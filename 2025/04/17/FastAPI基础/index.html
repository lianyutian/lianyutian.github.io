
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.33.1" theme-name="Stellar" theme-version="1.33.1">
  
  
  <meta name="generator" content="Hexo 7.3.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  <meta name="theme-color" content="#f9fafb">
  <title>FastAPIåŸºç¡€ - Lianyutian</title>

  
    <meta name="description" content="ç®€ä»‹FastAPI æ˜¯ä¸€ä¸ªç”¨äºæ„å»º API çš„ç°ä»£ã€å¿«é€Ÿï¼ˆé«˜æ€§èƒ½ï¼‰çš„ web æ¡†æ¶ï¼Œä½¿ç”¨ Python å¹¶åŸºäºæ ‡å‡†çš„ Python ç±»å‹æç¤ºã€‚ å…³é”®ç‰¹æ€§:  å¿«é€Ÿï¼šå¯ä¸ NodeJS å’Œ Go å¹¶è‚©çš„æé«˜æ€§èƒ½ï¼ˆå½’åŠŸäº Starlette å’Œ Pydanticï¼‰ã€‚æœ€å¿«çš„ Python web æ¡†æ¶ä¹‹ä¸€ã€‚ é«˜æ•ˆç¼–ç ï¼šæé«˜åŠŸèƒ½å¼€å‘é€Ÿåº¦çº¦ 200ï¼… è‡³ 300ï¼…ã€‚* æ›´å°‘ bugï¼šå‡å°‘çº¦ 40ï¼… çš„äººä¸ºï¼ˆ">
<meta property="og:type" content="article">
<meta property="og:title" content="FastAPIåŸºç¡€">
<meta property="og:url" content="http://example.com/2025/04/17/FastAPI%E5%9F%BA%E7%A1%80/">
<meta property="og:site_name" content="Lianyutian">
<meta property="og:description" content="ç®€ä»‹FastAPI æ˜¯ä¸€ä¸ªç”¨äºæ„å»º API çš„ç°ä»£ã€å¿«é€Ÿï¼ˆé«˜æ€§èƒ½ï¼‰çš„ web æ¡†æ¶ï¼Œä½¿ç”¨ Python å¹¶åŸºäºæ ‡å‡†çš„ Python ç±»å‹æç¤ºã€‚ å…³é”®ç‰¹æ€§:  å¿«é€Ÿï¼šå¯ä¸ NodeJS å’Œ Go å¹¶è‚©çš„æé«˜æ€§èƒ½ï¼ˆå½’åŠŸäº Starlette å’Œ Pydanticï¼‰ã€‚æœ€å¿«çš„ Python web æ¡†æ¶ä¹‹ä¸€ã€‚ é«˜æ•ˆç¼–ç ï¼šæé«˜åŠŸèƒ½å¼€å‘é€Ÿåº¦çº¦ 200ï¼… è‡³ 300ï¼…ã€‚* æ›´å°‘ bugï¼šå‡å°‘çº¦ 40ï¼… çš„äººä¸ºï¼ˆ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/assets/20240507174529.png">
<meta property="article:published_time" content="2025-04-17T13:35:13.000Z">
<meta property="article:modified_time" content="2025-12-23T08:50:16.674Z">
<meta property="article:author" content="lianyutian">
<meta property="article:tag" content="Webæ¡†æ¶">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/assets/20240507174529.png">
  
  
  
  <meta name="keywords" content="Webæ¡†æ¶">

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="Lianyutian" type="application/atom+xml">
  

  <link rel="stylesheet" href="/css/main.css?v=1.33.1">


  
    <link rel="shortcut icon" href="/assets/20240507174529.png">
  

  

  <script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"lianyutian","sameAs":[],"image":"/assets/20240507174529.png"},"dateCreated":"2025-04-17T13:35:13+00:00","dateModified":"2025-12-23T08:50:16+00:00","datePublished":"2025-04-17T13:35:13+00:00","description":"","headline":"FastAPIåŸºç¡€","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2025/04/17/FastAPI%E5%9F%BA%E7%A1%80/"},"publisher":{"@type":"Organization","name":"lianyutian","sameAs":[],"image":"/assets/20240507174529.png","logo":{"@type":"ImageObject","url":"/assets/20240507174529.png"}},"url":"http://example.com/2025/04/17/FastAPI%E5%9F%BA%E7%A1%80/","keywords":"Webæ¡†æ¶","image":[]}</script>
  
</head>
<body>

<div class="l_body content" id="start" layout="post" type="tech" ><aside class="l_left"><div class="sidebg"></div><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/assets/20240507174529.png" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main">Lianyutian</div><div class="sub cap">å­¦æ— æ­¢å¢ƒ</div></a></div></header>

<div class="nav-area">

<nav class="menu dis-select"><a class="nav-item active" title="æ–‡ç« " href="/" style="color:#1e6150"><span>æ–‡ç« </span></a><a class="nav-item" title="wiki" href="/wiki/" style="color:#1e6150"><span>wiki</span></a></nav>
</div>
<div class="widgets">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="ç«™å†…æœç´¢"></form><div id="search-result"></div><div class="search-no-result">æ²¡æœ‰æ‰¾åˆ°å†…å®¹ï¼</div></div>



<widget class="widget-wrapper recent post-list"><div class="widget-header dis-select"><span class="name">æœ€è¿‘æ›´æ–°</span></div><div class="widget-body fs14"><a class="item title" href="/2025/03/27/%E7%A4%BE%E5%8C%BA%E5%95%86%E5%9F%8E/"><span class="title">'ç¤¾åŒºå•†åŸ'</span></a><a class="item title" href="/2024/09/06/rpc%E5%9F%BA%E7%A1%80/"><span class="title">rpcåŸºç¡€</span></a><a class="item title" href="/2025/03/25/xxl-job/"><span class="title">xxl-jobåŸºç¡€</span></a><a class="item title" href="/2025/03/27/%E4%BA%91%E7%8E%AF%E5%A2%83/"><span class="title">äº‘ç¯å¢ƒ</span></a><a class="item title" href="/2025/03/28/%E5%8C%BA%E5%9D%97%E9%93%BE/"><span class="title">åŒºå—é“¾</span></a><a class="item title" href="/2024/12/13/circle-shop/"><span class="title">circle-shop</span></a><a class="item title" href="/2024/11/26/cloud-mall-vue/"><span class="title">cloud-mall-vue</span></a><a class="item title" href="/2024/09/06/protobuf%E5%9F%BA%E7%A1%80/"><span class="title">protobufåŸºç¡€</span></a><a class="item title" href="/2024/09/26/React%E5%9F%BA%E7%A1%80/"><span class="title">ReactåŸºç¡€</span></a><a class="item title" href="/2024/05/29/ReentrantLock%E8%AF%A6%E8%A7%A3/"><span class="title">ReentrantLockè¯¦è§£</span></a></div></widget>
</div>

</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">ä¸»é¡µ</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">æ–‡ç« </a></div>
<div class="flex-row" id="post-meta"><span class="text created">å‘å¸ƒäºï¼š<time datetime="2025-04-17T13:35:13.000Z">2025-04-17</time></span><span class="sep updated"></span><span class="text updated">æ›´æ–°äºï¼š<time datetime="2025-12-23T08:50:16.674Z">2025-12-23</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>FastAPIåŸºç¡€</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>FastAPI æ˜¯ä¸€ä¸ªç”¨äºæ„å»º API çš„ç°ä»£ã€å¿«é€Ÿï¼ˆé«˜æ€§èƒ½ï¼‰çš„ web æ¡†æ¶ï¼Œä½¿ç”¨ Python å¹¶åŸºäºæ ‡å‡†çš„ Python ç±»å‹æç¤ºã€‚</p>
<p>å…³é”®ç‰¹æ€§:</p>
<ul>
<li><strong>å¿«é€Ÿ</strong>ï¼šå¯ä¸ <strong>NodeJS</strong> å’Œ <strong>Go</strong> å¹¶è‚©çš„æé«˜æ€§èƒ½ï¼ˆå½’åŠŸäº Starlette å’Œ Pydanticï¼‰ã€‚<a target="_blank" rel="noopener" href="https://fastapi.tiangolo.com/zh/#_11">æœ€å¿«çš„ Python web æ¡†æ¶ä¹‹ä¸€</a>ã€‚</li>
<li><strong>é«˜æ•ˆç¼–ç </strong>ï¼šæé«˜åŠŸèƒ½å¼€å‘é€Ÿåº¦çº¦ 200ï¼… è‡³ 300ï¼…ã€‚*</li>
<li><strong>æ›´å°‘ bug</strong>ï¼šå‡å°‘çº¦ 40ï¼… çš„äººä¸ºï¼ˆå¼€å‘è€…ï¼‰å¯¼è‡´é”™è¯¯ã€‚*</li>
<li><strong>æ™ºèƒ½</strong>ï¼šæä½³çš„ç¼–è¾‘å™¨æ”¯æŒã€‚å¤„å¤„çš†å¯è‡ªåŠ¨è¡¥å…¨ï¼Œå‡å°‘è°ƒè¯•æ—¶é—´ã€‚</li>
<li><strong>ç®€å•</strong>ï¼šè®¾è®¡çš„æ˜“äºä½¿ç”¨å’Œå­¦ä¹ ï¼Œé˜…è¯»æ–‡æ¡£çš„æ—¶é—´æ›´çŸ­ã€‚</li>
<li><strong>ç®€çŸ­</strong>ï¼šä½¿ä»£ç é‡å¤æœ€å°åŒ–ã€‚é€šè¿‡ä¸åŒçš„å‚æ•°å£°æ˜å®ç°ä¸°å¯ŒåŠŸèƒ½ã€‚bug æ›´å°‘ã€‚</li>
<li><strong>å¥å£®</strong>ï¼šç”Ÿäº§å¯ç”¨çº§åˆ«çš„ä»£ç ã€‚è¿˜æœ‰è‡ªåŠ¨ç”Ÿæˆçš„äº¤äº’å¼æ–‡æ¡£ã€‚</li>
<li><strong>æ ‡å‡†åŒ–</strong>ï¼šåŸºäºï¼ˆå¹¶å®Œå…¨å…¼å®¹ï¼‰API çš„ç›¸å…³å¼€æ”¾æ ‡å‡†ï¼š<a target="_blank" rel="noopener" href="https://github.com/OAI/OpenAPI-Specification">OpenAPI</a> (ä»¥å‰è¢«ç§°ä¸º Swagger) å’Œ <a target="_blank" rel="noopener" href="https://json-schema.org/">JSON Schema</a>ã€‚</li>
</ul>
<p>å¯é€‰ä¾èµ–ï¼š</p>
<ul>
<li><p>ç”¨äº Pydanticï¼š</p>
<p><a target="_blank" rel="noopener" href="https://github.com/JoshData/python-email-validator"><code>email-validator</code></a> - ç”¨äº email æ ¡éªŒã€‚</p>
</li>
<li><p>ç”¨äº Starletteï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.python-httpx.org/"><code>httpx</code></a> - ä½¿ç”¨ <code>TestClient</code> æ—¶å®‰è£…ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://jinja.palletsprojects.com/"><code>jinja2</code></a> - ä½¿ç”¨é»˜è®¤æ¨¡æ¿é…ç½®æ—¶å®‰è£…ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://github.com/Kludex/python-multipart"><code>python-multipart</code></a> - éœ€è¦é€šè¿‡ <code>request.form()</code> å¯¹è¡¨å•è¿›è¡Œã€Œè§£æã€æ—¶å®‰è£…ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://pythonhosted.org/itsdangerous/"><code>itsdangerous</code></a> - éœ€è¦ <code>SessionMiddleware</code> æ”¯æŒæ—¶å®‰è£…ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://pyyaml.org/wiki/PyYAMLDocumentation"><code>pyyaml</code></a> - ä½¿ç”¨ Starlette æä¾›çš„ <code>SchemaGenerator</code> æ—¶å®‰è£…ï¼ˆæœ‰ FastAPI ä½ å¯èƒ½å¹¶ä¸éœ€è¦å®ƒï¼‰ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://graphene-python.org/"><code>graphene</code></a> - éœ€è¦ <code>GraphQLApp</code> æ”¯æŒæ—¶å®‰è£…ã€‚</li>
</ul>
</li>
<li><p>ç”¨äº FastAPI &#x2F; Starletteï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.uvicorn.org/"><code>uvicorn</code></a> - ç”¨äºåŠ è½½å’Œè¿è¡Œä½ çš„åº”ç”¨ç¨‹åºçš„æœåŠ¡å™¨ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://github.com/ijl/orjson"><code>orjson</code></a> - ä½¿ç”¨ <code>ORJSONResponse</code> æ—¶å®‰è£…ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://github.com/esnme/ultrajson"><code>ujson</code></a> - ä½¿ç”¨ <code>UJSONResponse</code> æ—¶å®‰è£…ã€‚</li>
</ul>
</li>
</ul>
<p>ä½ å¯ä»¥é€šè¿‡ <code>pip install &quot;fastapi[all]&quot;</code> å‘½ä»¤æ¥å®‰è£…ä»¥ä¸Šæ‰€æœ‰ä¾èµ–ã€‚</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install <span class="string">&quot;fastapi[standard]&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>å½“æ‚¨ä½¿ç”¨ <code>pip install &quot;fastapi[standard]&quot;</code> è¿›è¡Œå®‰è£…æ—¶ï¼Œå®ƒä¼šé™„å¸¦ä¸€äº›é»˜è®¤çš„å¯é€‰æ ‡å‡†ä¾èµ–é¡¹ã€‚</p>
<p>å¦‚æœæ‚¨ä¸æƒ³å®‰è£…è¿™äº›å¯é€‰ä¾èµ–ï¼Œå¯ä»¥é€‰æ‹©å®‰è£… <code>pip install fastapi</code>ã€‚</p>
</blockquote>
<h2 id="ç¬¬ä¸€æ­¥"><a href="#ç¬¬ä¸€æ­¥" class="headerlink" title="ç¬¬ä¸€æ­¥"></a>ç¬¬ä¸€æ­¥</h2><h3 id="å¯åŠ¨FastAPI"><a href="#å¯åŠ¨FastAPI" class="headerlink" title="å¯åŠ¨FastAPI"></a>å¯åŠ¨FastAPI</h3><blockquote>
<p>main.py</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/user/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@Time    : 2025/4/17 14:19</span></span><br><span class="line"><span class="string">@Author  : lianyutian</span></span><br><span class="line"><span class="string">@File    : test.py</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">root</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰§è¡Œ</span></span><br><span class="line">(.venv) PS D:\work\example_workspace\example_python\example_FastAPI\1.basic&gt; fastapi dev main.py        </span><br><span class="line"></span><br><span class="line">   FastAPI   Starting development server ğŸš€</span><br><span class="line"></span><br><span class="line">             Searching <span class="keyword">for</span> package file structure from directories with __init__.py files</span><br><span class="line">             Importing from D:\work\example_workspace\example_python\example_FastAPI\1.basic</span><br><span class="line"></span><br><span class="line">    module   ğŸ main.py</span><br><span class="line"></span><br><span class="line">      code   Importing the FastAPI app object from the module with the following code:</span><br><span class="line"></span><br><span class="line">             from main import app</span><br><span class="line"></span><br><span class="line">       app   Using import string: main:app</span><br><span class="line"></span><br><span class="line">    server   Server started at http://127.0.0.1:8000</span><br><span class="line">    server   Documentation at http://127.0.0.1:8000/docs</span><br><span class="line"></span><br><span class="line">       tip   Running <span class="keyword">in</span> development mode, <span class="keyword">for</span> production use: fastapi run</span><br><span class="line"></span><br><span class="line">             Logs:</span><br><span class="line"></span><br><span class="line">      INFO   Will watch <span class="keyword">for</span> changes <span class="keyword">in</span> these directories: [<span class="string">&#x27;D:\\work\\example_workspace\\example_python\\example_FastAPI\\1.basic&#x27;</span>]</span><br><span class="line">      INFO   Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)</span><br><span class="line"></span><br><span class="line">      INFO   Will watch <span class="keyword">for</span> changes <span class="keyword">in</span> these directories: [<span class="string">&#x27;D:\\work\\example_workspace\\example_python\\example_FastAPI\\1.basic&#x27;</span>]</span><br><span class="line">      INFO   Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)</span><br><span class="line">      INFO   Started reloader process [9924] using WatchFiles</span><br><span class="line">      INFO   Started server process [34056]</span><br><span class="line">      INFO   Waiting <span class="keyword">for</span> application startup.</span><br><span class="line">      INFO   Application startup complete.</span><br><span class="line">      INFO   127.0.0.1:1250 - <span class="string">&quot;GET / HTTP/1.1&quot;</span> 200</span><br><span class="line">      INFO   127.0.0.1:1250 - <span class="string">&quot;GET /favicon.ico HTTP/1.1&quot;</span> 404</span><br><span class="line">      INFO   127.0.0.1:1251 - <span class="string">&quot;GET /docs HTTP/1.1&quot;</span> 200</span><br><span class="line">      INFO   127.0.0.1:1251 - <span class="string">&quot;GET /openapi.json HTTP/1.1&quot;</span> 200</span><br><span class="line">      INFO   127.0.0.1:1260 - <span class="string">&quot;GET / HTTP/1.1&quot;</span> 200</span><br></pre></td></tr></table></figure>

<p>åœ¨è¾“å‡ºè¡Œä¸­ï¼Œä¼šæœ‰ä¸€è¡Œä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>INFO   Uvicorn running on <a target="_blank" rel="noopener" href="http://127.0.0.1:8000/">http://127.0.0.1:8000</a> (Press CTRL+C to quit)</p>
</blockquote>
<p>è¯¥è¡Œæ˜¾ç¤ºäº†ä½ çš„åº”ç”¨åœ¨æœ¬æœºæ‰€æä¾›æœåŠ¡çš„ URL åœ°å€ã€‚</p>
<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/20250417142926.png" alt="å›¾"></p>
<h3 id="åˆ†æ­¥æ¦‚æ‹¬"><a href="#åˆ†æ­¥æ¦‚æ‹¬" class="headerlink" title="åˆ†æ­¥æ¦‚æ‹¬"></a>åˆ†æ­¥æ¦‚æ‹¬</h3><h4 id="æ­¥éª¤1ï¼šå¯¼å…¥Fast-API"><a href="#æ­¥éª¤1ï¼šå¯¼å…¥Fast-API" class="headerlink" title="æ­¥éª¤1ï¼šå¯¼å…¥Fast API"></a>æ­¥éª¤1ï¼šå¯¼å…¥Fast API</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br></pre></td></tr></table></figure>

<p><code>FastAPI</code> æ˜¯ä¸€ä¸ªä¸ºä½ çš„ API æä¾›äº†æ‰€æœ‰åŠŸèƒ½çš„ Python ç±»ã€‚</p>
<blockquote>
<p><code>FastAPI</code> æ˜¯ç›´æ¥ä» <code>Starlette</code> ç»§æ‰¿çš„ç±»ã€‚</p>
<p>ä½ å¯ä»¥é€šè¿‡ <code>FastAPI</code> ä½¿ç”¨æ‰€æœ‰çš„ <a target="_blank" rel="noopener" href="https://www.starlette.io/">Starlette</a> çš„åŠŸèƒ½ã€‚</p>
</blockquote>
<h4 id="æ­¥éª¤2ï¼šåˆ›å»ºä¸€ä¸ª-FastAPIã€å®ä¾‹ã€‘"><a href="#æ­¥éª¤2ï¼šåˆ›å»ºä¸€ä¸ª-FastAPIã€å®ä¾‹ã€‘" class="headerlink" title="æ­¥éª¤2ï¼šåˆ›å»ºä¸€ä¸ª FastAPIã€å®ä¾‹ã€‘"></a>æ­¥éª¤2ï¼šåˆ›å»ºä¸€ä¸ª <code>FastAPI</code>ã€å®ä¾‹ã€‘</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app = FastAPI()</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„å˜é‡ <code>app</code> ä¼šæ˜¯ <code>FastAPI</code> ç±»çš„ä¸€ä¸ªã€Œå®ä¾‹ã€ã€‚</p>
<p>è¿™ä¸ªå®ä¾‹å°†æ˜¯åˆ›å»ºä½ æ‰€æœ‰ API çš„ä¸»è¦äº¤äº’å¯¹è±¡ã€‚</p>
<h4 id="æ­¥éª¤-3ï¼šåˆ›å»ºä¸€ä¸ªã€è·¯å¾„æ“ä½œã€‘"><a href="#æ­¥éª¤-3ï¼šåˆ›å»ºä¸€ä¸ªã€è·¯å¾„æ“ä½œã€‘" class="headerlink" title="æ­¥éª¤ 3ï¼šåˆ›å»ºä¸€ä¸ªã€è·¯å¾„æ“ä½œã€‘"></a>æ­¥éª¤ 3ï¼šåˆ›å»ºä¸€ä¸ªã€è·¯å¾„æ“ä½œã€‘</h4><h5 id="è·¯å¾„"><a href="#è·¯å¾„" class="headerlink" title="è·¯å¾„"></a>è·¯å¾„</h5><p>è¿™é‡Œçš„ã€Œè·¯å¾„ã€æŒ‡çš„æ˜¯ URL ä¸­ä»ç¬¬ä¸€ä¸ª <code>/</code> èµ·çš„ååŠéƒ¨åˆ†ã€‚</p>
<p>æ‰€ä»¥ï¼Œåœ¨ä¸€ä¸ªè¿™æ ·çš„ URL ä¸­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://example.com/items/foo</span><br></pre></td></tr></table></figure>

<p>è·¯å¾„ä¼šæ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/items/foo</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ã€Œè·¯å¾„ã€ä¹Ÿé€šå¸¸è¢«ç§°ä¸ºã€Œç«¯ç‚¹ã€æˆ–ã€Œè·¯ç”±ã€ã€‚</p>
</blockquote>
<p>å¼€å‘ API æ—¶ï¼Œã€Œè·¯å¾„ã€æ˜¯ç”¨æ¥åˆ†ç¦»ã€Œå…³æ³¨ç‚¹ã€å’Œã€Œèµ„æºã€çš„ä¸»è¦æ‰‹æ®µã€‚</p>
<h5 id="æ“ä½œ"><a href="#æ“ä½œ" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h5><p>è¿™é‡Œçš„ã€Œæ“ä½œã€æŒ‡çš„æ˜¯ä¸€ç§ HTTPã€Œæ–¹æ³•ã€ã€‚</p>
<p>ä¸‹åˆ—ä¹‹ä¸€ï¼š</p>
<ul>
<li><code>POST</code></li>
<li><code>GET</code></li>
<li><code>PUT</code></li>
<li><code>DELETE</code></li>
</ul>
<p>ä»¥åŠæ›´å°‘è§çš„å‡ ç§ï¼š</p>
<ul>
<li><code>OPTIONS</code></li>
<li><code>HEAD</code></li>
<li><code>PATCH</code></li>
<li><code>TRACE</code></li>
</ul>
<p>åœ¨ HTTP åè®®ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸Šçš„å…¶ä¸­ä¸€ç§ï¼ˆæˆ–å¤šç§ï¼‰ã€Œæ–¹æ³•ã€ä¸æ¯ä¸ªè·¯å¾„è¿›è¡Œé€šä¿¡ã€‚</p>
<hr>
<p>åœ¨å¼€å‘ API æ—¶ï¼Œä½ é€šå¸¸ä½¿ç”¨ç‰¹å®šçš„ HTTP æ–¹æ³•å»æ‰§è¡Œç‰¹å®šçš„è¡Œä¸ºã€‚</p>
<p>é€šå¸¸ä½¿ç”¨ï¼š</p>
<ul>
<li><code>POST</code>ï¼šåˆ›å»ºæ•°æ®ã€‚</li>
<li><code>GET</code>ï¼šè¯»å–æ•°æ®ã€‚</li>
<li><code>PUT</code>ï¼šæ›´æ–°æ•°æ®ã€‚</li>
<li><code>DELETE</code>ï¼šåˆ é™¤æ•°æ®ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œåœ¨ OpenAPI ä¸­ï¼Œæ¯ä¸€ä¸ª HTTP æ–¹æ³•éƒ½è¢«ç§°ä¸ºã€Œæ“ä½œã€ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿæ‰“ç®—ç§°å‘¼å®ƒä»¬ä¸ºã€Œæ“ä½œã€ã€‚</p>
<h5 id="å®šä¹‰ä¸€ä¸ªã€è·¯å¾„æ“ä½œè£…é¥°å™¨ã€‘"><a href="#å®šä¹‰ä¸€ä¸ªã€è·¯å¾„æ“ä½œè£…é¥°å™¨ã€‘" class="headerlink" title="å®šä¹‰ä¸€ä¸ªã€è·¯å¾„æ“ä½œè£…é¥°å™¨ã€‘"></a>å®šä¹‰ä¸€ä¸ªã€è·¯å¾„æ“ä½œè£…é¥°å™¨ã€‘</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br></pre></td></tr></table></figure>

<p><code>@app.get(&quot;/&quot;)</code> å‘Šè¯‰ <strong>FastAPI</strong> åœ¨å®ƒä¸‹æ–¹çš„å‡½æ•°è´Ÿè´£å¤„ç†å¦‚ä¸‹è®¿é—®è¯·æ±‚ï¼š</p>
<ul>
<li>è¯·æ±‚è·¯å¾„ä¸º <code>/</code></li>
<li>ä½¿ç”¨ <code>get</code> æ“ä½œ</li>
</ul>
<hr>
<p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ“ä½œï¼š</p>
<ul>
<li><code>@app.post()</code></li>
<li><code>@app.put()</code></li>
<li><code>@app.delete()</code></li>
</ul>
<p>ä»¥åŠæ›´å°‘è§çš„ï¼š</p>
<ul>
<li><code>@app.options()</code></li>
<li><code>@app.head()</code></li>
<li><code>@app.patch()</code></li>
<li><code>@app.trace()</code></li>
</ul>
<h4 id="æ­¥éª¤4ï¼šå®šä¹‰ã€è·¯å¾„æ“ä½œå‡½æ•°ã€‘"><a href="#æ­¥éª¤4ï¼šå®šä¹‰ã€è·¯å¾„æ“ä½œå‡½æ•°ã€‘" class="headerlink" title="æ­¥éª¤4ï¼šå®šä¹‰ã€è·¯å¾„æ“ä½œå‡½æ•°ã€‘"></a>æ­¥éª¤4ï¼šå®šä¹‰ã€è·¯å¾„æ“ä½œå‡½æ•°ã€‘</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">root</span>():</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸€ä¸ª Python å‡½æ•°ã€‚</p>
<p>æ¯å½“ <strong>FastAPI</strong> æ¥æ”¶ä¸€ä¸ªä½¿ç”¨ <code>GET</code> æ–¹æ³•è®¿é—® URLã€Œ<code>/</code>ã€çš„è¯·æ±‚æ—¶è¿™ä¸ªå‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚</p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒæ˜¯ä¸€ä¸ª <code>async</code> å‡½æ•°ã€‚</p>
<hr>
<p>ä½ ä¹Ÿå¯ä»¥å°†å…¶å®šä¹‰ä¸ºå¸¸è§„å‡½æ•°è€Œä¸ä½¿ç”¨ <code>async def</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">root</span>():</span><br></pre></td></tr></table></figure>

<h4 id="æ­¥éª¤5ï¼šè¿”å›å†…å®¹"><a href="#æ­¥éª¤5ï¼šè¿”å›å†…å®¹" class="headerlink" title="æ­¥éª¤5ï¼šè¿”å›å†…å®¹"></a>æ­¥éª¤5ï¼šè¿”å›å†…å®¹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>ä½ å¯ä»¥è¿”å›ä¸€ä¸ª <code>dict</code>ã€<code>list</code>ï¼Œåƒ <code>str</code>ã€<code>int</code> ä¸€æ ·çš„å•ä¸ªå€¼ï¼Œç­‰ç­‰ã€‚</p>
<p>ä½ è¿˜å¯ä»¥è¿”å› Pydantic æ¨¡å‹ï¼ˆç¨åä½ å°†äº†è§£æ›´å¤šï¼‰ã€‚</p>
<p>è¿˜æœ‰è®¸å¤šå…¶ä»–å°†ä¼šè‡ªåŠ¨è½¬æ¢ä¸º JSON çš„å¯¹è±¡å’Œæ¨¡å‹ï¼ˆåŒ…æ‹¬ ORM å¯¹è±¡ç­‰ï¼‰ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul>
<li>å¯¼å…¥ <code>FastAPI</code>ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ª <code>app</code> å®ä¾‹ã€‚</li>
<li>ç¼–å†™ä¸€ä¸ª<strong>è·¯å¾„æ“ä½œè£…é¥°å™¨</strong>ï¼Œå¦‚ <code>@app.get(&quot;/&quot;)</code>ã€‚</li>
<li>å®šä¹‰ä¸€ä¸ª<strong>è·¯å¾„æ“ä½œå‡½æ•°</strong>ï¼Œå¦‚ <code>def root(): ...</code>ã€‚</li>
<li>ä½¿ç”¨å‘½ä»¤ <code>fastapi dev</code> è¿è¡Œå¼€å‘æœåŠ¡å™¨ã€‚</li>
</ul>
<h3 id="äº¤äº’å¼APIæ–‡æ¡£"><a href="#äº¤äº’å¼APIæ–‡æ¡£" class="headerlink" title="äº¤äº’å¼APIæ–‡æ¡£"></a>äº¤äº’å¼APIæ–‡æ¡£</h3><p>è·³è½¬åˆ° <a target="_blank" rel="noopener" href="http://127.0.0.1:8000/docs%E3%80%82">http://127.0.0.1:8000/docsã€‚</a></p>
<p>ä½ å°†ä¼šçœ‹åˆ°è‡ªåŠ¨ç”Ÿæˆçš„äº¤äº’å¼ API æ–‡æ¡£ï¼ˆç”± <a target="_blank" rel="noopener" href="https://github.com/swagger-api/swagger-ui">Swagger UI</a> æä¾›ï¼‰ï¼š</p>
<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/20250417143054.png" alt="å›¾"></p>
<h2 id="è·¯å¾„å‚æ•°"><a href="#è·¯å¾„å‚æ•°" class="headerlink" title="è·¯å¾„å‚æ•°"></a>è·¯å¾„å‚æ•°</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>FastAPI æ”¯æŒä½¿ç”¨ Python å­—ç¬¦ä¸²æ ¼å¼åŒ–è¯­æ³•å£°æ˜<strong>è·¯å¾„å‚æ•°</strong>ï¼ˆ<strong>å˜é‡</strong>ï¼‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç æŠŠè·¯å¾„å‚æ•° <code>item_id</code> çš„å€¼ä¼ é€’ç»™è·¯å¾„å‡½æ•°çš„å‚æ•° <code>item_id</code>ã€‚</p>
<p>è¿è¡Œç¤ºä¾‹å¹¶è®¿é—® <a target="_blank" rel="noopener" href="http://127.0.0.1:8000/items/hello%EF%BC%8C%E5%8F%AF%E8%8E%B7%E5%BE%97%E5%A6%82%E4%B8%8B%E5%93%8D%E5%BA%94%EF%BC%9A">http://127.0.0.1:8000/items/helloï¼Œå¯è·å¾—å¦‚ä¸‹å“åº”ï¼š</a></p>
<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/20250417161918.png" alt="å›¾"></p>
<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/20250417162146.png" alt="å›¾"></p>
<h3 id="å£°æ˜è·¯å¾„å‚æ•°ç±»å‹"><a href="#å£°æ˜è·¯å¾„å‚æ•°ç±»å‹" class="headerlink" title="å£°æ˜è·¯å¾„å‚æ•°ç±»å‹"></a>å£°æ˜è·¯å¾„å‚æ•°ç±»å‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items_with_type/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item_with_type</span>(<span class="params">item_id: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br></pre></td></tr></table></figure>

<p>æœ¬ä¾‹æŠŠ <code>item_id</code> çš„ç±»å‹å£°æ˜ä¸º <code>int</code>ã€‚</p>
<p>å½“æˆ‘ä»¬è¾“å…¥å‚æ•°ä¸ä¸º <code>int</code> ç±»å‹æ—¶ï¼Œä¼šæŠ›å‡ºå¦‚ä¸‹é”™è¯¯ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int_parsing&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;loc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;path&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;item_id&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Input should be a valid integer, unable to parse string as an integer&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ff&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/20250417164205.png" alt="å›¾"></p>
<blockquote>
<p><strong>FastAPI</strong> ä½¿ç”¨ Python ç±»å‹å£°æ˜å®ç°äº†æ•°æ®æ ¡éªŒã€‚</p>
<p>æ³¨æ„ï¼Œä¸Šé¢çš„é”™è¯¯æ¸…æ™°åœ°æŒ‡å‡ºäº†æœªé€šè¿‡æ ¡éªŒçš„å…·ä½“åŸå› ã€‚</p>
<p>è¿™åœ¨å¼€å‘è°ƒè¯•ä¸ API äº¤äº’çš„ä»£ç æ—¶éå¸¸æœ‰ç”¨ã€‚</p>
</blockquote>
<h3 id="æ–¹æ³•å®šä¹‰é¡ºåº"><a href="#æ–¹æ³•å®šä¹‰é¡ºåº" class="headerlink" title="æ–¹æ³•å®šä¹‰é¡ºåº"></a>æ–¹æ³•å®šä¹‰é¡ºåº</h3><p>æœ‰æ—¶ï¼Œ<em>è·¯å¾„æ“ä½œ</em>ä¸­çš„è·¯å¾„æ˜¯å†™æ­»çš„ã€‚</p>
<p>æ¯”å¦‚è¦ä½¿ç”¨ <code>/users/me</code> è·å–å½“å‰ç”¨æˆ·çš„æ•°æ®ã€‚</p>
<p>ç„¶åè¿˜è¦ä½¿ç”¨ <code>/users/&#123;user_id&#125;</code>ï¼Œé€šè¿‡ç”¨æˆ· ID è·å–æŒ‡å®šç”¨æˆ·çš„æ•°æ®ã€‚</p>
<p>ç”±äº<em>è·¯å¾„æ“ä½œ</em>æ˜¯æŒ‰é¡ºåºä¾æ¬¡è¿è¡Œçš„ï¼Œå› æ­¤ï¼Œä¸€å®šè¦åœ¨ <code>/users/&#123;user_id&#125;</code> ä¹‹å‰å£°æ˜ <code>/users/me</code> ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/me&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_user_me</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;user_id&quot;</span>: <span class="string">&quot;the current user&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/&#123;user_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_user</span>(<span class="params">user_id: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;user_id&quot;</span>: user_id&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶è¾“å…¥ <code>http://127.0.0.1:8000/users/me</code> è¾“å‡ºå¦‚ä¸‹ç»“æœï¼š</p>
<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/20250417164823.png" alt="å›¾"></p>
<p>å¦‚æœæ–¹æ³•å®šä¹‰é¡ºåºç›¸åï¼Œ<code>/users/&#123;user_id&#125;</code> å°†åŒ¹é… <code>/users/me</code>ï¼ŒFastAPI ä¼š<strong>è®¤ä¸º</strong>æ­£åœ¨æ¥æ”¶å€¼ä¸º <code>&quot;me&quot;</code> çš„ <code>user_id</code> å‚æ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/&#123;user_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_user</span>(<span class="params">user_id: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;user_id&quot;</span>: user_id&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/me&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_user_me</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;user_id&quot;</span>: <span class="string">&quot;the current user&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶å†è¾“å…¥ <code>http://127.0.0.1:8000/users/me</code> è¾“å‡ºå¦‚ä¸‹ç»“æœï¼š</p>
<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/20250417164949.png" alt="å›¾"></p>
<h3 id="é¢„è®¾å€¼"><a href="#é¢„è®¾å€¼" class="headerlink" title="é¢„è®¾å€¼"></a>é¢„è®¾å€¼</h3><p>ä½¿ç”¨ Python çš„ <code>Enum</code> ç±»å‹æ¥æ”¶é¢„è®¾çš„<em>è·¯å¾„å‚æ•°</em>ã€‚</p>
<h4 id="Enumé¢„è®¾è·¯å¾„"><a href="#Enumé¢„è®¾è·¯å¾„" class="headerlink" title="Enumé¢„è®¾è·¯å¾„"></a>Enumé¢„è®¾è·¯å¾„</h4><p>å¯¼å…¥ <code>Enum</code> å¹¶åˆ›å»ºç»§æ‰¿è‡ª <code>str</code> å’Œ <code>Enum</code> çš„å­ç±»ã€‚</p>
<p>é€šè¿‡ä» <code>str</code> ç»§æ‰¿ï¼ŒAPI æ–‡æ¡£å°±èƒ½æŠŠå€¼çš„ç±»å‹å®šä¹‰ä¸º<strong>å­—ç¬¦ä¸²</strong>ï¼Œå¹¶ä¸”èƒ½æ­£ç¡®æ¸²æŸ“ã€‚</p>
<p>ç„¶åï¼Œåˆ›å»ºåŒ…å«å›ºå®šå€¼çš„ç±»å±æ€§ï¼Œè¿™äº›å›ºå®šå€¼æ˜¯å¯ç”¨çš„æœ‰æ•ˆå€¼ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModelName</span>(<span class="built_in">str</span>, Enum):</span><br><span class="line">    alexnet = <span class="string">&quot;alexnet&quot;</span></span><br><span class="line">    resnet = <span class="string">&quot;resnet&quot;</span></span><br><span class="line">    lenet = <span class="string">&quot;lenet&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="å£°æ˜è·¯å¾„å‚æ•°"><a href="#å£°æ˜è·¯å¾„å‚æ•°" class="headerlink" title="å£°æ˜è·¯å¾„å‚æ•°"></a>å£°æ˜è·¯å¾„å‚æ•°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModelName</span>(<span class="built_in">str</span>, Enum):</span><br><span class="line">    alexnet = <span class="string">&quot;alexnet&quot;</span></span><br><span class="line">    resnet = <span class="string">&quot;resnet&quot;</span></span><br><span class="line">    lenet = <span class="string">&quot;lenet&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/models/&#123;model_name&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_model</span>(<span class="params">model_name: ModelName</span>):</span><br><span class="line">    <span class="keyword">if</span> model_name <span class="keyword">is</span> ModelName.alexnet:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;model_name&quot;</span>: model_name, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Deep Learning FTW!&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> model_name.value == <span class="string">&quot;lenet&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;model_name&quot;</span>: model_name, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;LeCNN all the images&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;model_name&quot;</span>: model_name, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Have some residuals&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>API æ–‡æ¡£ä¼šæ˜¾ç¤ºé¢„å®šä¹‰<em>è·¯å¾„å‚æ•°</em>çš„å¯ç”¨å€¼ï¼š</p>
<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/20250417171805.png" alt="å›¾"></p>
<h3 id="åŒ…å«è·¯å¾„çš„è·¯å¾„å‚æ•°"><a href="#åŒ…å«è·¯å¾„çš„è·¯å¾„å‚æ•°" class="headerlink" title="åŒ…å«è·¯å¾„çš„è·¯å¾„å‚æ•°"></a>åŒ…å«è·¯å¾„çš„è·¯å¾„å‚æ•°</h3><p>å‡è®¾<em>è·¯å¾„æ“ä½œ</em>çš„è·¯å¾„ä¸º <code>/files/&#123;file_path&#125;</code>ã€‚</p>
<p>ä½†éœ€è¦ <code>file_path</code> ä¸­ä¹ŸåŒ…å«<em>è·¯å¾„</em>ï¼Œæ¯”å¦‚ï¼Œ<code>home/johndoe/myfile.txt</code>ã€‚</p>
<p>æ­¤æ—¶ï¼Œè¯¥æ–‡ä»¶çš„ URL æ˜¯è¿™æ ·çš„ï¼š<code>/files/home/johndoe/myfile.txt</code>ã€‚</p>
<h3 id="è·¯å¾„è½¬æ¢å™¨"><a href="#è·¯å¾„è½¬æ¢å™¨" class="headerlink" title="è·¯å¾„è½¬æ¢å™¨"></a>è·¯å¾„è½¬æ¢å™¨</h3><p>æˆ–è€…ä½¿ç”¨ Starlette çš„é€‰é¡¹å£°æ˜åŒ…å«<em>è·¯å¾„</em>çš„<em>è·¯å¾„å‚æ•°</em>ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/files/&#123;file_path:path&#125;</span><br></pre></td></tr></table></figure>

<p>æœ¬ä¾‹ä¸­ï¼Œå‚æ•°åä¸º <code>file_path</code>ï¼Œç»“å°¾éƒ¨åˆ†çš„ <code>:path</code> è¯´æ˜è¯¥å‚æ•°åº”åŒ¹é…<em>è·¯å¾„</em>ã€‚</p>
<p>ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/files/&#123;file_path:path&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_file</span>(<span class="params">file_path: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;file_path&quot;</span>: file_path&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„ï¼ŒåŒ…å« <code>/home/johndoe/myfile.txt</code> çš„è·¯å¾„å‚æ•°è¦ä»¥æ–œæ ï¼ˆ<code>/</code>ï¼‰å¼€å¤´ã€‚</p>
<p>æœ¬ä¾‹ä¸­çš„ URL æ˜¯ <code>/files//home/johndoe/myfile.txt</code>ã€‚æ³¨æ„ï¼Œ<code>files</code> å’Œ <code>home</code> ä¹‹é—´è¦ä½¿ç”¨<strong>åŒæ–œæ </strong>ï¼ˆ<code>//</code>ï¼‰ã€‚</p>
</blockquote>
<h2 id="æŸ¥è¯¢å‚æ•°"><a href="#æŸ¥è¯¢å‚æ•°" class="headerlink" title="æŸ¥è¯¢å‚æ•°"></a>æŸ¥è¯¢å‚æ•°</h2><h3 id="é»˜è®¤å€¼"><a href="#é»˜è®¤å€¼" class="headerlink" title="é»˜è®¤å€¼"></a>é»˜è®¤å€¼</h3><p>å½“å£°æ˜çš„å‡½æ•°ä¸­ã€å‡½æ•°å‚æ•°ã€‘ä¸æ˜¯ã€è·¯å¾„å‚æ•°ã€‘ä¸­çš„ä¸€éƒ¨åˆ†æ—¶ï¼Œ<strong>å‡½æ•°ä¸­çš„å‚æ•°</strong>ä¼šè¢«è‡ªåŠ¨è§£é‡Šä¸ºã€æŸ¥è¯¢å‚æ•°ã€‘</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line">fake_items_db = [&#123;<span class="string">&quot;item_name&quot;</span>: <span class="string">&quot;Foo&quot;</span>&#125;, &#123;<span class="string">&quot;item_name&quot;</span>: <span class="string">&quot;Bar&quot;</span>&#125;, &#123;<span class="string">&quot;item_name&quot;</span>: <span class="string">&quot;Baz&quot;</span>&#125;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">skip: <span class="built_in">int</span> = <span class="number">0</span>, limit: <span class="built_in">int</span> = <span class="number">10</span></span>):</span><br><span class="line">    <span class="keyword">return</span> fake_items_db[skip : skip + limit]</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/%E6%88%AA%E5%B1%8F2025-04-21%2014.42.56.png" alt="å›¾"></p>
<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/202504211454317.png" alt="å›¾"></p>
<p>å¯ä»¥çœ‹åˆ°å‚æ•°é»˜è®¤å€¼skipä¸º0ï¼Œlimitä¸º10ã€‚</p>
<p>è¿™äº›å€¼éƒ½æ˜¯ URL çš„ç»„æˆéƒ¨åˆ†ï¼Œå› æ­¤ï¼Œå®ƒä»¬çš„ç±»å‹<strong>æœ¬åº”</strong>æ˜¯å­—ç¬¦ä¸²ã€‚</p>
<p>ä½†å£°æ˜ Python ç±»å‹ï¼ˆä¸Šä¾‹ä¸­ä¸º <code>int</code>ï¼‰ä¹‹åï¼Œè¿™äº›å€¼å°±ä¼šè½¬æ¢ä¸ºå£°æ˜çš„ç±»å‹ï¼Œå¹¶è¿›è¡Œç±»å‹æ ¡éªŒã€‚</p>
<h3 id="å¯é€‰å‚æ•°"><a href="#å¯é€‰å‚æ•°" class="headerlink" title="å¯é€‰å‚æ•°"></a>å¯é€‰å‚æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">str</span>, q: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;q&quot;</span>: q&#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br></pre></td></tr></table></figure>

<p>æœ¬ä¾‹ä¸­ï¼ŒæŸ¥è¯¢å‚æ•° <code>q</code> æ˜¯å¯é€‰çš„ï¼Œé»˜è®¤å€¼ä¸º <code>None</code>ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œ<strong>FastAPI</strong> å¯ä»¥è¯†åˆ«å‡º <code>item_id</code> æ˜¯è·¯å¾„å‚æ•°ï¼Œ<code>q</code> ä¸æ˜¯è·¯å¾„å‚æ•°ï¼Œè€Œæ˜¯æŸ¥è¯¢å‚æ•°ã€‚<br>å› ä¸ºé»˜è®¤å€¼ä¸º <code>= None</code>ï¼ŒFastAPI æŠŠ <code>q</code> è¯†åˆ«ä¸ºå¯é€‰å‚æ•°ã€‚</p>
<p>FastAPI ä¸ä½¿ç”¨ <code>Optional[str]</code> ä¸­çš„ <code>Optional</code>ï¼ˆåªä½¿ç”¨ <code>str</code>ï¼‰ï¼Œä½† <code>Optional[str]</code> å¯ä»¥å¸®åŠ©ç¼–è¾‘å™¨å‘ç°ä»£ç ä¸­çš„é”™è¯¯ã€‚</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/imgimage-20250424105914316.png" alt="image-20250424105914316"></p>
<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/imgimage-20250424110146996.png" alt="image-20250424110146996"></p>
<h3 id="æŸ¥è¯¢å‚æ•°ç±»å‹è½¬æ¢"><a href="#æŸ¥è¯¢å‚æ•°ç±»å‹è½¬æ¢" class="headerlink" title="æŸ¥è¯¢å‚æ•°ç±»å‹è½¬æ¢"></a>æŸ¥è¯¢å‚æ•°ç±»å‹è½¬æ¢</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">short: <span class="built_in">bool</span> = <span class="literal">False</span></span>):</span><br><span class="line">    item = &#123;<span class="string">&quot;short&quot;</span>: short&#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> short:</span><br><span class="line">        item = &#123;<span class="string">&quot;short&quot;</span>: <span class="string">&quot;not short&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>

<p>å½“shortå€¼éç©º æˆ– éFalseæ—¶ï¼ŒFastAPI ä¼šè‡ªåŠ¨è½¬æ¢å‚æ•°ç±»å‹ã€‚</p>
<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/imgimage-20250424111542216.png" alt="image-20250424111542216"></p>
<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/imgimage-20250424111624455.png" alt="image-20250424111624455"></p>
<h3 id="å¤šä¸ªè·¯å¾„å’ŒæŸ¥è¯¢å‚æ•°"><a href="#å¤šä¸ªè·¯å¾„å’ŒæŸ¥è¯¢å‚æ•°" class="headerlink" title="å¤šä¸ªè·¯å¾„å’ŒæŸ¥è¯¢å‚æ•°"></a>å¤šä¸ªè·¯å¾„å’ŒæŸ¥è¯¢å‚æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/&#123;user_id&#125;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_user_item</span>(<span class="params"></span></span><br><span class="line"><span class="params">        user_id: <span class="built_in">int</span>, item_id: <span class="built_in">str</span>, q: <span class="built_in">str</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    item = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;owner_id&quot;</span>: user_id&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        item.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/imgimage-20250424134332716.png" alt="image-20250424134332716"></p>
<h3 id="å¿…é€‰æŸ¥è¯¢å‚æ•°"><a href="#å¿…é€‰æŸ¥è¯¢å‚æ•°" class="headerlink" title="å¿…é€‰æŸ¥è¯¢å‚æ•°"></a>å¿…é€‰æŸ¥è¯¢å‚æ•°</h3><p>æŸ¥è¯¢å‚æ•°ä¸è®¾ç½®é»˜è®¤å€¼ï¼Œé‚£ä¹ˆè¯¥æŸ¥è¯¢å‚æ•°å°±æ˜¯<strong>å¿…é€‰</strong>çš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„æŸ¥è¯¢å‚æ•° <code>item_id</code> æ˜¯ç±»å‹ä¸º <code>int</code> çš„å¿…é€‰æŸ¥è¯¢å‚æ•°ã€‚</p>
<p>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥å¦‚ä¸‹URLï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8000/items</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºè·¯å¾„ä¸­æ²¡æœ‰å¿…é€‰å‚æ•° <code>item_id</code>ï¼Œ è¿”å›çš„å“åº”ä¸­ä¼šæ˜¾ç¤ºå¦‚ä¸‹é”™è¯¯ä¿¡æ¯ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;missing&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;loc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;query&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;item_id&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Field required&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¾“å…¥æ­£ç¡®URLï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8000/items?item_id=1</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°æ­£ç¡®çš„è¿”å›ç»“æœï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;item_id&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="è¯·æ±‚ä½“"><a href="#è¯·æ±‚ä½“" class="headerlink" title="è¯·æ±‚ä½“"></a>è¯·æ±‚ä½“</h2><h3 id="è¯·æ±‚ä½“æ¦‚å¿µ"><a href="#è¯·æ±‚ä½“æ¦‚å¿µ" class="headerlink" title="è¯·æ±‚ä½“æ¦‚å¿µ"></a>è¯·æ±‚ä½“æ¦‚å¿µ</h3><p>FastAPI ä½¿ç”¨<strong>è¯·æ±‚ä½“</strong>ä»å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚æµè§ˆå™¨ï¼‰å‘ API å‘é€æ•°æ®ã€‚</p>
<p><strong>è¯·æ±‚ä½“</strong>æ˜¯å®¢æˆ·ç«¯å‘é€ç»™ API çš„æ•°æ®ã€‚<strong>å“åº”ä½“</strong>æ˜¯ API å‘é€ç»™å®¢æˆ·ç«¯çš„æ•°æ®ã€‚</p>
<p>API åŸºæœ¬ä¸Šè‚¯å®šè¦å‘é€<strong>å“åº”ä½“</strong>ï¼Œä½†æ˜¯å®¢æˆ·ç«¯ä¸ä¸€å®šå‘é€<strong>è¯·æ±‚ä½“</strong>ã€‚</p>
<p>ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://docs.pydantic.dev/">Pydantic</a> æ¨¡å‹å£°æ˜<strong>è¯·æ±‚ä½“</strong>ï¼Œèƒ½å……åˆ†åˆ©ç”¨å®ƒçš„åŠŸèƒ½å’Œä¼˜ç‚¹ã€‚</p>
<h3 id="åˆ›å»ºæ•°æ®æ¨¡å‹"><a href="#åˆ›å»ºæ•°æ®æ¨¡å‹" class="headerlink" title="åˆ›å»ºæ•°æ®æ¨¡å‹"></a>åˆ›å»ºæ•°æ®æ¨¡å‹</h3><h4 id="å¯¼å…¥-BaseModel"><a href="#å¯¼å…¥-BaseModel" class="headerlink" title="å¯¼å…¥ BaseModel"></a>å¯¼å…¥ BaseModel</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br></pre></td></tr></table></figure>

<p>ä¸å£°æ˜æŸ¥è¯¢å‚æ•°ä¸€æ ·ï¼ŒåŒ…å«é»˜è®¤å€¼çš„æ¨¡å‹å±æ€§æ˜¯å¯é€‰çš„ï¼Œå¦åˆ™å°±æ˜¯å¿…é€‰çš„ã€‚é»˜è®¤å€¼ä¸º <code>None</code> çš„æ¨¡å‹å±æ€§ä¹Ÿæ˜¯å¯é€‰çš„ã€‚</p>
<p>ä¸Šè¿°æ¨¡å‹å£°æ˜å¦‚ä¸‹ JSON <strong>å¯¹è±¡</strong>ï¼ˆå³ Python <strong>å­—å…¸</strong>ï¼‰ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Foo&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;An optional description&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">45.2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tax&quot;</span><span class="punctuation">:</span> <span class="number">3.5</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ç”±äº <code>description</code> å’Œ <code>tax</code> æ˜¯å¯é€‰çš„ï¼ˆé»˜è®¤å€¼ä¸º <code>None</code>ï¼‰ï¼Œä¸‹é¢çš„ JSON <strong>å¯¹è±¡</strong>ä¹Ÿæœ‰æ•ˆï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Foo&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">45.2</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="å£°æ˜è¯·æ±‚ä½“å‚æ•°"><a href="#å£°æ˜è¯·æ±‚ä½“å‚æ•°" class="headerlink" title="å£°æ˜è¯·æ±‚ä½“å‚æ•°"></a>å£°æ˜è¯·æ±‚ä½“å‚æ•°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">item: Item</span>):</span><br><span class="line">    <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>

<p>æ­¤å¤„ï¼Œè¯·æ±‚ä½“å‚æ•°çš„ç±»å‹ä¸º <code>Item</code> æ¨¡å‹ã€‚</p>
<h4 id="è¯·æ±‚ä½“æ€»ç»“"><a href="#è¯·æ±‚ä½“æ€»ç»“" class="headerlink" title="è¯·æ±‚ä½“æ€»ç»“"></a>è¯·æ±‚ä½“æ€»ç»“</h4><p>ä»…ä½¿ç”¨ Python ç±»å‹å£°æ˜ï¼Œ<strong>FastAPI</strong> å°±å¯ä»¥ï¼š</p>
<ul>
<li>ä»¥ JSON å½¢å¼è¯»å–è¯·æ±‚ä½“</li>
<li>ï¼ˆåœ¨å¿…è¦æ—¶ï¼‰æŠŠè¯·æ±‚ä½“è½¬æ¢ä¸ºå¯¹åº”çš„ç±»å‹</li>
<li>æ ¡éªŒæ•°æ®ï¼š<ul>
<li>æ•°æ®æ— æ•ˆæ—¶è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå¹¶æŒ‡å‡ºé”™è¯¯æ•°æ®çš„ç¡®åˆ‡ä½ç½®å’Œå†…å®¹</li>
</ul>
</li>
<li>æŠŠæ¥æ”¶çš„æ•°æ®èµ‹å€¼ç»™å‚æ•° item<ul>
<li>æŠŠå‡½æ•°ä¸­è¯·æ±‚ä½“å‚æ•°çš„ç±»å‹å£°æ˜ä¸º <code>Item</code>ï¼Œè¿˜èƒ½è·å¾—ä»£ç è¡¥å…¨ç­‰ç¼–è¾‘å™¨æ”¯æŒ</li>
</ul>
</li>
</ul>
<h3 id="ä½¿ç”¨æ¨¡å‹"><a href="#ä½¿ç”¨æ¨¡å‹" class="headerlink" title="ä½¿ç”¨æ¨¡å‹"></a>ä½¿ç”¨æ¨¡å‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">item: Item</span>):</span><br><span class="line">    item_dict = item.model_dump()</span><br><span class="line">    <span class="keyword">if</span> item.tax <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        price_with_tax = item.price + item.tax</span><br><span class="line">        item_dict.update(&#123;<span class="string">&quot;price&quot;</span>: price_with_tax&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> item_dict</span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)  </span><br></pre></td></tr></table></figure>

<p><strong>å…¥å‚ï¼š</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ç®±å­&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä¸€ä¸ªå¤§ç®±å­&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tax&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>è¿”å›ï¼š</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ç®±å­&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä¸€ä¸ªå¤§ç®±å­&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tax&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="è¯·æ±‚ä½“-è·¯å¾„å‚æ•°"><a href="#è¯·æ±‚ä½“-è·¯å¾„å‚æ•°" class="headerlink" title="è¯·æ±‚ä½“ + è·¯å¾„å‚æ•°"></a>è¯·æ±‚ä½“ + è·¯å¾„å‚æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Item</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item_id&quot;</span>: item_id, **item.model_dump()&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å…¥å‚ï¼š</strong></p>
<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/imgimage-20250424192750614.png" alt="image-20250424192750614"></p>
<p><strong>è¿”å›ï¼š</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;item_id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ç®±å­&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä¸€ä¸ªå¤§ç®±å­&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tax&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="è¯·æ±‚ä½“-è·¯å¾„å‚æ•°-æŸ¥è¯¢å‚æ•°"><a href="#è¯·æ±‚ä½“-è·¯å¾„å‚æ•°-æŸ¥è¯¢å‚æ•°" class="headerlink" title="è¯·æ±‚ä½“ + è·¯å¾„å‚æ•° + æŸ¥è¯¢å‚æ•°"></a>è¯·æ±‚ä½“ + è·¯å¾„å‚æ•° + æŸ¥è¯¢å‚æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Item, q: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span>):</span><br><span class="line">    result = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, **item.<span class="built_in">dict</span>()&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        result.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p><strong>å…¥å‚ï¼š</strong></p>
<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/imgimage-20250425083759545.png" alt="å›¾"></p>
<p><strong>è¿”å›ï¼š</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;item_id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ç®±å­&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä¸€ä¸ªå¤§ç®±å­&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tax&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;q&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å˜å˜&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>å‡½æ•°å‚æ•°æŒ‰å¦‚ä¸‹è§„åˆ™è¿›è¡Œè¯†åˆ«ï¼š</p>
<p>è·¯å¾„ä¸­å£°æ˜äº†ç›¸åŒå‚æ•°çš„å‚æ•°ï¼Œæ˜¯è·¯å¾„å‚æ•°ã€‚<br>ç±»å‹æ˜¯ï¼ˆintã€floatã€strã€bool ç­‰ï¼‰å•ç±»å‹çš„å‚æ•°ï¼Œæ˜¯æŸ¥è¯¢å‚æ•°ã€‚<br>ç±»å‹æ˜¯ Pydantic æ¨¡å‹çš„å‚æ•°ï¼Œæ˜¯è¯·æ±‚ä½“ã€‚</p>
<h2 id="æŸ¥è¯¢å‚æ•°å’Œå­—ç¬¦ä¸²æ ¡éªŒ"><a href="#æŸ¥è¯¢å‚æ•°å’Œå­—ç¬¦ä¸²æ ¡éªŒ" class="headerlink" title="æŸ¥è¯¢å‚æ•°å’Œå­—ç¬¦ä¸²æ ¡éªŒ"></a>æŸ¥è¯¢å‚æ•°å’Œå­—ç¬¦ä¸²æ ¡éªŒ</h2><p>FastAPI å…è®¸æˆ‘ä»¬ä¸ºå‚æ•°å£°æ˜é¢å¤–çš„ä¿¡æ¯å’Œæ ¡éªŒã€‚<br>ä»¥ä¸‹é¢ç¨‹åºä¸ºä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Query</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">q: <span class="built_in">str</span> | <span class="literal">None</span> = Query(<span class="params">default=<span class="literal">None</span>, min_length=<span class="number">3</span>, max_length=<span class="number">50</span></span>)</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;items&quot;</span>: [&#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Foo&quot;</span>&#125;, &#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Bar&quot;</span>&#125;]&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢å‚æ•° <code>q</code> çš„ç±»å‹ä¸º <code>str</code>ï¼Œé»˜è®¤å€¼ä¸º <code>None</code>ï¼Œå› æ­¤å®ƒæ˜¯å¯é€‰çš„ã€‚</p>
<h3 id="Queryæ£€éªŒ"><a href="#Queryæ£€éªŒ" class="headerlink" title="Queryæ£€éªŒ"></a>Queryæ£€éªŒ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Query</span><br><span class="line"></span><br><span class="line">q: <span class="built_in">str</span> | <span class="literal">None</span> = Query(default=<span class="literal">None</span>, min_length=<span class="number">3</span>, max_length=<span class="number">50</span>)</span><br></pre></td></tr></table></figure>

<p>å°† <code>Query</code> ä½œä¸ºå‚æ•° <code>q</code> çš„é»˜è®¤å€¼ã€‚<br><code>Query</code> æ˜¾å¼åœ°å°† <code>q</code> å£°æ˜ä¸ºæŸ¥è¯¢å‚æ•°ï¼Œå¹¶è®¾ç½®æ ¡éªŒæ¡ä»¶ã€‚</p>
<p><strong>æ— æ•ˆå…¥å‚ï¼š</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/6b409321bb9d3b911fe34563aaa1cf28c7d4586d99343609fd7b333f34effe91.png" alt="å›¾ 0">  </p>
<p><strong>è¿”å›ï¼š</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string_too_short&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;loc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;query&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;q&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;String should have at least 3 characters&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;12&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;ctx&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;min_length&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>æ­£å¸¸å…¥å‚ï¼š</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/84db921e8dd631c91b3bc6d09a4e02570c3a2bc1588828c039961ce0247aaeaf.png" alt="å›¾ 2">  </p>
<p><strong>è¿”å›ï¼š</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;items&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;item_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Foo&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;item_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Bar&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;q&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="æ­£åˆ™æ ¡éªŒ"><a href="#æ­£åˆ™æ ¡éªŒ" class="headerlink" title="æ­£åˆ™æ ¡éªŒ"></a>æ­£åˆ™æ ¡éªŒ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Union</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Query</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params"></span></span><br><span class="line"><span class="params">        q: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = Query(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="params">            default=<span class="literal">None</span>, min_length=<span class="number">3</span>, max_length=<span class="number">50</span>, pattern=<span class="string">&quot;^fixedquery$&quot;</span></span></span></span><br><span class="line"><span class="params"><span class="params">        </span>),</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;items&quot;</span>: [&#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Foo&quot;</span>&#125;, &#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Bar&quot;</span>&#125;]&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>pattern</code> è®¾ç½®æ­£åˆ™è¡¨è¾¾å¼æ ¡éªŒå‚æ•°ã€‚</p>
<p>è¿™ä¸ªæŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼é€šè¿‡ä»¥ä¸‹è§„åˆ™æ£€æŸ¥æ¥æ”¶åˆ°çš„å‚æ•°å€¼ï¼š</p>
<ul>
<li>^ï¼šä»¥è¯¥ç¬¦å·ä¹‹åçš„å­—ç¬¦å¼€å¤´ï¼Œç¬¦å·ä¹‹å‰æ²¡æœ‰å­—ç¬¦ã€‚</li>
<li>fixedquery: å€¼ç²¾ç¡®åœ°ç­‰äº fixedqueryã€‚</li>
<li>$: åˆ°æ­¤ç»“æŸï¼Œåœ¨ fixedquery ä¹‹åæ²¡æœ‰æ›´å¤šå­—ç¬¦ã€‚</li>
</ul>
<p><strong>æ— æ•ˆå…¥å‚ï¼š</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/bf304297298417e3f3cb0195d8d4b890de95101db056c985cbb73b5564359236.png" alt="å›¾ 3">  </p>
<p><strong>è¿”å›ï¼š</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string_pattern_mismatch&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;loc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;query&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;q&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;String should match pattern &#x27;^fixedquery$&#x27;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;ctx&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;pattern&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^fixedquery$&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>æ­£å¸¸å…¥å‚ï¼š</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/bb969d8a4c39d0bab97135a1f058ea9fe12547a9926f8a4bf52ce718897b117b.png" alt="å›¾ 4"></p>
<p><strong>è¿”å›ï¼š</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;items&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;item_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Foo&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;item_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Bar&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;q&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fixedquery&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Query-é»˜è®¤å€¼"><a href="#Query-é»˜è®¤å€¼" class="headerlink" title="Query é»˜è®¤å€¼"></a>Query é»˜è®¤å€¼</h3><p>ä½ å¯ä»¥å‘ <code>Query</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ <code>None</code> ç”¨ä½œæŸ¥è¯¢å‚æ•°çš„é»˜è®¤å€¼ï¼Œä»¥åŒæ ·çš„æ–¹å¼ä½ ä¹Ÿå¯ä»¥ä¼ é€’å…¶ä»–é»˜è®¤å€¼ã€‚</p>
<p>å‡è®¾ä½ æƒ³è¦å£°æ˜æŸ¥è¯¢å‚æ•° <code>q</code>ï¼Œä½¿å…¶ <code>min_length</code> ä¸º 3ï¼Œå¹¶ä¸”é»˜è®¤å€¼ä¸º <code>fixedquery</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Query</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">q: <span class="built_in">str</span> = Query(<span class="params">default=<span class="string">&quot;fixedquery&quot;</span>, min_length=<span class="number">3</span></span>)</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;items&quot;</span>: [&#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Foo&quot;</span>&#125;, &#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Bar&quot;</span>&#125;]&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å…·æœ‰é»˜è®¤å€¼ä¼šä½¿è¯¥å‚æ•°æˆä¸ºå¯é€‰å‚æ•°ã€‚</p>
</blockquote>
<h3 id="å£°æ˜å¿…éœ€å‚æ•°"><a href="#å£°æ˜å¿…éœ€å‚æ•°" class="headerlink" title="å£°æ˜å¿…éœ€å‚æ•°"></a>å£°æ˜å¿…éœ€å‚æ•°</h3><p>å½“ä½ åœ¨ä½¿ç”¨ <code>Query</code> ä¸”éœ€è¦å£°æ˜ä¸€ä¸ªå€¼æ˜¯å¿…éœ€çš„æ—¶ï¼Œåªéœ€ä¸å£°æ˜é»˜è®¤å‚æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Query</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">q: <span class="built_in">str</span> = Query(<span class="params">min_length=<span class="number">3</span></span>)</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;items&quot;</span>: [&#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Foo&quot;</span>&#125;, &#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Bar&quot;</span>&#125;]&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨-None-å£°æ˜å¿…éœ€å‚æ•°"><a href="#ä½¿ç”¨-None-å£°æ˜å¿…éœ€å‚æ•°" class="headerlink" title="ä½¿ç”¨ None å£°æ˜å¿…éœ€å‚æ•°"></a>ä½¿ç”¨ None å£°æ˜å¿…éœ€å‚æ•°</h3><p>ä½ å¯ä»¥å£°æ˜ä¸€ä¸ªå‚æ•°å¯ä»¥æ¥æ”¶ <code>None</code> å€¼ï¼Œä½†å®ƒä»ç„¶æ˜¯å¿…éœ€çš„ã€‚è¿™å°†å¼ºåˆ¶å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªå€¼ï¼Œå³ä½¿è¯¥å€¼æ˜¯ <code>None</code>ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Query</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">q: <span class="built_in">str</span> | <span class="literal">None</span> = Query(<span class="params">min_length=<span class="number">3</span></span>)</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;items&quot;</span>: [&#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Foo&quot;</span>&#125;, &#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Bar&quot;</span>&#125;]&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p><strong>å…¥å‚ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8000/items/</span><br></pre></td></tr></table></figure>

<p><strong>è¿”å›ï¼š</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;missing&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;loc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;query&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;q&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Field required&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥è¯¢å‚æ•°åˆ—è¡¨"><a href="#æŸ¥è¯¢å‚æ•°åˆ—è¡¨" class="headerlink" title="æŸ¥è¯¢å‚æ•°åˆ—è¡¨"></a>æŸ¥è¯¢å‚æ•°åˆ—è¡¨</h3><p>å½“ä½ ä½¿ç”¨ <code>Query</code> æ˜¾å¼åœ°å®šä¹‰æŸ¥è¯¢å‚æ•°æ—¶ï¼Œä½ è¿˜å¯ä»¥å£°æ˜å®ƒå»æ¥æ”¶ä¸€ç»„å€¼ï¼Œæˆ–æ¢å¥è¯æ¥è¯´ï¼Œæ¥æ”¶å¤šä¸ªå€¼ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè¦å£°æ˜ä¸€ä¸ªå¯åœ¨ <code>URL</code> ä¸­å‡ºç°å¤šæ¬¡çš„æŸ¥è¯¢å‚æ•° <code>q</code>ï¼Œä½ å¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Query</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">query: <span class="type">List</span>[<span class="built_in">str</span>] | <span class="literal">None</span> = Query(<span class="params">default=<span class="literal">None</span></span>)</span>):</span><br><span class="line">    query_items = &#123;<span class="string">&quot;query&quot;</span>: query&#125;</span><br><span class="line">    <span class="keyword">return</span> query_items</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œè¾“å…¥å¦‚ä¸‹ç½‘å€ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8000/items/?query=123&amp;query=321</span><br></pre></td></tr></table></figure>

<p>ä½ ä¼šåœ¨è·¯å¾„æ“ä½œå‡½æ•°çš„å‡½æ•°å‚æ•° <code>q</code> ä¸­ä»¥ä¸€ä¸ª Python <code>list</code> çš„å½¢å¼æ¥æ”¶åˆ°æŸ¥è¯¢å‚æ•° <code>q</code> çš„å¤šä¸ªå€¼ã€‚</p>
<p>å› æ­¤ï¼Œè¯¥ URL çš„å“åº”å°†ä¼šæ˜¯ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;123&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;321&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¦å£°æ˜ç±»å‹ä¸º <code>list</code> çš„æŸ¥è¯¢å‚æ•°ï¼Œå¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œä½ éœ€è¦æ˜¾å¼åœ°ä½¿ç”¨ <code>Query</code>ï¼Œå¦åˆ™è¯¥å‚æ•°å°†è¢«è§£é‡Šä¸ºè¯·æ±‚ä½“ã€‚</p>
</blockquote>
<h4 id="å¸¦é»˜è®¤å€¼çš„æŸ¥è¯¢å‚æ•°åˆ—è¡¨"><a href="#å¸¦é»˜è®¤å€¼çš„æŸ¥è¯¢å‚æ•°åˆ—è¡¨" class="headerlink" title="å¸¦é»˜è®¤å€¼çš„æŸ¥è¯¢å‚æ•°åˆ—è¡¨"></a>å¸¦é»˜è®¤å€¼çš„æŸ¥è¯¢å‚æ•°åˆ—è¡¨</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Query</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">q: Annotated[<span class="built_in">list</span>[<span class="built_in">str</span>], Query(<span class="params"></span>)] = [<span class="string">&quot;123&quot;</span>, <span class="string">&quot;321&quot;</span>]</span>):</span><br><span class="line">    query_items = &#123;<span class="string">&quot;q&quot;</span>: q&#125;</span><br><span class="line">    <span class="keyword">return</span> query_items</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p>è¾“å…¥å‚æ•°åŒ…å«é»˜è®¤å€¼ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/e48cbd91a3f6fac8381f8416a41127feebba5d5d0a515f02a7cb8d13946e42eb.png" alt="å›¾ 5">  </p>
<h3 id="å£°æ˜æ›´å¤šå…ƒæ•°æ®"><a href="#å£°æ˜æ›´å¤šå…ƒæ•°æ®" class="headerlink" title="å£°æ˜æ›´å¤šå…ƒæ•°æ®"></a>å£°æ˜æ›´å¤šå…ƒæ•°æ®</h3><p>ä½ å¯ä»¥æ·»åŠ æ›´å¤šæœ‰å…³è¯¥å‚æ•°çš„ä¿¡æ¯ã€‚</p>
<p>è¿™äº›ä¿¡æ¯å°†åŒ…å«åœ¨ç”Ÿæˆçš„ OpenAPI æ¨¡å¼ä¸­ï¼Œå¹¶ç”±æ–‡æ¡£ç”¨æˆ·ç•Œé¢å’Œå¤–éƒ¨å·¥å…·æ‰€ä½¿ç”¨ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">from typing import Annotated</span><br><span class="line"></span><br><span class="line">import uvicorn</span><br><span class="line">from fastapi import FastAPI, Query</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.get(&quot;/items/&quot;)</span><br><span class="line">async def read_items(</span><br><span class="line">        q: Annotated[</span><br><span class="line">            str | None,</span><br><span class="line">            Query(</span><br><span class="line">                title=&quot;Query string&quot;,</span><br><span class="line">                description=&quot;Query string for the items to search in the database that have a good match&quot;,</span><br><span class="line">                min_length=3,</span><br><span class="line">            ),</span><br><span class="line">        ] = None,</span><br><span class="line">):</span><br><span class="line">    results = &#123;&quot;items&quot;: [&#123;&quot;item_id&quot;: &quot;Foo&quot;&#125;, &#123;&quot;item_id&quot;: &quot;Bar&quot;&#125;]&#125;</span><br><span class="line">    if q:</span><br><span class="line">        results.update(&#123;&quot;q&quot;: q&#125;)</span><br><span class="line">    return results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    uvicorn.run(app, host=&quot;0.0.0.0&quot;, port=8000)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/4066c25c4b56b570a0fc9a5dfb750a3f9e00eb9752cf3280bc9eb091cbf63366.png" alt="å›¾ 6">  </p>
<h3 id="åˆ«åå‚æ•°"><a href="#åˆ«åå‚æ•°" class="headerlink" title="åˆ«åå‚æ•°"></a>åˆ«åå‚æ•°</h3><p>å‡è®¾ä½ æƒ³è¦æŸ¥è¯¢å‚æ•°ä¸º item-queryã€‚</p>
<p>åƒä¸‹é¢è¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;http://127.0.0.1:8000/items/?item-query=foobaritems&gt;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ <code>item-query</code> ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ Python å˜é‡åç§°ã€‚</p>
<p>æœ€æ¥è¿‘çš„æœ‰æ•ˆåç§°æ˜¯ <code>item_query</code>ã€‚</p>
<p>ä½†æ˜¯ä½ ä»ç„¶è¦æ±‚å®ƒåœ¨ URL ä¸­å¿…é¡»æ˜¯ <code>item-query</code>ã€‚</p>
<p>è¿™æ—¶ä½ å¯ä»¥ç”¨ alias å‚æ•°å£°æ˜ä¸€ä¸ªåˆ«åï¼Œè¯¥åˆ«åå°†ç”¨äºåœ¨ URL ä¸­æŸ¥æ‰¾æŸ¥è¯¢å‚æ•°å€¼ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Query</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">q: Annotated[<span class="built_in">str</span> | <span class="literal">None</span>, Query(<span class="params">alias=<span class="string">&quot;item-query&quot;</span></span>)] = <span class="literal">None</span></span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;items&quot;</span>: [&#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Foo&quot;</span>&#125;, &#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Bar&quot;</span>&#125;]&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>

<h3 id="å¼ƒç”¨å‚æ•°"><a href="#å¼ƒç”¨å‚æ•°" class="headerlink" title="å¼ƒç”¨å‚æ•°"></a>å¼ƒç”¨å‚æ•°</h3><p>ç°åœ¨å‡è®¾ä½ ä¸å†å–œæ¬¢æ­¤å‚æ•°ã€‚</p>
<p>ä½ ä¸å¾—ä¸å°†å…¶ä¿ç•™ä¸€æ®µæ—¶é—´ï¼Œå› ä¸ºæœ‰äº›å®¢æˆ·ç«¯æ­£åœ¨ä½¿ç”¨å®ƒï¼Œä½†ä½ å¸Œæœ›æ–‡æ¡£æ¸…æ¥šåœ°å°†å…¶å±•ç¤ºä¸ºå·²å¼ƒç”¨ã€‚</p>
<p>é‚£ä¹ˆå°†å‚æ•° <code>deprecated=True</code> ä¼ å…¥ <code>Query</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Query</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params"></span></span><br><span class="line"><span class="params">        q: Annotated[</span></span><br><span class="line"><span class="params">            <span class="built_in">str</span> | <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">            Query(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="params">                alias=<span class="string">&quot;item-query&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">                title=<span class="string">&quot;Query string&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">                description=<span class="string">&quot;Query string for the items to search in the database that have a good match&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">                min_length=<span class="number">3</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">                max_length=<span class="number">50</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">                pattern=<span class="string">&quot;^fixedquery$&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">                deprecated=<span class="literal">True</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">            </span>),</span></span><br><span class="line"><span class="params">        ] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;items&quot;</span>: [&#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Foo&quot;</span>&#125;, &#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Bar&quot;</span>&#125;]&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p>æ–‡æ¡£å°†ä¼šåƒä¸‹é¢è¿™æ ·å±•ç¤ºå®ƒï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/8c223d341a606a97f226e4cefebed6419f2920963d8b0ceee018dafae871db9c.png" alt="å›¾ 7">  </p>
<h3 id="æŸ¥è¯¢å‚æ•°å’Œå­—ç¬¦ä¸²æ ¡éªŒæ€»ç»“"><a href="#æŸ¥è¯¢å‚æ•°å’Œå­—ç¬¦ä¸²æ ¡éªŒæ€»ç»“" class="headerlink" title="æŸ¥è¯¢å‚æ•°å’Œå­—ç¬¦ä¸²æ ¡éªŒæ€»ç»“"></a>æŸ¥è¯¢å‚æ•°å’Œå­—ç¬¦ä¸²æ ¡éªŒæ€»ç»“</h3><p>ä½ å¯ä»¥ä¸ºæŸ¥è¯¢å‚æ•°å£°æ˜é¢å¤–çš„æ ¡éªŒå’Œå…ƒæ•°æ®ã€‚</p>
<p>é€šç”¨çš„æ ¡éªŒå’Œå…ƒæ•°æ®ï¼š</p>
<ul>
<li>alias</li>
<li>title</li>
<li>description</li>
<li>deprecated</li>
</ul>
<p>ç‰¹å®šäºå­—ç¬¦ä¸²çš„æ ¡éªŒï¼š</p>
<ul>
<li>min_length</li>
<li>max_length</li>
<li>regex</li>
</ul>
<h2 id="è·¯å¾„å‚æ•°å’Œæ•°å€¼æ ¡éªŒ"><a href="#è·¯å¾„å‚æ•°å’Œæ•°å€¼æ ¡éªŒ" class="headerlink" title="è·¯å¾„å‚æ•°å’Œæ•°å€¼æ ¡éªŒ"></a>è·¯å¾„å‚æ•°å’Œæ•°å€¼æ ¡éªŒ</h2><p>ä¸ä½¿ç”¨ <code>Query</code> ä¸ºæŸ¥è¯¢å‚æ•°å£°æ˜æ›´å¤šçš„æ ¡éªŒå’Œå…ƒæ•°æ®çš„æ–¹å¼ç›¸åŒï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>Path</code> ä¸ºè·¯å¾„å‚æ•°å£°æ˜ç›¸åŒç±»å‹çš„æ ¡éªŒå’Œå…ƒæ•°æ®ã€‚</p>
<h3 id="å¯¼å…¥-Path"><a href="#å¯¼å…¥-Path" class="headerlink" title="å¯¼å…¥ Path"></a>å¯¼å…¥ Path</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated, <span class="type">Union</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Path, Query</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params"></span></span><br><span class="line"><span class="params">    item_id: Annotated[<span class="built_in">int</span>, Path(<span class="params">title=<span class="string">&quot;The ID of the item to get&quot;</span></span>)],</span></span><br><span class="line"><span class="params">    q: Annotated[<span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>], Query(<span class="params">alias=<span class="string">&quot;item-query&quot;</span></span>)] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>

<h3 id="æŒ‰éœ€å¯¹å‚æ•°æ’åº"><a href="#æŒ‰éœ€å¯¹å‚æ•°æ’åº" class="headerlink" title="æŒ‰éœ€å¯¹å‚æ•°æ’åº"></a>æŒ‰éœ€å¯¹å‚æ•°æ’åº</h3><p>åœ¨ Python ä¸­ï¼Œå°†<code>å¸¦æœ‰é»˜è®¤å€¼çš„å‚æ•°</code>æ”¾åœ¨<code>ä¸å¸¦æœ‰é»˜è®¤å€¼çš„å‚æ•°ä¹‹å‰</code> Python ä¼šæŠ¥é”™ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/ce96c6a11c9f17bee244276c353aecabed8d1576f3050df8bfe688386948f777.png" alt="å›¾ 0">  </p>
<p>åœ¨ FastAPI ä¸­è¿™æ— å…³ç´§è¦ã€‚å®ƒå°†é€šè¿‡å‚æ•°çš„åç§°ã€ç±»å‹å’Œé»˜è®¤å€¼å£°æ˜ï¼ˆQueryã€Path ç­‰ï¼‰æ¥æ£€æµ‹å‚æ•°ï¼Œè€Œä¸åœ¨ä¹å‚æ•°çš„é¡ºåºã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Path</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params"></span></span><br><span class="line"><span class="params">    q: <span class="built_in">str</span>, item_id: Annotated[<span class="built_in">int</span>, Path(<span class="params">title=<span class="string">&quot;The ID of the item to get&quot;</span></span>)]</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ æƒ³ä½¿ç”¨ <code>Path</code> å£°æ˜è·¯å¾„å‚æ•° <code>item_id</code>ï¼Œå¹¶ä½¿å®ƒä»¬çš„é¡ºåºä¸ä¸Šé¢ä¸åŒï¼ŒPython å¯¹æ­¤æœ‰ä¸€äº›ç‰¹æ®Šçš„è¯­æ³•ã€‚</p>
<p>ä¼ é€’ * ä½œä¸ºå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚</p>
<p>Python ä¸ä¼šå¯¹è¯¥ * åšä»»ä½•äº‹æƒ…ï¼Œä½†æ˜¯å®ƒå°†çŸ¥é“ä¹‹åçš„æ‰€æœ‰å‚æ•°éƒ½åº”ä½œä¸ºå…³é”®å­—å‚æ•°ï¼ˆé”®å€¼å¯¹ï¼‰ï¼Œä¹Ÿè¢«ç§°ä¸º kwargsï¼Œæ¥è°ƒç”¨ã€‚å³ä½¿å®ƒä»¬æ²¡æœ‰é»˜è®¤å€¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Path</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">red_items</span>(<span class="params">*, item_id: Annotated[<span class="built_in">int</span>, Path(<span class="params">title=<span class="string">&quot;The ID of the item to get&quot;</span></span>)] = <span class="literal">None</span>, q: <span class="built_in">str</span></span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<h3 id="æ•°å€¼æ ¡éªŒï¼šå¤§äºç­‰äº"><a href="#æ•°å€¼æ ¡éªŒï¼šå¤§äºç­‰äº" class="headerlink" title="æ•°å€¼æ ¡éªŒï¼šå¤§äºç­‰äº"></a>æ•°å€¼æ ¡éªŒï¼šå¤§äºç­‰äº</h3><p>ä½¿ç”¨ <code>Query</code> å’Œ <code>Path</code> å¯ä»¥å£°æ˜å­—ç¬¦ä¸²çº¦æŸï¼Œä½†ä¹Ÿå¯ä»¥å£°æ˜æ•°å€¼çº¦æŸã€‚</p>
<p>åƒä¸‹é¢è¿™æ ·ï¼Œæ·»åŠ  <code>ge=1</code> åï¼Œ<code>item_id</code> å°†å¿…é¡»æ˜¯ä¸€ä¸ªå¤§äºï¼ˆgreater thanï¼‰æˆ–ç­‰äºï¼ˆequalï¼‰1 çš„æ•´æ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Path</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params"></span></span><br><span class="line"><span class="params">    item_id: Annotated[<span class="built_in">int</span>, Path(<span class="params">title=<span class="string">&quot;The ID of the item to get&quot;</span>, ge=<span class="number">1</span></span>)], q: <span class="built_in">str</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>

<h3 id="æ•°å€¼æ ¡éªŒï¼šå¤§äºå’Œå°äºç­‰äº"><a href="#æ•°å€¼æ ¡éªŒï¼šå¤§äºå’Œå°äºç­‰äº" class="headerlink" title="æ•°å€¼æ ¡éªŒï¼šå¤§äºå’Œå°äºç­‰äº"></a>æ•°å€¼æ ¡éªŒï¼šå¤§äºå’Œå°äºç­‰äº</h3><p>åŒæ ·çš„è§„åˆ™é€‚ç”¨äºï¼š</p>
<ul>
<li>gtï¼šå¤§äºï¼ˆgreater thanï¼‰</li>
<li>leï¼šå°äºç­‰äºï¼ˆless than or equalï¼‰</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Path</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params"></span></span><br><span class="line"><span class="params">    item_id: Annotated[<span class="built_in">int</span>, Path(<span class="params">title=<span class="string">&quot;The ID of the item to get&quot;</span>, gt=<span class="number">0</span>, le=<span class="number">1000</span></span>)],</span></span><br><span class="line"><span class="params">    q: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>

<h3 id="æ•°å€¼æ ¡éªŒï¼šæµ®ç‚¹æ•°ã€å¤§äºå’Œå°äº"><a href="#æ•°å€¼æ ¡éªŒï¼šæµ®ç‚¹æ•°ã€å¤§äºå’Œå°äº" class="headerlink" title="æ•°å€¼æ ¡éªŒï¼šæµ®ç‚¹æ•°ã€å¤§äºå’Œå°äº"></a>æ•°å€¼æ ¡éªŒï¼šæµ®ç‚¹æ•°ã€å¤§äºå’Œå°äº</h3><p>æ•°å€¼æ ¡éªŒåŒæ ·é€‚ç”¨äº <code>float</code> å€¼ã€‚</p>
<p>èƒ½å¤Ÿå£°æ˜ <code>gt</code> è€Œä¸ä»…ä»…æ˜¯ <code>ge</code> åœ¨è¿™ä¸ªå‰æä¸‹å˜å¾—é‡è¦èµ·æ¥ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥è¦æ±‚ä¸€ä¸ªå€¼å¿…é¡»å¤§äº 0ï¼Œå³ä½¿å®ƒå°äº 1ã€‚</p>
<p>å› æ­¤ï¼Œ0.5 å°†æ˜¯æœ‰æ•ˆå€¼ã€‚ä½†æ˜¯ 0.0 æˆ– 0 ä¸æ˜¯ã€‚</p>
<p>å¯¹äº <code>lt</code> ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Path, Query</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params"></span></span><br><span class="line"><span class="params">    *,</span></span><br><span class="line"><span class="params">    item_id: Annotated[<span class="built_in">int</span>, Path(<span class="params">title=<span class="string">&quot;The ID of the item to get&quot;</span>, ge=<span class="number">0</span>, le=<span class="number">1000</span></span>)],</span></span><br><span class="line"><span class="params">    q: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    size: Annotated[<span class="built_in">float</span>, Query(<span class="params">gt=<span class="number">0</span>, lt=<span class="number">10.5</span></span>)],</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">if</span> size:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;size&quot;</span>: size&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>

<h3 id="æ•°å€¼æ ¡éªŒæ€»ç»“"><a href="#æ•°å€¼æ ¡éªŒæ€»ç»“" class="headerlink" title="æ•°å€¼æ ¡éªŒæ€»ç»“"></a>æ•°å€¼æ ¡éªŒæ€»ç»“</h3><p>ä½ èƒ½å¤Ÿä»¥ä¸ æŸ¥è¯¢å‚æ•°å’Œå­—ç¬¦ä¸²æ ¡éªŒ ç›¸åŒçš„æ–¹å¼ä½¿ç”¨ <code>Query</code>ã€<code>Path</code> å£°æ˜å…ƒæ•°æ®å’Œå­—ç¬¦ä¸²æ ¡éªŒã€‚</p>
<p>è€Œä¸”ä½ è¿˜å¯ä»¥å£°æ˜æ•°å€¼æ ¡éªŒï¼š</p>
<ul>
<li>gtï¼šå¤§äºï¼ˆgreater thanï¼‰</li>
<li>geï¼šå¤§äºç­‰äºï¼ˆgreater than or equalï¼‰</li>
<li>ltï¼šå°äºï¼ˆless thanï¼‰</li>
<li>leï¼šå°äºç­‰äºï¼ˆless than or equalï¼‰</li>
</ul>
<h2 id="æŸ¥è¯¢å‚æ•°æ¨¡å‹"><a href="#æŸ¥è¯¢å‚æ•°æ¨¡å‹" class="headerlink" title="æŸ¥è¯¢å‚æ•°æ¨¡å‹"></a>æŸ¥è¯¢å‚æ•°æ¨¡å‹</h2><p>å¦‚æœä½ æœ‰ä¸€ç»„å…·æœ‰ç›¸å…³æ€§çš„æŸ¥è¯¢å‚æ•°ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª Pydantic æ¨¡å‹æ¥å£°æ˜å®ƒä»¬ã€‚</p>
<p>è¿™å°†å…è®¸ä½ åœ¨å¤šä¸ªåœ°æ–¹å»å¤ç”¨æ¨¡å‹ï¼Œå¹¶ä¸”ä¸€æ¬¡æ€§ä¸ºæ‰€æœ‰å‚æ•°å£°æ˜éªŒè¯å’Œå…ƒæ•°æ®ã€‚</p>
<h3 id="ä½¿ç”¨-Pydantic-æ¨¡å‹çš„æŸ¥è¯¢å‚æ•°"><a href="#ä½¿ç”¨-Pydantic-æ¨¡å‹çš„æŸ¥è¯¢å‚æ•°" class="headerlink" title="ä½¿ç”¨ Pydantic æ¨¡å‹çš„æŸ¥è¯¢å‚æ•°"></a>ä½¿ç”¨ Pydantic æ¨¡å‹çš„æŸ¥è¯¢å‚æ•°</h3><p>åœ¨ä¸€ä¸ª <code>Pydantic</code> æ¨¡å‹ä¸­å£°æ˜ä½ éœ€è¦çš„æŸ¥è¯¢å‚æ•°ï¼Œç„¶åå°†å‚æ•°å£°æ˜ä¸º <code>Query</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> idlelib.query <span class="keyword">import</span> Query</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">åœ¨ Python ä¸­ï¼ŒLiteral æ˜¯ typing æ¨¡å—æä¾›çš„ä¸€ä¸ªç‰¹æ®Šç±»å‹æ³¨è§£ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªå˜é‡æˆ–å‚æ•°åªèƒ½æ˜¯ç‰¹å®šçš„å­—é¢é‡å€¼ï¼ˆå³å…·ä½“çš„å€¼ï¼Œè€Œä¸æ˜¯ç±»å‹ï¼‰ã€‚</span></span><br><span class="line"><span class="string">å®ƒé€šå¸¸ç”¨äºç±»å‹æ£€æŸ¥å·¥å…·ï¼ˆå¦‚ mypyï¼‰æ¥å¢å¼ºä»£ç çš„ç±»å‹å®‰å…¨æ€§ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Literal çš„ä½œç”¨â€Œ</span></span><br><span class="line"><span class="string">1.â€Œé™åˆ¶å˜é‡æˆ–å‚æ•°çš„å–å€¼èŒƒå›´â€Œï¼š</span></span><br><span class="line"><span class="string">    ä½¿ç”¨ Literal å¯ä»¥æ˜ç¡®æŒ‡å®šæŸä¸ªå˜é‡æˆ–å‚æ•°åªèƒ½æ˜¯æŸäº›ç‰¹å®šçš„å€¼ï¼Œè€Œä¸æ˜¯ä»»æ„å€¼ã€‚</span></span><br><span class="line"><span class="string">    ä¾‹å¦‚ï¼Œä¸€ä¸ªå‡½æ•°å‚æ•°åªèƒ½æ˜¯ &quot;red&quot;ã€&quot;green&quot; æˆ– &quot;blue&quot;ï¼Œè€Œä¸èƒ½æ˜¯å…¶ä»–å­—ç¬¦ä¸²ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2.â€Œæé«˜ä»£ç å¯è¯»æ€§å’Œç±»å‹å®‰å…¨æ€§â€Œï¼š</span></span><br><span class="line"><span class="string">    é€šè¿‡ Literalï¼Œå¼€å‘è€…å¯ä»¥æ›´æ¸…æ™°åœ°è¡¨è¾¾æ„å›¾ï¼Œç±»å‹æ£€æŸ¥å™¨ä¹Ÿèƒ½åœ¨ç¼–è¯‘æ—¶æˆ–é™æ€åˆ†ææ—¶å‘ç°æ½œåœ¨çš„é”™è¯¯ã€‚</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Literal</span>, Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FilterParams</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    limit: <span class="built_in">int</span> = Field(<span class="number">100</span>, gt=<span class="number">0</span>, le=<span class="number">100</span>)</span><br><span class="line">    offset: <span class="built_in">int</span> = Field(<span class="number">0</span>, ge=<span class="number">0</span>)</span><br><span class="line">    order_by: <span class="type">Literal</span>[<span class="string">&quot;created_at&quot;</span>, <span class="string">&quot;updated_at&quot;</span>] = <span class="string">&quot;created_at&quot;</span></span><br><span class="line">    targs: <span class="built_in">list</span>[<span class="built_in">str</span>] = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">filter_query: Annotated[FilterParams, Query]</span>):</span><br><span class="line">    <span class="keyword">return</span> filter_query</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p><strong>FastAPI</strong> å°†ä¼šä»è¯·æ±‚çš„<strong>æŸ¥è¯¢å‚æ•°</strong>ä¸­æå–å‡º<strong>æ¯ä¸ªå­—æ®µ</strong>çš„æ•°æ®ï¼Œå¹¶å°†å…¶æä¾›ç»™ä½ å®šä¹‰çš„ Pydantic æ¨¡å‹ã€‚</p>
<p>åœ¨ doc æ–‡æ¡£ä¸­ï¼ŒSchema åˆ—å¯ä»¥æŸ¥çœ‹å‚æ•°çº¦æŸï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/689a3f0c9dc747ff2437411c42119479424785017f016938fe666d8bf7637426.png" alt="å›¾ 8">  </p>
<h3 id="ç¦æ­¢é¢å¤–çš„æŸ¥è¯¢å‚æ•°"><a href="#ç¦æ­¢é¢å¤–çš„æŸ¥è¯¢å‚æ•°" class="headerlink" title="ç¦æ­¢é¢å¤–çš„æŸ¥è¯¢å‚æ•°"></a>ç¦æ­¢é¢å¤–çš„æŸ¥è¯¢å‚æ•°</h3><p>åœ¨ä¸€äº›ç‰¹æ®Šçš„ä½¿ç”¨åœºæ™¯ä¸­ï¼Œä½ å¯èƒ½å¸Œæœ›é™åˆ¶ä½ è¦æ¥æ”¶çš„æŸ¥è¯¢å‚æ•°ã€‚</p>
<p>ä½ å¯ä»¥ä½¿ç”¨ Pydantic çš„æ¨¡å‹é…ç½®æ¥ <code>forbid</code>ï¼ˆæ„ä¸ºç¦æ­¢ï¼‰ä»»ä½• <code>extra</code>ï¼ˆæ„ä¸ºé¢å¤–çš„ï¼‰å­—æ®µï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated, <span class="type">Literal</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Query</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FilterParams</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    model_config = &#123;<span class="string">&quot;extra&quot;</span>: <span class="string">&quot;forbid&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    limit: <span class="built_in">int</span> = Field(<span class="number">100</span>, gt=<span class="number">0</span>, le=<span class="number">100</span>)</span><br><span class="line">    offset: <span class="built_in">int</span> = Field(<span class="number">0</span>, ge=<span class="number">0</span>)</span><br><span class="line">    order_by: <span class="type">Literal</span>[<span class="string">&quot;created_at&quot;</span>, <span class="string">&quot;updated_at&quot;</span>] = <span class="string">&quot;created_at&quot;</span></span><br><span class="line">    tags: <span class="built_in">list</span>[<span class="built_in">str</span>] = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">filter_query: Annotated[FilterParams, Query(<span class="params"></span>)]</span>):</span><br><span class="line">    <span class="keyword">return</span> filter_query</span><br></pre></td></tr></table></figure>

<p>å‡è®¾æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å°è¯•åœ¨æŸ¥è¯¢å‚æ•°ä¸­å‘é€ä¸€äº›é¢å¤–çš„æ•°æ®ï¼Œå®ƒå°†ä¼šæ”¶åˆ°ä¸€ä¸ªé”™è¯¯å“åº”ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœå®¢æˆ·ç«¯å°è¯•å‘é€ä¸€ä¸ªå€¼ä¸º plumbus çš„ tool æŸ¥è¯¢å‚æ•°ï¼Œå¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;https://example.com/items/?limit=10&amp;tool=plumbus&gt;</span><br></pre></td></tr></table></figure>

<p>ä»–ä»¬å°†æ”¶åˆ°ä¸€ä¸ªé”™è¯¯å“åº”ï¼Œå‘Šè¯‰ä»–ä»¬æŸ¥è¯¢å‚æ•° tool æ˜¯ä¸å…è®¸çš„ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;extra_forbidden&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;loc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;query&quot;</span><span class="punctuation">,</span> <span class="string">&quot;tool&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Extra inputs are not permitted&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;plumbus&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="è¯·æ±‚ä½“-å¤šä¸ªå‚æ•°"><a href="#è¯·æ±‚ä½“-å¤šä¸ªå‚æ•°" class="headerlink" title="è¯·æ±‚ä½“-å¤šä¸ªå‚æ•°"></a>è¯·æ±‚ä½“-å¤šä¸ªå‚æ•°</h2><h3 id="æ··åˆä½¿ç”¨-Pathã€Query-å’Œè¯·æ±‚ä½“å‚æ•°"><a href="#æ··åˆä½¿ç”¨-Pathã€Query-å’Œè¯·æ±‚ä½“å‚æ•°" class="headerlink" title="æ··åˆä½¿ç”¨ Pathã€Query å’Œè¯·æ±‚ä½“å‚æ•°"></a>æ··åˆä½¿ç”¨ Pathã€Query å’Œè¯·æ±‚ä½“å‚æ•°</h3><p>é¦–å…ˆï¼Œæ¯«æ— ç–‘é—®åœ°ï¼Œä½ å¯ä»¥éšæ„åœ°æ··åˆä½¿ç”¨ <code>Path</code>ã€<code>Query</code> å’Œè¯·æ±‚ä½“å‚æ•°å£°æ˜ï¼ŒFastAPI ä¼šçŸ¥é“è¯¥å¦‚ä½•å¤„ç†ã€‚</p>
<p>ä½ è¿˜å¯ä»¥é€šè¿‡å°†é»˜è®¤å€¼è®¾ç½®ä¸º <code>None</code> æ¥å°†è¯·æ±‚ä½“å‚æ•°å£°æ˜ä¸ºå¯é€‰å‚æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Path</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    <span class="built_in">print</span>: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params"></span></span><br><span class="line"><span class="params">        item_id: Annotated[<span class="built_in">int</span>, Path(<span class="params">title=<span class="string">&quot;item_id&quot;</span>, ge=<span class="number">0</span>, le=<span class="number">1000</span></span>)],</span></span><br><span class="line"><span class="params">        q: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        item: Item | <span class="literal">None</span> = <span class="literal">None</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">if</span> item:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;item&quot;</span>: item&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¯·æ³¨æ„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†ä»è¯·æ±‚ä½“è·å–çš„ item æ˜¯å¯é€‰çš„ã€‚å› ä¸ºå®ƒçš„é»˜è®¤å€¼ä¸º Noneã€‚</p>
</blockquote>
<h3 id="å¤šä¸ªè¯·æ±‚ä½“å‚æ•°"><a href="#å¤šä¸ªè¯·æ±‚ä½“å‚æ•°" class="headerlink" title="å¤šä¸ªè¯·æ±‚ä½“å‚æ•°"></a>å¤šä¸ªè¯·æ±‚ä½“å‚æ•°</h3><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œè·¯å¾„æ“ä½œå°†æœŸæœ›ä¸€ä¸ªå…·æœ‰ <code>Item</code> çš„å±æ€§çš„ JSON è¯·æ±‚ä½“ï¼Œå°±åƒï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Foo&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The pretender&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">42.0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tax&quot;</span><span class="punctuation">:</span> <span class="number">3.2</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ä½ ä¹Ÿå¯ä»¥å£°æ˜å¤šä¸ªè¯·æ±‚ä½“å‚æ•°ï¼Œä¾‹å¦‚ <code>item</code> å’Œ <code>user</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    <span class="built_in">print</span>: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    full_name: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Item, user: User</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;item&quot;</span>: item, <span class="string">&quot;user&quot;</span>: user&#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒFastAPI å°†æ³¨æ„åˆ°è¯¥å‡½æ•°ä¸­æœ‰å¤šä¸ªè¯·æ±‚ä½“å‚æ•°ï¼ˆä¸¤ä¸ª Pydantic æ¨¡å‹å‚æ•°ï¼‰ã€‚</p>
<p>å› æ­¤ï¼Œå®ƒå°†ä½¿ç”¨å‚æ•°åç§°ä½œä¸ºè¯·æ±‚ä½“ä¸­çš„é”®ï¼ˆå­—æ®µåç§°ï¼‰ï¼Œå¹¶æœŸæœ›ä¸€ä¸ªç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„è¯·æ±‚ä½“ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;item&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Foo&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The pretender&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">42.0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tax&quot;</span><span class="punctuation">:</span> <span class="number">3.2</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dave&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;full_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Dave Grohl&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>FastAPI å°†è‡ªåŠ¨å¯¹è¯·æ±‚ä¸­çš„æ•°æ®è¿›è¡Œè½¬æ¢ï¼Œå› æ­¤ <code>item</code> å‚æ•°å°†æ¥æ”¶æŒ‡å®šçš„å†…å®¹ï¼Œ<code>ÃŸuser</code> å‚æ•°ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå®ƒå°†æ‰§è¡Œå¯¹å¤åˆæ•°æ®çš„æ ¡éªŒã€‚</p>
<h3 id="è¯·æ±‚ä½“å½“ä¸­çš„å•ä¸€å€¼"><a href="#è¯·æ±‚ä½“å½“ä¸­çš„å•ä¸€å€¼" class="headerlink" title="è¯·æ±‚ä½“å½“ä¸­çš„å•ä¸€å€¼"></a>è¯·æ±‚ä½“å½“ä¸­çš„å•ä¸€å€¼</h3><p>ä¸ä½¿ç”¨ <code>Query</code> å’Œ <code>Path</code> ä¸ºæŸ¥è¯¢å‚æ•°å’Œè·¯å¾„å‚æ•°å®šä¹‰é¢å¤–æ•°æ®çš„æ–¹å¼ç›¸åŒï¼ŒFastAPI æä¾›äº†ä¸€ä¸ªåŒç­‰çš„ <code>Body</code>ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸ºäº†æ‰©å±•å…ˆå‰çš„æ¨¡å‹ï¼Œä½ å¯èƒ½å†³å®šé™¤äº† <code>item</code> å’Œ <code>user</code> ä¹‹å¤–ï¼Œè¿˜æƒ³åœ¨åŒä¸€è¯·æ±‚ä½“ä¸­å…·æœ‰å¦ä¸€ä¸ªé”® <code>importance</code>ã€‚</p>
<p>å¦‚æœä½ å°±æŒ‰åŸæ ·å£°æ˜å®ƒï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå•ä¸€å€¼ï¼ŒFastAPI å°†å‡å®šå®ƒæ˜¯ä¸€ä¸ªæŸ¥è¯¢å‚æ•°ã€‚</p>
<p>ä½†æ˜¯ä½ å¯ä»¥ä½¿ç”¨ <code>Body</code> æŒ‡ç¤º FastAPI å°†å…¶ä½œä¸ºè¯·æ±‚ä½“çš„å¦ä¸€ä¸ªé”®è¿›è¡Œå¤„ç†ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Body, FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    full_name: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Item, user: User, importance: Annotated[<span class="built_in">int</span>, Body(<span class="params"></span>)]</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>(item_id=item_id, item=item, user=user, importance=importance)</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒFastAPI å°†æœŸæœ›åƒè¿™æ ·çš„è¯·æ±‚ä½“ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;item&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Foo&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The pretender&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">42.0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tax&quot;</span><span class="punctuation">:</span> <span class="number">3.2</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dave&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;full_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Dave Grohl&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;importance&quot;</span><span class="punctuation">:</span> <span class="number">5</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/1ec566a9928874b3132dd1f66b3128bcc1bc3857e3fef900c39ee463aac5fa49.png" alt="å›¾ 9">  </p>
<h3 id="å¤šä¸ªè¯·æ±‚ä½“å‚æ•°å’ŒæŸ¥è¯¢å‚æ•°"><a href="#å¤šä¸ªè¯·æ±‚ä½“å‚æ•°å’ŒæŸ¥è¯¢å‚æ•°" class="headerlink" title="å¤šä¸ªè¯·æ±‚ä½“å‚æ•°å’ŒæŸ¥è¯¢å‚æ•°"></a>å¤šä¸ªè¯·æ±‚ä½“å‚æ•°å’ŒæŸ¥è¯¢å‚æ•°</h3><p>å½“ç„¶ï¼Œé™¤äº†è¯·æ±‚ä½“å‚æ•°å¤–ï¼Œä½ è¿˜å¯ä»¥åœ¨ä»»ä½•éœ€è¦çš„æ—¶å€™å£°æ˜é¢å¤–çš„æŸ¥è¯¢å‚æ•°ã€‚</p>
<p>ç”±äºé»˜è®¤æƒ…å†µä¸‹å•ä¸€å€¼è¢«è§£é‡Šä¸ºæŸ¥è¯¢å‚æ•°ï¼Œå› æ­¤ä½ ä¸å¿…æ˜¾å¼åœ°æ·»åŠ  <code>Query</code>ï¼Œä½ å¯ä»¥ä»…æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">q: <span class="built_in">str</span> = <span class="literal">None</span></span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Body, FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    full_name: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params"></span></span><br><span class="line"><span class="params">    *,</span></span><br><span class="line"><span class="params">    item_id: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">    item: Item,</span></span><br><span class="line"><span class="params">    user: User,</span></span><br><span class="line"><span class="params">    importance: Annotated[<span class="built_in">int</span>, Body(<span class="params">gt=<span class="number">0</span></span>)],</span></span><br><span class="line"><span class="params">    q: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;item&quot;</span>: item, <span class="string">&quot;user&quot;</span>: user, <span class="string">&quot;importance&quot;</span>: importance&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/2a05bf84472658c8a2d5c154346587a0d331d78d36680570534f9f0dc5e2bf95.png" alt="å›¾ 10">  </p>
<blockquote>
<p><code>Body</code> åŒæ ·å…·æœ‰ä¸ <code>Query</code>ã€<code>Path</code> å®Œå…¨ç›¸åŒçš„é¢å¤–æ ¡éªŒå’Œå…ƒæ•°æ®å‚æ•°ã€‚</p>
</blockquote>
<h3 id="åµŒå…¥å•ä¸ªè¯·æ±‚ä½“å‚æ•°"><a href="#åµŒå…¥å•ä¸ªè¯·æ±‚ä½“å‚æ•°" class="headerlink" title="åµŒå…¥å•ä¸ªè¯·æ±‚ä½“å‚æ•°"></a>åµŒå…¥å•ä¸ªè¯·æ±‚ä½“å‚æ•°</h3><p>å‡è®¾ä½ åªæœ‰ä¸€ä¸ªæ¥è‡ª Pydantic æ¨¡å‹ <code>Item</code> çš„è¯·æ±‚ä½“å‚æ•° <code>item</code>ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒFastAPI å°†ç›´æ¥æœŸæœ›è¿™æ ·çš„è¯·æ±‚ä½“ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœä½ å¸Œæœ›å®ƒæœŸæœ›ä¸€ä¸ªæ‹¥æœ‰ <code>item</code> é”®å¹¶åœ¨å€¼ä¸­åŒ…å«æ¨¡å‹å†…å®¹çš„ JSONï¼Œå°±åƒåœ¨å£°æ˜é¢å¤–çš„è¯·æ±‚ä½“å‚æ•°æ—¶æ‰€åšçš„é‚£æ ·ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„ <code>Body</code> å‚æ•° <code>embed</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">item: Item = Body(embed=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Body, FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Annotated[Item, Body(<span class="params">embed=<span class="literal">True</span></span>)]</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;item&quot;</span>: item&#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒFastAPI å°†æœŸæœ›åƒè¿™æ ·çš„è¯·æ±‚ä½“ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;item&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Foo&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The pretender&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">42.0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tax&quot;</span><span class="punctuation">:</span> <span class="number">3.2</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>è€Œä¸æ˜¯ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Foo&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The pretender&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">42.0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tax&quot;</span><span class="punctuation">:</span> <span class="number">3.2</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="è¯·æ±‚ä½“-å­—æ®µ"><a href="#è¯·æ±‚ä½“-å­—æ®µ" class="headerlink" title="è¯·æ±‚ä½“-å­—æ®µ"></a>è¯·æ±‚ä½“-å­—æ®µ</h2><p>ä¸åœ¨è·¯å¾„æ“ä½œå‡½æ•°ä¸­ä½¿ç”¨ <code>Query</code>ã€<code>Path</code> ã€<code>Body</code> å£°æ˜æ ¡éªŒä¸å…ƒæ•°æ®çš„æ–¹å¼ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨ Pydantic çš„ <code>Field</code> åœ¨ Pydantic æ¨¡å‹å†…éƒ¨å£°æ˜æ ¡éªŒå’Œå…ƒæ•°æ®ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Body</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = Field(</span><br><span class="line">        default=<span class="literal">None</span>, title=<span class="string">&quot;the description of the item&quot;</span>, max_length=<span class="number">100</span></span><br><span class="line">    )</span><br><span class="line">    price: <span class="built_in">float</span> = Field(gt=<span class="number">0</span>, description=<span class="string">&quot;the price of the item, must be greater than zero&quot;</span>)</span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Annotated[Item, Body(<span class="params">embed=<span class="literal">True</span></span>)]</span>):</span><br><span class="line">    result = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;item&quot;</span>: item&#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/b90a8a1780cc1c164fa6c28e616280109872e25a8642f2f28ceee4b653d10985.png" alt="å›¾ 11">  </p>
<p><code>Field</code> çš„å·¥ä½œæ–¹å¼å’Œ <code>Query</code>ã€<code>Path</code>ã€<code>Body</code> ç›¸åŒï¼Œå‚æ•°ä¹Ÿç›¸åŒã€‚</p>
<blockquote>
<p>å®é™…ä¸Šï¼Œ<code>Query</code>ã€<code>Path</code> éƒ½æ˜¯ <code>Params</code> çš„å­ç±»ï¼Œè€Œ <code>Params</code> ç±»åˆæ˜¯ Pydantic ä¸­ <code>FieldInfo</code> çš„å­ç±»ã€‚</p>
<p>Pydantic çš„ <code>Field</code> è¿”å›ä¹Ÿæ˜¯ <code>FieldInfo</code> çš„ç±»å®ä¾‹ã€‚</p>
<p><code>Body</code> ç›´æ¥è¿”å›çš„ä¹Ÿæ˜¯ <code>FieldInfo</code> çš„å­ç±»çš„å¯¹è±¡ã€‚åæ–‡è¿˜ä¼šä»‹ç»ä¸€äº› <code>Body</code> çš„å­ç±»ã€‚</p>
<p>æ³¨æ„ï¼Œä» fastapi å¯¼å…¥çš„ <code>Query</code>ã€<code>Path</code> ç­‰å¯¹è±¡å®é™…ä¸Šéƒ½æ˜¯è¿”å›ç‰¹æ®Šç±»çš„å‡½æ•°ã€‚</p>
<p>æ³¨æ„ï¼Œæ¨¡å‹å±æ€§çš„ç±»å‹ã€é»˜è®¤å€¼åŠ <code>Field</code> çš„ä»£ç ç»“æ„ä¸è·¯å¾„æ“ä½œå‡½æ•°çš„å‚æ•°ç›¸åŒï¼Œåªä¸è¿‡æ˜¯ç”¨ <code>Field</code> æ›¿æ¢äº†<code>Path</code>ã€<code>Query</code>ã€<code>Body</code>ã€‚</p>
</blockquote>
<h2 id="è¯·æ±‚ä½“-åµŒå¥—æ¨¡å‹"><a href="#è¯·æ±‚ä½“-åµŒå¥—æ¨¡å‹" class="headerlink" title="è¯·æ±‚ä½“-åµŒå¥—æ¨¡å‹"></a>è¯·æ±‚ä½“-åµŒå¥—æ¨¡å‹</h2><h3 id="Listå­—æ®µ"><a href="#Listå­—æ®µ" class="headerlink" title="Listå­—æ®µ"></a>Listå­—æ®µ</h3><p>ä½ å¯ä»¥å°†ä¸€ä¸ªå±æ€§å®šä¹‰ä¸ºæ‹¥æœ‰å­å…ƒç´ çš„ç±»å‹ã€‚ä¾‹å¦‚ Python <code>list</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    tags: <span class="built_in">list</span> = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Item</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;item&quot;</span>: item&#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>

<p>è¿™å°†ä½¿ <code>tags</code> æˆä¸ºä¸€ä¸ªç”±å…ƒç´ ç»„æˆçš„åˆ—è¡¨ã€‚ä¸è¿‡å®ƒæ²¡æœ‰å£°æ˜æ¯ä¸ªå…ƒç´ çš„ç±»å‹ã€‚</p>
<h3 id="å…·æœ‰å­ç±»å‹çš„Listå­—æ®µ"><a href="#å…·æœ‰å­ç±»å‹çš„Listå­—æ®µ" class="headerlink" title="å…·æœ‰å­ç±»å‹çš„Listå­—æ®µ"></a>å…·æœ‰å­ç±»å‹çš„Listå­—æ®µ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tags: <span class="built_in">list</span>[<span class="built_in">str</span>] = []</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    tags: <span class="built_in">list</span>[<span class="built_in">str</span>] = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Item</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;item&quot;</span>: item&#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>

<h3 id="åµŒå¥—æ¨¡å‹"><a href="#åµŒå¥—æ¨¡å‹" class="headerlink" title="åµŒå¥—æ¨¡å‹"></a>åµŒå¥—æ¨¡å‹</h3><p>Pydantic æ¨¡å‹çš„æ¯ä¸ªå±æ€§éƒ½å…·æœ‰ç±»å‹ã€‚</p>
<p>ä½†æ˜¯è¿™ä¸ªç±»å‹æœ¬èº«å¯ä»¥æ˜¯å¦ä¸€ä¸ª Pydantic æ¨¡å‹ã€‚</p>
<p>å› æ­¤ï¼Œä½ å¯ä»¥å£°æ˜æ‹¥æœ‰ç‰¹å®šå±æ€§åç§°ã€ç±»å‹å’Œæ ¡éªŒçš„æ·±åº¦åµŒå¥—çš„ JSON å¯¹è±¡ã€‚</p>
<p>ä¸Šè¿°è¿™äº›éƒ½å¯ä»¥ä»»æ„çš„åµŒå¥—ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Image</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    url: <span class="built_in">str</span></span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    tags: <span class="built_in">set</span>[<span class="built_in">str</span>] = <span class="built_in">set</span>()</span><br><span class="line">    image: Image | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Item</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;item&quot;</span>: item&#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>

<p>è¿™æ„å‘³ç€ FastAPI å°†æœŸæœ›ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„è¯·æ±‚ä½“ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Foo&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The pretender&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">42.0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tax&quot;</span><span class="punctuation">:</span> <span class="number">3.2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;rock&quot;</span><span class="punctuation">,</span> <span class="string">&quot;metal&quot;</span><span class="punctuation">,</span> <span class="string">&quot;bar&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://example.com/baz.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The Foo live&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/37257f46f7459db8ff5f40ab397932b24a810aa98aa0047574d80e979937d399.png" alt="å›¾ 12">  </p>
<h3 id="ç‰¹æ®Šç±»å‹å’Œæ ¡éªŒ"><a href="#ç‰¹æ®Šç±»å‹å’Œæ ¡éªŒ" class="headerlink" title="ç‰¹æ®Šç±»å‹å’Œæ ¡éªŒ"></a>ç‰¹æ®Šç±»å‹å’Œæ ¡éªŒ</h3><p>é™¤äº†æ™®é€šçš„å•ä¸€å€¼ç±»å‹ï¼ˆå¦‚ strã€intã€float ç­‰ï¼‰å¤–ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ä» <code>str</code> ç»§æ‰¿çš„æ›´å¤æ‚çš„å•ä¸€å€¼ç±»å‹ã€‚</p>
<p>è¦äº†è§£æ‰€æœ‰çš„å¯ç”¨é€‰é¡¹ï¼Œè¯·æŸ¥çœ‹å…³äº æ¥è‡ª Pydantic çš„å¤–éƒ¨ç±»å‹ çš„æ–‡æ¡£ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨ <code>Image</code> æ¨¡å‹ä¸­æˆ‘ä»¬æœ‰ä¸€ä¸ª <code>url</code> å­—æ®µï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒå£°æ˜ä¸º Pydantic çš„ <code>HttpUrl</code>ï¼Œè€Œä¸æ˜¯ <code>str</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, HttpUrl</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Image</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    url: HttpUrl</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    tags: <span class="built_in">set</span>[<span class="built_in">str</span>] = <span class="built_in">set</span>()</span><br><span class="line">    image: Image | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Item</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;item&quot;</span>: item&#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>

<p>è¯¥å­—ç¬¦ä¸²å°†è¢«æ£€æŸ¥æ˜¯å¦ä¸ºæœ‰æ•ˆçš„ URLï¼Œå¹¶åœ¨ JSON Schema &#x2F; OpenAPI æ–‡æ¡£ä¸­è¿›è¡Œè®°å½•ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/f79f9f030e974cff2803a2ffec6282a80543ed65cc5713cc403e5a344048d9aa.png" alt="å›¾ 13">  </p>
<h3 id="å¸¦æœ‰ä¸€ç»„å­æ¨¡å‹çš„å±æ€§"><a href="#å¸¦æœ‰ä¸€ç»„å­æ¨¡å‹çš„å±æ€§" class="headerlink" title="å¸¦æœ‰ä¸€ç»„å­æ¨¡å‹çš„å±æ€§"></a>å¸¦æœ‰ä¸€ç»„å­æ¨¡å‹çš„å±æ€§</h3><p>è¿˜å¯ä»¥å°† Pydantic æ¨¡å‹ç”¨ä½œ <code>list</code>ã€<code>set</code> ç­‰çš„å­ç±»å‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, HttpUrl</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Image</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    url: HttpUrl</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    tags: <span class="built_in">set</span>[<span class="built_in">str</span>] = <span class="built_in">set</span>()</span><br><span class="line">    images: <span class="built_in">list</span>[Image] | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Item</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;item&quot;</span>: item&#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>

<p>è¿™å°†æœŸæœ›ï¼ˆè½¬æ¢ï¼Œæ ¡éªŒï¼Œè®°å½•æ–‡æ¡£ç­‰ï¼‰ä¸‹é¢è¿™æ ·çš„ JSON è¯·æ±‚ä½“ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Foo&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The pretender&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">42.0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tax&quot;</span><span class="punctuation">:</span> <span class="number">3.2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;rock&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;metal&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;bar&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;images&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://example.com/baz.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The Foo live&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://example.com/dave.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The Baz&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="æ·±åº¦åµŒå¥—æ¨¡å‹"><a href="#æ·±åº¦åµŒå¥—æ¨¡å‹" class="headerlink" title="æ·±åº¦åµŒå¥—æ¨¡å‹"></a>æ·±åº¦åµŒå¥—æ¨¡å‹</h3><p>ä½ å¯ä»¥å®šä¹‰ä»»æ„æ·±åº¦çš„åµŒå¥—æ¨¡å‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, HttpUrl</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Image</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    url: HttpUrl</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    tags: <span class="built_in">set</span>[<span class="built_in">str</span>] = <span class="built_in">set</span>()</span><br><span class="line">    images: <span class="built_in">list</span>[Image] | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Offer</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    items: <span class="built_in">list</span>[Item]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/offers/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_offer</span>(<span class="params">offer: Offer</span>):</span><br><span class="line">    <span class="keyword">return</span> offer</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹è¯·æ±‚ä½“ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;items&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;tax&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;images&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://example.com/&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/f9b32edf8f804a7a641371e2e24a2674939a157a2319c4c262ebd9aa7a95b579.png" alt="å›¾ 14">  </p>
<h3 id="çº¯åˆ—è¡¨è¯·æ±‚ä½“"><a href="#çº¯åˆ—è¡¨è¯·æ±‚ä½“" class="headerlink" title="çº¯åˆ—è¡¨è¯·æ±‚ä½“"></a>çº¯åˆ—è¡¨è¯·æ±‚ä½“</h3><p>å¦‚æœä½ æœŸæœ›çš„ JSON è¯·æ±‚ä½“çš„æœ€å¤–å±‚æ˜¯ä¸€ä¸ª JSON arrayï¼ˆå³ Python listï¼‰ï¼Œåˆ™å¯ä»¥åœ¨è·¯å¾„æ“ä½œå‡½æ•°çš„å‚æ•°ä¸­å£°æ˜æ­¤ç±»å‹ï¼Œå°±åƒå£°æ˜ Pydantic æ¨¡å‹ä¸€æ ·ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">images: <span class="type">List</span>[Image]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, HttpUrl</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Image</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    url: HttpUrl</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/images/multiple/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_multiple_images</span>(<span class="params">images: <span class="built_in">list</span>[Image]</span>):</span><br><span class="line">    <span class="keyword">return</span> images</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹è¯·æ±‚ä½“ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://example.com/&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<h3 id="ä»»æ„-dict-æ„æˆçš„è¯·æ±‚ä½“"><a href="#ä»»æ„-dict-æ„æˆçš„è¯·æ±‚ä½“" class="headerlink" title="ä»»æ„ dict æ„æˆçš„è¯·æ±‚ä½“"></a>ä»»æ„ dict æ„æˆçš„è¯·æ±‚ä½“</h3><p>ä½ ä¹Ÿå¯ä»¥å°†è¯·æ±‚ä½“å£°æ˜ä¸ºä½¿ç”¨æŸç±»å‹çš„é”®å’Œå…¶ä»–ç±»å‹å€¼çš„ <code>dict</code>ã€‚</p>
<p>æ— éœ€äº‹å…ˆçŸ¥é“æœ‰æ•ˆçš„å­—æ®µ&#x2F;å±æ€§ï¼ˆåœ¨ä½¿ç”¨ Pydantic æ¨¡å‹çš„åœºæ™¯ï¼‰åç§°æ˜¯ä»€ä¹ˆã€‚</p>
<p>å¦‚æœä½ æƒ³æ¥æ”¶ä¸€äº›å°šä¸”æœªçŸ¥çš„é”®ï¼Œè¿™å°†å¾ˆæœ‰ç”¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/index-weights/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_index_weights</span>(<span class="params">weights: <span class="built_in">dict</span>[<span class="built_in">int</span>, <span class="built_in">float</span>]</span>):</span><br><span class="line">    <span class="keyword">return</span> weights</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¯·è®°ä½ JSON ä»…æ”¯æŒå°† str ä½œä¸ºé”®ã€‚</p>
<p>ä½†æ˜¯ Pydantic å…·æœ‰è‡ªåŠ¨è½¬æ¢æ•°æ®çš„åŠŸèƒ½ã€‚</p>
<p>è¿™æ„å‘³ç€ï¼Œå³ä½¿ä½ çš„ API å®¢æˆ·ç«¯åªèƒ½å°†å­—ç¬¦ä¸²ä½œä¸ºé”®å‘é€ï¼Œåªè¦è¿™äº›å­—ç¬¦ä¸²å†…å®¹ä»…åŒ…å«æ•´æ•°ï¼ŒPydantic å°±ä¼šå¯¹å…¶è¿›è¡Œè½¬æ¢å¹¶æ ¡éªŒã€‚</p>
<p>ç„¶åä½ æ¥æ”¶çš„åä¸º weights çš„ dict å®é™…ä¸Šå°†å…·æœ‰ int ç±»å‹çš„é”®å’Œ float ç±»å‹çš„å€¼ã€‚</p>
</blockquote>
<h2 id="æ¨¡å¼çš„é¢å¤–ä¿¡æ¯"><a href="#æ¨¡å¼çš„é¢å¤–ä¿¡æ¯" class="headerlink" title="æ¨¡å¼çš„é¢å¤–ä¿¡æ¯"></a>æ¨¡å¼çš„é¢å¤–ä¿¡æ¯</h2><p>å¯ä»¥åœ¨JSONæ¨¡å¼ä¸­å®šä¹‰é¢å¤–çš„ä¿¡æ¯ã€‚</p>
<p>ä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹æ˜¯æ·»åŠ ä¸€ä¸ªå°†åœ¨æ–‡æ¡£ä¸­æ˜¾ç¤ºçš„exampleã€‚</p>
<p>æœ‰å‡ ç§æ–¹æ³•å¯ä»¥å£°æ˜é¢å¤–çš„ JSON æ¨¡å¼ä¿¡æ¯ã€‚</p>
<h3 id="Pydantic-schema-extra"><a href="#Pydantic-schema-extra" class="headerlink" title="Pydantic schema_extra"></a>Pydantic schema_extra</h3><p>å¯ä»¥ä½¿ç”¨ Config å’Œ schema_extra ä¸ºPydanticæ¨¡å‹å£°æ˜ä¸€ä¸ªç¤ºä¾‹ï¼Œå¦‚:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    model_config = &#123;</span><br><span class="line">        <span class="string">&quot;json_schema_extra&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;examples&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Foo&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;A very nice Item&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;price&quot;</span>: <span class="number">35.4</span>,</span><br><span class="line">                    <span class="string">&quot;tax&quot;</span>: <span class="number">3.2</span>,</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Item</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;item&quot;</span>: item&#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p>doc æ–‡æ¡£æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/8c613a73950f11031cbe4ff6f549ab6b49252748dc07875d0e7d1539d773f12f.png" alt="å›¾ 15">  </p>
<h3 id="Field-çš„é™„åŠ å‚æ•°"><a href="#Field-çš„é™„åŠ å‚æ•°" class="headerlink" title="Field çš„é™„åŠ å‚æ•°"></a>Field çš„é™„åŠ å‚æ•°</h3><p>åœ¨ <code>Field</code>, <code>Path</code>, <code>Query</code>, <code>Body</code> å’Œå…¶ä»–ä½ ä¹‹åå°†ä¼šçœ‹åˆ°çš„å·¥å‚å‡½æ•°ï¼Œä½ å¯ä»¥ä¸ºJSON æ¨¡å¼å£°æ˜é¢å¤–ä¿¡æ¯ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ç»™å·¥å‚å‡½æ•°ä¼ é€’å…¶ä»–çš„ä»»æ„å‚æ•°æ¥ç»™ JSON æ¨¡å¼å£°æ˜é¢å¤–ä¿¡æ¯ï¼Œæ¯”å¦‚å¢åŠ  <code>example</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span> = Field(examples=[<span class="string">&quot;Foo&quot;</span>])</span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = Field(default=<span class="literal">None</span>, examples=[<span class="string">&quot;A very nice Item&quot;</span>])</span><br><span class="line">    price: <span class="built_in">float</span> = Field(examples=[<span class="number">35.4</span>])</span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = Field(default=<span class="literal">None</span>, examples=[<span class="number">3.2</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Item</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;item&quot;</span>: item&#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p>doc æ–‡æ¡£æ˜¾ç¤ºå¦‚ä¸Šå›¾ã€‚</p>
<h3 id="Body-é¢å¤–å‚æ•°"><a href="#Body-é¢å¤–å‚æ•°" class="headerlink" title="Body é¢å¤–å‚æ•°"></a>Body é¢å¤–å‚æ•°</h3><p>ä½ å¯ä»¥é€šè¿‡ä¼ é€’é¢å¤–ä¿¡æ¯ç»™ <code>Field</code> åŒæ ·çš„æ–¹å¼æ“ä½œ<code>Path</code>, <code>Query</code>, <code>Body</code>ç­‰ã€‚</p>
<p>æ¯”å¦‚ï¼Œä½ å¯ä»¥å°†è¯·æ±‚ä½“çš„ä¸€ä¸ª <code>example</code> ä¼ é€’ç»™ <code>Body</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Body, FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Annotated[Item, Body(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="params">    examples=[</span></span></span><br><span class="line"><span class="params"><span class="params">        &#123;</span></span></span><br><span class="line"><span class="params"><span class="params">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Foo&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">            <span class="string">&quot;description&quot;</span>: <span class="string">&quot;A very nice Item&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">            <span class="string">&quot;price&quot;</span>: <span class="number">35.4</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">            <span class="string">&quot;tax&quot;</span>: <span class="number">3.2</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">        &#125;</span></span></span><br><span class="line"><span class="params"><span class="params">    ],</span></span></span><br><span class="line"><span class="params"><span class="params"></span>)]</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;item&quot;</span>: item&#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p>docæ˜¾ç¤ºæ–‡æ¡£å¦‚ä¸Šå›¾ã€‚</p>
<h2 id="é¢å¤–æ•°æ®ç±»å‹"><a href="#é¢å¤–æ•°æ®ç±»å‹" class="headerlink" title="é¢å¤–æ•°æ®ç±»å‹"></a>é¢å¤–æ•°æ®ç±»å‹</h2><p>ä¸‹é¢æ˜¯ä¸€äº›ä½ å¯ä»¥ä½¿ç”¨çš„å…¶ä»–æ•°æ®ç±»å‹:</p>
<ul>
<li>UUID:<ul>
<li>ä¸€ç§æ ‡å‡†çš„ â€œé€šç”¨å”¯ä¸€æ ‡è¯†ç¬¦â€ ï¼Œåœ¨è®¸å¤šæ•°æ®åº“å’Œç³»ç»Ÿä¸­ç”¨ä½œIDã€‚</li>
<li>åœ¨è¯·æ±‚å’Œå“åº”ä¸­å°†ä»¥ str è¡¨ç¤ºã€‚</li>
</ul>
</li>
<li>datetime.datetime:<ul>
<li>ä¸€ä¸ª Python datetime.datetime.</li>
<li>åœ¨è¯·æ±‚å’Œå“åº”ä¸­å°†è¡¨ç¤ºä¸º ISO 8601 æ ¼å¼çš„ str ï¼Œæ¯”å¦‚: 2008-09-15T15:53:00+05:00.</li>
</ul>
</li>
<li>datetime.date:<ul>
<li>Python datetime.date.</li>
<li>åœ¨è¯·æ±‚å’Œå“åº”ä¸­å°†è¡¨ç¤ºä¸º ISO 8601 æ ¼å¼çš„ str ï¼Œæ¯”å¦‚: 2008-09-15.</li>
</ul>
</li>
<li>datetime.time:<ul>
<li>ä¸€ä¸ª Python datetime.time.</li>
<li>åœ¨è¯·æ±‚å’Œå“åº”ä¸­å°†è¡¨ç¤ºä¸º ISO 8601 æ ¼å¼çš„ str ï¼Œæ¯”å¦‚: 14:23:55.003.</li>
</ul>
</li>
<li>datetime.timedelta:<ul>
<li>ä¸€ä¸ª Python datetime.timedelta.</li>
<li>åœ¨è¯·æ±‚å’Œå“åº”ä¸­å°†è¡¨ç¤ºä¸º float ä»£è¡¨æ€»ç§’æ•°ã€‚</li>
<li>Pydantic ä¹Ÿå…è®¸å°†å…¶è¡¨ç¤ºä¸º â€œISO 8601 æ—¶é—´å·®å¼‚ç¼–ç â€ã€‚</li>
</ul>
</li>
<li>frozenset:<ul>
<li>åœ¨è¯·æ±‚å’Œå“åº”ä¸­ï¼Œä½œä¸º set å¯¹å¾…ï¼š<ul>
<li>åœ¨è¯·æ±‚ä¸­ï¼Œåˆ—è¡¨å°†è¢«è¯»å–ï¼Œæ¶ˆé™¤é‡å¤ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ª setã€‚</li>
<li>åœ¨å“åº”ä¸­ set å°†è¢«è½¬æ¢ä¸º list ã€‚</li>
<li>äº§ç”Ÿçš„æ¨¡å¼å°†æŒ‡å®šé‚£äº› set çš„å€¼æ˜¯å”¯ä¸€çš„ (ä½¿ç”¨ JSON æ¨¡å¼çš„ uniqueItems)ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>bytes:<ul>
<li>æ ‡å‡†çš„ Python bytesã€‚</li>
<li>åœ¨è¯·æ±‚å’Œå“åº”ä¸­è¢«å½“ä½œ str å¤„ç†ã€‚</li>
<li>ç”Ÿæˆçš„æ¨¡å¼å°†æŒ‡å®šè¿™ä¸ª str æ˜¯ binary â€œæ ¼å¼â€ã€‚</li>
</ul>
</li>
<li>Decimal:<ul>
<li>æ ‡å‡†çš„ Python Decimalã€‚</li>
<li>åœ¨è¯·æ±‚å’Œå“åº”ä¸­è¢«å½“åš float ä¸€æ ·å¤„ç†ã€‚</li>
</ul>
</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, time, timedelta</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"><span class="keyword">from</span> uuid <span class="keyword">import</span> UUID</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Body, FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params"></span></span><br><span class="line"><span class="params">    item_id: UUID,</span></span><br><span class="line"><span class="params">    start_datetime: Annotated[datetime, Body(<span class="params"></span>)],</span></span><br><span class="line"><span class="params">    end_datetime: Annotated[datetime, Body(<span class="params"></span>)],</span></span><br><span class="line"><span class="params">    process_after: Annotated[timedelta, Body(<span class="params"></span>)],</span></span><br><span class="line"><span class="params">    repeat_at: Annotated[time | <span class="literal">None</span>, Body(<span class="params"></span>)] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    start_process = start_datetime + process_after</span><br><span class="line">    duration = end_datetime - start_process</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;item_id&quot;</span>: item_id,</span><br><span class="line">        <span class="string">&quot;start_datetime&quot;</span>: start_datetime,</span><br><span class="line">        <span class="string">&quot;end_datetime&quot;</span>: end_datetime,</span><br><span class="line">        <span class="string">&quot;process_after&quot;</span>: process_after,</span><br><span class="line">        <span class="string">&quot;repeat_at&quot;</span>: repeat_at,</span><br><span class="line">        <span class="string">&quot;start_process&quot;</span>: start_process,</span><br><span class="line">        <span class="string">&quot;duration&quot;</span>: duration,</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="Cookieå‚æ•°"><a href="#Cookieå‚æ•°" class="headerlink" title="Cookieå‚æ•°"></a>Cookieå‚æ•°</h2><p>å®šä¹‰ <code>Cookie</code> å‚æ•°ä¸å®šä¹‰ <code>Query</code> å’Œ <code>Path</code> å‚æ•°ä¸€æ ·ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Cookie</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> Response</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">ads_id: Annotated[<span class="built_in">str</span> | <span class="literal">None</span>, Cookie(<span class="params"></span>)] = <span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;ads_id&quot;</span>: ads_id&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/set-cookie/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">set_cookie</span>() -&gt; Response:</span><br><span class="line">    res = &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Cookie set&quot;</span>&#125;</span><br><span class="line">    response = Response(content=<span class="built_in">str</span>(res))</span><br><span class="line">    response.set_cookie(key=<span class="string">&quot;ads_id&quot;</span>, value=<span class="string">&quot;gaga&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¿…é¡»ä½¿ç”¨ Cookie å£°æ˜ cookie å‚æ•°ï¼Œå¦åˆ™è¯¥å‚æ•°ä¼šè¢«è§£é‡Šä¸ºæŸ¥è¯¢å‚æ•°ã€‚</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/e6f18f16fb2190ea83daebdd2952816e56cf2040af25e6d399d9806fc2f51ff0.png" alt="å›¾ 16">  </p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/e98d396bac35103ca639a941c8b18bd9dbdf54f27aaf409e42c71bc1f47d2241.png" alt="å›¾ 17"></p>
<blockquote>
<p>è¯·è®°ä½ï¼Œç”±äºæµè§ˆå™¨ä»¥ç‰¹æ®Šæ–¹å¼å¤„ç† cookieï¼Œå¹¶åœ¨åå°è¿›è¡Œæ“ä½œï¼Œå› æ­¤å®ƒä»¬ä¸ä¼šè½»æ˜“å…è®¸ JavaScript è®¿é—®è¿™äº› cookieã€‚</p>
<p>å¦‚æœæ‚¨è®¿é—® &#x2F;docs çš„ API æ–‡æ¡£ UIï¼Œæ‚¨å°†èƒ½å¤ŸæŸ¥çœ‹æ‚¨è·¯å¾„æ“ä½œçš„ cookie æ–‡æ¡£ã€‚</p>
<p>ä½†æ˜¯å³ä½¿æ‚¨å¡«å†™æ•°æ®å¹¶ç‚¹å‡»â€œæ‰§è¡Œâ€ï¼Œç”±äºæ–‡æ¡£ç•Œé¢ä½¿ç”¨ JavaScriptï¼Œcookie å°†ä¸ä¼šè¢«å‘é€ã€‚è€Œæ‚¨ä¼šçœ‹åˆ°ä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼Œå°±å¥½åƒæ‚¨æ²¡æœ‰è¾“å…¥ä»»ä½•å€¼ä¸€æ ·ã€‚</p>
</blockquote>
<h2 id="Header-å‚æ•°"><a href="#Header-å‚æ•°" class="headerlink" title="Header å‚æ•°"></a>Header å‚æ•°</h2><p>å®šä¹‰ <code>Header</code> å‚æ•°çš„æ–¹å¼ä¸å®šä¹‰ <code>Query</code>ã€<code>Path</code>ã€<code>Cookie</code> å‚æ•°ç›¸åŒã€‚</p>
<h3 id="å£°æ˜-Header-å‚æ•°"><a href="#å£°æ˜-Header-å‚æ•°" class="headerlink" title="å£°æ˜ Header å‚æ•°"></a>å£°æ˜ Header å‚æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Header</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">user_agent: Annotated[<span class="built_in">str</span> | <span class="literal">None</span>, Header(<span class="params"></span>)] = <span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;User-Agent&quot;</span>: user_agent&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¿…é¡»ä½¿ç”¨ Header å£°æ˜ header å‚æ•°ï¼Œå¦åˆ™è¯¥å‚æ•°ä¼šè¢«è§£é‡Šä¸ºæŸ¥è¯¢å‚æ•°ã€‚</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/5d654be4b1a80f01e1b3b7c888a36693b11753e4075e5945ec4815f4bfe4a36f.png" alt="å›¾ 18">  </p>
<h3 id="è‡ªåŠ¨è½¬æ¢"><a href="#è‡ªåŠ¨è½¬æ¢" class="headerlink" title="è‡ªåŠ¨è½¬æ¢"></a>è‡ªåŠ¨è½¬æ¢</h3><p><code>Header</code> æ¯” <code>Path</code>ã€<code>Query</code> å’Œ <code>Cookie</code> æä¾›äº†æ›´å¤šåŠŸèƒ½ã€‚</p>
<p>å¤§éƒ¨åˆ†æ ‡å‡†è¯·æ±‚å¤´ç”¨è¿å­—ç¬¦åˆ†éš”ï¼Œå³å‡å·ï¼ˆ-ï¼‰ã€‚</p>
<p>ä½†æ˜¯ <code>user-agent</code> è¿™æ ·çš„å˜é‡åœ¨ Python ä¸­æ˜¯æ— æ•ˆçš„ã€‚</p>
<p>å› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>Header</code> ä¼šæŠŠå‚æ•°åä¸­çš„å­—ç¬¦ç”±ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰æ”¹ä¸ºè¿å­—ç¬¦ï¼ˆ-ï¼‰æ¥æå–å¹¶ä¿å­˜è¯·æ±‚å¤´ ã€‚</p>
<p>åŒæ—¶ï¼ŒHTTP çš„è¯·æ±‚å¤´ä¸åŒºåˆ†å¤§å°å†™ï¼Œå¯ä»¥ä½¿ç”¨ Python æ ‡å‡†æ ·å¼ï¼ˆå³ snake_caseï¼‰è¿›è¡Œå£°æ˜ã€‚</p>
<p>å› æ­¤ï¼Œå¯ä»¥åƒåœ¨ Python ä»£ç ä¸­ä¸€æ ·ä½¿ç”¨ <code>user_agent</code> ï¼Œæ— éœ€æŠŠé¦–å­—æ¯å¤§å†™ä¸º <code>User_Agent</code> ç­‰å½¢å¼ã€‚</p>
<p>å¦‚éœ€ç¦ç”¨ä¸‹åˆ’çº¿è‡ªåŠ¨è½¬æ¢ä¸ºè¿å­—ç¬¦ï¼Œå¯ä»¥æŠŠ <code>Header</code> çš„ <code>convert_underscores</code> å‚æ•°è®¾ç½®ä¸º <code>False</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Header</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">user_agent: Annotated[<span class="built_in">str</span> | <span class="literal">None</span>, Header(<span class="params"></span>)] = <span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;User-Agent&quot;</span>: user_agent&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/09db8a2834ca7e9f12819ddf42140dfb016a7fffebdd93e5cd723d8064f49140.png" alt="å›¾ 19">  </p>
<blockquote>
<p>æ³¨æ„ï¼Œä½¿ç”¨ <code>convert_underscores = False</code> è¦æ…é‡ï¼Œæœ‰äº› HTTP ä»£ç†å’ŒæœåŠ¡å™¨ä¸æ”¯æŒä½¿ç”¨å¸¦æœ‰ä¸‹åˆ’çº¿çš„è¯·æ±‚å¤´ã€‚</p>
</blockquote>
<h3 id="é‡å¤è¯·æ±‚å¤´"><a href="#é‡å¤è¯·æ±‚å¤´" class="headerlink" title="é‡å¤è¯·æ±‚å¤´"></a>é‡å¤è¯·æ±‚å¤´</h3><p>æœ‰æ—¶ï¼Œå¯èƒ½éœ€è¦æ¥æ”¶é‡å¤çš„è¯·æ±‚å¤´ã€‚å³åŒä¸€ä¸ªè¯·æ±‚å¤´æœ‰å¤šä¸ªå€¼ã€‚</p>
<p>ç±»å‹å£°æ˜ä¸­å¯ä»¥ä½¿ç”¨ <code>list</code> å®šä¹‰å¤šä¸ªè¯·æ±‚å¤´ã€‚</p>
<p>ä½¿ç”¨ Python <code>list</code> å¯ä»¥æ¥æ”¶é‡å¤è¯·æ±‚å¤´æ‰€æœ‰çš„å€¼ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå£°æ˜ <code>X-Token</code> å¤šæ¬¡å‡ºç°çš„è¯·æ±‚å¤´ï¼Œå¯ä»¥å†™æˆè¿™æ ·ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Header</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">x_token: Annotated[<span class="built_in">list</span>[<span class="built_in">str</span>] | <span class="literal">None</span>, Header(<span class="params"></span>)] = <span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;X-Token values&quot;</span>: x_token&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/20da92d3156063c5d979ccefee82f8a3fa0d509b3dd093d808a5fc92f4e3882c.png" alt="å›¾ 20">  </p>
<h2 id="Cookieå‚æ•°æ¨¡å‹"><a href="#Cookieå‚æ•°æ¨¡å‹" class="headerlink" title="Cookieå‚æ•°æ¨¡å‹"></a>Cookieå‚æ•°æ¨¡å‹</h2><h3 id="å¸¦æœ‰-Pydantic-æ¨¡å‹çš„-Cookie"><a href="#å¸¦æœ‰-Pydantic-æ¨¡å‹çš„-Cookie" class="headerlink" title="å¸¦æœ‰ Pydantic æ¨¡å‹çš„ Cookie"></a>å¸¦æœ‰ Pydantic æ¨¡å‹çš„ Cookie</h3><p>å¦‚æœæ‚¨æœ‰ä¸€ç»„ç›¸å…³çš„ cookieï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ª Pydantic æ¨¡å‹æ¥å£°æ˜å®ƒä»¬ã€‚</p>
<p>è¿™å°†å…è®¸æ‚¨åœ¨å¤šä¸ªåœ°æ–¹èƒ½å¤Ÿé‡ç”¨æ¨¡å‹ï¼Œå¹¶ä¸”å¯ä»¥ä¸€æ¬¡æ€§å£°æ˜æ‰€æœ‰å‚æ•°çš„éªŒè¯æ–¹å¼å’Œå…ƒæ•°æ®ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Cookie, Response</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cookies</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    session_id: <span class="built_in">str</span></span><br><span class="line">    session_name: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    session_age: <span class="built_in">int</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/set-cookies/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>() -&gt; Response:</span><br><span class="line">    cookie_data = Cookies(session_id=<span class="string">&quot;123&quot;</span>, session_name=<span class="string">&quot;è€ç‹&quot;</span>, session_age=<span class="number">18</span>)</span><br><span class="line">    <span class="comment"># åˆ›å»ºå“åº”å¯¹è±¡</span></span><br><span class="line">    response = Response(content=<span class="string">&quot;Cookies have been set&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯¹å¯èƒ½åŒ…å«é latin-1 å­—ç¬¦çš„å€¼è¿›è¡Œ Base64 ç¼–ç </span></span><br><span class="line">    encoded_session_name = base64.urlsafe_b64encode(</span><br><span class="line">        (cookie_data.session_name <span class="keyword">or</span> <span class="string">&quot;&quot;</span>).encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    ).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®¾ç½®å¤šä¸ª Cookie</span></span><br><span class="line">    response.set_cookie(key=<span class="string">&quot;session_id&quot;</span>, value=cookie_data.session_id)</span><br><span class="line">    response.set_cookie(key=<span class="string">&quot;session_name&quot;</span>, value=encoded_session_name)</span><br><span class="line">    response.set_cookie(key=<span class="string">&quot;session_age&quot;</span>, value=<span class="built_in">str</span>(cookie_data.session_age) <span class="keyword">if</span> cookie_data.session_age <span class="keyword">else</span> <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">cookies: Annotated[Cookies, Cookie(<span class="params"></span>)]</span>):</span><br><span class="line">    <span class="keyword">return</span> cookies</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p>FastAPI å°†ä»è¯·æ±‚ä¸­æ¥æ”¶åˆ°çš„ cookie ä¸­æå–å‡ºæ¯ä¸ªå­—æ®µçš„æ•°æ®ï¼Œå¹¶æä¾›æ‚¨å®šä¹‰çš„ Pydantic æ¨¡å‹ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/875a2951ee9db763e3d5fc10dbc9083cde8040c7587e879e0e9944580df84621.png" alt="å›¾ 21">  </p>
<h3 id="ç¦æ­¢é¢å¤–çš„-Cookie"><a href="#ç¦æ­¢é¢å¤–çš„-Cookie" class="headerlink" title="ç¦æ­¢é¢å¤–çš„ Cookie"></a>ç¦æ­¢é¢å¤–çš„ Cookie</h3><p>åœ¨æŸäº›ç‰¹æ®Šä½¿ç”¨æƒ…å†µä¸‹ï¼ˆå¯èƒ½å¹¶ä¸å¸¸è§ï¼‰ï¼Œæ‚¨å¯èƒ½å¸Œæœ›é™åˆ¶æ‚¨æƒ³è¦æ¥æ”¶çš„ cookieã€‚</p>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ Pydantic çš„æ¨¡å‹é…ç½®æ¥ç¦æ­¢ï¼ˆ forbid ï¼‰ä»»ä½•é¢å¤–ï¼ˆ extra ï¼‰å­—æ®µï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated, <span class="type">Union</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Cookie, FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cookies</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    model_config = &#123;<span class="string">&quot;extra&quot;</span>: <span class="string">&quot;forbid&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    session_id: <span class="built_in">str</span></span><br><span class="line">    fatebook_tracker: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    googall_tracker: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">cookies: Annotated[Cookies, Cookie(<span class="params"></span>)]</span>):</span><br><span class="line">    <span class="keyword">return</span> cookies</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå®¢æˆ·å°è¯•å‘é€ä¸€äº›<strong>é¢å¤–çš„ cookie</strong>ï¼Œä»–ä»¬å°†æ”¶åˆ°é”™è¯¯å“åº”ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœå®¢æˆ·ç«¯å°è¯•å‘é€ä¸€ä¸ªå€¼ä¸º good-list-please çš„ santa_tracker cookieï¼Œå®¢æˆ·ç«¯å°†æ”¶åˆ°ä¸€ä¸ªé”™è¯¯å“åº”ï¼Œå‘ŠçŸ¥ä»–ä»¬ santa_tracker cookie æ˜¯ä¸å…è®¸çš„ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;extra_forbidden&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;loc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;cookie&quot;</span><span class="punctuation">,</span> <span class="string">&quot;santa_tracker&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Extra inputs are not permitted&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;good-list-please&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Headerå‚æ•°æ¨¡å‹"><a href="#Headerå‚æ•°æ¨¡å‹" class="headerlink" title="Headerå‚æ•°æ¨¡å‹"></a>Headerå‚æ•°æ¨¡å‹</h2><p>å¦‚æœæ‚¨æœ‰ä¸€ç»„ç›¸å…³çš„ header å‚æ•°ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ª Pydantic æ¨¡å‹æ¥å£°æ˜å®ƒä»¬ã€‚</p>
<p>è¿™å°†å…è®¸æ‚¨åœ¨å¤šä¸ªåœ°æ–¹èƒ½å¤Ÿé‡ç”¨æ¨¡å‹ï¼Œå¹¶ä¸”å¯ä»¥ä¸€æ¬¡æ€§å£°æ˜æ‰€æœ‰å‚æ•°çš„éªŒè¯å’Œå…ƒæ•°æ®ã€‚</p>
<h3 id="ä½¿ç”¨-Pydantic-æ¨¡å‹çš„-Header-å‚æ•°"><a href="#ä½¿ç”¨-Pydantic-æ¨¡å‹çš„-Header-å‚æ•°" class="headerlink" title="ä½¿ç”¨ Pydantic æ¨¡å‹çš„ Header å‚æ•°"></a>ä½¿ç”¨ Pydantic æ¨¡å‹çš„ Header å‚æ•°</h3><p>åœ¨ Pydantic æ¨¡å‹ä¸­å£°æ˜æ‰€éœ€çš„ header å‚æ•°ï¼Œç„¶åå°†å‚æ•°å£°æ˜ä¸º <code>Header</code> :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Header</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CommonHeaders</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    host: <span class="built_in">str</span></span><br><span class="line">    save_data: <span class="built_in">bool</span></span><br><span class="line">    if_modified_since: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    traceparent: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    x_tag: <span class="built_in">list</span>[<span class="built_in">str</span>] = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">headers: Annotated[CommonHeaders, Header(<span class="params"></span>)]</span>):</span><br><span class="line">    <span class="keyword">return</span> headers</span><br></pre></td></tr></table></figure>

<p>FastAPI å°†ä»è¯·æ±‚ä¸­æ¥æ”¶åˆ°çš„ headers ä¸­æå–å‡ºæ¯ä¸ªå­—æ®µçš„æ•°æ®ï¼Œå¹¶æä¾›æ‚¨å®šä¹‰çš„ Pydantic æ¨¡å‹ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/b83bf81f4b5025f0b2830d274b89e03d2071fdb84413ba0ef2f9a3b658959bbd.png" alt="å›¾ 22">  </p>
<h3 id="ç¦æ­¢é¢å¤–çš„-Headers"><a href="#ç¦æ­¢é¢å¤–çš„-Headers" class="headerlink" title="ç¦æ­¢é¢å¤–çš„ Headers"></a>ç¦æ­¢é¢å¤–çš„ Headers</h3><p>åœ¨æŸäº›ç‰¹æ®Šä½¿ç”¨æƒ…å†µä¸‹ï¼ˆå¯èƒ½å¹¶ä¸å¸¸è§ï¼‰ï¼Œæ‚¨å¯èƒ½å¸Œæœ›é™åˆ¶æ‚¨æƒ³è¦æ¥æ”¶çš„ headersã€‚</p>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ Pydantic çš„æ¨¡å‹é…ç½®æ¥ç¦æ­¢ï¼ˆ forbid ï¼‰ä»»ä½•é¢å¤–ï¼ˆ extra ï¼‰å­—æ®µï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Header</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CommonHeaders</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    model_config = &#123;<span class="string">&quot;extra&quot;</span>: <span class="string">&quot;forbid&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    host: <span class="built_in">str</span></span><br><span class="line">    save_data: <span class="built_in">bool</span></span><br><span class="line">    if_modified_since: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    traceparent: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    x_tag: <span class="built_in">list</span>[<span class="built_in">str</span>] = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">headers: Annotated[CommonHeaders, Header(<span class="params"></span>)]</span>):</span><br><span class="line">    <span class="keyword">return</span> headers</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå®¢æˆ·å°è¯•å‘é€ä¸€äº›é¢å¤–çš„ headersï¼Œä»–ä»¬å°†æ”¶åˆ°é”™è¯¯å“åº”ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœå®¢æˆ·ç«¯å°è¯•å‘é€ä¸€ä¸ªå€¼ä¸º <code>plumbus</code> çš„ <code>tool</code> headerï¼Œå®¢æˆ·ç«¯å°†æ”¶åˆ°ä¸€ä¸ªé”™è¯¯å“åº”ï¼Œå‘ŠçŸ¥ä»–ä»¬ header å‚æ•° <code>tool</code> æ˜¯ä¸å…è®¸çš„ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;extra_forbidden&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;loc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;header&quot;</span><span class="punctuation">,</span> <span class="string">&quot;tool&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Extra inputs are not permitted&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;plumbus&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="å“åº”æ¨¡å‹"><a href="#å“åº”æ¨¡å‹" class="headerlink" title="å“åº”æ¨¡å‹"></a>å“åº”æ¨¡å‹</h2><p>ä½ å¯ä»¥åœ¨ä»»æ„çš„è·¯å¾„æ“ä½œä¸­ä½¿ç”¨ response_model å‚æ•°æ¥å£°æ˜ç”¨äºå“åº”çš„æ¨¡å‹ï¼š</p>
<p>@app.get()<br>@app.post()<br>@app.put()<br>@app.delete()<br>ç­‰ç­‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    tags: <span class="built_in">list</span>[<span class="built_in">str</span>] = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span>, response_model=Item</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>() -&gt; <span class="type">Any</span>:</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Portal Gun&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">42.0</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items1/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>() -&gt; <span class="type">Any</span>:</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Portal Gun&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">42.0</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Plumbus&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">32.0</span>&#125;,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items2/&quot;</span>, response_model=<span class="built_in">list</span>[Item]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>() -&gt; <span class="type">Any</span>:</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Portal Gun&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">42.0</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Plumbus&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">32.0</span>&#125;,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„ï¼Œ<code>response_model</code> æ˜¯ã€Œè£…é¥°å™¨ã€æ–¹æ³•ï¼ˆgetï¼Œpost ç­‰ï¼‰çš„ä¸€ä¸ªå‚æ•°ã€‚ä¸åƒä¹‹å‰çš„æ‰€æœ‰å‚æ•°å’Œè¯·æ±‚ä½“ï¼Œå®ƒä¸å±äºè·¯å¾„æ“ä½œå‡½æ•°ã€‚</p>
</blockquote>
<p>å®ƒæ¥æ”¶çš„ç±»å‹ä¸ä½ å°†ä¸º Pydantic æ¨¡å‹å±æ€§æ‰€å£°æ˜çš„ç±»å‹ç›¸åŒï¼Œå› æ­¤å®ƒå¯ä»¥æ˜¯ä¸€ä¸ª Pydantic æ¨¡å‹ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç”± Pydantic æ¨¡å‹ç»„æˆçš„ <code>list</code>ï¼Œä¾‹å¦‚ <code>List[Item]</code>ã€‚</p>
<p>FastAPI å°†ä½¿ç”¨æ­¤ <code>response_model</code> æ¥ï¼š</p>
<ul>
<li>å°†è¾“å‡ºæ•°æ®è½¬æ¢ä¸ºå…¶å£°æ˜çš„ç±»å‹ã€‚</li>
<li>æ ¡éªŒæ•°æ®ã€‚</li>
<li>åœ¨ OpenAPI çš„è·¯å¾„æ“ä½œä¸­ä¸ºå“åº”æ·»åŠ ä¸€ä¸ª JSON Schemaã€‚</li>
<li>å¹¶åœ¨è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ç³»ç»Ÿä¸­ä½¿ç”¨ã€‚</li>
</ul>
<p>ä½†æœ€é‡è¦çš„æ˜¯ï¼š<strong>ä¼šå°†è¾“å‡ºæ•°æ®é™åˆ¶åœ¨è¯¥æ¨¡å‹å®šä¹‰å†…ã€‚</strong><br><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/fac946796552d5a4ff8b998086e2467518f19d25038a5844a3b265c92b524209.png" alt="å›¾ 23">  </p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/936be851eb89614ba25c0ad2c121798e39f418f74b506bde3c6f25d028330bf6.png" alt="å›¾ 24">  </p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/5d9b5b4fa6de0674375bb64b2f2b9346e32f2a2756f01c21ee66e1ddacb9baed.png" alt="å›¾ 25">  </p>
<h3 id="è¿”å›ä¸è¾“å…¥ç›¸åŒ"><a href="#è¿”å›ä¸è¾“å…¥ç›¸åŒ" class="headerlink" title="è¿”å›ä¸è¾“å…¥ç›¸åŒ"></a>è¿”å›ä¸è¾“å…¥ç›¸åŒ</h3><p>ç°åœ¨æˆ‘ä»¬å£°æ˜ä¸€ä¸ª UserIn æ¨¡å‹ï¼Œå®ƒå°†åŒ…å«ä¸€ä¸ªæ˜æ–‡å¯†ç å±æ€§ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Union</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, EmailStr</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserIn</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    password: <span class="built_in">str</span></span><br><span class="line">    email: EmailStr</span><br><span class="line">    full_name: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Don&#x27;t do this in production!</span></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/user/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_user</span>(<span class="params">user: UserIn</span>) -&gt; UserIn:</span><br><span class="line">    <span class="keyword">return</span> user</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨æ­¤æ¨¡å‹å£°æ˜è¾“å…¥æ•°æ®ï¼Œå¹¶ä½¿ç”¨åŒä¸€æ¨¡å‹å£°æ˜è¾“å‡ºæ•°æ®ï¼š<br>ç°åœ¨ï¼Œæ¯å½“æµè§ˆå™¨ä½¿ç”¨ä¸€ä¸ªå¯†ç åˆ›å»ºç”¨æˆ·æ—¶ï¼ŒAPI éƒ½ä¼šåœ¨å“åº”ä¸­è¿”å›ç›¸åŒçš„å¯†ç ã€‚</p>
<p>åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œè¿™å¯èƒ½ä¸ç®—æ˜¯é—®é¢˜ï¼Œå› ä¸ºç”¨æˆ·è‡ªå·±æ­£åœ¨å‘é€å¯†ç ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å…¶ä»–çš„è·¯å¾„æ“ä½œä¸­ä½¿ç”¨ç›¸åŒçš„æ¨¡å‹ï¼Œåˆ™å¯èƒ½ä¼šå°†ç”¨æˆ·çš„å¯†ç å‘é€ç»™æ¯ä¸ªå®¢æˆ·ç«¯ã€‚</p>
<p>ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæœ‰æ˜æ–‡å¯†ç çš„è¾“å…¥æ¨¡å‹å’Œä¸€ä¸ªæ²¡æœ‰æ˜æ–‡å¯†ç çš„è¾“å‡ºæ¨¡å‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, EmailStr</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserIn</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    password: <span class="built_in">str</span></span><br><span class="line">    email: EmailStr</span><br><span class="line">    full_name: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserOut</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    email: EmailStr</span><br><span class="line">    full_name: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/user/&quot;</span>, response_model=UserOut</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_user</span>(<span class="params">user: UserIn</span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">    <span class="keyword">return</span> user</span><br></pre></td></tr></table></figure>

<p>å°† <code>response_model</code> å£°æ˜ä¸ºäº†ä¸åŒ…å«å¯†ç çš„ <code>UserOut</code> æ¨¡å‹, å› æ­¤ FastAPI å°†ä¼šè´Ÿè´£è¿‡æ»¤æ‰æœªåœ¨è¾“å‡ºæ¨¡å‹ä¸­å£°æ˜çš„æ‰€æœ‰æ•°æ®ï¼ˆä½¿ç”¨ Pydanticï¼‰ã€‚</p>
<h3 id="å“åº”æ¨¡å‹é»˜è®¤å€¼"><a href="#å“åº”æ¨¡å‹é»˜è®¤å€¼" class="headerlink" title="å“åº”æ¨¡å‹é»˜è®¤å€¼"></a>å“åº”æ¨¡å‹é»˜è®¤å€¼</h3><p>å¯ä»¥ä¸ºä½ çš„å“åº”æ¨¡å‹è®¾ç½®é»˜è®¤å€¼ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Union</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> = <span class="number">10.5</span></span><br><span class="line">    tags: <span class="type">List</span>[<span class="built_in">str</span>] = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">items = &#123;</span><br><span class="line">    <span class="string">&quot;foo&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Foo&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">50.2</span>&#125;,</span><br><span class="line">    <span class="string">&quot;bar&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Bar&quot;</span>, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;The bartenders&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">62</span>, <span class="string">&quot;tax&quot;</span>: <span class="number">20.2</span>&#125;,</span><br><span class="line">    <span class="string">&quot;baz&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Baz&quot;</span>, <span class="string">&quot;description&quot;</span>: <span class="literal">None</span>, <span class="string">&quot;price&quot;</span>: <span class="number">50.2</span>, <span class="string">&quot;tax&quot;</span>: <span class="number">10.5</span>, <span class="string">&quot;tags&quot;</span>: []&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span>, response_model=Item, response_model_exclude_unset=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> items[item_id]</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/31d4979633c5ee19c32831b2979f28380b428188b81f7061c6bf633620dcaa38.png" alt="å›¾ 26">  </p>
<p>ä½†å¦‚æœå“åº”æ¨¡å‹å¹¶æ²¡æœ‰å­˜å‚¨å®é™…çš„å€¼ï¼Œä½ å¯èƒ½æƒ³ä»ç»“æœä¸­å¿½ç•¥å®ƒä»¬çš„é»˜è®¤å€¼ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå½“ä½ åœ¨ NoSQL æ•°æ®åº“ä¸­ä¿å­˜äº†å…·æœ‰è®¸å¤šå¯é€‰å±æ€§çš„æ¨¡å‹ï¼Œä½†ä½ åˆä¸æƒ³å‘é€å……æ»¡é»˜è®¤å€¼çš„å¾ˆé•¿çš„ JSON å“åº”ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ <code>response_model_exclude_unset</code> å‚æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span>, response_model=Item, response_model_exclude_unset=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> items[item_id]</span><br></pre></td></tr></table></figure>

<p>ç„¶åå“åº”ä¸­å°†ä¸ä¼šåŒ…å«é‚£äº›é»˜è®¤å€¼ï¼Œè€Œæ˜¯ä»…æœ‰å®é™…è®¾ç½®çš„å€¼ã€‚</p>
<p>å› æ­¤ï¼Œå¦‚æœä½ å‘è·¯å¾„æ“ä½œå‘é€ ID ä¸º foo çš„å•†å“çš„è¯·æ±‚ï¼Œåˆ™å“åº”ï¼ˆä¸åŒ…æ‹¬é»˜è®¤å€¼ï¼‰å°†ä¸ºï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Foo&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">50.2</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="æ’é™¤å±æ€§"><a href="#æ’é™¤å±æ€§" class="headerlink" title="æ’é™¤å±æ€§"></a>æ’é™¤å±æ€§</h3><p>å¦‚æœä½ åªæœ‰ä¸€ä¸ª Pydantic æ¨¡å‹ï¼Œå¹¶ä¸”æƒ³è¦ä»è¾“å‡ºä¸­ç§»é™¤ä¸€äº›æ•°æ®ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è¿™ç§å¿«æ·æ–¹æ³•ã€‚</p>
<blockquote>
<p>ä½†æ˜¯ä¾ç„¶å»ºè®®ä½ ä½¿ç”¨ä¸Šé¢æåˆ°çš„ä¸»æ„ï¼Œä½¿ç”¨å¤šä¸ªç±»è€Œä¸æ˜¯è¿™äº›å‚æ•°ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºå³ä½¿ä½¿ç”¨ response_model_include æˆ– response_model_exclude æ¥çœç•¥æŸäº›å±æ€§ï¼Œåœ¨åº”ç”¨ç¨‹åºçš„ OpenAPI å®šä¹‰ï¼ˆå’Œæ–‡æ¡£ï¼‰ä¸­ç”Ÿæˆçš„ JSON Schema ä»å°†æ˜¯å®Œæ•´çš„æ¨¡å‹ã€‚</p>
<p>è¿™ä¹Ÿé€‚ç”¨äºä½œç”¨ç±»ä¼¼çš„ response_model_by_aliasã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Union</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> = <span class="number">10.5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">items = &#123;</span><br><span class="line">    <span class="string">&quot;foo&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Foo&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">50.2</span>&#125;,</span><br><span class="line">    <span class="string">&quot;bar&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Bar&quot;</span>, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;The Bar fighters&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">62</span>, <span class="string">&quot;tax&quot;</span>: <span class="number">20.2</span>&#125;,</span><br><span class="line">    <span class="string">&quot;baz&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Baz&quot;</span>,</span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;There goes my baz&quot;</span>,</span><br><span class="line">        <span class="string">&quot;price&quot;</span>: <span class="number">50.2</span>,</span><br><span class="line">        <span class="string">&quot;tax&quot;</span>: <span class="number">10.5</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    <span class="string">&quot;/items/&#123;item_id&#125;/name&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    response_model=Item,</span></span></span><br><span class="line"><span class="params"><span class="meta">    response_model_include=&#123;<span class="string">&quot;name&quot;</span>, <span class="string">&quot;description&quot;</span>&#125;,</span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item_name</span>(<span class="params">item_id: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> items[item_id]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;/public&quot;</span>, response_model=Item, response_model_exclude=&#123;<span class="string">&quot;tax&quot;</span>&#125;</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item_public_data</span>(<span class="params">item_id: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> items[item_id]</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/0faf8ad4e0d2fe8fe2d3eaa87119826d7914f1d30a43d22bc193378d602895a7.png" alt="å›¾ 27">  </p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/4a510fb8b5527c21eeb024478d4c3ed5f87452c1508e5948092707f7c716c05b.png" alt="å›¾ 28">  </p>
<h2 id="æ›´å¤šæ¨¡å‹"><a href="#æ›´å¤šæ¨¡å‹" class="headerlink" title="æ›´å¤šæ¨¡å‹"></a>æ›´å¤šæ¨¡å‹</h2><p>å¤šä¸ªå…³è”æ¨¡å‹è¿™ç§æƒ…å†µå¾ˆå¸¸è§ã€‚</p>
<p>ç‰¹åˆ«æ˜¯ç”¨æˆ·æ¨¡å‹ï¼Œå› ä¸ºï¼š</p>
<ul>
<li>è¾“å…¥æ¨¡å‹åº”è¯¥å«å¯†ç </li>
<li>è¾“å‡ºæ¨¡å‹ä¸åº”å«å¯†ç </li>
<li>æ•°æ®åº“æ¨¡å‹éœ€è¦åŠ å¯†çš„å¯†ç </li>
</ul>
<p>ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†ä¸åŒæ¨¡å‹å¤„ç†å¯†ç å­—æ®µçš„æ–¹å¼ï¼ŒåŠä½¿ç”¨ä½ç½®çš„å¤§è‡´æ€è·¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, EmailStr</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserIn</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    password: <span class="built_in">str</span></span><br><span class="line">    email: EmailStr</span><br><span class="line">    full_name: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserOut</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    email: EmailStr</span><br><span class="line">    full_name: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInDB</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    hashed_password: <span class="built_in">str</span></span><br><span class="line">    email: EmailStr</span><br><span class="line">    full_name: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fake_password_hasher</span>(<span class="params">raw_password: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;supersecret&quot;</span> + raw_password</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fake_save_user</span>(<span class="params">user_in: UserIn</span>):</span><br><span class="line">    hashed_password = fake_password_hasher(user_in.password)</span><br><span class="line">    user_in_db = UserInDB(**user_in.model_dump(), hashed_password=hashed_password)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;User saved! ..not really&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> user_in_db</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/user/&quot;</span>, response_model=UserOut</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_user</span>(<span class="params">user_in: UserIn</span>):</span><br><span class="line">    user_saved = fake_save_user(user_in)</span><br><span class="line">    <span class="keyword">return</span> user_saved</span><br></pre></td></tr></table></figure>

<h3 id="è¿”å›å¤šä¸ªæ¨¡å‹"><a href="#è¿”å›å¤šä¸ªæ¨¡å‹" class="headerlink" title="è¿”å›å¤šä¸ªæ¨¡å‹"></a>è¿”å›å¤šä¸ªæ¨¡å‹</h3><p>å“åº”å¯ä»¥å£°æ˜ä¸ºä¸¤ç§ç±»å‹çš„ <code>Union</code> ç±»å‹ï¼Œå³è¯¥å“åº”å¯ä»¥æ˜¯ä¸¤ç§ç±»å‹ä¸­çš„ä»»æ„ç±»å‹ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaseItem</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    description: <span class="built_in">str</span></span><br><span class="line">    <span class="built_in">type</span>: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CarItem</span>(<span class="title class_ inherited__">BaseItem</span>):</span><br><span class="line">    <span class="built_in">type</span>: <span class="built_in">str</span> = <span class="string">&quot;car&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PlaneItem</span>(<span class="title class_ inherited__">BaseItem</span>):</span><br><span class="line">    <span class="built_in">type</span>: <span class="built_in">str</span> = <span class="string">&quot;plane&quot;</span></span><br><span class="line">    size: <span class="built_in">int</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">items = &#123;</span><br><span class="line">    <span class="string">&quot;item1&quot;</span>: &#123;<span class="string">&quot;description&quot;</span>: <span class="string">&quot;All my friends drive a low rider&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;car&quot;</span>&#125;,</span><br><span class="line">    <span class="string">&quot;item2&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Music is my aeroplane, it&#x27;s my aeroplane&quot;</span>,</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;plane&quot;</span>,</span><br><span class="line">        <span class="string">&quot;size&quot;</span>: <span class="number">5</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span>, response_model=PlaneItem | CarItem</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> items[item_id]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å®šä¹‰ Union ç±»å‹æ—¶ï¼Œè¦æŠŠè¯¦ç»†çš„ç±»å‹å†™åœ¨å‰é¢ï¼Œç„¶åæ˜¯ä¸å¤ªè¯¦ç»†çš„ç±»å‹ã€‚ä¾‹ä¸­ï¼Œæ›´è¯¦ç»†çš„ PlaneItem ä½äº Union[PlaneItemï¼ŒCarItem] ä¸­çš„ CarItem ä¹‹å‰ã€‚</p>
</blockquote>
<p>æ­¤æ—¶å‚æ•° <code>item1</code> åŒ¹é…è¿”å›çš„æ˜¯ç±»å‹ <code>CarItem</code>ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/92a4becfb84b962ea77df33243ba4f62fb17578a8922847703596eb81efb390f.png" alt="å›¾ 29">  </p>
<p>å‚æ•° <code>item2</code> åŒ¹é…è¿”å›çš„æ˜¯ç±»å‹ <code>PlaneItem</code>ï¼š<br><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/e209f6d427a6ffaff0daebb38a75c98f07149c51b0f5a906d9d18c106298b403.png" alt="å›¾ 30">  </p>
<h3 id="ä»»æ„-dict-æ„æˆå“åº”"><a href="#ä»»æ„-dict-æ„æˆå“åº”" class="headerlink" title="ä»»æ„ dict æ„æˆå“åº”"></a>ä»»æ„ dict æ„æˆå“åº”</h3><p>ä»»æ„çš„ <code>dict</code> éƒ½èƒ½ç”¨äºå£°æ˜å“åº”ï¼Œåªè¦å£°æ˜é”®å’Œå€¼çš„ç±»å‹ï¼Œæ— éœ€ä½¿ç”¨ Pydantic æ¨¡å‹ã€‚</p>
<p>äº‹å…ˆä¸çŸ¥é“å¯ç”¨çš„å­—æ®µ &#x2F; å±æ€§åæ—¶ï¼ˆPydantic æ¨¡å‹å¿…é¡»çŸ¥é“å­—æ®µæ˜¯ä»€ä¹ˆï¼‰ï¼Œè¿™ç§æ–¹å¼ç‰¹åˆ«æœ‰ç”¨ã€‚</p>
<p>æ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>typing.Dict</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/keyword-weights/&quot;</span>, response_model=<span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="built_in">float</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_keyword_weights</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;foo&quot;</span>: <span class="string">&quot;2.3&quot;</span>, <span class="string">&quot;bar&quot;</span>: <span class="number">3.4</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/keyword-weights2/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_keyword_weights</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;foo&quot;</span>: <span class="string">&quot;2.3&quot;</span>, <span class="string">&quot;bar&quot;</span>: <span class="number">3.4</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/13b933c24645c09ac95df8668339959c7261ea5ef7c96083e8284fccce6f857b.png" alt="å›¾ 31"></p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/4c5ecc039b2260419e96f6ff544554632ba2e2a009a6add5b906f74caa974be9.png" alt="å›¾ 32">  </p>
<h2 id="å“åº”çŠ¶æ€ç "><a href="#å“åº”çŠ¶æ€ç " class="headerlink" title="å“åº”çŠ¶æ€ç "></a>å“åº”çŠ¶æ€ç </h2><p>ä¸æŒ‡å®šå“åº”æ¨¡å‹çš„æ–¹å¼ç›¸åŒï¼Œåœ¨ä»¥ä¸‹ä»»æ„è·¯å¾„æ“ä½œä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>status_code</code> å‚æ•°å£°æ˜ç”¨äºå“åº”çš„ HTTP çŠ¶æ€ç ï¼š</p>
<ul>
<li>@app.get()</li>
<li>@app.post()</li>
<li>@app.put()</li>
<li>@app.delete()</li>
<li>ç­‰â€¦â€¦</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, status</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/items/&quot;</span>, status_code=<span class="number">201</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">name: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;name&quot;</span>: name&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/items2/&quot;</span>, status_code=status.HTTP_200_OK</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item2</span>(<span class="params">name: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;name&quot;</span>: name&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„ï¼Œstatus_code æ˜¯ï¼ˆgetã€post ç­‰ï¼‰è£…é¥°å™¨æ–¹æ³•ä¸­çš„å‚æ•°ã€‚ä¸ä¹‹å‰çš„å‚æ•°å’Œè¯·æ±‚ä½“ä¸åŒï¼Œä¸æ˜¯è·¯å¾„æ“ä½œå‡½æ•°çš„å‚æ•°ã€‚</p>
</blockquote>
<p><code>status_code</code> å‚æ•°æ¥æ”¶è¡¨ç¤º HTTP çŠ¶æ€ç çš„æ•°å­—ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/cc899cd38b0fa89de517506d1cb3982ce33bb66b20fff42f8e64a4b341573d8b.png" alt="å›¾ 33">  </p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/0364f7337b76831030a0c4d59191b4bf4c5e42cc1ea9953945d1015fa718b10b.png" alt="å›¾ 34">  </p>
<h3 id="æ›´æ”¹çŠ¶æ€ç "><a href="#æ›´æ”¹çŠ¶æ€ç " class="headerlink" title="æ›´æ”¹çŠ¶æ€ç "></a>æ›´æ”¹çŠ¶æ€ç </h3><p>ä¾‹å¦‚ï¼Œå‡è®¾ä½ æƒ³é»˜è®¤è¿”å›ä¸€ä¸ªHTTPçŠ¶æ€ç ä¸ºâ€œOKâ€<code>200</code>ã€‚</p>
<p>ä½†å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œä½ æƒ³åˆ›å»ºå®ƒï¼Œå¹¶è¿”å›ä¸€ä¸ªHTTPçŠ¶æ€ç ä¸ºâ€œCREATEDâ€<code>201</code>ã€‚</p>
<p>ä½†ä½ ä»ç„¶å¸Œæœ›èƒ½å¤Ÿä½¿ç”¨ <code>response_model</code> è¿‡æ»¤å’Œè½¬æ¢ä½ è¿”å›çš„æ•°æ®ã€‚</p>
<p>å¯¹äºè¿™äº›æƒ…å†µï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ª <code>Response</code> å‚æ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Response, status</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    tags: <span class="built_in">list</span>[<span class="built_in">str</span>] = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span>, response_model=Item</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>() -&gt; <span class="type">Any</span>:</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Portal Gun&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">42.0</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items2/&quot;</span>, response_model=Item</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items2</span>(<span class="params">response: Response</span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">    response.status_code = status.HTTP_201_CREATED</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Portal Gun&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">42.0</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p>ç„¶åä½ å¯ä»¥åƒå¹³å¸¸ä¸€æ ·è¿”å›ä»»ä½•ä½ éœ€è¦çš„å¯¹è±¡ï¼ˆä¾‹å¦‚ä¸€ä¸ªdictæˆ–è€…ä¸€ä¸ªæ•°æ®åº“æ¨¡å‹ï¼‰ã€‚å¦‚æœä½ å£°æ˜äº†ä¸€ä¸ª <code>response_model</code>ï¼Œå®ƒä»ç„¶ä¼šè¢«ç”¨æ¥è¿‡æ»¤å’Œè½¬æ¢ä½ è¿”å›çš„å¯¹è±¡ã€‚</p>
<p>FastAPIå°†ä½¿ç”¨è¿™ä¸ªä¸´æ—¶å“åº”æ¥æå–çŠ¶æ€ç ï¼ˆä¹ŸåŒ…æ‹¬cookieså’Œå¤´éƒ¨ï¼‰ï¼Œå¹¶å°†å®ƒä»¬æ”¾å…¥åŒ…å«ä½ è¿”å›çš„å€¼çš„æœ€ç»ˆå“åº”ä¸­ï¼Œè¯¥å“åº”ç”±ä»»ä½• <code>response_model</code> è¿‡æ»¤ã€‚</p>
<p>ä½ ä¹Ÿå¯ä»¥åœ¨ä¾èµ–é¡¹ä¸­å£°æ˜Responseå‚æ•°ï¼Œå¹¶åœ¨å…¶ä¸­è®¾ç½®çŠ¶æ€ç ã€‚ä½†è¯·æ³¨æ„ï¼Œæœ€åè®¾ç½®çš„çŠ¶æ€ç å°†ä¼šç”Ÿæ•ˆã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/b9653d8b7d57424e704991465ccf63c0c706496903a14bfd7611ef62189521b7.png" alt="å›¾ 37">  </p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/8ba8504a9546f4d52042b104d74d8fbd5b1ca3a7aa019fe40cd14c4da061bac3.png" alt="å›¾ 38">  </p>
<h2 id="è¡¨å•æ•°æ®"><a href="#è¡¨å•æ•°æ®" class="headerlink" title="è¡¨å•æ•°æ®"></a>è¡¨å•æ•°æ®</h2><p>æ¥æ”¶çš„æ•°æ®ä¸æ˜¯ JSONï¼Œè€Œæ˜¯è¡¨å•å­—æ®µæ—¶ï¼Œè¦ä½¿ç”¨ Formã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Form</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginData</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    password: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/login/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">username: <span class="built_in">str</span> = Form(<span class="params">...</span>), password: <span class="built_in">str</span> = Form(<span class="params">...</span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Login successful&quot;</span>, <span class="string">&quot;username&quot;</span>: username&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app)</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºè¡¨å•ï¼ˆFormï¼‰å‚æ•°çš„æ–¹å¼ä¸ Body å’Œ Query ä¸€æ ·ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">username: <span class="built_in">str</span> = Form(<span class="params">...</span>), password: <span class="built_in">str</span> = Form(<span class="params">...</span>)</span>):</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>Form</code> å¯ä»¥å£°æ˜ä¸ <code>Body</code> ï¼ˆåŠ <code>Query</code>ã€<code>Path</code>ã€<code>Cookie</code>ï¼‰ç›¸åŒçš„å…ƒæ•°æ®å’ŒéªŒè¯ã€‚</p>
<p>ä¸ JSON ä¸åŒï¼ŒHTML è¡¨å•ï¼ˆ<code>&lt;form&gt;&lt;/form&gt;</code>ï¼‰å‘æœåŠ¡å™¨å‘é€æ•°æ®é€šå¸¸ä½¿ç”¨ã€Œç‰¹æ®Šã€çš„ç¼–ç ã€‚</p>
<p>FastAPI è¦ç¡®ä¿ä»æ­£ç¡®çš„ä½ç½®è¯»å–æ•°æ®ï¼Œè€Œä¸æ˜¯è¯»å– JSONã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/f7e637b28e10b6e4e84f57f1f43ca5f39e9cce68654684338087b2f64c047314.png" alt="å›¾ 39">  </p>
<h2 id="è¡¨å•æ¨¡å‹"><a href="#è¡¨å•æ¨¡å‹" class="headerlink" title="è¡¨å•æ¨¡å‹"></a>è¡¨å•æ¨¡å‹</h2><p>ä½ å¯ä»¥ä½¿ç”¨ Pydantic æ¨¡å‹åœ¨ FastAPI ä¸­å£°æ˜<strong>è¡¨å•å­—æ®µ</strong>ã€‚</p>
<p>åªéœ€å£°æ˜ä¸€ä¸ª Pydantic æ¨¡å‹ï¼Œå…¶ä¸­åŒ…å«æ‚¨å¸Œæœ›æ¥æ”¶çš„è¡¨å•å­—æ®µï¼Œç„¶åå°†å‚æ•°å£°æ˜ä¸º <code>Form</code> :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Form</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FormData</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    password: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/login/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">loginForm: Annotated[FormData, Form(<span class="params"></span>)]</span>):</span><br><span class="line">    <span class="keyword">return</span> loginForm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/d760e24cceda46a008c90374db81e50d2dc97df8a3639ef6a6cefd0a36d866d2.png" alt="å›¾ 40">  </p>
<h3 id="ç¦æ­¢é¢å¤–çš„è¡¨å•å­—æ®µ"><a href="#ç¦æ­¢é¢å¤–çš„è¡¨å•å­—æ®µ" class="headerlink" title="ç¦æ­¢é¢å¤–çš„è¡¨å•å­—æ®µ"></a>ç¦æ­¢é¢å¤–çš„è¡¨å•å­—æ®µ</h3><p>åœ¨æŸäº›ç‰¹æ®Šä½¿ç”¨æƒ…å†µä¸‹ï¼ˆå¯èƒ½å¹¶ä¸å¸¸è§ï¼‰ï¼Œä½ å¯èƒ½å¸Œæœ›å°†è¡¨å•å­—æ®µé™åˆ¶ä¸ºä»…åœ¨ Pydantic æ¨¡å‹ä¸­å£°æ˜è¿‡çš„å­—æ®µï¼Œå¹¶ç¦æ­¢ä»»ä½•é¢å¤–çš„å­—æ®µã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ Pydantic çš„æ¨¡å‹é…ç½®æ¥ç¦æ­¢ï¼ˆ <code>forbid</code> ï¼‰ä»»ä½•é¢å¤–ï¼ˆ <code>extra</code> ï¼‰å­—æ®µï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Form</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FormData</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    password: <span class="built_in">str</span></span><br><span class="line">    model_config = &#123;<span class="string">&quot;extra&quot;</span>: <span class="string">&quot;forbid&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/login/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">data: Annotated[FormData, Form(<span class="params"></span>)]</span>):</span><br><span class="line">    <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå®¢æˆ·ç«¯å°è¯•å‘é€ä¸€äº›é¢å¤–çš„æ•°æ®ï¼Œä»–ä»¬å°†æ”¶åˆ°é”™è¯¯å“åº”ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœå®¢æˆ·ç«¯å°è¯•å‘é€è¿™æ ·çš„è¡¨å•å­—æ®µï¼š</p>
<ul>
<li>username: Rick</li>
<li>password: Portal Gun</li>
<li>extra: Mr. Poopybutthole</li>
</ul>
<p>ä»–ä»¬å°†æ”¶åˆ°ä¸€æ¡é”™è¯¯å“åº”ï¼Œè¡¨æ˜å­—æ®µ <code>extra</code> æ˜¯ä¸è¢«å…è®¸çš„ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;extra_forbidden&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;loc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;body&quot;</span><span class="punctuation">,</span> <span class="string">&quot;extra&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Extra inputs are not permitted&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Mr. Poopybutthole&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="è¯·æ±‚æ–‡ä»¶"><a href="#è¯·æ±‚æ–‡ä»¶" class="headerlink" title="è¯·æ±‚æ–‡ä»¶"></a>è¯·æ±‚æ–‡ä»¶</h2><p><code>File</code> ç”¨äºå®šä¹‰å®¢æˆ·ç«¯çš„ä¸Šä¼ æ–‡ä»¶ã€‚</p>
<p>åˆ›å»ºæ–‡ä»¶ï¼ˆ<code>File</code>ï¼‰å‚æ•°çš„æ–¹å¼ä¸ <code>Body</code> å’Œ <code>Form</code> ä¸€æ ·ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, File, UploadFile</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/files/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_file</span>(<span class="params">file: <span class="built_in">bytes</span> = File(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;file_size&quot;</span>: <span class="built_in">len</span>(file)&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/uploadfile/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_upload_file</span>(<span class="params">file: UploadFile</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;filename&quot;</span>: file.filename&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å£°æ˜æ–‡ä»¶ä½“å¿…é¡»ä½¿ç”¨ Fileï¼Œå¦åˆ™ï¼ŒFastAPI ä¼šæŠŠè¯¥å‚æ•°å½“ä½œæŸ¥è¯¢å‚æ•°æˆ–è¯·æ±‚ä½“ï¼ˆJSONï¼‰å‚æ•°ã€‚</p>
</blockquote>
<p>æ–‡ä»¶ä½œä¸ºã€Œè¡¨å•æ•°æ®ã€ä¸Šä¼ ã€‚</p>
<p>å¦‚æœæŠŠè·¯å¾„æ“ä½œå‡½æ•°å‚æ•°çš„ç±»å‹å£°æ˜ä¸º <code>bytes</code>ï¼ŒFastAPI å°†ä»¥ <code>bytes</code> å½¢å¼è¯»å–å’Œæ¥æ”¶æ–‡ä»¶å†…å®¹ã€‚</p>
<p>è¿™ç§æ–¹å¼æŠŠæ–‡ä»¶çš„æ‰€æœ‰å†…å®¹éƒ½å­˜å‚¨åœ¨å†…å­˜é‡Œï¼Œé€‚ç”¨äºå°å‹æ–‡ä»¶ã€‚</p>
<p>ä¸è¿‡ï¼Œå¾ˆå¤šæƒ…å†µä¸‹ï¼Œ<code>UploadFile</code> æ›´å¥½ç”¨ã€‚</p>
<h3 id="UploadFile"><a href="#UploadFile" class="headerlink" title="UploadFile"></a>UploadFile</h3><p>å®šä¹‰æ–‡ä»¶å‚æ•°æ—¶ä½¿ç”¨ <code>UploadFile</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, File, UploadFile</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/files/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_file</span>(<span class="params">file: <span class="built_in">bytes</span> = File(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;file_size&quot;</span>: <span class="built_in">len</span>(file)&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/uploadfile/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_upload_file</span>(<span class="params">file: UploadFile</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;filename&quot;</span>: file.filename&#125;</span><br></pre></td></tr></table></figure>

<p><code>UploadFile</code> ä¸ <code>bytes</code> ç›¸æ¯”æœ‰æ›´å¤šä¼˜åŠ¿ï¼š</p>
<ul>
<li>ä½¿ç”¨ spooled æ–‡ä»¶ï¼š<br>å­˜å‚¨åœ¨å†…å­˜çš„æ–‡ä»¶è¶…å‡ºæœ€å¤§ä¸Šé™æ—¶ï¼ŒFastAPI ä¼šæŠŠæ–‡ä»¶å­˜å…¥ç£ç›˜ï¼›</li>
<li>è¿™ç§æ–¹å¼æ›´é€‚äºå¤„ç†å›¾åƒã€è§†é¢‘ã€äºŒè¿›åˆ¶æ–‡ä»¶ç­‰å¤§å‹æ–‡ä»¶ï¼Œå¥½å¤„æ˜¯ä¸ä¼šå ç”¨æ‰€æœ‰å†…å­˜ï¼›</li>
<li>å¯è·å–ä¸Šä¼ æ–‡ä»¶çš„å…ƒæ•°æ®ï¼›</li>
<li>è‡ªå¸¦ file-like async æ¥å£ï¼›</li>
<li>æš´éœ²çš„ Python SpooledTemporaryFile å¯¹è±¡ï¼Œå¯ç›´æ¥ä¼ é€’ç»™å…¶ä»–é¢„æœŸã€Œfile-likeã€å¯¹è±¡çš„åº“ã€‚</li>
</ul>
<p><code>UploadFile</code> çš„å±æ€§å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>filename</code>ï¼šä¸Šä¼ æ–‡ä»¶åå­—ç¬¦ä¸²ï¼ˆ<code>str</code>ï¼‰ï¼Œä¾‹å¦‚ï¼Œ <code>myimage.jpg</code>ï¼›</li>
<li><code>content_type</code>ï¼šå†…å®¹ç±»å‹ï¼ˆMIME ç±»å‹ &#x2F; åª’ä½“ç±»å‹ï¼‰å­—ç¬¦ä¸²ï¼ˆ<code>str</code>ï¼‰ï¼Œä¾‹å¦‚ï¼Œ<code>image/jpeg</code>ï¼›</li>
<li><code>file</code>ï¼š SpooledTemporaryFileï¼ˆ file-like å¯¹è±¡ï¼‰ã€‚å…¶å®å°±æ˜¯ Pythonæ–‡ä»¶ï¼Œå¯ç›´æ¥ä¼ é€’ç»™å…¶ä»–é¢„æœŸ <code>file-like</code> å¯¹è±¡çš„å‡½æ•°æˆ–æ”¯æŒåº“ã€‚</li>
</ul>
<p><code>UploadFile</code> æ”¯æŒä»¥ä¸‹ <code>async</code> æ–¹æ³•ï¼Œï¼ˆä½¿ç”¨å†…éƒ¨ <code>SpooledTemporaryFile</code>ï¼‰å¯è°ƒç”¨ç›¸åº”çš„æ–‡ä»¶æ–¹æ³•ã€‚</p>
<ul>
<li><code>write(data)</code>ï¼šæŠŠ <code>data</code> ï¼ˆ<code>str</code> æˆ– <code>bytes</code>ï¼‰å†™å…¥æ–‡ä»¶ï¼›</li>
<li><code>read(size)</code>ï¼šæŒ‰æŒ‡å®šæ•°é‡çš„å­—èŠ‚æˆ–å­—ç¬¦ï¼ˆ<code>size (int)</code>ï¼‰è¯»å–æ–‡ä»¶å†…å®¹ï¼›</li>
<li><code>seek(offset)</code>ï¼šç§»åŠ¨è‡³æ–‡ä»¶ <code>offset</code> ï¼ˆ<code>int</code>ï¼‰å­—èŠ‚å¤„çš„ä½ç½®ï¼›<br>ä¾‹å¦‚ï¼Œ<code>await myfile.seek(0)</code> ç§»åŠ¨åˆ°æ–‡ä»¶å¼€å¤´ï¼›<br>æ‰§è¡Œ <code>await myfile.read()</code> åï¼Œéœ€å†æ¬¡è¯»å–å·²è¯»å–å†…å®¹æ—¶ï¼Œè¿™ç§æ–¹æ³•ç‰¹åˆ«å¥½ç”¨ï¼›</li>
<li><code>close()</code>ï¼šå…³é—­æ–‡ä»¶ã€‚</li>
</ul>
<p>å› ä¸ºä¸Šè¿°æ–¹æ³•éƒ½æ˜¯ <code>async</code> æ–¹æ³•ï¼Œè¦æ­é…ã€Œawaitã€ä½¿ç”¨ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨ <code>async</code> è·¯å¾„æ“ä½œå‡½æ•° å†…ï¼Œè¦ç”¨ä»¥ä¸‹æ–¹å¼è¯»å–æ–‡ä»¶å†…å®¹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contents = <span class="keyword">await</span> myfile.read()</span><br></pre></td></tr></table></figure>

<p>åœ¨æ™®é€š <code>def</code> è·¯å¾„æ“ä½œå‡½æ•° å†…ï¼Œåˆ™å¯ä»¥ç›´æ¥è®¿é—® <code>UploadFile.file</code>ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contents = myfile.file.read()</span><br></pre></td></tr></table></figure>

<h3 id="å¯é€‰æ–‡ä»¶ä¸Šä¼ "><a href="#å¯é€‰æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="å¯é€‰æ–‡ä»¶ä¸Šä¼ "></a>å¯é€‰æ–‡ä»¶ä¸Šä¼ </h3><p>å¯ä»¥é€šè¿‡ä½¿ç”¨æ ‡å‡†ç±»å‹æ³¨è§£å¹¶å°† None ä½œä¸ºé»˜è®¤å€¼çš„æ–¹å¼å°†ä¸€ä¸ªæ–‡ä»¶å‚æ•°è®¾ä¸ºå¯é€‰:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, File, UploadFile</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/files/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_file</span>(<span class="params">file: Annotated[<span class="built_in">bytes</span> | <span class="literal">None</span>, File(<span class="params"></span>)] = <span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> file:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;No file sent&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;file_size&quot;</span>: <span class="built_in">len</span>(file)&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/uploadfile/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_upload_file</span>(<span class="params">file: UploadFile | <span class="literal">None</span> = <span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> file:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;No upload file sent&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;filename&quot;</span>: file.filename&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¸¦æœ‰é¢å¤–å…ƒæ•°æ®çš„-UploadFile"><a href="#å¸¦æœ‰é¢å¤–å…ƒæ•°æ®çš„-UploadFile" class="headerlink" title="å¸¦æœ‰é¢å¤–å…ƒæ•°æ®çš„ UploadFile"></a>å¸¦æœ‰é¢å¤–å…ƒæ•°æ®çš„ UploadFile</h3><p>ä¹Ÿå¯ä»¥å°† <code>File()</code> ä¸ <code>UploadFile</code> ä¸€èµ·ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼Œè®¾ç½®é¢å¤–çš„å…ƒæ•°æ®:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, File, UploadFile</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/files/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_file</span>(<span class="params">file: Annotated[<span class="built_in">bytes</span>, File(<span class="params">description=<span class="string">&quot;A file read as bytes&quot;</span></span>)]</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;file_size&quot;</span>: <span class="built_in">len</span>(file)&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/uploadfile/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_upload_file</span>(<span class="params"></span></span><br><span class="line"><span class="params">    file: Annotated[UploadFile, File(<span class="params">description=<span class="string">&quot;A file read as UploadFile&quot;</span></span>)],</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;filename&quot;</span>: file.filename&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¤šæ–‡ä»¶ä¸Šä¼ "><a href="#å¤šæ–‡ä»¶ä¸Šä¼ " class="headerlink" title="å¤šæ–‡ä»¶ä¸Šä¼ "></a>å¤šæ–‡ä»¶ä¸Šä¼ </h3><p>FastAPI æ”¯æŒåŒæ—¶ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ã€‚</p>
<p>å¯ç”¨åŒä¸€ä¸ªã€Œè¡¨å•å­—æ®µã€å‘é€å«å¤šä¸ªæ–‡ä»¶çš„ã€Œè¡¨å•æ•°æ®ã€ã€‚</p>
<p>ä¸Šä¼ å¤šä¸ªæ–‡ä»¶æ—¶ï¼Œè¦å£°æ˜å« <code>bytes</code> æˆ– <code>UploadFile</code> çš„åˆ—è¡¨ï¼ˆ<code>List</code>ï¼‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, File, UploadFile</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> HTMLResponse</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/files/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_files</span>(<span class="params">files: Annotated[<span class="built_in">list</span>[<span class="built_in">bytes</span>], File(<span class="params"></span>)]</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;file_sizes&quot;</span>: [<span class="built_in">len</span>(file) <span class="keyword">for</span> file <span class="keyword">in</span> files]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/uploadfiles/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_upload_files</span>(<span class="params">files: <span class="built_in">list</span>[UploadFile]</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;filenames&quot;</span>: [file.filename <span class="keyword">for</span> file <span class="keyword">in</span> files]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    content = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">&lt;form action=&quot;/files/&quot; enctype=&quot;multipart/form-data&quot; method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;files&quot; type=&quot;file&quot; multiple&gt;</span></span><br><span class="line"><span class="string">&lt;input type=&quot;submit&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;form action=&quot;/uploadfiles/&quot; enctype=&quot;multipart/form-data&quot; method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;files&quot; type=&quot;file&quot; multiple&gt;</span></span><br><span class="line"><span class="string">&lt;input type=&quot;submit&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> HTMLResponse(content=content)</span><br></pre></td></tr></table></figure>

<p>æ¥æ”¶çš„ä¹Ÿæ˜¯å« <code>bytes</code> æˆ– <code>UploadFile</code> çš„åˆ—è¡¨ï¼ˆ<code>list</code>ï¼‰ã€‚</p>
<h3 id="å¸¦æœ‰é¢å¤–å…ƒæ•°æ®çš„å¤šæ–‡ä»¶ä¸Šä¼ "><a href="#å¸¦æœ‰é¢å¤–å…ƒæ•°æ®çš„å¤šæ–‡ä»¶ä¸Šä¼ " class="headerlink" title="å¸¦æœ‰é¢å¤–å…ƒæ•°æ®çš„å¤šæ–‡ä»¶ä¸Šä¼ "></a>å¸¦æœ‰é¢å¤–å…ƒæ•°æ®çš„å¤šæ–‡ä»¶ä¸Šä¼ </h3><p>å’Œä¹‹å‰çš„æ–¹å¼ä¸€æ ·, å¯ä»¥ä¸º <code>File()</code> è®¾ç½®é¢å¤–å‚æ•°, å³ä½¿æ˜¯ <code>UploadFile</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, File, UploadFile</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> HTMLResponse</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/files/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_files</span>(<span class="params"></span></span><br><span class="line"><span class="params">    files: Annotated[<span class="built_in">list</span>[<span class="built_in">bytes</span>], File(<span class="params">description=<span class="string">&quot;Multiple files as bytes&quot;</span></span>)],</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;file_sizes&quot;</span>: [<span class="built_in">len</span>(file) <span class="keyword">for</span> file <span class="keyword">in</span> files]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/uploadfiles/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_upload_files</span>(<span class="params"></span></span><br><span class="line"><span class="params">    files: Annotated[</span></span><br><span class="line"><span class="params">        <span class="built_in">list</span>[UploadFile], File(<span class="params">description=<span class="string">&quot;Multiple files as UploadFile&quot;</span></span>)</span></span><br><span class="line"><span class="params">    ],</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;filenames&quot;</span>: [file.filename <span class="keyword">for</span> file <span class="keyword">in</span> files]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    content = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">&lt;form action=&quot;/files/&quot; enctype=&quot;multipart/form-data&quot; method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;files&quot; type=&quot;file&quot; multiple&gt;</span></span><br><span class="line"><span class="string">&lt;input type=&quot;submit&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;form action=&quot;/uploadfiles/&quot; enctype=&quot;multipart/form-data&quot; method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;files&quot; type=&quot;file&quot; multiple&gt;</span></span><br><span class="line"><span class="string">&lt;input type=&quot;submit&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> HTMLResponse(content=content)</span><br></pre></td></tr></table></figure>

<h2 id="è¯·æ±‚è¡¨å•ä¸æ–‡ä»¶"><a href="#è¯·æ±‚è¡¨å•ä¸æ–‡ä»¶" class="headerlink" title="è¯·æ±‚è¡¨å•ä¸æ–‡ä»¶"></a>è¯·æ±‚è¡¨å•ä¸æ–‡ä»¶</h2><p>FastAPI æ”¯æŒåŒæ—¶ä½¿ç”¨ <code>File</code> å’Œ <code>Form</code> å®šä¹‰æ–‡ä»¶å’Œè¡¨å•å­—æ®µã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, File, Form, UploadFile</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/files/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_file</span>(<span class="params"></span></span><br><span class="line"><span class="params">    file: <span class="built_in">bytes</span> = File(<span class="params"></span>), fileb: UploadFile = File(<span class="params"></span>), token: <span class="built_in">str</span> = Form(<span class="params"></span>)</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;file_size&quot;</span>: <span class="built_in">len</span>(file),</span><br><span class="line">        <span class="string">&quot;token&quot;</span>: token,</span><br><span class="line">        <span class="string">&quot;fileb_content_type&quot;</span>: fileb.content_type,</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/2802141baf5c82ce45946caf226704a87e145b83a4256b8a8012e386ad537e64.png" alt="å›¾ 41">  </p>
<h2 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h2><p>æŸäº›æƒ…å†µä¸‹ï¼Œéœ€è¦å‘å®¢æˆ·ç«¯è¿”å›é”™è¯¯æç¤ºã€‚</p>
<p>è¿™é‡Œæ‰€è°“çš„å®¢æˆ·ç«¯åŒ…æ‹¬å‰ç«¯æµè§ˆå™¨ã€å…¶ä»–åº”ç”¨ç¨‹åºã€ç‰©è”ç½‘è®¾å¤‡ç­‰ã€‚</p>
<p>éœ€è¦å‘å®¢æˆ·ç«¯è¿”å›é”™è¯¯æç¤ºçš„åœºæ™¯ä¸»è¦å¦‚ä¸‹ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯æ²¡æœ‰æ‰§è¡Œæ“ä½œçš„æƒé™</li>
<li>å®¢æˆ·ç«¯æ²¡æœ‰è®¿é—®èµ„æºçš„æƒé™</li>
<li>å®¢æˆ·ç«¯è¦è®¿é—®çš„é¡¹ç›®ä¸å­˜åœ¨</li>
<li>ç­‰ç­‰ â€¦</li>
</ul>
<p>é‡åˆ°è¿™äº›æƒ…å†µæ—¶ï¼Œé€šå¸¸è¦è¿”å› 4XXï¼ˆ400 è‡³ 499ï¼‰HTTP çŠ¶æ€ç ã€‚</p>
<p>4XX çŠ¶æ€ç ä¸è¡¨ç¤ºè¯·æ±‚æˆåŠŸçš„ 2XXï¼ˆ200 è‡³ 299ï¼‰ HTTP çŠ¶æ€ç ç±»ä¼¼ã€‚</p>
<p>åªä¸è¿‡ï¼Œ4XX çŠ¶æ€ç è¡¨ç¤ºå®¢æˆ·ç«¯å‘ç”Ÿçš„é”™è¯¯ã€‚</p>
<h3 id="HTTPException"><a href="#HTTPException" class="headerlink" title="HTTPException"></a>HTTPException</h3><p>å‘å®¢æˆ·ç«¯è¿”å› HTTP é”™è¯¯å“åº”ï¼Œå¯ä»¥ä½¿ç”¨ <code>HTTPException</code>ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, HTTPException</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line">items = &#123;<span class="string">&quot;foo&quot;</span>: <span class="string">&quot;The Foo Wrestlers&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">if</span> item_id <span class="keyword">not</span> <span class="keyword">in</span> items:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">404</span>, detail=<span class="string">&quot;Item not found&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item&quot;</span>: items[item_id]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/93cd6e9d076c046f33cf2467f4b13d83abb113274b66a67cc264a0c869dafba7.png" alt="å›¾ 42">  </p>
<p><code>HTTPException</code> æ˜¯é¢å¤–åŒ…å«äº†å’Œ API æœ‰å…³æ•°æ®çš„å¸¸è§„ Python å¼‚å¸¸ã€‚</p>
<p>å› ä¸ºæ˜¯ Python å¼‚å¸¸ï¼Œæ‰€ä»¥ä¸èƒ½ <code>return</code>ï¼Œåªèƒ½ <code>raise</code>ã€‚</p>
<p>å¦‚åœ¨è°ƒç”¨è·¯å¾„æ“ä½œå‡½æ•°é‡Œçš„å·¥å…·å‡½æ•°æ—¶ï¼Œè§¦å‘äº† <code>HTTPException</code>ï¼ŒFastAPI å°±ä¸å†ç»§ç»­æ‰§è¡Œè·¯å¾„æ“ä½œå‡½æ•°ä¸­çš„åç»­ä»£ç ï¼Œè€Œæ˜¯ç«‹å³ç»ˆæ­¢è¯·æ±‚ï¼Œå¹¶æŠŠ <code>HTTPException</code> çš„ HTTP é”™è¯¯å‘é€è‡³å®¢æˆ·ç«¯ã€‚</p>
<p>æœ¬ä¾‹ä¸­ï¼Œå®¢æˆ·ç«¯ç”¨ ID è¯·æ±‚çš„ <code>item</code> ä¸å­˜åœ¨æ—¶ï¼Œè§¦å‘çŠ¶æ€ç ä¸º <code>404</code> çš„å¼‚å¸¸ã€‚</p>
<p>è¯·æ±‚ä¸º <code>http://example.com/items/foo</code>ï¼ˆ<code>item_id</code> ä¸º <code>foo</code>ï¼‰æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šæ¥æ”¶åˆ° HTTP çŠ¶æ€ç  - 200 åŠå¦‚ä¸‹ JSON å“åº”ç»“æœï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;item&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The Foo Wrestlers&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä½†å¦‚æœå®¢æˆ·ç«¯è¯·æ±‚ <code>http://example.com/items/bar</code>ï¼ˆ<code>item_id</code> ä¸º <code>bar</code> ä¸å­˜åœ¨æ—¶ï¼‰ï¼Œåˆ™ä¼šæ¥æ”¶åˆ° HTTP çŠ¶æ€ç  - 404ï¼ˆã€Œæœªæ‰¾åˆ°ã€é”™è¯¯ï¼‰åŠå¦‚ä¸‹ JSON å“åº”ç»“æœï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Item not found&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="æ·»åŠ è‡ªå®šä¹‰å“åº”å¤´"><a href="#æ·»åŠ è‡ªå®šä¹‰å“åº”å¤´" class="headerlink" title="æ·»åŠ è‡ªå®šä¹‰å“åº”å¤´"></a>æ·»åŠ è‡ªå®šä¹‰å“åº”å¤´</h3><p>æœ‰äº›åœºæ™¯ä¸‹è¦ä¸º HTTP é”™è¯¯æ·»åŠ è‡ªå®šä¹‰å“åº”å¤´ã€‚ä¾‹å¦‚ï¼Œå‡ºäºæŸäº›æ–¹é¢çš„å®‰å…¨éœ€è¦ã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹å¯èƒ½ä¸ä¼šéœ€è¦åœ¨ä»£ç ä¸­ç›´æ¥ä½¿ç”¨å“åº”å¤´ã€‚</p>
<p>ä½†å¯¹äºæŸäº›é«˜çº§åº”ç”¨åœºæ™¯ï¼Œè¿˜æ˜¯éœ€è¦æ·»åŠ è‡ªå®šä¹‰å“åº”å¤´ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, HTTPException</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line">items = &#123;<span class="string">&quot;foo&quot;</span>: <span class="string">&quot;The Foo &quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items-header/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items_header</span>(<span class="params">item_id: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">if</span> item_id <span class="keyword">not</span> <span class="keyword">in</span> items:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">404</span>, detail=<span class="string">&quot;Item not found&quot;</span>, headers=&#123;<span class="string">&quot;X-Error&quot;</span>: <span class="string">&quot;There goes my error&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item&quot;</span>: items[item_id]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/df2f75c83040109452568fc2896af4b14794e88c000c6606b6fb2ed105cb5fda.png" alt="å›¾ 43">  </p>
<h3 id="è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†"><a href="#è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†" class="headerlink" title="è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†"></a>è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†</h3><p>æ·»åŠ è‡ªå®šä¹‰å¤„ç†å™¨ï¼Œè¦ä½¿ç”¨ Starlette çš„å¼‚å¸¸å·¥å…·ã€‚</p>
<p>å‡è®¾è¦è§¦å‘çš„è‡ªå®šä¹‰å¼‚å¸¸å«ä½œ <code>UnicornException</code>ã€‚</p>
<p>ä¸”éœ€è¦ FastAPI å®ç°å…¨å±€å¤„ç†è¯¥å¼‚å¸¸ã€‚</p>
<p>æ­¤æ—¶ï¼Œå¯ä»¥ç”¨ <code>@app.exception_handler()</code> æ·»åŠ è‡ªå®šä¹‰å¼‚å¸¸æ§åˆ¶å™¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Request</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> JSONResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UnicornException</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.exception_handler(<span class="params">UnicornException</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">unicorn_exception_handler</span>(<span class="params">request: Request, exc: UnicornException</span>):</span><br><span class="line">    <span class="keyword">return</span> JSONResponse(</span><br><span class="line">        status_code=<span class="number">418</span>,</span><br><span class="line">        content=&#123;<span class="string">&quot;message&quot;</span>: <span class="string">f&quot;Ops! <span class="subst">&#123;exc.name&#125;</span> did something. There goes a rainbow...&quot;</span>&#125;,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/unicorns/&#123;name&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_unicorn</span>(<span class="params">name: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">if</span> name == <span class="string">&quot;yolo&quot;</span>:</span><br><span class="line">        <span class="keyword">raise</span> UnicornException(name=name)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;unicorn_name&quot;</span>: name&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/7cb63fec9e948936888c1bc6096433c4f6e590d0e92c8f11dd319dc8272886ef.png" alt="å›¾ 44">  </p>
<p>è¯·æ±‚ <code>/unicorns/yolo</code> æ—¶ï¼Œè·¯å¾„æ“ä½œä¼šè§¦å‘ <code>UnicornException</code>ã€‚</p>
<p>ä½†è¯¥å¼‚å¸¸å°†ä¼šè¢« <code>unicorn_exception_handler</code> å¤„ç†ã€‚</p>
<p>æ¥æ”¶åˆ°çš„é”™è¯¯ä¿¡æ¯æ¸…æ™°æ˜äº†ï¼ŒHTTP çŠ¶æ€ç ä¸º 418ï¼ŒJSON å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Oops! yolo did something. There goes a rainbow...&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="è¦†ç›–é»˜è®¤å¼‚å¸¸å¤„ç†å™¨"><a href="#è¦†ç›–é»˜è®¤å¼‚å¸¸å¤„ç†å™¨" class="headerlink" title="è¦†ç›–é»˜è®¤å¼‚å¸¸å¤„ç†å™¨"></a>è¦†ç›–é»˜è®¤å¼‚å¸¸å¤„ç†å™¨</h3><p>FastAPI è‡ªå¸¦äº†ä¸€äº›é»˜è®¤å¼‚å¸¸å¤„ç†å™¨ã€‚</p>
<p>è§¦å‘ <code>HTTPException</code> æˆ–è¯·æ±‚æ— æ•ˆæ•°æ®æ—¶ï¼Œè¿™äº›å¤„ç†å™¨è¿”å›é»˜è®¤çš„ JSON å“åº”ç»“æœã€‚</p>
<p>ä¸è¿‡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰å¤„ç†å™¨è¦†ç›–é»˜è®¤å¼‚å¸¸å¤„ç†å™¨ã€‚</p>
<h4 id="è¦†ç›–è¯·æ±‚éªŒè¯å¼‚å¸¸"><a href="#è¦†ç›–è¯·æ±‚éªŒè¯å¼‚å¸¸" class="headerlink" title="è¦†ç›–è¯·æ±‚éªŒè¯å¼‚å¸¸"></a>è¦†ç›–è¯·æ±‚éªŒè¯å¼‚å¸¸</h4><p>è¯·æ±‚ä¸­åŒ…å«æ— æ•ˆæ•°æ®æ—¶ï¼ŒFastAPI å†…éƒ¨ä¼šè§¦å‘ <code>RequestValidationError</code>ã€‚</p>
<p>è¯¥å¼‚å¸¸ä¹Ÿå†…ç½®äº†é»˜è®¤å¼‚å¸¸å¤„ç†å™¨ã€‚</p>
<p>è¦†ç›–é»˜è®¤å¼‚å¸¸å¤„ç†å™¨æ—¶éœ€è¦å¯¼å…¥ <code>RequestValidationError</code>ï¼Œå¹¶ç”¨ <code>@app.excption_handler(RequestValidationError)</code> è£…é¥°å¼‚å¸¸å¤„ç†å™¨ã€‚</p>
<p>è¿™æ ·ï¼Œå¼‚å¸¸å¤„ç†å™¨å°±å¯ä»¥æ¥æ”¶ <code>Request</code> ä¸å¼‚å¸¸ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, HTTPException</span><br><span class="line"><span class="keyword">from</span> fastapi.exceptions <span class="keyword">import</span> RequestValidationError</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> PlainTextResponse</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.exception_handler(<span class="params">RequestValidationError</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">validation_exception_handler</span>(<span class="params">request, exc</span>):</span><br><span class="line">    <span class="keyword">return</span> PlainTextResponse(<span class="built_in">str</span>(exc), status_code=<span class="number">400</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="keyword">if</span> item_id == <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">418</span>, detail=<span class="string">&quot;Nope! I don&#x27;t like 3.&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p>è®¿é—® &#x2F;items&#x2F;fooï¼Œå¯ä»¥çœ‹åˆ°é»˜è®¤çš„ JSON é”™è¯¯ä¿¡æ¯ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int_parsing&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;loc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;path&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;item_id&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Input should be a valid integer, unable to parse string as an integer&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;foo&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¢«æ›¿æ¢ä¸ºäº†ä»¥ä¸‹æ–‡æœ¬æ ¼å¼çš„é”™è¯¯ä¿¡æ¯ï¼š</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123;&#x27;type&#x27;: &#x27;int_parsing&#x27;, &#x27;loc&#x27;: (&#x27;path&#x27;, &#x27;item_id&#x27;), &#x27;msg&#x27;: &#x27;Input should be a valid integer, unable to parse string as an integer&#x27;, &#x27;input&#x27;: &#x27;foo&#x27;&#125;]</span><br></pre></td></tr></table></figure>

<h4 id="ä½¿ç”¨-RequestValidationError-çš„è¯·æ±‚ä½“"><a href="#ä½¿ç”¨-RequestValidationError-çš„è¯·æ±‚ä½“" class="headerlink" title="ä½¿ç”¨ RequestValidationError çš„è¯·æ±‚ä½“"></a>ä½¿ç”¨ RequestValidationError çš„è¯·æ±‚ä½“</h4><p><code>RequestValidationError</code> åŒ…å«å…¶æ¥æ”¶åˆ°çš„æ— æ•ˆæ•°æ®è¯·æ±‚çš„ <code>body</code>ã€‚</p>
<p>å¼€å‘æ—¶ï¼Œå¯ä»¥ç”¨è¿™ä¸ªè¯·æ±‚ä½“ç”Ÿæˆæ—¥å¿—ã€è°ƒè¯•é”™è¯¯ï¼Œå¹¶è¿”å›ç»™ç”¨æˆ·ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Request, status</span><br><span class="line"><span class="keyword">from</span> fastapi.encoders <span class="keyword">import</span> jsonable_encoder</span><br><span class="line"><span class="keyword">from</span> fastapi.exceptions <span class="keyword">import</span> RequestValidationError</span><br><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> BaseModel</span><br><span class="line"><span class="keyword">from</span> starlette.responses <span class="keyword">import</span> JSONResponse</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.exception_handler(<span class="params">RequestValidationError</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">validation_exception_handler</span>(<span class="params">request: Request, exc: RequestValidationError</span>):</span><br><span class="line">    <span class="keyword">return</span> JSONResponse(</span><br><span class="line">        status_code=status.HTTP_422_UNPROCESSABLE_ENTITY,</span><br><span class="line">        content=jsonable_encoder(&#123;<span class="string">&quot;detail&quot;</span>: exc.errors(), <span class="string">&quot;body&quot;</span>: exc.body&#125;)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    title: <span class="built_in">str</span></span><br><span class="line">    size: <span class="built_in">int</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">item: Item</span>):</span><br><span class="line">    <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app)</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨è¯•ç€å‘é€ä¸€ä¸ªæ— æ•ˆçš„ <code>item</code>ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;towel&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;XL&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>æ”¶åˆ°çš„å“åº”åŒ…å« body ä¿¡æ¯ï¼Œå¹¶è¯´æ˜æ•°æ®æ˜¯æ— æ•ˆçš„ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int_parsing&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;loc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;body&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;size&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Input should be a valid integer, unable to parse string as an integer&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;XL&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;towel&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;XL&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/d09a7da677aa07119019e91e8505e6f0f9290136bcf5e1e5dc0acbe855b38007.png" alt="å›¾ 45">  </p>
<h4 id="è¦†ç›–-HTTPException-é”™è¯¯å¤„ç†å™¨"><a href="#è¦†ç›–-HTTPException-é”™è¯¯å¤„ç†å™¨" class="headerlink" title="è¦†ç›– HTTPException é”™è¯¯å¤„ç†å™¨"></a>è¦†ç›– HTTPException é”™è¯¯å¤„ç†å™¨</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, HTTPException</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> PlainTextResponse</span><br><span class="line"><span class="keyword">from</span> starlette.exceptions <span class="keyword">import</span> HTTPException <span class="keyword">as</span> StarletteHTTPException</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.exception_handler(<span class="params">StarletteHTTPException</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">http_exception_handler</span>(<span class="params">request, exc</span>):</span><br><span class="line">    <span class="keyword">return</span> PlainTextResponse(<span class="built_in">str</span>(exc.detail), status_code=exc.status_code)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="keyword">if</span> item_id == <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">418</span>, detail=<span class="string">&quot;Nope! I don&#x27;t like 3.&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p>FastAPI ä¹Ÿæä¾›äº†è‡ªæœ‰çš„ <code>HTTPException</code>ã€‚</p>
<p>FastAPI çš„ <code>HTTPException</code> ç»§æ‰¿è‡ª Starlette çš„ <code>HTTPException</code> é”™è¯¯ç±»ã€‚</p>
<p>å®ƒä»¬ä¹‹é—´çš„å”¯ä¸€åŒºåˆ«æ˜¯ï¼ŒFastAPI çš„ <code>HTTPException</code> å¯ä»¥åœ¨å“åº”ä¸­æ·»åŠ å“åº”å¤´ã€‚</p>
<p>OAuth 2.0 ç­‰å®‰å…¨å·¥å…·éœ€è¦åœ¨å†…éƒ¨è°ƒç”¨è¿™äº›å“åº”å¤´ã€‚</p>
<p>å› æ­¤ä½ å¯ä»¥ç»§ç»­åƒå¹³å¸¸ä¸€æ ·åœ¨ä»£ç ä¸­è§¦å‘ FastAPI çš„ <code>HTTPException</code> ã€‚</p>
<p><strong>ä½†æ³¨å†Œå¼‚å¸¸å¤„ç†å™¨æ—¶ï¼Œåº”è¯¥æ³¨å†Œåˆ°æ¥è‡ª Starlette çš„ <code>HTTPException</code>ã€‚</strong></p>
<p>è¿™æ ·åšæ˜¯ä¸ºäº†ï¼Œå½“ Starlette çš„å†…éƒ¨ä»£ç ã€æ‰©å±•æˆ–æ’ä»¶è§¦å‘ Starlette <code>HTTPException</code> æ—¶ï¼Œå¤„ç†ç¨‹åºèƒ½å¤Ÿæ•è·ã€å¹¶å¤„ç†æ­¤å¼‚å¸¸ã€‚</p>
<p>æ³¨æ„ï¼Œæœ¬ä¾‹ä»£ç ä¸­åŒæ—¶ä½¿ç”¨äº†è¿™ä¸¤ä¸ª <code>HTTPException</code>ï¼Œæ­¤æ—¶ï¼Œè¦æŠŠ Starlette çš„ <code>HTTPException</code> å‘½åä¸º <code>StarletteHTTPException</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> starlette.exceptions <span class="keyword">import</span> HTTPException <span class="keyword">as</span> StarletteHTTPException</span><br></pre></td></tr></table></figure>

<h3 id="å¤ç”¨-FastAPI-å¼‚å¸¸å¤„ç†å™¨"><a href="#å¤ç”¨-FastAPI-å¼‚å¸¸å¤„ç†å™¨" class="headerlink" title="å¤ç”¨ FastAPI å¼‚å¸¸å¤„ç†å™¨"></a>å¤ç”¨ FastAPI å¼‚å¸¸å¤„ç†å™¨</h3><p>FastAPI æ”¯æŒå…ˆå¯¹å¼‚å¸¸è¿›è¡ŒæŸäº›å¤„ç†ï¼Œç„¶åå†ä½¿ç”¨ FastAPI ä¸­å¤„ç†è¯¥å¼‚å¸¸çš„é»˜è®¤å¼‚å¸¸å¤„ç†å™¨ã€‚</p>
<p>ä» <code>fastapi.exception_handlers</code> ä¸­å¯¼å…¥è¦å¤ç”¨çš„é»˜è®¤å¼‚å¸¸å¤„ç†å™¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, HTTPException</span><br><span class="line"><span class="keyword">from</span> fastapi.exception_handlers <span class="keyword">import</span> (</span><br><span class="line">    http_exception_handler,</span><br><span class="line">    request_validation_exception_handler,</span><br><span class="line">)</span><br><span class="line"><span class="keyword">from</span> fastapi.exceptions <span class="keyword">import</span> RequestValidationError</span><br><span class="line"><span class="keyword">from</span> starlette.exceptions <span class="keyword">import</span> HTTPException <span class="keyword">as</span> StarletteHTTPException</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.exception_handler(<span class="params">StarletteHTTPException</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">custom_http_exception_handler</span>(<span class="params">request, exc</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;OMG! An HTTP error!: <span class="subst">&#123;<span class="built_in">repr</span>(exc)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> http_exception_handler(request, exc)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.exception_handler(<span class="params">RequestValidationError</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">validation_exception_handler</span>(<span class="params">request, exc</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;OMG! The client sent invalid data!: <span class="subst">&#123;exc&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> request_validation_exception_handler(request, exc)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="keyword">if</span> item_id == <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">418</span>, detail=<span class="string">&quot;Nope! I don&#x27;t like 3.&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br></pre></td></tr></table></figure>

<h2 id="è·¯å¾„æ“ä½œé…ç½®"><a href="#è·¯å¾„æ“ä½œé…ç½®" class="headerlink" title="è·¯å¾„æ“ä½œé…ç½®"></a>è·¯å¾„æ“ä½œé…ç½®</h2><p>è·¯å¾„æ“ä½œè£…é¥°å™¨æ”¯æŒå¤šç§é…ç½®å‚æ•°ã€‚</p>
<h3 id="çŠ¶æ€ç "><a href="#çŠ¶æ€ç " class="headerlink" title="çŠ¶æ€ç "></a>çŠ¶æ€ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Set</span>, <span class="type">Union</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, status</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="type">Union</span>[<span class="built_in">float</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    tags: <span class="type">Set</span>[<span class="built_in">str</span>] = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/items/&quot;</span>, response_model=Item, status_code=status.HTTP_201_CREATED</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">item: Item</span>):</span><br><span class="line">    <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>

<h3 id="tags-å‚æ•°"><a href="#tags-å‚æ•°" class="headerlink" title="tags å‚æ•°"></a>tags å‚æ•°</h3><p><code>tags</code> å‚æ•°çš„å€¼æ˜¯ç”± <code>str</code> ç»„æˆçš„ <code>list</code> ï¼ˆä¸€èˆ¬åªæœ‰ä¸€ä¸ª str ï¼‰ï¼Œ<code>tags</code> ç”¨äºä¸ºè·¯å¾„æ“ä½œæ·»åŠ æ ‡ç­¾ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Set</span>, <span class="type">Union</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="type">Union</span>[<span class="built_in">float</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    tags: <span class="type">Set</span>[<span class="built_in">str</span>] = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/items/&quot;</span>, response_model=Item, tags=[<span class="string">&quot;items&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">item: Item</span>):</span><br><span class="line">    <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span>, tags=[<span class="string">&quot;items&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>():</span><br><span class="line">    <span class="keyword">return</span> [&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Foo&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">42</span>&#125;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/&quot;</span>, tags=[<span class="string">&quot;users&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_users</span>():</span><br><span class="line">    <span class="keyword">return</span> [&#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;johndoe&quot;</span>&#125;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>) </span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/548e6a42b9b75ed329e014cd75b68f0b5e4687ca56f09c4f12abcad48685dd10.png" alt="å›¾ 46">  </p>
<h3 id="summary-å’Œ-description-å‚æ•°"><a href="#summary-å’Œ-description-å‚æ•°" class="headerlink" title="summary å’Œ description å‚æ•°"></a>summary å’Œ description å‚æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Set</span>, <span class="type">Union</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="type">Union</span>[<span class="built_in">float</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    tags: <span class="type">Set</span>[<span class="built_in">str</span>] = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    <span class="string">&quot;/items/&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    response_model=Item,</span></span></span><br><span class="line"><span class="params"><span class="meta">    summary=<span class="string">&quot;Create an item&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    description=<span class="string">&quot;Create an item with all the information, name, description, price, tax and a set of unique tags&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">item: Item</span>):</span><br><span class="line">    <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/a5dba0cd6c2bffaf85fbf46c9a0380a54cc285dbc191c6d80c47496e2039dd80.png" alt="å›¾ 47">  </p>
<h3 id="æ–‡æ¡£å­—ç¬¦ä¸²"><a href="#æ–‡æ¡£å­—ç¬¦ä¸²" class="headerlink" title="æ–‡æ¡£å­—ç¬¦ä¸²"></a>æ–‡æ¡£å­—ç¬¦ä¸²</h3><p>æè¿°å†…å®¹æ¯”è¾ƒé•¿ä¸”å ç”¨å¤šè¡Œæ—¶ï¼Œå¯ä»¥åœ¨å‡½æ•°çš„ docstring ä¸­å£°æ˜è·¯å¾„æ“ä½œçš„æè¿°ï¼ŒFastAPI æ”¯æŒä»æ–‡æ¡£å­—ç¬¦ä¸²ä¸­è¯»å–æè¿°å†…å®¹ã€‚</p>
<p>æ–‡æ¡£å­—ç¬¦ä¸²æ”¯æŒ Markdownï¼Œèƒ½æ­£ç¡®è§£æå’Œæ˜¾ç¤º Markdown çš„å†…å®¹ï¼Œä½†è¦æ³¨æ„æ–‡æ¡£å­—ç¬¦ä¸²çš„ç¼©è¿›ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Set</span>, <span class="type">Union</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="type">Union</span>[<span class="built_in">float</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    tags: <span class="type">Set</span>[<span class="built_in">str</span>] = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/items/&quot;</span>, response_model=Item, summary=<span class="string">&quot;Create an item&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">item: Item</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Create an item with all the information:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    - **name**: each item must have a name</span></span><br><span class="line"><span class="string">    - **description**: a long description</span></span><br><span class="line"><span class="string">    - **price**: required</span></span><br><span class="line"><span class="string">    - **tax**: if the item doesn&#x27;t have tax, you can omit this</span></span><br><span class="line"><span class="string">    - **tags**: a set of unique tag strings for this item</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/7ff624235e913119ce8256e6a470861c0837f1aae8282a4d1ff772fd5d73c74b.png" alt="å›¾ 48">  </p>
<h3 id="å“åº”æè¿°"><a href="#å“åº”æè¿°" class="headerlink" title="å“åº”æè¿°"></a>å“åº”æè¿°</h3><p><code>response_description</code> å‚æ•°ç”¨äºå®šä¹‰å“åº”çš„æè¿°è¯´æ˜ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Set</span>, <span class="type">Union</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="type">Union</span>[<span class="built_in">float</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    tags: <span class="type">Set</span>[<span class="built_in">str</span>] = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    <span class="string">&quot;/items/&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    response_model=Item,</span></span></span><br><span class="line"><span class="params"><span class="meta">    summary=<span class="string">&quot;Create an item&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    response_description=<span class="string">&quot;The created item&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">item: Item</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Create an item with all the information:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    - **name**: each item must have a name</span></span><br><span class="line"><span class="string">    - **description**: a long description</span></span><br><span class="line"><span class="string">    - **price**: required</span></span><br><span class="line"><span class="string">    - **tax**: if the item doesn&#x27;t have tax, you can omit this</span></span><br><span class="line"><span class="string">    - **tags**: a set of unique tag strings for this item</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/db2ea9b77956a789bd1d3e660b9f71768a23c32ba1821ad6c4c71e765703f879.png" alt="å›¾ 50">  </p>
<h3 id="å¼ƒç”¨è·¯å¾„æ“ä½œ"><a href="#å¼ƒç”¨è·¯å¾„æ“ä½œ" class="headerlink" title="å¼ƒç”¨è·¯å¾„æ“ä½œ"></a>å¼ƒç”¨è·¯å¾„æ“ä½œ</h3><p><code>deprecated</code> å‚æ•°å¯ä»¥æŠŠè·¯å¾„æ“ä½œæ ‡è®°ä¸ºå¼ƒç”¨ï¼Œæ— éœ€ç›´æ¥åˆ é™¤ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span>, tags=[<span class="string">&quot;items&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>():</span><br><span class="line">    <span class="keyword">return</span> [&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Foo&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">42</span>&#125;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/&quot;</span>, tags=[<span class="string">&quot;users&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_users</span>():</span><br><span class="line">    <span class="keyword">return</span> [&#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;johndoe&quot;</span>&#125;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/elements/&quot;</span>, tags=[<span class="string">&quot;items&quot;</span>], deprecated=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_elements</span>():</span><br><span class="line">    <span class="keyword">return</span> [&#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Foo&quot;</span>&#125;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/6fb0b611bb205b5db636315ee02702956c61ed13405a3ed5d5d67cf7130910b6.png" alt="å›¾ 51">  </p>
<h2 id="JSON-å…¼å®¹ç¼–ç å™¨"><a href="#JSON-å…¼å®¹ç¼–ç å™¨" class="headerlink" title="JSON å…¼å®¹ç¼–ç å™¨"></a>JSON å…¼å®¹ç¼–ç å™¨</h2><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦å°†æ•°æ®ç±»å‹ï¼ˆå¦‚Pydanticæ¨¡å‹ï¼‰è½¬æ¢ä¸ºä¸JSONå…¼å®¹çš„æ•°æ®ç±»å‹ï¼ˆå¦‚dictã€listç­‰ï¼‰ã€‚</p>
<p>æ¯”å¦‚ï¼Œå¦‚æœæ‚¨éœ€è¦å°†å…¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚</p>
<p>å¯¹äºè¿™ç§è¦æ±‚ï¼ŒFastAPIæä¾›äº† <code>jsonable_encoder()</code> å‡½æ•°ã€‚</p>
<p>æˆ‘ä»¬å‡è®¾ä½ æœ‰ä¸€ä¸ªæ•°æ®åº“åä¸º<code>fake_db</code>ï¼Œå®ƒåªèƒ½æ¥æ”¶ä¸JSONå…¼å®¹çš„æ•°æ®ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå®ƒä¸æ¥æ”¶<code>datetime</code>è¿™ç±»çš„å¯¹è±¡ï¼Œå› ä¸ºè¿™äº›å¯¹è±¡ä¸JSONä¸å…¼å®¹ã€‚</p>
<p>å› æ­¤ï¼Œ<code>datetime</code>å¯¹è±¡å¿…é¡»å°†è½¬æ¢ä¸ºåŒ…å«ISOæ ¼å¼åŒ–çš„strç±»å‹å¯¹è±¡ã€‚</p>
<p>åŒæ ·ï¼Œè¿™ä¸ªæ•°æ®åº“ä¹Ÿä¸ä¼šæ¥æ”¶Pydanticæ¨¡å‹ï¼ˆå¸¦æœ‰å±æ€§çš„å¯¹è±¡ï¼‰ï¼Œè€Œåªæ¥æ”¶<code>dict</code>ã€‚</p>
<p>å¯¹æ­¤ä½ å¯ä»¥ä½¿ç”¨<code>jsonable_encoder</code>ã€‚</p>
<p>å®ƒæ¥æ”¶ä¸€ä¸ªå¯¹è±¡ï¼Œæ¯”å¦‚Pydanticæ¨¡å‹ï¼Œå¹¶ä¼šè¿”å›ä¸€ä¸ªJSONå…¼å®¹çš„ç‰ˆæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.encoders <span class="keyword">import</span> jsonable_encoder</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">fake_db = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    title: <span class="built_in">str</span></span><br><span class="line">    timestamp: datetime</span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params"><span class="built_in">id</span>: <span class="built_in">str</span>, item: Item</span>):</span><br><span class="line">    json_compatible_item_data = jsonable_encoder(item)</span><br><span class="line">    fake_db[<span class="built_in">id</span>] = json_compatible_item_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_item</span>(<span class="params"><span class="built_in">id</span>: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> fake_db[<span class="built_in">id</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">import</span> uvicorn</span><br><span class="line"></span><br><span class="line">    uvicorn.run(app)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/544da5f0e20613e553c991970181e2ee48d700ee37290ec253aaeaea4dba45b5.png" alt="å›¾ 52">  </p>
<h2 id="ä¾èµ–é¡¹"><a href="#ä¾èµ–é¡¹" class="headerlink" title="ä¾èµ–é¡¹"></a>ä¾èµ–é¡¹</h2><p>ç¼–ç¨‹ä¸­çš„ã€Œä¾èµ–æ³¨å…¥ã€æ˜¯å£°æ˜ä»£ç è¿è¡Œæ‰€éœ€çš„ï¼Œæˆ–è¦ä½¿ç”¨çš„ã€Œä¾èµ–ã€çš„ä¸€ç§æ–¹å¼ã€‚</p>
<p>ç„¶åï¼Œç”±ç³»ç»Ÿï¼ˆæœ¬æ–‡ä¸­ä¸º FastAPIï¼‰è´Ÿè´£æ‰§è¡Œä»»æ„éœ€è¦çš„é€»è¾‘ï¼Œä¸ºä»£ç æä¾›è¿™äº›ä¾èµ–ï¼ˆã€Œæ³¨å…¥ã€ä¾èµ–é¡¹ï¼‰ã€‚</p>
<p>ä¾èµ–æ³¨å…¥å¸¸ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p>
<ul>
<li>å…±äº«ä¸šåŠ¡é€»è¾‘ï¼ˆå¤ç”¨ç›¸åŒçš„ä»£ç é€»è¾‘ï¼‰</li>
<li>å…±äº«æ•°æ®åº“è¿æ¥</li>
<li>å®ç°å®‰å…¨ã€éªŒè¯ã€è§’è‰²æƒé™</li>
<li>ç­‰â€¦â€¦</li>
</ul>
<p>ä¸Šè¿°åœºæ™¯å‡å¯ä»¥ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œå°†ä»£ç é‡å¤æœ€å°åŒ–ã€‚</p>
<p>é¦–å…ˆï¼Œè¦å…³æ³¨çš„æ˜¯ä¾èµ–é¡¹ã€‚<br>ä¾èµ–é¡¹å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸”å¯ä»¥ä½¿ç”¨ä¸è·¯å¾„æ“ä½œå‡½æ•°ç›¸åŒçš„å‚æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.params <span class="keyword">import</span> Depends</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">common_parameters</span>(<span class="params">q: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span>, skip: <span class="built_in">int</span> = <span class="number">0</span>, limit: <span class="built_in">int</span> = <span class="number">100</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;skip&quot;</span>: skip, <span class="string">&quot;limit&quot;</span>: limit, <span class="string">&quot;q&quot;</span>: q&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">commons: <span class="built_in">dict</span> = Depends(<span class="params">common_parameters</span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> commons</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_users</span>(<span class="params">commons: <span class="built_in">dict</span> = Depends(<span class="params">common_parameters</span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> commons</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p>ä¾èµ–é¡¹å‡½æ•°çš„å½¢å¼å’Œç»“æ„ä¸è·¯å¾„æ“ä½œå‡½æ•°ä¸€æ ·ã€‚<br>å› æ­¤ï¼Œå¯ä»¥æŠŠä¾èµ–é¡¹å½“ä½œæ²¡æœ‰ã€Œè£…é¥°å™¨ã€ï¼ˆå³ï¼Œæ²¡æœ‰ <code>@app.get(&quot;/some-path&quot;)</code> ï¼‰çš„è·¯å¾„æ“ä½œå‡½æ•°ã€‚<br>ä¾èµ–é¡¹å¯ä»¥è¿”å›å„ç§å†…å®¹ã€‚<br>æœ¬ä¾‹ä¸­çš„ä¾èµ–é¡¹é¢„æœŸæ¥æ”¶å¦‚ä¸‹å‚æ•°ï¼š</p>
<ul>
<li>ç±»å‹ä¸º str çš„å¯é€‰æŸ¥è¯¢å‚æ•° q</li>
<li>ç±»å‹ä¸º int çš„å¯é€‰æŸ¥è¯¢å‚æ•° skipï¼Œé»˜è®¤å€¼æ˜¯ 0</li>
<li>ç±»å‹ä¸º int çš„å¯é€‰æŸ¥è¯¢å‚æ•° limitï¼Œé»˜è®¤å€¼æ˜¯ 100</li>
</ul>
<p>ç„¶åï¼Œä¾èµ–é¡¹å‡½æ•°è¿”å›åŒ…å«è¿™äº›å€¼çš„ dictã€‚<br>å£°æ˜ä¾èµ–é¡¹éœ€è¦ä½¿ç”¨ <code>Depends</code> å’Œä¸€ä¸ªæ–°çš„å‚æ•°ï¼Œè¿™é‡Œåªèƒ½ä¼ ç»™ <code>Depends</code> ä¸€ä¸ªå‚æ•°ã€‚ä¸”è¯¥å‚æ•°å¿…é¡»æ˜¯å¯è°ƒç”¨å¯¹è±¡ï¼Œæ¯”å¦‚å‡½æ•°ã€‚</p>
<p>æ¥æ”¶åˆ°æ–°çš„è¯·æ±‚æ—¶ï¼ŒFastAPI æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š</p>
<ul>
<li>ç”¨æ­£ç¡®çš„å‚æ•°è°ƒç”¨ä¾èµ–é¡¹å‡½æ•°ï¼ˆã€Œå¯ä¾èµ–é¡¹ã€ï¼‰</li>
<li>è·å–å‡½æ•°è¿”å›çš„ç»“æœ</li>
<li>æŠŠå‡½æ•°è¿”å›çš„ç»“æœèµ‹å€¼ç»™è·¯å¾„æ“ä½œå‡½æ•°çš„å‚æ•°</li>
</ul>
<p>è¿™æ ·ï¼Œåªç¼–å†™ä¸€æ¬¡ä»£ç ï¼ŒFastAPI å°±å¯ä»¥ä¸ºå¤šä¸ªè·¯å¾„æ“ä½œå…±äº«è¿™æ®µä»£ç  ã€‚</p>
<p>ä½¿ç”¨éä¾èµ–é¡¹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">common_parameters</span>(<span class="params">q: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span>, skip: <span class="built_in">int</span> = <span class="number">0</span>, limit: <span class="built_in">int</span> = <span class="number">100</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;skip&quot;</span>: skip, <span class="string">&quot;limit&quot;</span>: limit, <span class="string">&quot;q&quot;</span>: q&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">q: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span>, skip: <span class="built_in">int</span> = <span class="number">0</span>, limit: <span class="built_in">int</span> = <span class="number">100</span></span>):</span><br><span class="line">    commons = <span class="keyword">await</span> common_parameters(q, skip, limit)</span><br><span class="line">    <span class="keyword">return</span> commons</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_users</span>(<span class="params">q: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span>, skip: <span class="built_in">int</span> = <span class="number">0</span>, limit: <span class="built_in">int</span> = <span class="number">100</span></span>):</span><br><span class="line">    commons = <span class="keyword">await</span> common_parameters(q, skip, limit)</span><br><span class="line">    <span class="keyword">return</span> commons</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>**ç§»é™¤äº† <code>Depends</code>**ï¼šæˆ‘ä»¬å°† å‡½æ•°çš„è°ƒç”¨ç›´æ¥æ”¾åœ¨äº†æ¯ä¸ªè·¯ç”±å¤„ç†å™¨ä¸­ã€‚ <code>common_parameters</code></li>
<li><strong>æ‰‹åŠ¨ä¼ é€’å‚æ•°</strong>ï¼šåœ¨æ¯ä¸ªè·¯ç”±ä¸­æ‰‹åŠ¨ä¼ é€’ ã€ å’Œ å‚æ•°ç»™ å‡½æ•°ã€‚ <code>qã€skipã€limitã€common_parameters</code></li>
</ul>
<h3 id="ç±»ä½œä¸ºä¾èµ–é¡¹"><a href="#ç±»ä½œä¸ºä¾èµ–é¡¹" class="headerlink" title="ç±»ä½œä¸ºä¾èµ–é¡¹"></a>ç±»ä½œä¸ºä¾èµ–é¡¹</h3><p>åœ¨ä¸Šä¸ªä¾‹å­ä¸­æˆ‘ä»¬ä»ä¸­è¿”å›äº†ä¸€ä¸ª <code>dict</code>,æˆ‘ä»¬çŸ¥é“ç¼–è¾‘å™¨ä¸èƒ½ä¸º <code>dict</code> æä¾›å¾ˆå¤šæ”¯æŒ(æ¯”å¦‚è¡¥å…¨)ï¼Œå› ä¸ºç¼–è¾‘å™¨ä¸çŸ¥é“ <code>dict</code> çš„é”®å’Œå€¼ç±»å‹ã€‚<br>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢çš„ä¾èµ–é¡¹ â€œå¯ä¾èµ–å¯¹è±¡â€ <code>common_parameters</code> æ›´æ”¹ä¸ºç±» <code>CommonQueryParams</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Depends</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line">fake_items_db = [&#123;<span class="string">&quot;item_name&quot;</span>: <span class="string">&quot;Foo&quot;</span>&#125;, &#123;<span class="string">&quot;item_name&quot;</span>: <span class="string">&quot;Bar&quot;</span>&#125;, &#123;<span class="string">&quot;item_name&quot;</span>: <span class="string">&quot;Baz&quot;</span>&#125;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CommonQueryParams</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, q: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span>, skip: <span class="built_in">int</span> = <span class="number">0</span>, limit: <span class="built_in">int</span> = <span class="number">100</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.q = q</span><br><span class="line">        <span class="variable language_">self</span>.skip = skip</span><br><span class="line">        <span class="variable language_">self</span>.limit = limit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">commons: CommonQueryParams = Depends(<span class="params">CommonQueryParams</span>)</span>):</span><br><span class="line">    response = &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> commons.q:</span><br><span class="line">        response.update(&#123;<span class="string">&quot;q&quot;</span>: commons.q&#125;)</span><br><span class="line">    items = fake_items_db[commons.skip: commons.skip + commons.limit]</span><br><span class="line">    response.update(&#123;<span class="string">&quot;items&quot;</span>: items&#125;)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<h3 id="å­ä¾èµ–é¡¹"><a href="#å­ä¾èµ–é¡¹" class="headerlink" title="å­ä¾èµ–é¡¹"></a>å­ä¾èµ–é¡¹</h3><p>FastAPI æ”¯æŒåˆ›å»ºå«å­ä¾èµ–é¡¹çš„ä¾èµ–é¡¹ã€‚</p>
<p>å¹¶ä¸”ï¼Œå¯ä»¥æŒ‰éœ€å£°æ˜ä»»æ„æ·±åº¦çš„å­ä¾èµ–é¡¹åµŒå¥—å±‚çº§ã€‚</p>
<p>FastAPI è´Ÿè´£å¤„ç†è§£æä¸åŒæ·±åº¦çš„å­ä¾èµ–é¡¹ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Cookie, Depends</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">query_extractor</span>(<span class="params">q: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">return</span> q</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">query_or_cookie_extractor</span>(<span class="params"></span></span><br><span class="line"><span class="params">        q: <span class="built_in">str</span> = Depends(<span class="params">query_extractor</span>),</span></span><br><span class="line"><span class="params">        last_query: <span class="built_in">str</span> | <span class="literal">None</span> = Cookie(<span class="params">default=<span class="literal">None</span></span>),</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> q:</span><br><span class="line">        <span class="keyword">return</span> last_query</span><br><span class="line">    <span class="keyword">return</span> q</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_query</span>(<span class="params">query_or_default: <span class="built_in">str</span> = Depends(<span class="params">query_or_cookie_extractor</span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;q_or_cookie&quot;</span>: query_or_default&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„ï¼Œè¿™é‡Œåœ¨è·¯å¾„æ“ä½œå‡½æ•°ä¸­åªå£°æ˜äº†ä¸€ä¸ªä¾èµ–é¡¹ï¼Œå³ query_or_cookie_extractor ã€‚</p>
<p>ä½† FastAPI å¿…é¡»å…ˆå¤„ç† query_extractorï¼Œä»¥ä¾¿åœ¨è°ƒç”¨ query_or_cookie_extractor æ—¶ä½¿ç”¨ query_extractor è¿”å›çš„ç»“æœã€‚</p>
</blockquote>
<p>å¦‚æœåœ¨åŒä¸€ä¸ª <strong>è·¯å¾„æ“ä½œ</strong> å¤šæ¬¡å£°æ˜äº†åŒä¸€ä¸ªä¾èµ–é¡¹ï¼Œä¾‹å¦‚ï¼Œå¤šä¸ªä¾èµ–é¡¹å…±ç”¨ä¸€ä¸ªå­ä¾èµ–é¡¹ï¼ŒFastAPI åœ¨å¤„ç†åŒä¸€è¯·æ±‚æ—¶ï¼Œåªè°ƒç”¨ä¸€æ¬¡è¯¥å­ä¾èµ–é¡¹ã€‚</p>
<p>FastAPI ä¸ä¼šä¸º<strong>åŒä¸€ä¸ªè¯·æ±‚</strong>å¤šæ¬¡è°ƒç”¨åŒä¸€ä¸ªä¾èµ–é¡¹ï¼Œè€Œæ˜¯æŠŠä¾èµ–é¡¹çš„è¿”å›å€¼è¿›è¡Œã€Œç¼“å­˜ã€ï¼Œå¹¶æŠŠå®ƒä¼ é€’ç»™åŒä¸€è¯·æ±‚ä¸­æ‰€æœ‰éœ€è¦ä½¿ç”¨è¯¥è¿”å›å€¼çš„ã€Œä¾èµ–é¡¹ã€ã€‚</p>
<p>åœ¨é«˜çº§ä½¿ç”¨åœºæ™¯ä¸­ï¼Œå¦‚æœä¸æƒ³ä½¿ç”¨ã€Œç¼“å­˜ã€å€¼ï¼Œè€Œæ˜¯ä¸ºéœ€è¦åœ¨åŒä¸€è¯·æ±‚çš„æ¯ä¸€æ­¥æ“ä½œï¼ˆå¤šæ¬¡ï¼‰ä¸­éƒ½å®é™…è°ƒç”¨ä¾èµ–é¡¹ï¼Œå¯ä»¥æŠŠ Depends çš„å‚æ•° use_cache çš„å€¼è®¾ç½®ä¸º False :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">needy_dependency</span>(<span class="params">fresh_value: <span class="built_in">str</span> = Depends(<span class="params">get_value, use_cache=<span class="literal">False</span></span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;fresh_value&quot;</span>: fresh_value&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è·¯å¾„æ“ä½œè£…é¥°å™¨ä¾èµ–é¡¹"><a href="#è·¯å¾„æ“ä½œè£…é¥°å™¨ä¾èµ–é¡¹" class="headerlink" title="è·¯å¾„æ“ä½œè£…é¥°å™¨ä¾èµ–é¡¹"></a>è·¯å¾„æ“ä½œè£…é¥°å™¨ä¾èµ–é¡¹</h3><p>æœ‰æ—¶ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦åœ¨è·¯å¾„æ“ä½œå‡½æ•°ä¸­ä½¿ç”¨ä¾èµ–é¡¹çš„è¿”å›å€¼ã€‚</p>
<p>æˆ–è€…è¯´ï¼Œæœ‰äº›ä¾èµ–é¡¹ä¸è¿”å›å€¼ã€‚</p>
<p>ä½†ä»è¦æ‰§è¡Œæˆ–è§£æè¯¥ä¾èµ–é¡¹ã€‚</p>
<p>å¯¹äºè¿™ç§æƒ…å†µï¼Œä¸å¿…åœ¨å£°æ˜è·¯å¾„æ“ä½œå‡½æ•°çš„å‚æ•°æ—¶ä½¿ç”¨ <code>Depends</code>ï¼Œè€Œæ˜¯å¯ä»¥åœ¨è·¯å¾„æ“ä½œè£…é¥°å™¨ä¸­æ·»åŠ ä¸€ä¸ªç”± <code>dependencies</code> ç»„æˆçš„ <code>list</code>ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Header, HTTPException, Depends</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">verify_token</span>(<span class="params">x_token: <span class="built_in">str</span> = Header(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="keyword">if</span> x_token != <span class="string">&quot;fake-super-secret-token&quot;</span>:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">400</span>, detail=<span class="string">&quot;X-Token header invalid&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">verify_key</span>(<span class="params">x_key: <span class="built_in">str</span> = Header(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="keyword">if</span> x_key != <span class="string">&quot;fake-super-secret-key&quot;</span>:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">400</span>, detail=<span class="string">&quot;X-Key header invalid&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> x_key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span>, dependencies=[Depends(<span class="params">verify_token</span>), Depends(<span class="params">verify_key</span>)]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>():</span><br><span class="line">    <span class="keyword">return</span> [&#123;<span class="string">&quot;item&quot;</span>: <span class="string">&quot;Foo&quot;</span>&#125;, &#123;<span class="string">&quot;item&quot;</span>: <span class="string">&quot;Bar&quot;</span>&#125;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app)</span><br></pre></td></tr></table></figure>

<p>è·¯å¾„æ“ä½œè£…é¥°å™¨ä¾èµ–é¡¹ï¼ˆä»¥ä¸‹ç®€ç§°ä¸ºâ€œè·¯å¾„è£…é¥°å™¨ä¾èµ–é¡¹â€ï¼‰çš„æ‰§è¡Œæˆ–è§£ææ–¹å¼å’Œæ™®é€šä¾èµ–é¡¹ä¸€æ ·ï¼Œä½†å°±ç®—è¿™äº›ä¾èµ–é¡¹ä¼šè¿”å›å€¼ï¼Œå®ƒä»¬çš„å€¼ä¹Ÿä¸ä¼šä¼ é€’ç»™è·¯å¾„æ“ä½œå‡½æ•°ã€‚</p>
<h3 id="å…¨å±€ä¾èµ–é¡¹"><a href="#å…¨å±€ä¾èµ–é¡¹" class="headerlink" title="å…¨å±€ä¾èµ–é¡¹"></a>å…¨å±€ä¾èµ–é¡¹</h3><p>æœ‰æ—¶ï¼Œæˆ‘ä»¬è¦ä¸ºæ•´ä¸ªåº”ç”¨æ·»åŠ ä¾èµ–é¡¹ã€‚</p>
<p>é€šè¿‡ä¸å®šä¹‰è·¯å¾„è£…é¥°å™¨ä¾èµ–é¡¹ ç±»ä¼¼çš„æ–¹å¼ï¼Œå¯ä»¥æŠŠä¾èµ–é¡¹æ·»åŠ è‡³æ•´ä¸ª FastAPI åº”ç”¨ã€‚</p>
<p>è¿™æ ·ä¸€æ¥ï¼Œå°±å¯ä»¥ä¸ºæ‰€æœ‰è·¯å¾„æ“ä½œåº”ç”¨è¯¥ä¾èµ–é¡¹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Depends, FastAPI, Header, HTTPException</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">verify_token</span>(<span class="params">x_token: <span class="built_in">str</span> = Header(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="keyword">if</span> x_token != <span class="string">&quot;fake-super-secret-token&quot;</span>:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">400</span>, detail=<span class="string">&quot;X-Token header invalid&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">verify_key</span>(<span class="params">x_key: <span class="built_in">str</span> = Header(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="keyword">if</span> x_key != <span class="string">&quot;fake-super-secret-key&quot;</span>:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">400</span>, detail=<span class="string">&quot;X-Key header invalid&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> x_key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = FastAPI(dependencies=[Depends(verify_token), Depends(verify_key)])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>():</span><br><span class="line">    <span class="keyword">return</span> [&#123;<span class="string">&quot;item&quot;</span>: <span class="string">&quot;Portal Gun&quot;</span>&#125;, &#123;<span class="string">&quot;item&quot;</span>: <span class="string">&quot;Plumbus&quot;</span>&#125;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_users</span>():</span><br><span class="line">    <span class="keyword">return</span> [&#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;Rick&quot;</span>&#125;, &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;Morty&quot;</span>&#125;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app)</span><br></pre></td></tr></table></figure>

<h2 id="å®‰å…¨æ€§"><a href="#å®‰å…¨æ€§" class="headerlink" title="å®‰å…¨æ€§"></a>å®‰å…¨æ€§</h2><h2 id="ä¸­é—´ä»¶"><a href="#ä¸­é—´ä»¶" class="headerlink" title="ä¸­é—´ä»¶"></a>ä¸­é—´ä»¶</h2><p>ä½ å¯ä»¥å‘ <strong>FastAPI</strong> åº”ç”¨æ·»åŠ ä¸­é—´ä»¶.</p>
<p>â€œä¸­é—´ä»¶â€æ˜¯ä¸€ä¸ªå‡½æ•°,å®ƒåœ¨æ¯ä¸ª<strong>è¯·æ±‚</strong>è¢«ç‰¹å®šçš„<em>è·¯å¾„æ“ä½œ</em>å¤„ç†ä¹‹å‰,ä»¥åŠåœ¨æ¯ä¸ª<strong>å“åº”</strong>è¿”å›ä¹‹å‰å·¥ä½œ.</p>
<ul>
<li>å®ƒæ¥æ”¶ä½ çš„åº”ç”¨ç¨‹åºçš„æ¯ä¸€ä¸ª<strong>è¯·æ±‚</strong>.</li>
<li>ç„¶åå®ƒå¯ä»¥å¯¹è¿™ä¸ª<strong>è¯·æ±‚</strong>åšä¸€äº›äº‹æƒ…æˆ–è€…æ‰§è¡Œä»»ä½•éœ€è¦çš„ä»£ç .</li>
<li>ç„¶åå®ƒå°†<strong>è¯·æ±‚</strong>ä¼ é€’ç»™åº”ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ† (é€šè¿‡æŸç§<em>è·¯å¾„æ“ä½œ</em>).</li>
<li>ç„¶åå®ƒè·å–åº”ç”¨ç¨‹åºç”Ÿäº§çš„<strong>å“åº”</strong> (é€šè¿‡æŸç§<em>è·¯å¾„æ“ä½œ</em>).</li>
<li>å®ƒå¯ä»¥å¯¹è¯¥<strong>å“åº”</strong>åšäº›ä»€ä¹ˆæˆ–è€…æ‰§è¡Œä»»ä½•éœ€è¦çš„ä»£ç .</li>
<li>ç„¶åå®ƒè¿”å›è¿™ä¸ª <strong>å“åº”</strong>.</li>
</ul>
<h3 id="åˆ›å»ºä¸­é—´ä»¶"><a href="#åˆ›å»ºä¸­é—´ä»¶" class="headerlink" title="åˆ›å»ºä¸­é—´ä»¶"></a>åˆ›å»ºä¸­é—´ä»¶</h3><p>è¦åˆ›å»ºä¸­é—´ä»¶ä½ å¯ä»¥åœ¨å‡½æ•°çš„é¡¶éƒ¨ä½¿ç”¨è£…é¥°å™¨ <code>@app.middleware(&quot;http&quot;)</code>.</p>
<p>ä¸­é—´ä»¶å‚æ•°æ¥æ”¶å¦‚ä¸‹å‚æ•°:</p>
<ul>
<li><p><code>request</code>.</p>
</li>
<li><p>ä¸€ä¸ªå‡½æ•° <code>call_next</code> å®ƒå°†æ¥æ”¶ <code>request</code>ä½œä¸ºå‚æ•°.</p>
<ul>
<li>è¿™ä¸ªå‡½æ•°å°† <code>request</code> ä¼ é€’ç»™ç›¸åº”çš„ <em>è·¯å¾„æ“ä½œ</em>.</li>
<li>ç„¶åå®ƒå°†è¿”å›ç”±ç›¸åº”çš„<em>è·¯å¾„æ“ä½œ</em>ç”Ÿæˆçš„ <code>response</code>.</li>
</ul>
</li>
<li><p>ç„¶åä½ å¯ä»¥åœ¨è¿”å› <code>response</code> å‰è¿›ä¸€æ­¥ä¿®æ”¹å®ƒ.</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Request</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.middleware(<span class="params"><span class="string">&quot;http&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">add_process_time_header</span>(<span class="params">request: Request, call_next</span>):</span><br><span class="line">    start_time = time.perf_counter()</span><br><span class="line">    response = <span class="keyword">await</span> call_next(request)</span><br><span class="line">    process_time = time.perf_counter() - start_time</span><br><span class="line">    response.headers[<span class="string">&quot;X-Process-Time&quot;</span>] = <span class="built_in">str</span>(process_time)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">item_id: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/7243420e2c4a52c95d0c3d8a9fbeba07afa120bcfd68014bc225fb834aecc04b.png" alt="å›¾ 53">  </p>
<h3 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h3><p>CORSï¼ˆCross-Origin Resource Sharingï¼Œè·¨æºèµ„æºå…±äº«ï¼‰æ˜¯ä¸€ç§æµè§ˆå™¨å®‰å…¨æœºåˆ¶ï¼Œç”¨äºå…è®¸æˆ–é™åˆ¶ Web é¡µé¢ä»ä¸€ä¸ªæºï¼ˆoriginï¼‰è¯·æ±‚å¦ä¸€ä¸ªæºçš„èµ„æºã€‚æºç”±åè®®ï¼ˆprotocolï¼Œå¦‚ http&#x2F;httpsï¼‰ã€åŸŸåï¼ˆdomainï¼‰å’Œç«¯å£ï¼ˆportï¼‰ç»„æˆï¼Œä¾‹å¦‚ <a href="https://example.com/">https://example.com:443</a> æ˜¯ä¸€ä¸ªæºã€‚å¦‚æœä¸¤ä¸ªæºä¸åŒï¼Œå³ä¸ºè·¨æºï¼ˆcross-originï¼‰è¯·æ±‚ã€‚</p>
<p>CORS ä¸»è¦è§£å†³æµè§ˆå™¨ä¸­çš„â€œåŒæºç­–ç•¥â€ï¼ˆSame-Origin Policyï¼ŒSOPï¼‰é—®é¢˜ã€‚åŒæºç­–ç•¥æ˜¯æµè§ˆå™¨é»˜è®¤çš„å®‰å…¨é™åˆ¶ï¼Œé˜²æ­¢è„šæœ¬ä»ä¸€ä¸ªæºè®¿é—®å¦ä¸€ä¸ªæºçš„èµ„æºï¼Œä»¥é¿å…æ¶æ„æ”»å‡»å¦‚ XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰æˆ– CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰ã€‚ç„¶è€Œï¼Œåœ¨ç°ä»£ Web å¼€å‘ä¸­ï¼Œè·¨åŸŸè¯·æ±‚å¾ˆå¸¸è§ï¼ˆå¦‚å‰ç«¯è°ƒç”¨åç«¯ APIï¼‰ï¼ŒCORS æä¾›äº†ä¸€ç§æ ‡å‡†æ–¹å¼æ¥æ”¾æ¾è¿™ä¸€é™åˆ¶ï¼Œç”±æœåŠ¡å™¨å†³å®šæ˜¯å¦å…è®¸è·¨æºè®¿é—®ã€‚</p>
<ul>
<li>å…³é”®æœ¯è¯­ï¼š<ul>
<li><strong>ç®€å•è¯·æ±‚</strong>ï¼šä¸è§¦å‘é¢„æ£€çš„è¯·æ±‚ï¼Œå¦‚ GETã€HEADã€POSTï¼ˆç‰¹å®š Content-Typeï¼‰ã€‚</li>
<li><strong>å¤æ‚è¯·æ±‚</strong>ï¼šéœ€è¦é¢„æ£€çš„è¯·æ±‚ï¼Œå¦‚ PUTã€DELETE æˆ–è‡ªå®šä¹‰å¤´éƒ¨ã€‚</li>
<li><strong>é¢„æ£€è¯·æ±‚</strong>ï¼šæµè§ˆå™¨åœ¨å®é™…è¯·æ±‚å‰å‘é€ OPTIONS æ–¹æ³•çš„è¯·æ±‚ï¼Œè¯¢é—®æœåŠ¡å™¨æ˜¯å¦å…è®¸ã€‚</li>
<li><strong>å‡­è¯</strong>ï¼šåŒ…æ‹¬ Cookiesã€HTTP è®¤è¯ç­‰ï¼ŒCORS æ”¯æŒ withCredentials æ—¶éœ€ç‰¹æ®Šå¤„ç†ã€‚</li>
</ul>
</li>
</ul>
<p>CORS äº 2009 å¹´ç”± W3C æå‡ºï¼Œå¹¶åœ¨ç°ä»£æµè§ˆå™¨ï¼ˆå¦‚ Chromeã€Firefoxã€Safariï¼‰ä¸­å¹¿æ³›æ”¯æŒã€‚å®ƒä¸æ˜¯æœåŠ¡å™¨ç«¯å¼ºåˆ¶ï¼Œè€Œæ˜¯æµè§ˆå™¨ç«¯æ‰§è¡Œçš„æœºåˆ¶ã€‚</p>
<h4 id="CORS-çš„åŸç†"><a href="#CORS-çš„åŸç†" class="headerlink" title="CORS çš„åŸç†"></a>CORS çš„åŸç†</h4><p>CORS çš„æ ¸å¿ƒæ˜¯é€šè¿‡ HTTP å¤´éƒ¨åœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰å’ŒæœåŠ¡å™¨ä¹‹é—´åå•†è®¿é—®æƒé™ã€‚æµè§ˆå™¨è‡ªåŠ¨å¤„ç† CORS é€»è¾‘ï¼ŒæœåŠ¡å™¨é€šè¿‡å“åº”å¤´éƒ¨æŒ‡ç¤ºå…è®¸çš„æºã€æ–¹æ³•ç­‰ã€‚</p>
<h4 id="å·¥ä½œæµç¨‹"><a href="#å·¥ä½œæµç¨‹" class="headerlink" title="å·¥ä½œæµç¨‹"></a>å·¥ä½œæµç¨‹</h4><ul>
<li><p><strong>æ­¥éª¤ 1ï¼šæµè§ˆå™¨å‘èµ·è¯·æ±‚</strong> å½“ JavaScriptï¼ˆå¦‚ XMLHttpRequest æˆ– Fetch APIï¼‰ä»ä¸€ä¸ªæºè¯·æ±‚å¦ä¸€ä¸ªæºçš„èµ„æºæ—¶ï¼Œæµè§ˆå™¨æ£€æŸ¥æ˜¯å¦è·¨æºã€‚å¦‚æœæ˜¯ï¼Œæµè§ˆå™¨ä¼šæ ¹æ®è¯·æ±‚ç±»å‹å†³å®šæ˜¯å¦å‘é€é¢„æ£€è¯·æ±‚ã€‚</p>
</li>
<li><p><strong>æ­¥éª¤ 2ï¼šé¢„æ£€è¯·æ±‚</strong>ï¼ˆå¦‚æœé€‚ç”¨ï¼‰</p>
<p>å¯¹äºå¤æ‚è¯·æ±‚ï¼Œæµè§ˆå™¨å…ˆå‘é€ä¸€ä¸ª OPTIONS è¯·æ±‚ï¼ˆé¢„æ£€ï¼‰ï¼ŒåŒ…å«ï¼š</p>
<ul>
<li>Originï¼šè¯·æ±‚æºï¼ˆå¦‚ <a target="_blank" rel="noopener" href="https://client.com)./">https://client.comï¼‰ã€‚</a></li>
<li>Access-Control-Request-Methodï¼šå®é™…è¯·æ±‚çš„æ–¹æ³•ï¼ˆå¦‚ POSTï¼‰ã€‚</li>
<li>Access-Control-Request-Headersï¼šå®é™…è¯·æ±‚çš„è‡ªå®šä¹‰å¤´éƒ¨ï¼ˆå¦‚ X-Custom-Headerï¼‰ã€‚</li>
</ul>
<p>æœåŠ¡å™¨å“åº”é¢„æ£€ï¼ŒæŒ‡ç¤ºæ˜¯å¦å…è®¸ï¼š</p>
<ul>
<li>å¦‚æœå…è®¸ï¼Œæµè§ˆå™¨ç»§ç»­å®é™…è¯·æ±‚ã€‚</li>
<li>å¦‚æœä¸å…è®¸ï¼Œæµè§ˆå™¨æŠ›å‡º CORS é”™è¯¯ï¼ˆå¦‚ â€œNo â€˜Access-Control-Allow-Originâ€™ header is presentâ€ï¼‰ã€‚</li>
</ul>
</li>
<li><p><strong>æ­¥éª¤ 3ï¼šå®é™…è¯·æ±‚</strong> æµè§ˆå™¨å‘é€å®é™…è¯·æ±‚ï¼ŒæœåŠ¡å™¨åœ¨å“åº”ä¸­æ·»åŠ  CORS å¤´éƒ¨ã€‚æµè§ˆå™¨æ£€æŸ¥è¿™äº›å¤´éƒ¨ï¼Œå¦‚æœåŒ¹é…ï¼Œåˆ™å…è®¸è„šæœ¬è®¿é—®å“åº”æ•°æ®ï¼›å¦åˆ™ï¼Œé˜»å¡è®¿é—®ã€‚</p>
</li>
</ul>
<h4 id="å…³é”®-HTTP-å¤´éƒ¨"><a href="#å…³é”®-HTTP-å¤´éƒ¨" class="headerlink" title="å…³é”® HTTP å¤´éƒ¨"></a>å…³é”® HTTP å¤´éƒ¨</h4><p>ä½¿ç”¨è¡¨æ ¼åˆ—å‡ºå¸¸ç”¨å¤´éƒ¨ï¼š</p>
<table>
<thead>
<tr>
<th>å¤´éƒ¨åç§°</th>
<th>ç±»å‹</th>
<th>æè¿°</th>
<th>ç¤ºä¾‹å€¼</th>
</tr>
</thead>
<tbody><tr>
<td>Origin</td>
<td>è¯·æ±‚å¤´éƒ¨</td>
<td>æµè§ˆå™¨è‡ªåŠ¨æ·»åŠ ï¼Œè¡¨ç¤ºè¯·æ±‚æºã€‚</td>
<td><a target="_blank" rel="noopener" href="https://client.com/">https://client.com</a></td>
</tr>
<tr>
<td>Access-Control-Allow-Origin</td>
<td>å“åº”å¤´éƒ¨</td>
<td>æŒ‡å®šå…è®¸çš„æºã€‚* è¡¨ç¤ºæ‰€æœ‰æºï¼ˆä¸å®‰å…¨ï¼Œä¸æ”¯æŒå‡­è¯ï¼‰ã€‚</td>
<td><a target="_blank" rel="noopener" href="https://client.com/">https://client.com</a> æˆ– *</td>
</tr>
<tr>
<td>Access-Control-Allow-Methods</td>
<td>å“åº”å¤´éƒ¨</td>
<td>æŒ‡å®šå…è®¸çš„ HTTP æ–¹æ³•ã€‚</td>
<td>GET, POST, OPTIONS</td>
</tr>
<tr>
<td>Access-Control-Allow-Headers</td>
<td>å“åº”å¤´éƒ¨</td>
<td>æŒ‡å®šå…è®¸çš„è‡ªå®šä¹‰è¯·æ±‚å¤´éƒ¨ã€‚</td>
<td>Content-Type, Authorization</td>
</tr>
<tr>
<td>Access-Control-Allow-Credentials</td>
<td>å“åº”å¤´éƒ¨</td>
<td>æ˜¯å¦å…è®¸å‘é€å‡­è¯ï¼ˆå¦‚ Cookiesï¼‰ã€‚å€¼ä¸º true æ—¶æœ‰æ•ˆã€‚</td>
<td>true</td>
</tr>
<tr>
<td>Access-Control-Expose-Headers</td>
<td>å“åº”å¤´éƒ¨</td>
<td>æŒ‡å®šæµè§ˆå™¨å¯è®¿é—®çš„å“åº”å¤´éƒ¨ï¼ˆé»˜è®¤åªæš´éœ²ç®€å•å¤´éƒ¨å¦‚ Cache-Controlï¼‰ã€‚</td>
<td>X-Custom-Response</td>
</tr>
<tr>
<td>Access-Control-Max-Age</td>
<td>å“åº”å¤´éƒ¨</td>
<td>é¢„æ£€ç»“æœç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œå‡å°‘é‡å¤é¢„æ£€ã€‚</td>
<td>86400 (24 å°æ—¶)</td>
</tr>
<tr>
<td>Access-Control-Request-Method</td>
<td>è¯·æ±‚å¤´éƒ¨</td>
<td>é¢„æ£€æ—¶è¡¨ç¤ºå®é™…æ–¹æ³•ï¼ˆæµè§ˆå™¨è‡ªåŠ¨æ·»åŠ ï¼‰ã€‚</td>
<td>POST</td>
</tr>
<tr>
<td>Access-Control-Request-Headers</td>
<td>è¯·æ±‚å¤´éƒ¨</td>
<td>é¢„æ£€æ—¶è¡¨ç¤ºå®é™…è‡ªå®šä¹‰å¤´éƒ¨ï¼ˆæµè§ˆå™¨è‡ªåŠ¨æ·»åŠ ï¼‰ã€‚</td>
<td>X-API-Key</td>
</tr>
</tbody></table>
<ul>
<li>ç®€å•è¯·æ±‚ vs å¤æ‚è¯·æ±‚ï¼š<ul>
<li><strong>ç®€å•è¯·æ±‚</strong>ï¼šä¸éœ€é¢„æ£€ã€‚æ¡ä»¶ï¼šæ–¹æ³•ä¸º GET&#x2F;HEAD&#x2F;POSTï¼›Content-Type ä¸º text&#x2F;plainã€multipart&#x2F;form-data æˆ– application&#x2F;x-www-form-urlencodedï¼›æ— è‡ªå®šä¹‰å¤´éƒ¨ã€‚</li>
<li><strong>å¤æ‚è¯·æ±‚</strong>ï¼šéœ€é¢„æ£€ã€‚å…¶ä»–æƒ…å†µï¼Œå¦‚ DELETE æ–¹æ³•æˆ–æ·»åŠ  Authorization å¤´éƒ¨ã€‚</li>
</ul>
</li>
</ul>
<h4 id="å®‰å…¨è€ƒè™‘"><a href="#å®‰å…¨è€ƒè™‘" class="headerlink" title="å®‰å…¨è€ƒè™‘"></a>å®‰å…¨è€ƒè™‘</h4><ul>
<li>CORS ä¾èµ–æœåŠ¡å™¨ä¿¡ä»»å®¢æˆ·ç«¯æºï¼Œä½†æµè§ˆå™¨å¼ºåˆ¶æ‰§è¡Œã€‚</li>
<li>é£é™©ï¼šå¦‚æœæœåŠ¡å™¨å…è®¸ *ï¼Œå¯èƒ½æš´éœ²æ•æ„Ÿæ•°æ®ã€‚æ¨èæŒ‡å®šç¡®åˆ‡æºã€‚</li>
<li>ä¸å…¶ä»–æœºåˆ¶ç»“åˆï¼šå¦‚ CSPï¼ˆContent Security Policyï¼‰è¿›ä¸€æ­¥é™åˆ¶ã€‚</li>
<li>æµè§ˆå™¨å®ç°ï¼šä¸åŒæµè§ˆå™¨ç•¥æœ‰å·®å¼‚ï¼Œä½†éµå¾ª W3C æ ‡å‡†ã€‚æ—§æµè§ˆå™¨ï¼ˆå¦‚ IE9ï¼‰æ”¯æŒæœ‰é™ã€‚</li>
</ul>
<h4 id="å†…éƒ¨å®ç°ç»†èŠ‚"><a href="#å†…éƒ¨å®ç°ç»†èŠ‚" class="headerlink" title="å†…éƒ¨å®ç°ç»†èŠ‚"></a>å†…éƒ¨å®ç°ç»†èŠ‚</h4><ul>
<li>æµè§ˆå™¨ä½¿ç”¨ Fetch API æˆ– XHR æ—¶ï¼Œè‡ªåŠ¨å¤„ç† Origin å’Œ CORS æ£€æŸ¥ã€‚</li>
<li>æœåŠ¡å™¨ç«¯ï¼šéœ€é…ç½®ï¼ˆå¦‚ Nginx çš„ add_headerã€Apache çš„ Header setï¼‰æˆ–æ¡†æ¶ï¼ˆå¦‚ Express çš„ cors ä¸­é—´ä»¶ï¼‰æ¥æ·»åŠ å“åº”å¤´éƒ¨ã€‚</li>
<li>é”™è¯¯è°ƒè¯•ï¼šæ§åˆ¶å°æ˜¾ç¤º CORS é”™è¯¯ï¼Œå¸¸è§åŸå› æ˜¯å“åº”ç¼ºå°‘ Allow-Origin æˆ–æ–¹æ³•ä¸åŒ¹é…ã€‚</li>
</ul>
<h3 id="CORSMiddleware"><a href="#CORSMiddleware" class="headerlink" title="CORSMiddleware"></a>CORSMiddleware</h3><p>ä½ å¯ä»¥åœ¨ <strong>FastAPI</strong> åº”ç”¨ä¸­ä½¿ç”¨ <code>CORSMiddleware</code> æ¥é…ç½®å®ƒã€‚</p>
<ul>
<li>å¯¼å…¥ <code>CORSMiddleware</code>ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªå…è®¸çš„æºåˆ—è¡¨ï¼ˆç”±å­—ç¬¦ä¸²ç»„æˆï¼‰ã€‚</li>
<li>å°†å…¶ä½œä¸ºã€Œä¸­é—´ä»¶ã€æ·»åŠ åˆ°ä½ çš„ <strong>FastAPI</strong> åº”ç”¨ä¸­ã€‚</li>
</ul>
<p>ä½ ä¹Ÿå¯ä»¥æŒ‡å®šåç«¯æ˜¯å¦å…è®¸ï¼š</p>
<ul>
<li>å‡­è¯ï¼ˆæˆæƒ headersï¼ŒCookies ç­‰ï¼‰ã€‚</li>
<li>ç‰¹å®šçš„ HTTP æ–¹æ³•ï¼ˆ<code>POST</code>ï¼Œ<code>PUT</code>ï¼‰æˆ–è€…ä½¿ç”¨é€šé…ç¬¦ <code>&quot;*&quot;</code> å…è®¸æ‰€æœ‰æ–¹æ³•ã€‚</li>
<li>ç‰¹å®šçš„ HTTP headers æˆ–è€…ä½¿ç”¨é€šé…ç¬¦ <code>&quot;*&quot;</code> å…è®¸æ‰€æœ‰ headersã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line">origins = [</span><br><span class="line">    <span class="string">&quot;http://localhost.example.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://localhost.example.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;http://localhost&quot;</span>,</span><br><span class="line">    <span class="string">&quot;http://localhost:8080&quot;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">int</span>, q: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;q&quot;</span>: q&#125;</span><br></pre></td></tr></table></figure>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ª <code>CORSMiddleware</code> å®ç°æ‰€ä½¿ç”¨çš„é»˜è®¤å‚æ•°è¾ƒä¸ºä¿å®ˆï¼Œæ‰€ä»¥ä½ éœ€è¦æ˜¾å¼åœ°å¯ç”¨ç‰¹å®šçš„æºã€æ–¹æ³•æˆ–è€… headersï¼Œä»¥ä¾¿æµè§ˆå™¨èƒ½å¤Ÿåœ¨è·¨åŸŸä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨å®ƒä»¬ã€‚</p>
<p>æ”¯æŒä»¥ä¸‹å‚æ•°ï¼š</p>
<ul>
<li><code>allow_origins</code> - ä¸€ä¸ªå…è®¸è·¨åŸŸè¯·æ±‚çš„æºåˆ—è¡¨ã€‚ä¾‹å¦‚ <code>[&#39;https://example.org&#39;, &#39;https://www.example.org&#39;]</code>ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>[&#39;*&#39;]</code> å…è®¸ä»»ä½•æºã€‚</li>
<li><code>allow_origin_regex</code> - ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²ï¼ŒåŒ¹é…çš„æºå…è®¸è·¨åŸŸè¯·æ±‚ã€‚ä¾‹å¦‚ <code>&#39;https://.*\.example\.org&#39;</code>ã€‚</li>
<li><code>allow_methods</code> - ä¸€ä¸ªå…è®¸è·¨åŸŸè¯·æ±‚çš„ HTTP æ–¹æ³•åˆ—è¡¨ã€‚é»˜è®¤ä¸º <code>[&#39;GET&#39;]</code>ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>[&#39;*&#39;]</code> æ¥å…è®¸æ‰€æœ‰æ ‡å‡†æ–¹æ³•ã€‚</li>
<li><code>allow_headers</code> - ä¸€ä¸ªå…è®¸è·¨åŸŸè¯·æ±‚çš„ HTTP è¯·æ±‚å¤´åˆ—è¡¨ã€‚é»˜è®¤ä¸º <code>[]</code>ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>[&#39;*&#39;]</code> å…è®¸æ‰€æœ‰çš„è¯·æ±‚å¤´ã€‚<code>Accept</code>ã€<code>Accept-Language</code>ã€<code>Content-Language</code> ä»¥åŠ <code>Content-Type</code> è¯·æ±‚å¤´æ€»æ˜¯å…è®¸ CORS è¯·æ±‚ã€‚</li>
<li><code>allow_credentials</code> - æŒ‡ç¤ºè·¨åŸŸè¯·æ±‚æ”¯æŒ cookiesã€‚é»˜è®¤æ˜¯ <code>False</code>ã€‚å¦å¤–ï¼Œå…è®¸å‡­è¯æ—¶ <code>allow_origins</code> ä¸èƒ½è®¾å®šä¸º <code>[&#39;*&#39;]</code>ï¼Œå¿…é¡»æŒ‡å®šæºã€‚</li>
<li><code>expose_headers</code> - æŒ‡ç¤ºå¯ä»¥è¢«æµè§ˆå™¨è®¿é—®çš„å“åº”å¤´ã€‚é»˜è®¤ä¸º <code>[]</code>ã€‚</li>
<li><code>max_age</code> - è®¾å®šæµè§ˆå™¨ç¼“å­˜ CORS å“åº”çš„æœ€é•¿æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ã€‚é»˜è®¤ä¸º <code>600</code>ã€‚</li>
</ul>
<p>ä¸­é—´ä»¶å“åº”ä¸¤ç§ç‰¹å®šç±»å‹çš„ HTTP è¯·æ±‚â€¦â€¦</p>
<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><h3 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h3><p>å¯¼å…¥ <code>TestClient</code>.</p>
<p>é€šè¿‡ä¼ å…¥ä½ çš„<strong>FastAPI</strong>åº”ç”¨åˆ›å»ºä¸€ä¸ª <code>TestClient</code> ã€‚</p>
<p>åˆ›å»ºåå­—ä»¥ <code>test_</code> å¼€å¤´çš„å‡½æ•°ï¼ˆè¿™æ˜¯æ ‡å‡†çš„ <code>pytest</code> çº¦å®šï¼‰ã€‚</p>
<p>åƒä½¿ç”¨ <code>httpx</code> é‚£æ ·ä½¿ç”¨ <code>TestClient</code> å¯¹è±¡ã€‚</p>
<p>ä¸ºä½ éœ€è¦æ£€æŸ¥çš„åœ°æ–¹ç”¨æ ‡å‡†çš„Pythonè¡¨è¾¾å¼å†™ä¸ªç®€å•çš„ <code>assert</code> è¯­å¥ï¼ˆé‡ç”³ï¼Œæ ‡å‡†çš„<code>pytest</code>ï¼‰ã€‚</p>
<p><code>main.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.testclient <span class="keyword">import</span> TestClient</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_main</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">client = TestClient(app)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_read_main</span>():</span><br><span class="line">    response = client.get(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">    <span class="keyword">assert</span> response.status_code == <span class="number">200</span></span><br><span class="line">    <span class="keyword">assert</span> response.json() == &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uv pip install pytest</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/1e51c5b0f13754b05f18d7a23257a31e67e2a519d71b13d5f6463aeaacdb954c.png" alt="å›¾ 54">  </p>
<h3 id="åˆ†ç¦»æµ‹è¯•"><a href="#åˆ†ç¦»æµ‹è¯•" class="headerlink" title="åˆ†ç¦»æµ‹è¯•"></a>åˆ†ç¦»æµ‹è¯•</h3><p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/5321b8b917f15085d5605fbf55ca422b04c90fa2fcf4f62f4d5b963c9abe6c3b.png" alt="å›¾ 55">  </p>
<p><code>main.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_main</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p><code>test_main.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi.testclient <span class="keyword">import</span> TestClient</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .main <span class="keyword">import</span> app</span><br><span class="line"></span><br><span class="line">client = TestClient(app)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_read_main</span>():</span><br><span class="line">    response = client.get(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">    <span class="keyword">assert</span> response.status_code == <span class="number">200</span></span><br><span class="line">    <span class="keyword">assert</span> response.json() == &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lianyutian/tuchuang1@main/img/71384ebc54e5845268ba861aeb370970df4570e3c90b162c406c82cb891422b9.png" alt="å›¾ 56">  </p>
</article>
<div class="article-footer">
    <section id="license">
      <div class="header"><span>è®¸å¯åè®®</span></div>
      <div class="body"><p>æœ¬æ–‡é‡‡ç”¨ <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…</a> è®¸å¯åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</div>
    </section>
    

</div>

<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"></div><div class="item" id="next"><div class="note">è¾ƒæ—©æ–‡ç« </div><a href="/2025/04/08/Docker/">Docker</a></div></section></div>






<footer class="page-footer footnote"><hr><div class="text"><div>
<span id="runtime_span"></span>
<script type="text/javascript">
function show_runtime() {
    window.setTimeout("show_runtime()", 1000);
    X = new Date("2023/11/20 17:00:00"); // ç½‘ç«™å¼€å§‹è¿è¡Œçš„æ—¥æœŸå’Œæ—¶é—´
    Y = new Date(); // å½“å‰æ—¥æœŸå’Œæ—¶é—´
    T = (Y.getTime() - X.getTime()); // ç½‘ç«™è¿è¡Œçš„æ€»æ¯«ç§’æ•°
    M = 24 * 60 * 60 * 1000; // ä¸€å¤©çš„æ¯«ç§’æ•°
    a = T / M; // æ€»å¤©æ•°
    A = Math.floor(a); // æ€»å¤©æ•°çš„æ•´æ•°éƒ¨åˆ†
    b = (a - A) * 24; // æ€»å°æ—¶æ•°
    B = Math.floor(b); // æ€»å°æ—¶æ•°çš„æ•´æ•°éƒ¨åˆ†
    c = (b - B) * 60; // æ€»åˆ†é’Ÿæ•°
    C = Math.floor((b - B) * 60); // æ€»åˆ†é’Ÿæ•°çš„æ•´æ•°éƒ¨åˆ†
    D = Math.floor((c - C) * 60); // æ€»ç§’æ•°
    runtime_span.innerHTML = "â±ï¸å°ç ´ç«™è‡³ä»Šè¿è¡Œ <span class='runtime'>" + A + "å¤©" + B + "å°æ—¶" + C + "åˆ†" + D + "ç§’</span>";
}
show_runtime();
</script> 
<img src="/assets/cat.gif" alt="" style="float: right; width: 30px;">
</div>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="false"><div class="widget-header dis-select"><span class="name">æœ¬æ–‡ç›®å½•</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-text">ç®€ä»‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-text">å®‰è£…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5"><span class="toc-text">ç¬¬ä¸€æ­¥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8FastAPI"><span class="toc-text">å¯åŠ¨FastAPI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%AD%A5%E6%A6%82%E6%8B%AC"><span class="toc-text">åˆ†æ­¥æ¦‚æ‹¬</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A41%EF%BC%9A%E5%AF%BC%E5%85%A5Fast-API"><span class="toc-text">æ­¥éª¤1ï¼šå¯¼å…¥Fast API</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A42%EF%BC%9A%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-FastAPI%E3%80%90%E5%AE%9E%E4%BE%8B%E3%80%91"><span class="toc-text">æ­¥éª¤2ï¼šåˆ›å»ºä¸€ä¸ª FastAPIã€å®ä¾‹ã€‘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-3%EF%BC%9A%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E3%80%90%E8%B7%AF%E5%BE%84%E6%93%8D%E4%BD%9C%E3%80%91"><span class="toc-text">æ­¥éª¤ 3ï¼šåˆ›å»ºä¸€ä¸ªã€è·¯å¾„æ“ä½œã€‘</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84"><span class="toc-text">è·¯å¾„</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C"><span class="toc-text">æ“ä½œ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E3%80%90%E8%B7%AF%E5%BE%84%E6%93%8D%E4%BD%9C%E8%A3%85%E9%A5%B0%E5%99%A8%E3%80%91"><span class="toc-text">å®šä¹‰ä¸€ä¸ªã€è·¯å¾„æ“ä½œè£…é¥°å™¨ã€‘</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A44%EF%BC%9A%E5%AE%9A%E4%B9%89%E3%80%90%E8%B7%AF%E5%BE%84%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0%E3%80%91"><span class="toc-text">æ­¥éª¤4ï¼šå®šä¹‰ã€è·¯å¾„æ“ä½œå‡½æ•°ã€‘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A45%EF%BC%9A%E8%BF%94%E5%9B%9E%E5%86%85%E5%AE%B9"><span class="toc-text">æ­¥éª¤5ï¼šè¿”å›å†…å®¹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">æ€»ç»“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E4%BA%92%E5%BC%8FAPI%E6%96%87%E6%A1%A3"><span class="toc-text">äº¤äº’å¼APIæ–‡æ¡£</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0"><span class="toc-text">è·¯å¾„å‚æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-text">æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-text">å£°æ˜è·¯å¾„å‚æ•°ç±»å‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%AE%9A%E4%B9%89%E9%A1%BA%E5%BA%8F"><span class="toc-text">æ–¹æ³•å®šä¹‰é¡ºåº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E8%AE%BE%E5%80%BC"><span class="toc-text">é¢„è®¾å€¼</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Enum%E9%A2%84%E8%AE%BE%E8%B7%AF%E5%BE%84"><span class="toc-text">Enumé¢„è®¾è·¯å¾„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0"><span class="toc-text">å£°æ˜è·¯å¾„å‚æ•°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%85%E5%90%AB%E8%B7%AF%E5%BE%84%E7%9A%84%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0"><span class="toc-text">åŒ…å«è·¯å¾„çš„è·¯å¾„å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E8%BD%AC%E6%8D%A2%E5%99%A8"><span class="toc-text">è·¯å¾„è½¬æ¢å™¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0"><span class="toc-text">æŸ¥è¯¢å‚æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-text">é»˜è®¤å€¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E9%80%89%E5%8F%82%E6%95%B0"><span class="toc-text">å¯é€‰å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-text">æŸ¥è¯¢å‚æ•°ç±»å‹è½¬æ¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E8%B7%AF%E5%BE%84%E5%92%8C%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0"><span class="toc-text">å¤šä¸ªè·¯å¾„å’ŒæŸ¥è¯¢å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%85%E9%80%89%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0"><span class="toc-text">å¿…é€‰æŸ¥è¯¢å‚æ•°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E4%BD%93"><span class="toc-text">è¯·æ±‚ä½“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E4%BD%93%E6%A6%82%E5%BF%B5"><span class="toc-text">è¯·æ±‚ä½“æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-text">åˆ›å»ºæ•°æ®æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5-BaseModel"><span class="toc-text">å¯¼å…¥ BaseModel</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E8%AF%B7%E6%B1%82%E4%BD%93%E5%8F%82%E6%95%B0"><span class="toc-text">å£°æ˜è¯·æ±‚ä½“å‚æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E4%BD%93%E6%80%BB%E7%BB%93"><span class="toc-text">è¯·æ±‚ä½“æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%A8%A1%E5%9E%8B"><span class="toc-text">ä½¿ç”¨æ¨¡å‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E4%BD%93-%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0"><span class="toc-text">è¯·æ±‚ä½“ + è·¯å¾„å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E4%BD%93-%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0-%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0"><span class="toc-text">è¯·æ±‚ä½“ + è·¯å¾„å‚æ•° + æŸ¥è¯¢å‚æ•°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0%E5%92%8C%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%A1%E9%AA%8C"><span class="toc-text">æŸ¥è¯¢å‚æ•°å’Œå­—ç¬¦ä¸²æ ¡éªŒ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Query%E6%A3%80%E9%AA%8C"><span class="toc-text">Queryæ£€éªŒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E6%A0%A1%E9%AA%8C"><span class="toc-text">æ­£åˆ™æ ¡éªŒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Query-%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-text">Query é»˜è®¤å€¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E5%BF%85%E9%9C%80%E5%8F%82%E6%95%B0"><span class="toc-text">å£°æ˜å¿…éœ€å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-None-%E5%A3%B0%E6%98%8E%E5%BF%85%E9%9C%80%E5%8F%82%E6%95%B0"><span class="toc-text">ä½¿ç”¨ None å£°æ˜å¿…éœ€å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0%E5%88%97%E8%A1%A8"><span class="toc-text">æŸ¥è¯¢å‚æ•°åˆ—è¡¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%A6%E9%BB%98%E8%AE%A4%E5%80%BC%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0%E5%88%97%E8%A1%A8"><span class="toc-text">å¸¦é»˜è®¤å€¼çš„æŸ¥è¯¢å‚æ•°åˆ—è¡¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E6%9B%B4%E5%A4%9A%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-text">å£°æ˜æ›´å¤šå…ƒæ•°æ®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%AB%E5%90%8D%E5%8F%82%E6%95%B0"><span class="toc-text">åˆ«åå‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%83%E7%94%A8%E5%8F%82%E6%95%B0"><span class="toc-text">å¼ƒç”¨å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0%E5%92%8C%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%A1%E9%AA%8C%E6%80%BB%E7%BB%93"><span class="toc-text">æŸ¥è¯¢å‚æ•°å’Œå­—ç¬¦ä¸²æ ¡éªŒæ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0%E5%92%8C%E6%95%B0%E5%80%BC%E6%A0%A1%E9%AA%8C"><span class="toc-text">è·¯å¾„å‚æ•°å’Œæ•°å€¼æ ¡éªŒ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5-Path"><span class="toc-text">å¯¼å…¥ Path</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E9%9C%80%E5%AF%B9%E5%8F%82%E6%95%B0%E6%8E%92%E5%BA%8F"><span class="toc-text">æŒ‰éœ€å¯¹å‚æ•°æ’åº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E6%A0%A1%E9%AA%8C%EF%BC%9A%E5%A4%A7%E4%BA%8E%E7%AD%89%E4%BA%8E"><span class="toc-text">æ•°å€¼æ ¡éªŒï¼šå¤§äºç­‰äº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E6%A0%A1%E9%AA%8C%EF%BC%9A%E5%A4%A7%E4%BA%8E%E5%92%8C%E5%B0%8F%E4%BA%8E%E7%AD%89%E4%BA%8E"><span class="toc-text">æ•°å€¼æ ¡éªŒï¼šå¤§äºå’Œå°äºç­‰äº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E6%A0%A1%E9%AA%8C%EF%BC%9A%E6%B5%AE%E7%82%B9%E6%95%B0%E3%80%81%E5%A4%A7%E4%BA%8E%E5%92%8C%E5%B0%8F%E4%BA%8E"><span class="toc-text">æ•°å€¼æ ¡éªŒï¼šæµ®ç‚¹æ•°ã€å¤§äºå’Œå°äº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E6%A0%A1%E9%AA%8C%E6%80%BB%E7%BB%93"><span class="toc-text">æ•°å€¼æ ¡éªŒæ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0%E6%A8%A1%E5%9E%8B"><span class="toc-text">æŸ¥è¯¢å‚æ•°æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Pydantic-%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0"><span class="toc-text">ä½¿ç”¨ Pydantic æ¨¡å‹çš„æŸ¥è¯¢å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%81%E6%AD%A2%E9%A2%9D%E5%A4%96%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0"><span class="toc-text">ç¦æ­¢é¢å¤–çš„æŸ¥è¯¢å‚æ•°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E4%BD%93-%E5%A4%9A%E4%B8%AA%E5%8F%82%E6%95%B0"><span class="toc-text">è¯·æ±‚ä½“-å¤šä¸ªå‚æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B7%E5%90%88%E4%BD%BF%E7%94%A8-Path%E3%80%81Query-%E5%92%8C%E8%AF%B7%E6%B1%82%E4%BD%93%E5%8F%82%E6%95%B0"><span class="toc-text">æ··åˆä½¿ç”¨ Pathã€Query å’Œè¯·æ±‚ä½“å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E8%AF%B7%E6%B1%82%E4%BD%93%E5%8F%82%E6%95%B0"><span class="toc-text">å¤šä¸ªè¯·æ±‚ä½“å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E4%BD%93%E5%BD%93%E4%B8%AD%E7%9A%84%E5%8D%95%E4%B8%80%E5%80%BC"><span class="toc-text">è¯·æ±‚ä½“å½“ä¸­çš„å•ä¸€å€¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E8%AF%B7%E6%B1%82%E4%BD%93%E5%8F%82%E6%95%B0%E5%92%8C%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0"><span class="toc-text">å¤šä¸ªè¯·æ±‚ä½“å‚æ•°å’ŒæŸ¥è¯¢å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B5%8C%E5%85%A5%E5%8D%95%E4%B8%AA%E8%AF%B7%E6%B1%82%E4%BD%93%E5%8F%82%E6%95%B0"><span class="toc-text">åµŒå…¥å•ä¸ªè¯·æ±‚ä½“å‚æ•°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E4%BD%93-%E5%AD%97%E6%AE%B5"><span class="toc-text">è¯·æ±‚ä½“-å­—æ®µ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E4%BD%93-%E5%B5%8C%E5%A5%97%E6%A8%A1%E5%9E%8B"><span class="toc-text">è¯·æ±‚ä½“-åµŒå¥—æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#List%E5%AD%97%E6%AE%B5"><span class="toc-text">Listå­—æ®µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E6%9C%89%E5%AD%90%E7%B1%BB%E5%9E%8B%E7%9A%84List%E5%AD%97%E6%AE%B5"><span class="toc-text">å…·æœ‰å­ç±»å‹çš„Listå­—æ®µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E6%A8%A1%E5%9E%8B"><span class="toc-text">åµŒå¥—æ¨¡å‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E7%B1%BB%E5%9E%8B%E5%92%8C%E6%A0%A1%E9%AA%8C"><span class="toc-text">ç‰¹æ®Šç±»å‹å’Œæ ¡éªŒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E6%9C%89%E4%B8%80%E7%BB%84%E5%AD%90%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-text">å¸¦æœ‰ä¸€ç»„å­æ¨¡å‹çš„å±æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B1%E5%BA%A6%E5%B5%8C%E5%A5%97%E6%A8%A1%E5%9E%8B"><span class="toc-text">æ·±åº¦åµŒå¥—æ¨¡å‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%AF%E5%88%97%E8%A1%A8%E8%AF%B7%E6%B1%82%E4%BD%93"><span class="toc-text">çº¯åˆ—è¡¨è¯·æ±‚ä½“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E6%84%8F-dict-%E6%9E%84%E6%88%90%E7%9A%84%E8%AF%B7%E6%B1%82%E4%BD%93"><span class="toc-text">ä»»æ„ dict æ„æˆçš„è¯·æ±‚ä½“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E7%9A%84%E9%A2%9D%E5%A4%96%E4%BF%A1%E6%81%AF"><span class="toc-text">æ¨¡å¼çš„é¢å¤–ä¿¡æ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Pydantic-schema-extra"><span class="toc-text">Pydantic schema_extra</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Field-%E7%9A%84%E9%99%84%E5%8A%A0%E5%8F%82%E6%95%B0"><span class="toc-text">Field çš„é™„åŠ å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Body-%E9%A2%9D%E5%A4%96%E5%8F%82%E6%95%B0"><span class="toc-text">Body é¢å¤–å‚æ•°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%9D%E5%A4%96%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text">é¢å¤–æ•°æ®ç±»å‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cookie%E5%8F%82%E6%95%B0"><span class="toc-text">Cookieå‚æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Header-%E5%8F%82%E6%95%B0"><span class="toc-text">Header å‚æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E-Header-%E5%8F%82%E6%95%B0"><span class="toc-text">å£°æ˜ Header å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E8%BD%AC%E6%8D%A2"><span class="toc-text">è‡ªåŠ¨è½¬æ¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%A4%8D%E8%AF%B7%E6%B1%82%E5%A4%B4"><span class="toc-text">é‡å¤è¯·æ±‚å¤´</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cookie%E5%8F%82%E6%95%B0%E6%A8%A1%E5%9E%8B"><span class="toc-text">Cookieå‚æ•°æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E6%9C%89-Pydantic-%E6%A8%A1%E5%9E%8B%E7%9A%84-Cookie"><span class="toc-text">å¸¦æœ‰ Pydantic æ¨¡å‹çš„ Cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%81%E6%AD%A2%E9%A2%9D%E5%A4%96%E7%9A%84-Cookie"><span class="toc-text">ç¦æ­¢é¢å¤–çš„ Cookie</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Header%E5%8F%82%E6%95%B0%E6%A8%A1%E5%9E%8B"><span class="toc-text">Headerå‚æ•°æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Pydantic-%E6%A8%A1%E5%9E%8B%E7%9A%84-Header-%E5%8F%82%E6%95%B0"><span class="toc-text">ä½¿ç”¨ Pydantic æ¨¡å‹çš„ Header å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%81%E6%AD%A2%E9%A2%9D%E5%A4%96%E7%9A%84-Headers"><span class="toc-text">ç¦æ­¢é¢å¤–çš„ Headers</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E6%A8%A1%E5%9E%8B"><span class="toc-text">å“åº”æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E4%B8%8E%E8%BE%93%E5%85%A5%E7%9B%B8%E5%90%8C"><span class="toc-text">è¿”å›ä¸è¾“å…¥ç›¸åŒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E6%A8%A1%E5%9E%8B%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-text">å“åº”æ¨¡å‹é»˜è®¤å€¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E9%99%A4%E5%B1%9E%E6%80%A7"><span class="toc-text">æ’é™¤å±æ€§</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E5%A4%9A%E6%A8%A1%E5%9E%8B"><span class="toc-text">æ›´å¤šæ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%A4%9A%E4%B8%AA%E6%A8%A1%E5%9E%8B"><span class="toc-text">è¿”å›å¤šä¸ªæ¨¡å‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E6%84%8F-dict-%E6%9E%84%E6%88%90%E5%93%8D%E5%BA%94"><span class="toc-text">ä»»æ„ dict æ„æˆå“åº”</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-text">å“åº”çŠ¶æ€ç </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-text">æ›´æ”¹çŠ¶æ€ç </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE"><span class="toc-text">è¡¨å•æ•°æ®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E6%A8%A1%E5%9E%8B"><span class="toc-text">è¡¨å•æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%81%E6%AD%A2%E9%A2%9D%E5%A4%96%E7%9A%84%E8%A1%A8%E5%8D%95%E5%AD%97%E6%AE%B5"><span class="toc-text">ç¦æ­¢é¢å¤–çš„è¡¨å•å­—æ®µ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E6%96%87%E4%BB%B6"><span class="toc-text">è¯·æ±‚æ–‡ä»¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UploadFile"><span class="toc-text">UploadFile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E9%80%89%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-text">å¯é€‰æ–‡ä»¶ä¸Šä¼ </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E6%9C%89%E9%A2%9D%E5%A4%96%E5%85%83%E6%95%B0%E6%8D%AE%E7%9A%84-UploadFile"><span class="toc-text">å¸¦æœ‰é¢å¤–å…ƒæ•°æ®çš„ UploadFile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-text">å¤šæ–‡ä»¶ä¸Šä¼ </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E6%9C%89%E9%A2%9D%E5%A4%96%E5%85%83%E6%95%B0%E6%8D%AE%E7%9A%84%E5%A4%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-text">å¸¦æœ‰é¢å¤–å…ƒæ•°æ®çš„å¤šæ–‡ä»¶ä¸Šä¼ </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E8%A1%A8%E5%8D%95%E4%B8%8E%E6%96%87%E4%BB%B6"><span class="toc-text">è¯·æ±‚è¡¨å•ä¸æ–‡ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-text">é”™è¯¯å¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTPException"><span class="toc-text">HTTPException</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%93%8D%E5%BA%94%E5%A4%B4"><span class="toc-text">æ·»åŠ è‡ªå®šä¹‰å“åº”å¤´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-text">è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%86%E7%9B%96%E9%BB%98%E8%AE%A4%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-text">è¦†ç›–é»˜è®¤å¼‚å¸¸å¤„ç†å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A6%86%E7%9B%96%E8%AF%B7%E6%B1%82%E9%AA%8C%E8%AF%81%E5%BC%82%E5%B8%B8"><span class="toc-text">è¦†ç›–è¯·æ±‚éªŒè¯å¼‚å¸¸</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-RequestValidationError-%E7%9A%84%E8%AF%B7%E6%B1%82%E4%BD%93"><span class="toc-text">ä½¿ç”¨ RequestValidationError çš„è¯·æ±‚ä½“</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A6%86%E7%9B%96-HTTPException-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-text">è¦†ç›– HTTPException é”™è¯¯å¤„ç†å™¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E7%94%A8-FastAPI-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-text">å¤ç”¨ FastAPI å¼‚å¸¸å¤„ç†å™¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E6%93%8D%E4%BD%9C%E9%85%8D%E7%BD%AE"><span class="toc-text">è·¯å¾„æ“ä½œé…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-text">çŠ¶æ€ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tags-%E5%8F%82%E6%95%B0"><span class="toc-text">tags å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#summary-%E5%92%8C-description-%E5%8F%82%E6%95%B0"><span class="toc-text">summary å’Œ description å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-text">æ–‡æ¡£å­—ç¬¦ä¸²</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E6%8F%8F%E8%BF%B0"><span class="toc-text">å“åº”æè¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%83%E7%94%A8%E8%B7%AF%E5%BE%84%E6%93%8D%E4%BD%9C"><span class="toc-text">å¼ƒç”¨è·¯å¾„æ“ä½œ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JSON-%E5%85%BC%E5%AE%B9%E7%BC%96%E7%A0%81%E5%99%A8"><span class="toc-text">JSON å…¼å®¹ç¼–ç å™¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E9%A1%B9"><span class="toc-text">ä¾èµ–é¡¹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E4%BD%9C%E4%B8%BA%E4%BE%9D%E8%B5%96%E9%A1%B9"><span class="toc-text">ç±»ä½œä¸ºä¾èµ–é¡¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E4%BE%9D%E8%B5%96%E9%A1%B9"><span class="toc-text">å­ä¾èµ–é¡¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E6%93%8D%E4%BD%9C%E8%A3%85%E9%A5%B0%E5%99%A8%E4%BE%9D%E8%B5%96%E9%A1%B9"><span class="toc-text">è·¯å¾„æ“ä½œè£…é¥°å™¨ä¾èµ–é¡¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E4%BE%9D%E8%B5%96%E9%A1%B9"><span class="toc-text">å…¨å±€ä¾èµ–é¡¹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E6%80%A7"><span class="toc-text">å®‰å…¨æ€§</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-text">ä¸­é—´ä»¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-text">åˆ›å»ºä¸­é—´ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CORS"><span class="toc-text">CORS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CORS-%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-text">CORS çš„åŸç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-text">å·¥ä½œæµç¨‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E9%94%AE-HTTP-%E5%A4%B4%E9%83%A8"><span class="toc-text">å…³é”® HTTP å¤´éƒ¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E8%80%83%E8%99%91"><span class="toc-text">å®‰å…¨è€ƒè™‘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82"><span class="toc-text">å†…éƒ¨å®ç°ç»†èŠ‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CORSMiddleware"><span class="toc-text">CORSMiddleware</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-text">æµ‹è¯•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-text">åŸºç¡€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%A6%BB%E6%B5%8B%E8%AF%95"><span class="toc-text">åˆ†ç¦»æµ‹è¯•</span></a></li></ol></li></ol></div><div class="widget-footer"><a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><!-- Icon from Solar by 480 Design - https://creativecommons.org/licenses/by/4.0/ --><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"><path stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/><path d="M7 3.338A9.95 9.95 0 0 1 12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12c0-1.821.487-3.53 1.338-5"/></g></svg><span>å›åˆ°é¡¶éƒ¨</span></a></div></widget>
</div></aside><div class='float-panel'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">


<script type="text/javascript">
  window.canonical = {"originalHost":null,"officialHosts":["localhost"],"encoded":""};
  const ctx = {
    date_suffix: {
      just: `åˆšåˆš`,
      min: `åˆ†é’Ÿå‰`,
      hour: `å°æ—¶å‰`,
      day: `å¤©å‰`,
    },
    root : `/`,
    tag_plugins: {
      chat: Object.assign({"api":"https://siteinfo.listentothewind.cn/api/v1"}),
    }
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"skip_search":null,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
    loading: `https://api.iconify.design/eos-icons:three-dots-loading.svg?color=%231cd0fd`,
  };
  const deps = {
    jquery: `https://gcore.jsdelivr.net/npm/jquery@3.7/dist/jquery.min.js`,
    marked: `https://gcore.jsdelivr.net/npm/marked@13.0/lib/marked.umd.min.js`,
    lazyload: `/%5Bobject%20Object%5D`
  }
  

</script>

<script type="text/javascript">
  
  function RunItem() {
    this.list = []; // å­˜æ”¾å›è°ƒå‡½æ•°
    this.start = () => {
      for (var i = 0; i < this.list.length; i++) {
        this.list[i].run();
      }
    };
    this.push = (fn, name, setRequestAnimationFrame = true) => {
      let myfn = fn
      if (setRequestAnimationFrame) {
        myfn = () => {
          utils.requestAnimationFrame(fn)
        }
      }
      var f = new Item(myfn, name);
      this.list.push(f);
    };
    this.remove = (name) => {
      for (let index = 0; index < this.list.length; index++) {
        const e = this.list[index];
        if (e.name == name) {
          this.list.splice(index, 1);
        }
      }
    }
    // æ„é€ ä¸€ä¸ªå¯ä»¥runçš„å¯¹è±¡
    function Item(fn, name) {
      // å‡½æ•°åç§°
      this.name = name || fn.name;
      // runæ–¹æ³•
      this.run = () => {
        try {
          fn()
        } catch (error) {
          console.log(error);
        }
      };
    }
  }

  const utils = {
    // æ‡’åŠ è½½ css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')) {
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // é»˜è®¤å¼‚æ­¥ï¼Œå¦‚æœéœ€è¦åŒæ­¥ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ {} å³å¯
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function () {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },

    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      const maxRetry = 3;
      let retryCount = 0;

      return new Promise((resolve, reject) => {
        const load = () => {
          utils.onLoading?.(el);

          let timedOut = false;
          const timeout = setTimeout(() => {
            timedOut = true;
            console.warn('[request] è¶…æ—¶:', url);

            if (++retryCount >= maxRetry) {
              utils.onLoadFailure?.(el);
              onFailure?.();
              reject('è¯·æ±‚è¶…æ—¶');
            } else {
              setTimeout(load, 1000);
            }
          }, 5000);

          fetch(url).then(resp => {
            if (timedOut) return;
            clearTimeout(timeout);

            if (!resp.ok) throw new Error('å“åº”å¤±è´¥');
            return resp;
          }).then(data => {
            if (timedOut) return;
            utils.onLoadSuccess?.(el);
            callback(data);
            resolve(data);
          }).catch(err => {
            clearTimeout(timeout);
            console.warn('[request] é”™è¯¯:', err);

            if (++retryCount >= maxRetry) {
              utils.onLoadFailure?.(el);
              onFailure?.();
              reject(err);
            } else {
              setTimeout(load, 1000);
            }
          });
        };

        load();
      });
    },
    requestWithoutLoading: (url, options = {}, maxRetry = 2, timeout = 5000) => {
      return new Promise((resolve, reject) => {
        let retryCount = 0;

        const tryRequest = () => {
          let timedOut = false;
          const timer = setTimeout(() => {
            timedOut = true;
            if (++retryCount > maxRetry) reject('timeout');
            else tryRequest();
          }, timeout);

          fetch(url, options)
            .then(resp => {
              clearTimeout(timer);
              if (!resp.ok) throw new Error('bad response');
              resolve(resp);
            })
            .catch(err => {
              clearTimeout(timer);
              if (++retryCount > maxRetry) reject(err);
              else setTimeout(tryRequest, 500);
            });
        };

        tryRequest();
      });
    },
    /********************** requestAnimationFrame ********************************/
    // 1ã€requestAnimationFrame ä¼šæŠŠæ¯ä¸€å¸§ä¸­çš„æ‰€æœ‰ DOM æ“ä½œé›†ä¸­èµ·æ¥ï¼Œåœ¨ä¸€æ¬¡é‡ç»˜æˆ–å›æµä¸­å°±å®Œæˆï¼Œå¹¶ä¸”é‡ç»˜æˆ–å›æµçš„æ—¶é—´é—´éš”ç´§ç´§è·Ÿéšæµè§ˆå™¨çš„åˆ·æ–°é¢‘ç‡ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªé¢‘ç‡ä¸ºæ¯ç§’60å¸§ã€‚
    // 2ã€åœ¨éšè—æˆ–ä¸å¯è§çš„å…ƒç´ ä¸­ï¼ŒrequestAnimationFrame å°†ä¸ä¼šè¿›è¡Œé‡ç»˜æˆ–å›æµï¼Œè¿™å½“ç„¶å°±æ„å‘³ç€æ›´å°‘çš„çš„ cpuï¼Œgpu å’Œå†…å­˜ä½¿ç”¨é‡ã€‚
    requestAnimationFrame: (fn) => {
      if (!window.requestAnimationFrame) {
        window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame;
      }
      window.requestAnimationFrame(fn)
    },
    dark: {},
  };

  // utils.dark.mode å½“å‰æ¨¡å¼ dark or light
  // utils.dark.toggle() æš—é»‘æ¨¡å¼è§¦å‘å™¨
  // utils.dark.push(callBack[,"callBackName"]) ä¼ å…¥è§¦å‘å™¨å›è°ƒå‡½æ•°
  utils.dark.method = {
    toggle: new RunItem(),
  };
  utils.dark = Object.assign(utils.dark, {
    push: utils.dark.method.toggle.push,
  });
</script>
<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>
<script type="text/javascript">
  (() => {
    const tagSwitchers = document.querySelectorAll('.tag-subtree.parent-tag > a > .tag-switcher-wrapper')
    for (const tagSwitcher of tagSwitchers) {
      tagSwitcher.addEventListener('click', (e) => {
        const parent = e.target.closest('.tag-subtree.parent-tag')
        parent.classList.toggle('expanded')
        e.preventDefault()
      })
    }

    // Get active tag from query string, then activate it.
    const urlParams = new URLSearchParams(window.location.search)
    const activeTag = urlParams.get('tag')
    if (activeTag) {
      let tag = document.querySelector(`.tag-subtree[data-tag="${activeTag}"]`)
      if (tag) {
        tag.querySelector('a').classList.add('active')
        
        while (tag) {
          tag.classList.add('expanded')
          tag = tag.parentElement.closest('.tag-subtree.parent-tag')
        }
      }
    }
  })()
</script>

<script async src="https://gcore.jsdelivr.net/npm/vanilla-lazyload@19.1/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
    callback_loaded: (el) => {
      el.classList.add('loaded');
      const wrapper = el.closest('.lazy-box');
      const icon = wrapper?.querySelector('.lazy-icon');
      if (icon) icon.remove();
    }
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });

  window.wrapLazyloadImages = (container) => {
    if (typeof container === 'string') {
      container = document.querySelector(container);
    }
    if (!container) return;
    
    const images = container.querySelectorAll('img');
    images.forEach((img) => {
      if (img.classList.contains('lazy')) return;

      const src = img.getAttribute('src');
      if (!src) return;

      const wrapper = document.createElement('div');
      wrapper.className = 'lazy-box';

      const newImg = img.cloneNode();
      newImg.removeAttribute('src');
      newImg.setAttribute('data-src', src);
      newImg.classList.add('lazy');

      const icon = document.createElement('div');
      icon.className = 'lazy-icon';
      if (def.loading) {
        icon.style.backgroundImage = `url("${def.loading}")`;
      }

      wrapper.appendChild(newImg);
      wrapper.appendChild(icon);

      img.replaceWith(wrapper);
    });

    // é€šçŸ¥ LazyLoad æ›´æ–°
    if (window.lazyLoadInstance?.update) {
      window.lazyLoadInstance.update();
    }
  }
  
</script>

<!-- required -->
<script src="/js/main.js?v=1.33.1" defer></script>

<script type="text/javascript">
  const applyTheme = (theme) => {
    if (theme === 'auto') {
      document.documentElement.removeAttribute('data-theme')
    } else {
      document.documentElement.setAttribute('data-theme', theme)
    }

    // applyThemeToGiscus(theme)
  }

  // FIXME: è¿™ä¼šå¯¼è‡´æ— æ³•ä½¿ç”¨ preferred_color_scheme ä»¥å¤–çš„ä¸»é¢˜
  const applyThemeToGiscus = (theme) => {
    // theme = theme === 'auto' ? 'preferred_color_scheme' : theme
    const cmt = document.getElementById('giscus')
    if (cmt) {
      // This works before giscus load.
      cmt.setAttribute('data-theme', theme)
    }

    const iframe = document.querySelector('#comments > section.giscus > iframe')
    if (iframe) {
      // This works after giscus loaded.
      const src = iframe.src
      const newSrc = src.replace(/theme=[\w]+/, `theme=${theme}`)
      iframe.src = newSrc
    }
  }

  const switchTheme = () => {
    // light -> dark -> auto -> light -> ...
    const currentTheme = document.documentElement.getAttribute('data-theme')
    let newTheme;
    switch (currentTheme) {
      case 'light':
        newTheme = 'dark'
        break
      case 'dark':
        newTheme = 'auto'
        break
      default:
        newTheme = 'light'
    }
    applyTheme(newTheme)
    window.localStorage.setItem('Stellar.theme', newTheme)
    utils.dark.mode = newTheme === 'auto' ? (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light") : newTheme;
    utils.dark.method.toggle.start();

    const messages = {
      light: `åˆ‡æ¢åˆ°æµ…è‰²æ¨¡å¼`,
      dark: `åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼`,
      auto: `åˆ‡æ¢åˆ°è·Ÿéšç³»ç»Ÿé…è‰²`,
    }
    hud?.toast?.(messages[newTheme])
  }

  (() => {
    // Apply user's preferred theme, if any.
    const theme = window.localStorage.getItem('Stellar.theme')
    if (theme !== null) {
      applyTheme(theme)
    } else {
      utils.dark.mode = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
    }
    utils.dark.method.toggle.start();
  })()
</script>


<!-- optional -->



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"rating":{"js":"/js/services/rating.js","api":"https://star-vote.xaox.cc/api/rating"},"vote":{"js":"/js/services/vote.js","api":"https://star-vote.xaox.cc/api/vote"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"friends_and_posts":{"js":"/js/services/friends_and_posts.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"},"voice":{"js":"/js/plugins/voice.js"},"video":{"js":"/js/plugins/video.js"},"download-file":{"js":"/js/plugins/download-file.js"},"twikoo":{"js":"/js/services/twikoo_latest_comment.js"},"waline":{"js":"/js/services/waline_latest_comment.js"},"artalk":{"js":"/js/services/artalk_latest_comment.js"},"giscus":{"js":"/js/services/giscus_latest_comment.js"},"contributors":{"edit_this_page":{"_posts/":null,"wiki/stellar/":"https://github.com/xaoxuu/hexo-theme-stellar-docs/blob/main/"},"js":"/js/services/contributors.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else if (id == 'voice') {
        ctx.voiceAudios = document.querySelectorAll('.voice>audio');
        if (ctx.voiceAudios?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            createVoiceDom(ctx.voiceAudios);
          });
        }
      } else if (id == 'video') {
        ctx.videos = document.querySelectorAll('.video>video');
        if (ctx.videos?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            videoEvents(ctx.videos);
          });
        }
      } else if (id == 'download-file') {
        ctx.files = document.querySelectorAll('.file');
        if (ctx.files?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            downloadFileEvent(ctx.files);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }

    // chat iphone time
    let phoneTimes = document.querySelectorAll('.chat .status-bar .time');

    if (phoneTimes.length > 0) {
      NowTime();
      var date = new Date();
      var sec = date.getSeconds();
      var firstAdjustInterval = setInterval(firstAdjustTime, 1000 * (60 - sec));
    }

    function firstAdjustTime() {
      NowTime();
      clearInterval(firstAdjustInterval);
      setInterval(NowTime, 1000 * 60);
    }

    function NowTime() {
      for (let i = 0; i < phoneTimes.length; ++i) {
        var timeSpan = phoneTimes[i];
        var date = new Date();
        var hour = date.getHours();
        var min = date.getMinutes();
        timeSpan.innerHTML = check(hour) + ":" + check(min);
      }
    };

    function check(val) {
      if (val < 10) {
        return ("0" + val);
      }
      return (val);
    }

    // chat quote
    const chat_quote_obverser = new IntersectionObserver((entries, observer) => {
      entries.filter((entry) => { return entry.isIntersecting }).sort((a, b) => a.intersectionRect.y !== b.intersectionRect.y ? a.intersectionRect.y - b.intersectionRect.y : a.intersectionRect.x - b.intersectionRect.x).forEach((entry, index) => {
          observer.unobserve(entry.target);
          setTimeout(() => {
            entry.target.classList.add('quote-blink');
            setTimeout(() => {
              entry.target.classList.remove('quote-blink');
            }, 1000);
          }, Math.max(100, 16) * (index + 1));
        });
    });

    var chatQuotes = document.querySelectorAll(".chat .talk .quote");
    chatQuotes.forEach((quote) => {
      quote.addEventListener('click', function () {
        var chatCellDom = document.getElementById("quote-" + quote.getAttribute("quotedCellTag"));
        if (chatCellDom) {
          var chatDiv = chatCellDom.parentElement;
          var mid = chatDiv.clientHeight / 2;
          var offsetTop = chatCellDom.offsetTop;
          if (offsetTop > mid - chatCellDom.clientHeight / 2) {
            chatDiv.scrollTo({
              top: chatCellDom.offsetTop - mid + chatCellDom.clientHeight / 2,
              behavior: "smooth"
            });
          } else {
            chatDiv.scrollTo({
              top: 0,
              behavior: "smooth"
            });
          }
          chat_quote_obverser.observe(chatCellDom);
        }
      });
    });
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://gcore.jsdelivr.net/npm/flying-pages@2/flying-pages.min.js"></script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://gcore.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css`,
    js: `https://gcore.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js`
  };
  var selector = '[data-fancybox]:not(.error), .with-fancybox .atk-content img:not([atk-emoticon])';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const memos = document.getElementsByClassName('ds-memos');
    if (memos != undefined && memos.length > 0) {
      needFancybox = true;
    }
    const fancybox = document.getElementsByClassName('with-fancybox');
    if (fancybox != undefined && fancybox.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `å¤åˆ¶æˆåŠŸ`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
