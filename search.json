[{"title":"FastAPIåŸºç¡€","path":"/2025/04/17/FastAPIåŸºç¡€/","content":"ç®€ä»‹FastAPI æ˜¯ä¸€ä¸ªç”¨äºæ„å»º API çš„ç°ä»£ã€å¿«é€Ÿï¼ˆé«˜æ€§èƒ½ï¼‰çš„ web æ¡†æ¶ï¼Œä½¿ç”¨ Python å¹¶åŸºäºæ ‡å‡†çš„ Python ç±»å‹æç¤ºã€‚ å…³é”®ç‰¹æ€§: å¿«é€Ÿï¼šå¯ä¸ NodeJS å’Œ Go å¹¶è‚©çš„æé«˜æ€§èƒ½ï¼ˆå½’åŠŸäº Starlette å’Œ Pydanticï¼‰ã€‚æœ€å¿«çš„ Python web æ¡†æ¶ä¹‹ä¸€ã€‚ é«˜æ•ˆç¼–ç ï¼šæé«˜åŠŸèƒ½å¼€å‘é€Ÿåº¦çº¦ 200ï¼… è‡³ 300ï¼…ã€‚* æ›´å°‘ bugï¼šå‡å°‘çº¦ 40ï¼… çš„äººä¸ºï¼ˆå¼€å‘è€…ï¼‰å¯¼è‡´é”™è¯¯ã€‚* æ™ºèƒ½ï¼šæä½³çš„ç¼–è¾‘å™¨æ”¯æŒã€‚å¤„å¤„çš†å¯è‡ªåŠ¨è¡¥å…¨ï¼Œå‡å°‘è°ƒè¯•æ—¶é—´ã€‚ ç®€å•ï¼šè®¾è®¡çš„æ˜“äºä½¿ç”¨å’Œå­¦ä¹ ï¼Œé˜…è¯»æ–‡æ¡£çš„æ—¶é—´æ›´çŸ­ã€‚ ç®€çŸ­ï¼šä½¿ä»£ç é‡å¤æœ€å°åŒ–ã€‚é€šè¿‡ä¸åŒçš„å‚æ•°å£°æ˜å®ç°ä¸°å¯ŒåŠŸèƒ½ã€‚bug æ›´å°‘ã€‚ å¥å£®ï¼šç”Ÿäº§å¯ç”¨çº§åˆ«çš„ä»£ç ã€‚è¿˜æœ‰è‡ªåŠ¨ç”Ÿæˆçš„äº¤äº’å¼æ–‡æ¡£ã€‚ æ ‡å‡†åŒ–ï¼šåŸºäºï¼ˆå¹¶å®Œå…¨å…¼å®¹ï¼‰API çš„ç›¸å…³å¼€æ”¾æ ‡å‡†ï¼šOpenAPI (ä»¥å‰è¢«ç§°ä¸º Swagger) å’Œ JSON Schemaã€‚ å¯é€‰ä¾èµ–ï¼š ç”¨äº Pydanticï¼š email-validator - ç”¨äº email æ ¡éªŒã€‚ ç”¨äº Starletteï¼š httpx - ä½¿ç”¨ TestClient æ—¶å®‰è£…ã€‚ jinja2 - ä½¿ç”¨é»˜è®¤æ¨¡æ¿é…ç½®æ—¶å®‰è£…ã€‚ python-multipart - éœ€è¦é€šè¿‡ request.form() å¯¹è¡¨å•è¿›è¡Œã€Œè§£æã€æ—¶å®‰è£…ã€‚ itsdangerous - éœ€è¦ SessionMiddleware æ”¯æŒæ—¶å®‰è£…ã€‚ pyyaml - ä½¿ç”¨ Starlette æä¾›çš„ SchemaGenerator æ—¶å®‰è£…ï¼ˆæœ‰ FastAPI ä½ å¯èƒ½å¹¶ä¸éœ€è¦å®ƒï¼‰ã€‚ graphene - éœ€è¦ GraphQLApp æ”¯æŒæ—¶å®‰è£…ã€‚ ç”¨äº FastAPI Starletteï¼š uvicorn - ç”¨äºåŠ è½½å’Œè¿è¡Œä½ çš„åº”ç”¨ç¨‹åºçš„æœåŠ¡å™¨ã€‚ orjson - ä½¿ç”¨ ORJSONResponse æ—¶å®‰è£…ã€‚ ujson - ä½¿ç”¨ UJSONResponse æ—¶å®‰è£…ã€‚ ä½ å¯ä»¥é€šè¿‡ pip install fastapi[all] å‘½ä»¤æ¥å®‰è£…ä»¥ä¸Šæ‰€æœ‰ä¾èµ–ã€‚ å®‰è£…pip install fastapi[standard] å½“æ‚¨ä½¿ç”¨ pip install fastapi[standard] è¿›è¡Œå®‰è£…æ—¶ï¼Œå®ƒä¼šé™„å¸¦ä¸€äº›é»˜è®¤çš„å¯é€‰æ ‡å‡†ä¾èµ–é¡¹ã€‚ å¦‚æœæ‚¨ä¸æƒ³å®‰è£…è¿™äº›å¯é€‰ä¾èµ–ï¼Œå¯ä»¥é€‰æ‹©å®‰è£… pip install fastapiã€‚ ç¬¬ä¸€æ­¥å¯åŠ¨FastAPI main.py #!/user/bin/env python# -*- coding: utf-8 -*-@Time : 2025/4/17 14:19@Author : lianyutian@File : test.pyfrom fastapi import FastAPIapp = FastAPI()@app.get(/)async def root(): return message: Hello World # æ‰§è¡Œ(.venv) PS D:\\work\\example_workspace\\example_python\\example_FastAPI\\1.basic fastapi dev main.py FastAPI Starting development server ğŸš€ Searching for package file structure from directories with __init__.py files Importing from D:\\work\\example_workspace\\example_python\\example_FastAPI\\1.basic module ğŸ main.py code Importing the FastAPI app object from the module with the following code: from main import app app Using import string: main:app server Server started at http://127.0.0.1:8000 server Documentation at http://127.0.0.1:8000/docs tip Running in development mode, for production use: fastapi run Logs: INFO Will watch for changes in these directories: [D:\\\\work\\\\example_workspace\\\\example_python\\\\example_FastAPI\\\\1.basic] INFO Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit) INFO Will watch for changes in these directories: [D:\\\\work\\\\example_workspace\\\\example_python\\\\example_FastAPI\\\\1.basic] INFO Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit) INFO Started reloader process [9924] using WatchFiles INFO Started server process [34056] INFO Waiting for application startup. INFO Application startup complete. INFO 127.0.0.1:1250 - GET / HTTP/1.1 200 INFO 127.0.0.1:1250 - GET /favicon.ico HTTP/1.1 404 INFO 127.0.0.1:1251 - GET /docs HTTP/1.1 200 INFO 127.0.0.1:1251 - GET /openapi.json HTTP/1.1 200 INFO 127.0.0.1:1260 - GET / HTTP/1.1 200 åœ¨è¾“å‡ºè¡Œä¸­ï¼Œä¼šæœ‰ä¸€è¡Œä¿¡æ¯å¦‚ä¸‹ï¼š INFO Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit) è¯¥è¡Œæ˜¾ç¤ºäº†ä½ çš„åº”ç”¨åœ¨æœ¬æœºæ‰€æä¾›æœåŠ¡çš„ URL åœ°å€ã€‚ åˆ†æ­¥æ¦‚æ‹¬æ­¥éª¤1ï¼šå¯¼å…¥Fast APIfrom fastapi import FastAPI FastAPI æ˜¯ä¸€ä¸ªä¸ºä½ çš„ API æä¾›äº†æ‰€æœ‰åŠŸèƒ½çš„ Python ç±»ã€‚ FastAPI æ˜¯ç›´æ¥ä» Starlette ç»§æ‰¿çš„ç±»ã€‚ ä½ å¯ä»¥é€šè¿‡ FastAPI ä½¿ç”¨æ‰€æœ‰çš„ Starlette çš„åŠŸèƒ½ã€‚ æ­¥éª¤2ï¼šåˆ›å»ºä¸€ä¸ª FastAPIã€å®ä¾‹ã€‘app = FastAPI() è¿™é‡Œçš„å˜é‡ app ä¼šæ˜¯ FastAPI ç±»çš„ä¸€ä¸ªã€Œå®ä¾‹ã€ã€‚ è¿™ä¸ªå®ä¾‹å°†æ˜¯åˆ›å»ºä½ æ‰€æœ‰ API çš„ä¸»è¦äº¤äº’å¯¹è±¡ã€‚ æ­¥éª¤ 3ï¼šåˆ›å»ºä¸€ä¸ªã€è·¯å¾„æ“ä½œã€‘è·¯å¾„è¿™é‡Œçš„ã€Œè·¯å¾„ã€æŒ‡çš„æ˜¯ URL ä¸­ä»ç¬¬ä¸€ä¸ª / èµ·çš„ååŠéƒ¨åˆ†ã€‚ æ‰€ä»¥ï¼Œåœ¨ä¸€ä¸ªè¿™æ ·çš„ URL ä¸­ï¼š https://example.com/items/foo è·¯å¾„ä¼šæ˜¯ï¼š /items/foo ã€Œè·¯å¾„ã€ä¹Ÿé€šå¸¸è¢«ç§°ä¸ºã€Œç«¯ç‚¹ã€æˆ–ã€Œè·¯ç”±ã€ã€‚ å¼€å‘ API æ—¶ï¼Œã€Œè·¯å¾„ã€æ˜¯ç”¨æ¥åˆ†ç¦»ã€Œå…³æ³¨ç‚¹ã€å’Œã€Œèµ„æºã€çš„ä¸»è¦æ‰‹æ®µã€‚ æ“ä½œè¿™é‡Œçš„ã€Œæ“ä½œã€æŒ‡çš„æ˜¯ä¸€ç§ HTTPã€Œæ–¹æ³•ã€ã€‚ ä¸‹åˆ—ä¹‹ä¸€ï¼š POST GET PUT DELETE ä»¥åŠæ›´å°‘è§çš„å‡ ç§ï¼š OPTIONS HEAD PATCH TRACE åœ¨ HTTP åè®®ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸Šçš„å…¶ä¸­ä¸€ç§ï¼ˆæˆ–å¤šç§ï¼‰ã€Œæ–¹æ³•ã€ä¸æ¯ä¸ªè·¯å¾„è¿›è¡Œé€šä¿¡ã€‚ åœ¨å¼€å‘ API æ—¶ï¼Œä½ é€šå¸¸ä½¿ç”¨ç‰¹å®šçš„ HTTP æ–¹æ³•å»æ‰§è¡Œç‰¹å®šçš„è¡Œä¸ºã€‚ é€šå¸¸ä½¿ç”¨ï¼š POSTï¼šåˆ›å»ºæ•°æ®ã€‚ GETï¼šè¯»å–æ•°æ®ã€‚ PUTï¼šæ›´æ–°æ•°æ®ã€‚ DELETEï¼šåˆ é™¤æ•°æ®ã€‚ å› æ­¤ï¼Œåœ¨ OpenAPI ä¸­ï¼Œæ¯ä¸€ä¸ª HTTP æ–¹æ³•éƒ½è¢«ç§°ä¸ºã€Œæ“ä½œã€ã€‚ æˆ‘ä»¬ä¹Ÿæ‰“ç®—ç§°å‘¼å®ƒä»¬ä¸ºã€Œæ“ä½œã€ã€‚ å®šä¹‰ä¸€ä¸ªã€è·¯å¾„æ“ä½œè£…é¥°å™¨ã€‘@app.get(/) @app.get(/) å‘Šè¯‰ FastAPI åœ¨å®ƒä¸‹æ–¹çš„å‡½æ•°è´Ÿè´£å¤„ç†å¦‚ä¸‹è®¿é—®è¯·æ±‚ï¼š è¯·æ±‚è·¯å¾„ä¸º / ä½¿ç”¨ get æ“ä½œ ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ“ä½œï¼š @app.post() @app.put() @app.delete() ä»¥åŠæ›´å°‘è§çš„ï¼š @app.options() @app.head() @app.patch() @app.trace() æ­¥éª¤4ï¼šå®šä¹‰ã€è·¯å¾„æ“ä½œå‡½æ•°ã€‘async def root(): è¿™æ˜¯ä¸€ä¸ª Python å‡½æ•°ã€‚ æ¯å½“ FastAPI æ¥æ”¶ä¸€ä¸ªä½¿ç”¨ GET æ–¹æ³•è®¿é—® URLã€Œ/ã€çš„è¯·æ±‚æ—¶è¿™ä¸ªå‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒæ˜¯ä¸€ä¸ª async å‡½æ•°ã€‚ ä½ ä¹Ÿå¯ä»¥å°†å…¶å®šä¹‰ä¸ºå¸¸è§„å‡½æ•°è€Œä¸ä½¿ç”¨ async def: def root(): æ­¥éª¤5ï¼šè¿”å›å†…å®¹return message: Hello World ä½ å¯ä»¥è¿”å›ä¸€ä¸ª dictã€listï¼Œåƒ strã€int ä¸€æ ·çš„å•ä¸ªå€¼ï¼Œç­‰ç­‰ã€‚ ä½ è¿˜å¯ä»¥è¿”å› Pydantic æ¨¡å‹ï¼ˆç¨åä½ å°†äº†è§£æ›´å¤šï¼‰ã€‚ è¿˜æœ‰è®¸å¤šå…¶ä»–å°†ä¼šè‡ªåŠ¨è½¬æ¢ä¸º JSON çš„å¯¹è±¡å’Œæ¨¡å‹ï¼ˆåŒ…æ‹¬ ORM å¯¹è±¡ç­‰ï¼‰ã€‚ æ€»ç»“ å¯¼å…¥ FastAPIã€‚ åˆ›å»ºä¸€ä¸ª app å®ä¾‹ã€‚ ç¼–å†™ä¸€ä¸ªè·¯å¾„æ“ä½œè£…é¥°å™¨ï¼Œå¦‚ @app.get(/)ã€‚ å®šä¹‰ä¸€ä¸ªè·¯å¾„æ“ä½œå‡½æ•°ï¼Œå¦‚ def root(): ...ã€‚ ä½¿ç”¨å‘½ä»¤ fastapi dev è¿è¡Œå¼€å‘æœåŠ¡å™¨ã€‚ äº¤äº’å¼APIæ–‡æ¡£è·³è½¬åˆ° http://127.0.0.1:8000/docsã€‚ ä½ å°†ä¼šçœ‹åˆ°è‡ªåŠ¨ç”Ÿæˆçš„äº¤äº’å¼ API æ–‡æ¡£ï¼ˆç”± Swagger UI æä¾›ï¼‰ï¼š è·¯å¾„å‚æ•°æ¦‚å¿µFastAPI æ”¯æŒä½¿ç”¨ Python å­—ç¬¦ä¸²æ ¼å¼åŒ–è¯­æ³•å£°æ˜è·¯å¾„å‚æ•°ï¼ˆå˜é‡ï¼‰ï¼š from fastapi import FastAPIapp = FastAPI()@app.get(/items/item_id)async def read_item(item_id): return item_id: item_id è¿™æ®µä»£ç æŠŠè·¯å¾„å‚æ•° item_id çš„å€¼ä¼ é€’ç»™è·¯å¾„å‡½æ•°çš„å‚æ•° item_idã€‚ è¿è¡Œç¤ºä¾‹å¹¶è®¿é—® http://127.0.0.1:8000/items/helloï¼Œå¯è·å¾—å¦‚ä¸‹å“åº”ï¼š å£°æ˜è·¯å¾„å‚æ•°ç±»å‹from fastapi import FastAPIapp = FastAPI()@app.get(/items_with_type/item_id)async def read_item_with_type(item_id: int): return item_id: item_id æœ¬ä¾‹æŠŠ item_id çš„ç±»å‹å£°æ˜ä¸º intã€‚ å½“æˆ‘ä»¬è¾“å…¥å‚æ•°ä¸ä¸º int ç±»å‹æ—¶ï¼Œä¼šæŠ›å‡ºå¦‚ä¸‹é”™è¯¯ï¼š detail: [ type: int_parsing, loc: [ path, item_id ], msg: Input should be a valid integer, unable to parse string as an integer, input: ff ] FastAPI ä½¿ç”¨ Python ç±»å‹å£°æ˜å®ç°äº†æ•°æ®æ ¡éªŒã€‚ æ³¨æ„ï¼Œä¸Šé¢çš„é”™è¯¯æ¸…æ™°åœ°æŒ‡å‡ºäº†æœªé€šè¿‡æ ¡éªŒçš„å…·ä½“åŸå› ã€‚ è¿™åœ¨å¼€å‘è°ƒè¯•ä¸ API äº¤äº’çš„ä»£ç æ—¶éå¸¸æœ‰ç”¨ã€‚ æ–¹æ³•å®šä¹‰é¡ºåºæœ‰æ—¶ï¼Œè·¯å¾„æ“ä½œä¸­çš„è·¯å¾„æ˜¯å†™æ­»çš„ã€‚ æ¯”å¦‚è¦ä½¿ç”¨ /users/me è·å–å½“å‰ç”¨æˆ·çš„æ•°æ®ã€‚ ç„¶åè¿˜è¦ä½¿ç”¨ /users/user_idï¼Œé€šè¿‡ç”¨æˆ· ID è·å–æŒ‡å®šç”¨æˆ·çš„æ•°æ®ã€‚ ç”±äºè·¯å¾„æ“ä½œæ˜¯æŒ‰é¡ºåºä¾æ¬¡è¿è¡Œçš„ï¼Œå› æ­¤ï¼Œä¸€å®šè¦åœ¨ /users/user_id ä¹‹å‰å£°æ˜ /users/me ï¼š from fastapi import FastAPIapp = FastAPI()@app.get(/users/me)async def read_user_me(): return user_id: the current user@app.get(/users/user_id)async def read_user(user_id: str): return user_id: user_id æ­¤æ—¶è¾“å…¥ http://127.0.0.1:8000/users/me è¾“å‡ºå¦‚ä¸‹ç»“æœï¼š å¦‚æœæ–¹æ³•å®šä¹‰é¡ºåºç›¸åï¼Œ/users/user_id å°†åŒ¹é… /users/meï¼ŒFastAPI ä¼šè®¤ä¸ºæ­£åœ¨æ¥æ”¶å€¼ä¸º me çš„ user_id å‚æ•°ã€‚ from fastapi import FastAPIapp = FastAPI()@app.get(/users/user_id)async def read_user(user_id: str): return user_id: user_id@app.get(/users/me)async def read_user_me(): return user_id: the current user æ­¤æ—¶å†è¾“å…¥ http://127.0.0.1:8000/users/me è¾“å‡ºå¦‚ä¸‹ç»“æœï¼š é¢„è®¾å€¼ä½¿ç”¨ Python çš„ Enum ç±»å‹æ¥æ”¶é¢„è®¾çš„è·¯å¾„å‚æ•°ã€‚ Enumé¢„è®¾è·¯å¾„å¯¼å…¥ Enum å¹¶åˆ›å»ºç»§æ‰¿è‡ª str å’Œ Enum çš„å­ç±»ã€‚ é€šè¿‡ä» str ç»§æ‰¿ï¼ŒAPI æ–‡æ¡£å°±èƒ½æŠŠå€¼çš„ç±»å‹å®šä¹‰ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”èƒ½æ­£ç¡®æ¸²æŸ“ã€‚ ç„¶åï¼Œåˆ›å»ºåŒ…å«å›ºå®šå€¼çš„ç±»å±æ€§ï¼Œè¿™äº›å›ºå®šå€¼æ˜¯å¯ç”¨çš„æœ‰æ•ˆå€¼ï¼š from enum import Enumclass ModelName(str, Enum): alexnet = alexnet resnet = resnet lenet = lenet å£°æ˜è·¯å¾„å‚æ•°from enum import Enumfrom fastapi import FastAPIclass ModelName(str, Enum): alexnet = alexnet resnet = resnet lenet = lenetapp = FastAPI()@app.get(/models/model_name)async def get_model(model_name: ModelName): if model_name is ModelName.alexnet: return model_name: model_name, message: Deep Learning FTW! if model_name.value == lenet: return model_name: model_name, message: LeCNN all the images return model_name: model_name, message: Have some residuals API æ–‡æ¡£ä¼šæ˜¾ç¤ºé¢„å®šä¹‰è·¯å¾„å‚æ•°çš„å¯ç”¨å€¼ï¼š åŒ…å«è·¯å¾„çš„è·¯å¾„å‚æ•°å‡è®¾è·¯å¾„æ“ä½œçš„è·¯å¾„ä¸º /files/file_pathã€‚ ä½†éœ€è¦ file_path ä¸­ä¹ŸåŒ…å«è·¯å¾„ï¼Œæ¯”å¦‚ï¼Œhome/johndoe/myfile.txtã€‚ æ­¤æ—¶ï¼Œè¯¥æ–‡ä»¶çš„ URL æ˜¯è¿™æ ·çš„ï¼š/files/home/johndoe/myfile.txtã€‚ è·¯å¾„è½¬æ¢å™¨æˆ–è€…ä½¿ç”¨ Starlette çš„é€‰é¡¹å£°æ˜åŒ…å«è·¯å¾„çš„è·¯å¾„å‚æ•°ï¼š /files/file_path:path æœ¬ä¾‹ä¸­ï¼Œå‚æ•°åä¸º file_pathï¼Œç»“å°¾éƒ¨åˆ†çš„ :path è¯´æ˜è¯¥å‚æ•°åº”åŒ¹é…è·¯å¾„ã€‚ ç”¨æ³•å¦‚ä¸‹ï¼š from fastapi import FastAPIapp = FastAPI()@app.get(/files/file_path:path)async def read_file(file_path: str): return file_path: file_path æ³¨æ„ï¼ŒåŒ…å« /home/johndoe/myfile.txt çš„è·¯å¾„å‚æ•°è¦ä»¥æ–œæ ï¼ˆ/ï¼‰å¼€å¤´ã€‚ æœ¬ä¾‹ä¸­çš„ URL æ˜¯ /files//home/johndoe/myfile.txtã€‚æ³¨æ„ï¼Œfiles å’Œ home ä¹‹é—´è¦ä½¿ç”¨åŒæ–œæ ï¼ˆ//ï¼‰ã€‚ æŸ¥è¯¢å‚æ•°é»˜è®¤å€¼å½“å£°æ˜çš„å‡½æ•°ä¸­ã€å‡½æ•°å‚æ•°ã€‘ä¸æ˜¯ã€è·¯å¾„å‚æ•°ã€‘ä¸­çš„ä¸€éƒ¨åˆ†æ—¶ï¼Œå‡½æ•°ä¸­çš„å‚æ•°ä¼šè¢«è‡ªåŠ¨è§£é‡Šä¸ºã€æŸ¥è¯¢å‚æ•°ã€‘ from fastapi import FastAPIapp = FastAPI()fake_items_db = [item_name: Foo, item_name: Bar, item_name: Baz]@app.get(/items/)async def read_item(skip: int = 0, limit: int = 10): return fake_items_db[skip : skip + limit] å¯ä»¥çœ‹åˆ°å‚æ•°é»˜è®¤å€¼skipä¸º0ï¼Œlimitä¸º10ã€‚ è¿™äº›å€¼éƒ½æ˜¯ URL çš„ç»„æˆéƒ¨åˆ†ï¼Œå› æ­¤ï¼Œå®ƒä»¬çš„ç±»å‹æœ¬åº”æ˜¯å­—ç¬¦ä¸²ã€‚ ä½†å£°æ˜ Python ç±»å‹ï¼ˆä¸Šä¾‹ä¸­ä¸º intï¼‰ä¹‹åï¼Œè¿™äº›å€¼å°±ä¼šè½¬æ¢ä¸ºå£°æ˜çš„ç±»å‹ï¼Œå¹¶è¿›è¡Œç±»å‹æ ¡éªŒã€‚ å¯é€‰å‚æ•°from fastapi import FastAPIapp = FastAPI()@app.get(/items/item_id)async def read_item(item_id: str, q: str | None = None): if q: return item_id: item_id, q: q return item_id: item_id æœ¬ä¾‹ä¸­ï¼ŒæŸ¥è¯¢å‚æ•° q æ˜¯å¯é€‰çš„ï¼Œé»˜è®¤å€¼ä¸º Noneã€‚ æ³¨æ„ï¼ŒFastAPI å¯ä»¥è¯†åˆ«å‡º item_id æ˜¯è·¯å¾„å‚æ•°ï¼Œq ä¸æ˜¯è·¯å¾„å‚æ•°ï¼Œè€Œæ˜¯æŸ¥è¯¢å‚æ•°ã€‚å› ä¸ºé»˜è®¤å€¼ä¸º = Noneï¼ŒFastAPI æŠŠ q è¯†åˆ«ä¸ºå¯é€‰å‚æ•°ã€‚ FastAPI ä¸ä½¿ç”¨ Optional[str] ä¸­çš„ Optionalï¼ˆåªä½¿ç”¨ strï¼‰ï¼Œä½† Optional[str] å¯ä»¥å¸®åŠ©ç¼–è¾‘å™¨å‘ç°ä»£ç ä¸­çš„é”™è¯¯ã€‚ æŸ¥è¯¢å‚æ•°ç±»å‹è½¬æ¢from fastapi import FastAPIapp = FastAPI()@app.get(/items)async def read_item(short: bool = False): item = short: short if not short: item = short: not short return item å½“shortå€¼éç©º æˆ– éFalseæ—¶ï¼ŒFastAPI ä¼šè‡ªåŠ¨è½¬æ¢å‚æ•°ç±»å‹ã€‚ å¤šä¸ªè·¯å¾„å’ŒæŸ¥è¯¢å‚æ•°from fastapi import FastAPIapp = FastAPI()@app.get(/users/user_id/items/item_id)async def read_user_item( user_id: int, item_id: str, q: str): item = item_id: item_id, owner_id: user_id if q: item.update(q: q) return item å¿…é€‰æŸ¥è¯¢å‚æ•°æŸ¥è¯¢å‚æ•°ä¸è®¾ç½®é»˜è®¤å€¼ï¼Œé‚£ä¹ˆè¯¥æŸ¥è¯¢å‚æ•°å°±æ˜¯å¿…é€‰çš„ã€‚ from fastapi import FastAPIapp = FastAPI()@app.get(/items)async def read_item(item_id: int): return item_id: item_id è¿™é‡Œçš„æŸ¥è¯¢å‚æ•° item_id æ˜¯ç±»å‹ä¸º int çš„å¿…é€‰æŸ¥è¯¢å‚æ•°ã€‚ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥å¦‚ä¸‹URLï¼š http://127.0.0.1:8000/items å› ä¸ºè·¯å¾„ä¸­æ²¡æœ‰å¿…é€‰å‚æ•° item_idï¼Œ è¿”å›çš„å“åº”ä¸­ä¼šæ˜¾ç¤ºå¦‚ä¸‹é”™è¯¯ä¿¡æ¯ï¼š detail: [ type: missing, loc: [ query, item_id ], msg: Field required, input: null ] è¾“å…¥æ­£ç¡®URLï¼š http://127.0.0.1:8000/items?item_id=1 å¾—åˆ°æ­£ç¡®çš„è¿”å›ç»“æœï¼š item_id: 1 è¯·æ±‚ä½“è¯·æ±‚ä½“æ¦‚å¿µFastAPI ä½¿ç”¨è¯·æ±‚ä½“ä»å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚æµè§ˆå™¨ï¼‰å‘ API å‘é€æ•°æ®ã€‚ è¯·æ±‚ä½“æ˜¯å®¢æˆ·ç«¯å‘é€ç»™ API çš„æ•°æ®ã€‚å“åº”ä½“æ˜¯ API å‘é€ç»™å®¢æˆ·ç«¯çš„æ•°æ®ã€‚ API åŸºæœ¬ä¸Šè‚¯å®šè¦å‘é€å“åº”ä½“ï¼Œä½†æ˜¯å®¢æˆ·ç«¯ä¸ä¸€å®šå‘é€è¯·æ±‚ä½“ã€‚ ä½¿ç”¨ Pydantic æ¨¡å‹å£°æ˜è¯·æ±‚ä½“ï¼Œèƒ½å……åˆ†åˆ©ç”¨å®ƒçš„åŠŸèƒ½å’Œä¼˜ç‚¹ã€‚ åˆ›å»ºæ•°æ®æ¨¡å‹å¯¼å…¥ BaseModelfrom pydantic import BaseModelclass Item(BaseModel): name: str description: str | None = None price: float tax: float | None = None ä¸å£°æ˜æŸ¥è¯¢å‚æ•°ä¸€æ ·ï¼ŒåŒ…å«é»˜è®¤å€¼çš„æ¨¡å‹å±æ€§æ˜¯å¯é€‰çš„ï¼Œå¦åˆ™å°±æ˜¯å¿…é€‰çš„ã€‚é»˜è®¤å€¼ä¸º None çš„æ¨¡å‹å±æ€§ä¹Ÿæ˜¯å¯é€‰çš„ã€‚ ä¸Šè¿°æ¨¡å‹å£°æ˜å¦‚ä¸‹ JSON å¯¹è±¡ï¼ˆå³ Python å­—å…¸ï¼‰ï¼š name: Foo, description: An optional description, price: 45.2, tax: 3.5 ç”±äº description å’Œ tax æ˜¯å¯é€‰çš„ï¼ˆé»˜è®¤å€¼ä¸º Noneï¼‰ï¼Œä¸‹é¢çš„ JSON å¯¹è±¡ä¹Ÿæœ‰æ•ˆï¼š name: Foo, price: 45.2 å£°æ˜è¯·æ±‚ä½“å‚æ•°@app.post(/items/)async def create_item(item: Item): return item æ­¤å¤„ï¼Œè¯·æ±‚ä½“å‚æ•°çš„ç±»å‹ä¸º Item æ¨¡å‹ã€‚ è¯·æ±‚ä½“æ€»ç»“ä»…ä½¿ç”¨ Python ç±»å‹å£°æ˜ï¼ŒFastAPI å°±å¯ä»¥ï¼š ä»¥ JSON å½¢å¼è¯»å–è¯·æ±‚ä½“ ï¼ˆåœ¨å¿…è¦æ—¶ï¼‰æŠŠè¯·æ±‚ä½“è½¬æ¢ä¸ºå¯¹åº”çš„ç±»å‹ æ ¡éªŒæ•°æ®ï¼š æ•°æ®æ— æ•ˆæ—¶è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå¹¶æŒ‡å‡ºé”™è¯¯æ•°æ®çš„ç¡®åˆ‡ä½ç½®å’Œå†…å®¹ æŠŠæ¥æ”¶çš„æ•°æ®èµ‹å€¼ç»™å‚æ•° item æŠŠå‡½æ•°ä¸­è¯·æ±‚ä½“å‚æ•°çš„ç±»å‹å£°æ˜ä¸º Itemï¼Œè¿˜èƒ½è·å¾—ä»£ç è¡¥å…¨ç­‰ç¼–è¾‘å™¨æ”¯æŒ ä½¿ç”¨æ¨¡å‹from fastapi import FastAPIfrom pydantic import BaseModelclass Item(BaseModel): name: str description: str | None = None price: float tax: float | None = Noneapp = FastAPI()@app.post(/items/)async def create_item(item: Item): item_dict = item.model_dump() if item.tax is not None: price_with_tax = item.price + item.tax item_dict.update(price: price_with_tax) return item_dict if __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) å…¥å‚ï¼š name: ç®±å­, description: ä¸€ä¸ªå¤§ç®±å­, price: 10, tax: 10 è¿”å›ï¼š name: ç®±å­, description: ä¸€ä¸ªå¤§ç®±å­, price: 20, tax: 10 è¯·æ±‚ä½“ + è·¯å¾„å‚æ•°from fastapi import FastAPIfrom pydantic import BaseModelclass Item(BaseModel): name: str description: str | None = None price: float tax: float | None = Noneapp = FastAPI()@app.put(/items/item_id)async def update_item(item_id: int, item: Item): return item_id: item_id, **item.model_dump() å…¥å‚ï¼š è¿”å›ï¼š item_id: 1, name: ç®±å­, description: ä¸€ä¸ªå¤§ç®±å­, price: 10, tax: 10 è¯·æ±‚ä½“ + è·¯å¾„å‚æ•° + æŸ¥è¯¢å‚æ•°import uvicornfrom fastapi import FastAPIfrom pydantic import BaseModelclass Item(BaseModel): name: str description: str | None = None price: float tax: float | None = Noneapp = FastAPI()@app.put(/items/item_id)async def update_item(item_id: int, item: Item, q: str | None = None): result = item_id: item_id, **item.dict() if q: result.update(q: q) return resultif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) å…¥å‚ï¼š è¿”å›ï¼š item_id: 1, name: ç®±å­, description: ä¸€ä¸ªå¤§ç®±å­, price: 10, tax: 10, q: å˜å˜ å‡½æ•°å‚æ•°æŒ‰å¦‚ä¸‹è§„åˆ™è¿›è¡Œè¯†åˆ«ï¼š è·¯å¾„ä¸­å£°æ˜äº†ç›¸åŒå‚æ•°çš„å‚æ•°ï¼Œæ˜¯è·¯å¾„å‚æ•°ã€‚ç±»å‹æ˜¯ï¼ˆintã€floatã€strã€bool ç­‰ï¼‰å•ç±»å‹çš„å‚æ•°ï¼Œæ˜¯æŸ¥è¯¢å‚æ•°ã€‚ç±»å‹æ˜¯ Pydantic æ¨¡å‹çš„å‚æ•°ï¼Œæ˜¯è¯·æ±‚ä½“ã€‚ æŸ¥è¯¢å‚æ•°å’Œå­—ç¬¦ä¸²æ ¡éªŒFastAPI å…è®¸æˆ‘ä»¬ä¸ºå‚æ•°å£°æ˜é¢å¤–çš„ä¿¡æ¯å’Œæ ¡éªŒã€‚ä»¥ä¸‹é¢ç¨‹åºä¸ºä¾‹ï¼š import uvicornfrom fastapi import FastAPI, Queryapp = FastAPI()@app.get(/items/)async def read_items(q: str | None = Query(default=None, min_length=3, max_length=50)): results = items: [item_id: Foo, item_id: Bar] if q: results.update(q: q) return resultsif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) æŸ¥è¯¢å‚æ•° q çš„ç±»å‹ä¸º strï¼Œé»˜è®¤å€¼ä¸º Noneï¼Œå› æ­¤å®ƒæ˜¯å¯é€‰çš„ã€‚ Queryæ£€éªŒfrom fastapi import Queryq: str | None = Query(default=None, min_length=3, max_length=50) å°† Query ä½œä¸ºå‚æ•° q çš„é»˜è®¤å€¼ã€‚Query æ˜¾å¼åœ°å°† q å£°æ˜ä¸ºæŸ¥è¯¢å‚æ•°ï¼Œå¹¶è®¾ç½®æ ¡éªŒæ¡ä»¶ã€‚ æ— æ•ˆå…¥å‚ï¼š è¿”å›ï¼š detail: [ type: string_too_short, loc: [ query, q ], msg: String should have at least 3 characters, input: 12, ctx: min_length: 3 ] æ­£å¸¸å…¥å‚ï¼š è¿”å›ï¼š items: [ item_id: Foo , item_id: Bar ], q: 123 æ­£åˆ™æ ¡éªŒfrom typing import Unionimport uvicornfrom fastapi import FastAPI, Queryapp = FastAPI()@app.get(/items/)async def read_items( q: Union[str, None] = Query( default=None, min_length=3, max_length=50, pattern=^fixedquery$ ),): results = items: [item_id: Foo, item_id: Bar] if q: results.update(q: q) return resultsif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) ä½¿ç”¨ pattern è®¾ç½®æ­£åˆ™è¡¨è¾¾å¼æ ¡éªŒå‚æ•°ã€‚ è¿™ä¸ªæŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼é€šè¿‡ä»¥ä¸‹è§„åˆ™æ£€æŸ¥æ¥æ”¶åˆ°çš„å‚æ•°å€¼ï¼š ^ï¼šä»¥è¯¥ç¬¦å·ä¹‹åçš„å­—ç¬¦å¼€å¤´ï¼Œç¬¦å·ä¹‹å‰æ²¡æœ‰å­—ç¬¦ã€‚ fixedquery: å€¼ç²¾ç¡®åœ°ç­‰äº fixedqueryã€‚ $: åˆ°æ­¤ç»“æŸï¼Œåœ¨ fixedquery ä¹‹åæ²¡æœ‰æ›´å¤šå­—ç¬¦ã€‚ æ— æ•ˆå…¥å‚ï¼š è¿”å›ï¼š detail: [ type: string_pattern_mismatch, loc: [ query, q ], msg: String should match pattern ^fixedquery$, input: 123, ctx: pattern: ^fixedquery$ ] æ­£å¸¸å…¥å‚ï¼š è¿”å›ï¼š items: [ item_id: Foo , item_id: Bar ], q: fixedquery Query é»˜è®¤å€¼ä½ å¯ä»¥å‘ Query çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ None ç”¨ä½œæŸ¥è¯¢å‚æ•°çš„é»˜è®¤å€¼ï¼Œä»¥åŒæ ·çš„æ–¹å¼ä½ ä¹Ÿå¯ä»¥ä¼ é€’å…¶ä»–é»˜è®¤å€¼ã€‚ å‡è®¾ä½ æƒ³è¦å£°æ˜æŸ¥è¯¢å‚æ•° qï¼Œä½¿å…¶ min_length ä¸º 3ï¼Œå¹¶ä¸”é»˜è®¤å€¼ä¸º fixedqueryï¼š from fastapi import FastAPI, Queryapp = FastAPI()@app.get(/items/)async def read_items(q: str = Query(default=fixedquery, min_length=3)): results = items: [item_id: Foo, item_id: Bar] if q: results.update(q: q) return results å…·æœ‰é»˜è®¤å€¼ä¼šä½¿è¯¥å‚æ•°æˆä¸ºå¯é€‰å‚æ•°ã€‚ å£°æ˜å¿…éœ€å‚æ•°å½“ä½ åœ¨ä½¿ç”¨ Query ä¸”éœ€è¦å£°æ˜ä¸€ä¸ªå€¼æ˜¯å¿…éœ€çš„æ—¶ï¼Œåªéœ€ä¸å£°æ˜é»˜è®¤å‚æ•°ï¼š from fastapi import FastAPI, Queryapp = FastAPI()@app.get(/items/)async def read_items(q: str = Query(min_length=3)): results = items: [item_id: Foo, item_id: Bar] if q: results.update(q: q) return results ä½¿ç”¨ None å£°æ˜å¿…éœ€å‚æ•°ä½ å¯ä»¥å£°æ˜ä¸€ä¸ªå‚æ•°å¯ä»¥æ¥æ”¶ None å€¼ï¼Œä½†å®ƒä»ç„¶æ˜¯å¿…éœ€çš„ã€‚è¿™å°†å¼ºåˆ¶å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªå€¼ï¼Œå³ä½¿è¯¥å€¼æ˜¯ Noneã€‚ import uvicornfrom fastapi import FastAPI, Queryapp = FastAPI()@app.get(/items/)async def read_items(q: str | None = Query(min_length=3)): results = items: [item_id: Foo, item_id: Bar] if q: results.update(q: q) return resultsif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) å…¥å‚ï¼š http://127.0.0.1:8000/items/ è¿”å›ï¼š detail: [ type: missing, loc: [ query, q ], msg: Field required, input: null ] æŸ¥è¯¢å‚æ•°åˆ—è¡¨å½“ä½ ä½¿ç”¨ Query æ˜¾å¼åœ°å®šä¹‰æŸ¥è¯¢å‚æ•°æ—¶ï¼Œä½ è¿˜å¯ä»¥å£°æ˜å®ƒå»æ¥æ”¶ä¸€ç»„å€¼ï¼Œæˆ–æ¢å¥è¯æ¥è¯´ï¼Œæ¥æ”¶å¤šä¸ªå€¼ã€‚ ä¾‹å¦‚ï¼Œè¦å£°æ˜ä¸€ä¸ªå¯åœ¨ URL ä¸­å‡ºç°å¤šæ¬¡çš„æŸ¥è¯¢å‚æ•° qï¼Œä½ å¯ä»¥è¿™æ ·å†™ï¼š from typing import Listimport uvicornfrom fastapi import FastAPIfrom fastapi import Queryapp = FastAPI()@app.get(/items/)async def read_items(query: List[str] | None = Query(default=None)): query_items = query: query return query_itemsif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) ç„¶åï¼Œè¾“å…¥å¦‚ä¸‹ç½‘å€ï¼š http://localhost:8000/items/?query=123query=321 ä½ ä¼šåœ¨è·¯å¾„æ“ä½œå‡½æ•°çš„å‡½æ•°å‚æ•° q ä¸­ä»¥ä¸€ä¸ª Python list çš„å½¢å¼æ¥æ”¶åˆ°æŸ¥è¯¢å‚æ•° q çš„å¤šä¸ªå€¼ã€‚ å› æ­¤ï¼Œè¯¥ URL çš„å“åº”å°†ä¼šæ˜¯ï¼š query: [ 123, 321 ] è¦å£°æ˜ç±»å‹ä¸º list çš„æŸ¥è¯¢å‚æ•°ï¼Œå¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œä½ éœ€è¦æ˜¾å¼åœ°ä½¿ç”¨ Queryï¼Œå¦åˆ™è¯¥å‚æ•°å°†è¢«è§£é‡Šä¸ºè¯·æ±‚ä½“ã€‚ å¸¦é»˜è®¤å€¼çš„æŸ¥è¯¢å‚æ•°åˆ—è¡¨from typing import Annotatedimport uvicornfrom fastapi import FastAPI, Queryapp = FastAPI()@app.get(/items/)async def read_items(q: Annotated[list[str], Query()] = [123, 321]): query_items = q: q return query_itemsif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) è¾“å…¥å‚æ•°åŒ…å«é»˜è®¤å€¼ï¼š å£°æ˜æ›´å¤šå…ƒæ•°æ®ä½ å¯ä»¥æ·»åŠ æ›´å¤šæœ‰å…³è¯¥å‚æ•°çš„ä¿¡æ¯ã€‚ è¿™äº›ä¿¡æ¯å°†åŒ…å«åœ¨ç”Ÿæˆçš„ OpenAPI æ¨¡å¼ä¸­ï¼Œå¹¶ç”±æ–‡æ¡£ç”¨æˆ·ç•Œé¢å’Œå¤–éƒ¨å·¥å…·æ‰€ä½¿ç”¨ã€‚ from typing import Annotatedimport uvicornfrom fastapi import FastAPI, Queryapp = FastAPI()@app.get(/items/)async def read_items( q: Annotated[ str | None, Query( title=Query string, description=Query string for the items to search in the database that have a good match, min_length=3, ), ] = None,): results = items: [item_id: Foo, item_id: Bar] if q: results.update(q: q) return resultsif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) åˆ«åå‚æ•°å‡è®¾ä½ æƒ³è¦æŸ¥è¯¢å‚æ•°ä¸º item-queryã€‚ åƒä¸‹é¢è¿™æ ·ï¼š http://127.0.0.1:8000/items/?item-query=foobaritems ä½†æ˜¯ item-query ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ Python å˜é‡åç§°ã€‚ æœ€æ¥è¿‘çš„æœ‰æ•ˆåç§°æ˜¯ item_queryã€‚ ä½†æ˜¯ä½ ä»ç„¶è¦æ±‚å®ƒåœ¨ URL ä¸­å¿…é¡»æ˜¯ item-queryã€‚ è¿™æ—¶ä½ å¯ä»¥ç”¨ alias å‚æ•°å£°æ˜ä¸€ä¸ªåˆ«åï¼Œè¯¥åˆ«åå°†ç”¨äºåœ¨ URL ä¸­æŸ¥æ‰¾æŸ¥è¯¢å‚æ•°å€¼ï¼š from typing import Annotatedfrom fastapi import FastAPI, Queryapp = FastAPI()@app.get(/items/)async def read_items(q: Annotated[str | None, Query(alias=item-query)] = None): results = items: [item_id: Foo, item_id: Bar] if q: results.update(q: q) return results å¼ƒç”¨å‚æ•°ç°åœ¨å‡è®¾ä½ ä¸å†å–œæ¬¢æ­¤å‚æ•°ã€‚ ä½ ä¸å¾—ä¸å°†å…¶ä¿ç•™ä¸€æ®µæ—¶é—´ï¼Œå› ä¸ºæœ‰äº›å®¢æˆ·ç«¯æ­£åœ¨ä½¿ç”¨å®ƒï¼Œä½†ä½ å¸Œæœ›æ–‡æ¡£æ¸…æ¥šåœ°å°†å…¶å±•ç¤ºä¸ºå·²å¼ƒç”¨ã€‚ é‚£ä¹ˆå°†å‚æ•° deprecated=True ä¼ å…¥ Queryï¼š from typing import Annotatedimport uvicornfrom fastapi import FastAPI, Queryapp = FastAPI()@app.get(/items/)async def read_items( q: Annotated[ str | None, Query( alias=item-query, title=Query string, description=Query string for the items to search in the database that have a good match, min_length=3, max_length=50, pattern=^fixedquery$, deprecated=True, ), ] = None,): results = items: [item_id: Foo, item_id: Bar] if q: results.update(q: q) return resultsif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) æ–‡æ¡£å°†ä¼šåƒä¸‹é¢è¿™æ ·å±•ç¤ºå®ƒï¼š æŸ¥è¯¢å‚æ•°å’Œå­—ç¬¦ä¸²æ ¡éªŒæ€»ç»“ä½ å¯ä»¥ä¸ºæŸ¥è¯¢å‚æ•°å£°æ˜é¢å¤–çš„æ ¡éªŒå’Œå…ƒæ•°æ®ã€‚ é€šç”¨çš„æ ¡éªŒå’Œå…ƒæ•°æ®ï¼š alias title description deprecated ç‰¹å®šäºå­—ç¬¦ä¸²çš„æ ¡éªŒï¼š min_length max_length regex è·¯å¾„å‚æ•°å’Œæ•°å€¼æ ¡éªŒä¸ä½¿ç”¨ Query ä¸ºæŸ¥è¯¢å‚æ•°å£°æ˜æ›´å¤šçš„æ ¡éªŒå’Œå…ƒæ•°æ®çš„æ–¹å¼ç›¸åŒï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ Path ä¸ºè·¯å¾„å‚æ•°å£°æ˜ç›¸åŒç±»å‹çš„æ ¡éªŒå’Œå…ƒæ•°æ®ã€‚ å¯¼å…¥ Pathfrom typing import Annotated, Unionfrom fastapi import FastAPI, Path, Queryapp = FastAPI()@app.get(/items/item_id)async def read_items( item_id: Annotated[int, Path(title=The ID of the item to get)], q: Annotated[Union[str, None], Query(alias=item-query)] = None,): results = item_id: item_id if q: results.update(q: q) return results æŒ‰éœ€å¯¹å‚æ•°æ’åºåœ¨ Python ä¸­ï¼Œå°†å¸¦æœ‰é»˜è®¤å€¼çš„å‚æ•°æ”¾åœ¨ä¸å¸¦æœ‰é»˜è®¤å€¼çš„å‚æ•°ä¹‹å‰ Python ä¼šæŠ¥é”™ã€‚ åœ¨ FastAPI ä¸­è¿™æ— å…³ç´§è¦ã€‚å®ƒå°†é€šè¿‡å‚æ•°çš„åç§°ã€ç±»å‹å’Œé»˜è®¤å€¼å£°æ˜ï¼ˆQueryã€Path ç­‰ï¼‰æ¥æ£€æµ‹å‚æ•°ï¼Œè€Œä¸åœ¨ä¹å‚æ•°çš„é¡ºåºã€‚ from typing import Annotatedfrom fastapi import FastAPI, Pathapp = FastAPI()@app.get(/items/item_id)async def read_items( q: str, item_id: Annotated[int, Path(title=The ID of the item to get)]): results = item_id: item_id if q: results.update(q: q) return results å¦‚æœä½ æƒ³ä½¿ç”¨ Path å£°æ˜è·¯å¾„å‚æ•° item_idï¼Œå¹¶ä½¿å®ƒä»¬çš„é¡ºåºä¸ä¸Šé¢ä¸åŒï¼ŒPython å¯¹æ­¤æœ‰ä¸€äº›ç‰¹æ®Šçš„è¯­æ³•ã€‚ ä¼ é€’ * ä½œä¸ºå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ Python ä¸ä¼šå¯¹è¯¥ * åšä»»ä½•äº‹æƒ…ï¼Œä½†æ˜¯å®ƒå°†çŸ¥é“ä¹‹åçš„æ‰€æœ‰å‚æ•°éƒ½åº”ä½œä¸ºå…³é”®å­—å‚æ•°ï¼ˆé”®å€¼å¯¹ï¼‰ï¼Œä¹Ÿè¢«ç§°ä¸º kwargsï¼Œæ¥è°ƒç”¨ã€‚å³ä½¿å®ƒä»¬æ²¡æœ‰é»˜è®¤å€¼ã€‚ from typing import Annotatedimport uvicornfrom fastapi import FastAPI, Pathapp = FastAPI()@app.get(/items/item_id)async def red_items(*, item_id: Annotated[int, Path(title=The ID of the item to get)] = None, q: str): results = item_id: item_id if q: results.update(q: q) return resultsif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) æ•°å€¼æ ¡éªŒï¼šå¤§äºç­‰äºä½¿ç”¨ Query å’Œ Path å¯ä»¥å£°æ˜å­—ç¬¦ä¸²çº¦æŸï¼Œä½†ä¹Ÿå¯ä»¥å£°æ˜æ•°å€¼çº¦æŸã€‚ åƒä¸‹é¢è¿™æ ·ï¼Œæ·»åŠ  ge=1 åï¼Œitem_id å°†å¿…é¡»æ˜¯ä¸€ä¸ªå¤§äºï¼ˆgreater thanï¼‰æˆ–ç­‰äºï¼ˆequalï¼‰1 çš„æ•´æ•°ã€‚ from typing import Annotatedfrom fastapi import FastAPI, Pathapp = FastAPI()@app.get(/items/item_id)async def read_items( item_id: Annotated[int, Path(title=The ID of the item to get, ge=1)], q: str): results = item_id: item_id if q: results.update(q: q) return results æ•°å€¼æ ¡éªŒï¼šå¤§äºå’Œå°äºç­‰äºåŒæ ·çš„è§„åˆ™é€‚ç”¨äºï¼š gtï¼šå¤§äºï¼ˆgreater thanï¼‰ leï¼šå°äºç­‰äºï¼ˆless than or equalï¼‰ from typing import Annotatedfrom fastapi import FastAPI, Pathapp = FastAPI()@app.get(/items/item_id)async def read_items( item_id: Annotated[int, Path(title=The ID of the item to get, gt=0, le=1000)], q: str,): results = item_id: item_id if q: results.update(q: q) return results æ•°å€¼æ ¡éªŒï¼šæµ®ç‚¹æ•°ã€å¤§äºå’Œå°äºæ•°å€¼æ ¡éªŒåŒæ ·é€‚ç”¨äº float å€¼ã€‚ èƒ½å¤Ÿå£°æ˜ gt è€Œä¸ä»…ä»…æ˜¯ ge åœ¨è¿™ä¸ªå‰æä¸‹å˜å¾—é‡è¦èµ·æ¥ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥è¦æ±‚ä¸€ä¸ªå€¼å¿…é¡»å¤§äº 0ï¼Œå³ä½¿å®ƒå°äº 1ã€‚ å› æ­¤ï¼Œ0.5 å°†æ˜¯æœ‰æ•ˆå€¼ã€‚ä½†æ˜¯ 0.0 æˆ– 0 ä¸æ˜¯ã€‚ å¯¹äº lt ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚ from typing import Annotatedfrom fastapi import FastAPI, Path, Queryapp = FastAPI()@app.get(/items/item_id)async def read_items( *, item_id: Annotated[int, Path(title=The ID of the item to get, ge=0, le=1000)], q: str, size: Annotated[float, Query(gt=0, lt=10.5)],): results = item_id: item_id if q: results.update(q: q) if size: results.update(size: size) return results æ•°å€¼æ ¡éªŒæ€»ç»“ä½ èƒ½å¤Ÿä»¥ä¸ æŸ¥è¯¢å‚æ•°å’Œå­—ç¬¦ä¸²æ ¡éªŒ ç›¸åŒçš„æ–¹å¼ä½¿ç”¨ Queryã€Path å£°æ˜å…ƒæ•°æ®å’Œå­—ç¬¦ä¸²æ ¡éªŒã€‚ è€Œä¸”ä½ è¿˜å¯ä»¥å£°æ˜æ•°å€¼æ ¡éªŒï¼š gtï¼šå¤§äºï¼ˆgreater thanï¼‰ geï¼šå¤§äºç­‰äºï¼ˆgreater than or equalï¼‰ ltï¼šå°äºï¼ˆless thanï¼‰ leï¼šå°äºç­‰äºï¼ˆless than or equalï¼‰ æŸ¥è¯¢å‚æ•°æ¨¡å‹å¦‚æœä½ æœ‰ä¸€ç»„å…·æœ‰ç›¸å…³æ€§çš„æŸ¥è¯¢å‚æ•°ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª Pydantic æ¨¡å‹æ¥å£°æ˜å®ƒä»¬ã€‚ è¿™å°†å…è®¸ä½ åœ¨å¤šä¸ªåœ°æ–¹å»å¤ç”¨æ¨¡å‹ï¼Œå¹¶ä¸”ä¸€æ¬¡æ€§ä¸ºæ‰€æœ‰å‚æ•°å£°æ˜éªŒè¯å’Œå…ƒæ•°æ®ã€‚ ä½¿ç”¨ Pydantic æ¨¡å‹çš„æŸ¥è¯¢å‚æ•°åœ¨ä¸€ä¸ª Pydantic æ¨¡å‹ä¸­å£°æ˜ä½ éœ€è¦çš„æŸ¥è¯¢å‚æ•°ï¼Œç„¶åå°†å‚æ•°å£°æ˜ä¸º Queryï¼š from idlelib.query import Queryimport uvicornåœ¨ Python ä¸­ï¼ŒLiteral æ˜¯ typing æ¨¡å—æä¾›çš„ä¸€ä¸ªç‰¹æ®Šç±»å‹æ³¨è§£ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªå˜é‡æˆ–å‚æ•°åªèƒ½æ˜¯ç‰¹å®šçš„å­—é¢é‡å€¼ï¼ˆå³å…·ä½“çš„å€¼ï¼Œè€Œä¸æ˜¯ç±»å‹ï¼‰ã€‚å®ƒé€šå¸¸ç”¨äºç±»å‹æ£€æŸ¥å·¥å…·ï¼ˆå¦‚ mypyï¼‰æ¥å¢å¼ºä»£ç çš„ç±»å‹å®‰å…¨æ€§ã€‚Literal çš„ä½œç”¨â€Œ1.â€Œé™åˆ¶å˜é‡æˆ–å‚æ•°çš„å–å€¼èŒƒå›´â€Œï¼š ä½¿ç”¨ Literal å¯ä»¥æ˜ç¡®æŒ‡å®šæŸä¸ªå˜é‡æˆ–å‚æ•°åªèƒ½æ˜¯æŸäº›ç‰¹å®šçš„å€¼ï¼Œè€Œä¸æ˜¯ä»»æ„å€¼ã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªå‡½æ•°å‚æ•°åªèƒ½æ˜¯ redã€green æˆ– blueï¼Œè€Œä¸èƒ½æ˜¯å…¶ä»–å­—ç¬¦ä¸²ã€‚2.â€Œæé«˜ä»£ç å¯è¯»æ€§å’Œç±»å‹å®‰å…¨æ€§â€Œï¼š é€šè¿‡ Literalï¼Œå¼€å‘è€…å¯ä»¥æ›´æ¸…æ™°åœ°è¡¨è¾¾æ„å›¾ï¼Œç±»å‹æ£€æŸ¥å™¨ä¹Ÿèƒ½åœ¨ç¼–è¯‘æ—¶æˆ–é™æ€åˆ†ææ—¶å‘ç°æ½œåœ¨çš„é”™è¯¯ã€‚from typing import Literal, Annotatedfrom fastapi import FastAPIfrom pydantic import BaseModel, Fieldapp = FastAPI()class FilterParams(BaseModel): limit: int = Field(100, gt=0, le=100) offset: int = Field(0, ge=0) order_by: Literal[created_at, updated_at] = created_at targs: list[str] = []@app.get(/items/)async def read_items(filter_query: Annotated[FilterParams, Query]): return filter_queryif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) FastAPI å°†ä¼šä»è¯·æ±‚çš„æŸ¥è¯¢å‚æ•°ä¸­æå–å‡ºæ¯ä¸ªå­—æ®µçš„æ•°æ®ï¼Œå¹¶å°†å…¶æä¾›ç»™ä½ å®šä¹‰çš„ Pydantic æ¨¡å‹ã€‚ åœ¨ doc æ–‡æ¡£ä¸­ï¼ŒSchema åˆ—å¯ä»¥æŸ¥çœ‹å‚æ•°çº¦æŸï¼š ç¦æ­¢é¢å¤–çš„æŸ¥è¯¢å‚æ•°åœ¨ä¸€äº›ç‰¹æ®Šçš„ä½¿ç”¨åœºæ™¯ä¸­ï¼Œä½ å¯èƒ½å¸Œæœ›é™åˆ¶ä½ è¦æ¥æ”¶çš„æŸ¥è¯¢å‚æ•°ã€‚ ä½ å¯ä»¥ä½¿ç”¨ Pydantic çš„æ¨¡å‹é…ç½®æ¥ forbidï¼ˆæ„ä¸ºç¦æ­¢ï¼‰ä»»ä½• extraï¼ˆæ„ä¸ºé¢å¤–çš„ï¼‰å­—æ®µï¼š from typing import Annotated, Literalfrom fastapi import FastAPI, Queryfrom pydantic import BaseModel, Fieldapp = FastAPI()class FilterParams(BaseModel): model_config = extra: forbid limit: int = Field(100, gt=0, le=100) offset: int = Field(0, ge=0) order_by: Literal[created_at, updated_at] = created_at tags: list[str] = []@app.get(/items/)async def read_items(filter_query: Annotated[FilterParams, Query()]): return filter_query å‡è®¾æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å°è¯•åœ¨æŸ¥è¯¢å‚æ•°ä¸­å‘é€ä¸€äº›é¢å¤–çš„æ•°æ®ï¼Œå®ƒå°†ä¼šæ”¶åˆ°ä¸€ä¸ªé”™è¯¯å“åº”ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœå®¢æˆ·ç«¯å°è¯•å‘é€ä¸€ä¸ªå€¼ä¸º plumbus çš„ tool æŸ¥è¯¢å‚æ•°ï¼Œå¦‚ï¼š https://example.com/items/?limit=10tool=plumbus ä»–ä»¬å°†æ”¶åˆ°ä¸€ä¸ªé”™è¯¯å“åº”ï¼Œå‘Šè¯‰ä»–ä»¬æŸ¥è¯¢å‚æ•° tool æ˜¯ä¸å…è®¸çš„ï¼š detail: [ type: extra_forbidden, loc: [query, tool], msg: Extra inputs are not permitted, input: plumbus ] è¯·æ±‚ä½“-å¤šä¸ªå‚æ•°æ··åˆä½¿ç”¨ Pathã€Query å’Œè¯·æ±‚ä½“å‚æ•°é¦–å…ˆï¼Œæ¯«æ— ç–‘é—®åœ°ï¼Œä½ å¯ä»¥éšæ„åœ°æ··åˆä½¿ç”¨ Pathã€Query å’Œè¯·æ±‚ä½“å‚æ•°å£°æ˜ï¼ŒFastAPI ä¼šçŸ¥é“è¯¥å¦‚ä½•å¤„ç†ã€‚ ä½ è¿˜å¯ä»¥é€šè¿‡å°†é»˜è®¤å€¼è®¾ç½®ä¸º None æ¥å°†è¯·æ±‚ä½“å‚æ•°å£°æ˜ä¸ºå¯é€‰å‚æ•°ï¼š from typing import Annotatedfrom fastapi import FastAPI, Pathfrom pydantic import BaseModelapp = FastAPI()class Item(BaseModel): name: str description: str | None = None print: float tax: float | None = None@app.put(/items/item_id)async def update_item( item_id: Annotated[int, Path(title=item_id, ge=0, le=1000)], q: str | None = None, item: Item | None = None): results = item_id: item_id if q: results.update(q: q) if item: results.update(item: item) return results è¯·æ³¨æ„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†ä»è¯·æ±‚ä½“è·å–çš„ item æ˜¯å¯é€‰çš„ã€‚å› ä¸ºå®ƒçš„é»˜è®¤å€¼ä¸º Noneã€‚ å¤šä¸ªè¯·æ±‚ä½“å‚æ•°åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œè·¯å¾„æ“ä½œå°†æœŸæœ›ä¸€ä¸ªå…·æœ‰ Item çš„å±æ€§çš„ JSON è¯·æ±‚ä½“ï¼Œå°±åƒï¼š name: Foo, description: The pretender, price: 42.0, tax: 3.2 ä½†æ˜¯ä½ ä¹Ÿå¯ä»¥å£°æ˜å¤šä¸ªè¯·æ±‚ä½“å‚æ•°ï¼Œä¾‹å¦‚ item å’Œ userï¼š from fastapi import FastAPIfrom pydantic import BaseModelapp = FastAPI()class Item(BaseModel): name: str description: str | None = None print: float tax: float | None = Noneclass User(BaseModel): username: str full_name: str | None = None@app.put(/items/item_id)async def update_item(item_id: int, item: Item, user: User): results = item_id: item_id, item: item, user: user return results åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒFastAPI å°†æ³¨æ„åˆ°è¯¥å‡½æ•°ä¸­æœ‰å¤šä¸ªè¯·æ±‚ä½“å‚æ•°ï¼ˆä¸¤ä¸ª Pydantic æ¨¡å‹å‚æ•°ï¼‰ã€‚ å› æ­¤ï¼Œå®ƒå°†ä½¿ç”¨å‚æ•°åç§°ä½œä¸ºè¯·æ±‚ä½“ä¸­çš„é”®ï¼ˆå­—æ®µåç§°ï¼‰ï¼Œå¹¶æœŸæœ›ä¸€ä¸ªç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„è¯·æ±‚ä½“ï¼š item: name: Foo, description: The pretender, price: 42.0, tax: 3.2 , user: username: dave, full_name: Dave Grohl FastAPI å°†è‡ªåŠ¨å¯¹è¯·æ±‚ä¸­çš„æ•°æ®è¿›è¡Œè½¬æ¢ï¼Œå› æ­¤ item å‚æ•°å°†æ¥æ”¶æŒ‡å®šçš„å†…å®¹ï¼ŒÃŸuser å‚æ•°ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå®ƒå°†æ‰§è¡Œå¯¹å¤åˆæ•°æ®çš„æ ¡éªŒã€‚ è¯·æ±‚ä½“å½“ä¸­çš„å•ä¸€å€¼ä¸ä½¿ç”¨ Query å’Œ Path ä¸ºæŸ¥è¯¢å‚æ•°å’Œè·¯å¾„å‚æ•°å®šä¹‰é¢å¤–æ•°æ®çš„æ–¹å¼ç›¸åŒï¼ŒFastAPI æä¾›äº†ä¸€ä¸ªåŒç­‰çš„ Bodyã€‚ ä¾‹å¦‚ï¼Œä¸ºäº†æ‰©å±•å…ˆå‰çš„æ¨¡å‹ï¼Œä½ å¯èƒ½å†³å®šé™¤äº† item å’Œ user ä¹‹å¤–ï¼Œè¿˜æƒ³åœ¨åŒä¸€è¯·æ±‚ä½“ä¸­å…·æœ‰å¦ä¸€ä¸ªé”® importanceã€‚ å¦‚æœä½ å°±æŒ‰åŸæ ·å£°æ˜å®ƒï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå•ä¸€å€¼ï¼ŒFastAPI å°†å‡å®šå®ƒæ˜¯ä¸€ä¸ªæŸ¥è¯¢å‚æ•°ã€‚ ä½†æ˜¯ä½ å¯ä»¥ä½¿ç”¨ Body æŒ‡ç¤º FastAPI å°†å…¶ä½œä¸ºè¯·æ±‚ä½“çš„å¦ä¸€ä¸ªé”®è¿›è¡Œå¤„ç†ã€‚ from typing import Annotatedfrom fastapi import Body, FastAPIfrom pydantic import BaseModelapp = FastAPI()class Item(BaseModel): name: str description: str | None = None price: float tax: float | None = Noneclass User(BaseModel): username: str full_name: str | None = None@app.put(/items/item_id)async def update_item(item_id: int, item: Item, user: User, importance: Annotated[int, Body()]): return dict(item_id=item_id, item=item, user=user, importance=importance) åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒFastAPI å°†æœŸæœ›åƒè¿™æ ·çš„è¯·æ±‚ä½“ï¼š item: name: Foo, description: The pretender, price: 42.0, tax: 3.2 , user: username: dave, full_name: Dave Grohl , importance: 5 å¤šä¸ªè¯·æ±‚ä½“å‚æ•°å’ŒæŸ¥è¯¢å‚æ•°å½“ç„¶ï¼Œé™¤äº†è¯·æ±‚ä½“å‚æ•°å¤–ï¼Œä½ è¿˜å¯ä»¥åœ¨ä»»ä½•éœ€è¦çš„æ—¶å€™å£°æ˜é¢å¤–çš„æŸ¥è¯¢å‚æ•°ã€‚ ç”±äºé»˜è®¤æƒ…å†µä¸‹å•ä¸€å€¼è¢«è§£é‡Šä¸ºæŸ¥è¯¢å‚æ•°ï¼Œå› æ­¤ä½ ä¸å¿…æ˜¾å¼åœ°æ·»åŠ  Queryï¼Œä½ å¯ä»¥ä»…æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š q: str = None ä¾‹å¦‚ï¼š from typing import Annotatedfrom fastapi import Body, FastAPIfrom pydantic import BaseModelapp = FastAPI()class Item(BaseModel): name: str description: str | None = None price: float tax: float | None = Noneclass User(BaseModel): username: str full_name: str | None = None@app.put(/items/item_id)async def update_item( *, item_id: int, item: Item, user: User, importance: Annotated[int, Body(gt=0)], q: str | None = None,): results = item_id: item_id, item: item, user: user, importance: importance if q: results.update(q: q) return results Body åŒæ ·å…·æœ‰ä¸ Queryã€Path å®Œå…¨ç›¸åŒçš„é¢å¤–æ ¡éªŒå’Œå…ƒæ•°æ®å‚æ•°ã€‚ åµŒå…¥å•ä¸ªè¯·æ±‚ä½“å‚æ•°å‡è®¾ä½ åªæœ‰ä¸€ä¸ªæ¥è‡ª Pydantic æ¨¡å‹ Item çš„è¯·æ±‚ä½“å‚æ•° itemã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒFastAPI å°†ç›´æ¥æœŸæœ›è¿™æ ·çš„è¯·æ±‚ä½“ã€‚ ä½†æ˜¯ï¼Œå¦‚æœä½ å¸Œæœ›å®ƒæœŸæœ›ä¸€ä¸ªæ‹¥æœ‰ item é”®å¹¶åœ¨å€¼ä¸­åŒ…å«æ¨¡å‹å†…å®¹çš„ JSONï¼Œå°±åƒåœ¨å£°æ˜é¢å¤–çš„è¯·æ±‚ä½“å‚æ•°æ—¶æ‰€åšçš„é‚£æ ·ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„ Body å‚æ•° embedï¼š item: Item = Body(embed=True) ä¾‹å¦‚ï¼š from typing import Annotatedfrom fastapi import Body, FastAPIfrom pydantic import BaseModelapp = FastAPI()class Item(BaseModel): name: str description: str | None = None price: float tax: float | None = None@app.put(/items/item_id)async def update_item(item_id: int, item: Annotated[Item, Body(embed=True)]): results = item_id: item_id, item: item return results åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒFastAPI å°†æœŸæœ›åƒè¿™æ ·çš„è¯·æ±‚ä½“ï¼š item: name: Foo, description: The pretender, price: 42.0, tax: 3.2 è€Œä¸æ˜¯ï¼š name: Foo, description: The pretender, price: 42.0, tax: 3.2 è¯·æ±‚ä½“-å­—æ®µä¸åœ¨è·¯å¾„æ“ä½œå‡½æ•°ä¸­ä½¿ç”¨ Queryã€Path ã€Body å£°æ˜æ ¡éªŒä¸å…ƒæ•°æ®çš„æ–¹å¼ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨ Pydantic çš„ Field åœ¨ Pydantic æ¨¡å‹å†…éƒ¨å£°æ˜æ ¡éªŒå’Œå…ƒæ•°æ®ã€‚ from typing import Annotatedimport uvicornfrom fastapi import FastAPI, Bodyfrom pydantic import BaseModel, Fieldapp = FastAPI()class Item(BaseModel): name: str description: str | None = Field( default=None, title=the description of the item, max_length=100 ) price: float = Field(gt=0, description=the price of the item, must be greater than zero) tax: float | None = None@app.put(/items/item_id)async def update_item(item_id: int, item: Annotated[Item, Body(embed=True)]): result = item_id: item_id, item: item return resultif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) Field çš„å·¥ä½œæ–¹å¼å’Œ Queryã€Pathã€Body ç›¸åŒï¼Œå‚æ•°ä¹Ÿç›¸åŒã€‚ å®é™…ä¸Šï¼ŒQueryã€Path éƒ½æ˜¯ Params çš„å­ç±»ï¼Œè€Œ Params ç±»åˆæ˜¯ Pydantic ä¸­ FieldInfo çš„å­ç±»ã€‚ Pydantic çš„ Field è¿”å›ä¹Ÿæ˜¯ FieldInfo çš„ç±»å®ä¾‹ã€‚ Body ç›´æ¥è¿”å›çš„ä¹Ÿæ˜¯ FieldInfo çš„å­ç±»çš„å¯¹è±¡ã€‚åæ–‡è¿˜ä¼šä»‹ç»ä¸€äº› Body çš„å­ç±»ã€‚ æ³¨æ„ï¼Œä» fastapi å¯¼å…¥çš„ Queryã€Path ç­‰å¯¹è±¡å®é™…ä¸Šéƒ½æ˜¯è¿”å›ç‰¹æ®Šç±»çš„å‡½æ•°ã€‚ æ³¨æ„ï¼Œæ¨¡å‹å±æ€§çš„ç±»å‹ã€é»˜è®¤å€¼åŠ Field çš„ä»£ç ç»“æ„ä¸è·¯å¾„æ“ä½œå‡½æ•°çš„å‚æ•°ç›¸åŒï¼Œåªä¸è¿‡æ˜¯ç”¨ Field æ›¿æ¢äº†Pathã€Queryã€Bodyã€‚ è¯·æ±‚ä½“-åµŒå¥—æ¨¡å‹Listå­—æ®µä½ å¯ä»¥å°†ä¸€ä¸ªå±æ€§å®šä¹‰ä¸ºæ‹¥æœ‰å­å…ƒç´ çš„ç±»å‹ã€‚ä¾‹å¦‚ Python listï¼š from fastapi import FastAPIfrom pydantic import BaseModelapp = FastAPI()class Item(BaseModel): name: str description: str | None = None price: float tax: float | None = None tags: list = []@app.put(/items/item_id)async def update_item(item_id: int, item: Item): results = item_id: item_id, item: item return results è¿™å°†ä½¿ tags æˆä¸ºä¸€ä¸ªç”±å…ƒç´ ç»„æˆçš„åˆ—è¡¨ã€‚ä¸è¿‡å®ƒæ²¡æœ‰å£°æ˜æ¯ä¸ªå…ƒç´ çš„ç±»å‹ã€‚ å…·æœ‰å­ç±»å‹çš„Listå­—æ®µtags: list[str] = [] from fastapi import FastAPIfrom pydantic import BaseModelapp = FastAPI()class Item(BaseModel): name: str description: str | None = None price: float tax: float | None = None tags: list[str] = []@app.put(/items/item_id)async def update_item(item_id: int, item: Item): results = item_id: item_id, item: item return results åµŒå¥—æ¨¡å‹Pydantic æ¨¡å‹çš„æ¯ä¸ªå±æ€§éƒ½å…·æœ‰ç±»å‹ã€‚ ä½†æ˜¯è¿™ä¸ªç±»å‹æœ¬èº«å¯ä»¥æ˜¯å¦ä¸€ä¸ª Pydantic æ¨¡å‹ã€‚ å› æ­¤ï¼Œä½ å¯ä»¥å£°æ˜æ‹¥æœ‰ç‰¹å®šå±æ€§åç§°ã€ç±»å‹å’Œæ ¡éªŒçš„æ·±åº¦åµŒå¥—çš„ JSON å¯¹è±¡ã€‚ ä¸Šè¿°è¿™äº›éƒ½å¯ä»¥ä»»æ„çš„åµŒå¥—ã€‚ from fastapi import FastAPIfrom pydantic import BaseModelapp = FastAPI()class Image(BaseModel): url: str name: strclass Item(BaseModel): name: str description: str | None = None price: float tax: float | None = None tags: set[str] = set() image: Image | None = None@app.put(/items/item_id)async def update_item(item_id: int, item: Item): results = item_id: item_id, item: item return results è¿™æ„å‘³ç€ FastAPI å°†æœŸæœ›ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„è¯·æ±‚ä½“ï¼š name: Foo, description: The pretender, price: 42.0, tax: 3.2, tags: [rock, metal, bar], image: url: http://example.com/baz.jpg, name: The Foo live ç‰¹æ®Šç±»å‹å’Œæ ¡éªŒé™¤äº†æ™®é€šçš„å•ä¸€å€¼ç±»å‹ï¼ˆå¦‚ strã€intã€float ç­‰ï¼‰å¤–ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ä» str ç»§æ‰¿çš„æ›´å¤æ‚çš„å•ä¸€å€¼ç±»å‹ã€‚ è¦äº†è§£æ‰€æœ‰çš„å¯ç”¨é€‰é¡¹ï¼Œè¯·æŸ¥çœ‹å…³äº æ¥è‡ª Pydantic çš„å¤–éƒ¨ç±»å‹ çš„æ–‡æ¡£ã€‚ ä¾‹å¦‚ï¼Œåœ¨ Image æ¨¡å‹ä¸­æˆ‘ä»¬æœ‰ä¸€ä¸ª url å­—æ®µï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒå£°æ˜ä¸º Pydantic çš„ HttpUrlï¼Œè€Œä¸æ˜¯ strï¼š from fastapi import FastAPIfrom pydantic import BaseModel, HttpUrlapp = FastAPI()class Image(BaseModel): url: HttpUrl name: strclass Item(BaseModel): name: str description: str | None = None price: float tax: float | None = None tags: set[str] = set() image: Image | None = None@app.put(/items/item_id)async def update_item(item_id: int, item: Item): results = item_id: item_id, item: item return results è¯¥å­—ç¬¦ä¸²å°†è¢«æ£€æŸ¥æ˜¯å¦ä¸ºæœ‰æ•ˆçš„ URLï¼Œå¹¶åœ¨ JSON Schema OpenAPI æ–‡æ¡£ä¸­è¿›è¡Œè®°å½•ã€‚ å¸¦æœ‰ä¸€ç»„å­æ¨¡å‹çš„å±æ€§è¿˜å¯ä»¥å°† Pydantic æ¨¡å‹ç”¨ä½œ listã€set ç­‰çš„å­ç±»å‹ï¼š from fastapi import FastAPIfrom pydantic import BaseModel, HttpUrlapp = FastAPI()class Image(BaseModel): url: HttpUrl name: strclass Item(BaseModel): name: str description: str | None = None price: float tax: float | None = None tags: set[str] = set() images: list[Image] | None = None@app.put(/items/item_id)async def update_item(item_id: int, item: Item): results = item_id: item_id, item: item return results è¿™å°†æœŸæœ›ï¼ˆè½¬æ¢ï¼Œæ ¡éªŒï¼Œè®°å½•æ–‡æ¡£ç­‰ï¼‰ä¸‹é¢è¿™æ ·çš„ JSON è¯·æ±‚ä½“ï¼š name: Foo, description: The pretender, price: 42.0, tax: 3.2, tags: [ rock, metal, bar ], images: [ url: http://example.com/baz.jpg, name: The Foo live , url: http://example.com/dave.jpg, name: The Baz ] æ·±åº¦åµŒå¥—æ¨¡å‹ä½ å¯ä»¥å®šä¹‰ä»»æ„æ·±åº¦çš„åµŒå¥—æ¨¡å‹ï¼š from fastapi import FastAPIfrom pydantic import BaseModel, HttpUrlapp = FastAPI()class Image(BaseModel): url: HttpUrl name: strclass Item(BaseModel): name: str description: str | None = None price: float tax: float | None = None tags: set[str] = set() images: list[Image] | None = Noneclass Offer(BaseModel): name: str description: str | None = None price: float items: list[Item]@app.post(/offers/)async def create_offer(offer: Offer): return offer ç¤ºä¾‹è¯·æ±‚ä½“ï¼š name: string, description: string, price: 0, items: [ name: string, description: string, price: 0, tax: 0, tags: [], images: [ url: https://example.com/, name: string ] ] çº¯åˆ—è¡¨è¯·æ±‚ä½“å¦‚æœä½ æœŸæœ›çš„ JSON è¯·æ±‚ä½“çš„æœ€å¤–å±‚æ˜¯ä¸€ä¸ª JSON arrayï¼ˆå³ Python listï¼‰ï¼Œåˆ™å¯ä»¥åœ¨è·¯å¾„æ“ä½œå‡½æ•°çš„å‚æ•°ä¸­å£°æ˜æ­¤ç±»å‹ï¼Œå°±åƒå£°æ˜ Pydantic æ¨¡å‹ä¸€æ ·ï¼š images: List[Image] from fastapi import FastAPIfrom pydantic import BaseModel, HttpUrlapp = FastAPI()class Image(BaseModel): url: HttpUrl name: str@app.post(/images/multiple/)async def create_multiple_images(images: list[Image]): return images ç¤ºä¾‹è¯·æ±‚ä½“ï¼š [ url: https://example.com/, name: string ] ä»»æ„ dict æ„æˆçš„è¯·æ±‚ä½“ä½ ä¹Ÿå¯ä»¥å°†è¯·æ±‚ä½“å£°æ˜ä¸ºä½¿ç”¨æŸç±»å‹çš„é”®å’Œå…¶ä»–ç±»å‹å€¼çš„ dictã€‚ æ— éœ€äº‹å…ˆçŸ¥é“æœ‰æ•ˆçš„å­—æ®µå±æ€§ï¼ˆåœ¨ä½¿ç”¨ Pydantic æ¨¡å‹çš„åœºæ™¯ï¼‰åç§°æ˜¯ä»€ä¹ˆã€‚ å¦‚æœä½ æƒ³æ¥æ”¶ä¸€äº›å°šä¸”æœªçŸ¥çš„é”®ï¼Œè¿™å°†å¾ˆæœ‰ç”¨ã€‚ from fastapi import FastAPIapp = FastAPI()@app.post(/index-weights/)async def create_index_weights(weights: dict[int, float]): return weights è¯·è®°ä½ JSON ä»…æ”¯æŒå°† str ä½œä¸ºé”®ã€‚ ä½†æ˜¯ Pydantic å…·æœ‰è‡ªåŠ¨è½¬æ¢æ•°æ®çš„åŠŸèƒ½ã€‚ è¿™æ„å‘³ç€ï¼Œå³ä½¿ä½ çš„ API å®¢æˆ·ç«¯åªèƒ½å°†å­—ç¬¦ä¸²ä½œä¸ºé”®å‘é€ï¼Œåªè¦è¿™äº›å­—ç¬¦ä¸²å†…å®¹ä»…åŒ…å«æ•´æ•°ï¼ŒPydantic å°±ä¼šå¯¹å…¶è¿›è¡Œè½¬æ¢å¹¶æ ¡éªŒã€‚ ç„¶åä½ æ¥æ”¶çš„åä¸º weights çš„ dict å®é™…ä¸Šå°†å…·æœ‰ int ç±»å‹çš„é”®å’Œ float ç±»å‹çš„å€¼ã€‚ æ¨¡å¼çš„é¢å¤–ä¿¡æ¯å¯ä»¥åœ¨JSONæ¨¡å¼ä¸­å®šä¹‰é¢å¤–çš„ä¿¡æ¯ã€‚ ä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹æ˜¯æ·»åŠ ä¸€ä¸ªå°†åœ¨æ–‡æ¡£ä¸­æ˜¾ç¤ºçš„exampleã€‚ æœ‰å‡ ç§æ–¹æ³•å¯ä»¥å£°æ˜é¢å¤–çš„ JSON æ¨¡å¼ä¿¡æ¯ã€‚ Pydantic schema_extraå¯ä»¥ä½¿ç”¨ Config å’Œ schema_extra ä¸ºPydanticæ¨¡å‹å£°æ˜ä¸€ä¸ªç¤ºä¾‹ï¼Œå¦‚: import uvicornfrom fastapi import FastAPIfrom pydantic import BaseModelapp = FastAPI()class Item(BaseModel): name: str description: str | None = None price: float tax: float | None = None model_config = json_schema_extra: examples: [ name: Foo, description: A very nice Item, price: 35.4, tax: 3.2, ] @app.put(/items/item_id)async def update_item(item_id: int, item: Item): results = item_id: item_id, item: item return resultsif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) doc æ–‡æ¡£æ˜¾ç¤ºå¦‚ä¸‹ï¼š Field çš„é™„åŠ å‚æ•°åœ¨ Field, Path, Query, Body å’Œå…¶ä»–ä½ ä¹‹åå°†ä¼šçœ‹åˆ°çš„å·¥å‚å‡½æ•°ï¼Œä½ å¯ä»¥ä¸ºJSON æ¨¡å¼å£°æ˜é¢å¤–ä¿¡æ¯ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ç»™å·¥å‚å‡½æ•°ä¼ é€’å…¶ä»–çš„ä»»æ„å‚æ•°æ¥ç»™ JSON æ¨¡å¼å£°æ˜é¢å¤–ä¿¡æ¯ï¼Œæ¯”å¦‚å¢åŠ  example: import uvicornfrom fastapi import FastAPIfrom pydantic import BaseModel, Fieldapp = FastAPI()class Item(BaseModel): name: str = Field(examples=[Foo]) description: str | None = Field(default=None, examples=[A very nice Item]) price: float = Field(examples=[35.4]) tax: float | None = Field(default=None, examples=[3.2])@app.put(/items/item_id)async def update_item(item_id: int, item: Item): results = item_id: item_id, item: item return resultsif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) doc æ–‡æ¡£æ˜¾ç¤ºå¦‚ä¸Šå›¾ã€‚ Body é¢å¤–å‚æ•°ä½ å¯ä»¥é€šè¿‡ä¼ é€’é¢å¤–ä¿¡æ¯ç»™ Field åŒæ ·çš„æ–¹å¼æ“ä½œPath, Query, Bodyç­‰ã€‚ æ¯”å¦‚ï¼Œä½ å¯ä»¥å°†è¯·æ±‚ä½“çš„ä¸€ä¸ª example ä¼ é€’ç»™ Body: from typing import Annotatedimport uvicornfrom fastapi import Body, FastAPIfrom pydantic import BaseModelapp = FastAPI()class Item(BaseModel): name: str description: str | None = None price: float tax: float | None = None@app.put(/items/item_id)async def update_item(item_id: int, item: Annotated[Item, Body( examples=[ name: Foo, description: A very nice Item, price: 35.4, tax: 3.2, ],)]): results = item_id: item_id, item: item return resultsif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) docæ˜¾ç¤ºæ–‡æ¡£å¦‚ä¸Šå›¾ã€‚ é¢å¤–æ•°æ®ç±»å‹ä¸‹é¢æ˜¯ä¸€äº›ä½ å¯ä»¥ä½¿ç”¨çš„å…¶ä»–æ•°æ®ç±»å‹: UUID: ä¸€ç§æ ‡å‡†çš„ â€œé€šç”¨å”¯ä¸€æ ‡è¯†ç¬¦â€ ï¼Œåœ¨è®¸å¤šæ•°æ®åº“å’Œç³»ç»Ÿä¸­ç”¨ä½œIDã€‚ åœ¨è¯·æ±‚å’Œå“åº”ä¸­å°†ä»¥ str è¡¨ç¤ºã€‚ datetime.datetime: ä¸€ä¸ª Python datetime.datetime. åœ¨è¯·æ±‚å’Œå“åº”ä¸­å°†è¡¨ç¤ºä¸º ISO 8601 æ ¼å¼çš„ str ï¼Œæ¯”å¦‚: 2008-09-15T15:53:00+05:00. datetime.date: Python datetime.date. åœ¨è¯·æ±‚å’Œå“åº”ä¸­å°†è¡¨ç¤ºä¸º ISO 8601 æ ¼å¼çš„ str ï¼Œæ¯”å¦‚: 2008-09-15. datetime.time: ä¸€ä¸ª Python datetime.time. åœ¨è¯·æ±‚å’Œå“åº”ä¸­å°†è¡¨ç¤ºä¸º ISO 8601 æ ¼å¼çš„ str ï¼Œæ¯”å¦‚: 14:23:55.003. datetime.timedelta: ä¸€ä¸ª Python datetime.timedelta. åœ¨è¯·æ±‚å’Œå“åº”ä¸­å°†è¡¨ç¤ºä¸º float ä»£è¡¨æ€»ç§’æ•°ã€‚ Pydantic ä¹Ÿå…è®¸å°†å…¶è¡¨ç¤ºä¸º â€œISO 8601 æ—¶é—´å·®å¼‚ç¼–ç â€ã€‚ frozenset: åœ¨è¯·æ±‚å’Œå“åº”ä¸­ï¼Œä½œä¸º set å¯¹å¾…ï¼š åœ¨è¯·æ±‚ä¸­ï¼Œåˆ—è¡¨å°†è¢«è¯»å–ï¼Œæ¶ˆé™¤é‡å¤ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ª setã€‚ åœ¨å“åº”ä¸­ set å°†è¢«è½¬æ¢ä¸º list ã€‚ äº§ç”Ÿçš„æ¨¡å¼å°†æŒ‡å®šé‚£äº› set çš„å€¼æ˜¯å”¯ä¸€çš„ (ä½¿ç”¨ JSON æ¨¡å¼çš„ uniqueItems)ã€‚ bytes: æ ‡å‡†çš„ Python bytesã€‚ åœ¨è¯·æ±‚å’Œå“åº”ä¸­è¢«å½“ä½œ str å¤„ç†ã€‚ ç”Ÿæˆçš„æ¨¡å¼å°†æŒ‡å®šè¿™ä¸ª str æ˜¯ binary â€œæ ¼å¼â€ã€‚ Decimal: æ ‡å‡†çš„ Python Decimalã€‚ åœ¨è¯·æ±‚å’Œå“åº”ä¸­è¢«å½“åš float ä¸€æ ·å¤„ç†ã€‚ ç¤ºä¾‹ï¼š from datetime import datetime, time, timedeltafrom typing import Annotatedfrom uuid import UUIDfrom fastapi import Body, FastAPIapp = FastAPI()@app.put(/items/item_id)async def read_items( item_id: UUID, start_datetime: Annotated[datetime, Body()], end_datetime: Annotated[datetime, Body()], process_after: Annotated[timedelta, Body()], repeat_at: Annotated[time | None, Body()] = None,): start_process = start_datetime + process_after duration = end_datetime - start_process return item_id: item_id, start_datetime: start_datetime, end_datetime: end_datetime, process_after: process_after, repeat_at: repeat_at, start_process: start_process, duration: duration, Cookieå‚æ•°å®šä¹‰ Cookie å‚æ•°ä¸å®šä¹‰ Query å’Œ Path å‚æ•°ä¸€æ ·ã€‚ from typing import Annotatedimport uvicornfrom fastapi import FastAPI, Cookiefrom fastapi.responses import Responseapp = FastAPI()@app.get(/items/)async def read_items(ads_id: Annotated[str | None, Cookie()] = None): return ads_id: ads_id@app.post(/set-cookie/)async def set_cookie() - Response: res = message: Cookie set response = Response(content=str(res)) response.set_cookie(key=ads_id, value=gaga) return responseif __name__ == __main__: uvicorn.run(app) å¿…é¡»ä½¿ç”¨ Cookie å£°æ˜ cookie å‚æ•°ï¼Œå¦åˆ™è¯¥å‚æ•°ä¼šè¢«è§£é‡Šä¸ºæŸ¥è¯¢å‚æ•°ã€‚ è¯·è®°ä½ï¼Œç”±äºæµè§ˆå™¨ä»¥ç‰¹æ®Šæ–¹å¼å¤„ç† cookieï¼Œå¹¶åœ¨åå°è¿›è¡Œæ“ä½œï¼Œå› æ­¤å®ƒä»¬ä¸ä¼šè½»æ˜“å…è®¸ JavaScript è®¿é—®è¿™äº› cookieã€‚ å¦‚æœæ‚¨è®¿é—® docs çš„ API æ–‡æ¡£ UIï¼Œæ‚¨å°†èƒ½å¤ŸæŸ¥çœ‹æ‚¨è·¯å¾„æ“ä½œçš„ cookie æ–‡æ¡£ã€‚ ä½†æ˜¯å³ä½¿æ‚¨å¡«å†™æ•°æ®å¹¶ç‚¹å‡»â€œæ‰§è¡Œâ€ï¼Œç”±äºæ–‡æ¡£ç•Œé¢ä½¿ç”¨ JavaScriptï¼Œcookie å°†ä¸ä¼šè¢«å‘é€ã€‚è€Œæ‚¨ä¼šçœ‹åˆ°ä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼Œå°±å¥½åƒæ‚¨æ²¡æœ‰è¾“å…¥ä»»ä½•å€¼ä¸€æ ·ã€‚ Header å‚æ•°å®šä¹‰ Header å‚æ•°çš„æ–¹å¼ä¸å®šä¹‰ Queryã€Pathã€Cookie å‚æ•°ç›¸åŒã€‚ å£°æ˜ Header å‚æ•°from typing import Annotatedimport uvicornfrom fastapi import FastAPI, Headerapp = FastAPI()@app.get(/items/)async def read_items(user_agent: Annotated[str | None, Header()] = None): return User-Agent: user_agentif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) å¿…é¡»ä½¿ç”¨ Header å£°æ˜ header å‚æ•°ï¼Œå¦åˆ™è¯¥å‚æ•°ä¼šè¢«è§£é‡Šä¸ºæŸ¥è¯¢å‚æ•°ã€‚ è‡ªåŠ¨è½¬æ¢Header æ¯” Pathã€Query å’Œ Cookie æä¾›äº†æ›´å¤šåŠŸèƒ½ã€‚ å¤§éƒ¨åˆ†æ ‡å‡†è¯·æ±‚å¤´ç”¨è¿å­—ç¬¦åˆ†éš”ï¼Œå³å‡å·ï¼ˆ-ï¼‰ã€‚ ä½†æ˜¯ user-agent è¿™æ ·çš„å˜é‡åœ¨ Python ä¸­æ˜¯æ— æ•ˆçš„ã€‚ å› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒHeader ä¼šæŠŠå‚æ•°åä¸­çš„å­—ç¬¦ç”±ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰æ”¹ä¸ºè¿å­—ç¬¦ï¼ˆ-ï¼‰æ¥æå–å¹¶ä¿å­˜è¯·æ±‚å¤´ ã€‚ åŒæ—¶ï¼ŒHTTP çš„è¯·æ±‚å¤´ä¸åŒºåˆ†å¤§å°å†™ï¼Œå¯ä»¥ä½¿ç”¨ Python æ ‡å‡†æ ·å¼ï¼ˆå³ snake_caseï¼‰è¿›è¡Œå£°æ˜ã€‚ å› æ­¤ï¼Œå¯ä»¥åƒåœ¨ Python ä»£ç ä¸­ä¸€æ ·ä½¿ç”¨ user_agent ï¼Œæ— éœ€æŠŠé¦–å­—æ¯å¤§å†™ä¸º User_Agent ç­‰å½¢å¼ã€‚ å¦‚éœ€ç¦ç”¨ä¸‹åˆ’çº¿è‡ªåŠ¨è½¬æ¢ä¸ºè¿å­—ç¬¦ï¼Œå¯ä»¥æŠŠ Header çš„ convert_underscores å‚æ•°è®¾ç½®ä¸º Falseï¼š from typing import Annotatedimport uvicornfrom fastapi import FastAPI, Headerapp = FastAPI()@app.get(/items/)async def read_items(user_agent: Annotated[str | None, Header()] = None): return User-Agent: user_agentif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) æ³¨æ„ï¼Œä½¿ç”¨ convert_underscores = False è¦æ…é‡ï¼Œæœ‰äº› HTTP ä»£ç†å’ŒæœåŠ¡å™¨ä¸æ”¯æŒä½¿ç”¨å¸¦æœ‰ä¸‹åˆ’çº¿çš„è¯·æ±‚å¤´ã€‚ é‡å¤è¯·æ±‚å¤´æœ‰æ—¶ï¼Œå¯èƒ½éœ€è¦æ¥æ”¶é‡å¤çš„è¯·æ±‚å¤´ã€‚å³åŒä¸€ä¸ªè¯·æ±‚å¤´æœ‰å¤šä¸ªå€¼ã€‚ ç±»å‹å£°æ˜ä¸­å¯ä»¥ä½¿ç”¨ list å®šä¹‰å¤šä¸ªè¯·æ±‚å¤´ã€‚ ä½¿ç”¨ Python list å¯ä»¥æ¥æ”¶é‡å¤è¯·æ±‚å¤´æ‰€æœ‰çš„å€¼ã€‚ ä¾‹å¦‚ï¼Œå£°æ˜ X-Token å¤šæ¬¡å‡ºç°çš„è¯·æ±‚å¤´ï¼Œå¯ä»¥å†™æˆè¿™æ ·ï¼š from typing import Annotatedimport uvicornfrom fastapi import FastAPI, Headerapp = FastAPI()@app.get(/items/)async def read_items(x_token: Annotated[list[str] | None, Header()] = None): return X-Token values: x_tokenif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) Cookieå‚æ•°æ¨¡å‹å¸¦æœ‰ Pydantic æ¨¡å‹çš„ Cookieå¦‚æœæ‚¨æœ‰ä¸€ç»„ç›¸å…³çš„ cookieï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ª Pydantic æ¨¡å‹æ¥å£°æ˜å®ƒä»¬ã€‚ è¿™å°†å…è®¸æ‚¨åœ¨å¤šä¸ªåœ°æ–¹èƒ½å¤Ÿé‡ç”¨æ¨¡å‹ï¼Œå¹¶ä¸”å¯ä»¥ä¸€æ¬¡æ€§å£°æ˜æ‰€æœ‰å‚æ•°çš„éªŒè¯æ–¹å¼å’Œå…ƒæ•°æ®ã€‚ import base64from typing import Annotatedimport uvicornfrom fastapi import FastAPI, Cookie, Responsefrom pydantic import BaseModelapp = FastAPI()class Cookies(BaseModel): session_id: str session_name: str | None = None session_age: int | None = None@app.post(/set-cookies/)async def read_items() - Response: cookie_data = Cookies(session_id=123, session_name=è€ç‹, session_age=18) # åˆ›å»ºå“åº”å¯¹è±¡ response = Response(content=Cookies have been set) # å¯¹å¯èƒ½åŒ…å«é latin-1 å­—ç¬¦çš„å€¼è¿›è¡Œ Base64 ç¼–ç  encoded_session_name = base64.urlsafe_b64encode( (cookie_data.session_name or ).encode(utf-8) ).decode(utf-8) # è®¾ç½®å¤šä¸ª Cookie response.set_cookie(key=session_id, value=cookie_data.session_id) response.set_cookie(key=session_name, value=encoded_session_name) response.set_cookie(key=session_age, value=str(cookie_data.session_age) if cookie_data.session_age else ) return response@app.get(/items/)async def read_items(cookies: Annotated[Cookies, Cookie()]): return cookiesif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) FastAPI å°†ä»è¯·æ±‚ä¸­æ¥æ”¶åˆ°çš„ cookie ä¸­æå–å‡ºæ¯ä¸ªå­—æ®µçš„æ•°æ®ï¼Œå¹¶æä¾›æ‚¨å®šä¹‰çš„ Pydantic æ¨¡å‹ã€‚ ç¦æ­¢é¢å¤–çš„ Cookieåœ¨æŸäº›ç‰¹æ®Šä½¿ç”¨æƒ…å†µä¸‹ï¼ˆå¯èƒ½å¹¶ä¸å¸¸è§ï¼‰ï¼Œæ‚¨å¯èƒ½å¸Œæœ›é™åˆ¶æ‚¨æƒ³è¦æ¥æ”¶çš„ cookieã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ Pydantic çš„æ¨¡å‹é…ç½®æ¥ç¦æ­¢ï¼ˆ forbid ï¼‰ä»»ä½•é¢å¤–ï¼ˆ extra ï¼‰å­—æ®µï¼š from typing import Annotated, Unionfrom fastapi import Cookie, FastAPIfrom pydantic import BaseModelapp = FastAPI()class Cookies(BaseModel): model_config = extra: forbid session_id: str fatebook_tracker: Union[str, None] = None googall_tracker: Union[str, None] = None@app.get(/items/)async def read_items(cookies: Annotated[Cookies, Cookie()]): return cookies å¦‚æœå®¢æˆ·å°è¯•å‘é€ä¸€äº›é¢å¤–çš„ cookieï¼Œä»–ä»¬å°†æ”¶åˆ°é”™è¯¯å“åº”ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœå®¢æˆ·ç«¯å°è¯•å‘é€ä¸€ä¸ªå€¼ä¸º good-list-please çš„ santa_tracker cookieï¼Œå®¢æˆ·ç«¯å°†æ”¶åˆ°ä¸€ä¸ªé”™è¯¯å“åº”ï¼Œå‘ŠçŸ¥ä»–ä»¬ santa_tracker cookie æ˜¯ä¸å…è®¸çš„ï¼š detail: [ type: extra_forbidden, loc: [cookie, santa_tracker], msg: Extra inputs are not permitted, input: good-list-please, ] Headerå‚æ•°æ¨¡å‹å¦‚æœæ‚¨æœ‰ä¸€ç»„ç›¸å…³çš„ header å‚æ•°ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ª Pydantic æ¨¡å‹æ¥å£°æ˜å®ƒä»¬ã€‚ è¿™å°†å…è®¸æ‚¨åœ¨å¤šä¸ªåœ°æ–¹èƒ½å¤Ÿé‡ç”¨æ¨¡å‹ï¼Œå¹¶ä¸”å¯ä»¥ä¸€æ¬¡æ€§å£°æ˜æ‰€æœ‰å‚æ•°çš„éªŒè¯å’Œå…ƒæ•°æ®ã€‚ ä½¿ç”¨ Pydantic æ¨¡å‹çš„ Header å‚æ•°åœ¨ Pydantic æ¨¡å‹ä¸­å£°æ˜æ‰€éœ€çš„ header å‚æ•°ï¼Œç„¶åå°†å‚æ•°å£°æ˜ä¸º Header : from typing import Annotatedfrom fastapi import FastAPI, Headerfrom pydantic import BaseModelapp = FastAPI()class CommonHeaders(BaseModel): host: str save_data: bool if_modified_since: str | None = None traceparent: str | None = None x_tag: list[str] = []@app.get(/items/)async def read_items(headers: Annotated[CommonHeaders, Header()]): return headers FastAPI å°†ä»è¯·æ±‚ä¸­æ¥æ”¶åˆ°çš„ headers ä¸­æå–å‡ºæ¯ä¸ªå­—æ®µçš„æ•°æ®ï¼Œå¹¶æä¾›æ‚¨å®šä¹‰çš„ Pydantic æ¨¡å‹ã€‚ ç¦æ­¢é¢å¤–çš„ Headersåœ¨æŸäº›ç‰¹æ®Šä½¿ç”¨æƒ…å†µä¸‹ï¼ˆå¯èƒ½å¹¶ä¸å¸¸è§ï¼‰ï¼Œæ‚¨å¯èƒ½å¸Œæœ›é™åˆ¶æ‚¨æƒ³è¦æ¥æ”¶çš„ headersã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ Pydantic çš„æ¨¡å‹é…ç½®æ¥ç¦æ­¢ï¼ˆ forbid ï¼‰ä»»ä½•é¢å¤–ï¼ˆ extra ï¼‰å­—æ®µï¼š from typing import Annotatedfrom fastapi import FastAPI, Headerfrom pydantic import BaseModelapp = FastAPI()class CommonHeaders(BaseModel): model_config = extra: forbid host: str save_data: bool if_modified_since: str | None = None traceparent: str | None = None x_tag: list[str] = []@app.get(/items/)async def read_items(headers: Annotated[CommonHeaders, Header()]): return headers å¦‚æœå®¢æˆ·å°è¯•å‘é€ä¸€äº›é¢å¤–çš„ headersï¼Œä»–ä»¬å°†æ”¶åˆ°é”™è¯¯å“åº”ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœå®¢æˆ·ç«¯å°è¯•å‘é€ä¸€ä¸ªå€¼ä¸º plumbus çš„ tool headerï¼Œå®¢æˆ·ç«¯å°†æ”¶åˆ°ä¸€ä¸ªé”™è¯¯å“åº”ï¼Œå‘ŠçŸ¥ä»–ä»¬ header å‚æ•° tool æ˜¯ä¸å…è®¸çš„ï¼š detail: [ type: extra_forbidden, loc: [header, tool], msg: Extra inputs are not permitted, input: plumbus, ] å“åº”æ¨¡å‹ä½ å¯ä»¥åœ¨ä»»æ„çš„è·¯å¾„æ“ä½œä¸­ä½¿ç”¨ response_model å‚æ•°æ¥å£°æ˜ç”¨äºå“åº”çš„æ¨¡å‹ï¼š @app.get()@app.post()@app.put()@app.delete()ç­‰ç­‰ã€‚ from typing import Anyimport uvicornfrom fastapi import FastAPIfrom pydantic import BaseModelapp = FastAPI()class Item(BaseModel): name: str description: str | None = None price: float tax: float | None = None tags: list[str] = []@app.get(/items/, response_model=Item)async def read_items() - Any: return name: Portal Gun, price: 42.0@app.get(/items1/)async def read_items() - Any: return [ name: Portal Gun, price: 42.0, name: Plumbus, price: 32.0, ]@app.get(/items2/, response_model=list[Item])async def read_items() - Any: return [ name: Portal Gun, price: 42.0, name: Plumbus, price: 32.0, ]if __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) æ³¨æ„ï¼Œresponse_model æ˜¯ã€Œè£…é¥°å™¨ã€æ–¹æ³•ï¼ˆgetï¼Œpost ç­‰ï¼‰çš„ä¸€ä¸ªå‚æ•°ã€‚ä¸åƒä¹‹å‰çš„æ‰€æœ‰å‚æ•°å’Œè¯·æ±‚ä½“ï¼Œå®ƒä¸å±äºè·¯å¾„æ“ä½œå‡½æ•°ã€‚ å®ƒæ¥æ”¶çš„ç±»å‹ä¸ä½ å°†ä¸º Pydantic æ¨¡å‹å±æ€§æ‰€å£°æ˜çš„ç±»å‹ç›¸åŒï¼Œå› æ­¤å®ƒå¯ä»¥æ˜¯ä¸€ä¸ª Pydantic æ¨¡å‹ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç”± Pydantic æ¨¡å‹ç»„æˆçš„ listï¼Œä¾‹å¦‚ List[Item]ã€‚ FastAPI å°†ä½¿ç”¨æ­¤ response_model æ¥ï¼š å°†è¾“å‡ºæ•°æ®è½¬æ¢ä¸ºå…¶å£°æ˜çš„ç±»å‹ã€‚ æ ¡éªŒæ•°æ®ã€‚ åœ¨ OpenAPI çš„è·¯å¾„æ“ä½œä¸­ä¸ºå“åº”æ·»åŠ ä¸€ä¸ª JSON Schemaã€‚ å¹¶åœ¨è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ç³»ç»Ÿä¸­ä½¿ç”¨ã€‚ ä½†æœ€é‡è¦çš„æ˜¯ï¼šä¼šå°†è¾“å‡ºæ•°æ®é™åˆ¶åœ¨è¯¥æ¨¡å‹å®šä¹‰å†…ã€‚ è¿”å›ä¸è¾“å…¥ç›¸åŒç°åœ¨æˆ‘ä»¬å£°æ˜ä¸€ä¸ª UserIn æ¨¡å‹ï¼Œå®ƒå°†åŒ…å«ä¸€ä¸ªæ˜æ–‡å¯†ç å±æ€§ã€‚ from typing import Unionfrom fastapi import FastAPIfrom pydantic import BaseModel, EmailStrapp = FastAPI()class UserIn(BaseModel): username: str password: str email: EmailStr full_name: Union[str, None] = None# Dont do this in production!@app.post(/user/)async def create_user(user: UserIn) - UserIn: return userif __name__ == __main__: uvicorn.run(app) æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨æ­¤æ¨¡å‹å£°æ˜è¾“å…¥æ•°æ®ï¼Œå¹¶ä½¿ç”¨åŒä¸€æ¨¡å‹å£°æ˜è¾“å‡ºæ•°æ®ï¼šç°åœ¨ï¼Œæ¯å½“æµè§ˆå™¨ä½¿ç”¨ä¸€ä¸ªå¯†ç åˆ›å»ºç”¨æˆ·æ—¶ï¼ŒAPI éƒ½ä¼šåœ¨å“åº”ä¸­è¿”å›ç›¸åŒçš„å¯†ç ã€‚ åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œè¿™å¯èƒ½ä¸ç®—æ˜¯é—®é¢˜ï¼Œå› ä¸ºç”¨æˆ·è‡ªå·±æ­£åœ¨å‘é€å¯†ç ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å…¶ä»–çš„è·¯å¾„æ“ä½œä¸­ä½¿ç”¨ç›¸åŒçš„æ¨¡å‹ï¼Œåˆ™å¯èƒ½ä¼šå°†ç”¨æˆ·çš„å¯†ç å‘é€ç»™æ¯ä¸ªå®¢æˆ·ç«¯ã€‚ ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæœ‰æ˜æ–‡å¯†ç çš„è¾“å…¥æ¨¡å‹å’Œä¸€ä¸ªæ²¡æœ‰æ˜æ–‡å¯†ç çš„è¾“å‡ºæ¨¡å‹ï¼š from typing import Anyfrom fastapi import FastAPIfrom pydantic import BaseModel, EmailStrapp = FastAPI()class UserIn(BaseModel): username: str password: str email: EmailStr full_name: str | None = Noneclass UserOut(BaseModel): username: str email: EmailStr full_name: str | None = None@app.post(/user/, response_model=UserOut)async def create_user(user: UserIn) - Any: return user å°† response_model å£°æ˜ä¸ºäº†ä¸åŒ…å«å¯†ç çš„ UserOut æ¨¡å‹, å› æ­¤ FastAPI å°†ä¼šè´Ÿè´£è¿‡æ»¤æ‰æœªåœ¨è¾“å‡ºæ¨¡å‹ä¸­å£°æ˜çš„æ‰€æœ‰æ•°æ®ï¼ˆä½¿ç”¨ Pydanticï¼‰ã€‚ å“åº”æ¨¡å‹é»˜è®¤å€¼å¯ä»¥ä¸ºä½ çš„å“åº”æ¨¡å‹è®¾ç½®é»˜è®¤å€¼ï¼Œä¾‹å¦‚ï¼š from typing import List, Unionfrom fastapi import FastAPIfrom pydantic import BaseModelapp = FastAPI()class Item(BaseModel): name: str description: Union[str, None] = None price: float tax: float = 10.5 tags: List[str] = []items = foo: name: Foo, price: 50.2, bar: name: Bar, description: The bartenders, price: 62, tax: 20.2, baz: name: Baz, description: None, price: 50.2, tax: 10.5, tags: [],@app.get(/items/item_id, response_model=Item, response_model_exclude_unset=True)async def read_item(item_id: str): return items[item_id] ä½†å¦‚æœå“åº”æ¨¡å‹å¹¶æ²¡æœ‰å­˜å‚¨å®é™…çš„å€¼ï¼Œä½ å¯èƒ½æƒ³ä»ç»“æœä¸­å¿½ç•¥å®ƒä»¬çš„é»˜è®¤å€¼ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå½“ä½ åœ¨ NoSQL æ•°æ®åº“ä¸­ä¿å­˜äº†å…·æœ‰è®¸å¤šå¯é€‰å±æ€§çš„æ¨¡å‹ï¼Œä½†ä½ åˆä¸æƒ³å‘é€å……æ»¡é»˜è®¤å€¼çš„å¾ˆé•¿çš„ JSON å“åº”ã€‚ å¯ä»¥ä½¿ç”¨ response_model_exclude_unset å‚æ•°ï¼š @app.get(/items/item_id, response_model=Item, response_model_exclude_unset=True)async def read_item(item_id: str): return items[item_id] ç„¶åå“åº”ä¸­å°†ä¸ä¼šåŒ…å«é‚£äº›é»˜è®¤å€¼ï¼Œè€Œæ˜¯ä»…æœ‰å®é™…è®¾ç½®çš„å€¼ã€‚ å› æ­¤ï¼Œå¦‚æœä½ å‘è·¯å¾„æ“ä½œå‘é€ ID ä¸º foo çš„å•†å“çš„è¯·æ±‚ï¼Œåˆ™å“åº”ï¼ˆä¸åŒ…æ‹¬é»˜è®¤å€¼ï¼‰å°†ä¸ºï¼š name: Foo, price: 50.2 æ’é™¤å±æ€§å¦‚æœä½ åªæœ‰ä¸€ä¸ª Pydantic æ¨¡å‹ï¼Œå¹¶ä¸”æƒ³è¦ä»è¾“å‡ºä¸­ç§»é™¤ä¸€äº›æ•°æ®ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è¿™ç§å¿«æ·æ–¹æ³•ã€‚ ä½†æ˜¯ä¾ç„¶å»ºè®®ä½ ä½¿ç”¨ä¸Šé¢æåˆ°çš„ä¸»æ„ï¼Œä½¿ç”¨å¤šä¸ªç±»è€Œä¸æ˜¯è¿™äº›å‚æ•°ã€‚ è¿™æ˜¯å› ä¸ºå³ä½¿ä½¿ç”¨ response_model_include æˆ– response_model_exclude æ¥çœç•¥æŸäº›å±æ€§ï¼Œåœ¨åº”ç”¨ç¨‹åºçš„ OpenAPI å®šä¹‰ï¼ˆå’Œæ–‡æ¡£ï¼‰ä¸­ç”Ÿæˆçš„ JSON Schema ä»å°†æ˜¯å®Œæ•´çš„æ¨¡å‹ã€‚ è¿™ä¹Ÿé€‚ç”¨äºä½œç”¨ç±»ä¼¼çš„ response_model_by_aliasã€‚ from typing import Unionfrom fastapi import FastAPIfrom pydantic import BaseModelapp = FastAPI()class Item(BaseModel): name: str description: Union[str, None] = None price: float tax: float = 10.5items = foo: name: Foo, price: 50.2, bar: name: Bar, description: The Bar fighters, price: 62, tax: 20.2, baz: name: Baz, description: There goes my baz, price: 50.2, tax: 10.5, ,@app.get( /items/item_id/name, response_model=Item, response_model_include=name, description,)async def read_item_name(item_id: str): return items[item_id]@app.get(/items/item_id/public, response_model=Item, response_model_exclude=tax)async def read_item_public_data(item_id: str): return items[item_id] æ›´å¤šæ¨¡å‹å¤šä¸ªå…³è”æ¨¡å‹è¿™ç§æƒ…å†µå¾ˆå¸¸è§ã€‚ ç‰¹åˆ«æ˜¯ç”¨æˆ·æ¨¡å‹ï¼Œå› ä¸ºï¼š è¾“å…¥æ¨¡å‹åº”è¯¥å«å¯†ç  è¾“å‡ºæ¨¡å‹ä¸åº”å«å¯†ç  æ•°æ®åº“æ¨¡å‹éœ€è¦åŠ å¯†çš„å¯†ç  ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†ä¸åŒæ¨¡å‹å¤„ç†å¯†ç å­—æ®µçš„æ–¹å¼ï¼ŒåŠä½¿ç”¨ä½ç½®çš„å¤§è‡´æ€è·¯ï¼š from fastapi import FastAPIfrom pydantic import BaseModel, EmailStrapp = FastAPI()class UserIn(BaseModel): username: str password: str email: EmailStr full_name: str | None = Noneclass UserOut(BaseModel): username: str email: EmailStr full_name: str | None = Noneclass UserInDB(BaseModel): username: str hashed_password: str email: EmailStr full_name: str | None = Nonedef fake_password_hasher(raw_password: str): return supersecret + raw_passworddef fake_save_user(user_in: UserIn): hashed_password = fake_password_hasher(user_in.password) user_in_db = UserInDB(**user_in.model_dump(), hashed_password=hashed_password) print(User saved! ..not really) return user_in_db@app.post(/user/, response_model=UserOut)async def create_user(user_in: UserIn): user_saved = fake_save_user(user_in) return user_saved è¿”å›å¤šä¸ªæ¨¡å‹å“åº”å¯ä»¥å£°æ˜ä¸ºä¸¤ç§ç±»å‹çš„ Union ç±»å‹ï¼Œå³è¯¥å“åº”å¯ä»¥æ˜¯ä¸¤ç§ç±»å‹ä¸­çš„ä»»æ„ç±»å‹ã€‚ import uvicornfrom fastapi import FastAPIfrom pydantic import BaseModelapp = FastAPI()class BaseItem(BaseModel): description: str type: strclass CarItem(BaseItem): type: str = carclass PlaneItem(BaseItem): type: str = plane size: intitems = item1: description: All my friends drive a low rider, type: car, item2: description: Music is my aeroplane, its my aeroplane, type: plane, size: 5, ,@app.get(/items/item_id, response_model=PlaneItem | CarItem)async def read_item(item_id: str): return items[item_id]if __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) å®šä¹‰ Union ç±»å‹æ—¶ï¼Œè¦æŠŠè¯¦ç»†çš„ç±»å‹å†™åœ¨å‰é¢ï¼Œç„¶åæ˜¯ä¸å¤ªè¯¦ç»†çš„ç±»å‹ã€‚ä¾‹ä¸­ï¼Œæ›´è¯¦ç»†çš„ PlaneItem ä½äº Union[PlaneItemï¼ŒCarItem] ä¸­çš„ CarItem ä¹‹å‰ã€‚ æ­¤æ—¶å‚æ•° item1 åŒ¹é…è¿”å›çš„æ˜¯ç±»å‹ CarItemï¼š å‚æ•° item2 åŒ¹é…è¿”å›çš„æ˜¯ç±»å‹ PlaneItemï¼š ä»»æ„ dict æ„æˆå“åº”ä»»æ„çš„ dict éƒ½èƒ½ç”¨äºå£°æ˜å“åº”ï¼Œåªè¦å£°æ˜é”®å’Œå€¼çš„ç±»å‹ï¼Œæ— éœ€ä½¿ç”¨ Pydantic æ¨¡å‹ã€‚ äº‹å…ˆä¸çŸ¥é“å¯ç”¨çš„å­—æ®µ å±æ€§åæ—¶ï¼ˆPydantic æ¨¡å‹å¿…é¡»çŸ¥é“å­—æ®µæ˜¯ä»€ä¹ˆï¼‰ï¼Œè¿™ç§æ–¹å¼ç‰¹åˆ«æœ‰ç”¨ã€‚ æ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ typing.Dictï¼š import uvicornfrom fastapi import FastAPIapp = FastAPI()@app.get(/keyword-weights/, response_model=dict[str, float])async def read_keyword_weights(): return foo: 2.3, bar: 3.4@app.get(/keyword-weights2/)async def read_keyword_weights(): return foo: 2.3, bar: 3.4if __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) å“åº”çŠ¶æ€ç ä¸æŒ‡å®šå“åº”æ¨¡å‹çš„æ–¹å¼ç›¸åŒï¼Œåœ¨ä»¥ä¸‹ä»»æ„è·¯å¾„æ“ä½œä¸­ï¼Œå¯ä»¥ä½¿ç”¨ status_code å‚æ•°å£°æ˜ç”¨äºå“åº”çš„ HTTP çŠ¶æ€ç ï¼š @app.get() @app.post() @app.put() @app.delete() ç­‰â€¦â€¦ import uvicornfrom fastapi import FastAPI, statusapp = FastAPI()@app.post(/items/, status_code=201)async def create_item(name: str): return name: name@app.post(/items2/, status_code=status.HTTP_200_OK)async def create_item2(name: str): return name: nameif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) æ³¨æ„ï¼Œstatus_code æ˜¯ï¼ˆgetã€post ç­‰ï¼‰è£…é¥°å™¨æ–¹æ³•ä¸­çš„å‚æ•°ã€‚ä¸ä¹‹å‰çš„å‚æ•°å’Œè¯·æ±‚ä½“ä¸åŒï¼Œä¸æ˜¯è·¯å¾„æ“ä½œå‡½æ•°çš„å‚æ•°ã€‚ status_code å‚æ•°æ¥æ”¶è¡¨ç¤º HTTP çŠ¶æ€ç çš„æ•°å­—ã€‚ æ›´æ”¹çŠ¶æ€ç ä¾‹å¦‚ï¼Œå‡è®¾ä½ æƒ³é»˜è®¤è¿”å›ä¸€ä¸ªHTTPçŠ¶æ€ç ä¸ºâ€œOKâ€200ã€‚ ä½†å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œä½ æƒ³åˆ›å»ºå®ƒï¼Œå¹¶è¿”å›ä¸€ä¸ªHTTPçŠ¶æ€ç ä¸ºâ€œCREATEDâ€201ã€‚ ä½†ä½ ä»ç„¶å¸Œæœ›èƒ½å¤Ÿä½¿ç”¨ response_model è¿‡æ»¤å’Œè½¬æ¢ä½ è¿”å›çš„æ•°æ®ã€‚ å¯¹äºè¿™äº›æƒ…å†µï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ª Response å‚æ•°ã€‚ from typing import Anyimport uvicornfrom fastapi import FastAPI, Response, statusfrom pydantic import BaseModelapp = FastAPI()class Item(BaseModel): name: str description: str | None = None price: float tax: float | None = None tags: list[str] = []@app.get(/items/, response_model=Item)async def read_items() - Any: return name: Portal Gun, price: 42.0@app.get(/items2/, response_model=Item)async def read_items2(response: Response) - Any: response.status_code = status.HTTP_201_CREATED return name: Portal Gun, price: 42.0if __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) ç„¶åä½ å¯ä»¥åƒå¹³å¸¸ä¸€æ ·è¿”å›ä»»ä½•ä½ éœ€è¦çš„å¯¹è±¡ï¼ˆä¾‹å¦‚ä¸€ä¸ªdictæˆ–è€…ä¸€ä¸ªæ•°æ®åº“æ¨¡å‹ï¼‰ã€‚å¦‚æœä½ å£°æ˜äº†ä¸€ä¸ª response_modelï¼Œå®ƒä»ç„¶ä¼šè¢«ç”¨æ¥è¿‡æ»¤å’Œè½¬æ¢ä½ è¿”å›çš„å¯¹è±¡ã€‚ FastAPIå°†ä½¿ç”¨è¿™ä¸ªä¸´æ—¶å“åº”æ¥æå–çŠ¶æ€ç ï¼ˆä¹ŸåŒ…æ‹¬cookieså’Œå¤´éƒ¨ï¼‰ï¼Œå¹¶å°†å®ƒä»¬æ”¾å…¥åŒ…å«ä½ è¿”å›çš„å€¼çš„æœ€ç»ˆå“åº”ä¸­ï¼Œè¯¥å“åº”ç”±ä»»ä½• response_model è¿‡æ»¤ã€‚ ä½ ä¹Ÿå¯ä»¥åœ¨ä¾èµ–é¡¹ä¸­å£°æ˜Responseå‚æ•°ï¼Œå¹¶åœ¨å…¶ä¸­è®¾ç½®çŠ¶æ€ç ã€‚ä½†è¯·æ³¨æ„ï¼Œæœ€åè®¾ç½®çš„çŠ¶æ€ç å°†ä¼šç”Ÿæ•ˆã€‚ è¡¨å•æ•°æ®æ¥æ”¶çš„æ•°æ®ä¸æ˜¯ JSONï¼Œè€Œæ˜¯è¡¨å•å­—æ®µæ—¶ï¼Œè¦ä½¿ç”¨ Formã€‚ import uvicornfrom fastapi import FastAPI, Formfrom pydantic import BaseModelapp = FastAPI()class LoginData(BaseModel): username: str password: str@app.post(/login/)async def login(username: str = Form(...), password: str = Form(...)): return message: Login successful, username: usernameif __name__ == __main__: uvicorn.run(app) åˆ›å»ºè¡¨å•ï¼ˆFormï¼‰å‚æ•°çš„æ–¹å¼ä¸ Body å’Œ Query ä¸€æ ·ï¼š async def login(username: str = Form(...), password: str = Form(...)): ä½¿ç”¨ Form å¯ä»¥å£°æ˜ä¸ Body ï¼ˆåŠ Queryã€Pathã€Cookieï¼‰ç›¸åŒçš„å…ƒæ•°æ®å’ŒéªŒè¯ã€‚ ä¸ JSON ä¸åŒï¼ŒHTML è¡¨å•ï¼ˆform/formï¼‰å‘æœåŠ¡å™¨å‘é€æ•°æ®é€šå¸¸ä½¿ç”¨ã€Œç‰¹æ®Šã€çš„ç¼–ç ã€‚ FastAPI è¦ç¡®ä¿ä»æ­£ç¡®çš„ä½ç½®è¯»å–æ•°æ®ï¼Œè€Œä¸æ˜¯è¯»å– JSONã€‚ è¡¨å•æ¨¡å‹ä½ å¯ä»¥ä½¿ç”¨ Pydantic æ¨¡å‹åœ¨ FastAPI ä¸­å£°æ˜è¡¨å•å­—æ®µã€‚ åªéœ€å£°æ˜ä¸€ä¸ª Pydantic æ¨¡å‹ï¼Œå…¶ä¸­åŒ…å«æ‚¨å¸Œæœ›æ¥æ”¶çš„è¡¨å•å­—æ®µï¼Œç„¶åå°†å‚æ•°å£°æ˜ä¸º Form : from typing import Annotatedimport uvicornfrom fastapi import FastAPI, Formfrom pydantic import BaseModelapp = FastAPI()class FormData(BaseModel): username: str password: str@app.post(/login/)async def login(loginForm: Annotated[FormData, Form()]): return loginFormif __name__ == __main__: uvicorn.run(app) ç¦æ­¢é¢å¤–çš„è¡¨å•å­—æ®µåœ¨æŸäº›ç‰¹æ®Šä½¿ç”¨æƒ…å†µä¸‹ï¼ˆå¯èƒ½å¹¶ä¸å¸¸è§ï¼‰ï¼Œä½ å¯èƒ½å¸Œæœ›å°†è¡¨å•å­—æ®µé™åˆ¶ä¸ºä»…åœ¨ Pydantic æ¨¡å‹ä¸­å£°æ˜è¿‡çš„å­—æ®µï¼Œå¹¶ç¦æ­¢ä»»ä½•é¢å¤–çš„å­—æ®µã€‚ å¯ä»¥ä½¿ç”¨ Pydantic çš„æ¨¡å‹é…ç½®æ¥ç¦æ­¢ï¼ˆ forbid ï¼‰ä»»ä½•é¢å¤–ï¼ˆ extra ï¼‰å­—æ®µï¼š from typing import Annotatedfrom fastapi import FastAPI, Formfrom pydantic import BaseModelapp = FastAPI()class FormData(BaseModel): username: str password: str model_config = extra: forbid@app.post(/login/)async def login(data: Annotated[FormData, Form()]): return data å¦‚æœå®¢æˆ·ç«¯å°è¯•å‘é€ä¸€äº›é¢å¤–çš„æ•°æ®ï¼Œä»–ä»¬å°†æ”¶åˆ°é”™è¯¯å“åº”ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœå®¢æˆ·ç«¯å°è¯•å‘é€è¿™æ ·çš„è¡¨å•å­—æ®µï¼š username: Rick password: Portal Gun extra: Mr. Poopybutthole ä»–ä»¬å°†æ”¶åˆ°ä¸€æ¡é”™è¯¯å“åº”ï¼Œè¡¨æ˜å­—æ®µ extra æ˜¯ä¸è¢«å…è®¸çš„ï¼š detail: [ type: extra_forbidden, loc: [body, extra], msg: Extra inputs are not permitted, input: Mr. Poopybutthole ] è¯·æ±‚æ–‡ä»¶File ç”¨äºå®šä¹‰å®¢æˆ·ç«¯çš„ä¸Šä¼ æ–‡ä»¶ã€‚ åˆ›å»ºæ–‡ä»¶ï¼ˆFileï¼‰å‚æ•°çš„æ–¹å¼ä¸ Body å’Œ Form ä¸€æ ·ï¼š from fastapi import FastAPI, File, UploadFileapp = FastAPI()@app.post(/files/)async def create_file(file: bytes = File()): return file_size: len(file)@app.post(/uploadfile/)async def create_upload_file(file: UploadFile): return filename: file.filename å£°æ˜æ–‡ä»¶ä½“å¿…é¡»ä½¿ç”¨ Fileï¼Œå¦åˆ™ï¼ŒFastAPI ä¼šæŠŠè¯¥å‚æ•°å½“ä½œæŸ¥è¯¢å‚æ•°æˆ–è¯·æ±‚ä½“ï¼ˆJSONï¼‰å‚æ•°ã€‚ æ–‡ä»¶ä½œä¸ºã€Œè¡¨å•æ•°æ®ã€ä¸Šä¼ ã€‚ å¦‚æœæŠŠè·¯å¾„æ“ä½œå‡½æ•°å‚æ•°çš„ç±»å‹å£°æ˜ä¸º bytesï¼ŒFastAPI å°†ä»¥ bytes å½¢å¼è¯»å–å’Œæ¥æ”¶æ–‡ä»¶å†…å®¹ã€‚ è¿™ç§æ–¹å¼æŠŠæ–‡ä»¶çš„æ‰€æœ‰å†…å®¹éƒ½å­˜å‚¨åœ¨å†…å­˜é‡Œï¼Œé€‚ç”¨äºå°å‹æ–‡ä»¶ã€‚ ä¸è¿‡ï¼Œå¾ˆå¤šæƒ…å†µä¸‹ï¼ŒUploadFile æ›´å¥½ç”¨ã€‚ UploadFileå®šä¹‰æ–‡ä»¶å‚æ•°æ—¶ä½¿ç”¨ UploadFileï¼š from fastapi import FastAPI, File, UploadFileapp = FastAPI()@app.post(/files/)async def create_file(file: bytes = File()): return file_size: len(file)@app.post(/uploadfile/)async def create_upload_file(file: UploadFile): return filename: file.filename UploadFile ä¸ bytes ç›¸æ¯”æœ‰æ›´å¤šä¼˜åŠ¿ï¼š ä½¿ç”¨ spooled æ–‡ä»¶ï¼šå­˜å‚¨åœ¨å†…å­˜çš„æ–‡ä»¶è¶…å‡ºæœ€å¤§ä¸Šé™æ—¶ï¼ŒFastAPI ä¼šæŠŠæ–‡ä»¶å­˜å…¥ç£ç›˜ï¼› è¿™ç§æ–¹å¼æ›´é€‚äºå¤„ç†å›¾åƒã€è§†é¢‘ã€äºŒè¿›åˆ¶æ–‡ä»¶ç­‰å¤§å‹æ–‡ä»¶ï¼Œå¥½å¤„æ˜¯ä¸ä¼šå ç”¨æ‰€æœ‰å†…å­˜ï¼› å¯è·å–ä¸Šä¼ æ–‡ä»¶çš„å…ƒæ•°æ®ï¼› è‡ªå¸¦ file-like async æ¥å£ï¼› æš´éœ²çš„ Python SpooledTemporaryFile å¯¹è±¡ï¼Œå¯ç›´æ¥ä¼ é€’ç»™å…¶ä»–é¢„æœŸã€Œfile-likeã€å¯¹è±¡çš„åº“ã€‚ UploadFile çš„å±æ€§å¦‚ä¸‹ï¼š filenameï¼šä¸Šä¼ æ–‡ä»¶åå­—ç¬¦ä¸²ï¼ˆstrï¼‰ï¼Œä¾‹å¦‚ï¼Œ myimage.jpgï¼› content_typeï¼šå†…å®¹ç±»å‹ï¼ˆMIME ç±»å‹ åª’ä½“ç±»å‹ï¼‰å­—ç¬¦ä¸²ï¼ˆstrï¼‰ï¼Œä¾‹å¦‚ï¼Œimage/jpegï¼› fileï¼š SpooledTemporaryFileï¼ˆ file-like å¯¹è±¡ï¼‰ã€‚å…¶å®å°±æ˜¯ Pythonæ–‡ä»¶ï¼Œå¯ç›´æ¥ä¼ é€’ç»™å…¶ä»–é¢„æœŸ file-like å¯¹è±¡çš„å‡½æ•°æˆ–æ”¯æŒåº“ã€‚ UploadFile æ”¯æŒä»¥ä¸‹ async æ–¹æ³•ï¼Œï¼ˆä½¿ç”¨å†…éƒ¨ SpooledTemporaryFileï¼‰å¯è°ƒç”¨ç›¸åº”çš„æ–‡ä»¶æ–¹æ³•ã€‚ write(data)ï¼šæŠŠ data ï¼ˆstr æˆ– bytesï¼‰å†™å…¥æ–‡ä»¶ï¼› read(size)ï¼šæŒ‰æŒ‡å®šæ•°é‡çš„å­—èŠ‚æˆ–å­—ç¬¦ï¼ˆsize (int)ï¼‰è¯»å–æ–‡ä»¶å†…å®¹ï¼› seek(offset)ï¼šç§»åŠ¨è‡³æ–‡ä»¶ offset ï¼ˆintï¼‰å­—èŠ‚å¤„çš„ä½ç½®ï¼›ä¾‹å¦‚ï¼Œawait myfile.seek(0) ç§»åŠ¨åˆ°æ–‡ä»¶å¼€å¤´ï¼›æ‰§è¡Œ await myfile.read() åï¼Œéœ€å†æ¬¡è¯»å–å·²è¯»å–å†…å®¹æ—¶ï¼Œè¿™ç§æ–¹æ³•ç‰¹åˆ«å¥½ç”¨ï¼› close()ï¼šå…³é—­æ–‡ä»¶ã€‚ å› ä¸ºä¸Šè¿°æ–¹æ³•éƒ½æ˜¯ async æ–¹æ³•ï¼Œè¦æ­é…ã€Œawaitã€ä½¿ç”¨ã€‚ ä¾‹å¦‚ï¼Œåœ¨ async è·¯å¾„æ“ä½œå‡½æ•° å†…ï¼Œè¦ç”¨ä»¥ä¸‹æ–¹å¼è¯»å–æ–‡ä»¶å†…å®¹ï¼š contents = await myfile.read() åœ¨æ™®é€š def è·¯å¾„æ“ä½œå‡½æ•° å†…ï¼Œåˆ™å¯ä»¥ç›´æ¥è®¿é—® UploadFile.fileï¼Œä¾‹å¦‚ï¼š contents = myfile.file.read() å¯é€‰æ–‡ä»¶ä¸Šä¼ å¯ä»¥é€šè¿‡ä½¿ç”¨æ ‡å‡†ç±»å‹æ³¨è§£å¹¶å°† None ä½œä¸ºé»˜è®¤å€¼çš„æ–¹å¼å°†ä¸€ä¸ªæ–‡ä»¶å‚æ•°è®¾ä¸ºå¯é€‰: from typing import Annotatedfrom fastapi import FastAPI, File, UploadFileapp = FastAPI()@app.post(/files/)async def create_file(file: Annotated[bytes | None, File()] = None): if not file: return message: No file sent else: return file_size: len(file)@app.post(/uploadfile/)async def create_upload_file(file: UploadFile | None = None): if not file: return message: No upload file sent else: return filename: file.filename å¸¦æœ‰é¢å¤–å…ƒæ•°æ®çš„ UploadFileä¹Ÿå¯ä»¥å°† File() ä¸ UploadFile ä¸€èµ·ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼Œè®¾ç½®é¢å¤–çš„å…ƒæ•°æ®: from typing import Annotatedfrom fastapi import FastAPI, File, UploadFileapp = FastAPI()@app.post(/files/)async def create_file(file: Annotated[bytes, File(description=A file read as bytes)]): return file_size: len(file)@app.post(/uploadfile/)async def create_upload_file( file: Annotated[UploadFile, File(description=A file read as UploadFile)],): return filename: file.filename å¤šæ–‡ä»¶ä¸Šä¼ FastAPI æ”¯æŒåŒæ—¶ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ã€‚ å¯ç”¨åŒä¸€ä¸ªã€Œè¡¨å•å­—æ®µã€å‘é€å«å¤šä¸ªæ–‡ä»¶çš„ã€Œè¡¨å•æ•°æ®ã€ã€‚ ä¸Šä¼ å¤šä¸ªæ–‡ä»¶æ—¶ï¼Œè¦å£°æ˜å« bytes æˆ– UploadFile çš„åˆ—è¡¨ï¼ˆListï¼‰ï¼š from typing import Annotatedfrom fastapi import FastAPI, File, UploadFilefrom fastapi.responses import HTMLResponseapp = FastAPI()@app.post(/files/)async def create_files(files: Annotated[list[bytes], File()]): return file_sizes: [len(file) for file in files]@app.post(/uploadfiles/)async def create_upload_files(files: list[UploadFile]): return filenames: [file.filename for file in files]@app.get(/)async def main(): content = bodyform action=/files/ enctype=multipart/form-data method=postinput name=files type=file multipleinput type=submit/formform action=/uploadfiles/ enctype=multipart/form-data method=postinput name=files type=file multipleinput type=submit/form/body return HTMLResponse(content=content) æ¥æ”¶çš„ä¹Ÿæ˜¯å« bytes æˆ– UploadFile çš„åˆ—è¡¨ï¼ˆlistï¼‰ã€‚ å¸¦æœ‰é¢å¤–å…ƒæ•°æ®çš„å¤šæ–‡ä»¶ä¸Šä¼ å’Œä¹‹å‰çš„æ–¹å¼ä¸€æ ·, å¯ä»¥ä¸º File() è®¾ç½®é¢å¤–å‚æ•°, å³ä½¿æ˜¯ UploadFile: from typing import Annotatedfrom fastapi import FastAPI, File, UploadFilefrom fastapi.responses import HTMLResponseapp = FastAPI()@app.post(/files/)async def create_files( files: Annotated[list[bytes], File(description=Multiple files as bytes)],): return file_sizes: [len(file) for file in files]@app.post(/uploadfiles/)async def create_upload_files( files: Annotated[ list[UploadFile], File(description=Multiple files as UploadFile) ],): return filenames: [file.filename for file in files]@app.get(/)async def main(): content = bodyform action=/files/ enctype=multipart/form-data method=postinput name=files type=file multipleinput type=submit/formform action=/uploadfiles/ enctype=multipart/form-data method=postinput name=files type=file multipleinput type=submit/form/body return HTMLResponse(content=content) è¯·æ±‚è¡¨å•ä¸æ–‡ä»¶FastAPI æ”¯æŒåŒæ—¶ä½¿ç”¨ File å’Œ Form å®šä¹‰æ–‡ä»¶å’Œè¡¨å•å­—æ®µã€‚ from fastapi import FastAPI, File, Form, UploadFileapp = FastAPI()@app.post(/files/)async def create_file( file: bytes = File(), fileb: UploadFile = File(), token: str = Form()): return file_size: len(file), token: token, fileb_content_type: fileb.content_type, é”™è¯¯å¤„ç†æŸäº›æƒ…å†µä¸‹ï¼Œéœ€è¦å‘å®¢æˆ·ç«¯è¿”å›é”™è¯¯æç¤ºã€‚ è¿™é‡Œæ‰€è°“çš„å®¢æˆ·ç«¯åŒ…æ‹¬å‰ç«¯æµè§ˆå™¨ã€å…¶ä»–åº”ç”¨ç¨‹åºã€ç‰©è”ç½‘è®¾å¤‡ç­‰ã€‚ éœ€è¦å‘å®¢æˆ·ç«¯è¿”å›é”™è¯¯æç¤ºçš„åœºæ™¯ä¸»è¦å¦‚ä¸‹ï¼š å®¢æˆ·ç«¯æ²¡æœ‰æ‰§è¡Œæ“ä½œçš„æƒé™ å®¢æˆ·ç«¯æ²¡æœ‰è®¿é—®èµ„æºçš„æƒé™ å®¢æˆ·ç«¯è¦è®¿é—®çš„é¡¹ç›®ä¸å­˜åœ¨ ç­‰ç­‰ â€¦ é‡åˆ°è¿™äº›æƒ…å†µæ—¶ï¼Œé€šå¸¸è¦è¿”å› 4XXï¼ˆ400 è‡³ 499ï¼‰HTTP çŠ¶æ€ç ã€‚ 4XX çŠ¶æ€ç ä¸è¡¨ç¤ºè¯·æ±‚æˆåŠŸçš„ 2XXï¼ˆ200 è‡³ 299ï¼‰ HTTP çŠ¶æ€ç ç±»ä¼¼ã€‚ åªä¸è¿‡ï¼Œ4XX çŠ¶æ€ç è¡¨ç¤ºå®¢æˆ·ç«¯å‘ç”Ÿçš„é”™è¯¯ã€‚ HTTPExceptionå‘å®¢æˆ·ç«¯è¿”å› HTTP é”™è¯¯å“åº”ï¼Œå¯ä»¥ä½¿ç”¨ HTTPExceptionã€‚ from fastapi import FastAPI, HTTPExceptionapp = FastAPI()items = foo: The Foo Wrestlers@app.get(/items/item_id)async def read_item(item_id: str): if item_id not in items: raise HTTPException(status_code=404, detail=Item not found) return item: items[item_id]if __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) HTTPException æ˜¯é¢å¤–åŒ…å«äº†å’Œ API æœ‰å…³æ•°æ®çš„å¸¸è§„ Python å¼‚å¸¸ã€‚ å› ä¸ºæ˜¯ Python å¼‚å¸¸ï¼Œæ‰€ä»¥ä¸èƒ½ returnï¼Œåªèƒ½ raiseã€‚ å¦‚åœ¨è°ƒç”¨è·¯å¾„æ“ä½œå‡½æ•°é‡Œçš„å·¥å…·å‡½æ•°æ—¶ï¼Œè§¦å‘äº† HTTPExceptionï¼ŒFastAPI å°±ä¸å†ç»§ç»­æ‰§è¡Œè·¯å¾„æ“ä½œå‡½æ•°ä¸­çš„åç»­ä»£ç ï¼Œè€Œæ˜¯ç«‹å³ç»ˆæ­¢è¯·æ±‚ï¼Œå¹¶æŠŠ HTTPException çš„ HTTP é”™è¯¯å‘é€è‡³å®¢æˆ·ç«¯ã€‚ æœ¬ä¾‹ä¸­ï¼Œå®¢æˆ·ç«¯ç”¨ ID è¯·æ±‚çš„ item ä¸å­˜åœ¨æ—¶ï¼Œè§¦å‘çŠ¶æ€ç ä¸º 404 çš„å¼‚å¸¸ã€‚ è¯·æ±‚ä¸º http://example.com/items/fooï¼ˆitem_id ä¸º fooï¼‰æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šæ¥æ”¶åˆ° HTTP çŠ¶æ€ç  - 200 åŠå¦‚ä¸‹ JSON å“åº”ç»“æœï¼š item: The Foo Wrestlers ä½†å¦‚æœå®¢æˆ·ç«¯è¯·æ±‚ http://example.com/items/barï¼ˆitem_id ä¸º bar ä¸å­˜åœ¨æ—¶ï¼‰ï¼Œåˆ™ä¼šæ¥æ”¶åˆ° HTTP çŠ¶æ€ç  - 404ï¼ˆã€Œæœªæ‰¾åˆ°ã€é”™è¯¯ï¼‰åŠå¦‚ä¸‹ JSON å“åº”ç»“æœï¼š detail: Item not found æ·»åŠ è‡ªå®šä¹‰å“åº”å¤´æœ‰äº›åœºæ™¯ä¸‹è¦ä¸º HTTP é”™è¯¯æ·»åŠ è‡ªå®šä¹‰å“åº”å¤´ã€‚ä¾‹å¦‚ï¼Œå‡ºäºæŸäº›æ–¹é¢çš„å®‰å…¨éœ€è¦ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹å¯èƒ½ä¸ä¼šéœ€è¦åœ¨ä»£ç ä¸­ç›´æ¥ä½¿ç”¨å“åº”å¤´ã€‚ ä½†å¯¹äºæŸäº›é«˜çº§åº”ç”¨åœºæ™¯ï¼Œè¿˜æ˜¯éœ€è¦æ·»åŠ è‡ªå®šä¹‰å“åº”å¤´ï¼š import uvicornfrom fastapi import FastAPI, HTTPExceptionapp = FastAPI()items = foo: The Foo @app.get(/items-header/item_id)async def read_items_header(item_id: str): if item_id not in items: raise HTTPException(status_code=404, detail=Item not found, headers=X-Error: There goes my error) return item: items[item_id]if __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†æ·»åŠ è‡ªå®šä¹‰å¤„ç†å™¨ï¼Œè¦ä½¿ç”¨ Starlette çš„å¼‚å¸¸å·¥å…·ã€‚ å‡è®¾è¦è§¦å‘çš„è‡ªå®šä¹‰å¼‚å¸¸å«ä½œ UnicornExceptionã€‚ ä¸”éœ€è¦ FastAPI å®ç°å…¨å±€å¤„ç†è¯¥å¼‚å¸¸ã€‚ æ­¤æ—¶ï¼Œå¯ä»¥ç”¨ @app.exception_handler() æ·»åŠ è‡ªå®šä¹‰å¼‚å¸¸æ§åˆ¶å™¨ï¼š import uvicornfrom fastapi import FastAPI, Requestfrom fastapi.responses import JSONResponseclass UnicornException(Exception): def __init__(self, name: str): self.name = nameapp = FastAPI()@app.exception_handler(UnicornException)async def unicorn_exception_handler(request: Request, exc: UnicornException): return JSONResponse( status_code=418, content=message: fOps! exc.name did something. There goes a rainbow..., )@app.get(/unicorns/name)async def read_unicorn(name: str): if name == yolo: raise UnicornException(name=name) return unicorn_name: nameif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) è¯·æ±‚ /unicorns/yolo æ—¶ï¼Œè·¯å¾„æ“ä½œä¼šè§¦å‘ UnicornExceptionã€‚ ä½†è¯¥å¼‚å¸¸å°†ä¼šè¢« unicorn_exception_handler å¤„ç†ã€‚ æ¥æ”¶åˆ°çš„é”™è¯¯ä¿¡æ¯æ¸…æ™°æ˜äº†ï¼ŒHTTP çŠ¶æ€ç ä¸º 418ï¼ŒJSON å†…å®¹å¦‚ä¸‹ï¼š message: Oops! yolo did something. There goes a rainbow... è¦†ç›–é»˜è®¤å¼‚å¸¸å¤„ç†å™¨FastAPI è‡ªå¸¦äº†ä¸€äº›é»˜è®¤å¼‚å¸¸å¤„ç†å™¨ã€‚ è§¦å‘ HTTPException æˆ–è¯·æ±‚æ— æ•ˆæ•°æ®æ—¶ï¼Œè¿™äº›å¤„ç†å™¨è¿”å›é»˜è®¤çš„ JSON å“åº”ç»“æœã€‚ ä¸è¿‡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰å¤„ç†å™¨è¦†ç›–é»˜è®¤å¼‚å¸¸å¤„ç†å™¨ã€‚ è¦†ç›–è¯·æ±‚éªŒè¯å¼‚å¸¸è¯·æ±‚ä¸­åŒ…å«æ— æ•ˆæ•°æ®æ—¶ï¼ŒFastAPI å†…éƒ¨ä¼šè§¦å‘ RequestValidationErrorã€‚ è¯¥å¼‚å¸¸ä¹Ÿå†…ç½®äº†é»˜è®¤å¼‚å¸¸å¤„ç†å™¨ã€‚ è¦†ç›–é»˜è®¤å¼‚å¸¸å¤„ç†å™¨æ—¶éœ€è¦å¯¼å…¥ RequestValidationErrorï¼Œå¹¶ç”¨ @app.excption_handler(RequestValidationError) è£…é¥°å¼‚å¸¸å¤„ç†å™¨ã€‚ è¿™æ ·ï¼Œå¼‚å¸¸å¤„ç†å™¨å°±å¯ä»¥æ¥æ”¶ Request ä¸å¼‚å¸¸ã€‚ import uvicornfrom fastapi import FastAPI, HTTPExceptionfrom fastapi.exceptions import RequestValidationErrorfrom fastapi.responses import PlainTextResponseapp = FastAPI()@app.exception_handler(RequestValidationError)async def validation_exception_handler(request, exc): return PlainTextResponse(str(exc), status_code=400)@app.get(/items/item_id)async def read_item(item_id: int): if item_id == 3: raise HTTPException(status_code=418, detail=Nope! I dont like 3.) return item_id: item_idif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) è®¿é—® itemsfooï¼Œå¯ä»¥çœ‹åˆ°é»˜è®¤çš„ JSON é”™è¯¯ä¿¡æ¯ï¼š detail: [ type: int_parsing, loc: [ path, item_id ], msg: Input should be a valid integer, unable to parse string as an integer, input: foo ] è¢«æ›¿æ¢ä¸ºäº†ä»¥ä¸‹æ–‡æœ¬æ ¼å¼çš„é”™è¯¯ä¿¡æ¯ï¼š [type: int_parsing, loc: (path, item_id), msg: Input should be a valid integer, unable to parse string as an integer, input: foo] ä½¿ç”¨ RequestValidationError çš„è¯·æ±‚ä½“RequestValidationError åŒ…å«å…¶æ¥æ”¶åˆ°çš„æ— æ•ˆæ•°æ®è¯·æ±‚çš„ bodyã€‚ å¼€å‘æ—¶ï¼Œå¯ä»¥ç”¨è¿™ä¸ªè¯·æ±‚ä½“ç”Ÿæˆæ—¥å¿—ã€è°ƒè¯•é”™è¯¯ï¼Œå¹¶è¿”å›ç»™ç”¨æˆ·ã€‚ import uvicornfrom fastapi import FastAPI, Request, statusfrom fastapi.encoders import jsonable_encoderfrom fastapi.exceptions import RequestValidationErrorfrom openai import BaseModelfrom starlette.responses import JSONResponseapp = FastAPI()@app.exception_handler(RequestValidationError)async def validation_exception_handler(request: Request, exc: RequestValidationError): return JSONResponse( status_code=status.HTTP_422_UNPROCESSABLE_ENTITY, content=jsonable_encoder(detail: exc.errors(), body: exc.body) )class Item(BaseModel): title: str size: int@app.post(/items/)async def create_item(item: Item): return itemif __name__ == __main__: uvicorn.run(app) ç°åœ¨è¯•ç€å‘é€ä¸€ä¸ªæ— æ•ˆçš„ itemï¼Œä¾‹å¦‚ï¼š title: towel, size: XL æ”¶åˆ°çš„å“åº”åŒ…å« body ä¿¡æ¯ï¼Œå¹¶è¯´æ˜æ•°æ®æ˜¯æ— æ•ˆçš„ï¼š detail: [ type: int_parsing, loc: [ body, size ], msg: Input should be a valid integer, unable to parse string as an integer, input: XL ], body: title: towel, size: XL è¦†ç›– HTTPException é”™è¯¯å¤„ç†å™¨import uvicornfrom fastapi import FastAPI, HTTPExceptionfrom fastapi.responses import PlainTextResponsefrom starlette.exceptions import HTTPException as StarletteHTTPExceptionapp = FastAPI()@app.exception_handler(StarletteHTTPException)async def http_exception_handler(request, exc): return PlainTextResponse(str(exc.detail), status_code=exc.status_code)@app.get(/items/item_id)async def read_item(item_id: int): if item_id == 3: raise HTTPException(status_code=418, detail=Nope! I dont like 3.) return item_id: item_idif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) FastAPI ä¹Ÿæä¾›äº†è‡ªæœ‰çš„ HTTPExceptionã€‚ FastAPI çš„ HTTPException ç»§æ‰¿è‡ª Starlette çš„ HTTPException é”™è¯¯ç±»ã€‚ å®ƒä»¬ä¹‹é—´çš„å”¯ä¸€åŒºåˆ«æ˜¯ï¼ŒFastAPI çš„ HTTPException å¯ä»¥åœ¨å“åº”ä¸­æ·»åŠ å“åº”å¤´ã€‚ OAuth 2.0 ç­‰å®‰å…¨å·¥å…·éœ€è¦åœ¨å†…éƒ¨è°ƒç”¨è¿™äº›å“åº”å¤´ã€‚ å› æ­¤ä½ å¯ä»¥ç»§ç»­åƒå¹³å¸¸ä¸€æ ·åœ¨ä»£ç ä¸­è§¦å‘ FastAPI çš„ HTTPException ã€‚ ä½†æ³¨å†Œå¼‚å¸¸å¤„ç†å™¨æ—¶ï¼Œåº”è¯¥æ³¨å†Œåˆ°æ¥è‡ª Starlette çš„ HTTPExceptionã€‚ è¿™æ ·åšæ˜¯ä¸ºäº†ï¼Œå½“ Starlette çš„å†…éƒ¨ä»£ç ã€æ‰©å±•æˆ–æ’ä»¶è§¦å‘ Starlette HTTPException æ—¶ï¼Œå¤„ç†ç¨‹åºèƒ½å¤Ÿæ•è·ã€å¹¶å¤„ç†æ­¤å¼‚å¸¸ã€‚ æ³¨æ„ï¼Œæœ¬ä¾‹ä»£ç ä¸­åŒæ—¶ä½¿ç”¨äº†è¿™ä¸¤ä¸ª HTTPExceptionï¼Œæ­¤æ—¶ï¼Œè¦æŠŠ Starlette çš„ HTTPException å‘½åä¸º StarletteHTTPExceptionï¼š from starlette.exceptions import HTTPException as StarletteHTTPException å¤ç”¨ FastAPI å¼‚å¸¸å¤„ç†å™¨FastAPI æ”¯æŒå…ˆå¯¹å¼‚å¸¸è¿›è¡ŒæŸäº›å¤„ç†ï¼Œç„¶åå†ä½¿ç”¨ FastAPI ä¸­å¤„ç†è¯¥å¼‚å¸¸çš„é»˜è®¤å¼‚å¸¸å¤„ç†å™¨ã€‚ ä» fastapi.exception_handlers ä¸­å¯¼å…¥è¦å¤ç”¨çš„é»˜è®¤å¼‚å¸¸å¤„ç†å™¨ï¼š from fastapi import FastAPI, HTTPExceptionfrom fastapi.exception_handlers import ( http_exception_handler, request_validation_exception_handler,)from fastapi.exceptions import RequestValidationErrorfrom starlette.exceptions import HTTPException as StarletteHTTPExceptionapp = FastAPI()@app.exception_handler(StarletteHTTPException)async def custom_http_exception_handler(request, exc): print(fOMG! An HTTP error!: repr(exc)) return await http_exception_handler(request, exc)@app.exception_handler(RequestValidationError)async def validation_exception_handler(request, exc): print(fOMG! The client sent invalid data!: exc) return await request_validation_exception_handler(request, exc)@app.get(/items/item_id)async def read_item(item_id: int): if item_id == 3: raise HTTPException(status_code=418, detail=Nope! I dont like 3.) return item_id: item_id è·¯å¾„æ“ä½œé…ç½®è·¯å¾„æ“ä½œè£…é¥°å™¨æ”¯æŒå¤šç§é…ç½®å‚æ•°ã€‚ çŠ¶æ€ç from typing import Set, Unionfrom fastapi import FastAPI, statusfrom pydantic import BaseModelapp = FastAPI()class Item(BaseModel): name: str description: Union[str, None] = None price: float tax: Union[float, None] = None tags: Set[str] = set()@app.post(/items/, response_model=Item, status_code=status.HTTP_201_CREATED)async def create_item(item: Item): return item tags å‚æ•°tags å‚æ•°çš„å€¼æ˜¯ç”± str ç»„æˆçš„ list ï¼ˆä¸€èˆ¬åªæœ‰ä¸€ä¸ª str ï¼‰ï¼Œtags ç”¨äºä¸ºè·¯å¾„æ“ä½œæ·»åŠ æ ‡ç­¾ï¼š from typing import Set, Unionimport uvicornfrom fastapi import FastAPIfrom pydantic import BaseModelapp = FastAPI()class Item(BaseModel): name: str description: Union[str, None] = None price: float tax: Union[float, None] = None tags: Set[str] = set()@app.post(/items/, response_model=Item, tags=[items])async def create_item(item: Item): return item@app.get(/items/, tags=[items])async def read_items(): return [name: Foo, price: 42]@app.get(/users/, tags=[users])async def read_users(): return [username: johndoe]if __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) summary å’Œ description å‚æ•°from typing import Set, Unionimport uvicornfrom fastapi import FastAPIfrom pydantic import BaseModelapp = FastAPI()class Item(BaseModel): name: str description: Union[str, None] = None price: float tax: Union[float, None] = None tags: Set[str] = set()@app.post( /items/, response_model=Item, summary=Create an item, description=Create an item with all the information, name, description, price, tax and a set of unique tags,)async def create_item(item: Item): return itemif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) æ–‡æ¡£å­—ç¬¦ä¸²æè¿°å†…å®¹æ¯”è¾ƒé•¿ä¸”å ç”¨å¤šè¡Œæ—¶ï¼Œå¯ä»¥åœ¨å‡½æ•°çš„ docstring ä¸­å£°æ˜è·¯å¾„æ“ä½œçš„æè¿°ï¼ŒFastAPI æ”¯æŒä»æ–‡æ¡£å­—ç¬¦ä¸²ä¸­è¯»å–æè¿°å†…å®¹ã€‚ æ–‡æ¡£å­—ç¬¦ä¸²æ”¯æŒ Markdownï¼Œèƒ½æ­£ç¡®è§£æå’Œæ˜¾ç¤º Markdown çš„å†…å®¹ï¼Œä½†è¦æ³¨æ„æ–‡æ¡£å­—ç¬¦ä¸²çš„ç¼©è¿›ã€‚ from typing import Set, Unionimport uvicornfrom fastapi import FastAPIfrom pydantic import BaseModelapp = FastAPI()class Item(BaseModel): name: str description: Union[str, None] = None price: float tax: Union[float, None] = None tags: Set[str] = set()@app.post(/items/, response_model=Item, summary=Create an item)async def create_item(item: Item): Create an item with all the information: - **name**: each item must have a name - **description**: a long description - **price**: required - **tax**: if the item doesnt have tax, you can omit this - **tags**: a set of unique tag strings for this item return itemif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) å“åº”æè¿°response_description å‚æ•°ç”¨äºå®šä¹‰å“åº”çš„æè¿°è¯´æ˜ï¼š from typing import Set, Unionimport uvicornfrom fastapi import FastAPIfrom pydantic import BaseModelapp = FastAPI()class Item(BaseModel): name: str description: Union[str, None] = None price: float tax: Union[float, None] = None tags: Set[str] = set()@app.post( /items/, response_model=Item, summary=Create an item, response_description=The created item,)async def create_item(item: Item): Create an item with all the information: - **name**: each item must have a name - **description**: a long description - **price**: required - **tax**: if the item doesnt have tax, you can omit this - **tags**: a set of unique tag strings for this item return itemif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) å¼ƒç”¨è·¯å¾„æ“ä½œdeprecated å‚æ•°å¯ä»¥æŠŠè·¯å¾„æ“ä½œæ ‡è®°ä¸ºå¼ƒç”¨ï¼Œæ— éœ€ç›´æ¥åˆ é™¤ï¼š import uvicornfrom fastapi import FastAPIapp = FastAPI()@app.get(/items/, tags=[items])async def read_items(): return [name: Foo, price: 42]@app.get(/users/, tags=[users])async def read_users(): return [username: johndoe]@app.get(/elements/, tags=[items], deprecated=True)async def read_elements(): return [item_id: Foo]if __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) JSON å…¼å®¹ç¼–ç å™¨åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦å°†æ•°æ®ç±»å‹ï¼ˆå¦‚Pydanticæ¨¡å‹ï¼‰è½¬æ¢ä¸ºä¸JSONå…¼å®¹çš„æ•°æ®ç±»å‹ï¼ˆå¦‚dictã€listç­‰ï¼‰ã€‚ æ¯”å¦‚ï¼Œå¦‚æœæ‚¨éœ€è¦å°†å…¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚ å¯¹äºè¿™ç§è¦æ±‚ï¼ŒFastAPIæä¾›äº† jsonable_encoder() å‡½æ•°ã€‚ æˆ‘ä»¬å‡è®¾ä½ æœ‰ä¸€ä¸ªæ•°æ®åº“åä¸ºfake_dbï¼Œå®ƒåªèƒ½æ¥æ”¶ä¸JSONå…¼å®¹çš„æ•°æ®ã€‚ ä¾‹å¦‚ï¼Œå®ƒä¸æ¥æ”¶datetimeè¿™ç±»çš„å¯¹è±¡ï¼Œå› ä¸ºè¿™äº›å¯¹è±¡ä¸JSONä¸å…¼å®¹ã€‚ å› æ­¤ï¼Œdatetimeå¯¹è±¡å¿…é¡»å°†è½¬æ¢ä¸ºåŒ…å«ISOæ ¼å¼åŒ–çš„strç±»å‹å¯¹è±¡ã€‚ åŒæ ·ï¼Œè¿™ä¸ªæ•°æ®åº“ä¹Ÿä¸ä¼šæ¥æ”¶Pydanticæ¨¡å‹ï¼ˆå¸¦æœ‰å±æ€§çš„å¯¹è±¡ï¼‰ï¼Œè€Œåªæ¥æ”¶dictã€‚ å¯¹æ­¤ä½ å¯ä»¥ä½¿ç”¨jsonable_encoderã€‚ å®ƒæ¥æ”¶ä¸€ä¸ªå¯¹è±¡ï¼Œæ¯”å¦‚Pydanticæ¨¡å‹ï¼Œå¹¶ä¼šè¿”å›ä¸€ä¸ªJSONå…¼å®¹çš„ç‰ˆæœ¬ï¼š from datetime import datetimefrom fastapi import FastAPIfrom fastapi.encoders import jsonable_encoderfrom pydantic import BaseModelfake_db = class Item(BaseModel): title: str timestamp: datetime description: str | None = Noneapp = FastAPI()@app.put(/items/id)def update_item(id: str, item: Item): json_compatible_item_data = jsonable_encoder(item) fake_db[id] = json_compatible_item_data@app.get(/items/id)def get_item(id: str): return fake_db[id]if __name__ == __main__: import uvicorn uvicorn.run(app) ä¾èµ–é¡¹ç¼–ç¨‹ä¸­çš„ã€Œä¾èµ–æ³¨å…¥ã€æ˜¯å£°æ˜ä»£ç è¿è¡Œæ‰€éœ€çš„ï¼Œæˆ–è¦ä½¿ç”¨çš„ã€Œä¾èµ–ã€çš„ä¸€ç§æ–¹å¼ã€‚ ç„¶åï¼Œç”±ç³»ç»Ÿï¼ˆæœ¬æ–‡ä¸­ä¸º FastAPIï¼‰è´Ÿè´£æ‰§è¡Œä»»æ„éœ€è¦çš„é€»è¾‘ï¼Œä¸ºä»£ç æä¾›è¿™äº›ä¾èµ–ï¼ˆã€Œæ³¨å…¥ã€ä¾èµ–é¡¹ï¼‰ã€‚ ä¾èµ–æ³¨å…¥å¸¸ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š å…±äº«ä¸šåŠ¡é€»è¾‘ï¼ˆå¤ç”¨ç›¸åŒçš„ä»£ç é€»è¾‘ï¼‰ å…±äº«æ•°æ®åº“è¿æ¥ å®ç°å®‰å…¨ã€éªŒè¯ã€è§’è‰²æƒé™ ç­‰â€¦â€¦ ä¸Šè¿°åœºæ™¯å‡å¯ä»¥ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œå°†ä»£ç é‡å¤æœ€å°åŒ–ã€‚ é¦–å…ˆï¼Œè¦å…³æ³¨çš„æ˜¯ä¾èµ–é¡¹ã€‚ä¾èµ–é¡¹å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸”å¯ä»¥ä½¿ç”¨ä¸è·¯å¾„æ“ä½œå‡½æ•°ç›¸åŒçš„å‚æ•°ï¼š import uvicornfrom fastapi import FastAPIfrom fastapi.params import Dependsapp = FastAPI()async def common_parameters(q: str | None = None, skip: int = 0, limit: int = 100): return skip: skip, limit: limit, q: q@app.get(/items/)async def read_items(commons: dict = Depends(common_parameters)): return commons@app.get(/users/)async def read_users(commons: dict = Depends(common_parameters)): return commonsif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) ä¾èµ–é¡¹å‡½æ•°çš„å½¢å¼å’Œç»“æ„ä¸è·¯å¾„æ“ä½œå‡½æ•°ä¸€æ ·ã€‚å› æ­¤ï¼Œå¯ä»¥æŠŠä¾èµ–é¡¹å½“ä½œæ²¡æœ‰ã€Œè£…é¥°å™¨ã€ï¼ˆå³ï¼Œæ²¡æœ‰ @app.get(/some-path) ï¼‰çš„è·¯å¾„æ“ä½œå‡½æ•°ã€‚ä¾èµ–é¡¹å¯ä»¥è¿”å›å„ç§å†…å®¹ã€‚æœ¬ä¾‹ä¸­çš„ä¾èµ–é¡¹é¢„æœŸæ¥æ”¶å¦‚ä¸‹å‚æ•°ï¼š ç±»å‹ä¸º str çš„å¯é€‰æŸ¥è¯¢å‚æ•° q ç±»å‹ä¸º int çš„å¯é€‰æŸ¥è¯¢å‚æ•° skipï¼Œé»˜è®¤å€¼æ˜¯ 0 ç±»å‹ä¸º int çš„å¯é€‰æŸ¥è¯¢å‚æ•° limitï¼Œé»˜è®¤å€¼æ˜¯ 100 ç„¶åï¼Œä¾èµ–é¡¹å‡½æ•°è¿”å›åŒ…å«è¿™äº›å€¼çš„ dictã€‚å£°æ˜ä¾èµ–é¡¹éœ€è¦ä½¿ç”¨ Depends å’Œä¸€ä¸ªæ–°çš„å‚æ•°ï¼Œè¿™é‡Œåªèƒ½ä¼ ç»™ Depends ä¸€ä¸ªå‚æ•°ã€‚ä¸”è¯¥å‚æ•°å¿…é¡»æ˜¯å¯è°ƒç”¨å¯¹è±¡ï¼Œæ¯”å¦‚å‡½æ•°ã€‚ æ¥æ”¶åˆ°æ–°çš„è¯·æ±‚æ—¶ï¼ŒFastAPI æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š ç”¨æ­£ç¡®çš„å‚æ•°è°ƒç”¨ä¾èµ–é¡¹å‡½æ•°ï¼ˆã€Œå¯ä¾èµ–é¡¹ã€ï¼‰ è·å–å‡½æ•°è¿”å›çš„ç»“æœ æŠŠå‡½æ•°è¿”å›çš„ç»“æœèµ‹å€¼ç»™è·¯å¾„æ“ä½œå‡½æ•°çš„å‚æ•° è¿™æ ·ï¼Œåªç¼–å†™ä¸€æ¬¡ä»£ç ï¼ŒFastAPI å°±å¯ä»¥ä¸ºå¤šä¸ªè·¯å¾„æ“ä½œå…±äº«è¿™æ®µä»£ç  ã€‚ ä½¿ç”¨éä¾èµ–é¡¹ï¼š import uvicornfrom fastapi import FastAPIapp = FastAPI()async def common_parameters(q: str | None = None, skip: int = 0, limit: int = 100): return skip: skip, limit: limit, q: q@app.get(/items/)async def read_items(q: str | None = None, skip: int = 0, limit: int = 100): commons = await common_parameters(q, skip, limit) return commons@app.get(/users/)async def read_users(q: str | None = None, skip: int = 0, limit: int = 100): commons = await common_parameters(q, skip, limit) return commonsif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) **ç§»é™¤äº† Depends**ï¼šæˆ‘ä»¬å°† å‡½æ•°çš„è°ƒç”¨ç›´æ¥æ”¾åœ¨äº†æ¯ä¸ªè·¯ç”±å¤„ç†å™¨ä¸­ã€‚ common_parameters æ‰‹åŠ¨ä¼ é€’å‚æ•°ï¼šåœ¨æ¯ä¸ªè·¯ç”±ä¸­æ‰‹åŠ¨ä¼ é€’ ã€ å’Œ å‚æ•°ç»™ å‡½æ•°ã€‚ qã€skipã€limitã€common_parameters ç±»ä½œä¸ºä¾èµ–é¡¹åœ¨ä¸Šä¸ªä¾‹å­ä¸­æˆ‘ä»¬ä»ä¸­è¿”å›äº†ä¸€ä¸ª dict,æˆ‘ä»¬çŸ¥é“ç¼–è¾‘å™¨ä¸èƒ½ä¸º dict æä¾›å¾ˆå¤šæ”¯æŒ(æ¯”å¦‚è¡¥å…¨)ï¼Œå› ä¸ºç¼–è¾‘å™¨ä¸çŸ¥é“ dict çš„é”®å’Œå€¼ç±»å‹ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢çš„ä¾èµ–é¡¹ â€œå¯ä¾èµ–å¯¹è±¡â€ common_parameters æ›´æ”¹ä¸ºç±» CommonQueryParams: import uvicornfrom fastapi import FastAPI, Dependsapp = FastAPI()fake_items_db = [item_name: Foo, item_name: Bar, item_name: Baz]class CommonQueryParams: def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100): self.q = q self.skip = skip self.limit = limit@app.get(/items/)async def read_items(commons: CommonQueryParams = Depends(CommonQueryParams)): response = if commons.q: response.update(q: commons.q) items = fake_items_db[commons.skip: commons.skip + commons.limit] response.update(items: items) return responseif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) å­ä¾èµ–é¡¹FastAPI æ”¯æŒåˆ›å»ºå«å­ä¾èµ–é¡¹çš„ä¾èµ–é¡¹ã€‚ å¹¶ä¸”ï¼Œå¯ä»¥æŒ‰éœ€å£°æ˜ä»»æ„æ·±åº¦çš„å­ä¾èµ–é¡¹åµŒå¥—å±‚çº§ã€‚ FastAPI è´Ÿè´£å¤„ç†è§£æä¸åŒæ·±åº¦çš„å­ä¾èµ–é¡¹ã€‚ import uvicornfrom fastapi import FastAPI, Cookie, Dependsapp = FastAPI()def query_extractor(q: str | None = None): return qdef query_or_cookie_extractor( q: str = Depends(query_extractor), last_query: str | None = Cookie(default=None),): if not q: return last_query return q@app.get(/items/)async def read_query(query_or_default: str = Depends(query_or_cookie_extractor)): return q_or_cookie: query_or_defaultif __name__ == __main__: uvicorn.run(app, host=0.0.0.0, port=8000) æ³¨æ„ï¼Œè¿™é‡Œåœ¨è·¯å¾„æ“ä½œå‡½æ•°ä¸­åªå£°æ˜äº†ä¸€ä¸ªä¾èµ–é¡¹ï¼Œå³ query_or_cookie_extractor ã€‚ ä½† FastAPI å¿…é¡»å…ˆå¤„ç† query_extractorï¼Œä»¥ä¾¿åœ¨è°ƒç”¨ query_or_cookie_extractor æ—¶ä½¿ç”¨ query_extractor è¿”å›çš„ç»“æœã€‚ å¦‚æœåœ¨åŒä¸€ä¸ª è·¯å¾„æ“ä½œ å¤šæ¬¡å£°æ˜äº†åŒä¸€ä¸ªä¾èµ–é¡¹ï¼Œä¾‹å¦‚ï¼Œå¤šä¸ªä¾èµ–é¡¹å…±ç”¨ä¸€ä¸ªå­ä¾èµ–é¡¹ï¼ŒFastAPI åœ¨å¤„ç†åŒä¸€è¯·æ±‚æ—¶ï¼Œåªè°ƒç”¨ä¸€æ¬¡è¯¥å­ä¾èµ–é¡¹ã€‚ FastAPI ä¸ä¼šä¸ºåŒä¸€ä¸ªè¯·æ±‚å¤šæ¬¡è°ƒç”¨åŒä¸€ä¸ªä¾èµ–é¡¹ï¼Œè€Œæ˜¯æŠŠä¾èµ–é¡¹çš„è¿”å›å€¼è¿›è¡Œã€Œç¼“å­˜ã€ï¼Œå¹¶æŠŠå®ƒä¼ é€’ç»™åŒä¸€è¯·æ±‚ä¸­æ‰€æœ‰éœ€è¦ä½¿ç”¨è¯¥è¿”å›å€¼çš„ã€Œä¾èµ–é¡¹ã€ã€‚ åœ¨é«˜çº§ä½¿ç”¨åœºæ™¯ä¸­ï¼Œå¦‚æœä¸æƒ³ä½¿ç”¨ã€Œç¼“å­˜ã€å€¼ï¼Œè€Œæ˜¯ä¸ºéœ€è¦åœ¨åŒä¸€è¯·æ±‚çš„æ¯ä¸€æ­¥æ“ä½œï¼ˆå¤šæ¬¡ï¼‰ä¸­éƒ½å®é™…è°ƒç”¨ä¾èµ–é¡¹ï¼Œå¯ä»¥æŠŠ Depends çš„å‚æ•° use_cache çš„å€¼è®¾ç½®ä¸º False : async def needy_dependency(fresh_value: str = Depends(get_value, use_cache=False)): return fresh_value: fresh_value è·¯å¾„æ“ä½œè£…é¥°å™¨ä¾èµ–é¡¹æœ‰æ—¶ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦åœ¨è·¯å¾„æ“ä½œå‡½æ•°ä¸­ä½¿ç”¨ä¾èµ–é¡¹çš„è¿”å›å€¼ã€‚ æˆ–è€…è¯´ï¼Œæœ‰äº›ä¾èµ–é¡¹ä¸è¿”å›å€¼ã€‚ ä½†ä»è¦æ‰§è¡Œæˆ–è§£æè¯¥ä¾èµ–é¡¹ã€‚ å¯¹äºè¿™ç§æƒ…å†µï¼Œä¸å¿…åœ¨å£°æ˜è·¯å¾„æ“ä½œå‡½æ•°çš„å‚æ•°æ—¶ä½¿ç”¨ Dependsï¼Œè€Œæ˜¯å¯ä»¥åœ¨è·¯å¾„æ“ä½œè£…é¥°å™¨ä¸­æ·»åŠ ä¸€ä¸ªç”± dependencies ç»„æˆçš„ listã€‚ import uvicornfrom fastapi import FastAPI, Header, HTTPException, Dependsapp = FastAPI()async def verify_token(x_token: str = Header()): if x_token != fake-super-secret-token: raise HTTPException(status_code=400, detail=X-Token header invalid)async def verify_key(x_key: str = Header()): if x_key != fake-super-secret-key: raise HTTPException(status_code=400, detail=X-Key header invalid) return x_key@app.get(/items/, dependencies=[Depends(verify_token), Depends(verify_key)])async def read_items(): return [item: Foo, item: Bar]if __name__ == __main__: uvicorn.run(app) è·¯å¾„æ“ä½œè£…é¥°å™¨ä¾èµ–é¡¹ï¼ˆä»¥ä¸‹ç®€ç§°ä¸ºâ€œè·¯å¾„è£…é¥°å™¨ä¾èµ–é¡¹â€ï¼‰çš„æ‰§è¡Œæˆ–è§£ææ–¹å¼å’Œæ™®é€šä¾èµ–é¡¹ä¸€æ ·ï¼Œä½†å°±ç®—è¿™äº›ä¾èµ–é¡¹ä¼šè¿”å›å€¼ï¼Œå®ƒä»¬çš„å€¼ä¹Ÿä¸ä¼šä¼ é€’ç»™è·¯å¾„æ“ä½œå‡½æ•°ã€‚ å…¨å±€ä¾èµ–é¡¹æœ‰æ—¶ï¼Œæˆ‘ä»¬è¦ä¸ºæ•´ä¸ªåº”ç”¨æ·»åŠ ä¾èµ–é¡¹ã€‚ é€šè¿‡ä¸å®šä¹‰è·¯å¾„è£…é¥°å™¨ä¾èµ–é¡¹ ç±»ä¼¼çš„æ–¹å¼ï¼Œå¯ä»¥æŠŠä¾èµ–é¡¹æ·»åŠ è‡³æ•´ä¸ª FastAPI åº”ç”¨ã€‚ è¿™æ ·ä¸€æ¥ï¼Œå°±å¯ä»¥ä¸ºæ‰€æœ‰è·¯å¾„æ“ä½œåº”ç”¨è¯¥ä¾èµ–é¡¹ï¼š import uvicornfrom fastapi import Depends, FastAPI, Header, HTTPExceptionasync def verify_token(x_token: str = Header()): if x_token != fake-super-secret-token: raise HTTPException(status_code=400, detail=X-Token header invalid)async def verify_key(x_key: str = Header()): if x_key != fake-super-secret-key: raise HTTPException(status_code=400, detail=X-Key header invalid) return x_keyapp = FastAPI(dependencies=[Depends(verify_token), Depends(verify_key)])@app.get(/items/)async def read_items(): return [item: Portal Gun, item: Plumbus]@app.get(/users/)async def read_users(): return [username: Rick, username: Morty]if __name__ == __main__: uvicorn.run(app) å®‰å…¨æ€§ä¸­é—´ä»¶ä½ å¯ä»¥å‘ FastAPI åº”ç”¨æ·»åŠ ä¸­é—´ä»¶. â€œä¸­é—´ä»¶â€æ˜¯ä¸€ä¸ªå‡½æ•°,å®ƒåœ¨æ¯ä¸ªè¯·æ±‚è¢«ç‰¹å®šçš„è·¯å¾„æ“ä½œå¤„ç†ä¹‹å‰,ä»¥åŠåœ¨æ¯ä¸ªå“åº”è¿”å›ä¹‹å‰å·¥ä½œ. å®ƒæ¥æ”¶ä½ çš„åº”ç”¨ç¨‹åºçš„æ¯ä¸€ä¸ªè¯·æ±‚. ç„¶åå®ƒå¯ä»¥å¯¹è¿™ä¸ªè¯·æ±‚åšä¸€äº›äº‹æƒ…æˆ–è€…æ‰§è¡Œä»»ä½•éœ€è¦çš„ä»£ç . ç„¶åå®ƒå°†è¯·æ±‚ä¼ é€’ç»™åº”ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ† (é€šè¿‡æŸç§è·¯å¾„æ“ä½œ). ç„¶åå®ƒè·å–åº”ç”¨ç¨‹åºç”Ÿäº§çš„å“åº” (é€šè¿‡æŸç§è·¯å¾„æ“ä½œ). å®ƒå¯ä»¥å¯¹è¯¥å“åº”åšäº›ä»€ä¹ˆæˆ–è€…æ‰§è¡Œä»»ä½•éœ€è¦çš„ä»£ç . ç„¶åå®ƒè¿”å›è¿™ä¸ª å“åº”. åˆ›å»ºä¸­é—´ä»¶è¦åˆ›å»ºä¸­é—´ä»¶ä½ å¯ä»¥åœ¨å‡½æ•°çš„é¡¶éƒ¨ä½¿ç”¨è£…é¥°å™¨ @app.middleware(http). ä¸­é—´ä»¶å‚æ•°æ¥æ”¶å¦‚ä¸‹å‚æ•°: request. ä¸€ä¸ªå‡½æ•° call_next å®ƒå°†æ¥æ”¶ requestä½œä¸ºå‚æ•°. è¿™ä¸ªå‡½æ•°å°† request ä¼ é€’ç»™ç›¸åº”çš„ è·¯å¾„æ“ä½œ. ç„¶åå®ƒå°†è¿”å›ç”±ç›¸åº”çš„è·¯å¾„æ“ä½œç”Ÿæˆçš„ response. ç„¶åä½ å¯ä»¥åœ¨è¿”å› response å‰è¿›ä¸€æ­¥ä¿®æ”¹å®ƒ. import timefrom fastapi import FastAPI, Requestapp = FastAPI()@app.middleware(http)async def add_process_time_header(request: Request, call_next): start_time = time.perf_counter() response = await call_next(request) process_time = time.perf_counter() - start_time response.headers[X-Process-Time] = str(process_time) return response@app.get(/items/item_id)async def read_items(item_id: int): return item_id: item_id CORSCORSï¼ˆCross-Origin Resource Sharingï¼Œè·¨æºèµ„æºå…±äº«ï¼‰æ˜¯ä¸€ç§æµè§ˆå™¨å®‰å…¨æœºåˆ¶ï¼Œç”¨äºå…è®¸æˆ–é™åˆ¶ Web é¡µé¢ä»ä¸€ä¸ªæºï¼ˆoriginï¼‰è¯·æ±‚å¦ä¸€ä¸ªæºçš„èµ„æºã€‚æºç”±åè®®ï¼ˆprotocolï¼Œå¦‚ httphttpsï¼‰ã€åŸŸåï¼ˆdomainï¼‰å’Œç«¯å£ï¼ˆportï¼‰ç»„æˆï¼Œä¾‹å¦‚ https://example.com:443 æ˜¯ä¸€ä¸ªæºã€‚å¦‚æœä¸¤ä¸ªæºä¸åŒï¼Œå³ä¸ºè·¨æºï¼ˆcross-originï¼‰è¯·æ±‚ã€‚ CORS ä¸»è¦è§£å†³æµè§ˆå™¨ä¸­çš„â€œåŒæºç­–ç•¥â€ï¼ˆSame-Origin Policyï¼ŒSOPï¼‰é—®é¢˜ã€‚åŒæºç­–ç•¥æ˜¯æµè§ˆå™¨é»˜è®¤çš„å®‰å…¨é™åˆ¶ï¼Œé˜²æ­¢è„šæœ¬ä»ä¸€ä¸ªæºè®¿é—®å¦ä¸€ä¸ªæºçš„èµ„æºï¼Œä»¥é¿å…æ¶æ„æ”»å‡»å¦‚ XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰æˆ– CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰ã€‚ç„¶è€Œï¼Œåœ¨ç°ä»£ Web å¼€å‘ä¸­ï¼Œè·¨åŸŸè¯·æ±‚å¾ˆå¸¸è§ï¼ˆå¦‚å‰ç«¯è°ƒç”¨åç«¯ APIï¼‰ï¼ŒCORS æä¾›äº†ä¸€ç§æ ‡å‡†æ–¹å¼æ¥æ”¾æ¾è¿™ä¸€é™åˆ¶ï¼Œç”±æœåŠ¡å™¨å†³å®šæ˜¯å¦å…è®¸è·¨æºè®¿é—®ã€‚ å…³é”®æœ¯è¯­ï¼š ç®€å•è¯·æ±‚ï¼šä¸è§¦å‘é¢„æ£€çš„è¯·æ±‚ï¼Œå¦‚ GETã€HEADã€POSTï¼ˆç‰¹å®š Content-Typeï¼‰ã€‚ å¤æ‚è¯·æ±‚ï¼šéœ€è¦é¢„æ£€çš„è¯·æ±‚ï¼Œå¦‚ PUTã€DELETE æˆ–è‡ªå®šä¹‰å¤´éƒ¨ã€‚ é¢„æ£€è¯·æ±‚ï¼šæµè§ˆå™¨åœ¨å®é™…è¯·æ±‚å‰å‘é€ OPTIONS æ–¹æ³•çš„è¯·æ±‚ï¼Œè¯¢é—®æœåŠ¡å™¨æ˜¯å¦å…è®¸ã€‚ å‡­è¯ï¼šåŒ…æ‹¬ Cookiesã€HTTP è®¤è¯ç­‰ï¼ŒCORS æ”¯æŒ withCredentials æ—¶éœ€ç‰¹æ®Šå¤„ç†ã€‚ CORS äº 2009 å¹´ç”± W3C æå‡ºï¼Œå¹¶åœ¨ç°ä»£æµè§ˆå™¨ï¼ˆå¦‚ Chromeã€Firefoxã€Safariï¼‰ä¸­å¹¿æ³›æ”¯æŒã€‚å®ƒä¸æ˜¯æœåŠ¡å™¨ç«¯å¼ºåˆ¶ï¼Œè€Œæ˜¯æµè§ˆå™¨ç«¯æ‰§è¡Œçš„æœºåˆ¶ã€‚ CORS çš„åŸç†CORS çš„æ ¸å¿ƒæ˜¯é€šè¿‡ HTTP å¤´éƒ¨åœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰å’ŒæœåŠ¡å™¨ä¹‹é—´åå•†è®¿é—®æƒé™ã€‚æµè§ˆå™¨è‡ªåŠ¨å¤„ç† CORS é€»è¾‘ï¼ŒæœåŠ¡å™¨é€šè¿‡å“åº”å¤´éƒ¨æŒ‡ç¤ºå…è®¸çš„æºã€æ–¹æ³•ç­‰ã€‚ å·¥ä½œæµç¨‹ æ­¥éª¤ 1ï¼šæµè§ˆå™¨å‘èµ·è¯·æ±‚ å½“ JavaScriptï¼ˆå¦‚ XMLHttpRequest æˆ– Fetch APIï¼‰ä»ä¸€ä¸ªæºè¯·æ±‚å¦ä¸€ä¸ªæºçš„èµ„æºæ—¶ï¼Œæµè§ˆå™¨æ£€æŸ¥æ˜¯å¦è·¨æºã€‚å¦‚æœæ˜¯ï¼Œæµè§ˆå™¨ä¼šæ ¹æ®è¯·æ±‚ç±»å‹å†³å®šæ˜¯å¦å‘é€é¢„æ£€è¯·æ±‚ã€‚ æ­¥éª¤ 2ï¼šé¢„æ£€è¯·æ±‚ï¼ˆå¦‚æœé€‚ç”¨ï¼‰ å¯¹äºå¤æ‚è¯·æ±‚ï¼Œæµè§ˆå™¨å…ˆå‘é€ä¸€ä¸ª OPTIONS è¯·æ±‚ï¼ˆé¢„æ£€ï¼‰ï¼ŒåŒ…å«ï¼š Originï¼šè¯·æ±‚æºï¼ˆå¦‚ https://client.comï¼‰ã€‚ Access-Control-Request-Methodï¼šå®é™…è¯·æ±‚çš„æ–¹æ³•ï¼ˆå¦‚ POSTï¼‰ã€‚ Access-Control-Request-Headersï¼šå®é™…è¯·æ±‚çš„è‡ªå®šä¹‰å¤´éƒ¨ï¼ˆå¦‚ X-Custom-Headerï¼‰ã€‚ æœåŠ¡å™¨å“åº”é¢„æ£€ï¼ŒæŒ‡ç¤ºæ˜¯å¦å…è®¸ï¼š å¦‚æœå…è®¸ï¼Œæµè§ˆå™¨ç»§ç»­å®é™…è¯·æ±‚ã€‚ å¦‚æœä¸å…è®¸ï¼Œæµè§ˆå™¨æŠ›å‡º CORS é”™è¯¯ï¼ˆå¦‚ â€œNo â€˜Access-Control-Allow-Originâ€™ header is presentâ€ï¼‰ã€‚ æ­¥éª¤ 3ï¼šå®é™…è¯·æ±‚ æµè§ˆå™¨å‘é€å®é™…è¯·æ±‚ï¼ŒæœåŠ¡å™¨åœ¨å“åº”ä¸­æ·»åŠ  CORS å¤´éƒ¨ã€‚æµè§ˆå™¨æ£€æŸ¥è¿™äº›å¤´éƒ¨ï¼Œå¦‚æœåŒ¹é…ï¼Œåˆ™å…è®¸è„šæœ¬è®¿é—®å“åº”æ•°æ®ï¼›å¦åˆ™ï¼Œé˜»å¡è®¿é—®ã€‚ å…³é”® HTTP å¤´éƒ¨ä½¿ç”¨è¡¨æ ¼åˆ—å‡ºå¸¸ç”¨å¤´éƒ¨ï¼š å¤´éƒ¨åç§° ç±»å‹ æè¿° ç¤ºä¾‹å€¼ Origin è¯·æ±‚å¤´éƒ¨ æµè§ˆå™¨è‡ªåŠ¨æ·»åŠ ï¼Œè¡¨ç¤ºè¯·æ±‚æºã€‚ https://client.com Access-Control-Allow-Origin å“åº”å¤´éƒ¨ æŒ‡å®šå…è®¸çš„æºã€‚* è¡¨ç¤ºæ‰€æœ‰æºï¼ˆä¸å®‰å…¨ï¼Œä¸æ”¯æŒå‡­è¯ï¼‰ã€‚ https://client.com æˆ– * Access-Control-Allow-Methods å“åº”å¤´éƒ¨ æŒ‡å®šå…è®¸çš„ HTTP æ–¹æ³•ã€‚ GET, POST, OPTIONS Access-Control-Allow-Headers å“åº”å¤´éƒ¨ æŒ‡å®šå…è®¸çš„è‡ªå®šä¹‰è¯·æ±‚å¤´éƒ¨ã€‚ Content-Type, Authorization Access-Control-Allow-Credentials å“åº”å¤´éƒ¨ æ˜¯å¦å…è®¸å‘é€å‡­è¯ï¼ˆå¦‚ Cookiesï¼‰ã€‚å€¼ä¸º true æ—¶æœ‰æ•ˆã€‚ true Access-Control-Expose-Headers å“åº”å¤´éƒ¨ æŒ‡å®šæµè§ˆå™¨å¯è®¿é—®çš„å“åº”å¤´éƒ¨ï¼ˆé»˜è®¤åªæš´éœ²ç®€å•å¤´éƒ¨å¦‚ Cache-Controlï¼‰ã€‚ X-Custom-Response Access-Control-Max-Age å“åº”å¤´éƒ¨ é¢„æ£€ç»“æœç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œå‡å°‘é‡å¤é¢„æ£€ã€‚ 86400 (24 å°æ—¶) Access-Control-Request-Method è¯·æ±‚å¤´éƒ¨ é¢„æ£€æ—¶è¡¨ç¤ºå®é™…æ–¹æ³•ï¼ˆæµè§ˆå™¨è‡ªåŠ¨æ·»åŠ ï¼‰ã€‚ POST Access-Control-Request-Headers è¯·æ±‚å¤´éƒ¨ é¢„æ£€æ—¶è¡¨ç¤ºå®é™…è‡ªå®šä¹‰å¤´éƒ¨ï¼ˆæµè§ˆå™¨è‡ªåŠ¨æ·»åŠ ï¼‰ã€‚ X-API-Key ç®€å•è¯·æ±‚ vs å¤æ‚è¯·æ±‚ï¼š ç®€å•è¯·æ±‚ï¼šä¸éœ€é¢„æ£€ã€‚æ¡ä»¶ï¼šæ–¹æ³•ä¸º GETHEADPOSTï¼›Content-Type ä¸º textplainã€multipartform-data æˆ– applicationx-www-form-urlencodedï¼›æ— è‡ªå®šä¹‰å¤´éƒ¨ã€‚ å¤æ‚è¯·æ±‚ï¼šéœ€é¢„æ£€ã€‚å…¶ä»–æƒ…å†µï¼Œå¦‚ DELETE æ–¹æ³•æˆ–æ·»åŠ  Authorization å¤´éƒ¨ã€‚ å®‰å…¨è€ƒè™‘ CORS ä¾èµ–æœåŠ¡å™¨ä¿¡ä»»å®¢æˆ·ç«¯æºï¼Œä½†æµè§ˆå™¨å¼ºåˆ¶æ‰§è¡Œã€‚ é£é™©ï¼šå¦‚æœæœåŠ¡å™¨å…è®¸ *ï¼Œå¯èƒ½æš´éœ²æ•æ„Ÿæ•°æ®ã€‚æ¨èæŒ‡å®šç¡®åˆ‡æºã€‚ ä¸å…¶ä»–æœºåˆ¶ç»“åˆï¼šå¦‚ CSPï¼ˆContent Security Policyï¼‰è¿›ä¸€æ­¥é™åˆ¶ã€‚ æµè§ˆå™¨å®ç°ï¼šä¸åŒæµè§ˆå™¨ç•¥æœ‰å·®å¼‚ï¼Œä½†éµå¾ª W3C æ ‡å‡†ã€‚æ—§æµè§ˆå™¨ï¼ˆå¦‚ IE9ï¼‰æ”¯æŒæœ‰é™ã€‚ å†…éƒ¨å®ç°ç»†èŠ‚ æµè§ˆå™¨ä½¿ç”¨ Fetch API æˆ– XHR æ—¶ï¼Œè‡ªåŠ¨å¤„ç† Origin å’Œ CORS æ£€æŸ¥ã€‚ æœåŠ¡å™¨ç«¯ï¼šéœ€é…ç½®ï¼ˆå¦‚ Nginx çš„ add_headerã€Apache çš„ Header setï¼‰æˆ–æ¡†æ¶ï¼ˆå¦‚ Express çš„ cors ä¸­é—´ä»¶ï¼‰æ¥æ·»åŠ å“åº”å¤´éƒ¨ã€‚ é”™è¯¯è°ƒè¯•ï¼šæ§åˆ¶å°æ˜¾ç¤º CORS é”™è¯¯ï¼Œå¸¸è§åŸå› æ˜¯å“åº”ç¼ºå°‘ Allow-Origin æˆ–æ–¹æ³•ä¸åŒ¹é…ã€‚ CORSMiddlewareä½ å¯ä»¥åœ¨ FastAPI åº”ç”¨ä¸­ä½¿ç”¨ CORSMiddleware æ¥é…ç½®å®ƒã€‚ å¯¼å…¥ CORSMiddlewareã€‚ åˆ›å»ºä¸€ä¸ªå…è®¸çš„æºåˆ—è¡¨ï¼ˆç”±å­—ç¬¦ä¸²ç»„æˆï¼‰ã€‚ å°†å…¶ä½œä¸ºã€Œä¸­é—´ä»¶ã€æ·»åŠ åˆ°ä½ çš„ FastAPI åº”ç”¨ä¸­ã€‚ ä½ ä¹Ÿå¯ä»¥æŒ‡å®šåç«¯æ˜¯å¦å…è®¸ï¼š å‡­è¯ï¼ˆæˆæƒ headersï¼ŒCookies ç­‰ï¼‰ã€‚ ç‰¹å®šçš„ HTTP æ–¹æ³•ï¼ˆPOSTï¼ŒPUTï¼‰æˆ–è€…ä½¿ç”¨é€šé…ç¬¦ * å…è®¸æ‰€æœ‰æ–¹æ³•ã€‚ ç‰¹å®šçš„ HTTP headers æˆ–è€…ä½¿ç”¨é€šé…ç¬¦ * å…è®¸æ‰€æœ‰ headersã€‚ from fastapi import FastAPIapp = FastAPI()origins = [ http://localhost.example.com, https://localhost.example.com, http://localhost, http://localhost:8080,]@app.get(/items/item_id)async def read_item(item_id: int, q: str): return item_id: item_id, q: q é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ª CORSMiddleware å®ç°æ‰€ä½¿ç”¨çš„é»˜è®¤å‚æ•°è¾ƒä¸ºä¿å®ˆï¼Œæ‰€ä»¥ä½ éœ€è¦æ˜¾å¼åœ°å¯ç”¨ç‰¹å®šçš„æºã€æ–¹æ³•æˆ–è€… headersï¼Œä»¥ä¾¿æµè§ˆå™¨èƒ½å¤Ÿåœ¨è·¨åŸŸä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨å®ƒä»¬ã€‚ æ”¯æŒä»¥ä¸‹å‚æ•°ï¼š allow_origins - ä¸€ä¸ªå…è®¸è·¨åŸŸè¯·æ±‚çš„æºåˆ—è¡¨ã€‚ä¾‹å¦‚ [https://example.org, https://www.example.org]ã€‚ä½ å¯ä»¥ä½¿ç”¨ [*] å…è®¸ä»»ä½•æºã€‚ allow_origin_regex - ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²ï¼ŒåŒ¹é…çš„æºå…è®¸è·¨åŸŸè¯·æ±‚ã€‚ä¾‹å¦‚ https://.*\\.example\\.orgã€‚ allow_methods - ä¸€ä¸ªå…è®¸è·¨åŸŸè¯·æ±‚çš„ HTTP æ–¹æ³•åˆ—è¡¨ã€‚é»˜è®¤ä¸º [GET]ã€‚ä½ å¯ä»¥ä½¿ç”¨ [*] æ¥å…è®¸æ‰€æœ‰æ ‡å‡†æ–¹æ³•ã€‚ allow_headers - ä¸€ä¸ªå…è®¸è·¨åŸŸè¯·æ±‚çš„ HTTP è¯·æ±‚å¤´åˆ—è¡¨ã€‚é»˜è®¤ä¸º []ã€‚ä½ å¯ä»¥ä½¿ç”¨ [*] å…è®¸æ‰€æœ‰çš„è¯·æ±‚å¤´ã€‚Acceptã€Accept-Languageã€Content-Language ä»¥åŠ Content-Type è¯·æ±‚å¤´æ€»æ˜¯å…è®¸ CORS è¯·æ±‚ã€‚ allow_credentials - æŒ‡ç¤ºè·¨åŸŸè¯·æ±‚æ”¯æŒ cookiesã€‚é»˜è®¤æ˜¯ Falseã€‚å¦å¤–ï¼Œå…è®¸å‡­è¯æ—¶ allow_origins ä¸èƒ½è®¾å®šä¸º [*]ï¼Œå¿…é¡»æŒ‡å®šæºã€‚ expose_headers - æŒ‡ç¤ºå¯ä»¥è¢«æµè§ˆå™¨è®¿é—®çš„å“åº”å¤´ã€‚é»˜è®¤ä¸º []ã€‚ max_age - è®¾å®šæµè§ˆå™¨ç¼“å­˜ CORS å“åº”çš„æœ€é•¿æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ã€‚é»˜è®¤ä¸º 600ã€‚ ä¸­é—´ä»¶å“åº”ä¸¤ç§ç‰¹å®šç±»å‹çš„ HTTP è¯·æ±‚â€¦â€¦ æµ‹è¯•åŸºç¡€å¯¼å…¥ TestClient. é€šè¿‡ä¼ å…¥ä½ çš„FastAPIåº”ç”¨åˆ›å»ºä¸€ä¸ª TestClient ã€‚ åˆ›å»ºåå­—ä»¥ test_ å¼€å¤´çš„å‡½æ•°ï¼ˆè¿™æ˜¯æ ‡å‡†çš„ pytest çº¦å®šï¼‰ã€‚ åƒä½¿ç”¨ httpx é‚£æ ·ä½¿ç”¨ TestClient å¯¹è±¡ã€‚ ä¸ºä½ éœ€è¦æ£€æŸ¥çš„åœ°æ–¹ç”¨æ ‡å‡†çš„Pythonè¡¨è¾¾å¼å†™ä¸ªç®€å•çš„ assert è¯­å¥ï¼ˆé‡ç”³ï¼Œæ ‡å‡†çš„pytestï¼‰ã€‚ main.py from fastapi import FastAPIfrom fastapi.testclient import TestClientapp = FastAPI()@app.get(/)async def read_main(): return message: Hello Worldclient = TestClient(app)def test_read_main(): response = client.get(/) assert response.status_code == 200 assert response.json() == message: Hello World uv pip install pytest åˆ†ç¦»æµ‹è¯• main.py from fastapi import FastAPIapp = FastAPI()@app.get(/)async def read_main(): return message: Hello World test_main.py from fastapi.testclient import TestClientfrom .main import appclient = TestClient(app)def test_read_main(): response = client.get(/) assert response.status_code == 200 assert response.json() == message: Hello World","tags":["Webæ¡†æ¶"]},{"title":"Docker","path":"/2025/04/08/Docker/","content":"Docker ç®€ä»‹ â€Œä»€ä¹ˆæ˜¯ Dockerï¼Ÿ Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œè€Œä¸€ä¸ªå®¹å™¨ containers å…¶å®æ˜¯ä¸€ä¸ªè™šæ‹ŸåŒ–çš„ç‹¬ç«‹çš„ç¯å¢ƒï¼Œè®©å¼€å‘è€…å¯ä»¥æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªå¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚å®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œç›¸äº’ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•æ¥å£ã€‚ â€ŒDocker çš„åº”ç”¨åœºæ™¯ å¼€å‘ç¯å¢ƒæ ‡å‡†åŒ– æŒç»­é›†æˆæŒç»­éƒ¨ç½²ï¼ˆCICDï¼‰ å¾®æœåŠ¡æ¶æ„ å¿«é€Ÿæ‰©å±•ä¸å¼¹æ€§ä¼¸ç¼© Docker æ ¸å¿ƒæ¦‚å¿µ â€Œé•œåƒï¼ˆImageï¼‰â€Œ åªè¯»æ¨¡æ¿ï¼ŒåŒ…å«åº”ç”¨å’Œè¿è¡Œç¯å¢ƒ åˆ†å±‚å­˜å‚¨ç»“æ„ â€Œå®¹å™¨ï¼ˆContainerï¼‰ é•œåƒçš„è¿è¡Œå®ä¾‹ å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç† â€Œä»“åº“ï¼ˆRegistryï¼‰ Docker Hub å…¬å…±ä»“åº“ ç§æœ‰ä»“åº“æ­å»ºï¼ˆå¦‚ Harborï¼‰ â€ŒDocker å¼•æ“ï¼ˆDocker Engineï¼‰ å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ ç»„ä»¶ï¼šDocker Daemonã€CLIã€REST API Docker å®‰è£…ä¸é…ç½®Docker ä» 1.13 ç‰ˆæœ¬ä¹‹åé‡‡ç”¨æ—¶é—´çº¿çš„æ–¹å¼ä½œä¸ºç‰ˆæœ¬å·ï¼Œåˆ†ä¸ºç¤¾åŒºç‰ˆ CE å’Œä¼ä¸šç‰ˆ EEï¼Œç¤¾åŒºç‰ˆæ˜¯å…è´¹æä¾›ç»™ä¸ªäººå¼€å‘è€…å’Œå°å‹å›¢ä½“ä½¿ç”¨çš„ï¼Œä¼ä¸šç‰ˆä¼šæä¾›é¢å¤–çš„æ”¶è´¹æœåŠ¡ï¼Œæ¯”å¦‚ç»è¿‡å®˜æ–¹æµ‹è¯•è®¤è¯è¿‡çš„åŸºç¡€è®¾æ–½ã€å®¹å™¨ã€æ’ä»¶ç­‰ã€‚ CentOS 7ï¼ˆä½¿ç”¨ yum è¿›è¡Œå®‰è£…ï¼‰ # step 1: å®‰è£…å¿…è¦çš„ä¸€äº›ç³»ç»Ÿå·¥å…·sudo yum install -y yum-utils device-mapper-persistent-data lvm2## è¿™æ­¥å¦‚æœæ‹‰å–è¶…æ—¶å¯ä»¥æ·»åŠ yumæº# docker å®˜æ–¹æº#sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo# é˜¿é‡Œäº‘æº#sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo# Step 2: æ·»åŠ è½¯ä»¶æºä¿¡æ¯sudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo# PS:å¦‚æœå‡ºç°å¦‚ä¸‹é”™è¯¯ä¿¡æ¯Loaded plugins: fastestmirroradding repo from: https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repograbbing file https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo to /etc/yum.repos.d/docker-ce.repoCould not fetch/save url https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo to file /etc/yum.repos.d/docker-ce.repo: [Errno 14] curl#60 - Peers Certificate issuer is not recognized.# ç¼–è¾‘ /etc/yum.conf æ–‡ä»¶, åœ¨ [main] ä¸‹é¢æ·»åŠ  sslverify=0 å‚æ•°vi /etc/yum.conf# é…ç½®å¦‚ä¸‹----------------------[main]sslverify=0# -----------------------------# Step 3: æ›´æ–°å¹¶å®‰è£…Docker-CEsudo yum makecache fastsudo yum -y install docker-ce# Step 4: å¼€å¯DockeræœåŠ¡sudo service docker start# Step 5: è®¾ç½®å¼€æœºå¯åŠ¨systemctl start dockersystemctl enable docker# Step 6ï¼šè¿è¡Œ hello-world é•œåƒï¼ŒéªŒè¯æ˜¯å¦æ­£ç¡®å®‰è£…äº† dockerã€‚docker run hello-world# æ³¨æ„ï¼š# å®˜æ–¹è½¯ä»¶æºé»˜è®¤å¯ç”¨äº†æœ€æ–°çš„è½¯ä»¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡ç¼–è¾‘è½¯ä»¶æºçš„æ–¹å¼è·å–å„ä¸ªç‰ˆæœ¬çš„è½¯ä»¶åŒ…ã€‚ä¾‹å¦‚å®˜æ–¹å¹¶æ²¡æœ‰å°†æµ‹è¯•ç‰ˆæœ¬çš„è½¯ä»¶æºç½®ä¸ºå¯ç”¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¼€å¯ã€‚åŒç†å¯ä»¥å¼€å¯å„ç§æµ‹è¯•ç‰ˆæœ¬ç­‰ã€‚# vim /etc/yum.repos.d/docker-ee.repo# å°†[docker-ce-test]ä¸‹æ–¹çš„enabled=0ä¿®æ”¹ä¸ºenabled=1## å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„Docker-CE:# Step 1: æŸ¥æ‰¾Docker-CEçš„ç‰ˆæœ¬:# yum list docker-ce.x86_64 --showduplicates | sort -r# Loading mirror speeds from cached hostfile# Loaded plugins: branch, fastestmirror, langpacks# docker-ce.x86_64 17.03.1.ce-1.el7.centos docker-ce-stable# docker-ce.x86_64 17.03.1.ce-1.el7.centos @docker-ce-stable# docker-ce.x86_64 17.03.0.ce-1.el7.centos docker-ce-stable# Available Packages# Step2: å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„Docker-CE: (VERSIONä¾‹å¦‚ä¸Šé¢çš„17.03.0.ce.1-1.el7.centos)# sudo yum -y install docker-ce-[VERSION] å‘½ä»¤ä»‹ç»åŸºç¡€å‘½ä»¤$ docker --helpç®¡ç†å‘½ä»¤: container ç®¡ç†å®¹å™¨ image ç®¡ç†é•œåƒ network ç®¡ç†ç½‘ç»œå‘½ä»¤ï¼š attach ä»‹å…¥åˆ°ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨ build æ ¹æ® Dockerfile æ„å»ºä¸€ä¸ªé•œåƒ commit æ ¹æ®å®¹å™¨çš„æ›´æ”¹åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒ cp åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸å®¹å™¨ä¸­å¤åˆ¶ æ–‡ä»¶/æ–‡ä»¶å¤¹ create åˆ›å»ºä¸€ä¸ªæ–°å®¹å™¨ exec åœ¨å®¹å™¨ä¸­æ‰§è¡Œä¸€æ¡å‘½ä»¤ images åˆ—å‡ºé•œåƒ kill æ€æ­»ä¸€ä¸ªæˆ–å¤šä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨ logs å–å¾—å®¹å™¨çš„æ—¥å¿— pause æš‚åœä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨çš„æ‰€æœ‰è¿›ç¨‹ ps åˆ—å‡ºæ‰€æœ‰å®¹å™¨ pull æ‹‰å–ä¸€ä¸ªé•œåƒæˆ–ä»“åº“åˆ° registry push æ¨é€ä¸€ä¸ªé•œåƒæˆ–ä»“åº“åˆ° registry rename é‡å‘½åä¸€ä¸ªå®¹å™¨ restart é‡æ–°å¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ rm åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ rmi åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒ run åœ¨ä¸€ä¸ªæ–°çš„å®¹å™¨ä¸­æ‰§è¡Œä¸€æ¡å‘½ä»¤ search åœ¨ Docker Hub ä¸­æœç´¢é•œåƒ start å¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªå·²ç»åœæ­¢è¿è¡Œçš„å®¹å™¨ stats æ˜¾ç¤ºä¸€ä¸ªå®¹å™¨çš„å®æ—¶èµ„æºå ç”¨ stop åœæ­¢ä¸€ä¸ªæˆ–å¤šä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨ tag ä¸ºé•œåƒåˆ›å»ºä¸€ä¸ªæ–°çš„æ ‡ç­¾ top æ˜¾ç¤ºä¸€ä¸ªå®¹å™¨å†…çš„æ‰€æœ‰è¿›ç¨‹ unpause æ¢å¤ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨å†…æ‰€æœ‰è¢«æš‚åœçš„è¿›ç¨‹ æœåŠ¡ç®¡ç†service docker start # å¯åŠ¨ docker æœåŠ¡ï¼Œå®ˆæŠ¤è¿›ç¨‹service docker stop # åœæ­¢ docker æœåŠ¡service docker status # æŸ¥çœ‹ docker æœåŠ¡çŠ¶æ€ Docker åŸºç¡€æ“ä½œ â€Œé•œåƒæ“ä½œâ€Œ æ‹‰å–é•œåƒï¼šdocker pull image æŸ¥çœ‹é•œåƒï¼šdocker images åˆ é™¤é•œåƒï¼šdocker rmi image â€Œå®¹å™¨æ“ä½œ å¯åŠ¨å®¹å™¨ï¼š docker run [options] image å¸¸ç”¨å‚æ•°ï¼š-dï¼ˆåå°è¿è¡Œï¼‰ã€-pï¼ˆç«¯å£æ˜ å°„ï¼‰ã€-vï¼ˆæ•°æ®å·ï¼‰ æŸ¥çœ‹å®¹å™¨ï¼šdocker ps -a è¿›å…¥å®¹å™¨ï¼šdocker exec -it container /bin/bash åœæ­¢åˆ é™¤å®¹å™¨ï¼šdocker stop/rm container â€Œæ—¥å¿—ä¸çŠ¶æ€ docker logs container docker stats Dockerfile ä¸é•œåƒæ„å»º â€Œ Dockerfile è¯­æ³• â€Œ åŸºç¡€æŒ‡ä»¤ï¼šFROMã€RUNã€COPYã€CMDã€ENTRYPOINT ä¼˜åŒ–æŒ‡ä»¤ï¼šWORKDIRã€EXPOSEã€ENV â€Œ æ„å»ºè‡ªå®šä¹‰é•œåƒ â€Œ docker build -t image-name . â€Œ é•œåƒä¼˜åŒ–å®è·µ â€Œ å‡å°‘å±‚æ•°ï¼ˆåˆå¹¶ RUN æŒ‡ä»¤ï¼‰ ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºï¼ˆMulti-stage Buildsï¼‰ é€‰æ‹©è½»é‡åŸºç¡€é•œåƒï¼ˆå¦‚ Alpineï¼‰ æ•°æ®ç®¡ç†ä¸æŒä¹…åŒ– â€Œ æ•°æ®å·ï¼ˆVolumesï¼‰ â€Œ åˆ›å»ºæ•°æ®å·ï¼šdocker volume create volume-name æŒ‚è½½æ•°æ®å·ï¼š-v volume-name:container-path â€Œ ç»‘å®šæŒ‚è½½ï¼ˆBind Mountsï¼‰ â€Œ æœ¬åœ°ç›®å½•ä¸å®¹å™¨ç›®å½•æ˜ å°„ â€Œ æ•°æ®å·å®¹å™¨ â€Œ é€šè¿‡å®¹å™¨å…±äº«æ•°æ® Docker ç½‘ç»œ â€Œ ç½‘ç»œæ¨¡å¼ â€Œ bridgeï¼ˆé»˜è®¤æ¡¥æ¥ç½‘ç»œï¼‰ hostï¼ˆå…±äº«ä¸»æœºç½‘ç»œï¼‰ noneï¼ˆæ— ç½‘ç»œï¼‰ è‡ªå®šä¹‰ç½‘ç»œ â€Œ å®¹å™¨é—´é€šä¿¡ â€Œ é€šè¿‡å®¹å™¨åç§°æˆ– IP åœ°å€è¿æ¥ â€Œ ç«¯å£æ˜ å°„ â€Œ -p host-port:container-port Docker Compose â€Œ YAML æ–‡ä»¶ç»“æ„ â€Œ versionã€servicesã€volumesã€networks â€Œ å¸¸ç”¨å‘½ä»¤ â€Œ docker-compose up -d docker-compose down â€Œ åº”ç”¨æ¡ˆä¾‹ â€Œ éƒ¨ç½²å¤šå®¹å™¨åº”ç”¨ï¼ˆå¦‚ Web + DBï¼‰ ç¯å¢ƒå˜é‡é…ç½®ï¼ˆ.env æ–‡ä»¶ï¼‰ æœ€ä½³å®è·µä¸å¸¸è§é—®é¢˜ â€Œ æœ€ä½³å®è·µ â€Œ é¿å…ä»¥ root ç”¨æˆ·è¿è¡Œå®¹å™¨ å®šæœŸæ¸…ç†æ— ç”¨é•œåƒå’Œå®¹å™¨ â€Œ å¸¸è§é—®é¢˜ â€Œ å®¹å™¨å¯åŠ¨å¤±è´¥æ’æŸ¥ï¼ˆæ—¥å¿—ã€ç«¯å£å†²çªï¼‰ ç½‘ç»œè¿æ¥é—®é¢˜ æ•°æ®å·æƒé™é—®é¢˜ å®æˆ˜æ¡ˆä¾‹ â€Œ éƒ¨ç½²ä¸€ä¸ª Web åº”ç”¨ â€Œ ä½¿ç”¨ Nginx + Node.js + MySQL â€Œ æ­å»ºå¾®æœåŠ¡ç¯å¢ƒ â€Œ å¤šä¸ªå®¹å™¨é€šè¿‡ Docker Compose ç¼–æ’ â€Œ é›†æˆ CICD æµç¨‹ â€Œ ç»“åˆ GitLab CI æˆ– GitHub Actions å­¦ä¹ èµ„æº å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.docker.com/ æ¨èä¹¦ç±ï¼šã€ŠDocker å®æˆ˜ã€‹ã€ŠKubernetes æƒå¨æŒ‡å—ã€‹ ç¤¾åŒºè®ºå›ï¼šStack Overflowã€Docker å®˜æ–¹è®ºå›","tags":["Docker"]},{"title":"åŒºå—é“¾","path":"/2025/03/28/åŒºå—é“¾/","content":"æ¯”ç‰¹å¸å¯†ç å­¦ä¸­ Hash å‡½æ•°æ€§è´¨æœ¬è´¨å±æ€§â€Œ â€Œå›ºå®šè¾“å‡ºé•¿åº¦â€Œæ— è®ºè¾“å…¥æ•°æ®å¤§å°ï¼Œå“ˆå¸Œå‡½æ•°å§‹ç»ˆç”Ÿæˆå›ºå®šé•¿åº¦çš„æ‘˜è¦ï¼ˆå¦‚ SHA-256 è¾“å‡º 256 ä½ï¼‰ã€‚ â€Œç¡®å®šæ€§â€Œç›¸åŒè¾“å…¥å¿…å®šäº§ç”Ÿç›¸åŒå“ˆå¸Œå€¼ã€‚ â€Œé«˜æ•ˆæ€§â€Œå¯å¿«é€Ÿè®¡ç®—ä»»æ„è¾“å…¥çš„å“ˆå¸Œå€¼ï¼Œæ»¡è¶³å®æ—¶åº”ç”¨éœ€æ±‚ã€‚ å®‰å…¨ç‰¹æ€§â€Œ â€Œå•å‘æ€§ï¼ˆæŠ—åŸåƒæ”»å‡»ï¼‰â€Œç»™å®šå“ˆå¸Œå€¼ hï¼Œæ— æ³•é€šè¿‡è®¡ç®—æ¨å¯¼å‡ºåŸå§‹è¾“å…¥ Mï¼ˆæ•°å­¦ä¸å¯é€†ï¼‰ã€‚ â€Œå¼±æŠ—ç¢°æ’æ€§ï¼ˆæŠ—ç¬¬äºŒåŸåƒæ”»å‡»ï¼‰â€Œç»™å®š M1 å’Œ H(M1)ï¼Œéš¾ä»¥æ‰¾åˆ°å¦ä¸€æ¶ˆæ¯ M2â‰ M1 ä½¿å¾— H(M1)H(M2)ã€‚ â€Œå¼ºæŠ—ç¢°æ’æ€§â€Œéš¾ä»¥æ‰¾åˆ°ä»»æ„ä¸¤ä¸ªä¸åŒæ¶ˆæ¯ M1â‰ M2 æ»¡è¶³ H(M1)H(M2)ã€‚ â€Œé›ªå´©æ•ˆåº”â€Œè¾“å…¥æ•°æ®çš„å¾®å°æ”¹åŠ¨ï¼ˆå¦‚ 1 æ¯”ç‰¹å˜åŒ–ï¼‰ä¼šå¯¼è‡´è¾“å‡ºå“ˆå¸Œå€¼æ˜¾è‘—å˜åŒ–ï¼ˆå¹³å‡ 50% æ¯”ç‰¹ç¿»è½¬ï¼‰ã€‚ å¯†ç å­¦ä¸­çš„æ•°å­—ç­¾åæœºåˆ¶è§£æä¸€ã€æ ¸å¿ƒåŸç† éå¯¹ç§°åŠ å¯†ä½“ç³» åŸºäºå…¬é’¥å¯†ç å­¦ï¼Œæ¯ä¸ªç”¨æˆ·æ‹¥æœ‰ç§é’¥ï¼ˆä¿å¯†ï¼‰å’Œå…¬é’¥ï¼ˆå…¬å¼€ï¼‰çš„å¯†é’¥å¯¹ã€‚ ç§é’¥ç”¨äºç”Ÿæˆç­¾åï¼Œå…¬é’¥ç”¨äºéªŒè¯ç­¾åå¯ä¿¡æ€§ã€‚ ç­¾åç”Ÿæˆæµç¨‹ ä¿¡æ¯å“ˆå¸ŒåŒ–ï¼šå¯¹å¾…ç­¾åæ•°æ®è®¡ç®—å“ˆå¸Œå€¼ï¼ˆå¦‚SHA-256ï¼‰ã€‚ ç§é’¥åŠ å¯†ï¼šç”¨ç§é’¥åŠ å¯†å“ˆå¸Œå€¼ç”Ÿæˆæ•°å­—ç­¾åï¼ˆåŒ…å«r,så‚æ•°ï¼‰ã€‚ ç»‘å®šä¼ è¾“ï¼šå°†åŸå§‹æ•°æ®ä¸ç­¾åå…±åŒå‘é€ã€‚ ç­¾åéªŒè¯æµç¨‹ å“ˆå¸Œè®¡ç®—ï¼šæ¥æ”¶æ–¹ç‹¬ç«‹è®¡ç®—åŸå§‹æ•°æ®å“ˆå¸Œå€¼ã€‚ ç­¾åè§£å¯†ï¼šç”¨ç­¾åè€…å…¬é’¥è§£å¯†ç­¾åè·å¾—å“ˆå¸Œå€¼ã€‚ å¯¹æ¯”éªŒè¯ï¼šæ¯”å¯¹ä¸¤ä¸ªå“ˆå¸Œå€¼ï¼Œä¸€è‡´åˆ™éªŒè¯é€šè¿‡ã€‚ äºŒã€å…³é”®ç‰¹æ€§ ç‰¹æ€§ å®ç°æœºåˆ¶ å®‰å…¨ä»·å€¼ ä¸å¯ä¼ªé€ æ€§ ç§é’¥å”¯ä¸€æ§åˆ¶ç­¾åç”Ÿæˆæƒ é˜²æ­¢èº«ä»½å†’å…… ä¸å¯æŠµèµ–æ€§ ç­¾åä¸ç§é’¥å¼ºç»‘å®š è¿½æº¯è´£ä»»ä¸»ä½“ æ•°æ®å®Œæ•´æ€§ å“ˆå¸Œå€¼å˜åŒ–å¯¼è‡´éªŒè¯å¤±è´¥ é˜²å†…å®¹ç¯¡æ”¹ èº«ä»½è®¤è¯ å…¬é’¥å¯å…¬å¼€éªŒè¯ç­¾åæ¥æº ç¡®è®¤å‘é€æ–¹èº«ä»½ ä¸‰ã€ä¸»æµç®—æ³•å®ç° ECDSAï¼ˆæ¤­åœ†æ›²çº¿ç­¾åï¼‰ æ¯”ç‰¹å¸é‡‡ç”¨ secp256k1 æ›²çº¿ï¼Œä»¥160ä½å¯†é’¥å®ç°é«˜å®‰å…¨æ€§ã€‚ ä¼˜åŠ¿ï¼šè®¡ç®—é‡å°ã€ç­¾åé•¿åº¦çŸ­ï¼ˆå…¸å‹65å­—èŠ‚ï¼‰ã€‚ å¤šé‡ç­¾åæŠ€æœ¯ éœ€å¤šä¸ªç§é’¥å…±åŒæˆæƒäº¤æ˜“ï¼ˆå¦‚M-of-Næ¨¡å¼ï¼‰ã€‚ åº”ç”¨åœºæ™¯ï¼šè”åˆè´¦æˆ·ã€èµ„é‡‘æ‰˜ç®¡ã€‚ å››ã€å·¥ä½œæ¨¡å‹å›¾è§£graph LRA[åŸå§‹æ•°æ®] -- B(å“ˆå¸Œè¿ç®—)B -- C[æ•°æ®æ‘˜è¦]D[ç§é’¥] -- E(åŠ å¯†ç­¾å)C -- EE -- F[æ•°å­—ç­¾å]F -- Gä¼ è¾“G -- H[æ¥æ”¶æ–¹]H -- I[å…¬é’¥éªŒè¯]I -- J[ç­¾åæœ‰æ•ˆæ€§] æ¯”ç‰¹å¸ä¸­ä½¿ç”¨åˆ°çš„ Hash å‡½æ•°æ€§è´¨æ¯”ç‰¹å¸ç³»ç»Ÿä¸»è¦ä¾èµ–å¯†ç å­¦å“ˆå¸Œå‡½æ•°çš„ä¸‰ä¸ªæ ¸å¿ƒæ€§è´¨ç¡®ä¿å…¶å®‰å…¨æ€§ä¸åŠŸèƒ½æ€§ï¼Œå…·ä½“åº”ç”¨åŠæŠ€æœ¯ä¾æ®å¦‚ä¸‹ï¼š ä¸€ã€æ ¸å¿ƒå®‰å…¨æ€§è´¨ æŠ—ç¢°æ’æ€§ï¼ˆCollision Resistanceï¼‰ ç¡®ä¿äº¤æ˜“æ•°æ®ä¸å¯ç¯¡æ”¹ï¼Œä»»ä½•ä¿®æ”¹éƒ½ä¼šå¯¼è‡´åŒºå—å“ˆå¸Œå€¼å˜åŒ–ï¼Œç ´ååŒºå—é“¾è¿ç»­æ€§ã€‚ å…¸å‹åº”ç”¨ï¼šåŒºå—å¤´é€šè¿‡å­˜å‚¨å‰ä¸€åŒºå—å“ˆå¸Œå€¼å½¢æˆé“¾å¼ç»“æ„ã€‚ å•å‘æ€§éšç§˜æ€§ï¼ˆHidingï¼‰ ä¿æŠ¤ç”¨æˆ·éšç§ï¼Œæ¯”ç‰¹å¸åœ°å€ç”±å…¬é’¥ç» SHA-256 å’Œ RIPEMD-160 åŒé‡å“ˆå¸Œç”Ÿæˆï¼Œæ— æ³•é€†å‘æ¨å¯¼ã€‚ å…¸å‹åº”ç”¨ï¼šäº¤æ˜“ä»…å…¬å¼€å“ˆå¸Œåçš„åœ°å€ï¼Œéšè—çœŸå®èº«ä»½ã€‚ è°œé¢˜å‹å¥½æ€§ï¼ˆPuzzle Friendlyï¼‰ æ”¯æ’‘å·¥ä½œé‡è¯æ˜ï¼ˆPoWï¼‰ï¼ŒçŸ¿å·¥éœ€æš´åŠ›æšä¸¾ Nonce ä½¿åŒºå—å¤´å“ˆå¸Œæ»¡è¶³éš¾åº¦ç›®æ ‡ã€‚ å…¸å‹åº”ç”¨ï¼šæŒ–çŸ¿è¿‡ç¨‹å¿…é¡»é€šè¿‡ SHA-256(SHA-256(BlockHeader)) è®¡ç®—ã€‚ äºŒã€è¾…åŠ©åŠŸèƒ½æ€§è´¨ æ€§è´¨ åº”ç”¨åœºæ™¯ æŠ€æœ¯ä»·å€¼ é›ªå´©æ•ˆåº” äº¤æ˜“å¾®å°æ”¹åŠ¨å¯¼è‡´å“ˆå¸Œå€¼å‰§å˜ï¼Œè§¦å‘åˆ†å‰æ£€æµ‹æœºåˆ¶ å¢å¼ºæ•°æ®å®Œæ•´æ€§éªŒè¯çµæ•åº¦ å›ºå®šè¾“å‡ºé•¿åº¦ SHA-256ç»Ÿä¸€è¾“å‡º256ä½å“ˆå¸Œï¼Œç®€åŒ–åŒºå—å¤´ç»“æ„ï¼ˆ80å­—èŠ‚ï¼‰ æå‡ç½‘ç»œä¼ è¾“ä¸å­˜å‚¨æ•ˆç‡ ç¡®å®šæ€§ ç›¸åŒäº¤æ˜“å§‹ç»ˆç”Ÿæˆç›¸åŒå“ˆå¸Œå€¼ï¼Œä¿éšœå…¨èŠ‚ç‚¹éªŒè¯ä¸€è‡´æ€§ ç»´æŠ¤åˆ†å¸ƒå¼è´¦æœ¬å…±è¯†åŸºç¡€ ä¸‰ã€ç®—æ³•å®ç°æ‰©å±• åŒé‡SHA-256ï¼šåŒºå—å¤´ç»è¿‡ä¸¤æ¬¡å“ˆå¸Œè¿ç®—é™ä½ç¢°æ’æ¦‚ç‡ï¼Œå¢å¼ºæŒ–çŸ¿å®‰å…¨æ€§ã€‚ Merkleæ ‘ç»“æ„ï¼šäº¤æ˜“å“ˆå¸Œé€å±‚èšåˆç”ŸæˆMerkle Rootï¼Œåˆ©ç”¨æŠ—ç¢°æ’æ€§å®ç°é«˜æ•ˆéªŒè¯ã€‚ æ³¨ï¼šæ¯”ç‰¹å¸é€šè¿‡ç»æµæ¿€åŠ±æœºåˆ¶ï¼ˆå¦‚PoWæ¶ˆè€—èµ„æºï¼‰å°†å“ˆå¸Œæ€§è´¨è½¬åŒ–ä¸ºå»ä¸­å¿ƒåŒ–ä¿¡ä»»åŸºçŸ³ã€‚ æ¯”ç‰¹å¸ç­¾åæœºåˆ¶è¯¦è§£ä¸€ã€æ ¸å¿ƒç»„ä»¶ éå¯¹ç§°åŠ å¯†ä½“ç³» é‡‡ç”¨æ¤­åœ†æ›²çº¿æ•°å­—ç­¾åç®—æ³•(ECDSA)ï¼ŒåŸºäº secp256k1 æ›²çº¿ã€‚ æ¯ä¸ªç”¨æˆ·æ‹¥æœ‰ç§é’¥(ä¿å¯†)å’Œå…¬é’¥(å…¬å¼€)çš„å¯†é’¥å¯¹ã€‚ ç­¾åç”Ÿæˆæµç¨‹ ç§é’¥ç­¾åï¼šç”¨ç§é’¥å¯¹äº¤æ˜“å“ˆå¸Œå€¼åŠ å¯†ç”Ÿæˆæ•°å­—ç­¾åã€‚ å…¬é’¥éªŒè¯ï¼šé€šè¿‡å…¬é’¥è§£å¯†ç­¾åéªŒè¯äº¤æ˜“çœŸå®æ€§ã€‚ äºŒã€å®Œæ•´ç­¾åè¿‡ç¨‹ äº¤æ˜“æ„é€  åŒ…å«å‘é€æ–¹åœ°å€ã€æ¥æ”¶æ–¹åœ°å€ã€è½¬è´¦é‡‘é¢ç­‰æ•°æ®ã€‚ ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆå”¯ä¸€äº¤æ˜“IDé˜²æ­¢é‡å¤ã€‚ å“ˆå¸Œè®¡ç®— å¯¹äº¤æ˜“å†…å®¹è¿›è¡Œ SHA-256 å“ˆå¸Œè¿ç®—ã€‚ ç¡®ä¿ä»»ä½•å¾®å°ä¿®æ”¹éƒ½ä¼šå¯¼è‡´å“ˆå¸Œå€¼å‰§å˜ã€‚ ç­¾åç”Ÿæˆ ä½¿ç”¨ç§é’¥åŠ å¯†äº¤æ˜“å“ˆå¸Œå€¼ã€‚ ç”ŸæˆåŒ…å«(r,s)ä¸¤ä¸ªå‚æ•°çš„ECDSAç­¾åã€‚ å¹¿æ’­éªŒè¯ å°†åŸå§‹äº¤æ˜“ã€ç­¾åå’Œå…¬é’¥å¹¿æ’­è‡³ç½‘ç»œã€‚ èŠ‚ç‚¹é€šè¿‡å…¬é’¥éªŒè¯ç­¾åä¸äº¤æ˜“å“ˆå¸Œçš„åŒ¹é…æ€§ã€‚ ä¸‰ã€å®‰å…¨ç‰¹æ€§ ç‰¹æ€§ å®ç°æ–¹å¼ é˜²æŠ¤ç›®æ ‡ ä¸å¯ä¼ªé€ æ€§ åªæœ‰ç§é’¥æŒæœ‰è€…èƒ½ç”Ÿæˆæœ‰æ•ˆç­¾å é˜²æ­¢äº¤æ˜“ä¼ªé€  ä¸å¯æŠµèµ–æ€§ ç­¾åä¸ç§é’¥å¼ºç»‘å®š é˜²æ­¢å‘é€æ–¹å¦è®¤äº¤æ˜“ æ•°æ®å®Œæ•´æ€§ å“ˆå¸Œå€¼å˜åŒ–å¯¼è‡´éªŒè¯å¤±è´¥ é˜²æ­¢äº¤æ˜“å†…å®¹ç¯¡æ”¹ å››ã€æŠ€æœ¯ä¼˜åŠ¿ å»ä¸­å¿ƒåŒ–éªŒè¯ï¼šä»»ä½•èŠ‚ç‚¹éƒ½å¯ä½¿ç”¨å…¬é’¥ç‹¬ç«‹éªŒè¯ç­¾åã€‚ éšç§ä¿æŠ¤ï¼šåœ°å€ç”±å…¬é’¥å“ˆå¸Œç”Ÿæˆï¼Œå®ç°ä¼ªåŒ¿åæ€§ã€‚ æŠ—é‡å­è®¡ç®—ï¼šsecp256k1 æ›²çº¿æä¾›è¾ƒé«˜ç®—æ³•å¼ºåº¦ã€‚ é€šä¿—ç‰ˆæ¯”ç‰¹å¸ç­¾åæµç¨‹ï¼ˆç±»æ¯”å¯„ä¿¡ï¼‰ å‡†å¤‡ä¿¡ä»¶ï¼ˆäº¤æ˜“æ„é€ ï¼‰å†™æ¸…æ¥šï¼šè°ç»™ä½ è½¬è´¦ï¼ˆè¾“å…¥ï¼‰ã€è½¬ç»™è°ï¼ˆè¾“å‡ºï¼‰ã€è½¬å¤šå°‘é’±ï¼ˆé‡‘é¢ï¼‰ã€‚â†’ å°±åƒå¡«å†™æ±‡æ¬¾å•ï¼šæ±‡æ¬¾äººã€æ”¶æ¬¾äººã€é‡‘é¢ã€‚ æŒ‰æŒ‡çº¹ï¼ˆç”Ÿæˆç­¾åï¼‰ æµ“ç¼©å†…å®¹ï¼šæŠŠæ•´å¼ â€œæ±‡æ¬¾å•â€å‹æˆä¸€é“é˜²ä¼ªç ï¼ˆSHA-256å“ˆå¸Œï¼‰ã€‚â†’ ç±»ä¼¼æŠŠæ–‡ä»¶å¡è¿›é˜²ç¯¡æ”¹ä¿¡å°ã€‚ ç›–ç§ç« ï¼šç”¨åªæœ‰ä½ æœ‰çš„å°ç« ï¼ˆç§é’¥ï¼‰åœ¨ä¿¡å°å°å£å¤„ç›–ç« ï¼ˆECDSAç­¾åï¼‰ã€‚â†’ è¿™ä¸ªç« åŒ…å«ç‰¹æ®Šå¯†ç ï¼ˆr,så‚æ•°ï¼‰ï¼Œåˆ«äººä»¿ä¸äº†ã€‚ å¯„å‡ºä¿¡ä»¶ï¼ˆå¹¿æ’­äº¤æ˜“ï¼‰æŠŠâ€œç›–å¥½ç« çš„ä¿¡å°â€ï¼ˆç­¾åäº¤æ˜“ï¼‰+ ä½ çš„å…¬å¼€å°ç« æ¨¡ï¼ˆå…¬é’¥ï¼‰ä¸€èµ·å¯„åˆ°é‚®å±€ï¼ˆåŒºå—é“¾ç½‘ç»œï¼‰ã€‚ é‚®å±€éªŒçœŸä¼ªï¼ˆèŠ‚ç‚¹éªŒè¯ï¼‰ æ‹†å¼€ä¿¡å°é‡æ–°è®¡ç®—é˜²ä¼ªç ï¼ˆå“ˆå¸Œå€¼ï¼‰ã€‚ ç”¨ä½ çš„å…¬å¼€å°ç« æ¨¡æ ¸å¯¹å°å£ç« ï¼ˆå…¬é’¥è§£å¯†ç­¾åï¼‰ã€‚ æ ¸å¯¹æˆåŠŸ â†’ äº¤æ˜“æœ‰æ•ˆï¼Œé’±å¯è½¬å‡º âœ… ã€‚ é˜²ä¼ªç å¯¹ä¸ä¸Šæˆ–ç« ä¸å¯¹ â†’ å½“åœºä½œåºŸ âŒã€‚ å…³é”®ç‚¹ç§’æ‡‚ æ¦‚å¿µ ç”Ÿæ´»æ¯”å–» ä½œç”¨ ç§é’¥ ä½ çš„ä¸“å±å°ç«  åªæœ‰ä½ èƒ½ç›–ç« ï¼ˆç­¾åï¼‰ å…¬é’¥ å°ç« çš„å…¬å¼€æ¨¡å­ ä»»ä½•äººéƒ½èƒ½æ ¸å¯¹ä½ ç›–çš„ç«  äº¤æ˜“å“ˆå¸Œ ä¿¡å°é‡Œçš„é˜²ä¼ªç  ä¿è¯å†…å®¹æ²¡è¢«æ‰åŒ… ç­¾å ç›–åœ¨å°å£çš„ç«  è¯æ˜æ˜¯ä½ æœ¬äººå¯„çš„ä¿¡ ğŸ’¡ æœ¬è´¨ï¼šä¸ç”¨æš´éœ²å°ç« ï¼ˆç§é’¥ï¼‰å°±èƒ½å‘å…¨ç½‘è¯æ˜â€œè¿™æ˜¯æˆ‘åŒæ„çš„äº¤æ˜“â€ æ¯”ç‰¹å¸çš„æ•°æ®ç»“æ„ä¸€ã€æ ¸å¿ƒæ•°æ®ç»“æ„ç»„ä»¶ â€Œå“ˆå¸ŒæŒ‡é’ˆï¼ˆHash Pointerï¼‰ â€Œç»“æ„â€Œï¼šåŒ…å«æŒ‡å‘æ•°æ®å—çš„æŒ‡é’ˆ + è¯¥æ•°æ®å—çš„å“ˆå¸Œå€¼ï¼ˆå¦‚ SHA-256ï¼‰ã€‚ â€Œä½œç”¨â€Œï¼š æ£€æµ‹æ•°æ®ç¯¡æ”¹ï¼ˆå“ˆå¸Œå€¼ä¸åŒ¹é…å³è§¦å‘è­¦æŠ¥ï¼‰ã€‚ å®ç°åŒºå—é—´é“¾å¼è¿æ¥ï¼ˆåä¸€åŒºå—å­˜å‰ä¸€åŒºå—çš„å“ˆå¸ŒæŒ‡é’ˆï¼‰ã€‚ â€ŒåŒºå—ï¼ˆBlockï¼‰ â€ŒåŒºå—å¤´ï¼ˆ80å­—èŠ‚ï¼‰ å­—æ®µ é•¿åº¦ ä½œç”¨ ç‰ˆæœ¬å· 4å­—èŠ‚ åè®®ç‰ˆæœ¬æ ‡è¯†ï¼ˆå¦‚ BIP9 è½¯åˆ†å‰ï¼‰ å‰é©±åŒºå—å“ˆå¸Œ 32å­—èŠ‚ æŒ‡å‘ä¸Šä¸€ä¸ªåŒºå—çš„å“ˆå¸Œå€¼ Merkleæ ‘æ ¹å“ˆå¸Œ 32å­—èŠ‚ æœ¬åŒºå—äº¤æ˜“çš„æŒ‡çº¹æ‘˜è¦ æ—¶é—´æˆ³ 4å­—èŠ‚ åŒºå—ç”Ÿæˆæ—¶é—´ï¼ˆUNIXç§’çº§ï¼‰ éš¾åº¦ç›®æ ‡ 4å­—èŠ‚ PoW æŒ–çŸ¿ç›®æ ‡å€¼ï¼ˆå‹ç¼©æ ¼å¼ï¼‰ éšæœºæ•°ï¼ˆNonceï¼‰ 4å­—èŠ‚ åŠ¨æ€è°ƒæ•´ä»¥æ»¡è¶³å“ˆå¸Œæ¡ä»¶ â€ŒåŒºå—ä½“â€Œï¼šå­˜å‚¨äº¤æ˜“åˆ—è¡¨ï¼Œå« 1~4MB äº¤æ˜“æ•°æ®ã€‚ åŒºå—ç»“æ„ï¼š graph LR A[åŒºå—å¤´] -- B[ç‰ˆæœ¬å·] A -- C[å‰é©±åŒºå—å“ˆå¸Œ] A -- D[Merkleæ ¹å“ˆå¸Œ] A -- E[æ—¶é—´æˆ³] A -- F[éš¾åº¦ç›®æ ‡] A -- G[Nonce] H[åŒºå—ä½“] -- I[äº¤æ˜“åˆ—è¡¨] â€Œé»˜å…‹å°”æ ‘ï¼ˆMerkle Treeï¼‰ â€Œç»“æ„â€Œï¼šäºŒå‰æ ‘ï¼Œå¶å­èŠ‚ç‚¹ä¸ºäº¤æ˜“å“ˆå¸Œï¼Œéå¶èŠ‚ç‚¹ä¸ºå­èŠ‚ç‚¹å“ˆå¸Œçš„ç»„åˆã€‚ â€Œç”Ÿæˆé€»è¾‘ï¼š â€Œä½œç”¨â€Œï¼š å¿«é€ŸéªŒè¯äº¤æ˜“å­˜åœ¨æ€§ï¼ˆåªéœ€ O(log n) é‡çº§è·¯å¾„ï¼‰ã€‚ é˜²ç¯¡æ”¹ï¼šä¿®æ”¹ä»»æ„äº¤æ˜“å°†å¯¼è‡´æ ¹å“ˆå¸Œå˜åŒ–ã€‚ äºŒã€å…¨å±€é“¾å¼ç»“æ„ â€ŒåŒºå—é“¾ï¼ˆBlockchainï¼‰ ç”±åŒºå—é€šè¿‡å“ˆå¸ŒæŒ‡é’ˆä¸²è”çš„é“¾è¡¨ï¼Œé¦–ä¸ªåŒºå—ä¸º â€Œåˆ›ä¸–åŒºå—ï¼ˆGenesis Blockï¼‰ ç‰¹æ€§ï¼š â€Œé˜²ç¯¡æ”¹é“¾â€Œï¼šä¿®æ”¹ä»»ä¸€åŒºå—å°†å¼•å‘åç»­æ‰€æœ‰åŒºå—å“ˆå¸Œå€¼è¿é”å¤±æ•ˆ â€Œè½»èŠ‚ç‚¹éªŒè¯â€Œï¼šåªéœ€ä¿å­˜æœ€è¿‘åŒºå—å“ˆå¸Œå€¼å³å¯éªŒè¯å†å²æ•°æ®å®Œæ•´æ€§ é“¾å¼ç»“æ„ï¼š graph LR Genesis[åˆ›ä¸–åŒºå—] -- Block1[åŒºå—1] Block1 -- Block2[åŒºå—2] Block2 -- Block3[...] â€Œäº¤æ˜“æ•°æ®ç»“æ„â€Œ â€Œè¾“å…¥ï¼ˆInputï¼‰ï¼šå¼•ç”¨å‰åºäº¤æ˜“çš„è¾“å‡ºï¼ˆUTXOï¼šUnspent Transaction Outputï¼ŒæœªèŠ±è´¹äº¤æ˜“è¾“å‡ºï¼‰åŠè§£é”è„šæœ¬ â€Œè¾“å‡ºï¼ˆOutputï¼‰ï¼šåŒ…å«æ¥æ”¶æ–¹åœ°å€ã€è½¬è´¦é‡‘é¢åŠé”å®šè„šæœ¬ â€ŒCoinBaseäº¤æ˜“â€Œï¼šçŸ¿å·¥å¥–åŠ±äº¤æ˜“ï¼ˆæ— è¾“å…¥æ¥æºï¼Œ2025å¹´ 3.125 BTCåŒºå—ï¼‰ äº¤æ˜“ç»“æ„ï¼š graph TD T[äº¤æ˜“] -- V[ç‰ˆæœ¬å·] T -- IN[è¾“å…¥åˆ—è¡¨] T -- OUT[è¾“å‡ºåˆ—è¡¨] T -- L[é”å®šæ—¶é—´] IN -- PREV[å‰åºäº¤æ˜“å“ˆå¸Œ] IN -- INDEX[è¾“å‡ºç´¢å¼•] IN -- SCRIPT[è§£é”è„šæœ¬] OUT -- VALUE[é‡‘é¢] OUT -- SCRIPT[é”å®šè„šæœ¬] ä¸‰ã€å…³é”®ç‰¹æ€§ä¸ä¼˜åŒ– â€Œç‰¹æ€§â€Œ â€Œå®ç°æ–¹å¼â€Œ â€ŒæŠ€æœ¯ä»·å€¼â€Œ æ•°æ®å®Œæ•´æ€§ å“ˆå¸ŒæŒ‡é’ˆ + Merkleæ ‘ ä»»ä½•ç¯¡æ”¹å¯è¢«èŠ‚ç‚¹å¿«é€Ÿä¾¦æµ‹ é«˜æ•ˆéªŒè¯ Merkle Proof è·¯å¾„éªŒè¯ è½»èŠ‚ç‚¹æ— éœ€ä¸‹è½½å®Œæ•´äº¤æ˜“å†å² æ‰©å®¹èƒ½åŠ› åŒºå—å¤§å°åŠ¨æ€è°ƒæ•´ï¼ˆSegWitå‡çº§ï¼‰ æå‡äº¤æ˜“ååé‡ ğŸ’¡ â€Œç¤ºä¾‹â€Œï¼šè‹¥æ”»å‡»è€…ç¯¡æ”¹åŒºå—Nçš„äº¤æ˜“ï¼Œå°†å¯¼è‡´ï¼š åŒºå—Nçš„å“ˆå¸Œå€¼æ”¹å˜ â†’ åŒºå—N+1çš„â€œå‰é©±å“ˆå¸Œâ€å¤±æ•ˆ Merkleæ ‘æ ¹å“ˆå¸Œå˜åŒ– â†’ åŒºå—å¤´æ•°æ®æ— æ•ˆ å…¨ç½‘èŠ‚ç‚¹æ‹’ç»è¯¥é“¾ï¼Œæ”»å‡»å¤±è´¥ æ¯”ç‰¹å¸é€šè¿‡å“ˆå¸ŒæŒ‡é’ˆã€åŒºå—å¤´å…ƒæ•°æ®åŠé»˜å…‹å°”æ ‘çš„åµŒå¥—è®¾è®¡ï¼Œæ„å»ºäº†å»ä¸­å¿ƒåŒ–ã€æŠ—ç¯¡æ”¹ä¸”å¯é«˜æ•ˆéªŒè¯çš„åˆ†å¸ƒå¼è´¦æœ¬ç³»ç»Ÿã€‚ æ¯”ç‰¹å¸çš„åˆ†å¸ƒå¼å…±è¯†æ¯”ç‰¹å¸é€šè¿‡â€Œå·¥ä½œé‡è¯æ˜ï¼ˆPoWï¼‰å…±è¯†æœºåˆ¶â€Œå®ç°åˆ†å¸ƒå¼å…±è¯†ï¼Œç»“åˆæœ€é•¿é“¾åŸåˆ™å’Œæ¿€åŠ±æœºåˆ¶ï¼Œç¡®ä¿å…¨ç½‘èŠ‚ç‚¹å¯¹è´¦æœ¬çŠ¶æ€è¾¾æˆä¸€è‡´ã€‚ä»¥ä¸‹æ˜¯æ ¸å¿ƒæµç¨‹ä¸æŠ€æœ¯è¦ç‚¹ï¼š ä¸€ã€å…±è¯†æœºåˆ¶æ ¸å¿ƒæµç¨‹ â€Œäº¤æ˜“å¹¿æ’­ä¸æ‰“åŒ…â€Œç”¨æˆ·å‘èµ·äº¤æ˜“åå‘å…¨ç½‘å¹¿æ’­ï¼ŒèŠ‚ç‚¹æ”¶é›†äº¤æ˜“å¹¶éªŒè¯åˆæ³•æ€§ï¼ˆå¦‚ç­¾åæœ‰æ•ˆæ€§ã€UTXOæœªé‡å¤æ”¯å‡ºï¼‰ã€‚éªŒè¯é€šè¿‡çš„äº¤æ˜“è¿›å…¥â€Œå†…å­˜æ± ï¼ˆmempoolï¼‰ï¼Œç­‰å¾…çŸ¿å·¥æ‰“åŒ…â€Œã€‚ â€Œå·¥ä½œé‡è¯æ˜ï¼ˆPoWï¼‰ç«äº‰â€ŒçŸ¿å·¥å°†äº¤æ˜“æ‰“åŒ…æˆå€™é€‰åŒºå—ï¼Œé€šè¿‡è®¡ç®—å¯»æ‰¾æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„â€ŒNonceå€¼â€Œï¼ˆå³åŒºå—å¤´çš„å“ˆå¸Œå€¼éœ€å°äºç›®æ ‡å€¼ï¼Œå¦‚ä»¥å¤šä¸ª0å¼€å¤´ï¼‰ã€‚æ­¤è¿‡ç¨‹éœ€å¤§é‡ç®—åŠ›ï¼Œæœ€å¿«è§£å‡ºNonceçš„çŸ¿å·¥è·å¾—è®°è´¦æƒâ€Œã€‚â€Œæ•°å­¦æœ¬è´¨â€Œï¼šSHA256(SHA256(åŒºå—å¤´ + Nonce)) [9][12 Target â€ŒåŒºå—å¹¿æ’­ä¸éªŒè¯â€ŒæˆåŠŸæŒ–çŸ¿çš„èŠ‚ç‚¹å°†æ–°åŒºå—å¹¿æ’­è‡³å…¨ç½‘ï¼Œå…¶ä»–èŠ‚ç‚¹éªŒè¯ï¼š Nonceå€¼æ˜¯å¦æ»¡è¶³éš¾åº¦è¦æ±‚ åŒºå—å†…æ‰€æœ‰äº¤æ˜“æ˜¯å¦åˆæ³•ï¼ˆå¦‚UTXOæœ‰æ•ˆæ€§ï¼‰ åŒºå—æ˜¯å¦é“¾æ¥åˆ°å½“å‰æœ€é•¿é“¾çš„æœ«ç«¯ã€‚ â€Œæœ€é•¿é“¾åŸåˆ™â€Œè‹¥å‡ºç°ä¸´æ—¶åˆ†å‰ï¼ˆå¦‚ä¸¤ä¸ªçŸ¿å·¥åŒæ—¶è§£å‡ºNonceï¼‰ï¼ŒèŠ‚ç‚¹é»˜è®¤åœ¨â€Œæœ€å…ˆæ”¶åˆ°çš„æœ‰æ•ˆåŒºå—â€Œåç»§ç»­æŒ–çŸ¿ã€‚å½“æŸä¸€åˆ†å‰åç»­åŒºå—æ›´å¤šï¼ˆé“¾æ›´é•¿ï¼‰æ—¶ï¼Œå…¨ç½‘èŠ‚ç‚¹å°†åˆ‡æ¢è‡³æœ€é•¿é“¾ï¼Œä¸¢å¼ƒçŸ­é“¾ä¸Šçš„åŒºå—â€Œã€‚ â€Œç¡®è®¤ä¸ä¸å¯é€†æ€§â€Œäº¤æ˜“è¢«æ‰“åŒ…è¿›åŒºå—è§†ä¸ºâ€Œ1æ¬¡ç¡®è®¤â€Œï¼Œåç»­æ¯æ–°å¢ä¸€ä¸ªåŒºå—å¢åŠ 1æ¬¡ç¡®è®¤ã€‚6æ¬¡ç¡®è®¤åï¼ˆçº¦1å°æ—¶ï¼‰ï¼Œäº¤æ˜“è¢«è§†ä½œä¸å¯é€†â€”â€”å› æ”»å‡»è€…éœ€é‡æ„è¶…è¿‡6ä¸ªåŒºå—ï¼Œç®—åŠ›æˆæœ¬æé«˜â€Œã€‚ äºŒã€å…³é”®æ”¯æ’‘æŠ€æœ¯ â€ŒPoWçš„å®‰å…¨è®¾è®¡â€Œ â€Œ51%æ”»å‡»é˜²å¾¡â€Œï¼šæ¶æ„èŠ‚ç‚¹éœ€æŒæ§å…¨ç½‘51%ä»¥ä¸Šç®—åŠ›æ‰å¯èƒ½ç¯¡æ”¹å†å²äº¤æ˜“ï¼Œä½†å®é™…æˆæœ¬è¿œè¶…æ”¶ç›Šï¼ˆç”µåŠ›ã€ç¡¬ä»¶æŠ•å…¥ï¼‰â€Œã€‚ â€Œéš¾åº¦åŠ¨æ€è°ƒæ•´â€Œï¼šæ¯2016ä¸ªåŒºå—ï¼ˆçº¦ä¸¤å‘¨ï¼‰æ ¹æ®å…¨ç½‘ç®—åŠ›è°ƒæ•´å“ˆå¸Œç›®æ ‡å€¼ï¼Œç»´æŒå¹³å‡10åˆ†é’Ÿå‡ºå—é€Ÿåº¦â€Œã€‚ â€Œç»æµæ¿€åŠ±æœºåˆ¶â€Œ â€ŒåŒºå—å¥–åŠ±â€Œï¼šæˆåŠŸæŒ–çŸ¿çš„çŸ¿å·¥è·å¾—æ–°ç”Ÿæˆçš„æ¯”ç‰¹å¸ï¼ˆåˆå§‹12.5 BTCï¼Œæ¯4å¹´å‡åŠï¼‰åŠåŒºå—å†…äº¤æ˜“æ‰‹ç»­è´¹â€Œã€‚ â€Œæˆæœ¬çº¦æŸâ€Œï¼šçŸ¿å·¥æŠ•å…¥çš„ç¡¬ä»¶ä¸ç”µåŠ›æˆæœ¬å½¢æˆâ€œæ²‰æ²¡æˆæœ¬â€ï¼Œæ¿€åŠ±å…¶ç»´æŠ¤ç³»ç»Ÿè€Œéç ´åâ€Œã€‚ ä¸‰ã€å¯¹æ¯”å…¶ä»–å…±è¯†æœºåˆ¶ â€Œæœºåˆ¶â€Œ â€Œæ ¸å¿ƒé€»è¾‘â€Œ â€Œæ¯”ç‰¹å¸é€‚ç”¨æ€§â€Œ â€Œå±€é™æ€§â€Œ PoW ç®—åŠ›ç«äº‰è§£é¢˜ é«˜å®‰å…¨æ€§ï¼Œå»ä¸­å¿ƒåŒ–æœ€ä½³ èƒ½è€—å·¨å¤§ï¼Œæ•ˆç‡ä½â€Œ13 PoS æŒå¸æ•°é‡ä¸æ—¶é•¿å†³å®š èŠ‚èƒ½ï¼Œä½†æ˜“å¯¼è‡´ä¸­å¿ƒåŒ–å„æ–­ æ— åˆ©ç›Šæ”»å‡»é£é™©â€Œ13 DPoS æŒå¸è€…é€‰ä¸¾ä»£ç†èŠ‚ç‚¹ æ•ˆç‡é«˜ï¼Œé€‚åˆé«˜é¢‘äº¤æ˜“åœºæ™¯ å¼±åŒ–å»ä¸­å¿ƒåŒ–ç‰¹æ€§â€Œ19 å››ã€å…±è¯†æŒ‘æˆ˜ä¸åº”å¯¹ â€Œåˆ†å‰å¤„ç†â€Œç¡¬åˆ†å‰ï¼ˆå¦‚BCHï¼‰éœ€ç¤¾åŒºå…±è¯†æ”¯æŒï¼›è½¯åˆ†å‰ï¼ˆå¦‚SegWitï¼‰ä¿æŒå‘åå…¼å®¹ï¼Œé€šè¿‡èŠ‚ç‚¹å‡çº§å®ç°â€Œã€‚ â€Œå¥³å·«æ”»å‡»é˜²å¾¡â€ŒPoWè¦æ±‚èŠ‚ç‚¹ä»˜å‡ºçœŸå®ç®—åŠ›æˆæœ¬ï¼Œé˜²æ­¢æ¶æ„åˆ›å»ºå¤§é‡è™šå‡èŠ‚ç‚¹â€Œã€‚ æ€»ç»“æ¯”ç‰¹å¸é€šè¿‡â€ŒPoWç®—åŠ›ç«äº‰+æœ€é•¿é“¾åŸåˆ™+ç»æµæ¿€åŠ±â€Œçš„ä¸‰å…ƒæ¡†æ¶è¾¾æˆåˆ†å¸ƒå¼å…±è¯†ï¼Œåœ¨å»ä¸­å¿ƒåŒ–ä¸å®‰å…¨æ€§é—´å–å¾—å¹³è¡¡ã€‚å°½ç®¡å­˜åœ¨èƒ½è€—é—®é¢˜ï¼Œä½†å…¶51%æ”»å‡»é˜²å¾¡æœºåˆ¶å’Œé“¾ä¸Šæ•°æ®çš„ä¸å¯ç¯¡æ”¹æ€§ï¼Œä½¿å…¶æˆä¸ºå½“å‰æœ€ç¨³å¥çš„å…¬æœ‰é“¾å…±è¯†æ¨¡å‹â€Œã€‚ é˜²èŒƒåŒèŠ±æ”»å‡»åŠéªŒè¯äº¤æ˜“åˆæ³•æ€§ä¸€ã€é˜²èŒƒåŒèŠ±æ”»å‡»çš„å…³é”®æœºåˆ¶ â€ŒUTXOæ¨¡å‹ï¼ˆæœªèŠ±è´¹äº¤æ˜“è¾“å‡ºï¼‰æ¯”ç‰¹å¸é‡‡ç”¨UTXOè€Œéè´¦æˆ·ä½™é¢æ¨¡å‹ã€‚æ¯ç¬”äº¤æ˜“çš„è¾“å…¥å¿…é¡»å¼•ç”¨å…ˆå‰æœªèŠ±è´¹çš„è¾“å‡ºï¼Œå¹¶ç”Ÿæˆæ–°çš„UTXOã€‚ç³»ç»Ÿå®æ—¶æ ¡éªŒUTXOé›†åˆï¼Œç¡®ä¿åŒä¸€ç¬”èµ„é‡‘æ— æ³•è¢«é‡å¤å¼•ç”¨ï¼Œä»æ•°æ®ç»“æ„ä¸Šæœç»â€œå¹¿æ’­å†²çªå‹åŒèŠ±â€ â€Œã€‚ â€Œå·¥ä½œé‡è¯æ˜ï¼ˆPoWï¼‰ä¸æœ€é•¿é“¾åŸåˆ™â€Œ çŸ¿å·¥é€šè¿‡ç®—åŠ›ç«äº‰å°†äº¤æ˜“æ‰“åŒ…å…¥åŒºå—ï¼Œ6æ¬¡ç¡®è®¤åäº¤æ˜“è§†ä¸ºä¸å¯é€†ï¼ˆå› æ”»å‡»è€…éœ€é‡æ„è¶…6ä¸ªåŒºå—ï¼Œç®—åŠ›æˆæœ¬æé«˜ï¼‰ã€‚ èŠ‚ç‚¹é»˜è®¤æ¥å—â€Œæœ€é•¿æœ‰æ•ˆé“¾â€Œä½œä¸ºä¸»é“¾ã€‚æ”»å‡»è€…éœ€æ§åˆ¶51%ç®—åŠ›æ‰å¯èƒ½æ„é€ æ›¿ä»£é“¾å®æ–½â€œäº¤æ˜“å›æ»šå‹åŒèŠ±â€ï¼Œä½†å®é™…æˆæœ¬è¿œè¶…æ”¶ç›Š â€Œã€‚ â€Œäº¤æ˜“ç¡®è®¤å»¶è¿Ÿç­–ç•¥â€Œå•†å®¶å»ºè®®ç­‰å¾…6ä¸ªåŒºå—ç¡®è®¤ï¼ˆçº¦1å°æ—¶ï¼‰å†äº¤ä»˜å•†å“ã€‚æœªç¡®è®¤äº¤æ˜“æ± ï¼ˆmempoolï¼‰ä¼šæ£€æµ‹å†²çªäº¤æ˜“ï¼Œä»…ä¼ æ’­é¦–ä¸ªæœ‰æ•ˆäº¤æ˜“ï¼Œåç»­å†²çªäº¤æ˜“è‡ªåŠ¨å¤±æ•ˆ â€Œã€‚ äºŒã€äº¤æ˜“åˆæ³•æ€§éªŒè¯æµç¨‹ â€Œå¯†ç å­¦ç­¾åéªŒè¯â€Œæ¯ç¬”äº¤æ˜“éœ€æä¾›å‘é€è€…å¯¹â€Œå‰åºUTXOçš„åˆæ³•ç­¾åâ€Œï¼Œé€šè¿‡æ¤­åœ†æ›²çº¿æ•°å­—ç­¾åç®—æ³•ï¼ˆECDSAï¼‰éªŒè¯æ‰€æœ‰æƒï¼Œé˜²æ­¢ä¼ªé€ äº¤æ˜“ â€Œã€‚ â€ŒåŒé‡æ ¡éªŒè§„åˆ™â€Œ â€ŒUTXOå­˜åœ¨æ€§â€Œï¼šæ£€æŸ¥äº¤æ˜“è¾“å…¥æ˜¯å¦å¼•ç”¨æœ‰æ•ˆçš„æœªèŠ±è´¹è¾“å‡ºã€‚ â€Œæ— é‡å¤æ”¯å‡ºâ€Œï¼šç¡®ä¿åŒä¸€UTXOæœªè¢«å…¶ä»–å·²ç¡®è®¤äº¤æ˜“ä½¿ç”¨ã€‚ â€Œè„šæœ¬æ‰§è¡Œâ€Œï¼šè§£é”è„šæœ¬ï¼ˆç­¾åï¼‰éœ€æ»¡è¶³é”å®šè„šæœ¬ï¼ˆæ¥æ”¶æ–¹æ¡ä»¶ï¼‰è¦æ±‚ï¼Œä¾‹å¦‚OP_CHECKSIGæŒ‡ä»¤éªŒè¯ç­¾åæœ‰æ•ˆæ€§ â€Œã€‚ â€ŒåŒºå—çº§å…±è¯†éªŒè¯â€ŒçŸ¿å·¥æ‰“åŒ…äº¤æ˜“å‰éœ€éªŒè¯ï¼š äº¤æ˜“æ•°æ®ç»“æ„åˆè§„æ€§ï¼ˆå¦‚è¾“å…¥è¾“å‡ºæ•°é‡ï¼‰ è¾“å…¥æ€»é¢ â‰¥ è¾“å‡ºæ€»é¢ï¼ˆé˜²è¶…é¢æ”¯å‡ºï¼‰ æ—¶é—´æˆ³ç¬¦åˆç½‘ç»œè§„åˆ™ã€‚ æ¯”ç‰¹å¸çš„æŒ–çŸ¿æ¯”ç‰¹å¸æŒ–çŸ¿æ˜¯æ¯”ç‰¹å¸ç½‘ç»œè¿è¡Œçš„æ ¸å¿ƒæœºåˆ¶ï¼Œæœ¬è´¨ä¸Šæ˜¯çŸ¿å·¥é€šè¿‡ç®—åŠ›ç«äº‰éªŒè¯äº¤æ˜“ã€ç”Ÿæˆæ–°åŒºå—å¹¶è·å–å¥–åŠ±çš„è¿‡ç¨‹ã€‚ä»¥ä¸‹æ˜¯å…¶å…³é”®åŸç†ä¸æµç¨‹ï¼š ä¸€ã€æ ¸å¿ƒç›®çš„ä¸ä½œç”¨ â€Œäº¤æ˜“éªŒè¯ä¸é˜²åŒèŠ±â€ŒçŸ¿å·¥æ”¶é›†æœªç¡®è®¤äº¤æ˜“ï¼Œæ£€æŸ¥ç­¾åæœ‰æ•ˆæ€§ã€UTXOï¼ˆæœªèŠ±è´¹äº¤æ˜“è¾“å‡ºï¼‰çŠ¶æ€ï¼Œç¡®ä¿æ— é‡å¤æ”¯ä»˜ï¼Œç»´æŠ¤äº¤æ˜“å¯ä¿¡åº¦ã€‚â€Œ â€ŒåŒºå—ç”Ÿæˆä¸é“¾å¼å­˜å‚¨â€Œå°†åˆæ³•äº¤æ˜“æ‰“åŒ…æˆåŒºå—ï¼ˆçº¦1MBï¼Œå«4000æ¡äº¤æ˜“ï¼‰ï¼Œé“¾æ¥åˆ°å·²æœ‰åŒºå—é“¾ä¸Šï¼Œå½¢æˆä¸å¯ç¯¡æ”¹çš„åˆ†å¸ƒå¼è´¦æœ¬ã€‚â€Œ â€Œæ¿€åŠ±ç»´æŠ¤ç½‘ç»œå®‰å…¨â€ŒæˆåŠŸæŒ–çŸ¿çš„çŸ¿å·¥è·å¾—åŒºå—å¥–åŠ±ï¼ˆæ–°å‘è¡Œæ¯”ç‰¹å¸ï¼‰åŠäº¤æ˜“æ‰‹ç»­è´¹ï¼Œé©±åŠ¨ç®—åŠ›æŠ•å…¥ä¿éšœç³»ç»Ÿç¨³å®šã€‚â€Œ äºŒã€è¿ä½œæœºåˆ¶è¯¦è§£ â€Œå·¥ä½œé‡è¯æ˜ï¼ˆPoWï¼‰ç«äº‰ çŸ¿å·¥éœ€è®¡ç®—åŒºå—å¤´çš„å“ˆå¸Œå€¼ï¼ˆé€šè¿‡SHA-256ç®—æ³•ï¼‰ï¼Œä½¿å…¶æ»¡è¶³ç½‘ç»œè®¾å®šçš„ç›®æ ‡å€¼ï¼ˆå¦‚ä»¥å¤šä¸ª0å¼€å¤´ï¼‰ã€‚ é€šè¿‡ä¸æ–­è°ƒæ•´â€Œéšæœºæ•°ï¼ˆNonceï¼‰â€Œ åå¤å°è¯•ï¼Œç›´åˆ°æ‰¾åˆ°æœ‰æ•ˆè§£ï¼Œæ¶ˆè€—å·¨å¤§ç®—åŠ›ä¸ç”µåŠ›ã€‚â€Œ â€Œæœ€é•¿é“¾åŸåˆ™ä¸å…±è¯†è¾¾æˆâ€Œ é¦–ä¸ªè§£å‡ºæœ‰æ•ˆNonceçš„çŸ¿å·¥å°†æ–°åŒºå—å¹¿æ’­è‡³å…¨ç½‘ï¼Œå…¶ä»–èŠ‚ç‚¹éªŒè¯ååŠ å…¥æœ¬åœ°é“¾ã€‚ è‹¥å‡ºç°åˆ†å‰ï¼ˆå¤šä¸ªçŸ¿å·¥åŒæ—¶è§£å‡ºï¼‰ï¼ŒèŠ‚ç‚¹é€‰æ‹©åç»­åŒºå—æ›´é•¿çš„é“¾ä½œä¸ºä¸»é“¾ï¼Œç¡®ä¿å…¨å±€ä¸€è‡´ã€‚â€Œ â€Œéš¾åº¦åŠ¨æ€è°ƒæ•´â€Œæ¯”ç‰¹å¸ç½‘ç»œæ¯2016ä¸ªåŒºå—ï¼ˆçº¦ä¸¤å‘¨ï¼‰æ ¹æ®å…¨ç½‘ç®—åŠ›è‡ªåŠ¨è°ƒæ•´å“ˆå¸Œç›®æ ‡å€¼ï¼Œç»´æŒå¹³å‡10åˆ†é’Ÿå‡ºå—é€Ÿåº¦ã€‚â€Œ ä¸‰ã€çŸ¿å·¥è§’è‰²ä¸æ”¶ç›Š â€Œç¯èŠ‚â€Œ â€ŒçŸ¿å·¥è¡Œä¸ºâ€Œ â€Œå¥–åŠ±æœºåˆ¶â€Œ äº¤æ˜“æ”¶é›† ç­›é€‰å†…å­˜æ± ï¼ˆmempoolï¼‰ä¸­æœªç¡®è®¤äº¤æ˜“ æ— ç›´æ¥æ”¶ç›Š åŒºå—æ‰“åŒ…ä¸è®¡ç®— è€—è´¹ç®—åŠ›æ±‚è§£Nonce æˆåŠŸè€…è·åŒºå—å¥–åŠ±ï¼ˆ2025å¹´3.125 BTCï¼‰â€Œ äº¤æ˜“æ‰‹ç»­è´¹ ä¼˜å…ˆæ‰“åŒ…é«˜æ‰‹ç»­è´¹äº¤æ˜“ åŒºå—å†…æ‰€æœ‰äº¤æ˜“æ‰‹ç»­è´¹å½’çŸ¿å·¥æ‰€æœ‰â€Œ â€Œæ€»é‡æ§åˆ¶â€Œ åŒºå—å¥–åŠ±æ¯4å¹´å‡åŠ 2140å¹´è¾¾2100ä¸‡æšä¸Šé™åä»…é æ‰‹ç»­è´¹â€Œ åˆå§‹åŒºå—å¥–åŠ±50 BTCï¼Œç»å†ä¸‰æ¬¡å‡åŠå2025å¹´ä¸º3.125 BTCã€‚ å››ã€ç¡¬ä»¶æ¼”è¿›ä¸æŒ‘æˆ˜ â€Œè®¾å¤‡ä¸“ä¸šåŒ– â€Œæ—©æœŸâ€Œï¼šæ™®é€šCPUGPUå³å¯å‚ä¸ï¼ˆ2009-2012å¹´ï¼‰â€Œã€‚ â€Œå½“å‰â€Œï¼šASICçŸ¿æœºï¼ˆä¸“ä¸ºå“ˆå¸Œè®¡ç®—ä¼˜åŒ–ï¼‰ä¸»å¯¼ï¼Œæ•ˆç‡è¿œè¶…é€šç”¨è®¾å¤‡ï¼Œä¸ªäººçŸ¿å·¥éš¾ç«äº‰â€Œã€‚ â€Œé«˜æˆæœ¬å£å’ â€Œç”µåŠ›æ¶ˆè€—â€Œï¼šå…¨çƒå¹´è€—ç”µé‡è¶…éƒ¨åˆ†ä¸­å°å›½å®¶ï¼Œå¼•å‘ç¯ä¿äº‰è®®â€Œã€‚ â€Œé›†ä¸­åŒ–é£é™©â€Œï¼šå¤§å‹çŸ¿åœºä¸çŸ¿æ± ï¼ˆå¦‚Antpoolã€F2Poolï¼‰æ§åˆ¶å¤šæ•°ç®—åŠ›â€Œã€‚ äº”ã€å…³é”®æ„ä¹‰æ€»ç»“ â€Œå®‰å…¨æ€§ä¿éšœâ€Œï¼šPoWæœºåˆ¶ä½¿ç¯¡æ”¹å†å²äº¤æ˜“éœ€æŒæ§51%ç®—åŠ›ï¼Œæˆæœ¬è¿œè¶…æ”¶ç›Šâ€Œã€‚ â€Œå»ä¸­å¿ƒåŒ–åŸºçŸ³â€Œï¼šå…¨çƒèŠ‚ç‚¹å…±åŒéªŒè¯ï¼Œé¿å…å•ä¸€æœºæ„æ§åˆ¶è´§å¸ç³»ç»Ÿâ€Œã€‚ â€Œç»æµæ¨¡å‹é—­ç¯â€Œï¼šé€šè¿‡å‘è¡Œæœºåˆ¶ä¸æ‰‹ç»­è´¹å¹³è¡¡çŸ¿å·¥æ¿€åŠ±ä¸è´§å¸ç¨€ç¼ºæ€§â€Œã€‚ æŒ–çŸ¿çš„éš¾åº¦æ¯”ç‰¹å¸æŒ–çŸ¿éš¾åº¦æ˜¯æ¯”ç‰¹å¸ç½‘ç»œçš„æ ¸å¿ƒè°ƒèŠ‚æœºåˆ¶ï¼Œç”¨äºç¡®ä¿æ–°åŒºå—å¹³å‡æ¯ â€Œ10 åˆ†é’Ÿâ€Œ ç¨³å®šç”Ÿæˆï¼Œå…¶æœ¬è´¨æ˜¯æ§åˆ¶çŸ¿å·¥è®¡ç®—å“ˆå¸Œå€¼çš„â€œè§£é¢˜é—¨æ§›â€ã€‚ä»¥ä¸‹æ˜¯å…¶å…³é”®åŸç†åŠè¿è¡Œé€»è¾‘çš„ç»¼åˆè¯´æ˜ã€‚ ä¸€ã€æŒ–çŸ¿éš¾åº¦çš„æŠ€æœ¯åŸç† â€Œç›®æ ‡é˜ˆå€¼ï¼ˆTargetï¼‰å†³å®šéš¾åº¦â€Œ çŸ¿å·¥éœ€å¯»æ‰¾ä¸€ä¸ªéšæœºæ•°ï¼ˆNonceï¼‰ï¼Œä½¿åŒºå—å¤´çš„å“ˆå¸Œå€¼ â€Œä½äºç›®æ ‡é˜ˆå€¼â€Œï¼ˆTargetï¼‰ã€‚ â€Œç›®æ ‡é˜ˆå€¼è¶Šå°â€Œï¼Œæœ‰æ•ˆå“ˆå¸Œå€¼çš„èŒƒå›´è¶Šçª„ï¼ŒçŸ¿å·¥éœ€å°è¯•çš„è®¡ç®—æ¬¡æ•°è¶Šå¤šï¼Œéš¾åº¦è¶Šé«˜ã€‚ æŒ–çŸ¿éš¾åº¦ï¼ˆDifficultyï¼‰ä¸ç›®æ ‡é˜ˆå€¼æˆåæ¯”ï¼š$ \\text{Difficulty} \\frac{\\text{difficulty_1_target}}{\\text{target}} $å…¶ä¸­ difficulty_1_target æ˜¯éš¾åº¦ä¸º 1 æ—¶çš„æœ€å¤§ç›®æ ‡å€¼ã€‚ â€Œéš¾åº¦è°ƒæ•´è§¦å‘æ¡ä»¶â€Œ æ¯”ç‰¹å¸åè®®æ¯äº§ç”Ÿ â€Œ2016 ä¸ªåŒºå—â€Œï¼ˆçº¦ â€Œ14 å¤©â€Œï¼‰è‡ªåŠ¨è°ƒæ•´ä¸€æ¬¡éš¾åº¦ã€‚ è°ƒæ•´ä¾æ®æ˜¯è¿‡å» 2016 ä¸ªåŒºå—çš„å®é™…ç”Ÿæˆæ—¶é—´ä¸ç†è®ºæ—¶é—´ï¼ˆ20,160 åˆ†é’Ÿï¼‰çš„åå·®ï¼šæ–°ç›®æ ‡å€¼ æ—§ç›®æ ‡å€¼ Ã— $\\frac{\\text{å®é™…ç”¨æ—¶}}{20,160 \\text{åˆ†é’Ÿ}}$è‹¥å®é™…ç”¨æ—¶ç¼©çŸ­ï¼ˆç®—åŠ›ä¸Šå‡ï¼‰ï¼Œç›®æ ‡å€¼å‡å°ï¼Œéš¾åº¦å‡é«˜ï¼›åä¹‹åˆ™éš¾åº¦é™ä½ã€‚ äºŒã€éš¾åº¦è°ƒæ•´çš„æ ¸å¿ƒç›®çš„ â€Œç»´æŒå‡ºå—é€Ÿç‡ç¨³å®šâ€Œ é¿å…ç®—åŠ›å¢é•¿å¯¼è‡´å‡ºå—è¿‡å¿«ï¼ˆå¦‚ï¼œ10åˆ†é’Ÿï¼‰ï¼šé˜²æ­¢äº¤æ˜“ç¡®è®¤æ—¶é—´ç¼©çŸ­ã€åˆ†å‰é£é™©å¢åŠ ã€‚ é¿å…ç®—åŠ›ä¸‹é™å¯¼è‡´å‡ºå—è¿‡æ…¢ï¼ˆå¦‚ï¼10åˆ†é’Ÿï¼‰ï¼šç¡®ä¿äº¤æ˜“å¤„ç†æ•ˆç‡åŠç½‘ç»œå¯ç”¨æ€§ã€‚ â€Œä¿éšœç½‘ç»œå®‰å…¨ä¸ç»æµå¹³è¡¡â€Œ é«˜éš¾åº¦è¦æ±‚æ”»å‡»è€…éœ€æ§åˆ¶å…¨ç½‘ â€Œ51% ä»¥ä¸Šç®—åŠ›â€Œæ‰å¯èƒ½ç¯¡æ”¹äº¤æ˜“ï¼Œå¤§å¹…æå‡æ”»å‡»æˆæœ¬ã€‚ é€šè¿‡è°ƒèŠ‚éš¾åº¦åŒ¹é…å½“å‰ç®—åŠ›æ°´å¹³ï¼Œé¿å…çŸ¿å·¥å› æ”¶ç›Šè¿‡ä½å¤§è§„æ¨¡é€€å‡ºï¼Œç»´æŠ¤å»ä¸­å¿ƒåŒ–ã€‚ ä¸‰ã€éš¾åº¦å˜åŒ–çš„å½±å“å› ç´ ä¸å¸‚åœºå…³è” â€Œå› ç´ â€Œ â€Œå¯¹éš¾åº¦çš„å½±å“â€Œ â€Œå®ä¾‹ï¼ˆ2024â€“2025å¹´ï¼‰ â€Œå…¨ç½‘ç®—åŠ›å˜åŒ–â€Œ æ­£ç›¸å…³ï¼ˆç®—åŠ›â†‘â†’éš¾åº¦â†‘ï¼‰ 2025å¹´4æœˆç®—åŠ›è¾¾884 EHsï¼Œéš¾åº¦å‡è‡³123.23Tå†å²å³°å€¼ â€Œæ¯”ç‰¹å¸ä»·æ ¼æ³¢åŠ¨â€Œ é—´æ¥å½±å“ï¼ˆä»·æ ¼â†“â†’çŸ¿å·¥é€€å‡ºâ†’ç®—åŠ›â†“ï¼‰ 2025å¹´1æœˆä»·æ ¼æš´è·Œè‡´éš¾åº¦ä¸‹è°ƒ â€Œ**2.12%**ï¼ˆ110.45Tâ†’108.11Tï¼‰ â€Œæç«¯äº‹ä»¶å†²å‡»â€Œ çŸ­æœŸç®—åŠ›éª¤é™å¼•å‘éš¾åº¦ä¸‹è°ƒ 2025å¹´6æœˆå› é«˜æ¸©åœç”µäº‹ä»¶ï¼Œéš¾åº¦å•æ¬¡ä¸‹è°ƒ â€Œ**7.48%**ï¼ˆåˆ›å››å¹´æœ€å¤§è·Œå¹…ï¼‰ å››ã€æŒ–çŸ¿éš¾åº¦æ¼”å˜è¶‹åŠ¿ï¼ˆ2009â€“2025ï¼‰ â€ŒæŒ‡æ•°çº§å¢é•¿â€Œï¼š2009å¹´éš¾åº¦ä¸º â€Œ1â€Œ â†’ 2021å¹´è¾¾ â€Œ24ä¸‡äº¿â€Œ â†’ 2024å¹´çªç ´ â€Œ100ä¸‡äº¿â€Œï¼ˆ100Tï¼‰ï¼Œ2025å¹´æœ€é«˜è¾¾ â€Œ123.23Tâ€Œã€‚ â€ŒçŸ¿æœºæŠ€æœ¯è¿­ä»£é©±åŠ¨â€Œï¼šCPUæŒ–çŸ¿ï¼ˆ2009ï¼‰â†’ GPUï¼ˆ2010ï¼‰â†’ FPGAï¼ˆ2011ï¼‰â†’ ASICçŸ¿æœºï¼ˆ2013è‡³ä»Šï¼‰ã€‚ ğŸ’¡ â€Œå½“å‰ç°çŠ¶ï¼ˆ2025å¹´7æœˆï¼‰â€Œï¼šæ¯”ç‰¹å¸æŒ–çŸ¿å·²è¿›å…¥ â€Œè¶…é«˜é—¨æ§›é˜¶æ®µâ€Œï¼Œä¸ªäººç”µè„‘æ— æ³•å‚ä¸ï¼Œéœ€ä¾èµ–ä¸“ä¸šçŸ¿åœºä¸ä½ç”µä»·èµ„æºï¼ˆå¦‚ä¼Šæœ—ã€ç¾å›½å¾·å·ï¼‰ç»´æŒç›ˆåˆ©æ€§ã€‚è‹¥è€ƒè™‘å…¥å±€ï¼Œéœ€è°¨æ…è¯„ä¼°è®¾å¤‡æŠ˜æ—§ï¼ˆASICçŸ¿æœºï¼‰ã€ç”µåŠ›æˆæœ¬åŠæ”¿ç­–é£é™©ï¼ˆå¦‚ä¸­å›½ç¦æ­¢æŒ–çŸ¿ï¼‰ã€‚ æ¯”ç‰¹å¸è„šæœ¬æ¯”ç‰¹å¸è„šæœ¬ï¼ˆBitcoin Scriptï¼‰æ˜¯æ¯”ç‰¹å¸äº¤æ˜“çš„æ ¸å¿ƒéªŒè¯æœºåˆ¶ï¼Œé€šè¿‡åŸºäºå †æ ˆçš„ç¼–ç¨‹è¯­è¨€å®ç°äº¤æ˜“æ¡ä»¶çš„è®¾å®šä¸éªŒè¯ã€‚ä»¥ä¸‹æ˜¯å…¶æŠ€æœ¯åŸç†ã€åŠŸèƒ½åˆ†ç±»åŠå®é™…åº”ç”¨çš„ç³»ç»Ÿè§£æã€‚ ä¸€ã€æ¯”ç‰¹å¸è„šæœ¬çš„æŠ€æœ¯åŸç† â€ŒåŸºäºå †æ ˆçš„æ‰§è¡Œæ¨¡å‹â€Œ è„šæœ¬é€šè¿‡åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„å †æ ˆç»“æ„æ‰§è¡Œæ“ä½œï¼Œä»…æ”¯æŒç¡®å®šæ€§æ“ä½œï¼ˆå¦‚å“ˆå¸Œè¿ç®—ã€ç­¾åéªŒè¯ï¼‰ï¼Œç¦æ­¢å¾ªç¯å’Œé€’å½’ä»¥é˜²æ­¢æ­»å¾ªç¯æ”»å‡»â€Œã€‚ æ‰§è¡Œæµç¨‹åˆ†ä¸ºä¸¤æ­¥ï¼šå…ˆè¿è¡Œè§£é”è„šæœ¬ï¼ˆScriptSigï¼‰ï¼Œå†è¿è¡Œé”å®šè„šæœ¬ï¼ˆScriptPubKeyï¼‰ï¼Œæœ€ç»ˆæ ˆé¡¶ç»“æœä¸º TRUE åˆ™äº¤æ˜“æœ‰æ•ˆâ€Œã€‚ â€Œéå›¾çµå®Œå¤‡æ€§â€Œ è„šæœ¬è¯­è¨€è®¾è®¡ä¸ºæ— çŠ¶æ€ã€æ— è·³è½¬æŒ‡ä»¤ï¼Œæ— æ³•å®ç°å¤æ‚é€»è¾‘å¾ªç¯ï¼Œä½†æ”¯æŒæ¡ä»¶åˆ¤æ–­ï¼ˆå¦‚ OP_IFï¼‰ï¼Œå¹³è¡¡äº†å®‰å…¨æ€§ä¸åŠŸèƒ½æ€§â€Œã€‚ â€Œè„šæœ¬ä¸UTXOçš„ç»‘å®šå…³ç³»â€Œ æ¯ä¸ªæœªèŠ±è´¹äº¤æ˜“è¾“å‡ºï¼ˆUTXOï¼‰é€šè¿‡é”å®šè„šæœ¬å®šä¹‰èŠ±è´¹æ¡ä»¶ï¼Œè€Œè§£é”è„šæœ¬éœ€æä¾›æ»¡è¶³æ¡ä»¶çš„å‚æ•°ï¼ˆå¦‚ç­¾åã€å…¬é’¥ï¼‰æ‰èƒ½è§£é”èµ„é‡‘â€Œã€‚ äºŒã€è„šæœ¬ç±»å‹ä¸åŠŸèƒ½å®ç°æ ‡å‡†è„šæœ¬ç±»å‹ â€ŒP2PKHï¼ˆæ”¯ä»˜åˆ°å…¬é’¥å“ˆå¸Œï¼‰ â€Œé”å®šè„šæœ¬â€Œï¼šOP_DUP OP_HASH160 å…¬é’¥å“ˆå¸Œ OP_EQUALVERIFY OP_CHECKSIGï¼ˆè½¬å¸ç»™è°ï¼‰ â€Œè§£é”è„šæœ¬â€Œï¼šç­¾å å…¬é’¥ï¼ˆè°æ¥è½¬å¸ï¼‰ éªŒè¯æµç¨‹ï¼šå…¬é’¥éœ€å“ˆå¸ŒååŒ¹é…é”å®šè„šæœ¬ä¸­çš„åœ°å€ï¼Œç­¾åéœ€éªŒè¯æœ‰æ•ˆæ€§â€Œã€‚ â€ŒP2SHï¼ˆæ”¯ä»˜åˆ°è„šæœ¬å“ˆå¸Œï¼‰ å°†å¤æ‚è„šæœ¬ï¼ˆå¦‚å¤šé‡ç­¾åï¼‰å“ˆå¸ŒååµŒå…¥é”å®šè„šæœ¬ï¼Œå®é™…æ‰§è¡Œæ—¶å†è¿˜åŸï¼Œé™ä½äº¤æ˜“æ•°æ®é‡â€Œã€‚ â€Œå¤šé‡ç­¾åï¼ˆMultisigï¼‰ è¦æ±‚å¤šä¸ªç§é’¥ä¸­çš„æŒ‡å®šæ•°é‡ï¼ˆå¦‚23ï¼‰ç­¾åæ‰èƒ½è§£é”ï¼Œå¸¸ç”¨äºä¼ä¸šèµ„é‡‘ç®¡ç†â€Œã€‚ é«˜çº§è„šæœ¬åº”ç”¨ â€Œæ—¶é—´é”ï¼ˆTimelockï¼‰ é€šè¿‡ OP_CHECKLOCKTIMEVERIFY å®ç°èµ„é‡‘åœ¨ç‰¹å®šæ—¶é—´åå¯ç”¨â€Œã€‚ â€Œé”€æ¯è¯æ˜ï¼ˆProof of Burnï¼‰ å°†æ¯”ç‰¹å¸å‘é€åˆ°ä¸å¯èŠ±è´¹çš„åœ°å€ï¼ˆå¦‚ OP_RETURN è¾“å‡ºï¼‰ï¼Œç”¨äºé”€æ¯ä»£å¸æˆ–å­˜å‚¨æ•°æ®â€Œã€‚ ä¸‰ã€è„šæœ¬æ‰§è¡Œç¤ºä¾‹ä¸€ã€åŸºç¡€æ”¯ä»˜è„šæœ¬ï¼šP2PKHï¼ˆæ”¯ä»˜åˆ°å…¬é’¥å“ˆå¸Œï¼‰â€Œåœºæ™¯â€Œï¼šAlice å‘ Bob è½¬è´¦ 1 BTC â€Œé”å®šè„šæœ¬ï¼ˆBobçš„æ”¶æ¬¾æ¡ä»¶ï¼‰ OP_DUP OP_HASH160 Bobçš„å…¬é’¥å“ˆå¸Œ OP_EQUALVERIFY OP_CHECKSIG Bobçš„å…¬é’¥å“ˆå¸Œï¼šç”± Bob çš„å…¬é’¥ç» RIPEMD160(SHA256) ç”Ÿæˆï¼Œå¦‚ 3a4b...c8d9â€Œ â€Œè§£é”è„šæœ¬ï¼ˆBobèŠ±è´¹æ—¶æä¾›ï¼‰ Bobçš„ç­¾å Bobçš„åŸå§‹å…¬é’¥ ç­¾åï¼šBob ç”¨ç§é’¥å¯¹äº¤æ˜“æ•°æ®ç”Ÿæˆçš„ä¸€æ¬¡æ€§å¯†ç â€Œ â€ŒéªŒè¯æµç¨‹â€Œï¼š æ­¥éª¤1ï¼šå°† Bobçš„åŸå§‹å…¬é’¥ å“ˆå¸ŒåŒ– â†’ å¯¹æ¯”é”å®šè„šæœ¬ä¸­çš„å…¬é’¥å“ˆå¸Œï¼ˆOP_EQUALVERIFYï¼‰ æ­¥éª¤2ï¼šè¾“å…¥è„šæœ¬ä¸­ç”¨å…¬é’¥éªŒè¯ç­¾åçš„æœ‰æ•ˆæ€§ï¼ˆOP_CHECKSIGï¼‰ è‹¥ä¸¤æ­¥å‡é€šè¿‡ï¼Œèµ„é‡‘è§£é”æˆåŠŸâ€Œ version: 1, // äº¤æ˜“åè®®ç‰ˆæœ¬ locktime: 0, // ç«‹å³ç”Ÿæ•ˆ vin: [ txid: a1b2...c3d4, // è¾“å…¥å¼•ç”¨çš„å‰åºäº¤æ˜“ID vout: 0, // å¼•ç”¨å‰åºäº¤æ˜“çš„ç¬¬0ä¸ªè¾“å‡º scriptSig: Aliceç­¾å Aliceå…¬é’¥, // è§£é”è„šæœ¬ sequence: 0xFFFFFFFF ], vout: [ value: 1, // è¾“å‡ºé‡‘é¢ï¼ˆBTCï¼‰ scriptPubKey: OP_DUP OP_HASH160 Bobå…¬é’¥å“ˆå¸Œ OP_EQUALVERIFY OP_CHECKSIG // é”å®šè„šæœ¬ ] äºŒã€å¤šç­¾è´¦æˆ·è„šæœ¬ï¼š23 å¤šé‡ç­¾åâ€Œåœºæ™¯â€Œï¼šå…¬å¸èµ„é‡‘éœ€ä»»æ„ä¸¤åé«˜ç®¡ï¼ˆABCï¼‰å…±åŒç­¾ç½²ç”Ÿæ•ˆ â€Œé”å®šè„šæœ¬ï¼ˆå®šä¹‰èŠ±è´¹è§„åˆ™ï¼‰ 2 Açš„å…¬é’¥ Bçš„å…¬é’¥ Cçš„å…¬é’¥ 3 OP_CHECKMULTISIG 2/3 è¡¨ç¤ºéœ€æä¾›è‡³å°‘ 2 ä¸ªæœ‰æ•ˆç­¾åâ€Œ â€Œè§£é”è„šæœ¬ï¼ˆå®é™…èŠ±è´¹æ—¶æä¾›ï¼‰ OP_0 Açš„ç­¾å Cçš„ç­¾å OP_0ï¼šå› å†å²é—ç•™é—®é¢˜éœ€å‰ç½®æ— æ•ˆå ä½ç¬¦â€Œ â€ŒéªŒè¯æµç¨‹â€Œï¼š ç³»ç»ŸæŒ‰å…¬é’¥é¡ºåºåŒ¹é…ç­¾åï¼ˆA å’Œ C çš„ç­¾åæœ‰æ•ˆå³é€šè¿‡ï¼‰ è‹¥åªæä¾› 1 ä¸ªç­¾åæˆ–ç­¾åæ— æ•ˆåˆ™å¤±è´¥â€Œ vin: [ txid: e5f6...g7h8, vout: 1, scriptSig: OP_0 Aç­¾å Cç­¾å redeemScript, // æä¾›2ä¸ªç­¾å sequence: 0xFFFFFFFE ], vout: [ value: 2.0, scriptPubKey: OP_HASH160 redeemScriptå“ˆå¸Œ OP_EQUAL // P2SHé”å®šè„šæœ¬ ], witness: [] // SegWitæ‰©å±•å­—æ®µï¼ˆå¯é€‰ï¼‰ ä¸‰ã€è¿›é˜¶è„šæœ¬å®ä¾‹ æ—¶é—´é”æ”¯ä»˜ï¼ˆHTLCï¼‰ â€Œåœºæ™¯â€Œï¼šè·¨é“¾åŸå­äº¤æ¢ï¼Œè¦æ±‚ Bob åœ¨ 48 å°æ—¶å†…æä¾›å“ˆå¸ŒåŸåƒ â€Œé”å®šè„šæœ¬â€Œï¼š OP_IF OP_SHA256 å“ˆå¸Œå€¼ OP_EQUALVERIFY OP_ELSE 48å°æ—¶åæ—¶é—´æˆ³ OP_CHECKLOCKTIMEVERIFY OP_ENDIF â€Œæ‰§è¡Œé€»è¾‘â€Œï¼š è‹¥ Bob åœ¨æ—¶é™å†…æä¾›æ­£ç¡®åŸåƒï¼ˆåŒ¹é…å“ˆå¸Œï¼‰ï¼Œç«‹å³è§£é”ï¼› è¶…æ—¶å Alice å¯è‡ªè¡Œå–å›èµ„é‡‘â€Œ Taproot ä¼˜åŒ–è„šæœ¬ï¼ˆP2TRï¼‰ â€Œåœºæ™¯â€Œï¼šéšç§å¢å¼ºå‹äº¤æ˜“ â€Œé”å®šè„šæœ¬â€Œï¼šOP_1 èšåˆå…¬é’¥çš„é»˜å…‹å°”æ ¹å“ˆå¸Œ â€Œè§£é”æ–¹å¼â€Œï¼šæä¾›å•ä¸€ç­¾å â€Œæˆ–â€Œ æ»¡è¶³é»˜å…‹å°”æ ‘ä¸­çš„å¤æ‚æ¡ä»¶ï¼ˆå¦‚å¤šç­¾æ—¶é—´é”ï¼‰ â€Œä¼˜åŠ¿â€Œï¼šé“¾ä¸Šä»…æ˜¾ç¤ºå•ç­¾äº¤æ˜“ï¼Œéšè—çœŸå®é€»è¾‘â€Œ æ¯”ç‰¹å¸åˆ†å‰æ¯”ç‰¹å¸åˆ†å‰æ˜¯æŒ‡æ¯”ç‰¹å¸åŒºå—é“¾å› åè®®è§„åˆ™å˜æ›´æˆ–ç¤¾åŒºåˆ†æ­§è€Œåˆ†è£‚ä¸ºä¸¤æ¡ç‹¬ç«‹é“¾çš„ç°è±¡ï¼Œæœ¬è´¨ä¸Šæ˜¯åŒºå—é“¾æŠ€æœ¯å‡çº§æˆ–ç¤¾åŒºæ²»ç†çŸ›ç›¾çš„ä½“ç°ã€‚ ç¡¬åˆ†å‰ä¸€ã€ç¡¬åˆ†å‰çš„æŠ€æœ¯å®šä¹‰ç¡¬åˆ†å‰æ˜¯æŒ‡åŒºå—é“¾åè®®å‘ç”Ÿâ€Œä¸å…¼å®¹å‡çº§â€Œï¼Œå¯¼è‡´æœªå‡çº§èŠ‚ç‚¹æ— æ³•éªŒè¯æ–°åŒºå—ï¼Œæœ€ç»ˆåˆ†è£‚ä¸ºä¸¤æ¡ç‹¬ç«‹è¿è¡Œçš„é“¾ã€‚å…¶æ ¸å¿ƒç‰¹å¾åŒ…æ‹¬ï¼š â€Œåè®®ä¸å…¼å®¹â€Œï¼šæ–°æ—§èŠ‚ç‚¹éµå¾ªä¸åŒè§„åˆ™ï¼Œæ—§èŠ‚ç‚¹ä¼šæ‹’ç»æ–°èŠ‚ç‚¹äº§ç”Ÿçš„åŒºå—â€Œï¼ˆæ–°æŒ–å‡ºçš„æ—§åè®®çš„èŠ‚ç‚¹ä¸è®¤å¯æ–°åè®®çš„èŠ‚ç‚¹è¿˜æ˜¯é“¾åˆ°ä¹‹å‰çš„é“¾ä¸Šï¼‰ã€‚ â€Œæ°¸ä¹…æ€§åˆ†è£‚â€Œï¼šåˆ†å‰åä¸¤æ¡é“¾å®Œå…¨ç‹¬ç«‹ï¼Œæ‹¥æœ‰å„è‡ªçš„äº¤æ˜“å†å²å’Œä»£å¸â€Œã€‚ â€Œéœ€å…¨ç½‘å‡çº§â€Œï¼šè‹¥éƒ¨åˆ†èŠ‚ç‚¹æ‹’ç»å‡çº§ï¼Œåˆ™å¿…ç„¶äº§ç”Ÿåˆ†å‰â€Œã€‚ äºŒã€ç¡¬åˆ†å‰è§¦å‘æ¡ä»¶ä¸æµç¨‹ è§¦å‘æ¡ä»¶ â€Œé‡å¤§åè®®å˜æ›´â€Œï¼šå¦‚ä¿®æ”¹åŒºå—å¤§å°ã€å…±è¯†ç®—æ³•ç­‰åº•å±‚è§„åˆ™â€Œ14ã€‚ â€Œç¤¾åŒºåˆ†æ­§â€Œï¼šå¼€å‘è€…æˆ–çŸ¿å·¥å¯¹å‡çº§æ–¹æ¡ˆæ— æ³•è¾¾æˆå…±è¯†â€Œ67ã€‚ æ‰§è¡Œæµç¨‹ â€Œä»£ç åˆ†å‰â€Œï¼šå¤åˆ¶åŸé“¾ä»£ç å¹¶ä¿®æ”¹åè®®è§„åˆ™ï¼ˆå¦‚å°†åŒºå—ä»1MBæ‰©å®¹è‡³8MBï¼‰ã€‚ â€Œè®¾å®šæ¿€æ´»ç‚¹â€Œï¼šæŒ‡å®šåŒºå—é«˜åº¦æˆ–æ—¶é—´ç‚¹è§¦å‘åˆ†å‰ï¼ˆå¦‚BCHåœ¨åŒºå—é«˜åº¦478558åˆ†å‰ï¼‰ã€‚ â€Œé“¾åˆ†è£‚â€Œï¼šå‡çº§èŠ‚ç‚¹ä¸æœªå‡çº§èŠ‚ç‚¹åˆ†åˆ«å»¶ç»­è‡ªå·±è®¤å¯çš„é“¾â€Œã€‚ ä¸‰ã€å…¸å‹ç¡¬åˆ†å‰æ¡ˆä¾‹ â€Œæ¯”ç‰¹å¸ç°é‡‘ï¼ˆBCHï¼‰åˆ†å‰ï¼ˆ2017ï¼‰ â€ŒèƒŒæ™¯â€Œï¼šæ¯”ç‰¹å¸1MBåŒºå—é™åˆ¶å¯¼è‡´äº¤æ˜“æ‹¥å µï¼Œç¤¾åŒºå¯¹æ‰©å®¹æ–¹æ¡ˆäº§ç”Ÿåˆ†æ­§â€Œã€‚ â€Œåˆ†å‰å†…å®¹ï¼š BCHæ”¯æŒè€…å°†åŒºå—æ‰©å®¹è‡³8MBï¼Œå–æ¶ˆéš”ç¦»è§è¯ï¼ˆSegWitï¼‰â€Œã€‚ åˆ†å‰åæŒæœ‰BTCçš„ç”¨æˆ·1:1è·å¾—BCHâ€Œã€‚ â€Œç»“æœâ€Œï¼šBCHæˆä¸ºå¸‚å€¼æœ€é«˜çš„æ¯”ç‰¹å¸åˆ†å‰å¸ï¼Œä½†åç»­å› å†…éƒ¨çŸ›ç›¾å†æ¬¡åˆ†è£‚ï¼ˆå¦‚BCH ABCä¸BSVï¼‰ã€‚ â€Œä»¥å¤ªåŠç»å…¸ï¼ˆETCï¼‰åˆ†å‰ï¼ˆ2016ï¼‰ â€ŒèƒŒæ™¯â€Œï¼šDAOé»‘å®¢æ”»å‡»åï¼Œä»¥å¤ªåŠç¤¾åŒºæŠ•ç¥¨å†³å®šå›æ»šäº¤æ˜“æŒ½å›æŸå¤±â€Œã€‚ â€Œåˆ†å‰å†…å®¹ï¼š ä¸»é“¾ï¼ˆETHï¼‰æ‰§è¡Œå›æ»šï¼Œåå¯¹è€…åšæŒåŸé“¾ï¼ˆETCï¼‰ä»¥ç»´æŠ¤â€ä»£ç å³æ³•å¾‹â€åŸåˆ™â€Œã€‚ â€Œç»“æœâ€Œï¼šETCæˆä¸ºå°‘æ•°æ´¾é“¾ï¼Œä½†ä¿ç•™äº†â€ä¸å¯ç¯¡æ”¹â€çš„æ„è¯†å½¢æ€è±¡å¾â€Œã€‚ å››ã€ç¡¬åˆ†å‰çš„å½±å“ â€Œç”¨æˆ·èµ„äº§â€Œï¼šåˆ†å‰å‰æŒå¸è€…è‡ªåŠ¨è·å¾—æ–°é“¾ä»£å¸ï¼Œä½†ä»·å€¼å–å†³äºå¸‚åœºè®¤å¯ï¼ˆå¦‚BCHæ›¾è¾¾BTCä»·æ ¼çš„20%ï¼‰ã€‚ â€Œç”Ÿæ€é£é™©ï¼š ç®—åŠ›åˆ†æ•£å¯èƒ½å¯¼è‡´å®‰å…¨æ€§ä¸‹é™ï¼ˆå¦‚BCHæ›¾é­51%æ”»å‡»ï¼‰ã€‚ ç¤¾åŒºåˆ†è£‚å‰Šå¼±ç½‘ç»œæ•ˆåº”ï¼ˆå¦‚BTCä¸BCHé•¿æœŸç«äº‰ï¼‰ã€‚ â€ŒæŠ€æœ¯æ¼”è¿›â€Œï¼šæ¨åŠ¨åŒºå—é“¾æ‰©å®¹æ–¹æ¡ˆåˆ›æ–°ï¼ˆå¦‚BCHåç»­å‡çº§è‡³32MBåŒºå—ï¼‰ã€‚ äº”ã€ä¸è½¯åˆ†å‰çš„å…³é”®åŒºåˆ« â€Œå¯¹æ¯”ç»´åº¦â€Œ â€Œç¡¬åˆ†å‰â€Œ â€Œè½¯åˆ†å‰â€Œ å…¼å®¹æ€§ ä¸å…¼å®¹æ—§èŠ‚ç‚¹ å‘ä¸‹å…¼å®¹æ—§èŠ‚ç‚¹ é“¾åˆ†è£‚ å¿…ç„¶åˆ†è£‚ å¯èƒ½é¿å…åˆ†è£‚ å‡çº§è¦æ±‚ å¼ºåˆ¶å…¨ç½‘å‡çº§ å¤šæ•°ç®—åŠ›æ”¯æŒå³å¯ å…¸å‹æ¡ˆä¾‹ BCHã€ETC æ¯”ç‰¹å¸SegWitå‡çº§ ç¡¬åˆ†å‰æœ¬è´¨æ˜¯åŒºå—é“¾å»ä¸­å¿ƒåŒ–æ²»ç†çš„ä½“ç°ï¼Œæ—¢æ˜¯æŠ€æœ¯å‡çº§æ‰‹æ®µï¼Œä¹Ÿæ˜¯ç¤¾åŒºå…±è¯†å±æœºçš„äº§ç‰©â€Œã€‚ è½¯åˆ†å‰è½¯åˆ†å‰æ˜¯åŒºå—é“¾åè®®å‡çº§çš„ä¸€ç§æ–¹å¼ï¼Œå…¶æ ¸å¿ƒç‰¹ç‚¹æ˜¯â€Œå‘åå…¼å®¹â€Œï¼Œå³æ–°è§„åˆ™è®¾è®¡çš„äº¤æ˜“æˆ–åŒºå—ä»èƒ½è¢«æ—§èŠ‚ç‚¹æ¥å—ï¼Œé€šå¸¸ä¸ä¼šå¯¼è‡´åŒºå—é“¾æ°¸ä¹…åˆ†è£‚ã€‚ â€Œä¸€ã€è½¯åˆ†å‰çš„æ ¸å¿ƒæœºåˆ¶ â€Œè§„åˆ™å­é›†åŸåˆ™â€Œæ–°è§„åˆ™æ˜¯æ—§è§„åˆ™çš„å­é›†ï¼Œæ„å‘³ç€æ–°ç‰ˆæœ¬è®¤ä¸ºåˆæ³•çš„äº¤æ˜“åŒºå—ï¼Œæ—§ç‰ˆæœ¬ä¹Ÿä¼šè®¤å¯ï¼ˆå°½ç®¡å¯èƒ½ä¸ç†è§£æ–°è§„åˆ™çš„å…·ä½“å«ä¹‰ï¼‰ã€‚ä¾‹å¦‚ï¼Œæ¯”ç‰¹å¸çš„éš”ç¦»è§è¯ï¼ˆSegWitï¼‰é€šè¿‡å°†ç­¾åæ•°æ®ç§»å‡ºä¸»åŒºå—ï¼Œæ—§èŠ‚ç‚¹ä»èƒ½éªŒè¯äº¤æ˜“ï¼Œä½†æ— æ³•è¯†åˆ«æ–°åŠŸèƒ½ã€‚ â€Œä¸´æ—¶æ€§åˆ†å‰â€Œè‹¥éƒ¨åˆ†èŠ‚ç‚¹æœªå‡çº§ï¼Œå¯èƒ½çŸ­æš‚å‡ºç°åˆ†å‰ï¼Œä½†æ–°èŠ‚ç‚¹ç®—åŠ›å ä¼˜æ—¶ï¼Œæ—§èŠ‚ç‚¹äº§ç”Ÿçš„æ— æ•ˆåŒºå—ä¼šè¢«æŠ›å¼ƒï¼Œæœ€ç»ˆå›å½’å•é“¾ã€‚ äºŒâ€Œã€å…¸å‹è½¯åˆ†å‰ç¤ºä¾‹ â€Œæ¯”ç‰¹å¸SegWitå‡çº§ï¼ˆ2017ï¼‰ â€Œæ”¹åŠ¨å†…å®¹â€Œï¼šå°†äº¤æ˜“ç­¾åæ•°æ®ä»åŒºå—ä¸»ä½“ç§»è‡³æ‰©å±•åŒºåŸŸï¼Œé—´æ¥æ‰©å®¹åŒºå—ã€‚ â€Œå…¼å®¹æ€§â€Œï¼šæ—§èŠ‚ç‚¹ä»èƒ½éªŒè¯äº¤æ˜“ï¼Œä½†æ— æ³•è¯†åˆ« SegWit æ ¼å¼çš„æ–°åŠŸèƒ½ã€‚ â€ŒBIP34å‡çº§ï¼ˆåŒºå—é«˜åº¦åµŒå…¥ï¼‰ â€Œæ”¹åŠ¨å†…å®¹â€Œï¼šè¦æ±‚çŸ¿å·¥åœ¨åŒºå—ä¸­å¿…é¡»åŒ…å«é«˜åº¦ä¿¡æ¯ã€‚ â€Œåˆ†å‰å¤„ç†â€Œï¼šæ—§èŠ‚ç‚¹å¿½ç•¥è¯¥å­—æ®µï¼Œæ–°èŠ‚ç‚¹é€æ­¥å¼ºåˆ¶æ ¡éªŒï¼Œæœ€ç»ˆæ¨åŠ¨å…¨ç½‘å‡çº§ã€‚ â€Œä¸‰ã€ä¸ç¡¬åˆ†å‰çš„å…³é”®åŒºåˆ« â€Œå…¼å®¹æ€§â€Œï¼šè½¯åˆ†å‰æ–°æ—§èŠ‚ç‚¹å¯å…±å­˜ï¼Œç¡¬åˆ†å‰å¿…ç„¶åˆ†è£‚ã€‚ â€Œå‡çº§æˆæœ¬â€Œï¼šè½¯åˆ†å‰æ— éœ€å¼ºåˆ¶å…¨ç½‘å‡çº§ï¼Œç¡¬åˆ†å‰éœ€æ‰€æœ‰èŠ‚ç‚¹æ›´æ–°ã€‚ è½¯åˆ†å‰é€šè¿‡æ¸©å’Œå‡çº§å¹³è¡¡åˆ›æ–°ä¸ç¨³å®šæ€§ï¼Œæ˜¯åŒºå—é“¾æ¼”åŒ–çš„é‡è¦å·¥å…·ã€‚","tags":["åŒºå—é“¾ã€æ¯”ç‰¹å¸ã€ETH"],"categories":["åŒºå—é“¾"]},{"title":"'ç¤¾åŒºå•†åŸ'","path":"/2025/03/27/ç¤¾åŒºå•†åŸ/","content":"é¡¹ç›®æ¦‚è¿°é¡¹ç›®ç®€ä»‹ä¸»ç•Œé¢ä¸»è¦åŠŸèƒ½é¡¹ç›®ç‰¹ç‚¹éœ€æ±‚åˆ†æåŠŸèƒ½éœ€æ±‚ç”¨æˆ·æ³¨å†Œç”¨æˆ·ç™»å½•éªŒè¯ç å›¾å½¢éªŒè¯ç çŸ­ä¿¡éªŒè¯ç ä¸Šä¼ ç”¨æˆ·å¤´åƒéåŠŸèƒ½éœ€æ±‚ç”¨æˆ·è§’è‰²ç³»ç»Ÿæ¶æ„è®¾è®¡æŠ€æœ¯é€‰å‹æœ¬åœ°å­˜å‚¨ä¸ OSS ç»´åº¦ æœ¬åœ°å­˜å‚¨ OSSï¼ˆå¯¹è±¡å­˜å‚¨æœåŠ¡ï¼‰ æˆæœ¬ åˆæœŸæŠ•èµ„å¤§ï¼Œç¡¬ä»¶è´­ä¹°å’Œè¿ç»´æˆæœ¬é«˜ã€‚ æŒ‰éœ€ä»˜è´¹ï¼ŒæŒ‰å­˜å‚¨é‡å’Œæµé‡è®¡è´¹ï¼ŒåˆæœŸæ— å¤§é¢æŠ•èµ„ã€‚ å¯æ‰©å±•æ€§ æ‰©å±•æœ‰é™ï¼Œå¢åŠ å­˜å‚¨ç©ºé—´å’Œå¸¦å®½éœ€è¦ç¡¬ä»¶æŠ•å…¥ã€‚ å¼¹æ€§æ‰©å±•ï¼ŒæŒ‰éœ€æ‰©å±•ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„ã€‚ å¯é æ€§ å®¹é”™èƒ½åŠ›æœ‰é™ï¼Œéœ€è¦è‡ªè¡Œå¤„ç†å†—ä½™å’Œå¤‡ä»½ã€‚ é«˜å¯ç”¨æ€§ï¼Œæ•°æ®å†—ä½™è‡ªåŠ¨å¤„ç†ï¼Œæ”¯æŒå¤šæ•°æ®ä¸­å¿ƒã€‚ å®‰å…¨æ€§ éœ€è¦è‡ªè¡Œç®¡ç†è®¿é—®æ§åˆ¶ã€åŠ å¯†å’Œå¤‡ä»½ç­‰ã€‚ æä¾›å¼ºå¤§çš„åŠ å¯†ã€è®¿é—®æ§åˆ¶ã€èº«ä»½éªŒè¯å’Œå®¡è®¡æ—¥å¿—ã€‚ ç»´æŠ¤ä¸è¿ç»´ éœ€è¦æŠ•å…¥äººåŠ›è¿›è¡Œç¡¬ä»¶å’Œè½¯ä»¶çš„ç»´æŠ¤ã€ä¿®å¤ã€‚ ç”±äº‘å‚å•†è´Ÿè´£ç¡¬ä»¶å’Œè½¯ä»¶çš„ç»´æŠ¤ï¼Œè‡ªåŠ¨ä¿®å¤æ•…éšœã€‚ æ•°æ®è®¿é—® å±€åŸŸç½‘è®¿é—®è¾ƒå¿«ï¼Œè·¨åœ°åŸŸè®¿é—®è¾ƒæ…¢ã€‚ å…¨çƒåˆ†å¸ƒï¼Œä½å»¶è¿Ÿï¼Œé€‚åˆè·¨åœ°åŸŸã€å¤§è§„æ¨¡è®¿é—®ã€‚ çµæ´»æ€§ é…ç½®å’Œæ‰©å±•å¤æ‚ï¼Œçµæ´»æ€§è¾ƒä½ã€‚ é«˜çµæ´»æ€§ï¼Œæ”¯æŒä¸åŒç±»å‹çš„æ•°æ®å­˜å‚¨å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚ åˆè§„æ€§ éœ€è¦è‡ªè¡Œç®¡ç†åˆè§„è¦æ±‚å’Œå®¡è®¡ã€‚ äº‘å‚å•†æä¾›åˆè§„æ”¯æŒï¼Œå¦‚ GDPRã€ISO ç­‰ã€‚ ä½¿ç”¨å¤æ‚åº¦ é…ç½®å’Œç®¡ç†å¤æ‚ï¼Œéœ€è¦ä¸“ä¸šæŠ€æœ¯äººå‘˜ã€‚ ä½¿ç”¨ç®€å•ï¼Œé€šè¿‡ Web æ§åˆ¶å°æˆ– API è¿›è¡Œç®¡ç†ã€‚ ç¾éš¾æ¢å¤ éœ€è¦è‡ªè¡Œè®¾è®¡å¤‡ä»½å’Œæ¢å¤æ–¹æ¡ˆã€‚ è‡ªåŠ¨åŒ–å¤‡ä»½å’Œæ¢å¤ï¼Œæ”¯æŒå¼‚åœ°ç¾éš¾æ¢å¤ã€‚ æ€»ç»“ï¼š æœ¬åœ°å­˜å‚¨ é€‚åˆå¯¹æ•°æ®æ§åˆ¶ã€æ€§èƒ½æœ‰é«˜åº¦è¦æ±‚çš„åœºæ™¯ï¼Œä½†æˆæœ¬ã€è¿ç»´ã€æ‰©å±•ç­‰æ–¹é¢å­˜åœ¨ä¸€å®šçš„æŒ‘æˆ˜ã€‚ OSS æä¾›äº†æ›´é«˜çš„å¼¹æ€§ã€å¯æ‰©å±•æ€§å’Œä¾¿æ·æ€§ï¼Œé€‚åˆå­˜å‚¨é‡å¤§ã€éœ€è¦å…¨çƒè®¿é—®æˆ–äº‘è®¡ç®—é›†æˆçš„åº”ç”¨ï¼Œæˆæœ¬ç›¸å¯¹è¾ƒä½ï¼Œè¿ç»´å‹åŠ›å°ã€‚ æ ¹æ®å¯¹æ¯”å­˜å‚¨æ¨èä½¿ç”¨é˜¿é‡Œäº‘ OSSã€‚ ç³»ç»Ÿæ¶æ„å›¾æ¨¡å—åˆ’åˆ†æ•°æ®åº“è®¾è®¡ER å›¾è¡¨ç»“æ„è®¾è®¡æ¥å£æ–‡æ¡£æ¥å£è§„èŒƒæ¥å£åˆ—è¡¨é¡¹ç›®éƒ¨ç½²é¡¹ç›®ç¯å¢ƒéƒ¨ç½²æ–‡æ¡£å¼€å‘è¿›åº¦é¡¹ç›®åˆ›å»ºåˆå§‹åŒ– åˆ›å»º Maven èšåˆå·¥ç¨‹ circle-shoppom.xml ?xml version=1.0 encoding=UTF-8?project xmlns=http://maven.apache.org/POM/4.0.0 xmlns:xsi=http://www.w3.org/2001/XMLSchema-instance xsi:schemaLocation=http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd modelVersion4.0.0/modelVersion groupIdgithub.lianyutian.cshop/groupId artifactIdcircle-shop/artifactId version1.0-SNAPSHOT/version packagingpom/packaging modules modulecshop-common/module modulecshop-user/module /modules properties java.version17/java.version maven.compiler.source17/maven.compiler.source maven.compiler.target17/maven.compiler.target project.build.sourceEncodingUTF-8/project.build.sourceEncoding !-- ç‰ˆæœ¬åŒ¹é…è¯´æ˜ -- !-- https://sca.aliyun.com/docs/2023/overview/version-explain/?spm=5176.29160081.0.0.74805c72WoVfdt -- !-- æŒ‡å®š SpringBoot ç‰ˆæœ¬ -- spring.boot.version3.2.4/spring.boot.version !-- æŒ‡å®š SpringCloud ç‰ˆæœ¬ -- spring.cloud.version2023.0.1/spring.cloud.version !-- æŒ‡å®š SpringCloudAlibaba ç‰ˆæœ¬ -- alibaba.cloud.version2023.0.1.0/alibaba.cloud.version !-- æŒ‡å®š lombok ç‰ˆæœ¬ -- lombok.version1.18.26/lombok.version !-- é€šç”¨å·¥å…·åŒ…ç‰ˆæœ¬ -- commons-lang3.version3.14.0/commons-lang3.version !-- gson ç‰ˆæœ¬ -- gson.version2.10.1/gson.version /properties dependencyManagement dependencies dependency groupIdorg.springframework.boot/groupId artifactIdspring-boot-dependencies/artifactId version$spring.boot.version/version typepom/type scopeimport/scope /dependency dependency groupIdorg.springframework.cloud/groupId artifactIdspring-cloud-dependencies/artifactId version$spring.cloud.version/version typepom/type scopeimport/scope /dependency dependency groupIdcom.alibaba.cloud/groupId artifactIdspring-cloud-alibaba-dependencies/artifactId version$alibaba.cloud.version/version typepom/type scopeimport/scope /dependency dependency groupIdorg.projectlombok/groupId artifactIdlombok/artifactId version$lombok.version/version /dependency dependency groupIdorg.apache.commons/groupId artifactIdcommons-lang3/artifactId version$commons-lang3.version/version /dependency dependency groupIdcom.google.code.gson/groupId artifactIdgson/artifactId version$gson.version/version /dependency /dependencies /dependencyManagement !-- åŠ å¿«ä»£ç åº“ä¸‹è½½ï¼Œ è¿™é‡Œä½¿ç”¨é˜¿é‡Œäº‘é•œåƒä»“åº“-- repositories repository idmaven-ali/id urlhttp://maven.aliyun.com/nexus/content/groups/public///url releases enabledtrue/enabled /releases snapshots enabledtrue/enabled updatePolicyalways/updatePolicy checksumPolicyfail/checksumPolicy /snapshots /repository /repositories pluginRepositories pluginRepository idpublic/id namealiyun nexus/name urlhttp://maven.aliyun.com/nexus/content/groups/public//url releases enabledtrue/enabled /releases snapshots enabledfalse/enabled /snapshots /pluginRepository /pluginRepositories !-- springboot æ‰“åŒ… docker é•œåƒä½¿ç”¨ -- build plugins plugin groupIdorg.springframework.boot/groupId artifactIdspring-boot-maven-plugin/artifactId version$spring.boot.version/version configuration addResourcestrue/addResources /configuration /plugin /plugins /build/project åˆ›å»ºå­æ¨¡å—é€šç”¨å·¥ç¨‹ cshop-commoncshop-commonpom.xml ?xml version=1.0 encoding=UTF-8?project xmlns=http://maven.apache.org/POM/4.0.0 xmlns:xsi=http://www.w3.org/2001/XMLSchema-instance xsi:schemaLocation=http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd modelVersion4.0.0/modelVersion parent groupIdgithub.lianyutian.cshop/groupId artifactIdcircle-shop/artifactId version1.0-SNAPSHOT/version /parent groupIdgithub.lianyutian.cshop.common/groupId artifactIdcshop-common/artifactId properties maven.compiler.source17/maven.compiler.source maven.compiler.target17/maven.compiler.target project.build.sourceEncodingUTF-8/project.build.sourceEncoding /properties dependencies dependency groupIdorg.projectlombok/groupId artifactIdlombok/artifactId /dependency dependency groupIdorg.springframework.boot/groupId artifactIdspring-boot-starter-web/artifactId /dependency dependency groupIdorg.apache.commons/groupId artifactIdcommons-lang3/artifactId /dependency dependency groupIdcom.google.code.gson/groupId artifactIdgson/artifactId /dependency /dependencies/project ç»Ÿä¸€å·¥å…·ç±»ä¸šåŠ¡çŠ¶æ€ç æšä¸¾ cshop-commonsrcmainJavagithublianyutiancshopcommonenumsBizCodeEnum.Java package github.lianyutian.cshop.common.enums;import lombok.Getter;/** * ç»Ÿä¸€ä¸šåŠ¡æšä¸¾çŠ¶æ€ç  * * @author lianyutian * @since 2024-12-13 13:27:13 * @version 1.0 * p æ•´ä¸ªçŠ¶æ€ç æ€»å…± 7 ä½ï¼Œå‰ 3 ä½è¡¨ç¤ºã€Œä¸šåŠ¡å¾®æœåŠ¡ã€çŠ¶æ€ç ï¼Œå 4 ä½è¡¨ç¤ºã€ŒæœåŠ¡å†…éƒ¨æ¥å£ã€çŠ¶æ€ç ï¼Œåç»­éœ€è¦å†è¿›è¡Œæ‹†åˆ†ã€‚ * å…¬å…±æ“ä½œï¼š110ã€‚ * ç”¨æˆ·æœåŠ¡ï¼š210ï¼Œ */@Getterpublic enum BizCodeEnum /** é€šç”¨æ“ä½œç  */ COMMON_OP_REPEAT(110001, é‡å¤æ“ä½œ), COMMON_PARAM_ERROR(110002, å‚æ•°é”™è¯¯), COMMON_SERVER_ERROR(110003, æœåŠ¡å¼‚å¸¸), COMMON_TOO_MANY_TRY(110004, å½“å‰è®¿é—®äººæ•°è¿‡å¤šï¼Œè¯·ç¨å€™å†è¯•...), /** ç”¨æˆ·å¾®æœåŠ¡éªŒè¯ç ç›¸å…³ 2101 å¼€å¤´ */ USER_PHONE_ERROR(2101001, æ‰‹æœºå·ä¸åˆæ³•), USER_CODE_FAST_LIMITED(2101002, éªŒè¯ç å·²å‘é€ï¼Œè¯·ç¨åå†å‘), USER_CODE_PHONE_ERROR(2101003, æ‰‹æœºéªŒè¯ç é”™è¯¯), USER_CODE_CAPTCHA_ERROR(2101004, å›¾å½¢éªŒè¯ç é”™è¯¯), USER_CODE_EMAIL_ERROR(2101005, é‚®ç®±éªŒè¯ç é”™è¯¯), USER_CODE_SMS_ERROR(2101006, çŸ­ä¿¡éªŒè¯ç é”™è¯¯), USER_CODE_SMS_SEND_ERROR(2101006, çŸ­ä¿¡å‘é€å¤±è´¥è¯·ç¨åé‡è¯•), USER_CODE_SMS_SEND_REPLICATE_ERROR(2101007, çŸ­ä¿¡éªŒè¯ç å·²å‘é€è¯·ç¨åé‡è¯•), USER_CODE_SEND_ERROR(2101008, éªŒè¯ç å‘é€å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•), /** ç”¨æˆ·å¾®æœåŠ¡è´¦å·ç›¸å…³ 2102 å¼€å¤´ */ USER_ACCOUNT_EXIST(2102001, ç”¨æˆ·å·²å­˜åœ¨), USER_ACCOUNT_UNREGISTER(2102002, ç”¨æˆ·ä¸å­˜åœ¨), USER_ACCOUNT_PWD_ERROR(2102003, ç”¨æˆ·è´¦å·æˆ–å¯†ç é”™è¯¯), USER_REFRESH_TOKEN_EMPTY(2102004, è¯·é‡æ–°ç™»å½•), USER_ACCOUNT_UNLOGIN(2102005, ç”¨æˆ·è´¦å·æœªç™»å½•), USER_LOGIN_SUCCESS(0, ç”¨æˆ·ç™»å½•æˆåŠŸ), USER_UPDATE_LOCK_FAIL(2102006, ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯è·å–é”å¤±è´¥), USER_INFO_SHOW_LOCK_FAIL(2102007, è¯»å–ç”¨æˆ·ä¿¡æ¯è·å–é”å¤±è´¥), /** ç”¨æˆ·å¾®æœåŠ¡ä¸Šä¼ ç›¸å…³ 2103 å¼€å¤´ */ USER_AVATAR_FILE_UPLOAD_ERROR(2103001, ç”¨æˆ·å¤´åƒä¸Šä¼ å¤±è´¥), /** ç”¨æˆ·å¾®æœåŠ¡æ”¶è´§åœ°å€ç›¸å…³ 2104 å¼€å¤´ */ USER_ADDRESS_NOT_EXITS(2104001, æ”¶è´§åœ°å€ä¸å­˜åœ¨), USER_ADDRESS_ADD_FAIL(2104002, æ–°å¢æ”¶è´§åœ°å€å¤±è´¥), USER_ADDRESS_DEL_FAIL(2104003, åˆ é™¤æ”¶è´§åœ°å€å¤±è´¥), /** ç”¨æˆ·å…³æ³¨ã€å–æ¶ˆ 2105 å¼€å¤´ åšä¸»å…³æ³¨ã€å–æ¶ˆ */ USER_FOLLOWER_NOT_SELF(2105001, ä¸èƒ½å…³æ³¨è‡ªå·±å“¦), USER_UN_FOLLOWER_NOT_SELF(2105002, ä¸èƒ½å–å…³è‡ªå·±å“¦), USER_FOLLOWED(2105003, å·²ç»å…³æ³¨è¿‡äº†å“¦), USER_UN_FOLLOWED(2105004, å·²ç»å–å…³è¿‡äº†å“¦), USER_ATTENTION_NOT_SELF(2105005, åšä¸»ä¸èƒ½å…³æ³¨è‡ªå·±å“¦), USER_UN_ATTENTION_NOT_SELF(2105006, åšä¸»ä¸èƒ½å–å…³è‡ªå·±å“¦), USER_ATTENTED(2105007, å·²ç»å…³æ³¨è¿‡äº†å“¦), USER_UN_ATTENTED(2105008, å·²ç»å–å…³è¿‡äº†å“¦), USER_FOLLOWER_SUCCESS(0, å…³æ³¨æˆåŠŸ), USER_UN_FOLLOWER_SUCCESS(0, å–å…³æˆåŠŸ), USER_ATTENTION_SUCCESS(0, å…³æ³¨æˆåŠŸ), USER_UN_ATTENTION_SUCCESS(0, å–å…³æˆåŠŸ), USER_FOLLOWER_INFO_LOCK_FAIL(2105009, æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å…³æ³¨é”å¤±è´¥), /** ç”¨æˆ·ç¬”è®°ç›¸å…³ 2106 å¼€å¤´ */ NOTE_NOT_EXITS(2106001, ç¬”è®°ä¸å­˜åœ¨), NOTE_ADD_FAIL(2104002, æ–°å¢ç¬”è®°å¤±è´¥), NOTE_DEL_FAIL(2104003, åˆ é™¤ç¬”è®°å¤±è´¥), NOTE_UPDATE_FAIL(2102004, ç¬”è®°æ›´æ–°å¤±è´¥), NOTE_UPDATE_LOCK_FAIL(2104006, ä¿®æ”¹ç¬”è®°ä¿¡æ¯è·å–é”å¤±è´¥), NOTE_INFO_LOCK_FAIL(2102007, è¯»å–ç¬”è®°ä¿¡æ¯è·å–é”å¤±è´¥); /** é”™è¯¯ä¿¡æ¯ */ private final String message; /** çŠ¶æ€ç  */ private final int code; /** * ç¼–ç  * * @param code çŠ¶æ€ç  * @param message é”™è¯¯ä¿¡æ¯ */ BizCodeEnum(int code, String message) this.code = code; this.message = message; ç»Ÿä¸€æ¥å£å“åº” cshop-commonsrcmainJavagithublianyutiancshopcommonmodelApiResult.Java package github.lianyutian.cshop.common.model;import github.lianyutian.cshop.common.enums.BizCodeEnum;import lombok.AllArgsConstructor;import lombok.Data;import lombok.NoArgsConstructor;/** * æ¥å£ç»Ÿä¸€å“åº”å°è£… * * @author lianyutian * @since 2024-12-13 13:40:47 * @version 1.0 */@Data@AllArgsConstructor@NoArgsConstructorpublic class ApiResultT /** æ¥å£å“åº”çŠ¶æ€ç  0 è¡¨ç¤ºæˆåŠŸ å…¶ä»–è¡¨ç¤ºå¤±è´¥ */ private Integer code; /** æ•°æ® */ private T data; /** æè¿° */ private String msg; /** * æˆåŠŸå“åº” * * @return @see ApiResult */ public static T ApiResultT success() return new ApiResult(0, null, null); /** * æˆåŠŸå“åº”ï¼Œä¼ å…¥æ•°æ® * * @param data æ¥å£æ•°æ® * @return @see ApiResult */ public static T ApiResultT success(T data) return new ApiResult(0, data, null); /** * å¤±è´¥å“åº” * * @param code çŠ¶æ€ç  * @return @see ApiResult */ public static T ApiResultT error(Integer code, String msg) return new ApiResult(code, null, msg); /** * è‡ªå®šä¹‰çŠ¶æ€ç å’Œé”™è¯¯ä¿¡æ¯ * * @param code çŠ¶æ€ç  * @param msg é”™è¯¯ä¿¡æ¯ * @return @see ApiResult */ public static T ApiResultT buildResult(int code, String msg) return new ApiResult(code, null, msg); /** * é€šè¿‡æšä¸¾è¿”å› * * @param bizCodeEnum ä¸šåŠ¡æšä¸¾çŠ¶æ€ç  * @return @see ApiResult */ public static T ApiResultT result(BizCodeEnum bizCodeEnum) return ApiResult.buildResult(bizCodeEnum.getCode(), bizCodeEnum.getMessage()); ä¸šåŠ¡å¼‚å¸¸ç±» cshop-commonsrcmainJavagithublianyutiancshopcommonexceptionBizException.Java package github.lianyutian.cshop.common.exception;import github.lianyutian.cshop.common.enums.BizCodeEnum;import lombok.Data;import lombok.EqualsAndHashCode;/** * ä¸šåŠ¡å¼‚å¸¸ * * @author lianyutian * @since 2024-12-13 13:54:35 * @version 1.0 */@EqualsAndHashCode(callSuper = false)@Datapublic class BizException extends RuntimeException /** é»˜è®¤é”™è¯¯ç  */ private static final int DEFAULT_ERROR_CODE = -1; /** å¼‚å¸¸ code ç  */ private int code; /** å¼‚å¸¸æ¶ˆæ¯ */ private String message; /** * æ ¹æ® codeã€message è¿”å›å¼‚å¸¸ä¿¡æ¯ * * @param code é”™è¯¯ç  * @param message å¼‚å¸¸æ¶ˆæ¯ */ public BizException(int code, String message) super(message); this.code = code; this.message = message; /** æ ¹æ® BizCode è¿”å›å¼‚å¸¸ä¿¡æ¯ */ public BizException(BizCodeEnum bizCodeEnum) super(bizCodeEnum.getMessage()); this.code = bizCodeEnum.getCode(); this.message = bizCodeEnum.getMessage(); /** * æ ¹æ® errMsg è¿”å›å¼‚å¸¸ä¿¡æ¯ * * @param errorMsg é”™è¯¯ä¿¡æ¯ */ public BizException(String errorMsg) super(errorMsg); this.code = DEFAULT_ERROR_CODE; this.message = errorMsg; å…¨å±€å¼‚å¸¸å¤„ç† cshop-commonsrcmainJavagithublianyutiancshopcommonexceptionGlobalExceptionHandler.Java package github.lianyutian.cshop.common.exception;import github.lianyutian.cshop.common.model.ApiResult;import lombok.extern.slf4j.Slf4j;import org.springframework.http.HttpStatus;import org.springframework.web.bind.annotation.ControllerAdvice;import org.springframework.web.bind.annotation.ExceptionHandler;import org.springframework.web.bind.annotation.ResponseBody;/** * å…¨å±€å¼‚å¸¸å¤„ç† * * @author lianyutian * @since 2024-12-13 14:04:58 * @version 1.0 */@ControllerAdvice@Slf4jpublic class GlobalExceptionHandler @ExceptionHandler(value = Exception.class) @ResponseBody public ApiResultString handle(Exception e) // åˆ¤æ–­æ˜¯å¦æ˜¯ä¸šåŠ¡å¼‚å¸¸è¿˜æ˜¯éä¸šåŠ¡å¼‚å¸¸ if (e instanceof BizException bizException) log.error([è¿™é‡Œæ˜¯ä¸šåŠ¡å¼‚å¸¸ä¿¡æ¯]ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹: , e.getMessage(), e); return ApiResult.error(bizException.getCode(), bizException.getMessage()); else log.info([è¿™é‡Œæ˜¯ç³»ç»Ÿå¼‚å¸¸ä¿¡æ¯ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹: ], e.getMessage(), e); return ApiResult.error(HttpStatus.INTERNAL_SERVER_ERROR.value(), æœåŠ¡å¼‚å¸¸è¯·ç¨åé‡è¯•); é€šç”¨å·¥å…·ç±»JsonUtil cshop-commonsrcmainJavagithublianyutiancshopcommonutilsJsonUtil.Java package github.lianyutian.cshop.common.utils;import com.google.gson.Gson;import com.google.gson.JsonSyntaxException;import lombok.extern.slf4j.Slf4j;/** * Json å·¥å…·ç±» * * @author lianyutian * @since 2024-12-27 14:25:42 * @version 1.0 */@Slf4jpublic class JsonUtil private static final Gson GSON = new Gson(); /** * å°†å¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸² * * @param object éœ€è¦è½¬æ¢çš„å¯¹è±¡ * @return JSON å­—ç¬¦ä¸² * @throws IllegalArgumentException å¦‚æœè¾“å…¥å¯¹è±¡ä¸º null */ public static String toJson(Object object) if (object == null) throw new IllegalArgumentException(Input object cannot be null); return GSON.toJson(object); /** * å°† JSON å­—ç¬¦ä¸²è½¬æ¢ä¸ºæŒ‡å®šç±»å‹çš„å¯¹è±¡ * * @param json JSON å­—ç¬¦ä¸² * @param clazz ç›®æ ‡ç±»å‹ * @param T æ³›å‹ç±»å‹ * @return è½¬æ¢åçš„å¯¹è±¡ * @throws IllegalArgumentException å¦‚æœè¾“å…¥ JSON å­—ç¬¦ä¸²ä¸º null æˆ–ç©º * @throws JsonSyntaxException å¦‚æœ JSON å­—ç¬¦ä¸²æ ¼å¼ä¸æ­£ç¡® */ public static T T fromJson(String json, ClassT clazz) if (json == null || json.trim().isEmpty()) throw new IllegalArgumentException(Input JSON string cannot be null or empty); try return GSON.fromJson(json, clazz); catch (JsonSyntaxException e) log.error(Failed to parse JSON string: , json, e); throw e; CommonUtil cshop-commonsrcmainJavagithublianyutiancshopcommonutilsCommonUtil.Java package github.lianyutian.cshop.common.utils;import github.lianyutian.cshop.common.exception.BizException;import github.lianyutian.cshop.common.model.ApiResult;import jakarta.servlet.http.HttpServletRequest;import jakarta.servlet.http.HttpServletResponse;import java.io.IOException;import java.io.PrintWriter;import java.net.InetAddress;import java.net.UnknownHostException;import java.nio.charset.StandardCharsets;import java.security.MessageDigest;import java.security.NoSuchAlgorithmException;import java.util.Random;import java.util.UUID;import lombok.extern.slf4j.Slf4j;/** * é€šç”¨å·¥å…·ç±» * * @author lianyutian * @since 2024-12-17 14:57:04 * @version 1.0 */@Slf4jpublic class CommonUtil /** åŠ å¯†ä¸² */ private static final String SECRET_STRING = ./0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz; /** * è·å–å®¢æˆ·ç«¯ ip * * @param request HTTP è¯·æ±‚å¯¹è±¡ï¼Œç”¨äºè·å–å®¢æˆ·ç«¯ IP åœ°å€ * @return å®¢æˆ·ç«¯çš„ IP åœ°å€ * @throws RuntimeException å¦‚æœè·å– IP åœ°å€å¤±è´¥ */ public static String getRemoteIpAddr(HttpServletRequest request) String ipAddress; try // å°è¯•ä»è¯·æ±‚å¤´ä¸­è·å–å®¢æˆ·ç«¯ IP åœ°å€ ipAddress = request.getHeader(x-forwarded-for); if (ipAddress == null || ipAddress.isEmpty() || unknown.equalsIgnoreCase(ipAddress)) ipAddress = request.getHeader(Proxy-Client-IP); if (ipAddress == null || ipAddress.isEmpty() || unknown.equalsIgnoreCase(ipAddress)) ipAddress = request.getHeader(WL-Proxy-Client-IP); if (ipAddress == null || ipAddress.isEmpty() || unknown.equalsIgnoreCase(ipAddress)) // å¦‚æœè¯·æ±‚å¤´ä¸­æ²¡æœ‰ IP åœ°å€ä¿¡æ¯ï¼Œåˆ™ç›´æ¥è·å–è¿œç¨‹åœ°å€ ipAddress = request.getRemoteAddr(); if (127.0.0.1.equals(ipAddress)) // å¦‚æœæ˜¯æœ¬åœ°åœ°å€ï¼Œåˆ™å°è¯•è·å–æœ¬åœ°ä¸»æœºçš„ IP åœ°å€ InetAddress inet = InetAddress.getLocalHost(); ipAddress = inet.getHostAddress(); // å¤„ç†é€šè¿‡å¤šä¸ªä»£ç†çš„æƒ…å†µï¼Œæå–å‡ºçœŸå®çš„å®¢æˆ·ç«¯ IP åœ°å€ if (ipAddress != null ipAddress.length() 15) if (ipAddress.indexOf(,) 0) ipAddress = ipAddress.substring(0, ipAddress.indexOf(,)); if (ipAddress == null || ipAddress.isEmpty()) throw new RuntimeException(Failed to get remote IP address); catch (UnknownHostException e) log.error(e.getMessage(), e); throw new RuntimeException(Failed to get local host IP address, e); catch (Exception e) log.error(e.getMessage(), e); throw new RuntimeException(Failed to get remote IP address, e); return ipAddress; /** * MD5 åŠ å¯† * * @param data éœ€è¦åŠ å¯†çš„æ•°æ® * @return åŠ å¯†åçš„æ•°æ® * @throws RuntimeException å¦‚æœåŠ å¯†å¤±è´¥ */ public static String MD5(String data) try // åˆ›å»º MD5 åŠ å¯†å™¨å®ä¾‹ MessageDigest md = MessageDigest.getInstance(MD5); // å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†å¤„ç† byte[] array = md.digest(data.getBytes(StandardCharsets.UTF_8)); StringBuilder sb = new StringBuilder(); for (byte item : array) // å°†åŠ å¯†åçš„å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸² sb.append(Integer.toHexString((item 0xFF) | 0x100), 1, 3); // è¿”å›åŠ å¯†åçš„å­—ç¬¦ä¸² return sb.toString().toUpperCase(); catch (NoSuchAlgorithmException e) log.error(e.getMessage(), e); throw new RuntimeException(Failed to create MD5 digest, e); /** * ç”ŸæˆæŒ‡å®šé•¿åº¦çš„æ•°å­—éªŒè¯ç  * * @param length éªŒè¯ç çš„é•¿åº¦ * @return ç”Ÿæˆçš„æ•°å­—éªŒè¯ç  */ public static String getRandomCode(int length) String numbers = 0123456789; StringBuilder sb = new StringBuilder(); for (int i = 0; i length; i++) int index = (int) (Math.random() * numbers.length()); sb.append(numbers.charAt(index)); return sb.toString(); /** * è·å–å½“å‰æ—¶é—´æˆ³ * * @return å½“å‰æ—¶é—´æˆ³ */ public static long getCurrentTimestamp() return System.currentTimeMillis(); /** * ç”Ÿæˆ UUID * * @return ç”Ÿæˆçš„ UUID å­—ç¬¦ä¸² */ public static String generateUUID() return UUID.randomUUID().toString().replace(-, ); /** * å‘å®¢æˆ·ç«¯å‘é€ HTTP å“åº” æ­¤æ–¹æ³•ç”¨äºå°†ç»™å®šçš„ ApiResult å¯¹è±¡åºåˆ—åŒ–ä¸º JSON æ ¼å¼ * * p å¹¶é€šè¿‡ HttpServletResponse å¯¹è±¡å°†å…¶ä½œä¸º HTTP å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ å®ƒå¤„ç†å“åº”çš„åºåˆ—åŒ–å’Œå‘é€è¿‡ç¨‹ï¼Œå¹¶è®°å½•ç›¸å…³æ—¥å¿— * * @param response ç”¨äºå‘é€å“åº”çš„ HttpServletResponse å¯¹è±¡ * @param result è¦åºåˆ—åŒ–å¹¶å‘é€çš„ ApiResult å¯¹è±¡ */ public static void sendResponse(HttpServletResponse response, ApiResultVoid result) // è®¾ç½®å“åº”å¤´ response.setContentType(application/json; charset=utf-8); String jsonResponse; try // å°† ApiResult å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸² jsonResponse = JsonUtil.toJson(result); catch (Exception e) // è®°å½•åºåˆ—åŒ–å¼‚å¸¸ä¿¡æ¯ log.warn(åºåˆ—åŒ–å“åº”æ•°æ®å¼‚å¸¸ï¼š, e.getMessage(), e); // å¦‚æœåºåˆ—åŒ–å¤±è´¥ï¼ŒæŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸ throw new BizException(åºåˆ—åŒ–å“åº”æ•°æ®å¤±è´¥); try (PrintWriter writer = response.getWriter()) // å†™å‡ºå“åº” writer.print(jsonResponse); // åˆ·æ–°å“åº”ç¼“å†²åŒºï¼Œç¡®ä¿å“åº”è¢«å‘é€ response.flushBuffer(); catch (IOException e) // è®°å½•å‘é€å“åº”å¼‚å¸¸ä¿¡æ¯ log.warn(è¿”å›å“åº”ç»™å‰ç«¯å¼‚å¸¸ï¼š, e.getMessage(), e); // å¦‚æœå‘é€å“åº”å¤±è´¥ï¼ŒæŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸ throw new BizException(è¿”å›å“åº”ç»™å‰ç«¯å¤±è´¥); // å¦‚æœå¯ç”¨äº†ä¿¡æ¯çº§åˆ«æ—¥å¿—è®°å½•ï¼Œè®°å½•å‘é€çš„å“åº”æ•°æ® if (log.isInfoEnabled()) log.info(è¿”å›å“åº”ç»™å‰ç«¯æ•°æ®ï¼š, jsonResponse); /** * ç”ŸæˆåŒºé—´èŒƒå›´å†…çš„éšæœºæ•° * * @param min min * @param max max * @return éšæœºæ•° */ public static int genRandomInt(int min, int max) return genRandomInt(max - min) + min; /** * ç”Ÿæˆéšæœºæ•° * * @param bound bound * @return éšæœºæ•° */ public static int genRandomInt(int bound) return new Random().nextInt(bound); CheckUtil cshop-commonsrcmainJavagithublianyutiancshopcommonutilsCheckUtil.Java package github.lianyutian.cshop.common.utils;import java.util.regex.Matcher;import java.util.regex.Pattern;/** * æ ¡éªŒå·¥å…·ç±» * * @author lianyutian * @since 2024-12-19 13:38:22 * @version 1.0 */public class CheckUtil /** æ‰‹æœºå·æ­£åˆ™ */ private static final Pattern PHONE_PATTERN = Pattern.compile(^((13[0-9])|(15[^4,\\\\D])|(18[0,5-9]))\\\\d8$); /** * æ£€æµ‹æ˜¯å¦æ˜¯æ‰‹æœºå· * * @param phone æ‰‹æœºå· * @return boolean */ public static boolean isPhone(String phone) if (null == phone || .equals(phone)) return false; Matcher m = PHONE_PATTERN.matcher(phone); return m.matches(); BeanUtil cshop-commonsrcmainJavagithublianyutiancshopcommonutilsBeanUtil.Java package github.lianyutian.cshop.common.utils;import java.lang.reflect.Constructor;import java.util.ArrayList;import java.util.List;import java.util.Map;import java.util.concurrent.ConcurrentHashMap;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.BeanUtils;/** * Bean æ‹·è´å·¥å…·ç±» * * @author lianyutian * @since 2025-01-03 15:09:31 * @version 1.0 */@Slf4jpublic class BeanUtil private static final ConstructorCache CONSTRUCTOR_CACHE = new ConstructorCache(); public static T T copy(Object source, ClassT targetClass) if (source == null) return null; T target; try ConstructorT constructor = CONSTRUCTOR_CACHE.getConstructor(targetClass); target = constructor.newInstance(); BeanUtils.copyProperties(source, target); catch (ReflectiveOperationException e) log.error( Failed to copy properties from to , source.getClass().getName(), targetClass.getName(), e); throw new BeanCopyException(Failed to copy properties, e); return target; public static T ListT copyList(List? sourceList, ClassT targetClass) if (sourceList == null || sourceList.isEmpty()) return null; ListT targetList = new ArrayList(sourceList.size()); for (Object source : sourceList) T target = copy(source, targetClass); if (target != null) targetList.add(target); return targetList; private static class ConstructorCache private final MapClass?, Constructor? cache = new ConcurrentHashMap(); @SuppressWarnings(unchecked) public T ConstructorT getConstructor(ClassT clazz) throws ReflectiveOperationException ConstructorT constructor = (ConstructorT) cache.get(clazz); if (constructor == null) synchronized (cache) constructor = (ConstructorT) cache.get(clazz); if (constructor == null) try constructor = clazz.getDeclaredConstructor(); constructor.setAccessible(true); cache.put(clazz, constructor); catch (NoSuchMethodException e) throw new ReflectiveOperationException(e); return constructor; public static class BeanCopyException extends RuntimeException public BeanCopyException(String message, Throwable cause) super(message, cause); Redis pom.xml !-- redisson ç‰ˆæœ¬ --redisson.version3.41.0/redisson.version!-- https://mvnrepository.com/artifact/org.redisson/redisson --dependency groupIdorg.redisson/groupId artifactIdredisson/artifactId version$redisson.version/version/dependency cshop-commonpom.xml dependency groupIdorg.springframework.boot/groupId artifactIdspring-boot-starter-data-redis/artifactId/dependency!-- https://mvnrepository.com/artifact/org.redisson/redisson --dependency groupIdorg.redisson/groupId artifactIdredisson/artifactId/dependencydependencygroupIdorg.springframework.boot/groupIdartifactIdspring-boot-starter-data-redis/artifactId/dependency RedisConfig cshop-commonsrcmainJavagithublianyutiancshopcommonredisRedisConfig.Java package github.lianyutian.cshop.common.redis;import com.fasterxml.jackson.annotation.JsonAutoDetect;import com.fasterxml.jackson.annotation.PropertyAccessor;import com.fasterxml.jackson.databind.ObjectMapper;import org.redisson.Redisson;import org.redisson.api.RedissonClient;import org.redisson.client.codec.StringCodec;import org.redisson.config.Config;import org.springframework.beans.factory.annotation.Value;import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.data.redis.connection.RedisConnectionFactory;import org.springframework.data.redis.core.RedisTemplate;import org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;import org.springframework.data.redis.serializer.StringRedisSerializer;/** * redis å®¢æˆ·ç«¯é…ç½® * * @author lianyutian * @since 2024-12-17 14:36:40 * @version 1.0 */@Configuration@ConditionalOnClass(RedisConnectionFactory.class)// é…ç½®æ˜¯å¦ä½¿ç”¨ redis (enable = true æ—¶éœ€è¦é…ç½® redisï¼Œå¦åˆ™æœåŠ¡å¯åŠ¨æ—¶ä¼šæŠ¥é”™)@ConditionalOnProperty(prefix = spring.data.redis, name = enable, havingValue = true)public class RedisConfig @Value($spring.data.redis.host) private String redisHost; @Value($spring.data.redis.port) private String redisPort; @Value($spring.data.redis.password) private String redisPwd; @Value($spring.data.redis.timeout) private int redisTimeout; /** * é…ç½® RedisTemplate ç”¨äºæ“ä½œ Redis æ•°æ®åº“ * * @param redisConnectionFactory Redis è¿æ¥å·¥å‚ï¼Œç”¨äºåˆ›å»º Redis è¿æ¥ * @return é…ç½®å¥½çš„ RedisTemplate å®ä¾‹ */ @Bean public RedisTemplateObject, Object redisTemplate( RedisConnectionFactory redisConnectionFactory) // å®ä¾‹åŒ– RedisTemplate RedisTemplateObject, Object redisTemplate = new RedisTemplate(); // è®¾ç½®è¿æ¥ redisTemplate.setConnectionFactory(redisConnectionFactory); // é…ç½® Redis åºåˆ—åŒ–è§„åˆ™ // ä½¿ç”¨ Jackson ä½œä¸º JSON å¤„ç†åº“ã€‚è¯¥åºåˆ—åŒ–å™¨å¯ä»¥ç”¨äºå°† Java å¯¹è±¡å­˜å‚¨åˆ° Redis ä¸­æ—¶ï¼Œè‡ªåŠ¨è½¬æ¢ä¸º JSON å­—ç¬¦ä¸² ObjectMapper objectMapper = new ObjectMapper(); Jackson2JsonRedisSerializerObject jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer(objectMapper, Object.class); // è®¾ç½® ObjectMapper çš„å¯è§æ€§ï¼Œä»¥ä¾¿å®ƒå¯ä»¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ‰€æœ‰è®¿é—®çº§åˆ«çš„å±æ€§ objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY); // è®¾ç½® key-value åºåˆ—åŒ–è§„åˆ™ // ä½¿ç”¨ StringRedisSerializer åºåˆ—åŒ– keyï¼Œä»¥ç¡®ä¿ key æ˜¯å­—ç¬¦ä¸²å½¢å¼å­˜å‚¨ // ä½¿ç”¨ Jackson2JsonRedisSerializer åºåˆ—åŒ– valueï¼Œå°† Java å¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²å­˜å‚¨ redisTemplate.setKeySerializer(new StringRedisSerializer()); redisTemplate.setValueSerializer(jackson2JsonRedisSerializer); // è®¾ç½® hash-value åºåˆ—åŒ–è§„åˆ™ // åŒæ ·åœ°ï¼Œä½¿ç”¨ StringRedisSerializer åºåˆ—åŒ– hash çš„ keyï¼Œä½¿ç”¨ Jackson2JsonRedisSerializer åºåˆ—åŒ– hash çš„ value redisTemplate.setHashKeySerializer(new StringRedisSerializer()); redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer); return redisTemplate; /** * å®ä¾‹åŒ– redissonClient * * @return RedissonClient */ @Bean public RedissonClient redissonClient() Config config = new Config(); config .useSingleServer() .setAddress(redis:// + redisHost + : + redisPort) .setPassword(redisPwd) // è®¾ç½®è¿æ¥æ± æœ€å°ç©ºé—²å¤§å° .setConnectionMinimumIdleSize(10) // è®¾ç½®è¿æ¥æ± å¤§å° .setConnectionPoolSize(100) // è®¾ç½®ç©ºé—²é“¾æ¥è¶…æ—¶æ—¶é—´ .setIdleConnectionTimeout(600000) .setSubscriptionConnectionMinimumIdleSize(10) .setSubscriptionConnectionPoolSize(100) // è®¾ç½®è¶…æ—¶æ—¶é—´ .setTimeout(redisTimeout); config.setCodec(new StringCodec()); // è®¾ç½®çº¿ç¨‹æ•° config.setThreads(5); // è®¾ç½® netty çº¿ç¨‹æ•° config.setNettyThreads(5); // å®ä¾‹åŒ– redisson å®¢æˆ·ç«¯ return Redisson.create(config); RedisCache cshop-commonsrcmainJavagithublianyutiancshopcommonredisRedisCache.Java package github.lianyutian.cshop.common.redis;import github.lianyutian.cshop.common.utils.CommonUtil;import github.lianyutian.cshop.common.utils.JsonUtil;import java.util.concurrent.TimeUnit;import lombok.extern.slf4j.Slf4j;import org.springframework.boot.autoconfigure.condition.ConditionalOnBean;import org.springframework.data.redis.core.RedisTemplate;import org.springframework.data.redis.core.ValueOperations;import org.springframework.stereotype.Component;/** * Redis ç¼“å­˜å·¥å…·ç±» * * @author lianyutian * @since 2024-12-27 11:30:30 * @version 1.0 */@Component@ConditionalOnBean(RedisConfig.class)@Slf4jpublic class RedisCache private final RedisTemplateString, String redisTemplate; /** ç¼“å­˜ç©ºæ•°æ® */ public static final String EMPTY_CACHE = ; /** åˆ†å¸ƒå¼é”åŠ é”æ—¶é—´ 200 æ¯«ç§’ */ public static final long UPDATE_LOCK_TIMEOUT = 200; /** ä¸€å°æ—¶æœ‰æ•ˆæœŸ */ public static final Integer ONE_HOUR_SECONDS = 60 * 60; /** ä¸¤å¤©æœ‰æ•ˆæœŸ */ public static final Integer TWO_DAYS_SECONDS = 2 * 24 * 60 * 60; /** ä¸€å¤©æœ‰æ•ˆæœŸ */ public static final Integer ONE_DAY_SECONDS = 24 * 60 * 60; public RedisCache(RedisTemplateString, String redisTemplate) this.redisTemplate = redisTemplate; /** * ç”Ÿæˆç¼“å­˜è¿‡æœŸæ—¶é—´ï¼š2 å¤©åŠ ä¸Šéšæœºå‡ å°æ—¶ï¼Œé˜²æ­¢ç¼“å­˜é›ªå´©ï¼Œç©¿é€æ•°æ®åº“ * * @return è¿”å›è¿‡æœŸæ—¶é—´ */ public static Integer generateCacheExpire() return TWO_DAYS_SECONDS + CommonUtil.genRandomInt(0, 10) * 60 * 60; /** * ç”Ÿæˆç¼“å­˜ç©¿é€è¿‡æœŸæ—¶é—´ï¼Œå•ä½ ç§’ * * @return éšæœº 30 - 100 ç§’ */ public static Integer generateCachePenetrationExpire() return CommonUtil.genRandomInt(30, 100); /** * å†™å…¥ç¼“å­˜ * * @param key key * @param value value * @param seconds è®¾ç½®è¿‡æœŸæ—¶é—´ */ public void set(String key, String value, int seconds) ValueOperationsString, String op = redisTemplate.opsForValue(); try if (seconds 0) // è®¾ç½®ç¼“å­˜æ—¶é—´ op.set(key, value, seconds, TimeUnit.SECONDS); else if (seconds == 0) // æ°¸ä¸è¿‡æœŸ op.set(key, value); else throw new IllegalArgumentException(Expiration time must be a non-negative integer); catch (Exception e) log.error(å†™å…¥ç¼“å­˜å¤±è´¥, key: , value: [REDACTED], key, e); throw new RedisCacheException(å†™å…¥ç¼“å­˜å¤±è´¥, e); /** * å†™å…¥ç¼“å­˜ value ä¸º Object ç±»å‹ * * @param key key * @param value value * @param seconds è¿‡æœŸæ—¶é—´ */ public void set(String key, Object value, int seconds) try // å…ˆå°† Object è½¬æˆ Json å­—ç¬¦ä¸²å†è¿›è¡Œå­˜å‚¨ this.set(key, JsonUtil.toJson(value), seconds); catch (Exception e) log.error(å†™å…¥ç¼“å­˜å¤±è´¥, key: , value: [REDACTED], key, e); throw new RedisCacheException(å†™å…¥ç¼“å­˜å¤±è´¥, e); /** * è¯»å–ç¼“å­˜ * * @param key key * @return ç¼“å­˜æ•°æ® */ public String get(String key) try ValueOperationsString, String op = redisTemplate.opsForValue(); return op.get(key); catch (Exception e) log.error(è¯»å–ç¼“å­˜å¤±è´¥, key: , key, e); throw new RedisCacheException(è¯»å–ç¼“å­˜å¤±è´¥, e); /** * åˆ é™¤ç¼“å­˜ * * @param key key * @return åˆ é™¤æˆåŠŸè¿”å› trueï¼Œå¦åˆ™è¿”å› false */ public boolean delete(String key) try return Boolean.TRUE.equals(redisTemplate.delete(key)); catch (Exception e) log.error(åˆ é™¤ç¼“å­˜å¤±è´¥, key: , key, e); throw new RedisCacheException(åˆ é™¤ç¼“å­˜å¤±è´¥, e); /** * è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´ * * @param key key * @param seconds è¿‡æœŸæ—¶é—´ */ public void expire(String key, Integer seconds) if (key == null || key.isEmpty()) throw new IllegalArgumentException(Key cannot be null or empty); if (seconds == null || seconds 0) throw new IllegalArgumentException(Expiration time must be a non-negative integer); try redisTemplate.expire(key, seconds, TimeUnit.SECONDS); catch (Exception e) log.error(Failed to set expiration for key: , key, e); throw new RedisCacheException(Failed to set expiration for key: + key, e); /** * è·å–ç¼“å­˜è¿‡æœŸæ—¶é—´ * * @param key key * @param timeUnit æ—¶é—´ç±»å‹ * @return è¿‡æœŸæ—¶é—´ */ public Long getExpire(String key, TimeUnit timeUnit) if (key == null || key.isEmpty()) throw new IllegalArgumentException(Key cannot be null or empty); try return redisTemplate.getExpire(key, timeUnit); catch (Exception e) log.error(Failed to get expiration for key: , key, e); throw new RedisCacheException(Failed to get expiration for key: + key, e); /** * è·å–æ•´æ•°å€¼ * * @param key key * @return ç¼“å­˜æ•°æ® */ public Long getLong(String key) if (key == null || key.isEmpty()) throw new IllegalArgumentException(Key cannot be null or empty); try ValueOperationsString, String op = redisTemplate.opsForValue(); String value = op.get(key); return value != null ? Long.parseLong(value) : null; catch (NumberFormatException e) log.error(Failed to parse integer value for key: , key, e); throw new RedisCacheException(Failed to parse integer value for key: + key, e); catch (Exception e) log.error(Failed to get integer value for key: , key, e); throw new RedisCacheException(Failed to get integer value for key: + key, e); /** * å¢åŠ ç¼“å­˜å€¼ * * @param key key * @param delta å¢åŠ çš„å€¼ */ public void increment(String key, int delta) try ValueOperationsString, String op = redisTemplate.opsForValue(); op.increment(key, delta); catch (Exception e) log.error(Failed to increment value for key: , key, e); throw new RedisCacheException(Failed to increment value for key: + key, e); class RedisCacheException extends RuntimeException public RedisCacheException(String message, Throwable cause) super(message, cause); RedisLock cshop-commonsrcmainJavagithublianyutiancshopcommonredisRedisLock.Java package github.lianyutian.cshop.common.redis;import java.util.concurrent.TimeUnit;import org.redisson.api.RLock;import org.redisson.api.RedissonClient;import org.springframework.boot.autoconfigure.condition.ConditionalOnBean;import org.springframework.stereotype.Component;/** * Redis åˆ†å¸ƒå¼é” * * @author lianyutian * @since 2024-12-27 11:30:30 * @version 1.0 */@Component@ConditionalOnBean(RedissonClient.class)public class RedisLock /** åˆ†å¸ƒå¼é”åŠ é”æ—¶é—´ 200 æ¯«ç§’ */ public static final long UPDATE_LOCK_TIMEOUT = 200; private final RedissonClient redissonClient; public RedisLock(RedissonClient redissonClient) this.redissonClient = redissonClient; /** * redisson äº’æ–¥é”ï¼Œç­‰å¾… seconds ç§’åè‡ªåŠ¨å¤±æ•ˆ * * @param key key * @param seconds ç§’ * @return åŠ é”ç»“æœ */ public boolean lock(String key, int seconds) // å…ˆè·å–åˆ†å¸ƒå¼é” RLock rLock = redissonClient.getLock(key); // å¦‚æœå·²ç»åŠ é”äº†è¿”å› false if (rLock.isLocked()) return false; // åŠ é”ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´å†…æ²¡é‡Šæ”¾é”ï¼Œå®ƒä¼šè‡ªåŠ¨åœ¨åº•å±‚æŠŠé”é‡Šæ”¾æ‰ rLock.lock(seconds, TimeUnit.SECONDS); // åŠ é”æˆåŠŸè¿”å› true return true; /** * redisson äº’æ–¥é”ï¼Œè‡ªåŠ¨ç»­æœŸ * * @param key key * @return åŠ é”ç»“æœ */ public boolean lock(String key) // å…ˆè·å–åˆ†å¸ƒå¼é” RLock rLock = redissonClient.getLock(key); // å¦‚æœå·²ç»åŠ é”äº†è¿”å› false if (rLock.isLocked()) return false; // åŠ é” rLock.lock(); // åŠ é”æˆåŠŸè¿”å› true return true; /** * å°è¯•åŠ é” * * @param key key * @param timeout è¶…æ—¶æ—¶é—´ * @return åŠ é”ç»“æœ */ public boolean tryLock(String key, long timeout) throws InterruptedException // å…ˆè·å–åˆ†å¸ƒå¼é” RLock rLock = redissonClient.getLock(key); // å°è¯•åŠ é” return rLock.tryLock(timeout, TimeUnit.MILLISECONDS); /** * æ‰‹åŠ¨é‡Šæ”¾é” * * @param key key */ public void unlock(String key) // å…ˆè·å–åˆ†å¸ƒå¼é” RLock rLock = redissonClient.getLock(key); // å¦‚æœå·²é”å®šï¼Œåˆ™é‡Šæ”¾é” if (rLock.isLocked()) rLock.unlock(); ç”¨æˆ·æ¨¡å—æ–°å»º cshop-userpom.xml ?xml version=1.0 encoding=UTF-8?project xmlns=http://maven.apache.org/POM/4.0.0 xmlns:xsi=http://www.w3.org/2001/XMLSchema-instance xsi:schemaLocation=http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd modelVersion4.0.0/modelVersion parent groupIdgithub.lianyutian.cshop/groupId artifactIdcircle-shop/artifactId version1.0-SNAPSHOT/version /parent groupIdgithub.lianyutian.cshop.user/groupId artifactIdcshop-user/artifactId properties maven.compiler.source17/maven.compiler.source maven.compiler.target17/maven.compiler.target project.build.sourceEncodingUTF-8/project.build.sourceEncoding /properties dependencies dependency groupIdgithub.lianyutian.cshop.common/groupId artifactIdcshop-common/artifactId version1.0-SNAPSHOT/version /dependency /dependencies/project cshop-usersrcmainJavagithublianyutiancshopuserUserApplication.Java package github.lianyutian.cshop.user;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.context.annotation.ComponentScan;/** * ç”¨æˆ·æœåŠ¡å¯åŠ¨ç±» * * @author lianyutian * @since 2024-12-13 14:14:31 * @version 1.0 */@SpringBootApplication@ComponentScan(basePackages = github.lianyutian.cshop.user, github.lianyutian.cshop.common)public class UserApplication public static void main(String[] args) SpringApplication.run(UserApplication.class, args); cshop-usersrcmainresourcesapplication.yml # æœåŠ¡ç«¯å£server: port: 9001 spring: application: name: cshop-user # è®¾ç½®æ—¥å¿—çº§åˆ«ï¼šERROR/WARN/INFO/DEBUG,é»˜è®¤æ˜¯ INFO ä»¥ä¸Šæ‰æ˜¾ç¤ºlogging: level: root: INFO æµ‹è¯• cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserController.Java package github.lianyutian.cshop.user.controller;import github.lianyutian.cshop.common.utils.ApiResult;import org.springframework.web.bind.annotation.PostMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;/** * UserController * * @author lianyutian * @since 2024-12-13 14:19:30 * @version 1.0 */@RestController@RequestMapping(/api/user/v1)public class UserController @PostMapping(test) public ApiResultString test() int i = 1 / 0; return ApiResult.success(hello circle-shop); ç”¨æˆ·éªŒè¯ç å›¾å½¢éªŒè¯ç åŸºç¡€åŠŸèƒ½Kaptcha æ˜¯ä¸€ä¸ªå¼€æºçš„ Java å›¾å½¢éªŒè¯ç ç”Ÿæˆåº“ï¼Œå¸¸ç”¨äºåœ¨ Web åº”ç”¨ä¸­ç”ŸæˆéªŒè¯ç å›¾ç‰‡ã€‚ https://github.com/penggle/kaptcha pom.xml !-- å›¾å½¢éªŒè¯ç  kaptcha ç‰ˆæœ¬ --kaptcha.version2.3.2/kaptcha.version dependency groupIdcom.github.penggle/groupId artifactIdkaptcha/artifactId version$kaptcha.version/version/dependency cshop-userpom.xml dependency groupIdcom.github.penggle/groupId artifactIdkaptcha/artifactId/dependency cshop-usersrcmainJavagithublianyutiancshopuserconfigKaptchaConfig.Java package github.lianyutian.cshop.user.config;import com.google.code.kaptcha.Constants;import com.google.code.kaptcha.impl.DefaultKaptcha;import com.google.code.kaptcha.util.Config;import java.util.Properties;import org.springframework.beans.factory.annotation.Qualifier;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;/** * Kaptcha é…ç½®ç±» * * @author lianyutian * @since 2024-12-17 11:15:02 * @version 1.0 */@Configurationpublic class KaptchaConfig @Bean @Qualifier(captchaProducer) public DefaultKaptcha producer() Properties properties = new Properties(); // è®¾ç½® Kaptcha ç”Ÿæˆçš„å›¾ç‰‡å®½åº¦(åƒç´ ) properties.setProperty(Constants.KAPTCHA_IMAGE_WIDTH, 200); // è®¾ç½® Kaptcha ç”Ÿæˆçš„å›¾ç‰‡é«˜åº¦(åƒç´ ) properties.setProperty(Constants.KAPTCHA_IMAGE_HEIGHT, 50); // è®¾ç½® Kaptcha æ–‡æœ¬å­—ä½“å¤§å° properties.setProperty(Constants.KAPTCHA_TEXTPRODUCER_FONT_SIZE, 40); // è®¾ç½® Kaptcha æ–‡æœ¬å­—ä½“é¢œè‰² properties.setProperty(Constants.KAPTCHA_TEXTPRODUCER_FONT_COLOR, black); // è®¾ç½® Kaptcha æ–‡æœ¬å­—ç¬¦é•¿åº¦ properties.setProperty(Constants.KAPTCHA_TEXTPRODUCER_CHAR_LENGTH, 5); // è®¾ç½® Kaptcha æ–‡æœ¬å­—ç¬¦é›†ä¸ºè‹±æ–‡å­—æ¯ï¼ˆå¤§å°å†™ï¼‰å’Œæ•°å­— properties.setProperty( Constants.KAPTCHA_TEXTPRODUCER_CHAR_STRING, abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890); // è®¾ç½® Kaptcha æ–‡æœ¬å­—ä½“ properties.setProperty(Constants.KAPTCHA_TEXTPRODUCER_FONT_NAMES, Arial); // NoNoise ç±»è¡¨ç¤ºä¸æ·»åŠ ä»»ä½•å™ªå£°ï¼Œå³ç”Ÿæˆçš„éªŒè¯ç å›¾ç‰‡å°†ä¸ä¼šæœ‰ä»»ä½•å¹²æ‰°çº¿æˆ–ç‚¹ã€‚ // é€šè¿‡è®¾ç½® Constants.KAPTCHA_NOISE_IMPL å±æ€§ï¼Œå¯ä»¥æ§åˆ¶éªŒè¯ç å›¾ç‰‡çš„æ ·å¼å’Œå¤æ‚åº¦ properties.setProperty(Constants.KAPTCHA_NOISE_IMPL, com.google.code.kaptcha.impl.NoNoise); Config config = new Config(properties); DefaultKaptcha defaultKaptcha = new DefaultKaptcha(); defaultKaptcha.setConfig(config); return defaultKaptcha; cshop-usersrcmainJavagithublianyutiancshopusercontrollerCaptchaController.Java package github.lianyutian.cshop.user.controller;import com.google.code.kaptcha.impl.DefaultKaptcha;import github.lianyutian.cshop.common.utils.CommonUtil;import jakarta.servlet.ServletOutputStream;import jakarta.servlet.http.HttpServletRequest;import jakarta.servlet.http.HttpServletResponse;import lombok.AllArgsConstructor;import lombok.extern.slf4j.Slf4j;import org.springframework.data.redis.core.StringRedisTemplate;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;import javax.imageio.ImageIO;import java.awt.image.BufferedImage;import java.io.IOException;import java.util.concurrent.TimeUnit;/** * éªŒè¯ç å‰ç«¯æ§åˆ¶å™¨ * * @author lianyutian * @since 2024-12-17 11:17:12 * @version 1.0 */@RestController@RequestMapping(/api/captcha/v1)@AllArgsConstructor@Slf4jpublic class CaptchaController /** * éªŒè¯ç ç”Ÿæˆå™¨ */ private final DefaultKaptcha captchaProducer; /** * è·å–å›¾å½¢éªŒè¯ç  * * @param response response */ @RequestMapping(getImgCaptcha) public void getImgCaptcha(HttpServletResponse response) // 1ã€å…ˆç”Ÿæˆå›¾å½¢éªŒè¯ç æ–‡æœ¬ String captchaText = captchaProducer.createText(); log.info(éªŒè¯ç æ¨¡å—-è·å–å›¾å½¢éªŒè¯ç æ–‡æœ¬:, captchaText); // 2ã€æ ¹æ®éªŒè¯ç æ–‡æœ¬ç”Ÿæˆå›¾å½¢éªŒè¯ç å›¾ç‰‡ BufferedImage bufferedImage = captchaProducer.createImage(captchaText); try (ServletOutputStream outputStream = response.getOutputStream(); ) ImageIO.write(bufferedImage, jpg, outputStream); outputStream.flush(); catch (IOException e) log.error(éªŒè¯ç æ¨¡å—-è·å–å›¾å½¢éªŒè¯ç å¼‚å¸¸:, e.getMessage(), e); æ¥å…¥ Redisåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæœ‰å¤šä¸ªå®ä¾‹è¿è¡ŒæœåŠ¡æ—¶ï¼ŒéªŒè¯ç çš„å­˜å‚¨å’ŒéªŒè¯æ¶‰åŠåˆ°è·¨å®ä¾‹çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ é€šå¸¸ï¼ŒéªŒè¯ç æ˜¯å­˜å‚¨åœ¨ç”¨æˆ·ä¼šè¯ï¼ˆSessionï¼‰ä¸­ï¼Œè€Œå¦‚æœæœåŠ¡æ˜¯åˆ†å¸ƒå¼çš„ï¼Œé‚£ä¹ˆæ¯ä¸ªæœåŠ¡å®ä¾‹å¯èƒ½æœ‰è‡ªå·±çš„ç‹¬ç«‹ä¼šè¯å­˜å‚¨ï¼Œå°†ä¼šå¯¼è‡´éªŒè¯å¤±è´¥ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¥å…¥ Redis å­˜å‚¨éªŒè¯ç ã€‚ åœ¨ common æ¨¡å—ä¸­å·²ç»å¼•å…¥äº† redis æ‰€ä»¥ user æ¨¡å—ä¸ç”¨é‡å¤å¼•å…¥ï¼Œç›´æ¥é…ç½® redis å°±å¯ä»¥ã€‚ cshop-usersrcmainresourcesapplication.yml spring: # redisé…ç½® data: redis: enable: true host: 116.198.217.158 port: 6379 password: MIIEowIBAAKCAQEAwG90ULRHmAXFXQzZSwleoYts2+bCzUvqhhqtGiv/F5kUsETY # å¦‚æœæœ‰å¯†ç  database: 0 # é»˜è®¤æ•°æ®åº“ timeout: 60000 # è¯»å– redis è¶…æ—¶æ—¶é—´ lettuce: pool: max-active: 100 # æœ€å¤§è¿æ¥æ•° max-idle: 100 # æœ€å¤§ç©ºé—²è¿æ¥æ•° min-idle: 100 # æœ€å°ç©ºé—²è¿æ¥æ•° max-wait: 60000 # æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ cshop-usersrcmainJavagithublianyutiancshopuserconstantUserCacheKeyConstant.Java package github.lianyutian.cshop.user.constant;/** * ç¼“å­˜å¸¸é‡ * * @author lianyutian * @since 2024-12-24 13:46:37 * @version 1.0 */public class UserCacheKeyConstant /** å›¾å½¢éªŒè¯ç ç¼“å­˜ key å‰ç¼€ */ public static final String CAPTCHA_IMG_KEY_PREFIX = cshop-user:img-captcha:; /** æ³¨å†ŒéªŒè¯ç ç¼“å­˜ key å‰ç¼€ */ public static final String CAPTCHA_REGISTER_KEY_PREFIX = cshop-user:register-captcha:; /** ç”¨æˆ·ä¿¡æ¯æ›´æ–°é”å‰ç¼€ */ public static final String USER_UPDATE_LOCK_KEY_PREFIX = cshop-user:update:lock:; /** ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ç¼“å­˜å‰ç¼€ */ public static final String USER_DETAIL_KEY_PREFIX = cshop-user:detail:; /** ç”¨æˆ·å±•ç¤ºä¿¡æ¯ç¼“å­˜å‰ç¼€ */ public static final String USER_SHOW_KEY_PREFIX = cshop-user:show:; cshop-usersrcmainJavagithublianyutiancshopusercontrollerCaptchaController.Java package github.lianyutian.cshop.user.controller;import com.google.code.kaptcha.impl.DefaultKaptcha;import github.lianyutian.cshop.common.enums.BizCodeEnum;import github.lianyutian.cshop.common.model.ApiResult;import github.lianyutian.cshop.common.redis.RedisCache;import github.lianyutian.cshop.common.utils.CheckUtil;import github.lianyutian.cshop.common.utils.CommonUtil;import github.lianyutian.cshop.user.constant.UserCacheKeyConstant;import github.lianyutian.cshop.user.service.captcha.CaptchaService;import jakarta.servlet.ServletOutputStream;import jakarta.servlet.http.HttpServletRequest;import jakarta.servlet.http.HttpServletResponse;import java.awt.image.BufferedImage;import java.io.IOException;import javax.imageio.ImageIO;import lombok.AllArgsConstructor;import lombok.extern.slf4j.Slf4j;import org.apache.commons.lang3.StringUtils;import org.springframework.web.bind.annotation.PostMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.RestController;/** * CaptchaController * * @author lianyutian * @since 2024-12-17 11:17:12 * @version 1.0 */@RestController@RequestMapping(/api/captcha/v1)@AllArgsConstructor@Slf4jpublic class CaptchaController /** å›¾å½¢éªŒè¯ç è¿‡æœŸæ—¶é—´ */ private static final long CAPTCHA_EXPIRE_TIME = 60 * 1000 * 5; /** éªŒè¯ç ç”Ÿæˆå™¨ */ private final DefaultKaptcha captchaProducer; private final RedisCache redisCache; private final CaptchaService captchaService; /** * è·å–å›¾å½¢éªŒè¯ç  * * @param request request * @param response response */ @PostMapping(getImgCaptcha) public void getImgCaptcha(HttpServletRequest request, HttpServletResponse response) // 1ã€å…ˆç”Ÿæˆå›¾å½¢éªŒè¯ç æ–‡æœ¬ String captchaText = captchaProducer.createText(); log.info(éªŒè¯ç æ¨¡å—-è·å–å›¾å½¢éªŒè¯ç æ–‡æœ¬:, captchaText); // 2ã€å­˜å‚¨åˆ° redis ä¸­ï¼Œå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ redisCache.set(getImgCaptchaKey(request), captchaText, CAPTCHA_EXPIRE_TIME); // 3ã€æ ¹æ®éªŒè¯ç æ–‡æœ¬ç”Ÿæˆå›¾å½¢éªŒè¯ç å›¾ç‰‡ BufferedImage bufferedImage = captchaProducer.createImage(captchaText); try (ServletOutputStream outputStream = response.getOutputStream(); ) ImageIO.write(bufferedImage, jpg, outputStream); outputStream.flush(); catch (IOException e) log.error(éªŒè¯ç æ¨¡å—-è·å–å›¾å½¢éªŒè¯ç å¼‚å¸¸:, e.getMessage(), e); private String getImgCaptchaKey(HttpServletRequest request) // è·å–å®¢æˆ·ç«¯ç”¨æˆ·çš„ IP åœ°å€ String ip = CommonUtil.getRemoteIpAddr(request); // è·å–è¯·æ±‚å¤´ä¸­çš„ User-Agent å±æ€§å€¼ String userAgent = request.getHeader(User-Agent); // æ ¹æ® ip + userAgent ç”Ÿæˆå¯¹åº”çš„ key return UserCacheKeyConstant.CAPTCHA_IMG_KEY_PREFIX + CommonUtil.MD5(ip + userAgent); çŸ­ä¿¡å‘é€é˜¿é‡Œäº‘çŸ­ä¿¡https://www.alibabacloud.com/help/zh/sms/?spm a2c63.p38356.0.0.5d031637kOTDrA https://dysms.console.aliyun.com/quickstart å‰ç½®æ­¥éª¤ ç”³è¯·èµ„è´¨ èµ„è´¨æ˜¯ç”³è¯·ç­¾åçš„å®ååŒ–ä¿¡æ¯ï¼Œå¯å¤ç”¨ å‰å¾€æŸ¥çœ‹ ç”³è¯·ç­¾å ç­¾åæ˜¯çŸ­ä¿¡ä¸­èƒ½ä»£è¡¨å‘é€è€…å±æ€§çš„å­—æ®µã€‚ å‰å¾€æŸ¥çœ‹ ç”³è¯·æ¨¡æ¿ æ¨¡æ¿å³å…·ä½“å‘é€çš„çŸ­ä¿¡å†…å®¹ã€‚ å‰å¾€æŸ¥çœ‹ å®‰å…¨è®¾ç½®https://dysms.console.aliyun.com/msgsetting/safe åˆ›å»º RAM ç”¨æˆ· åˆ›å»ºç”¨æˆ· https://ram.console.aliyun.com/users/create æ·»åŠ çŸ­ä¿¡æˆæƒ API è¯¦ç»† API æ–‡æ¡£ https://api.aliyun.com/document/Dysmsapi/2017-05-25/SendSms ç¤ºä¾‹ https://api.aliyun.com/api-tools/sdk/Dysmsapi?version 2017-05-25language Java-async-teatab primer-doc å¼€å‘ pom.xml !-- é˜¿é‡Œäº‘çŸ­ä¿¡ sdk ç‰ˆæœ¬ --alibabacloud.dysmsapi.version3.0.1/alibabacloud.dysmsapi.versiondependency groupIdcom.aliyun/groupId artifactIdalibabacloud-dysmsapi20170525/artifactId version$alibabacloud.dysmsapi.version/version/dependency cshop-userpom.xml dependency groupIdcom.aliyun/groupId artifactIdalibabacloud-dysmsapi20170525/artifactId/dependency cshop-usersrcmainJavagithublianyutiancshopuserservicesmsSmsCodeService.Java /** çŸ­ä¿¡æœåŠ¡æ¥å£ æä¾›çŸ­ä¿¡éªŒè¯ç å‘é€åŠŸèƒ½ */package github.lianyutian.cshop.user.service.sms;/** * çŸ­ä¿¡æœåŠ¡æ¥å£ * * @author lianyutian * @since 2024-12-18 14:39:43 * @version 1.0 */public interface SmsCodeService /** * å‘é€çŸ­ä¿¡éªŒè¯ç  * * @param phone æ¥æ”¶çŸ­ä¿¡çš„æ‰‹æœºå·ç  * @param templateId çŸ­ä¿¡æ¨¡æ¿ IDï¼Œç”¨äºæŒ‡å®šçŸ­ä¿¡çš„å†…å®¹æ ¼å¼ * @param templateParam çŸ­ä¿¡æ¨¡æ¿å‚æ•°ï¼Œç”¨äºæ›¿æ¢çŸ­ä¿¡æ¨¡æ¿ä¸­çš„å ä½ç¬¦ * @return å‘é€ç»“æœï¼Œé€šå¸¸ä¸ºæˆåŠŸæˆ–å¤±è´¥çš„æ ‡è¯† */ boolean sendSmsCode(String phone, String templateId, String[] templateParam); cshop-usersrcmainJavagithublianyutiancshopuserservicesmsimplAliyunSmsCodeServiceImpl.Java package github.lianyutian.cshop.user.service.sms.impl;import com.aliyun.auth.credentials.Credential;import com.aliyun.auth.credentials.provider.StaticCredentialProvider;import com.aliyun.sdk.service.dysmsapi20170525.AsyncClient;import com.aliyun.sdk.service.dysmsapi20170525.models.SendSmsRequest;import com.aliyun.sdk.service.dysmsapi20170525.models.SendSmsResponse;import darabonba.core.client.ClientOverrideConfiguration;import github.lianyutian.cshop.common.utils.JsonUtil;import github.lianyutian.cshop.user.service.sms.SmsCodeService;import java.time.Duration;import java.util.Objects;import java.util.concurrent.CompletableFuture;import java.util.concurrent.ExecutionException;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.annotation.Value;import org.springframework.stereotype.Service;/** * é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡å®ç°ç±» * * @author lianyutian * @since 2024-12-19 08:42:48 * @version 1.0 */@Service@Slf4jpublic class AliyunSmsCodeServiceImpl implements SmsCodeService @Value($sms.aliyun.secretId) private String secretId; @Value($sms.aliyun.secretKey) private String secretKey; @Value($sms.aliyun.signName) private String signName; @Override public boolean sendSmsCode(String phone, String templateId, String[] templateParam) // é…ç½®è®¤è¯ä¿¡æ¯ï¼ŒåŒ…æ‹¬è®¿é—®å¯†é’¥ IDã€è®¿é—®å¯†é’¥å¯†é’¥ StaticCredentialProvider provider = StaticCredentialProvider.create( Credential.builder().accessKeyId(secretId).accessKeySecret(secretKey).build()); try (AsyncClient client = AsyncClient.builder() // .httpClient(httpClient) // ä½¿ç”¨é…ç½®çš„ HttpClientï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤çš„ HttpClient (Apache HttpClient) .credentialsProvider(provider) // .serviceConfiguration(Configuration.create()) // æœåŠ¡çº§åˆ«é…ç½® // å®¢æˆ·ç«¯çº§åˆ«é…ç½®é‡å†™ï¼Œå¯ä»¥è®¾ç½® Endpointã€HTTP è¯·æ±‚å‚æ•°ç­‰ .overrideConfiguration( ClientOverrideConfiguration.create() // Endpoint è¯·å‚è€ƒ https://api.aliyun.com/product/Dysmsapi .setEndpointOverride(dysmsapi.aliyuncs.com) .setConnectTimeout(Duration.ofSeconds(30))) .build()) // è®¾ç½® API è¯·æ±‚å‚æ•° SendSmsRequest sendSmsRequest = SendSmsRequest.builder() .phoneNumbers(phone) .signName(signName) .templateCode(templateId) .templateParam(\\code\\:\\ + templateParam[0] + \\) // è¯·æ±‚çº§åˆ«é…ç½®é‡å†™ï¼Œå¯ä»¥è®¾ç½® HTTP è¯·æ±‚å‚æ•°ç­‰ // .requestConfiguration(RequestConfiguration.create().setHttpHeaders(new // HttpHeaders())) .build(); // å¼‚æ­¥è·å– API è¯·æ±‚çš„è¿”å›å€¼ CompletableFutureSendSmsResponse response = client.sendSms(sendSmsRequest); // åŒæ­¥è·å– API è¯·æ±‚çš„è¿”å›å€¼ SendSmsResponse resp = response.get(); log.info(çŸ­ä¿¡æ¨¡å—-çŸ­ä¿¡å‘é€ç»“æœï¼š, JsonUtil.toJson(resp)); String code = resp.getBody().getCode(); if (Objects.equals(code, OK)) return true; catch (ExecutionException | InterruptedException e) log.error(e.getMessage(), e); return false; return false; cshop-usersrcmainJavagithublianyutiancshopuserservicesmsSmsSender.Java å› ä¸ºçŸ­ä¿¡æœåŠ¡æä¾›å•†æœ‰å¤šå®¶ï¼Œä¸ºæ–¹ä¾¿å¯ä»¥è‡ªç”±é€‰æ‹©æä¾›å•†æ‰€ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼ package github.lianyutian.cshop.user.service.sms;import github.lianyutian.cshop.user.service.sms.impl.AliyunSmsCodeServiceImpl;import github.lianyutian.cshop.user.service.sms.impl.TencentcloudSmsCodeServiceImpl;import java.util.concurrent.atomic.AtomicInteger;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.annotation.Value;import org.springframework.stereotype.Service;/** * çŸ­ä¿¡å‘é€ç®¡ç† * * @author lianyutian * @since 2024-12-19 09:50:10 * @version 1.0 */@Service@Slf4jpublic class SmsSender /** å½“å‰ä½¿ç”¨çš„çŸ­ä¿¡æœåŠ¡ */ private SmsCodeService currentService; /** å½“å‰çŸ­ä¿¡æ¨¡æ¿ ID */ private String currentTemplateId; /** å¤±è´¥è®¡æ•° */ private final AtomicInteger failureCount = new AtomicInteger(0); /** é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡å®ç° */ private final AliyunSmsCodeServiceImpl aliyunSmsCodeService; /** è…¾è®¯äº‘çŸ­ä¿¡æœåŠ¡å®ç° */ private final TencentcloudSmsCodeServiceImpl tencentcloudSmsCodeService; /** æœ€å¤§å¤±è´¥æ¬¡æ•° */ private final int maxFailures; private final String aliyunTemplateId; private final String tencentcloudTemplateId; /** æ„é€ æ–¹æ³•ï¼Œé»˜è®¤ä½¿ç”¨é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡ */ public SmsSender( @Value($sms.send.fail) int maxFailures, @Value($sms.send.templateId.aliyun) String aliyunTemplateId, @Value($sms.send.templateId.tencentcloud) String tencentcloudTemplateId, AliyunSmsCodeServiceImpl aliyunSmsCodeService, TencentcloudSmsCodeServiceImpl tencentcloudSmsCodeService) if (maxFailures = 0) throw new IllegalArgumentException(æœ€å¤§å¤±è´¥æ¬¡æ•°å¿…é¡»å¤§äº0); this.maxFailures = maxFailures; this.aliyunTemplateId = aliyunTemplateId; this.tencentcloudTemplateId = tencentcloudTemplateId; this.aliyunSmsCodeService = aliyunSmsCodeService; this.tencentcloudSmsCodeService = tencentcloudSmsCodeService; this.currentService = aliyunSmsCodeService; this.currentTemplateId = aliyunTemplateId; /** * å‘é€çŸ­ä¿¡ * * @param phoneNumber æ¥æ”¶çŸ­ä¿¡çš„ç”µè¯å·ç  * @param templateParam çŸ­ä¿¡æ¨¡æ¿å‚æ•° * @return çŸ­ä¿¡å‘é€ç»“æœï¼Œtrue è¡¨ç¤ºå‘é€æˆåŠŸï¼Œfalse è¡¨ç¤ºå‘é€å¤±è´¥ */ public boolean send(String phoneNumber, String[] templateParam) try boolean result = currentService.sendSmsCode(phoneNumber, currentTemplateId, templateParam); // å‘é€æˆåŠŸæ—¶ï¼Œé‡ç½®å¤±è´¥æ¬¡æ•° failureCount.set(0); return result; catch (Exception e) log.error(çŸ­ä¿¡æ¨¡å—-çŸ­ä¿¡å‘é€å¤±è´¥, , e.getMessage(), e); int currentFailureCount = failureCount.incrementAndGet(); if (currentFailureCount = maxFailures) // åˆ‡æ¢åˆ°å¦ä¸€ä¸ªå‚å•† switchVendor(currentFailureCount); return false; /** åˆ‡æ¢çŸ­ä¿¡æœåŠ¡ä¾›åº”å•† */ private void switchVendor(int currentFailureCount) if (currentService instanceof AliyunSmsCodeServiceImpl) log.info(çŸ­ä¿¡æ¨¡å—-åˆ‡æ¢åˆ°è…¾è®¯äº‘, å½“å‰å¤±è´¥æ¬¡æ•°: , currentFailureCount); currentService = tencentcloudSmsCodeService; currentTemplateId = tencentcloudTemplateId; else log.info(çŸ­ä¿¡æ¨¡å—-åˆ‡æ¢åˆ°é˜¿é‡Œäº‘, å½“å‰å¤±è´¥æ¬¡æ•°: , currentFailureCount); currentService = aliyunSmsCodeService; currentTemplateId = aliyunTemplateId; cshop-usersrcmainresourcesapplication.yml sms: aliyun: secretId: xxx secretKey: xxx signName: CircleShopå•†åŸ tencent: secretId: xxx secretKey: xxx signName: xxx send: fail: 10 templateId: aliyun: SMS_476800055 tencentcloud: xxx è…¾è®¯äº‘çŸ­ä¿¡å¼€é€šè…¾è®¯äº‘çŸ­ä¿¡ï¼ˆç­¾åä¸é€šè¿‡æš‚ç¼“ï¼‰https://console.cloud.tencent.com/smsv2 https://blog.csdn.net/mjl1125/article/details/122047618 https://blog.csdn.net/huixi_aa/article/details/124687445 æ³¨å†ŒéªŒè¯ç  cshop-usersrcmainJavagithublianyutiancshopusercontrollerCaptchaController.Java private final CaptchaService captchaService;/** * å‘é€æ³¨å†ŒéªŒè¯ç  * * @param to æ¥æ”¶æ–¹ */@PostMapping(sendRegisterCode)public ApiResultVoid sendRegisterCode(@RequestParam(value = to) String to) if (!CheckUtil.isPhone(to)) return ApiResult.result(BizCodeEnum.USER_PHONE_ERROR); // å…ˆä»ç¼“å­˜ä¸­è·å–éªŒè¯ç  // key:cshop-user:register-captcha: ç”µè¯ // value: ç”µè¯_å‘é€æ—¶é—´æˆ³ String cacheKey = UserCacheKeyConstant.CAPTCHA_REGISTER_KEY_PREFIX + to; String registerCode = redisCache.get(cacheKey); // å¦‚æœä¸ä¸ºç©ºï¼Œåˆ™åˆ¤æ–­æ˜¯å¦ 60 ç§’å†…é‡å¤å‘é€ if (StringUtils.isNotBlank(registerCode)) // ä»ç¼“å­˜ä¸­å–å‡ºéªŒè¯ç å‘é€æ—¶é—´æˆ³ long cacheCheckTtl = Long.parseLong(registerCode.split(_)[1]); // å½“å‰æ—¶é—´ - éªŒè¯ç å‘é€æ—¶é—´æˆ³ï¼Œå¦‚æœå°äº 60 ç§’ï¼Œåˆ™ä¸ç»™é‡å¤å‘é€ if (CommonUtil.getCurrentTimestamp() - cacheCheckTtl 1000 * 60) log.info( éªŒè¯ç æ¨¡å—-è¯·ä¸è¦é‡å¤å‘é€éªŒè¯ç ï¼Œæ—¶é—´é—´éš”ï¼š, (CommonUtil.getCurrentTimestamp() - cacheCheckTtl) / 1000); return ApiResult.result(BizCodeEnum.USER_CODE_FAST_LIMITED); // å‘é€æ³¨å†ŒéªŒè¯ç  boolean res = captchaService.sendCode(cacheKey, to); return res ? ApiResult.success() : ApiResult.result(BizCodeEnum.USER_CODE_SEND_ERROR); cshop-usersrcmainJavagithublianyutiancshopuserservicecaptchaCaptchaService.Java package github.lianyutian.cshop.user.service.captcha;/** * éªŒè¯ç æœåŠ¡æ¥å£ * * @author lianyutian * @since 2024-12-17 17:17:03 * @version 1.0 */public interface CaptchaService /** * å‘é€éªŒè¯ç  * * @param cacheKey ç¼“å­˜ key * @param to æ¥æ”¶è€… * @return å‘é€ç»“æœ */ boolean sendCode(String cacheKey, String to); cshop-usersrcmainJavagithublianyutiancshopuserservicecaptchaimplCaptchaServiceImpl.Java package github.lianyutian.cshop.user.service.captcha.impl;import github.lianyutian.cshop.common.redis.RedisCache;import github.lianyutian.cshop.common.utils.CommonUtil;import github.lianyutian.cshop.user.service.captcha.CaptchaService;import github.lianyutian.cshop.user.service.sms.SmsSender;import java.util.concurrent.TimeUnit;import lombok.AllArgsConstructor;import lombok.extern.slf4j.Slf4j;import org.springframework.stereotype.Service;/** * éªŒè¯ç æœåŠ¡å®ç°ç±» * * @author lianyutian * @since 2024-12-17 17:35:10 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class CaptchaServiceImpl implements CaptchaService /** çŸ­ä¿¡éªŒè¯ç è¿‡æœŸæ—¶é—´ */ private static final long CAPTCHA_EXPIRE_TIME = 60 * 1000 * 5; private final RedisCache redisCache; private final SmsSender smsSender; @Override public boolean sendCode(String cacheKey, String to) // è·å–éšæœºéªŒè¯ç  String code = CommonUtil.getRandomCode(6); // æ‹¼æ¥éªŒè¯ç  æ ¼å¼ï¼šéªŒè¯ç _æ—¶é—´æˆ³ String newCode = code + _ + CommonUtil.getCurrentTimestamp(); log.info(éªŒè¯ç æ¨¡å—-å†™å…¥ Redis éªŒè¯ç ï¼š, newCode); redisCache.set(cacheKey, newCode, CAPTCHA_EXPIRE_TIME, TimeUnit.MILLISECONDS); // å‘é€çŸ­ä¿¡ boolean sendRes = smsSender.send(to, new String[] code); if (!sendRes) // å‘é€å¤±è´¥åˆ é™¤ç¼“å­˜ redisCache.delete(cacheKey); return sendRes; ç”¨æˆ·å¤´åƒä¸Šä¼ https://www.alibabacloud.com/help/zh/oss/?spm a2c63.p38356.0.0.47cb60deEkjUPk https://www.alibabacloud.com/help/zh/oss/developer-reference/getting-started?spm a2c63.p38356.help-menu-31815.d_3_2_0_0.59105a1abcz5t5 pom.xml !-- é˜¿é‡Œäº‘ OSS sdk ç‰ˆæœ¬ --aliyun-sdk-oss.version3.18.1/aliyun-sdk-oss.version!-- https://mvnrepository.com/artifact/com.aliyun.oss/aliyun-sdk-oss --dependency groupIdcom.aliyun.oss/groupId artifactIdaliyun-sdk-oss/artifactId version$aliyun-sdk-oss.version/version/dependency cshop-usersrcmainresourcesapplication.yml oss: aliyun: secretId: xxx secretKey: xxx bucketName: xxx endPoint: oss-cn-shenzhen.aliyuncs.com cshop-usersrcmainJavagithublianyutiancshopuserserviceossOssService.Java package github.lianyutian.cshop.user.service.oss;import org.springframework.web.multipart.MultipartFile;/** * å¯¹è±¡å­˜å‚¨æœåŠ¡ * * @author lianyutian * @since 2024-12-23 14:04:03 * @version 1.0 */public interface OssService /** * ä¸Šä¼ ç”¨æˆ·å¤´åƒ * * @param file å¤´åƒæ–‡ä»¶ * @return å¤´åƒåœ°å€ */ String uploadUserAvatar(MultipartFile file); cshop-usersrcmainJavagithublianyutiancshopuserserviceossimplOssServiceImpl.Java package github.lianyutian.cshop.user.service.oss.impl;import com.aliyun.oss.OSS;import com.aliyun.oss.OSSClientBuilder;import com.aliyun.oss.model.PutObjectResult;import github.lianyutian.cshop.common.utils.CommonUtil;import github.lianyutian.cshop.user.service.oss.OssService;import java.io.IOException;import java.io.InputStream;import java.time.LocalDateTime;import java.time.format.DateTimeFormatter;import java.util.Objects;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.annotation.Value;import org.springframework.stereotype.Service;import org.springframework.web.multipart.MultipartFile;/** * å¯¹è±¡å­˜å‚¨å®ç° * * @author lianyutian * @since 2024-12-23 14:06:09 * @version 1.0 */@Slf4j@Servicepublic class OssServiceImpl implements OssService @Value($oss.aliyun.secretId) private String secretId; @Value($oss.aliyun.secretKey) private String secretKey; @Value($oss.aliyun.bucketName) private String bucketName; @Value($oss.aliyun.endPoint) private String endPoint; @Override public String uploadUserAvatar(MultipartFile file) // è·å–åŸå§‹æ–‡ä»¶å String originalFilename = Objects.requireNonNullElse(file.getOriginalFilename(), default_filename); // è·å–æ—¥æœŸæ ¼å¼ï¼Œä¸Šä¼ æ—¶ä½œä¸ºç›®å½•åä½¿ç”¨ LocalDateTime localDateTime = LocalDateTime.now(); DateTimeFormatter dateTimeFormatter = DateTimeFormatter.ofPattern(yyyy/MM/dd); // OSS ä¸Šä¼ å­˜å‚¨è·¯å¾„ï¼šuser/2024/12/23/xxx.jpg String folder = dateTimeFormatter.format(localDateTime); // è·å–æ‰©å±•å String extension = originalFilename.substring(originalFilename.lastIndexOf(.)); // æ–°æ–‡ä»¶åï¼Œé€šè¿‡ uuid ç”Ÿæˆæ–‡ä»¶åï¼Œ String fileName = user + / + folder + / + CommonUtil.generateUUID() + extension; OSS ossClient = new OSSClientBuilder().build(endPoint, secretId, secretKey); try (InputStream inputStream = file.getInputStream()) // å†™å…¥ OSS PutObjectResult putObjectResult = ossClient.putObject(bucketName, fileName, inputStream); // è¿”å›å›¾ç‰‡è·¯å¾„ if (putObjectResult != null) return https:// + bucketName + . + endPoint + / + fileName; else log.error(ç”¨æˆ·å¾®æœåŠ¡-ä¸Šä¼ æ¨¡å—-æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼ŒputObjectResult ä¸ºç©º); return null; catch (IOException e) log.error(ç”¨æˆ·å¾®æœåŠ¡-ä¸Šä¼ æ¨¡å—-æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼š, e.getMessage(), e); return null; finally ossClient.shutdown(); cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserController.Java package github.lianyutian.cshop.user.controller;import github.lianyutian.cshop.common.enums.BizCodeEnum;import github.lianyutian.cshop.common.model.ApiResult;import github.lianyutian.cshop.user.model.param.UserEditParam;import github.lianyutian.cshop.user.model.param.UserLoginParam;import github.lianyutian.cshop.user.model.param.UserRegisterParam;import github.lianyutian.cshop.user.model.vo.UserDetailVO;import github.lianyutian.cshop.user.model.vo.UserShowVO;import github.lianyutian.cshop.user.service.UserService;import github.lianyutian.cshop.user.service.oss.OssService;import java.util.Map;import lombok.RequiredArgsConstructor;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.annotation.Value;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.PathVariable;import org.springframework.web.bind.annotation.PostMapping;import org.springframework.web.bind.annotation.RequestBody;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.RequestPart;import org.springframework.web.bind.annotation.RestController;import org.springframework.web.multipart.MultipartFile;/** * UserController * * @author lianyutian * @since 2024-12-13 14:19:30 * @version 1.0 */@RestController@RequestMapping(/api/user/v1)@Slf4j@RequiredArgsConstructorpublic class UserController @Value($oss.aliyun.maxFileSize:1048576) // æ–°å¢æ–‡ä»¶å¤§å°é™åˆ¶é…ç½® private long maxFileSize; @Value($oss.aliyun.allowedFileTypes:image/jpeg,image/png) // æ–°å¢å…è®¸çš„æ–‡ä»¶ç±»å‹é…ç½® private String[] allowedFileTypes; private final OssService ossService; private final UserService userService; /** * ä¸Šä¼ ç”¨æˆ·å¤´åƒ * * @param file å¤´åƒæ–‡ä»¶ * @return ä¸Šä¼ ç»“æœ */ @PostMapping(uploadUserAvatar) public ApiResultString uploadUserAvatar(@RequestPart(file) MultipartFile file) // éªŒè¯æ–‡ä»¶æ˜¯å¦ä¸ºç©º if (file == null || file.isEmpty()) log.warn(ç”¨æˆ·å¾®æœåŠ¡-ä¸Šä¼ æ¨¡å—-æ–‡ä»¶ä¸ºç©º); return ApiResult.result(BizCodeEnum.USER_AVATAR_FILE_UPLOAD_ERROR); // éªŒè¯æ–‡ä»¶å¤§å° if (file.getSize() maxFileSize) log.warn(ç”¨æˆ·å¾®æœåŠ¡-ä¸Šä¼ æ¨¡å—-æ–‡ä»¶è¶…å‡ºæœ€å¤§é™åˆ¶: , file.getSize()); return ApiResult.result(BizCodeEnum.USER_AVATAR_FILE_UPLOAD_ERROR); // éªŒè¯æ–‡ä»¶ç±»å‹ String contentType = file.getContentType(); if (!isFileTypeAllowed(contentType)) log.warn(ç”¨æˆ·å¾®æœåŠ¡-ä¸Šä¼ æ¨¡å—-ä¸å…è®¸çš„æ–‡ä»¶ç±»å‹: , contentType); return ApiResult.result(BizCodeEnum.USER_AVATAR_FILE_UPLOAD_ERROR); String result = ossService.uploadUserAvatar(file); return result != null ? ApiResult.success(result) : ApiResult.result(BizCodeEnum.USER_AVATAR_FILE_UPLOAD_ERROR); ç”¨æˆ·æ³¨å†Œåˆ›å»ºç”¨æˆ·è¡¨ cshop-userdocSQLuser.SQL create table user( id bigint unsigned auto_increment primary key, name varchar(32) null comment ç”¨æˆ·æ˜µç§°, pwd varchar(64) null comment ç”¨æˆ·å¯†ç , avatar varchar(524) null comment ç”¨æˆ·å¤´åƒ, sex tinyint(1) default 1 null comment 0 å¥³ï¼Œ1 ç”·, phone varchar(11) default null comment ç”¨æˆ·æ‰‹æœºå·, create_time datetime default CURRENT_TIMESTAMP null comment åˆ›å»ºæ—¶é—´, update_time datetime default CURRENT_TIMESTAMP null on update CURRENT_TIMESTAMP comment æ›´æ–°æ—¶é—´, constraint phone_idx unique (phone)) comment ç”¨æˆ·è¡¨ row_format = DYNAMIC; é…ç½® pom.xml !-- mybatis-plus ç‰ˆæœ¬ --mybatis-plus.version3.5.9/mybatis-plus.version!-- mysql é©±åŠ¨ ç‰ˆæœ¬ --mysql-connector-java.version8.0.33/mysql-connector-java.versiondependency groupIdcom.baomidou/groupId artifactIdmybatis-plus-bom/artifactId version$mybatis-plus.version/version typepom/type scopeimport/scope/dependencydependency groupIdmysql/groupId artifactIdmysql-connector-java/artifactId version$mysql-connector-java.version/version/dependency cshop-userpom.xml dependency groupIdcom.baomidou/groupId artifactIdmybatis-plus-spring-boot3-starter/artifactId/dependencydependency groupIdmysql/groupId artifactIdmysql-connector-java/artifactId/dependency!-- å¯†ç åŠ å¯† --dependency groupIdorg.springframework.security/groupId artifactIdspring-security-crypto/artifactId/dependency cshop-usersrcmainresourcesapplication.yml spring: # mysqlé…ç½® datasource: username: root password: MIIEowIBAAKCAQEAwG90ULRHmAXFXQzZSwleoYts2+bCzUvqhhqtGiv/F5kUsETY url: jdbc:mysql://116.198.217.158:3306/cshop-user?useUnicode=truecharacterEncoding=utf-8useSSL=falseserverTimezone=Asia/Shanghai driver-class-name: com.mysql.cj.jdbc.Driver# é…ç½® mybatis plus æ‰“å° sql æ—¥å¿—mybatis-plus: configuration: log-impl: org.apache.ibatis.logging.stdout.StdOutImpl æ³¨å†ŒåŠŸèƒ½å¼€å‘BCryptPasswordEncoder cshop-usersrcmainJavagithublianyutiancshopuserconfigSecurityConfig.Java package github.lianyutian.cshop.user.config;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;import org.springframework.security.crypto.password.PasswordEncoder;/** * å¯†ç åŠ å¯† * * @author lianyutian * @since 2024-12-24 15:16:39 * @version 1.0 */@Configurationpublic class SecurityConfig @Bean public PasswordEncoder passwordEncoder() return new BCryptPasswordEncoder(); cshop-usersrcmainJavagithublianyutiancshopusermodelparamUserRegisterParam.Java package github.lianyutian.cshop.user.model.param;import lombok.Data;/** * ç”¨æˆ·æ³¨å†Œå‚æ•° * * @author lianyutian * @since 2024-12-24 13:30:19 * @version 1.0 */@Datapublic class UserRegisterParam /** ç”¨æˆ·å */ private String name; /** å¯†ç  */ private String password; /** ç”¨æˆ·å¤´åƒ */ private String avatar; /** æ€§åˆ« 0 å¥³ï¼Œ1 ç”· */ private String sex; /** æ‰‹æœºå· */ private String phone; /** éªŒè¯ç  */ private String code; cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserController.Java /** * ç”¨æˆ·æ³¨å†Œ * * @param userRegisterVO æ³¨å†Œä¿¡æ¯ * @return æ³¨å†Œç»“æœ */@PostMapping(register)public ApiResultVoid register(@RequestBody UserRegisterParam userRegisterParam) return userService.register(userRegisterVO); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserService.Java package github.lianyutian.cshop.user.service;import github.lianyutian.cshop.common.model.ApiResult;import github.lianyutian.cshop.user.model.param.UserRegisterParam;/** * ç”¨æˆ·æœåŠ¡æ¥å£ * * @author lianyutian * @since 2024-12-24 08:41:57 * @version 1.0 */public interface UserService /** * ç”¨æˆ·æ³¨å†Œ * * @param userRegisterParam ç”¨æˆ·æ³¨å†Œå…¥å‚ * @return æ³¨å†Œç»“æœ */ ApiResultVoid register(UserRegisterParam userRegisterParam); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserServiceImpl.Java package github.lianyutian.cshop.user.service.impl;import github.lianyutian.cshop.common.enums.BizCodeEnum;import github.lianyutian.cshop.common.exception.BizException;import github.lianyutian.cshop.common.model.ApiResult;import github.lianyutian.cshop.common.redis.RedisCache;import github.lianyutian.cshop.common.utils.BeanUtil;import github.lianyutian.cshop.user.mapper.UserMapper;import github.lianyutian.cshop.user.model.param.UserRegisterParam;import github.lianyutian.cshop.user.model.po.User;import github.lianyutian.cshop.user.service.UserService;import java.util.concurrent.TimeUnit;import lombok.RequiredArgsConstructor;import lombok.extern.slf4j.Slf4j;import org.apache.commons.lang3.StringUtils;import org.springframework.beans.BeanUtils;import org.springframework.dao.DuplicateKeyException;import org.springframework.security.crypto.password.PasswordEncoder;import org.springframework.stereotype.Service;import org.springframework.transaction.annotation.Transactional;import org.springframework.util.CollectionUtils;/** * ç”¨æˆ·æœåŠ¡å®ç°ç±» * * @author lianyutian * @since 2024-12-24 08:44:49 * @version 1.0 */@Service@Slf4j@RequiredArgsConstructorpublic class UserServiceImpl implements UserService private final UserMapper userMapper; private final PasswordEncoder passwordEncoder; private final RedisCache redisCache; private final RedisLock redisLock; @Override @Transactional public ApiResultVoid register(UserRegisterParam userRegisterParam) // 1. æ ¡éªŒæ³¨å†ŒéªŒè¯ç æ˜¯å¦æ­£ç¡® boolean checked = checkCode(userRegisterParam.getPhone(), userRegisterParam.getCode()); if (!checked) return ApiResult.result(BizCodeEnum.USER_CODE_PHONE_ERROR); // 1.2 é€šè¿‡æ‰‹æœºå·å”¯ä¸€ç´¢å¼•å®ç°å”¯ä¸€ User user = new User(); BeanUtils.copyProperties(userRegisterParam, user); // å¯†ç åŠ å¯† String secretPwd = passwordEncoder.encode(userRegisterParam.getPassword()); user.setPwd(secretPwd); try userMapper.insert(user); catch (DuplicateKeyException e) log.warn(ç”¨æˆ·å¾®æœåŠ¡-æ³¨å†Œæ¨¡å—-ç”¨æˆ·å·²å­˜åœ¨ , userRegisterParam.getPhone()); return ApiResult.result(BizCodeEnum.USER_ACCOUNT_EXIST); return ApiResult.success(); private boolean checkCode(String phone, String code) // å…ˆä»ç¼“å­˜ä¸­è·å–éªŒè¯ç  key - cshop-user:register-captcha:ç”µè¯ String cacheKey = UserCacheKeyConstant.CAPTCHA_REGISTER_KEY_PREFIX + phone; String codeVal = redisCache.get(cacheKey); if (StringUtils.isBlank(codeVal)) return false; String[] parts = codeVal.split(_); String registerCode = parts[0]; if (registerCode.equals(code)) // åˆ é™¤éªŒè¯ç ï¼Œç¡®ä¿éªŒè¯ç ä¸å¯ä»¥é‡å¤ä½¿ç”¨ redisCache.delete(cacheKey); return true; return false; cshop-usersrcmainJavagithublianyutiancshopusermapperUserMapper.Java package github.lianyutian.cshop.user.mapper;import com.baomidou.mybatisplus.core.mapper.BaseMapper;import github.lianyutian.cshop.user.model.po.User;import org.apache.ibatis.annotations.Mapper;/** * UserMapper * * @author lianyutian * @since 2024-12-24 14:19:30 * @version 1.0 */@Mapperpublic interface UserMapper extends BaseMapperUser ç”¨æˆ·ç™»å½•pom é…ç½® pom.xml !-- jwt ç‰ˆæœ¬ --jwt.version0.12.6/jwt.version!-- https://mvnrepository.com/artifact/io.jsonwebtoken/jjwt --dependency groupIdio.jsonwebtoken/groupId artifactIdjjwt/artifactId version$jwt.version/version/dependency cshop-commonpom.xml dependency groupIdio.jsonwebtoken/groupId artifactIdjjwt/artifactId/dependency åŠŸèƒ½å¼€å‘ cshop-usersrcmainJavagithublianyutiancshopusermodelvoUserLoginParam.Java package github.lianyutian.cshop.user.model.param;import lombok.Data;/** * ç”¨æˆ·ç™»å½•å‚æ•° * * @author lianyutian * @since 2024-12-24 08:40:33 * @version 1.0 */@Datapublic class UserLoginParam /** æ‰‹æœºå· */ private String phone; /** å¯†ç  */ private String password; cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserController.Java /** * ç”¨æˆ·ç™»å½• * * @param userLoginParam ç”¨æˆ·ç™»å½•å…¥å‚ * @return ç™»å½•ç»“æœ */@PostMapping(login)public ApiResultMapString, Object login(@RequestBody UserLoginParam userLoginParam) return userService.login(userLoginParam); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserService.Java /** * ç”¨æˆ·ç™»å½• * * @param userLoginParam ç”¨æˆ·ç™»å½•å…¥å‚ * @return ç™»å½•ç»“æœ */ApiResultMapString, Object login(UserLoginParam userLoginParam); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserServiceImpl.Java @Overridepublic ApiResultMapString, Object login(UserLoginParam userLoginParam) // æ ¹æ®æ‰‹æœºå·æŸ¥è¯¢æ˜¯å¦å­˜åœ¨ LambdaQueryWrapperUser queryWrapper = new LambdaQueryWrapper(); queryWrapper.eq(User::getPhone, userLoginParam.getPhone()); User user = userMapper.selectOne(queryWrapper); if (user == null) // æœªæ³¨å†Œ return ApiResult.result(BizCodeEnum.USER_ACCOUNT_PWD_ERROR); // æ ¡éªŒå¯†ç  if (passwordEncoder.matches(userLoginParam.getPassword(), user.getPwd())) // TODO ç™»å½•æˆåŠŸï¼Œç”Ÿæˆ jwt return null; else return ApiResult.result(BizCodeEnum.USER_ACCOUNT_PWD_ERROR); é‰´æƒä¸åˆ·æ–°JWT JWTï¼ˆJSON Web Tokenï¼‰é‰´æƒä¸ä¼ ç»Ÿé‰´æƒåœ¨æŠ€æœ¯å®ç°ã€ä½¿ç”¨åœºæ™¯å’Œæ€§èƒ½ç­‰æ–¹é¢å­˜åœ¨æ˜¾è‘—åŒºåˆ«ï¼Œä»¥ä¸‹æ˜¯ä¸¤è€…çš„ä¸»è¦å¯¹æ¯”ï¼š 1. æ•°æ®å­˜å‚¨ä¸çŠ¶æ€ç®¡ç† ä¼ ç»Ÿé‰´æƒ ä½¿ç”¨ ä¼šè¯æœºåˆ¶ï¼ŒæœåŠ¡å™¨ä¼šåœ¨å†…å­˜ï¼ˆæˆ–æ•°æ®åº“ï¼‰ä¸­ç»´æŠ¤ç”¨æˆ·çŠ¶æ€ã€‚ é€šå¸¸é€šè¿‡ Session ID æ ‡è¯†ç”¨æˆ·ï¼ŒSession ID å­˜å‚¨åœ¨ Cookie ä¸­ï¼Œç”±å®¢æˆ·ç«¯éšæ¯ä¸ªè¯·æ±‚å‘é€ç»™æœåŠ¡å™¨ã€‚ éœ€è¦åœ¨æœåŠ¡å™¨ç«¯ç»´æŠ¤ä¼šè¯çŠ¶æ€ï¼Œå› æ­¤ä¼šè¯ç®¡ç†çš„æ‰©å±•æ€§è¾ƒå·®ï¼ˆå¦‚åˆ†å¸ƒå¼éƒ¨ç½²æ—¶éœ€è¦é¢å¤–è§£å†³ä¼šè¯å…±äº«é—®é¢˜ï¼‰ã€‚ JWT é‰´æƒ åŸºäº æ— çŠ¶æ€ çš„è®¾è®¡ï¼ŒæœåŠ¡å™¨ä¸éœ€è¦ä¿å­˜ä»»ä½•ä¼šè¯ä¿¡æ¯ã€‚ ç”¨æˆ·çš„è®¤è¯ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ· IDã€è§’è‰²ç­‰ï¼‰è¢«ç¼–ç ä¸ºä¸€ä¸ªåŠ å¯†åçš„ Tokenï¼Œç”±å®¢æˆ·ç«¯å­˜å‚¨ï¼ˆå¦‚ Cookie æˆ– Local Storageï¼‰å¹¶åœ¨æ¯æ¬¡è¯·æ±‚æ—¶å‘é€ç»™æœåŠ¡å™¨ã€‚ é€‚ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå› ä¸ºä¸éœ€è¦ä¾èµ–æœåŠ¡å™¨çš„ä¼šè¯å­˜å‚¨ã€‚ 2. å®‰å…¨æ€§ ä¼ ç»Ÿé‰´æƒ Session ID æœ¬èº«é€šå¸¸æ²¡æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œä»…ç”¨æ¥ç´¢å¼•æœåŠ¡å™¨å­˜å‚¨çš„ç”¨æˆ·æ•°æ®ã€‚ éœ€è¦é˜²èŒƒ ä¼šè¯åŠ«æŒ å’Œ è·¨ç«™ç‚¹ä¼ªé€ è¯·æ±‚ï¼ˆCSRFï¼‰ã€‚ JWT é‰´æƒ Token è‡ªåŒ…å«ç”¨æˆ·æ•°æ®ï¼Œä¸”é€šè¿‡ç­¾åï¼ˆå¦‚ HMAC æˆ– RSAï¼‰é˜²ç¯¡æ”¹ã€‚ å¦‚æœå¯†é’¥æ³„éœ²ï¼Œæ”»å‡»è€…å¯èƒ½ä¼ªé€  Tokenï¼Œå› æ­¤å¯†é’¥çš„å®‰å…¨æ€§å°¤ä¸ºé‡è¦ã€‚ éœ€è¦é¢å¤–æ³¨æ„ Token çš„ç”Ÿå‘½å‘¨æœŸå’Œåˆ·æ–°ç­–ç•¥ï¼Œé¿å…è¢«çªƒå–åé•¿æœŸæœ‰æ•ˆã€‚ 3. æ‰©å±•æ€§å’Œæ€§èƒ½ ä¼ ç»Ÿé‰´æƒ éœ€è¦æœåŠ¡å™¨å¤„ç†å’Œå­˜å‚¨æ¯ä¸ªç”¨æˆ·çš„ä¼šè¯çŠ¶æ€ï¼Œéšç€ç”¨æˆ·æ•°é‡å¢åŠ ï¼Œæ‰©å±•æ€§æœ‰é™ã€‚ æ¯æ¬¡ç”¨æˆ·è¯·æ±‚éƒ½ä¼šæ¶‰åŠæœåŠ¡å™¨ç«¯çŠ¶æ€çš„è¯»å–æ“ä½œï¼Œå¢åŠ äº†æœåŠ¡å™¨çš„è´Ÿæ‹…ã€‚ JWT é‰´æƒ ä¸éœ€è¦åœ¨æœåŠ¡å™¨ç«¯å­˜å‚¨çŠ¶æ€ä¿¡æ¯ï¼Œæ‰€æœ‰ä¿¡æ¯éƒ½åœ¨ Token ä¸­æºå¸¦ï¼ŒæœåŠ¡å™¨åªéœ€éªŒè¯ Tokenã€‚ å‡å°‘äº†æœåŠ¡å™¨è´Ÿæ‹…ï¼Œå°¤å…¶é€‚åˆé«˜å¹¶å‘åœºæ™¯ã€‚ 4. ç”Ÿå‘½å‘¨æœŸå’Œåˆ·æ–°æœºåˆ¶ ä¼ ç»Ÿé‰´æƒ Session é€šå¸¸æœ‰æ˜ç¡®çš„è¿‡æœŸæ—¶é—´ï¼Œå¯ä»¥é€šè¿‡æœåŠ¡å™¨ç«¯ç›´æ¥å¤±æ•ˆï¼ˆåˆ é™¤ä¼šè¯æ•°æ®ï¼‰ã€‚ æä¾›è¾ƒç®€å•çš„ä¼šè¯ç®¡ç†å’Œç”¨æˆ·é€€å‡ºæœºåˆ¶ã€‚ JWT é‰´æƒ JWT ä¸€æ—¦ç­¾å‘ï¼Œåœ¨è¿‡æœŸä¹‹å‰æ— æ³•ç›´æ¥ä½¿å…¶å¤±æ•ˆï¼ˆé™¤éå¼•å…¥é¢å¤–çš„é»‘åå•æœºåˆ¶ï¼‰ã€‚ é€šå¸¸ä½¿ç”¨ çŸ­æœŸ Token + åˆ·æ–° Token çš„ç»„åˆï¼ŒçŸ­æœŸ Token è¿‡æœŸåç”¨åˆ·æ–° Token è·å–æ–° Tokenã€‚ 5. ä½¿ç”¨åœºæ™¯ ä¼ ç»Ÿé‰´æƒ æ›´é€‚åˆéœ€è¦é¢‘ç¹äº¤äº’çš„å°å‹æˆ–å•ä½“åº”ç”¨ã€‚ å½“å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜æ—¶ï¼Œå¯ä»¥å€ŸåŠ©æœåŠ¡å™¨ç®¡ç†ä¼šè¯æ¥æ›´çµæ´»åœ°æ§åˆ¶ç”¨æˆ·æƒé™ã€‚ JWT é‰´æƒ æ›´é€‚åˆå¾®æœåŠ¡æ¶æ„ã€ç§»åŠ¨åº”ç”¨ã€å•é¡µåº”ç”¨ï¼ˆSPAï¼‰ç­‰åˆ†å¸ƒå¼åœºæ™¯ã€‚ è·¨åŸŸæ”¯æŒæ›´å‹å¥½ï¼Œå› ä¸ºå¯ä»¥ä½¿ç”¨ HTTP æ ‡å¤´ä¼ é€’ Tokenã€‚ æ€»ç»“ ç‰¹æ€§ ä¼ ç»Ÿé‰´æƒ JWT é‰´æƒ çŠ¶æ€ç®¡ç† æœ‰çŠ¶æ€ï¼Œéœ€è¦æœåŠ¡å™¨å­˜å‚¨ æ— çŠ¶æ€ï¼Œæ‰€æœ‰ä¿¡æ¯åœ¨ Token ä¸­ æ‰©å±•æ€§ ä½ï¼Œéœ€å¤„ç†ä¼šè¯å…±äº« é«˜ï¼Œé€‚åˆåˆ†å¸ƒå¼ç³»ç»Ÿ å®‰å…¨æ€§ ä¾èµ–æœåŠ¡å™¨æ§åˆ¶ å¯†é’¥ç®¡ç†å’Œ Token å®‰å…¨æ€§å…³é”® ç”Ÿå‘½å‘¨æœŸ æœåŠ¡ç«¯å¯éšæ—¶æ§åˆ¶ä¼šè¯å¤±æ•ˆ ç”Ÿå‘½å‘¨æœŸæ§åˆ¶å¤æ‚ï¼ˆéœ€åˆ·æ–°æœºåˆ¶ï¼‰ é€‚ç”¨åœºæ™¯ å°å‹æˆ–å•ä½“åº”ç”¨ åˆ†å¸ƒå¼ç³»ç»Ÿã€ç§»åŠ¨å‰åç«¯åˆ†ç¦»åº”ç”¨ JWTï¼ˆJSON Web Tokenï¼‰è‡ªåŠ¨åˆ·æ–°æœºåˆ¶ä¸»è¦ç”¨äºæå‡ç”¨æˆ·ä½“éªŒå’Œå®‰å…¨æ€§ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åŸå› ï¼š æå‡ç”¨æˆ·ä½“éªŒï¼š å‡å°‘ç™»å½•é¢‘ç‡ï¼šé€šè¿‡è‡ªåŠ¨åˆ·æ–°æœºåˆ¶ï¼Œç”¨æˆ·ä¸éœ€è¦é¢‘ç¹é‡æ–°ç™»å½•ã€‚å½“ç”¨æˆ·çš„è®¿é—®ä»¤ç‰Œï¼ˆAccess Tokenï¼‰è¿‡æœŸæ—¶ï¼Œç³»ç»Ÿå¯ä»¥ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œï¼ˆRefresh Tokenï¼‰è‡ªåŠ¨è·å–æ–°çš„è®¿é—®ä»¤ç‰Œï¼Œä»è€Œä¿æŒç”¨æˆ·ä¼šè¯çš„è¿ç»­æ€§ã€‚ å¢å¼ºå®‰å…¨æ€§ï¼š çŸ­æœŸæœ‰æ•ˆçš„è®¿é—®ä»¤ç‰Œï¼šè®¿é—®ä»¤ç‰Œé€šå¸¸è®¾ç½®è¾ƒçŸ­çš„æœ‰æ•ˆæœŸï¼ˆä¾‹å¦‚ 15 åˆ†é’Ÿï¼‰ï¼Œè¿™æ ·å³ä½¿è®¿é—®ä»¤ç‰Œè¢«æ³„éœ²ï¼Œæ”»å‡»è€…ä¹Ÿæ— æ³•é•¿æ—¶é—´ä½¿ç”¨å®ƒã€‚ é•¿æœŸæœ‰æ•ˆçš„åˆ·æ–°ä»¤ç‰Œï¼šåˆ·æ–°ä»¤ç‰Œé€šå¸¸è®¾ç½®è¾ƒé•¿çš„æœ‰æ•ˆæœŸï¼ˆä¾‹å¦‚ 30 å¤©ï¼‰ï¼Œä½†åªèƒ½ç”¨äºè·å–æ–°çš„è®¿é—®ä»¤ç‰Œï¼Œä¸èƒ½ç›´æ¥è®¿é—®å—ä¿æŠ¤çš„èµ„æºã€‚è¿™æ ·å³ä½¿åˆ·æ–°ä»¤ç‰Œè¢«æ³„éœ²ï¼Œæ”»å‡»è€…ä¹Ÿæ— æ³•ç›´æ¥è®¿é—®ç”¨æˆ·æ•°æ®ã€‚ æ’¤é”€æœºåˆ¶ï¼šå¦‚æœæ€€ç–‘åˆ·æ–°ä»¤ç‰Œè¢«æ³„éœ²ï¼Œå¯ä»¥ç«‹å³æ’¤é”€è¯¥ä»¤ç‰Œï¼Œä»è€Œé˜²æ­¢è¿›ä¸€æ­¥çš„æœªæˆæƒè®¿é—®ã€‚ çµæ´»æ€§ï¼š åŠ¨æ€è°ƒæ•´ä»¤ç‰Œæœ‰æ•ˆæœŸï¼šå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚åŠ¨æ€è°ƒæ•´è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œçš„æœ‰æ•ˆæœŸï¼Œä»¥å¹³è¡¡å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒã€‚ å®ç° JWT è‡ªåŠ¨åˆ·æ–°çš„æ­¥éª¤: ç”Ÿæˆè®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œï¼š å½“ç”¨æˆ·ç™»å½•æˆåŠŸæ—¶ï¼Œç”Ÿæˆä¸€ä¸ªçŸ­æœŸæœ‰æ•ˆçš„è®¿é—®ä»¤ç‰Œå’Œä¸€ä¸ªé•¿æœŸæœ‰æ•ˆçš„åˆ·æ–°ä»¤ç‰Œã€‚ å°†è®¿é—®ä»¤ç‰Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¹¶å°†åˆ·æ–°ä»¤ç‰Œå­˜å‚¨åœ¨å®‰å…¨çš„åœ°æ–¹ï¼ˆå¦‚æœåŠ¡å™¨ç«¯çš„æ•°æ®åº“æˆ–ç¼“å­˜ä¸­ï¼‰ã€‚ å®¢æˆ·ç«¯å­˜å‚¨ä»¤ç‰Œï¼š å®¢æˆ·ç«¯é€šå¸¸å°†è®¿é—®ä»¤ç‰Œå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼ˆå¦‚æµè§ˆå™¨çš„ localStorage æˆ– sessionStorageï¼‰ï¼Œå¹¶åœ¨æ¯æ¬¡è¯·æ±‚æ—¶å°†å…¶é™„åŠ åˆ°è¯·æ±‚å¤´ä¸­ã€‚ åˆ·æ–°ä»¤ç‰Œé€šå¸¸å­˜å‚¨åœ¨æ›´å®‰å…¨çš„åœ°æ–¹ï¼Œå¦‚ HTTP-only Cookieï¼Œä»¥é˜²æ­¢ XSS æ”»å‡»ã€‚ è®¿é—®ä»¤ç‰Œè¿‡æœŸå¤„ç†ï¼š å½“è®¿é—®ä»¤ç‰Œè¿‡æœŸæ—¶ï¼Œå®¢æˆ·ç«¯ä¼šå°è¯•ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œè·å–æ–°çš„è®¿é—®ä»¤ç‰Œã€‚ å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œè¯·æ±‚ä¸­åŒ…å«åˆ·æ–°ä»¤ç‰Œã€‚ æœåŠ¡å™¨éªŒè¯åˆ·æ–°ä»¤ç‰Œçš„æœ‰æ•ˆæ€§ï¼Œå¦‚æœæœ‰æ•ˆï¼Œåˆ™ç”Ÿæˆä¸€ä¸ªæ–°çš„è®¿é—®ä»¤ç‰Œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ åˆ·æ–°ä»¤ç‰Œçš„å®‰å…¨æ€§ï¼š åˆ·æ–°ä»¤ç‰Œåº”è¯¥å­˜å‚¨åœ¨å®‰å…¨çš„åœ°æ–¹ï¼Œé˜²æ­¢è¢«çªƒå–ã€‚ å¯ä»¥è®¾ç½®åˆ·æ–°ä»¤ç‰Œçš„è¿‡æœŸæ—¶é—´ï¼Œå¹¶åœ¨ç”¨æˆ·ç™»å‡ºæ—¶ç«‹å³æ’¤é”€åˆ·æ–°ä»¤ç‰Œã€‚ å¯ä»¥é™åˆ¶æ¯ä¸ªåˆ·æ–°ä»¤ç‰Œåªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œä½¿ç”¨åç«‹å³å¤±æ•ˆã€‚ 7.8.1 pom é…ç½® pom.xml !-- jwt ç‰ˆæœ¬ --jwt.version0.12.6/jwt.version!-- https://mvnrepository.com/artifact/io.jsonwebtoken/jjwt --dependency groupIdio.jsonwebtoken/groupId artifactIdjjwt/artifactId version$jwt.version/version/dependency cshop-commonpom.xml dependency groupIdio.jsonwebtoken/groupId artifactIdjjwt/artifactId/dependency 7.8.2 åŠŸèƒ½å¼€å‘7.8.2.1 jwt ç”Ÿæˆ cshop-commonsrcmainJavagithublianyutiancshopcommonutilsJWTUtil.Java package github.lianyutian.cshop.common.utils;import github.lianyutian.cshop.common.model.LoginUserInfo;import io.jsonwebtoken.Claims;import io.jsonwebtoken.Jws;import io.jsonwebtoken.Jwts;import io.jsonwebtoken.security.Keys;import java.util.Date;import java.util.HashMap;import java.util.Map;import lombok.extern.slf4j.Slf4j;/** * jwt å·¥å…·ç±» * * @author lianyutian * @since 2024-12-24 10:01:54 * @version 1.0 */@Slf4jpublic class JWTUtil /** AccessToken è¿‡æœŸæ—¶é—´ï¼Œæ­£å¸¸è¿‡æœŸæ—¶é—´ 7 å¤© */ private static final long EXPIRE = 1000L * 60 * 60 * 24 * 7; /** RefreshToken è¿‡æœŸæ—¶é—´ï¼Œæ­£å¸¸è¿‡æœŸæ—¶é—´ 30 å¤© */ public static final long REFRESH_EXPIRE = 1000L * 60 * 60 * 24 * 30; /** åŠ å¯†çš„å¯†é’¥ï¼Œä»ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶ä¸­è¯»å– */ private static final String SECRET = MIIEowIBAAKCAQEAwG90ULRHmAXFXQzZSwleoYts2+bCzUvqhhqtGiv/F5kUsETY; /** token å‰ç¼€ */ private static final String TOKEN_PREFIX = circle-shop.; /** SUBJECT */ private static final String SUBJECT = circle-shop; public static final String KEY_PREFIX = circle-shop:refresh-token:; /** * æ ¹æ®ç”¨æˆ·ä¿¡æ¯ï¼Œç”Ÿæˆ JWT ä»¤ç‰Œ * * @return JWT ä»¤ç‰Œ */ public static MapString, Object createJwt(LoginUserInfo loginUserInfo) if (loginUserInfo == null) throw new NullPointerException(ç™»å½•å¯¹è±¡ä¸ºç©º); // è¿‡æœŸæ—¶é—´ Date expireTime = new Date(System.currentTimeMillis() + EXPIRE); // ç”Ÿæˆ JWT TOKEN String token = Jwts.builder() .subject(SUBJECT) // payload .claim(id, loginUserInfo.getId()) .claim(name, loginUserInfo.getName()) .claim(avatar, loginUserInfo.getAvatar()) .issuedAt(new Date()) .expiration(expireTime) // åŠ å¯†ç®—æ³• .signWith(Keys.hmacShaKeyFor(SECRET.getBytes()), Jwts.SIG.HS256) .compact(); // åŠ å‰ç¼€åŒºåˆ†ä¸šåŠ¡ token = TOKEN_PREFIX + token; MapString, Object result = new HashMap(); result.put(AccessToken, token); result.put(AccessTokenExpireTime, expireTime); result.put(RefreshToken, CommonUtil.generateUUID()); log.info(å…¬å…±æœåŠ¡-ç”Ÿæˆ tokenï¼Œè¿‡æœŸæ—¶é—´ï¼š, expireTime); return result; /** * æ ¡éªŒ token æ˜¯å¦æ­£ç¡® * * @param token token * @return Claims */ public static Claims parserToken(String token) if (token == null || !token.startsWith(TOKEN_PREFIX)) log.warn(å…¬å…±æœåŠ¡-è§£æ token å¤±è´¥ï¼šæ— æ•ˆçš„ token æ ¼å¼); return null; try // å»é™¤å‰ç¼€åè§£æ String cleanToken = token.replace(TOKEN_PREFIX, ); // jws è§£æ JwsClaims claims = Jwts.parser() .verifyWith(Keys.hmacShaKeyFor(SECRET.getBytes())) .build() .parseSignedClaims(cleanToken); log.info(å…¬å…±æœåŠ¡-è§£æ token æˆåŠŸ); return claims.getPayload(); catch (Exception e) log.error(å…¬å…±æœåŠ¡-è§£æ token å¤±è´¥ï¼š, e.getMessage(), e); return null; 7.8.2.2 ç™»å½•æˆåŠŸç”Ÿæˆ jwt cshop-usersrcmainJavagithublianyutiancshopuserserviceUserServiceImpl.Java @Overridepublic ApiResultMapString, Object login(UserLoginParam userLoginParam) // æ ¹æ®æ‰‹æœºå·æŸ¥è¯¢æ˜¯å¦å­˜åœ¨ LambdaQueryWrapperUser queryWrapper = new LambdaQueryWrapper(); queryWrapper.eq(User::getPhone, userLoginParam.getPhone()); User user = userMapper.selectOne(queryWrapper); if (user == null) // æœªæ³¨å†Œ return ApiResult.result(BizCodeEnum.USER_ACCOUNT_PWD_ERROR); // æ ¡éªŒå¯†ç  if (passwordEncoder.matches(userLoginParam.getPassword(), user.getPwd())) // ç™»å½•æˆåŠŸï¼Œç”Ÿæˆ jwt MapString, Object jwt = createNewJwt(user); return ApiResult.success(jwt); else return ApiResult.result(BizCodeEnum.USER_ACCOUNT_PWD_ERROR); private MapString, Object createNewJwt(User user) // ç™»å½•æˆåŠŸï¼Œç”Ÿæˆ Token LoginUserInfo loginUserInfo = BeanUtil.copy(user, LoginUserInfo.class); BeanUtils.copyProperties(user, loginUserInfo); // ç”Ÿæˆ JWT Tokenï¼Œè¿‡æœŸæ—¶é—´ MapString, Object jwt = JWTUtil.createJwt(loginUserInfo); // 4ã€è®¾ç½® RefreshToken åˆ° Redis ä¸­ï¼Œè¿‡æœŸæ—¶é—´ä¸º 30 å¤© String newRefreshToken = (String) jwt.get(RefreshToken); String key = JWTUtil.KEY_PREFIX + newRefreshToken; redisCache.set(key, 1, JWTUtil.REFRESH_EXPIRE, TimeUnit.MILLISECONDS); return jwt; 7.8.2.3 åˆ·æ–° token cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserController.Java /** * åˆ·æ–° token * * @param refreshToken refreshToken * @param accessToken accessToken * @return æ–°çš„ token */@PostMapping(refreshToken)public ApiResultMapString, Object refreshToken( @RequestParam(value = refreshToken) String refreshToken, @RequestParam(value = accessToken) String accessToken) return userService.refreshToken(refreshToken, accessToken); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserService.Java /** * åˆ·æ–° token * * @param refreshToken åˆ·æ–° token * @param accessToken è®¿é—® token */ApiResultMapString, Object refreshToken(String refreshToken, String accessToken); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserServiceImpl.Java @Overridepublic ApiResultMapString, Object refreshToken(String refreshToken, String accessToken) String refreshTokenVal = redisCache.get(JWTUtil.KEY_PREFIX + refreshToken); // refreshToken è¿‡æœŸ if (StringUtils.isBlank(refreshTokenVal)) return ApiResult.result(BizCodeEnum.USER_REFRESH_TOKEN_EMPTY); // 2ã€å¦‚æœ refreshToken å­˜åœ¨ï¼Œè§£å¯† accessToken Claims claims = JWTUtil.parserToken(accessToken); if (claims == null) // æ— æ³•è§£å¯†æç¤ºæœªç™»å½• return ApiResult.result(BizCodeEnum.USER_ACCOUNT_UNLOGIN); // 3ã€å¦‚æœå¯ä»¥è§£å¯† accessTokenï¼Œ åˆ™é‡æ–°ç”Ÿæˆ accessToken ç­‰ä¿¡æ¯è¿”å› long userId = Long.parseLong(claims.get(id).toString()); LambdaQueryWrapperUser queryWrapper = new LambdaQueryWrapper(); queryWrapper.eq(User::getId, userId); User user = userMapper.selectOne(queryWrapper); if (user != null) MapString, Object jwt = createNewJwt(user); // åˆ é™¤æ—§çš„ refreshToken redisCache.delete(JWTUtil.KEY_PREFIX + refreshToken); return ApiResult.success(jwt); else // æ— æ³•è§£å¯†æç¤ºæœªç™»å½• return ApiResult.result(BizCodeEnum.USER_ACCOUNT_UNLOGIN); 7.9 ç™»å½•æ‹¦æˆªåœ¨ç”¨æˆ·ç™»å½•æ—¶å¯ä»¥è·å–åˆ° token ä¿¡æ¯ï¼Œåœ¨è®¿é—®ä¸€äº›æ¥å£æ—¶éœ€è¦åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ã€‚æ­¤æ—¶å¯ä»¥åœ¨ä½¿ç”¨ Interceptor æ‹¦æˆªå™¨æ‹¦æˆªè¯·æ±‚æ¥å£è§£æ token åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ã€‚ cshop-commonsrcmainJavagithublianyutiancshopcommoninterceptorLoginInterceptor.Java package github.lianyutian.cshop.common.interceptor;import github.lianyutian.cshop.common.enums.BizCodeEnum;import github.lianyutian.cshop.common.model.ApiResult;import github.lianyutian.cshop.common.model.LoginUserInfo;import github.lianyutian.cshop.common.utils.CommonUtil;import github.lianyutian.cshop.common.utils.JWTUtil;import github.lianyutian.cshop.common.utils.JsonUtil;import io.jsonwebtoken.Claims;import jakarta.servlet.http.HttpServletRequest;import jakarta.servlet.http.HttpServletResponse;import lombok.extern.slf4j.Slf4j;import org.apache.commons.lang3.StringUtils;import org.springframework.web.servlet.HandlerInterceptor;/** * ç™»å½•æ‹¦æˆª * * @author lianyutian * @since 2024-12-25 15:47:02 * @version 1.0 */@Slf4jpublic class LoginInterceptor implements HandlerInterceptor public static final ThreadLocalLoginUserInfo USER_THREAD_LOCAL = new ThreadLocal(); @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception String token = request.getHeader(token); if (StringUtils.isBlank(token)) token = request.getParameter(token); Claims claims = JWTUtil.parserToken(token); if (claims == null) // è§£å¯†å¤±è´¥ï¼Œç™»å½•è¿‡æœŸï¼Œæç¤ºè´¦å·æœªç™»å½• CommonUtil.sendResponse(response, ApiResult.result(BizCodeEnum.USER_ACCOUNT_UNLOGIN)); return false; long id = Long.parseLong(claims.get(id).toString()); String avatar = (String) claims.get(avatar); String name = (String) claims.get(name); LoginUserInfo loginUserInfo = LoginUserInfo.builder().id(id).avatar(avatar).name(name).build(); USER_THREAD_LOCAL.set(loginUserInfo); log.info(ç™»å½•æ‹¦æˆªå™¨--ç”¨æˆ·ä¿¡æ¯ï¼š, JsonUtil.toJson(loginUserInfo)); return true; é…ç½®æ‹¦æˆªè·¯å¾„ cshop-commonsrcmainJavagithublianyutiancshopcommoninterceptorconfigInterceptorConfig.Java package github.lianyutian.cshop.common.interceptor.config;import github.lianyutian.cshop.common.interceptor.LoginInterceptor;import lombok.extern.slf4j.Slf4j;import org.springframework.context.annotation.Configuration;import org.springframework.web.servlet.config.annotation.InterceptorRegistry;import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;/** * ç™»å½•æ‹¦æˆªé…ç½® * * @author lianyutian * @since 2024-12-25 16:17:31 * @version 1.0 */@Configuration@Slf4jpublic class InterceptorConfig implements WebMvcConfigurer public LoginInterceptor loginInterceptor() return new LoginInterceptor(); @Override public void addInterceptors(InterceptorRegistry registry) registry // æ·»åŠ æ‹¦æˆªå™¨ .addInterceptor(loginInterceptor()) // ä¸éœ€è¦æ‹¦æˆªçš„è·¯å¾„ .excludePathPatterns( /api/user/*/getImgCaptcha, /api/user/*/sendRegisterCode, /api/user/*/register, /api/user/*/login, /api/user/*/uploadUserAvatar, /api/user/*/detailShow/*); 7.10 è·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ cshop-usersrcmainJavagithublianyutiancshopusermodelvoUserDetailVO.Java package github.lianyutian.cshop.user.model.vo;import lombok.Data;/** * ç”¨æˆ·ä¿¡æ¯ VO * * @author lianyutian * @since 2024-12-25 16:22:40 * @version 1.0 */@Datapublic class UserDetailVO private Long id; /** ç”¨æˆ·å */ private String name; /** ç”¨æˆ·å¤´åƒ */ private String avatar; /** 0 å¥³ï¼Œ1 ç”· */ private Integer sex; /** ç”¨æˆ·æ‰‹æœºå· */ private String phone; cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserController.Java /** * ç”¨æˆ·è´¦å·ä¿¡æ¯æŸ¥è¯¢ * * @return ç”¨æˆ·ä¿¡æ¯ */@GetMapping(detail)public ApiResultUserDetailVO detail() UserDetailVO userDetailVO = userService.getUserDetail(); return ApiResult.success(userDetailVO); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserService.Java /** * è·å–ç”¨æˆ·è¯¦æƒ… * * @return ç”¨æˆ·è¯¦æƒ… */UserDetailVO getUserDetail(); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserServiceImpl.Java @Overridepublic UserDetailVO getUserDetail() // é€šè¿‡ç™»å½•æ‹¦æˆªå™¨ä¸­ ThreadLocal è¿›è¡Œäº†ç”¨æˆ·ä¿¡æ¯ä¼ é€’ LoginUserInfo loginUserInfo = LoginInterceptor.USER_THREAD_LOCAL.get(); User user = userMapper.selectOne(new LambdaQueryWrapperUser().eq(User::getId, loginUserInfo.getId())); UserDetailVO userDetailVO = new UserDetailVO(); BeanUtils.copyProperties(user, userDetailVO); return userDetailVO; æ—  token è®¿é—®ç”¨æˆ·ä¿¡æ¯ æœ‰æ•ˆ token è®¿é—®ç”¨æˆ·ä¿¡æ¯ 7.11 ç”¨æˆ·åœ°å€ç›¸å…³ cshop-userdocSQLuser.SQL create table user_address( id bigint unsigned auto_increment primary key, user_id bigint null comment ç”¨æˆ·id, default_status tinyint(1) default 0 null comment æ˜¯å¦é»˜è®¤æ”¶è´§åœ°å€ï¼š0å¦ 1æ˜¯, receive_name varchar(64) null comment æ”¶å‘è´§äººå§“å, phone varchar(64) null comment æ”¶è´§äººç”µè¯, province varchar(64) null comment çœ/ç›´è¾–å¸‚, city varchar(64) null comment å¸‚, region varchar(64) null comment åŒº, detail_address varchar(200) null comment è¯¦ç»†åœ°å€, create_time datetime default CURRENT_TIMESTAMP null comment åˆ›å»ºæ—¶é—´, update_time datetime default CURRENT_TIMESTAMP null on update CURRENT_TIMESTAMP comment æ›´æ–°æ—¶é—´) comment ç”¨æˆ·æ”¶è´§åœ°å€è¡¨ row_format = DYNAMIC;create index uid on user_address (user_id); 7.11.1 æ–°å¢ç”¨æˆ·åœ°å€ cshop-usersrcmainJavagithublianyutiancshopusermodelparamAddressAddParam.Java package github.lianyutian.cshop.user.model.param;import lombok.Data;/** * æ·»åŠ ç”¨æˆ·æ”¶è´§åœ°å€ VO * * @author lianyutian * @since 2024-12-26 10:18:32 * @version 1.0 */@Datapublic class AddressAddParam /** æ˜¯å¦é»˜è®¤æ”¶è´§åœ°å€ï¼š0 å¦ 1 æ˜¯ */ private Integer defaultStatus; /** æ”¶å‘è´§äººå§“å */ private String receiveName; /** æ”¶è´§äººç”µè¯ */ private String phone; /** çœ/ç›´è¾–å¸‚ */ private String province; /** å¸‚ */ private String city; /** åŒº */ private String region; /** è¯¦ç»†åœ°å€ */ private String detailAddress; cshop-usersrcmainJavagithublianyutiancshopuserenumsAddressStatusEnum.Java package github.lianyutian.cshop.user.enums;import lombok.Getter;/** * æ”¶è´§åœ°å€çŠ¶æ€æšä¸¾ * * @author lianyutian * @since 2024-12-26 17:34:38 * @version 1.0 */@Getterpublic enum AddressStatusEnum DEFAULT_STATUS(0, é»˜è®¤åœ°å€), NOT_DEFAULT_STATUS(1, éé»˜è®¤åœ°å€); private final Integer code; private final String message; AddressStatusEnum(Integer code, String message) this.code = code; this.message = message; cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserAddressController.Java package github.lianyutian.cshop.user.controller;/** * UserAddressController * * @author lianyutian * @since 2024-12-26 09:42:18 * @version 1.0 */@AllArgsConstructor@RestController@RequestMapping(/api/address/v1)public class UserAddressController private final UserAddressService userAddressService; /** * æ–°å¢æ”¶è´§åœ°å€ * * @param addressAddParam æ”¶è´§åœ°å€ * @return æ–°å¢ç»“æœ */ @PostMapping(add) public ApiResultVoid add(@RequestBody AddressAddParam addressAddParam) userAddressService.addUserAddress(addressAddParam); return ApiResult.success(); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserAddressService.Java package github.lianyutian.cshop.user.service;/** * ç”¨æˆ·åœ°å€æœåŠ¡æ¥å£ * * @author lianyutian * @since 2024-12-26 09:54:49 * @version 1.0 */public interface UserAddressService /** * æ–°å¢ç”¨æˆ·åœ°å€ * * @param addressAddParam æ–°å¢ç”¨æˆ·åœ°å€å‚æ•° */ void addUserAddress(AddressAddParam addressAddParam); cshop-usersrcmainJavagithublianyutiancshopuserserviceimplUserAddressServiceImpl.Java package github.lianyutian.cshop.user.service.impl;/** * ç”¨æˆ·åœ°å€æœåŠ¡æ¥å£å®ç°ç±» * * @author lianyutian * @since 2024-12-26 09:55:13 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class UserAddressServiceImpl implements UserAddressService private final UserAddressMapper userAddressMapper; @Override @Transactional(rollbackFor = Exception.class) public void addUserAddress(AddressAddParam addressAddParam) LoginUserInfo loginUserInfo = getLoginUserInfo(); UserAddress userAddress = BeanUtil.copy(addressAddParam, UserAddress.class); userAddress.setUserId(loginUserInfo.getId()); setDefaultStatusIfRequired(userAddress); int affectedRows = userAddressMapper.insert(userAddress); log.info( ç”¨æˆ·æ”¶è´§åœ°å€æ¨¡å—-æ–°å¢æ”¶è´§åœ°å€ï¼šaffectedRows=ï¼Œdata=, affectedRows, formatUserAddressForLog(userAddress)); private LoginUserInfo getLoginUserInfo() LoginUserInfo loginUserInfo = LoginInterceptor.USER_THREAD_LOCAL.get(); if (loginUserInfo == null) throw new IllegalStateException(LoginUserInfo not found in ThreadLocal); return loginUserInfo; private void setDefaultStatusIfRequired(UserAddress userAddress) if (Objects.equals( userAddress.getDefaultStatus(), AddressStatusEnum.DEFAULT_STATUS.getCode())) // è®¾ç½®é»˜è®¤çš„ä¸ºéé»˜è®¤çŠ¶æ€ userAddressMapper.update( null, new LambdaUpdateWrapperUserAddress() .set(UserAddress::getDefaultStatus, AddressStatusEnum.NOT_DEFAULT_STATUS.getCode()) .eq(UserAddress::getUserId, userAddress.getUserId()) .eq(UserAddress::getDefaultStatus, AddressStatusEnum.DEFAULT_STATUS.getCode())); private String formatUserAddressForLog(UserAddress userAddress) // åªæ‰“å°å¿…è¦çš„å­—æ®µï¼Œé¿å…æ³„éœ²æ•æ„Ÿä¿¡æ¯ return id= + userAddress.getId() + , userId= + userAddress.getUserId() + , defaultStatus= + userAddress.getDefaultStatus(); cshop-usersrcmainJavagithublianyutiancshopusermapperUserAddressMapper.Java package github.lianyutian.cshop.user.mapper;import com.baomidou.mybatisplus.core.mapper.BaseMapper;import github.lianyutian.cshop.user.model.po.UserAddress;import org.apache.ibatis.annotations.Mapper;/** * UserAddressMapper * * @author lianyutian * @since 2024-12-26 14:19:30 * @version 1.0 */@Mapperpublic interface UserAddressMapper extends BaseMapperUserAddress cshop-usersrcmainresourcesmapperUserAddressMapper.xml ?xml version=1.0 encoding=UTF-8?!DOCTYPE mapper PUBLIC -//mybatis.org//DTD Mapper 3.0//EN http://mybatis.org/dtd/mybatis-3-mapper.dtdmapper namespace=github.lianyutian.cshop.user.mapper.UserAddressMapper resultMap id=BaseResultMap type=github.lianyutian.cshop.user.model.po.UserAddress id property=id column=id jdbcType=BIGINT/ result property=userId column=user_id jdbcType=BIGINT/ result property=defaultStatus column=default_status jdbcType=TINYINT/ result property=receiveName column=receive_name jdbcType=VARCHAR/ result property=phone column=phone jdbcType=VARCHAR/ result property=province column=province jdbcType=VARCHAR/ result property=city column=city jdbcType=VARCHAR/ result property=region column=region jdbcType=VARCHAR/ result property=detailAddress column=detail_address jdbcType=VARCHAR/ result property=createTime column=create_time jdbcType=TIMESTAMP/ result property=updateTime column=update_time jdbcType=TIMESTAMP/ /resultMap sql id=Base_Column_List id,user_id,default_status, receive_name,phone,province, city,region,detail_address, create_time,update_time /sql/mapper 7.11.2 æ ¹æ® id æŸ¥è¯¢æ”¶è´§åœ°å€è¯¦æƒ… cshop-usersrcmainJavagithublianyutiancshopusermodelvoUserAddressVO.Java package github.lianyutian.cshop.user.model.vo;import lombok.Data;/** * ç”¨æˆ·åœ°å€ VO ç•Œé¢å±•ç¤º * * @author lianyutian * @since 2024-12-26 09:59:44 * @version 1.0 */@Datapublic class UserAddressVO private Long id; /** ç”¨æˆ· id */ private Long userId; /** æ˜¯å¦é»˜è®¤æ”¶è´§åœ°å€ï¼š0 å¦ 1 æ˜¯ */ private Integer defaultStatus; /** æ”¶å‘è´§äººå§“å */ private String receiveName; /** æ”¶è´§äººç”µè¯ */ private String phone; /** çœ/ç›´è¾–å¸‚ */ private String province; /** å¸‚ */ private String city; /** åŒº */ private String region; /** è¯¦ç»†åœ°å€ */ private String detailAddress; cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserAddressController.Java /** * æ ¹æ® id æŸ¥è¯¢æ”¶è´§åœ°å€è¯¦æƒ… * * @param addressId æ”¶è´§åœ°å€ id * @return æ”¶è·åœ°å€è¯¦æƒ… */@GetMapping(detail/addressId)public ApiResultUserAddressVO detail(@PathVariable(addressId) Long addressId) UserAddressVO userAddressVo = userAddressService.getUserAddressDetail(addressId); return userAddressVo == null ? ApiResult.result(BizCodeEnum.USER_ADDRESS_NOT_EXITS) : ApiResult.success(userAddressVo); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserAddressService.Java /** * æ ¹æ®ç”¨æˆ·åœ°å€ id è·å–ç”¨æˆ·åœ°å€è¯¦æƒ… * * @param addressId åœ°å€ ID * @return ç”¨æˆ·åœ°å€è¯¦æƒ… */UserAddressVO getUserAddressDetail(Long addressId); cshop-usersrcmainJavagithublianyutiancshopuserserviceimplUserAddressServiceImpl.Java @Overridepublic UserAddressVO getUserAddressDetail(Long addressId) if (addressId == null || addressId = 0) throw new IllegalArgumentException(Invalid addressId); UserAddress userAddress = userAddressMapper.selectById(addressId); if (userAddress == null) return null; return BeanUtil.copy(userAddress, UserAddressVO.class); 7.11.3 è·å–ç”¨æˆ·åœ°å€åˆ—è¡¨ cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserAddressController.Java /** * è·å–ç”¨æˆ·åœ°å€åˆ—è¡¨ * * @return ç”¨æˆ·åœ°å€åˆ—è¡¨ */@GetMapping(list)public ApiResultListUserAddressVO list() ListUserAddressVO allUserAddressList = userAddressService.getAllUserAddressList(); return ApiResult.success(allUserAddressList); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserAddressService.Java /** * è·å–ç”¨æˆ·åœ°å€åˆ—è¡¨ * * @return ç”¨æˆ·åœ°å€åˆ—è¡¨ */ListUserAddressVO getAllUserAddressList(); cshop-usersrcmainJavagithublianyutiancshopuserserviceimplUserAddressServiceImpl.Java @Overridepublic ListUserAddressVO getAllUserAddressList() LoginUserInfo loginUserInfo = getLoginUserInfo(); ListUserAddress userAddressList = userAddressMapper.selectList( new LambdaQueryWrapperUserAddress() .eq(UserAddress::getUserId, loginUserInfo.getId())); return userAddressList.stream().map(this::convertToUserAddressVO).collect(Collectors.toList());private UserAddressVO convertToUserAddressVO(UserAddress userAddress) return BeanUtil.copy(userAddress, UserAddressVO.class); 7.11.4 ä¿®æ”¹æŒ‡å®šæ”¶è´§åœ°å€ cshop-usersrcmainJavagithublianyutiancshopusermodelparamAddressEditParam.Java package github.lianyutian.cshop.user.model.param;import lombok.Data;/** * ä¿®æ”¹æŒ‡å®šæ”¶è´§åœ°å€å…¥å‚ * * @author lianyutian * @since 2024-12-26 11:02:20 * @version 1.0 */@Datapublic class AddressEditParam /** åœ°å€ id */ private Long id; /** æ˜¯å¦é»˜è®¤æ”¶è´§åœ°å€ï¼š0 å¦ 1 æ˜¯ */ private Integer defaultStatus; /** æ”¶å‘è´§äººå§“å */ private String receiveName; /** æ”¶è´§äººç”µè¯ */ private String phone; /** çœ/ç›´è¾–å¸‚ */ private String province; /** å¸‚ */ private String city; /** åŒº */ private String region; /** è¯¦ç»†åœ°å€ */ private String detailAddress; cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserAddressController.Java /** * ä¿®æ”¹æŒ‡å®šæ”¶è´§åœ°å€ * * @param addressEditParam æ”¶è´§åœ°å€ * @return ä¿®æ”¹ç»“æœ */@PostMapping(edit)public ApiResultVoid edit(@RequestBody AddressEditParam addressEditParam) boolean updated = userAddressService.updateUserAddress(addressEditParam); return updated ? ApiResult.success() : ApiResult.result(BizCodeEnum.USER_ADDRESS_NOT_EXITS); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserAddressService.Java /** * ä¿®æ”¹ç”¨æˆ·åœ°å€ * * @param addressEditParam ä¿®æ”¹ç”¨æˆ·åœ°å€å‚æ•° */boolean updateUserAddress(AddressEditParam addressEditParam); cshop-usersrcmainJavagithublianyutiancshopuserserviceimplUserAddressServiceImpl.Java @Override@Transactional(rollbackFor = Exception.class)public boolean updateUserAddress(AddressEditParam addressEditParam) UserAddress oldUserAddress = userAddressMapper.selectById(addressEditParam.getId()); if (oldUserAddress == null) return false; LoginUserInfo loginUserInfo = getLoginUserInfo(); UserAddress userAddress = BeanUtil.copy(addressEditParam, UserAddress.class); userAddress.setUserId(loginUserInfo.getId()); setDefaultStatusIfRequired(userAddress); int affectedRows = userAddressMapper.update( userAddress, new LambdaUpdateWrapperUserAddress() .eq(UserAddress::getId, addressEditParam.getId())); if (affectedRows == 0) log.warn(ç”¨æˆ·æ”¶è´§åœ°å€æ¨¡å—-æ›´æ–°æ”¶è´§åœ°å€å¤±è´¥ï¼šid=, addressEditParam.getId()); return false; log.info( ç”¨æˆ·æ”¶è´§åœ°å€æ¨¡å—-æ›´æ–°æ”¶è´§åœ°å€ï¼šaffectedRows=ï¼Œdata=, affectedRows, formatUserAddressForLog(userAddress)); return true; 7.11.5 åˆ é™¤ç”¨æˆ·åœ°å€ cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserAddressController.Java /** * åˆ é™¤æŒ‡å®šæ”¶è´§åœ°å€ * * @param addressId æ”¶è´§åœ°å€ id * @return åˆ é™¤ç»“æœ */@GetMapping(delete/addressId)public ApiResultVoid delete(@PathVariable(addressId) Long addressId) return userAddressService.deleteUserAddress(addressId) == 1 ? ApiResult.success() : ApiResult.result(BizCodeEnum.USER_ADDRESS_NOT_EXITS); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserAddressService.Java /** * åˆ é™¤ç”¨æˆ·åœ°å€ * * @param addressId åœ°å€ ID * @return åˆ é™¤ç»“æœ */int deleteUserAddress(Long addressId); cshop-usersrcmainJavagithublianyutiancshopuserserviceimplUserAddressServiceImpl.Java @Override@Transactional(rollbackFor = Exception.class)public int deleteUserAddress(Long addressId) return userAddressMapper.deleteById(addressId); 7.12 ç”¨æˆ·è¯¦æƒ…å¼•å…¥ Redisç”¨æˆ·ç‚¹å‡»è‡ªèº«è¯¦æƒ…æ—¶ä¼šæ˜¾ç¤º ç”¨æˆ·åã€å¤´åƒã€æ€§åˆ«ã€æ‰‹æœºå· ç­‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å¾ˆå°‘å˜åŠ¨ï¼Œå¯ä»¥è€ƒè™‘å†™å…¥ç¼“å­˜ä¸­ã€‚ cshop-usersrcmainJavagithublianyutiancshopuserconstantUserCacheKeyConstant.Java package github.lianyutian.cshop.user.constant;/** * ç¼“å­˜å¸¸é‡ * * @author lianyutian * @since 2024-12-24 13:46:37 * @version 1.0 */public class UserCacheKeyConstant /** å›¾å½¢éªŒè¯ç ç¼“å­˜ key å‰ç¼€ */ public static final String CAPTCHA_IMG_KEY_PREFIX = cshop-user:img-captcha:; /** æ³¨å†ŒéªŒè¯ç ç¼“å­˜ key å‰ç¼€ */ public static final String CAPTCHA_REGISTER_KEY_PREFIX = cshop-user:register-captcha:; /** ç”¨æˆ·ä¿¡æ¯æ›´æ–°é”å‰ç¼€ */ public static final String USER_UPDATE_LOCK_KEY_PREFIX = cshop-user:update:lock:; /** ç”¨æˆ·ä¿¡æ¯ç¼“å­˜å‰ç¼€ */ public static final String USER_DETAIL_KEY_PREFIX = cshop-user:detail:; /** ç”¨æˆ·å±•ç¤ºä¿¡æ¯ç¼“å­˜å‰ç¼€ */ public static final String USER_SHOW_KEY_PREFIX = cshop-user:show:; cshop-usersrcmainJavagithublianyutiancshopuserserviceimplUserServiceImpl.Java private final RedisCache redisCache;@Overridepublic UserDetailVO getUserDetail() // é€šè¿‡ç™»å½•æ‹¦æˆªå™¨ä¸­ ThreadLocal è¿›è¡Œäº†ç”¨æˆ·ä¿¡æ¯ä¼ é€’ LoginUserInfo loginUserInfo = LoginInterceptor.USER_THREAD_LOCAL.get(); UserDetailVO userDetailVO = getUserDetailFromCache(loginUserInfo.getId()); if (userDetailVO != null) return userDetailVO; // ä¸å­˜åœ¨æ‰å»æŸ¥åº“ User user = userMapper.selectOne(new LambdaQueryWrapperUser().eq(User::getId, loginUserInfo.getId())); userDetailVO = BeanUtil.copy(user, UserDetailVO.class); redisCache.set( UserCacheKeyConstant.USER_DETAIL_KEY_PREFIX + loginUserInfo.getId(), userDetailVO, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); log.info(ç”¨æˆ·æ¨¡å—-ç¼“å­˜ç”¨æˆ·ä¿¡æ¯ï¼š, JsonUtil.toJson(user)); return userDetailVO;private UserDetailVO getUserDetailFromCache(long userId) String key = UserCacheKeyConstant.USER_DETAIL_KEY_PREFIX + userId; String userDetail = redisCache.get(key); log.info(ç”¨æˆ·æ¨¡å—-ä»ç¼“å­˜ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼š, userDetail); if (StringUtils.isNotBlank(userDetail)) // ç¼“å­˜å»¶æœŸ redisCache.expire(key, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); return JsonUtil.fromJson(userDetail, UserDetailVO.class); return null; 7.13 ç”¨æˆ·ä¿¡æ¯å±•ç¤º ç‚¹å‡»è¿›å…¥ç”¨æˆ·ä¸»é¡µå¯ä»¥æ˜¾ç¤ºç”¨æˆ· ç”¨æˆ·åã€idã€æ€§åˆ« ç­‰ä¸»è¦ä¿¡æ¯ 7.13.1 V1 ç‰ˆæœ¬ cshop-usersrcmainJavagithublianyutiancshopusermodelvoUserShowVO.Java package github.lianyutian.cshop.user.model.vo;import lombok.Data;/** * ç”¨æˆ·å±•ç¤ºä¿¡æ¯ VO å±•ç¤ºç»™ä»–äººçœ‹çš„ä¿¡æ¯ * * @author lianyutian * @since 2024-12-27 17:11:22 * @version 1.0 */@Datapublic class UserShowVO /** ç”¨æˆ· id */ private Long id; /** ç”¨æˆ·å */ private String name; /** ç”¨æˆ·å¤´åƒ */ private String avatar; cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserController.Java /** * è·å–ç”¨æˆ·å±•ç¤ºä¿¡æ¯ * * @param userId ç”¨æˆ· ID * @return ç”¨æˆ·å±•ç¤ºä¿¡æ¯ */@GetMapping(detail/show/userId)public ApiResultUserShowVO getUserShow(@PathVariable(userId) Long userId) UserShowVO userShowVO = userService.getUserShow(userId); return ApiResult.success(userShowVO); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserService.Java /** * è·å–ç”¨æˆ·å±•ç¤ºè¯¦æƒ… * * @param userId ç”¨æˆ· id * @return ç”¨æˆ·å±•ç¤ºè¯¦æƒ… */UserShowDetailVO getUserShow(Long userId); cshop-usersrcmainJavagithublianyutiancshopuserserviceimplUserServiceImpl.Java public UserShowVO getUserShow_V1(Long userId) User user = userMapper.selectOne(new LambdaQueryWrapperUser().eq(User::getId, userId)); UserShowVO userShowVO = new UserShowVO(); return BeanUtil.copy(user, userShowVO); ä¼˜ç‚¹ æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯éƒ½ç›´æ¥æŸ¥æ•°æ®åº“ï¼Œæ²¡æœ‰æ•°æ®ä¸€è‡´æ€§é—®é¢˜ ç¼ºç‚¹ æ‰€æœ‰è¯·æ±‚éƒ½æŸ¥åº“ï¼Œæ€§èƒ½ä¸é«˜ å¦‚æœå¹¶å‘é‡å¤§å¯èƒ½ç›´æ¥æ‰“å´©æ•°æ®åº“ 7.12.2 V2 ç‰ˆæœ¬å› ä¸ºç”¨æˆ·ä¿¡æ¯å±•ç¤ºæ˜¯ä¸ªè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œç”¨æˆ·ä¿¡æ¯è‡ªèº«å¾ˆå°‘å˜æ›´ä½†æ˜¯ç”¨æˆ·å±•ç¤ºä¿¡æ¯ä¼šæœ‰è¾ƒå¤šçš„æŸ¥è¯¢å±•ç¤ºã€‚éå¸¸é€‚åˆç¼“å­˜ï¼Œæ‰€ä»¥è¿™é‡Œå¼•å…¥ Redis ç¼“å­˜ç”¨æˆ·çš„å±•ç¤ºä¿¡æ¯ã€‚ cshop-usersrcmainJavagithublianyutiancshopuserserviceimplUserServiceImpl.Java public UserShowVO getUserShow_V2(Long userId) UserShowVO userShowVO = getUserShowFromCache(userId); if (userShowVO != null) UserShowVO userShowVO = new UserShowVO(); return BeanUtil.copy(userShowVO, UserShowVO.class); User user = userMapper.selectOne(new LambdaQueryWrapperUser().eq(User::getId, userId)); UserShowVO userShowVO = new UserShowVO(); return BeanUtil.copy(userShowVO, UserShowVO.class);private UserShowVO getUserShowFromCache(long userId) String key = UserCacheKeyConstant.USER_SHOW_KEY_PREFIX + userId; String userShow = redisCache.get(key); log.info(ç”¨æˆ·æ¨¡å—-ä»ç¼“å­˜ä¸­è·å–ç”¨æˆ·å±•ç¤ºä¿¡æ¯ï¼š, userShow); if (StringUtils.isNotBlank(userShow)) // ç¼“å­˜å»¶æœŸ redisCache.expire(key, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); return JsonUtil.fromJson(userShow, UserShowVO.class); return null; ä¼˜ç‚¹ ç¼“å­˜å­˜åœ¨æ—¶æ‰€æœ‰æŸ¥è¯¢èµ°ç¼“å­˜ï¼Œæ€§èƒ½é«˜ ç¼ºç‚¹ ç¼“å­˜ä¸å­˜åœ¨æ—¶ï¼Œå¦‚æœæœ‰è¶…é«˜å¹¶å‘è¿›å…¥è¿˜æ˜¯ä¼šç›´æ¥æ‰“è¿›æ•°æ®åº“ å½“æŸ¥è¯¢ä¸å­˜åœ¨çš„ userId æ—¶ä¼šç›´æ¥ç©¿é€ç¼“å­˜æ‰“åˆ°æ•°æ®åº“ï¼ŒåŒæ—¶é«˜å¹¶å‘æŸ¥è¯¢ä¸å­˜åœ¨çš„ userId ä¹Ÿå¯èƒ½æ‰“å´©æ•°æ®åº“ 7.12.3 V3 ç‰ˆæœ¬public UserShowVO getUserShow_V3(Long userId) UserShowVO userShowVO = getUserShowFromCache(userId); if (userShowVO != null) return BeanUtil.copy(userShowVO, UserShowVO.class); boolean tryLocked = false; try // è§£å†³é«˜å¹¶å‘æŸ¥åº“çš„é—®é¢˜ tryLocked = redisLock.tryLock(cshop-user:user-show:lock: + userId, 200); if (!tryLocked) return null; User user = userMapper.selectOne(new LambdaQueryWrapperUser().eq(User::getId, userId)); if (user == null) // è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜ redisCache.set( UserCacheKeyConstant.USER_SHOW_KEY_PREFIX + userId, , RedisCache.generateCachePenetrationExpire(), TimeUnit.MILLISECONDS); return null; return BeanUtil.copy(user, UserShowVO.class); catch (InterruptedException e) log.info(ã€getUserShowã€‘è·å–é”å¤±è´¥, userId , userId); return null; finally if (tryLocked) redisLock.unlock(cshop-user:info:lock: + userId); ä¼˜ç‚¹ è§£å†³é«˜å¹¶å‘ä¸‹æŸ¥æ•°æ®åº“é—®é¢˜ è§£å†³é«˜å¹¶å‘ä¸‹æŸ¥ä¸å­˜åœ¨ userId é—®é¢˜ ç¼ºç‚¹ ç”¨æˆ·åŒæ—¶æ›´æ–°ä¿¡æ¯æ—¶å­˜åœ¨ç¼“å­˜å’Œæ•°æ®åº“ä¸ä¸€è‡´é—®é¢˜ 7.12.4 V4 ç‰ˆæœ¬** * ç”¨æˆ·å±•ç¤ºä¿¡æ¯ * * p1.å‡å¦‚ ç”¨æˆ·Z å‘å¸ƒäº†ä¸€ç¯‡å†…å®¹çªç„¶çˆ†ç«ï¼ŒåŒä¸€æ—¶åˆ»æœ‰ä¸Šä¸‡ç”¨æˆ·æ¥æŸ¥çœ‹ ç”¨æˆ·Z çš„ä¸ªäººä¿¡æ¯ï¼Œæ­¤æ—¶å°±ä¼šå­˜åœ¨åŒä¸€æ—¶åˆ»ä¼šæœ‰è¶…å¤§å¹¶å‘æµé‡è¿›å…¥è¯¥æ¥å£ * * p2.å¦‚æœæœ‰æ¶æ„ç”¨æˆ·å¤§æ‰¹é‡ä½¿ç”¨ä¸å­˜åœ¨çš„ ç”¨æˆ·id æ¥æŸ¥è¯¢ï¼Œå°±ä¼šé€ æˆç¼“å­˜ç©¿é€ï¼Œå¤§é‡è¯·æ±‚å‡»ç©¿çš„ DB å±‚ã€‚ * * p3.å¦‚æœ ç”¨æˆ·Z åœ¨è¿™ä¸ªæ—¶åˆ»ä¿®æ”¹äº†è‡ªå·±çš„ä¿¡æ¯ï¼Œæ€ä¹ˆä¿è¯å…¶ä»–ç”¨æˆ·æŸ¥è¯¢åˆ°çš„æ˜¯æœ€æ–°çš„ä¿¡æ¯ï¼Œæ€ä¹ˆä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§ * * påœºæ™¯ï¼šä¾‹å¦‚ çº¿ç¨‹A æ¥æŸ¥è¯¢ ç”¨æˆ·Z çš„ä¿¡æ¯ï¼ŒåŒæ—¶ çº¿ç¨‹B ä¿®æ”¹ ç”¨æˆ·Z ä¿¡æ¯ä¸”æ­¤æ—¶ç¼“å­˜ä¸­ ç”¨æˆ·Z ä¿¡æ¯åˆšå¥½è¿‡æœŸã€‚ * * pé‚£ä¹ˆæ­¤æ—¶ çº¿ç¨‹A ä¼šå»æŸ¥æ•°æ®åº“ï¼Œè¿™ä¸ªæ—¶å€™ çº¿ç¨‹B è¿˜æ²¡å°† ç”¨æˆ·Z ä¿®æ”¹åçš„ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚ * * pæ‰€ä»¥ çº¿ç¨‹A æ‹¿åˆ°çš„æ˜¯æ—§çš„æ•°æ®ï¼Œå†å‡è®¾æ­¤æ—¶ çº¿ç¨‹A æ²¡æŠ¢åˆ° CPU èµ„æºé˜»å¡ä½äº†ã€‚ * * pè¿™ä¸ªæ—¶å€™ çº¿ç¨‹B å·²ç»ä¿®æ”¹å®Œè‡ªèº«ä¿¡æ¯å¹¶ä¿å­˜å…¥æ•°æ®åº“ï¼ŒåŒæ—¶ä¼šå°†æ–°æ•°æ®åˆ·æ–°åˆ°ç¼“å­˜ä¸­ã€‚ * * på†æ‰§è¡Œå®Œæˆè¿™ä¸€æ­¥åï¼Œçº¿ç¨‹A æ‰ç»§ç»­æ‰§è¡Œï¼Œæ­¤æ—¶ çº¿ç¨‹A æ‹¿åˆ°çš„è¿˜æ˜¯æ—§çš„æ•°æ®ï¼Œä¹Ÿä¼šå»åˆ·æ–°ç¼“å­˜ã€‚ * * pé‚£ä¹ˆæ­¤æ—¶ç¼“å­˜ä¸­çš„æ•°æ®æ˜¯ çº¿ç¨‹A åœ¨ çº¿ç¨‹B æ›´æ–°å‰çš„æ—§æ•°æ®ï¼Œæ•°æ®åº“ä¸­æ˜¯ çº¿ç¨‹B æ›´æ–°çš„æ–°æ•°æ®ã€‚ * * pè§£å†³æ–¹æ¡ˆï¼šæ›´æ–°ç”¨æˆ·æ¥å£ä¹ŸåŠ  åŒ ä¸€æŠŠåˆ†å¸ƒå¼é”ï¼Œä¿è¯è¯»å†™ä¸²è¡Œã€‚ç”¨æˆ·æ›´æ–°è‡ªèº«ä¿¡æ¯æ˜¯å æ¯”å¾ˆå°‘çš„å†™æ“ä½œï¼Œè¿™é‡Œè€ƒè™‘çš„æ˜¯æç«¯åœºæ™¯ * * @param userId ç”¨æˆ·id * @return ç”¨æˆ·å±•ç¤ºä¿¡æ¯ */@Overridepublic UserShowVO getUserShow(Long userId) UserShowVO userShowVO = getUserShowFromCache(userId); if (userShowVO != null) return userShowVO; // 2ã€ç¼“å­˜ä¸ºç©ºå†ä»æ•°æ®åº“ä¸­è·å– return getUserShowFromDB(userId);private UserDetailVO getUserDetailFromCache(long userId) String key = UserCacheKeyConstant.USER_DETAIL_KEY_PREFIX + userId; String userDetail = redisCache.get(key); log.info(ç”¨æˆ·æ¨¡å—-ä»ç¼“å­˜ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼š, userDetail); if (StringUtils.isNotBlank(userDetail)) // ç¼“å­˜å»¶æœŸ redisCache.expire(key, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); return JsonUtil.fromJson(userDetail, UserDetailVO.class); return null;private UserShowVO getUserShowFromCache(long userId) String key = UserCacheKeyConstant.USER_SHOW_KEY_PREFIX + userId; String userShow = redisCache.get(key); log.info(ç”¨æˆ·æ¨¡å—-ä»ç¼“å­˜ä¸­è·å–ç”¨æˆ·å±•ç¤ºä¿¡æ¯ï¼š, userShow); if (StringUtils.isNotBlank(userShow)) // ç¼“å­˜å»¶æœŸ redisCache.expire(key, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); return JsonUtil.fromJson(userShow, UserShowVO.class); return null;private UserShowVO getUserShowFromDB(Long userId) String userUpdateLockKey = UserCacheKeyConstant.USER_UPDATE_LOCK_KEY_PREFIX + userId; // è®¾ç½®åˆ†å¸ƒå¼é” boolean tryLocked = false; try // TODO è§£é‡Š tryLocked = redisLock.tryLock(userUpdateLockKey, RedisCache.UPDATE_LOCK_TIMEOUT); if (!tryLocked) // åŠ é”è¶…æ—¶ /* å°è¯•åŠ é”æ—¶é—´æœ‰ RedisCache.UPDATE_LOCK_TIMEOUT æœ‰å¯èƒ½å…¶ä»–çº¿ç¨‹å·²ç»è·å–æ•°æ®å¹¶å†™å…¥ç¼“å­˜äº†æ‰€ä»¥è¿™é‡Œå†å°è¯•å»è¯»ä¸‹ç¼“å­˜ */ UserShowVO userShowFromCache = getUserShowFromCache(userId); if (userShowFromCache != null) return userShowFromCache; log.warn(ã€getUserShowFromDBã€‘ç”¨æˆ·ç¼“å­˜ä¸ºç©ºï¼ŒæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯è·å–é”å¤±è´¥ , userId); return null; User user = userMapper.selectById(userId); if (user == null) // å¦‚æœä¸ºç©ºå…ˆåœ¨ç¼“å­˜ä¸­è®¾ç½®ä¸€ä¸ªç©ºå€¼ï¼Œé˜²æ­¢ç¼“å­˜ç©¿é€ï¼ˆè§£å†³ 2ï¼‰ redisCache.set( UserCacheKeyConstant.USER_SHOW_KEY_PREFIX + userId, RedisCache.EMPTY_CACHE, RedisCache.generateCachePenetrationExpire(), TimeUnit.MILLISECONDS); return null; UserShowVO userShowVO = BeanUtil.copy(user, UserShowVO.class); log.info(ã€getUserShowFromDBã€‘ç”¨æˆ·ç¼“å­˜ä¸ºç©ºï¼Œä»æ•°æ®åº“è·å–ç”¨æˆ·ä¿¡æ¯ , JsonUtil.toJson(userShowVO)); redisCache.set( UserCacheKeyConstant.USER_SHOW_KEY_PREFIX + userId, userShowVO, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); return userShowVO; catch (InterruptedException e) // åŠ é”å¤±è´¥ // è¿™é‡Œå†å»å°è¯•è·å–ä¸‹ç¼“å­˜-åŒé‡æ£€æŸ¥ UserShowVO userShowFromCache = getUserShowFromCache(userId); if (userShowFromCache != null) return userShowFromCache; log.error(ã€getUserShowFromDBã€‘å°è¯•åŠ é”å¼‚å¸¸ï¼Œå¼‚å¸¸ä¿¡æ¯ï¼š, e.getMessage(), e); throw new BizException(BizCodeEnum.USER_INFO_SHOW_LOCK_FAIL); finally if (tryLocked) redisLock.unlock(userUpdateLockKey); 7.13 ç”¨æˆ·ä¿¡æ¯æ›´æ–° cshop-usersrcmainJavagithublianyutiancshopusermodelparamUserEditParam.Java package github.lianyutian.cshop.user.model.param;import lombok.Data;/** * ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹å…¥å‚ * * @author lianyutian * @since 2024-12-27 13:23:04 * @version 1.0 */@Datapublic class UserEditParam /** ç”¨æˆ· id */ private Long id; /** æ‰‹æœºå· */ private String phone; /** ç”¨æˆ·å */ private String name; /** å¤´åƒ */ private String avatar; /** æ€§åˆ« */ private int sex; cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserController.Java /** * ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹ * * @param userEditParam ç”¨æˆ·ä¿¡æ¯ * @return ä¿®æ”¹ç»“æœ */@PostMapping(edit)public ApiResultVoid edit(@RequestBody UserEditParam userEditParam) userService.updateUser(userEditParam); return ApiResult.success(); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserService.Java /** * æ›´æ–°ç”¨æˆ·ä¿¡æ¯ * * @param userEditParam ç”¨æˆ·ç¼–è¾‘å‚æ•° */void updateUserInfo(UserEditParam userEditParam); cshop-usersrcmainJavagithublianyutiancshopuserserviceimplUserServiceImpl.Java @Override@Transactional(rollbackFor = Exception.class)public void updateUser(UserEditParam userEditParam) LoginUserInfo loginUserInfo = LoginInterceptor.USER_THREAD_LOCAL.get(); userEditParam.setId(loginUserInfo.getId()); boolean locked = false; try // è¿™é‡ŒåŠ åˆ†å¸ƒå¼é”æ˜¯ä¸ºäº†ä¿è¯é«˜å¹¶å‘ä¸‹æœ‰å…¶ä»–ç”¨æˆ·æŸ¥è¯¢è¯¥ç”¨æˆ·ä¿¡æ¯æ—¶ä¿è¯æ•°æ®åº“å’Œç¼“å­˜çš„ä¸€è‡´æ€§ locked = redisLock.lock(UserCacheKeyConstant.USER_UPDATE_LOCK_KEY_PREFIX + loginUserInfo.getId()); if (!locked) log.error(ç”¨æˆ·æ¨¡å—-ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼šç”¨æˆ· è·å–é”å¤±è´¥, loginUserInfo.getId()); throw new BizException(BizCodeEnum.USER_DETAIL_UPDATE_FAIL); // å…ˆåˆ æ‰ç¼“å­˜ï¼Œé˜²æ­¢å‡ºç°æ•°æ®åº“æ›´æ–°æˆåŠŸä½†æ˜¯æ›´æ–°ç¼“å­˜å¤±è´¥ï¼Œè·å–ç”¨æˆ·ä¿¡æ¯æ—¶ä¸€ç›´éƒ½æ˜¯ç¼“å­˜çš„æ•°æ® redisCache.delete(UserCacheKeyConstant.USER_SHOW_KEY_PREFIX + loginUserInfo.getId()); redisCache.delete(UserCacheKeyConstant.USER_DETAIL_KEY_PREFIX + loginUserInfo.getId()); User user = BeanUtil.copy(userEditParam, User.class); int rows = userMapper.update( user, new LambdaUpdateWrapperUser().eq(User::getId, loginUserInfo.getId())); log.info(ç”¨æˆ·æ¨¡å—-ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼šrows=ï¼Œdata=, rows, userEditParam); User newUser = userMapper.selectOne( new LambdaQueryWrapperUser().eq(User::getId, loginUserInfo.getId())); UserShowVO userShowVO = BeanUtil.copy(newUser, UserShowVO.class); // è¿™é‡Œå­˜åœ¨æ•°æ®åº“æ›´æ–°åï¼Œç¼“å­˜æ›´æ–°å¤±è´¥çš„åœºæ™¯ï¼ˆè¿™é‡Œä¸å»å¼ºåˆ¶ä¿è¯æ•°æ®åº“æ›´æ–°å®Œæˆåä¸€å®šæ›´æ–°æˆåŠŸç¼“å­˜ï¼‰ redisCache.set( UserCacheKeyConstant.USER_SHOW_KEY_PREFIX + loginUserInfo.getId(), userShowVO, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); UserDetailVO userDetailVO = BeanUtil.copy(newUser, UserDetailVO.class); redisCache.set( UserCacheKeyConstant.USER_DETAIL_KEY_PREFIX + loginUserInfo.getId(), userDetailVO, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); finally if (locked) redisLock.unlock(UserCacheKeyConstant.USER_UPDATE_LOCK_KEY_PREFIX + loginUserInfo.getId()); 7.14 ç¬”è®°æœåŠ¡https://nginx.org/en/download.html 7.14.1 æ–°å»ºç¬”è®°æœåŠ¡ cshop-commonpom.xml !-- mybatis-plus åˆ†é¡µæ’ä»¶ --dependency groupIdcom.baomidou/groupId artifactIdmybatis-plus-jsqlparser/artifactId/dependency cshop-notepom.xml ?xml version=1.0 encoding=UTF-8?project xmlns=http://maven.apache.org/POM/4.0.0 xmlns:xsi=http://www.w3.org/2001/XMLSchema-instance xsi:schemaLocation=http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd modelVersion4.0.0/modelVersion parent groupIdgithub.lianyutian.cshop/groupId artifactIdcircle-shop/artifactId version1.0-SNAPSHOT/version /parent groupIdgithub.lianyutian.cshop.note/groupId artifactIdcshop-note/artifactId descriptionç¬”è®°æœåŠ¡/description properties maven.compiler.source17/maven.compiler.source maven.compiler.target17/maven.compiler.target project.build.sourceEncodingUTF-8/project.build.sourceEncoding /properties dependencies dependency groupIdgithub.lianyutian.cshop.common/groupId artifactIdcshop-common/artifactId version1.0-SNAPSHOT/version /dependency dependency groupIdorg.springframework.boot/groupId artifactIdspring-boot-starter-web/artifactId /dependency dependency groupIdmysql/groupId artifactIdmysql-connector-java/artifactId /dependency dependency groupIdcom.baomidou/groupId artifactIdmybatis-plus-spring-boot3-starter/artifactId /dependency dependency groupIdorg.apache.rocketmq/groupId artifactIdrocketmq-client/artifactId /dependency /dependencies/project cshop-notesrcmainresourcesapplication.yml # æœåŠ¡ç«¯å£server: port: 9003spring: application: name: cshop-note # mysqlé…ç½® datasource: username: root password: MIIEowIBAAKCAQEAwG90ULRHmAXFXQzZSwleoYts2+bCzUvqhhqtGiv/F5kUsETY url: jdbc:mysql://116.198.217.158:3306/cshop-user?useUnicode=truecharacterEncoding=utf-8useSSL=falseserverTimezone=Asia/Shanghai driver-class-name: com.mysql.cj.jdbc.Driver # redisé…ç½® data: redis: host: 116.198.217.158 port: 6379 password: MIIEowIBAAKCAQEAwG90ULRHmAXFXQzZSwleoYts2+bCzUvqhhqtGiv/F5kUsETY # å¦‚æœæœ‰å¯†ç  database: 0 # é»˜è®¤æ•°æ®åº“ timeout: 60000 # è¯»å– redis è¶…æ—¶æ—¶é—´ lettuce: pool: max-active: 100 # æœ€å¤§è¿æ¥æ•° max-idle: 100 # æœ€å¤§ç©ºé—²è¿æ¥æ•° min-idle: 100 # æœ€å°ç©ºé—²è¿æ¥æ•° max-wait: 60000 # æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’# è®¾ç½®æ—¥å¿—çº§åˆ«ï¼šERROR/WARN/INFO/DEBUG,é»˜è®¤æ˜¯ INFO ä»¥ä¸Šæ‰æ˜¾ç¤ºlogging: level: root: INFO# é…ç½® mybatis plus æ‰“å° sql æ—¥å¿—mybatis-plus: configuration: log-impl: org.apache.ibatis.logging.stdout.StdOutImpl# rocketmqé…ç½®rocketmq: accessKey: mqadmin secretKey: MIIEowIBAAKCAQEAwG90ULRHmAXFXQzZSwleoYts2+bCzUvqhhqtGiv/F5kUsETY nameServer: 116.198.217.158:9876 cshop-notesrcmainJavagithublianyutiancshopnoteNoteApplication.Java package github.lianyutian.cshop.note;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.context.annotation.ComponentScan;/** * ç¬”è®°æœåŠ¡å¯åŠ¨ç±» * * @author lianyutian * @since 2025-01-02 14:55:33 * @version 1.0 */@SpringBootApplication@ComponentScan(basePackages = github.lianyutian.cshop.note, github.lianyutian.cshop.common)public class NoteApplication public static void main(String[] args) SpringApplication.run(NoteApplication.class, args); 7.14.2 æ–°å¢ç¬”è®° cshop-notesrcmainJavagithublianyutiancshopnotemodelparamNoteAddParam.Java package github.lianyutian.cshop.note.model.param;import com.fasterxml.jackson.annotation.JsonFormat;import java.util.Date;import lombok.Data;/** * æ·»åŠ ç¬”è®°å…¥å‚ * * @author lianyutian * @since 2025-01-02 17:16:18 * @version 1.0 */@Datapublic class NoteAddParam /** ç¬”è®°å›¾ç‰‡é“¾æ¥ */ private String imgUrls; /** ç¬”è®°æ ‡é¢˜ */ private String title; /** æ­£æ–‡å†…å®¹ */ private String content; /** ç¬”è®°è§†é¢‘é“¾æ¥ */ private String videoUrl; /** è‡ªä¸»å£°æ˜ */ private String declaration; /** 1 å…¬å¼€å¯è§ï¼Œ2 ä»…è‡ªå·±å¯è§ï¼Œ3 ä»…äº’å…³å¥½å‹å¯è§ï¼Œ4 éƒ¨åˆ†äººå¯è§ 5 éƒ¨åˆ†äººä¸å¯è§ */ private Integer visibleRange; /** å‘å¸ƒæ—¶é—´ */ @JsonFormat(pattern = yyyy-MM-dd HH:mm:ss, timezone = GMT+8) private Date publishTime; cshop-notesrcmainJavagithublianyutiancshopnotecontrollerNoteController.Java package github.lianyutian.cshop.note.controller;import github.lianyutian.cshop.common.enums.BizCodeEnum;import github.lianyutian.cshop.common.model.ApiResult;import github.lianyutian.cshop.note.model.param.NoteAddParam;import github.lianyutian.cshop.note.model.param.NoteEditParam;import github.lianyutian.cshop.note.model.vo.NoteDetailVO;import github.lianyutian.cshop.note.service.NoteService;import lombok.AllArgsConstructor;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.PathVariable;import org.springframework.web.bind.annotation.PostMapping;import org.springframework.web.bind.annotation.RequestBody;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;/** * NoteController * * @author lianyutian * @since 2025-01-02 17:14:17 * @version 1.0 */@RestController@RequestMapping(/api/note/v1)@AllArgsConstructorpublic class NoteController private final NoteService noteService; /** * æ·»åŠ ç¬”è®° * * @param noteAddParam ç¬”è®°å…¥å‚ * @return æ·»åŠ ç»“æœ */ @PostMapping(add) public ApiResultVoid addNote(@RequestBody NoteAddParam noteAddParam) int added = noteService.addNote(noteAddParam); return added 0 ? ApiResult.success() : ApiResult.result(BizCodeEnum.NOTE_ADD_FAIL); cshop-notesrcmainJavagithublianyutiancshopnoteserviceNoteService.Java package github.lianyutian.cshop.note.service;import github.lianyutian.cshop.note.model.param.NoteAddParam;import github.lianyutian.cshop.note.model.param.NoteEditParam;import github.lianyutian.cshop.note.model.vo.NoteDetailVO;/** * ç¬”è®°æœåŠ¡ * * @author lianyutian * @since 2025-01-03 10:53:40 * @version 1.0 */public interface NoteService /** * æ·»åŠ ç¬”è®° * * @param noteAddParam ç¬”è®°å…¥å‚ */ int addNote(NoteAddParam noteAddParam); cshop-notesrcmainJavagithublianyutiancshopnoteserviceimplNoteServiceImpl.Java package github.lianyutian.cshop.note.service.impl;import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;import com.baomidou.mybatisplus.core.conditions.update.LambdaUpdateWrapper;import github.lianyutian.cshop.common.enums.BizCodeEnum;import github.lianyutian.cshop.common.exception.BizException;import github.lianyutian.cshop.common.interceptor.LoginInterceptor;import github.lianyutian.cshop.common.model.LoginUserInfo;import github.lianyutian.cshop.common.redis.RedisCache;import github.lianyutian.cshop.common.redis.RedisLock;import github.lianyutian.cshop.common.utils.BeanUtil;import github.lianyutian.cshop.common.utils.JsonUtil;import github.lianyutian.cshop.note.constant.NoteCacheKeyConstant;import github.lianyutian.cshop.note.constant.NoteRocketMQConstant;import github.lianyutian.cshop.note.enums.NoteMessageType;import github.lianyutian.cshop.note.enums.NoteStatusEnum;import github.lianyutian.cshop.note.mapper.NoteMapper;import github.lianyutian.cshop.note.model.param.NoteAddParam;import github.lianyutian.cshop.note.model.param.NoteEditParam;import github.lianyutian.cshop.note.model.po.Note;import github.lianyutian.cshop.note.model.vo.NoteDetailVO;import github.lianyutian.cshop.note.model.vo.NoteShowVO;import github.lianyutian.cshop.note.mq.message.NoteAddMessage;import github.lianyutian.cshop.note.mq.message.NoteUpdateMessage;import github.lianyutian.cshop.note.mq.producer.NoteTransactionProducer;import github.lianyutian.cshop.note.service.NoteService;import java.util.Date;import java.util.concurrent.TimeUnit;import lombok.AllArgsConstructor;import lombok.extern.slf4j.Slf4j;import org.apache.commons.lang3.StringUtils;import org.springframework.stereotype.Service;import org.springframework.transaction.annotation.Transactional;/** * ç¬”è®°æœåŠ¡å®ç°ç±» * * @author lianyutian * @since 2025-01-03 10:54:31 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class NoteServiceImpl implements NoteService private final NoteMapper noteMapper; @Override @Transactional(rollbackFor = Exception.class) public int addNote(NoteAddParam noteAddParam) LoginUserInfo loginUserInfo = LoginInterceptor.USER_THREAD_LOCAL.get(); Note note = BeanUtil.copy(noteAddParam, Note.class); note.setUserId(loginUserInfo.getId()); note.setStatus(NoteStatusEnum.AUDITING); note.setPublishTime(new Date()); int row; try row = noteMapper.insert(note); catch (Exception e) log.error(db addNote error , e.getMessage(), e); throw new BizException(BizCodeEnum.NOTE_ADD_FAIL); log.info(ç¬”è®°æœåŠ¡-æ–°å¢ç¬”è®°ï¼šrows=ï¼Œdata=, row, JsonUtil.toJson(noteAddParam)); return row; 7.14.3 ä¿®æ”¹ç¬”è®° cshop-notesrcmainJavagithublianyutiancshopnotemodelparamNoteEditParam.Java package github.lianyutian.cshop.note.model.param;import com.fasterxml.jackson.annotation.JsonFormat;import java.util.Date;import lombok.Data;/** * ç¬”è®°ä¿®æ”¹å…¥å‚ * * @author lianyutian * @since 2025-01-03 11:07:53 * @version 1.0 */@Datapublic class NoteEditParam /** ç¬”è®° id */ private Long id; /** ç¬”è®°å›¾ç‰‡é“¾æ¥ */ private String imgUrls; /** ç¬”è®°æ ‡é¢˜ */ private String title; /** æ­£æ–‡å†…å®¹ */ private String content; /** ç¬”è®°è§†é¢‘é“¾æ¥ */ private String videoUrl; /** è‡ªä¸»å£°æ˜ */ private String declaration; /** 1 å…¬å¼€å¯è§ï¼Œ2 ä»…è‡ªå·±å¯è§ï¼Œ3 ä»…äº’å…³å¥½å‹å¯è§ï¼Œ4 éƒ¨åˆ†äººå¯è§ 5 éƒ¨åˆ†äººä¸å¯è§ */ private Integer visibleRange; /** å‘å¸ƒæ—¶é—´ */ @JsonFormat(pattern = yyyy-MM-dd HH:mm:ss, timezone = GMT+8) private Date publishTime; package github.lianyutian.cshop.note.controller;/** * NoteController * * @author lianyutian * @since 2025-01-02 17:14:17 * @version 1.0 */@RestController@RequestMapping(/api/note/v1)@AllArgsConstructorpublic class NoteController private final NoteService noteService; /** * æ›´æ–°æˆ‘çš„ç¬”è®° * * @param noteAddParam æ›´æ–°ç¬”è®°å…¥å‚ * @return æ›´æ–°ç»“æœ */ @PostMapping(edit) public ApiResultVoid updateNote(@RequestBody NoteEditParam noteAddParam) int updated = noteService.updateNote(noteAddParam); return updated 0 ? ApiResult.success() : ApiResult.result(BizCodeEnum.NOTE_UPDATE_FAIL); package github.lianyutian.cshop.note.service;/** * ç¬”è®°æœåŠ¡ * * @author lianyutian * @since 2025-01-03 10:53:40 * @version 1.0 */public interface NoteService /** * æ›´æ–°ç¬”è®° * * @param noteAddParam ç¬”è®°æ›´æ–°å…¥å‚ */ int updateNote(NoteEditParam noteAddParam); package github.lianyutian.cshop.note.service.impl;/** * ç¬”è®°æœåŠ¡å®ç°ç±» * * @author lianyutian * @since 2025-01-03 10:54:31 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class NoteServiceImpl implements NoteService private final NoteMapper noteMapper; @Override @Transactional(rollbackFor = Exception.class) public int updateNote(NoteEditParam noteEditParam) // 1.æŸ¥è¯¢ç¬”è®°æ˜¯å¦å­˜åœ¨ LoginUserInfo loginUserInfo = LoginInterceptor.USER_THREAD_LOCAL.get(); Note updateNote = BeanUtil.copy(noteEditParam, Note.class); int row = 0; try row = noteMapper.update( updateNote, new LambdaUpdateWrapperNote() .eq(Note::getId, noteEditParam.getId()) .eq(Note::getUserId, loginUserInfo.getId())); log.info(ç¬”è®°æœåŠ¡-æ›´æ–°ç¬”è®°ï¼šrow=, data=, row, JsonUtil.toJson(noteEditParam)); return row; catch (Exception e) log.error(updateNote error , e.getMessage(), e); throw new BizException(BizCodeEnum.NOTE_UPDATE_FAIL); 7.14.4 åˆ é™¤ç¬”è®°package github.lianyutian.cshop.note.controller;/** * NoteController * * @author lianyutian * @since 2025-01-02 17:14:17 * @version 1.0 */@RestController@RequestMapping(/api/note/v1)@AllArgsConstructorpublic class NoteController private final NoteService noteService; /** * åˆ é™¤æˆ‘çš„ç¬”è®° * * @param noteId noteId * @return åˆ é™¤ç»“æœ */ @GetMapping(delete/noteId) public ApiResultVoid delete(@PathVariable(noteId) long noteId) int deleted = noteService.deleteNote(noteId); return deleted 0 ? ApiResult.success() : ApiResult.result(BizCodeEnum.NOTE_DEL_FAIL); package github.lianyutian.cshop.note.service;/** * ç¬”è®°æœåŠ¡ * * @author lianyutian * @since 2025-01-03 10:53:40 * @version 1.0 */public interface NoteService /** * åˆ é™¤ç¬”è®° * * @param id ç¬”è®° id */ int deleteNote(long id); package github.lianyutian.cshop.note.service.impl;/** * ç¬”è®°æœåŠ¡å®ç°ç±» * * @author lianyutian * @since 2025-01-03 10:54:31 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class NoteServiceImpl implements NoteService private final NoteMapper noteMapper; @Override @Transactional(rollbackFor = Exception.class) public int deleteNote(long id) return noteMapper.deleteById(id); 7.14.5 è·å–æˆ‘çš„ç¬”è®°è¯¦æƒ… cshop-notesrcmainJavagithublianyutiancshopnotemodelvoNoteDetailVO.Java package github.lianyutian.cshop.note.model.vo;import java.util.Date;import lombok.Data;/** * ç¬”è®° VO * * @author lianyutian * @since 2025-01-03 11:06:30 * @version 1.0 */@Datapublic class NoteDetailVO /** ç¬”è®° id */ private long id; /** ç¬”è®°å›¾ç‰‡é“¾æ¥ */ private String imgUrls; /** ç¬”è®°æ ‡é¢˜ */ private String title; /** æ­£æ–‡å†…å®¹ */ private String content; /** ç¬”è®°è§†é¢‘é“¾æ¥ */ private String videoUrl; /** è‡ªä¸»å£°æ˜ */ private String declaration; /** 1 å…¬å¼€å¯è§ï¼Œ2 ä»…è‡ªå·±å¯è§ï¼Œ3 ä»…äº’å…³å¥½å‹å¯è§ï¼Œ4 éƒ¨åˆ†äººå¯è§ 5 éƒ¨åˆ†äººä¸å¯è§ */ private Integer visibleRange; /** å‘å¸ƒæ—¶é—´ */ private Date publishTime; package github.lianyutian.cshop.note.controller;import github.lianyutian.cshop.common.enums.BizCodeEnum;import github.lianyutian.cshop.common.model.ApiResult;import github.lianyutian.cshop.note.model.param.NoteAddParam;import github.lianyutian.cshop.note.model.param.NoteEditParam;import github.lianyutian.cshop.note.model.vo.NoteDetailVO;import github.lianyutian.cshop.note.service.NoteService;import lombok.AllArgsConstructor;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.PathVariable;import org.springframework.web.bind.annotation.PostMapping;import org.springframework.web.bind.annotation.RequestBody;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;/** * NoteController * * @author lianyutian * @since 2025-01-02 17:14:17 * @version 1.0 */@RestController@RequestMapping(/api/note/v1)@AllArgsConstructorpublic class NoteController private final NoteService noteService; /** * è·å–æˆ‘çš„ç¬”è®°è¯¦æƒ… * * @param noteId noteId * @return ç¬”è®°è¯¦æƒ…ä¿¡æ¯ */ @GetMapping(/detail/noteId) public ApiResultNoteDetailVO detail(@PathVariable(noteId) Long noteId) return ApiResult.success(noteService.getNoteDetail(noteId)); package github.lianyutian.cshop.note.service;/** * ç¬”è®°æœåŠ¡ * * @author lianyutian * @since 2025-01-03 10:53:40 * @version 1.0 */public interface NoteService /** * è·å–ç¬”è®°è¯¦æƒ… * * @param noteId ç¬”è®° id */ NoteDetailVO getNoteDetail(Long noteId); package github.lianyutian.cshop.note.service.impl;/** * ç¬”è®°æœåŠ¡å®ç°ç±» * * @author lianyutian * @since 2025-01-03 10:54:31 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class NoteServiceImpl implements NoteService private final NoteMapper noteMapper; @Override public NoteDetailVO getNoteDetail(Long noteId) LoginUserInfo loginUserInfo = LoginInterceptor.USER_THREAD_LOCAL.get(); Note note = noteMapper.selectOne( new LambdaQueryWrapperNote() .eq(Note::getId, noteId) .eq(Note::getUserId, loginUserInfo.getId())); if (note == null) return null; return BeanUtil.copy(note, NoteDetailVO.class); 7.14.6 æŸ¥çœ‹ä»–äººç¬”è®°è¯¦æƒ… cshop-notesrcmainJavagithublianyutiancshopnotemodelvoNoteShowVO.Java package github.lianyutian.cshop.note.model.vo;import java.util.Date;import lombok.Data;/** * ç¬”è®°å±•ç¤º VO * * @author lianyutian * @since 2025-01-03 11:06:30 * @version 1.0 */@Datapublic class NoteShowVO /** ç¬”è®° id */ private long id; /** ç¬”è®°å›¾ç‰‡é“¾æ¥ */ private String imgUrls; /** ç¬”è®°æ ‡é¢˜ */ private String title; /** æ­£æ–‡å†…å®¹ */ private String content; /** ç¬”è®°è§†é¢‘é“¾æ¥ */ private String videoUrl; /** è‡ªä¸»å£°æ˜ */ private String declaration; /** å‘å¸ƒæ—¶é—´ */ private Date publishTime; cshop-notesrcmainJavagithublianyutiancshopnotecontrollerNoteShowController.Java package github.lianyutian.cshop.note.controller;/** * ç”¨æˆ·ç¬”è®°å±•ç¤º * * @author lianyutian * @since 2025-01-09 10:12:54 * @version 1.0 */@RestController@RequestMapping(/api/note/v1)@AllArgsConstructorpublic class NoteShowController private final NoteShowService noteShowService; /** * è·å–ç¬”è®°è¯¦æƒ… * * @param noteId ç¬”è®° ID * @return ç¬”è®°è¯¦æƒ… */ @PostMapping(detail/show) public ApiResultNoteShowVO getNoteShow(@RequestBody Long noteId) if (noteId == null) return ApiResult.result(BizCodeEnum.COMMON_PARAM_ERROR); NoteShowVO noteShowVO = noteShowService.getNoteShow(noteId); return noteShowVO == null ? ApiResult.result(BizCodeEnum.NOTE_NOT_EXITS) : ApiResult.success(noteShowVO); cshop-notesrcmainJavagithublianyutiancshopnoteserviceNoteShowService.Java package github.lianyutian.cshop.note.service;/** * ç”¨æˆ·ç¬”è®°å±•ç¤º * * @author lianyutian * @since 2025-01-09 10:15:18 * @version 1.0 */public interface NoteShowService /** * è·å–ç¬”è®°å±•ç¤ºè¯¦æƒ… * * @param noteId ç¬”è®° ID * @return ç¬”è®°è¯¦æƒ… */ NoteShowVO getNoteShow(Long noteId); cshop-notesrcmainJavagithublianyutiancshopnoteserviceimplNoteShowServiceImpl.Java package github.lianyutian.cshop.note.service.impl;/** * ç”¨æˆ·ç¬”è®°å±•ç¤ºå®ç° * * @author lianyutian * @since 2025-01-09 10:18:39 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class NoteShowServiceImpl implements NoteShowService private final NoteMapper noteMapper; @Override public NoteShowVO getNoteShow(Long noteId) Note note = noteMapper.selectOne( new LambdaQueryWrapperNote() .eq(Note::getId, noteId) .eq(Note::getStatus, NoteStatusEnum.PUBLISHED.getCode())); if (note == null) log.info(ã€getNoteShowã€‘ç¬”è®°ä¸å­˜åœ¨ , noteId); return null; return BeanUtil.copy(note, NoteShowVO.class); 7.14.7 æŸ¥çœ‹ç¬”è®°åˆ†é¡µåˆ—è¡¨ cshop-notesrcmainJavagithublianyutiancshopnoteconfigMybatisPlusConfig.Java package github.lianyutian.cshop.note.config;import com.baomidou.mybatisplus.annotation.DbType;import com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;import com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;/** * MybatisPlus æ’ä»¶é…ç½® * * @author lianyutian * @since 2025-01-03 13:46:12 * @version 1.0 */@Configurationpublic class MybatisPlusConfig /** æ·»åŠ åˆ†é¡µæ’ä»¶ */ @Bean public MybatisPlusInterceptor mybatisPlusInterceptor() MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor(); interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL)); return interceptor; cshop-commonsrcmainJavagithublianyutiancshopcommonmodelvoPageVO.Java package github.lianyutian.cshop.common.model.vo;import com.baomidou.mybatisplus.extension.plugins.pagination.Page;import com.fasterxml.jackson.annotation.JsonIgnore;import java.util.Collections;import java.util.List;import java.util.Objects;import lombok.AllArgsConstructor;import lombok.Data;/** * åˆ†é¡µè¿”å›ç»“æœ * * @author lianyutian * @since 2025-01-03 14:19:25 * @version 1.0 */@Data@AllArgsConstructorpublic class PageVOT /** æ€»æ¡æ•° */ protected Long total; /** æ€»é¡µç æ•° */ protected Long pages; /** å½“å‰é¡µæ•°æ® */ protected ListT list; public static T PageVOT empty(Page? page) return new PageVO( Objects.requireNonNull(page, Page cannot be null).getTotal(), page.getPages(), Collections.emptyList()); public static T PageVOT of(Page? page, ListT list) if (page == null) throw new IllegalArgumentException(Page cannot be null); if (list == null) throw new IllegalArgumentException(List cannot be null); return new PageVO(page.getTotal(), page.getPages(), Collections.unmodifiableList(list)); @JsonIgnore public boolean isEmpty() return list.isEmpty(); cshop-commonsrcmainJavagithublianyutiancshopcommonmodelparamPageParam.Java package github.lianyutian.cshop.common.model.param;import com.baomidou.mybatisplus.core.metadata.OrderItem;import com.baomidou.mybatisplus.extension.plugins.pagination.Page;import jakarta.validation.constraints.Min;import lombok.Data;import org.apache.commons.lang3.StringUtils;/** * åˆ†é¡µæŸ¥è¯¢å…¥å‚ * * @author lianyutian * @since 2025-01-03 14:53:29 * @version 1.0 */@Datapublic class PageParam public static final Integer DEFAULT_PAGE_SIZE = 20; public static final Integer DEFAULT_PAGE_NUM = 1; /** é¡µç  */ @Min(value = 1, message = é¡µç ä¸èƒ½å°äº1) private final Integer pageNo = DEFAULT_PAGE_NUM; /** æ¯é¡µå¤§å° */ @Min(value = 1, message = æ¯é¡µæŸ¥è¯¢æ•°é‡ä¸èƒ½å°äº1) private final Integer pageSize = DEFAULT_PAGE_SIZE; /** æ˜¯å¦å‡åº */ private Boolean isAsc = true; /** æ’åºå­—æ®µ */ private String sortBy; public int from() return (pageNo - 1) * pageSize; public T PageT toMpPage(OrderItem... orderItems) PageT page = new Page(pageNo, pageSize); // æ˜¯å¦æ‰‹åŠ¨æŒ‡å®šæ’åºæ–¹å¼ if (orderItems != null orderItems.length 0) for (OrderItem orderItem : orderItems) page.addOrder(orderItem); return page; // å‰ç«¯æ˜¯å¦æœ‰æ’åºå­—æ®µ if (StringUtils.isNotEmpty(sortBy)) OrderItem orderItem = new OrderItem(); orderItem.setAsc(isAsc); orderItem.setColumn(sortBy); page.addOrder(orderItem); return page; public T PageT toMpPage(String defaultSortBy, boolean isAsc) if (StringUtils.isBlank(sortBy)) sortBy = defaultSortBy; this.isAsc = isAsc; PageT page = new Page(pageNo, pageSize); OrderItem orderItem = new OrderItem(); orderItem.setAsc(this.isAsc); orderItem.setColumn(sortBy); page.addOrder(orderItem); return page; public T PageT toMpPageDefaultSortByCreateTimeDesc() return toMpPage(create_time, false); cshop-notesrcmainJavagithublianyutiancshopnotemodelparamNotePageParam.Java package github.lianyutian.cshop.note.model.param;import github.lianyutian.cshop.common.model.param.PageParam;import lombok.Data;import lombok.EqualsAndHashCode;/** * åˆ†é¡µæŸ¥è¯¢ç¬”è®°å…¥å‚ * * @author lianyutian * @since 2025-01-03 13:51:14 * @version 1.0 */@EqualsAndHashCode(callSuper = true)@Datapublic class NotePageParam extends PageParam /** åšä¸» ID */ private Long userId; package github.lianyutian.cshop.note.controller;/** * ç”¨æˆ·ç¬”è®°å±•ç¤º * * @author lianyutian * @since 2025-01-09 10:12:54 * @version 1.0 */@RestController@RequestMapping(/api/note/v1)@AllArgsConstructorpublic class NoteShowController private final NoteShowService noteShowService; /** * åˆ†é¡µæŸ¥è¯¢ç”¨æˆ·ç¬”è®°åˆ—è¡¨ * * @param notePageParam ç¬”è®°åˆ—è¡¨å…¥å‚ * @return æˆ‘çš„ç¬”è®°åˆ—è¡¨ */ @PostMapping(list/show) public ApiResultPageVONoteShowVO getNoteShowList(@RequestBody NotePageParam notePageParam) return ApiResult.success(noteShowService.getNoteShowList(notePageParam)); package github.lianyutian.cshop.note.service;/** * ç”¨æˆ·ç¬”è®°å±•ç¤º * * @author lianyutian * @since 2025-01-09 10:15:18 * @version 1.0 */public interface NoteShowService /** * è·å–ç¬”è®°å±•ç¤ºåˆ—è¡¨ * * @param notePageParam æŸ¥è¯¢å…¥å‚ * @return ç¬”è®°åˆ—è¡¨ */ PageVONoteShowVO getNoteShowList(NotePageParam notePageParam); package github.lianyutian.cshop.note.service.impl;/** * ç”¨æˆ·ç¬”è®°å±•ç¤ºå®ç° * * @author lianyutian * @since 2025-01-09 10:18:39 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class NoteShowServiceImpl implements NoteShowService private final NoteMapper noteMapper; @Override public PageVONoteShowVO getNoteShowList(NotePageParam notePageParam) Long userId = notePageParam.getUserId(); // æŸ¥è¯¢æ•°æ®åº“ LambdaQueryWrapperNote lambdaQueryWrapper = new LambdaQueryWrapper(); lambdaQueryWrapper .eq(Note::getUserId, userId) .eq(Note::getStatus, NoteStatusEnum.PUBLISHED) .orderByAsc(Note::getCreateTime); PageNote notePage = noteMapper.selectPage( notePageParam.toMpPageDefaultSortByCreateTimeDesc(), lambdaQueryWrapper); ListNoteShowVO noteShowList = BeanUtil.copyList(notePage.getRecords(), NoteShowVO.class); if (CollectionUtils.isEmpty(noteShowList)) return PageVO.empty(notePage); log.info(ä»æ•°æ®åº“è·å–ç¬”è®°ä¿¡æ¯ , JsonUtil.toJson(noteShowList)); return PageVO.of(notePage, noteShowList); 7.14.8 å¼•å…¥ç¼“å­˜7.14.8.1 è·å–æˆ‘çš„ç¬”è®°è¯¦æƒ… è·å–æˆ‘çš„ç¬”è®°è¯¦æƒ…æ˜¯ä¸€ä¸ªè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œç¬”è®°çš„æ›´æ–°é¢‘ç‡æ˜¯å¾ˆå°‘çš„ã€‚ä¸€èˆ¬éƒ½æ˜¯è¯»æ“ä½œï¼Œä¸”è·å–è‡ªå·±ç¬”è®°è¯¦æƒ…æ˜¯æ²¡æœ‰å¹¶å‘åœºæ™¯åªå­˜åœ¨è‡ªå·±è°ƒè¯¥æ¥å£ä¸éœ€è¦é”ã€‚ cshop-notesrcmainJavagithublianyutiancshopnoteconstantNoteCacheKeyConstant.Java package github.lianyutian.cshop.note.constant;/** * ç¬”è®°ç¼“å­˜å¸¸é‡ * * @author lianyutian * @since 2025-01-08 14:06:12 * @version 1.0 */public class NoteCacheKeyConstant /** ç¬”è®°ä¿¡æ¯æ›´æ–°é”å‰ç¼€ */ public static final String NOTE_UPDATE_LOCK_KEY_PREFIX = cshop-note:update:lock:; /** ç¬”è®°å±•ç¤ºä¿¡æ¯ç¼“å­˜å‰ç¼€ */ public static final String NOTE_SHOW_KEY_PREFIX = cshop-note:show:; /** ç¬”è®°ä¿¡æ¯ç¼“å­˜å‰ç¼€ */ public static final String NOTE_DETAIL_KEY_PREFIX = cshop-note:detail:; /** ç¬”è®°ä¿¡æ¯åˆ†é¡µç¼“å­˜å‰ç¼€ */ public static final String NOTE_SHOW_PAGE_KEY_PREFIX = cshop-note:show-page:; /** ç”¨æˆ·ç¬”è®°ä¿¡æ¯æ€»æ•°ç¼“å­˜å‰ç¼€ */ public static final String NOTE_TOTAL_KEY_PREFIX = cshop-note:total:; package github.lianyutian.cshop.note.service.impl;/** * ç¬”è®°æœåŠ¡å®ç°ç±» * * @author lianyutian * @since 2025-01-03 10:54:31 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class NoteServiceImpl implements NoteService private final NoteMapper noteMapper; private final RedisCache redisCache; @Override public NoteDetailVO getNoteDetail(Long noteId) LoginUserInfo loginUserInfo = LoginInterceptor.USER_THREAD_LOCAL.get(); String noteDetailKey = NoteCacheKeyConstant.NOTE_DETAIL_KEY_PREFIX + noteId; NoteDetailVO noteDetailFromCache = getNoteDetailFromCache(noteDetailKey); if (noteDetailFromCache != null) return noteDetailFromCache; Note note = noteMapper.selectOne( new LambdaQueryWrapperNote() .eq(Note::getId, noteId) .eq(Note::getUserId, loginUserInfo.getId())); if (note == null) return null; return BeanUtil.copy(note, NoteDetailVO.class); private NoteDetailVO getNoteDetailFromCache(String noteDetailKey) String noteDetailFromCache = redisCache.get(noteDetailKey); if (StringUtils.isNotBlank(noteDetailFromCache)) Long expire = redisCache.getExpire(noteDetailKey, TimeUnit.SECONDS); // å¦‚æœè¿‡æœŸæ—¶é—´å·²ç»åœ¨ 1 å°æ—¶å†…äº†å°±è‡ªåŠ¨å»¶æœŸ if (expire RedisCache.ONE_HOUR_SECONDS) // ç¼“å­˜ç²¾å‡†è‡ªåŠ¨å»¶æœŸ 2 å¤© + éšæœºå‡ ä¸ªå°æ—¶ redisCache.expire(noteDetailKey, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); return JsonUtil.fromJson(noteDetailFromCache, NoteDetailVO.class); return null; 7.14.8.2 æŸ¥çœ‹ä»–äººç¬”è®°è¯¦æƒ… æŸ¥çœ‹ä»–äººç¬”è®°è¯¦æƒ…å°±éœ€è¦è€ƒè™‘å¹¶å‘é—®é¢˜äº†ã€‚ åœºæ™¯ 1ï¼šA ç”¨æˆ·çš„æŸç¯‡ç¬”è®°çˆ†ç«ï¼Œæ­¤æ—¶å°±å¯èƒ½ä¼šå­˜åœ¨æˆåƒæˆ–ä¸Šä¸‡ç”¨æˆ·åŒæ—¶æ¥æŸ¥çœ‹è¿™ä¸€ç¯‡ç¬”è®°ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ç¼“å­˜æ¥æŠ—ä½è¿™äº›å¹¶å‘è¯·æ±‚ã€‚ åœºæ™¯ 2ï¼šåœ¨åœºæ™¯ 1 çš„åŸºç¡€ä¸Šï¼ŒA ç”¨æˆ·å‘ç°ç¬”è®°æœ‰æè¿°é”™è¯¯å»æ›´æ–°äº†ç¬”è®°ã€‚è¿™ä¸ªæ—¶å€™éœ€è¦è€ƒè™‘ç¬”è®°ç¼“å­˜å’Œæ•°æ®åº“ä¸­æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ä¾‹å¦‚ B ç”¨æˆ·çº¿ç¨‹è¯·æ±‚ç¬”è®°è¯¦æƒ…æ—¶ï¼Œç¼“å­˜åˆšå¥½è¿‡æœŸã€‚è¿™ä¸ªæ—¶å€™å»æŸ¥è¯¢æ•°æ®åº“è·å–åˆ°äº†ç¬”è®°æ•°æ®ï¼Œæ¥ä¸‹æ¥è¦æ›´æ–°ç¼“å­˜ä½†æ˜¯æ­¤æ—¶çº¿ç¨‹æ—¶é—´ç‰‡ç”¨å®Œè¢«æš‚åœã€‚è¿™æ—¶ç”¨æˆ· A çº¿ç¨‹å»ä¿®æ”¹ç¬”è®°ï¼Œå¹¶æ›´æ–°æ•°æ®åº“åŒæ—¶æ›´æ–°ç¼“å­˜ã€‚åœ¨ç”¨æˆ· A çº¿ç¨‹æ›´æ–°å®Œç¼“å­˜åï¼Œç”¨æˆ· B çº¿ç¨‹æ‰ç»§ç»­æ‰§è¡Œå†å»æ›´æ–°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™ç¼“å­˜ä¸­å°±æ˜¯æ—§æ•°æ®ï¼Œæ•°æ®åº“ä¸­æ˜¯æ–°æ•°æ®ã€‚ package github.lianyutian.cshop.note.service.impl;/** * ç”¨æˆ·ç¬”è®°å±•ç¤ºå®ç° * * @author lianyutian * @since 2025-01-09 10:18:39 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class NoteShowServiceImpl implements NoteShowService private final RedisCache redisCache; private final RedisLock redisLock; private final NoteMapper noteMapper; @Override public NoteShowVO getNoteShow(Long noteId) String noteShowKey = NoteCacheKeyConstant.NOTE_SHOW_KEY_PREFIX + noteId; NoteShowVO noteDetailFromCache = getNoteShowFromCache(noteShowKey); if (noteDetailFromCache != null) return noteDetailFromCache; return getNoteShowFromDB(noteShowKey, noteId); private NoteShowVO getNoteShowFromCache(String noteShowKey) String noteDetailFromCache = redisCache.get(noteShowKey); if (StringUtils.isNotBlank(noteDetailFromCache)) Long expire = redisCache.getExpire(noteShowKey, TimeUnit.SECONDS); // å¦‚æœè¿‡æœŸæ—¶é—´å·²ç»åœ¨ 1 å°æ—¶å†…äº†å°±è‡ªåŠ¨å»¶æœŸ if (expire RedisCache.ONE_HOUR_SECONDS) // ç¼“å­˜ç²¾å‡†è‡ªåŠ¨å»¶æœŸ 2 å¤© + éšæœºå‡ ä¸ªå°æ—¶ redisCache.expire(noteShowKey, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); return JsonUtil.fromJson(noteDetailFromCache, NoteShowVO.class); return null; private NoteShowVO getNoteShowFromDB(String noteDetailKey, Long noteId) /* 1.è®¾ç½®åˆ†å¸ƒå¼é”é˜²æ­¢è¶…é«˜å¹¶å‘è¯·æ±‚æ‰“åˆ°æ•°æ®åº“ 2.ä¿è¯ç¬”è®°æ•°æ®æ›´æ–°æ—¶ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§ */ String noteUpdateLockKey = NoteCacheKeyConstant.NOTE_UPDATE_LOCK_KEY_PREFIX + noteId; boolean locked = false; try locked = redisLock.tryLock(noteUpdateLockKey, RedisLock.UPDATE_LOCK_TIMEOUT); if (!locked) // åŠ é”è¶…æ—¶æ—¶é—´æœ‰ 200ms, æ‰€ä»¥å†æ¬¡å°è¯•è·å–ç¼“å­˜ NoteShowVO noteDetailFromCache = getNoteShowFromCache(noteDetailKey); if (noteDetailFromCache != null) return noteDetailFromCache; log.warn(ã€getNoteShowDetailã€‘ç¬”è®°ç¼“å­˜ä¸ºç©ºï¼ŒæŸ¥è¯¢ç¬”è®°ä¿¡æ¯è·å–é”å¤±è´¥ , noteId); throw new BizException(BizCodeEnum.NOTE_INFO_LOCK_FAIL); // è·å–é”æˆåŠŸï¼ŒæŸ¥è¯¢æ•°æ®åº“ Note note = noteMapper.selectOne( new LambdaQueryWrapperNote() .eq(Note::getId, noteId) .eq(Note::getStatus, NoteStatusEnum.PUBLISHED.getCode())); if (note == null) log.warn(ã€getNoteShowDetailã€‘ç¬”è®°ä¸å­˜åœ¨ , noteId); // é˜²æ­¢åŒæ—¶é—´å¤§é‡æ— æ•ˆ noteId ç©¿é€ç¼“å­˜æ‰“åˆ°æ•°æ®åº“é€ æˆç¼“å­˜ç©¿é€ redisCache.set( noteDetailKey, RedisCache.EMPTY_CACHE, RedisCache.generateCachePenetrationExpire(), TimeUnit.MILLISECONDS); return null; return BeanUtil.copy(note, NoteShowVO.class); catch (InterruptedException e) NoteShowVO noteDetailFromCache = getNoteShowFromCache(noteDetailKey); if (noteDetailFromCache != null) return noteDetailFromCache; log.error(ã€getNoteShowã€‘å°è¯•åŠ é”å¼‚å¸¸ï¼Œå¼‚å¸¸ä¿¡æ¯ï¼š, e.getMessage(), e); throw new BizException(BizCodeEnum.NOTE_INFO_LOCK_FAIL); finally if (locked) redisLock.unlock(noteUpdateLockKey); 7.14.8.3 æŸ¥çœ‹ç¬”è®°åˆ†é¡µåˆ—è¡¨package github.lianyutian.cshop.note.service.impl;/** * ç”¨æˆ·ç¬”è®°å±•ç¤ºå®ç° * * @author lianyutian * @since 2025-01-09 10:18:39 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class NoteShowServiceImpl implements NoteShowService private final RedisCache redisCache; private final RedisLock redisLock; private final NoteMapper noteMapper; @Override public PageVONoteShowVO getNoteShowList(NotePageParam notePageParam) // ä»ç¼“å­˜æŸ¥è¯¢åˆ†é¡µæ•°æ® ListNoteShowVO noteListFromCache = getNoteShowListFromCache( NoteCacheKeyConstant.NOTE_SHOW_PAGE_KEY_PREFIX + notePageParam.getUserId() + : + notePageParam.getPageNo()); if (!CollectionUtils.isEmpty(noteListFromCache)) return getNotePage(notePageParam, noteListFromCache); ListNoteShowVO noteListFromDB = getNoteShowListFromDB(notePageParam); if (!CollectionUtils.isEmpty(noteListFromDB)) return getNotePage(notePageParam, noteListFromDB); return null; /** * è·å–ç¼“å­˜çš„åˆ†é¡µç¬”è®°ä¿¡æ¯ * * @param notePageInfoKey åˆ†é¡µç¼“å­˜ key * @return åˆ†é¡µç¬”è®°ä¿¡æ¯ */ @SuppressWarnings(unchecked) private ListNoteShowVO getNoteShowListFromCache(String notePageInfoKey) String cachePageInfo = redisCache.get(notePageInfoKey); if (StringUtils.isNotBlank(cachePageInfo)) Long expire = redisCache.getExpire(notePageInfoKey, TimeUnit.SECONDS); // å¦‚æœè¿‡æœŸæ—¶é—´å·²ç»åœ¨ 1 å°æ—¶å†…äº†å°±è‡ªåŠ¨å»¶æœŸ if (expire RedisCache.ONE_HOUR_SECONDS) // ç¼“å­˜ç²¾å‡†è‡ªåŠ¨å»¶æœŸ 2 å¤© + éšæœºå‡ ä¸ªå°æ—¶ redisCache.expire(notePageInfoKey, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); return JsonUtil.fromJson(cachePageInfo, List.class); return null; private ListNoteShowVO getNoteShowListFromDB(NotePageParam notePageParam) Long userId = notePageParam.getUserId(); // åˆ†å¸ƒå¼é” key String noteUpdateLockKey = NoteCacheKeyConstant.NOTE_UPDATE_LOCK_KEY_PREFIX + userId; boolean tryLocked = false; // ç¬”è®°åˆ†é¡µç¼“å­˜ key String notePageKey = NoteCacheKeyConstant.NOTE_SHOW_PAGE_KEY_PREFIX + userId + : + notePageParam.getPageNo(); try tryLocked = redisLock.tryLock(noteUpdateLockKey, RedisCache.UPDATE_LOCK_TIMEOUT); if (!tryLocked) /* å°è¯•åŠ é”æ—¶é—´æœ‰ RedisCache.UPDATE_LOCK_TIMEOUT æœ‰å¯èƒ½å…¶ä»–çº¿ç¨‹å·²ç»è·å–æ•°æ®å¹¶å†™å…¥ç¼“å­˜äº†æ‰€ä»¥è¿™é‡Œå†å°è¯•å»è¯»ä¸‹ç¼“å­˜ */ ListNoteShowVO noteListFromCache = getNoteShowListFromCache(notePageKey); if (!CollectionUtils.isEmpty(noteListFromCache)) return noteListFromCache; log.info(ã€getNoteListFromDBã€‘ç¬”è®°ç¼“å­˜ä¸ºç©ºï¼ŒæŸ¥è¯¢ç¬”è®°ä¿¡æ¯è·å–é”å¤±è´¥ , userId); return null; // æŸ¥è¯¢æ•°æ®åº“ LambdaQueryWrapperNote lambdaQueryWrapper = new LambdaQueryWrapper(); lambdaQueryWrapper .eq(Note::getUserId, userId) .eq(Note::getStatus, NoteStatusEnum.PUBLISHED) .orderByAsc(Note::getCreateTime); PageNote notePage = noteMapper.selectPage( notePageParam.toMpPageDefaultSortByCreateTimeDesc(), lambdaQueryWrapper); ListNoteShowVO noteShowList = BeanUtil.copyList(notePage.getRecords(), NoteShowVO.class); if (CollectionUtils.isEmpty(noteShowList)) // é˜²æ­¢ç¼“å­˜ç©¿é€ redisCache.set( notePageKey, RedisCache.EMPTY_CACHE, RedisCache.generateCachePenetrationExpire(), TimeUnit.MILLISECONDS); return null; redisCache.set( notePageKey, noteShowList, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); log.info(ã€getNoteListFromDBã€‘ç¬”è®°ç¼“å­˜ä¸ºç©ºï¼Œä»æ•°æ®åº“è·å–ç¬”è®°ä¿¡æ¯ , JsonUtil.toJson(noteShowList)); return noteShowList; catch (InterruptedException e) // åŠ é”å¤±è´¥ // è¿™é‡Œå†å»å°è¯•è·å–ä¸‹ç¼“å­˜-åŒé‡æ£€æŸ¥ ListNoteShowVO noteListFromCache = getNoteShowListFromCache(notePageKey); if (!CollectionUtils.isEmpty(noteListFromCache)) return noteListFromCache; log.error(ã€getNoteListFromDBã€‘å°è¯•åŠ é”å¼‚å¸¸ï¼Œå¼‚å¸¸ä¿¡æ¯ï¼š, e.getMessage(), e); throw new BizException(BizCodeEnum.NOTE_INFO_LOCK_FAIL); finally if (tryLocked) redisLock.unlock(noteUpdateLockKey); private PageVONoteShowVO getNotePage(NotePageParam notePageParam, ListNoteShowVO noteList) // è®¡ç®—æˆ‘çš„ç¬”è®°åˆ—è¡¨æ€»æ•° String userNoteTotalKey = NoteCacheKeyConstant.NOTE_TOTAL_KEY_PREFIX + notePageParam.getUserId(); // ç¬”è®°æ€»æ¡æ•° Long total = redisCache.getLong(userNoteTotalKey); // è®¡ç®—æ€»é¡µæ•° double totalPages = Math.ceil((double) total / notePageParam.getPageSize()); return new PageVO(total, (long) totalPages, Collections.unmodifiableList(noteList)); 7.14.9 é‡å»ºåˆ†é¡µç¼“å­˜ ç”¨æˆ·æŸ¥è¯¢ç¬”è®°åˆ†é¡µæ—¶ï¼Œä¼šä»æ•°æ®åº“æ ¹æ®åˆ†é¡µæ•°æŸ¥è¯¢åˆ†é¡µè®°å½•å¹¶æŠŠç»“æœå†™å…¥åˆ°ç¼“å­˜ã€‚å¦‚æœç”¨æˆ·æ·»åŠ æ›´æ–°äº†ä¸€ç¯‡æ–°ç¬”è®°ï¼Œé‚£ä¹ˆæ•´ä¸ªåˆ†é¡µç¼“å­˜è®°å½•éƒ½éœ€è¦é‡æ–°æ„å»ºã€‚é‡å»ºç¼“å­˜æ˜¯ä¸ªè€—æ—¶çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥å¼•å…¥ RocketMq åšä¸€ä¸ªå¼‚æ­¥æ›´æ–°æ“ä½œã€‚æ·»åŠ æ›´æ–°ä¸€ç¯‡ç¬”è®°åä¼šå‘é€ MQ æ¶ˆæ¯ï¼Œæ¶ˆè´¹ç«¯ç›‘å¬æ¶ˆæ¯ï¼Œé‡å»ºç¼“å­˜ã€‚ pom.xml !-- rocketmq ç‰ˆæœ¬ --rocketmq-starter.version2.2.1/rocketmq-starter.versiondependency groupIdorg.apache.rocketmq/groupId artifactIdrocketmq-spring-boot-starter/artifactId version$rocketmq-starter.version/version/dependency cshop-commonpom.xml dependency groupIdorg.apache.rocketmq/groupId artifactIdrocketmq-spring-boot-starter/artifactId/dependency cshop-notepom.xml dependency groupIdorg.apache.rocketmq/groupId artifactIdrocketmq-client/artifactId/dependency cshop-commonsrcmainJavagithublianyutiancshopcommonmqRocketMQConfig.Java package github.lianyutian.cshop.common.mq;import lombok.Data;import org.apache.rocketmq.acl.common.AclClientRPCHook;import org.apache.rocketmq.acl.common.SessionCredentials;import org.apache.rocketmq.remoting.RPCHook;import org.springframework.beans.factory.annotation.Value;import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;/** * rocketmq é…ç½®ç±» * * @author lianyutian * @since 2025-01-15 10:26:51 * @version 1.0 */@Data@Configuration@ConditionalOnProperty(prefix = rocketmq, value = nameServer)public class RocketMQConfig @Value($rocketmq.nameServer) private String nameServer; @Value($rocketmq.accessKey) private String accessKey; @Value($rocketmq.secretKey) private String secretKey; /** * é‰´æƒ hook * * @return RPCHook */ @Bean public RPCHook rpcHook() return new AclClientRPCHook(new SessionCredentials(accessKey, secretKey)); cshop-notesrcmainresourcesapplication.yml # rocketmqé…ç½®rocketmq: accessKey: mqadmin secretKey: MIIEowIBAAKCAQEAwG90ULRHmAXFXQzZSwleoYts2+bCzUvqhhqtGiv/F5kUsETY nameServer: 116.198.217.158:9876 cshop-notesrcmainJavagithublianyutiancshopnoteconstantNoteRocketMQConstant.Java package github.lianyutian.cshop.note.constant;/** * MQ å¸¸é‡ç±» * * @author lianyutian * @since 2025-01-14 14:53:14 * @version 1.0 */public class NoteRocketMQConstant public static final String NOTE_UPDATE_PRODUCER_GROUP = note-update-producer-group; public static final String NOTE_UPDATE_TOPIC = note-update-topic; cshop-notesrcmainJavagithublianyutiancshopnoteenumsNoteMessageType.Java package github.lianyutian.cshop.note.enums;import lombok.Getter;/** * ç¬”è®° MQ æ¶ˆæ¯ç±»å‹æšä¸¾ * * @author lianyutian * @since 2025-01-15 14:26:26 * @version 1.0 */@Getterpublic enum NoteMessageType /** ç¬”è®°æ–°å¢æ¶ˆæ¯ */ ADD_NOTE(ADD, æ–°å¢ç¬”è®°æ¶ˆæ¯), /** ç¬”è®°æ›´æ–°æ¶ˆæ¯ */ UPDATE_NOTE(UPDATE, æ›´æ–°ç¬”è®°æ¶ˆæ¯); private final String type; private final String message; NoteMessageType(String type, String message) this.type = type; this.message = message; cshop-notesrcmainJavagithublianyutiancshopnotemqmessageNoteUpdateMessage.Java package github.lianyutian.cshop.note.mq.message;import java.io.Serializable;import lombok.Builder;import lombok.Getter;import lombok.Setter;/** * ç¬”è®°æ›´æ–°æ¶ˆæ¯ * * @author lianyutian * @since 2025-01-14 16:16:40 * @version 1.0 */@Getter@Setter@Builderpublic class NoteUpdateMessage implements Serializable /** ç¬”è®° ID */ private Long noteId; /** åšä¸» ID */ private Long userId; cshop-notesrcmainJavagithublianyutiancshopnotemqproducerNoteTransactionProducer.Java package github.lianyutian.cshop.note.mq.producer;/** * ç¬”è®°äº‹åŠ¡æ¶ˆæ¯ç”Ÿäº§è€… * * @author lianyutian * @since 2025-01-14 14:52:03 * @version 1.0 */@Getter@Component@Slf4jpublic class NoteTransactionProducer private final TransactionMQProducer producer; @Autowired public NoteTransactionProducer( RocketMQConfig rocketMQConfig, RPCHook rpcHook, NoteAddListener noteAddListener) // åˆå§‹åŒ–äº‹åŠ¡ç”Ÿäº§è€…å®¢æˆ·ç«¯ï¼Œè®¾ç½®å¯¹åº”çš„ç”Ÿäº§è€…ç»„ producer = new TransactionMQProducer(NoteRocketMQConstant.NOTE_UPDATE_PRODUCER_GROUP, rpcHook); // è®¾ç½® nameserver producer.setNamesrvAddr(rocketMQConfig.getNameServer()); producer.setTransactionListener(noteAddListener); // å¯åŠ¨ç”Ÿäº§è€…æœåŠ¡ start(); /** å¯åŠ¨ rocketmq ç”Ÿäº§è€…æœåŠ¡ è¯¥å¯¹è±¡åœ¨ä½¿ç”¨ä¹‹å‰å¿…é¡»è¦è°ƒç”¨ä¸€æ¬¡ï¼Œåªèƒ½åˆå§‹åŒ–ä¸€æ¬¡ */ public void start() try this.producer.start(); catch (MQClientException e) log.error(rocketmq producer start error, e); /** å…³é—­ rocketmq ç”Ÿäº§è€… */ public void shutdown() this.producer.shutdown(); /** * å‘é€äº‹åŠ¡æ¶ˆæ¯ * * @param topic topic * @param tag tag * @param message æ¶ˆæ¯ * @param arg é¢å¤–å‚æ•° * @param type æ¶ˆæ¯ç±»å‹ */ public void sendTransactionMessage( String topic, String tag, String message, Object arg, NoteMessageType type) Message msg = new Message(topic, tag, message.getBytes(StandardCharsets.UTF_8)); try SendResult send = producer.sendMessageInTransaction(msg, arg); if (SendStatus.SEND_OK == send.getSendStatus()) log.info(å‘é€ MQ æ¶ˆæ¯æˆåŠŸ, type:, message:, arg:, type.getMessage(), message, arg); else throw new BizException(send.getSendStatus().toString()); catch (Exception e) log.error(å‘é€ MQ æ¶ˆæ¯å¤±è´¥ï¼š, e); throw new BizException(å‘é€ MQ æ¶ˆæ¯å¤±è´¥); /** * åŒæ­¥å‘é€å•æ¡æ¶ˆæ¯ * * @param topic ä¸»é¢˜ * @param tag tag * @param message æ¶ˆæ¯ * @param type ç±»å‹ */ public void sendMessage(String topic, String tag, String message, NoteMessageType type) sendDelayMessage(topic, tag, message, DelayLevel.LEVEL_0, type); /** * å‘é€å•æ¡å»¶è¿Ÿæ¶ˆæ¯ * * @param topic topic * @param tag tag * @param message æ¶ˆæ¯ * @param delayTimeLevel å»¶è¿Ÿç­‰çº§ * @param type ç±»å‹ */ public void sendDelayMessage( String topic, String tag, String message, DelayLevel delayTimeLevel, NoteMessageType type) Message msg = new Message(topic, tag, message.getBytes(StandardCharsets.UTF_8)); try if (delayTimeLevel.getValue() 0) msg.setDelayTimeLevel(delayTimeLevel.getValue()); SendResult send = producer.send(msg); if (SendStatus.SEND_OK == send.getSendStatus()) log.info(å‘é€ MQ æ¶ˆæ¯æˆåŠŸ, type:, message:, type.getMessage(), message); else throw new BizException(send.getSendStatus().toString()); catch (Exception e) log.error(å‘é€ MQ æ¶ˆæ¯å¤±è´¥ï¼š, e); throw new BizException(å‘é€ MQ æ¶ˆæ¯å¤±è´¥); /** * æ‰¹é‡å‘é€å»¶è¿Ÿæ¶ˆæ¯ * * @param topic topic * @param tag tag * @param messages å¤šä¸ªæ¶ˆæ¯ * @param delayTimeLevel å»¶è¿Ÿç­‰çº§ * @param type ç±»å‹ */ public void sendDelayMessages( String topic, String tag, ListString messages, DelayLevel delayTimeLevel, NoteMessageType type) ListMessage list = new ArrayList(); for (String message : messages) Message msg = new Message(topic, tag, message.getBytes(StandardCharsets.UTF_8)); if (delayTimeLevel.getValue() 0) msg.setDelayTimeLevel(delayTimeLevel.getValue()); list.add(msg); try SendResult send = producer.send(list); if (SendStatus.SEND_OK == send.getSendStatus()) log.info(å‘é€ MQ æ¶ˆæ¯æˆåŠŸ, type:, type.getMessage()); else throw new BizException(send.getSendStatus().toString()); catch (Exception e) log.error(å‘é€ MQ æ¶ˆæ¯å¤±è´¥ï¼š, e); throw new BizException(å‘é€ MQ æ¶ˆæ¯å¤±è´¥); cshop-notesrcmainJavagithublianyutiancshopnotemqproducerlistenerNoteAddListener.Java package github.lianyutian.cshop.note.mq.producer.listener;/** * ç¬”è®°æ·»åŠ æ¶ˆæ¯ç›‘å¬ * * @author lianyutian * @since 2025-01-16 10:59:25 * @version 1.0 */@Slf4j@Component@AllArgsConstructorpublic class NoteAddListener implements TransactionListener private final NoteMapper noteMapper; @Override public LocalTransactionState executeLocalTransaction(Message msg, Object arg) return LocalTransactionState.UNKNOW; @Override public LocalTransactionState checkLocalTransaction(MessageExt msg) return checkNoteAddStatus(msg); private LocalTransactionState checkNoteAddStatus(Message msg) try String messageBody = new String(msg.getBody(), StandardCharsets.UTF_8); NoteUpdateMessage noteAddMessage = JsonUtil.fromJson(messageBody, NoteUpdateMessage.class); if (noteAddMessage == null) log.error(Failed to parse NoteAddMessage from message body: , messageBody); return LocalTransactionState.ROLLBACK_MESSAGE; Long noteId = noteAddMessage.getNoteId(); if (noteId == null) log.error(NoteId is null in NoteAddMessage: , noteAddMessage); return LocalTransactionState.ROLLBACK_MESSAGE; Note note = noteMapper.selectById(noteId); if (note != null) log.info(Note with id found, committing message, noteId); return LocalTransactionState.COMMIT_MESSAGE; else log.warn(Note with id not found, returning unknown state, noteId); return LocalTransactionState.UNKNOW; catch (Exception e) log.error(Error processing message: , e.getMessage(), e); return LocalTransactionState.ROLLBACK_MESSAGE; cshop-notesrcmainJavagithublianyutiancshopnotemqconsumerNoteUpdateConsumerConfig.Java package github.lianyutian.cshop.note.mq.consumer;/** * é»˜è®¤æ¶ˆè´¹è€… * * @author lianyutian * @since 2025-01-15 10:32:28 * @version 1.0 */@Componentpublic class NoteUpdateConsumerConfig @Bean public DefaultMQPushConsumer noteUpdateConsumer( RocketMQConfig rocketMQConfig, NoteUpdateListener noteUpdateListener, NoteAddListener noteAddListener, RPCHook rpcHook) throws MQClientException DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(null, NoteRocketMQConstant.NOTE_UPDATE_PRODUCER_GROUP, rpcHook); consumer.setNamesrvAddr(rocketMQConfig.getNameServer()); consumer.subscribe(NoteRocketMQConstant.NOTE_UPDATE_TOPIC, *); consumer.registerMessageListener(noteUpdateListener); consumer.start(); return consumer; cshop-notesrcmainJavagithublianyutiancshopnotemqconsumerlistenerNoteUpdateListener.Java package github.lianyutian.cshop.note.mq.consumer.listener;/** * ç¬”è®°æ›´æ–°æ¶ˆæ¯ç›‘å¬å™¨ * * @author lianyutian * @since 2025-01-15 10:34:58 * @version 1.0 */@Slf4j@Component@AllArgsConstructorpublic class NoteUpdateListener implements MessageListenerConcurrently /** æ¯é¡µ 20 æ¡ */ private static final int PAGE_SIZE = 2; private final RedisCache redisCache; private final RedisLock redisLock; private final NoteMapper noteMapper; @Override public ConsumeConcurrentlyStatus consumeMessage( ListMessageExt noteMessageList, ConsumeConcurrentlyContext context) try for (MessageExt noteMessage : noteMessageList) String msg = new String(noteMessage.getBody()); Long userId; NoteUpdateMessage noteUpdateMessage = JsonUtil.fromJson(msg, NoteUpdateMessage.class); userId = noteUpdateMessage.getUserId(); log.info(ç¬”è®° MQ å¼‚æ­¥æ›´æ–°-æ‰§è¡Œåšä¸»ç¬”è®°åˆ†é¡µç¼“å­˜æ•°æ®å¼‚æ­¥æ›´æ–°ï¼Œæ¶ˆæ¯å†…å®¹ï¼š, JsonUtil.toJson(noteUpdateMessage)); // è¿™é‡Œå¢åŠ åˆ†å¸ƒå¼é”ï¼ŒåŒä¸€ä¸ªç”¨æˆ·åŒæ—¶é—´åªèƒ½æ“ä½œä¸€æ¬¡ï¼Œé¿å…é‡å¤è¯·æ±‚ String noteUpdateLockKey = NoteCacheKeyConstant.NOTE_UPDATE_LOCK_KEY_PREFIX + userId; boolean locked = false; try // è¿™é‡Œé€šè¿‡é˜»å¡çš„æ–¹å¼è¿›è¡ŒåŠ é”ï¼Œè·Ÿæ–°å¢/æ›´æ–°ç¬”è®°æ“ä½œäº’æ–¥ï¼Œå¹¶å‘æ“ä½œæ—¶è¿›è¡Œé˜»å¡ locked = redisLock.blockedLock(noteUpdateLockKey); updateCache(userId); finally if (locked) redisLock.unlock(noteUpdateLockKey); catch (Exception e) // æœ¬æ¬¡æ¶ˆè´¹å¤±è´¥ï¼Œä¸‹æ¬¡é‡æ–°æ¶ˆè´¹ log.error(ç¬”è®° MQ å¼‚æ­¥æ›´æ–° consume error, æ›´æ–°åšä¸»ç¬”è®°ç¼“å­˜æ•°æ®æ¶ˆè´¹å¤±è´¥, e); return ConsumeConcurrentlyStatus.RECONSUME_LATER; log.info(ç¬”è®° MQ å¼‚æ­¥æ›´æ–°-åšä¸»ç¬”è®°ç¼“å­˜æ•°æ®æ¶ˆè´¹æˆåŠŸ, result: , ConsumeConcurrentlyStatus.CONSUME_SUCCESS); return ConsumeConcurrentlyStatus.CONSUME_SUCCESS; private void updateCache(Long userId) // æ­¤æ—¶æˆ‘ä»¬éœ€è¦å¯¹åšä¸»çš„ç¬”è®°åˆ—è¡¨è¿›è¡Œåˆ†é¡µç¼“å­˜é‡æ–°æ„å»º // æ–°å¢éœ€è¦æ„å»ºæ‰€æœ‰ç¬”è®°åˆ†é¡µç¼“å­˜ // 1ã€è®¡ç®—æˆ‘çš„ç¬”è®°åˆ—è¡¨æ€»æ•° String userNoteTotalKey = NoteCacheKeyConstant.NOTE_TOTAL_KEY_PREFIX + userId; Long size = redisCache.getLong(userNoteTotalKey); log.info(ç¬”è®° MQ å¼‚æ­¥æ›´æ–°-key:, value:, userNoteTotalKey, size); // è®¡ç®—æ€»åˆ†é¡µæ•° int pageTotal = (int) Math.ceil((double) size / PAGE_SIZE) + 1; for (int pageNum = 1; pageNum = pageTotal; pageNum++) buildPageCache(userId, pageNum); private void buildPageCache(Long userId, int pageNum) // ç¬”è®°åˆ†é¡µç¼“å­˜ key String notePageKey = NoteCacheKeyConstant.NOTE_SHOW_PAGE_KEY_PREFIX + userId + : + pageNum; // å…ˆä»ç¼“å­˜ä¸­è·å–ä¸€ä¸‹ String notePageCache = redisCache.get(notePageKey); // å¦‚æœåˆ†é¡µç¼“å­˜ä¸ºç©ºï¼Œè·³è¿‡ if (StringUtils.isBlank(notePageCache)) return; // åªæœ‰ç¼“å­˜ä¸­å­˜åœ¨è¿™ä¸€é¡µçš„æ•°æ®æ‰ä¼šå»æ•°æ®åº“è¯»å–æœ€æ–°çš„ç¬”è®°ä¿¡æ¯å»æ›´æ–° // æŸ¥è¯¢æˆ‘çš„æœªåˆ é™¤ç¬”è®°åˆ—è¡¨ LambdaQueryWrapperNote lambdaQueryWrapper = new LambdaQueryWrapper(); lambdaQueryWrapper .eq(Note::getUserId, userId) .eq(Note::getStatus, NoteStatusEnum.PUBLISHED) .orderByDesc(Note::getUpdateTime); PageNote notePageParam = new Page(pageNum, PAGE_SIZE); PageNote notePage = noteMapper.selectPage(notePageParam, lambdaQueryWrapper); ListNote noteList = notePage.getRecords(); log.info( ç¬”è®° MQ å¼‚æ­¥æ›´æ–°-ä»æ•°æ®åº“è·å–æˆ‘çš„ç¬”è®°åˆ—è¡¨ï¼ŒpageNum:, total:, sizeï¼š, userId: , notePage.getPages(), notePage.getTotal(), notePage.getSize(), userId); ListNoteShowVO noteShowVOList = BeanUtil.copyList(noteList, NoteShowVO.class); // å†™å…¥åˆ†é¡µç¼“å­˜æ•°æ® redisCache.set( notePageKey, noteShowVOList, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); package github.lianyutian.cshop.note.service.impl;/** * ç¬”è®°æœåŠ¡å®ç°ç±» * * @author lianyutian * @since 2025-01-03 10:54:31 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class NoteServiceImpl implements NoteService private final NoteMapper noteMapper; private final RedisLock redisLock; private final RedisCache redisCache; private final NoteTransactionProducer noteTransactionProducer; @Override @Transactional(rollbackFor = Exception.class) public int addNote(NoteAddParam noteAddParam) LoginUserInfo loginUserInfo = LoginInterceptor.USER_THREAD_LOCAL.get(); Note note = BeanUtil.copy(noteAddParam, Note.class); note.setUserId(loginUserInfo.getId()); // note.setStatus(NoteStatusEnum.AUDITING); note.setStatus(NoteStatusEnum.PUBLISHED); note.setPublishTime(new Date()); int row; try row = noteMapper.insert(note); if (row 0) try redisCache.increment( NoteCacheKeyConstant.NOTE_TOTAL_KEY_PREFIX + loginUserInfo.getId(), 1); // ä¸èƒ½å› ä¸ºæ¶ˆæ¯å‘é€å¤±è´¥å¯¼è‡´ç¬”è®°æ–°å¢å¤±è´¥ // TODO éœ€è¦å®šæ—¶ä»»åŠ¡æ‰«ææ–°å¢ç¬”è®°æ¥å…œåº•åˆ†é¡µåˆ·æ–° publishNoteAddedEvent(note.getId(), loginUserInfo.getId()); catch (Exception e) log.error(redis or mq error , e.getMessage(), e); catch (Exception e) log.error(db addNote error , e.getMessage(), e); throw new BizException(BizCodeEnum.NOTE_ADD_FAIL); log.info(ç¬”è®°æœåŠ¡-æ–°å¢ç¬”è®°ï¼šrows=ï¼Œdata=, row, JsonUtil.toJson(noteAddParam)); return row; @Override @Transactional(rollbackFor = Exception.class) public int updateNote(NoteEditParam noteEditParam) // 1.æŸ¥è¯¢ç¬”è®°æ˜¯å¦å­˜åœ¨ LoginUserInfo loginUserInfo = LoginInterceptor.USER_THREAD_LOCAL.get(); // è¿™é‡Œå¢åŠ åˆ†å¸ƒå¼é”æ˜¯ä¸ºäº†ä¿è¯ Redis ä¸­ç¼“å­˜çš„ç¬”è®°æ•°æ®å’Œ DB ä¸­çš„ç¬”è®°æ•°æ®ä¸€è‡´ /* å­˜åœ¨è¿™ç§åœºæ™¯ï¼šå‡è®¾å½“å‰ç¼“å­˜ä¸ºç©ºï¼Œç”¨æˆ· A æ›´æ–°è‡ªå·±çš„ç¬”è®°ï¼ŒåŒæ—¶ç”¨æˆ· B æŸ¥è¯¢ç”¨æˆ· A çš„ç¬”è®°ã€‚å¦‚æœè¿™æ—¶ç”¨æˆ· A è¿˜æœªæ›´æ–°æ•°æ®åº“ï¼Œç”¨æˆ· B å·²ç»ä»æ•°æ®åº“æŸ¥è¯¢åˆ°äº†æ•°æ® åŒæ—¶ç”¨æˆ· B æ‰€åœ¨çº¿ç¨‹ CPU æ‰§è¡Œæ—¶é—´æ¶ˆè€—å®Œè¢«æŒ‚èµ·ã€‚æ­¤æ—¶ç”¨æˆ· A å†æ›´æ–°æ•°æ®åº“æˆåŠŸå¹¶å°†æ–°æ•°æ®å†™å…¥ç¼“å­˜ã€‚ç”¨æˆ· B çº¿ç¨‹æ‰ç»§ç»­æ‰§è¡Œï¼Œæ­¤æ—¶ç”¨æˆ· B æŸ¥è¯¢åˆ°çš„æ•°æ®æ˜¯æ—§çš„ã€‚ åˆå»å†™å…¥äº†ç¼“å­˜é‚£ä¹ˆæ­¤æ—¶çš„ç¼“å­˜æ•°æ®å°±æ˜¯æ—§çš„ã€‚ */ String noteUpdateLockKey = NoteCacheKeyConstant.NOTE_UPDATE_LOCK_KEY_PREFIX + noteEditParam.getId(); boolean locked = false; try locked = redisLock.lock(noteUpdateLockKey); if (!locked) log.info(ç¬”è®°æ¨¡å—-ç”¨æˆ·ä¿®æ”¹ç¬”è®°ä¿¡æ¯ï¼šç”¨æˆ· è·å–é”å¤±è´¥, ç¬”è®° , loginUserInfo.getId(), noteEditParam.getId()); throw new BizException(BizCodeEnum.NOTE_UPDATE_LOCK_FAIL); Note updateNote = BeanUtil.copy(noteEditParam, Note.class); int row = noteMapper.update( updateNote, new LambdaUpdateWrapperNote() .eq(Note::getId, noteEditParam.getId()) .eq(Note::getUserId, loginUserInfo.getId())); if (row 0) updateNoteCache(noteEditParam.getId()); publishNoteUpdatedEvent(noteEditParam.getId(), loginUserInfo.getId()); log.info(ç¬”è®°æœåŠ¡-æ›´æ–°ç¬”è®°ï¼šrow=, data=, row, JsonUtil.toJson(noteEditParam)); return row; catch (Exception e) log.error(updateNote error , e.getMessage(), e); // åˆ æ‰ç¼“å­˜ redisCache.delete(NoteCacheKeyConstant.NOTE_SHOW_KEY_PREFIX + noteEditParam.getId()); redisCache.delete(NoteCacheKeyConstant.NOTE_DETAIL_KEY_PREFIX + noteEditParam.getId()); throw new BizException(BizCodeEnum.NOTE_UPDATE_FAIL); finally if (locked) redisLock.unlock(noteUpdateLockKey); private void publishNoteAddedEvent(Long noteId, Long userId) noteTransactionProducer.sendTransactionMessage( NoteRocketMQConstant.NOTE_UPDATE_TOPIC, NoteMessageType.ADD_NOTE.getType(), JsonUtil.toJson(NoteUpdateMessage.builder().noteId(noteId).userId(userId).build()), null, NoteMessageType.ADD_NOTE); private void publishNoteUpdatedEvent(Long noteId, Long userId) noteTransactionProducer.sendMessage( NoteRocketMQConstant.NOTE_UPDATE_TOPIC, NoteMessageType.UPDATE_NOTE.getType(), JsonUtil.toJson(NoteUpdateMessage.builder().noteId(noteId).userId(userId).build()), NoteMessageType.UPDATE_NOTE); ç¤¾äº¤æœåŠ¡ä¼˜æƒ åˆ¸æœåŠ¡æµ‹è¯•è®¡åˆ’æµ‹è¯•èŒƒå›´æµ‹è¯•ç”¨ä¾‹æ€§èƒ½æµ‹è¯•è¿ç»´è®¡åˆ’æ—¥å¿—ç®¡ç†å¼‚å¸¸å¤„ç†å¤‡ä»½ç­–ç•¥é™„å½•æœ¯è¯­è¡¨å‚è€ƒæ–‡çŒ®å¸¸è§é—®é¢˜","tags":["Java","å•†åŸ","åˆ†å¸ƒå¼"]},{"title":"äº‘ç¯å¢ƒ","path":"/2025/03/27/äº‘ç¯å¢ƒ/","content":"åŸºäºäº¬ä¸œäº‘2c8gæœåŠ¡å™¨æ­å»º ç™»å½•å¯†ç ï¼š2+bCzUvqhhqtGivF5kUsETY 1. åˆ‡æ¢dockeré•œåƒæºsudo tee /etc/docker/daemon.json -EOF registry-mirrors: [https://c58uc66a.mirror.aliyuncs.com]EOFsudo systemctl daemon-reloadsudo systemctl restart docker 2. å®‰è£…Docker-Portainerdocker run -d --restart=always -p 9000:9000 -v /home/run/docker.sock:/var/run/docker.sock --name portainer portainer/portainer è¿æ¥æ—¶ï¼Œå¦‚æœä½ çš„è¿œç¨‹dockeræ²¡æœ‰å¼€å¯2375ç«¯å£æ˜¯è¿æ¥ä¸ä¸Šçš„ï¼Œä¸‹é¢æ˜¯é…ç½®dockerç«¯å£çš„æ–¹æ³•ï¼š 1.ç¼–è¾‘docker.servicecd /usr/lib/systemd/system/vim /usr/lib/systemd/system/docker.service# æ‰¾åˆ° ExecStartå­—æ®µä¿®æ”¹å¦‚ä¸‹ExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix://var/run/docker.sock2.é‡å¯dockeré‡æ–°è¯»å–é…ç½®æ–‡ä»¶ï¼Œé‡æ–°å¯åŠ¨dockeræœåŠ¡systemctl daemon-reloadsystemctl restart docker3.é˜²ç«å¢™è§„åˆ™æ·»åŠ 2375ç«¯å£ 3. å®‰è£…Mysql# å®‰è£…é•œåƒdocker run -d -p 3306:3306 --name mysql \\-e MYSQL_ROOT_PASSWORD=MIIEowIBAAKCAQEAwG90ULRHmAXFXQzZSwleoYts2+bCzUvqhhqtGiv/F5kUsETY \\-d mysql:latest# è¿›å…¥å®¹å™¨docker exec -it mysql /bin/bash# æ·»åŠ ç”¨æˆ·mysql -uroot -pli.ming9518create user cloud@% identified by MIIEowIBAAKCAQEAwG90ULRHmAXFXQzZSwleoYts2+bCzUvqhhqtGiv/F5kUsETY;grant all privileges on *.* to cloud@% with grant option;flush privileges; 4. å®‰è£…Redisdocker run \\-p 6379:6379 \\--name redis \\-d redis redis-server \\--appendonly yes \\--requirepass MIIEowIBAAKCAQEAwG90ULRHmAXFXQzZSwleoYts2+bCzUvqhhqtGiv/F5kUsETY 5. å®‰è£…nacos1.åˆ›å»ºæŒ‚è½½ç›®å½• mkdir -p /var/lib/docker/volumes/nacos/confmkdir -p /var/lib/docker/volumes/nacos/datamkdir -p /var/lib/docker/volumes/nacos/logschmod a+w /var/lib/docker/volumes/nacoscd /var/lib/docker/volumes/nacos/confvi application.properties 2.æ·»åŠ application.properties # springserver.servlet.contextPath=/nacosserver.contextPath=/nacosserver.port=8848# server.tomcat.accesslog.max-days=30# server.tomcat.accesslog.pattern=%h %l %u %t %r %s %b %D %User-Agenti %Request-Sourcei# server.tomcat.accesslog.enabled=false# default current work dir# server.tomcat.basedir=file:.#*************** Config Module Related Configurations ***************#### Deprecated configuration property, it is recommended to use `spring.sql.init.platform` replaced.spring.datasource.platform=mysqlspring.sql.init.platform=mysqlnacos.cmdb.dumpTaskInterval=3600nacos.cmdb.eventTaskInterval=10nacos.cmdb.labelTaskInterval=300nacos.cmdb.loadDataAtStart=falsedb.num=1# è¿™é‡Œå¿…é¡»ä¸ºå…¬ç½‘æˆ–æœåŠ¡å™¨å†…ç½‘åœ°å€ï¼Œæˆ‘è¿™é‡Œæ˜¯æœåŠ¡å™¨çš„å†…ç½‘åœ°å€ï¼Œå®¹å™¨å†…éƒ¨æ²¡æœ‰mysqlï¼Œç»å¯¹ä¸èƒ½ä½¿ç”¨ 127.0.0.1å’Œlocalhost# å¦‚æœnacoså¯åŠ¨å¤±è´¥ï¼ŒNacos Server did not start because dumpservice bean construction failure : No DataSource set# åŠ ä¸Š serverTimezone=UTC ï¼Œå†ä¸è¡Œå°±åŠ ä¸Š allowPublicKeyRetrieval=true# å°†connectTimeout å’Œ socketTimeout åˆ†åˆ«åŠ ä¸ª0ï¼Œé¿å…å‡ºç°è¶…æ—¶å¼‚å¸¸db.url.0=jdbc:mysql://116.198.217.158:3306/nacos?characterEncoding=utf8connectTimeout=10000socketTimeout=30000autoReconnect=trueuseUnicode=trueuseSSL=falsedb.user.0=clouddb.password.0=liming9518### The auth system to use, currently only nacos and ldap is supported:# é‰´æƒç±»å‹ï¼Œé»˜è®¤ä¸ºnacosnacos.core.auth.system.type=nacos# æ˜¯å¦å¼€å¯é‰´æƒåŠŸèƒ½ï¼Œé»˜è®¤ä¸ºfalsenacos.core.auth.enabled=true# Base64åŠ å¯†å‰å¯†ç  TcmxJw05k$-_zcx.)8EtFC^D^F1W!IPr# Base64åŠ å¯†åå¯†ç  VGNteEp3MDVrJC1femN4Lik4RXRGQ15EXkYxVyFJUHI=# åŠ å¯†ç½‘ç«™ï¼šhttps://www.qqxiuzi.cn/bianma/base64.htm# è‡ªå®šä¹‰å¯†é’¥ï¼Œåœ¨è‡ªå®šä¹‰å¯†é’¥æ—¶ï¼Œæ¨èå°†é…ç½®é¡¹è®¾ç½®ä¸ºBase64ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œä¸”åŸå§‹å¯†é’¥é•¿åº¦ä¸å¾—ä½äº32å­—ç¬¦ã€‚åŒnacos.core.auth.plugin.nacos.token.secret.keynacos.core.auth.default.token.secret.key=VGNteEp3MDVrJC1femN4Lik4RXRGQ15EXkYxVyFJUHI=### worked when nacos.core.auth.system.type=nacos### The token expiration in seconds:# ç”¨æˆ·ç™»é™†ä¸´æ—¶accessTokençš„è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤18000nacos.core.auth.plugin.nacos.token.expire.seconds=18000### The default token:# é»˜è®¤é‰´æƒæ’ä»¶ç”¨äºç”Ÿæˆç”¨æˆ·ç™»é™†ä¸´æ—¶accessTokenæ‰€ä½¿ç”¨çš„å¯†é’¥ï¼Œåœ¨2.2.0.1åæ— é»˜è®¤å€¼ï¼Œå¿…é¡»æ‰§è¡Œæ­¤å˜æ›´ï¼Œå¦åˆ™æ— æ³•å¯åŠ¨ï¼›å…¶ä»–ç‰ˆæœ¬ä¸ºå»ºè®®è®¾ç½®ã€‚nacos.core.auth.plugin.nacos.token.secret.key=VGNteEp3MDVrJC1femN4Lik4RXRGQ15EXkYxVyFJUHI=### Turn on/off caching of auth information. By turning on this switch, the update of auth information would have a 15 seconds delay.# nacos.core.auth.caching.enabled=$NACOS_AUTH_CACHE_ENABLE:false# å…³é—­ä½¿ç”¨user-agentåˆ¤æ–­æœåŠ¡ç«¯è¯·æ±‚å¹¶æ”¾è¡Œé‰´æƒçš„åŠŸèƒ½nacos.core.auth.enable.userAgentAuthWhite=false# ç”¨äºæ›¿æ¢useragentç™½åå•çš„èº«ä»½è¯†åˆ«keyï¼Œä¸å¯ä¸ºç©ºï¼Œ2.2.1åæ— é»˜è®¤å€¼nacos.core.auth.server.identity.key=nacosKey# ç”¨äºæ›¿æ¢useragentç™½åå•çš„èº«ä»½è¯†åˆ«valueï¼Œä¸å¯ä¸ºç©ºï¼Œ2.2.1åæ— é»˜è®¤å€¼nacos.core.auth.server.identity.value=nacosValue## spring security config### turn off securitynacos.security.ignore.urls=/,/error,/**/*.css,/**/*.js,/**/*.html,/**/*.map,/**/*.svg,/**/*.png,/**/*.ico,/console-fe/public/**,/v1/auth/**,/v1/console/health/**,/actuator/**,/v1/console/server/**# metrics for elastic searchmanagement.metrics.export.elastic.enabled=falsemanagement.metrics.export.influx.enabled=falsenacos.naming.distro.taskDispatchThreadCount=10nacos.naming.distro.taskDispatchPeriod=200nacos.naming.distro.batchSyncKeyCount=1000nacos.naming.distro.initDataRatio=0.9nacos.naming.distro.syncRetryDelay=5000nacos.naming.data.warmup=true 3.æ·»åŠ nacosç›¸å…³è¡¨ CREATE TABLE `config_info` ( `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT id, `data_id` varchar(255) NOT NULL COMMENT data_id, `group_id` varchar(128) DEFAULT NULL, `content` longtext NOT NULL COMMENT content, `md5` varchar(32) DEFAULT NULL COMMENT md5, `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT åˆ›å»ºæ—¶é—´, `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT ä¿®æ”¹æ—¶é—´, `src_user` text COMMENT source user, `src_ip` varchar(50) DEFAULT NULL COMMENT source ip, `app_name` varchar(128) DEFAULT NULL, `tenant_id` varchar(128) DEFAULT COMMENT ç§Ÿæˆ·å­—æ®µ, `c_desc` varchar(256) DEFAULT NULL, `c_use` varchar(64) DEFAULT NULL, `effect` varchar(64) DEFAULT NULL, `type` varchar(64) DEFAULT NULL, `c_schema` text, `encrypted_data_key` text NOT NULL COMMENT ç§˜é’¥, PRIMARY KEY (`id`), UNIQUE KEY `uk_configinfo_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=config_info;/******************************************//* æ•°æ®åº“å…¨å = nacos_config *//* è¡¨åç§° = config_info_aggr *//******************************************/CREATE TABLE `config_info_aggr` ( `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT id, `data_id` varchar(255) NOT NULL COMMENT data_id, `group_id` varchar(128) NOT NULL COMMENT group_id, `datum_id` varchar(255) NOT NULL COMMENT datum_id, `content` longtext NOT NULL COMMENT å†…å®¹, `gmt_modified` datetime NOT NULL COMMENT ä¿®æ”¹æ—¶é—´, `app_name` varchar(128) DEFAULT NULL, `tenant_id` varchar(128) DEFAULT COMMENT ç§Ÿæˆ·å­—æ®µ, PRIMARY KEY (`id`), UNIQUE KEY `uk_configinfoaggr_datagrouptenantdatum` (`data_id`,`group_id`,`tenant_id`,`datum_id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=å¢åŠ ç§Ÿæˆ·å­—æ®µ;/******************************************//* æ•°æ®åº“å…¨å = nacos_config *//* è¡¨åç§° = config_info_beta *//******************************************/CREATE TABLE `config_info_beta` ( `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT id, `data_id` varchar(255) NOT NULL COMMENT data_id, `group_id` varchar(128) NOT NULL COMMENT group_id, `app_name` varchar(128) DEFAULT NULL COMMENT app_name, `content` longtext NOT NULL COMMENT content, `beta_ips` varchar(1024) DEFAULT NULL COMMENT betaIps, `md5` varchar(32) DEFAULT NULL COMMENT md5, `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT åˆ›å»ºæ—¶é—´, `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT ä¿®æ”¹æ—¶é—´, `src_user` text COMMENT source user, `src_ip` varchar(50) DEFAULT NULL COMMENT source ip, `tenant_id` varchar(128) DEFAULT COMMENT ç§Ÿæˆ·å­—æ®µ, `encrypted_data_key` text NOT NULL COMMENT ç§˜é’¥, PRIMARY KEY (`id`), UNIQUE KEY `uk_configinfobeta_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=config_info_beta;/******************************************//* æ•°æ®åº“å…¨å = nacos_config *//* è¡¨åç§° = config_info_tag *//******************************************/CREATE TABLE `config_info_tag` ( `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT id, `data_id` varchar(255) NOT NULL COMMENT data_id, `group_id` varchar(128) NOT NULL COMMENT group_id, `tenant_id` varchar(128) DEFAULT COMMENT tenant_id, `tag_id` varchar(128) NOT NULL COMMENT tag_id, `app_name` varchar(128) DEFAULT NULL COMMENT app_name, `content` longtext NOT NULL COMMENT content, `md5` varchar(32) DEFAULT NULL COMMENT md5, `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT åˆ›å»ºæ—¶é—´, `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT ä¿®æ”¹æ—¶é—´, `src_user` text COMMENT source user, `src_ip` varchar(50) DEFAULT NULL COMMENT source ip, PRIMARY KEY (`id`), UNIQUE KEY `uk_configinfotag_datagrouptenanttag` (`data_id`,`group_id`,`tenant_id`,`tag_id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=config_info_tag;/******************************************//* æ•°æ®åº“å…¨å = nacos_config *//* è¡¨åç§° = config_tags_relation *//******************************************/CREATE TABLE `config_tags_relation` ( `id` bigint(20) NOT NULL COMMENT id, `tag_name` varchar(128) NOT NULL COMMENT tag_name, `tag_type` varchar(64) DEFAULT NULL COMMENT tag_type, `data_id` varchar(255) NOT NULL COMMENT data_id, `group_id` varchar(128) NOT NULL COMMENT group_id, `tenant_id` varchar(128) DEFAULT COMMENT tenant_id, `nid` bigint(20) NOT NULL AUTO_INCREMENT, PRIMARY KEY (`nid`), UNIQUE KEY `uk_configtagrelation_configidtag` (`id`,`tag_name`,`tag_type`), KEY `idx_tenant_id` (`tenant_id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=config_tag_relation;/******************************************//* æ•°æ®åº“å…¨å = nacos_config *//* è¡¨åç§° = group_capacity *//******************************************/CREATE TABLE `group_capacity` ( `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT ä¸»é”®ID, `group_id` varchar(128) NOT NULL DEFAULT COMMENT Group IDï¼Œç©ºå­—ç¬¦è¡¨ç¤ºæ•´ä¸ªé›†ç¾¤, `quota` int(10) unsigned NOT NULL DEFAULT 0 COMMENT é…é¢ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼, `usage` int(10) unsigned NOT NULL DEFAULT 0 COMMENT ä½¿ç”¨é‡, `max_size` int(10) unsigned NOT NULL DEFAULT 0 COMMENT å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼, `max_aggr_count` int(10) unsigned NOT NULL DEFAULT 0 COMMENT èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°ï¼Œï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼, `max_aggr_size` int(10) unsigned NOT NULL DEFAULT 0 COMMENT å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼, `max_history_count` int(10) unsigned NOT NULL DEFAULT 0 COMMENT æœ€å¤§å˜æ›´å†å²æ•°é‡, `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT åˆ›å»ºæ—¶é—´, `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT ä¿®æ”¹æ—¶é—´, PRIMARY KEY (`id`), UNIQUE KEY `uk_group_id` (`group_id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=é›†ç¾¤ã€å„Groupå®¹é‡ä¿¡æ¯è¡¨;/******************************************//* æ•°æ®åº“å…¨å = nacos_config *//* è¡¨åç§° = his_config_info *//******************************************/CREATE TABLE `his_config_info` ( `id` bigint(20) unsigned NOT NULL, `nid` bigint(20) unsigned NOT NULL AUTO_INCREMENT, `data_id` varchar(255) NOT NULL, `group_id` varchar(128) NOT NULL, `app_name` varchar(128) DEFAULT NULL COMMENT app_name, `content` longtext NOT NULL, `md5` varchar(32) DEFAULT NULL, `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP, `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP, `src_user` text, `src_ip` varchar(50) DEFAULT NULL, `op_type` char(10) DEFAULT NULL, `tenant_id` varchar(128) DEFAULT COMMENT ç§Ÿæˆ·å­—æ®µ, `encrypted_data_key` text NOT NULL COMMENT ç§˜é’¥, PRIMARY KEY (`nid`), KEY `idx_gmt_create` (`gmt_create`), KEY `idx_gmt_modified` (`gmt_modified`), KEY `idx_did` (`data_id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=å¤šç§Ÿæˆ·æ”¹é€ ;/******************************************//* æ•°æ®åº“å…¨å = nacos_config *//* è¡¨åç§° = tenant_capacity *//******************************************/CREATE TABLE `tenant_capacity` ( `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT ä¸»é”®ID, `tenant_id` varchar(128) NOT NULL DEFAULT COMMENT Tenant ID, `quota` int(10) unsigned NOT NULL DEFAULT 0 COMMENT é…é¢ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼, `usage` int(10) unsigned NOT NULL DEFAULT 0 COMMENT ä½¿ç”¨é‡, `max_size` int(10) unsigned NOT NULL DEFAULT 0 COMMENT å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼, `max_aggr_count` int(10) unsigned NOT NULL DEFAULT 0 COMMENT èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°, `max_aggr_size` int(10) unsigned NOT NULL DEFAULT 0 COMMENT å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼, `max_history_count` int(10) unsigned NOT NULL DEFAULT 0 COMMENT æœ€å¤§å˜æ›´å†å²æ•°é‡, `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT åˆ›å»ºæ—¶é—´, `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT ä¿®æ”¹æ—¶é—´, PRIMARY KEY (`id`), UNIQUE KEY `uk_tenant_id` (`tenant_id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=ç§Ÿæˆ·å®¹é‡ä¿¡æ¯è¡¨;CREATE TABLE `tenant_info` ( `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT id, `kp` varchar(128) NOT NULL COMMENT kp, `tenant_id` varchar(128) default COMMENT tenant_id, `tenant_name` varchar(128) default COMMENT tenant_name, `tenant_desc` varchar(256) DEFAULT NULL COMMENT tenant_desc, `create_source` varchar(32) DEFAULT NULL COMMENT create_source, `gmt_create` bigint(20) NOT NULL COMMENT åˆ›å»ºæ—¶é—´, `gmt_modified` bigint(20) NOT NULL COMMENT ä¿®æ”¹æ—¶é—´, PRIMARY KEY (`id`), UNIQUE KEY `uk_tenant_info_kptenantid` (`kp`,`tenant_id`), KEY `idx_tenant_id` (`tenant_id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=tenant_info;CREATE TABLE `users` ( `username` varchar(50) NOT NULL PRIMARY KEY, `password` varchar(500) NOT NULL, `enabled` boolean NOT NULL);CREATE TABLE `roles` ( `username` varchar(50) NOT NULL, `role` varchar(50) NOT NULL, UNIQUE INDEX `idx_user_role` (`username` ASC, `role` ASC) USING BTREE);CREATE TABLE `permissions` ( `role` varchar(50) NOT NULL, `resource` varchar(255) NOT NULL, `action` varchar(8) NOT NULL, UNIQUE INDEX `uk_role_permission` (`role`,`resource`,`action`) USING BTREE);INSERT INTO users (username, password, enabled) VALUES (nacos, $2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu, TRUE);INSERT INTO roles (username, role) VALUES (nacos, ROLE_ADMIN); 3.å¯åŠ¨nacos docker run -d --name nacos \\--ip 0.0.0.0 \\-p 8848:8848 \\-p 9848:9848 \\-p 9849:9849 \\--env MODE=standalone \\--env NACOS_AUTH_ENABLE=true \\-e JVM_XMS=256m \\-e JVM_XMX=256m acos/nacos-server 6. å®‰è£…RocketMQ æ‹‰å–é•œåƒ docker pull apache/rocketmq:4.9.4 å¯åŠ¨nameserver # å¯åŠ¨NameServerdocker run -d \\--privileged=true \\--name rmqnamesrv \\-p 9876:9876 \\-e MAX_HEAP_SIZE=256M \\-e HEAP_NEWSIZE=128M \\-e MAX_POSSIBLE_HEAP=100000000 \\apache/rocketmq sh mqnamesrv# éªŒè¯NameServeræ˜¯å¦å¯åŠ¨æˆåŠŸdocker logs -f rmqnamesrv è¿›å…¥confç›®å½•ç¼–è¾‘broker.conf # æ‰€å±é›†ç¾¤åç§°ï¼Œå¦‚æœèŠ‚ç‚¹è¾ƒå¤šå¯ä»¥é…ç½®å¤šä¸ªbrokerClusterName = DefaultCluster#brokeråç§°ï¼Œmasterå’Œslaveä½¿ç”¨ç›¸åŒçš„åç§°ï¼Œè¡¨æ˜ä»–ä»¬çš„ä¸»ä»å…³ç³»brokerName = broker-a#0è¡¨ç¤ºMasterï¼Œå¤§äº0è¡¨ç¤ºä¸åŒçš„slavebrokerId = 0#è¡¨ç¤ºå‡ ç‚¹åšæ¶ˆæ¯åˆ é™¤åŠ¨ä½œï¼Œé»˜è®¤æ˜¯å‡Œæ™¨4ç‚¹deleteWhen = 04#åœ¨ç£ç›˜ä¸Šä¿ç•™æ¶ˆæ¯çš„æ—¶é•¿ï¼Œå•ä½æ˜¯å°æ—¶fileReservedTime = 48#æœ‰ä¸‰ä¸ªå€¼ï¼šSYNC_MASTERï¼ŒASYNC_MASTERï¼ŒSLAVEï¼›åŒæ­¥å’Œå¼‚æ­¥è¡¨ç¤ºMasterå’ŒSlaveä¹‹é—´åŒæ­¥æ•°æ®çš„æœºåˆ¶ï¼›brokerRole = ASYNC_MASTER#åˆ·ç›˜ç­–ç•¥ï¼Œå–å€¼ä¸ºï¼šASYNC_FLUSHï¼ŒSYNC_FLUSHè¡¨ç¤ºåŒæ­¥åˆ·ç›˜å’Œå¼‚æ­¥åˆ·ç›˜ï¼›SYNC_FLUSHæ¶ˆæ¯å†™å…¥ç£ç›˜åæ‰è¿”å›æˆåŠŸçŠ¶æ€ï¼ŒASYNC_FLUSHä¸éœ€è¦ï¼›flushDiskType = ASYNC_FLUSH#è®¾ç½®brokerèŠ‚ç‚¹æ‰€åœ¨æœåŠ¡å™¨çš„ipåœ°å€ï¼ˆ**è¿™ä¸ªéå¸¸é‡è¦,ä¸»ä»æ¨¡å¼ä¸‹ï¼Œä»èŠ‚ç‚¹ä¼šæ ¹æ®ä¸»èŠ‚ç‚¹çš„brokerIP2æ¥åŒæ­¥æ•°æ®ï¼Œå¦‚æœä¸é…ç½®ï¼Œä¸»ä»æ— æ³•åŒæ­¥ï¼ŒbrokerIP1è®¾ç½®ä¸ºè‡ªå·±å¤–ç½‘èƒ½è®¿é—®çš„ipï¼ŒæœåŠ¡å™¨åŒç½‘å¡æƒ…å†µä¸‹å¿…é¡»é…ç½®ï¼Œæ¯”å¦‚é˜¿é‡Œäº‘è¿™ç§ï¼Œä¸»èŠ‚ç‚¹éœ€è¦é…ç½®ip1å’Œip2ï¼Œä»èŠ‚ç‚¹åªéœ€è¦é…ç½®ip1å³å¯ï¼‰brokerIP1 = 116.198.217.158#nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰²namesrvAddr=116.198.217.158:9876#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£,#listenPort = 10911#æ˜¯å¦å…è®¸Brokerè‡ªåŠ¨åˆ›å»ºTopic ä¸Šçº¿ä¸ºfalse æµ‹è¯•å¯å¼€å¯autoCreateTopicEnable = true#æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ ä¸Šçº¿ä¸ºfalse æµ‹è¯•å¯å¼€å¯autoCreateSubscriptionGroup = true#å¼€å¯é‰´æƒaclEnable=true ç¼–è¾‘ACLæƒé™é…ç½®æ–‡ä»¶plain_acl.yml accounts: - accessKey: mqadmin secretKey: MIIEowIBAAKCAQEAwG90ULRHmAXFXQzZSwleoYts2+bCzUvqhhqtGiv/F5kUsETY # if it is admin, it could access all resources admin: true å¯åŠ¨borker docker run -d --restart=always --name rocketmq-broker-a \\-p 10909:10909 -p 10911:10911 -p 10912:10912 \\-v /var/lib/docker/volumes/rocketmq/broker/logs:/root/logs \\-v /var/lib/docker/volumes/rocketmq/broker/store:/root/store \\-v /var/lib/docker/volumes/rocketmq/broker/conf/broker.conf:/home/rocketmq/rocketmq-4.9.2/conf/broker.conf \\-v /var/lib/docker/volumes/rocketmq/broker/conf/plain_acl.yml:/home/rocketmq/rocketmq-4.9.2/conf/plain_acl.yml \\-e NAMESRV_ADDR=116.198.217.158:9876 \\-e MAX_POSSIBLE_HEAP=200000000 \\-e MAX_HEAP_SIZE=512M \\-e HEAP_NEWSIZE=256M \\apache/rocketmq \\sh mqbroker -c ../conf/broker.conf# éªŒè¯ Broker æ˜¯å¦å¯åŠ¨æˆåŠŸdocker logs rmqbroker æµ‹è¯• # è¿›å…¥brokerå®¹å™¨$ docker exec -it rmqbroker bash$ sh tools.sh org.apache.rocketmq.example.quickstart.Producer SendResult [sendStatus=SEND_OK, msgId= ...$ sh tools.sh org.apache.rocketmq.example.quickstart.Consumer ConsumeMessageThread_%d Receive New Messages: [MessageExt... æ³¨æ„ å®¢æˆ·ç«¯ç‰ˆæœ¬éœ€è¦å’ŒæœåŠ¡ç«¯ç‰ˆæœ¬ä¸€è‡´ä¸ç„¶ä¼šå‡ºç°å„ç§é—®é¢˜ 7. å®‰è£…RocketMQ Dashboard#å»ºç«‹é…ç½®ç›®å½•cd /var/lib/docker/volumes/rocketmqmkdir -p console/data#æ–°å»ºusers.propertiesæ–‡ä»¶å¹¶å†™å…¥è´¦å·å¯†ç #ç”¨æˆ·åå’Œå¯†ç è§„åˆ™ã€Œç”¨æˆ·å=å¯†ç ,æƒé™ã€ï¼Œè¿™é‡Œçš„æƒé™ä¸º1è¡¨ç¤ºç®¡ç†å‘˜ï¼Œä¸º0è¡¨ç¤ºæ™®é€šç”¨æˆ·mqadmin=MIIEowIBAAKCAQEAwG90ULRHmAXFXQzZSwleoYts2+bCzUvqhhqtGiv/F5kUsETY,1docker run -d --restart=always --name rocketmq-console \\-v /var/lib/docker/volumes/rocketmq/console/data:/tmp/rocketmq-console/data \\-e JAVA_OPTS=-Drocketmq.namesrv.addr=116.198.217.158:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false -Drocketmq.config.loginRequired=true -Drocketmq.config.accessKey=mqadmin -Drocketmq.config.secretKey=MIIEowIBAAKCAQEAwG90ULRHmAXFXQzZSwleoYts2+bCzUvqhhqtGiv/F5kUsETY -p 8888:8080 apacherocketmq/rocketmq-dashboard:latestdocker exec -it rocketmq-dashboard bash 8. å®‰è£…xxl-jobCREATE database if NOT EXISTS `xxl-job` default character set utf8 collate utf8_general_ci;use `xxl-job`;CREATE TABLE XXL_JOB_QRTZ_JOB_DETAILS ( SCHED_NAME VARCHAR(120) NOT NULL, JOB_NAME VARCHAR(200) NOT NULL, JOB_GROUP VARCHAR(200) NOT NULL, DESCRIPTION VARCHAR(250) NULL, JOB_CLASS_NAME VARCHAR(250) NOT NULL, IS_DURABLE VARCHAR(1) NOT NULL, IS_NONCONCURRENT VARCHAR(1) NOT NULL, IS_UPDATE_DATA VARCHAR(1) NOT NULL, REQUESTS_RECOVERY VARCHAR(1) NOT NULL, JOB_DATA BLOB NULL, PRIMARY KEY (SCHED_NAME,JOB_NAME,JOB_GROUP));CREATE TABLE XXL_JOB_QRTZ_TRIGGERS ( SCHED_NAME VARCHAR(120) NOT NULL, TRIGGER_NAME VARCHAR(200) NOT NULL, TRIGGER_GROUP VARCHAR(200) NOT NULL, JOB_NAME VARCHAR(200) NOT NULL, JOB_GROUP VARCHAR(200) NOT NULL, DESCRIPTION VARCHAR(250) NULL, NEXT_FIRE_TIME BIGINT(13) NULL, PREV_FIRE_TIME BIGINT(13) NULL, PRIORITY INTEGER NULL, TRIGGER_STATE VARCHAR(16) NOT NULL, TRIGGER_TYPE VARCHAR(8) NOT NULL, START_TIME BIGINT(13) NOT NULL, END_TIME BIGINT(13) NULL, CALENDAR_NAME VARCHAR(200) NULL, MISFIRE_INSTR SMALLINT(2) NULL, JOB_DATA BLOB NULL, PRIMARY KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP), FOREIGN KEY (SCHED_NAME,JOB_NAME,JOB_GROUP) REFERENCES XXL_JOB_QRTZ_JOB_DETAILS(SCHED_NAME,JOB_NAME,JOB_GROUP));CREATE TABLE XXL_JOB_QRTZ_SIMPLE_TRIGGERS ( SCHED_NAME VARCHAR(120) NOT NULL, TRIGGER_NAME VARCHAR(200) NOT NULL, TRIGGER_GROUP VARCHAR(200) NOT NULL, REPEAT_COUNT BIGINT(7) NOT NULL, REPEAT_INTERVAL BIGINT(12) NOT NULL, TIMES_TRIGGERED BIGINT(10) NOT NULL, PRIMARY KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP), FOREIGN KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP) REFERENCES XXL_JOB_QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP));CREATE TABLE XXL_JOB_QRTZ_CRON_TRIGGERS ( SCHED_NAME VARCHAR(120) NOT NULL, TRIGGER_NAME VARCHAR(200) NOT NULL, TRIGGER_GROUP VARCHAR(200) NOT NULL, CRON_EXPRESSION VARCHAR(200) NOT NULL, TIME_ZONE_ID VARCHAR(80), PRIMARY KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP), FOREIGN KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP) REFERENCES XXL_JOB_QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP));CREATE TABLE XXL_JOB_QRTZ_SIMPROP_TRIGGERS ( SCHED_NAME VARCHAR(120) NOT NULL, TRIGGER_NAME VARCHAR(200) NOT NULL, TRIGGER_GROUP VARCHAR(200) NOT NULL, STR_PROP_1 VARCHAR(512) NULL, STR_PROP_2 VARCHAR(512) NULL, STR_PROP_3 VARCHAR(512) NULL, INT_PROP_1 INT NULL, INT_PROP_2 INT NULL, LONG_PROP_1 BIGINT NULL, LONG_PROP_2 BIGINT NULL, DEC_PROP_1 NUMERIC(13,4) NULL, DEC_PROP_2 NUMERIC(13,4) NULL, BOOL_PROP_1 VARCHAR(1) NULL, BOOL_PROP_2 VARCHAR(1) NULL, PRIMARY KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP), FOREIGN KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP) REFERENCES XXL_JOB_QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP));CREATE TABLE XXL_JOB_QRTZ_BLOB_TRIGGERS ( SCHED_NAME VARCHAR(120) NOT NULL, TRIGGER_NAME VARCHAR(200) NOT NULL, TRIGGER_GROUP VARCHAR(200) NOT NULL, BLOB_DATA BLOB NULL, PRIMARY KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP), FOREIGN KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP) REFERENCES XXL_JOB_QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP));CREATE TABLE XXL_JOB_QRTZ_CALENDARS ( SCHED_NAME VARCHAR(120) NOT NULL, CALENDAR_NAME VARCHAR(200) NOT NULL, CALENDAR BLOB NOT NULL, PRIMARY KEY (SCHED_NAME,CALENDAR_NAME));CREATE TABLE XXL_JOB_QRTZ_PAUSED_TRIGGER_GRPS ( SCHED_NAME VARCHAR(120) NOT NULL, TRIGGER_GROUP VARCHAR(200) NOT NULL, PRIMARY KEY (SCHED_NAME,TRIGGER_GROUP));CREATE TABLE XXL_JOB_QRTZ_FIRED_TRIGGERS ( SCHED_NAME VARCHAR(120) NOT NULL, ENTRY_ID VARCHAR(95) NOT NULL, TRIGGER_NAME VARCHAR(200) NOT NULL, TRIGGER_GROUP VARCHAR(200) NOT NULL, INSTANCE_NAME VARCHAR(200) NOT NULL, FIRED_TIME BIGINT(13) NOT NULL, SCHED_TIME BIGINT(13) NOT NULL, PRIORITY INTEGER NOT NULL, STATE VARCHAR(16) NOT NULL, JOB_NAME VARCHAR(200) NULL, JOB_GROUP VARCHAR(200) NULL, IS_NONCONCURRENT VARCHAR(1) NULL, REQUESTS_RECOVERY VARCHAR(1) NULL, PRIMARY KEY (SCHED_NAME,ENTRY_ID));CREATE TABLE XXL_JOB_QRTZ_SCHEDULER_STATE ( SCHED_NAME VARCHAR(120) NOT NULL, INSTANCE_NAME VARCHAR(200) NOT NULL, LAST_CHECKIN_TIME BIGINT(13) NOT NULL, CHECKIN_INTERVAL BIGINT(13) NOT NULL, PRIMARY KEY (SCHED_NAME,INSTANCE_NAME));CREATE TABLE XXL_JOB_QRTZ_LOCKS ( SCHED_NAME VARCHAR(120) NOT NULL, LOCK_NAME VARCHAR(40) NOT NULL, PRIMARY KEY (SCHED_NAME,LOCK_NAME));CREATE TABLE `XXL_JOB_QRTZ_TRIGGER_INFO` ( `id` int(11) NOT NULL AUTO_INCREMENT, `job_group` int(11) NOT NULL COMMENT æ‰§è¡Œå™¨ä¸»é”®ID, `job_cron` varchar(128) NOT NULL COMMENT ä»»åŠ¡æ‰§è¡ŒCRON, `job_desc` varchar(255) NOT NULL, `add_time` datetime DEFAULT NULL, `update_time` datetime DEFAULT NULL, `author` varchar(64) DEFAULT NULL COMMENT ä½œè€…, `alarm_email` varchar(255) DEFAULT NULL COMMENT æŠ¥è­¦é‚®ä»¶, `executor_route_strategy` varchar(50) DEFAULT NULL COMMENT æ‰§è¡Œå™¨è·¯ç”±ç­–ç•¥, `executor_handler` varchar(255) DEFAULT NULL COMMENT æ‰§è¡Œå™¨ä»»åŠ¡handler, `executor_param` varchar(512) DEFAULT NULL COMMENT æ‰§è¡Œå™¨ä»»åŠ¡å‚æ•°, `executor_block_strategy` varchar(50) DEFAULT NULL COMMENT é˜»å¡å¤„ç†ç­–ç•¥, `executor_timeout` int(11) NOT NULL DEFAULT 0 COMMENT ä»»åŠ¡æ‰§è¡Œè¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’, `executor_fail_retry_count` int(11) NOT NULL DEFAULT 0 COMMENT å¤±è´¥é‡è¯•æ¬¡æ•°, `glue_type` varchar(50) NOT NULL COMMENT GLUEç±»å‹, `glue_source` mediumtext COMMENT GLUEæºä»£ç , `glue_remark` varchar(128) DEFAULT NULL COMMENT GLUEå¤‡æ³¨, `glue_updatetime` datetime DEFAULT NULL COMMENT GLUEæ›´æ–°æ—¶é—´, `child_jobid` varchar(255) DEFAULT NULL COMMENT å­ä»»åŠ¡IDï¼Œå¤šä¸ªé€—å·åˆ†éš”, PRIMARY KEY (`id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8;CREATE TABLE `XXL_JOB_QRTZ_TRIGGER_LOG` ( `id` int(11) NOT NULL AUTO_INCREMENT, `job_group` int(11) NOT NULL COMMENT æ‰§è¡Œå™¨ä¸»é”®ID, `job_id` int(11) NOT NULL COMMENT ä»»åŠ¡ï¼Œä¸»é”®ID, `executor_address` varchar(255) DEFAULT NULL COMMENT æ‰§è¡Œå™¨åœ°å€ï¼Œæœ¬æ¬¡æ‰§è¡Œçš„åœ°å€, `executor_handler` varchar(255) DEFAULT NULL COMMENT æ‰§è¡Œå™¨ä»»åŠ¡handler, `executor_param` varchar(512) DEFAULT NULL COMMENT æ‰§è¡Œå™¨ä»»åŠ¡å‚æ•°, `executor_sharding_param` varchar(20) DEFAULT NULL COMMENT æ‰§è¡Œå™¨ä»»åŠ¡åˆ†ç‰‡å‚æ•°ï¼Œæ ¼å¼å¦‚ 1/2, `executor_fail_retry_count` int(11) NOT NULL DEFAULT 0 COMMENT å¤±è´¥é‡è¯•æ¬¡æ•°, `trigger_time` datetime DEFAULT NULL COMMENT è°ƒåº¦-æ—¶é—´, `trigger_code` int(11) NOT NULL COMMENT è°ƒåº¦-ç»“æœ, `trigger_msg` text COMMENT è°ƒåº¦-æ—¥å¿—, `handle_time` datetime DEFAULT NULL COMMENT æ‰§è¡Œ-æ—¶é—´, `handle_code` int(11) NOT NULL COMMENT æ‰§è¡Œ-çŠ¶æ€, `handle_msg` text COMMENT æ‰§è¡Œ-æ—¥å¿—, PRIMARY KEY (`id`), KEY `I_trigger_time` (`trigger_time`)) ENGINE=InnoDB DEFAULT CHARSET=utf8;CREATE TABLE `XXL_JOB_QRTZ_TRIGGER_LOGGLUE` ( `id` int(11) NOT NULL AUTO_INCREMENT, `job_id` int(11) NOT NULL COMMENT ä»»åŠ¡ï¼Œä¸»é”®ID, `glue_type` varchar(50) DEFAULT NULL COMMENT GLUEç±»å‹, `glue_source` mediumtext COMMENT GLUEæºä»£ç , `glue_remark` varchar(128) NOT NULL COMMENT GLUEå¤‡æ³¨, `add_time` timestamp NULL DEFAULT NULL, `update_time` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP, PRIMARY KEY (`id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8;CREATE TABLE XXL_JOB_QRTZ_TRIGGER_REGISTRY ( `id` int(11) NOT NULL AUTO_INCREMENT, `registry_group` varchar(255) NOT NULL, `registry_key` varchar(255) NOT NULL, `registry_value` varchar(255) NOT NULL, `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP, PRIMARY KEY (`id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8;CREATE TABLE `XXL_JOB_QRTZ_TRIGGER_GROUP` ( `id` int(11) NOT NULL AUTO_INCREMENT, `app_name` varchar(64) NOT NULL COMMENT æ‰§è¡Œå™¨AppName, `title` varchar(12) NOT NULL COMMENT æ‰§è¡Œå™¨åç§°, `order` tinyint(4) NOT NULL DEFAULT 0 COMMENT æ’åº, `address_type` tinyint(4) NOT NULL DEFAULT 0 COMMENT æ‰§è¡Œå™¨åœ°å€ç±»å‹ï¼š0=è‡ªåŠ¨æ³¨å†Œã€1=æ‰‹åŠ¨å½•å…¥, `address_list` varchar(512) DEFAULT NULL COMMENT æ‰§è¡Œå™¨åœ°å€åˆ—è¡¨ï¼Œå¤šåœ°å€é€—å·åˆ†éš”, PRIMARY KEY (`id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8;INSERT INTO `XXL_JOB_QRTZ_TRIGGER_GROUP` ( `app_name`, `title`, `order`, `address_type`, `address_list`) values ( xxl-job-executor-sample, ç¤ºä¾‹æ‰§è¡Œå™¨, 1, 0, null);commit; docker run -e PARAMS=--spring.datasource.url=jdbc:mysql://116.198.217.158:3306/xxl_job?useUnicode=truecharacterEncoding=UTF-8autoReconnect=trueserverTimezone=Asia/Shanghai --spring.datasource.username=cloud --spring.datasource.password=li.ming9518 \\-p 9999:8080 --name xxl-job-admin -d 116.198.217.158:5000/xxl-job-admin:2.4.1 docker exec -it xxl-job-admin bashcd /usr/local/tomcat/webapps/xxl-job-admin/WEB-INF/classesapt-get install vim MIIEowIBAAKCAQEAwG 9. docker composeversion: 3.8services: mysql: image: mysql:8.0 container_name: mysql environment: MYSQL_ROOT_PASSWORD: strong_root_password ports: - 3306:3306 volumes: - mysql_data:/var/lib/mysql networks: - backend deploy: resources: limits: cpus: 2 memory: 2G restart: always redis: image: redis:6.2 container_name: redis ports: - 6379:6379 volumes: - redis_data:/data networks: - backend deploy: resources: limits: cpus: 1 memory: 2G restart: always nacos: image: nacos/nacos-server:2.2.0 container_name: nacos environment: MODE: standalone SPRING_DATASOURCE_PLATFORM: mysql MYSQL_SERVICE_HOST: mysql MYSQL_SERVICE_PORT: 3306 MYSQL_SERVICE_DB_NAME: nacos_config MYSQL_SERVICE_USER: root MYSQL_SERVICE_PASSWORD: strong_root_password ports: - 8848:8848 - 9848:9848 networks: - backend volumes: - nacos_logs:/home/nacos/logs - nacos_data:/home/nacos/data deploy: resources: limits: cpus: 2 memory: 2G restart: always rocketmq: image: apache/rocketmq:4.9.4 container_name: rocketmq ports: - 9876:9876 networks: - backend volumes: - rocketmq_logs:/root/logs - rocketmq_store:/root/store deploy: resources: limits: cpus: 2 memory: 2G restart: always rocketmq-broker: image: apache/rocketmq:4.9.4 container_name: rocketmq-broker depends_on: - rocketmq environment: - NAMESRV_ADDR=rocketmq:9876 ports: - 10911:10911 - 10912:10912 - 10909:10909 networks: - backend volumes: - rocketmq_broker_logs:/root/logs - rocketmq_broker_store:/root/store deploy: resources: limits: cpus: 2 memory: 2G restart: always xxl-job: image: xuxueli/xxl-job-admin:2.3.0 container_name: xxl-job environment: XXL_JOB_DB_USERNAME: root XXL_JOB_DB_PASSWORD: strong_root_password XXL_JOB_DB_PORT: 3306 XXL_JOB_DB_URL: jdbc:mysql://mysql:3306/xxl_job?characterEncoding=UTF-8useSSL=true ports: - 8080:8080 networks: - backend deploy: resources: limits: cpus: 1 memory: 1G restart: always elasticsearch: image: docker.elastic.co/elasticsearch/elasticsearch:7.17.0 container_name: elasticsearch environment: discovery.type: single-node ES_JAVA_OPTS: -Xms1g -Xmx1g ports: - 9200:9200 - 9300:9300 volumes: - es_data:/usr/share/elasticsearch/data networks: - backend deploy: resources: limits: cpus: 4 memory: 4G restart: always kibana: image: docker.elastic.co/kibana/kibana:7.17.0 container_name: kibana ports: - 5601:5601 networks: - backend depends_on: - elasticsearch deploy: resources: limits: cpus: 1 memory: 2G restart: always logstash: image: docker.elastic.co/logstash/logstash:7.17.0 container_name: logstash ports: - 5044:5044 - 9600:9600 volumes: - ./logstash.conf:/usr/share/logstash/pipeline/logstash.conf:ro networks: - backend depends_on: - elasticsearch deploy: resources: limits: cpus: 2 memory: 2G restart: always skywalking-oap: image: apache/skywalking-oap-server:9.0.0 container_name: skywalking-oap environment: SW_STORAGE: elasticsearch SW_STORAGE_ES_CLUSTER_NODES: elasticsearch:9200 SW_HEALTH_CHECKER: default ports: - 12800:12800 - 11800:11800 networks: - backend depends_on: - elasticsearch deploy: resources: limits: cpus: 2 memory: 4G restart: always skywalking-ui: image: apache/skywalking-ui:9.0.0 container_name: skywalking-ui ports: - 8088:8080 networks: - backend depends_on: - skywalking-oap deploy: resources: limits: cpus: 1 memory: 2G restart: always nginx: image: nginx:latest container_name: nginx ports: - 80:80 - 443:443 volumes: - ./nginx.conf:/etc/nginx/nginx.conf:ro - ./nginx_logs:/var/log/nginx networks: - backend - frontend # å¯ä»¥ä¸ºå‰ç«¯åº”ç”¨æä¾›æœåŠ¡ restart: always deploy: resources: limits: cpus: 1 memory: 512M prometheus: image: prom/prometheus:latest container_name: prometheus ports: - 9090:9090 volumes: - ./prometheus.yml:/etc/prometheus/prometheus.yml:ro - prometheus_data:/prometheus networks: - monitoring - backend restart: always deploy: resources: limits: cpus: 2 memory: 2G grafana: image: grafana/grafana:latest container_name: grafana ports: - 3000:3000 volumes: - grafana_data:/var/lib/grafana environment: - GF_SECURITY_ADMIN_PASSWORD=strong_grafana_password networks: - monitoring depends_on: - prometheus restart: always deploy: resources: limits: cpus: 1 memory: 1Gvolumes: mysql_data: redis_data: nacos_logs: nacos_data: rocketmq_logs: rocketmq_store: rocketmq_broker_logs: rocketmq_broker_store: es_data: nginx_logs: prometheus_data: grafana_data:networks: backend: driver: bridge frontend: driver: bridge monitoring: driver: bridge å®‰è£…weaviatedocker run â€“name weaviate-dev -d -p 8080:8080 -p 50051:50051 -e AUTHENTICATION_ANONYMOUS_ACCESS_ENABLEDâ€™trueâ€™ semitechnologiesweaviate:1.30.0 10. ç¯å¢ƒæ­å»º ä¿®æ”¹yumæº http://mirrors.aliyun.com/repo/Centos-7.repocd /etc/yum.repos.dcp CentOS-Base.repo CentOS-Base.repo.bakmv Centos-7.repo CentOS-Base.repoyum clean all yum makecacheyum -y update å®‰è£…docker æ·»åŠ é•œåƒæº docker run \\ --rm \\ -u root \\ -p 8080:8080 \\ -v jenkins-data:/var/jenkins_home \\ -v /var/run/docker.sock:/var/run/docker.sock \\ -v $HOME:/home \\ -restart: always \\ jenkins:2.60.3"},{"title":"xxl-jobåŸºç¡€","path":"/2025/03/25/xxl-job/","content":"XXL-JOBç®€ä»‹æ¦‚è¿°XXL-JOB æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°ï¼Œå…¶æ ¸å¿ƒè®¾è®¡ç›®æ ‡æ˜¯å¼€å‘è¿…é€Ÿã€å­¦ä¹ ç®€å•ã€è½»é‡çº§ã€æ˜“æ‰©å±•ã€‚ç°å·²å¼€æ”¾æºä»£ç å¹¶æ¥å…¥å¤šå®¶å…¬å¸çº¿ä¸Šäº§å“çº¿ï¼Œå¼€ç®±å³ç”¨ã€‚ ç‰¹æ€§ 1ã€ç®€å•ï¼šæ”¯æŒé€šè¿‡ Web é¡µé¢å¯¹ä»»åŠ¡è¿›è¡Œ CRUD æ“ä½œï¼Œæ“ä½œç®€å•ï¼Œä¸€åˆ†é’Ÿä¸Šæ‰‹ï¼› 2ã€åŠ¨æ€ï¼šæ”¯æŒåŠ¨æ€ä¿®æ”¹ä»»åŠ¡çŠ¶æ€ã€å¯åŠ¨åœæ­¢ä»»åŠ¡ï¼Œä»¥åŠç»ˆæ­¢è¿è¡Œä¸­ä»»åŠ¡ï¼Œå³æ—¶ç”Ÿæ•ˆï¼› 3ã€è°ƒåº¦ä¸­å¿ƒ HAï¼ˆä¸­å¿ƒå¼ï¼‰ï¼šè°ƒåº¦é‡‡ç”¨ä¸­å¿ƒå¼è®¾è®¡ï¼Œâ€œè°ƒåº¦ä¸­å¿ƒâ€è‡ªç ”è°ƒåº¦ç»„ä»¶å¹¶æ”¯æŒé›†ç¾¤éƒ¨ç½²ï¼Œå¯ä¿è¯è°ƒåº¦ä¸­å¿ƒ HAï¼› 4ã€æ‰§è¡Œå™¨ HAï¼ˆåˆ†å¸ƒå¼ï¼‰ï¼šä»»åŠ¡åˆ†å¸ƒå¼æ‰§è¡Œï¼Œä»»åŠ¡â€æ‰§è¡Œå™¨â€æ”¯æŒé›†ç¾¤éƒ¨ç½²ï¼Œå¯ä¿è¯ä»»åŠ¡æ‰§è¡Œ HAï¼› 5ã€æ³¨å†Œä¸­å¿ƒ: æ‰§è¡Œå™¨ä¼šå‘¨æœŸæ€§è‡ªåŠ¨æ³¨å†Œä»»åŠ¡, è°ƒåº¦ä¸­å¿ƒå°†ä¼šè‡ªåŠ¨å‘ç°æ³¨å†Œçš„ä»»åŠ¡å¹¶è§¦å‘æ‰§è¡Œã€‚åŒæ—¶ï¼Œä¹Ÿæ”¯æŒæ‰‹åŠ¨å½•å…¥æ‰§è¡Œå™¨åœ°å€ï¼› 6ã€å¼¹æ€§æ‰©å®¹ç¼©å®¹ï¼šä¸€æ—¦æœ‰æ–°æ‰§è¡Œå™¨æœºå™¨ä¸Šçº¿æˆ–è€…ä¸‹çº¿ï¼Œä¸‹æ¬¡è°ƒåº¦æ—¶å°†ä¼šé‡æ–°åˆ†é…ä»»åŠ¡ï¼› 7ã€è§¦å‘ç­–ç•¥ï¼šæä¾›ä¸°å¯Œçš„ä»»åŠ¡è§¦å‘ç­–ç•¥ï¼ŒåŒ…æ‹¬ï¼šCron è§¦å‘ã€å›ºå®šé—´éš”è§¦å‘ã€å›ºå®šå»¶æ—¶è§¦å‘ã€APIï¼ˆäº‹ä»¶ï¼‰è§¦å‘ã€äººå·¥è§¦å‘ã€çˆ¶å­ä»»åŠ¡è§¦å‘ï¼› 8ã€è°ƒåº¦è¿‡æœŸç­–ç•¥ï¼šè°ƒåº¦ä¸­å¿ƒé”™è¿‡è°ƒåº¦æ—¶é—´çš„è¡¥å¿å¤„ç†ç­–ç•¥ï¼ŒåŒ…æ‹¬ï¼šå¿½ç•¥ã€ç«‹å³è¡¥å¿è§¦å‘ä¸€æ¬¡ç­‰ï¼› 9ã€é˜»å¡å¤„ç†ç­–ç•¥ï¼šè°ƒåº¦è¿‡äºå¯†é›†æ‰§è¡Œå™¨æ¥ä¸åŠå¤„ç†æ—¶çš„å¤„ç†ç­–ç•¥ï¼Œç­–ç•¥åŒ…æ‹¬ï¼šå•æœºä¸²è¡Œï¼ˆé»˜è®¤ï¼‰ã€ä¸¢å¼ƒåç»­è°ƒåº¦ã€è¦†ç›–ä¹‹å‰è°ƒåº¦ï¼› 10ã€ä»»åŠ¡è¶…æ—¶æ§åˆ¶ï¼šæ”¯æŒè‡ªå®šä¹‰ä»»åŠ¡è¶…æ—¶æ—¶é—´ï¼Œä»»åŠ¡è¿è¡Œè¶…æ—¶å°†ä¼šä¸»åŠ¨ä¸­æ–­ä»»åŠ¡ï¼› 11ã€ä»»åŠ¡å¤±è´¥é‡è¯•ï¼šæ”¯æŒè‡ªå®šä¹‰ä»»åŠ¡å¤±è´¥é‡è¯•æ¬¡æ•°ï¼Œå½“ä»»åŠ¡å¤±è´¥æ—¶å°†ä¼šæŒ‰ç…§é¢„è®¾çš„å¤±è´¥é‡è¯•æ¬¡æ•°ä¸»åŠ¨è¿›è¡Œé‡è¯•ï¼›å…¶ä¸­åˆ†ç‰‡ä»»åŠ¡æ”¯æŒåˆ†ç‰‡ç²’åº¦çš„å¤±è´¥é‡è¯•ï¼› 12ã€ä»»åŠ¡å¤±è´¥å‘Šè­¦ï¼›é»˜è®¤æä¾›é‚®ä»¶æ–¹å¼å¤±è´¥å‘Šè­¦ï¼ŒåŒæ—¶é¢„ç•™æ‰©å±•æ¥å£ï¼Œå¯æ–¹ä¾¿çš„æ‰©å±•çŸ­ä¿¡ã€é’‰é’‰ç­‰å‘Šè­¦æ–¹å¼ï¼› 13ã€è·¯ç”±ç­–ç•¥ï¼šæ‰§è¡Œå™¨é›†ç¾¤éƒ¨ç½²æ—¶æä¾›ä¸°å¯Œçš„è·¯ç”±ç­–ç•¥ï¼ŒåŒ…æ‹¬ï¼šç¬¬ä¸€ä¸ªã€æœ€åä¸€ä¸ªã€è½®è¯¢ã€éšæœºã€ä¸€è‡´æ€§ HASHã€æœ€ä¸ç»å¸¸ä½¿ç”¨ã€æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ã€æ•…éšœè½¬ç§»ã€å¿™ç¢Œè½¬ç§»ç­‰ï¼› 14ã€åˆ†ç‰‡å¹¿æ’­ä»»åŠ¡ï¼šæ‰§è¡Œå™¨é›†ç¾¤éƒ¨ç½²æ—¶ï¼Œä»»åŠ¡è·¯ç”±ç­–ç•¥é€‰æ‹©â€åˆ†ç‰‡å¹¿æ’­â€æƒ…å†µä¸‹ï¼Œä¸€æ¬¡ä»»åŠ¡è°ƒåº¦å°†ä¼šå¹¿æ’­è§¦å‘é›†ç¾¤ä¸­æ‰€æœ‰æ‰§è¡Œå™¨æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ï¼Œå¯æ ¹æ®åˆ†ç‰‡å‚æ•°å¼€å‘åˆ†ç‰‡ä»»åŠ¡ï¼› 15ã€åŠ¨æ€åˆ†ç‰‡ï¼šåˆ†ç‰‡å¹¿æ’­ä»»åŠ¡ä»¥æ‰§è¡Œå™¨ä¸ºç»´åº¦è¿›è¡Œåˆ†ç‰‡ï¼Œæ”¯æŒåŠ¨æ€æ‰©å®¹æ‰§è¡Œå™¨é›†ç¾¤ä»è€ŒåŠ¨æ€å¢åŠ åˆ†ç‰‡æ•°é‡ï¼ŒååŒè¿›è¡Œä¸šåŠ¡å¤„ç†ï¼›åœ¨è¿›è¡Œå¤§æ•°æ®é‡ä¸šåŠ¡æ“ä½œæ—¶å¯æ˜¾è‘—æå‡ä»»åŠ¡å¤„ç†èƒ½åŠ›å’Œé€Ÿåº¦ã€‚ 16ã€æ•…éšœè½¬ç§»ï¼šä»»åŠ¡è·¯ç”±ç­–ç•¥é€‰æ‹©â€æ•…éšœè½¬ç§»â€æƒ…å†µä¸‹ï¼Œå¦‚æœæ‰§è¡Œå™¨é›†ç¾¤ä¸­æŸä¸€å°æœºå™¨æ•…éšœï¼Œå°†ä¼šè‡ªåŠ¨ Failover åˆ‡æ¢åˆ°ä¸€å°æ­£å¸¸çš„æ‰§è¡Œå™¨å‘é€è°ƒåº¦è¯·æ±‚ã€‚ 17ã€ä»»åŠ¡è¿›åº¦ç›‘æ§ï¼šæ”¯æŒå®æ—¶ç›‘æ§ä»»åŠ¡è¿›åº¦ï¼› 18ã€Rolling å®æ—¶æ—¥å¿—ï¼šæ”¯æŒåœ¨çº¿æŸ¥çœ‹è°ƒåº¦ç»“æœï¼Œå¹¶ä¸”æ”¯æŒä»¥ Rolling æ–¹å¼å®æ—¶æŸ¥çœ‹æ‰§è¡Œå™¨è¾“å‡ºçš„å®Œæ•´çš„æ‰§è¡Œæ—¥å¿—ï¼› 19ã€GLUEï¼šæä¾› Web IDEï¼Œæ”¯æŒåœ¨çº¿å¼€å‘ä»»åŠ¡é€»è¾‘ä»£ç ï¼ŒåŠ¨æ€å‘å¸ƒï¼Œå®æ—¶ç¼–è¯‘ç”Ÿæ•ˆï¼Œçœç•¥éƒ¨ç½²ä¸Šçº¿çš„è¿‡ç¨‹ã€‚æ”¯æŒ 30 ä¸ªç‰ˆæœ¬çš„å†å²ç‰ˆæœ¬å›æº¯ã€‚ 20ã€è„šæœ¬ä»»åŠ¡ï¼šæ”¯æŒä»¥ GLUE æ¨¡å¼å¼€å‘å’Œè¿è¡Œè„šæœ¬ä»»åŠ¡ï¼ŒåŒ…æ‹¬ Shellã€Pythonã€NodeJSã€PHPã€PowerShell ç­‰ç±»å‹è„šæœ¬; 21ã€å‘½ä»¤è¡Œä»»åŠ¡ï¼šåŸç”Ÿæä¾›é€šç”¨å‘½ä»¤è¡Œä»»åŠ¡ Handlerï¼ˆBean ä»»åŠ¡ï¼Œâ€CommandJobHandlerâ€ï¼‰ï¼›ä¸šåŠ¡æ–¹åªéœ€è¦æä¾›å‘½ä»¤è¡Œå³å¯ï¼› 22ã€ä»»åŠ¡ä¾èµ–ï¼šæ”¯æŒé…ç½®å­ä»»åŠ¡ä¾èµ–ï¼Œå½“çˆ¶ä»»åŠ¡æ‰§è¡Œç»“æŸä¸”æ‰§è¡ŒæˆåŠŸåå°†ä¼šä¸»åŠ¨è§¦å‘ä¸€æ¬¡å­ä»»åŠ¡çš„æ‰§è¡Œ, å¤šä¸ªå­ä»»åŠ¡ç”¨é€—å·åˆ†éš”ï¼› 23ã€ä¸€è‡´æ€§ï¼šâ€œè°ƒåº¦ä¸­å¿ƒâ€é€šè¿‡ DB é”ä¿è¯é›†ç¾¤åˆ†å¸ƒå¼è°ƒåº¦çš„ä¸€è‡´æ€§, ä¸€æ¬¡ä»»åŠ¡è°ƒåº¦åªä¼šè§¦å‘ä¸€æ¬¡æ‰§è¡Œï¼› 24ã€è‡ªå®šä¹‰ä»»åŠ¡å‚æ•°ï¼šæ”¯æŒåœ¨çº¿é…ç½®è°ƒåº¦ä»»åŠ¡å…¥å‚ï¼Œå³æ—¶ç”Ÿæ•ˆï¼› 25ã€è°ƒåº¦çº¿ç¨‹æ± ï¼šè°ƒåº¦ç³»ç»Ÿå¤šçº¿ç¨‹è§¦å‘è°ƒåº¦è¿è¡Œï¼Œç¡®ä¿è°ƒåº¦ç²¾ç¡®æ‰§è¡Œï¼Œä¸è¢«å µå¡ï¼› 26ã€æ•°æ®åŠ å¯†ï¼šè°ƒåº¦ä¸­å¿ƒå’Œæ‰§è¡Œå™¨ä¹‹é—´çš„é€šè®¯è¿›è¡Œæ•°æ®åŠ å¯†ï¼Œæå‡è°ƒåº¦ä¿¡æ¯å®‰å…¨æ€§ï¼› 27ã€é‚®ä»¶æŠ¥è­¦ï¼šä»»åŠ¡å¤±è´¥æ—¶æ”¯æŒé‚®ä»¶æŠ¥è­¦ï¼Œæ”¯æŒé…ç½®å¤šé‚®ä»¶åœ°å€ç¾¤å‘æŠ¥è­¦é‚®ä»¶ï¼› 28ã€æ¨é€ maven ä¸­å¤®ä»“åº“: å°†ä¼šæŠŠæœ€æ–°ç¨³å®šç‰ˆæ¨é€åˆ° maven ä¸­å¤®ä»“åº“, æ–¹ä¾¿ç”¨æˆ·æ¥å…¥å’Œä½¿ç”¨; 29ã€è¿è¡ŒæŠ¥è¡¨ï¼šæ”¯æŒå®æ—¶æŸ¥çœ‹è¿è¡Œæ•°æ®ï¼Œå¦‚ä»»åŠ¡æ•°é‡ã€è°ƒåº¦æ¬¡æ•°ã€æ‰§è¡Œå™¨æ•°é‡ç­‰ï¼›ä»¥åŠè°ƒåº¦æŠ¥è¡¨ï¼Œå¦‚è°ƒåº¦æ—¥æœŸåˆ†å¸ƒå›¾ï¼Œè°ƒåº¦æˆåŠŸåˆ†å¸ƒå›¾ç­‰ï¼› 30ã€å…¨å¼‚æ­¥ï¼šä»»åŠ¡è°ƒåº¦æµç¨‹å…¨å¼‚æ­¥åŒ–è®¾è®¡å®ç°ï¼Œå¦‚å¼‚æ­¥è°ƒåº¦ã€å¼‚æ­¥è¿è¡Œã€å¼‚æ­¥å›è°ƒç­‰ï¼Œæœ‰æ•ˆå¯¹å¯†é›†è°ƒåº¦è¿›è¡Œæµé‡å‰Šå³°ï¼Œç†è®ºä¸Šæ”¯æŒä»»æ„æ—¶é•¿ä»»åŠ¡çš„è¿è¡Œï¼› 31ã€è·¨è¯­è¨€OpenAPIï¼šè°ƒåº¦ä¸­å¿ƒä¸æ‰§è¡Œå™¨æä¾›è¯­è¨€æ— å…³çš„ OpenApiï¼ˆRESTful æ ¼å¼ï¼‰ï¼Œç¬¬ä¸‰æ–¹ä»»æ„è¯­è¨€å¯æ®æ­¤å¯¹æ¥è°ƒåº¦ä¸­å¿ƒæˆ–è€…å®ç°æ‰§è¡Œå™¨ï¼Œå®ç°å¤šè¯­è¨€æ”¯æŒã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æä¾›äº† â€œå¤šä»»åŠ¡æ¨¡å¼â€å’Œâ€œhttpJobHandlerâ€ç­‰å…¶ä»–è·¨è¯­è¨€æ–¹æ¡ˆï¼› 32ã€å›½é™…åŒ–ï¼šè°ƒåº¦ä¸­å¿ƒæ”¯æŒå›½é™…åŒ–è®¾ç½®ï¼Œæä¾›ä¸­æ–‡ã€è‹±æ–‡ä¸¤ç§å¯é€‰è¯­è¨€ï¼Œé»˜è®¤ä¸ºä¸­æ–‡ï¼› 33ã€å®¹å™¨åŒ–ï¼šæä¾›å®˜æ–¹ docker é•œåƒï¼Œå¹¶å®æ—¶æ›´æ–°æ¨é€ dockerhubï¼Œè¿›ä¸€æ­¥å®ç°äº§å“å¼€ç®±å³ç”¨ï¼› 34ã€çº¿ç¨‹æ± éš”ç¦»ï¼šè°ƒåº¦çº¿ç¨‹æ± è¿›è¡Œéš”ç¦»æ‹†åˆ†ï¼Œæ…¢ä»»åŠ¡è‡ªåŠ¨é™çº§è¿›å…¥â€Slowâ€çº¿ç¨‹æ± ï¼Œé¿å…è€—å°½è°ƒåº¦çº¿ç¨‹ï¼Œæé«˜ç³»ç»Ÿç¨³å®šæ€§ï¼› 35ã€ç”¨æˆ·ç®¡ç†ï¼šæ”¯æŒåœ¨çº¿ç®¡ç†ç³»ç»Ÿç”¨æˆ·ï¼Œå­˜åœ¨ç®¡ç†å‘˜ã€æ™®é€šç”¨æˆ·ä¸¤ç§è§’è‰²ï¼› 36ã€æƒé™æ§åˆ¶ï¼šæ‰§è¡Œå™¨ç»´åº¦è¿›è¡Œæƒé™æ§åˆ¶ï¼Œç®¡ç†å‘˜æ‹¥æœ‰å…¨é‡æƒé™ï¼Œæ™®é€šç”¨æˆ·éœ€è¦åˆ†é…æ‰§è¡Œå™¨æƒé™åæ‰å…è®¸ç›¸å…³æ“ä½œï¼› å®‰è£…æºç éƒ¨ç½²ä¸‹è½½åœ°å€ https://github.com/xuxueli/xxl-job/releases ç¯å¢ƒè¦æ±‚ Maven3+ Jdk17+ (è¯´æ˜ï¼šç‰ˆæœ¬ 3.x å¼€å§‹è¦æ±‚ Jdk17ï¼›ç‰ˆæœ¬ 2.x åŠä»¥ä¸‹æ”¯æŒ Jdk1.8ã€‚å¦‚å¯¹ Jdk ç‰ˆæœ¬æœ‰è¯‰æ±‚ï¼Œå¯é€‰æ‹©æ¥å…¥ä¸åŒç‰ˆæœ¬ã€‚) Mysql8.0+ åˆå§‹åŒ–æ•°æ®åº“ xxl-jobdocdbtables_xxl_job.SQL éƒ¨ç½² xxl-job-adminè°ƒåº¦ä¸­å¿ƒé…ç½®æ–‡ä»¶è¯´æ˜ï¼š ### è°ƒåº¦ä¸­å¿ƒJDBCé“¾æ¥spring.datasource.url=jdbc:mysql://127.0.0.1:3306/xxl_job?useUnicode=truecharacterEncoding=UTF-8autoReconnect=trueserverTimezone=Asia/Shanghaispring.datasource.username=rootspring.datasource.password=root_pwdspring.datasource.driver-class-name=com.mysql.jdbc.Driver### æŠ¥è­¦é‚®ç®±spring.mail.host=smtp.qq.comspring.mail.port=25spring.mail.username=xxx@qq.comspring.mail.password=xxxspring.mail.properties.mail.smtp.auth=truespring.mail.properties.mail.smtp.starttls.enable=truespring.mail.properties.mail.smtp.starttls.required=truespring.mail.properties.mail.smtp.socketFactory.class=javax.net.ssl.SSLSocketFactory### è°ƒåº¦ä¸­å¿ƒé€šè®¯TOKEN [é€‰å¡«]ï¼šéç©ºæ—¶å¯ç”¨ï¼›xxl.job.accessToken=### è°ƒåº¦ä¸­å¿ƒé€šè®¯è¶…æ—¶æ—¶é—´[é€‰å¡«]ï¼Œå•ä½ç§’ï¼›é»˜è®¤3sï¼›xxl.job.timeout=3### è°ƒåº¦ä¸­å¿ƒå›½é™…åŒ–é…ç½® [å¿…å¡«]ï¼š é»˜è®¤ä¸º zh_CN/ä¸­æ–‡ç®€ä½“, å¯é€‰èŒƒå›´ä¸º zh_CN/ä¸­æ–‡ç®€ä½“, zh_TC/ä¸­æ–‡ç¹ä½“ and en/è‹±æ–‡ï¼›xxl.job.i18n=zh_CN## è°ƒåº¦çº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹é…ç½®ã€å¿…å¡«ã€‘xxl.job.triggerpool.fast.max=200xxl.job.triggerpool.slow.max=100### è°ƒåº¦ä¸­å¿ƒæ—¥å¿—è¡¨æ•°æ®ä¿å­˜å¤©æ•° [å¿…å¡«]ï¼šè¿‡æœŸæ—¥å¿—è‡ªåŠ¨æ¸…ç†ï¼›é™åˆ¶å¤§äºç­‰äº7æ—¶ç”Ÿæ•ˆï¼Œå¦åˆ™, å¦‚-1ï¼Œå…³é—­è‡ªåŠ¨æ¸…ç†åŠŸèƒ½ï¼›xxl.job.logretentiondays=30 http://localhost: 8080xxl-job-admin é»˜è®¤ç™»é™†è´¦å·å¯†ç ï¼šadmin123456 docker å®‰è£…ä¸‹è½½é•œåƒ#Dockeråœ°å€ï¼šhttps://hub.docker.com/r/xuxueli/xxl-job-admin/ (å»ºè®®æŒ‡å®šç‰ˆæœ¬å·)docker pull xuxueli/xxl-job-admin è¿è¡Œé•œåƒ#å¦‚éœ€è‡ªå®šä¹‰ mysql ç­‰é…ç½®ï¼Œå¯é€šè¿‡ -e PARAMS æŒ‡å®šï¼Œå‚æ•°æ ¼å¼ PARAMS=--key=value --key2=value2 ï¼›#é…ç½®é¡¹å‚è€ƒæ–‡ä»¶ï¼š/xxl-job/xxl-job-admin/src/main/resources/application.properties#å¦‚éœ€è‡ªå®šä¹‰ JVMå†…å­˜å‚æ•° ç­‰é…ç½®ï¼Œå¯é€šè¿‡ -e JAVA_OPTS æŒ‡å®šï¼Œå‚æ•°æ ¼å¼ JAVA_OPTS=-Xmx512m ï¼›# IPä½¿ç”¨å®¿ä¸»æœºIPdocker run -e PARAMS=--spring.datasource.url=jdbc:mysql://10.211.55.2:3306/xxl_job?useUnicode=truecharacterEncoding=UTF-8autoReconnect=trueserverTimezone=Asia/Shanghai --spring.datasource.password=123456 --spring.datasource.username=root -p 8080:8080 -v /tmp:/data/applogs --name xxl-job-admin -d xuxueli/xxl-job-admin:3.2.0 æ‰§è¡Œå™¨éƒ¨ç½²æ–°å»ºé¡¹ç›® pom.xml ?xml version=1.0 encoding=UTF-8?project xmlns=http://maven.apache.org/POM/4.0.0 xmlns:xsi=http://www.w3.org/2001/XMLSchema-instance xsi:schemaLocation=http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd modelVersion4.0.0/modelVersion groupIdexample.java.xxl-job/groupId artifactIdexample_xxl-job/artifactId version1.0-SNAPSHOT/version properties maven.compiler.source17/maven.compiler.source maven.compiler.target17/maven.compiler.target project.build.sourceEncodingUTF-8/project.build.sourceEncoding /properties dependencyManagement dependencies dependency !-- Import dependency management from Spring Boot (ä¾èµ–ç®¡ç†ï¼šç»§æ‰¿ä¸€äº›é»˜è®¤çš„ä¾èµ–ï¼Œå·¥ç¨‹éœ€è¦ä¾èµ–çš„jaråŒ…çš„ç®¡ç†ï¼Œç”³æ˜å…¶ä»–dependencyçš„æ—¶å€™å°±ä¸éœ€è¦version) -- groupIdorg.springframework.boot/groupId artifactIdspring-boot-starter-parent/artifactId version3.2.4/version typepom/type scopeimport/scope /dependency /dependencies /dependencyManagement dependencies !-- http://repo1.maven.org/maven2/com/xuxueli/xxl-job-core/ -- dependency groupIdcom.xuxueli/groupId artifactIdxxl-job-core/artifactId version3.0.0/version /dependency dependency groupIdorg.springframework.boot/groupId artifactIdspring-boot-starter-web/artifactId /dependency dependency groupIdorg.projectlombok/groupId artifactIdlombok/artifactId version1.18.34/version /dependency /dependencies/project srcmainresourcesapplication.properties # web portserver.port=8081# no web#spring.main.web-environment=false# log configlogging.config=classpath:logback.xml### xxl-job admin address list, such as http://address or http://address01,http://address02xxl.job.admin.addresses=http://127.0.0.1:8080/xxl-job-admin### xxl-job, access tokenxxl.job.admin.accessToken=default_token### xxl-job timeout by second, default 3sxxl.job.admin.timeout=3### xxl-job executor appnamexxl.job.executor.appname=xxl-job-executor-example### xxl-job executor registry-address: default use address to registry , otherwise use ip:port if address is nullxxl.job.executor.address=### xxl-job executor server-infoxxl.job.executor.ip=xxl.job.executor.port=9998### xxl-job executor log-pathxxl.job.executor.logpath=/data/applogs/xxl-job/jobhandler### xxl-job executor log-retention-daysxxl.job.executor.logretentiondays=30 srcmainresourceslogback.xml ?xml version=1.0 encoding=UTF-8?configuration debug=false scan=true scanPeriod=1 seconds contextNamelogback/contextName property name=log.path value=/data/applogs/xxl-job/xxl-job-executor-sample-springboot.log/ appender name=console class=ch.qos.logback.core.ConsoleAppender encoder pattern%dHH:mm:ss.SSS %contextName [%thread] %-5level %logger36 - %msg%n/pattern /encoder /appender appender name=file class=ch.qos.logback.core.rolling.RollingFileAppender file$log.path/file rollingPolicy class=ch.qos.logback.core.rolling.TimeBasedRollingPolicy fileNamePattern$log.path.%dyyyy-MM-dd.zip/fileNamePattern /rollingPolicy encoder pattern%date %level [%thread] %logger36 [%file : %line] %msg%n /pattern /encoder /appender root level=info appender-ref ref=console/ appender-ref ref=file/ /root/configuration æ‰§è¡Œå™¨é…ç½® srcmainJavaexampleJavaxxljobconfigXxlJobConfig.Java package example.java.xxljob.config;import com.xxl.job.core.executor.impl.XxlJobSpringExecutor;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.beans.factory.annotation.Value;import org.springframework.context.annotation.Bean;import org.springframework.stereotype.Component;/** * * * @author lianyutian * @since 2025/3/25 * @version 1.0 */@Componentpublic class XxlJobConfig private Logger logger = LoggerFactory.getLogger(XxlJobConfig.class); @Value($xxl.job.admin.addresses) private String adminAddresses; @Value($xxl.job.admin.accessToken) private String accessToken; @Value($xxl.job.admin.timeout) private int timeout; @Value($xxl.job.executor.appname) private String appname; @Value($xxl.job.executor.address) private String address; @Value($xxl.job.executor.ip) private String ip; @Value($xxl.job.executor.port) private int port; @Value($xxl.job.executor.logpath) private String logPath; @Value($xxl.job.executor.logretentiondays) private int logRetentionDays; @Bean public XxlJobSpringExecutor xxlJobExecutor() logger.info( xxl-job config init.); XxlJobSpringExecutor xxlJobSpringExecutor = new XxlJobSpringExecutor(); xxlJobSpringExecutor.setAdminAddresses(adminAddresses); xxlJobSpringExecutor.setAppname(appname); xxlJobSpringExecutor.setAddress(address); xxlJobSpringExecutor.setIp(ip); xxlJobSpringExecutor.setPort(port); xxlJobSpringExecutor.setAccessToken(accessToken); xxlJobSpringExecutor.setTimeout(timeout); xxlJobSpringExecutor.setLogPath(logPath); xxlJobSpringExecutor.setLogRetentionDays(logRetentionDays); return xxlJobSpringExecutor; /** * é’ˆå¯¹å¤šç½‘å¡ã€å®¹å™¨å†…éƒ¨ç½²ç­‰æƒ…å†µï¼Œå¯å€ŸåŠ© spring-cloud-commons æä¾›çš„ InetUtils ç»„ä»¶çµæ´»å®šåˆ¶æ³¨å†ŒIPï¼› * * 1ã€å¼•å…¥ä¾èµ–ï¼š * dependency * groupIdorg.springframework.cloud/groupId * artifactIdspring-cloud-commons/artifactId * version$version/version * /dependency * * 2ã€é…ç½®æ–‡ä»¶ï¼Œæˆ–è€…å®¹å™¨å¯åŠ¨å˜é‡ * spring.cloud.inetutils.preferred-networks: xxx.xxx.xxx. * * 3ã€è·å–IP * String ip_ = inetUtils.findFirstNonLoopbackHostInfo().getIpAddress(); */ æ·»åŠ æ‰§è¡Œå™¨åœ¨è°ƒåº¦ç•Œé¢æ‰‹åŠ¨æ–°å¢æ‰§è¡Œå™¨ã€‚ æ‰§è¡Œå™¨å±æ€§è¯´æ˜ï¼š AppName: æ˜¯æ¯ä¸ªæ‰§è¡Œå™¨é›†ç¾¤çš„å”¯ä¸€æ ‡ç¤ºAppName, æ‰§è¡Œå™¨ä¼šå‘¨æœŸæ€§ä»¥AppNameä¸ºå¯¹è±¡è¿›è¡Œè‡ªåŠ¨æ³¨å†Œã€‚å¯é€šè¿‡è¯¥é…ç½®è‡ªåŠ¨å‘ç°æ³¨å†ŒæˆåŠŸçš„æ‰§è¡Œå™¨, ä¾›ä»»åŠ¡è°ƒåº¦æ—¶ä½¿ç”¨;åç§°: æ‰§è¡Œå™¨çš„åç§°, å› ä¸ºAppNameé™åˆ¶å­—æ¯æ•°å­—ç­‰ç»„æˆ,å¯è¯»æ€§ä¸å¼º, åç§°ä¸ºäº†æé«˜æ‰§è¡Œå™¨çš„å¯è¯»æ€§;æ’åº: æ‰§è¡Œå™¨çš„æ’åº, ç³»ç»Ÿä¸­éœ€è¦æ‰§è¡Œå™¨çš„åœ°æ–¹,å¦‚ä»»åŠ¡æ–°å¢, å°†ä¼šæŒ‰ç…§è¯¥æ’åºè¯»å–å¯ç”¨çš„æ‰§è¡Œå™¨åˆ—è¡¨;æ³¨å†Œæ–¹å¼ï¼šè°ƒåº¦ä¸­å¿ƒè·å–æ‰§è¡Œå™¨åœ°å€çš„æ–¹å¼ï¼› è‡ªåŠ¨æ³¨å†Œï¼šæ‰§è¡Œå™¨è‡ªåŠ¨è¿›è¡Œæ‰§è¡Œå™¨æ³¨å†Œï¼Œè°ƒåº¦ä¸­å¿ƒé€šè¿‡åº•å±‚æ³¨å†Œè¡¨å¯ä»¥åŠ¨æ€å‘ç°æ‰§è¡Œå™¨æœºå™¨åœ°å€ï¼› æ‰‹åŠ¨å½•å…¥ï¼šäººå·¥æ‰‹åŠ¨å½•å…¥æ‰§è¡Œå™¨çš„åœ°å€ä¿¡æ¯ï¼Œå¤šåœ°å€é€—å·åˆ†éš”ï¼Œä¾›è°ƒåº¦ä¸­å¿ƒä½¿ç”¨ï¼›æœºå™¨åœ°å€ï¼šæ³¨å†Œæ–¹å¼ä¸ºæ‰‹åŠ¨å½•å…¥æ—¶æœ‰æ•ˆï¼Œæ”¯æŒäººå·¥ç»´æŠ¤æ‰§è¡Œå™¨çš„åœ°å€ä¿¡æ¯ï¼›æ³¨å†Œåœ°å€æ ¼å¼å¯å‚è€ƒâ€œhttp://127.0.0.1:9999/â€ï¼Œä¸ºæ‰§è¡Œå™¨å†…åµŒæœåŠ¡åœ°å€ï¼› å¯åŠ¨æ‰§è¡Œå™¨æœåŠ¡å¯ä»¥æŸ¥çœ‹åˆ°æ‰§è¡Œå™¨æœåŠ¡æ³¨å†ŒæˆåŠŸã€‚ ä»»åŠ¡ç®¡ç†GLUE æ¨¡å¼(Java)æ–°å»ºä»»åŠ¡ ä»»åŠ¡å¼€å‘ç‚¹å‡»ä»»åŠ¡å³ä¾§ GLUE IDE æŒ‰é’®ï¼Œè¿›å…¥ GLUE ç¼–è¾‘å™¨å¼€å‘ç•Œé¢ ï¼Œè§ä¸‹å›¾ã€‚GLUE æ¨¡å¼(Java) è¿è¡Œæ¨¡å¼çš„ä»»åŠ¡é»˜è®¤å·²ç»åˆå§‹åŒ–äº†ç¤ºä¾‹ä»»åŠ¡ä»£ç ï¼Œå³æ‰“å° Hello Worldã€‚ ä»»åŠ¡æ‰§è¡Œç‚¹å‡»ä»»åŠ¡å³ä¾§ æ‰§è¡Œä¸€æ¬¡ æŒ‰é’®ï¼Œå¯æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡ä»»åŠ¡æ‰§è¡Œã€‚ é…ç½®äº† Cron è¡¨è¾¾å¼çš„ä»»åŠ¡ ç‚¹å‡» å¯åŠ¨ æ—¶ä¼šæ ¹æ® Cron è¡¨è¾¾å¼è‡ªåŠ¨æ‰§è¡Œã€‚ è°ƒåº¦æ—¥å¿—ç‚¹å‡»ä»»åŠ¡å³ä¾§ æ—¥å¿— æŒ‰é’®ï¼Œå¯å‰å¾€ä»»åŠ¡æ—¥å¿—ç•Œé¢æŸ¥çœ‹ä»»åŠ¡æ—¥å¿—ã€‚ åœ¨ä»»åŠ¡æ—¥å¿—ç•Œé¢ä¸­ï¼Œå¯æŸ¥çœ‹è¯¥ä»»åŠ¡çš„å†å²è°ƒåº¦è®°å½•ä»¥åŠæ¯ä¸€æ¬¡è°ƒåº¦çš„ä»»åŠ¡è°ƒåº¦ä¿¡æ¯ã€æ‰§è¡Œå‚æ•°å’Œæ‰§è¡Œä¿¡æ¯ã€‚è¿è¡Œä¸­çš„ä»»åŠ¡ç‚¹å‡»å³ä¾§çš„ æ‰§è¡Œæ—¥å¿— æŒ‰é’®ï¼Œå¯è¿›å…¥æ—¥å¿—æ§åˆ¶å°æŸ¥çœ‹å®æ—¶æ‰§è¡Œæ—¥å¿—ã€‚ ä»»åŠ¡é…ç½®å±æ€§è¯´æ˜åŸºç¡€é…ç½®ï¼š - æ‰§è¡Œå™¨ï¼šä»»åŠ¡çš„ç»‘å®šçš„æ‰§è¡Œå™¨ï¼Œä»»åŠ¡è§¦å‘è°ƒåº¦æ—¶å°†ä¼šè‡ªåŠ¨å‘ç°æ³¨å†ŒæˆåŠŸçš„æ‰§è¡Œå™¨, å®ç°ä»»åŠ¡è‡ªåŠ¨å‘ç°åŠŸèƒ½; å¦ä¸€æ–¹é¢ä¹Ÿå¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œä»»åŠ¡åˆ†ç»„ã€‚æ¯ä¸ªä»»åŠ¡å¿…é¡»ç»‘å®šä¸€ä¸ªæ‰§è¡Œå™¨, å¯åœ¨ æ‰§è¡Œå™¨ç®¡ç† è¿›è¡Œè®¾ç½®; - ä»»åŠ¡æè¿°ï¼šä»»åŠ¡çš„æè¿°ä¿¡æ¯ï¼Œä¾¿äºä»»åŠ¡ç®¡ç†ï¼› - è´Ÿè´£äººï¼šä»»åŠ¡çš„è´Ÿè´£äººï¼› - æŠ¥è­¦é‚®ä»¶ï¼šä»»åŠ¡è°ƒåº¦å¤±è´¥æ—¶é‚®ä»¶é€šçŸ¥çš„é‚®ç®±åœ°å€ï¼Œæ”¯æŒé…ç½®å¤šé‚®ç®±åœ°å€ï¼Œé…ç½®å¤šä¸ªé‚®ç®±åœ°å€æ—¶ç”¨é€—å·åˆ†éš”ï¼›è§¦å‘é…ç½®ï¼š - è°ƒåº¦ç±»å‹ï¼š æ— ï¼šè¯¥ç±»å‹ä¸ä¼šä¸»åŠ¨è§¦å‘è°ƒåº¦ï¼› CRONï¼šè¯¥ç±»å‹å°†ä¼šé€šè¿‡CRONï¼Œè§¦å‘ä»»åŠ¡è°ƒåº¦ï¼› å›ºå®šé€Ÿåº¦ï¼šè¯¥ç±»å‹å°†ä¼šä»¥å›ºå®šé€Ÿåº¦ï¼Œè§¦å‘ä»»åŠ¡è°ƒåº¦ï¼›æŒ‰ç…§å›ºå®šçš„é—´éš”æ—¶é—´ï¼Œå‘¨æœŸæ€§è§¦å‘ï¼› å›ºå®šå»¶è¿Ÿï¼šè¯¥ç±»å‹å°†ä¼šä»¥å›ºå®šå»¶è¿Ÿï¼Œè§¦å‘ä»»åŠ¡è°ƒåº¦ï¼›æŒ‰ç…§å›ºå®šçš„å»¶è¿Ÿæ—¶é—´ï¼Œä»ä¸Šæ¬¡è°ƒåº¦ç»“æŸåå¼€å§‹è®¡ç®—å»¶è¿Ÿæ—¶é—´ï¼Œåˆ°è¾¾å»¶è¿Ÿæ—¶é—´åè§¦å‘ä¸‹æ¬¡è°ƒåº¦ï¼› - CRONï¼šè§¦å‘ä»»åŠ¡æ‰§è¡Œçš„Cronè¡¨è¾¾å¼ï¼› - å›ºå®šé€Ÿåº¦ï¼šå›ºå®šé€Ÿåº¦çš„æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºç§’ï¼› - å›ºå®šå»¶è¿Ÿï¼šå›ºå®šå»¶è¿Ÿçš„æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºç§’ï¼›ä»»åŠ¡é…ç½®ï¼š - è¿è¡Œæ¨¡å¼ï¼š BEANæ¨¡å¼ï¼šä»»åŠ¡ä»¥JobHandleræ–¹å¼ç»´æŠ¤åœ¨æ‰§è¡Œå™¨ç«¯ï¼›éœ€è¦ç»“åˆ JobHandler å±æ€§åŒ¹é…æ‰§è¡Œå™¨ä¸­ä»»åŠ¡ï¼› GLUEæ¨¡å¼(Java)ï¼šä»»åŠ¡ä»¥æºç æ–¹å¼ç»´æŠ¤åœ¨è°ƒåº¦ä¸­å¿ƒï¼›è¯¥æ¨¡å¼çš„ä»»åŠ¡å®é™…ä¸Šæ˜¯ä¸€æ®µç»§æ‰¿è‡ªIJobHandlerçš„Javaç±»ä»£ç å¹¶ groovy æºç æ–¹å¼ç»´æŠ¤ï¼Œå®ƒåœ¨æ‰§è¡Œå™¨é¡¹ç›®ä¸­è¿è¡Œï¼Œå¯ä½¿ç”¨@Resource/@Autowireæ³¨å…¥æ‰§è¡Œå™¨é‡Œä¸­çš„å…¶ä»–æœåŠ¡ï¼› GLUEæ¨¡å¼(Shell)ï¼šä»»åŠ¡ä»¥æºç æ–¹å¼ç»´æŠ¤åœ¨è°ƒåº¦ä¸­å¿ƒï¼›è¯¥æ¨¡å¼çš„ä»»åŠ¡å®é™…ä¸Šæ˜¯ä¸€æ®µ shell è„šæœ¬ï¼› GLUEæ¨¡å¼(Python)ï¼šä»»åŠ¡ä»¥æºç æ–¹å¼ç»´æŠ¤åœ¨è°ƒåº¦ä¸­å¿ƒï¼›è¯¥æ¨¡å¼çš„ä»»åŠ¡å®é™…ä¸Šæ˜¯ä¸€æ®µ python è„šæœ¬ï¼› GLUEæ¨¡å¼(PHP)ï¼šä»»åŠ¡ä»¥æºç æ–¹å¼ç»´æŠ¤åœ¨è°ƒåº¦ä¸­å¿ƒï¼›è¯¥æ¨¡å¼çš„ä»»åŠ¡å®é™…ä¸Šæ˜¯ä¸€æ®µ php è„šæœ¬ï¼› GLUEæ¨¡å¼(NodeJS)ï¼šä»»åŠ¡ä»¥æºç æ–¹å¼ç»´æŠ¤åœ¨è°ƒåº¦ä¸­å¿ƒï¼›è¯¥æ¨¡å¼çš„ä»»åŠ¡å®é™…ä¸Šæ˜¯ä¸€æ®µ nodejs è„šæœ¬ï¼› GLUEæ¨¡å¼(PowerShell)ï¼šä»»åŠ¡ä»¥æºç æ–¹å¼ç»´æŠ¤åœ¨è°ƒåº¦ä¸­å¿ƒï¼›è¯¥æ¨¡å¼çš„ä»»åŠ¡å®é™…ä¸Šæ˜¯ä¸€æ®µ PowerShell è„šæœ¬ï¼› - JobHandlerï¼šè¿è¡Œæ¨¡å¼ä¸º BEANæ¨¡å¼ æ—¶ç”Ÿæ•ˆï¼Œå¯¹åº”æ‰§è¡Œå™¨ä¸­æ–°å¼€å‘çš„JobHandlerç±»â€œ@XxlJobâ€æ³¨è§£è‡ªå®šä¹‰çš„valueå€¼ï¼› - æ‰§è¡Œå‚æ•°ï¼šä»»åŠ¡æ‰§è¡Œæ‰€éœ€çš„å‚æ•°ï¼› é«˜çº§é…ç½®ï¼š - è·¯ç”±ç­–ç•¥ï¼šå½“æ‰§è¡Œå™¨é›†ç¾¤éƒ¨ç½²æ—¶ï¼Œæä¾›ä¸°å¯Œçš„è·¯ç”±ç­–ç•¥ï¼ŒåŒ…æ‹¬ï¼› FIRSTï¼ˆç¬¬ä¸€ä¸ªï¼‰ï¼šå›ºå®šé€‰æ‹©ç¬¬ä¸€ä¸ªæœºå™¨ï¼› LASTï¼ˆæœ€åä¸€ä¸ªï¼‰ï¼šå›ºå®šé€‰æ‹©æœ€åä¸€ä¸ªæœºå™¨ï¼› ROUNDï¼ˆè½®è¯¢ï¼‰ï¼šï¼› RANDOMï¼ˆéšæœºï¼‰ï¼šéšæœºé€‰æ‹©åœ¨çº¿çš„æœºå™¨ï¼› CONSISTENT_HASHï¼ˆä¸€è‡´æ€§HASHï¼‰ï¼šæ¯ä¸ªä»»åŠ¡æŒ‰ç…§Hashç®—æ³•å›ºå®šé€‰æ‹©æŸä¸€å°æœºå™¨ï¼Œä¸”æ‰€æœ‰ä»»åŠ¡å‡åŒ€æ•£åˆ—åœ¨ä¸åŒæœºå™¨ä¸Šã€‚ LEAST_FREQUENTLY_USEDï¼ˆæœ€ä¸ç»å¸¸ä½¿ç”¨ï¼‰ï¼šä½¿ç”¨é¢‘ç‡æœ€ä½çš„æœºå™¨ä¼˜å…ˆè¢«é€‰ä¸¾ï¼› LEAST_RECENTLY_USEDï¼ˆæœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ï¼‰ï¼šæœ€ä¹…æœªä½¿ç”¨çš„æœºå™¨ä¼˜å…ˆè¢«é€‰ä¸¾ï¼› FAILOVERï¼ˆæ•…éšœè½¬ç§»ï¼‰ï¼šæŒ‰ç…§é¡ºåºä¾æ¬¡è¿›è¡Œå¿ƒè·³æ£€æµ‹ï¼Œç¬¬ä¸€ä¸ªå¿ƒè·³æ£€æµ‹æˆåŠŸçš„æœºå™¨é€‰å®šä¸ºç›®æ ‡æ‰§è¡Œå™¨å¹¶å‘èµ·è°ƒåº¦ï¼› BUSYOVERï¼ˆå¿™ç¢Œè½¬ç§»ï¼‰ï¼šæŒ‰ç…§é¡ºåºä¾æ¬¡è¿›è¡Œç©ºé—²æ£€æµ‹ï¼Œç¬¬ä¸€ä¸ªç©ºé—²æ£€æµ‹æˆåŠŸçš„æœºå™¨é€‰å®šä¸ºç›®æ ‡æ‰§è¡Œå™¨å¹¶å‘èµ·è°ƒåº¦ï¼› SHARDING_BROADCAST(åˆ†ç‰‡å¹¿æ’­)ï¼šå¹¿æ’­è§¦å‘å¯¹åº”é›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ï¼ŒåŒæ—¶ç³»ç»Ÿè‡ªåŠ¨ä¼ é€’åˆ†ç‰‡å‚æ•°ï¼›å¯æ ¹æ®åˆ†ç‰‡å‚æ•°å¼€å‘åˆ†ç‰‡ä»»åŠ¡ï¼› - å­ä»»åŠ¡ï¼šæ¯ä¸ªä»»åŠ¡éƒ½æ‹¥æœ‰ä¸€ä¸ªå”¯ä¸€çš„ä»»åŠ¡ID(ä»»åŠ¡IDå¯ä»¥ä»ä»»åŠ¡åˆ—è¡¨è·å–)ï¼Œå½“æœ¬ä»»åŠ¡æ‰§è¡Œç»“æŸå¹¶ä¸”æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œå°†ä¼šè§¦å‘å­ä»»åŠ¡IDæ‰€å¯¹åº”çš„ä»»åŠ¡çš„ä¸€æ¬¡ä¸»åŠ¨è°ƒåº¦ã€‚ - è°ƒåº¦è¿‡æœŸç­–ç•¥ï¼š - å¿½ç•¥ï¼šè°ƒåº¦è¿‡æœŸåï¼Œå¿½ç•¥è¿‡æœŸçš„ä»»åŠ¡ï¼Œä»å½“å‰æ—¶é—´å¼€å§‹é‡æ–°è®¡ç®—ä¸‹æ¬¡è§¦å‘æ—¶é—´ï¼› - ç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼šè°ƒåº¦è¿‡æœŸåï¼Œç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä»å½“å‰æ—¶é—´å¼€å§‹é‡æ–°è®¡ç®—ä¸‹æ¬¡è§¦å‘æ—¶é—´ï¼› - é˜»å¡å¤„ç†ç­–ç•¥ï¼šè°ƒåº¦è¿‡äºå¯†é›†æ‰§è¡Œå™¨æ¥ä¸åŠå¤„ç†æ—¶çš„å¤„ç†ç­–ç•¥ï¼› å•æœºä¸²è¡Œï¼ˆé»˜è®¤ï¼‰ï¼šè°ƒåº¦è¯·æ±‚è¿›å…¥å•æœºæ‰§è¡Œå™¨åï¼Œè°ƒåº¦è¯·æ±‚è¿›å…¥FIFOé˜Ÿåˆ—å¹¶ä»¥ä¸²è¡Œæ–¹å¼è¿è¡Œï¼› ä¸¢å¼ƒåç»­è°ƒåº¦ï¼šè°ƒåº¦è¯·æ±‚è¿›å…¥å•æœºæ‰§è¡Œå™¨åï¼Œå‘ç°æ‰§è¡Œå™¨å­˜åœ¨è¿è¡Œçš„è°ƒåº¦ä»»åŠ¡ï¼Œæœ¬æ¬¡è¯·æ±‚å°†ä¼šè¢«ä¸¢å¼ƒå¹¶æ ‡è®°ä¸ºå¤±è´¥ï¼› è¦†ç›–ä¹‹å‰è°ƒåº¦ï¼šè°ƒåº¦è¯·æ±‚è¿›å…¥å•æœºæ‰§è¡Œå™¨åï¼Œå‘ç°æ‰§è¡Œå™¨å­˜åœ¨è¿è¡Œçš„è°ƒåº¦ä»»åŠ¡ï¼Œå°†ä¼šç»ˆæ­¢è¿è¡Œä¸­çš„è°ƒåº¦ä»»åŠ¡å¹¶æ¸…ç©ºé˜Ÿåˆ—ï¼Œç„¶åè¿è¡Œæœ¬åœ°è°ƒåº¦ä»»åŠ¡ï¼› - ä»»åŠ¡è¶…æ—¶æ—¶é—´ï¼šæ”¯æŒè‡ªå®šä¹‰ä»»åŠ¡è¶…æ—¶æ—¶é—´ï¼Œä»»åŠ¡è¿è¡Œè¶…æ—¶å°†ä¼šä¸»åŠ¨ä¸­æ–­ä»»åŠ¡ï¼› - å¤±è´¥é‡è¯•æ¬¡æ•°ï¼›æ”¯æŒè‡ªå®šä¹‰ä»»åŠ¡å¤±è´¥é‡è¯•æ¬¡æ•°ï¼Œå½“ä»»åŠ¡å¤±è´¥æ—¶å°†ä¼šæŒ‰ç…§é¢„è®¾çš„å¤±è´¥é‡è¯•æ¬¡æ•°ä¸»åŠ¨è¿›è¡Œé‡è¯•ï¼› è°ƒåº¦æ—¥å¿—å±æ€§è¯´æ˜è°ƒåº¦æ—¶é—´ï¼šè°ƒåº¦ä¸­å¿ƒè§¦å‘æœ¬æ¬¡è°ƒåº¦å¹¶å‘æ‰§è¡Œå™¨å‘é€ä»»åŠ¡æ‰§è¡Œä¿¡å·çš„æ—¶é—´ï¼›è°ƒåº¦ç»“æœï¼šè°ƒåº¦ä¸­å¿ƒè§¦å‘æœ¬æ¬¡è°ƒåº¦çš„ç»“æœï¼Œ200è¡¨ç¤ºæˆåŠŸï¼Œ500æˆ–å…¶ä»–è¡¨ç¤ºå¤±è´¥ï¼›è°ƒåº¦å¤‡æ³¨ï¼šè°ƒåº¦ä¸­å¿ƒè§¦å‘æœ¬æ¬¡è°ƒåº¦çš„æ—¥å¿—ä¿¡æ¯ï¼›æ‰§è¡Œå™¨åœ°å€ï¼šæœ¬æ¬¡ä»»åŠ¡æ‰§è¡Œçš„æœºå™¨åœ°å€è¿è¡Œæ¨¡å¼ï¼šè§¦å‘è°ƒåº¦æ—¶ä»»åŠ¡çš„è¿è¡Œæ¨¡å¼ï¼Œè¿è¡Œæ¨¡å¼å¯å‚è€ƒç« èŠ‚ ä¸‰ã€ä»»åŠ¡è¯¦è§£ï¼›ä»»åŠ¡å‚æ•°ï¼šæœ¬åœ°ä»»åŠ¡æ‰§è¡Œçš„å…¥å‚æ‰§è¡Œæ—¶é—´ï¼šæ‰§è¡Œå™¨ä¸­æœ¬æ¬¡ä»»åŠ¡æ‰§è¡Œç»“æŸåå›è°ƒçš„æ—¶é—´ï¼›æ‰§è¡Œç»“æœï¼šæ‰§è¡Œå™¨ä¸­æœ¬æ¬¡ä»»åŠ¡æ‰§è¡Œçš„ç»“æœï¼Œ200è¡¨ç¤ºæˆåŠŸï¼Œ500æˆ–å…¶ä»–è¡¨ç¤ºå¤±è´¥ï¼›æ‰§è¡Œå¤‡æ³¨ï¼šæ‰§è¡Œå™¨ä¸­æœ¬æ¬¡ä»»åŠ¡æ‰§è¡Œçš„æ—¥å¿—ä¿¡æ¯ï¼›æ“ä½œï¼š æ‰§è¡Œæ—¥å¿—æŒ‰é’®ï¼šç‚¹å‡»å¯æŸ¥çœ‹æœ¬åœ°ä»»åŠ¡æ‰§è¡Œçš„è¯¦ç»†æ—¥å¿—ä¿¡æ¯ï¼›è¯¦è§â€œ4.8 æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—â€ï¼› ç»ˆæ­¢ä»»åŠ¡æŒ‰é’®ï¼šç‚¹å‡»å¯ç»ˆæ­¢æœ¬åœ°è°ƒåº¦å¯¹åº”æ‰§è¡Œå™¨ä¸Šæœ¬ä»»åŠ¡çš„æ‰§è¡Œçº¿ç¨‹ï¼ŒåŒ…æ‹¬æœªæ‰§è¡Œçš„é˜»å¡ä»»åŠ¡ä¸€å¹¶è¢«ç»ˆæ­¢ï¼› Bean æ¨¡å¼ï¼ˆç±»å½¢å¼ï¼‰Bean æ¨¡å¼ä»»åŠ¡ï¼Œæ”¯æŒåŸºäºç±»çš„å¼€å‘æ–¹å¼ï¼Œæ¯ä¸ªä»»åŠ¡å¯¹åº”ä¸€ä¸ª Java ç±»ã€‚ ä¼˜ç‚¹ï¼šä¸é™åˆ¶é¡¹ç›®ç¯å¢ƒï¼Œå…¼å®¹æ€§å¥½ã€‚å³ä½¿æ˜¯æ— æ¡†æ¶é¡¹ç›®ï¼Œå¦‚ main æ–¹æ³•ç›´æ¥å¯åŠ¨çš„é¡¹ç›®ä¹Ÿå¯ä»¥æä¾›æ”¯æŒã€‚ ç¼ºç‚¹ï¼š æ¯ä¸ªä»»åŠ¡éœ€è¦å ç”¨ä¸€ä¸ª Java ç±»ï¼Œé€ æˆç±»çš„æµªè´¹ï¼› ä¸æ”¯æŒè‡ªåŠ¨æ‰«æä»»åŠ¡å¹¶æ³¨å…¥åˆ°æ‰§è¡Œå™¨å®¹å™¨ï¼Œéœ€è¦æ‰‹åŠ¨æ³¨å…¥ã€‚ æ–°å»ºæ‰§è¡Œå™¨ pom.xml ?xml version=1.0 encoding=UTF-8?project xmlns=http://maven.apache.org/POM/4.0.0 xmlns:xsi=http://www.w3.org/2001/XMLSchema-instance xsi:schemaLocation=http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd modelVersion4.0.0/modelVersion parent groupIdexample.java.xxl-job/groupId artifactIdexample_xxl-job/artifactId version1.0-SNAPSHOT/version /parent artifactIdexample_xxl-job_single/artifactId properties maven.compiler.source17/maven.compiler.source maven.compiler.target17/maven.compiler.target project.build.sourceEncodingUTF-8/project.build.sourceEncoding /properties dependencies dependency groupIdcom.xuxueli/groupId artifactIdxxl-job-core/artifactId version3.0.0/version /dependency dependency groupIdorg.slf4j/groupId artifactIdslf4j-api/artifactId version2.0.16/version /dependency dependency groupIdch.qos.logback/groupId artifactIdlogback-classic/artifactId version1.4.14/version /dependency /dependencies/project logback.xml ?xml version=1.0 encoding=UTF-8?configuration debug=false scan=true scanPeriod=1 seconds contextNamelogback/contextName property name=log.path value=/data/applogs/xxl-job/example_xxl-job_single.log/ appender name=console class=ch.qos.logback.core.ConsoleAppender encoder pattern%dHH:mm:ss.SSS %contextName [%thread] %-5level %logger36 - %msg%n/pattern /encoder /appender appender name=file class=ch.qos.logback.core.rolling.RollingFileAppender file$log.path/file rollingPolicy class=ch.qos.logback.core.rolling.TimeBasedRollingPolicy fileNamePattern$log.path.%dyyyy-MM-dd.zip/fileNamePattern /rollingPolicy encoder pattern%date %level [%thread] %logger36 [%file : %line] %msg%n /pattern /encoder /appender root level=info appender-ref ref=console/ appender-ref ref=file/ /root/configuration xxl-job-executor.properties ### xxl-job admin address list, such as http://address or http://address01,http://address02xxl.job.admin.addresses=http://127.0.0.1:8080/xxl-job-admin### xxl-job access-tokenxxl.job.admin.accessToken=default_token### xxl-job timeout by second, default 3sxxl.job.admin.timeout=3### xxl-job executor appnamexxl.job.executor.appname=xxl-job-executor-example-single### xxl-job executor registry-address: default use address to registry , otherwise use ip:port if address is nullxxl.job.executor.address=### xxl-job executor server-infoxxl.job.executor.ip=xxl.job.executor.port=9997### xxl-job executor log-pathxxl.job.executor.logpath=/data/applogs/xxl-job/jobhandler### xxl-job executor log-retention-daysxxl.job.executor.logretentiondays=30 æ‰§è¡Œå™¨é…ç½® srcmainJavaexampleJavaxxljobsingleconfigJobConfig.Java package example.java.xxljob.single.config;import com.xxl.job.core.executor.XxlJobExecutor;import com.xxl.job.core.executor.impl.XxlJobSimpleExecutor;import example.java.xxljob.single.job.ExampleJob;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import java.io.IOException;import java.io.InputStreamReader;import java.util.Arrays;import java.util.Properties;/** * * * @author lianyutian * @since 2025/3/26 * @version 1.0 */public class JobConfig private static Logger logger = LoggerFactory.getLogger(JobConfig.class); private static JobConfig instance = new JobConfig(); public static JobConfig getInstance() return instance; private XxlJobSimpleExecutor xxlJobExecutor = null; /** * init */ public void initXxlJobExecutor() // åŠ è½½ properties Properties xxlJobProp = loadProperties(xxl-job-executor.properties); // åˆå§‹åŒ–æ‰§è¡Œå™¨ xxlJobExecutor = new XxlJobSimpleExecutor(); xxlJobExecutor.setAdminAddresses(xxlJobProp.getProperty(xxl.job.admin.addresses)); xxlJobExecutor.setAccessToken(xxlJobProp.getProperty(xxl.job.admin.accessToken)); xxlJobExecutor.setTimeout(Integer.valueOf(xxlJobProp.getProperty(xxl.job.admin.timeout))); xxlJobExecutor.setAppname(xxlJobProp.getProperty(xxl.job.executor.appname)); xxlJobExecutor.setAddress(xxlJobProp.getProperty(xxl.job.executor.address)); xxlJobExecutor.setIp(xxlJobProp.getProperty(xxl.job.executor.ip)); xxlJobExecutor.setPort(Integer.valueOf(xxlJobProp.getProperty(xxl.job.executor.port))); xxlJobExecutor.setLogPath(xxlJobProp.getProperty(xxl.job.executor.logpath)); xxlJobExecutor.setLogRetentionDays(Integer.valueOf(xxlJobProp.getProperty(xxl.job.executor.logretentiondays))); // æ³¨å†Œä»»åŠ¡ XxlJobExecutor.registJobHandler(exampleJob, new ExampleJob()); // è¿è¡Œæ‰§è¡Œå™¨ try xxlJobExecutor.start(); catch (Exception e) logger.error(e.getMessage(), e); /** * destroy */ public void destroyXxlJobExecutor() if (xxlJobExecutor != null) xxlJobExecutor.destroy(); public static Properties loadProperties(String propertyFileName) InputStreamReader in = null; try ClassLoader loder = Thread.currentThread().getContextClassLoader(); in = new InputStreamReader(loder.getResourceAsStream(propertyFileName), UTF-8);; if (in != null) Properties prop = new Properties(); prop.load(in); return prop; catch (IOException e) logger.error(load error!, propertyFileName); finally if (in != null) try in.close(); catch (IOException e) logger.error(close error!, propertyFileName); return null; ç¼–å†™ä»»åŠ¡ srcmainJavaexampleJavaxxljobsinglejobExampleJob.Java package example.java.xxljob.single.job;import com.xxl.job.core.context.XxlJobHelper;import com.xxl.job.core.handler.IJobHandler;/** * * * @author lianyutian * @since 2025/3/26 * @version 1.0 */public class ExampleJob extends IJobHandler @Override public void execute() throws Exception XxlJobHelper.log(EXAMPLEJOB, EXECUTE.); å¯åŠ¨æ‰§è¡Œå™¨ srcmainJavaexampleJavaxxljobsingleMain.Java package example.java.xxljob.single;import example.java.xxljob.single.config.JobConfig;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import java.util.concurrent.TimeUnit;/** * * * @author lianyutian * @since 2025/3/26 * @version 1.0 */public class Main private static Logger logger = LoggerFactory.getLogger(Main.class); public static void main(String[] args) try // åˆå§‹è¯ xxl-job é…ç½® JobConfig.getInstance().initXxlJobExecutor(); // Blocks until interrupted while (true) try TimeUnit.HOURS.sleep(1); catch (InterruptedException e) break; catch (Exception e) logger.error(e.getMessage(), e); finally // é”€æ¯æ‰§è¡Œå™¨ JobConfig.getInstance().destroyXxlJobExecutor(); è°ƒåº¦å¹³å°è¿è¡Œä»»åŠ¡æ–°å»ºæ‰§è¡Œå™¨ï¼ˆåŒ 3 ç« èŠ‚ï¼‰â€“ æ–°å»ºè°ƒåº¦ä»»åŠ¡ï¼ˆåŒ 4.1 ç« èŠ‚æ‰§è¡Œæ­¥éª¤ï¼‰ æ³¨æ„ï¼šä»»åŠ¡é…ç½®ä¸­ JobHandler çš„åç§°ä¸æ³¨å†Œä»»åŠ¡æ—¶è®¾ç½®çš„åç§°éœ€è¦ä¸€è‡´ Bean æ¨¡å¼ï¼ˆæ–¹æ³•ï¼‰æ–°å»ºä»»åŠ¡ srcmainJavaexampleJavaxxljobsinglejobExampleMethodJob.Java package example.java.xxljob.single.job;import com.xxl.job.core.context.XxlJobHelper;import com.xxl.job.core.handler.annotation.XxlJob;/** * @author lianyutian * @since 2025/3/26 * @version 1.0 */public class ExampleMethodJob /** * 1ã€ç®€å•ä»»åŠ¡ç¤ºä¾‹ï¼ˆBeanæ¨¡å¼ï¼‰ */ @XxlJob(exampleMethodJob) public void exampleMethodJob() throws Exception XxlJobHelper.log(exampleMethodJob execute); // default success æ³¨å†Œä»»åŠ¡ srcmainJavaexampleJavaxxljobsingleconfigJobConfig.Java public void initXxlJobExecutor() // åŠ è½½ properties ... // åˆå§‹åŒ–æ‰§è¡Œå™¨ ... // æ³¨å†Œä»»åŠ¡ XxlJobExecutor.registJobHandler(exampleJob, new ExampleJob()); xxlJobExecutor.setXxlJobBeanList(Arrays.asList(new ExampleMethodJob())); // è¿è¡Œæ‰§è¡Œå™¨ try xxlJobExecutor.start(); catch (Exception e) logger.error(e.getMessage(), e); è°ƒåº¦ä¸­å¿ƒæ–°å»ºä»»åŠ¡ åˆ†ç‰‡å¹¿æ’­ä»»åŠ¡ç®€ä»‹æ‰§è¡Œå™¨é›†ç¾¤éƒ¨ç½²æ—¶ï¼Œä»»åŠ¡è·¯ç”±ç­–ç•¥é€‰æ‹© åˆ†ç‰‡å¹¿æ’­ æƒ…å†µä¸‹ï¼Œä¸€æ¬¡ä»»åŠ¡è°ƒåº¦å°†ä¼šå¹¿æ’­è§¦å‘å¯¹åº”é›†ç¾¤ä¸­æ‰€æœ‰æ‰§è¡Œå™¨æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ï¼ŒåŒæ—¶ç³»ç»Ÿè‡ªåŠ¨ä¼ é€’åˆ†ç‰‡å‚æ•°ï¼›å¯æ ¹æ®åˆ†ç‰‡å‚æ•°å¼€å‘åˆ†ç‰‡ä»»åŠ¡ï¼› åˆ†ç‰‡å¹¿æ’­ ä»¥æ‰§è¡Œå™¨ä¸ºç»´åº¦è¿›è¡Œåˆ†ç‰‡ï¼Œæ”¯æŒåŠ¨æ€æ‰©å®¹æ‰§è¡Œå™¨é›†ç¾¤ä»è€ŒåŠ¨æ€å¢åŠ åˆ†ç‰‡æ•°é‡ï¼ŒååŒè¿›è¡Œä¸šåŠ¡å¤„ç†ï¼›åœ¨è¿›è¡Œå¤§æ•°æ®é‡ä¸šåŠ¡æ“ä½œæ—¶å¯æ˜¾è‘—æå‡ä»»åŠ¡å¤„ç†èƒ½åŠ›å’Œé€Ÿåº¦ã€‚ åˆ†ç‰‡å¹¿æ’­ å’Œæ™®é€šä»»åŠ¡å¼€å‘æµç¨‹ä¸€è‡´ï¼Œä¸åŒä¹‹å¤„åœ¨äºå¯ä»¥è·å–åˆ†ç‰‡å‚æ•°ï¼Œè·å–åˆ†ç‰‡å‚æ•°è¿›è¡Œåˆ†ç‰‡ä¸šåŠ¡å¤„ç†ã€‚ åˆ†ç‰‡å‚æ•°è·å–// åˆ†ç‰‡åºå·int shardIndex = XxlJobHelper.getShardIndex();// æ€»åˆ†ç‰‡æ•°int shardTotal = XxlJobHelper.getShardTotal(); shardIndexï¼šå½“å‰åˆ†ç‰‡åºå·(ä» 0 å¼€å§‹)ï¼Œæ‰§è¡Œå™¨é›†ç¾¤åˆ—è¡¨ä¸­å½“å‰æ‰§è¡Œå™¨çš„åºå·ï¼› shardTotalï¼šæ€»åˆ†ç‰‡æ•°ï¼Œæ‰§è¡Œå™¨é›†ç¾¤çš„æ€»æœºå™¨æ•°é‡ï¼› è¯¥ç‰¹æ€§é€‚ç”¨åœºæ™¯å¦‚ï¼š åˆ†ç‰‡ä»»åŠ¡åœºæ™¯ï¼š10 ä¸ªæ‰§è¡Œå™¨çš„é›†ç¾¤æ¥å¤„ç† 10w æ¡æ•°æ®ï¼Œæ¯å°æœºå™¨åªéœ€è¦å¤„ç† 1w æ¡æ•°æ®ï¼Œè€—æ—¶é™ä½ 10 å€ï¼› å¹¿æ’­ä»»åŠ¡åœºæ™¯ï¼šå¹¿æ’­æ‰§è¡Œå™¨æœºå™¨è¿è¡Œ shell è„šæœ¬ã€å¹¿æ’­é›†ç¾¤èŠ‚ç‚¹è¿›è¡Œç¼“å­˜æ›´æ–°ç­‰ åˆ†ç‰‡ä»»åŠ¡package example.java.xxljob.springboot.job;import com.xxl.job.core.context.XxlJobHelper;import com.xxl.job.core.handler.annotation.XxlJob;import org.springframework.stereotype.Component;/** * @author lianyutian * @since 2025/3/26 * @version 1.0 */@Componentpublic class ExampleShardingBroadcastJob @XxlJob(exampleShardingBroadcastJob) public void exampleShardingBroadcastJob() // åˆ†ç‰‡å‚æ•° int shardIndex = XxlJobHelper.getShardIndex(); int shardTotal = XxlJobHelper.getShardTotal(); XxlJobHelper.log(åˆ†ç‰‡å‚æ•°ï¼šå½“å‰åˆ†ç‰‡åºå· = , æ€»åˆ†ç‰‡æ•° = , shardIndex, shardTotal); // ä¸šåŠ¡é€»è¾‘ for (int i = 0; i shardTotal; i++) if (i == shardIndex) XxlJobHelper.log(ç¬¬ ç‰‡, å‘½ä¸­åˆ†ç‰‡å¼€å§‹å¤„ç†, i); else XxlJobHelper.log(ç¬¬ ç‰‡, å¿½ç•¥, i); è°ƒåº¦ä»»åŠ¡ å¯åŠ¨ä¸¤ä¸ªæ‰§è¡Œå™¨ æ‰§è¡Œä»»åŠ¡ç‚¹å‡» æ‰§è¡Œä¸€æ¬¡ åˆ†ç‰‡ä»»åŠ¡ï¼Œå¯ä»¥çœ‹åˆ°ä¸¤æ¡è°ƒåº¦æ—¥å¿—ã€‚ å¹¿æ’­ä¼šè§¦å‘å¯¹åº”æ‰§è¡Œå™¨é›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ï¼ŒåŒæ—¶ç³»ç»Ÿè‡ªåŠ¨ä¼ é€’åˆ†ç‰‡å‚æ•°ï¼›","tags":["xxl-jobã€åˆ†å¸ƒå¼è°ƒåº¦"]},{"title":"Flask","path":"/2025/02/21/FlaskåŸºç¡€/","content":"ç®€ä»‹â€ŒFlaskâ€Œ æ˜¯ä¸€ä¸ªåŸºäº Python çš„è½»é‡çº§ â€ŒWeb å¼€å‘æ¡†æ¶â€Œï¼Œä»¥ç®€æ´ã€çµæ´»è‘—ç§°ã€‚å®ƒä¸å¼ºåˆ¶ä¾èµ–ç‰¹å®šå·¥å…·æˆ–åº“ï¼Œå¼€å‘è€…å¯è‡ªç”±ç»„åˆæŠ€æœ¯æ ˆï¼Œé€‚åˆæ„å»ºå°å‹åˆ°ä¸­å‹çš„ Web åº”ç”¨æˆ– API æœåŠ¡ã€‚ å®‰è£…è™šæ‹Ÿç¯å¢ƒä½¿ç”¨è™šæ‹Ÿç¯å¢ƒå¯ä»¥åœ¨å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒä¸‹ç®¡ç†é¡¹ç›®ä¾èµ–ã€‚ è™šæ‹Ÿç¯å¢ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿä½ çš„ Python é¡¹ç›®è¶Šå¤šï¼Œå°±è¶Šæœ‰å¯èƒ½éœ€è¦ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„ Python åŒ…ï¼Œç”šè‡³ Python æœ¬èº«ã€‚æŸä¸ªé¡¹ç›®ä½¿ç”¨çš„æ–°ç‰ˆæœ¬çš„åº“å¯èƒ½ä¼šç ´åå…¶ä»–é¡¹ç›®çš„å…¼å®¹æ€§ã€‚ è™šæ‹Ÿç¯å¢ƒæ˜¯ Python åº“çš„ç‹¬ç«‹é›†åˆï¼Œæ¯ä¸€ä¸ªé¡¹ç›®å¯¹åº”ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒã€‚å®‰è£…åˆ°æŸä¸ªé¡¹ç›®çš„åŒ…ä¸ä¼šå½±å“å…¶ä»–é¡¹ç›®æˆ–æ˜¯æ“ä½œç³»ç»Ÿå±‚çº§çš„åŒ…ã€‚ åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ mkdir myprojectcd myprojectpython3 -m venv .venv æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ $ . .venv/bin/activate# deactivate é€€å‡º ä½ çš„ shell æç¤ºç¬¦ç°åœ¨ä¼šæ˜¾ç¤ºæ¿€æ´»çš„è™šæ‹Ÿç¯å¢ƒåç§°ã€‚ .venvlim@lim-PC:~/work/sty_workspace/sty_flask$ å®‰è£…åœ¨æ¿€æ´»çš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œå®‰è£… Flaskï¼š .venv/bin/pip3 install Flask å®‰è£…å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤éªŒè¯ Flask æ˜¯å¦å®‰è£…æˆåŠŸï¼š .venv/bin/pip3 show Flask è¾“å‡ºç»“æœï¼š Name: FlaskVersion: 3.1.0Summary: A simple framework for building complex web applications.Home-page:Author:Author-email:License:Location: persistenthomelimworksty_workspacesty_flask.venvlibpython3.12site-packagesRequires: blinker, click, itsdangerous, Jinja2, WerkzeugRequired-by: ç¬¬ä¸€ä¸ªåº”ç”¨ homelimworksty_workspacesty_flaskapp.py from flask import Flaskapp = Flask(__name__)@app.route(/)def hello_world(): return pHello, World!/p æ‰§è¡Œå‘½ä»¤è¿è¡Œ Flask åº”ç”¨ï¼š .venv/bin/flask --app app run ä½ ä¼šçœ‹åˆ° Flask å¼€å‘æœåŠ¡å™¨å¯åŠ¨ï¼Œå¹¶æ˜¾ç¤ºç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼š * Serving Flask app app * Debug mode: offWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead. * Running on http://127.0.0.1:5000Press CTRL+C to quit æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® http://127.0.0.1:5000/ï¼Œåº”è¯¥ä¼šçœ‹åˆ° â€œHello, World!â€ çš„æ¶ˆæ¯ï¼Œè¡¨ç¤º Flask å·²æˆåŠŸå®‰è£…å¹¶è¿è¡Œã€‚ ä»£ç è§£æï¼š from flask import Flaskï¼š è¿™è¡Œä»£ç ä» flask æ¨¡å—ä¸­å¯¼å…¥äº† Flask ç±»ã€‚Flask ç±»æ˜¯ Flask æ¡†æ¶çš„æ ¸å¿ƒï¼Œç”¨äºåˆ›å»º Flask åº”ç”¨ç¨‹åºå®ä¾‹ã€‚ **app = Flask(__name__)**ï¼š è¿™è¡Œä»£ç åˆ›å»ºäº†ä¸€ä¸ª Flask åº”ç”¨å®ä¾‹ã€‚__name__ æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ Python å˜é‡ï¼Œå®ƒåœ¨æ¨¡å—è¢«ç›´æ¥è¿è¡Œæ—¶æ˜¯ __main__ï¼Œåœ¨è¢«å…¶ä»–æ¨¡å—å¯¼å…¥æ—¶æ˜¯æ¨¡å—çš„åå­—ã€‚ä¼ é€’ __name__ ç»™ Flask æ„é€ å‡½æ•°å…è®¸ Flask åº”ç”¨æ‰¾åˆ°å’ŒåŠ è½½é…ç½®æ–‡ä»¶ã€‚ **@app.route(â€˜â€˜)**ï¼š è¿™æ˜¯ä¸€ä¸ªè£…é¥°å™¨ï¼Œç”¨äºå‘Šè¯‰ Flask å“ªä¸ª URL åº”è¯¥è§¦å‘ä¸‹é¢çš„å‡½æ•°ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒæŒ‡å®šäº†æ ¹ URLï¼ˆå³ç½‘ç«™çš„ä¸»é¡µï¼‰ã€‚ **def hello_world():**ï¼š è¿™æ˜¯å®šä¹‰äº†ä¸€ä¸ªåä¸º hello_world çš„å‡½æ•°ï¼Œå®ƒå°†è¢«è°ƒç”¨å½“ç”¨æˆ·è®¿é—®æ ¹ URL æ—¶ã€‚ **return â€˜Hello, World!â€™**ï¼š è¿™è¡Œä»£ç æ˜¯ hello_world å‡½æ•°çš„è¿”å›å€¼ã€‚å½“ç”¨æˆ·è®¿é—®æ ¹ URL æ—¶ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å°†è¢«å‘é€å›ç”¨æˆ·çš„æµè§ˆå™¨ã€‚ è°ƒè¯•æ¨¡å¼ï¼š .venv/bin/flask --app app run --debug * Serving Flask app app * Debug mode: onWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead. * Running on http://127.0.0.1:5000Press CTRL+C to quit * Restarting with stat * Debugger is active! * Debugger PIN: 547-932-025 è¯¥å‘½ä»¤çš„ä½œç”¨ä¸ä»…ä»…æ˜¯å¯åŠ¨æœåŠ¡å™¨ã€‚é€šè¿‡å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼ŒæœåŠ¡å™¨å°†åœ¨ä»£ç æ›´æ”¹æ—¶è‡ªåŠ¨é‡æ–°åŠ è½½ï¼Œå¹¶åœ¨è¯·æ±‚æœŸé—´å‘ç”Ÿé”™è¯¯æ—¶åœ¨æµè§ˆå™¨ä¸­æ˜¾ç¤ºäº¤äº’å¼è°ƒè¯•å™¨ã€‚ Flask åŸºæœ¬æ¦‚å¿µäº†è§£ Flask çš„åŸºæœ¬æ¦‚å¿µå¯¹äºå¼€å‘é«˜æ•ˆçš„ Web åº”ç”¨éå¸¸é‡è¦ã€‚ ä»¥ä¸‹æ˜¯ Flask çš„ä¸»è¦åŸºæœ¬æ¦‚å¿µçš„è¯¦ç»†è§£æï¼š è·¯ç”±ï¼šè·¯ç”±æ˜¯ URL åˆ° Python å‡½æ•°çš„æ˜ å°„ã€‚Flask å…è®¸ä½ å®šä¹‰è·¯ç”±ï¼Œè¿™æ ·å½“ç‰¹å®šçš„ URL è¢«è®¿é—®æ—¶ï¼Œå°±ä¼šè°ƒç”¨ç›¸åº”çš„å‡½æ•°ã€‚ è§†å›¾å‡½æ•°ï¼šè§†å›¾å‡½æ•°æ˜¯å¤„ç†è¯·æ±‚å¹¶è¿”å›å“åº”çš„ Python å‡½æ•°ã€‚å®ƒä»¬é€šå¸¸æ¥æ”¶è¯·æ±‚å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›å“åº”å¯¹è±¡ã€‚ è¯·æ±‚å¯¹è±¡ï¼šè¯·æ±‚å¯¹è±¡åŒ…å«äº†å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ä¿¡æ¯ï¼Œå¦‚è¯·æ±‚æ–¹æ³•ã€URLã€è¯·æ±‚å¤´ã€è¡¨å•æ•°æ®ç­‰ã€‚ å“åº”å¯¹è±¡ï¼šå“åº”å¯¹è±¡åŒ…å«äº†å‘é€ç»™å®¢æˆ·ç«¯çš„å“åº”ä¿¡æ¯ï¼Œå¦‚çŠ¶æ€ç ã€å“åº”å¤´ã€å“åº”ä½“ç­‰ã€‚ æ¨¡æ¿ï¼šFlask ä½¿ç”¨ Jinja2 æ¨¡æ¿å¼•æ“æ¥æ¸²æŸ“ HTML æ¨¡æ¿ã€‚æ¨¡æ¿å…è®¸ä½ å°† Python ä»£ç åµŒå…¥åˆ° HTML ä¸­ï¼Œä»è€ŒåŠ¨æ€ç”Ÿæˆç½‘é¡µã€‚ åº”ç”¨å·¥å‚ï¼šåº”ç”¨å·¥å‚æ˜¯ä¸€ä¸ª Python å‡½æ•°ï¼Œå®ƒåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ª Flask åº”ç”¨å®ä¾‹ã€‚è¿™å…è®¸ä½ é…ç½®å’Œåˆå§‹åŒ–ä½ çš„åº”ç”¨ï¼Œå¹¶ä¸”å¯ä»¥åˆ›å»ºå¤šä¸ªåº”ç”¨å®ä¾‹ã€‚ é…ç½®å¯¹è±¡ï¼šFlask åº”ç”¨æœ‰ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥è®¾ç½®å„ç§é…ç½®é€‰é¡¹ï¼Œå¦‚æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€è°ƒè¯•æ¨¡å¼ç­‰ã€‚ è“å›¾ï¼šè“å›¾æ˜¯ Flask ä¸­çš„ä¸€ä¸ªç»„ç»‡ä»£ç çš„æ–¹å¼ï¼Œå®ƒå…è®¸ä½ å°†ç›¸å…³çš„è§†å›¾å‡½æ•°ã€æ¨¡æ¿å’Œé™æ€æ–‡ä»¶ç»„ç»‡åœ¨ä¸€èµ·ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å¤šä¸ªåº”ç”¨ä¸­é‡ç”¨ã€‚ é™æ€æ–‡ä»¶ï¼šé™æ€æ–‡ä»¶æ˜¯ä¸ä¼šè¢«æœåŠ¡å™¨ç«¯æ‰§è¡Œçš„æ–‡ä»¶ï¼Œå¦‚ CSSã€JavaScript å’Œå›¾ç‰‡æ–‡ä»¶ã€‚Flask æä¾›äº†ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ¥æœåŠ¡è¿™äº›æ–‡ä»¶ã€‚ æ‰©å±•ï¼šFlask æœ‰è®¸å¤šæ‰©å±•ï¼Œå¯ä»¥æ·»åŠ é¢å¤–çš„åŠŸèƒ½ï¼Œå¦‚æ•°æ®åº“é›†æˆã€è¡¨å•éªŒè¯ã€ç”¨æˆ·è®¤è¯ç­‰ã€‚ ä¼šè¯ï¼šFlask ä½¿ç”¨å®¢æˆ·ç«¯ä¼šè¯æ¥å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™å…è®¸ä½ åœ¨ç”¨æˆ·æµè§ˆä½ çš„åº”ç”¨æ—¶è®°ä½ä»–ä»¬çš„çŠ¶æ€ã€‚ é”™è¯¯å¤„ç†ï¼šFlask å…è®¸ä½ å®šä¹‰é”™è¯¯å¤„ç†å‡½æ•°ï¼Œå½“ç‰¹å®šçš„é”™è¯¯å‘ç”Ÿæ—¶ï¼Œè¿™äº›å‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚ é¡¹ç›®ç»“æ„ä¸€ä¸ª Flask åº”ç”¨å¯ä»¥ç®€å•åˆ°åªæœ‰ä¸€ä¸ªæ–‡ä»¶ã€‚ æ¯”å¦‚ä»¥ä¸‹ hello.py æ–‡ä»¶å°±æ˜¯ä¸€ä¸ª Flask åº”ç”¨ï¼š from flask import Flaskapp = Flask(__name__)@app.route(/)def hello(): return Hello, World! ç„¶è€Œï¼Œå½“é¡¹ç›®å˜å¤§æ—¶ï¼ŒæŠŠæ‰€æœ‰ä»£ç éƒ½æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œä¸å¤ªç°å®ã€‚ Flask é¡¹ç›®ç»“æ„å¯ä»¥æ ¹æ®åº”ç”¨çš„è§„æ¨¡å’Œå¤æ‚æ€§æœ‰æ‰€ä¸åŒã€‚ ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„ Flask é¡¹ç›®ç»“æ„ï¼Œåˆ†åˆ«é€‚ç”¨äºç®€å•åº”ç”¨å’Œè¾ƒå¤æ‚çš„åº”ç”¨ã€‚ ç®€å•é¡¹ç›®ç»“æ„ï¼šé€‚ç”¨äºå°å‹åº”ç”¨ï¼Œæ‰€æœ‰ä»£ç é›†ä¸­åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚ ä¸­å‹é¡¹ç›®ç»“æ„ï¼šå°†åº”ç”¨åˆ†ä¸ºå¤šä¸ªæ¨¡å—ï¼Œä¾¿äºç®¡ç†å’Œæ‰©å±•ã€‚ å¤æ‚é¡¹ç›®ç»“æ„ï¼šæ”¯æŒæ›´é«˜çš„æ¨¡å—åŒ–ï¼Œé€‚ç”¨äºå¤§å‹åº”ç”¨ï¼ŒåŒ…å«è·¯ç”±ã€æ¨¡å‹ã€æ¨¡æ¿å’Œé™æ€æ–‡ä»¶ç›®å½•ã€‚ ç®€å•é¡¹ç›®ç»“æ„å¯¹äºä¸€ä¸ªç®€å•çš„ Flask åº”ç”¨ï¼Œé¡¹ç›®ç»“æ„å¯ä»¥éå¸¸ç®€æ´ï¼š my_flask_app/â”‚â”œâ”€â”€ app.pyâ””â”€â”€ requirements.txt **app.py**ï¼šä¸»è¦çš„ Flask åº”ç”¨æ–‡ä»¶ï¼ŒåŒ…å«è·¯ç”±å’Œè§†å›¾å‡½æ•°çš„å®šä¹‰ã€‚ **requirements.txt**ï¼šåˆ—å‡ºé¡¹ç›®çš„ä¾èµ–åº“ï¼Œç”¨äºè®°å½• Flask å’Œå…¶ä»–åŒ…çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚ my_flask_app ç›®å½•ä¸‹çš„ app.py æ–‡ä»¶ä»£ç ï¼š from flask import Flaskapp = Flask(__name__)@app.route(/)def home(): return Hello, World!if __name__ == __main__: app.run(debug=True) requirements.txt ç¤ºä¾‹ï¼š Flask==2.2.3 ä¸­å‹é¡¹ç›®ç»“æ„å¯¹äºç¨å¤æ‚çš„åº”ç”¨ï¼Œé€šå¸¸ä¼šå°†é¡¹ç›®åˆ†ä¸ºå¤šä¸ªæ¨¡å—å’Œç›®å½•ï¼š my_flask_app/â”‚â”œâ”€â”€ app/â”‚ â”œâ”€â”€ __init__.pyâ”‚ â”œâ”€â”€ routes.pyâ”‚ â””â”€â”€ models.pyâ”‚â”œâ”€â”€ config.pyâ”œâ”€â”€ requirements.txtâ””â”€â”€ run.py app/ï¼šåŒ…å« Flask åº”ç”¨çš„ä¸»è¦ä»£ç ã€‚ **__init__.py**ï¼šåˆå§‹åŒ– Flask åº”ç”¨å’Œé…ç½®æ‰©å±•ã€‚ **routes.py**ï¼šå®šä¹‰åº”ç”¨çš„è·¯ç”±å’Œè§†å›¾å‡½æ•°ã€‚ **models.py**ï¼šå®šä¹‰åº”ç”¨çš„æ•°æ®æ¨¡å‹ã€‚ **config.py**ï¼šé…ç½®æ–‡ä»¶ï¼ŒåŒ…å«åº”ç”¨çš„é…ç½®ä¿¡æ¯ã€‚ **requirements.txt**ï¼šåˆ—å‡ºé¡¹ç›®çš„ä¾èµ–åº“ã€‚ **run.py**ï¼šç”¨äºå¯åŠ¨ Flask åº”ç”¨ã€‚ app/__init__.py ç¤ºä¾‹ï¼š from flask import Flaskdef create_app(): app = Flask(__name__) app.config.from_object(config.Config) from . import routes app.register_blueprint(routes.bp) return app approutes.py ç¤ºä¾‹ï¼š from flask import Blueprintbp = Blueprint(main, __name__)@bp.route(/)def home(): return Hello, World! run.py ç¤ºä¾‹ï¼š from app import create_appapp = create_app()if __name__ == __main__: app.run(debug=True) å¤æ‚é¡¹ç›®ç»“æ„å¯¹äºè¾ƒå¤§çš„åº”ç”¨ï¼Œå¯èƒ½éœ€è¦æ›´å¤æ‚çš„é¡¹ç›®ç»“æ„ï¼Œä»¥æ”¯æŒæ›´é«˜çš„æ¨¡å—åŒ–å’Œæ‰©å±•æ€§ï¼š my_flask_app/â”‚â”œâ”€â”€ app/â”‚ â”œâ”€â”€ __init__.pyâ”‚ â”œâ”€â”€ routes/â”‚ â”‚ â”œâ”€â”€ __init__.pyâ”‚ â”‚ â”œâ”€â”€ main.pyâ”‚ â”‚ â””â”€â”€ auth.pyâ”‚ â”œâ”€â”€ models/â”‚ â”‚ â”œâ”€â”€ __init__.pyâ”‚ â”‚ â””â”€â”€ user.pyâ”‚ â”œâ”€â”€ templates/â”‚ â”‚ â”œâ”€â”€ layout.htmlâ”‚ â”‚ â””â”€â”€ home.htmlâ”‚ â””â”€â”€ static/â”‚ â”œâ”€â”€ css/â”‚ â””â”€â”€ js/â”‚â”œâ”€â”€ config.pyâ”œâ”€â”€ requirements.txtâ”œâ”€â”€ migrations/â”‚ â””â”€â”€ ...â””â”€â”€ run.py app/routes/ï¼šå°†ä¸åŒåŠŸèƒ½æ¨¡å—çš„è·¯ç”±åˆ†å¼€ç®¡ç†ã€‚ **main.py**ï¼šä¸»æ¨¡å—çš„è·¯ç”±ã€‚ **auth.py**ï¼šè®¤è¯ç›¸å…³çš„è·¯ç”±ã€‚ app/models/ï¼šç®¡ç†æ•°æ®æ¨¡å‹ï¼Œé€šå¸¸ä¸æ•°æ®åº“æ“ä½œç›¸å…³ã€‚ **user.py**ï¼šç”¨æˆ·æ¨¡å‹ã€‚ **app/templates/**ï¼šå­˜æ”¾ HTML æ¨¡æ¿æ–‡ä»¶ã€‚ **app/static/**ï¼šå­˜æ”¾é™æ€æ–‡ä»¶ï¼Œå¦‚ CSS å’Œ JavaScriptã€‚ **migrations/**ï¼šæ•°æ®åº“è¿ç§»æ–‡ä»¶ï¼Œé€šå¸¸ä¸ SQLAlchemy ç›¸å…³ã€‚ approutesmain.py ç¤ºä¾‹ï¼š from flask import Blueprint, render_templatebp = Blueprint(main, __name__)@bp.route(/)def home(): return render_template(home.html) appmodelsuser.py ç¤ºä¾‹ï¼š from app import dbclass User(db.Model): id = db.Column(db.Integer, primary_key=True) username = db.Column(db.String(150), unique=True, nullable=False) è·¯ç”±Flask è·¯ç”±æ˜¯ Web åº”ç”¨ç¨‹åºä¸­å°† URL æ˜ å°„åˆ° Python å‡½æ•°çš„æœºåˆ¶ã€‚ Flask è·¯ç”±æ˜¯ Flask åº”ç”¨çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œç”¨äºå¤„ç†ä¸åŒ URL çš„è¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚çš„å¤„ç†å§”æ‰˜ç»™ç›¸åº”çš„è§†å›¾å‡½æ•°ã€‚ ä»¥ä¸‹æ˜¯å…³äº Flask è·¯ç”±çš„è¯¦ç»†è¯´æ˜ï¼ŒåŒ…æ‹¬è·¯ç”±çš„å®šä¹‰ã€å‚æ•°ã€æ–¹æ³•å’Œè§„åˆ™ç­‰ã€‚ å®šä¹‰è·¯ç”±ï¼šä½¿ç”¨ @app.route(/path) è£…é¥°å™¨å®šä¹‰ URL å’Œè§†å›¾å‡½æ•°çš„æ˜ å°„ã€‚ è·¯ç”±å‚æ•°ï¼šé€šè¿‡åŠ¨æ€éƒ¨åˆ†åœ¨ URL ä¸­ä¼ é€’å‚æ•°ã€‚ è·¯ç”±è§„åˆ™ï¼šä½¿ç”¨ç±»å‹è½¬æ¢å™¨æŒ‡å®š URL å‚æ•°çš„ç±»å‹ã€‚ è¯·æ±‚æ–¹æ³•ï¼šæŒ‡å®šå…è®¸çš„ HTTP è¯·æ±‚æ–¹æ³•ã€‚ è·¯ç”±å‡½æ•°è¿”å›ï¼šè§†å›¾å‡½æ•°å¯ä»¥è¿”å›ä¸åŒç±»å‹çš„å“åº”ã€‚ é™æ€æ–‡ä»¶å’Œæ¨¡æ¿ï¼šç®¡ç†é™æ€æ–‡ä»¶å’ŒåŠ¨æ€æ¸²æŸ“ HTML æ¨¡æ¿ã€‚ è·¯ç”±ä¼˜å…ˆçº§ï¼šç¡®ä¿è·¯ç”±é¡ºåºæ­£ç¡®ï¼Œä»¥é¿å…æ„å¤–çš„åŒ¹é…ç»“æœã€‚ å®šä¹‰è·¯ç”±åŸºæœ¬è·¯ç”±å®šä¹‰ï¼š from flask import Flaskapp = Flask(__name__)@app.route(/)def home(): return Welcome to the Home Page! @app.route(/)ï¼šè£…é¥°å™¨ï¼Œç”¨äºå®šä¹‰è·¯ç”±ã€‚/ è¡¨ç¤ºæ ¹ URLã€‚ def home()ï¼šè§†å›¾å‡½æ•°ï¼Œå½“è®¿é—®æ ¹ URL æ—¶ï¼Œè¿”å› Welcome to the Home Page!ã€‚ ä½¿ç”¨ flask.Flask.add_url_rule() æ³¨å†Œè·¯ç”±ï¼š app = Flask()app.add_url_rule(/ping, view_func=AppHandler.ping) rule ( str ) â€“ URL è§„åˆ™å­—ç¬¦ä¸²ã€‚ endpoint ï¼ˆ[str]) | Noneï¼‰â€“ ä¸è§„åˆ™å’Œè§†å›¾å‡½æ•°å…³è”çš„ç«¯ç‚¹åç§°ã€‚åœ¨è·¯ç”±å’Œæ„å»º URL æ—¶ä½¿ç”¨ã€‚é»˜è®¤ä¸º view_func.__name__ view_funcï¼ˆft.RouteCallable | Noneï¼‰â€“ ä¸ç«¯ç‚¹åç§°å…³è”çš„è§†å›¾å‡½æ•°ã€‚ provide_automatic_options( bool|None ) â€“ æ·»åŠ  OPTIONS æ–¹æ³•å¹¶è‡ªåŠ¨å“åº” OPTIONS è¯·æ±‚ã€‚ optionsï¼ˆt.Anyï¼‰ â€“ ä¼ é€’ç»™ Rule å¯¹è±¡çš„é¢å¤–é€‰é¡¹ã€‚ è·¯ç”±å‚æ•°è·¯ç”±å¯ä»¥åŒ…å«åŠ¨æ€éƒ¨åˆ†ï¼Œé€šè¿‡åœ¨è·¯ç”±ä¸­æŒ‡å®šå‚æ•°ï¼Œå¯ä»¥å°† URL ä¸­çš„éƒ¨åˆ†æ•°æ®ä¼ é€’ç»™è§†å›¾å‡½æ•°ã€‚ @app.route(/greet/name)def greet(name): return fHello, name! è·¯ç”±è§„åˆ™è·¯ç”±è§„åˆ™æ”¯æŒä¸åŒç±»å‹çš„å‚æ•°å’ŒåŒ¹é…è§„åˆ™ã€‚ ç±»å‹è§„åˆ™ï¼š å­—ç¬¦ä¸²ï¼ˆé»˜è®¤ï¼‰ï¼š åŒ¹é…ä»»æ„å­—ç¬¦ä¸²ã€‚ æ•´æ•°ï¼ˆint:nameï¼‰ï¼š åŒ¹é…æ•´æ•°å€¼ã€‚ æµ®ç‚¹æ•°ï¼ˆfloat:valueï¼‰ï¼š åŒ¹é…æµ®ç‚¹æ•°å€¼ã€‚ è·¯å¾„ï¼ˆpath:nameï¼‰ï¼š åŒ¹é…ä»»æ„å­—ç¬¦ï¼ŒåŒ…æ‹¬æ–œæ  /ã€‚ @app.route(/user/int:user_id)def user_profile(user_id): return fUser ID: user_id@app.route(/files/path:filename)def serve_file(filename): return fServing file: filename @app.route(/user/int:user_id)ï¼šåŒ¹é…æ•´æ•°ç±»å‹çš„ user_idã€‚ @app.route(/files/path:filename)ï¼šåŒ¹é…åŒ…å«æ–œæ çš„è·¯å¾„ filenameã€‚ å¦‚æœç›´æ¥ä½¿ç”¨ @app.route(/user/user_id) æ¥æ”¶å…¥å‚ï¼Œæµè§ˆå™¨è¾“å…¥ http://127.0.0.1:5000/user/1ã€‚user_id ä¼šè¢«è½¬æˆå­—ç¬¦ä¸²ã€‚ è¯·æ±‚æ–¹æ³•Flask è·¯ç”±æ”¯æŒä¸åŒçš„ HTTP è¯·æ±‚æ–¹æ³•ï¼Œå¦‚ GETã€POSTã€PUTã€DELETE ç­‰ã€‚å¯ä»¥é€šè¿‡ methods å‚æ•°æŒ‡å®šå…è®¸çš„è¯·æ±‚æ–¹æ³•ã€‚ @app.route(/submit, methods=[POST])def submit(): return Form submitted! è·¯ç”±è½¬æ¢å™¨Flask æä¾›äº†ä¸€äº›å†…ç½®çš„è½¬æ¢å™¨ï¼Œå¯ä»¥å¯¹ URL ä¸­çš„å‚æ•°è¿›è¡Œç‰¹å®šç±»å‹çš„è½¬æ¢ã€‚ å¸¸ç”¨è½¬æ¢å™¨ï¼š intï¼š åŒ¹é…æ•´æ•°ã€‚ floatï¼š åŒ¹é…æµ®ç‚¹æ•°ã€‚ pathï¼š åŒ¹é…ä»»æ„è·¯å¾„ï¼ŒåŒ…æ‹¬æ–œæ ã€‚ @app.route(/items/int:item_id/details)def item_details(item_id): return fItem details for item ID: item_id int:item_idï¼šå°† URL ä¸­çš„ item_id è½¬æ¢ä¸ºæ•´æ•°ã€‚ è·¯ç”±å‡½æ•°è¿”å›è§†å›¾å‡½æ•°å¯ä»¥è¿”å›å¤šç§ç±»å‹çš„å“åº”ï¼š å­—ç¬¦ä¸²ï¼šè¿”å›çº¯æ–‡æœ¬å“åº”ã€‚ HTMLï¼šè¿”å› HTML é¡µé¢ã€‚ JSONï¼šè¿”å› JSON æ•°æ®ã€‚ Response å¯¹è±¡ï¼šè‡ªå®šä¹‰å“åº”ã€‚ from flask import jsonify, Response@app.route(/json)def json_response(): data = key: value return jsonify(data)@app.route(/custom)def custom_response(): response = Response(Custom response with headers, status=200) response.headers[X-Custom-Header] = Value return response é™æ€æ–‡ä»¶å’Œæ¨¡æ¿é™æ€æ–‡ä»¶ï¼ˆå¦‚ CSSã€JavaScriptã€å›¾ç‰‡ï¼‰å¯ä»¥é€šè¿‡ static è·¯ç”±è®¿é—®ã€‚æ¨¡æ¿æ–‡ä»¶åˆ™é€šè¿‡ templates æ–‡ä»¶å¤¹ç»„ç»‡ï¼Œç”¨äºæ¸²æŸ“ HTML é¡µé¢ã€‚ é™æ€ CSS æ–‡ä»¶è®¿é—®ï¼š link rel=stylesheet href= url_for(static, filename=style.css) å›¾ç‰‡æ¸²æŸ“ï¼š img src= url_for(static, filename=img/test.jpg) alt=ç¤ºä¾‹å›¾ç‰‡ æ¨¡æ¿æ–‡ä»¶æ¸²æŸ“ï¼š !DOCTYPE htmlhtmlhead titleHello/title/headbody h1Hello/h1 link rel=stylesheet href= url_for(static, filename=style.css) img src= url_for(static, filename=img/test.jpg) alt=ç¤ºä¾‹å›¾ç‰‡/body/html from flask import render_template@app.route(/hello/name)def hello(name): return render_template(hello.html, name=name) æ³¨æ„ï¼š æ¨¡æ¿æ–‡ä»¶è¦æ”¾åˆ° templates æ–‡ä»¶å¤¹ä¸­ï¼Œæ–‡ä»¶å¤¹åç§°å¿…é¡»ä¸º templates é™æ€æ–‡ä»¶å¤¹å¿…é¡»å‘½åä¸º static è·¯ç”±ä¼˜å…ˆçº§Flask æŒ‰ç…§å®šä¹‰çš„é¡ºåºåŒ¹é…è·¯ç”±ï¼Œç¬¬ä¸€ä¸ªåŒ¹é…æˆåŠŸçš„è·¯ç”±å°†è¢«å¤„ç†ã€‚ç¡®ä¿æ›´å…·ä½“çš„è·¯ç”±æ”¾åœ¨æ›´ä¸€èˆ¬çš„è·¯ç”±ä¹‹å‰ã€‚ @app.route(/user/int:user_id)def user_profile(user_id): return fUser ID: user_id@app.route(/user)def user_list(): return User List /user/123 å°†åŒ¹é…åˆ° /user/int:user_idï¼Œè€Œ /user å°†åŒ¹é…åˆ° user_listã€‚ è§†å›¾å‡½æ•°è§†å›¾å‡½æ•°æ˜¯ Flask åº”ç”¨ä¸­çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒè´Ÿè´£å¤„ç†è¯·æ±‚å¹¶ç”Ÿæˆå“åº”ã€‚ è§†å›¾å‡½æ•°ä¸è·¯ç”±ç´§å¯†ç»“åˆï¼Œé€šè¿‡è·¯ç”±å°† URL æ˜ å°„åˆ°å…·ä½“çš„è§†å›¾å‡½æ•°ã€‚ ä»¥ä¸‹æ˜¯å¯¹ Flask è§†å›¾å‡½æ•°çš„è¯¦ç»†è¯´æ˜ï¼ŒåŒ…æ‹¬å¦‚ä½•å®šä¹‰ã€ä½¿ç”¨è¯·æ±‚æ•°æ®ã€è¿”å›å“åº”ã€ä»¥åŠå¦‚ä½•å¤„ç†é”™è¯¯ç­‰ã€‚ å®šä¹‰è§†å›¾å‡½æ•°ï¼šè§†å›¾å‡½æ•°æ˜¯å¤„ç†è¯·æ±‚å¹¶è¿”å›å“åº”çš„æ ¸å¿ƒåŠŸèƒ½ã€‚ æ¥æ”¶è¯·æ±‚æ•°æ®ï¼šä½¿ç”¨ request å¯¹è±¡è·å– URL å‚æ•°ã€è¡¨å•æ•°æ®ã€æŸ¥è¯¢å‚æ•°ç­‰ã€‚ è¿”å›å“åº”ï¼šå¯ä»¥è¿”å›å­—ç¬¦ä¸²ã€HTMLã€JSON æˆ–è‡ªå®šä¹‰å“åº”å¯¹è±¡ã€‚ å¤„ç†è¯·æ±‚å’Œå“åº”ï¼šä½¿ç”¨ request å¯¹è±¡å’Œ make_response æ¥å¤„ç†è¯·æ±‚å’Œç”Ÿæˆè‡ªå®šä¹‰å“åº”ã€‚ å¤„ç†é”™è¯¯ï¼šè§†å›¾å‡½æ•°å†…å¤„ç†å¼‚å¸¸æˆ–ä½¿ç”¨ Flask çš„é”™è¯¯å¤„ç†æœºåˆ¶ã€‚ è§†å›¾å‡½æ•°çš„è£…é¥°å™¨ï¼šä½¿ç”¨ @app.before_requestã€@app.after_request ç­‰è£…é¥°å™¨å¤„ç†è¯·æ±‚å‰åé€»è¾‘ã€‚ è§†å›¾å‡½æ•°è¿”å›çš„çŠ¶æ€ç ï¼šå¯ä»¥æŒ‡å®š HTTP çŠ¶æ€ç æ¥è¡¨ç¤ºè¯·æ±‚çš„å¤„ç†ç»“æœã€‚ å®šä¹‰è§†å›¾å‡½æ•°è§†å›¾å‡½æ•°æ˜¯ä¸€ä¸ªæ™®é€šçš„ Python å‡½æ•°ï¼Œå®ƒæ¥æ”¶è¯·æ±‚å¹¶è¿”å›å“åº”ã€‚è§†å›¾å‡½æ•°é€šå¸¸ä¸è·¯ç”±é…åˆä½¿ç”¨ï¼Œé€šè¿‡è£…é¥°å™¨å°† URL æ˜ å°„åˆ°è§†å›¾å‡½æ•°ã€‚ from flask import Flaskapp = Flask(__name__)@app.route(/)def home(): return Hello, World! @app.route(/)ï¼šå°†æ ¹ URL / æ˜ å°„åˆ° home è§†å›¾å‡½æ•°ã€‚ def home()ï¼šè§†å›¾å‡½æ•°ï¼Œè¿”å›å­—ç¬¦ä¸² Hello, World! ä½œä¸ºå“åº”ã€‚ æ¥æ”¶è¯·æ±‚æ•°æ®è§†å›¾å‡½æ•°å¯ä»¥æ¥æ”¶ä¸åŒç±»å‹çš„è¯·æ±‚æ•°æ®ï¼ŒåŒ…æ‹¬ URL å‚æ•°ã€è¡¨å•æ•°æ®ã€æŸ¥è¯¢å‚æ•°ç­‰ã€‚ è·å– URL å‚æ•°@app.route(/greet/name)def greet(name): return fHello, name! name æ˜¯ä¸€ä¸ª URL å‚æ•°ï¼Œä¼ é€’åˆ°è§†å›¾å‡½æ•° greetã€‚ è·å–è¡¨å•æ•°æ® sty_flasktemplatesindex.HTML !DOCTYPE htmlhtmlhead titleHello/title/headbody form action=/submit method=POST input type=text name=username placeholder=Name/input input type=submit value=Submit/input /form/body/html sty_flaskapp.py from flask import render_template, Flask, requestapp = Flask(__name__)@app.route(/)def index(): return render_template(index.html)@app.route(/submit, methods=[POST])def submit(): username = request.form.get(username, Guest) return fForm submitted by username request.form.get(â€˜usernameâ€™)ï¼š è·å– POST è¯·æ±‚ä¸­è¡¨å•æ•°æ®çš„ username å­—æ®µã€‚ è·å–æŸ¥è¯¢å‚æ•°!DOCTYPE htmlhtmlhead titleHello/title/headbody form action=/search method=GET input type=text name=query placeholder=Name/input input type=submit value=Query/input /form/body/html @app.route(/search)def search(): query = request.args.get(query) return fSearch results for: query request.args.get(â€˜queryâ€™)ï¼š è·å– GET è¯·æ±‚ä¸­çš„æŸ¥è¯¢å‚æ•° queryã€‚ è¿”å›å“åº”è§†å›¾å‡½æ•°å¯ä»¥è¿”å›å¤šç§ç±»å‹çš„å“åº”ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ã€HTMLã€JSONã€æˆ–è‡ªå®šä¹‰å“åº”å¯¹è±¡ã€‚ è¿”å›å­—ç¬¦ä¸²ï¼š @app.route(/message)def message(): return This is a simple message. è¿”å› HTML æ¨¡æ¿ï¼š from flask import render_template@app.route(/hello/name)def hello(name): return render_template(hello.html, name=name) render_template(hello.html, name=name)ï¼šæ¸²æŸ“ HTML æ¨¡æ¿ hello.HTMLï¼Œå¹¶å°† name å˜é‡ä¼ é€’ç»™æ¨¡æ¿ã€‚ è¿”å› JSON æ•°æ®ï¼š from flask import jsonify@app.route(/api/data)def api_data(): data = key: value return jsonify(data) jsonify(data)ï¼šå°† Python å­—å…¸è½¬æ¢ä¸º JSON å“åº”ã€‚ è¿”å›è‡ªå®šä¹‰å“åº”å¯¹è±¡ï¼š from flask import Response@app.route(/custom)def custom_response(): response = Response(Custom response with headers, status=200) response.headers[X-Custom-Header] = Value return response Response(Custom response with headers, status=200)ï¼šåˆ›å»ºè‡ªå®šä¹‰å“åº”å¯¹è±¡ï¼Œå¹¶è®¾ç½®å“åº”å¤´ã€‚ å¤„ç†è¯·æ±‚å’Œå“åº”è§†å›¾å‡½æ•°å¯ä»¥è®¿é—®è¯·æ±‚å¯¹è±¡ï¼Œå¹¶æ ¹æ®è¯·æ±‚æ•°æ®ç”Ÿæˆå“åº”ã€‚å¯ä»¥ä½¿ç”¨ request å¯¹è±¡æ¥è·å–è¯·æ±‚çš„ä¿¡æ¯ï¼Œä½¿ç”¨ make_response æ¥åˆ›å»ºè‡ªå®šä¹‰å“åº”ã€‚ ä½¿ç”¨ request å¯¹è±¡ï¼š from flask import request@app.route(/info)def info(): user_agent = request.headers.get(User-Agent) return fYour user agent is user_agent ä½¿ç”¨ make_responseï¼š from flask import make_response@app.route(/header)def custom_header(): response = make_response(Response with custom header) response.headers[X-Custom-Header] = Value return response make_response(Response with custom header)ï¼šåˆ›å»ºå“åº”å¯¹è±¡å¹¶è®¾ç½®è‡ªå®šä¹‰å¤´ä¿¡æ¯ã€‚ å¤„ç†é”™è¯¯å¯ä»¥åœ¨è§†å›¾å‡½æ•°ä¸­å¤„ç†å¼‚å¸¸æˆ–é”™è¯¯ï¼Œæˆ–è€…é€šè¿‡ Flask æä¾›çš„é”™è¯¯å¤„ç†æœºåˆ¶æ¥å¤„ç†åº”ç”¨ä¸­çš„é”™è¯¯ã€‚ åœ¨è§†å›¾å‡½æ•°ä¸­å¤„ç†é”™è¯¯ï¼š @app.route(/divide/int:x/int:y)def divide(x, y): try: result = x / y return fResult: result except ZeroDivisionError: return Error: Division by zero, 400 ä½¿ç”¨ try-except è¯­å¥å¤„ç†é™¤é›¶é”™è¯¯ï¼Œå¹¶è¿”å›è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯å’ŒçŠ¶æ€ç ã€‚ å…¨å±€é”™è¯¯å¤„ç†ï¼š @app.errorhandler(404)def not_found(error): return Page not found, 404 @app.errorhandler(404)ï¼šå®šä¹‰å¤„ç† 404 é”™è¯¯çš„å‡½æ•°ã€‚ è§†å›¾å‡½æ•°çš„è£…é¥°å™¨é™¤äº† @app.routeï¼ŒFlask è¿˜æ”¯æŒå…¶ä»–è£…é¥°å™¨ï¼Œç”¨äºå®ç°æ›´å¤æ‚çš„åŠŸèƒ½ã€‚ ç¤ºä¾‹ï¼š **@app.before_request**ï¼šåœ¨æ¯ä¸ªè¯·æ±‚å¤„ç†ä¹‹å‰è¿è¡Œçš„å‡½æ•°ã€‚ **@app.after_request**ï¼šåœ¨æ¯ä¸ªè¯·æ±‚å¤„ç†ä¹‹åè¿è¡Œçš„å‡½æ•°ã€‚ **@app.teardown_request**ï¼šåœ¨è¯·æ±‚ç»“æŸåè¿è¡Œçš„å‡½æ•°ï¼Œç”¨äºæ¸…ç†å·¥ä½œã€‚ ç¤ºä¾‹è£…é¥°å™¨ä½¿ç”¨ï¼š @app.before_requestdef before_request(): print(Before request)@app.after_requestdef after_request(response): print(After request) return response@app.teardown_requestdef teardown_request(exception): print(Teardown request) çŠ¶æ€ç è§†å›¾å‡½æ•°ä¸ä»…å¯ä»¥è¿”å›å†…å®¹ï¼Œè¿˜å¯ä»¥æŒ‡å®š HTTP çŠ¶æ€ç ã€‚ @app.route(/status)def status(): return Everything is OK, 200 è¿”å›çŠ¶æ€ç  200 è¡¨ç¤ºè¯·æ±‚æˆåŠŸã€‚ è¿”å›å¸¦æœ‰çŠ¶æ€ç çš„å“åº”å¯¹è±¡ï¼š from flask import Response@app.route(/error)def error(): return Response(An error occurred, status=500) è¿”å›çŠ¶æ€ç  500 è¡¨ç¤ºæœåŠ¡å™¨å†…éƒ¨é”™è¯¯ã€‚ è¡¨å•å¤„ç†åœ¨ Flask ä¸­ï¼Œè¡¨å•å¤„ç†æ˜¯æ„å»º Web åº”ç”¨æ—¶ä¸€ä¸ªå¸¸è§çš„éœ€æ±‚ã€‚ å¤„ç†è¡¨å•æ•°æ®æ¶‰åŠåˆ°æ¥æ”¶ã€éªŒè¯å’Œå¤„ç†ç”¨æˆ·æäº¤çš„è¡¨å•ã€‚Flask æä¾›äº†åŸºæœ¬çš„è¡¨å•å¤„ç†åŠŸèƒ½ï¼Œä½†é€šå¸¸ç»“åˆ Flask-WTF æ‰©å±•æ¥ç®€åŒ–è¡¨å•æ“ä½œå’ŒéªŒè¯ã€‚ åŸºæœ¬è¡¨å•å¤„ç†ï¼šä½¿ç”¨ request.form è·å–è¡¨å•æ•°æ®ã€‚ ä½¿ç”¨ Flask-WTFï¼šç»“åˆ WTForms è¿›è¡Œè¡¨å•å¤„ç†å’ŒéªŒè¯ï¼Œç®€åŒ–è¡¨å•æ“ä½œã€‚ è¡¨å•éªŒè¯ï¼šä½¿ç”¨éªŒè¯å™¨ç¡®ä¿è¡¨å•æ•°æ®çš„æœ‰æ•ˆæ€§ã€‚ æ–‡ä»¶ä¸Šä¼ ï¼šå¤„ç†æ–‡ä»¶ä¸Šä¼ å’Œä¿å­˜æ–‡ä»¶ã€‚ CSRF ä¿æŠ¤ï¼šç¡®ä¿è¡¨å•å…å—è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»ã€‚ åŸºæœ¬è¡¨å•å¤„ç†Flask æä¾›äº†ç›´æ¥å¤„ç†è¡¨å•æ•°æ®çš„æ–¹å¼ï¼Œä½¿ç”¨ request å¯¹è±¡æ¥è·å–æäº¤çš„æ•°æ®ã€‚ åˆ›å»º HTML è¡¨å• templatesform.HTML !DOCTYPE htmlhtmlhead titleForm Example/title/headbody form action=/submit method=post label for=nameName:/label input type=text id=name name=name br label for=emailEmail:/label input type=email id=email name=email br input type=submit value=Submit /form/body/html action=/submitï¼šè¡¨å•æ•°æ®æäº¤åˆ° submit è·¯å¾„ã€‚ method=postï¼šä½¿ç”¨ POST æ–¹æ³•æäº¤æ•°æ®ã€‚ å¤„ç†è¡¨å•æ•°æ® app.py from flask import Flask, render_template, requestapp = Flask(__name__)@app.route(/)def form(): return render_template(form.html)@app.route(/submit, methods=[POST])def submit(): name = request.form.get(name) email = request.form.get(email) return fName: name, Email: emailif __name__ == __main__: app.run(debug=True) request.form.get(name) å’Œ request.form.get(email)ï¼šè·å–æäº¤çš„è¡¨å•æ•°æ®ã€‚ ä½¿ç”¨ Flask-WTF æ‰©å±•Flask-WTF æ˜¯ä¸€ä¸ªå°è£…äº† WTForms çš„æ‰©å±•ï¼Œæä¾›äº†è¡¨å•å¤„ç†å’ŒéªŒè¯çš„åŠŸèƒ½ï¼Œä½¿å¾—è¡¨å•å¤„ç†æ›´åŠ ç®€æ´å’Œå¼ºå¤§ã€‚ å®‰è£… Flask-WTF pip install flask-wtf# wtforms3.0 åéœ€è¦é¢å¤–å®‰è£…email-validatoråŒ…pip install email-validator app.py from flask import Flask, render_template, redirect, url_forfrom flask_wtf import FlaskFormfrom wtforms import StringField, EmailField, SubmitFieldfrom wtforms.validators import DataRequired, Emailapp = Flask(__name__)app.secret_key = your_secret_key # Required for form protectionclass MyForm(FlaskForm): name = StringField(Name, validators=[DataRequired()]) email = EmailField(Email, validators=[DataRequired(), Email()]) submit = SubmitField(Submit)@app.route(/, methods=[GET, POST])def form(): form = MyForm() if form.validate_on_submit(): name = form.name.data email = form.email.data return fName: name, Email: email return render_template(form.html, form=form)if __name__ == __main__: app.run(debug=True) templatesform.HTML !DOCTYPE htmlhtmlhead titleForm Example/title/headbody form method=post form.hidden_tag() div form.name.label br form.name(size=32) /div div form.email.label br form.email(size=32) /div div form.submit() /div /form/body/html form.hidden_tag() ï¼šç”Ÿæˆéšè—å­—æ®µï¼Œç”¨äºä¿æŠ¤è¡¨å•å…å— CSRF æ”»å‡»ã€‚ form.name.label å’Œ form.name(size = 32) ï¼šæ¸²æŸ“è¡¨å•å­—æ®µåŠå…¶æ ‡ç­¾ã€‚ è¡¨å•éªŒè¯Flask-WTF å’Œ WTForms æä¾›äº†ä¸°å¯Œçš„è¡¨å•éªŒè¯åŠŸèƒ½ã€‚ä½ å¯ä»¥ä½¿ç”¨å†…ç½®çš„éªŒè¯å™¨æˆ–è‡ªå®šä¹‰éªŒè¯å™¨æ¥ç¡®ä¿è¡¨å•æ•°æ®çš„æœ‰æ•ˆæ€§ã€‚ from wtforms import Form, StringField, EmailField, SubmitFieldfrom wtforms.validators import DataRequired, Email, Lengthclass MyForm(FlaskForm): name = StringField(Name, validators=[ DataRequired(), Length(min=1, max=50) ]) email = EmailField(Email, validators=[ DataRequired(), Email() ]) submit = SubmitField(Submit) DataRequired()ï¼šç¡®ä¿å­—æ®µä¸ä¸ºç©ºã€‚ Length(min=1, max=50)ï¼šé™åˆ¶å­—ç¬¦ä¸²çš„æœ€å°å’Œæœ€å¤§é•¿åº¦ã€‚ Email()ï¼šéªŒè¯å­—æ®µæ˜¯å¦ä¸ºæœ‰æ•ˆçš„ç”µå­é‚®ä»¶åœ°å€ã€‚ æ–‡ä»¶ä¸Šä¼ Flask è¿˜æ”¯æŒå¤„ç†æ–‡ä»¶ä¸Šä¼ ã€‚ä¸Šä¼ çš„æ–‡ä»¶å¯ä»¥é€šè¿‡ request.files è®¿é—®ã€‚ åˆ›å»ºæ–‡ä»¶ä¸Šä¼ è¡¨å• emplatesupload.HTML !DOCTYPE htmlhtmlhead titleUpload File/title/headbody form action=/upload method=post enctype=multipart/form-data label for=fileFile:/label input type=file id=file name=file br input type=submit value=Upload /form/body/html enctype=multipart/form-dataï¼šæŒ‡å®šè¡¨å•æ•°æ®çš„ç¼–ç ç±»å‹ï¼Œæ”¯æŒæ–‡ä»¶ä¸Šä¼ ã€‚ å¤„ç†æ–‡ä»¶ä¸Šä¼  app.py from flask import Flask, request, redirect, url_forapp = Flask(__name__)app.secret_key = your_secret_key@app.route(/upload, methods=[POST])def upload(): file = request.files.get(file) if file: filename = file.filename file.save(fuploads/filename) return fFile uploaded successfully: filename return No file uploadedif __name__ == __main__: app.run(debug=True) request.files.get(file)ï¼šè·å–ä¸Šä¼ çš„æ–‡ä»¶å¯¹è±¡ã€‚ file.save(fuploads/filename)ï¼šå°†æ–‡ä»¶ä¿å­˜åˆ°æŒ‡å®šç›®å½•ã€‚ CSRF ä¿æŠ¤Flask-WTF è‡ªåŠ¨ä¸ºè¡¨å•æä¾› CSRF ä¿æŠ¤ã€‚ä½ éœ€è¦é…ç½®ä¸€ä¸ªå¯†é’¥æ¥å¯ç”¨ CSRF ä¿æŠ¤ï¼Œå¹¶åœ¨æ¨¡æ¿ä¸­åŒ…å«éšè—çš„ CSRF ä»¤ç‰Œã€‚ é…ç½® CSRF ä¿æŠ¤ï¼š app.secret_key = your_secret_key åœ¨æ¨¡æ¿ä¸­æ·»åŠ  CSRF ä»¤ç‰Œï¼š form method=post form.hidden_tag() !-- Form fields here --/form è“å›¾ (Blueprints)Flask çš„è“å›¾ï¼ˆBlueprintsï¼‰æ˜¯ä¸€ç§ç»„ç»‡ä»£ç çš„æœºåˆ¶ï¼Œå…è®¸ä½ å°† Flask åº”ç”¨åˆ†è§£æˆå¤šä¸ªæ¨¡å—ã€‚è¿™æ ·å¯ä»¥æ›´å¥½åœ°ç»„ç»‡åº”ç”¨é€»è¾‘ï¼Œä½¿å¾—åº”ç”¨æ›´å…·å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚ æ¯ä¸ªè“å›¾å¯ä»¥æœ‰è‡ªå·±çš„è·¯ç”±ã€è§†å›¾å‡½æ•°ã€æ¨¡æ¿å’Œé™æ€æ–‡ä»¶ï¼Œè¿™æ ·å¯ä»¥å°†ç›¸å…³çš„åŠŸèƒ½åˆ†ç»„ã€‚ é€šè¿‡ä½¿ç”¨è“å›¾ï¼Œä½ å¯ä»¥å°† Flask åº”ç”¨æ‹†åˆ†æˆå¤šä¸ªæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—å¤„ç†ç›¸å…³çš„åŠŸèƒ½ï¼Œä½¿å¾—ä»£ç æ›´åŠ æ¸…æ™°å’Œæ˜“äºç®¡ç†ã€‚ åˆ›å»ºè“å›¾ï¼šåœ¨ç‹¬ç«‹çš„æ¨¡å—ä¸­å®šä¹‰è“å›¾ï¼Œå¹¶æŒ‡å®šè·¯ç”±å’Œè§†å›¾å‡½æ•°ã€‚ æ³¨å†Œè“å›¾ï¼šåœ¨ä¸»åº”ç”¨ä¸­æ³¨å†Œè“å›¾ï¼Œå¹¶è®¾ç½®è·¯ç”±å‰ç¼€ã€‚ ä½¿ç”¨è“å›¾ä¸­çš„æ¨¡æ¿å’Œé™æ€æ–‡ä»¶ï¼šå°†æ¨¡æ¿å’Œé™æ€æ–‡ä»¶æ”¾åœ¨è“å›¾çš„ templates å’Œ static æ–‡ä»¶å¤¹ä¸­ã€‚ ä½¿ç”¨è¯·æ±‚é’©å­å’Œé”™è¯¯å¤„ç†ï¼šåœ¨è“å›¾ä¸­å®šä¹‰è¯·æ±‚é’©å­å’Œé”™è¯¯å¤„ç†å‡½æ•°ã€‚ åˆ›å»ºè“å›¾åˆ›å»ºè“å›¾æ¶‰åŠåˆ°ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š å®šä¹‰è“å›¾ï¼š åœ¨ä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ï¼ˆæ–‡ä»¶ï¼‰ä¸­å®šä¹‰è“å›¾ã€‚ æ³¨å†Œè“å›¾ï¼š åœ¨ä¸»åº”ç”¨ä¸­æ³¨å†Œè“å›¾ï¼Œä½¿å…¶ç”Ÿæ•ˆã€‚ å‡è®¾æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªåšå®¢åº”ç”¨ï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·ç®¡ç†å’Œåšå®¢åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›åŠŸèƒ½åˆ†æˆä¸¤ä¸ªè“å›¾ï¼šauth å’Œ blogã€‚ é¡¹ç›®ç»“æ„ï¼š yourapp/â”‚â”œâ”€â”€ app.pyâ”œâ”€â”€ auth/â”‚ â”œâ”€â”€ __init__.pyâ”‚ â””â”€â”€ routes.pyâ”‚â””â”€â”€ blog/ â”œâ”€â”€ __init__.py â””â”€â”€ routes.py å®šä¹‰è“å›¾ authroutes.py from flask import Blueprint, render_template, request, redirect, url_forauth = Blueprint(auth, __name__)@auth.route(/login)def login(): return render_template(login.html)@auth.route(/logout)def logout(): return redirect(url_for(auth.login))@auth.route(/register)def register(): return render_template(register.html) Blueprint(â€˜authâ€™, name **)**ï¼šåˆ›å»ºä¸€ä¸ªåä¸º auth çš„è“å›¾ã€‚ è“å›¾ä¸­å®šä¹‰çš„è·¯ç”±å‡½æ•°å¯ä»¥ç”¨æ¥å¤„ç†è¯·æ±‚ã€‚ blogroutes.py from flask import Blueprint, render_templateblog = Blueprint(blog, __name__)@blog.route(/)def index(): return render_template(index.html)@blog.route(/post/int:post_id)def post(post_id): return fPost ID: post_id Blueprint(â€˜blogâ€™, name **)**ï¼šåˆ›å»ºä¸€ä¸ªåä¸º blog çš„è“å›¾ã€‚ æ³¨å†Œè“å›¾ app.py from flask import Flaskapp = Flask(__name__)# å¯¼å…¥è“å›¾from auth.routes import authfrom blog.routes import blog# æ³¨å†Œè“å›¾app.register_blueprint(auth, url_prefix=/auth)app.register_blueprint(blog, url_prefix=/blog)if __name__ == __main__: app.run(debug=True) app.register_blueprint(auth, url_prefix=/auth)ï¼šæ³¨å†Œ auth è“å›¾ï¼Œå¹¶å°†æ‰€æœ‰çš„è·¯ç”±å‰ç¼€è®¾ç½®ä¸º /authã€‚ app.register_blueprint(blog, url_prefix=/blog)ï¼šæ³¨å†Œ blog è“å›¾ï¼Œå¹¶å°†æ‰€æœ‰çš„è·¯ç”±å‰ç¼€è®¾ç½®ä¸º /blogã€‚ ä½¿ç”¨è“å›¾ä¸­çš„æ¨¡æ¿å’Œé™æ€æ–‡ä»¶è“å›¾ä¸­çš„æ¨¡æ¿å’Œé™æ€æ–‡ä»¶åº”æ”¾åœ¨è“å›¾çš„æ–‡ä»¶å¤¹ä¸‹çš„ templates å’Œ static å­æ–‡ä»¶å¤¹ä¸­ã€‚ é¡¹ç›®ç»“æ„ï¼š yourapp/â”‚â”œâ”€â”€ app.pyâ”œâ”€â”€ auth/â”‚ â”œâ”€â”€ __init__.pyâ”‚ â”œâ”€â”€ routes.pyâ”‚ â””â”€â”€ templates/â”‚ â”œâ”€â”€ login.htmlâ”‚ â””â”€â”€ register.htmlâ”‚â””â”€â”€ blog/ â”œâ”€â”€ __init__.py â”œâ”€â”€ routes.py â””â”€â”€ templates/ â”œâ”€â”€ index.html â””â”€â”€ post.html åœ¨è“å›¾ä¸­ä½¿ç”¨è¯·æ±‚é’©å­è“å›¾æ”¯æŒè¯·æ±‚é’©å­ï¼Œä¾‹å¦‚ before_request å’Œ after_requestï¼Œå¯ä»¥åœ¨è“å›¾ä¸­å®šä¹‰è¿™äº›é’©å­æ¥å¤„ç†è¯·æ±‚å’Œå“åº”ã€‚ authroutes.py @auth.before_app_requestdef before_request(): # æ‰§è¡Œåœ¨æ¯ä¸ªè¯·æ±‚ä¹‹å‰çš„æ“ä½œ pass@auth.after_app_requestdef after_request(response): # æ‰§è¡Œåœ¨æ¯ä¸ªè¯·æ±‚ä¹‹åçš„æ“ä½œ return response åœ¨è“å›¾ä¸­å®šä¹‰é”™è¯¯å¤„ç†è“å›¾ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„é”™è¯¯å¤„ç†å‡½æ•°ã€‚ blogroutes.py @blog.errorhandler(404)def page_not_found(error): return Page not found, 404 é”™è¯¯å¤„ç†Flask æä¾›äº†çµæ´»çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œå¯ä»¥æ•è·å¹¶å¤„ç†åº”ç”¨ä¸­çš„å„ç§é”™è¯¯ã€‚ ä»¥ä¸‹æ˜¯è¯¦ç»†çš„è¯´æ˜ï¼Œæ¶µç›–äº†å¦‚ä½•å®šä¹‰å’Œå¤„ç†é”™è¯¯ï¼Œå¦‚ä½•å¤„ç† HTTP çŠ¶æ€ç ä»¥åŠå¦‚ä½•å¤„ç†è‡ªå®šä¹‰é”™è¯¯ã€‚ å¤„ç† HTTP é”™è¯¯ï¼šä½¿ç”¨ @app.errorhandler è£…é¥°å™¨å®šä¹‰é’ˆå¯¹ç‰¹å®š HTTP çŠ¶æ€ç çš„é”™è¯¯å¤„ç†å‡½æ•°ã€‚ è“å›¾ä¸­çš„é”™è¯¯å¤„ç†ï¼šåœ¨è“å›¾ä¸­å®šä¹‰é”™è¯¯å¤„ç†å‡½æ•°ï¼Œå…è®¸æ¨¡å—åŒ–çš„é”™è¯¯å¤„ç†ã€‚ è‡ªå®šä¹‰é”™è¯¯ï¼šå®šä¹‰è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼Œå¹¶åœ¨åº”ç”¨ä¸­æ•è·å’Œå¤„ç†è¿™äº›å¼‚å¸¸ã€‚ å…¨å±€é”™è¯¯å¤„ç†ï¼šä½¿ç”¨å…¨å±€é”™è¯¯å¤„ç†å‡½æ•°æ•è·æ‰€æœ‰æœªå¤„ç†çš„å¼‚å¸¸ã€‚ ä½¿ç”¨ abort å‡½æ•°ï¼šåœ¨è§†å›¾å‡½æ•°ä¸­ä¸»åŠ¨è§¦å‘ HTTP é”™è¯¯ã€‚ æ¸²æŸ“è‡ªå®šä¹‰é”™è¯¯é¡µé¢ï¼šä¸ºæ¯ä¸ªé”™è¯¯ç åˆ›å»ºè‡ªå®šä¹‰çš„ HTML é”™è¯¯é¡µé¢ã€‚ å¤„ç† HTTP é”™è¯¯Flask å…è®¸ä½ å®šä¹‰é’ˆå¯¹ç‰¹å®š HTTP çŠ¶æ€ç çš„é”™è¯¯å¤„ç†å‡½æ•°ã€‚è¿™äº›å¤„ç†å‡½æ•°å¯ä»¥ç”¨äºæ•è·å¹¶å¤„ç†åº”ç”¨ä¸­çš„å¸¸è§é”™è¯¯ï¼Œå¦‚ 404 é¡µé¢æœªæ‰¾åˆ°é”™è¯¯ã€500 æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ç­‰ã€‚ app.py from flask import Flask, render_templateapp = Flask(__name__)@app.route(/)def index(): return Welcome to the homepage!@app.errorhandler(404)def page_not_found(error): return render_template(404.html), 404@app.errorhandler(500)def internal_server_error(error): return render_template(500.html), 500if __name__ == __main__: app.run(debug=True) **@app.errorhandler(404)**ï¼šæ•è· 404 é”™è¯¯ï¼Œå¹¶è¿”å›è‡ªå®šä¹‰çš„ 404 é”™è¯¯é¡µé¢ã€‚ **@app.errorhandler(500)**ï¼šæ•è· 500 é”™è¯¯ï¼Œå¹¶è¿”å›è‡ªå®šä¹‰çš„ 500 é”™è¯¯é¡µé¢ã€‚ ä½¿ç”¨è“å›¾ä¸­çš„é”™è¯¯å¤„ç†è“å›¾ï¼ˆBlueprintsï¼‰ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„é”™è¯¯å¤„ç†å‡½æ•°ã€‚è¿™ä½¿å¾—æ¯ä¸ªæ¨¡å—å¯ä»¥æœ‰è‡ªå·±çš„é”™è¯¯å¤„ç†é€»è¾‘ã€‚ authroutes.py from flask import Blueprint, render_templateauth = Blueprint(auth, __name__)@auth.errorhandler(404)def auth_not_found(error): return render_template(auth_404.html), 404 app.py from flask import Flaskfrom auth.routes import authapp = Flask(__name__)app.register_blueprint(auth, url_prefix=/auth)if __name__ == __main__: app.run(debug=True) å¤„ç†è‡ªå®šä¹‰é”™è¯¯ä½ å¯ä»¥å®šä¹‰è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼Œå¹¶åœ¨åº”ç”¨ä¸­æ•è·å’Œå¤„ç†è¿™äº›å¼‚å¸¸ã€‚è¿™å…è®¸ä½ åœ¨åº”ç”¨ä¸­å®ç°æ›´å¤æ‚çš„é”™è¯¯å¤„ç†é€»è¾‘ã€‚ è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼š class CustomError(Exception): pass æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸ï¼š @app.route(/raise_custom_error)def raise_custom_error(): raise CustomError(This is a custom error.) å¤„ç†è‡ªå®šä¹‰å¼‚å¸¸ï¼š @app.errorhandler(CustomError)def handle_custom_error(error): return str(error), 400 å…¨å±€é”™è¯¯å¤„ç†å¦‚æœä½ å¸Œæœ›åœ¨æ•´ä¸ªåº”ç”¨ä¸­å¤„ç†æ‰€æœ‰æœªå¤„ç†çš„å¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨å…¨å±€é”™è¯¯å¤„ç†å‡½æ•°ã€‚è¿™äº›å¤„ç†å‡½æ•°å¯ä»¥æ•è·æ‰€æœ‰æœªè¢«æ˜¾å¼æ•è·çš„é”™è¯¯ã€‚ app.py @app.errorhandler(Exception)def handle_exception(error): # å¤„ç†æ‰€æœ‰å¼‚å¸¸ return fAn error occurred: error, 500 ä½¿ç”¨ abort å‡½æ•°Flask æä¾›äº†ä¸€ä¸ª abort å‡½æ•°ï¼Œç”¨äºåœ¨è§†å›¾å‡½æ•°ä¸­ä¸»åŠ¨è§¦å‘ HTTP é”™è¯¯ã€‚è¿™å¯ä»¥ç”¨äºåœ¨ç‰¹å®šæ¡ä»¶ä¸‹è¿”å›é”™è¯¯å“åº”ã€‚ from flask import abort@app.route(/abort_example)def abort_example(): abort(403) # è¿”å› 403 Forbidden é”™è¯¯ **abort(403)**ï¼šè§¦å‘ 403 é”™è¯¯ï¼Œè‡ªåŠ¨è°ƒç”¨å¯¹åº”çš„é”™è¯¯å¤„ç†å‡½æ•°ã€‚ æ¸²æŸ“è‡ªå®šä¹‰é”™è¯¯é¡µé¢å¯ä»¥ä¸ºæ¯ä¸ªé”™è¯¯ç åˆ›å»ºè‡ªå®šä¹‰çš„ HTML é¡µé¢ï¼Œä½¿å¾—é”™è¯¯é¡µé¢ä¸åº”ç”¨çš„æ•´ä½“è®¾è®¡ä¸€è‡´ã€‚ é¡¹ç›®ç»“æ„ç¤ºä¾‹ï¼š yourapp/â”‚â”œâ”€â”€ app.pyâ”œâ”€â”€ templates/â”‚ â”œâ”€â”€ 404.htmlâ”‚ â”œâ”€â”€ 500.htmlâ”‚ â””â”€â”€ auth_404.html è‡ªå®šä¹‰é”™è¯¯é¡µé¢ç¤ºä¾‹ï¼š templates404.HTML !doctype htmlhtml lang=enhead meta charset=utf-8 titlePage Not Found/title/headbody h1404 - Page Not Found/h1 pSorry, the page you are looking for does not exist./p/body/html Flask ä¸­é—´ä»¶å’Œæ‰©å±•åœ¨ Flask ä¸­ï¼Œä¸­é—´ä»¶å’Œæ‰©å±•æ˜¯å¢å¼ºå’Œæ‰©å±•åº”ç”¨åŠŸèƒ½çš„ä¸¤ä¸ªå…³é”®æœºåˆ¶ã€‚ é€šè¿‡ä¸­é—´ä»¶å’Œæ‰©å±•ï¼Œä½ å¯ä»¥å¤§å¤§å¢å¼º Flask åº”ç”¨çš„åŠŸèƒ½å’Œçµæ´»æ€§ï¼Œä½¿å¾—åº”ç”¨èƒ½å¤Ÿæ»¡è¶³å„ç§å¤æ‚çš„éœ€æ±‚ã€‚ ä¸‹é¢è¯¦ç»†ä»‹ç»è¿™ä¸¤è€…çš„æ¦‚å¿µå’Œå¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚ Flask ä¸­é—´ä»¶ï¼š ä½¿ç”¨è¯·æ±‚é’©å­åœ¨è¯·æ±‚å¤„ç†çš„ä¸åŒé˜¶æ®µæ’å…¥ä»£ç ã€‚ åˆ›å»ºè‡ªå®šä¹‰ä¸­é—´ä»¶ç±»æ¥å¤„ç†è¯·æ±‚å’Œå“åº”ã€‚ Flask æ‰©å±•ï¼š ä½¿ç”¨ç°æœ‰çš„æ‰©å±•ï¼ˆå¦‚ Flask-SQLAlchemyã€Flask-WTFï¼‰æ¥æ·»åŠ åŠŸèƒ½ã€‚ åˆ›å»ºè‡ªå®šä¹‰æ‰©å±•æ¥æ»¡è¶³ç‰¹å®šéœ€æ±‚ã€‚ ä¸­é—´ä»¶Flask çš„ä¸­é—´ä»¶ï¼ˆmiddlewareï¼‰æ˜¯å¯¹è¯·æ±‚å’Œå“åº”è¿›è¡Œå¤„ç†çš„é’©å­ï¼Œé€šå¸¸ç”¨äºåœ¨è¯·æ±‚åˆ°è¾¾è§†å›¾å‡½æ•°ä¹‹å‰æˆ–åœ¨å“åº”å‘é€åˆ°å®¢æˆ·ç«¯ä¹‹å‰æ‰§è¡Œä¸€äº›æ“ä½œã€‚ä¸­é—´ä»¶å¯ä»¥ç”¨äºæ—¥å¿—è®°å½•ã€è¯·æ±‚ä¿®æ”¹ã€å“åº”ä¿®æ”¹ç­‰ã€‚ è¯·æ±‚é’©å­è¯·æ±‚é’©å­å…è®¸ä½ åœ¨å¤„ç†è¯·æ±‚çš„ä¸åŒé˜¶æ®µæ’å…¥ä»£ç ï¼ŒFlask æä¾›äº†å‡ ç§é’©å­æ¥å¤„ç†è¯·æ±‚ç”Ÿå‘½å‘¨æœŸçš„ä¸åŒé˜¶æ®µï¼š **before_request**ï¼šåœ¨æ¯ä¸ªè¯·æ±‚å¤„ç†ä¹‹å‰æ‰§è¡Œã€‚ **after_request**ï¼šåœ¨æ¯ä¸ªè¯·æ±‚å¤„ç†ä¹‹åæ‰§è¡Œã€‚ **teardown_request**ï¼šè¯·æ±‚å¤„ç†ç»“æŸåï¼Œæ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸éƒ½ä¼šæ‰§è¡Œã€‚ **before_first_request**ï¼šä»…åœ¨åº”ç”¨ç¬¬ä¸€æ¬¡å¤„ç†è¯·æ±‚ä¹‹å‰æ‰§è¡Œã€‚ app.py from flask import Flask, requestapp = Flask(__name__)@app.before_requestdef before_request(): print(Before request)@app.after_requestdef after_request(response): print(After request) return response@app.teardown_requestdef teardown_request(exception): print(Teardown request)@app.route(/)def index(): return Hello, World!if __name__ == __main__: app.run(debug=True) @app.before_requestï¼šåœ¨æ¯ä¸ªè¯·æ±‚å¤„ç†ä¹‹å‰æ‰“å° â€œBefore requestâ€ã€‚ @app.after_requestï¼šåœ¨æ¯ä¸ªè¯·æ±‚å¤„ç†ä¹‹åæ‰“å° â€œAfter requestâ€ã€‚ @app.teardown_requestï¼šåœ¨æ¯ä¸ªè¯·æ±‚å¤„ç†åï¼ˆæ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼‰æ‰“å° â€œTeardown requestâ€ã€‚ è‡ªå®šä¹‰ä¸­é—´ä»¶Flask è¿˜å…è®¸ä½ åˆ›å»ºè‡ªå®šä¹‰ä¸­é—´ä»¶ç±»ï¼Œè¿™äº›ä¸­é—´ä»¶ç±»å¯ä»¥åœ¨è¯·æ±‚å’Œå“åº”å¤„ç†çš„å„ä¸ªé˜¶æ®µè¿›è¡Œæ“ä½œã€‚ middleware.py class CustomMiddleware: def __init__(self, app): self.app = app def __call__(self, environ, start_response): def custom_start_response(status, headers): headers.append((X-Custom-Header, Value)) return start_response(status, headers) return self.app(environ, custom_start_response) app.py from flask import Flaskfrom middleware import CustomMiddlewareapp = Flask(__name__)app.wsgi_app = CustomMiddleware(app.wsgi_app)@app.route(/)def index(): return Hello, World!if __name__ == __main__: app.run(debug=True) CustomMiddlewareï¼šè‡ªå®šä¹‰ä¸­é—´ä»¶ç±»ï¼Œæ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰å“åº”å¤´ã€‚ æ‰©å±•Flask æ‰©å±•æ˜¯ç”¨äºä¸º Flask åº”ç”¨æ·»åŠ åŠŸèƒ½çš„æ’ä»¶ã€‚Flask çš„æ‰©å±•å¯ä»¥é›†æˆç¬¬ä¸‰æ–¹åº“ï¼Œæä¾›ä¾‹å¦‚æ•°æ®åº“é›†æˆã€è¡¨å•å¤„ç†ã€ç”¨æˆ·è®¤è¯ç­‰åŠŸèƒ½ã€‚ å¸¸è§çš„ Flask æ‰©å±• Flask-SQLAlchemyï¼šé›†æˆ SQLAlchemy ORMï¼Œä½¿æ•°æ®åº“æ“ä½œæ›´æ–¹ä¾¿ã€‚ Flask-WTFï¼šé›†æˆ WTForms è¡¨å•åº“ï¼Œç®€åŒ–è¡¨å•å¤„ç†ã€‚ Flask-Loginï¼šæä¾›ç”¨æˆ·ä¼šè¯ç®¡ç†å’Œç”¨æˆ·è®¤è¯åŠŸèƒ½ã€‚ Flask-Migrateï¼šç”¨äºæ•°æ®åº“è¿ç§»çš„æ‰©å±•ï¼ŒåŸºäº Alembicã€‚ Flask-Mailï¼šç”¨äºå‘é€ç”µå­é‚®ä»¶ã€‚ å®‰è£…å’Œä½¿ç”¨ Flask æ‰©å±•ä»¥ Flask-SQLAlchemy ä¸ºä¾‹ï¼Œå®‰è£…ï¼š pip install flask-sqlalchemy é…ç½®å’Œä½¿ç”¨ï¼Œapp.py æ–‡ä»¶ä»£ç ï¼š from flask import Flaskfrom flask_sqlalchemy import SQLAlchemyapp = Flask(__name__)app.config[SQLALCHEMY_DATABASE_URI] = sqlite:///example.dbdb = SQLAlchemy(app)class User(db.Model): id = db.Column(db.Integer, primary_key=True) username = db.Column(db.String(80), unique=True, nullable=False)@app.route(/)def index(): return Hello, World!if __name__ == __main__: app.run(debug=True) SQLAlchemy æ‰©å±•é›†æˆäº† SQLAlchemyï¼Œä½¿å¾—ä½ å¯ä»¥è½»æ¾åœ°å®šä¹‰æ¨¡å‹å¹¶ä¸æ•°æ®åº“äº¤äº’ã€‚ åˆ›å»ºè‡ªå®šä¹‰æ‰©å±•å¦‚æœç°æœ‰çš„æ‰©å±•ä¸èƒ½æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œä½ å¯ä»¥åˆ›å»ºè‡ªå·±çš„æ‰©å±•ã€‚åˆ›å»ºè‡ªå®šä¹‰æ‰©å±•é€šå¸¸æ¶‰åŠåˆ°å®šä¹‰ä¸€ä¸ªç±»ï¼Œæä¾›åˆå§‹åŒ–é…ç½®å’Œç›¸å…³åŠŸèƒ½ã€‚ myextension.py class MyExtension: def __init__(self, app=None): if app is not None: self.init_app(app) def init_app(self, app): app.config.setdefault(MY_EXTENSION_CONFIG, default_value) app.after_request(self.after_request) def after_request(self, response): response.headers[X-My-Extension] = MyValue return response app.py from flask import Flaskfrom myextension import MyExtensionapp = Flask(__name__)my_ext = MyExtension(app)@app.route(/)def index(): return Hello, World!if __name__ == __main__: app.run(debug=True) MyExtensionï¼šè‡ªå®šä¹‰æ‰©å±•ï¼Œæ·»åŠ äº†ä¸€ä¸ªè‡ªå®šä¹‰å“åº”å¤´ã€‚","tags":["pythonã€flask"],"categories":["python"]},{"title":"circle-shop","path":"/2024/12/13/circle-shop/","content":"é¡¹ç›®æ¦‚è¿°é¡¹ç›®ç®€ä»‹ä¸»ç•Œé¢ä¸»è¦åŠŸèƒ½é¡¹ç›®ç‰¹ç‚¹éœ€æ±‚åˆ†æåŠŸèƒ½éœ€æ±‚ç”¨æˆ·æ³¨å†Œç”¨æˆ·ç™»å½•éªŒè¯ç å›¾å½¢éªŒè¯ç çŸ­ä¿¡éªŒè¯ç ä¸Šä¼ ç”¨æˆ·å¤´åƒéåŠŸèƒ½éœ€æ±‚ç”¨æˆ·è§’è‰²ç³»ç»Ÿæ¶æ„è®¾è®¡æŠ€æœ¯é€‰å‹æœ¬åœ°å­˜å‚¨ä¸ OSS ç»´åº¦ æœ¬åœ°å­˜å‚¨ OSSï¼ˆå¯¹è±¡å­˜å‚¨æœåŠ¡ï¼‰ æˆæœ¬ åˆæœŸæŠ•èµ„å¤§ï¼Œç¡¬ä»¶è´­ä¹°å’Œè¿ç»´æˆæœ¬é«˜ã€‚ æŒ‰éœ€ä»˜è´¹ï¼ŒæŒ‰å­˜å‚¨é‡å’Œæµé‡è®¡è´¹ï¼ŒåˆæœŸæ— å¤§é¢æŠ•èµ„ã€‚ å¯æ‰©å±•æ€§ æ‰©å±•æœ‰é™ï¼Œå¢åŠ å­˜å‚¨ç©ºé—´å’Œå¸¦å®½éœ€è¦ç¡¬ä»¶æŠ•å…¥ã€‚ å¼¹æ€§æ‰©å±•ï¼ŒæŒ‰éœ€æ‰©å±•ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„ã€‚ å¯é æ€§ å®¹é”™èƒ½åŠ›æœ‰é™ï¼Œéœ€è¦è‡ªè¡Œå¤„ç†å†—ä½™å’Œå¤‡ä»½ã€‚ é«˜å¯ç”¨æ€§ï¼Œæ•°æ®å†—ä½™è‡ªåŠ¨å¤„ç†ï¼Œæ”¯æŒå¤šæ•°æ®ä¸­å¿ƒã€‚ å®‰å…¨æ€§ éœ€è¦è‡ªè¡Œç®¡ç†è®¿é—®æ§åˆ¶ã€åŠ å¯†å’Œå¤‡ä»½ç­‰ã€‚ æä¾›å¼ºå¤§çš„åŠ å¯†ã€è®¿é—®æ§åˆ¶ã€èº«ä»½éªŒè¯å’Œå®¡è®¡æ—¥å¿—ã€‚ ç»´æŠ¤ä¸è¿ç»´ éœ€è¦æŠ•å…¥äººåŠ›è¿›è¡Œç¡¬ä»¶å’Œè½¯ä»¶çš„ç»´æŠ¤ã€ä¿®å¤ã€‚ ç”±äº‘å‚å•†è´Ÿè´£ç¡¬ä»¶å’Œè½¯ä»¶çš„ç»´æŠ¤ï¼Œè‡ªåŠ¨ä¿®å¤æ•…éšœã€‚ æ•°æ®è®¿é—® å±€åŸŸç½‘è®¿é—®è¾ƒå¿«ï¼Œè·¨åœ°åŸŸè®¿é—®è¾ƒæ…¢ã€‚ å…¨çƒåˆ†å¸ƒï¼Œä½å»¶è¿Ÿï¼Œé€‚åˆè·¨åœ°åŸŸã€å¤§è§„æ¨¡è®¿é—®ã€‚ çµæ´»æ€§ é…ç½®å’Œæ‰©å±•å¤æ‚ï¼Œçµæ´»æ€§è¾ƒä½ã€‚ é«˜çµæ´»æ€§ï¼Œæ”¯æŒä¸åŒç±»å‹çš„æ•°æ®å­˜å‚¨å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚ åˆè§„æ€§ éœ€è¦è‡ªè¡Œç®¡ç†åˆè§„è¦æ±‚å’Œå®¡è®¡ã€‚ äº‘å‚å•†æä¾›åˆè§„æ”¯æŒï¼Œå¦‚ GDPRã€ISO ç­‰ã€‚ ä½¿ç”¨å¤æ‚åº¦ é…ç½®å’Œç®¡ç†å¤æ‚ï¼Œéœ€è¦ä¸“ä¸šæŠ€æœ¯äººå‘˜ã€‚ ä½¿ç”¨ç®€å•ï¼Œé€šè¿‡ Web æ§åˆ¶å°æˆ– API è¿›è¡Œç®¡ç†ã€‚ ç¾éš¾æ¢å¤ éœ€è¦è‡ªè¡Œè®¾è®¡å¤‡ä»½å’Œæ¢å¤æ–¹æ¡ˆã€‚ è‡ªåŠ¨åŒ–å¤‡ä»½å’Œæ¢å¤ï¼Œæ”¯æŒå¼‚åœ°ç¾éš¾æ¢å¤ã€‚ æ€»ç»“ï¼š æœ¬åœ°å­˜å‚¨ é€‚åˆå¯¹æ•°æ®æ§åˆ¶ã€æ€§èƒ½æœ‰é«˜åº¦è¦æ±‚çš„åœºæ™¯ï¼Œä½†æˆæœ¬ã€è¿ç»´ã€æ‰©å±•ç­‰æ–¹é¢å­˜åœ¨ä¸€å®šçš„æŒ‘æˆ˜ã€‚ OSS æä¾›äº†æ›´é«˜çš„å¼¹æ€§ã€å¯æ‰©å±•æ€§å’Œä¾¿æ·æ€§ï¼Œé€‚åˆå­˜å‚¨é‡å¤§ã€éœ€è¦å…¨çƒè®¿é—®æˆ–äº‘è®¡ç®—é›†æˆçš„åº”ç”¨ï¼Œæˆæœ¬ç›¸å¯¹è¾ƒä½ï¼Œè¿ç»´å‹åŠ›å°ã€‚ æ ¹æ®å¯¹æ¯”å­˜å‚¨æ¨èä½¿ç”¨é˜¿é‡Œäº‘ OSSã€‚ ç³»ç»Ÿæ¶æ„å›¾æ¨¡å—åˆ’åˆ†æ•°æ®åº“è®¾è®¡ER å›¾è¡¨ç»“æ„è®¾è®¡æ¥å£æ–‡æ¡£æ¥å£è§„èŒƒæ¥å£åˆ—è¡¨é¡¹ç›®éƒ¨ç½²é¡¹ç›®ç¯å¢ƒéƒ¨ç½²æ–‡æ¡£å¼€å‘è¿›åº¦é¡¹ç›®åˆ›å»ºåˆå§‹åŒ– åˆ›å»º Maven èšåˆå·¥ç¨‹ circle-shoppom.xml ?xml version=1.0 encoding=UTF-8?project xmlns=http://maven.apache.org/POM/4.0.0 xmlns:xsi=http://www.w3.org/2001/XMLSchema-instance xsi:schemaLocation=http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd modelVersion4.0.0/modelVersion groupIdgithub.lianyutian.cshop/groupId artifactIdcircle-shop/artifactId version1.0-SNAPSHOT/version packagingpom/packaging modules modulecshop-common/module modulecshop-user/module /modules properties java.version17/java.version maven.compiler.source17/maven.compiler.source maven.compiler.target17/maven.compiler.target project.build.sourceEncodingUTF-8/project.build.sourceEncoding !-- ç‰ˆæœ¬åŒ¹é…è¯´æ˜ -- !-- https://sca.aliyun.com/docs/2023/overview/version-explain/?spm=5176.29160081.0.0.74805c72WoVfdt -- !-- æŒ‡å®š SpringBoot ç‰ˆæœ¬ -- spring.boot.version3.2.4/spring.boot.version !-- æŒ‡å®š SpringCloud ç‰ˆæœ¬ -- spring.cloud.version2023.0.1/spring.cloud.version !-- æŒ‡å®š SpringCloudAlibaba ç‰ˆæœ¬ -- alibaba.cloud.version2023.0.1.0/alibaba.cloud.version !-- æŒ‡å®š lombok ç‰ˆæœ¬ -- lombok.version1.18.26/lombok.version !-- é€šç”¨å·¥å…·åŒ…ç‰ˆæœ¬ -- commons-lang3.version3.14.0/commons-lang3.version !-- gson ç‰ˆæœ¬ -- gson.version2.10.1/gson.version /properties dependencyManagement dependencies dependency groupIdorg.springframework.boot/groupId artifactIdspring-boot-dependencies/artifactId version$spring.boot.version/version typepom/type scopeimport/scope /dependency dependency groupIdorg.springframework.cloud/groupId artifactIdspring-cloud-dependencies/artifactId version$spring.cloud.version/version typepom/type scopeimport/scope /dependency dependency groupIdcom.alibaba.cloud/groupId artifactIdspring-cloud-alibaba-dependencies/artifactId version$alibaba.cloud.version/version typepom/type scopeimport/scope /dependency dependency groupIdorg.projectlombok/groupId artifactIdlombok/artifactId version$lombok.version/version /dependency dependency groupIdorg.apache.commons/groupId artifactIdcommons-lang3/artifactId version$commons-lang3.version/version /dependency dependency groupIdcom.google.code.gson/groupId artifactIdgson/artifactId version$gson.version/version /dependency /dependencies /dependencyManagement !-- åŠ å¿«ä»£ç åº“ä¸‹è½½ï¼Œ è¿™é‡Œä½¿ç”¨é˜¿é‡Œäº‘é•œåƒä»“åº“-- repositories repository idmaven-ali/id urlhttp://maven.aliyun.com/nexus/content/groups/public///url releases enabledtrue/enabled /releases snapshots enabledtrue/enabled updatePolicyalways/updatePolicy checksumPolicyfail/checksumPolicy /snapshots /repository /repositories pluginRepositories pluginRepository idpublic/id namealiyun nexus/name urlhttp://maven.aliyun.com/nexus/content/groups/public//url releases enabledtrue/enabled /releases snapshots enabledfalse/enabled /snapshots /pluginRepository /pluginRepositories !-- springboot æ‰“åŒ… docker é•œåƒä½¿ç”¨ -- build plugins plugin groupIdorg.springframework.boot/groupId artifactIdspring-boot-maven-plugin/artifactId version$spring.boot.version/version configuration addResourcestrue/addResources /configuration /plugin /plugins /build/project åˆ›å»ºå­æ¨¡å—é€šç”¨å·¥ç¨‹ cshop-commoncshop-commonpom.xml ?xml version=1.0 encoding=UTF-8?project xmlns=http://maven.apache.org/POM/4.0.0 xmlns:xsi=http://www.w3.org/2001/XMLSchema-instance xsi:schemaLocation=http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd modelVersion4.0.0/modelVersion parent groupIdgithub.lianyutian.cshop/groupId artifactIdcircle-shop/artifactId version1.0-SNAPSHOT/version /parent groupIdgithub.lianyutian.cshop.common/groupId artifactIdcshop-common/artifactId properties maven.compiler.source17/maven.compiler.source maven.compiler.target17/maven.compiler.target project.build.sourceEncodingUTF-8/project.build.sourceEncoding /properties dependencies dependency groupIdorg.projectlombok/groupId artifactIdlombok/artifactId /dependency dependency groupIdorg.springframework.boot/groupId artifactIdspring-boot-starter-web/artifactId /dependency dependency groupIdorg.apache.commons/groupId artifactIdcommons-lang3/artifactId /dependency dependency groupIdcom.google.code.gson/groupId artifactIdgson/artifactId /dependency /dependencies/project ç»Ÿä¸€å·¥å…·ç±»ä¸šåŠ¡çŠ¶æ€ç æšä¸¾ cshop-commonsrcmainJavagithublianyutiancshopcommonenumsBizCodeEnum.Java package github.lianyutian.cshop.common.enums;import lombok.Getter;/** * ç»Ÿä¸€ä¸šåŠ¡æšä¸¾çŠ¶æ€ç  * * @author lianyutian * @since 2024-12-13 13:27:13 * @version 1.0 * p æ•´ä¸ªçŠ¶æ€ç æ€»å…± 7 ä½ï¼Œå‰ 3 ä½è¡¨ç¤ºã€Œä¸šåŠ¡å¾®æœåŠ¡ã€çŠ¶æ€ç ï¼Œå 4 ä½è¡¨ç¤ºã€ŒæœåŠ¡å†…éƒ¨æ¥å£ã€çŠ¶æ€ç ï¼Œåç»­éœ€è¦å†è¿›è¡Œæ‹†åˆ†ã€‚ * å…¬å…±æ“ä½œï¼š110ã€‚ * ç”¨æˆ·æœåŠ¡ï¼š210ï¼Œ */@Getterpublic enum BizCodeEnum /** é€šç”¨æ“ä½œç  */ COMMON_OP_REPEAT(110001, é‡å¤æ“ä½œ), COMMON_PARAM_ERROR(110002, å‚æ•°é”™è¯¯), COMMON_SERVER_ERROR(110003, æœåŠ¡å¼‚å¸¸), COMMON_TOO_MANY_TRY(110004, å½“å‰è®¿é—®äººæ•°è¿‡å¤šï¼Œè¯·ç¨å€™å†è¯•...), /** ç”¨æˆ·å¾®æœåŠ¡éªŒè¯ç ç›¸å…³ 2101 å¼€å¤´ */ USER_PHONE_ERROR(2101001, æ‰‹æœºå·ä¸åˆæ³•), USER_CODE_FAST_LIMITED(2101002, éªŒè¯ç å·²å‘é€ï¼Œè¯·ç¨åå†å‘), USER_CODE_PHONE_ERROR(2101003, æ‰‹æœºéªŒè¯ç é”™è¯¯), USER_CODE_CAPTCHA_ERROR(2101004, å›¾å½¢éªŒè¯ç é”™è¯¯), USER_CODE_EMAIL_ERROR(2101005, é‚®ç®±éªŒè¯ç é”™è¯¯), USER_CODE_SMS_ERROR(2101006, çŸ­ä¿¡éªŒè¯ç é”™è¯¯), USER_CODE_SMS_SEND_ERROR(2101006, çŸ­ä¿¡å‘é€å¤±è´¥è¯·ç¨åé‡è¯•), USER_CODE_SMS_SEND_REPLICATE_ERROR(2101007, çŸ­ä¿¡éªŒè¯ç å·²å‘é€è¯·ç¨åé‡è¯•), USER_CODE_SEND_ERROR(2101008, éªŒè¯ç å‘é€å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•), /** ç”¨æˆ·å¾®æœåŠ¡è´¦å·ç›¸å…³ 2102 å¼€å¤´ */ USER_ACCOUNT_EXIST(2102001, ç”¨æˆ·å·²å­˜åœ¨), USER_ACCOUNT_UNREGISTER(2102002, ç”¨æˆ·ä¸å­˜åœ¨), USER_ACCOUNT_PWD_ERROR(2102003, ç”¨æˆ·è´¦å·æˆ–å¯†ç é”™è¯¯), USER_REFRESH_TOKEN_EMPTY(2102004, è¯·é‡æ–°ç™»å½•), USER_ACCOUNT_UNLOGIN(2102005, ç”¨æˆ·è´¦å·æœªç™»å½•), USER_LOGIN_SUCCESS(0, ç”¨æˆ·ç™»å½•æˆåŠŸ), USER_UPDATE_LOCK_FAIL(2102006, ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯è·å–é”å¤±è´¥), USER_INFO_SHOW_LOCK_FAIL(2102007, è¯»å–ç”¨æˆ·ä¿¡æ¯è·å–é”å¤±è´¥), /** ç”¨æˆ·å¾®æœåŠ¡ä¸Šä¼ ç›¸å…³ 2103 å¼€å¤´ */ USER_AVATAR_FILE_UPLOAD_ERROR(2103001, ç”¨æˆ·å¤´åƒä¸Šä¼ å¤±è´¥), /** ç”¨æˆ·å¾®æœåŠ¡æ”¶è´§åœ°å€ç›¸å…³ 2104 å¼€å¤´ */ USER_ADDRESS_NOT_EXITS(2104001, æ”¶è´§åœ°å€ä¸å­˜åœ¨), USER_ADDRESS_ADD_FAIL(2104002, æ–°å¢æ”¶è´§åœ°å€å¤±è´¥), USER_ADDRESS_DEL_FAIL(2104003, åˆ é™¤æ”¶è´§åœ°å€å¤±è´¥), /** ç”¨æˆ·å…³æ³¨ã€å–æ¶ˆ 2105 å¼€å¤´ åšä¸»å…³æ³¨ã€å–æ¶ˆ */ USER_FOLLOWER_NOT_SELF(2105001, ä¸èƒ½å…³æ³¨è‡ªå·±å“¦), USER_UN_FOLLOWER_NOT_SELF(2105002, ä¸èƒ½å–å…³è‡ªå·±å“¦), USER_FOLLOWED(2105003, å·²ç»å…³æ³¨è¿‡äº†å“¦), USER_UN_FOLLOWED(2105004, å·²ç»å–å…³è¿‡äº†å“¦), USER_ATTENTION_NOT_SELF(2105005, åšä¸»ä¸èƒ½å…³æ³¨è‡ªå·±å“¦), USER_UN_ATTENTION_NOT_SELF(2105006, åšä¸»ä¸èƒ½å–å…³è‡ªå·±å“¦), USER_ATTENTED(2105007, å·²ç»å…³æ³¨è¿‡äº†å“¦), USER_UN_ATTENTED(2105008, å·²ç»å–å…³è¿‡äº†å“¦), USER_FOLLOWER_SUCCESS(0, å…³æ³¨æˆåŠŸ), USER_UN_FOLLOWER_SUCCESS(0, å–å…³æˆåŠŸ), USER_ATTENTION_SUCCESS(0, å…³æ³¨æˆåŠŸ), USER_UN_ATTENTION_SUCCESS(0, å–å…³æˆåŠŸ), USER_FOLLOWER_INFO_LOCK_FAIL(2105009, æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å…³æ³¨é”å¤±è´¥), /** ç”¨æˆ·ç¬”è®°ç›¸å…³ 2106 å¼€å¤´ */ NOTE_NOT_EXITS(2106001, ç¬”è®°ä¸å­˜åœ¨), NOTE_ADD_FAIL(2104002, æ–°å¢ç¬”è®°å¤±è´¥), NOTE_DEL_FAIL(2104003, åˆ é™¤ç¬”è®°å¤±è´¥), NOTE_UPDATE_FAIL(2102004, ç¬”è®°æ›´æ–°å¤±è´¥), NOTE_UPDATE_LOCK_FAIL(2104006, ä¿®æ”¹ç¬”è®°ä¿¡æ¯è·å–é”å¤±è´¥), NOTE_INFO_LOCK_FAIL(2102007, è¯»å–ç¬”è®°ä¿¡æ¯è·å–é”å¤±è´¥); /** é”™è¯¯ä¿¡æ¯ */ private final String message; /** çŠ¶æ€ç  */ private final int code; /** * ç¼–ç  * * @param code çŠ¶æ€ç  * @param message é”™è¯¯ä¿¡æ¯ */ BizCodeEnum(int code, String message) this.code = code; this.message = message; ç»Ÿä¸€æ¥å£å“åº” cshop-commonsrcmainJavagithublianyutiancshopcommonmodelApiResult.Java package github.lianyutian.cshop.common.model;import github.lianyutian.cshop.common.enums.BizCodeEnum;import lombok.AllArgsConstructor;import lombok.Data;import lombok.NoArgsConstructor;/** * æ¥å£ç»Ÿä¸€å“åº”å°è£… * * @author lianyutian * @since 2024-12-13 13:40:47 * @version 1.0 */@Data@AllArgsConstructor@NoArgsConstructorpublic class ApiResultT /** æ¥å£å“åº”çŠ¶æ€ç  0 è¡¨ç¤ºæˆåŠŸ å…¶ä»–è¡¨ç¤ºå¤±è´¥ */ private Integer code; /** æ•°æ® */ private T data; /** æè¿° */ private String msg; /** * æˆåŠŸå“åº” * * @return @see ApiResult */ public static T ApiResultT success() return new ApiResult(0, null, null); /** * æˆåŠŸå“åº”ï¼Œä¼ å…¥æ•°æ® * * @param data æ¥å£æ•°æ® * @return @see ApiResult */ public static T ApiResultT success(T data) return new ApiResult(0, data, null); /** * å¤±è´¥å“åº” * * @param code çŠ¶æ€ç  * @return @see ApiResult */ public static T ApiResultT error(Integer code, String msg) return new ApiResult(code, null, msg); /** * è‡ªå®šä¹‰çŠ¶æ€ç å’Œé”™è¯¯ä¿¡æ¯ * * @param code çŠ¶æ€ç  * @param msg é”™è¯¯ä¿¡æ¯ * @return @see ApiResult */ public static T ApiResultT buildResult(int code, String msg) return new ApiResult(code, null, msg); /** * é€šè¿‡æšä¸¾è¿”å› * * @param bizCodeEnum ä¸šåŠ¡æšä¸¾çŠ¶æ€ç  * @return @see ApiResult */ public static T ApiResultT result(BizCodeEnum bizCodeEnum) return ApiResult.buildResult(bizCodeEnum.getCode(), bizCodeEnum.getMessage()); ä¸šåŠ¡å¼‚å¸¸ç±» cshop-commonsrcmainJavagithublianyutiancshopcommonexceptionBizException.Java package github.lianyutian.cshop.common.exception;import github.lianyutian.cshop.common.enums.BizCodeEnum;import lombok.Data;import lombok.EqualsAndHashCode;/** * ä¸šåŠ¡å¼‚å¸¸ * * @author lianyutian * @since 2024-12-13 13:54:35 * @version 1.0 */@EqualsAndHashCode(callSuper = false)@Datapublic class BizException extends RuntimeException /** é»˜è®¤é”™è¯¯ç  */ private static final int DEFAULT_ERROR_CODE = -1; /** å¼‚å¸¸ code ç  */ private int code; /** å¼‚å¸¸æ¶ˆæ¯ */ private String message; /** * æ ¹æ® codeã€message è¿”å›å¼‚å¸¸ä¿¡æ¯ * * @param code é”™è¯¯ç  * @param message å¼‚å¸¸æ¶ˆæ¯ */ public BizException(int code, String message) super(message); this.code = code; this.message = message; /** æ ¹æ® BizCode è¿”å›å¼‚å¸¸ä¿¡æ¯ */ public BizException(BizCodeEnum bizCodeEnum) super(bizCodeEnum.getMessage()); this.code = bizCodeEnum.getCode(); this.message = bizCodeEnum.getMessage(); /** * æ ¹æ® errMsg è¿”å›å¼‚å¸¸ä¿¡æ¯ * * @param errorMsg é”™è¯¯ä¿¡æ¯ */ public BizException(String errorMsg) super(errorMsg); this.code = DEFAULT_ERROR_CODE; this.message = errorMsg; å…¨å±€å¼‚å¸¸å¤„ç† cshop-commonsrcmainJavagithublianyutiancshopcommonexceptionGlobalExceptionHandler.Java package github.lianyutian.cshop.common.exception;import github.lianyutian.cshop.common.model.ApiResult;import lombok.extern.slf4j.Slf4j;import org.springframework.http.HttpStatus;import org.springframework.web.bind.annotation.ControllerAdvice;import org.springframework.web.bind.annotation.ExceptionHandler;import org.springframework.web.bind.annotation.ResponseBody;/** * å…¨å±€å¼‚å¸¸å¤„ç† * * @author lianyutian * @since 2024-12-13 14:04:58 * @version 1.0 */@ControllerAdvice@Slf4jpublic class GlobalExceptionHandler @ExceptionHandler(value = Exception.class) @ResponseBody public ApiResultString handle(Exception e) // åˆ¤æ–­æ˜¯å¦æ˜¯ä¸šåŠ¡å¼‚å¸¸è¿˜æ˜¯éä¸šåŠ¡å¼‚å¸¸ if (e instanceof BizException bizException) log.error([è¿™é‡Œæ˜¯ä¸šåŠ¡å¼‚å¸¸ä¿¡æ¯]ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹: , e.getMessage(), e); return ApiResult.error(bizException.getCode(), bizException.getMessage()); else log.info([è¿™é‡Œæ˜¯ç³»ç»Ÿå¼‚å¸¸ä¿¡æ¯ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹: ], e.getMessage(), e); return ApiResult.error(HttpStatus.INTERNAL_SERVER_ERROR.value(), æœåŠ¡å¼‚å¸¸è¯·ç¨åé‡è¯•); é€šç”¨å·¥å…·ç±»JsonUtil cshop-commonsrcmainJavagithublianyutiancshopcommonutilsJsonUtil.Java package github.lianyutian.cshop.common.utils;import com.google.gson.Gson;import com.google.gson.JsonSyntaxException;import lombok.extern.slf4j.Slf4j;/** * Json å·¥å…·ç±» * * @author lianyutian * @since 2024-12-27 14:25:42 * @version 1.0 */@Slf4jpublic class JsonUtil private static final Gson GSON = new Gson(); /** * å°†å¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸² * * @param object éœ€è¦è½¬æ¢çš„å¯¹è±¡ * @return JSON å­—ç¬¦ä¸² * @throws IllegalArgumentException å¦‚æœè¾“å…¥å¯¹è±¡ä¸º null */ public static String toJson(Object object) if (object == null) throw new IllegalArgumentException(Input object cannot be null); return GSON.toJson(object); /** * å°† JSON å­—ç¬¦ä¸²è½¬æ¢ä¸ºæŒ‡å®šç±»å‹çš„å¯¹è±¡ * * @param json JSON å­—ç¬¦ä¸² * @param clazz ç›®æ ‡ç±»å‹ * @param T æ³›å‹ç±»å‹ * @return è½¬æ¢åçš„å¯¹è±¡ * @throws IllegalArgumentException å¦‚æœè¾“å…¥ JSON å­—ç¬¦ä¸²ä¸º null æˆ–ç©º * @throws JsonSyntaxException å¦‚æœ JSON å­—ç¬¦ä¸²æ ¼å¼ä¸æ­£ç¡® */ public static T T fromJson(String json, ClassT clazz) if (json == null || json.trim().isEmpty()) throw new IllegalArgumentException(Input JSON string cannot be null or empty); try return GSON.fromJson(json, clazz); catch (JsonSyntaxException e) log.error(Failed to parse JSON string: , json, e); throw e; CommonUtil cshop-commonsrcmainJavagithublianyutiancshopcommonutilsCommonUtil.Java package github.lianyutian.cshop.common.utils;import github.lianyutian.cshop.common.exception.BizException;import github.lianyutian.cshop.common.model.ApiResult;import jakarta.servlet.http.HttpServletRequest;import jakarta.servlet.http.HttpServletResponse;import java.io.IOException;import java.io.PrintWriter;import java.net.InetAddress;import java.net.UnknownHostException;import java.nio.charset.StandardCharsets;import java.security.MessageDigest;import java.security.NoSuchAlgorithmException;import java.util.Random;import java.util.UUID;import lombok.extern.slf4j.Slf4j;/** * é€šç”¨å·¥å…·ç±» * * @author lianyutian * @since 2024-12-17 14:57:04 * @version 1.0 */@Slf4jpublic class CommonUtil /** åŠ å¯†ä¸² */ private static final String SECRET_STRING = ./0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz; /** * è·å–å®¢æˆ·ç«¯ ip * * @param request HTTP è¯·æ±‚å¯¹è±¡ï¼Œç”¨äºè·å–å®¢æˆ·ç«¯ IP åœ°å€ * @return å®¢æˆ·ç«¯çš„ IP åœ°å€ * @throws RuntimeException å¦‚æœè·å– IP åœ°å€å¤±è´¥ */ public static String getRemoteIpAddr(HttpServletRequest request) String ipAddress; try // å°è¯•ä»è¯·æ±‚å¤´ä¸­è·å–å®¢æˆ·ç«¯ IP åœ°å€ ipAddress = request.getHeader(x-forwarded-for); if (ipAddress == null || ipAddress.isEmpty() || unknown.equalsIgnoreCase(ipAddress)) ipAddress = request.getHeader(Proxy-Client-IP); if (ipAddress == null || ipAddress.isEmpty() || unknown.equalsIgnoreCase(ipAddress)) ipAddress = request.getHeader(WL-Proxy-Client-IP); if (ipAddress == null || ipAddress.isEmpty() || unknown.equalsIgnoreCase(ipAddress)) // å¦‚æœè¯·æ±‚å¤´ä¸­æ²¡æœ‰ IP åœ°å€ä¿¡æ¯ï¼Œåˆ™ç›´æ¥è·å–è¿œç¨‹åœ°å€ ipAddress = request.getRemoteAddr(); if (127.0.0.1.equals(ipAddress)) // å¦‚æœæ˜¯æœ¬åœ°åœ°å€ï¼Œåˆ™å°è¯•è·å–æœ¬åœ°ä¸»æœºçš„ IP åœ°å€ InetAddress inet = InetAddress.getLocalHost(); ipAddress = inet.getHostAddress(); // å¤„ç†é€šè¿‡å¤šä¸ªä»£ç†çš„æƒ…å†µï¼Œæå–å‡ºçœŸå®çš„å®¢æˆ·ç«¯ IP åœ°å€ if (ipAddress != null ipAddress.length() 15) if (ipAddress.indexOf(,) 0) ipAddress = ipAddress.substring(0, ipAddress.indexOf(,)); if (ipAddress == null || ipAddress.isEmpty()) throw new RuntimeException(Failed to get remote IP address); catch (UnknownHostException e) log.error(e.getMessage(), e); throw new RuntimeException(Failed to get local host IP address, e); catch (Exception e) log.error(e.getMessage(), e); throw new RuntimeException(Failed to get remote IP address, e); return ipAddress; /** * MD5 åŠ å¯† * * @param data éœ€è¦åŠ å¯†çš„æ•°æ® * @return åŠ å¯†åçš„æ•°æ® * @throws RuntimeException å¦‚æœåŠ å¯†å¤±è´¥ */ public static String MD5(String data) try // åˆ›å»º MD5 åŠ å¯†å™¨å®ä¾‹ MessageDigest md = MessageDigest.getInstance(MD5); // å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†å¤„ç† byte[] array = md.digest(data.getBytes(StandardCharsets.UTF_8)); StringBuilder sb = new StringBuilder(); for (byte item : array) // å°†åŠ å¯†åçš„å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸² sb.append(Integer.toHexString((item 0xFF) | 0x100), 1, 3); // è¿”å›åŠ å¯†åçš„å­—ç¬¦ä¸² return sb.toString().toUpperCase(); catch (NoSuchAlgorithmException e) log.error(e.getMessage(), e); throw new RuntimeException(Failed to create MD5 digest, e); /** * ç”ŸæˆæŒ‡å®šé•¿åº¦çš„æ•°å­—éªŒè¯ç  * * @param length éªŒè¯ç çš„é•¿åº¦ * @return ç”Ÿæˆçš„æ•°å­—éªŒè¯ç  */ public static String getRandomCode(int length) String numbers = 0123456789; StringBuilder sb = new StringBuilder(); for (int i = 0; i length; i++) int index = (int) (Math.random() * numbers.length()); sb.append(numbers.charAt(index)); return sb.toString(); /** * è·å–å½“å‰æ—¶é—´æˆ³ * * @return å½“å‰æ—¶é—´æˆ³ */ public static long getCurrentTimestamp() return System.currentTimeMillis(); /** * ç”Ÿæˆ UUID * * @return ç”Ÿæˆçš„ UUID å­—ç¬¦ä¸² */ public static String generateUUID() return UUID.randomUUID().toString().replace(-, ); /** * å‘å®¢æˆ·ç«¯å‘é€ HTTP å“åº” æ­¤æ–¹æ³•ç”¨äºå°†ç»™å®šçš„ ApiResult å¯¹è±¡åºåˆ—åŒ–ä¸º JSON æ ¼å¼ * * p å¹¶é€šè¿‡ HttpServletResponse å¯¹è±¡å°†å…¶ä½œä¸º HTTP å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ å®ƒå¤„ç†å“åº”çš„åºåˆ—åŒ–å’Œå‘é€è¿‡ç¨‹ï¼Œå¹¶è®°å½•ç›¸å…³æ—¥å¿— * * @param response ç”¨äºå‘é€å“åº”çš„ HttpServletResponse å¯¹è±¡ * @param result è¦åºåˆ—åŒ–å¹¶å‘é€çš„ ApiResult å¯¹è±¡ */ public static void sendResponse(HttpServletResponse response, ApiResultVoid result) // è®¾ç½®å“åº”å¤´ response.setContentType(application/json; charset=utf-8); String jsonResponse; try // å°† ApiResult å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸² jsonResponse = JsonUtil.toJson(result); catch (Exception e) // è®°å½•åºåˆ—åŒ–å¼‚å¸¸ä¿¡æ¯ log.warn(åºåˆ—åŒ–å“åº”æ•°æ®å¼‚å¸¸ï¼š, e.getMessage(), e); // å¦‚æœåºåˆ—åŒ–å¤±è´¥ï¼ŒæŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸ throw new BizException(åºåˆ—åŒ–å“åº”æ•°æ®å¤±è´¥); try (PrintWriter writer = response.getWriter()) // å†™å‡ºå“åº” writer.print(jsonResponse); // åˆ·æ–°å“åº”ç¼“å†²åŒºï¼Œç¡®ä¿å“åº”è¢«å‘é€ response.flushBuffer(); catch (IOException e) // è®°å½•å‘é€å“åº”å¼‚å¸¸ä¿¡æ¯ log.warn(è¿”å›å“åº”ç»™å‰ç«¯å¼‚å¸¸ï¼š, e.getMessage(), e); // å¦‚æœå‘é€å“åº”å¤±è´¥ï¼ŒæŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸ throw new BizException(è¿”å›å“åº”ç»™å‰ç«¯å¤±è´¥); // å¦‚æœå¯ç”¨äº†ä¿¡æ¯çº§åˆ«æ—¥å¿—è®°å½•ï¼Œè®°å½•å‘é€çš„å“åº”æ•°æ® if (log.isInfoEnabled()) log.info(è¿”å›å“åº”ç»™å‰ç«¯æ•°æ®ï¼š, jsonResponse); /** * ç”ŸæˆåŒºé—´èŒƒå›´å†…çš„éšæœºæ•° * * @param min min * @param max max * @return éšæœºæ•° */ public static int genRandomInt(int min, int max) return genRandomInt(max - min) + min; /** * ç”Ÿæˆéšæœºæ•° * * @param bound bound * @return éšæœºæ•° */ public static int genRandomInt(int bound) return new Random().nextInt(bound); CheckUtil cshop-commonsrcmainJavagithublianyutiancshopcommonutilsCheckUtil.Java package github.lianyutian.cshop.common.utils;import java.util.regex.Matcher;import java.util.regex.Pattern;/** * æ ¡éªŒå·¥å…·ç±» * * @author lianyutian * @since 2024-12-19 13:38:22 * @version 1.0 */public class CheckUtil /** æ‰‹æœºå·æ­£åˆ™ */ private static final Pattern PHONE_PATTERN = Pattern.compile(^((13[0-9])|(15[^4,\\\\D])|(18[0,5-9]))\\\\d8$); /** * æ£€æµ‹æ˜¯å¦æ˜¯æ‰‹æœºå· * * @param phone æ‰‹æœºå· * @return boolean */ public static boolean isPhone(String phone) if (null == phone || .equals(phone)) return false; Matcher m = PHONE_PATTERN.matcher(phone); return m.matches(); BeanUtil cshop-commonsrcmainJavagithublianyutiancshopcommonutilsBeanUtil.Java package github.lianyutian.cshop.common.utils;import java.lang.reflect.Constructor;import java.util.ArrayList;import java.util.List;import java.util.Map;import java.util.concurrent.ConcurrentHashMap;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.BeanUtils;/** * Bean æ‹·è´å·¥å…·ç±» * * @author lianyutian * @since 2025-01-03 15:09:31 * @version 1.0 */@Slf4jpublic class BeanUtil private static final ConstructorCache CONSTRUCTOR_CACHE = new ConstructorCache(); public static T T copy(Object source, ClassT targetClass) if (source == null) return null; T target; try ConstructorT constructor = CONSTRUCTOR_CACHE.getConstructor(targetClass); target = constructor.newInstance(); BeanUtils.copyProperties(source, target); catch (ReflectiveOperationException e) log.error( Failed to copy properties from to , source.getClass().getName(), targetClass.getName(), e); throw new BeanCopyException(Failed to copy properties, e); return target; public static T ListT copyList(List? sourceList, ClassT targetClass) if (sourceList == null || sourceList.isEmpty()) return null; ListT targetList = new ArrayList(sourceList.size()); for (Object source : sourceList) T target = copy(source, targetClass); if (target != null) targetList.add(target); return targetList; private static class ConstructorCache private final MapClass?, Constructor? cache = new ConcurrentHashMap(); @SuppressWarnings(unchecked) public T ConstructorT getConstructor(ClassT clazz) throws ReflectiveOperationException ConstructorT constructor = (ConstructorT) cache.get(clazz); if (constructor == null) synchronized (cache) constructor = (ConstructorT) cache.get(clazz); if (constructor == null) try constructor = clazz.getDeclaredConstructor(); constructor.setAccessible(true); cache.put(clazz, constructor); catch (NoSuchMethodException e) throw new ReflectiveOperationException(e); return constructor; public static class BeanCopyException extends RuntimeException public BeanCopyException(String message, Throwable cause) super(message, cause); Redis pom.xml !-- redisson ç‰ˆæœ¬ --redisson.version3.41.0/redisson.version!-- https://mvnrepository.com/artifact/org.redisson/redisson --dependency groupIdorg.redisson/groupId artifactIdredisson/artifactId version$redisson.version/version/dependency cshop-commonpom.xml dependency groupIdorg.springframework.boot/groupId artifactIdspring-boot-starter-data-redis/artifactId/dependency!-- https://mvnrepository.com/artifact/org.redisson/redisson --dependency groupIdorg.redisson/groupId artifactIdredisson/artifactId/dependencydependencygroupIdorg.springframework.boot/groupIdartifactIdspring-boot-starter-data-redis/artifactId/dependency RedisConfig cshop-commonsrcmainJavagithublianyutiancshopcommonredisRedisConfig.Java package github.lianyutian.cshop.common.redis;import com.fasterxml.jackson.annotation.JsonAutoDetect;import com.fasterxml.jackson.annotation.PropertyAccessor;import com.fasterxml.jackson.databind.ObjectMapper;import org.redisson.Redisson;import org.redisson.api.RedissonClient;import org.redisson.client.codec.StringCodec;import org.redisson.config.Config;import org.springframework.beans.factory.annotation.Value;import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.data.redis.connection.RedisConnectionFactory;import org.springframework.data.redis.core.RedisTemplate;import org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;import org.springframework.data.redis.serializer.StringRedisSerializer;/** * redis å®¢æˆ·ç«¯é…ç½® * * @author lianyutian * @since 2024-12-17 14:36:40 * @version 1.0 */@Configuration@ConditionalOnClass(RedisConnectionFactory.class)// é…ç½®æ˜¯å¦ä½¿ç”¨ redis (enable = true æ—¶éœ€è¦é…ç½® redisï¼Œå¦åˆ™æœåŠ¡å¯åŠ¨æ—¶ä¼šæŠ¥é”™)@ConditionalOnProperty(prefix = spring.data.redis, name = enable, havingValue = true)public class RedisConfig @Value($spring.data.redis.host) private String redisHost; @Value($spring.data.redis.port) private String redisPort; @Value($spring.data.redis.password) private String redisPwd; @Value($spring.data.redis.timeout) private int redisTimeout; /** * é…ç½® RedisTemplate ç”¨äºæ“ä½œ Redis æ•°æ®åº“ * * @param redisConnectionFactory Redis è¿æ¥å·¥å‚ï¼Œç”¨äºåˆ›å»º Redis è¿æ¥ * @return é…ç½®å¥½çš„ RedisTemplate å®ä¾‹ */ @Bean public RedisTemplateObject, Object redisTemplate( RedisConnectionFactory redisConnectionFactory) // å®ä¾‹åŒ– RedisTemplate RedisTemplateObject, Object redisTemplate = new RedisTemplate(); // è®¾ç½®è¿æ¥ redisTemplate.setConnectionFactory(redisConnectionFactory); // é…ç½® Redis åºåˆ—åŒ–è§„åˆ™ // ä½¿ç”¨ Jackson ä½œä¸º JSON å¤„ç†åº“ã€‚è¯¥åºåˆ—åŒ–å™¨å¯ä»¥ç”¨äºå°† Java å¯¹è±¡å­˜å‚¨åˆ° Redis ä¸­æ—¶ï¼Œè‡ªåŠ¨è½¬æ¢ä¸º JSON å­—ç¬¦ä¸² ObjectMapper objectMapper = new ObjectMapper(); Jackson2JsonRedisSerializerObject jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer(objectMapper, Object.class); // è®¾ç½® ObjectMapper çš„å¯è§æ€§ï¼Œä»¥ä¾¿å®ƒå¯ä»¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ‰€æœ‰è®¿é—®çº§åˆ«çš„å±æ€§ objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY); // è®¾ç½® key-value åºåˆ—åŒ–è§„åˆ™ // ä½¿ç”¨ StringRedisSerializer åºåˆ—åŒ– keyï¼Œä»¥ç¡®ä¿ key æ˜¯å­—ç¬¦ä¸²å½¢å¼å­˜å‚¨ // ä½¿ç”¨ Jackson2JsonRedisSerializer åºåˆ—åŒ– valueï¼Œå°† Java å¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²å­˜å‚¨ redisTemplate.setKeySerializer(new StringRedisSerializer()); redisTemplate.setValueSerializer(jackson2JsonRedisSerializer); // è®¾ç½® hash-value åºåˆ—åŒ–è§„åˆ™ // åŒæ ·åœ°ï¼Œä½¿ç”¨ StringRedisSerializer åºåˆ—åŒ– hash çš„ keyï¼Œä½¿ç”¨ Jackson2JsonRedisSerializer åºåˆ—åŒ– hash çš„ value redisTemplate.setHashKeySerializer(new StringRedisSerializer()); redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer); return redisTemplate; /** * å®ä¾‹åŒ– redissonClient * * @return RedissonClient */ @Bean public RedissonClient redissonClient() Config config = new Config(); config .useSingleServer() .setAddress(redis:// + redisHost + : + redisPort) .setPassword(redisPwd) // è®¾ç½®è¿æ¥æ± æœ€å°ç©ºé—²å¤§å° .setConnectionMinimumIdleSize(10) // è®¾ç½®è¿æ¥æ± å¤§å° .setConnectionPoolSize(100) // è®¾ç½®ç©ºé—²é“¾æ¥è¶…æ—¶æ—¶é—´ .setIdleConnectionTimeout(600000) .setSubscriptionConnectionMinimumIdleSize(10) .setSubscriptionConnectionPoolSize(100) // è®¾ç½®è¶…æ—¶æ—¶é—´ .setTimeout(redisTimeout); config.setCodec(new StringCodec()); // è®¾ç½®çº¿ç¨‹æ•° config.setThreads(5); // è®¾ç½® netty çº¿ç¨‹æ•° config.setNettyThreads(5); // å®ä¾‹åŒ– redisson å®¢æˆ·ç«¯ return Redisson.create(config); RedisCache cshop-commonsrcmainJavagithublianyutiancshopcommonredisRedisCache.Java package github.lianyutian.cshop.common.redis;import github.lianyutian.cshop.common.utils.CommonUtil;import github.lianyutian.cshop.common.utils.JsonUtil;import java.util.concurrent.TimeUnit;import lombok.extern.slf4j.Slf4j;import org.springframework.boot.autoconfigure.condition.ConditionalOnBean;import org.springframework.data.redis.core.RedisTemplate;import org.springframework.data.redis.core.ValueOperations;import org.springframework.stereotype.Component;/** * Redis ç¼“å­˜å·¥å…·ç±» * * @author lianyutian * @since 2024-12-27 11:30:30 * @version 1.0 */@Component@ConditionalOnBean(RedisConfig.class)@Slf4jpublic class RedisCache private final RedisTemplateString, String redisTemplate; /** ç¼“å­˜ç©ºæ•°æ® */ public static final String EMPTY_CACHE = ; /** åˆ†å¸ƒå¼é”åŠ é”æ—¶é—´ 200 æ¯«ç§’ */ public static final long UPDATE_LOCK_TIMEOUT = 200; /** ä¸€å°æ—¶æœ‰æ•ˆæœŸ */ public static final Integer ONE_HOUR_SECONDS = 60 * 60; /** ä¸¤å¤©æœ‰æ•ˆæœŸ */ public static final Integer TWO_DAYS_SECONDS = 2 * 24 * 60 * 60; /** ä¸€å¤©æœ‰æ•ˆæœŸ */ public static final Integer ONE_DAY_SECONDS = 24 * 60 * 60; public RedisCache(RedisTemplateString, String redisTemplate) this.redisTemplate = redisTemplate; /** * ç”Ÿæˆç¼“å­˜è¿‡æœŸæ—¶é—´ï¼š2 å¤©åŠ ä¸Šéšæœºå‡ å°æ—¶ï¼Œé˜²æ­¢ç¼“å­˜é›ªå´©ï¼Œç©¿é€æ•°æ®åº“ * * @return è¿”å›è¿‡æœŸæ—¶é—´ */ public static Integer generateCacheExpire() return TWO_DAYS_SECONDS + CommonUtil.genRandomInt(0, 10) * 60 * 60; /** * ç”Ÿæˆç¼“å­˜ç©¿é€è¿‡æœŸæ—¶é—´ï¼Œå•ä½ ç§’ * * @return éšæœº 30 - 100 ç§’ */ public static Integer generateCachePenetrationExpire() return CommonUtil.genRandomInt(30, 100); /** * å†™å…¥ç¼“å­˜ * * @param key key * @param value value * @param seconds è®¾ç½®è¿‡æœŸæ—¶é—´ */ public void set(String key, String value, int seconds) ValueOperationsString, String op = redisTemplate.opsForValue(); try if (seconds 0) // è®¾ç½®ç¼“å­˜æ—¶é—´ op.set(key, value, seconds, TimeUnit.SECONDS); else if (seconds == 0) // æ°¸ä¸è¿‡æœŸ op.set(key, value); else throw new IllegalArgumentException(Expiration time must be a non-negative integer); catch (Exception e) log.error(å†™å…¥ç¼“å­˜å¤±è´¥, key: , value: [REDACTED], key, e); throw new RedisCacheException(å†™å…¥ç¼“å­˜å¤±è´¥, e); /** * å†™å…¥ç¼“å­˜ value ä¸º Object ç±»å‹ * * @param key key * @param value value * @param seconds è¿‡æœŸæ—¶é—´ */ public void set(String key, Object value, int seconds) try // å…ˆå°† Object è½¬æˆ Json å­—ç¬¦ä¸²å†è¿›è¡Œå­˜å‚¨ this.set(key, JsonUtil.toJson(value), seconds); catch (Exception e) log.error(å†™å…¥ç¼“å­˜å¤±è´¥, key: , value: [REDACTED], key, e); throw new RedisCacheException(å†™å…¥ç¼“å­˜å¤±è´¥, e); /** * è¯»å–ç¼“å­˜ * * @param key key * @return ç¼“å­˜æ•°æ® */ public String get(String key) try ValueOperationsString, String op = redisTemplate.opsForValue(); return op.get(key); catch (Exception e) log.error(è¯»å–ç¼“å­˜å¤±è´¥, key: , key, e); throw new RedisCacheException(è¯»å–ç¼“å­˜å¤±è´¥, e); /** * åˆ é™¤ç¼“å­˜ * * @param key key * @return åˆ é™¤æˆåŠŸè¿”å› trueï¼Œå¦åˆ™è¿”å› false */ public boolean delete(String key) try return Boolean.TRUE.equals(redisTemplate.delete(key)); catch (Exception e) log.error(åˆ é™¤ç¼“å­˜å¤±è´¥, key: , key, e); throw new RedisCacheException(åˆ é™¤ç¼“å­˜å¤±è´¥, e); /** * è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´ * * @param key key * @param seconds è¿‡æœŸæ—¶é—´ */ public void expire(String key, Integer seconds) if (key == null || key.isEmpty()) throw new IllegalArgumentException(Key cannot be null or empty); if (seconds == null || seconds 0) throw new IllegalArgumentException(Expiration time must be a non-negative integer); try redisTemplate.expire(key, seconds, TimeUnit.SECONDS); catch (Exception e) log.error(Failed to set expiration for key: , key, e); throw new RedisCacheException(Failed to set expiration for key: + key, e); /** * è·å–ç¼“å­˜è¿‡æœŸæ—¶é—´ * * @param key key * @param timeUnit æ—¶é—´ç±»å‹ * @return è¿‡æœŸæ—¶é—´ */ public Long getExpire(String key, TimeUnit timeUnit) if (key == null || key.isEmpty()) throw new IllegalArgumentException(Key cannot be null or empty); try return redisTemplate.getExpire(key, timeUnit); catch (Exception e) log.error(Failed to get expiration for key: , key, e); throw new RedisCacheException(Failed to get expiration for key: + key, e); /** * è·å–æ•´æ•°å€¼ * * @param key key * @return ç¼“å­˜æ•°æ® */ public Long getLong(String key) if (key == null || key.isEmpty()) throw new IllegalArgumentException(Key cannot be null or empty); try ValueOperationsString, String op = redisTemplate.opsForValue(); String value = op.get(key); return value != null ? Long.parseLong(value) : null; catch (NumberFormatException e) log.error(Failed to parse integer value for key: , key, e); throw new RedisCacheException(Failed to parse integer value for key: + key, e); catch (Exception e) log.error(Failed to get integer value for key: , key, e); throw new RedisCacheException(Failed to get integer value for key: + key, e); /** * å¢åŠ ç¼“å­˜å€¼ * * @param key key * @param delta å¢åŠ çš„å€¼ */ public void increment(String key, int delta) try ValueOperationsString, String op = redisTemplate.opsForValue(); op.increment(key, delta); catch (Exception e) log.error(Failed to increment value for key: , key, e); throw new RedisCacheException(Failed to increment value for key: + key, e); class RedisCacheException extends RuntimeException public RedisCacheException(String message, Throwable cause) super(message, cause); RedisLock cshop-commonsrcmainJavagithublianyutiancshopcommonredisRedisLock.Java package github.lianyutian.cshop.common.redis;import java.util.concurrent.TimeUnit;import org.redisson.api.RLock;import org.redisson.api.RedissonClient;import org.springframework.boot.autoconfigure.condition.ConditionalOnBean;import org.springframework.stereotype.Component;/** * Redis åˆ†å¸ƒå¼é” * * @author lianyutian * @since 2024-12-27 11:30:30 * @version 1.0 */@Component@ConditionalOnBean(RedissonClient.class)public class RedisLock /** åˆ†å¸ƒå¼é”åŠ é”æ—¶é—´ 200 æ¯«ç§’ */ public static final long UPDATE_LOCK_TIMEOUT = 200; private final RedissonClient redissonClient; public RedisLock(RedissonClient redissonClient) this.redissonClient = redissonClient; /** * redisson äº’æ–¥é”ï¼Œç­‰å¾… seconds ç§’åè‡ªåŠ¨å¤±æ•ˆ * * @param key key * @param seconds ç§’ * @return åŠ é”ç»“æœ */ public boolean lock(String key, int seconds) // å…ˆè·å–åˆ†å¸ƒå¼é” RLock rLock = redissonClient.getLock(key); // å¦‚æœå·²ç»åŠ é”äº†è¿”å› false if (rLock.isLocked()) return false; // åŠ é”ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´å†…æ²¡é‡Šæ”¾é”ï¼Œå®ƒä¼šè‡ªåŠ¨åœ¨åº•å±‚æŠŠé”é‡Šæ”¾æ‰ rLock.lock(seconds, TimeUnit.SECONDS); // åŠ é”æˆåŠŸè¿”å› true return true; /** * redisson äº’æ–¥é”ï¼Œè‡ªåŠ¨ç»­æœŸ * * @param key key * @return åŠ é”ç»“æœ */ public boolean lock(String key) // å…ˆè·å–åˆ†å¸ƒå¼é” RLock rLock = redissonClient.getLock(key); // å¦‚æœå·²ç»åŠ é”äº†è¿”å› false if (rLock.isLocked()) return false; // åŠ é” rLock.lock(); // åŠ é”æˆåŠŸè¿”å› true return true; /** * å°è¯•åŠ é” * * @param key key * @param timeout è¶…æ—¶æ—¶é—´ * @return åŠ é”ç»“æœ */ public boolean tryLock(String key, long timeout) throws InterruptedException // å…ˆè·å–åˆ†å¸ƒå¼é” RLock rLock = redissonClient.getLock(key); // å°è¯•åŠ é” return rLock.tryLock(timeout, TimeUnit.MILLISECONDS); /** * æ‰‹åŠ¨é‡Šæ”¾é” * * @param key key */ public void unlock(String key) // å…ˆè·å–åˆ†å¸ƒå¼é” RLock rLock = redissonClient.getLock(key); // å¦‚æœå·²é”å®šï¼Œåˆ™é‡Šæ”¾é” if (rLock.isLocked()) rLock.unlock(); ç”¨æˆ·æ¨¡å—æ–°å»º cshop-userpom.xml ?xml version=1.0 encoding=UTF-8?project xmlns=http://maven.apache.org/POM/4.0.0 xmlns:xsi=http://www.w3.org/2001/XMLSchema-instance xsi:schemaLocation=http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd modelVersion4.0.0/modelVersion parent groupIdgithub.lianyutian.cshop/groupId artifactIdcircle-shop/artifactId version1.0-SNAPSHOT/version /parent groupIdgithub.lianyutian.cshop.user/groupId artifactIdcshop-user/artifactId properties maven.compiler.source17/maven.compiler.source maven.compiler.target17/maven.compiler.target project.build.sourceEncodingUTF-8/project.build.sourceEncoding /properties dependencies dependency groupIdgithub.lianyutian.cshop.common/groupId artifactIdcshop-common/artifactId version1.0-SNAPSHOT/version /dependency /dependencies/project cshop-usersrcmainJavagithublianyutiancshopuserUserApplication.Java package github.lianyutian.cshop.user;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.context.annotation.ComponentScan;/** * ç”¨æˆ·æœåŠ¡å¯åŠ¨ç±» * * @author lianyutian * @since 2024-12-13 14:14:31 * @version 1.0 */@SpringBootApplication@ComponentScan(basePackages = github.lianyutian.cshop.user, github.lianyutian.cshop.common)public class UserApplication public static void main(String[] args) SpringApplication.run(UserApplication.class, args); cshop-usersrcmainresourcesapplication.yml # æœåŠ¡ç«¯å£server: port: 9001 spring: application: name: cshop-user # è®¾ç½®æ—¥å¿—çº§åˆ«ï¼šERROR/WARN/INFO/DEBUG,é»˜è®¤æ˜¯ INFO ä»¥ä¸Šæ‰æ˜¾ç¤ºlogging: level: root: INFO æµ‹è¯• cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserController.Java package github.lianyutian.cshop.user.controller;import github.lianyutian.cshop.common.utils.ApiResult;import org.springframework.web.bind.annotation.PostMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;/** * UserController * * @author lianyutian * @since 2024-12-13 14:19:30 * @version 1.0 */@RestController@RequestMapping(/api/user/v1)public class UserController @PostMapping(test) public ApiResultString test() int i = 1 / 0; return ApiResult.success(hello circle-shop); ç”¨æˆ·éªŒè¯ç å›¾å½¢éªŒè¯ç åŸºç¡€åŠŸèƒ½Kaptcha æ˜¯ä¸€ä¸ªå¼€æºçš„ Java å›¾å½¢éªŒè¯ç ç”Ÿæˆåº“ï¼Œå¸¸ç”¨äºåœ¨ Web åº”ç”¨ä¸­ç”ŸæˆéªŒè¯ç å›¾ç‰‡ã€‚ https://github.com/penggle/kaptcha pom.xml !-- å›¾å½¢éªŒè¯ç  kaptcha ç‰ˆæœ¬ --kaptcha.version2.3.2/kaptcha.version dependency\tgroupIdcom.github.penggle/groupId\tartifactIdkaptcha/artifactId\tversion$kaptcha.version/version/dependency cshop-userpom.xml dependency\tgroupIdcom.github.penggle/groupId\tartifactIdkaptcha/artifactId/dependency cshop-usersrcmainJavagithublianyutiancshopuserconfigKaptchaConfig.Java package github.lianyutian.cshop.user.config;import com.google.code.kaptcha.Constants;import com.google.code.kaptcha.impl.DefaultKaptcha;import com.google.code.kaptcha.util.Config;import java.util.Properties;import org.springframework.beans.factory.annotation.Qualifier;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;/** * Kaptcha é…ç½®ç±» * * @author lianyutian * @since 2024-12-17 11:15:02 * @version 1.0 */@Configurationpublic class KaptchaConfig @Bean @Qualifier(captchaProducer) public DefaultKaptcha producer() Properties properties = new Properties(); // è®¾ç½® Kaptcha ç”Ÿæˆçš„å›¾ç‰‡å®½åº¦(åƒç´ ) properties.setProperty(Constants.KAPTCHA_IMAGE_WIDTH, 200); // è®¾ç½® Kaptcha ç”Ÿæˆçš„å›¾ç‰‡é«˜åº¦(åƒç´ ) properties.setProperty(Constants.KAPTCHA_IMAGE_HEIGHT, 50); // è®¾ç½® Kaptcha æ–‡æœ¬å­—ä½“å¤§å° properties.setProperty(Constants.KAPTCHA_TEXTPRODUCER_FONT_SIZE, 40); // è®¾ç½® Kaptcha æ–‡æœ¬å­—ä½“é¢œè‰² properties.setProperty(Constants.KAPTCHA_TEXTPRODUCER_FONT_COLOR, black); // è®¾ç½® Kaptcha æ–‡æœ¬å­—ç¬¦é•¿åº¦ properties.setProperty(Constants.KAPTCHA_TEXTPRODUCER_CHAR_LENGTH, 5); // è®¾ç½® Kaptcha æ–‡æœ¬å­—ç¬¦é›†ä¸ºè‹±æ–‡å­—æ¯ï¼ˆå¤§å°å†™ï¼‰å’Œæ•°å­— properties.setProperty( Constants.KAPTCHA_TEXTPRODUCER_CHAR_STRING, abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890); // è®¾ç½® Kaptcha æ–‡æœ¬å­—ä½“ properties.setProperty(Constants.KAPTCHA_TEXTPRODUCER_FONT_NAMES, Arial); // NoNoise ç±»è¡¨ç¤ºä¸æ·»åŠ ä»»ä½•å™ªå£°ï¼Œå³ç”Ÿæˆçš„éªŒè¯ç å›¾ç‰‡å°†ä¸ä¼šæœ‰ä»»ä½•å¹²æ‰°çº¿æˆ–ç‚¹ã€‚ // é€šè¿‡è®¾ç½® Constants.KAPTCHA_NOISE_IMPL å±æ€§ï¼Œå¯ä»¥æ§åˆ¶éªŒè¯ç å›¾ç‰‡çš„æ ·å¼å’Œå¤æ‚åº¦ properties.setProperty(Constants.KAPTCHA_NOISE_IMPL, com.google.code.kaptcha.impl.NoNoise); Config config = new Config(properties); DefaultKaptcha defaultKaptcha = new DefaultKaptcha(); defaultKaptcha.setConfig(config); return defaultKaptcha; cshop-usersrcmainJavagithublianyutiancshopusercontrollerCaptchaController.Java package github.lianyutian.cshop.user.controller;import com.google.code.kaptcha.impl.DefaultKaptcha;import github.lianyutian.cshop.common.utils.CommonUtil;import jakarta.servlet.ServletOutputStream;import jakarta.servlet.http.HttpServletRequest;import jakarta.servlet.http.HttpServletResponse;import lombok.AllArgsConstructor;import lombok.extern.slf4j.Slf4j;import org.springframework.data.redis.core.StringRedisTemplate;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;import javax.imageio.ImageIO;import java.awt.image.BufferedImage;import java.io.IOException;import java.util.concurrent.TimeUnit;/** * éªŒè¯ç å‰ç«¯æ§åˆ¶å™¨ * * @author lianyutian * @since 2024-12-17 11:17:12 * @version 1.0 */@RestController@RequestMapping(/api/captcha/v1)@AllArgsConstructor@Slf4jpublic class CaptchaController /** * éªŒè¯ç ç”Ÿæˆå™¨ */ private final DefaultKaptcha captchaProducer; /** * è·å–å›¾å½¢éªŒè¯ç  * * @param response response */ @RequestMapping(getImgCaptcha) public void getImgCaptcha(HttpServletResponse response) // 1ã€å…ˆç”Ÿæˆå›¾å½¢éªŒè¯ç æ–‡æœ¬ String captchaText = captchaProducer.createText(); log.info(éªŒè¯ç æ¨¡å—-è·å–å›¾å½¢éªŒè¯ç æ–‡æœ¬:, captchaText); // 2ã€æ ¹æ®éªŒè¯ç æ–‡æœ¬ç”Ÿæˆå›¾å½¢éªŒè¯ç å›¾ç‰‡ BufferedImage bufferedImage = captchaProducer.createImage(captchaText); try (ServletOutputStream outputStream = response.getOutputStream(); ) ImageIO.write(bufferedImage, jpg, outputStream); outputStream.flush(); catch (IOException e) log.error(éªŒè¯ç æ¨¡å—-è·å–å›¾å½¢éªŒè¯ç å¼‚å¸¸:, e.getMessage(), e); æ¥å…¥ Redisåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæœ‰å¤šä¸ªå®ä¾‹è¿è¡ŒæœåŠ¡æ—¶ï¼ŒéªŒè¯ç çš„å­˜å‚¨å’ŒéªŒè¯æ¶‰åŠåˆ°è·¨å®ä¾‹çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ é€šå¸¸ï¼ŒéªŒè¯ç æ˜¯å­˜å‚¨åœ¨ç”¨æˆ·ä¼šè¯ï¼ˆSessionï¼‰ä¸­ï¼Œè€Œå¦‚æœæœåŠ¡æ˜¯åˆ†å¸ƒå¼çš„ï¼Œé‚£ä¹ˆæ¯ä¸ªæœåŠ¡å®ä¾‹å¯èƒ½æœ‰è‡ªå·±çš„ç‹¬ç«‹ä¼šè¯å­˜å‚¨ï¼Œå°†ä¼šå¯¼è‡´éªŒè¯å¤±è´¥ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¥å…¥ Redis å­˜å‚¨éªŒè¯ç ã€‚ åœ¨ common æ¨¡å—ä¸­å·²ç»å¼•å…¥äº† redis æ‰€ä»¥ user æ¨¡å—ä¸ç”¨é‡å¤å¼•å…¥ï¼Œç›´æ¥é…ç½® redis å°±å¯ä»¥ã€‚ cshop-usersrcmainresourcesapplication.yml spring: # redisé…ç½® data: redis: enable: true host: 116.198.217.158 port: 6379 password: MIIEowIBAAKCAQEAwG90ULRHmAXFXQzZSwleoYts2+bCzUvqhhqtGiv/F5kUsETY # å¦‚æœæœ‰å¯†ç  database: 0 # é»˜è®¤æ•°æ®åº“ timeout: 60000 # è¯»å– redis è¶…æ—¶æ—¶é—´ lettuce: pool: max-active: 100 # æœ€å¤§è¿æ¥æ•° max-idle: 100 # æœ€å¤§ç©ºé—²è¿æ¥æ•° min-idle: 100 # æœ€å°ç©ºé—²è¿æ¥æ•° max-wait: 60000 # æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ cshop-usersrcmainJavagithublianyutiancshopuserconstantUserCacheKeyConstant.Java package github.lianyutian.cshop.user.constant;/** * ç¼“å­˜å¸¸é‡ * * @author lianyutian * @since 2024-12-24 13:46:37 * @version 1.0 */public class UserCacheKeyConstant /** å›¾å½¢éªŒè¯ç ç¼“å­˜ key å‰ç¼€ */ public static final String CAPTCHA_IMG_KEY_PREFIX = cshop-user:img-captcha:; /** æ³¨å†ŒéªŒè¯ç ç¼“å­˜ key å‰ç¼€ */ public static final String CAPTCHA_REGISTER_KEY_PREFIX = cshop-user:register-captcha:; /** ç”¨æˆ·ä¿¡æ¯æ›´æ–°é”å‰ç¼€ */ public static final String USER_UPDATE_LOCK_KEY_PREFIX = cshop-user:update:lock:; /** ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ç¼“å­˜å‰ç¼€ */ public static final String USER_DETAIL_KEY_PREFIX = cshop-user:detail:; /** ç”¨æˆ·å±•ç¤ºä¿¡æ¯ç¼“å­˜å‰ç¼€ */ public static final String USER_SHOW_KEY_PREFIX = cshop-user:show:; cshop-usersrcmainJavagithublianyutiancshopusercontrollerCaptchaController.Java package github.lianyutian.cshop.user.controller;import com.google.code.kaptcha.impl.DefaultKaptcha;import github.lianyutian.cshop.common.enums.BizCodeEnum;import github.lianyutian.cshop.common.model.ApiResult;import github.lianyutian.cshop.common.redis.RedisCache;import github.lianyutian.cshop.common.utils.CheckUtil;import github.lianyutian.cshop.common.utils.CommonUtil;import github.lianyutian.cshop.user.constant.UserCacheKeyConstant;import github.lianyutian.cshop.user.service.captcha.CaptchaService;import jakarta.servlet.ServletOutputStream;import jakarta.servlet.http.HttpServletRequest;import jakarta.servlet.http.HttpServletResponse;import java.awt.image.BufferedImage;import java.io.IOException;import javax.imageio.ImageIO;import lombok.AllArgsConstructor;import lombok.extern.slf4j.Slf4j;import org.apache.commons.lang3.StringUtils;import org.springframework.web.bind.annotation.PostMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.RestController;/** * CaptchaController * * @author lianyutian * @since 2024-12-17 11:17:12 * @version 1.0 */@RestController@RequestMapping(/api/captcha/v1)@AllArgsConstructor@Slf4jpublic class CaptchaController /** å›¾å½¢éªŒè¯ç è¿‡æœŸæ—¶é—´ */ private static final long CAPTCHA_EXPIRE_TIME = 60 * 1000 * 5; /** éªŒè¯ç ç”Ÿæˆå™¨ */ private final DefaultKaptcha captchaProducer; private final RedisCache redisCache; private final CaptchaService captchaService; /** * è·å–å›¾å½¢éªŒè¯ç  * * @param request request * @param response response */ @PostMapping(getImgCaptcha) public void getImgCaptcha(HttpServletRequest request, HttpServletResponse response) // 1ã€å…ˆç”Ÿæˆå›¾å½¢éªŒè¯ç æ–‡æœ¬ String captchaText = captchaProducer.createText(); log.info(éªŒè¯ç æ¨¡å—-è·å–å›¾å½¢éªŒè¯ç æ–‡æœ¬:, captchaText); // 2ã€å­˜å‚¨åˆ° redis ä¸­ï¼Œå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ redisCache.set(getImgCaptchaKey(request), captchaText, CAPTCHA_EXPIRE_TIME); // 3ã€æ ¹æ®éªŒè¯ç æ–‡æœ¬ç”Ÿæˆå›¾å½¢éªŒè¯ç å›¾ç‰‡ BufferedImage bufferedImage = captchaProducer.createImage(captchaText); try (ServletOutputStream outputStream = response.getOutputStream(); ) ImageIO.write(bufferedImage, jpg, outputStream); outputStream.flush(); catch (IOException e) log.error(éªŒè¯ç æ¨¡å—-è·å–å›¾å½¢éªŒè¯ç å¼‚å¸¸:, e.getMessage(), e); private String getImgCaptchaKey(HttpServletRequest request) // è·å–å®¢æˆ·ç«¯ç”¨æˆ·çš„ IP åœ°å€ String ip = CommonUtil.getRemoteIpAddr(request); // è·å–è¯·æ±‚å¤´ä¸­çš„ User-Agent å±æ€§å€¼ String userAgent = request.getHeader(User-Agent); // æ ¹æ® ip + userAgent ç”Ÿæˆå¯¹åº”çš„ key return UserCacheKeyConstant.CAPTCHA_IMG_KEY_PREFIX + CommonUtil.MD5(ip + userAgent); çŸ­ä¿¡å‘é€é˜¿é‡Œäº‘çŸ­ä¿¡https://www.alibabacloud.com/help/zh/sms/?spm a2c63.p38356.0.0.5d031637kOTDrA https://dysms.console.aliyun.com/quickstart å‰ç½®æ­¥éª¤ ç”³è¯·èµ„è´¨ èµ„è´¨æ˜¯ç”³è¯·ç­¾åçš„å®ååŒ–ä¿¡æ¯ï¼Œå¯å¤ç”¨ å‰å¾€æŸ¥çœ‹ ç”³è¯·ç­¾å ç­¾åæ˜¯çŸ­ä¿¡ä¸­èƒ½ä»£è¡¨å‘é€è€…å±æ€§çš„å­—æ®µã€‚ å‰å¾€æŸ¥çœ‹ ç”³è¯·æ¨¡æ¿ æ¨¡æ¿å³å…·ä½“å‘é€çš„çŸ­ä¿¡å†…å®¹ã€‚ å‰å¾€æŸ¥çœ‹ å®‰å…¨è®¾ç½®https://dysms.console.aliyun.com/msgsetting/safe åˆ›å»º RAM ç”¨æˆ· åˆ›å»ºç”¨æˆ· https://ram.console.aliyun.com/users/create æ·»åŠ çŸ­ä¿¡æˆæƒ API è¯¦ç»† API æ–‡æ¡£ https://api.aliyun.com/document/Dysmsapi/2017-05-25/SendSms ç¤ºä¾‹ https://api.aliyun.com/api-tools/sdk/Dysmsapi?version 2017-05-25language Java-async-teatab primer-doc å¼€å‘ pom.xml !-- é˜¿é‡Œäº‘çŸ­ä¿¡ sdk ç‰ˆæœ¬ --alibabacloud.dysmsapi.version3.0.1/alibabacloud.dysmsapi.versiondependency groupIdcom.aliyun/groupId artifactIdalibabacloud-dysmsapi20170525/artifactId version$alibabacloud.dysmsapi.version/version/dependency cshop-userpom.xml dependency groupIdcom.aliyun/groupId artifactIdalibabacloud-dysmsapi20170525/artifactId/dependency cshop-usersrcmainJavagithublianyutiancshopuserservicesmsSmsCodeService.Java /** çŸ­ä¿¡æœåŠ¡æ¥å£ æä¾›çŸ­ä¿¡éªŒè¯ç å‘é€åŠŸèƒ½ */package github.lianyutian.cshop.user.service.sms;/** * çŸ­ä¿¡æœåŠ¡æ¥å£ * * @author lianyutian * @since 2024-12-18 14:39:43 * @version 1.0 */public interface SmsCodeService /** * å‘é€çŸ­ä¿¡éªŒè¯ç  * * @param phone æ¥æ”¶çŸ­ä¿¡çš„æ‰‹æœºå·ç  * @param templateId çŸ­ä¿¡æ¨¡æ¿ IDï¼Œç”¨äºæŒ‡å®šçŸ­ä¿¡çš„å†…å®¹æ ¼å¼ * @param templateParam çŸ­ä¿¡æ¨¡æ¿å‚æ•°ï¼Œç”¨äºæ›¿æ¢çŸ­ä¿¡æ¨¡æ¿ä¸­çš„å ä½ç¬¦ * @return å‘é€ç»“æœï¼Œé€šå¸¸ä¸ºæˆåŠŸæˆ–å¤±è´¥çš„æ ‡è¯† */ boolean sendSmsCode(String phone, String templateId, String[] templateParam); cshop-usersrcmainJavagithublianyutiancshopuserservicesmsimplAliyunSmsCodeServiceImpl.Java package github.lianyutian.cshop.user.service.sms.impl;import com.aliyun.auth.credentials.Credential;import com.aliyun.auth.credentials.provider.StaticCredentialProvider;import com.aliyun.sdk.service.dysmsapi20170525.AsyncClient;import com.aliyun.sdk.service.dysmsapi20170525.models.SendSmsRequest;import com.aliyun.sdk.service.dysmsapi20170525.models.SendSmsResponse;import darabonba.core.client.ClientOverrideConfiguration;import github.lianyutian.cshop.common.utils.JsonUtil;import github.lianyutian.cshop.user.service.sms.SmsCodeService;import java.time.Duration;import java.util.Objects;import java.util.concurrent.CompletableFuture;import java.util.concurrent.ExecutionException;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.annotation.Value;import org.springframework.stereotype.Service;/** * é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡å®ç°ç±» * * @author lianyutian * @since 2024-12-19 08:42:48 * @version 1.0 */@Service@Slf4jpublic class AliyunSmsCodeServiceImpl implements SmsCodeService @Value($sms.aliyun.secretId) private String secretId; @Value($sms.aliyun.secretKey) private String secretKey; @Value($sms.aliyun.signName) private String signName; @Override public boolean sendSmsCode(String phone, String templateId, String[] templateParam) // é…ç½®è®¤è¯ä¿¡æ¯ï¼ŒåŒ…æ‹¬è®¿é—®å¯†é’¥ IDã€è®¿é—®å¯†é’¥å¯†é’¥ StaticCredentialProvider provider = StaticCredentialProvider.create( Credential.builder().accessKeyId(secretId).accessKeySecret(secretKey).build()); try (AsyncClient client = AsyncClient.builder() // .httpClient(httpClient) // ä½¿ç”¨é…ç½®çš„ HttpClientï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤çš„ HttpClient (Apache HttpClient) .credentialsProvider(provider) // .serviceConfiguration(Configuration.create()) // æœåŠ¡çº§åˆ«é…ç½® // å®¢æˆ·ç«¯çº§åˆ«é…ç½®é‡å†™ï¼Œå¯ä»¥è®¾ç½® Endpointã€HTTP è¯·æ±‚å‚æ•°ç­‰ .overrideConfiguration( ClientOverrideConfiguration.create() // Endpoint è¯·å‚è€ƒ https://api.aliyun.com/product/Dysmsapi .setEndpointOverride(dysmsapi.aliyuncs.com) .setConnectTimeout(Duration.ofSeconds(30))) .build()) // è®¾ç½® API è¯·æ±‚å‚æ•° SendSmsRequest sendSmsRequest = SendSmsRequest.builder() .phoneNumbers(phone) .signName(signName) .templateCode(templateId) .templateParam(\\code\\:\\ + templateParam[0] + \\) // è¯·æ±‚çº§åˆ«é…ç½®é‡å†™ï¼Œå¯ä»¥è®¾ç½® HTTP è¯·æ±‚å‚æ•°ç­‰ // .requestConfiguration(RequestConfiguration.create().setHttpHeaders(new // HttpHeaders())) .build(); // å¼‚æ­¥è·å– API è¯·æ±‚çš„è¿”å›å€¼ CompletableFutureSendSmsResponse response = client.sendSms(sendSmsRequest); // åŒæ­¥è·å– API è¯·æ±‚çš„è¿”å›å€¼ SendSmsResponse resp = response.get(); log.info(çŸ­ä¿¡æ¨¡å—-çŸ­ä¿¡å‘é€ç»“æœï¼š, JsonUtil.toJson(resp)); String code = resp.getBody().getCode(); if (Objects.equals(code, OK)) return true; catch (ExecutionException | InterruptedException e) log.error(e.getMessage(), e); return false; return false; cshop-usersrcmainJavagithublianyutiancshopuserservicesmsSmsSender.Java å› ä¸ºçŸ­ä¿¡æœåŠ¡æä¾›å•†æœ‰å¤šå®¶ï¼Œä¸ºæ–¹ä¾¿å¯ä»¥è‡ªç”±é€‰æ‹©æä¾›å•†æ‰€ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼ package github.lianyutian.cshop.user.service.sms;import github.lianyutian.cshop.user.service.sms.impl.AliyunSmsCodeServiceImpl;import github.lianyutian.cshop.user.service.sms.impl.TencentcloudSmsCodeServiceImpl;import java.util.concurrent.atomic.AtomicInteger;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.annotation.Value;import org.springframework.stereotype.Service;/** * çŸ­ä¿¡å‘é€ç®¡ç† * * @author lianyutian * @since 2024-12-19 09:50:10 * @version 1.0 */@Service@Slf4jpublic class SmsSender /** å½“å‰ä½¿ç”¨çš„çŸ­ä¿¡æœåŠ¡ */ private SmsCodeService currentService; /** å½“å‰çŸ­ä¿¡æ¨¡æ¿ ID */ private String currentTemplateId; /** å¤±è´¥è®¡æ•° */ private final AtomicInteger failureCount = new AtomicInteger(0); /** é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡å®ç° */ private final AliyunSmsCodeServiceImpl aliyunSmsCodeService; /** è…¾è®¯äº‘çŸ­ä¿¡æœåŠ¡å®ç° */ private final TencentcloudSmsCodeServiceImpl tencentcloudSmsCodeService; /** æœ€å¤§å¤±è´¥æ¬¡æ•° */ private final int maxFailures; private final String aliyunTemplateId; private final String tencentcloudTemplateId; /** æ„é€ æ–¹æ³•ï¼Œé»˜è®¤ä½¿ç”¨é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡ */ public SmsSender( @Value($sms.send.fail) int maxFailures, @Value($sms.send.templateId.aliyun) String aliyunTemplateId, @Value($sms.send.templateId.tencentcloud) String tencentcloudTemplateId, AliyunSmsCodeServiceImpl aliyunSmsCodeService, TencentcloudSmsCodeServiceImpl tencentcloudSmsCodeService) if (maxFailures = 0) throw new IllegalArgumentException(æœ€å¤§å¤±è´¥æ¬¡æ•°å¿…é¡»å¤§äº0); this.maxFailures = maxFailures; this.aliyunTemplateId = aliyunTemplateId; this.tencentcloudTemplateId = tencentcloudTemplateId; this.aliyunSmsCodeService = aliyunSmsCodeService; this.tencentcloudSmsCodeService = tencentcloudSmsCodeService; this.currentService = aliyunSmsCodeService; this.currentTemplateId = aliyunTemplateId; /** * å‘é€çŸ­ä¿¡ * * @param phoneNumber æ¥æ”¶çŸ­ä¿¡çš„ç”µè¯å·ç  * @param templateParam çŸ­ä¿¡æ¨¡æ¿å‚æ•° * @return çŸ­ä¿¡å‘é€ç»“æœï¼Œtrue è¡¨ç¤ºå‘é€æˆåŠŸï¼Œfalse è¡¨ç¤ºå‘é€å¤±è´¥ */ public boolean send(String phoneNumber, String[] templateParam) try boolean result = currentService.sendSmsCode(phoneNumber, currentTemplateId, templateParam); // å‘é€æˆåŠŸæ—¶ï¼Œé‡ç½®å¤±è´¥æ¬¡æ•° failureCount.set(0); return result; catch (Exception e) log.error(çŸ­ä¿¡æ¨¡å—-çŸ­ä¿¡å‘é€å¤±è´¥, , e.getMessage(), e); int currentFailureCount = failureCount.incrementAndGet(); if (currentFailureCount = maxFailures) // åˆ‡æ¢åˆ°å¦ä¸€ä¸ªå‚å•† switchVendor(currentFailureCount); return false; /** åˆ‡æ¢çŸ­ä¿¡æœåŠ¡ä¾›åº”å•† */ private void switchVendor(int currentFailureCount) if (currentService instanceof AliyunSmsCodeServiceImpl) log.info(çŸ­ä¿¡æ¨¡å—-åˆ‡æ¢åˆ°è…¾è®¯äº‘, å½“å‰å¤±è´¥æ¬¡æ•°: , currentFailureCount); currentService = tencentcloudSmsCodeService; currentTemplateId = tencentcloudTemplateId; else log.info(çŸ­ä¿¡æ¨¡å—-åˆ‡æ¢åˆ°é˜¿é‡Œäº‘, å½“å‰å¤±è´¥æ¬¡æ•°: , currentFailureCount); currentService = aliyunSmsCodeService; currentTemplateId = aliyunTemplateId; cshop-usersrcmainresourcesapplication.yml sms: aliyun: secretId: xxx secretKey: xxx signName: CircleShopå•†åŸ tencent: secretId: xxx secretKey: xxx signName: xxx send: fail: 10 templateId: aliyun: SMS_476800055 tencentcloud: xxx è…¾è®¯äº‘çŸ­ä¿¡å¼€é€šè…¾è®¯äº‘çŸ­ä¿¡ï¼ˆç­¾åä¸é€šè¿‡æš‚ç¼“ï¼‰https://console.cloud.tencent.com/smsv2 https://blog.csdn.net/mjl1125/article/details/122047618 https://blog.csdn.net/huixi_aa/article/details/124687445 æ³¨å†ŒéªŒè¯ç  cshop-usersrcmainJavagithublianyutiancshopusercontrollerCaptchaController.Java private final CaptchaService captchaService;/** * å‘é€æ³¨å†ŒéªŒè¯ç  * * @param to æ¥æ”¶æ–¹ */@PostMapping(sendRegisterCode)public ApiResultVoid sendRegisterCode(@RequestParam(value = to) String to) if (!CheckUtil.isPhone(to)) return ApiResult.result(BizCodeEnum.USER_PHONE_ERROR); // å…ˆä»ç¼“å­˜ä¸­è·å–éªŒè¯ç  // key:cshop-user:register-captcha: ç”µè¯ // value: ç”µè¯_å‘é€æ—¶é—´æˆ³ String cacheKey = UserCacheKeyConstant.CAPTCHA_REGISTER_KEY_PREFIX + to; String registerCode = redisCache.get(cacheKey); // å¦‚æœä¸ä¸ºç©ºï¼Œåˆ™åˆ¤æ–­æ˜¯å¦ 60 ç§’å†…é‡å¤å‘é€ if (StringUtils.isNotBlank(registerCode)) // ä»ç¼“å­˜ä¸­å–å‡ºéªŒè¯ç å‘é€æ—¶é—´æˆ³ long cacheCheckTtl = Long.parseLong(registerCode.split(_)[1]); // å½“å‰æ—¶é—´ - éªŒè¯ç å‘é€æ—¶é—´æˆ³ï¼Œå¦‚æœå°äº 60 ç§’ï¼Œåˆ™ä¸ç»™é‡å¤å‘é€ if (CommonUtil.getCurrentTimestamp() - cacheCheckTtl 1000 * 60) log.info( éªŒè¯ç æ¨¡å—-è¯·ä¸è¦é‡å¤å‘é€éªŒè¯ç ï¼Œæ—¶é—´é—´éš”ï¼š, (CommonUtil.getCurrentTimestamp() - cacheCheckTtl) / 1000); return ApiResult.result(BizCodeEnum.USER_CODE_FAST_LIMITED); // å‘é€æ³¨å†ŒéªŒè¯ç  boolean res = captchaService.sendCode(cacheKey, to); return res ? ApiResult.success() : ApiResult.result(BizCodeEnum.USER_CODE_SEND_ERROR); cshop-usersrcmainJavagithublianyutiancshopuserservicecaptchaCaptchaService.Java package github.lianyutian.cshop.user.service.captcha;/** * éªŒè¯ç æœåŠ¡æ¥å£ * * @author lianyutian * @since 2024-12-17 17:17:03 * @version 1.0 */public interface CaptchaService /** * å‘é€éªŒè¯ç  * * @param cacheKey ç¼“å­˜ key * @param to æ¥æ”¶è€… * @return å‘é€ç»“æœ */ boolean sendCode(String cacheKey, String to); cshop-usersrcmainJavagithublianyutiancshopuserservicecaptchaimplCaptchaServiceImpl.Java package github.lianyutian.cshop.user.service.captcha.impl;import github.lianyutian.cshop.common.redis.RedisCache;import github.lianyutian.cshop.common.utils.CommonUtil;import github.lianyutian.cshop.user.service.captcha.CaptchaService;import github.lianyutian.cshop.user.service.sms.SmsSender;import java.util.concurrent.TimeUnit;import lombok.AllArgsConstructor;import lombok.extern.slf4j.Slf4j;import org.springframework.stereotype.Service;/** * éªŒè¯ç æœåŠ¡å®ç°ç±» * * @author lianyutian * @since 2024-12-17 17:35:10 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class CaptchaServiceImpl implements CaptchaService /** çŸ­ä¿¡éªŒè¯ç è¿‡æœŸæ—¶é—´ */ private static final long CAPTCHA_EXPIRE_TIME = 60 * 1000 * 5; private final RedisCache redisCache; private final SmsSender smsSender; @Override public boolean sendCode(String cacheKey, String to) // è·å–éšæœºéªŒè¯ç  String code = CommonUtil.getRandomCode(6); // æ‹¼æ¥éªŒè¯ç  æ ¼å¼ï¼šéªŒè¯ç _æ—¶é—´æˆ³ String newCode = code + _ + CommonUtil.getCurrentTimestamp(); log.info(éªŒè¯ç æ¨¡å—-å†™å…¥ Redis éªŒè¯ç ï¼š, newCode); redisCache.set(cacheKey, newCode, CAPTCHA_EXPIRE_TIME, TimeUnit.MILLISECONDS); // å‘é€çŸ­ä¿¡ boolean sendRes = smsSender.send(to, new String[] code); if (!sendRes) // å‘é€å¤±è´¥åˆ é™¤ç¼“å­˜ redisCache.delete(cacheKey); return sendRes; ç”¨æˆ·å¤´åƒä¸Šä¼ https://www.alibabacloud.com/help/zh/oss/?spm a2c63.p38356.0.0.47cb60deEkjUPk https://www.alibabacloud.com/help/zh/oss/developer-reference/getting-started?spm a2c63.p38356.help-menu-31815.d_3_2_0_0.59105a1abcz5t5 pom.xml !-- é˜¿é‡Œäº‘ OSS sdk ç‰ˆæœ¬ --aliyun-sdk-oss.version3.18.1/aliyun-sdk-oss.version!-- https://mvnrepository.com/artifact/com.aliyun.oss/aliyun-sdk-oss --dependency groupIdcom.aliyun.oss/groupId artifactIdaliyun-sdk-oss/artifactId version$aliyun-sdk-oss.version/version/dependency cshop-usersrcmainresourcesapplication.yml oss: aliyun: secretId: xxx secretKey: xxx bucketName: xxx endPoint: oss-cn-shenzhen.aliyuncs.com cshop-usersrcmainJavagithublianyutiancshopuserserviceossOssService.Java package github.lianyutian.cshop.user.service.oss;import org.springframework.web.multipart.MultipartFile;/** * å¯¹è±¡å­˜å‚¨æœåŠ¡ * * @author lianyutian * @since 2024-12-23 14:04:03 * @version 1.0 */public interface OssService /** * ä¸Šä¼ ç”¨æˆ·å¤´åƒ * * @param file å¤´åƒæ–‡ä»¶ * @return å¤´åƒåœ°å€ */ String uploadUserAvatar(MultipartFile file); cshop-usersrcmainJavagithublianyutiancshopuserserviceossimplOssServiceImpl.Java package github.lianyutian.cshop.user.service.oss.impl;import com.aliyun.oss.OSS;import com.aliyun.oss.OSSClientBuilder;import com.aliyun.oss.model.PutObjectResult;import github.lianyutian.cshop.common.utils.CommonUtil;import github.lianyutian.cshop.user.service.oss.OssService;import java.io.IOException;import java.io.InputStream;import java.time.LocalDateTime;import java.time.format.DateTimeFormatter;import java.util.Objects;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.annotation.Value;import org.springframework.stereotype.Service;import org.springframework.web.multipart.MultipartFile;/** * å¯¹è±¡å­˜å‚¨å®ç° * * @author lianyutian * @since 2024-12-23 14:06:09 * @version 1.0 */@Slf4j@Servicepublic class OssServiceImpl implements OssService @Value($oss.aliyun.secretId) private String secretId; @Value($oss.aliyun.secretKey) private String secretKey; @Value($oss.aliyun.bucketName) private String bucketName; @Value($oss.aliyun.endPoint) private String endPoint; @Override public String uploadUserAvatar(MultipartFile file) // è·å–åŸå§‹æ–‡ä»¶å String originalFilename = Objects.requireNonNullElse(file.getOriginalFilename(), default_filename); // è·å–æ—¥æœŸæ ¼å¼ï¼Œä¸Šä¼ æ—¶ä½œä¸ºç›®å½•åä½¿ç”¨ LocalDateTime localDateTime = LocalDateTime.now(); DateTimeFormatter dateTimeFormatter = DateTimeFormatter.ofPattern(yyyy/MM/dd); // OSS ä¸Šä¼ å­˜å‚¨è·¯å¾„ï¼šuser/2024/12/23/xxx.jpg String folder = dateTimeFormatter.format(localDateTime); // è·å–æ‰©å±•å String extension = originalFilename.substring(originalFilename.lastIndexOf(.)); // æ–°æ–‡ä»¶åï¼Œé€šè¿‡ uuid ç”Ÿæˆæ–‡ä»¶åï¼Œ String fileName = user + / + folder + / + CommonUtil.generateUUID() + extension; OSS ossClient = new OSSClientBuilder().build(endPoint, secretId, secretKey); try (InputStream inputStream = file.getInputStream()) // å†™å…¥ OSS PutObjectResult putObjectResult = ossClient.putObject(bucketName, fileName, inputStream); // è¿”å›å›¾ç‰‡è·¯å¾„ if (putObjectResult != null) return https:// + bucketName + . + endPoint + / + fileName; else log.error(ç”¨æˆ·å¾®æœåŠ¡-ä¸Šä¼ æ¨¡å—-æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼ŒputObjectResult ä¸ºç©º); return null; catch (IOException e) log.error(ç”¨æˆ·å¾®æœåŠ¡-ä¸Šä¼ æ¨¡å—-æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼š, e.getMessage(), e); return null; finally ossClient.shutdown(); cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserController.Java package github.lianyutian.cshop.user.controller;import github.lianyutian.cshop.common.enums.BizCodeEnum;import github.lianyutian.cshop.common.model.ApiResult;import github.lianyutian.cshop.user.model.param.UserEditParam;import github.lianyutian.cshop.user.model.param.UserLoginParam;import github.lianyutian.cshop.user.model.param.UserRegisterParam;import github.lianyutian.cshop.user.model.vo.UserDetailVO;import github.lianyutian.cshop.user.model.vo.UserShowVO;import github.lianyutian.cshop.user.service.UserService;import github.lianyutian.cshop.user.service.oss.OssService;import java.util.Map;import lombok.RequiredArgsConstructor;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.annotation.Value;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.PathVariable;import org.springframework.web.bind.annotation.PostMapping;import org.springframework.web.bind.annotation.RequestBody;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.RequestPart;import org.springframework.web.bind.annotation.RestController;import org.springframework.web.multipart.MultipartFile;/** * UserController * * @author lianyutian * @since 2024-12-13 14:19:30 * @version 1.0 */@RestController@RequestMapping(/api/user/v1)@Slf4j@RequiredArgsConstructorpublic class UserController @Value($oss.aliyun.maxFileSize:1048576) // æ–°å¢æ–‡ä»¶å¤§å°é™åˆ¶é…ç½® private long maxFileSize; @Value($oss.aliyun.allowedFileTypes:image/jpeg,image/png) // æ–°å¢å…è®¸çš„æ–‡ä»¶ç±»å‹é…ç½® private String[] allowedFileTypes; private final OssService ossService; private final UserService userService; /** * ä¸Šä¼ ç”¨æˆ·å¤´åƒ * * @param file å¤´åƒæ–‡ä»¶ * @return ä¸Šä¼ ç»“æœ */ @PostMapping(uploadUserAvatar) public ApiResultString uploadUserAvatar(@RequestPart(file) MultipartFile file) // éªŒè¯æ–‡ä»¶æ˜¯å¦ä¸ºç©º if (file == null || file.isEmpty()) log.warn(ç”¨æˆ·å¾®æœåŠ¡-ä¸Šä¼ æ¨¡å—-æ–‡ä»¶ä¸ºç©º); return ApiResult.result(BizCodeEnum.USER_AVATAR_FILE_UPLOAD_ERROR); // éªŒè¯æ–‡ä»¶å¤§å° if (file.getSize() maxFileSize) log.warn(ç”¨æˆ·å¾®æœåŠ¡-ä¸Šä¼ æ¨¡å—-æ–‡ä»¶è¶…å‡ºæœ€å¤§é™åˆ¶: , file.getSize()); return ApiResult.result(BizCodeEnum.USER_AVATAR_FILE_UPLOAD_ERROR); // éªŒè¯æ–‡ä»¶ç±»å‹ String contentType = file.getContentType(); if (!isFileTypeAllowed(contentType)) log.warn(ç”¨æˆ·å¾®æœåŠ¡-ä¸Šä¼ æ¨¡å—-ä¸å…è®¸çš„æ–‡ä»¶ç±»å‹: , contentType); return ApiResult.result(BizCodeEnum.USER_AVATAR_FILE_UPLOAD_ERROR); String result = ossService.uploadUserAvatar(file); return result != null ? ApiResult.success(result) : ApiResult.result(BizCodeEnum.USER_AVATAR_FILE_UPLOAD_ERROR); ç”¨æˆ·æ³¨å†Œåˆ›å»ºç”¨æˆ·è¡¨ cshop-userdocSQLuser.SQL create table user( id bigint unsigned auto_increment primary key, name varchar(32) null comment ç”¨æˆ·æ˜µç§°, pwd varchar(64) null comment ç”¨æˆ·å¯†ç , avatar varchar(524) null comment ç”¨æˆ·å¤´åƒ, sex tinyint(1) default 1 null comment 0 å¥³ï¼Œ1 ç”·, phone varchar(11) default null comment ç”¨æˆ·æ‰‹æœºå·, create_time datetime default CURRENT_TIMESTAMP null comment åˆ›å»ºæ—¶é—´, update_time datetime default CURRENT_TIMESTAMP null on update CURRENT_TIMESTAMP comment æ›´æ–°æ—¶é—´, constraint phone_idx unique (phone)) comment ç”¨æˆ·è¡¨ row_format = DYNAMIC; é…ç½® pom.xml !-- mybatis-plus ç‰ˆæœ¬ --mybatis-plus.version3.5.9/mybatis-plus.version!-- mysql é©±åŠ¨ ç‰ˆæœ¬ --mysql-connector-java.version8.0.33/mysql-connector-java.versiondependency groupIdcom.baomidou/groupId artifactIdmybatis-plus-bom/artifactId version$mybatis-plus.version/version typepom/type scopeimport/scope/dependencydependency groupIdmysql/groupId artifactIdmysql-connector-java/artifactId version$mysql-connector-java.version/version/dependency cshop-userpom.xml dependency groupIdcom.baomidou/groupId artifactIdmybatis-plus-spring-boot3-starter/artifactId/dependencydependency groupIdmysql/groupId artifactIdmysql-connector-java/artifactId/dependency!-- å¯†ç åŠ å¯† --dependency groupIdorg.springframework.security/groupId artifactIdspring-security-crypto/artifactId/dependency cshop-usersrcmainresourcesapplication.yml spring: # mysqlé…ç½® datasource: username: root password: MIIEowIBAAKCAQEAwG90ULRHmAXFXQzZSwleoYts2+bCzUvqhhqtGiv/F5kUsETY url: jdbc:mysql://116.198.217.158:3306/cshop-user?useUnicode=truecharacterEncoding=utf-8useSSL=falseserverTimezone=Asia/Shanghai driver-class-name: com.mysql.cj.jdbc.Driver# é…ç½® mybatis plus æ‰“å° sql æ—¥å¿—mybatis-plus: configuration: log-impl: org.apache.ibatis.logging.stdout.StdOutImpl æ³¨å†ŒåŠŸèƒ½å¼€å‘BCryptPasswordEncoder cshop-usersrcmainJavagithublianyutiancshopuserconfigSecurityConfig.Java package github.lianyutian.cshop.user.config;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;import org.springframework.security.crypto.password.PasswordEncoder;/** * å¯†ç åŠ å¯† * * @author lianyutian * @since 2024-12-24 15:16:39 * @version 1.0 */@Configurationpublic class SecurityConfig @Bean public PasswordEncoder passwordEncoder() return new BCryptPasswordEncoder(); cshop-usersrcmainJavagithublianyutiancshopusermodelparamUserRegisterParam.Java package github.lianyutian.cshop.user.model.param;import lombok.Data;/** * ç”¨æˆ·æ³¨å†Œå‚æ•° * * @author lianyutian * @since 2024-12-24 13:30:19 * @version 1.0 */@Datapublic class UserRegisterParam /** ç”¨æˆ·å */ private String name; /** å¯†ç  */ private String password; /** ç”¨æˆ·å¤´åƒ */ private String avatar; /** æ€§åˆ« 0 å¥³ï¼Œ1 ç”· */ private String sex; /** æ‰‹æœºå· */ private String phone; /** éªŒè¯ç  */ private String code; cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserController.Java /** * ç”¨æˆ·æ³¨å†Œ * * @param userRegisterVO æ³¨å†Œä¿¡æ¯ * @return æ³¨å†Œç»“æœ */@PostMapping(register)public ApiResultVoid register(@RequestBody UserRegisterParam userRegisterParam) return userService.register(userRegisterVO); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserService.Java package github.lianyutian.cshop.user.service;import github.lianyutian.cshop.common.model.ApiResult;import github.lianyutian.cshop.user.model.param.UserRegisterParam;/** * ç”¨æˆ·æœåŠ¡æ¥å£ * * @author lianyutian * @since 2024-12-24 08:41:57 * @version 1.0 */public interface UserService /** * ç”¨æˆ·æ³¨å†Œ * * @param userRegisterParam ç”¨æˆ·æ³¨å†Œå…¥å‚ * @return æ³¨å†Œç»“æœ */ ApiResultVoid register(UserRegisterParam userRegisterParam); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserServiceImpl.Java package github.lianyutian.cshop.user.service.impl;import github.lianyutian.cshop.common.enums.BizCodeEnum;import github.lianyutian.cshop.common.exception.BizException;import github.lianyutian.cshop.common.model.ApiResult;import github.lianyutian.cshop.common.redis.RedisCache;import github.lianyutian.cshop.common.utils.BeanUtil;import github.lianyutian.cshop.user.mapper.UserMapper;import github.lianyutian.cshop.user.model.param.UserRegisterParam;import github.lianyutian.cshop.user.model.po.User;import github.lianyutian.cshop.user.service.UserService;import java.util.concurrent.TimeUnit;import lombok.RequiredArgsConstructor;import lombok.extern.slf4j.Slf4j;import org.apache.commons.lang3.StringUtils;import org.springframework.beans.BeanUtils;import org.springframework.dao.DuplicateKeyException;import org.springframework.security.crypto.password.PasswordEncoder;import org.springframework.stereotype.Service;import org.springframework.transaction.annotation.Transactional;import org.springframework.util.CollectionUtils;/** * ç”¨æˆ·æœåŠ¡å®ç°ç±» * * @author lianyutian * @since 2024-12-24 08:44:49 * @version 1.0 */@Service@Slf4j@RequiredArgsConstructorpublic class UserServiceImpl implements UserService private final UserMapper userMapper; private final PasswordEncoder passwordEncoder; private final RedisCache redisCache; private final RedisLock redisLock; @Override @Transactional public ApiResultVoid register(UserRegisterParam userRegisterParam) // 1. æ ¡éªŒæ³¨å†ŒéªŒè¯ç æ˜¯å¦æ­£ç¡® boolean checked = checkCode(userRegisterParam.getPhone(), userRegisterParam.getCode()); if (!checked) return ApiResult.result(BizCodeEnum.USER_CODE_PHONE_ERROR); // 1.2 é€šè¿‡æ‰‹æœºå·å”¯ä¸€ç´¢å¼•å®ç°å”¯ä¸€ User user = new User(); BeanUtils.copyProperties(userRegisterParam, user); // å¯†ç åŠ å¯† String secretPwd = passwordEncoder.encode(userRegisterParam.getPassword()); user.setPwd(secretPwd); try userMapper.insert(user); catch (DuplicateKeyException e) log.warn(ç”¨æˆ·å¾®æœåŠ¡-æ³¨å†Œæ¨¡å—-ç”¨æˆ·å·²å­˜åœ¨ , userRegisterParam.getPhone()); return ApiResult.result(BizCodeEnum.USER_ACCOUNT_EXIST); return ApiResult.success(); private boolean checkCode(String phone, String code) // å…ˆä»ç¼“å­˜ä¸­è·å–éªŒè¯ç  key - cshop-user:register-captcha:ç”µè¯ String cacheKey = UserCacheKeyConstant.CAPTCHA_REGISTER_KEY_PREFIX + phone; String codeVal = redisCache.get(cacheKey); if (StringUtils.isBlank(codeVal)) return false; String[] parts = codeVal.split(_); String registerCode = parts[0]; if (registerCode.equals(code)) // åˆ é™¤éªŒè¯ç ï¼Œç¡®ä¿éªŒè¯ç ä¸å¯ä»¥é‡å¤ä½¿ç”¨ redisCache.delete(cacheKey); return true; return false; cshop-usersrcmainJavagithublianyutiancshopusermapperUserMapper.Java package github.lianyutian.cshop.user.mapper;import com.baomidou.mybatisplus.core.mapper.BaseMapper;import github.lianyutian.cshop.user.model.po.User;import org.apache.ibatis.annotations.Mapper;/** * UserMapper * * @author lianyutian * @since 2024-12-24 14:19:30 * @version 1.0 */@Mapperpublic interface UserMapper extends BaseMapperUser ç”¨æˆ·ç™»å½•pom é…ç½® pom.xml !-- jwt ç‰ˆæœ¬ --jwt.version0.12.6/jwt.version!-- https://mvnrepository.com/artifact/io.jsonwebtoken/jjwt --dependency groupIdio.jsonwebtoken/groupId artifactIdjjwt/artifactId version$jwt.version/version/dependency cshop-commonpom.xml dependency groupIdio.jsonwebtoken/groupId artifactIdjjwt/artifactId/dependency åŠŸèƒ½å¼€å‘ cshop-usersrcmainJavagithublianyutiancshopusermodelvoUserLoginParam.Java package github.lianyutian.cshop.user.model.param;import lombok.Data;/** * ç”¨æˆ·ç™»å½•å‚æ•° * * @author lianyutian * @since 2024-12-24 08:40:33 * @version 1.0 */@Datapublic class UserLoginParam /** æ‰‹æœºå· */ private String phone; /** å¯†ç  */ private String password; cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserController.Java /** * ç”¨æˆ·ç™»å½• * * @param userLoginParam ç”¨æˆ·ç™»å½•å…¥å‚ * @return ç™»å½•ç»“æœ */@PostMapping(login)public ApiResultMapString, Object login(@RequestBody UserLoginParam userLoginParam) return userService.login(userLoginParam); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserService.Java /** * ç”¨æˆ·ç™»å½• * * @param userLoginParam ç”¨æˆ·ç™»å½•å…¥å‚ * @return ç™»å½•ç»“æœ */ApiResultMapString, Object login(UserLoginParam userLoginParam); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserServiceImpl.Java @Overridepublic ApiResultMapString, Object login(UserLoginParam userLoginParam) // æ ¹æ®æ‰‹æœºå·æŸ¥è¯¢æ˜¯å¦å­˜åœ¨ LambdaQueryWrapperUser queryWrapper = new LambdaQueryWrapper(); queryWrapper.eq(User::getPhone, userLoginParam.getPhone()); User user = userMapper.selectOne(queryWrapper); if (user == null) // æœªæ³¨å†Œ return ApiResult.result(BizCodeEnum.USER_ACCOUNT_PWD_ERROR); // æ ¡éªŒå¯†ç  if (passwordEncoder.matches(userLoginParam.getPassword(), user.getPwd())) // TODO ç™»å½•æˆåŠŸï¼Œç”Ÿæˆ jwt return null; else return ApiResult.result(BizCodeEnum.USER_ACCOUNT_PWD_ERROR); é‰´æƒä¸åˆ·æ–°JWT JWTï¼ˆJSON Web Tokenï¼‰é‰´æƒä¸ä¼ ç»Ÿé‰´æƒåœ¨æŠ€æœ¯å®ç°ã€ä½¿ç”¨åœºæ™¯å’Œæ€§èƒ½ç­‰æ–¹é¢å­˜åœ¨æ˜¾è‘—åŒºåˆ«ï¼Œä»¥ä¸‹æ˜¯ä¸¤è€…çš„ä¸»è¦å¯¹æ¯”ï¼š 1. æ•°æ®å­˜å‚¨ä¸çŠ¶æ€ç®¡ç† ä¼ ç»Ÿé‰´æƒ ä½¿ç”¨ ä¼šè¯æœºåˆ¶ï¼ŒæœåŠ¡å™¨ä¼šåœ¨å†…å­˜ï¼ˆæˆ–æ•°æ®åº“ï¼‰ä¸­ç»´æŠ¤ç”¨æˆ·çŠ¶æ€ã€‚ é€šå¸¸é€šè¿‡ Session ID æ ‡è¯†ç”¨æˆ·ï¼ŒSession ID å­˜å‚¨åœ¨ Cookie ä¸­ï¼Œç”±å®¢æˆ·ç«¯éšæ¯ä¸ªè¯·æ±‚å‘é€ç»™æœåŠ¡å™¨ã€‚ éœ€è¦åœ¨æœåŠ¡å™¨ç«¯ç»´æŠ¤ä¼šè¯çŠ¶æ€ï¼Œå› æ­¤ä¼šè¯ç®¡ç†çš„æ‰©å±•æ€§è¾ƒå·®ï¼ˆå¦‚åˆ†å¸ƒå¼éƒ¨ç½²æ—¶éœ€è¦é¢å¤–è§£å†³ä¼šè¯å…±äº«é—®é¢˜ï¼‰ã€‚ JWT é‰´æƒ åŸºäº æ— çŠ¶æ€ çš„è®¾è®¡ï¼ŒæœåŠ¡å™¨ä¸éœ€è¦ä¿å­˜ä»»ä½•ä¼šè¯ä¿¡æ¯ã€‚ ç”¨æˆ·çš„è®¤è¯ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ· IDã€è§’è‰²ç­‰ï¼‰è¢«ç¼–ç ä¸ºä¸€ä¸ªåŠ å¯†åçš„ Tokenï¼Œç”±å®¢æˆ·ç«¯å­˜å‚¨ï¼ˆå¦‚ Cookie æˆ– Local Storageï¼‰å¹¶åœ¨æ¯æ¬¡è¯·æ±‚æ—¶å‘é€ç»™æœåŠ¡å™¨ã€‚ é€‚ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå› ä¸ºä¸éœ€è¦ä¾èµ–æœåŠ¡å™¨çš„ä¼šè¯å­˜å‚¨ã€‚ 2. å®‰å…¨æ€§ ä¼ ç»Ÿé‰´æƒ Session ID æœ¬èº«é€šå¸¸æ²¡æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œä»…ç”¨æ¥ç´¢å¼•æœåŠ¡å™¨å­˜å‚¨çš„ç”¨æˆ·æ•°æ®ã€‚ éœ€è¦é˜²èŒƒ ä¼šè¯åŠ«æŒ å’Œ è·¨ç«™ç‚¹ä¼ªé€ è¯·æ±‚ï¼ˆCSRFï¼‰ã€‚ JWT é‰´æƒ Token è‡ªåŒ…å«ç”¨æˆ·æ•°æ®ï¼Œä¸”é€šè¿‡ç­¾åï¼ˆå¦‚ HMAC æˆ– RSAï¼‰é˜²ç¯¡æ”¹ã€‚ å¦‚æœå¯†é’¥æ³„éœ²ï¼Œæ”»å‡»è€…å¯èƒ½ä¼ªé€  Tokenï¼Œå› æ­¤å¯†é’¥çš„å®‰å…¨æ€§å°¤ä¸ºé‡è¦ã€‚ éœ€è¦é¢å¤–æ³¨æ„ Token çš„ç”Ÿå‘½å‘¨æœŸå’Œåˆ·æ–°ç­–ç•¥ï¼Œé¿å…è¢«çªƒå–åé•¿æœŸæœ‰æ•ˆã€‚ 3. æ‰©å±•æ€§å’Œæ€§èƒ½ ä¼ ç»Ÿé‰´æƒ éœ€è¦æœåŠ¡å™¨å¤„ç†å’Œå­˜å‚¨æ¯ä¸ªç”¨æˆ·çš„ä¼šè¯çŠ¶æ€ï¼Œéšç€ç”¨æˆ·æ•°é‡å¢åŠ ï¼Œæ‰©å±•æ€§æœ‰é™ã€‚ æ¯æ¬¡ç”¨æˆ·è¯·æ±‚éƒ½ä¼šæ¶‰åŠæœåŠ¡å™¨ç«¯çŠ¶æ€çš„è¯»å–æ“ä½œï¼Œå¢åŠ äº†æœåŠ¡å™¨çš„è´Ÿæ‹…ã€‚ JWT é‰´æƒ ä¸éœ€è¦åœ¨æœåŠ¡å™¨ç«¯å­˜å‚¨çŠ¶æ€ä¿¡æ¯ï¼Œæ‰€æœ‰ä¿¡æ¯éƒ½åœ¨ Token ä¸­æºå¸¦ï¼ŒæœåŠ¡å™¨åªéœ€éªŒè¯ Tokenã€‚ å‡å°‘äº†æœåŠ¡å™¨è´Ÿæ‹…ï¼Œå°¤å…¶é€‚åˆé«˜å¹¶å‘åœºæ™¯ã€‚ 4. ç”Ÿå‘½å‘¨æœŸå’Œåˆ·æ–°æœºåˆ¶ ä¼ ç»Ÿé‰´æƒ Session é€šå¸¸æœ‰æ˜ç¡®çš„è¿‡æœŸæ—¶é—´ï¼Œå¯ä»¥é€šè¿‡æœåŠ¡å™¨ç«¯ç›´æ¥å¤±æ•ˆï¼ˆåˆ é™¤ä¼šè¯æ•°æ®ï¼‰ã€‚ æä¾›è¾ƒç®€å•çš„ä¼šè¯ç®¡ç†å’Œç”¨æˆ·é€€å‡ºæœºåˆ¶ã€‚ JWT é‰´æƒ JWT ä¸€æ—¦ç­¾å‘ï¼Œåœ¨è¿‡æœŸä¹‹å‰æ— æ³•ç›´æ¥ä½¿å…¶å¤±æ•ˆï¼ˆé™¤éå¼•å…¥é¢å¤–çš„é»‘åå•æœºåˆ¶ï¼‰ã€‚ é€šå¸¸ä½¿ç”¨ çŸ­æœŸ Token + åˆ·æ–° Token çš„ç»„åˆï¼ŒçŸ­æœŸ Token è¿‡æœŸåç”¨åˆ·æ–° Token è·å–æ–° Tokenã€‚ 5. ä½¿ç”¨åœºæ™¯ ä¼ ç»Ÿé‰´æƒ æ›´é€‚åˆéœ€è¦é¢‘ç¹äº¤äº’çš„å°å‹æˆ–å•ä½“åº”ç”¨ã€‚ å½“å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜æ—¶ï¼Œå¯ä»¥å€ŸåŠ©æœåŠ¡å™¨ç®¡ç†ä¼šè¯æ¥æ›´çµæ´»åœ°æ§åˆ¶ç”¨æˆ·æƒé™ã€‚ JWT é‰´æƒ æ›´é€‚åˆå¾®æœåŠ¡æ¶æ„ã€ç§»åŠ¨åº”ç”¨ã€å•é¡µåº”ç”¨ï¼ˆSPAï¼‰ç­‰åˆ†å¸ƒå¼åœºæ™¯ã€‚ è·¨åŸŸæ”¯æŒæ›´å‹å¥½ï¼Œå› ä¸ºå¯ä»¥ä½¿ç”¨ HTTP æ ‡å¤´ä¼ é€’ Tokenã€‚ æ€»ç»“ ç‰¹æ€§ ä¼ ç»Ÿé‰´æƒ JWT é‰´æƒ çŠ¶æ€ç®¡ç† æœ‰çŠ¶æ€ï¼Œéœ€è¦æœåŠ¡å™¨å­˜å‚¨ æ— çŠ¶æ€ï¼Œæ‰€æœ‰ä¿¡æ¯åœ¨ Token ä¸­ æ‰©å±•æ€§ ä½ï¼Œéœ€å¤„ç†ä¼šè¯å…±äº« é«˜ï¼Œé€‚åˆåˆ†å¸ƒå¼ç³»ç»Ÿ å®‰å…¨æ€§ ä¾èµ–æœåŠ¡å™¨æ§åˆ¶ å¯†é’¥ç®¡ç†å’Œ Token å®‰å…¨æ€§å…³é”® ç”Ÿå‘½å‘¨æœŸ æœåŠ¡ç«¯å¯éšæ—¶æ§åˆ¶ä¼šè¯å¤±æ•ˆ ç”Ÿå‘½å‘¨æœŸæ§åˆ¶å¤æ‚ï¼ˆéœ€åˆ·æ–°æœºåˆ¶ï¼‰ é€‚ç”¨åœºæ™¯ å°å‹æˆ–å•ä½“åº”ç”¨ åˆ†å¸ƒå¼ç³»ç»Ÿã€ç§»åŠ¨å‰åç«¯åˆ†ç¦»åº”ç”¨ JWTï¼ˆJSON Web Tokenï¼‰è‡ªåŠ¨åˆ·æ–°æœºåˆ¶ä¸»è¦ç”¨äºæå‡ç”¨æˆ·ä½“éªŒå’Œå®‰å…¨æ€§ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åŸå› ï¼š æå‡ç”¨æˆ·ä½“éªŒï¼š å‡å°‘ç™»å½•é¢‘ç‡ï¼šé€šè¿‡è‡ªåŠ¨åˆ·æ–°æœºåˆ¶ï¼Œç”¨æˆ·ä¸éœ€è¦é¢‘ç¹é‡æ–°ç™»å½•ã€‚å½“ç”¨æˆ·çš„è®¿é—®ä»¤ç‰Œï¼ˆAccess Tokenï¼‰è¿‡æœŸæ—¶ï¼Œç³»ç»Ÿå¯ä»¥ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œï¼ˆRefresh Tokenï¼‰è‡ªåŠ¨è·å–æ–°çš„è®¿é—®ä»¤ç‰Œï¼Œä»è€Œä¿æŒç”¨æˆ·ä¼šè¯çš„è¿ç»­æ€§ã€‚ å¢å¼ºå®‰å…¨æ€§ï¼š çŸ­æœŸæœ‰æ•ˆçš„è®¿é—®ä»¤ç‰Œï¼šè®¿é—®ä»¤ç‰Œé€šå¸¸è®¾ç½®è¾ƒçŸ­çš„æœ‰æ•ˆæœŸï¼ˆä¾‹å¦‚ 15 åˆ†é’Ÿï¼‰ï¼Œè¿™æ ·å³ä½¿è®¿é—®ä»¤ç‰Œè¢«æ³„éœ²ï¼Œæ”»å‡»è€…ä¹Ÿæ— æ³•é•¿æ—¶é—´ä½¿ç”¨å®ƒã€‚ é•¿æœŸæœ‰æ•ˆçš„åˆ·æ–°ä»¤ç‰Œï¼šåˆ·æ–°ä»¤ç‰Œé€šå¸¸è®¾ç½®è¾ƒé•¿çš„æœ‰æ•ˆæœŸï¼ˆä¾‹å¦‚ 30 å¤©ï¼‰ï¼Œä½†åªèƒ½ç”¨äºè·å–æ–°çš„è®¿é—®ä»¤ç‰Œï¼Œä¸èƒ½ç›´æ¥è®¿é—®å—ä¿æŠ¤çš„èµ„æºã€‚è¿™æ ·å³ä½¿åˆ·æ–°ä»¤ç‰Œè¢«æ³„éœ²ï¼Œæ”»å‡»è€…ä¹Ÿæ— æ³•ç›´æ¥è®¿é—®ç”¨æˆ·æ•°æ®ã€‚ æ’¤é”€æœºåˆ¶ï¼šå¦‚æœæ€€ç–‘åˆ·æ–°ä»¤ç‰Œè¢«æ³„éœ²ï¼Œå¯ä»¥ç«‹å³æ’¤é”€è¯¥ä»¤ç‰Œï¼Œä»è€Œé˜²æ­¢è¿›ä¸€æ­¥çš„æœªæˆæƒè®¿é—®ã€‚ çµæ´»æ€§ï¼š åŠ¨æ€è°ƒæ•´ä»¤ç‰Œæœ‰æ•ˆæœŸï¼šå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚åŠ¨æ€è°ƒæ•´è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œçš„æœ‰æ•ˆæœŸï¼Œä»¥å¹³è¡¡å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒã€‚ å®ç° JWT è‡ªåŠ¨åˆ·æ–°çš„æ­¥éª¤: ç”Ÿæˆè®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œï¼š å½“ç”¨æˆ·ç™»å½•æˆåŠŸæ—¶ï¼Œç”Ÿæˆä¸€ä¸ªçŸ­æœŸæœ‰æ•ˆçš„è®¿é—®ä»¤ç‰Œå’Œä¸€ä¸ªé•¿æœŸæœ‰æ•ˆçš„åˆ·æ–°ä»¤ç‰Œã€‚ å°†è®¿é—®ä»¤ç‰Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¹¶å°†åˆ·æ–°ä»¤ç‰Œå­˜å‚¨åœ¨å®‰å…¨çš„åœ°æ–¹ï¼ˆå¦‚æœåŠ¡å™¨ç«¯çš„æ•°æ®åº“æˆ–ç¼“å­˜ä¸­ï¼‰ã€‚ å®¢æˆ·ç«¯å­˜å‚¨ä»¤ç‰Œï¼š å®¢æˆ·ç«¯é€šå¸¸å°†è®¿é—®ä»¤ç‰Œå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼ˆå¦‚æµè§ˆå™¨çš„ localStorage æˆ– sessionStorageï¼‰ï¼Œå¹¶åœ¨æ¯æ¬¡è¯·æ±‚æ—¶å°†å…¶é™„åŠ åˆ°è¯·æ±‚å¤´ä¸­ã€‚ åˆ·æ–°ä»¤ç‰Œé€šå¸¸å­˜å‚¨åœ¨æ›´å®‰å…¨çš„åœ°æ–¹ï¼Œå¦‚ HTTP-only Cookieï¼Œä»¥é˜²æ­¢ XSS æ”»å‡»ã€‚ è®¿é—®ä»¤ç‰Œè¿‡æœŸå¤„ç†ï¼š å½“è®¿é—®ä»¤ç‰Œè¿‡æœŸæ—¶ï¼Œå®¢æˆ·ç«¯ä¼šå°è¯•ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œè·å–æ–°çš„è®¿é—®ä»¤ç‰Œã€‚ å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œè¯·æ±‚ä¸­åŒ…å«åˆ·æ–°ä»¤ç‰Œã€‚ æœåŠ¡å™¨éªŒè¯åˆ·æ–°ä»¤ç‰Œçš„æœ‰æ•ˆæ€§ï¼Œå¦‚æœæœ‰æ•ˆï¼Œåˆ™ç”Ÿæˆä¸€ä¸ªæ–°çš„è®¿é—®ä»¤ç‰Œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ åˆ·æ–°ä»¤ç‰Œçš„å®‰å…¨æ€§ï¼š åˆ·æ–°ä»¤ç‰Œåº”è¯¥å­˜å‚¨åœ¨å®‰å…¨çš„åœ°æ–¹ï¼Œé˜²æ­¢è¢«çªƒå–ã€‚ å¯ä»¥è®¾ç½®åˆ·æ–°ä»¤ç‰Œçš„è¿‡æœŸæ—¶é—´ï¼Œå¹¶åœ¨ç”¨æˆ·ç™»å‡ºæ—¶ç«‹å³æ’¤é”€åˆ·æ–°ä»¤ç‰Œã€‚ å¯ä»¥é™åˆ¶æ¯ä¸ªåˆ·æ–°ä»¤ç‰Œåªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œä½¿ç”¨åç«‹å³å¤±æ•ˆã€‚ 7.8.1 pom é…ç½® pom.xml !-- jwt ç‰ˆæœ¬ --jwt.version0.12.6/jwt.version!-- https://mvnrepository.com/artifact/io.jsonwebtoken/jjwt --dependency groupIdio.jsonwebtoken/groupId artifactIdjjwt/artifactId version$jwt.version/version/dependency cshop-commonpom.xml dependency groupIdio.jsonwebtoken/groupId artifactIdjjwt/artifactId/dependency 7.8.2 åŠŸèƒ½å¼€å‘7.8.2.1 jwt ç”Ÿæˆ cshop-commonsrcmainJavagithublianyutiancshopcommonutilsJWTUtil.Java package github.lianyutian.cshop.common.utils;import github.lianyutian.cshop.common.model.LoginUserInfo;import io.jsonwebtoken.Claims;import io.jsonwebtoken.Jws;import io.jsonwebtoken.Jwts;import io.jsonwebtoken.security.Keys;import java.util.Date;import java.util.HashMap;import java.util.Map;import lombok.extern.slf4j.Slf4j;/** * jwt å·¥å…·ç±» * * @author lianyutian * @since 2024-12-24 10:01:54 * @version 1.0 */@Slf4jpublic class JWTUtil /** AccessToken è¿‡æœŸæ—¶é—´ï¼Œæ­£å¸¸è¿‡æœŸæ—¶é—´ 7 å¤© */ private static final long EXPIRE = 1000L * 60 * 60 * 24 * 7; /** RefreshToken è¿‡æœŸæ—¶é—´ï¼Œæ­£å¸¸è¿‡æœŸæ—¶é—´ 30 å¤© */ public static final long REFRESH_EXPIRE = 1000L * 60 * 60 * 24 * 30; /** åŠ å¯†çš„å¯†é’¥ï¼Œä»ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶ä¸­è¯»å– */ private static final String SECRET = MIIEowIBAAKCAQEAwG90ULRHmAXFXQzZSwleoYts2+bCzUvqhhqtGiv/F5kUsETY; /** token å‰ç¼€ */ private static final String TOKEN_PREFIX = circle-shop.; /** SUBJECT */ private static final String SUBJECT = circle-shop; public static final String KEY_PREFIX = circle-shop:refresh-token:; /** * æ ¹æ®ç”¨æˆ·ä¿¡æ¯ï¼Œç”Ÿæˆ JWT ä»¤ç‰Œ * * @return JWT ä»¤ç‰Œ */ public static MapString, Object createJwt(LoginUserInfo loginUserInfo) if (loginUserInfo == null) throw new NullPointerException(ç™»å½•å¯¹è±¡ä¸ºç©º); // è¿‡æœŸæ—¶é—´ Date expireTime = new Date(System.currentTimeMillis() + EXPIRE); // ç”Ÿæˆ JWT TOKEN String token = Jwts.builder() .subject(SUBJECT) // payload .claim(id, loginUserInfo.getId()) .claim(name, loginUserInfo.getName()) .claim(avatar, loginUserInfo.getAvatar()) .issuedAt(new Date()) .expiration(expireTime) // åŠ å¯†ç®—æ³• .signWith(Keys.hmacShaKeyFor(SECRET.getBytes()), Jwts.SIG.HS256) .compact(); // åŠ å‰ç¼€åŒºåˆ†ä¸šåŠ¡ token = TOKEN_PREFIX + token; MapString, Object result = new HashMap(); result.put(AccessToken, token); result.put(AccessTokenExpireTime, expireTime); result.put(RefreshToken, CommonUtil.generateUUID()); log.info(å…¬å…±æœåŠ¡-ç”Ÿæˆ tokenï¼Œè¿‡æœŸæ—¶é—´ï¼š, expireTime); return result; /** * æ ¡éªŒ token æ˜¯å¦æ­£ç¡® * * @param token token * @return Claims */ public static Claims parserToken(String token) if (token == null || !token.startsWith(TOKEN_PREFIX)) log.warn(å…¬å…±æœåŠ¡-è§£æ token å¤±è´¥ï¼šæ— æ•ˆçš„ token æ ¼å¼); return null; try // å»é™¤å‰ç¼€åè§£æ String cleanToken = token.replace(TOKEN_PREFIX, ); // jws è§£æ JwsClaims claims = Jwts.parser() .verifyWith(Keys.hmacShaKeyFor(SECRET.getBytes())) .build() .parseSignedClaims(cleanToken); log.info(å…¬å…±æœåŠ¡-è§£æ token æˆåŠŸ); return claims.getPayload(); catch (Exception e) log.error(å…¬å…±æœåŠ¡-è§£æ token å¤±è´¥ï¼š, e.getMessage(), e); return null; 7.8.2.2 ç™»å½•æˆåŠŸç”Ÿæˆ jwt cshop-usersrcmainJavagithublianyutiancshopuserserviceUserServiceImpl.Java @Overridepublic ApiResultMapString, Object login(UserLoginParam userLoginParam) // æ ¹æ®æ‰‹æœºå·æŸ¥è¯¢æ˜¯å¦å­˜åœ¨ LambdaQueryWrapperUser queryWrapper = new LambdaQueryWrapper(); queryWrapper.eq(User::getPhone, userLoginParam.getPhone()); User user = userMapper.selectOne(queryWrapper); if (user == null) // æœªæ³¨å†Œ return ApiResult.result(BizCodeEnum.USER_ACCOUNT_PWD_ERROR); // æ ¡éªŒå¯†ç  if (passwordEncoder.matches(userLoginParam.getPassword(), user.getPwd())) // ç™»å½•æˆåŠŸï¼Œç”Ÿæˆ jwt MapString, Object jwt = createNewJwt(user); return ApiResult.success(jwt); else return ApiResult.result(BizCodeEnum.USER_ACCOUNT_PWD_ERROR); private MapString, Object createNewJwt(User user) // ç™»å½•æˆåŠŸï¼Œç”Ÿæˆ Token LoginUserInfo loginUserInfo = BeanUtil.copy(user, LoginUserInfo.class); BeanUtils.copyProperties(user, loginUserInfo); // ç”Ÿæˆ JWT Tokenï¼Œè¿‡æœŸæ—¶é—´ MapString, Object jwt = JWTUtil.createJwt(loginUserInfo); // 4ã€è®¾ç½® RefreshToken åˆ° Redis ä¸­ï¼Œè¿‡æœŸæ—¶é—´ä¸º 30 å¤© String newRefreshToken = (String) jwt.get(RefreshToken); String key = JWTUtil.KEY_PREFIX + newRefreshToken; redisCache.set(key, 1, JWTUtil.REFRESH_EXPIRE, TimeUnit.MILLISECONDS); return jwt; 7.8.2.3 åˆ·æ–° token cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserController.Java /** * åˆ·æ–° token * * @param refreshToken refreshToken * @param accessToken accessToken * @return æ–°çš„ token */@PostMapping(refreshToken)public ApiResultMapString, Object refreshToken( @RequestParam(value = refreshToken) String refreshToken, @RequestParam(value = accessToken) String accessToken) return userService.refreshToken(refreshToken, accessToken); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserService.Java /** * åˆ·æ–° token * * @param refreshToken åˆ·æ–° token * @param accessToken è®¿é—® token */ApiResultMapString, Object refreshToken(String refreshToken, String accessToken); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserServiceImpl.Java @Overridepublic ApiResultMapString, Object refreshToken(String refreshToken, String accessToken) String refreshTokenVal = redisCache.get(JWTUtil.KEY_PREFIX + refreshToken); // refreshToken è¿‡æœŸ if (StringUtils.isBlank(refreshTokenVal)) return ApiResult.result(BizCodeEnum.USER_REFRESH_TOKEN_EMPTY); // 2ã€å¦‚æœ refreshToken å­˜åœ¨ï¼Œè§£å¯† accessToken Claims claims = JWTUtil.parserToken(accessToken); if (claims == null) // æ— æ³•è§£å¯†æç¤ºæœªç™»å½• return ApiResult.result(BizCodeEnum.USER_ACCOUNT_UNLOGIN); // 3ã€å¦‚æœå¯ä»¥è§£å¯† accessTokenï¼Œ åˆ™é‡æ–°ç”Ÿæˆ accessToken ç­‰ä¿¡æ¯è¿”å› long userId = Long.parseLong(claims.get(id).toString()); LambdaQueryWrapperUser queryWrapper = new LambdaQueryWrapper(); queryWrapper.eq(User::getId, userId); User user = userMapper.selectOne(queryWrapper); if (user != null) MapString, Object jwt = createNewJwt(user); // åˆ é™¤æ—§çš„ refreshToken redisCache.delete(JWTUtil.KEY_PREFIX + refreshToken); return ApiResult.success(jwt); else // æ— æ³•è§£å¯†æç¤ºæœªç™»å½• return ApiResult.result(BizCodeEnum.USER_ACCOUNT_UNLOGIN); 7.9 ç™»å½•æ‹¦æˆªåœ¨ç”¨æˆ·ç™»å½•æ—¶å¯ä»¥è·å–åˆ° token ä¿¡æ¯ï¼Œåœ¨è®¿é—®ä¸€äº›æ¥å£æ—¶éœ€è¦åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ã€‚æ­¤æ—¶å¯ä»¥åœ¨ä½¿ç”¨ Interceptor æ‹¦æˆªå™¨æ‹¦æˆªè¯·æ±‚æ¥å£è§£æ token åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ã€‚ cshop-commonsrcmainJavagithublianyutiancshopcommoninterceptorLoginInterceptor.Java package github.lianyutian.cshop.common.interceptor;import github.lianyutian.cshop.common.enums.BizCodeEnum;import github.lianyutian.cshop.common.model.ApiResult;import github.lianyutian.cshop.common.model.LoginUserInfo;import github.lianyutian.cshop.common.utils.CommonUtil;import github.lianyutian.cshop.common.utils.JWTUtil;import github.lianyutian.cshop.common.utils.JsonUtil;import io.jsonwebtoken.Claims;import jakarta.servlet.http.HttpServletRequest;import jakarta.servlet.http.HttpServletResponse;import lombok.extern.slf4j.Slf4j;import org.apache.commons.lang3.StringUtils;import org.springframework.web.servlet.HandlerInterceptor;/** * ç™»å½•æ‹¦æˆª * * @author lianyutian * @since 2024-12-25 15:47:02 * @version 1.0 */@Slf4jpublic class LoginInterceptor implements HandlerInterceptor public static final ThreadLocalLoginUserInfo USER_THREAD_LOCAL = new ThreadLocal(); @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception String token = request.getHeader(token); if (StringUtils.isBlank(token)) token = request.getParameter(token); Claims claims = JWTUtil.parserToken(token); if (claims == null) // è§£å¯†å¤±è´¥ï¼Œç™»å½•è¿‡æœŸï¼Œæç¤ºè´¦å·æœªç™»å½• CommonUtil.sendResponse(response, ApiResult.result(BizCodeEnum.USER_ACCOUNT_UNLOGIN)); return false; long id = Long.parseLong(claims.get(id).toString()); String avatar = (String) claims.get(avatar); String name = (String) claims.get(name); LoginUserInfo loginUserInfo = LoginUserInfo.builder().id(id).avatar(avatar).name(name).build(); USER_THREAD_LOCAL.set(loginUserInfo); log.info(ç™»å½•æ‹¦æˆªå™¨--ç”¨æˆ·ä¿¡æ¯ï¼š, JsonUtil.toJson(loginUserInfo)); return true; é…ç½®æ‹¦æˆªè·¯å¾„ cshop-commonsrcmainJavagithublianyutiancshopcommoninterceptorconfigInterceptorConfig.Java package github.lianyutian.cshop.common.interceptor.config;import github.lianyutian.cshop.common.interceptor.LoginInterceptor;import lombok.extern.slf4j.Slf4j;import org.springframework.context.annotation.Configuration;import org.springframework.web.servlet.config.annotation.InterceptorRegistry;import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;/** * ç™»å½•æ‹¦æˆªé…ç½® * * @author lianyutian * @since 2024-12-25 16:17:31 * @version 1.0 */@Configuration@Slf4jpublic class InterceptorConfig implements WebMvcConfigurer public LoginInterceptor loginInterceptor() return new LoginInterceptor(); @Override public void addInterceptors(InterceptorRegistry registry) registry // æ·»åŠ æ‹¦æˆªå™¨ .addInterceptor(loginInterceptor()) // ä¸éœ€è¦æ‹¦æˆªçš„è·¯å¾„ .excludePathPatterns( /api/user/*/getImgCaptcha, /api/user/*/sendRegisterCode, /api/user/*/register, /api/user/*/login, /api/user/*/uploadUserAvatar, /api/user/*/detailShow/*); 7.10 è·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ cshop-usersrcmainJavagithublianyutiancshopusermodelvoUserDetailVO.Java package github.lianyutian.cshop.user.model.vo;import lombok.Data;/** * ç”¨æˆ·ä¿¡æ¯ VO * * @author lianyutian * @since 2024-12-25 16:22:40 * @version 1.0 */@Datapublic class UserDetailVO private Long id; /** ç”¨æˆ·å */ private String name; /** ç”¨æˆ·å¤´åƒ */ private String avatar; /** 0 å¥³ï¼Œ1 ç”· */ private Integer sex; /** ç”¨æˆ·æ‰‹æœºå· */ private String phone; cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserController.Java /** * ç”¨æˆ·è´¦å·ä¿¡æ¯æŸ¥è¯¢ * * @return ç”¨æˆ·ä¿¡æ¯ */@GetMapping(detail)public ApiResultUserDetailVO detail() UserDetailVO userDetailVO = userService.getUserDetail(); return ApiResult.success(userDetailVO); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserService.Java /** * è·å–ç”¨æˆ·è¯¦æƒ… * * @return ç”¨æˆ·è¯¦æƒ… */UserDetailVO getUserDetail(); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserServiceImpl.Java @Overridepublic UserDetailVO getUserDetail() // é€šè¿‡ç™»å½•æ‹¦æˆªå™¨ä¸­ ThreadLocal è¿›è¡Œäº†ç”¨æˆ·ä¿¡æ¯ä¼ é€’ LoginUserInfo loginUserInfo = LoginInterceptor.USER_THREAD_LOCAL.get(); User user = userMapper.selectOne(new LambdaQueryWrapperUser().eq(User::getId, loginUserInfo.getId())); UserDetailVO userDetailVO = new UserDetailVO(); BeanUtils.copyProperties(user, userDetailVO); return userDetailVO; æ—  token è®¿é—®ç”¨æˆ·ä¿¡æ¯ æœ‰æ•ˆ token è®¿é—®ç”¨æˆ·ä¿¡æ¯ 7.11 ç”¨æˆ·åœ°å€ç›¸å…³ cshop-userdocSQLuser.SQL create table user_address( id bigint unsigned auto_increment primary key, user_id bigint null comment ç”¨æˆ·id, default_status tinyint(1) default 0 null comment æ˜¯å¦é»˜è®¤æ”¶è´§åœ°å€ï¼š0å¦ 1æ˜¯, receive_name varchar(64) null comment æ”¶å‘è´§äººå§“å, phone varchar(64) null comment æ”¶è´§äººç”µè¯, province varchar(64) null comment çœ/ç›´è¾–å¸‚, city varchar(64) null comment å¸‚, region varchar(64) null comment åŒº, detail_address varchar(200) null comment è¯¦ç»†åœ°å€, create_time datetime default CURRENT_TIMESTAMP null comment åˆ›å»ºæ—¶é—´, update_time datetime default CURRENT_TIMESTAMP null on update CURRENT_TIMESTAMP comment æ›´æ–°æ—¶é—´) comment ç”¨æˆ·æ”¶è´§åœ°å€è¡¨ row_format = DYNAMIC;create index uid on user_address (user_id); 7.11.1 æ–°å¢ç”¨æˆ·åœ°å€ cshop-usersrcmainJavagithublianyutiancshopusermodelparamAddressAddParam.Java package github.lianyutian.cshop.user.model.param;import lombok.Data;/** * æ·»åŠ ç”¨æˆ·æ”¶è´§åœ°å€ VO * * @author lianyutian * @since 2024-12-26 10:18:32 * @version 1.0 */@Datapublic class AddressAddParam /** æ˜¯å¦é»˜è®¤æ”¶è´§åœ°å€ï¼š0 å¦ 1 æ˜¯ */ private Integer defaultStatus; /** æ”¶å‘è´§äººå§“å */ private String receiveName; /** æ”¶è´§äººç”µè¯ */ private String phone; /** çœ/ç›´è¾–å¸‚ */ private String province; /** å¸‚ */ private String city; /** åŒº */ private String region; /** è¯¦ç»†åœ°å€ */ private String detailAddress; cshop-usersrcmainJavagithublianyutiancshopuserenumsAddressStatusEnum.Java package github.lianyutian.cshop.user.enums;import lombok.Getter;/** * æ”¶è´§åœ°å€çŠ¶æ€æšä¸¾ * * @author lianyutian * @since 2024-12-26 17:34:38 * @version 1.0 */@Getterpublic enum AddressStatusEnum DEFAULT_STATUS(0, é»˜è®¤åœ°å€), NOT_DEFAULT_STATUS(1, éé»˜è®¤åœ°å€); private final Integer code; private final String message; AddressStatusEnum(Integer code, String message) this.code = code; this.message = message; cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserAddressController.Java package github.lianyutian.cshop.user.controller;/** * UserAddressController * * @author lianyutian * @since 2024-12-26 09:42:18 * @version 1.0 */@AllArgsConstructor@RestController@RequestMapping(/api/address/v1)public class UserAddressController private final UserAddressService userAddressService; /** * æ–°å¢æ”¶è´§åœ°å€ * * @param addressAddParam æ”¶è´§åœ°å€ * @return æ–°å¢ç»“æœ */ @PostMapping(add) public ApiResultVoid add(@RequestBody AddressAddParam addressAddParam) userAddressService.addUserAddress(addressAddParam); return ApiResult.success(); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserAddressService.Java package github.lianyutian.cshop.user.service;/** * ç”¨æˆ·åœ°å€æœåŠ¡æ¥å£ * * @author lianyutian * @since 2024-12-26 09:54:49 * @version 1.0 */public interface UserAddressService /** * æ–°å¢ç”¨æˆ·åœ°å€ * * @param addressAddParam æ–°å¢ç”¨æˆ·åœ°å€å‚æ•° */ void addUserAddress(AddressAddParam addressAddParam); cshop-usersrcmainJavagithublianyutiancshopuserserviceimplUserAddressServiceImpl.Java package github.lianyutian.cshop.user.service.impl;/** * ç”¨æˆ·åœ°å€æœåŠ¡æ¥å£å®ç°ç±» * * @author lianyutian * @since 2024-12-26 09:55:13 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class UserAddressServiceImpl implements UserAddressService private final UserAddressMapper userAddressMapper; @Override @Transactional(rollbackFor = Exception.class) public void addUserAddress(AddressAddParam addressAddParam) LoginUserInfo loginUserInfo = getLoginUserInfo(); UserAddress userAddress = BeanUtil.copy(addressAddParam, UserAddress.class); userAddress.setUserId(loginUserInfo.getId()); setDefaultStatusIfRequired(userAddress); int affectedRows = userAddressMapper.insert(userAddress); log.info( ç”¨æˆ·æ”¶è´§åœ°å€æ¨¡å—-æ–°å¢æ”¶è´§åœ°å€ï¼šaffectedRows=ï¼Œdata=, affectedRows, formatUserAddressForLog(userAddress)); private LoginUserInfo getLoginUserInfo() LoginUserInfo loginUserInfo = LoginInterceptor.USER_THREAD_LOCAL.get(); if (loginUserInfo == null) throw new IllegalStateException(LoginUserInfo not found in ThreadLocal); return loginUserInfo; private void setDefaultStatusIfRequired(UserAddress userAddress) if (Objects.equals( userAddress.getDefaultStatus(), AddressStatusEnum.DEFAULT_STATUS.getCode())) // è®¾ç½®é»˜è®¤çš„ä¸ºéé»˜è®¤çŠ¶æ€ userAddressMapper.update( null, new LambdaUpdateWrapperUserAddress() .set(UserAddress::getDefaultStatus, AddressStatusEnum.NOT_DEFAULT_STATUS.getCode()) .eq(UserAddress::getUserId, userAddress.getUserId()) .eq(UserAddress::getDefaultStatus, AddressStatusEnum.DEFAULT_STATUS.getCode())); private String formatUserAddressForLog(UserAddress userAddress) // åªæ‰“å°å¿…è¦çš„å­—æ®µï¼Œé¿å…æ³„éœ²æ•æ„Ÿä¿¡æ¯ return id= + userAddress.getId() + , userId= + userAddress.getUserId() + , defaultStatus= + userAddress.getDefaultStatus(); cshop-usersrcmainJavagithublianyutiancshopusermapperUserAddressMapper.Java package github.lianyutian.cshop.user.mapper;import com.baomidou.mybatisplus.core.mapper.BaseMapper;import github.lianyutian.cshop.user.model.po.UserAddress;import org.apache.ibatis.annotations.Mapper;/** * UserAddressMapper * * @author lianyutian * @since 2024-12-26 14:19:30 * @version 1.0 */@Mapperpublic interface UserAddressMapper extends BaseMapperUserAddress cshop-usersrcmainresourcesmapperUserAddressMapper.xml ?xml version=1.0 encoding=UTF-8?!DOCTYPE mapper PUBLIC -//mybatis.org//DTD Mapper 3.0//EN http://mybatis.org/dtd/mybatis-3-mapper.dtdmapper namespace=github.lianyutian.cshop.user.mapper.UserAddressMapper resultMap id=BaseResultMap type=github.lianyutian.cshop.user.model.po.UserAddress id property=id column=id jdbcType=BIGINT/ result property=userId column=user_id jdbcType=BIGINT/ result property=defaultStatus column=default_status jdbcType=TINYINT/ result property=receiveName column=receive_name jdbcType=VARCHAR/ result property=phone column=phone jdbcType=VARCHAR/ result property=province column=province jdbcType=VARCHAR/ result property=city column=city jdbcType=VARCHAR/ result property=region column=region jdbcType=VARCHAR/ result property=detailAddress column=detail_address jdbcType=VARCHAR/ result property=createTime column=create_time jdbcType=TIMESTAMP/ result property=updateTime column=update_time jdbcType=TIMESTAMP/ /resultMap sql id=Base_Column_List id,user_id,default_status, receive_name,phone,province, city,region,detail_address, create_time,update_time /sql/mapper 7.11.2 æ ¹æ® id æŸ¥è¯¢æ”¶è´§åœ°å€è¯¦æƒ… cshop-usersrcmainJavagithublianyutiancshopusermodelvoUserAddressVO.Java package github.lianyutian.cshop.user.model.vo;import lombok.Data;/** * ç”¨æˆ·åœ°å€ VO ç•Œé¢å±•ç¤º * * @author lianyutian * @since 2024-12-26 09:59:44 * @version 1.0 */@Datapublic class UserAddressVO private Long id; /** ç”¨æˆ· id */ private Long userId; /** æ˜¯å¦é»˜è®¤æ”¶è´§åœ°å€ï¼š0 å¦ 1 æ˜¯ */ private Integer defaultStatus; /** æ”¶å‘è´§äººå§“å */ private String receiveName; /** æ”¶è´§äººç”µè¯ */ private String phone; /** çœ/ç›´è¾–å¸‚ */ private String province; /** å¸‚ */ private String city; /** åŒº */ private String region; /** è¯¦ç»†åœ°å€ */ private String detailAddress; cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserAddressController.Java /** * æ ¹æ® id æŸ¥è¯¢æ”¶è´§åœ°å€è¯¦æƒ… * * @param addressId æ”¶è´§åœ°å€ id * @return æ”¶è·åœ°å€è¯¦æƒ… */@GetMapping(detail/addressId)public ApiResultUserAddressVO detail(@PathVariable(addressId) Long addressId) UserAddressVO userAddressVo = userAddressService.getUserAddressDetail(addressId); return userAddressVo == null ? ApiResult.result(BizCodeEnum.USER_ADDRESS_NOT_EXITS) : ApiResult.success(userAddressVo); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserAddressService.Java /** * æ ¹æ®ç”¨æˆ·åœ°å€ id è·å–ç”¨æˆ·åœ°å€è¯¦æƒ… * * @param addressId åœ°å€ ID * @return ç”¨æˆ·åœ°å€è¯¦æƒ… */UserAddressVO getUserAddressDetail(Long addressId); cshop-usersrcmainJavagithublianyutiancshopuserserviceimplUserAddressServiceImpl.Java @Overridepublic UserAddressVO getUserAddressDetail(Long addressId) if (addressId == null || addressId = 0) throw new IllegalArgumentException(Invalid addressId); UserAddress userAddress = userAddressMapper.selectById(addressId); if (userAddress == null) return null; return BeanUtil.copy(userAddress, UserAddressVO.class); 7.11.3 è·å–ç”¨æˆ·åœ°å€åˆ—è¡¨ cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserAddressController.Java /** * è·å–ç”¨æˆ·åœ°å€åˆ—è¡¨ * * @return ç”¨æˆ·åœ°å€åˆ—è¡¨ */@GetMapping(list)public ApiResultListUserAddressVO list() ListUserAddressVO allUserAddressList = userAddressService.getAllUserAddressList(); return ApiResult.success(allUserAddressList); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserAddressService.Java /** * è·å–ç”¨æˆ·åœ°å€åˆ—è¡¨ * * @return ç”¨æˆ·åœ°å€åˆ—è¡¨ */ListUserAddressVO getAllUserAddressList(); cshop-usersrcmainJavagithublianyutiancshopuserserviceimplUserAddressServiceImpl.Java @Overridepublic ListUserAddressVO getAllUserAddressList() LoginUserInfo loginUserInfo = getLoginUserInfo(); ListUserAddress userAddressList = userAddressMapper.selectList( new LambdaQueryWrapperUserAddress() .eq(UserAddress::getUserId, loginUserInfo.getId())); return userAddressList.stream().map(this::convertToUserAddressVO).collect(Collectors.toList());private UserAddressVO convertToUserAddressVO(UserAddress userAddress) return BeanUtil.copy(userAddress, UserAddressVO.class); 7.11.4 ä¿®æ”¹æŒ‡å®šæ”¶è´§åœ°å€ cshop-usersrcmainJavagithublianyutiancshopusermodelparamAddressEditParam.Java package github.lianyutian.cshop.user.model.param;import lombok.Data;/** * ä¿®æ”¹æŒ‡å®šæ”¶è´§åœ°å€å…¥å‚ * * @author lianyutian * @since 2024-12-26 11:02:20 * @version 1.0 */@Datapublic class AddressEditParam /** åœ°å€ id */ private Long id; /** æ˜¯å¦é»˜è®¤æ”¶è´§åœ°å€ï¼š0 å¦ 1 æ˜¯ */ private Integer defaultStatus; /** æ”¶å‘è´§äººå§“å */ private String receiveName; /** æ”¶è´§äººç”µè¯ */ private String phone; /** çœ/ç›´è¾–å¸‚ */ private String province; /** å¸‚ */ private String city; /** åŒº */ private String region; /** è¯¦ç»†åœ°å€ */ private String detailAddress; cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserAddressController.Java /** * ä¿®æ”¹æŒ‡å®šæ”¶è´§åœ°å€ * * @param addressEditParam æ”¶è´§åœ°å€ * @return ä¿®æ”¹ç»“æœ */@PostMapping(edit)public ApiResultVoid edit(@RequestBody AddressEditParam addressEditParam) boolean updated = userAddressService.updateUserAddress(addressEditParam); return updated ? ApiResult.success() : ApiResult.result(BizCodeEnum.USER_ADDRESS_NOT_EXITS); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserAddressService.Java /** * ä¿®æ”¹ç”¨æˆ·åœ°å€ * * @param addressEditParam ä¿®æ”¹ç”¨æˆ·åœ°å€å‚æ•° */boolean updateUserAddress(AddressEditParam addressEditParam); cshop-usersrcmainJavagithublianyutiancshopuserserviceimplUserAddressServiceImpl.Java @Override@Transactional(rollbackFor = Exception.class)public boolean updateUserAddress(AddressEditParam addressEditParam) UserAddress oldUserAddress = userAddressMapper.selectById(addressEditParam.getId()); if (oldUserAddress == null) return false; LoginUserInfo loginUserInfo = getLoginUserInfo(); UserAddress userAddress = BeanUtil.copy(addressEditParam, UserAddress.class); userAddress.setUserId(loginUserInfo.getId()); setDefaultStatusIfRequired(userAddress); int affectedRows = userAddressMapper.update( userAddress, new LambdaUpdateWrapperUserAddress() .eq(UserAddress::getId, addressEditParam.getId())); if (affectedRows == 0) log.warn(ç”¨æˆ·æ”¶è´§åœ°å€æ¨¡å—-æ›´æ–°æ”¶è´§åœ°å€å¤±è´¥ï¼šid=, addressEditParam.getId()); return false; log.info( ç”¨æˆ·æ”¶è´§åœ°å€æ¨¡å—-æ›´æ–°æ”¶è´§åœ°å€ï¼šaffectedRows=ï¼Œdata=, affectedRows, formatUserAddressForLog(userAddress)); return true; 7.11.5 åˆ é™¤ç”¨æˆ·åœ°å€ cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserAddressController.Java /** * åˆ é™¤æŒ‡å®šæ”¶è´§åœ°å€ * * @param addressId æ”¶è´§åœ°å€ id * @return åˆ é™¤ç»“æœ */@GetMapping(delete/addressId)public ApiResultVoid delete(@PathVariable(addressId) Long addressId) return userAddressService.deleteUserAddress(addressId) == 1 ? ApiResult.success() : ApiResult.result(BizCodeEnum.USER_ADDRESS_NOT_EXITS); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserAddressService.Java /** * åˆ é™¤ç”¨æˆ·åœ°å€ * * @param addressId åœ°å€ ID * @return åˆ é™¤ç»“æœ */int deleteUserAddress(Long addressId); cshop-usersrcmainJavagithublianyutiancshopuserserviceimplUserAddressServiceImpl.Java @Override@Transactional(rollbackFor = Exception.class)public int deleteUserAddress(Long addressId) return userAddressMapper.deleteById(addressId); 7.12 ç”¨æˆ·è¯¦æƒ…å¼•å…¥ Redisç”¨æˆ·ç‚¹å‡»è‡ªèº«è¯¦æƒ…æ—¶ä¼šæ˜¾ç¤º ç”¨æˆ·åã€å¤´åƒã€æ€§åˆ«ã€æ‰‹æœºå· ç­‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å¾ˆå°‘å˜åŠ¨ï¼Œå¯ä»¥è€ƒè™‘å†™å…¥ç¼“å­˜ä¸­ã€‚ cshop-usersrcmainJavagithublianyutiancshopuserconstantUserCacheKeyConstant.Java package github.lianyutian.cshop.user.constant;/** * ç¼“å­˜å¸¸é‡ * * @author lianyutian * @since 2024-12-24 13:46:37 * @version 1.0 */public class UserCacheKeyConstant /** å›¾å½¢éªŒè¯ç ç¼“å­˜ key å‰ç¼€ */ public static final String CAPTCHA_IMG_KEY_PREFIX = cshop-user:img-captcha:; /** æ³¨å†ŒéªŒè¯ç ç¼“å­˜ key å‰ç¼€ */ public static final String CAPTCHA_REGISTER_KEY_PREFIX = cshop-user:register-captcha:; /** ç”¨æˆ·ä¿¡æ¯æ›´æ–°é”å‰ç¼€ */ public static final String USER_UPDATE_LOCK_KEY_PREFIX = cshop-user:update:lock:; /** ç”¨æˆ·ä¿¡æ¯ç¼“å­˜å‰ç¼€ */ public static final String USER_DETAIL_KEY_PREFIX = cshop-user:detail:; /** ç”¨æˆ·å±•ç¤ºä¿¡æ¯ç¼“å­˜å‰ç¼€ */ public static final String USER_SHOW_KEY_PREFIX = cshop-user:show:; cshop-usersrcmainJavagithublianyutiancshopuserserviceimplUserServiceImpl.Java private final RedisCache redisCache;@Overridepublic UserDetailVO getUserDetail() // é€šè¿‡ç™»å½•æ‹¦æˆªå™¨ä¸­ ThreadLocal è¿›è¡Œäº†ç”¨æˆ·ä¿¡æ¯ä¼ é€’ LoginUserInfo loginUserInfo = LoginInterceptor.USER_THREAD_LOCAL.get(); UserDetailVO userDetailVO = getUserDetailFromCache(loginUserInfo.getId()); if (userDetailVO != null) return userDetailVO; // ä¸å­˜åœ¨æ‰å»æŸ¥åº“ User user = userMapper.selectOne(new LambdaQueryWrapperUser().eq(User::getId, loginUserInfo.getId())); userDetailVO = BeanUtil.copy(user, UserDetailVO.class); redisCache.set( UserCacheKeyConstant.USER_DETAIL_KEY_PREFIX + loginUserInfo.getId(), userDetailVO, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); log.info(ç”¨æˆ·æ¨¡å—-ç¼“å­˜ç”¨æˆ·ä¿¡æ¯ï¼š, JsonUtil.toJson(user)); return userDetailVO;private UserDetailVO getUserDetailFromCache(long userId) String key = UserCacheKeyConstant.USER_DETAIL_KEY_PREFIX + userId; String userDetail = redisCache.get(key); log.info(ç”¨æˆ·æ¨¡å—-ä»ç¼“å­˜ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼š, userDetail); if (StringUtils.isNotBlank(userDetail)) // ç¼“å­˜å»¶æœŸ redisCache.expire(key, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); return JsonUtil.fromJson(userDetail, UserDetailVO.class); return null; 7.13 ç”¨æˆ·ä¿¡æ¯å±•ç¤º ç‚¹å‡»è¿›å…¥ç”¨æˆ·ä¸»é¡µå¯ä»¥æ˜¾ç¤ºç”¨æˆ· ç”¨æˆ·åã€idã€æ€§åˆ« ç­‰ä¸»è¦ä¿¡æ¯ 7.13.1 V1 ç‰ˆæœ¬ cshop-usersrcmainJavagithublianyutiancshopusermodelvoUserShowVO.Java package github.lianyutian.cshop.user.model.vo;import lombok.Data;/** * ç”¨æˆ·å±•ç¤ºä¿¡æ¯ VO å±•ç¤ºç»™ä»–äººçœ‹çš„ä¿¡æ¯ * * @author lianyutian * @since 2024-12-27 17:11:22 * @version 1.0 */@Datapublic class UserShowVO /** ç”¨æˆ· id */ private Long id; /** ç”¨æˆ·å */ private String name; /** ç”¨æˆ·å¤´åƒ */ private String avatar; cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserController.Java /** * è·å–ç”¨æˆ·å±•ç¤ºä¿¡æ¯ * * @param userId ç”¨æˆ· ID * @return ç”¨æˆ·å±•ç¤ºä¿¡æ¯ */@GetMapping(detail/show/userId)public ApiResultUserShowVO getUserShow(@PathVariable(userId) Long userId) UserShowVO userShowVO = userService.getUserShow(userId); return ApiResult.success(userShowVO); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserService.Java /** * è·å–ç”¨æˆ·å±•ç¤ºè¯¦æƒ… * * @param userId ç”¨æˆ· id * @return ç”¨æˆ·å±•ç¤ºè¯¦æƒ… */UserShowDetailVO getUserShow(Long userId); cshop-usersrcmainJavagithublianyutiancshopuserserviceimplUserServiceImpl.Java public UserShowVO getUserShow_V1(Long userId) User user = userMapper.selectOne(new LambdaQueryWrapperUser().eq(User::getId, userId)); UserShowVO userShowVO = new UserShowVO(); return BeanUtil.copy(user, userShowVO); ä¼˜ç‚¹ æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯éƒ½ç›´æ¥æŸ¥æ•°æ®åº“ï¼Œæ²¡æœ‰æ•°æ®ä¸€è‡´æ€§é—®é¢˜ ç¼ºç‚¹ æ‰€æœ‰è¯·æ±‚éƒ½æŸ¥åº“ï¼Œæ€§èƒ½ä¸é«˜ å¦‚æœå¹¶å‘é‡å¤§å¯èƒ½ç›´æ¥æ‰“å´©æ•°æ®åº“ 7.12.2 V2 ç‰ˆæœ¬å› ä¸ºç”¨æˆ·ä¿¡æ¯å±•ç¤ºæ˜¯ä¸ªè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œç”¨æˆ·ä¿¡æ¯è‡ªèº«å¾ˆå°‘å˜æ›´ä½†æ˜¯ç”¨æˆ·å±•ç¤ºä¿¡æ¯ä¼šæœ‰è¾ƒå¤šçš„æŸ¥è¯¢å±•ç¤ºã€‚éå¸¸é€‚åˆç¼“å­˜ï¼Œæ‰€ä»¥è¿™é‡Œå¼•å…¥ Redis ç¼“å­˜ç”¨æˆ·çš„å±•ç¤ºä¿¡æ¯ã€‚ cshop-usersrcmainJavagithublianyutiancshopuserserviceimplUserServiceImpl.Java public UserShowVO getUserShow_V2(Long userId) UserShowVO userShowVO = getUserShowFromCache(userId); if (userShowVO != null) UserShowVO userShowVO = new UserShowVO(); return BeanUtil.copy(userShowVO, UserShowVO.class); User user = userMapper.selectOne(new LambdaQueryWrapperUser().eq(User::getId, userId)); UserShowVO userShowVO = new UserShowVO(); return BeanUtil.copy(userShowVO, UserShowVO.class);private UserShowVO getUserShowFromCache(long userId) String key = UserCacheKeyConstant.USER_SHOW_KEY_PREFIX + userId; String userShow = redisCache.get(key); log.info(ç”¨æˆ·æ¨¡å—-ä»ç¼“å­˜ä¸­è·å–ç”¨æˆ·å±•ç¤ºä¿¡æ¯ï¼š, userShow); if (StringUtils.isNotBlank(userShow)) // ç¼“å­˜å»¶æœŸ redisCache.expire(key, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); return JsonUtil.fromJson(userShow, UserShowVO.class); return null; ä¼˜ç‚¹ ç¼“å­˜å­˜åœ¨æ—¶æ‰€æœ‰æŸ¥è¯¢èµ°ç¼“å­˜ï¼Œæ€§èƒ½é«˜ ç¼ºç‚¹ ç¼“å­˜ä¸å­˜åœ¨æ—¶ï¼Œå¦‚æœæœ‰è¶…é«˜å¹¶å‘è¿›å…¥è¿˜æ˜¯ä¼šç›´æ¥æ‰“è¿›æ•°æ®åº“ å½“æŸ¥è¯¢ä¸å­˜åœ¨çš„ userId æ—¶ä¼šç›´æ¥ç©¿é€ç¼“å­˜æ‰“åˆ°æ•°æ®åº“ï¼ŒåŒæ—¶é«˜å¹¶å‘æŸ¥è¯¢ä¸å­˜åœ¨çš„ userId ä¹Ÿå¯èƒ½æ‰“å´©æ•°æ®åº“ 7.12.3 V3 ç‰ˆæœ¬public UserShowVO getUserShow_V3(Long userId) UserShowVO userShowVO = getUserShowFromCache(userId); if (userShowVO != null) return BeanUtil.copy(userShowVO, UserShowVO.class); boolean tryLocked = false; try // è§£å†³é«˜å¹¶å‘æŸ¥åº“çš„é—®é¢˜ tryLocked = redisLock.tryLock(cshop-user:user-show:lock: + userId, 200); if (!tryLocked) return null; User user = userMapper.selectOne(new LambdaQueryWrapperUser().eq(User::getId, userId)); if (user == null) // è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜ redisCache.set( UserCacheKeyConstant.USER_SHOW_KEY_PREFIX + userId, , RedisCache.generateCachePenetrationExpire(), TimeUnit.MILLISECONDS); return null; return BeanUtil.copy(user, UserShowVO.class); catch (InterruptedException e) log.info(ã€getUserShowã€‘è·å–é”å¤±è´¥, userId , userId); return null; finally if (tryLocked) redisLock.unlock(cshop-user:info:lock: + userId); ä¼˜ç‚¹ è§£å†³é«˜å¹¶å‘ä¸‹æŸ¥æ•°æ®åº“é—®é¢˜ è§£å†³é«˜å¹¶å‘ä¸‹æŸ¥ä¸å­˜åœ¨ userId é—®é¢˜ ç¼ºç‚¹ ç”¨æˆ·åŒæ—¶æ›´æ–°ä¿¡æ¯æ—¶å­˜åœ¨ç¼“å­˜å’Œæ•°æ®åº“ä¸ä¸€è‡´é—®é¢˜ 7.12.4 V4 ç‰ˆæœ¬** * ç”¨æˆ·å±•ç¤ºä¿¡æ¯ * * p1.å‡å¦‚ ç”¨æˆ·Z å‘å¸ƒäº†ä¸€ç¯‡å†…å®¹çªç„¶çˆ†ç«ï¼ŒåŒä¸€æ—¶åˆ»æœ‰ä¸Šä¸‡ç”¨æˆ·æ¥æŸ¥çœ‹ ç”¨æˆ·Z çš„ä¸ªäººä¿¡æ¯ï¼Œæ­¤æ—¶å°±ä¼šå­˜åœ¨åŒä¸€æ—¶åˆ»ä¼šæœ‰è¶…å¤§å¹¶å‘æµé‡è¿›å…¥è¯¥æ¥å£ * * p2.å¦‚æœæœ‰æ¶æ„ç”¨æˆ·å¤§æ‰¹é‡ä½¿ç”¨ä¸å­˜åœ¨çš„ ç”¨æˆ·id æ¥æŸ¥è¯¢ï¼Œå°±ä¼šé€ æˆç¼“å­˜ç©¿é€ï¼Œå¤§é‡è¯·æ±‚å‡»ç©¿çš„ DB å±‚ã€‚ * * p3.å¦‚æœ ç”¨æˆ·Z åœ¨è¿™ä¸ªæ—¶åˆ»ä¿®æ”¹äº†è‡ªå·±çš„ä¿¡æ¯ï¼Œæ€ä¹ˆä¿è¯å…¶ä»–ç”¨æˆ·æŸ¥è¯¢åˆ°çš„æ˜¯æœ€æ–°çš„ä¿¡æ¯ï¼Œæ€ä¹ˆä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§ * * påœºæ™¯ï¼šä¾‹å¦‚ çº¿ç¨‹A æ¥æŸ¥è¯¢ ç”¨æˆ·Z çš„ä¿¡æ¯ï¼ŒåŒæ—¶ çº¿ç¨‹B ä¿®æ”¹ ç”¨æˆ·Z ä¿¡æ¯ä¸”æ­¤æ—¶ç¼“å­˜ä¸­ ç”¨æˆ·Z ä¿¡æ¯åˆšå¥½è¿‡æœŸã€‚ * * pé‚£ä¹ˆæ­¤æ—¶ çº¿ç¨‹A ä¼šå»æŸ¥æ•°æ®åº“ï¼Œè¿™ä¸ªæ—¶å€™ çº¿ç¨‹B è¿˜æ²¡å°† ç”¨æˆ·Z ä¿®æ”¹åçš„ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚ * * pæ‰€ä»¥ çº¿ç¨‹A æ‹¿åˆ°çš„æ˜¯æ—§çš„æ•°æ®ï¼Œå†å‡è®¾æ­¤æ—¶ çº¿ç¨‹A æ²¡æŠ¢åˆ° CPU èµ„æºé˜»å¡ä½äº†ã€‚ * * pè¿™ä¸ªæ—¶å€™ çº¿ç¨‹B å·²ç»ä¿®æ”¹å®Œè‡ªèº«ä¿¡æ¯å¹¶ä¿å­˜å…¥æ•°æ®åº“ï¼ŒåŒæ—¶ä¼šå°†æ–°æ•°æ®åˆ·æ–°åˆ°ç¼“å­˜ä¸­ã€‚ * * på†æ‰§è¡Œå®Œæˆè¿™ä¸€æ­¥åï¼Œçº¿ç¨‹A æ‰ç»§ç»­æ‰§è¡Œï¼Œæ­¤æ—¶ çº¿ç¨‹A æ‹¿åˆ°çš„è¿˜æ˜¯æ—§çš„æ•°æ®ï¼Œä¹Ÿä¼šå»åˆ·æ–°ç¼“å­˜ã€‚ * * pé‚£ä¹ˆæ­¤æ—¶ç¼“å­˜ä¸­çš„æ•°æ®æ˜¯ çº¿ç¨‹A åœ¨ çº¿ç¨‹B æ›´æ–°å‰çš„æ—§æ•°æ®ï¼Œæ•°æ®åº“ä¸­æ˜¯ çº¿ç¨‹B æ›´æ–°çš„æ–°æ•°æ®ã€‚ * * pè§£å†³æ–¹æ¡ˆï¼šæ›´æ–°ç”¨æˆ·æ¥å£ä¹ŸåŠ  åŒ ä¸€æŠŠåˆ†å¸ƒå¼é”ï¼Œä¿è¯è¯»å†™ä¸²è¡Œã€‚ç”¨æˆ·æ›´æ–°è‡ªèº«ä¿¡æ¯æ˜¯å æ¯”å¾ˆå°‘çš„å†™æ“ä½œï¼Œè¿™é‡Œè€ƒè™‘çš„æ˜¯æç«¯åœºæ™¯ * * @param userId ç”¨æˆ·id * @return ç”¨æˆ·å±•ç¤ºä¿¡æ¯ */@Overridepublic UserShowVO getUserShow(Long userId) UserShowVO userShowVO = getUserShowFromCache(userId); if (userShowVO != null) return userShowVO; // 2ã€ç¼“å­˜ä¸ºç©ºå†ä»æ•°æ®åº“ä¸­è·å– return getUserShowFromDB(userId);private UserDetailVO getUserDetailFromCache(long userId) String key = UserCacheKeyConstant.USER_DETAIL_KEY_PREFIX + userId; String userDetail = redisCache.get(key); log.info(ç”¨æˆ·æ¨¡å—-ä»ç¼“å­˜ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼š, userDetail); if (StringUtils.isNotBlank(userDetail)) // ç¼“å­˜å»¶æœŸ redisCache.expire(key, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); return JsonUtil.fromJson(userDetail, UserDetailVO.class); return null;private UserShowVO getUserShowFromCache(long userId) String key = UserCacheKeyConstant.USER_SHOW_KEY_PREFIX + userId; String userShow = redisCache.get(key); log.info(ç”¨æˆ·æ¨¡å—-ä»ç¼“å­˜ä¸­è·å–ç”¨æˆ·å±•ç¤ºä¿¡æ¯ï¼š, userShow); if (StringUtils.isNotBlank(userShow)) // ç¼“å­˜å»¶æœŸ redisCache.expire(key, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); return JsonUtil.fromJson(userShow, UserShowVO.class); return null;private UserShowVO getUserShowFromDB(Long userId) String userUpdateLockKey = UserCacheKeyConstant.USER_UPDATE_LOCK_KEY_PREFIX + userId; // è®¾ç½®åˆ†å¸ƒå¼é” boolean tryLocked = false; try // TODO è§£é‡Š tryLocked = redisLock.tryLock(userUpdateLockKey, RedisCache.UPDATE_LOCK_TIMEOUT); if (!tryLocked) // åŠ é”è¶…æ—¶ /* å°è¯•åŠ é”æ—¶é—´æœ‰ RedisCache.UPDATE_LOCK_TIMEOUT æœ‰å¯èƒ½å…¶ä»–çº¿ç¨‹å·²ç»è·å–æ•°æ®å¹¶å†™å…¥ç¼“å­˜äº†æ‰€ä»¥è¿™é‡Œå†å°è¯•å»è¯»ä¸‹ç¼“å­˜ */ UserShowVO userShowFromCache = getUserShowFromCache(userId); if (userShowFromCache != null) return userShowFromCache; log.warn(ã€getUserShowFromDBã€‘ç”¨æˆ·ç¼“å­˜ä¸ºç©ºï¼ŒæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯è·å–é”å¤±è´¥ , userId); return null; User user = userMapper.selectById(userId); if (user == null) // å¦‚æœä¸ºç©ºå…ˆåœ¨ç¼“å­˜ä¸­è®¾ç½®ä¸€ä¸ªç©ºå€¼ï¼Œé˜²æ­¢ç¼“å­˜ç©¿é€ï¼ˆè§£å†³ 2ï¼‰ redisCache.set( UserCacheKeyConstant.USER_SHOW_KEY_PREFIX + userId, RedisCache.EMPTY_CACHE, RedisCache.generateCachePenetrationExpire(), TimeUnit.MILLISECONDS); return null; UserShowVO userShowVO = BeanUtil.copy(user, UserShowVO.class); log.info(ã€getUserShowFromDBã€‘ç”¨æˆ·ç¼“å­˜ä¸ºç©ºï¼Œä»æ•°æ®åº“è·å–ç”¨æˆ·ä¿¡æ¯ , JsonUtil.toJson(userShowVO)); redisCache.set( UserCacheKeyConstant.USER_SHOW_KEY_PREFIX + userId, userShowVO, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); return userShowVO; catch (InterruptedException e) // åŠ é”å¤±è´¥ // è¿™é‡Œå†å»å°è¯•è·å–ä¸‹ç¼“å­˜-åŒé‡æ£€æŸ¥ UserShowVO userShowFromCache = getUserShowFromCache(userId); if (userShowFromCache != null) return userShowFromCache; log.error(ã€getUserShowFromDBã€‘å°è¯•åŠ é”å¼‚å¸¸ï¼Œå¼‚å¸¸ä¿¡æ¯ï¼š, e.getMessage(), e); throw new BizException(BizCodeEnum.USER_INFO_SHOW_LOCK_FAIL); finally if (tryLocked) redisLock.unlock(userUpdateLockKey); 7.13 ç”¨æˆ·ä¿¡æ¯æ›´æ–° cshop-usersrcmainJavagithublianyutiancshopusermodelparamUserEditParam.Java package github.lianyutian.cshop.user.model.param;import lombok.Data;/** * ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹å…¥å‚ * * @author lianyutian * @since 2024-12-27 13:23:04 * @version 1.0 */@Datapublic class UserEditParam /** ç”¨æˆ· id */ private Long id; /** æ‰‹æœºå· */ private String phone; /** ç”¨æˆ·å */ private String name; /** å¤´åƒ */ private String avatar; /** æ€§åˆ« */ private int sex; cshop-usersrcmainJavagithublianyutiancshopusercontrollerUserController.Java /** * ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹ * * @param userEditParam ç”¨æˆ·ä¿¡æ¯ * @return ä¿®æ”¹ç»“æœ */@PostMapping(edit)public ApiResultVoid edit(@RequestBody UserEditParam userEditParam) userService.updateUser(userEditParam); return ApiResult.success(); cshop-usersrcmainJavagithublianyutiancshopuserserviceUserService.Java /** * æ›´æ–°ç”¨æˆ·ä¿¡æ¯ * * @param userEditParam ç”¨æˆ·ç¼–è¾‘å‚æ•° */void updateUserInfo(UserEditParam userEditParam); cshop-usersrcmainJavagithublianyutiancshopuserserviceimplUserServiceImpl.Java @Override@Transactional(rollbackFor = Exception.class)public void updateUser(UserEditParam userEditParam) LoginUserInfo loginUserInfo = LoginInterceptor.USER_THREAD_LOCAL.get(); userEditParam.setId(loginUserInfo.getId()); boolean locked = false; try // è¿™é‡ŒåŠ åˆ†å¸ƒå¼é”æ˜¯ä¸ºäº†ä¿è¯é«˜å¹¶å‘ä¸‹æœ‰å…¶ä»–ç”¨æˆ·æŸ¥è¯¢è¯¥ç”¨æˆ·ä¿¡æ¯æ—¶ä¿è¯æ•°æ®åº“å’Œç¼“å­˜çš„ä¸€è‡´æ€§ locked = redisLock.lock(UserCacheKeyConstant.USER_UPDATE_LOCK_KEY_PREFIX + loginUserInfo.getId()); if (!locked) log.error(ç”¨æˆ·æ¨¡å—-ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼šç”¨æˆ· è·å–é”å¤±è´¥, loginUserInfo.getId()); throw new BizException(BizCodeEnum.USER_DETAIL_UPDATE_FAIL); // å…ˆåˆ æ‰ç¼“å­˜ï¼Œé˜²æ­¢å‡ºç°æ•°æ®åº“æ›´æ–°æˆåŠŸä½†æ˜¯æ›´æ–°ç¼“å­˜å¤±è´¥ï¼Œè·å–ç”¨æˆ·ä¿¡æ¯æ—¶ä¸€ç›´éƒ½æ˜¯ç¼“å­˜çš„æ•°æ® redisCache.delete(UserCacheKeyConstant.USER_SHOW_KEY_PREFIX + loginUserInfo.getId()); redisCache.delete(UserCacheKeyConstant.USER_DETAIL_KEY_PREFIX + loginUserInfo.getId()); User user = BeanUtil.copy(userEditParam, User.class); int rows = userMapper.update( user, new LambdaUpdateWrapperUser().eq(User::getId, loginUserInfo.getId())); log.info(ç”¨æˆ·æ¨¡å—-ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼šrows=ï¼Œdata=, rows, userEditParam); User newUser = userMapper.selectOne( new LambdaQueryWrapperUser().eq(User::getId, loginUserInfo.getId())); UserShowVO userShowVO = BeanUtil.copy(newUser, UserShowVO.class); // è¿™é‡Œå­˜åœ¨æ•°æ®åº“æ›´æ–°åï¼Œç¼“å­˜æ›´æ–°å¤±è´¥çš„åœºæ™¯ï¼ˆè¿™é‡Œä¸å»å¼ºåˆ¶ä¿è¯æ•°æ®åº“æ›´æ–°å®Œæˆåä¸€å®šæ›´æ–°æˆåŠŸç¼“å­˜ï¼‰ redisCache.set( UserCacheKeyConstant.USER_SHOW_KEY_PREFIX + loginUserInfo.getId(), userShowVO, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); UserDetailVO userDetailVO = BeanUtil.copy(newUser, UserDetailVO.class); redisCache.set( UserCacheKeyConstant.USER_DETAIL_KEY_PREFIX + loginUserInfo.getId(), userDetailVO, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); finally if (locked) redisLock.unlock(UserCacheKeyConstant.USER_UPDATE_LOCK_KEY_PREFIX + loginUserInfo.getId()); 7.14 ç¬”è®°æœåŠ¡https://nginx.org/en/download.html 7.14.1 æ–°å»ºç¬”è®°æœåŠ¡ cshop-commonpom.xml !-- mybatis-plus åˆ†é¡µæ’ä»¶ --dependency groupIdcom.baomidou/groupId artifactIdmybatis-plus-jsqlparser/artifactId/dependency cshop-notepom.xml ?xml version=1.0 encoding=UTF-8?project xmlns=http://maven.apache.org/POM/4.0.0 xmlns:xsi=http://www.w3.org/2001/XMLSchema-instance xsi:schemaLocation=http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd modelVersion4.0.0/modelVersion parent groupIdgithub.lianyutian.cshop/groupId artifactIdcircle-shop/artifactId version1.0-SNAPSHOT/version /parent groupIdgithub.lianyutian.cshop.note/groupId artifactIdcshop-note/artifactId descriptionç¬”è®°æœåŠ¡/description properties maven.compiler.source17/maven.compiler.source maven.compiler.target17/maven.compiler.target project.build.sourceEncodingUTF-8/project.build.sourceEncoding /properties dependencies dependency groupIdgithub.lianyutian.cshop.common/groupId artifactIdcshop-common/artifactId version1.0-SNAPSHOT/version /dependency dependency groupIdorg.springframework.boot/groupId artifactIdspring-boot-starter-web/artifactId /dependency dependency groupIdmysql/groupId artifactIdmysql-connector-java/artifactId /dependency dependency groupIdcom.baomidou/groupId artifactIdmybatis-plus-spring-boot3-starter/artifactId /dependency dependency groupIdorg.apache.rocketmq/groupId artifactIdrocketmq-client/artifactId /dependency /dependencies/project cshop-notesrcmainresourcesapplication.yml # æœåŠ¡ç«¯å£server: port: 9003spring: application: name: cshop-note # mysqlé…ç½® datasource: username: root password: MIIEowIBAAKCAQEAwG90ULRHmAXFXQzZSwleoYts2+bCzUvqhhqtGiv/F5kUsETY url: jdbc:mysql://116.198.217.158:3306/cshop-user?useUnicode=truecharacterEncoding=utf-8useSSL=falseserverTimezone=Asia/Shanghai driver-class-name: com.mysql.cj.jdbc.Driver # redisé…ç½® data: redis: host: 116.198.217.158 port: 6379 password: MIIEowIBAAKCAQEAwG90ULRHmAXFXQzZSwleoYts2+bCzUvqhhqtGiv/F5kUsETY # å¦‚æœæœ‰å¯†ç  database: 0 # é»˜è®¤æ•°æ®åº“ timeout: 60000 # è¯»å– redis è¶…æ—¶æ—¶é—´ lettuce: pool: max-active: 100 # æœ€å¤§è¿æ¥æ•° max-idle: 100 # æœ€å¤§ç©ºé—²è¿æ¥æ•° min-idle: 100 # æœ€å°ç©ºé—²è¿æ¥æ•° max-wait: 60000 # æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’# è®¾ç½®æ—¥å¿—çº§åˆ«ï¼šERROR/WARN/INFO/DEBUG,é»˜è®¤æ˜¯ INFO ä»¥ä¸Šæ‰æ˜¾ç¤ºlogging: level: root: INFO# é…ç½® mybatis plus æ‰“å° sql æ—¥å¿—mybatis-plus: configuration: log-impl: org.apache.ibatis.logging.stdout.StdOutImpl# rocketmqé…ç½®rocketmq: accessKey: mqadmin secretKey: MIIEowIBAAKCAQEAwG90ULRHmAXFXQzZSwleoYts2+bCzUvqhhqtGiv/F5kUsETY nameServer: 116.198.217.158:9876 cshop-notesrcmainJavagithublianyutiancshopnoteNoteApplication.Java package github.lianyutian.cshop.note;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.context.annotation.ComponentScan;/** * ç¬”è®°æœåŠ¡å¯åŠ¨ç±» * * @author lianyutian * @since 2025-01-02 14:55:33 * @version 1.0 */@SpringBootApplication@ComponentScan(basePackages = github.lianyutian.cshop.note, github.lianyutian.cshop.common)public class NoteApplication public static void main(String[] args) SpringApplication.run(NoteApplication.class, args); 7.14.2 æ–°å¢ç¬”è®° cshop-notesrcmainJavagithublianyutiancshopnotemodelparamNoteAddParam.Java package github.lianyutian.cshop.note.model.param;import com.fasterxml.jackson.annotation.JsonFormat;import java.util.Date;import lombok.Data;/** * æ·»åŠ ç¬”è®°å…¥å‚ * * @author lianyutian * @since 2025-01-02 17:16:18 * @version 1.0 */@Datapublic class NoteAddParam /** ç¬”è®°å›¾ç‰‡é“¾æ¥ */ private String imgUrls; /** ç¬”è®°æ ‡é¢˜ */ private String title; /** æ­£æ–‡å†…å®¹ */ private String content; /** ç¬”è®°è§†é¢‘é“¾æ¥ */ private String videoUrl; /** è‡ªä¸»å£°æ˜ */ private String declaration; /** 1 å…¬å¼€å¯è§ï¼Œ2 ä»…è‡ªå·±å¯è§ï¼Œ3 ä»…äº’å…³å¥½å‹å¯è§ï¼Œ4 éƒ¨åˆ†äººå¯è§ 5 éƒ¨åˆ†äººä¸å¯è§ */ private Integer visibleRange; /** å‘å¸ƒæ—¶é—´ */ @JsonFormat(pattern = yyyy-MM-dd HH:mm:ss, timezone = GMT+8) private Date publishTime; cshop-notesrcmainJavagithublianyutiancshopnotecontrollerNoteController.Java package github.lianyutian.cshop.note.controller;import github.lianyutian.cshop.common.enums.BizCodeEnum;import github.lianyutian.cshop.common.model.ApiResult;import github.lianyutian.cshop.note.model.param.NoteAddParam;import github.lianyutian.cshop.note.model.param.NoteEditParam;import github.lianyutian.cshop.note.model.vo.NoteDetailVO;import github.lianyutian.cshop.note.service.NoteService;import lombok.AllArgsConstructor;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.PathVariable;import org.springframework.web.bind.annotation.PostMapping;import org.springframework.web.bind.annotation.RequestBody;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;/** * NoteController * * @author lianyutian * @since 2025-01-02 17:14:17 * @version 1.0 */@RestController@RequestMapping(/api/note/v1)@AllArgsConstructorpublic class NoteController private final NoteService noteService; /** * æ·»åŠ ç¬”è®° * * @param noteAddParam ç¬”è®°å…¥å‚ * @return æ·»åŠ ç»“æœ */ @PostMapping(add) public ApiResultVoid addNote(@RequestBody NoteAddParam noteAddParam) int added = noteService.addNote(noteAddParam); return added 0 ? ApiResult.success() : ApiResult.result(BizCodeEnum.NOTE_ADD_FAIL); cshop-notesrcmainJavagithublianyutiancshopnoteserviceNoteService.Java package github.lianyutian.cshop.note.service;import github.lianyutian.cshop.note.model.param.NoteAddParam;import github.lianyutian.cshop.note.model.param.NoteEditParam;import github.lianyutian.cshop.note.model.vo.NoteDetailVO;/** * ç¬”è®°æœåŠ¡ * * @author lianyutian * @since 2025-01-03 10:53:40 * @version 1.0 */public interface NoteService /** * æ·»åŠ ç¬”è®° * * @param noteAddParam ç¬”è®°å…¥å‚ */ int addNote(NoteAddParam noteAddParam); cshop-notesrcmainJavagithublianyutiancshopnoteserviceimplNoteServiceImpl.Java package github.lianyutian.cshop.note.service.impl;import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;import com.baomidou.mybatisplus.core.conditions.update.LambdaUpdateWrapper;import github.lianyutian.cshop.common.enums.BizCodeEnum;import github.lianyutian.cshop.common.exception.BizException;import github.lianyutian.cshop.common.interceptor.LoginInterceptor;import github.lianyutian.cshop.common.model.LoginUserInfo;import github.lianyutian.cshop.common.redis.RedisCache;import github.lianyutian.cshop.common.redis.RedisLock;import github.lianyutian.cshop.common.utils.BeanUtil;import github.lianyutian.cshop.common.utils.JsonUtil;import github.lianyutian.cshop.note.constant.NoteCacheKeyConstant;import github.lianyutian.cshop.note.constant.NoteRocketMQConstant;import github.lianyutian.cshop.note.enums.NoteMessageType;import github.lianyutian.cshop.note.enums.NoteStatusEnum;import github.lianyutian.cshop.note.mapper.NoteMapper;import github.lianyutian.cshop.note.model.param.NoteAddParam;import github.lianyutian.cshop.note.model.param.NoteEditParam;import github.lianyutian.cshop.note.model.po.Note;import github.lianyutian.cshop.note.model.vo.NoteDetailVO;import github.lianyutian.cshop.note.model.vo.NoteShowVO;import github.lianyutian.cshop.note.mq.message.NoteAddMessage;import github.lianyutian.cshop.note.mq.message.NoteUpdateMessage;import github.lianyutian.cshop.note.mq.producer.NoteTransactionProducer;import github.lianyutian.cshop.note.service.NoteService;import java.util.Date;import java.util.concurrent.TimeUnit;import lombok.AllArgsConstructor;import lombok.extern.slf4j.Slf4j;import org.apache.commons.lang3.StringUtils;import org.springframework.stereotype.Service;import org.springframework.transaction.annotation.Transactional;/** * ç¬”è®°æœåŠ¡å®ç°ç±» * * @author lianyutian * @since 2025-01-03 10:54:31 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class NoteServiceImpl implements NoteService private final NoteMapper noteMapper; @Override @Transactional(rollbackFor = Exception.class) public int addNote(NoteAddParam noteAddParam) LoginUserInfo loginUserInfo = LoginInterceptor.USER_THREAD_LOCAL.get(); Note note = BeanUtil.copy(noteAddParam, Note.class); note.setUserId(loginUserInfo.getId()); note.setStatus(NoteStatusEnum.AUDITING); note.setPublishTime(new Date()); int row; try row = noteMapper.insert(note); catch (Exception e) log.error(db addNote error , e.getMessage(), e); throw new BizException(BizCodeEnum.NOTE_ADD_FAIL); log.info(ç¬”è®°æœåŠ¡-æ–°å¢ç¬”è®°ï¼šrows=ï¼Œdata=, row, JsonUtil.toJson(noteAddParam)); return row; 7.14.3 ä¿®æ”¹ç¬”è®° cshop-notesrcmainJavagithublianyutiancshopnotemodelparamNoteEditParam.Java package github.lianyutian.cshop.note.model.param;import com.fasterxml.jackson.annotation.JsonFormat;import java.util.Date;import lombok.Data;/** * ç¬”è®°ä¿®æ”¹å…¥å‚ * * @author lianyutian * @since 2025-01-03 11:07:53 * @version 1.0 */@Datapublic class NoteEditParam /** ç¬”è®° id */ private Long id; /** ç¬”è®°å›¾ç‰‡é“¾æ¥ */ private String imgUrls; /** ç¬”è®°æ ‡é¢˜ */ private String title; /** æ­£æ–‡å†…å®¹ */ private String content; /** ç¬”è®°è§†é¢‘é“¾æ¥ */ private String videoUrl; /** è‡ªä¸»å£°æ˜ */ private String declaration; /** 1 å…¬å¼€å¯è§ï¼Œ2 ä»…è‡ªå·±å¯è§ï¼Œ3 ä»…äº’å…³å¥½å‹å¯è§ï¼Œ4 éƒ¨åˆ†äººå¯è§ 5 éƒ¨åˆ†äººä¸å¯è§ */ private Integer visibleRange; /** å‘å¸ƒæ—¶é—´ */ @JsonFormat(pattern = yyyy-MM-dd HH:mm:ss, timezone = GMT+8) private Date publishTime; package github.lianyutian.cshop.note.controller;/** * NoteController * * @author lianyutian * @since 2025-01-02 17:14:17 * @version 1.0 */@RestController@RequestMapping(/api/note/v1)@AllArgsConstructorpublic class NoteController private final NoteService noteService; /** * æ›´æ–°æˆ‘çš„ç¬”è®° * * @param noteAddParam æ›´æ–°ç¬”è®°å…¥å‚ * @return æ›´æ–°ç»“æœ */ @PostMapping(edit) public ApiResultVoid updateNote(@RequestBody NoteEditParam noteAddParam) int updated = noteService.updateNote(noteAddParam); return updated 0 ? ApiResult.success() : ApiResult.result(BizCodeEnum.NOTE_UPDATE_FAIL); package github.lianyutian.cshop.note.service;/** * ç¬”è®°æœåŠ¡ * * @author lianyutian * @since 2025-01-03 10:53:40 * @version 1.0 */public interface NoteService /** * æ›´æ–°ç¬”è®° * * @param noteAddParam ç¬”è®°æ›´æ–°å…¥å‚ */ int updateNote(NoteEditParam noteAddParam); package github.lianyutian.cshop.note.service.impl;/** * ç¬”è®°æœåŠ¡å®ç°ç±» * * @author lianyutian * @since 2025-01-03 10:54:31 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class NoteServiceImpl implements NoteService private final NoteMapper noteMapper; @Override @Transactional(rollbackFor = Exception.class) public int updateNote(NoteEditParam noteEditParam) // 1.æŸ¥è¯¢ç¬”è®°æ˜¯å¦å­˜åœ¨ LoginUserInfo loginUserInfo = LoginInterceptor.USER_THREAD_LOCAL.get(); Note updateNote = BeanUtil.copy(noteEditParam, Note.class); int row = 0; try row = noteMapper.update( updateNote, new LambdaUpdateWrapperNote() .eq(Note::getId, noteEditParam.getId()) .eq(Note::getUserId, loginUserInfo.getId())); log.info(ç¬”è®°æœåŠ¡-æ›´æ–°ç¬”è®°ï¼šrow=, data=, row, JsonUtil.toJson(noteEditParam)); return row; catch (Exception e) log.error(updateNote error , e.getMessage(), e); throw new BizException(BizCodeEnum.NOTE_UPDATE_FAIL); 7.14.4 åˆ é™¤ç¬”è®°package github.lianyutian.cshop.note.controller;/** * NoteController * * @author lianyutian * @since 2025-01-02 17:14:17 * @version 1.0 */@RestController@RequestMapping(/api/note/v1)@AllArgsConstructorpublic class NoteController private final NoteService noteService; /** * åˆ é™¤æˆ‘çš„ç¬”è®° * * @param noteId noteId * @return åˆ é™¤ç»“æœ */ @GetMapping(delete/noteId) public ApiResultVoid delete(@PathVariable(noteId) long noteId) int deleted = noteService.deleteNote(noteId); return deleted 0 ? ApiResult.success() : ApiResult.result(BizCodeEnum.NOTE_DEL_FAIL); package github.lianyutian.cshop.note.service;/** * ç¬”è®°æœåŠ¡ * * @author lianyutian * @since 2025-01-03 10:53:40 * @version 1.0 */public interface NoteService /** * åˆ é™¤ç¬”è®° * * @param id ç¬”è®° id */ int deleteNote(long id); package github.lianyutian.cshop.note.service.impl;/** * ç¬”è®°æœåŠ¡å®ç°ç±» * * @author lianyutian * @since 2025-01-03 10:54:31 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class NoteServiceImpl implements NoteService private final NoteMapper noteMapper; @Override @Transactional(rollbackFor = Exception.class) public int deleteNote(long id) return noteMapper.deleteById(id); 7.14.5 è·å–æˆ‘çš„ç¬”è®°è¯¦æƒ… cshop-notesrcmainJavagithublianyutiancshopnotemodelvoNoteDetailVO.Java package github.lianyutian.cshop.note.model.vo;import java.util.Date;import lombok.Data;/** * ç¬”è®° VO * * @author lianyutian * @since 2025-01-03 11:06:30 * @version 1.0 */@Datapublic class NoteDetailVO /** ç¬”è®° id */ private long id; /** ç¬”è®°å›¾ç‰‡é“¾æ¥ */ private String imgUrls; /** ç¬”è®°æ ‡é¢˜ */ private String title; /** æ­£æ–‡å†…å®¹ */ private String content; /** ç¬”è®°è§†é¢‘é“¾æ¥ */ private String videoUrl; /** è‡ªä¸»å£°æ˜ */ private String declaration; /** 1 å…¬å¼€å¯è§ï¼Œ2 ä»…è‡ªå·±å¯è§ï¼Œ3 ä»…äº’å…³å¥½å‹å¯è§ï¼Œ4 éƒ¨åˆ†äººå¯è§ 5 éƒ¨åˆ†äººä¸å¯è§ */ private Integer visibleRange; /** å‘å¸ƒæ—¶é—´ */ private Date publishTime; package github.lianyutian.cshop.note.controller;import github.lianyutian.cshop.common.enums.BizCodeEnum;import github.lianyutian.cshop.common.model.ApiResult;import github.lianyutian.cshop.note.model.param.NoteAddParam;import github.lianyutian.cshop.note.model.param.NoteEditParam;import github.lianyutian.cshop.note.model.vo.NoteDetailVO;import github.lianyutian.cshop.note.service.NoteService;import lombok.AllArgsConstructor;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.PathVariable;import org.springframework.web.bind.annotation.PostMapping;import org.springframework.web.bind.annotation.RequestBody;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;/** * NoteController * * @author lianyutian * @since 2025-01-02 17:14:17 * @version 1.0 */@RestController@RequestMapping(/api/note/v1)@AllArgsConstructorpublic class NoteController private final NoteService noteService; /** * è·å–æˆ‘çš„ç¬”è®°è¯¦æƒ… * * @param noteId noteId * @return ç¬”è®°è¯¦æƒ…ä¿¡æ¯ */ @GetMapping(/detail/noteId) public ApiResultNoteDetailVO detail(@PathVariable(noteId) Long noteId) return ApiResult.success(noteService.getNoteDetail(noteId)); package github.lianyutian.cshop.note.service;/** * ç¬”è®°æœåŠ¡ * * @author lianyutian * @since 2025-01-03 10:53:40 * @version 1.0 */public interface NoteService /** * è·å–ç¬”è®°è¯¦æƒ… * * @param noteId ç¬”è®° id */ NoteDetailVO getNoteDetail(Long noteId); package github.lianyutian.cshop.note.service.impl;/** * ç¬”è®°æœåŠ¡å®ç°ç±» * * @author lianyutian * @since 2025-01-03 10:54:31 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class NoteServiceImpl implements NoteService private final NoteMapper noteMapper; @Override public NoteDetailVO getNoteDetail(Long noteId) LoginUserInfo loginUserInfo = LoginInterceptor.USER_THREAD_LOCAL.get(); Note note = noteMapper.selectOne( new LambdaQueryWrapperNote() .eq(Note::getId, noteId) .eq(Note::getUserId, loginUserInfo.getId())); if (note == null) return null; return BeanUtil.copy(note, NoteDetailVO.class); 7.14.6 æŸ¥çœ‹ä»–äººç¬”è®°è¯¦æƒ… cshop-notesrcmainJavagithublianyutiancshopnotemodelvoNoteShowVO.Java package github.lianyutian.cshop.note.model.vo;import java.util.Date;import lombok.Data;/** * ç¬”è®°å±•ç¤º VO * * @author lianyutian * @since 2025-01-03 11:06:30 * @version 1.0 */@Datapublic class NoteShowVO /** ç¬”è®° id */ private long id; /** ç¬”è®°å›¾ç‰‡é“¾æ¥ */ private String imgUrls; /** ç¬”è®°æ ‡é¢˜ */ private String title; /** æ­£æ–‡å†…å®¹ */ private String content; /** ç¬”è®°è§†é¢‘é“¾æ¥ */ private String videoUrl; /** è‡ªä¸»å£°æ˜ */ private String declaration; /** å‘å¸ƒæ—¶é—´ */ private Date publishTime; cshop-notesrcmainJavagithublianyutiancshopnotecontrollerNoteShowController.Java package github.lianyutian.cshop.note.controller;/** * ç”¨æˆ·ç¬”è®°å±•ç¤º * * @author lianyutian * @since 2025-01-09 10:12:54 * @version 1.0 */@RestController@RequestMapping(/api/note/v1)@AllArgsConstructorpublic class NoteShowController private final NoteShowService noteShowService; /** * è·å–ç¬”è®°è¯¦æƒ… * * @param noteId ç¬”è®° ID * @return ç¬”è®°è¯¦æƒ… */ @PostMapping(detail/show) public ApiResultNoteShowVO getNoteShow(@RequestBody Long noteId) if (noteId == null) return ApiResult.result(BizCodeEnum.COMMON_PARAM_ERROR); NoteShowVO noteShowVO = noteShowService.getNoteShow(noteId); return noteShowVO == null ? ApiResult.result(BizCodeEnum.NOTE_NOT_EXITS) : ApiResult.success(noteShowVO); cshop-notesrcmainJavagithublianyutiancshopnoteserviceNoteShowService.Java package github.lianyutian.cshop.note.service;/** * ç”¨æˆ·ç¬”è®°å±•ç¤º * * @author lianyutian * @since 2025-01-09 10:15:18 * @version 1.0 */public interface NoteShowService /** * è·å–ç¬”è®°å±•ç¤ºè¯¦æƒ… * * @param noteId ç¬”è®° ID * @return ç¬”è®°è¯¦æƒ… */ NoteShowVO getNoteShow(Long noteId); cshop-notesrcmainJavagithublianyutiancshopnoteserviceimplNoteShowServiceImpl.Java package github.lianyutian.cshop.note.service.impl;/** * ç”¨æˆ·ç¬”è®°å±•ç¤ºå®ç° * * @author lianyutian * @since 2025-01-09 10:18:39 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class NoteShowServiceImpl implements NoteShowService private final NoteMapper noteMapper; @Override public NoteShowVO getNoteShow(Long noteId) Note note = noteMapper.selectOne( new LambdaQueryWrapperNote() .eq(Note::getId, noteId) .eq(Note::getStatus, NoteStatusEnum.PUBLISHED.getCode())); if (note == null) log.info(ã€getNoteShowã€‘ç¬”è®°ä¸å­˜åœ¨ , noteId); return null; return BeanUtil.copy(note, NoteShowVO.class); 7.14.7 æŸ¥çœ‹ç¬”è®°åˆ†é¡µåˆ—è¡¨ cshop-notesrcmainJavagithublianyutiancshopnoteconfigMybatisPlusConfig.Java package github.lianyutian.cshop.note.config;import com.baomidou.mybatisplus.annotation.DbType;import com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;import com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;/** * MybatisPlus æ’ä»¶é…ç½® * * @author lianyutian * @since 2025-01-03 13:46:12 * @version 1.0 */@Configurationpublic class MybatisPlusConfig /** æ·»åŠ åˆ†é¡µæ’ä»¶ */ @Bean public MybatisPlusInterceptor mybatisPlusInterceptor() MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor(); interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL)); return interceptor; cshop-commonsrcmainJavagithublianyutiancshopcommonmodelvoPageVO.Java package github.lianyutian.cshop.common.model.vo;import com.baomidou.mybatisplus.extension.plugins.pagination.Page;import com.fasterxml.jackson.annotation.JsonIgnore;import java.util.Collections;import java.util.List;import java.util.Objects;import lombok.AllArgsConstructor;import lombok.Data;/** * åˆ†é¡µè¿”å›ç»“æœ * * @author lianyutian * @since 2025-01-03 14:19:25 * @version 1.0 */@Data@AllArgsConstructorpublic class PageVOT /** æ€»æ¡æ•° */ protected Long total; /** æ€»é¡µç æ•° */ protected Long pages; /** å½“å‰é¡µæ•°æ® */ protected ListT list; public static T PageVOT empty(Page? page) return new PageVO( Objects.requireNonNull(page, Page cannot be null).getTotal(), page.getPages(), Collections.emptyList()); public static T PageVOT of(Page? page, ListT list) if (page == null) throw new IllegalArgumentException(Page cannot be null); if (list == null) throw new IllegalArgumentException(List cannot be null); return new PageVO(page.getTotal(), page.getPages(), Collections.unmodifiableList(list)); @JsonIgnore public boolean isEmpty() return list.isEmpty(); cshop-commonsrcmainJavagithublianyutiancshopcommonmodelparamPageParam.Java package github.lianyutian.cshop.common.model.param;import com.baomidou.mybatisplus.core.metadata.OrderItem;import com.baomidou.mybatisplus.extension.plugins.pagination.Page;import jakarta.validation.constraints.Min;import lombok.Data;import org.apache.commons.lang3.StringUtils;/** * åˆ†é¡µæŸ¥è¯¢å…¥å‚ * * @author lianyutian * @since 2025-01-03 14:53:29 * @version 1.0 */@Datapublic class PageParam public static final Integer DEFAULT_PAGE_SIZE = 20; public static final Integer DEFAULT_PAGE_NUM = 1; /** é¡µç  */ @Min(value = 1, message = é¡µç ä¸èƒ½å°äº1) private final Integer pageNo = DEFAULT_PAGE_NUM; /** æ¯é¡µå¤§å° */ @Min(value = 1, message = æ¯é¡µæŸ¥è¯¢æ•°é‡ä¸èƒ½å°äº1) private final Integer pageSize = DEFAULT_PAGE_SIZE; /** æ˜¯å¦å‡åº */ private Boolean isAsc = true; /** æ’åºå­—æ®µ */ private String sortBy; public int from() return (pageNo - 1) * pageSize; public T PageT toMpPage(OrderItem... orderItems) PageT page = new Page(pageNo, pageSize); // æ˜¯å¦æ‰‹åŠ¨æŒ‡å®šæ’åºæ–¹å¼ if (orderItems != null orderItems.length 0) for (OrderItem orderItem : orderItems) page.addOrder(orderItem); return page; // å‰ç«¯æ˜¯å¦æœ‰æ’åºå­—æ®µ if (StringUtils.isNotEmpty(sortBy)) OrderItem orderItem = new OrderItem(); orderItem.setAsc(isAsc); orderItem.setColumn(sortBy); page.addOrder(orderItem); return page; public T PageT toMpPage(String defaultSortBy, boolean isAsc) if (StringUtils.isBlank(sortBy)) sortBy = defaultSortBy; this.isAsc = isAsc; PageT page = new Page(pageNo, pageSize); OrderItem orderItem = new OrderItem(); orderItem.setAsc(this.isAsc); orderItem.setColumn(sortBy); page.addOrder(orderItem); return page; public T PageT toMpPageDefaultSortByCreateTimeDesc() return toMpPage(create_time, false); cshop-notesrcmainJavagithublianyutiancshopnotemodelparamNotePageParam.Java package github.lianyutian.cshop.note.model.param;import github.lianyutian.cshop.common.model.param.PageParam;import lombok.Data;import lombok.EqualsAndHashCode;/** * åˆ†é¡µæŸ¥è¯¢ç¬”è®°å…¥å‚ * * @author lianyutian * @since 2025-01-03 13:51:14 * @version 1.0 */@EqualsAndHashCode(callSuper = true)@Datapublic class NotePageParam extends PageParam /** åšä¸» ID */ private Long userId; package github.lianyutian.cshop.note.controller;/** * ç”¨æˆ·ç¬”è®°å±•ç¤º * * @author lianyutian * @since 2025-01-09 10:12:54 * @version 1.0 */@RestController@RequestMapping(/api/note/v1)@AllArgsConstructorpublic class NoteShowController private final NoteShowService noteShowService; /** * åˆ†é¡µæŸ¥è¯¢ç”¨æˆ·ç¬”è®°åˆ—è¡¨ * * @param notePageParam ç¬”è®°åˆ—è¡¨å…¥å‚ * @return æˆ‘çš„ç¬”è®°åˆ—è¡¨ */ @PostMapping(list/show) public ApiResultPageVONoteShowVO getNoteShowList(@RequestBody NotePageParam notePageParam) return ApiResult.success(noteShowService.getNoteShowList(notePageParam)); package github.lianyutian.cshop.note.service;/** * ç”¨æˆ·ç¬”è®°å±•ç¤º * * @author lianyutian * @since 2025-01-09 10:15:18 * @version 1.0 */public interface NoteShowService /** * è·å–ç¬”è®°å±•ç¤ºåˆ—è¡¨ * * @param notePageParam æŸ¥è¯¢å…¥å‚ * @return ç¬”è®°åˆ—è¡¨ */ PageVONoteShowVO getNoteShowList(NotePageParam notePageParam); package github.lianyutian.cshop.note.service.impl;/** * ç”¨æˆ·ç¬”è®°å±•ç¤ºå®ç° * * @author lianyutian * @since 2025-01-09 10:18:39 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class NoteShowServiceImpl implements NoteShowService private final NoteMapper noteMapper; @Override public PageVONoteShowVO getNoteShowList(NotePageParam notePageParam) Long userId = notePageParam.getUserId(); // æŸ¥è¯¢æ•°æ®åº“ LambdaQueryWrapperNote lambdaQueryWrapper = new LambdaQueryWrapper(); lambdaQueryWrapper .eq(Note::getUserId, userId) .eq(Note::getStatus, NoteStatusEnum.PUBLISHED) .orderByAsc(Note::getCreateTime); PageNote notePage = noteMapper.selectPage( notePageParam.toMpPageDefaultSortByCreateTimeDesc(), lambdaQueryWrapper); ListNoteShowVO noteShowList = BeanUtil.copyList(notePage.getRecords(), NoteShowVO.class); if (CollectionUtils.isEmpty(noteShowList)) return PageVO.empty(notePage); log.info(ä»æ•°æ®åº“è·å–ç¬”è®°ä¿¡æ¯ , JsonUtil.toJson(noteShowList)); return PageVO.of(notePage, noteShowList); 7.14.8 å¼•å…¥ç¼“å­˜7.14.8.1 è·å–æˆ‘çš„ç¬”è®°è¯¦æƒ… è·å–æˆ‘çš„ç¬”è®°è¯¦æƒ…æ˜¯ä¸€ä¸ªè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œç¬”è®°çš„æ›´æ–°é¢‘ç‡æ˜¯å¾ˆå°‘çš„ã€‚ä¸€èˆ¬éƒ½æ˜¯è¯»æ“ä½œï¼Œä¸”è·å–è‡ªå·±ç¬”è®°è¯¦æƒ…æ˜¯æ²¡æœ‰å¹¶å‘åœºæ™¯åªå­˜åœ¨è‡ªå·±è°ƒè¯¥æ¥å£ä¸éœ€è¦é”ã€‚ cshop-notesrcmainJavagithublianyutiancshopnoteconstantNoteCacheKeyConstant.Java package github.lianyutian.cshop.note.constant;/** * ç¬”è®°ç¼“å­˜å¸¸é‡ * * @author lianyutian * @since 2025-01-08 14:06:12 * @version 1.0 */public class NoteCacheKeyConstant /** ç¬”è®°ä¿¡æ¯æ›´æ–°é”å‰ç¼€ */ public static final String NOTE_UPDATE_LOCK_KEY_PREFIX = cshop-note:update:lock:; /** ç¬”è®°å±•ç¤ºä¿¡æ¯ç¼“å­˜å‰ç¼€ */ public static final String NOTE_SHOW_KEY_PREFIX = cshop-note:show:; /** ç¬”è®°ä¿¡æ¯ç¼“å­˜å‰ç¼€ */ public static final String NOTE_DETAIL_KEY_PREFIX = cshop-note:detail:; /** ç¬”è®°ä¿¡æ¯åˆ†é¡µç¼“å­˜å‰ç¼€ */ public static final String NOTE_SHOW_PAGE_KEY_PREFIX = cshop-note:show-page:; /** ç”¨æˆ·ç¬”è®°ä¿¡æ¯æ€»æ•°ç¼“å­˜å‰ç¼€ */ public static final String NOTE_TOTAL_KEY_PREFIX = cshop-note:total:; package github.lianyutian.cshop.note.service.impl;/** * ç¬”è®°æœåŠ¡å®ç°ç±» * * @author lianyutian * @since 2025-01-03 10:54:31 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class NoteServiceImpl implements NoteService private final NoteMapper noteMapper; private final RedisCache redisCache; @Override public NoteDetailVO getNoteDetail(Long noteId) LoginUserInfo loginUserInfo = LoginInterceptor.USER_THREAD_LOCAL.get(); String noteDetailKey = NoteCacheKeyConstant.NOTE_DETAIL_KEY_PREFIX + noteId; NoteDetailVO noteDetailFromCache = getNoteDetailFromCache(noteDetailKey); if (noteDetailFromCache != null) return noteDetailFromCache; Note note = noteMapper.selectOne( new LambdaQueryWrapperNote() .eq(Note::getId, noteId) .eq(Note::getUserId, loginUserInfo.getId())); if (note == null) return null; return BeanUtil.copy(note, NoteDetailVO.class); private NoteDetailVO getNoteDetailFromCache(String noteDetailKey) String noteDetailFromCache = redisCache.get(noteDetailKey); if (StringUtils.isNotBlank(noteDetailFromCache)) Long expire = redisCache.getExpire(noteDetailKey, TimeUnit.SECONDS); // å¦‚æœè¿‡æœŸæ—¶é—´å·²ç»åœ¨ 1 å°æ—¶å†…äº†å°±è‡ªåŠ¨å»¶æœŸ if (expire RedisCache.ONE_HOUR_SECONDS) // ç¼“å­˜ç²¾å‡†è‡ªåŠ¨å»¶æœŸ 2 å¤© + éšæœºå‡ ä¸ªå°æ—¶ redisCache.expire(noteDetailKey, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); return JsonUtil.fromJson(noteDetailFromCache, NoteDetailVO.class); return null; 7.14.8.2 æŸ¥çœ‹ä»–äººç¬”è®°è¯¦æƒ… æŸ¥çœ‹ä»–äººç¬”è®°è¯¦æƒ…å°±éœ€è¦è€ƒè™‘å¹¶å‘é—®é¢˜äº†ã€‚ åœºæ™¯ 1ï¼šA ç”¨æˆ·çš„æŸç¯‡ç¬”è®°çˆ†ç«ï¼Œæ­¤æ—¶å°±å¯èƒ½ä¼šå­˜åœ¨æˆåƒæˆ–ä¸Šä¸‡ç”¨æˆ·åŒæ—¶æ¥æŸ¥çœ‹è¿™ä¸€ç¯‡ç¬”è®°ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ç¼“å­˜æ¥æŠ—ä½è¿™äº›å¹¶å‘è¯·æ±‚ã€‚ åœºæ™¯ 2ï¼šåœ¨åœºæ™¯ 1 çš„åŸºç¡€ä¸Šï¼ŒA ç”¨æˆ·å‘ç°ç¬”è®°æœ‰æè¿°é”™è¯¯å»æ›´æ–°äº†ç¬”è®°ã€‚è¿™ä¸ªæ—¶å€™éœ€è¦è€ƒè™‘ç¬”è®°ç¼“å­˜å’Œæ•°æ®åº“ä¸­æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ä¾‹å¦‚ B ç”¨æˆ·çº¿ç¨‹è¯·æ±‚ç¬”è®°è¯¦æƒ…æ—¶ï¼Œç¼“å­˜åˆšå¥½è¿‡æœŸã€‚è¿™ä¸ªæ—¶å€™å»æŸ¥è¯¢æ•°æ®åº“è·å–åˆ°äº†ç¬”è®°æ•°æ®ï¼Œæ¥ä¸‹æ¥è¦æ›´æ–°ç¼“å­˜ä½†æ˜¯æ­¤æ—¶çº¿ç¨‹æ—¶é—´ç‰‡ç”¨å®Œè¢«æš‚åœã€‚è¿™æ—¶ç”¨æˆ· A çº¿ç¨‹å»ä¿®æ”¹ç¬”è®°ï¼Œå¹¶æ›´æ–°æ•°æ®åº“åŒæ—¶æ›´æ–°ç¼“å­˜ã€‚åœ¨ç”¨æˆ· A çº¿ç¨‹æ›´æ–°å®Œç¼“å­˜åï¼Œç”¨æˆ· B çº¿ç¨‹æ‰ç»§ç»­æ‰§è¡Œå†å»æ›´æ–°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™ç¼“å­˜ä¸­å°±æ˜¯æ—§æ•°æ®ï¼Œæ•°æ®åº“ä¸­æ˜¯æ–°æ•°æ®ã€‚ package github.lianyutian.cshop.note.service.impl;/** * ç”¨æˆ·ç¬”è®°å±•ç¤ºå®ç° * * @author lianyutian * @since 2025-01-09 10:18:39 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class NoteShowServiceImpl implements NoteShowService private final RedisCache redisCache; private final RedisLock redisLock; private final NoteMapper noteMapper; @Override public NoteShowVO getNoteShow(Long noteId) String noteShowKey = NoteCacheKeyConstant.NOTE_SHOW_KEY_PREFIX + noteId; NoteShowVO noteDetailFromCache = getNoteShowFromCache(noteShowKey); if (noteDetailFromCache != null) return noteDetailFromCache; return getNoteShowFromDB(noteShowKey, noteId); private NoteShowVO getNoteShowFromCache(String noteShowKey) String noteDetailFromCache = redisCache.get(noteShowKey); if (StringUtils.isNotBlank(noteDetailFromCache)) Long expire = redisCache.getExpire(noteShowKey, TimeUnit.SECONDS); // å¦‚æœè¿‡æœŸæ—¶é—´å·²ç»åœ¨ 1 å°æ—¶å†…äº†å°±è‡ªåŠ¨å»¶æœŸ if (expire RedisCache.ONE_HOUR_SECONDS) // ç¼“å­˜ç²¾å‡†è‡ªåŠ¨å»¶æœŸ 2 å¤© + éšæœºå‡ ä¸ªå°æ—¶ redisCache.expire(noteShowKey, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); return JsonUtil.fromJson(noteDetailFromCache, NoteShowVO.class); return null; private NoteShowVO getNoteShowFromDB(String noteDetailKey, Long noteId) /* 1.è®¾ç½®åˆ†å¸ƒå¼é”é˜²æ­¢è¶…é«˜å¹¶å‘è¯·æ±‚æ‰“åˆ°æ•°æ®åº“ 2.ä¿è¯ç¬”è®°æ•°æ®æ›´æ–°æ—¶ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§ */ String noteUpdateLockKey = NoteCacheKeyConstant.NOTE_UPDATE_LOCK_KEY_PREFIX + noteId; boolean locked = false; try locked = redisLock.tryLock(noteUpdateLockKey, RedisLock.UPDATE_LOCK_TIMEOUT); if (!locked) // åŠ é”è¶…æ—¶æ—¶é—´æœ‰ 200ms, æ‰€ä»¥å†æ¬¡å°è¯•è·å–ç¼“å­˜ NoteShowVO noteDetailFromCache = getNoteShowFromCache(noteDetailKey); if (noteDetailFromCache != null) return noteDetailFromCache; log.warn(ã€getNoteShowDetailã€‘ç¬”è®°ç¼“å­˜ä¸ºç©ºï¼ŒæŸ¥è¯¢ç¬”è®°ä¿¡æ¯è·å–é”å¤±è´¥ , noteId); throw new BizException(BizCodeEnum.NOTE_INFO_LOCK_FAIL); // è·å–é”æˆåŠŸï¼ŒæŸ¥è¯¢æ•°æ®åº“ Note note = noteMapper.selectOne( new LambdaQueryWrapperNote() .eq(Note::getId, noteId) .eq(Note::getStatus, NoteStatusEnum.PUBLISHED.getCode())); if (note == null) log.warn(ã€getNoteShowDetailã€‘ç¬”è®°ä¸å­˜åœ¨ , noteId); // é˜²æ­¢åŒæ—¶é—´å¤§é‡æ— æ•ˆ noteId ç©¿é€ç¼“å­˜æ‰“åˆ°æ•°æ®åº“é€ æˆç¼“å­˜ç©¿é€ redisCache.set( noteDetailKey, RedisCache.EMPTY_CACHE, RedisCache.generateCachePenetrationExpire(), TimeUnit.MILLISECONDS); return null; return BeanUtil.copy(note, NoteShowVO.class); catch (InterruptedException e) NoteShowVO noteDetailFromCache = getNoteShowFromCache(noteDetailKey); if (noteDetailFromCache != null) return noteDetailFromCache; log.error(ã€getNoteShowã€‘å°è¯•åŠ é”å¼‚å¸¸ï¼Œå¼‚å¸¸ä¿¡æ¯ï¼š, e.getMessage(), e); throw new BizException(BizCodeEnum.NOTE_INFO_LOCK_FAIL); finally if (locked) redisLock.unlock(noteUpdateLockKey); 7.14.8.3 æŸ¥çœ‹ç¬”è®°åˆ†é¡µåˆ—è¡¨package github.lianyutian.cshop.note.service.impl;/** * ç”¨æˆ·ç¬”è®°å±•ç¤ºå®ç° * * @author lianyutian * @since 2025-01-09 10:18:39 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class NoteShowServiceImpl implements NoteShowService private final RedisCache redisCache; private final RedisLock redisLock; private final NoteMapper noteMapper; @Override public PageVONoteShowVO getNoteShowList(NotePageParam notePageParam) // ä»ç¼“å­˜æŸ¥è¯¢åˆ†é¡µæ•°æ® ListNoteShowVO noteListFromCache = getNoteShowListFromCache( NoteCacheKeyConstant.NOTE_SHOW_PAGE_KEY_PREFIX + notePageParam.getUserId() + : + notePageParam.getPageNo()); if (!CollectionUtils.isEmpty(noteListFromCache)) return getNotePage(notePageParam, noteListFromCache); ListNoteShowVO noteListFromDB = getNoteShowListFromDB(notePageParam); if (!CollectionUtils.isEmpty(noteListFromDB)) return getNotePage(notePageParam, noteListFromDB); return null; /** * è·å–ç¼“å­˜çš„åˆ†é¡µç¬”è®°ä¿¡æ¯ * * @param notePageInfoKey åˆ†é¡µç¼“å­˜ key * @return åˆ†é¡µç¬”è®°ä¿¡æ¯ */ @SuppressWarnings(unchecked) private ListNoteShowVO getNoteShowListFromCache(String notePageInfoKey) String cachePageInfo = redisCache.get(notePageInfoKey); if (StringUtils.isNotBlank(cachePageInfo)) Long expire = redisCache.getExpire(notePageInfoKey, TimeUnit.SECONDS); // å¦‚æœè¿‡æœŸæ—¶é—´å·²ç»åœ¨ 1 å°æ—¶å†…äº†å°±è‡ªåŠ¨å»¶æœŸ if (expire RedisCache.ONE_HOUR_SECONDS) // ç¼“å­˜ç²¾å‡†è‡ªåŠ¨å»¶æœŸ 2 å¤© + éšæœºå‡ ä¸ªå°æ—¶ redisCache.expire(notePageInfoKey, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); return JsonUtil.fromJson(cachePageInfo, List.class); return null; private ListNoteShowVO getNoteShowListFromDB(NotePageParam notePageParam) Long userId = notePageParam.getUserId(); // åˆ†å¸ƒå¼é” key String noteUpdateLockKey = NoteCacheKeyConstant.NOTE_UPDATE_LOCK_KEY_PREFIX + userId; boolean tryLocked = false; // ç¬”è®°åˆ†é¡µç¼“å­˜ key String notePageKey = NoteCacheKeyConstant.NOTE_SHOW_PAGE_KEY_PREFIX + userId + : + notePageParam.getPageNo(); try tryLocked = redisLock.tryLock(noteUpdateLockKey, RedisCache.UPDATE_LOCK_TIMEOUT); if (!tryLocked) /* å°è¯•åŠ é”æ—¶é—´æœ‰ RedisCache.UPDATE_LOCK_TIMEOUT æœ‰å¯èƒ½å…¶ä»–çº¿ç¨‹å·²ç»è·å–æ•°æ®å¹¶å†™å…¥ç¼“å­˜äº†æ‰€ä»¥è¿™é‡Œå†å°è¯•å»è¯»ä¸‹ç¼“å­˜ */ ListNoteShowVO noteListFromCache = getNoteShowListFromCache(notePageKey); if (!CollectionUtils.isEmpty(noteListFromCache)) return noteListFromCache; log.info(ã€getNoteListFromDBã€‘ç¬”è®°ç¼“å­˜ä¸ºç©ºï¼ŒæŸ¥è¯¢ç¬”è®°ä¿¡æ¯è·å–é”å¤±è´¥ , userId); return null; // æŸ¥è¯¢æ•°æ®åº“ LambdaQueryWrapperNote lambdaQueryWrapper = new LambdaQueryWrapper(); lambdaQueryWrapper .eq(Note::getUserId, userId) .eq(Note::getStatus, NoteStatusEnum.PUBLISHED) .orderByAsc(Note::getCreateTime); PageNote notePage = noteMapper.selectPage( notePageParam.toMpPageDefaultSortByCreateTimeDesc(), lambdaQueryWrapper); ListNoteShowVO noteShowList = BeanUtil.copyList(notePage.getRecords(), NoteShowVO.class); if (CollectionUtils.isEmpty(noteShowList)) // é˜²æ­¢ç¼“å­˜ç©¿é€ redisCache.set( notePageKey, RedisCache.EMPTY_CACHE, RedisCache.generateCachePenetrationExpire(), TimeUnit.MILLISECONDS); return null; redisCache.set( notePageKey, noteShowList, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); log.info(ã€getNoteListFromDBã€‘ç¬”è®°ç¼“å­˜ä¸ºç©ºï¼Œä»æ•°æ®åº“è·å–ç¬”è®°ä¿¡æ¯ , JsonUtil.toJson(noteShowList)); return noteShowList; catch (InterruptedException e) // åŠ é”å¤±è´¥ // è¿™é‡Œå†å»å°è¯•è·å–ä¸‹ç¼“å­˜-åŒé‡æ£€æŸ¥ ListNoteShowVO noteListFromCache = getNoteShowListFromCache(notePageKey); if (!CollectionUtils.isEmpty(noteListFromCache)) return noteListFromCache; log.error(ã€getNoteListFromDBã€‘å°è¯•åŠ é”å¼‚å¸¸ï¼Œå¼‚å¸¸ä¿¡æ¯ï¼š, e.getMessage(), e); throw new BizException(BizCodeEnum.NOTE_INFO_LOCK_FAIL); finally if (tryLocked) redisLock.unlock(noteUpdateLockKey); private PageVONoteShowVO getNotePage(NotePageParam notePageParam, ListNoteShowVO noteList) // è®¡ç®—æˆ‘çš„ç¬”è®°åˆ—è¡¨æ€»æ•° String userNoteTotalKey = NoteCacheKeyConstant.NOTE_TOTAL_KEY_PREFIX + notePageParam.getUserId(); // ç¬”è®°æ€»æ¡æ•° Long total = redisCache.getLong(userNoteTotalKey); // è®¡ç®—æ€»é¡µæ•° double totalPages = Math.ceil((double) total / notePageParam.getPageSize()); return new PageVO(total, (long) totalPages, Collections.unmodifiableList(noteList)); 7.14.9 é‡å»ºåˆ†é¡µç¼“å­˜ ç”¨æˆ·æŸ¥è¯¢ç¬”è®°åˆ†é¡µæ—¶ï¼Œä¼šä»æ•°æ®åº“æ ¹æ®åˆ†é¡µæ•°æŸ¥è¯¢åˆ†é¡µè®°å½•å¹¶æŠŠç»“æœå†™å…¥åˆ°ç¼“å­˜ã€‚å¦‚æœç”¨æˆ·æ·»åŠ æ›´æ–°äº†ä¸€ç¯‡æ–°ç¬”è®°ï¼Œé‚£ä¹ˆæ•´ä¸ªåˆ†é¡µç¼“å­˜è®°å½•éƒ½éœ€è¦é‡æ–°æ„å»ºã€‚é‡å»ºç¼“å­˜æ˜¯ä¸ªè€—æ—¶çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥å¼•å…¥ RocketMq åšä¸€ä¸ªå¼‚æ­¥æ›´æ–°æ“ä½œã€‚æ·»åŠ æ›´æ–°ä¸€ç¯‡ç¬”è®°åä¼šå‘é€ MQ æ¶ˆæ¯ï¼Œæ¶ˆè´¹ç«¯ç›‘å¬æ¶ˆæ¯ï¼Œé‡å»ºç¼“å­˜ã€‚ pom.xml !-- rocketmq ç‰ˆæœ¬ --rocketmq-starter.version2.2.1/rocketmq-starter.versiondependency groupIdorg.apache.rocketmq/groupId artifactIdrocketmq-spring-boot-starter/artifactId version$rocketmq-starter.version/version/dependency cshop-commonpom.xml dependency groupIdorg.apache.rocketmq/groupId artifactIdrocketmq-spring-boot-starter/artifactId/dependency cshop-notepom.xml dependency groupIdorg.apache.rocketmq/groupId artifactIdrocketmq-client/artifactId/dependency cshop-commonsrcmainJavagithublianyutiancshopcommonmqRocketMQConfig.Java package github.lianyutian.cshop.common.mq;import lombok.Data;import org.apache.rocketmq.acl.common.AclClientRPCHook;import org.apache.rocketmq.acl.common.SessionCredentials;import org.apache.rocketmq.remoting.RPCHook;import org.springframework.beans.factory.annotation.Value;import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;/** * rocketmq é…ç½®ç±» * * @author lianyutian * @since 2025-01-15 10:26:51 * @version 1.0 */@Data@Configuration@ConditionalOnProperty(prefix = rocketmq, value = nameServer)public class RocketMQConfig @Value($rocketmq.nameServer) private String nameServer; @Value($rocketmq.accessKey) private String accessKey; @Value($rocketmq.secretKey) private String secretKey; /** * é‰´æƒ hook * * @return RPCHook */ @Bean public RPCHook rpcHook() return new AclClientRPCHook(new SessionCredentials(accessKey, secretKey)); cshop-notesrcmainresourcesapplication.yml # rocketmqé…ç½®rocketmq: accessKey: mqadmin secretKey: MIIEowIBAAKCAQEAwG90ULRHmAXFXQzZSwleoYts2+bCzUvqhhqtGiv/F5kUsETY nameServer: 116.198.217.158:9876 cshop-notesrcmainJavagithublianyutiancshopnoteconstantNoteRocketMQConstant.Java package github.lianyutian.cshop.note.constant;/** * MQ å¸¸é‡ç±» * * @author lianyutian * @since 2025-01-14 14:53:14 * @version 1.0 */public class NoteRocketMQConstant public static final String NOTE_UPDATE_PRODUCER_GROUP = note-update-producer-group; public static final String NOTE_UPDATE_TOPIC = note-update-topic; cshop-notesrcmainJavagithublianyutiancshopnoteenumsNoteMessageType.Java package github.lianyutian.cshop.note.enums;import lombok.Getter;/** * ç¬”è®° MQ æ¶ˆæ¯ç±»å‹æšä¸¾ * * @author lianyutian * @since 2025-01-15 14:26:26 * @version 1.0 */@Getterpublic enum NoteMessageType /** ç¬”è®°æ–°å¢æ¶ˆæ¯ */ ADD_NOTE(ADD, æ–°å¢ç¬”è®°æ¶ˆæ¯), /** ç¬”è®°æ›´æ–°æ¶ˆæ¯ */ UPDATE_NOTE(UPDATE, æ›´æ–°ç¬”è®°æ¶ˆæ¯); private final String type; private final String message; NoteMessageType(String type, String message) this.type = type; this.message = message; cshop-notesrcmainJavagithublianyutiancshopnotemqmessageNoteUpdateMessage.Java package github.lianyutian.cshop.note.mq.message;import java.io.Serializable;import lombok.Builder;import lombok.Getter;import lombok.Setter;/** * ç¬”è®°æ›´æ–°æ¶ˆæ¯ * * @author lianyutian * @since 2025-01-14 16:16:40 * @version 1.0 */@Getter@Setter@Builderpublic class NoteUpdateMessage implements Serializable /** ç¬”è®° ID */ private Long noteId; /** åšä¸» ID */ private Long userId; cshop-notesrcmainJavagithublianyutiancshopnotemqproducerNoteTransactionProducer.Java package github.lianyutian.cshop.note.mq.producer;/** * ç¬”è®°äº‹åŠ¡æ¶ˆæ¯ç”Ÿäº§è€… * * @author lianyutian * @since 2025-01-14 14:52:03 * @version 1.0 */@Getter@Component@Slf4jpublic class NoteTransactionProducer private final TransactionMQProducer producer; @Autowired public NoteTransactionProducer( RocketMQConfig rocketMQConfig, RPCHook rpcHook, NoteAddListener noteAddListener) // åˆå§‹åŒ–äº‹åŠ¡ç”Ÿäº§è€…å®¢æˆ·ç«¯ï¼Œè®¾ç½®å¯¹åº”çš„ç”Ÿäº§è€…ç»„ producer = new TransactionMQProducer(NoteRocketMQConstant.NOTE_UPDATE_PRODUCER_GROUP, rpcHook); // è®¾ç½® nameserver producer.setNamesrvAddr(rocketMQConfig.getNameServer()); producer.setTransactionListener(noteAddListener); // å¯åŠ¨ç”Ÿäº§è€…æœåŠ¡ start(); /** å¯åŠ¨ rocketmq ç”Ÿäº§è€…æœåŠ¡ è¯¥å¯¹è±¡åœ¨ä½¿ç”¨ä¹‹å‰å¿…é¡»è¦è°ƒç”¨ä¸€æ¬¡ï¼Œåªèƒ½åˆå§‹åŒ–ä¸€æ¬¡ */ public void start() try this.producer.start(); catch (MQClientException e) log.error(rocketmq producer start error, e); /** å…³é—­ rocketmq ç”Ÿäº§è€… */ public void shutdown() this.producer.shutdown(); /** * å‘é€äº‹åŠ¡æ¶ˆæ¯ * * @param topic topic * @param tag tag * @param message æ¶ˆæ¯ * @param arg é¢å¤–å‚æ•° * @param type æ¶ˆæ¯ç±»å‹ */ public void sendTransactionMessage( String topic, String tag, String message, Object arg, NoteMessageType type) Message msg = new Message(topic, tag, message.getBytes(StandardCharsets.UTF_8)); try SendResult send = producer.sendMessageInTransaction(msg, arg); if (SendStatus.SEND_OK == send.getSendStatus()) log.info(å‘é€ MQ æ¶ˆæ¯æˆåŠŸ, type:, message:, arg:, type.getMessage(), message, arg); else throw new BizException(send.getSendStatus().toString()); catch (Exception e) log.error(å‘é€ MQ æ¶ˆæ¯å¤±è´¥ï¼š, e); throw new BizException(å‘é€ MQ æ¶ˆæ¯å¤±è´¥); /** * åŒæ­¥å‘é€å•æ¡æ¶ˆæ¯ * * @param topic ä¸»é¢˜ * @param tag tag * @param message æ¶ˆæ¯ * @param type ç±»å‹ */ public void sendMessage(String topic, String tag, String message, NoteMessageType type) sendDelayMessage(topic, tag, message, DelayLevel.LEVEL_0, type); /** * å‘é€å•æ¡å»¶è¿Ÿæ¶ˆæ¯ * * @param topic topic * @param tag tag * @param message æ¶ˆæ¯ * @param delayTimeLevel å»¶è¿Ÿç­‰çº§ * @param type ç±»å‹ */ public void sendDelayMessage( String topic, String tag, String message, DelayLevel delayTimeLevel, NoteMessageType type) Message msg = new Message(topic, tag, message.getBytes(StandardCharsets.UTF_8)); try if (delayTimeLevel.getValue() 0) msg.setDelayTimeLevel(delayTimeLevel.getValue()); SendResult send = producer.send(msg); if (SendStatus.SEND_OK == send.getSendStatus()) log.info(å‘é€ MQ æ¶ˆæ¯æˆåŠŸ, type:, message:, type.getMessage(), message); else throw new BizException(send.getSendStatus().toString()); catch (Exception e) log.error(å‘é€ MQ æ¶ˆæ¯å¤±è´¥ï¼š, e); throw new BizException(å‘é€ MQ æ¶ˆæ¯å¤±è´¥); /** * æ‰¹é‡å‘é€å»¶è¿Ÿæ¶ˆæ¯ * * @param topic topic * @param tag tag * @param messages å¤šä¸ªæ¶ˆæ¯ * @param delayTimeLevel å»¶è¿Ÿç­‰çº§ * @param type ç±»å‹ */ public void sendDelayMessages( String topic, String tag, ListString messages, DelayLevel delayTimeLevel, NoteMessageType type) ListMessage list = new ArrayList(); for (String message : messages) Message msg = new Message(topic, tag, message.getBytes(StandardCharsets.UTF_8)); if (delayTimeLevel.getValue() 0) msg.setDelayTimeLevel(delayTimeLevel.getValue()); list.add(msg); try SendResult send = producer.send(list); if (SendStatus.SEND_OK == send.getSendStatus()) log.info(å‘é€ MQ æ¶ˆæ¯æˆåŠŸ, type:, type.getMessage()); else throw new BizException(send.getSendStatus().toString()); catch (Exception e) log.error(å‘é€ MQ æ¶ˆæ¯å¤±è´¥ï¼š, e); throw new BizException(å‘é€ MQ æ¶ˆæ¯å¤±è´¥); cshop-notesrcmainJavagithublianyutiancshopnotemqproducerlistenerNoteAddListener.Java package github.lianyutian.cshop.note.mq.producer.listener;/** * ç¬”è®°æ·»åŠ æ¶ˆæ¯ç›‘å¬ * * @author lianyutian * @since 2025-01-16 10:59:25 * @version 1.0 */@Slf4j@Component@AllArgsConstructorpublic class NoteAddListener implements TransactionListener private final NoteMapper noteMapper; @Override public LocalTransactionState executeLocalTransaction(Message msg, Object arg) return LocalTransactionState.UNKNOW; @Override public LocalTransactionState checkLocalTransaction(MessageExt msg) return checkNoteAddStatus(msg); private LocalTransactionState checkNoteAddStatus(Message msg) try String messageBody = new String(msg.getBody(), StandardCharsets.UTF_8); NoteUpdateMessage noteAddMessage = JsonUtil.fromJson(messageBody, NoteUpdateMessage.class); if (noteAddMessage == null) log.error(Failed to parse NoteAddMessage from message body: , messageBody); return LocalTransactionState.ROLLBACK_MESSAGE; Long noteId = noteAddMessage.getNoteId(); if (noteId == null) log.error(NoteId is null in NoteAddMessage: , noteAddMessage); return LocalTransactionState.ROLLBACK_MESSAGE; Note note = noteMapper.selectById(noteId); if (note != null) log.info(Note with id found, committing message, noteId); return LocalTransactionState.COMMIT_MESSAGE; else log.warn(Note with id not found, returning unknown state, noteId); return LocalTransactionState.UNKNOW; catch (Exception e) log.error(Error processing message: , e.getMessage(), e); return LocalTransactionState.ROLLBACK_MESSAGE; cshop-notesrcmainJavagithublianyutiancshopnotemqconsumerNoteUpdateConsumerConfig.Java package github.lianyutian.cshop.note.mq.consumer;/** * é»˜è®¤æ¶ˆè´¹è€… * * @author lianyutian * @since 2025-01-15 10:32:28 * @version 1.0 */@Componentpublic class NoteUpdateConsumerConfig @Bean public DefaultMQPushConsumer noteUpdateConsumer( RocketMQConfig rocketMQConfig, NoteUpdateListener noteUpdateListener, NoteAddListener noteAddListener, RPCHook rpcHook) throws MQClientException DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(null, NoteRocketMQConstant.NOTE_UPDATE_PRODUCER_GROUP, rpcHook); consumer.setNamesrvAddr(rocketMQConfig.getNameServer()); consumer.subscribe(NoteRocketMQConstant.NOTE_UPDATE_TOPIC, *); consumer.registerMessageListener(noteUpdateListener); consumer.start(); return consumer; cshop-notesrcmainJavagithublianyutiancshopnotemqconsumerlistenerNoteUpdateListener.Java package github.lianyutian.cshop.note.mq.consumer.listener;/** * ç¬”è®°æ›´æ–°æ¶ˆæ¯ç›‘å¬å™¨ * * @author lianyutian * @since 2025-01-15 10:34:58 * @version 1.0 */@Slf4j@Component@AllArgsConstructorpublic class NoteUpdateListener implements MessageListenerConcurrently /** æ¯é¡µ 20 æ¡ */ private static final int PAGE_SIZE = 2; private final RedisCache redisCache; private final RedisLock redisLock; private final NoteMapper noteMapper; @Override public ConsumeConcurrentlyStatus consumeMessage( ListMessageExt noteMessageList, ConsumeConcurrentlyContext context) try for (MessageExt noteMessage : noteMessageList) String msg = new String(noteMessage.getBody()); Long userId; NoteUpdateMessage noteUpdateMessage = JsonUtil.fromJson(msg, NoteUpdateMessage.class); userId = noteUpdateMessage.getUserId(); log.info(ç¬”è®° MQ å¼‚æ­¥æ›´æ–°-æ‰§è¡Œåšä¸»ç¬”è®°åˆ†é¡µç¼“å­˜æ•°æ®å¼‚æ­¥æ›´æ–°ï¼Œæ¶ˆæ¯å†…å®¹ï¼š, JsonUtil.toJson(noteUpdateMessage)); // è¿™é‡Œå¢åŠ åˆ†å¸ƒå¼é”ï¼ŒåŒä¸€ä¸ªç”¨æˆ·åŒæ—¶é—´åªèƒ½æ“ä½œä¸€æ¬¡ï¼Œé¿å…é‡å¤è¯·æ±‚ String noteUpdateLockKey = NoteCacheKeyConstant.NOTE_UPDATE_LOCK_KEY_PREFIX + userId; boolean locked = false; try // è¿™é‡Œé€šè¿‡é˜»å¡çš„æ–¹å¼è¿›è¡ŒåŠ é”ï¼Œè·Ÿæ–°å¢/æ›´æ–°ç¬”è®°æ“ä½œäº’æ–¥ï¼Œå¹¶å‘æ“ä½œæ—¶è¿›è¡Œé˜»å¡ locked = redisLock.blockedLock(noteUpdateLockKey); updateCache(userId); finally if (locked) redisLock.unlock(noteUpdateLockKey); catch (Exception e) // æœ¬æ¬¡æ¶ˆè´¹å¤±è´¥ï¼Œä¸‹æ¬¡é‡æ–°æ¶ˆè´¹ log.error(ç¬”è®° MQ å¼‚æ­¥æ›´æ–° consume error, æ›´æ–°åšä¸»ç¬”è®°ç¼“å­˜æ•°æ®æ¶ˆè´¹å¤±è´¥, e); return ConsumeConcurrentlyStatus.RECONSUME_LATER; log.info(ç¬”è®° MQ å¼‚æ­¥æ›´æ–°-åšä¸»ç¬”è®°ç¼“å­˜æ•°æ®æ¶ˆè´¹æˆåŠŸ, result: , ConsumeConcurrentlyStatus.CONSUME_SUCCESS); return ConsumeConcurrentlyStatus.CONSUME_SUCCESS; private void updateCache(Long userId) // æ­¤æ—¶æˆ‘ä»¬éœ€è¦å¯¹åšä¸»çš„ç¬”è®°åˆ—è¡¨è¿›è¡Œåˆ†é¡µç¼“å­˜é‡æ–°æ„å»º // æ–°å¢éœ€è¦æ„å»ºæ‰€æœ‰ç¬”è®°åˆ†é¡µç¼“å­˜ // 1ã€è®¡ç®—æˆ‘çš„ç¬”è®°åˆ—è¡¨æ€»æ•° String userNoteTotalKey = NoteCacheKeyConstant.NOTE_TOTAL_KEY_PREFIX + userId; Long size = redisCache.getLong(userNoteTotalKey); log.info(ç¬”è®° MQ å¼‚æ­¥æ›´æ–°-key:, value:, userNoteTotalKey, size); // è®¡ç®—æ€»åˆ†é¡µæ•° int pageTotal = (int) Math.ceil((double) size / PAGE_SIZE) + 1; for (int pageNum = 1; pageNum = pageTotal; pageNum++) buildPageCache(userId, pageNum); private void buildPageCache(Long userId, int pageNum) // ç¬”è®°åˆ†é¡µç¼“å­˜ key String notePageKey = NoteCacheKeyConstant.NOTE_SHOW_PAGE_KEY_PREFIX + userId + : + pageNum; // å…ˆä»ç¼“å­˜ä¸­è·å–ä¸€ä¸‹ String notePageCache = redisCache.get(notePageKey); // å¦‚æœåˆ†é¡µç¼“å­˜ä¸ºç©ºï¼Œè·³è¿‡ if (StringUtils.isBlank(notePageCache)) return; // åªæœ‰ç¼“å­˜ä¸­å­˜åœ¨è¿™ä¸€é¡µçš„æ•°æ®æ‰ä¼šå»æ•°æ®åº“è¯»å–æœ€æ–°çš„ç¬”è®°ä¿¡æ¯å»æ›´æ–° // æŸ¥è¯¢æˆ‘çš„æœªåˆ é™¤ç¬”è®°åˆ—è¡¨ LambdaQueryWrapperNote lambdaQueryWrapper = new LambdaQueryWrapper(); lambdaQueryWrapper .eq(Note::getUserId, userId) .eq(Note::getStatus, NoteStatusEnum.PUBLISHED) .orderByDesc(Note::getUpdateTime); PageNote notePageParam = new Page(pageNum, PAGE_SIZE); PageNote notePage = noteMapper.selectPage(notePageParam, lambdaQueryWrapper); ListNote noteList = notePage.getRecords(); log.info( ç¬”è®° MQ å¼‚æ­¥æ›´æ–°-ä»æ•°æ®åº“è·å–æˆ‘çš„ç¬”è®°åˆ—è¡¨ï¼ŒpageNum:, total:, sizeï¼š, userId: , notePage.getPages(), notePage.getTotal(), notePage.getSize(), userId); ListNoteShowVO noteShowVOList = BeanUtil.copyList(noteList, NoteShowVO.class); // å†™å…¥åˆ†é¡µç¼“å­˜æ•°æ® redisCache.set( notePageKey, noteShowVOList, RedisCache.generateCacheExpire(), TimeUnit.MILLISECONDS); package github.lianyutian.cshop.note.service.impl;/** * ç¬”è®°æœåŠ¡å®ç°ç±» * * @author lianyutian * @since 2025-01-03 10:54:31 * @version 1.0 */@Service@Slf4j@AllArgsConstructorpublic class NoteServiceImpl implements NoteService private final NoteMapper noteMapper; private final RedisLock redisLock; private final RedisCache redisCache; private final NoteTransactionProducer noteTransactionProducer; @Override @Transactional(rollbackFor = Exception.class) public int addNote(NoteAddParam noteAddParam) LoginUserInfo loginUserInfo = LoginInterceptor.USER_THREAD_LOCAL.get(); Note note = BeanUtil.copy(noteAddParam, Note.class); note.setUserId(loginUserInfo.getId()); // note.setStatus(NoteStatusEnum.AUDITING); note.setStatus(NoteStatusEnum.PUBLISHED); note.setPublishTime(new Date()); int row; try row = noteMapper.insert(note); if (row 0) try redisCache.increment( NoteCacheKeyConstant.NOTE_TOTAL_KEY_PREFIX + loginUserInfo.getId(), 1); // ä¸èƒ½å› ä¸ºæ¶ˆæ¯å‘é€å¤±è´¥å¯¼è‡´ç¬”è®°æ–°å¢å¤±è´¥ // TODO éœ€è¦å®šæ—¶ä»»åŠ¡æ‰«ææ–°å¢ç¬”è®°æ¥å…œåº•åˆ†é¡µåˆ·æ–° publishNoteAddedEvent(note.getId(), loginUserInfo.getId()); catch (Exception e) log.error(redis or mq error , e.getMessage(), e); catch (Exception e) log.error(db addNote error , e.getMessage(), e); throw new BizException(BizCodeEnum.NOTE_ADD_FAIL); log.info(ç¬”è®°æœåŠ¡-æ–°å¢ç¬”è®°ï¼šrows=ï¼Œdata=, row, JsonUtil.toJson(noteAddParam)); return row; @Override @Transactional(rollbackFor = Exception.class) public int updateNote(NoteEditParam noteEditParam) // 1.æŸ¥è¯¢ç¬”è®°æ˜¯å¦å­˜åœ¨ LoginUserInfo loginUserInfo = LoginInterceptor.USER_THREAD_LOCAL.get(); // è¿™é‡Œå¢åŠ åˆ†å¸ƒå¼é”æ˜¯ä¸ºäº†ä¿è¯ Redis ä¸­ç¼“å­˜çš„ç¬”è®°æ•°æ®å’Œ DB ä¸­çš„ç¬”è®°æ•°æ®ä¸€è‡´ /* å­˜åœ¨è¿™ç§åœºæ™¯ï¼šå‡è®¾å½“å‰ç¼“å­˜ä¸ºç©ºï¼Œç”¨æˆ· A æ›´æ–°è‡ªå·±çš„ç¬”è®°ï¼ŒåŒæ—¶ç”¨æˆ· B æŸ¥è¯¢ç”¨æˆ· A çš„ç¬”è®°ã€‚å¦‚æœè¿™æ—¶ç”¨æˆ· A è¿˜æœªæ›´æ–°æ•°æ®åº“ï¼Œç”¨æˆ· B å·²ç»ä»æ•°æ®åº“æŸ¥è¯¢åˆ°äº†æ•°æ® åŒæ—¶ç”¨æˆ· B æ‰€åœ¨çº¿ç¨‹ CPU æ‰§è¡Œæ—¶é—´æ¶ˆè€—å®Œè¢«æŒ‚èµ·ã€‚æ­¤æ—¶ç”¨æˆ· A å†æ›´æ–°æ•°æ®åº“æˆåŠŸå¹¶å°†æ–°æ•°æ®å†™å…¥ç¼“å­˜ã€‚ç”¨æˆ· B çº¿ç¨‹æ‰ç»§ç»­æ‰§è¡Œï¼Œæ­¤æ—¶ç”¨æˆ· B æŸ¥è¯¢åˆ°çš„æ•°æ®æ˜¯æ—§çš„ã€‚ åˆå»å†™å…¥äº†ç¼“å­˜é‚£ä¹ˆæ­¤æ—¶çš„ç¼“å­˜æ•°æ®å°±æ˜¯æ—§çš„ã€‚ */ String noteUpdateLockKey = NoteCacheKeyConstant.NOTE_UPDATE_LOCK_KEY_PREFIX + noteEditParam.getId(); boolean locked = false; try locked = redisLock.lock(noteUpdateLockKey); if (!locked) log.info(ç¬”è®°æ¨¡å—-ç”¨æˆ·ä¿®æ”¹ç¬”è®°ä¿¡æ¯ï¼šç”¨æˆ· è·å–é”å¤±è´¥, ç¬”è®° , loginUserInfo.getId(), noteEditParam.getId()); throw new BizException(BizCodeEnum.NOTE_UPDATE_LOCK_FAIL); Note updateNote = BeanUtil.copy(noteEditParam, Note.class); int row = noteMapper.update( updateNote, new LambdaUpdateWrapperNote() .eq(Note::getId, noteEditParam.getId()) .eq(Note::getUserId, loginUserInfo.getId())); if (row 0) updateNoteCache(noteEditParam.getId()); publishNoteUpdatedEvent(noteEditParam.getId(), loginUserInfo.getId()); log.info(ç¬”è®°æœåŠ¡-æ›´æ–°ç¬”è®°ï¼šrow=, data=, row, JsonUtil.toJson(noteEditParam)); return row; catch (Exception e) log.error(updateNote error , e.getMessage(), e); // åˆ æ‰ç¼“å­˜ redisCache.delete(NoteCacheKeyConstant.NOTE_SHOW_KEY_PREFIX + noteEditParam.getId()); redisCache.delete(NoteCacheKeyConstant.NOTE_DETAIL_KEY_PREFIX + noteEditParam.getId()); throw new BizException(BizCodeEnum.NOTE_UPDATE_FAIL); finally if (locked) redisLock.unlock(noteUpdateLockKey); private void publishNoteAddedEvent(Long noteId, Long userId) noteTransactionProducer.sendTransactionMessage( NoteRocketMQConstant.NOTE_UPDATE_TOPIC, NoteMessageType.ADD_NOTE.getType(), JsonUtil.toJson(NoteUpdateMessage.builder().noteId(noteId).userId(userId).build()), null, NoteMessageType.ADD_NOTE); private void publishNoteUpdatedEvent(Long noteId, Long userId) noteTransactionProducer.sendMessage( NoteRocketMQConstant.NOTE_UPDATE_TOPIC, NoteMessageType.UPDATE_NOTE.getType(), JsonUtil.toJson(NoteUpdateMessage.builder().noteId(noteId).userId(userId).build()), NoteMessageType.UPDATE_NOTE); ç¤¾äº¤æœåŠ¡ä¼˜æƒ åˆ¸æœåŠ¡åå°ç•Œé¢é¡¹ç›®åˆ›å»ºyarn create vueyarn create v1.22.22[1/4] Resolving packages...[2/4] Fetching packages...[3/4] Linking dependencies...[4/4] Building fresh packages...success Installed create-vue@3.15.1 with binaries: - create-vue[##] 2/2â”Œ Vue.js - The Progressive JavaScript Frameworkâ”‚â—‡ è¯·è¾“å…¥é¡¹ç›®åç§°ï¼šâ”‚ cshop-admin-frontâ”‚â—‡ è¯·é€‰æ‹©è¦åŒ…å«çš„åŠŸèƒ½ï¼š (â†‘/â†“ åˆ‡æ¢ï¼Œç©ºæ ¼é€‰æ‹©ï¼Œa å…¨é€‰ï¼Œå›è½¦ç¡®è®¤)â”‚ TypeScript, Routerï¼ˆå•é¡µé¢åº”ç”¨å¼€å‘ï¼‰, Piniaï¼ˆçŠ¶æ€ç®¡ç†ï¼‰, Vitestï¼ˆå•å…ƒæµ‹è¯•ï¼‰, ESLintï¼ˆé”™è¯¯é¢„é˜²ï¼‰, Prettierï¼ˆä»£ç æ ¼å¼åŒ–ï¼‰â”‚â—‡ æ˜¯å¦å¼•å…¥ Oxlint ä»¥åŠ å¿«æ£€æµ‹ï¼Ÿï¼ˆè¯•éªŒé˜¶æ®µï¼‰â”‚ Noæ­£åœ¨åˆå§‹åŒ–é¡¹ç›® D:\\work\\workspace\\circle-shop\\cshop-admin-front...â”‚â”” é¡¹ç›®åˆå§‹åŒ–å®Œæˆï¼Œå¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š cd cshop-admin-front yarn yarn format yarn dev| å¯é€‰ï¼šä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨é¡¹ç›®ç›®å½•ä¸­åˆå§‹åŒ– Gitï¼š git init git add -A git commit -m initial commitDone in 29.18s. æµ‹è¯•è®¡åˆ’æµ‹è¯•èŒƒå›´æµ‹è¯•ç”¨ä¾‹æ€§èƒ½æµ‹è¯•è¿ç»´è®¡åˆ’æ—¥å¿—ç®¡ç†å¼‚å¸¸å¤„ç†å¤‡ä»½ç­–ç•¥é™„å½•æœ¯è¯­è¡¨å‚è€ƒæ–‡çŒ®å¸¸è§é—®é¢˜","tags":["Javaã€å•†åŸã€åˆ†å¸ƒå¼"]},{"title":"cloud-mall-vue","path":"/2024/11/26/cloud-mall-vue/","content":"1. åˆå§‹åŒ–é¡¹ç›®1.1 æ„å»ºé¡¹ç›®npm init vue@latest jsconfig.jsoné…ç½®åˆ«åè·¯å¾„ é…ç½®åˆ«åè·¯å¾„å¯ä»¥åœ¨å†™ä»£ç æ—¶è”æƒ³æç¤ºè·¯å¾„ compilerOptions: baseUrl: ./, paths: @/*: [src/*] , exclude: [node_modules, dist] å¼•å…¥element-pluså’Œè‡ªåŠ¨å¼•å…¥æ’ä»¶ npm install element-plus --savenpm install -D unplugin-vue-components unplugin-auto-import vite.config.js // vite.config.tsimport defineConfig from viteimport AutoImport from unplugin-auto-import/viteimport Components from unplugin-vue-components/viteimport ElementPlusResolver from unplugin-vue-components/resolversexport default defineConfig( // ... plugins: [ // ... AutoImport( resolvers: [ElementPlusResolver()], ), Components( resolvers: [ElementPlusResolver()], ), ],) å®‰è£…sassä¾èµ– åŸºäºviteçš„é¡¹ç›®é»˜è®¤ä¸æ”¯æŒcssé¢„å¤„ç†å™¨ï¼Œéœ€è¦å¼€å‘è€…å•ç‹¬å®‰è£… # å®‰è£…ä¸ºå¼€å‘ä¾èµ–npm i sass -D å¼•å…¥common.scss src\\styles\\common.scss // é‡ç½®æ ·å¼* box-sizing: border-box;html height: 100%; font-size: 14px;body height: 100%; color: #333; min-width: 1240px; font: 1em/1.4 Microsoft Yahei, PingFang SC, Avenir, Segoe UI, Hiragino Sans GB, STHeiti, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif;body,ul,h1,h3,h4,p,dl,dd padding: 0; margin: 0;a text-decoration: none; color: #333; outline: none;i font-style: normal;input[type=text],input[type=search],input[type=password],input[type=checkbox] padding: 0; outline: none; border: none; -webkit-appearance: none; ::placeholder color: #ccc; img max-width: 100%; max-height: 100%; vertical-align: middle; background: #ebebeb url(@/assets/images/200.png) no-repeat center / contain;ul list-style: none;#app background: #f5f5f5; user-select: none;.container width: 1240px; margin: 0 auto; position: relative;.ellipsis white-space: nowrap; text-overflow: ellipsis; overflow: hidden;.ellipsis-2 word-break: break-all; text-overflow: ellipsis; display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 2; overflow: hidden;.fl float: left;.fr float: right;.clearfix:after content: .; display: block; visibility: hidden; height: 0; line-height: 0; clear: both;// reset element.el-breadcrumb__inner.is-link font-weight: 400 !important; src\\main.js import createApp from vueimport createPinia from piniaimport App from ./App.vueimport router from ./router// å¼•å…¥åˆå§‹åŒ–æ ·å¼æ–‡ä»¶import @/styles/common.scss... å®šä¹‰é¢œè‰²å˜é‡ src\\styles\\var.scss $mallColor: #27ba9b;$helpColor: #e26237;$sucColor: #1dc779;$warnColor: #ffb302;$priceColor: #cf4444; vite.config.js ...// https://vite.dev/config/export default defineConfig( ... resolve: alias: @: fileURLToPath(new URL(./src, import.meta.url)) , , css: preprocessorOptions: scss: // è‡ªåŠ¨å¯¼å…¥å®šåˆ¶åŒ–æ ·å¼æ–‡ä»¶è¿›è¡Œæ ·å¼è¦†ç›– // ç”¨äºåœ¨æ¯ä¸ª SCSS æ–‡ä»¶ç¼–è¯‘ä¹‹å‰ï¼Œè‡ªåŠ¨æ·»åŠ ä¸€æ®µä»£ç ã€‚ // è¡¨ç¤ºå¯¼å…¥ @/styles/var.scss æ–‡ä»¶ï¼Œå¹¶å°†å…¶ä¸­çš„å†…å®¹ä½œä¸ºå…¨å±€æ ·å¼ä½¿ç”¨ã€‚ // è¿è¡Œé¡¹ç›®ï¼Œæ‰€æœ‰çš„ SCSS æ–‡ä»¶ä¼šè‡ªåŠ¨åŠ è½½ @/styles/var.scss ä¸­çš„å†…å®¹ã€‚ // ar.scss ä¸­å®šä¹‰çš„å˜é‡ã€å‡½æ•°ã€æ··åˆç­‰å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ additionalData: ` @use @/styles/var.scss as *; `, ) å¼•å…¥aliå­—ä½“ å­—ä½“å›¾æ ‡é‡‡ç”¨çš„æ˜¯é˜¿é‡Œçš„å­—ä½“å›¾æ ‡åº“ï¼Œåœ¨ index.htmlæ–‡ä»¶ä¸­å¼•å…¥ !DOCTYPE htmlhtml lang= head meta charset=UTF-8 link rel=icon href=/favicon.ico link rel=stylesheet href=//at.alicdn.com/t/font_2143783_iq6z4ey5vu.css meta name=viewport content=width=device-width, initial-scale=1.0 titleäº‘å•†åŸ/title /head body div id=app/div script type=module src=/src/main.js/script /body/html 1.2 è‡ªåŠ¨æ ¼å¼åŒ–é…ç½®1.2.1 å®‰è£… Prettierç¡®ä¿ Prettier å®‰è£…åœ¨é¡¹ç›®ä¸­ï¼š npm install --save-dev prettier åˆ›å»º Prettier é…ç½®æ–‡ä»¶ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º .prettierrc æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š semi: false, singleQuote: true, tabWidth: 2, trailingComma: es5, arrowParens: always ä¹Ÿå¯ä»¥åˆ›å»º .prettierignore æ–‡ä»¶ï¼ŒæŒ‡å®šå¿½ç•¥çš„æ–‡ä»¶æˆ–ç›®å½•ï¼š node_modulesdist 1.2.2 å®‰è£… ESLint å’Œæ’ä»¶å¦‚æœæœªåœ¨åˆå§‹åŒ–æ—¶é€‰æ‹© ESLintï¼Œå¯ä»¥æ‰‹åŠ¨å®‰è£…ï¼š npm install --save-dev eslint eslint-plugin-vue å¦‚æœéœ€è¦ Prettier å’Œ ESLint é›†æˆï¼š npm install --save-dev eslint-config-prettier eslint-plugin-prettier é…ç½® ESLint åˆ›å»ºæˆ–ä¿®æ”¹ eslint.config.js æ–‡ä»¶ï¼Œç¡®ä¿åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š import js from @eslint/jsimport pluginVue from eslint-plugin-vueexport default [ js.configs.recommended, ...pluginVue.configs[flat/essential], name: app/files-to-lint, files: [**/*.js,mjs,jsx,vue], rules: // è‡ªå®šä¹‰è§„åˆ™ï¼šå…³é—­å¤šå•è¯ç»„ä»¶åç§°æ ¡éªŒ vue/multi-word-component-names: off, , , name: app/files-to-ignore, ignores: [**/dist/**, **/dist-ssr/**, **/coverage/**], ,] 1.2.3 é…ç½® VSCode æ ¼å¼åŒ–åœ¨ VSCode ä¸­å®‰è£…ä»¥ä¸‹æ‰©å±•ï¼š ESLint Prettier - Code Formatter åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºæˆ–ä¿®æ”¹ .vscode/settings.jsonï¼š explorer.fileNesting.enabled: true, explorer.fileNesting.patterns: tsconfig.json: tsconfig.*.json, env.d.ts, vite.config.*: jsconfig*, vitest.config.*, cypress.config.*, playwright.config.*, package.json: package-lock.json, pnpm*, .yarnrc*, yarn*, .eslint*, eslint*, .prettier*, prettier*, .editorconfig , editor.codeActionsOnSave: source.fixAll: explicit , editor.formatOnSave: true, editor.defaultFormatter: esbenp.prettier-vscode, files.autoSave: onFocusChange, [vue]: editor.defaultFormatter: esbenp.prettier-vscode , prettier.tabWidth: 2 1.3 å®‰è£…axiosnpm i axios å®˜æ–¹æ–‡æ¡£åœ°å€ï¼šhttps://axios-http.com/zh/docs/introåŸºç¡€é…ç½®é€šå¸¸åŒ…æ‹¬ï¼š å®ä¾‹åŒ– - baseURL + timeout æ‹¦æˆªå™¨ - æºå¸¦token 401æ‹¦æˆªç­‰ src\\utils\\http.js import axios from axios// åˆ›å»ºaxioså®ä¾‹const http = axios.create( baseURL: http://www.cloudmall.com, timeout: 5000)// axiosè¯·æ±‚æ‹¦æˆªå™¨http.interceptors.request.use(config = return config, e = Promise.reject(e))// axioså“åº”å¼æ‹¦æˆªå™¨http.interceptors.response.use(res = res.data, e = return Promise.reject(e))export default http 1.4 æ„å»ºåˆæ­¥è·¯ç”± src\\router\\index.js // createRouterï¼šåˆ›å»ºrouterå®ä¾‹å¯¹è±¡// createWebHistoryï¼šåˆ›å»ºhistoryæ¨¡å¼çš„è·¯ç”±import createRouter, createWebHistory from vue-routerimport Layout from @/views/Layout/index.vueconst router = createRouter( history: createWebHistory(import.meta.env.BASE_URL), // pathå’Œcomponentå¯¹åº”å…³ç³»çš„ä½ç½® routes: [ path: /, component: Layout ])export default router src\\App.vue script setup/scripttemplate !-- é…ç½®å¯¼èˆªï¼Œé…ç½®è·¯ç”±å‡ºå£(è·¯å¾„åŒ¹é…çš„ç»„ä»¶æ˜¾ç¤ºçš„ä½ç½®) -- RouterView/RouterView/templatestyle scoped/style 2. Layouté¡µ src\\views\\Layout\\components\\LayoutNav.vue script setup/scripttemplate nav class=app-topnav div class=container ul template v-if=true lia href=javascript:;i class=iconfont icon-user/iå‘¨æ°ä¼¦/a/li li el-popconfirm title=ç¡®è®¤é€€å‡ºå—? confirm-button-text=ç¡®è®¤ cancel-button-text=å–æ¶ˆ template #reference a href=javascript:;é€€å‡ºç™»å½•/a /template /el-popconfirm /li lia href=javascript:;æˆ‘çš„è®¢å•/a/li lia href=javascript:;ä¼šå‘˜ä¸­å¿ƒ/a/li /template template v-else lia href=javascript:;è¯·å…ˆç™»å½•/a/li lia href=javascript:;å¸®åŠ©ä¸­å¿ƒ/a/li lia href=javascript:;å…³äºæˆ‘ä»¬/a/li /template /ul /div /nav/templatestyle scoped lang=scss.app-topnav background: #333; ul display: flex; height: 53px; justify-content: flex-end; align-items: center; li a padding: 0 15px; color: #cdcdcd; line-height: 1; display: inline-block; i font-size: 14px; margin-right: 2px; :hover color: $mallColor; ~li a border-left: 2px solid #666; /style src\\views\\Layout\\components\\LayoutHeader.vue script setup/scripttemplate header class=app-header div class=container h1 class=logo RouterLink to=/å°å…”é²œ/RouterLink /h1 ul class=app-header-nav li class=home RouterLink to=/é¦–é¡µ/RouterLink /li li RouterLink to=/å±…å®¶/RouterLink /li li RouterLink to=/ç¾é£Ÿ/RouterLink /li li RouterLink to=/æœé¥°/RouterLink /li /ul div class=search i class=iconfont icon-search/i input type=text placeholder=æœä¸€æœ /div !-- å¤´éƒ¨è´­ç‰©è½¦ -- /div /header/templatestyle scoped lang=scss.app-header background: #fff; .container display: flex; align-items: center; .logo width: 200px; a display: block; height: 132px; width: 100%; text-indent: -9999px; background: url(@/assets/images/logo.png) no-repeat center 18px / contain; .app-header-nav width: 820px; display: flex; padding-left: 40px; position: relative; z-index: 998; li margin-right: 40px; width: 38px; text-align: center; a font-size: 16px; line-height: 32px; height: 32px; display: inline-block; :hover color: $mallColor; border-bottom: 1px solid $mallColor; .active color: $mallColor; border-bottom: 1px solid $mallColor; .search width: 170px; height: 32px; position: relative; border-bottom: 1px solid #e7e7e7; line-height: 32px; .icon-search font-size: 18px; margin-left: 5px; input width: 140px; padding-left: 5px; color: #666; .cart width: 50px; .curr height: 32px; line-height: 32px; text-align: center; position: relative; display: block; .icon-cart font-size: 22px; em font-style: normal; position: absolute; right: 0; top: 0; padding: 1px 6px; line-height: 1; background: $helpColor; color: #fff; font-size: 12px; border-radius: 10px; font-family: Arial; /style src\\views\\Layout\\components\\LayoutFooter.vue template footer class=app_footer !-- è”ç³»æˆ‘ä»¬ -- div class=contact div class=container dl dtå®¢æˆ·æœåŠ¡/dt ddi class=iconfont icon-kefu/i åœ¨çº¿å®¢æœ/dd ddi class=iconfont icon-question/i é—®é¢˜åé¦ˆ/dd /dl dl dtå…³æ³¨æˆ‘ä»¬/dt ddi class=iconfont icon-weixin/i å…¬ä¼—å·/dd ddi class=iconfont icon-weibo/i å¾®åš/dd /dl dl dtä¸‹è½½APP/dt dd class=qrcodeimg src=@/assets/images/qrcode.jpg //dd dd class=download spanæ‰«æäºŒç»´ç /span spanç«‹é©¬ä¸‹è½½APP/span a href=javascript:;ä¸‹è½½é¡µé¢/a /dd /dl dl dtæœåŠ¡çƒ­çº¿/dt dd class=hotline400-0000-000 smallå‘¨ä¸€è‡³å‘¨æ—¥ 8:00-18:00/small/dd /dl /div /div !-- å…¶å®ƒ -- div class=extra div class=container div class=slogan a href=javascript:; i class=iconfont icon-footer01/i spanä»·æ ¼äº²æ°‘/span /a a href=javascript:; i class=iconfont icon-footer02/i spanç‰©æµå¿«æ·/span /a a href=javascript:; i class=iconfont icon-footer03/i spanå“è´¨æ–°é²œ/span /a /div !-- ç‰ˆæƒä¿¡æ¯ -- div class=copyright p a href=javascript:;å…³äºæˆ‘ä»¬/a a href=javascript:;å¸®åŠ©ä¸­å¿ƒ/a a href=javascript:;å”®åæœåŠ¡/a a href=javascript:;é…é€ä¸éªŒæ”¶/a a href=javascript:;å•†åŠ¡åˆä½œ/a a href=javascript:;æœç´¢æ¨è/a a href=javascript:;å‹æƒ…é“¾æ¥/a /p pCopyRight Â© å°å…”é²œå„¿/p /div /div /div /footer /template style scoped lang=scss .app_footer overflow: hidden; background-color: #f5f5f5; padding-top: 20px; .contact background: #fff; .container padding: 60px 0 40px 25px; display: flex; dl height: 190px; text-align: center; padding: 0 72px; border-right: 1px solid #f2f2f2; color: #999; :first-child padding-left: 0; :last-child border-right: none; padding-right: 0; dt line-height: 1; font-size: 18px; dd margin: 36px 12px 0 0; float: left; width: 92px; height: 92px; padding-top: 10px; border: 1px solid #ededed; .iconfont font-size: 36px; display: block; color: #666; :hover .iconfont color: $mallColor; :last-child margin-right: 0; .qrcode width: 92px; height: 92px; padding: 7px; border: 1px solid #ededed; .download padding-top: 5px; font-size: 14px; width: auto; height: auto; border: none; span display: block; a display: block; line-height: 1; padding: 10px 25px; margin-top: 5px; color: #fff; border-radius: 2px; background-color: $mallColor; .hotline padding-top: 20px; font-size: 22px; color: #666; width: auto; height: auto; border: none; small display: block; font-size: 15px; color: #999; .extra background-color: #333; .slogan height: 178px; line-height: 58px; padding: 60px 100px; border-bottom: 1px solid #434343; display: flex; justify-content: space-between; a height: 58px; line-height: 58px; color: #fff; font-size: 28px; i font-size: 50px; vertical-align: middle; margin-right: 10px; font-weight: 100; span vertical-align: middle; text-shadow: 0 0 1px #333; .copyright height: 170px; padding-top: 40px; text-align: center; color: #999; font-size: 15px; p line-height: 1; margin-bottom: 20px; a color: #999; line-height: 1; padding: 0 10px; border-right: 1px solid #999; :last-child border-right: none; /style src\\views\\Layout\\index.vue script setupimport LayoutNav from ./components/LayoutNav.vueimport LayoutHeader from ./components/LayoutHeader.vueimport LayoutFooter from ./components/LayoutFooter.vue/scripttemplate LayoutNav / LayoutHeader / !-- äºŒçº§è·¯ç”± -- RouterView / LayoutFooter //template å®Œæˆåç›®æ ‡å¦‚å›¾ï¼š 3. ä¸€çº§å¯¼èˆª 3.1 åŠ¨æ€æ•°æ®æ¸²æŸ“è·å–åˆ†ç±»API src\\apis\\layout.js // è·å–ä¸€çº§åˆ†ç±»export function getCategoryAPI () return http( url: /home/category/head ) æ¸²æŸ“æ•°æ® src\\views\\Layout\\components\\LayoutHeader.vue script setupimport ref, onMounted from vueimport getCategoryAPI from @/apis/layoutconst categoryList = ref([])const getCategory = async () = const res = await getCategoryAPI() categoryList.value = res.resultonMounted(()=getCategory())/scripttemplate header class=app-header div class=container h1 class=logo RouterLink to=/å°å…”é²œ/RouterLink /h1 !-- æ¸²æŸ“ä¸€çº§åˆ†ç±»æ•°æ® -- ul class=app-header-nav li class=home v-for=item in categoryList :key=item.id RouterLink to=/item.name/RouterLink /li /ul div class=search i class=iconfont icon-search/i input type=text placeholder=æœä¸€æœ /div !-- å¤´éƒ¨è´­ç‰©è½¦ -- /div /header/template 3.2 å¸é¡¶å¯¼èˆªäº¤äº’å®ç°3.2.1 åŸºç¡€ä»£ç  src\\views\\Layout\\components\\LayoutFixed.vue script setupimport ref, onMounted from vueimport getCategoryAPI from @/apis/layoutconst categoryList = ref([])const getCategory = async () = const res = await getCategoryAPI() categoryList.value = res.resultonMounted(()=getCategory())/scripttemplate div class=app-header-sticky div class=container RouterLink class=logo to=/ / !-- å¯¼èˆªåŒºåŸŸ -- ul class=app-header-nav li class=home v-for=item in categoryList :key=item.id RouterLink to=/item.name/RouterLink /li /ul div class=right RouterLink to=/å“ç‰Œ/RouterLink RouterLink to=/ä¸“é¢˜/RouterLink /div /div /div/templatestyle scoped lang=scss.app-header-sticky width: 100%; height: 80px; position: fixed; left: 0; top: 0; z-index: 999; background-color: #fff; border-bottom: 1px solid #e4e4e4; // æ­¤å¤„ä¸ºå…³é”®æ ·å¼!!! // çŠ¶æ€ä¸€ï¼šå¾€ä¸Šå¹³ç§»è‡ªèº«é«˜åº¦ + å®Œå…¨é€æ˜ transform: translateY(-100%); opacity: 0; // çŠ¶æ€äºŒï¼šç§»é™¤å¹³ç§» + å®Œå…¨ä¸é€æ˜ .show transition: all 0.3s linear; transform: none; opacity: 1; .container display: flex; align-items: center; .logo width: 200px; height: 80px; background: url(@/assets/images/logo.png) no-repeat right 2px; background-size: 160px auto; .right width: 220px; display: flex; text-align: center; padding-left: 40px; border-left: 2px solid $mallColor; a width: 38px; margin-right: 40px; font-size: 16px; line-height: 1; :hover color: $mallColor; .app-header-nav width: 820px; display: flex; padding-left: 40px; position: relative; z-index: 998; li margin-right: 40px; width: 38px; text-align: center; a font-size: 16px; line-height: 32px; height: 32px; display: inline-block; :hover color: $mallColor; border-bottom: 1px solid $mallColor; .active color: $mallColor; border-bottom: 1px solid $mallColor; /style 3.2.2 å®ç°å¸é¡¶äº¤äº’ æ ¸å¿ƒé€»è¾‘ï¼šæ ¹æ®æ»šåŠ¨è·ç¦»åˆ¤æ–­å½“å‰showç±»åæ˜¯å¦æ˜¾ç¤ºï¼Œå¤§äº78æ˜¾ç¤ºï¼Œå°äº78ï¼Œä¸æ˜¾ç¤º // https://vueuse.org/guide/npm i @vueuse/core script setup// vueUseimport useScroll from @vueuse/coreimport ref, onMounted from vueimport getCategoryAPI from @/apis/layout// useScroll// https://vueuse.org/core/useScroll/#usescroll// è·å–çª—å£ y è½´ç§»åŠ¨è·ç¦»const y = useScroll(window)const categoryList = ref([])const getCategory = async () = const res = await getCategoryAPI() categoryList.value = res.resultonMounted(()=getCategory())/scripttemplate div class=app-header-sticky :class= show: y 78 !-- ç§»åŠ¨è·ç¦»å¤§äº 78 æ—¶æ˜¾ç¤ºå¸é¡¶å¯¼èˆª -- div class=container RouterLink class=logo to=/ / !-- å¯¼èˆªåŒºåŸŸ -- ul class=app-header-nav li class=home v-for=item in categoryList :key=item.id RouterLink to=/item.name/RouterLink /li /ul div class=right RouterLink to=/å“ç‰Œ/RouterLink RouterLink to=/ä¸“é¢˜/RouterLink /div /div /div/template... 3.3 ä¼˜åŒ–é‡å¤è¯·æ±‚ åœ¨åŠ è½½é¦–é¡µæ—¶ LayoutHeader.vue å’Œ LayoutFixed.vue éƒ½å‘é€äº†è·å–åˆ†ç±»æ•°æ®è¯·æ±‚ã€‚ç„¶è€Œåˆ†ç±»æ•°æ®æ˜¯å›ºå®šçš„ä¸éœ€è¦åˆ†å¼€å‘é€ä¸¤æ¬¡è¯·æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ pinia å­˜å‚¨åˆ†ç±»æ•°æ®ï¼Œä¼˜åŒ–é‡å¤è¯·æ±‚ã€‚ 3.3.1 å®šä¹‰åˆ†ç±» sotre src\\stores\\categoryStore.js // å¼•å…¥defineStoreç”¨äºåˆ›å»ºstoreimport defineStore from piniaimport ref from vueimport getCategoryAPI from @/apis/layout// å®šä¹‰å¹¶æš´éœ²ä¸€ä¸ªstoreexport const useCategoryStore = defineStore(category,() = // å¯¼èˆªåˆ—è¡¨çš„æ•°æ®ç®¡ç† // state å¯¼èˆªåˆ—è¡¨æ•°æ® const categoryList = ref([]) // action è·å–å¯¼èˆªæ•°æ®çš„æ–¹æ³• const getCategory = async () = const res = await getCategoryAPI() categoryList.value = res.result return categoryList, getCategory ) 3.3.2 åŠ è½½åˆ†ç±»æ•°æ® src\\views\\Layout\\index.vue script setup...import useCategoryStore from @/stores/categoryStoreimport onMounted from vue// è§¦å‘è·å–å¯¼èˆªåˆ†ç±»æ•°æ® actionconst categoryStore = useCategoryStore()onMounted(() = categoryStore.getCategory())/scripttemplate .../template 3.3.3 ä»piniaä¸­è·å–æ•°æ®æ¸²æŸ“ src\\views\\Layout\\components\\LayoutFixed.vue script setup// vueUseimport useScroll from @vueuse/coreimport useCategoryStore from @/stores/categoryStore;// vueuseconst y = useScroll(window)const categoryStore = useCategoryStore()/scripttemplate div class=app-header-sticky :class= show: y 78 !-- ç§»åŠ¨è·ç¦»å¤§äº 78 æ—¶æ˜¾ç¤ºå¸é¡¶å¯¼èˆª -- div class=container RouterLink class=logo to=/ / !-- å¯¼èˆªåŒºåŸŸ -- ul class=app-header-nav li class=home v-for=item in categoryStore.categoryList :key=item.id !-- ä» pinia ä¸­è·å–æ•°æ®æ¸²æŸ“ -- RouterLink to=/item.name/RouterLink /li /ul div class=right RouterLink to=/å“ç‰Œ/RouterLink RouterLink to=/ä¸“é¢˜/RouterLink /div /div /div/template src\\views\\Layout\\components\\LayoutHeader.vue script setupimport useCategoryStore from @/stores/categoryStore;const categoryStore = useCategoryStore()/scripttemplate header class=app-header div class=container h1 class=logo RouterLink to=/å°å…”é²œ/RouterLink /h1 ul class=app-header-nav !-- æ¸²æŸ“ä¸€çº§åˆ†ç±»æ•°æ® -- !-- ä» pinia ä¸­è·å–æ•°æ®æ¸²æŸ“ -- li class=home v-for=item in categoryStore.categoryList :key=item.id RouterLink to=/item.name/RouterLink /li /ul div class=search i class=iconfont icon-search/i input type=text placeholder=æœä¸€æœ /div !-- å¤´éƒ¨è´­ç‰©è½¦ -- /div /header/template 3.3.4 ä¼˜åŒ–ç»“æœ 4. HOMEé¡µ4.1 æ•´ä½“ç»“æ„åˆ›å»º 1- æŒ‰ç…§ç»“æ„æ–°å¢äº”ä¸ªç»„ä»¶ï¼Œå‡†å¤‡æœ€ç®€å•çš„æ¨¡ç‰ˆï¼Œåˆ†åˆ«åœ¨Homeæ¨¡å—çš„å…¥å£ç»„ä»¶ä¸­å¼•å…¥ src\\views\\Home\\components\\HomeCategory.vue HomeCategory HomeBanner HomeNew HomeHot HomeProduct script setup/scripttemplate div HomeCategory /div/template 2- Homeæ¨¡å—å…¥å£ç»„ä»¶ä¸­å¼•å…¥å¹¶æ¸²æŸ“ script setupimport HomeCategory from ./components/HomeCategory.vueimport HomeBanner from ./components/HomeBanner.vueimport HomeNew from ./components/HomeNew.vueimport HomeHot from ./components/HomeHot.vueimport homeProduct from ./components/HomeProduct.vue/scripttemplate div class=container HomeCategory / HomeBanner / /div HomeNew / HomeHot / homeProduct //template 4.2 åˆ†ç±»4.2.1 é™æ€ä»£ç  src\\views\\Home\\components\\HomeCategory.vue script setup/scripttemplate div class=home-category ul class=menu li v-for=item in 9 :key=item RouterLink to=/å±…å®¶/RouterLink RouterLink v-for=i in 2 :key=i to=/å—åŒ—å¹²è´§/RouterLink !-- å¼¹å±‚layerä½ç½® -- div class=layer h4åˆ†ç±»æ¨è smallæ ¹æ®æ‚¨çš„è´­ä¹°æˆ–æµè§ˆè®°å½•æ¨è/small/h4 ul li v-for=i in 5 :key=i RouterLink to=/ img alt= / div class=info p class=name ellipsis-2 ç”·å£«å¤–å¥— /p p class=desc ellipsisç”·å£«å¤–å¥—ï¼Œå†¬å­£å¿…é€‰/p p class=priceiÂ¥/i200.00/p /div /RouterLink /li /ul /div /li /ul /div/templatestyle scoped lang=scss.home-category width: 250px; height: 500px; background: rgba(0, 0, 0, 0.8); position: relative; z-index: 99; .menu li padding-left: 40px; height: 55px; line-height: 55px; :hover background: $xtxColor; a margin-right: 4px; color: #fff; :first-child font-size: 16px; .layer width: 990px; height: 500px; background: rgba(255, 255, 255, 0.8); position: absolute; left: 250px; top: 0; display: none; padding: 0 15px; h4 font-size: 20px; font-weight: normal; line-height: 80px; small font-size: 16px; color: #666; ul display: flex; flex-wrap: wrap; li width: 310px; height: 120px; margin-right: 15px; margin-bottom: 15px; border: 1px solid #eee; border-radius: 4px; background: #fff; :nth-child(3n) margin-right: 0; a display: flex; width: 100%; height: 100%; align-items: center; padding: 10px; :hover background: #e3f9f4; img width: 95px; height: 95px; .info padding-left: 10px; line-height: 24px; overflow: hidden; .name font-size: 16px; color: #666; .desc color: #999; .price font-size: 22px; color: $priceColor; i font-size: 16px; // å…³é”®æ ·å¼ hoverçŠ¶æ€ä¸‹çš„layerç›’å­å˜æˆblock :hover .layer display: block; /style 4.2.2 åŠ¨æ€æ¸²æŸ“ src\\views\\Home\\components\\HomeCategory.vue script setupimport useCategoryStore from @/stores/categoryStoreconst categoryStore = useCategoryStore()/scripttemplate div class=home-category ul class=menu li v-for=item in categoryStore.categoryList :key=item.id RouterLink to=/ item.name /RouterLink RouterLink v-for=i in item.children.slice(0, 2) :key=i to=/ i.name /RouterLink !-- å¼¹å±‚layerä½ç½® -- div class=layer h4åˆ†ç±»æ¨è smallæ ¹æ®æ‚¨çš„è´­ä¹°æˆ–æµè§ˆè®°å½•æ¨è/small/h4 ul li v-for=i in item.goods :key=i.id RouterLink to=/ img alt= / div class=info p class=name ellipsis-2 i.name /p p class=desc ellipsis i.desc /p p class=priceiÂ¥/i i.price /p /div /RouterLink /li /ul /div /li /ul /div/template 4.3 Bannerå›¾4.3.1 é™æ€ä»£ç  src\\views\\Home\\components\\HomeBanner.vue script setup/scripttemplate div class=home-banner el-carousel height=500px el-carousel-item v-for=item in 4 :key=item img src=http://yjy-xiaotuxian-dev.oss-cn-beijing.aliyuncs.com/picture/2021-04-15/6d202d8e-bb47-4f92-9523-f32ab65754f4.jpg alt= /el-carousel-item /el-carousel /div/templatestyle scoped lang=scss.home-banner width: 1240px; height: 500px; position: absolute; left: 0; top: 0; z-index: 98; img width: 100%; height: 500px; /style 4.3.2 API src\\apis\\home.js import http from @/utils/http// è·å– banner å›¾export function getBannerAPI() return http.request( url: home/banner, ) 4.3.3 æ¸²æŸ“æ•°æ®script setupimport onMounted, ref from vueimport getBannerAPI from @/apis/homeconst bannerList = ref([])const getBanner = async () = const res = await getBannerAPI() bannerList.value = res.resultonMounted(() = getBanner())/scripttemplate div class=home-banner el-carousel height=500px autoplay el-carousel-item v-for=item in bannerList :key=item.id img :src=item.imgUrl alt= / /el-carousel-item /el-carousel /div/template 4.4 å°è£…é¢æ¿ç»„ä»¶ æ–°é²œå¥½ç‰©å’Œäººæ°”æ¨èæ¨¡å—ï¼Œåœ¨ç»“æ„ä¸Šéå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯å†…å®¹ä¸åŒï¼Œé€šè¿‡ç»„ä»¶å°è£…å¯ä»¥å®ç°å¤ç”¨ç»“æ„çš„æ•ˆæœã€‚ æ ¸å¿ƒæ€è·¯ï¼šæŠŠå¯å¤ç”¨çš„ç»“æ„åªå†™ä¸€æ¬¡ï¼ŒæŠŠå¯èƒ½å‘ç”Ÿå˜åŒ–çš„éƒ¨åˆ†æŠ½è±¡æˆç»„ä»¶å‚æ•°ï¼ˆprops æ’æ§½ï¼‰ 4.4.1 å®Œæ•´ä»£ç  src\\views\\Home\\components\\HomePanel.vue script setupdefineProps( titile: type: String, default: , subTitle: type: String, default: ,)/scripttemplate div class=home-panel div class=container div class=head !-- ä¸»æ ‡é¢˜å’Œå‰¯æ ‡é¢˜ -- h3 titile small subTitle /small /h3 /div !-- ä¸»ä½“å†…å®¹åŒºåŸŸ(å…·åæ’æ§½) -- slot name=main/slot /div /div/templatestyle scoped lang=scss.home-panel background-color: #fff; .head padding: 40px 0; display: flex; align-items: flex-end; h3 flex: 1; font-size: 32px; font-weight: normal; margin-left: 6px; height: 35px; line-height: 35px; small font-size: 16px; color: #999; margin-left: 20px; /style 4.5 æ–°é²œå¥½ç‰©4.5.1 é™æ€ä»£ç  src\\views\\Home\\components\\HomeNew.vue script setupimport HomePanel from ./HomePanel.vue/scripttemplate HomePanel titile=æ–°é²œå¥½ç‰© sub-title=æ–°é²œå‡ºç‚‰ å“è´¨é è°± template #main ul class=goods-list li v-for= :key=item.id RouterLink to=/ img :src=item.picture alt= / p class=name item.name /p p class=priceyen; item.price /p /RouterLink /li /ul /template /HomePanel/templatestyle scoped lang=scss.goods-list display: flex; justify-content: space-between; height: 406px; li width: 306px; height: 406px; background: #f0f9f4; transition: all 0.5s; :hover transform: translate3d(0, -3px, 0); box-shadow: 0 3px 8px rgb(0 0 0 / 20%); img width: 306px; height: 306px; p font-size: 22px; padding-top: 12px; text-align: center; text-overflow: ellipsis; overflow: hidden; white-space: nowrap; .price color: $priceColor; /style 4.5.2 API src\\apis\\home.js // è·å–æ–°é²œå¥½ç‰©export const getNewAPI = () = return http( url: /home/new, ) 4.5.3 åŠ¨æ€æ¸²æŸ“ src\\views\\Home\\components\\HomeNew.vue script setupimport ref from vueimport HomePanel from ./HomePanel.vueimport getNewAPI from @/apis/homeconst newList = ref([])const getNewList = async () = const res = await getNewAPI() newList.value = res.resultgetNewList()/scripttemplate HomePanel titile=æ–°é²œå¥½ç‰© sub-title=æ–°é²œå‡ºç‚‰ å“è´¨é è°± template #main ul class=goods-list li v-for=item in newList :key=item.id RouterLink to=/ img :src=item.picture alt= / p class=name item.name /p p class=priceyen; item.price /p /RouterLink /li /ul /template /HomePanel/template 4.6 äººæ°”æ¨è4.6.1 é™æ€ä»£ç  src\\views\\Home\\components\\HomeHot.vue script setupimport HomePanel from ./HomePanel.vue/scripttemplate HomePanel titile=äººæ°”æ¨è sub-title=äººæ°”çˆ†æ¬¾ ä¸å®¹é”™è¿‡ template #main ul class=goods-list li v-for=item in hotList :key=item.id RouterLink to=/ img :src=item.picture alt= / p class=name item.name /p p class=desc item.alt /p /RouterLink /li /ul /template /HomePanel/templatestyle scoped lang=scss.goods-list display: flex; justify-content: space-between; height: 406px; li width: 306px; height: 406px; background: #f0f9f4; transition: all 0.5s; :hover transform: translate3d(0, -3px, 0); box-shadow: 0 3px 8px rgb(0 0 0 / 20%); img width: 306px; height: 306px; p font-size: 22px; padding-top: 12px; text-align: center; text-overflow: ellipsis; overflow: hidden; white-space: nowrap; .price color: $priceColor; /style 4.6.2 API src\\apis\\home.js // è·å–äººæ°”æ¨èexport const getHotAPI = () = return http(home/hot) 4.6.3 åŠ¨æ€æ¸²æŸ“script setupimport ref from vueimport HomePanel from ./HomePanel.vueimport getHotAPI from @/apis/homeconst hotList = ref([])const getHotList = async () = const res = await getHotAPI() hotList.value = res.resultgetHotList()/scripttemplate HomePanel titile=äººæ°”æ¨è sub-title=äººæ°”çˆ†æ¬¾ ä¸å®¹é”™è¿‡ template #main ul class=goods-list li v-for=item in hotList :key=item.id RouterLink to=/ img :src=item.picture alt= / p class=name item.name /p p class=desc item.alt /p /RouterLink /li /ul /template /HomePanel/template 4.7 å›¾ç‰‡åŠ è½½é—®é¢˜ åœºæ™¯ï¼šç”µå•†ç½‘ç«™çš„é¦–é¡µé€šå¸¸ä¼šå¾ˆé•¿ï¼Œç”¨æˆ·ä¸ä¸€å®šèƒ½è®¿é—®åˆ°é¡µé¢é ä¸‹é¢çš„å›¾ç‰‡ï¼Œè¿™ç±»å›¾ç‰‡é€šè¿‡æ‡’åŠ è½½ä¼˜åŒ–æ‰‹æ®µå¯ä»¥åšåˆ° 4.7.1 è‡ªå®šä¹‰æŒ‡ä»¤https://cn.vuejs.org/guide/reusability/custom-directives.html#usage-on-components https://vueuse.org/core/useIntersectionObserver/ æ ¸å¿ƒåŸç†ï¼šå›¾ç‰‡è¿›å…¥è§†å£æ‰å‘é€èµ„æºè¯·æ±‚ src\\main.js import App from ./App.vueimport useIntersectionObserver from @vueuse/coreconst app = createApp(App)app.directive(img-lazy, mounted(el, binding) // el:æŒ‡ä»¤ç»‘å®šçš„å…ƒç´  img // binding: binding.value ç­‰äºæŒ‡ä»¤åé¢ç»‘å®šçš„è¡¨è¾¾å¼ å›¾ç‰‡url // useIntersectionObserver è§†å›¾çª—å£æ’ä»¶ï¼Œå½“è¿›å…¥è§†å£æ—¶ isIntersecting = true const stop = useIntersectionObserver(el, ([ isIntersecting ]) = if (isIntersecting) el.src = binding.value // åœ¨ç›‘å¬çš„å›¾ç‰‡ç¬¬ä¸€æ¬¡å®ŒæˆåŠ è½½ä¹‹åå°±åœæ­¢ç›‘å¬ stop() ) ,) ä¿®æ”¹ä¸ºè‡ªå®šä¹‰æŒ‡ä»¤ src\\views\\Home\\components\\HomeNew.vue template HomePanel titile=æ–°é²œå¥½ç‰© sub-title=æ–°é²œå‡ºç‚‰ å“è´¨é è°± template #main ul class=goods-list li v-for=item in newList :key=item.id RouterLink to=/ !-- ä½¿ç”¨è‡ªå®šä¹‰æŒ‡ä»¤ -- img v-img-lazy=item.picture alt= / p class=name item.name /p p class=priceyen; item.price /p /RouterLink /li /ul /template /HomePanel/template src\\views\\Home\\components\\HomeHot.vue template HomePanel titile=äººæ°”æ¨è sub-title=äººæ°”çˆ†æ¬¾ ä¸å®¹é”™è¿‡ template #main ul class=goods-list li v-for=item in hotList :key=item.id RouterLink to=/ !-- ä½¿ç”¨è‡ªå®šä¹‰æŒ‡ä»¤ -- img v-img-lazy=item.picture alt= / p class=name item.name /p p class=desc item.alt /p /RouterLink /li /ul /template /HomePanel/template 4.7.2 ä¼˜åŒ–æŒ‡ä»¤æ‡’åŠ è½½æŒ‡ä»¤çš„é€»è¾‘ç›´æ¥å†™åˆ°å…¥å£æ–‡ä»¶ä¸­ï¼Œä¸åˆç†ã€‚å…¥å£æ–‡ä»¶é€šå¸¸åªåšä¸€äº›åˆå§‹åŒ–çš„äº‹æƒ…ï¼Œä¸åº”è¯¥åŒ…å«å¤ªå¤šçš„é€»è¾‘ä»£ç ï¼Œå¯ä»¥é€šè¿‡æ’ä»¶çš„æ–¹æ³•æŠŠæ‡’åŠ è½½æŒ‡ä»¤å°è£…ä¸ºæ’ä»¶ï¼Œmain.js å…¥å£æ–‡ä»¶åªéœ€è¦è´Ÿè´£æ³¨å†Œæ’ä»¶å³å¯ã€‚ https://cn.vuejs.org/guide/reusability/plugins.html src\\directives\\index.js import useIntersectionObserver from @vueuse/coreexport const imgLazyPlugin = install: (app) = app.directive(img-lazy, mounted(el, binding) // el:æŒ‡ä»¤ç»‘å®šçš„å…ƒç´  img // binding: binding.value ç­‰äºæŒ‡ä»¤åé¢ç»‘å®šçš„è¡¨è¾¾å¼ å›¾ç‰‡url const stop = useIntersectionObserver(el, ([ isIntersecting ]) = if (isIntersecting) el.src = binding.value // åœ¨ç›‘å¬çš„å›¾ç‰‡ç¬¬ä¸€æ¬¡å®ŒæˆåŠ è½½ä¹‹åå°±åœæ­¢ç›‘å¬ stop() ) , ) , src\\main.js import App from ./App.vueimport imgLazyPlugin from @/directivesconst app = createApp(App)app.use(imgLazyPlugin) 4.8 Productäº§å“åˆ—è¡¨4.8.1 é™æ€ä»£ç  src\\views\\Home\\components\\HomeProduct.vue script setupimport HomePanel from ./HomePanel.vue/scripttemplate div class=home-product HomePanel :title=cate.name v-for=cate in goodsList :key=cate.id template #main div class=box RouterLink class=cover to=/ img v-img-lazy=cate.picture / strong class=label span cate.name é¦†/span span cate.saleInfo /span /strong /RouterLink ul class=goods-list li v-for=goods in cate.goods :key=goods.id RouterLink to=/ class=goods-item img v-img-lazy=good.picture alt= / p class=name ellipsis good.name /p p class=desc ellipsis good.desc /p p class=priceyen; good.price /p /RouterLink /li /ul /div /template /HomePanel /div/templatestyle scoped lang=scss.home-product background: #fff; margin-top: 20px; .sub margin-bottom: 2px; a padding: 2px 12px; font-size: 16px; border-radius: 4px; :hover background: $mallColor; color: #fff; :last-child margin-right: 80px; .box display: flex; .cover width: 240px; height: 610px; margin-right: 10px; position: relative; img width: 100%; height: 100%; .label width: 188px; height: 66px; display: flex; font-size: 18px; color: #fff; line-height: 66px; font-weight: normal; position: absolute; left: 0; top: 50%; transform: translate3d(0, -50%, 0); span text-align: center; :first-child width: 76px; background: rgba(0, 0, 0, 0.9); :last-child flex: 1; background: rgba(0, 0, 0, 0.7); .goods-list width: 990px; display: flex; flex-wrap: wrap; li width: 240px; height: 300px; margin-right: 10px; margin-bottom: 10px; :nth-last-child(-n + 4) margin-bottom: 0; :nth-child(4n) margin-right: 0; .goods-item display: block; width: 220px; padding: 20px 30px; text-align: center; transition: all 0.5s; :hover transform: translate3d(0, -3px, 0); box-shadow: 0 3px 8px rgb(0 0 0 / 20%); img width: 160px; height: 160px; p padding-top: 10px; .name font-size: 16px; .desc color: #999; height: 29px; .price color: $priceColor; font-size: 20px; /style 4.8.2 API src\\apis\\home.js // è·å–äº§å“åˆ—è¡¨export const getGoodsAPI = () = return http(/home/goods) 4.8.3 åŠ¨æ€æ¸²æŸ“ src\\views\\Home\\components\\HomeProduct.vue script setupimport HomePanel from ./HomePanel.vueimport GoodItem from ./GoodItem.vueimport getGoodsAPI from @/apis/homeimport onMounted, ref from vueconst goodsList = ref([])const getGoodsList = async () = const res = await getGoodsAPI() goodsList.value = res.resultonMounted(() = getGoodsList())/scripttemplate div class=home-product HomePanel :title=cate.name v-for=cate in goodsList :key=cate.id template #main div class=box RouterLink class=cover to=/ img v-img-lazy=cate.picture / strong class=label span cate.name é¦†/span span cate.saleInfo /span /strong /RouterLink ul class=goods-list li v-for=goods in cate.goods :key=goods.id RouterLink to=/ class=goods-item img v-img-lazy=good.picture alt= / p class=name ellipsis good.name /p p class=desc ellipsis good.desc /p p class=priceyen; good.price /p /RouterLink /li /ul /div /template /HomePanel /div/template 4.8.4 GoodItemå°è£… åœ¨é¡¹ç›®çš„å¾ˆå¤šä¸ªä¸šåŠ¡æ¨¡å—ä¸­éƒ½éœ€è¦ç”¨åˆ°åŒæ ·çš„å•†å“å±•ç¤ºæ¨¡å—ï¼Œæ²¡å¿…è¦é‡å¤å®šä¹‰ï¼Œå°è£…èµ·æ¥ï¼Œæ–¹ä¾¿å¤ç”¨ã€‚ src\\views\\Home\\components\\GoodItem.vue script setupdefineProps( goods: type: Object, default: () = , ,)/scripttemplate RouterLink to=/ class=goods-item img v-img-lazy=goods.picture alt= / p class=name ellipsis goods.name /p p class=desc ellipsis goods.desc /p p class=priceyen; goods.price /p /RouterLink/templatestyle scoped lang=scss.goods-item display: block; width: 220px; padding: 20px 30px; text-align: center; transition: all 0.5s; :hover transform: translate3d(0, -3px, 0); box-shadow: 0 3px 8px rgb(0 0 0 / 20%); img width: 160px; height: 160px; p padding-top: 10px; .name font-size: 16px; .desc color: #999; height: 29px; .price color: $priceColor; font-size: 20px; /style ä½¿ç”¨ src\\views\\Home\\components\\HomeProduct.vue script setup.../scripttemplate div class=home-product HomePanel :title=cate.name v-for=cate in goodsList :key=cate.id template #main div class=box RouterLink class=cover to=/ img v-img-lazy=cate.picture / strong class=label span cate.name é¦†/span span cate.saleInfo /span /strong /RouterLink ul class=goods-list li v-for=goods in cate.goods :key=goods.id !-- ä½¿ç”¨ GoodItem ç»„ä»¶ -- GoodItem :goods=goods / /li /ul /div /template /HomePanel /div/template 5. ä¸€çº§åˆ†ç±»5.1 åˆ†ç±»é¡µ 5.1.1 é™æ€ä»£ç  src\\views\\Category\\index.vue script setup/scripttemplate div class=top-category åˆ†ç±» /div/templatestyle scoped lang=scss.top-category h3 font-size: 28px; color: #666; font-weight: normal; text-align: center; line-height: 100px; .sub-list margin-top: 20px; background-color: #fff; ul display: flex; padding: 0 32px; flex-wrap: wrap; li width: 168px; height: 160px; a text-align: center; display: block; font-size: 16px; img width: 100px; height: 100px; p line-height: 40px; :hover color: $mallColor; .ref-goods background-color: #fff; margin-top: 20px; position: relative; .head .xtx-more position: absolute; top: 20px; right: 20px; .tag text-align: center; color: #999; font-size: 20px; position: relative; top: -20px; .body display: flex; justify-content: space-around; padding: 0 40px 30px; .bread-container padding: 25px 0; /style 5.1.2 é…ç½®è·¯ç”± src\\router\\index.js import Category from @/views/Category/index.vueconst router = createRouter( history: createWebHistory(import.meta.env.BASE_URL), // pathå’Œcomponentå¯¹åº”å…³ç³»çš„ä½ç½® routes: [ path: /, component: Layout, children: [ path: , component: Home, , // é…ç½®åˆ†ç±»è·¯ç”±ï¼Œä½¿ç”¨åŠ¨æ€è·¯ç”±ä¼ é€’åˆ†ç±»id path: /category/:id, name: category, component: Category, , ], , path: /login, component: Login, , ],)export default router 5.1.3 é…ç½®è·¯ç”±è·³è½¬ src\\views\\Layout\\components\\LayoutHeader.vue script setupimport useCategoryStore from @/stores/categoryStoreconst categoryStore = useCategoryStore()/scripttemplate header class=app-header div class=container h1 class=logo RouterLink to=/å°å…”é²œ/RouterLink /h1 ul class=app-header-nav !-- æ¸²æŸ“ä¸€çº§åˆ†ç±»æ•°æ® -- li class=home v-for=item in categoryStore.categoryList :key=item.id !-- é…ç½®åˆ†ç±»è·¯ç”±è·³è½¬ -- RouterLink active-class=active :to=`/category/$item.id` item.name /RouterLink /li /ul ... /div /header/template 5.2 é¢åŒ…å±‘å¯¼èˆª5.2.1 é™æ€ä»£ç  src\\views\\Category\\index.vue script setup/scripttemplate div class=top-category div class=container m-top-20 !-- é¢åŒ…å±‘ -- div class=bread-container el-breadcrumb separator= el-breadcrumb-item :to= path: / é¦–é¡µ/el-breadcrumb-item el-breadcrumb-item topCategory.name /el-breadcrumb-item /el-breadcrumb /div /div /div/template 5.2.2 API src\\apis\\category.js import http from @/utils/http/** * @description: è·å–åˆ†ç±»æ•°æ® * @param * id åˆ†ç±»id * @return * */export const getTopCategoryAPI = (id) = return http( url: /category, params: id, , ) 5.2.3 åŠ¨æ€æ¸²æŸ“ src\\views\\Category\\index.vue script setupimport ref from vueimport getTopCategoryAPI from @/apis/categoryimport useRoute from vue-routerconst topCategory = ref()const getTopCategory = async (id) = const res = await getTopCategoryAPI(id) topCategory.value = res.resultconst route = useRoute()getTopCategory(route.params.id)/scripttemplate div class=top-category div class=container m-top-20 !-- é¢åŒ…å±‘ -- div class=bread-container el-breadcrumb separator= el-breadcrumb-item :to= path: / é¦–é¡µ/el-breadcrumb-item el-breadcrumb-item topCategory.name /el-breadcrumb-item /el-breadcrumb /div /div /div/template 5.2.4 ç»„ä»¶å¤ç”¨é—®é¢˜ é—®é¢˜ï¼šä¸€çº§åˆ†ç±»çš„åˆ‡æ¢æ­£å¥½æ»¡è¶³ä¸Šé¢çš„æ¡ä»¶ï¼Œç»„ä»¶å®ä¾‹å¤ç”¨ï¼Œå¯¼è‡´åˆ†ç±»æ•°æ®æ— æ³•æ›´æ–° è§£å†³é—®é¢˜çš„æ€è·¯ï¼š 1.è®©ç»„ä»¶å®ä¾‹ä¸å¤ç”¨ï¼Œå¼ºåˆ¶é”€æ¯é‡å»º ä»¥å½“å‰è·¯ç”±å®Œæ•´è·¯å¾„ä¸ºkeyçš„å€¼ï¼Œç»™router-viewç»„ä»¶ç»‘å®š key src\\views\\Layout\\index.vue script setup/scripttemplate LayoutNav / LayoutHeader / LayoutFixed / !-- äºŒçº§è·¯ç”± -- !-- ç»‘å®š key -- RouterView :key=$route.fullPath / LayoutFooter //template 2.ç›‘å¬è·¯ç”±å˜åŒ–ï¼Œå˜åŒ–ä¹‹åæ‰§è¡Œæ•°æ®æ›´æ–°æ“ä½œ beforeRouteUpdateé’©å­å‡½æ•°å¯ä»¥åœ¨æ¯æ¬¡è·¯ç”±æ›´æ–°ä¹‹å‰æ‰§è¡Œï¼Œåœ¨å›è°ƒä¸­æ‰§è¡Œéœ€è¦æ•°æ®æ›´æ–°çš„ä¸šåŠ¡é€»è¾‘å³å¯ import onBeforeRouteUpdate from vue-router// ç›®æ ‡:è·¯ç”±å‚æ•°å˜åŒ–çš„æ—¶å€™ å¯ä»¥æŠŠåˆ†ç±»æ•°æ®æ¥å£é‡æ–°å‘é€onBeforeRouteUpdate((to) = // å­˜åœ¨é—®é¢˜ï¼šä½¿ç”¨æœ€æ–°çš„è·¯ç”±å‚æ•°è¯·æ±‚æœ€æ–°çš„åˆ†ç±»æ•°æ® getTopCategory(to.params.id)) 5.3 åˆ†ç±» Banner5.3.1 API src\\apis\\category.js // è·å– banner å›¾export function getBannerAPI(params = ) // é»˜è®¤ä¸º1 å•†å“ä¸º2 const distributionSite = 1 = params return http( url: /home/banner, params: distributionSite, , ) 5.3.2 åŠ¨æ€æ¸²æŸ“ src\\views\\Category\\index.vue script setupimport ref, onMounted from vueimport getBannerAPI from @/apis/category// è·å–bannerconst bannerList = ref([])const getBanner = async () = const res = await getBannerAPI( distributionSite: 2 ) bannerList.value = res.resultonMounted(() = getBanner())/scripttemplate div class=top-category div class=container m-top-20 !-- é¢åŒ…å±‘ -- ... !-- è½®æ’­å›¾ -- div class=home-banner el-carousel height=500px autoplay el-carousel-item v-for=item in bannerList :key=item.id img :src=item.imgUrl alt= / /el-carousel-item /el-carousel /div /div/templatestyle scoped lang=scss.top-category ... .home-banner width: 1240px; height: 500px; margin: 0 auto; img width: 100%; height: 500px; /style 5.4 å•†å“åˆ†ç±»åˆ—è¡¨5.4.1 API src\\apis\\category.js export const getTopCategoryAPI = (id) = return http( url: /category, params: id, , ) 5.4.2 åŠ¨æ€æ¸²æŸ“è·å–é¢åŒ…å±‘æ•°æ®æ—¶å·²ç»è·å–äº†å•†å“åˆ—è¡¨æ•°æ®ï¼Œå¯ä»¥ç›´æ¥æ¸²æŸ“ template div class=top-category div class=container m-top-20 !-- é¢åŒ…å±‘ -- ... !-- è½®æ’­å›¾ -- ... !-- åˆ†ç±»å•†å“åˆ—è¡¨ -- div class=sub-list h3å…¨éƒ¨åˆ†ç±»/h3 ul li v-for=i in topCategory.children :key=i.id RouterLink to=/ img :src=i.picture / p i.name /p /RouterLink /li /ul /div div class=ref-goods v-for=item in topCategory.children :key=item.id div class=head h3- item.name -/h3 /div div class=body GoodItem v-for=good in item.goods :goods=good :key=good.id / /div /div /div /div/template 5.4.3 æ‹†åˆ†ä¸šåŠ¡é€»è¾‘åŸºäºé€»è¾‘å‡½æ•°æ‹†åˆ†ä¸šåŠ¡æ˜¯æŒ‡æŠŠåŒä¸€ä¸ªç»„ä»¶ä¸­ç‹¬ç«‹çš„ä¸šåŠ¡ä»£ç é€šè¿‡å‡½æ•°åšå°è£…å¤„ç†ï¼Œæå‡ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚ å®ç°æ­¥éª¤ï¼š æŒ‰ç…§ä¸šåŠ¡å£°æ˜ä»¥ use æ‰“å¤´çš„é€»è¾‘å‡½æ•° æŠŠç‹¬ç«‹çš„ä¸šåŠ¡é€»è¾‘å°è£…åˆ°å„ä¸ªå‡½æ•°å†…éƒ¨ å‡½æ•°å†…éƒ¨æŠŠç»„ä»¶ä¸­éœ€è¦ç”¨åˆ°çš„æ•°æ®æˆ–è€…æ–¹æ³•returnå‡ºå» åœ¨ç»„ä»¶ä¸­è°ƒç”¨å‡½æ•°æŠŠæ•°æ®æˆ–è€…æ–¹æ³•ç»„åˆå›æ¥ä½¿ç”¨ src\\views\\Category\\composables\\useBanner.js import ref, onMounted from vueimport getBannerAPI from @/apis/category// è·å–bannerexport function useBanner() const bannerList = ref([]) const getBanner = async () = const res = await getBannerAPI( distributionSite: 2, ) bannerList.value = res.result onMounted(() = getBanner()) return bannerList, src\\views\\Category\\composables\\useCategory.js import onMounted, ref from vueimport getTopCategoryAPI from @/apis/categoryimport onBeforeRouteUpdate from vue-routerimport useRoute from vue-routerexport function useCategory() // è·å–é¢åŒ…å±‘åˆ†ç±»æ•°æ® const topCategory = ref() const route = useRoute() const getTopCategory = async (id = route.params.id) = const res = await getTopCategoryAPI(id) topCategory.value = res.result onMounted(() = getTopCategory()) // ç›®æ ‡:è·¯ç”±å‚æ•°å˜åŒ–çš„æ—¶å€™ å¯ä»¥æŠŠåˆ†ç±»æ•°æ®æ¥å£é‡æ–°å‘é€ onBeforeRouteUpdate((to) = getTopCategory(to.params.id) ) return topCategory, src\\views\\Category\\index.vue script setupimport GoodItem from ../Home/components/GoodItem.vueimport useBanner from ./composables/useBannerimport useCategory from ./composables/useCategoryconst bannerList = useBanner()const topCategory = useCategory()/script 6. äºŒçº§åˆ†ç±»6.1 é™æ€æ¨¡æ¿ src\\views\\SubCategory\\index.vue script setup/scripttemplate div class=container !-- é¢åŒ…å±‘ -- div class=bread-container el-breadcrumb separator= el-breadcrumb-item :to= path: / é¦–é¡µ/el-breadcrumb-item el-breadcrumb-item :to= path: / å±…å®¶ /el-breadcrumb-item el-breadcrumb-itemå±…å®¶ç”Ÿæ´»ç”¨å“/el-breadcrumb-item /el-breadcrumb /div div class=sub-container el-tabs el-tab-pane label=æœ€æ–°å•†å“ name=publishTime/el-tab-pane el-tab-pane label=æœ€é«˜äººæ°” name=orderNum/el-tab-pane el-tab-pane label=è¯„è®ºæœ€å¤š name=evaluateNum/el-tab-pane /el-tabs div class=body !-- å•†å“åˆ—è¡¨-- /div /div /div/templatestyle lang=scss scoped.bread-container padding: 25px 0; color: #666;.sub-container padding: 20px 10px; background-color: #fff; .body display: flex; flex-wrap: wrap; padding: 0 10px; .goods-item display: block; width: 220px; margin-right: 20px; padding: 20px 30px; text-align: center; img width: 160px; height: 160px; p padding-top: 10px; .name font-size: 16px; .desc color: #999; height: 29px; .price color: $priceColor; font-size: 20px; .pagination-container margin-top: 20px; display: flex; justify-content: center; /style 6.2 è·¯ç”±é…ç½® src\\router\\index.js // createRouterï¼šåˆ›å»ºrouterå®ä¾‹å¯¹è±¡// createWebHistoryï¼šåˆ›å»ºhistoryæ¨¡å¼çš„è·¯ç”±import createRouter, createWebHistory from vue-router...import SubCategory from @/views/SubCategory/index.vueconst router = createRouter( history: createWebHistory(import.meta.env.BASE_URL), // pathå’Œcomponentå¯¹åº”å…³ç³»çš„ä½ç½® routes: [ path: /, component: Layout, children: [ ... path: category/sub/:id, name: subCategory, component: SubCategory, , ], , ... ],)export default router è·¯ç”±è·³è½¬ src\\views\\Category\\index.vue script setup.../scripttemplate div class=top-category div class=container m-top-20 !-- é¢åŒ…å±‘ -- ... !-- è½®æ’­å›¾ -- ... !-- åˆ†ç±»å•†å“åˆ—è¡¨ -- div class=sub-list h3å…¨éƒ¨åˆ†ç±»/h3 ul li v-for=i in topCategory.children :key=i.id RouterLink :to=`/category/sub/$i.id` img :src=i.picture / p i.name /p /RouterLink /li /ul /div ... /div/template 6.3 é¢åŒ…å±‘å¯¼èˆª6.3.1 API src\\apis\\category.js /** * @description: è·å–äºŒçº§åˆ†ç±»åˆ—è¡¨æ•°æ® * @param * id åˆ†ç±»id * @return * */export const getCategoryFilterAPI = (id) = return http( url: /category/sub/filter, params: id, , ) 6.3.2 åŠ¨æ€æ¸²æŸ“ src\\views\\SubCategory\\index.vue script setupimport onMounted, ref from vueimport getCategoryFilterAPI from @/apis/categoryimport useRoute from vue-routerconst route = useRoute()// é¢åŒ…å±‘æ•°æ®const categoryFilter = ref()const getCategoryFilter = async (id = route.params.id) = const res = await getCategoryFilterAPI(id) categoryFilter.value = res.resultonMounted(() = getCategoryFilter())/scripttemplate div class=container !-- é¢åŒ…å±‘ -- div class=bread-container el-breadcrumb separator= el-breadcrumb-item router-link to=/é¦–é¡µ/router-link /el-breadcrumb-item el-breadcrumb-item RouterLink :to=`/category/$categoryFilter.parentId` categoryFilter.parentName /RouterLink/el-breadcrumb-item el-breadcrumb-item categoryFilter.name /el-breadcrumb-item /el-breadcrumb /div /div/template 6.4 äºŒçº§åˆ†ç±»ç­›é€‰6.4.1 API src\\apis\\category.js /** * @description: è·å–å¯¼èˆªæ•°æ® * @data categoryId: 1005000 , page: 1, pageSize: 20, sortField: publishTime | orderNum | evaluateNum * @return * */export const getSubCategoryAPI = (data) = return http( url: /category/goods/temporary, method: POST, data, ) 6.4.2 åŠ¨æ€æ¸²æŸ“ src\\views\\SubCategory\\index.vue script setupimport onMounted, ref from vueimport getSubCategoryAPI from @/apis/category // äºŒçº§åˆ†ç±»åˆ—è¡¨æ•°æ®const goodList = ref([])const activeName = ref(publishTime)const req = ref( categoryId: route.params.id, page: 1, pageSize: 20, sortField: publishTime,)const getSubCategory = async () = const res = await getSubCategoryAPI(req.value) goodList.value = res.result.itemsonMounted(() = getSubCategory())// è¡¨æ ¼åˆ‡æ¢const onChange = (activeName) = req.value.sortField = activeName req.value.page = 1 getSubCategory()/scripttemplate el-tabs v-model=reqData.sortField @tab-change=tabChange el-tab-pane label=æœ€æ–°å•†å“ name=publishTime/el-tab-pane el-tab-pane label=æœ€é«˜äººæ°” name=orderNum/el-tab-pane el-tab-pane label=è¯„è®ºæœ€å¤š name=evaluateNum/el-tab-pane /el-tabs/template 6.5 äºŒçº§åˆ†ç±»åˆ—è¡¨ src\\views\\SubCategory\\index.vue script setupimport GoodItem from ../Home/components/GoodItem.vueimport onMounted, ref from vueimport getCategoryFilterAPI, getSubCategoryAPI from @/apis/categoryimport useRoute from vue-routerconst route = useRoute()// é¢åŒ…å±‘æ•°æ®...// äºŒçº§åˆ†ç±»åˆ—è¡¨æ•°æ®...// è¡¨æ ¼åˆ‡æ¢...// æ»šåŠ¨åŠ è½½const disabled = ref(false)const load = async () = // è·å–ä¸‹ä¸€é¡µçš„æ•°æ® req.value.page++ const res = await getSubCategoryAPI(req.value) goodList.value = [...goodList.value, ...res.result.items] // åŠ è½½å®Œæ¯• åœæ­¢ç›‘å¬ if (res.result.items.length === 0) disabled.value = true /scripttemplate div class=container !-- é¢åŒ…å±‘ -- ... div class=sub-container !-- åˆ†ç±»ç­›é€‰ -- ... div class=body v-infinite-scroll=load :infinite-scroll-disabled=disabled !-- å•†å“åˆ—è¡¨-- GoodItem v-for=good in goodList :goods=good :key=good.id / /div /div /div/template https://element-plus.org/zh-CN/component/infinite-scroll.html#%E6%8C%87%E4%BB%A4 v-infinite-scroll=loadï¼šæ»šåŠ¨åˆ°åº•éƒ¨æ—¶ï¼ŒåŠ è½½æ›´å¤šæ•°æ® :infinite-scroll-disabled=disabledï¼šæ˜¯å¦ç¦ç”¨ æ ¸å¿ƒå®ç°é€»è¾‘ï¼šä½¿ç”¨ elementPlus æä¾›çš„ v-infinite-scroll æŒ‡ä»¤ç›‘å¬æ˜¯å¦æ»¡è¶³è§¦åº•æ¡ä»¶ï¼Œæ»¡è¶³åŠ è½½æ¡ä»¶æ—¶è®©é¡µæ•°å‚æ•°åŠ ä¸€è·å–ä¸‹ä¸€é¡µæ•°æ®ï¼Œåšæ–°è€æ•°æ®æ‹¼æ¥æ¸²æŸ“ã€‚ 6.6 å®šåˆ¶è·¯ç”±scrollBehaviorå®šåˆ¶è·¯ç”±è¡Œä¸ºè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ åœ¨ä¸åŒè·¯ç”±åˆ‡æ¢çš„æ—¶å€™ï¼Œå¯ä»¥è‡ªåŠ¨æ»šåŠ¨åˆ°é¡µé¢çš„é¡¶éƒ¨ï¼Œè€Œä¸æ˜¯åœç•™åœ¨åŸå…ˆçš„ä½ç½®ã€‚ src\\router\\index.js // createRouterï¼šåˆ›å»ºrouterå®ä¾‹å¯¹è±¡// createWebHistoryï¼šåˆ›å»ºhistoryæ¨¡å¼çš„è·¯ç”±...const router = createRouter( history: createWebHistory(import.meta.env.BASE_URL), // pathå’Œcomponentå¯¹åº”å…³ç³»çš„ä½ç½® routes: [ ... ], scrollBehavior() return top: 0 ,)export default router 7.å•†å“è¯¦æƒ…é¡µ7.1 é™æ€æ¨¡æ¿ src\\views\\Detail\\index.vue script setup/scripttemplate div class=xtx-goods-page div class=container div class=bread-container el-breadcrumb separator= el-breadcrumb-item :to= path: / é¦–é¡µ/el-breadcrumb-item el-breadcrumb-item :to= path: / æ¯å©´ /el-breadcrumb-item el-breadcrumb-item :to= path: / è·‘æ­¥é‹ /el-breadcrumb-item el-breadcrumb-itemæŠ“ç»’ä¿æš–ï¼Œæ¯›æ¯›è™«å­å„¿ç«¥è¿åŠ¨é‹/el-breadcrumb-item /el-breadcrumb /div !-- å•†å“ä¿¡æ¯ -- div class=info-container div div class=goods-info div class=media !-- å›¾ç‰‡é¢„è§ˆåŒº -- !-- ç»Ÿè®¡æ•°é‡ -- ul class=goods-sales li pé”€é‡äººæ°”/p p 100+ /p pi class=iconfont icon-task-filling/ié”€é‡äººæ°”/p /li li på•†å“è¯„ä»·/p p200+/p pi class=iconfont icon-comment-filling/iæŸ¥çœ‹è¯„ä»·/p /li li pæ”¶è—äººæ°”/p p300+/p pi class=iconfont icon-favorite-filling/iæ”¶è—å•†å“/p /li li på“ç‰Œä¿¡æ¯/p p400+/p pi class=iconfont icon-dynamic-filling/iå“ç‰Œä¸»é¡µ/p /li /ul /div div class=spec !-- å•†å“ä¿¡æ¯åŒº -- p class=g-name æŠ“ç»’ä¿æš–ï¼Œæ¯›æ¯›è™«å„¿ç«¥é‹ /p p class=g-descå¥½ç©¿ /p p class=g-price span200/span span 100/span /p div class=g-service dl dtä¿ƒé”€/dt dd12æœˆå¥½ç‰©æ”¾é€ï¼ŒAppé¢†åˆ¸è´­ä¹°ç›´é™120å…ƒ/dd /dl dl dtæœåŠ¡/dt dd spanæ— å¿§é€€è´§/span spanå¿«é€Ÿé€€æ¬¾/span spanå…è´¹åŒ…é‚®/span a href=javascript:;äº†è§£è¯¦æƒ…/a /dd /dl /div !-- skuç»„ä»¶ -- !-- æ•°æ®ç»„ä»¶ -- !-- æŒ‰é’®ç»„ä»¶ -- div el-button size=large class=btn åŠ å…¥è´­ç‰©è½¦ /el-button /div /div /div div class=goods-footer div class=goods-article !-- å•†å“è¯¦æƒ… -- div class=goods-tabs nav aå•†å“è¯¦æƒ…/a /nav div class=goods-detail !-- å±æ€§ -- ul class=attrs li v-for=item in 3 :key=item.value span class=dtç™½è‰²/span span class=ddçº¯æ£‰/span /li /ul !-- å›¾ç‰‡ -- /div /div /div !-- 24çƒ­æ¦œ+ä¸“é¢˜æ¨è -- div class=goods-aside /div /div /div /div /div /div/templatestyle scoped lang=scss.xtx-goods-page .goods-info min-height: 600px; background: #fff; display: flex; .media width: 580px; height: 600px; padding: 30px 50px; .spec flex: 1; padding: 30px 30px 30px 0; .goods-footer display: flex; margin-top: 20px; .goods-article width: 940px; margin-right: 20px; .goods-aside width: 280px; min-height: 1000px; .goods-tabs min-height: 600px; background: #fff; .goods-warn min-height: 600px; background: #fff; margin-top: 20px; .number-box display: flex; align-items: center; .label width: 60px; color: #999; padding-left: 10px; .g-name font-size: 22px; .g-desc color: #999; margin-top: 10px; .g-price margin-top: 10px; span ::before content: Â¥; font-size: 14px; :first-child color: $priceColor; margin-right: 10px; font-size: 22px; :last-child color: #999; text-decoration: line-through; font-size: 16px; .g-service background: #f5f5f5; width: 500px; padding: 20px 10px 0 10px; margin-top: 10px; dl padding-bottom: 20px; display: flex; align-items: center; dt width: 50px; color: #999; dd color: #666; :last-child span margin-right: 10px; ::before content: â€¢; color: $xtxColor; margin-right: 2px; a color: $xtxColor; .goods-sales display: flex; width: 400px; align-items: center; text-align: center; height: 140px; li flex: 1; position: relative; ~li::after position: absolute; top: 10px; left: 0; height: 60px; border-left: 1px solid #e4e4e4; content: ; p :first-child color: #999; :nth-child(2) color: $priceColor; margin-top: 10px; :last-child color: #666; margin-top: 10px; i color: $xtxColor; font-size: 14px; margin-right: 2px; :hover color: $xtxColor; cursor: pointer; .goods-tabs min-height: 600px; background: #fff; nav height: 70px; line-height: 70px; display: flex; border-bottom: 1px solid #f5f5f5; a padding: 0 40px; font-size: 18px; position: relative; span color: $priceColor; font-size: 16px; margin-left: 10px; .goods-detail padding: 40px; .attrs display: flex; flex-wrap: wrap; margin-bottom: 30px; li display: flex; margin-bottom: 10px; width: 50%; .dt width: 100px; color: #999; .dd flex: 1; color: #666; img width: 100%; .btn margin-top: 20px;.bread-container padding: 25px 0;/style 7.2 è·¯ç”±é…ç½® src\\router\\index.js // createRouterï¼šåˆ›å»ºrouterå®ä¾‹å¯¹è±¡// createWebHistoryï¼šåˆ›å»ºhistoryæ¨¡å¼çš„è·¯ç”±...const router = createRouter( history: createWebHistory(import.meta.env.BASE_URL), // pathå’Œcomponentå¯¹åº”å…³ç³»çš„ä½ç½® routes: [ path: /, component: Layout, children: [ ... path: detail/:id, component: Detail, , ], , ... ], ...)export default router ç•Œé¢è·³è½¬ src\\views\\Home\\components\\HomeNew.vue script setup.../scripttemplate HomePanel titile=æ–°é²œå¥½ç‰© sub-title=æ–°é²œå‡ºç‚‰ å“è´¨é è°± template #main ul class=goods-list li v-for=item in newList :key=item.id !-- é…ç½®å•†å“è¯¦æƒ…é¡µè·³è½¬ -- RouterLink :to=`/detail/$item.id` !-- ä½¿ç”¨è‡ªå®šä¹‰æŒ‡ä»¤ -- img v-img-lazy=item.picture alt= / p class=name item.name /p p class=priceyen; item.price /p /RouterLink /li /ul /template /HomePanel/template 7.3 API src\\apis\\detail.js import http from @/utils/http/** * è·å–å•†å“è¯¦æƒ… * @param Number id å•†å“id * @returns */export const getDetailAPI = (id) = return http( url: /goods, params: id, , ) 7.4 åŸºç¡€æ•°æ®æ¸²æŸ“script setupimport onMounted, ref from vueimport getDetailAPI from @/apis/detailimport useRoute from vue-router// è·å–å•†å“è¯¦ç»†æ•°const goodDetail = ref()const route = useRoute()const getDetail = async (id = route.params.id) = const res = await getDetailAPI(id) goodDetail.value = res.resultonMounted(() = getDetail())/scripttemplate div class=xtx-goods-page !-- é”™è¯¯åŸå› ï¼šgoodDetailä¸€å¼€å§‹ .categories - undefined - undefined[1] 1. å¯é€‰é“¾çš„è¯­æ³•?. 2. v-ifæ‰‹åŠ¨æ§åˆ¶æ¸²æŸ“æ—¶æœº ä¿è¯åªæœ‰æ•°æ®å­˜åœ¨æ‰æ¸²æŸ“ -- div class=container v-if=goodDetail.details div class=bread-container el-breadcrumb separator= el-breadcrumb-item :to= path: / é¦–é¡µ/el-breadcrumb-item el-breadcrumb-item :to= path: `/category/sub/$goodDetail.categories[1].id` !-- å¯é€‰é“¾ -- !-- goodDetail.categories?.[1].name -- goodDetail.categories[1].name /el-breadcrumb-item el-breadcrumb-item :to= path: `/category/sub/$goodDetail.categories[0].id` !-- goodDetail?.categories?.[0].name -- goodDetail.categories[0].name /el-breadcrumb-item el-breadcrumb-item goodDetail.name /el-breadcrumb-item /el-breadcrumb /div !-- å•†å“ä¿¡æ¯ -- div class=info-container div div class=goods-info div class=media !-- å›¾ç‰‡é¢„è§ˆåŒº -- ImageView :image-list=goodDetail.mainPictures/ImageView !-- ç»Ÿè®¡æ•°é‡ -- ul class=goods-sales li pé”€é‡äººæ°”/p p goodDetail.salesCount /p p i class=iconfont icon-task-filling/i é”€é‡äººæ°” /p /li li på•†å“è¯„ä»·/p p goodDetail.commentCount /p p i class=iconfont icon-comment-filling/i æŸ¥çœ‹è¯„ä»· /p /li li pæ”¶è—äººæ°”/p p goodDetail.collectCount /p p i class=iconfont icon-favorite-filling/i æ”¶è—å•†å“ /p /li li på“ç‰Œä¿¡æ¯/p p goodDetail.brand.name /p p i class=iconfont icon-dynamic-filling/i å“ç‰Œä¸»é¡µ /p /li /ul /div div class=spec !-- å•†å“ä¿¡æ¯åŒº -- p class=g-name goodDetail.name /p p class=g-desc goodDetail.desc /p p class=g-price span goodDetail.oldPrice /span span goodDetail.price /span /p div class=g-service dl dtä¿ƒé”€/dt dd12æœˆå¥½ç‰©æ”¾é€,Appé¢†åˆ¸è´­ä¹°ç›´é™120å…ƒ/dd /dl dl dtæœåŠ¡/dt dd spanæ— å¿§é€€è´§/span spanå¿«é€Ÿé€€æ¬¾/span spanå…è´¹åŒ…é‚®/span a href=javascript:;äº†è§£è¯¦æƒ…/a /dd /dl /div !-- skuç»„ä»¶ -- !-- æ•°æ®ç»„ä»¶ -- !-- æŒ‰é’®ç»„ä»¶ -- div el-button size=large class=btnåŠ å…¥è´­ç‰©è½¦/el-button /div /div /div div class=goods-footer div class=goods-article !-- å•†å“è¯¦æƒ… -- div class=goods-tabs nav aå•†å“è¯¦æƒ…/a /nav div class=goods-detail !-- å±æ€§ -- ul class=attrs li v-for=item in goodDetail.details.properties :key=item.value span class=dt item.name /span span class=dd item.value /span /li /ul !-- è¯¦æƒ…å›¾ç‰‡ -- img v-for=img in goodDetail.details.pictures :src=img :key=img alt= /div /div /div !-- 24çƒ­æ¦œ+ä¸“é¢˜æ¨è -- div class=goods-aside /div /div /div /div /div /div/template 7.5 çƒ­æ¦œ7.5.2 é™æ€æ¨¡æ¿ src\\views\\Detail\\components\\DetailHot.vue script setup/scripttemplate div class=goods-hot h3å‘¨æ—¥æ¦œå•/h3 !-- å•†å“åŒºå— -- RouterLink to=/ class=goods-item v-for=item in 3 :key=item.id img :src=item.picture alt= / p class=name ellipsisä¸€åŒç”·é‹/p p class=desc ellipsisä¸€åŒå¥½ç©¿çš„ç”·é‹/p p class=priceyen;200.00/p /RouterLink /div/templatestyle scoped lang=scss.goods-hot h3 height: 70px; background: $helpColor; color: #fff; font-size: 18px; line-height: 70px; padding-left: 25px; margin-bottom: 10px; font-weight: normal; .goods-item display: block; padding: 20px 30px; text-align: center; background: #fff; img width: 160px; height: 160px; p padding-top: 10px; .name font-size: 16px; .desc color: #999; height: 29px; .price color: $priceColor; font-size: 20px; /style 7.5.1 API src\\apis\\detail.js /** * è·å–çƒ­æ¦œå•†å“ * @param Number id - å•†å“id * @param Number type - 1ä»£è¡¨24å°æ—¶çƒ­é”€æ¦œ 2ä»£è¡¨å‘¨çƒ­é”€æ¦œ * @param Number limit - è·å–ä¸ªæ•° */export const getHotGoodsAPI = ( id, type, limit = 3 ) = return http( url: /goods/hot, params: id, type, limit, , ) 7.5.3 åŠ¨æ€æ¸²æŸ“ src\\views\\Detail\\components\\DetailHot.vue script setupimport getHotGoodsAPI from @/apis/detailimport onMounted, ref, computed from vueimport useRoute from vue-router// çƒ­æ¦œè¯¦ç»†æ•°æ®const goods = ref()const route = useRoute()const getHotGoods = async (id = route.params.id, type = 1) = const res = await getHotGoodsAPI(id, type) goods.value = res.resultonMounted(() = getHotGoods())/scripttemplate div class=goods-hot h324å°æ—¶çƒ­æ¦œ/h3 !-- å•†å“åŒºå— -- RouterLink to=/ class=goods-item v-for=item in goods :key=item.id img :src=item.picture alt= / p class=name ellipsis item.name /p p class=desc ellipsis item.desc /p p class=priceyen; item.price /p /RouterLink /div/template 7.5.4 åŠ¨æ€é€‚é…çƒ­æ¦œç±»å‹ src\\views\\Detail\\components\\DetailHot.vue script setupimport getHotGoodsAPI from @/apis/detailimport onMounted, ref, computed from vueimport useRoute from vue-routerconst props = defineProps( type: type: Number, default: 1, ,)// çƒ­æ¦œè¯¦ç»†æ•°æ®const goods = ref()const route = useRoute()const getHotGoods = async (id = route.params.id, type = props.type) = const res = await getHotGoodsAPI(id, type) goods.value = res.resultonMounted(() = getHotGoods())// çƒ­æ¦œæ ‡é¢˜const TITLEMAP = 1: 24å°æ—¶çƒ­æ¦œ, 2: å‘¨çƒ­æ¦œ,const title = computed(() = TITLEMAP[props.type])/scripttemplate div class=goods-hot h3 title /h3 !-- å•†å“åŒºå— -- RouterLink to=/ class=goods-item v-for=item in goods :key=item.id img :src=item.picture alt= / p class=name ellipsis item.name /p p class=desc ellipsis item.desc /p p class=priceyen; item.price /p /RouterLink /div/template src\\views\\Detail\\index.vue script setupimport DetailHot from ./components/DetailHot.vue/scripttemplate...\t!-- 24çƒ­æ¦œ+å‘¨æ¦œ -- div class=goods-aside DetailHot :type=1 / DetailHot :type=2 / /div.../template","tags":["vue3"]},{"title":"ReactåŸºç¡€","path":"/2024/09/26/ReactåŸºç¡€/","content":"1. ç®€ä»‹React æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢ï¼ˆUIï¼‰çš„ JavaScript åº“ï¼Œç”¨æˆ·ç•Œé¢ç”±æŒ‰é’®ã€æ–‡æœ¬å’Œå›¾åƒç­‰å°å•å…ƒå†…å®¹æ„å»ºè€Œæˆã€‚React å¸®åŠ©ä½ æŠŠå®ƒä»¬ç»„åˆæˆå¯é‡ç”¨ã€å¯åµŒå¥—çš„ ç»„ä»¶ã€‚ä» web ç«¯ç½‘ç«™åˆ°ç§»åŠ¨ç«¯åº”ç”¨ï¼Œå±å¹•ä¸Šçš„æ‰€æœ‰å†…å®¹éƒ½å¯ä»¥è¢«åˆ†è§£æˆç»„ä»¶ã€‚ React çš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š ç»„ä»¶åŒ–ï¼šå°† UI æ‹†åˆ†ä¸ºå¯é‡ç”¨çš„ç»„ä»¶ï¼Œä½¿å¾—å¼€å‘å’Œç»´æŠ¤æ›´åŠ é«˜æ•ˆã€‚ è™šæ‹Ÿ DOMï¼šé€šè¿‡è™šæ‹Ÿ DOM æå‡æ€§èƒ½ï¼Œåªåœ¨å®é™…éœ€è¦æ›´æ–°çš„éƒ¨åˆ†è¿›è¡Œé‡æ¸²æŸ“ï¼Œå‡å°‘äº†ä¸çœŸå® DOM çš„ç›´æ¥æ“ä½œã€‚ å•å‘æ•°æ®æµï¼šæ•°æ®åœ¨åº”ç”¨ä¸­çš„æµåŠ¨æ˜¯å•å‘çš„ï¼Œç®€åŒ–äº†æ•°æ®ç®¡ç†ï¼Œä½¿å¾—è°ƒè¯•æ›´ä¸ºæ–¹ä¾¿ã€‚ å£°æ˜å¼ç¼–ç¨‹ï¼šå¼€å‘è€…åªéœ€æè¿°æƒ³è¦çš„ UI çŠ¶æ€ï¼ŒReact ä¼šå¤„ç†æ›´æ–°çš„ç»†èŠ‚ã€‚ 2. æè¿° UI2.1 ç»„ä»¶2.1.1 UIæ„æˆåœ¨ Web å½“ä¸­ï¼ŒHTML å…è®¸æˆ‘ä»¬ä½¿ç”¨å…¶å†…ç½®çš„æ ‡ç­¾é›†ï¼ˆå¦‚ h1 å’Œ liï¼‰åˆ›å»ºä¸°å¯Œçš„ç»“æ„åŒ–æ–‡æ¡£ï¼š article h1æˆ‘çš„ç¬¬ä¸€ä¸ªç»„ä»¶/h1 ol liç»„ä»¶ï¼šUI æ„æˆè¦ç´ /li liå®šä¹‰ç»„ä»¶/li liä½¿ç”¨ç»„ä»¶/li /ol/article article è¡¨ç¤ºè¿™ç¯‡æ–‡ç« ï¼Œh1 è¡¨ç¤ºæ–‡ç« çš„æ ‡é¢˜ï¼Œol ä»¥æœ‰åºåˆ—è¡¨çš„å½¢å¼è¡¨ç¤ºæ–‡ç« çš„ï¼ˆç¼©å†™çš„ï¼‰ç›®å½•ã€‚æ¯ä¸€ä¸ªä¾§è¾¹æ ã€å¤´åƒã€æ¨¡æ€æ¡†ã€ä¸‹æ‹‰æ¡†çš„èƒŒåæ˜¯éƒ½æ˜¯åƒè¿™æ ·çš„ï¼ˆç»“åˆäº†ç”¨äºæ ·å¼çš„ CSS å’Œç”¨äºäº¤äº’çš„ JavaScript çš„ï¼‰æ ‡ç­¾â€”â€”ä½ åœ¨ Web ä¸Šçœ‹åˆ°çš„æ¯ä¸€ä¸ª UI æ¨¡å—ã€‚ React å…è®¸ä½ å°†æ ‡ç­¾ã€CSS å’Œ JavaScript ç»„åˆæˆè‡ªå®šä¹‰â€œç»„ä»¶â€ï¼Œå³ åº”ç”¨ç¨‹åºä¸­å¯å¤ç”¨çš„ UI å…ƒç´ ã€‚ä¸Šæ–‡ä¸­è¡¨ç¤ºç›®å½•çš„ä»£ç å¯ä»¥æ”¹å†™æˆä¸€ä¸ªèƒ½å¤Ÿåœ¨æ¯ä¸ªé¡µé¢ä¸­æ¸²æŸ“çš„ TableOfContents / ç»„ä»¶ã€‚å®é™…ä¸Šï¼Œä½¿ç”¨çš„ä¾ç„¶æ˜¯ articleã€h1 ç­‰ç›¸åŒçš„ HTML æ ‡ç­¾ã€‚ å°±åƒä½¿ç”¨ HTML æ ‡ç­¾ä¸€æ ·ï¼Œä½ å¯ä»¥ç»„åˆã€æ’åºå’ŒåµŒå¥—ç»„ä»¶æ¥ç»˜åˆ¶æ•´ä¸ªé¡µé¢ã€‚ éšç€é¡¹ç›®çš„å‘å±•ï¼Œä½ ä¼šå‘ç°å¾ˆå¤šå¸ƒå±€å¯ä»¥é€šè¿‡å¤ç”¨å·²ç»å®Œæˆçš„ç»„ä»¶æ¥å®ç°ï¼Œä»è€ŒåŠ å¿«å¼€å‘è¿›ç¨‹ã€‚ä½ å¯ä»¥ä½¿ç”¨ React å¼€æºç¤¾åŒºåˆ†äº«çš„å¤§é‡ç»„ä»¶ï¼ˆä¾‹å¦‚ Chakra UI å’Œ Material UIï¼‰æ¥å¿«é€Ÿå¯åŠ¨é¡¹ç›®ã€‚ 2.1.2 å®šä¹‰ç»„ä»¶ä¸€ç›´ä»¥æ¥ï¼Œåˆ›å»ºç½‘é¡µæ—¶ï¼ŒWeb å¼€å‘äººå‘˜ä¼šç”¨æ ‡ç­¾æè¿°å†…å®¹ï¼Œç„¶åé€šè¿‡ JavaScript æ¥å¢åŠ äº¤äº’ã€‚ è¿™ç§åœ¨ Web ä¸Šæ·»åŠ äº¤äº’çš„æ–¹å¼èƒ½äº§ç”Ÿå‡ºè‰²çš„æ•ˆæœã€‚ç°åœ¨è®¸å¤šç½‘ç«™å’Œå…¨éƒ¨åº”ç”¨éƒ½éœ€è¦äº¤äº’ã€‚ React æœ€ä¸ºé‡è§†äº¤äº’æ€§ä¸”ä½¿ç”¨äº†ç›¸åŒçš„å¤„ç†æ–¹å¼ï¼šReact ç»„ä»¶æ˜¯ä¸€æ®µå¯ä»¥ä½¿ç”¨æ ‡ç­¾è¿›è¡Œæ‰©å±•çš„ JavaScript å‡½æ•°ã€‚ å¦‚ä¸‹æ‰€ç¤ºï¼š export default function Profile() return ( img src=https://i.imgur.com/MK3eW3Am.jpg alt=Katherine Johnson / ) ä»¥ä¸‹æ˜¯æ„å»ºç»„ä»¶çš„æ­¥éª¤ï¼š ç¬¬ä¸€æ­¥ï¼šå¯¼å‡ºç»„ä»¶ export default å‰ç¼€æ˜¯ä¸€ç§ JavaScript æ ‡å‡†è¯­æ³•ï¼ˆé React çš„ç‰¹æ€§ï¼‰ã€‚å®ƒå…è®¸ä½ å¯¼å‡ºä¸€ä¸ªæ–‡ä»¶ä¸­çš„ä¸»è¦å‡½æ•°ä»¥ä¾¿ä½ ä»¥åå¯ä»¥ä»å…¶ä»–æ–‡ä»¶å¼•å…¥å®ƒã€‚æ¬²äº†è§£æ›´å¤šå…³äºå¯¼å…¥çš„å†…å®¹ï¼Œè¯·å‚é˜… ç»„ä»¶çš„å¯¼å…¥ä¸å¯¼å‡º ç« èŠ‚ï¼ ç¬¬äºŒæ­¥ï¼šå®šä¹‰å‡½æ•° ä½¿ç”¨ function Profile() å®šä¹‰åä¸º Profile çš„ JavaScript å‡½æ•°ã€‚ React ç»„ä»¶æ˜¯å¸¸è§„çš„ JavaScript å‡½æ•°ï¼Œä½† ç»„ä»¶çš„åç§°å¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œå¦åˆ™å®ƒä»¬å°†æ— æ³•è¿è¡Œï¼ ç¬¬ä¸‰æ­¥ï¼šæ·»åŠ æ ‡ç­¾ è¿™ä¸ªç»„ä»¶è¿”å›ä¸€ä¸ªå¸¦æœ‰ src å’Œ alt å±æ€§çš„ img / æ ‡ç­¾ã€‚img / å†™å¾—åƒ HTMLï¼Œä½†å®é™…ä¸Šæ˜¯ JavaScriptï¼è¿™ç§è¯­æ³•è¢«ç§°ä¸º JSXï¼Œå®ƒå…è®¸ä½ åœ¨ JavaScript ä¸­åµŒå…¥æ ‡ç­¾ã€‚ è¿”å›è¯­å¥å¯ä»¥å…¨å†™åœ¨ä¸€è¡Œä¸Šï¼Œå¦‚ä¸‹é¢ç»„ä»¶ä¸­æ‰€ç¤ºï¼š return img src=https://i.imgur.com/MK3eW3As.jpg alt=Katherine Johnson /; ä½†æ˜¯ï¼Œå¦‚æœä½ çš„æ ‡ç­¾å’Œ return å…³é”®å­—ä¸åœ¨åŒä¸€è¡Œï¼Œåˆ™å¿…é¡»æŠŠå®ƒåŒ…è£¹åœ¨ä¸€å¯¹æ‹¬å·ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š return ( div img src=https://i.imgur.com/MK3eW3As.jpg alt=Katherine Johnson / /div); æ²¡æœ‰æ‹¬å·åŒ…è£¹çš„è¯ï¼Œä»»ä½•åœ¨ return ä¸‹ä¸€è¡Œçš„ä»£ç éƒ½ å°†è¢«å¿½ç•¥ï¼ 2.1.3 ä½¿ç”¨ç»„ä»¶ç°åœ¨ä½ å·²ç»å®šä¹‰äº† Profile ç»„ä»¶ï¼Œä½ å¯ä»¥åœ¨å…¶ä»–ç»„ä»¶ä¸­ä½¿ç”¨å®ƒã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å¯¼å‡ºä¸€ä¸ªå†…éƒ¨ä½¿ç”¨äº†å¤šä¸ª Profile ç»„ä»¶çš„ Gallery ç»„ä»¶ï¼š function Profile() return ( img src=https://i.imgur.com/MK3eW3As.jpg alt=Katherine Johnson / );export default function Gallery() return ( section h1äº†ä¸èµ·çš„ç§‘å­¦å®¶/h1 Profile / Profile / Profile / /section ); !DOCTYPE htmlhtmlbody div id=root/div/body!-- This setup is not suitable for production. --!-- Only use it in development! --script src=https://unpkg.com/@babel/standalone/babel.min.js/scriptscript async src=https://ga.jspm.io/npm:es-module-shims@1.7.0/dist/es-module-shims.js/scriptscript type=importmap imports: react: https://esm.sh/react?dev, react-dom/client: https://esm.sh/react-dom/client?dev /scriptscript type=text/babel data-type=moduleimport React, StrictMode from react;import createRoot from react-dom/client;function Profile() return ( img src=https://i.imgur.com/MK3eW3As.jpg alt=Katherine Johnson / );let App = function Gallery() return ( section h1äº†ä¸èµ·çš„ç§‘å­¦å®¶/h1 Profile / Profile / Profile / /section );const root = createRoot(document.getElementById(root));root.render( StrictMode App / /StrictMode);/scriptstyle* box-sizing: border-box;body font-family: sans-serif; margin: 20px; padding: 0;h1 margin-top: 0; font-size: 22px;h2 margin-top: 0; font-size: 20px;h3 margin-top: 0; font-size: 18px;h4 margin-top: 0; font-size: 16px;h5 margin-top: 0; font-size: 14px;h6 margin-top: 0; font-size: 12px;code font-size: 1.2em;ul padding-inline-start: 20px;img margin: 0 10px 10px 0; height: 90px; /style/html æµè§ˆå™¨æ‰€çœ‹åˆ°çš„ æ³¨æ„ä¸‹é¢ä¸¤è€…çš„åŒºåˆ«ï¼š section æ˜¯å°å†™çš„ï¼Œæ‰€ä»¥ React çŸ¥é“æˆ‘ä»¬æŒ‡çš„æ˜¯ HTML æ ‡ç­¾ã€‚ Profile / ä»¥å¤§å†™ P å¼€å¤´ï¼Œæ‰€ä»¥ React çŸ¥é“æˆ‘ä»¬æƒ³è¦ä½¿ç”¨åä¸º Profile çš„ç»„ä»¶ã€‚ ç„¶è€Œ Profile åŒ…å«æ›´å¤šçš„ HTMLï¼šimg /ã€‚è¿™æ˜¯æµè§ˆå™¨æœ€åæ‰€çœ‹åˆ°çš„ï¼š section h1äº†ä¸èµ·çš„ç§‘å­¦å®¶/h1 img src=https://i.imgur.com/MK3eW3As.jpg alt=Katherine Johnson / img src=https://i.imgur.com/MK3eW3As.jpg alt=Katherine Johnson / img src=https://i.imgur.com/MK3eW3As.jpg alt=Katherine Johnson //section 2.1.4 åµŒå¥—å’Œç»„ç»‡ç»„ä»¶ç»„ä»¶æ˜¯å¸¸è§„çš„ JavaScript å‡½æ•°ï¼Œæ‰€ä»¥ä½ å¯ä»¥å°†å¤šä¸ªç»„ä»¶ä¿å­˜åœ¨åŒä¸€ä»½æ–‡ä»¶ä¸­ã€‚å½“ç»„ä»¶ç›¸å¯¹è¾ƒå°æˆ–å½¼æ­¤ç´§å¯†ç›¸å…³æ—¶ï¼Œè¿™æ˜¯ä¸€ç§çœäº‹çš„å¤„ç†æ–¹å¼ã€‚å¦‚æœè¿™ä¸ªæ–‡ä»¶å˜å¾—è‡ƒè‚¿ï¼Œä½ ä¹Ÿå¯ä»¥éšæ—¶å°† Profile ç§»åŠ¨åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­ã€‚ä½ å¯ä»¥ç«‹å³åœ¨ å…³äºå¼•å…¥çš„é¡µé¢ ä¸­å­¦ä¹ å¦‚ä½•åšåˆ°è¿™äº›ã€‚ å› ä¸º Profile ç»„ä»¶åœ¨ Gallery ç»„ä»¶ä¸­æ¸²æŸ“â€”â€”ç”šè‡³å¥½å‡ æ¬¡ï¼â€”â€”æˆ‘ä»¬å¯ä»¥è®¤ä¸º Gallery æ˜¯ä¸€ä¸ª çˆ¶ç»„ä»¶ï¼Œå°†æ¯ä¸ª Profile æ¸²æŸ“ä¸ºä¸€ä¸ªâ€œå­©å­â€ã€‚è¿™æ˜¯ React çš„ç¥å¥‡ä¹‹å¤„ï¼šä½ å¯ä»¥åªå®šä¹‰ç»„ä»¶ä¸€æ¬¡ï¼Œç„¶åæŒ‰éœ€å¤šå¤„å’Œå¤šæ¬¡ä½¿ç”¨ã€‚ ç»„ä»¶å¯ä»¥æ¸²æŸ“å…¶ä»–ç»„ä»¶ï¼Œä½†æ˜¯ è¯·ä¸è¦åµŒå¥—ä»–ä»¬çš„å®šä¹‰ï¼š export default function Gallery() // ğŸ”´ æ°¸è¿œä¸è¦åœ¨ç»„ä»¶ä¸­å®šä¹‰ç»„ä»¶ function Profile() // ... // ... ä¸Šé¢è¿™æ®µä»£ç  éå¸¸æ…¢ï¼Œå¹¶ä¸”ä¼šå¯¼è‡´ bug äº§ç”Ÿã€‚å› æ­¤ï¼Œä½ åº”è¯¥åœ¨é¡¶å±‚å®šä¹‰æ¯ä¸ªç»„ä»¶ï¼š export default function Gallery() // ...// âœ… åœ¨é¡¶å±‚å£°æ˜ç»„ä»¶function Profile() // ... å½“å­ç»„ä»¶éœ€è¦ä½¿ç”¨çˆ¶ç»„ä»¶çš„æ•°æ®æ—¶ï¼Œä½ éœ€è¦ é€šè¿‡ props çš„å½¢å¼è¿›è¡Œä¼ é€’ï¼Œè€Œä¸æ˜¯åµŒå¥—å®šä¹‰ã€‚ 2.1.5 ç»„ä»¶çš„å¯¼å…¥ä¸å¯¼å‡ºç»„ä»¶çš„ç¥å¥‡ä¹‹å¤„åœ¨äºå®ƒä»¬çš„å¯é‡ç”¨æ€§ï¼šä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªç”±å…¶ä»–ç»„ä»¶æ„æˆçš„ç»„ä»¶ã€‚ä½†å½“ä½ åµŒå¥—äº†è¶Šæ¥è¶Šå¤šçš„ç»„ä»¶æ—¶ï¼Œåˆ™éœ€è¦å°†å®ƒä»¬æ‹†åˆ†æˆä¸åŒçš„æ–‡ä»¶ã€‚è¿™æ ·å¯ä»¥ä½¿å¾—æŸ¥æ‰¾æ–‡ä»¶æ›´åŠ å®¹æ˜“ï¼Œå¹¶ä¸”èƒ½åœ¨æ›´å¤šåœ°æ–¹å¤ç”¨è¿™äº›ç»„ä»¶ã€‚ 2.1.5.1 æ ¹ç»„ä»¶åœ¨ ä½ çš„ç¬¬ä¸€ä¸ªç»„ä»¶ ä¸­ï¼Œä½ åˆ›å»ºäº†ä¸€ä¸ª Profile ç»„ä»¶ï¼Œå¹¶ä¸”æ¸²æŸ“åœ¨ Gallery ç»„ä»¶é‡Œã€‚ function Profile() return ( img src=https://i.imgur.com/MK3eW3As.jpg alt=Katherine Johnson / );export default function Gallery() return ( section h1äº†ä¸èµ·çš„ç§‘å­¦å®¶ä»¬/h1 Profile / Profile / Profile / /section ); åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ‰€æœ‰ç»„ä»¶ç›®å‰éƒ½å®šä¹‰åœ¨ æ ¹ç»„ä»¶ App.js æ–‡ä»¶ä¸­ã€‚å…·ä½“è¿˜éœ€æ ¹æ®é¡¹ç›®é…ç½®å†³å®šï¼Œæœ‰äº›æ ¹ç»„ä»¶å¯èƒ½ä¼šå£°æ˜åœ¨å…¶ä»–æ–‡ä»¶ä¸­ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ¡†æ¶åŸºäºæ–‡ä»¶è¿›è¡Œè·¯ç”±ï¼Œå¦‚ Next.jsï¼Œé‚£ä½ æ¯ä¸ªé¡µé¢çš„æ ¹ç»„ä»¶éƒ½ä¼šä¸ä¸€æ ·ã€‚ 2.1.5.2 å¯¼å…¥å’Œå¯¼å‡ºç»„ä»¶å¦‚æœå°†æ¥éœ€è¦åœ¨é¦–é¡µæ·»åŠ å…³äºç§‘å­¦ä¹¦ç±çš„åˆ—è¡¨ï¼Œäº¦æˆ–è€…éœ€è¦å°†æ‰€æœ‰çš„èµ„æ–™ä¿¡æ¯ç§»åŠ¨åˆ°å…¶ä»–æ–‡ä»¶ã€‚è¿™æ—¶å°† Gallery ç»„ä»¶å’Œ Profile ç»„ä»¶ç§»å‡ºæ ¹ç»„ä»¶æ–‡ä»¶ä¼šæ›´åŠ åˆç†ã€‚è¿™ä¼šä½¿ç»„ä»¶æ›´åŠ æ¨¡å—åŒ–ï¼Œå¹¶ä¸”å¯åœ¨å…¶ä»–æ–‡ä»¶ä¸­å¤ç”¨ã€‚ä½ å¯ä»¥æ ¹æ®ä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤å¯¹ç»„ä»¶è¿›è¡Œæ‹†åˆ†ï¼š åˆ›å»º ä¸€ä¸ªæ–°çš„ JS æ–‡ä»¶æ¥å­˜æ”¾è¯¥ç»„ä»¶ã€‚ å¯¼å‡º è¯¥æ–‡ä»¶ä¸­çš„å‡½æ•°ç»„ä»¶ï¼ˆå¯ä»¥ä½¿ç”¨ é»˜è®¤å¯¼å‡º æˆ– å…·åå¯¼å‡ºï¼‰ åœ¨éœ€è¦ä½¿ç”¨è¯¥ç»„ä»¶çš„æ–‡ä»¶ä¸­ å¯¼å…¥ï¼ˆå¯ä»¥æ ¹æ®ç›¸åº”çš„å¯¼å‡ºæ–¹å¼ä½¿ç”¨ é»˜è®¤å¯¼å…¥ æˆ– å…·åå¯¼å…¥ï¼‰ã€‚ è¿™é‡Œå°† Profile ç»„ä»¶å’Œ Gallery ç»„ä»¶ï¼Œä» App.js æ–‡ä»¶ä¸­ç§»åŠ¨åˆ°äº† Gallery.js æ–‡ä»¶ä¸­ã€‚ä¿®æ”¹åï¼Œå³å¯åœ¨ App.js ä¸­å¯¼å…¥ Gallery.js ä¸­çš„ Gallery ç»„ä»¶: function Profile() return ( img src=https://i.imgur.com/QIrZWGIs.jpg alt=Alan L. Hart / );export default function Gallery() return ( section h1äº†ä¸èµ·çš„ç§‘å­¦å®¶ä»¬/h1 Profile / Profile / Profile / /section ); import Gallery from ./Gallery.js;export default function App() return ( Gallery / ); è¯¥ç¤ºä¾‹ä¸­éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚ä½•å°†ç»„ä»¶æ‹†åˆ†æˆä¸¤ä¸ªæ–‡ä»¶ï¼š Gallery.js å®šä¹‰äº† Profile ç»„ä»¶ï¼Œè¯¥ç»„ä»¶ä»…åœ¨è¯¥æ–‡ä»¶å†…ä½¿ç”¨ï¼Œæ²¡æœ‰è¢«å¯¼å‡ºã€‚ ä½¿ç”¨ é»˜è®¤å¯¼å‡º çš„æ–¹å¼ï¼Œå°† Gallery ç»„ä»¶å¯¼å‡º App.js ä½¿ç”¨ é»˜è®¤å¯¼å…¥ çš„æ–¹å¼ï¼Œä» Gallery.js ä¸­å¯¼å…¥ Gallery ç»„ä»¶ã€‚ ä½¿ç”¨ é»˜è®¤å¯¼å‡º çš„æ–¹å¼ï¼Œå°†æ ¹ç»„ä»¶ App å¯¼å‡ºã€‚ å¼•å…¥è¿‡ç¨‹ä¸­ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ä¸€äº›æ–‡ä»¶å¹¶æœªæ·»åŠ  .js æ–‡ä»¶åç¼€ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š import Gallery from ./Gallery; æ— è®ºæ˜¯ ./Gallery.js è¿˜æ˜¯ ./Galleryï¼Œåœ¨ React é‡Œéƒ½èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œåªæ˜¯å‰è€…æ›´ç¬¦åˆ åŸç”Ÿ ES æ¨¡å—ã€‚ é»˜è®¤å¯¼å‡ºä¸å…·åå¯¼å‡º è¿™æ˜¯ JavaScript é‡Œä¸¤ä¸ªä¸»è¦ç”¨æ¥å¯¼å‡ºå€¼çš„æ–¹å¼ï¼šé»˜è®¤å¯¼å‡ºå’Œå…·åå¯¼å‡ºã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„ç¤ºä¾‹ä¸­åªç”¨åˆ°äº†é»˜è®¤å¯¼å‡ºã€‚ä½†ä½ å¯ä»¥åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œé€‰æ‹©ä½¿ç”¨å…¶ä¸­ä¸€ç§ï¼Œæˆ–è€…ä¸¤ç§éƒ½ä½¿ç”¨ã€‚ä¸€ä¸ªæ–‡ä»¶é‡Œæœ‰ä¸”ä»…æœ‰ä¸€ä¸ª é»˜è®¤ å¯¼å‡ºï¼Œä½†æ˜¯å¯ä»¥æœ‰ä»»æ„å¤šä¸ª å…·å å¯¼å‡ºã€‚ ç»„ä»¶çš„å¯¼å‡ºæ–¹å¼å†³å®šäº†å…¶å¯¼å…¥æ–¹å¼ã€‚å½“ä½ ç”¨é»˜è®¤å¯¼å…¥çš„æ–¹å¼ï¼Œå¯¼å…¥å…·åå¯¼å‡ºçš„ç»„ä»¶æ—¶ï¼Œå°±ä¼šæŠ¥é”™ã€‚å¦‚ä¸‹è¡¨æ ¼å¯ä»¥å¸®ä½ æ›´å¥½åœ°ç†è§£å®ƒä»¬ï¼š è¯­æ³• å¯¼å‡ºè¯­å¥ å¯¼å…¥è¯­å¥ é»˜è®¤ export default function Button() import Button from ./Button.js; å…·å export function Button() import Button from ./Button.js; å½“ä½¿ç”¨é»˜è®¤å¯¼å…¥æ—¶ï¼Œä½ å¯ä»¥åœ¨ import è¯­å¥åé¢è¿›è¡Œä»»æ„å‘½åã€‚æ¯”å¦‚ import Banana from ./Button.jsï¼Œå¦‚æ­¤ä½ èƒ½è·å¾—ä¸é»˜è®¤å¯¼å‡ºä¸€è‡´çš„å†…å®¹ã€‚ç›¸åï¼Œå¯¹äºå…·åå¯¼å…¥ï¼Œå¯¼å…¥å’Œå¯¼å‡ºçš„åå­—å¿…é¡»ä¸€è‡´ã€‚è¿™ä¹Ÿæ˜¯ç§°å…¶ä¸º å…·å å¯¼å…¥çš„åŸå› ï¼ é€šå¸¸ï¼Œæ–‡ä»¶ä¸­ä»…åŒ…å«ä¸€ä¸ªç»„ä»¶æ—¶ï¼Œäººä»¬ä¼šé€‰æ‹©é»˜è®¤å¯¼å‡ºï¼Œè€Œå½“æ–‡ä»¶ä¸­åŒ…å«å¤šä¸ªç»„ä»¶æˆ–æŸä¸ªå€¼éœ€è¦å¯¼å‡ºæ—¶ï¼Œåˆ™ä¼šé€‰æ‹©å…·åå¯¼å‡ºã€‚ æ— è®ºé€‰æ‹©å“ªç§æ–¹å¼ï¼Œè¯·è®°å¾—ç»™ä½ çš„ç»„ä»¶å’Œç›¸åº”çš„æ–‡ä»¶å‘½åä¸€ä¸ªæœ‰æ„ä¹‰çš„åå­—ã€‚æˆ‘ä»¬ä¸å»ºè®®åˆ›å»ºæœªå‘½åçš„ç»„ä»¶ï¼Œæ¯”å¦‚ export default () = ï¼Œå› ä¸ºè¿™æ ·ä¼šä½¿å¾—è°ƒè¯•å˜å¾—å¼‚å¸¸å›°éš¾ã€‚ 2.1.5.3 ä»åŒä¸€æ–‡ä»¶å¯¼å‡ºå’Œå¯¼å…¥å¤šä¸ªç»„ä»¶å¦‚æœä½ åªæƒ³å±•ç¤ºä¸€ä¸ª Profile ç»„ï¼Œè€Œä¸å±•ç¤ºæ•´ä¸ªå›¾é›†ã€‚ä½ ä¹Ÿå¯ä»¥å¯¼å‡º Profile ç»„ä»¶ã€‚ä½† Gallery.js ä¸­å·²åŒ…å« é»˜è®¤ å¯¼å‡ºï¼Œæ­¤æ—¶ï¼Œä½ ä¸èƒ½å®šä¹‰ ä¸¤ä¸ª é»˜è®¤å¯¼å‡ºã€‚ä½†ä½ å¯ä»¥å°†å…¶åœ¨æ–°æ–‡ä»¶ä¸­è¿›è¡Œé»˜è®¤å¯¼å‡ºï¼Œæˆ–è€…å°† Profile è¿›è¡Œ å…·å å¯¼å‡ºã€‚åŒä¸€æ–‡ä»¶ä¸­ï¼Œæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªé»˜è®¤å¯¼å‡ºï¼Œä½†å¯ä»¥æœ‰å¤šä¸ªå…·åå¯¼å‡ºï¼ ä¸ºäº†å‡å°‘åœ¨é»˜è®¤å¯¼å‡ºå’Œå…·åå¯¼å‡ºä¹‹é—´çš„æ··æ·†ï¼Œä¸€äº›å›¢é˜Ÿä¼šé€‰æ‹©åªä½¿ç”¨ä¸€ç§é£æ ¼ï¼ˆé»˜è®¤æˆ–è€…å…·åï¼‰ï¼Œæˆ–è€…ç¦æ­¢åœ¨å•ä¸ªæ–‡ä»¶å†…æ··åˆä½¿ç”¨ã€‚è¿™å› äººè€Œå¼‚ï¼Œé€‰æ‹©æœ€é€‚åˆä½ çš„å³å¯ï¼ é¦–å…ˆï¼Œç”¨å…·åå¯¼å‡ºçš„æ–¹å¼ï¼Œå°† Profile ç»„ä»¶ä» Gallery.js å¯¼å‡ºï¼ˆä¸ä½¿ç”¨ default å…³é”®å­—ï¼‰ï¼š export function Profile() // ... æ¥ç€ï¼Œç”¨å…·åå¯¼å…¥çš„æ–¹å¼ï¼Œä» Gallery.js æ–‡ä»¶ä¸­ å¯¼å…¥ Profile ç»„ä»¶ï¼ˆç”¨å¤§æ‹¬å·ï¼‰: import Profile from ./Gallery.js; æœ€åï¼Œåœ¨ App ç»„ä»¶é‡Œ æ¸²æŸ“ Profile /ï¼š export default function App() return Profile /; ç°åœ¨ï¼ŒGallery.js åŒ…å«ä¸¤ä¸ªå¯¼å‡ºï¼šä¸€ä¸ªæ˜¯é»˜è®¤å¯¼å‡ºçš„ Galleryï¼Œå¦ä¸€ä¸ªæ˜¯å…·åå¯¼å‡ºçš„ Profileã€‚App.js ä¸­å‡å¯¼å…¥äº†è¿™ä¸¤ä¸ªç»„ä»¶ã€‚å°è¯•å°† Profile / æ”¹æˆ Gallery /ï¼Œå›åˆ°ç¤ºä¾‹ä¸­ï¼š export function Profile() return ( img src=https://i.imgur.com/QIrZWGIs.jpg alt=Alan L. Hart / );export default function Gallery() return ( section h1äº†ä¸èµ·çš„ç§‘å­¦å®¶ä»¬/h1 Profile / Profile / Profile / /section ); import Gallery from ./Gallery.js;import Profile from ./Gallery.js;export default function App() return ( Profile / ); ç¤ºä¾‹ä¸­æ··åˆä½¿ç”¨äº†é»˜è®¤å¯¼å‡ºå’Œå…·åå¯¼å‡ºï¼š Gallery.js ä½¿ç”¨ å…·åå¯¼å‡º çš„æ–¹å¼ï¼Œå°† Profile ç»„ä»¶å¯¼å‡ºï¼Œå¹¶å–åä¸º Profileã€‚ ä½¿ç”¨ é»˜è®¤å¯¼å‡º çš„æ–¹å¼ï¼Œå°† Gallery ç»„ä»¶å¯¼å‡ºã€‚ App.js ä½¿ç”¨ å…·åå¯¼å…¥ çš„æ–¹å¼ï¼Œä» Gallery.js ä¸­å¯¼å…¥ Profile ç»„ä»¶ï¼Œå¹¶å–åä¸º Profileã€‚ ä½¿ç”¨ é»˜è®¤å¯¼å…¥ çš„æ–¹å¼ï¼Œä» Gallery.js ä¸­å¯¼å…¥ Gallery ç»„ä»¶ã€‚ ä½¿ç”¨ é»˜è®¤å¯¼å‡º çš„æ–¹å¼ï¼Œå°†æ ¹ç»„ä»¶ App å¯¼å‡ºã€‚ 2.2 JSXæ ‡ç­¾è¯­è¨€JSX æ˜¯ JavaScript è¯­æ³•æ‰©å±•ï¼Œå¯ä»¥è®©ä½ åœ¨ JavaScript æ–‡ä»¶ä¸­ä¹¦å†™ç±»ä¼¼ HTML çš„æ ‡ç­¾ã€‚è™½ç„¶è¿˜æœ‰å…¶å®ƒæ–¹å¼å¯ä»¥ç¼–å†™ç»„ä»¶ï¼Œä½†å¤§éƒ¨åˆ† React å¼€å‘è€…æ›´å–œæ¬¢ JSX çš„ç®€æ´æ€§ï¼Œå¹¶ä¸”åœ¨å¤§éƒ¨åˆ†ä»£ç åº“ä¸­ä½¿ç”¨å®ƒã€‚ 2.2.1 å°†æ ‡ç­¾å¼•å…¥ JavaScriptç½‘é¡µæ˜¯æ„å»ºåœ¨ HTMLã€CSS å’Œ JavaScript ä¹‹ä¸Šçš„ã€‚å¤šå¹´ä»¥æ¥ï¼Œweb å¼€å‘è€…éƒ½æ˜¯å°†ç½‘é¡µå†…å®¹å­˜æ”¾åœ¨ HTML ä¸­ï¼Œæ ·å¼æ”¾åœ¨ CSS ä¸­ï¼Œè€Œé€»è¾‘åˆ™æ”¾åœ¨ JavaScript ä¸­ â€”â€” é€šå¸¸æ˜¯åœ¨ä¸åŒçš„æ–‡ä»¶ä¸­ï¼é¡µé¢çš„å†…å®¹é€šè¿‡æ ‡ç­¾è¯­è¨€æè¿°å¹¶å­˜æ”¾åœ¨ HTML æ–‡ä»¶ä¸­ï¼Œè€Œé€»è¾‘åˆ™å•ç‹¬å­˜æ”¾åœ¨ JavaScript æ–‡ä»¶ä¸­ã€‚ ä½†éšç€ Web çš„äº¤äº’æ€§è¶Šæ¥è¶Šå¼ºï¼Œé€»è¾‘è¶Šæ¥è¶Šå†³å®šé¡µé¢ä¸­çš„å†…å®¹ã€‚JavaScript æ§åˆ¶ç€ HTML çš„å†…å®¹ï¼è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ åœ¨ React ä¸­ï¼Œæ¸²æŸ“é€»è¾‘å’Œæ ‡ç­¾å…±åŒå­˜åœ¨äºåŒä¸€ä¸ªåœ°æ–¹â€”â€”ç»„ä»¶ã€‚ å°†ä¸€ä¸ªæŒ‰é’®çš„æ¸²æŸ“é€»è¾‘å’Œæ ‡ç­¾æ”¾åœ¨ä¸€èµ·å¯ä»¥ç¡®ä¿å®ƒä»¬åœ¨æ¯æ¬¡ç¼–è¾‘æ—¶éƒ½èƒ½ä¿æŒäº’ç›¸åŒæ­¥ã€‚åä¹‹ï¼Œå½¼æ­¤æ— å…³çš„ç»†èŠ‚æ˜¯äº’ç›¸éš”ç¦»çš„ï¼Œä¾‹å¦‚æŒ‰é’®çš„æ ‡ç­¾å’Œä¾§è¾¹æ çš„æ ‡ç­¾ã€‚è¿™æ ·æˆ‘ä»¬åœ¨ä¿®æ”¹å…¶ä¸­ä»»æ„ä¸€ä¸ªç»„ä»¶æ—¶ä¼šæ›´å®‰å…¨ã€‚ æ¯ä¸ª React ç»„ä»¶éƒ½æ˜¯ä¸€ä¸ª JavaScript å‡½æ•°ï¼Œå®ƒä¼šè¿”å›ä¸€äº›æ ‡ç­¾ï¼ŒReact ä¼šå°†è¿™äº›æ ‡ç­¾æ¸²æŸ“åˆ°æµè§ˆå™¨ä¸Šã€‚React ç»„ä»¶ä½¿ç”¨ä¸€ç§è¢«ç§°ä¸º JSX çš„è¯­æ³•æ‰©å±•æ¥æè¿°è¿™äº›æ ‡ç­¾ã€‚JSX çœ‹èµ·æ¥å’Œ HTML å¾ˆåƒï¼Œä½†å®ƒçš„è¯­æ³•æ›´åŠ ä¸¥æ ¼å¹¶ä¸”å¯ä»¥åŠ¨æ€å±•ç¤ºä¿¡æ¯ã€‚äº†è§£è¿™äº›åŒºåˆ«æœ€å¥½çš„æ–¹å¼å°±æ˜¯å°†ä¸€äº› HTML æ ‡ç­¾è½¬åŒ–ä¸º JSX æ ‡ç­¾ã€‚ JSX and React æ˜¯ç›¸äº’ç‹¬ç«‹çš„ ä¸œè¥¿ã€‚ä½†å®ƒä»¬ç»å¸¸ä¸€èµ·ä½¿ç”¨ï¼Œä½†ä½  å¯ä»¥ å•ç‹¬ä½¿ç”¨å®ƒä»¬ä¸­çš„ä»»æ„ä¸€ä¸ªï¼ŒJSX æ˜¯ä¸€ç§è¯­æ³•æ‰©å±•ï¼Œè€Œ React åˆ™æ˜¯ä¸€ä¸ª JavaScript çš„åº“ã€‚ 2.2.2 JSX è§„åˆ™2.2.2.1 åªèƒ½è¿”å›ä¸€ä¸ªæ ¹å…ƒç´ å¦‚æœæƒ³è¦åœ¨ä¸€ä¸ªç»„ä»¶ä¸­åŒ…å«å¤šä¸ªå…ƒç´ ï¼Œéœ€è¦ç”¨ä¸€ä¸ªçˆ¶æ ‡ç­¾æŠŠå®ƒä»¬åŒ…è£¹èµ·æ¥ã€‚ ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ª div æ ‡ç­¾ï¼š div h1æµ·è’‚Â·æ‹‰ç›çš„å¾…åŠäº‹é¡¹/h1 img src=https://i.imgur.com/yXOvdOSs.jpg alt=Hedy Lamarr class=photo ul ... /ul/div å¦‚æœä½ ä¸æƒ³åœ¨æ ‡ç­¾ä¸­å¢åŠ ä¸€ä¸ªé¢å¤–çš„ divï¼Œå¯ä»¥ç”¨ å’Œ / å…ƒç´ æ¥ä»£æ›¿ï¼š h1æµ·è’‚Â·æ‹‰ç›çš„å¾…åŠäº‹é¡¹/h1 img src=https://i.imgur.com/yXOvdOSs.jpg alt=Hedy Lamarr class=photo ul ... /ul/ è¿™ä¸ªç©ºæ ‡ç­¾è¢«ç§°ä½œ *Fragment*ã€‚React Fragment å…è®¸ä½ å°†å­å…ƒç´ åˆ†ç»„ï¼Œè€Œä¸ä¼šåœ¨ HTML ç»“æ„ä¸­æ·»åŠ é¢å¤–èŠ‚ç‚¹ã€‚ ä¸ºä»€ä¹ˆå¤šä¸ª JSX æ ‡ç­¾éœ€è¦è¢«ä¸€ä¸ªçˆ¶å…ƒç´ åŒ…è£¹ï¼ŸJSX è™½ç„¶çœ‹èµ·æ¥å¾ˆåƒ HTMLï¼Œä½†åœ¨åº•å±‚å…¶å®è¢«è½¬åŒ–ä¸ºäº† JavaScript å¯¹è±¡ï¼Œä½ ä¸èƒ½åœ¨ä¸€ä¸ªå‡½æ•°ä¸­è¿”å›å¤šä¸ªå¯¹è±¡ï¼Œé™¤éç”¨ä¸€ä¸ªæ•°ç»„æŠŠä»–ä»¬åŒ…è£…èµ·æ¥ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¤šä¸ª JSX æ ‡ç­¾å¿…é¡»è¦ç”¨ä¸€ä¸ªçˆ¶å…ƒç´ æˆ–è€… Fragment æ¥åŒ…è£¹ã€‚ 2.2.2.2 æ ‡ç­¾å¿…é¡»é—­åˆJSX è¦æ±‚æ ‡ç­¾å¿…é¡»æ­£ç¡®é—­åˆã€‚åƒ img è¿™æ ·çš„è‡ªé—­åˆæ ‡ç­¾å¿…é¡»ä¹¦å†™æˆ img /ï¼Œè€Œåƒ lioranges è¿™æ ·åªæœ‰å¼€å§‹æ ‡ç­¾çš„å…ƒç´ å¿…é¡»å¸¦æœ‰é—­åˆæ ‡ç­¾ï¼Œéœ€è¦æ”¹ä¸º lioranges/liã€‚ æµ·è’‚Â·æ‹‰ç›çš„ç…§ç‰‡å’Œå¾…åŠäº‹é¡¹çš„æ ‡ç­¾ç»ä¿®æ”¹åå˜ä¸ºï¼š img src=https://i.imgur.com/yXOvdOSs.jpg alt=Hedy Lamarr class=photo / ul liå‘æ˜ä¸€ç§æ–°å¼äº¤é€šä¿¡å·ç¯/li liæ’ç»ƒä¸€ä¸ªç”µå½±åœºæ™¯/li liæ”¹è¿›é¢‘è°±æŠ€æœ¯/li /ul img src=https://i.imgur.com/yXOvdOSs.jpg alt=Hedy Lamarr class=photo / ul liå‘æ˜ä¸€ç§æ–°å¼äº¤é€šä¿¡å·ç¯/li liæ’ç»ƒä¸€ä¸ªç”µå½±åœºæ™¯/li liæ”¹è¿›é¢‘è°±æŠ€æœ¯/li /ul// 2.2.2.3 ä½¿ç”¨é©¼å³°å¼å‘½åæ³•JSX æœ€ç»ˆä¼šè¢«è½¬åŒ–ä¸º JavaScriptï¼Œè€Œ JSX ä¸­çš„å±æ€§ä¹Ÿä¼šå˜æˆ JavaScript å¯¹è±¡ä¸­çš„é”®å€¼å¯¹ã€‚åœ¨ä½ è‡ªå·±çš„ç»„ä»¶ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°éœ€è¦ç”¨å˜é‡çš„æ–¹å¼è¯»å–è¿™äº›å±æ€§çš„æ—¶å€™ã€‚ä½† JavaScript å¯¹å˜é‡çš„å‘½åæœ‰é™åˆ¶ã€‚ä¾‹å¦‚ï¼Œå˜é‡åç§°ä¸èƒ½åŒ…å« - ç¬¦å·æˆ–è€…åƒ class è¿™æ ·çš„ä¿ç•™å­—ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ React ä¸­ï¼Œå¤§éƒ¨åˆ† HTML å’Œ SVG å±æ€§éƒ½ç”¨é©¼å³°å¼å‘½åæ³•è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œéœ€è¦ç”¨ strokeWidth ä»£æ›¿ stroke-widthã€‚ç”±äº class æ˜¯ä¸€ä¸ªä¿ç•™å­—ï¼Œæ‰€ä»¥åœ¨ React ä¸­éœ€è¦ç”¨ className æ¥ä»£æ›¿ã€‚è¿™ä¹Ÿæ˜¯ DOM å±æ€§ä¸­çš„å‘½å: img src=https://i.imgur.com/yXOvdOSs.jpg alt=Hedy Lamarr className=photo/ ä½ å¯ä»¥ åœ¨ React DOM å…ƒç´ ä¸­æ‰¾åˆ°æ‰€æœ‰å¯¹åº”çš„å±æ€§ã€‚å¦‚æœä½ åœ¨ç¼–å†™å±æ€§æ—¶å‘ç”Ÿäº†é”™è¯¯ï¼Œä¸ç”¨æ‹…å¿ƒ â€”â€” React ä¼šåœ¨ æµè§ˆå™¨æ§åˆ¶å° ä¸­æ‰“å°ä¸€æ¡å¯èƒ½çš„æ›´æ­£ä¿¡æ¯ã€‚ ç”±äºå†å²åŸå› ï¼Œaria-* å’Œ data-* å±æ€§æ˜¯ä»¥å¸¦ - ç¬¦å·çš„ HTML æ ¼å¼ä¹¦å†™çš„ã€‚ 2.2.3 å°† HTML è½¬åŒ–ä¸º JSXå‡è®¾ä½ ç°åœ¨æœ‰ä¸€äº›ï¼ˆå®Œå…¨æœ‰æ•ˆçš„ï¼‰HTML æ ‡ç­¾ï¼š h1æµ·è’‚Â·æ‹‰ç›çš„å¾…åŠäº‹é¡¹/h1img src=https://i.imgur.com/yXOvdOSs.jpg alt=Hedy Lamarr class=photoul liå‘æ˜ä¸€ç§æ–°å¼äº¤é€šä¿¡å·ç¯ liæ’ç»ƒä¸€ä¸ªç”µå½±åœºæ™¯ liæ”¹è¿›é¢‘è°±æŠ€æœ¯/ul è€Œç°åœ¨æƒ³è¦æŠŠè¿™äº›æ ‡ç­¾è¿ç§»åˆ°ç»„ä»¶ä¸­ï¼š export default function TodoList() return ( // ??? ) å¦‚æœç›´æ¥å¤åˆ¶åˆ°ç»„ä»¶ä¸­ï¼Œå¹¶ä¸èƒ½æ­£å¸¸å·¥ä½œï¼š export default function TodoList() return ( // è¿™ä¸èµ·ä½œç”¨ï¼ h1æµ·è’‚Â·æ‹‰ç›çš„å¾…åŠäº‹é¡¹/h1 img src=https://i.imgur.com/yXOvdOSs.jpg alt=Hedy Lamarr class=photo ul liå‘æ˜ä¸€ç§æ–°å¼äº¤é€šä¿¡å·ç¯ liæ’ç»ƒä¸€ä¸ªç”µå½±åœºæ™¯ liæ”¹è¿›é¢‘è°±æŠ€æœ¯ /ul ); è¿™æ˜¯å› ä¸º JSX è¯­æ³•æ›´åŠ ä¸¥æ ¼å¹¶ä¸”ç›¸æ¯” HTML æœ‰æ›´å¤šçš„è§„åˆ™ï¼ä¸Šé¢çš„é”™è¯¯æç¤ºå¯ä»¥å¸®åŠ©ä½ ä¿®å¤æ ‡ç­¾ä¸­çš„é”™è¯¯ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å‚è€ƒä¸‹é¢çš„æŒ‡å¼•ã€‚ å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼ŒReact åœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„é”™è¯¯æç¤ºå°±èƒ½å¸®ä½ æ‰¾åˆ°é—®é¢˜æ‰€åœ¨ï¼Œå¦‚æœåœ¨ç¼–å†™è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜å°±å‚è€ƒä¸€ä¸‹æç¤ºå§ã€‚ å°†ç°æœ‰çš„ HTML ä¸­çš„æ‰€æœ‰å±æ€§è½¬åŒ– JSX çš„æ ¼å¼æ˜¯å¾ˆç¹ççš„ã€‚æˆ‘ä»¬å»ºè®®ä½¿ç”¨ è½¬åŒ–å™¨ å°† HTML å’Œ SVG æ ‡ç­¾è½¬åŒ–ä¸º JSXã€‚è¿™ç§è½¬åŒ–å™¨åœ¨å®è·µä¸­éå¸¸æœ‰ç”¨ã€‚ä½†æˆ‘ä»¬ä¾ç„¶æœ‰å¿…è¦å»äº†è§£è¿™ç§è½¬åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆï¼Œè¿™æ ·ä½ å°±å¯ä»¥ç¼–å†™è‡ªå·±çš„ JSX äº†ã€‚ è¿™æ˜¯æœ€ç»ˆçš„ç»“æœï¼š export default function TodoList() return ( h1æµ·è’‚Â·æ‹‰ç›çš„å¾…åŠäº‹é¡¹/h1 img src=https://i.imgur.com/yXOvdOSs.jpg alt=Hedy Lamarr className=photo / ul liå‘æ˜ä¸€ç§æ–°å¼äº¤é€šä¿¡å·ç¯/li liæ’ç»ƒä¸€ä¸ªç”µå½±åœºæ™¯/li liæ”¹è¿›é¢‘è°±æŠ€æœ¯/li /ul / ); 2.2.4 åœ¨ JSX ä¸­é€šè¿‡å¤§æ‹¬å·ä½¿ç”¨ JavaScriptJSX å…è®¸ä½ åœ¨ JavaScript ä¸­ç¼–å†™ç±»ä¼¼ HTML çš„æ ‡ç­¾ï¼Œä»è€Œä½¿æ¸²æŸ“çš„é€»è¾‘å’Œå†…å®¹å¯ä»¥å†™åœ¨ä¸€èµ·ã€‚ æœ‰æ—¶å€™ï¼Œä½ å¯èƒ½æƒ³è¦åœ¨æ ‡ç­¾ä¸­æ·»åŠ ä¸€äº› JavaScript é€»è¾‘æˆ–è€…å¼•ç”¨åŠ¨æ€çš„å±æ€§ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥åœ¨ JSX çš„å¤§æ‹¬å·å†…æ¥ç¼–å†™ JavaScriptã€‚ 2.2.4.1 ä½¿ç”¨å¼•å·ä¼ é€’å­—ç¬¦ä¸²å½“ä½ æƒ³æŠŠä¸€ä¸ªå­—ç¬¦ä¸²å±æ€§ä¼ é€’ç»™ JSX æ—¶ï¼ŒæŠŠå®ƒæ”¾åˆ°å•å¼•å·æˆ–åŒå¼•å·ä¸­ï¼š export default function Avatar() return ( img className=avatar src=https://i.imgur.com/7vQD0fPs.jpg alt=Gregorio Y. Zara / ); è¿™é‡Œçš„ https://i.imgur.com/7vQD0fPs.jpg å’Œ Gregorio Y. Zara å°±æ˜¯è¢«ä½œä¸ºå­—ç¬¦ä¸²ä¼ é€’çš„ã€‚ ä½†æ˜¯å¦‚æœä½ æƒ³è¦åŠ¨æ€åœ°æŒ‡å®š src æˆ– alt çš„å€¼å‘¢ï¼Ÿä½ å¯ä»¥ ç”¨ å’Œ æ›¿ä»£ å’Œ ä»¥ä½¿ç”¨ JavaScript å˜é‡ ï¼š export default function Avatar() const avatar = https://i.imgur.com/7vQD0fPs.jpg; const description = Gregorio Y. Zara; return ( img className=avatar src=avatar alt=description / ); è¯·æ³¨æ„ className=avatar å’Œ src=avatar ä¹‹é—´çš„åŒºåˆ«ï¼ŒclassName=avatar æŒ‡å®šäº†ä¸€ä¸ªå°±å« avatar çš„ä½¿å›¾ç‰‡åœ¨æ ·å¼ä¸Šå˜åœ†çš„ CSS ç±»åï¼Œè€Œ src=avatar è¿™ç§å†™æ³•ä¼šå»è¯»å– JavaScript ä¸­ avatar è¿™ä¸ªå˜é‡çš„å€¼ã€‚è¿™æ˜¯å› ä¸ºå¤§æ‹¬å·å¯ä»¥ä½¿ä½ ç›´æ¥åœ¨æ ‡ç­¾ä¸­ä½¿ç”¨ JavaScriptï¼ 2.2.4.2 ä½¿ç”¨å¤§æ‹¬å·ï¼šä¸€æ‰‡è¿›å…¥ JavaScript ä¸–ç•Œçš„çª—æˆ·JSX æ˜¯ä¸€ç§ç¼–å†™ JavaScript çš„ç‰¹æ®Šæ–¹å¼ã€‚è¿™ä¸ºåœ¨å¤§æ‹¬å· ä¸­ä½¿ç”¨ JavaScript å¸¦æ¥äº†å¯èƒ½ã€‚ä¸‹é¢çš„ç¤ºä¾‹ä¸­å£°æ˜äº†ç§‘å­¦å®¶çš„åå­—ï¼Œnameï¼Œç„¶ååœ¨ h1 åçš„å¤§æ‹¬å·å†…åµŒå…¥å®ƒï¼š export default function TodoList() const name = Gregorio Y. Zara; return ( h1names To Do List/h1 ); è¯•ç€å°† name çš„å€¼ä» Gregorio Y. Zara æ›´æ”¹æˆ Hedy Lamarrã€‚çœ‹çœ‹è¿™ä¸ª To Do List çš„æ ‡é¢˜å°†å¦‚ä½•å˜åŒ–ï¼Ÿ å¤§æ‹¬å·å†…çš„ä»»ä½• JavaScript è¡¨è¾¾å¼éƒ½èƒ½æ­£å¸¸è¿è¡Œï¼ŒåŒ…æ‹¬åƒ formatDate() è¿™æ ·çš„å‡½æ•°è°ƒç”¨ï¼š const today = new Date();function formatDate(date) return new Intl.DateTimeFormat( zh-CN, weekday: long ).format(date);export default function TodoList() return ( h1To Do List for formatDate(today)/h1 ); åœ¨ JSX ä¸­ï¼Œåªèƒ½åœ¨ä»¥ä¸‹ä¸¤ç§åœºæ™¯ä¸­ä½¿ç”¨å¤§æ‹¬å·ï¼š ç”¨ä½œ JSX æ ‡ç­¾å†…çš„æ–‡æœ¬ï¼šh1names To Do List/h1 æ˜¯æœ‰æ•ˆçš„ï¼Œä½†æ˜¯ tagGregorio Y. Zaras To Do List/tag æ— æ•ˆã€‚ ç”¨ä½œç´§è·Ÿåœ¨ = ç¬¦å·åçš„ å±æ€§ï¼šsrc=avatar ä¼šè¯»å– avatar å˜é‡ï¼Œä½†æ˜¯ src=avatar åªä¼šä¼ ä¸€ä¸ªå­—ç¬¦ä¸² avatarã€‚ 2.2.4.3 ä½¿ç”¨ â€œåŒå¤§æ‹¬å·â€ï¼šJSX ä¸­çš„ CSS å’Œ å¯¹è±¡é™¤äº†å­—ç¬¦ä¸²ã€æ•°å­—å’Œå…¶å®ƒ JavaScript è¡¨è¾¾å¼ï¼Œä½ ç”šè‡³å¯ä»¥åœ¨ JSX ä¸­ä¼ é€’å¯¹è±¡ã€‚å¯¹è±¡ä¹Ÿç”¨å¤§æ‹¬å·è¡¨ç¤ºï¼Œä¾‹å¦‚ name: Hedy Lamarr, inventions: 5 ã€‚å› æ­¤ï¼Œä¸ºäº†èƒ½åœ¨ JSX ä¸­ä¼ é€’ï¼Œä½ å¿…é¡»ç”¨å¦ä¸€å¯¹é¢å¤–çš„å¤§æ‹¬å·åŒ…è£¹å¯¹è±¡ï¼šperson= name: \"Hedy Lamarr\", inventions: 5 ã€‚ ä½ å¯èƒ½åœ¨ JSX çš„å†…è” CSS æ ·å¼ä¸­å°±å·²ç»è§è¿‡è¿™ç§å†™æ³•äº†ã€‚React ä¸è¦æ±‚ä½ ä½¿ç”¨å†…è”æ ·å¼ï¼ˆä½¿ç”¨ CSS ç±»å°±èƒ½æ»¡è¶³å¤§éƒ¨åˆ†æƒ…å†µï¼‰ã€‚ä½†æ˜¯å½“ä½ éœ€è¦å†…è”æ ·å¼çš„æ—¶å€™ï¼Œä½ å¯ä»¥ç»™ style å±æ€§ä¼ é€’ä¸€ä¸ªå¯¹è±¡ï¼š export default function TodoList() return ( ul style= backgroundColor: black, color: pink liImprove the videophone/li liPrepare aeronautics lectures/li liWork on the alcohol-fuelled engine/li /ul ); æ‰€ä»¥å½“ä½ ä¸‹æ¬¡åœ¨ JSX ä¸­çœ‹åˆ° ` å’Œ `æ—¶ï¼Œå°±çŸ¥é“å®ƒåªä¸è¿‡æ˜¯åŒ…åœ¨å¤§æ‹¬å·é‡Œçš„ä¸€ä¸ªå¯¹è±¡ç½¢äº†ï¼ å†…è” style å±æ€§ ä½¿ç”¨é©¼å³°å‘½åæ³•ç¼–å†™ã€‚ä¾‹å¦‚ï¼ŒHTML ul style=background-color: black åœ¨ä½ çš„ç»„ä»¶é‡Œåº”è¯¥å†™æˆ ul style= backgroundColor: 'black' ã€‚ 2.2.4.4 JavaScript å¯¹è±¡å’Œå¤§æ‹¬å·çš„æ›´å¤šå¯èƒ½ä½ å¯ä»¥å°†å¤šä¸ªè¡¨è¾¾å¼åˆå¹¶åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œåœ¨ JSX çš„å¤§æ‹¬å·å†…åˆ†åˆ«ä½¿ç”¨å®ƒä»¬ï¼š const person = name: Gregorio Y. Zara, theme: backgroundColor: black, color: pink ;export default function TodoList() return ( div style=person.theme h1person.names Todos/h1 img className=avatar src=https://i.imgur.com/7vQD0fPs.jpg alt=Gregorio Y. Zara / ul liImprove the videophone/li liPrepare aeronautics lectures/li liWork on the alcohol-fuelled engine/li /ul /div ); ç°åœ¨ä½ å‡ ä¹äº†è§£äº†æœ‰å…³ JSX çš„ä¸€åˆ‡ï¼š JSX å¼•å·å†…çš„å€¼ä¼šä½œä¸ºå­—ç¬¦ä¸²ä¼ é€’ç»™å±æ€§ã€‚ å¤§æ‹¬å·è®©ä½ å¯ä»¥å°† JavaScript çš„é€»è¾‘å’Œå˜é‡å¸¦å…¥åˆ°æ ‡ç­¾ä¸­ã€‚ å®ƒä»¬ä¼šåœ¨ JSX æ ‡ç­¾ä¸­çš„å†…å®¹åŒºåŸŸæˆ–ç´§éšå±æ€§çš„ = åèµ·ä½œç”¨ã€‚ ` å’Œ ` å¹¶ä¸æ˜¯ä»€ä¹ˆç‰¹æ®Šçš„è¯­æ³•ï¼šå®ƒåªæ˜¯åŒ…åœ¨ JSX å¤§æ‹¬å·å†…çš„ JavaScript å¯¹è±¡ã€‚ 2.3 çˆ¶å­ç»„ä»¶å±æ€§ä¼ é€’React ç»„ä»¶ä½¿ç”¨ props æ¥äº’ç›¸é€šä¿¡ã€‚æ¯ä¸ªçˆ¶ç»„ä»¶éƒ½å¯ä»¥æä¾› props ç»™å®ƒçš„å­ç»„ä»¶ï¼Œä»è€Œå°†ä¸€äº›ä¿¡æ¯ä¼ é€’ç»™å®ƒã€‚Props å¯èƒ½ä¼šè®©ä½ æƒ³èµ· HTML å±æ€§ï¼Œä½†ä½ å¯ä»¥é€šè¿‡å®ƒä»¬ä¼ é€’ä»»ä½• JavaScript å€¼ï¼ŒåŒ…æ‹¬å¯¹è±¡ã€æ•°ç»„å’Œå‡½æ•°ã€‚ 2.3.1 ç®€ä»‹Props æ˜¯ä½ ä¼ é€’ç»™ JSX æ ‡ç­¾çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼ŒclassNameã€srcã€altã€width å’Œ height ä¾¿æ˜¯ä¸€äº›å¯ä»¥ä¼ é€’ç»™ img çš„ propsï¼š function Avatar() return ( img className=avatar src=https://i.imgur.com/1bX5QH6.jpg alt=Lin Lanying width=100 height=100 / );export default function Profile() return ( Avatar / ); ä½ å¯ä»¥ä¼ é€’ç»™ img æ ‡ç­¾çš„ props æ˜¯é¢„å®šä¹‰çš„ï¼ˆReactDOM ç¬¦åˆ HTML æ ‡å‡†ï¼‰ã€‚ä½†æ˜¯ä½ å¯ä»¥å°†ä»»ä½• props ä¼ é€’ç»™ ä½ è‡ªå·±çš„ ç»„ä»¶ï¼Œä¾‹å¦‚ Avatar ï¼Œä»¥ä¾¿è‡ªå®šä¹‰å®ƒä»¬ã€‚ 2.3.2 å‘ç»„ä»¶ä¼ é€’ propsåœ¨è¿™æ®µä»£ç ä¸­ï¼Œ Profile ç»„ä»¶æ²¡æœ‰å‘å®ƒçš„å­ç»„ä»¶ Avatar ä¼ é€’ä»»ä½• props ï¼š export default function Profile() return ( Avatar / ); ä½ å¯ä»¥åˆ†ä¸¤æ­¥ç»™ Avatar ä¸€äº› propsã€‚ æ­¥éª¤ä¸€ï¼šå°† props ä¼ é€’ç»™å­ç»„ä»¶ é¦–å…ˆï¼Œå°†ä¸€äº› props ä¼ é€’ç»™ Avatarã€‚ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬ä¼ é€’ä¸¤ä¸ª propsï¼špersonï¼ˆä¸€ä¸ªå¯¹è±¡ï¼‰å’Œ sizeï¼ˆä¸€ä¸ªæ•°å­—ï¼‰ï¼š export default function Profile() return ( Avatar person= name: Lin Lanying, imageId: 1bX5QH6 size=100 / ); ç°åœ¨ï¼Œä½ å¯ä»¥åœ¨ Avatar ç»„ä»¶ä¸­è¯»å–è¿™äº› props äº†ã€‚ æ­¥éª¤äºŒï¼šåœ¨å­ç»„ä»¶ä¸­è¯»å– props ä½ å¯ä»¥é€šè¿‡åœ¨ function Avatar ä¹‹åç›´æ¥åˆ—å‡ºå®ƒä»¬çš„åå­— person, size æ¥è¯»å–è¿™äº› propsã€‚è¿™äº› props åœ¨ ( å’Œ ) ä¹‹é—´ï¼Œå¹¶ç”±é€—å·åˆ†éš”ã€‚è¿™æ ·ï¼Œä½ å¯ä»¥åœ¨ Avatar çš„ä»£ç ä¸­ä½¿ç”¨å®ƒä»¬ï¼Œå°±åƒä½¿ç”¨å˜é‡ä¸€æ ·ã€‚ function Avatar( person, size ) // åœ¨è¿™é‡Œ person å’Œ size æ˜¯å¯è®¿é—®çš„ å‘ä½¿ç”¨ person å’Œ size props æ¸²æŸ“çš„ Avatar æ·»åŠ ä¸€äº›é€»è¾‘ï¼Œä½ å°±å®Œæˆäº†ã€‚ ç°åœ¨ä½ å¯ä»¥é…ç½® Avatar ï¼Œé€šè¿‡ä¸åŒçš„ propsï¼Œä½¿å®ƒèƒ½ä»¥å¤šç§ä¸åŒçš„æ–¹å¼è¿›è¡Œæ¸²æŸ“ã€‚å°è¯•å˜æ¢å€¼å§ï¼ export function getImageUrl(person, size = s) return ( https://i.imgur.com/ + person.imageId + size + .jpg ); import getImageUrl from ./utils.js;function Avatar( person, size ) return ( img className=avatar src=getImageUrl(person) alt=person.name width=size height=size / );export default function Profile() return ( div Avatar size=100 person= name: Katsuko Saruhashi, imageId: YfeOqp2 / Avatar size=80 person= name: Aklilu Lemma, imageId: OKS67lh / /div ); Props ä½¿ä½ ç‹¬ç«‹æ€è€ƒçˆ¶ç»„ä»¶å’Œå­ç»„ä»¶ã€‚ ä¾‹å¦‚ï¼Œä½ å¯ä»¥æ”¹å˜ Profile ä¸­çš„ person æˆ– size propsï¼Œè€Œæ— éœ€è€ƒè™‘ Avatar å¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚ åŒæ ·ï¼Œä½ å¯ä»¥æ”¹å˜ Avatar ä½¿ç”¨è¿™äº› props çš„æ–¹å¼ï¼Œä¸å¿…è€ƒè™‘ Profileã€‚ ä½ å¯ä»¥å°† props æƒ³è±¡æˆå¯ä»¥è°ƒæ•´çš„â€œæ—‹é’®â€ã€‚å®ƒä»¬çš„ä½œç”¨ä¸å‡½æ•°çš„å‚æ•°ç›¸åŒ â€”â€” äº‹å®ä¸Šï¼Œprops æ­£æ˜¯ ç»„ä»¶çš„å”¯ä¸€å‚æ•°ï¼ React ç»„ä»¶å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œä¸€ä¸ª props å¯¹è±¡ï¼š function Avatar(props) let person = props.person; let size = props.size; // ... é€šå¸¸ä½ ä¸éœ€è¦æ•´ä¸ª props å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥å°†å®ƒè§£æ„ä¸ºå•ç‹¬çš„ propsã€‚ åœ¨å£°æ˜ props æ—¶ï¼Œ ä¸è¦å¿˜è®° ( å’Œ ) ä¹‹é—´çš„ä¸€å¯¹èŠ±æ‹¬å· å’Œ ï¼š function Avatar( person, size ) // ... è¿™ç§è¯­æ³•è¢«ç§°ä¸º â€œè§£æ„â€ï¼Œç­‰ä»·äºäºä»å‡½æ•°å‚æ•°ä¸­è¯»å–å±æ€§ï¼š function Avatar(props) let person = props.person; let size = props.size; // ... 2.3.3 ç»™ prop æŒ‡å®šä¸€ä¸ªé»˜è®¤å€¼å¦‚æœä½ æƒ³åœ¨æ²¡æœ‰æŒ‡å®šå€¼çš„æƒ…å†µä¸‹ç»™ prop ä¸€ä¸ªé»˜è®¤å€¼ï¼Œä½ å¯ä»¥é€šè¿‡åœ¨å‚æ•°åé¢å†™ = å’Œé»˜è®¤å€¼æ¥è¿›è¡Œè§£æ„ï¼š function Avatar( person, size = 100 ) // ... ç°åœ¨ï¼Œ å¦‚æœ Avatar person=... / æ¸²æŸ“æ—¶æ²¡æœ‰ size propï¼Œ size å°†è¢«èµ‹å€¼ä¸º 100ã€‚ é»˜è®¤å€¼ä»…åœ¨ç¼ºå°‘ size prop æˆ– size=undefined æ—¶ç”Ÿæ•ˆã€‚ ä½†æ˜¯å¦‚æœä½ ä¼ é€’äº† size=null æˆ– size=0ï¼Œé»˜è®¤å€¼å°† ä¸ è¢«ä½¿ç”¨ã€‚ 2.3.4 ä½¿ç”¨ JSX å±•å¼€è¯­æ³•ä¼ é€’ propsæœ‰æ—¶å€™ï¼Œä¼ é€’ props ä¼šå˜å¾—éå¸¸é‡å¤ï¼š function Profile( person, size, isSepia, thickBorder ) return ( div className=card Avatar person=person size=size isSepia=isSepia thickBorder=thickBorder / /div ); é‡å¤ä»£ç æ²¡æœ‰é”™ï¼ˆå®ƒå¯ä»¥æ›´æ¸…æ™°ï¼‰ã€‚ä½†æœ‰æ—¶ä½ å¯èƒ½ä¼šé‡è§†ç®€æ´ã€‚ä¸€äº›ç»„ä»¶å°†å®ƒä»¬æ‰€æœ‰çš„ props è½¬å‘ç»™å­ç»„ä»¶ï¼Œæ­£å¦‚ Profile è½¬ç»™ Avatar é‚£æ ·ã€‚å› ä¸ºè¿™äº›ç»„ä»¶ä¸ç›´æ¥ä½¿ç”¨ä»–ä»¬æœ¬èº«çš„ä»»ä½• propsï¼Œæ‰€ä»¥ä½¿ç”¨æ›´ç®€æ´çš„â€œå±•å¼€â€è¯­æ³•æ˜¯æœ‰æ„ä¹‰çš„ï¼š function Profile(props) return ( div className=card Avatar ...props / /div ); è¿™ä¼šå°† Profile çš„æ‰€æœ‰ props è½¬å‘åˆ° Avatarï¼Œè€Œä¸åˆ—å‡ºæ¯ä¸ªåå­—ã€‚ è¯·å…‹åˆ¶åœ°ä½¿ç”¨å±•å¼€è¯­æ³•ã€‚ å¦‚æœä½ åœ¨æ‰€æœ‰å…¶ä»–ç»„ä»¶ä¸­éƒ½ä½¿ç”¨å®ƒï¼Œé‚£å°±æœ‰é—®é¢˜äº†ã€‚ é€šå¸¸ï¼Œå®ƒè¡¨ç¤ºä½ åº”è¯¥æ‹†åˆ†ç»„ä»¶ï¼Œå¹¶å°†å­ç»„ä»¶ä½œä¸º JSX ä¼ é€’ã€‚ 2.3.5 å°† JSX ä½œä¸ºå­ç»„ä»¶ä¼ é€’åµŒå¥—æµè§ˆå™¨å†…ç½®æ ‡ç­¾æ˜¯å¾ˆå¸¸è§çš„ï¼š div img //div æœ‰æ—¶ä½ ä¼šå¸Œæœ›ä»¥ç›¸åŒçš„æ–¹å¼åµŒå¥—è‡ªå·±çš„ç»„ä»¶ï¼š Card Avatar //Card å½“å°†å†…å®¹åµŒå¥—åœ¨ JSX æ ‡ç­¾ä¸­æ—¶ï¼Œçˆ¶ç»„ä»¶å°†åœ¨åä¸º children çš„ prop ä¸­æ¥æ”¶åˆ°è¯¥å†…å®¹ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ Card ç»„ä»¶å°†æ¥æ”¶ä¸€ä¸ªè¢«è®¾ä¸º Avatar / çš„ children prop å¹¶å°†å…¶åŒ…è£¹åœ¨ div ä¸­æ¸²æŸ“ï¼š App.js import Avatar from ./Avatar.js;function Card( children ) return ( div className=card children /div );export default function Profile() return ( Card Avatar size=100 person= name: Katsuko Saruhashi, imageId: YfeOqp2 / /Card ); Avatar.js import getImageUrl from ./utils.js;export default function Avatar( person, size ) return ( img className=avatar src=getImageUrl(person) alt=person.name width=size height=size / ); utils.js export function getImageUrl(person, size = s) return ( https://i.imgur.com/ + person.imageId + size + .jpg ); å°è¯•ç”¨ä¸€äº›æ–‡æœ¬æ›¿æ¢ Card ä¸­çš„ Avatarï¼Œçœ‹çœ‹ Card ç»„ä»¶å¦‚ä½•åŒ…è£¹ä»»æ„åµŒå¥—å†…å®¹ã€‚å®ƒä¸å¿…â€œçŸ¥é“â€å…¶ä¸­æ¸²æŸ“çš„å†…å®¹ã€‚ä½ ä¼šåœ¨å¾ˆå¤šåœ°æ–¹çœ‹åˆ°è¿™ç§çµæ´»çš„æ¨¡å¼ã€‚ å¯ä»¥å°†å¸¦æœ‰ children prop çš„ç»„ä»¶çœ‹ä½œæœ‰ä¸€ä¸ªâ€œæ´â€ï¼Œå¯ä»¥ç”±å…¶çˆ¶ç»„ä»¶ä½¿ç”¨ä»»æ„ JSX æ¥â€œå¡«å……â€ã€‚ä½ ä¼šç»å¸¸ä½¿ç”¨ children prop æ¥è¿›è¡Œè§†è§‰åŒ…è£…ï¼šé¢æ¿ã€ç½‘æ ¼ç­‰ç­‰ã€‚ 2.3.6 Props å¦‚ä½•éšæ—¶é—´å˜åŒ–ä¸‹é¢çš„ Clock ç»„ä»¶ä»å…¶çˆ¶ç»„ä»¶æ¥æ”¶ä¸¤ä¸ª propsï¼šcolor å’Œ timeã€‚ï¼ˆçˆ¶ç»„ä»¶çš„ä»£ç è¢«çœç•¥ï¼Œå› ä¸ºå®ƒä½¿ç”¨ stateï¼Œæˆ‘ä»¬æš‚æ—¶ä¸ä¼šæ·±å…¥ç ”ç©¶ã€‚ï¼‰ å°è¯•åœ¨ä¸‹é¢çš„é€‰æ‹©æ¡†ä¸­æ›´æ”¹é¢œè‰²ï¼š export default function Clock( color, time ) return ( h1 style= color: color time /h1 ); è¿™ä¸ªä¾‹å­è¯´æ˜ï¼Œä¸€ä¸ªç»„ä»¶å¯èƒ½ä¼šéšç€æ—¶é—´çš„æ¨ç§»æ”¶åˆ°ä¸åŒçš„ propsã€‚ Props å¹¶ä¸æ€»æ˜¯é™æ€çš„ï¼åœ¨è¿™é‡Œï¼Œtime prop æ¯ç§’éƒ½åœ¨å˜åŒ–ã€‚å½“ä½ é€‰æ‹©å¦ä¸€ç§é¢œè‰²æ—¶ï¼Œcolor prop ä¹Ÿæ”¹å˜äº†ã€‚Props åæ˜ äº†ç»„ä»¶åœ¨ä»»ä½•æ—¶é—´ç‚¹çš„æ•°æ®ï¼Œå¹¶ä¸ä»…ä»…æ˜¯åœ¨å¼€å§‹æ—¶ã€‚ ç„¶è€Œï¼Œprops æ˜¯ ä¸å¯å˜çš„ï¼ˆä¸€ä¸ªè®¡ç®—æœºç§‘å­¦æœ¯è¯­ï¼Œæ„æ€æ˜¯â€œä¸å¯æ”¹å˜â€ï¼‰ã€‚å½“ä¸€ä¸ªç»„ä»¶éœ€è¦æ”¹å˜å®ƒçš„ propsï¼ˆä¾‹å¦‚ï¼Œå“åº”ç”¨æˆ·äº¤äº’æˆ–æ–°æ•°æ®ï¼‰æ—¶ï¼Œå®ƒä¸å¾—ä¸â€œè¯·æ±‚â€å®ƒçš„çˆ¶ç»„ä»¶ä¼ é€’ ä¸åŒçš„ props â€”â€” ä¸€ä¸ªæ–°å¯¹è±¡ï¼å®ƒçš„æ—§ props å°†è¢«ä¸¢å¼ƒï¼Œæœ€ç»ˆ JavaScript å¼•æ“å°†å›æ”¶å®ƒä»¬å ç”¨çš„å†…å­˜ã€‚ ä¸è¦å°è¯•â€œæ›´æ”¹ propsâ€ã€‚ å½“ä½ éœ€è¦å“åº”ç”¨æˆ·è¾“å…¥ï¼ˆä¾‹å¦‚æ›´æ”¹æ‰€é€‰é¢œè‰²ï¼‰æ—¶ï¼Œä½ å¯ä»¥â€œè®¾ç½® stateâ€ï¼Œä½ å¯ä»¥åœ¨ State: ä¸€ä¸ªç»„ä»¶çš„å†…å­˜ ä¸­ç»§ç»­äº†è§£ã€‚ 2.4 æ¡ä»¶æ¸²æŸ“é€šå¸¸ä½ çš„ç»„ä»¶ä¼šéœ€è¦æ ¹æ®ä¸åŒçš„æƒ…å†µæ˜¾ç¤ºä¸åŒçš„å†…å®¹ã€‚åœ¨ React ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ JavaScript çš„ if è¯­å¥ã€ å’Œ ? : è¿ç®—ç¬¦æ¥é€‰æ‹©æ€§åœ°æ¸²æŸ“ JSXã€‚ 2.4.1 æ¡ä»¶è¿”å› JSXå‡è®¾æœ‰ä¸€ä¸ª PackingList ç»„ä»¶ï¼Œé‡Œé¢æ¸²æŸ“å¤šä¸ª Item ç»„ä»¶ï¼Œæ¯ä¸ªç‰©å“å¯æ ‡è®°ä¸ºæ‰“åŒ…ä¸å¦ï¼š function Item( name, isPacked ) return li className=itemname/li;export default function PackingList() return ( section h1Sally Ride çš„è¡Œææ¸…å•/h1 ul Item isPacked=true name=å®‡èˆªæœ / Item isPacked=true name=å¸¦é‡‘ç®”çš„å¤´ç›” / Item isPacked=false name=Tam çš„ç…§ç‰‡ / /ul /section ); éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ‰äº› Item ç»„ä»¶çš„ isPacked å±æ€§æ˜¯è¢«è®¾ä¸º true è€Œä¸æ˜¯ falseã€‚ä½ å¯ä»¥åœ¨é‚£äº›æ»¡è¶³ isPacked=true æ¡ä»¶çš„ç‰©å“æ—åŠ ä¸Šä¸€ä¸ªå‹¾é€‰ç¬¦å·ï¼ˆâœ…ï¼‰ã€‚ ä½ å¯ä»¥ç”¨ ifelse è¯­å¥ å»åˆ¤æ–­ï¼š if (isPacked) return li className=itemname âœ…/li;return li className=itemname/li; å¦‚æœ isPacked å±æ€§æ˜¯ trueï¼Œè¿™æ®µä»£ç ä¼šè¿”å›ä¸€ä¸ªä¸ä¸€æ ·çš„ JSXã€‚é€šè¿‡è¿™æ ·çš„æ”¹åŠ¨ï¼Œä¸€äº›ç‰©å“çš„åå­—åé¢ä¼šå‡ºç°ä¸€ä¸ªå‹¾é€‰ç¬¦å·ï¼š function Item( name, isPacked ) if (isPacked) return li className=itemname âœ…/li; return li className=itemname/li;export default function PackingList() return ( section h1Sally Ride çš„è¡Œææ¸…å•/h1 ul Item isPacked=true name=å®‡èˆªæœ / Item isPacked=true name=å¸¦é‡‘ç®”çš„å¤´ç›” / Item isPacked=false name=Tam çš„ç…§ç‰‡ / /ul /section ); ç•™æ„è¿™é‡Œä½ æ˜¯æ€ä¹ˆä½¿ç”¨ JavaScript çš„ if å’Œ return è¯­å¥æ¥å†™åˆ†æ”¯é€»è¾‘ã€‚åœ¨ React ä¸­ï¼Œæ˜¯ç”± JavaScript æ¥å¤„ç†æ§åˆ¶æµçš„ï¼ˆæ¯”å¦‚æ¡ä»¶ï¼‰ã€‚ 2.4.2 é€‰æ‹©æ€§è¿”å› nullåœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œä½ ä¸æƒ³æœ‰ä»»ä½•ä¸œè¥¿è¿›è¡Œæ¸²æŸ“ã€‚æ¯”å¦‚ï¼Œä½ ä¸æƒ³æ˜¾ç¤ºå·²ç»æ‰“åŒ…å¥½çš„ç‰©å“ã€‚ä½†ä¸€ä¸ªç»„ä»¶å¿…é¡»è¿”å›ä¸€äº›ä¸œè¥¿ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ç›´æ¥è¿”å› nullã€‚ if (isPacked) return null;return li className=itemname/li; å¦‚æœç»„ä»¶çš„ isPacked å±æ€§ä¸º trueï¼Œé‚£ä¹ˆå®ƒå°†åªè¿”å› nullã€‚å¦åˆ™ï¼Œå®ƒå°†è¿”å›ç›¸åº”çš„ JSX ç”¨æ¥æ¸²æŸ“ã€‚ function Item( name, isPacked ) if (isPacked) return null; return li className=itemname/li;export default function PackingList() return ( section h1Sally Ride çš„è¡Œææ¸…å•/h1 ul Item isPacked=true name=å®‡èˆªæœ / Item isPacked=true name=å¸¦é‡‘ç®”çš„å¤´ç›” / Item isPacked=false name=Tam çš„ç…§ç‰‡ / /ul /section ); å®é™…ä¸Šï¼Œåœ¨ç»„ä»¶é‡Œè¿”å› null å¹¶ä¸å¸¸è§ï¼Œå› ä¸ºè¿™æ ·ä¼šè®©æƒ³ä½¿ç”¨å®ƒçš„å¼€å‘è€…æ„Ÿè§‰å¥‡æ€ªã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥åœ¨çˆ¶ç»„ä»¶é‡Œé€‰æ‹©æ˜¯å¦è¦æ¸²æŸ“è¯¥ç»„ä»¶ã€‚è®©æˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹å§ï¼ 2.4.3 é€‰æ‹©æ€§åœ°åŒ…å« JSXåœ¨ä¹‹å‰çš„ä¾‹å­é‡Œï¼Œä½ åœ¨ç»„ä»¶å†…éƒ¨æ§åˆ¶å“ªäº› JSX æ ‘ï¼ˆå¦‚æœæœ‰çš„è¯ï¼ï¼‰ä¼šè¿”å›ã€‚ä½ å¯èƒ½å·²ç»å‘ç°äº†åœ¨æ¸²æŸ“è¾“å‡ºé‡Œä¼šæœ‰ä¸€äº›é‡å¤çš„å†…å®¹ï¼š li className=itemname âœ…/li å’Œä¸‹é¢çš„å†™æ³•å¾ˆåƒï¼š li className=itemname/li ä¸¤ä¸ªæ¡ä»¶åˆ†æ”¯éƒ½ä¼šè¿”å› li className=item.../liï¼š if (isPacked) return li className=itemname âœ…/li;return li className=itemname/li; è™½ç„¶è¿™äº›é‡å¤çš„å†…å®¹æ²¡ä»€ä¹ˆå®³å¤„ï¼Œä½†è¿™æ ·å¯èƒ½ä¼šå¯¼è‡´ä½ çš„ä»£ç æ›´éš¾ç»´æŠ¤ã€‚æ¯”å¦‚ä½ æƒ³æ›´æ”¹ classNameï¼Ÿä½ å°±éœ€è¦ä¿®æ”¹ä¸¤ä¸ªåœ°æ–¹ï¼é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œä½ å¯ä»¥é€šè¿‡é€‰æ‹©æ€§åœ°åŒ…å«ä¸€å°æ®µ JSX æ¥è®©ä½ çš„ä»£ç æ›´åŠ  DRYã€‚ ä¸‰ç›®è¿ç®—ç¬¦ï¼ˆ? :ï¼‰ JavaScript æœ‰ä¸€ç§ç´§å‡‘å‹è¯­æ³•æ¥å®ç°æ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼â€”â€”æ¡ä»¶è¿ç®—ç¬¦ åˆç§°â€œä¸‰ç›®è¿ç®—ç¬¦â€ã€‚ é™¤äº†è¿™æ ·ï¼š if (isPacked) return li className=itemname âœ…/li;return li className=itemname/li; ä½ è¿˜å¯ä»¥è¿™æ ·å®ç°ï¼š return ( li className=item isPacked ? name + âœ… : name /li); ä½ å¯ä»¥è®¤ä¸ºï¼Œâ€œå¦‚æœ isPacked ä¸º true æ—¶ï¼Œåˆ™ï¼ˆ?ï¼‰æ¸²æŸ“ name + âœ…ï¼Œå¦åˆ™ï¼ˆ:ï¼‰æ¸²æŸ“ nameã€‚â€ å¦‚æœä½ ä¹‹å‰æ˜¯ä¹ æƒ¯é¢å‘å¯¹è±¡å¼€å‘çš„ï¼Œä½ å¯èƒ½ä¼šè®¤ä¸ºä¸Šé¢çš„ä¸¤ä¸ªä¾‹å­ç•¥æœ‰ä¸åŒï¼Œå› ä¸ºå…¶ä¸­ä¸€ä¸ªå¯èƒ½ä¼šåˆ›å»ºä¸¤ä¸ªä¸åŒçš„ li â€œå®ä¾‹â€ã€‚ä½† JSX å…ƒç´ ä¸æ˜¯â€œå®ä¾‹â€ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰å†…éƒ¨çŠ¶æ€ä¹Ÿä¸æ˜¯çœŸå®çš„ DOM èŠ‚ç‚¹ã€‚å®ƒä»¬åªæ˜¯ä¸€äº›ç®€å•çš„æè¿°ï¼Œå°±åƒå›¾çº¸ä¸€æ ·ã€‚æ‰€ä»¥ä¸Šé¢è¿™ä¸¤ä¸ªä¾‹å­äº‹å®ä¸Šæ˜¯å®Œå…¨ç›¸åŒçš„ã€‚åœ¨ çŠ¶æ€çš„ä¿æŒå’Œé‡ç½® é‡Œä¼šæ·±å…¥æ¢è®¨å…¶åŸå› ã€‚ ç°åœ¨ï¼Œå‡å¦‚ä½ æƒ³å°†å¯¹åº”ç‰©å“çš„æ–‡æœ¬æ”¾åˆ°å¦ä¸€ä¸ª HTML æ ‡ç­¾é‡Œï¼Œæ¯”å¦‚ç”¨ del æ¥æ˜¾ç¤ºåˆ é™¤çº¿ã€‚ä½ å¯ä»¥æ·»åŠ æ›´å¤šçš„æ¢è¡Œå’Œæ‹¬å·ï¼Œä»¥ä¾¿åœ¨å„ç§æƒ…å†µä¸‹æ›´å¥½åœ°å»åµŒå¥— JSXï¼š function Item( name, isPacked ) return ( li className=item isPacked ? ( del name + âœ… /del ) : ( name ) /li );export default function PackingList() return ( section h1Sally Ride çš„è¡Œææ¸…å•/h1 ul Item isPacked=true name=å®‡èˆªæœ / Item isPacked=true name=å¸¦é‡‘ç®”çš„å¤´ç›” / Item isPacked=false name=Tam çš„ç…§ç‰‡ / /ul /section ); å¯¹äºç®€å•çš„æ¡ä»¶åˆ¤æ–­ï¼Œè¿™æ ·çš„é£æ ¼å¯ä»¥å¾ˆå¥½åœ°å®ç°ï¼Œä½†éœ€è¦é€‚é‡ä½¿ç”¨ã€‚å¦‚æœä½ çš„ç»„ä»¶é‡Œæœ‰å¾ˆå¤šçš„åµŒå¥—å¼æ¡ä»¶è¡¨è¾¾å¼ï¼Œåˆ™éœ€è¦è€ƒè™‘é€šè¿‡æå–ä¸ºå­ç»„ä»¶æ¥ç®€åŒ–è¿™äº›åµŒå¥—è¡¨è¾¾å¼ã€‚åœ¨ React é‡Œï¼Œæ ‡ç­¾ä¹Ÿæ˜¯ä½ ä»£ç ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä½¿ç”¨å˜é‡å’Œå‡½æ•°æ¥æ•´ç†ä¸€äº›å¤æ‚çš„è¡¨è¾¾å¼ã€‚ 2.4.4 ä¸è¿ç®—ç¬¦ï¼ˆï¼‰ä½ ä¼šé‡åˆ°çš„å¦ä¸€ä¸ªå¸¸è§çš„å¿«æ·è¡¨è¾¾å¼æ˜¯ [JavaScript é€»è¾‘ä¸ï¼ˆï¼‰è¿ç®—ç¬¦](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Logical_AND#:~:text=The logical AND ( %26%26 ) operator,it returns a Boolean value.)ã€‚åœ¨ React ç»„ä»¶é‡Œï¼Œé€šå¸¸ç”¨åœ¨å½“æ¡ä»¶æˆç«‹æ—¶ï¼Œä½ æƒ³æ¸²æŸ“ä¸€äº› JSXï¼Œæˆ–è€…ä¸åšä»»ä½•æ¸²æŸ“ã€‚ä½¿ç”¨ ï¼Œä½ ä¹Ÿå¯ä»¥å®ç°ä»…å½“ isPacked ä¸º true æ—¶ï¼Œæ¸²æŸ“å‹¾é€‰ç¬¦å·ã€‚ return ( li className=item name isPacked âœ… /li); ä½ å¯ä»¥è®¤ä¸ºï¼Œâ€œå½“ isPacked ä¸ºçœŸå€¼æ—¶ï¼Œåˆ™ï¼ˆï¼‰æ¸²æŸ“å‹¾é€‰ç¬¦å·ï¼Œå¦åˆ™ï¼Œä¸æ¸²æŸ“ã€‚â€ ä¸‹é¢ä¸ºå…·ä½“çš„ä¾‹å­ï¼š function Item( name, isPacked ) return ( li className=item name isPacked âœ… /li );export default function PackingList() return ( section h1Sally Ride çš„è¡Œææ¸…å•/h1 ul Item isPacked=true name=å®‡èˆªæœ / Item isPacked=true name=å¸¦é‡‘ç®”çš„å¤´ç›” / Item isPacked=false name=Tam çš„ç…§ç‰‡ / /ul /section ); å½“ JavaScript è¡¨è¾¾å¼ çš„å·¦ä¾§ï¼ˆæˆ‘ä»¬çš„æ¡ä»¶ï¼‰ä¸º true æ—¶ï¼Œå®ƒåˆ™è¿”å›å…¶å³ä¾§çš„å€¼ï¼ˆåœ¨æˆ‘ä»¬çš„ä¾‹å­é‡Œæ˜¯å‹¾é€‰ç¬¦å·ï¼‰ã€‚ä½†æ¡ä»¶çš„ç»“æœæ˜¯ falseï¼Œåˆ™æ•´ä¸ªè¡¨è¾¾å¼ä¼šå˜æˆ falseã€‚åœ¨ JSX é‡Œï¼ŒReact ä¼šå°† false è§†ä¸ºä¸€ä¸ªâ€œç©ºå€¼â€ï¼Œå°±åƒ null æˆ–è€… undefinedï¼Œè¿™æ · React å°±ä¸ä¼šåœ¨è¿™é‡Œè¿›è¡Œä»»ä½•æ¸²æŸ“ã€‚ åˆ‡å‹¿å°†æ•°å­—æ”¾åœ¨ å·¦ä¾§. JavaScript ä¼šè‡ªåŠ¨å°†å·¦ä¾§çš„å€¼è½¬æ¢æˆå¸ƒå°”ç±»å‹ä»¥åˆ¤æ–­æ¡ä»¶æˆç«‹ä¸å¦ã€‚ç„¶è€Œï¼Œå¦‚æœå·¦ä¾§æ˜¯ 0ï¼Œæ•´ä¸ªè¡¨è¾¾å¼å°†å˜æˆå·¦ä¾§çš„å€¼ï¼ˆ0ï¼‰ï¼ŒReact æ­¤æ—¶åˆ™ä¼šæ¸²æŸ“ 0 è€Œä¸æ˜¯ä¸è¿›è¡Œæ¸²æŸ“ã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªå¸¸è§çš„é”™è¯¯æ˜¯ messageCount pNew messages/pã€‚å…¶åŸæœ¬æ˜¯æƒ³å½“ messageCount ä¸º 0 çš„æ—¶å€™ä¸è¿›è¡Œæ¸²æŸ“ï¼Œä½†å®é™…ä¸Šå´æ¸²æŸ“äº† 0ã€‚ ä¸ºäº†æ›´æ­£ï¼Œå¯ä»¥å°†å·¦ä¾§çš„å€¼æ”¹æˆå¸ƒå°”ç±»å‹ï¼šmessageCount 0 pNew messages/pã€‚ 2.4.5 é€‰æ‹©æ€§åœ°å°† JSX èµ‹å€¼ç»™å˜é‡å½“è¿™äº›å¿«æ·æ–¹å¼å¦¨ç¢å†™æ™®é€šä»£ç æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ if è¯­å¥å’Œå˜é‡ã€‚å› ä¸ºä½ å¯ä»¥ä½¿ç”¨ let è¿›è¡Œé‡å¤èµ‹å€¼ï¼Œæ‰€ä»¥ä¸€å¼€å§‹ä½ å¯ä»¥å°†ä½ æƒ³å±•ç¤ºçš„ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯ç‰©å“çš„åå­—ï¼‰ä½œä¸ºé»˜è®¤å€¼èµ‹äºˆç»™è¯¥å˜é‡ã€‚ let itemContent = name; ç»“åˆ if è¯­å¥ï¼Œå½“ isPacked ä¸º true æ—¶ï¼Œå°† JSX è¡¨è¾¾å¼çš„å€¼é‡æ–°èµ‹å€¼ç»™ itemContentï¼š if (isPacked) itemContent = name + âœ…; åœ¨ JSX ä¸­é€šè¿‡å¤§æ‹¬å·ä½¿ç”¨ JavaScriptã€‚å°†å˜é‡ç”¨å¤§æ‹¬å·åµŒå…¥åœ¨è¿”å›çš„ JSX æ ‘ä¸­ï¼Œæ¥åµŒå¥—è®¡ç®—å¥½çš„è¡¨è¾¾å¼ä¸ JSXï¼š li className=item itemContent/li è¿™ç§æ–¹å¼æ˜¯æœ€å†—é•¿çš„ï¼Œä½†ä¹Ÿæ˜¯æœ€çµæ´»çš„ã€‚ä¸‹é¢æ˜¯ç›¸å…³çš„ä¾‹å­ï¼š function Item( name, isPacked ) let itemContent = name; if (isPacked) itemContent = name + âœ…; return ( li className=item itemContent /li );export default function PackingList() return ( section h1Sally Ride çš„è¡Œææ¸…å•/h1 ul Item isPacked=true name=å®‡èˆªæœ / Item isPacked=true name=å¸¦é‡‘ç®”çš„å¤´ç›” / Item isPacked=false name=Tam çš„ç…§ç‰‡ / /ul /section ); è·Ÿä¹‹å‰çš„ä¸€æ ·ï¼Œè¿™ä¸ªæ–¹å¼ä¸ä»…ä»…é€‚ç”¨äºæ–‡æœ¬ï¼Œä»»æ„çš„ JSX å‡é€‚ç”¨ï¼š function Item( name, isPacked ) let itemContent = name; if (isPacked) itemContent = ( del name + âœ… /del ); return ( li className=item itemContent /li );export default function PackingList() return ( section h1Sally Ride çš„è¡Œææ¸…å•/h1 ul Item isPacked=true name=å®‡èˆªæœ / Item isPacked=true name=å¸¦é‡‘ç®”çš„å¤´ç›” / Item isPacked=false name=Tam çš„ç…§ç‰‡ / /ul /section ); å¦‚æœå¯¹ JavaScript ä¸ç†Ÿæ‚‰ï¼Œè¿™äº›ä¸åŒçš„é£æ ¼ä¸€å¼€å§‹å¯èƒ½ä¼šè®©ä½ æ„Ÿåˆ°ä¸çŸ¥æ‰€æªã€‚ä½†æ˜¯ï¼Œå­¦ä¹ è¿™äº›å°†æœ‰åŠ©äºä½ ç†è§£å’Œå†™ä»»ä½•çš„ JavaScript ä»£ç ï¼Œè€Œä¸ä»…ä»…æ˜¯ React ç»„ä»¶ã€‚ä¸€å¼€å§‹å¯ä»¥é€‰æ‹©ä¸€ä¸ªä½ å–œæ¬¢çš„æ¥ç”¨ï¼Œç„¶åå½“ä½ å¿˜è®°å…¶ä»–çš„æ€ä¹ˆç”¨æ—¶ï¼Œå¯ä»¥å†ç¿»é˜…è¿™ä»½å‚è€ƒèµ„æ–™ã€‚ 2.5 æ¸²æŸ“åˆ—è¡¨ä½ å¯èƒ½ç»å¸¸éœ€è¦é€šè¿‡ JavaScript çš„æ•°ç»„æ–¹æ³• æ¥æ“ä½œæ•°ç»„ä¸­çš„æ•°æ®ï¼Œä»è€Œå°†ä¸€ä¸ªæ•°æ®é›†æ¸²æŸ“æˆå¤šä¸ªç›¸ä¼¼çš„ç»„ä»¶ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä½ å°†å­¦ä¼šå¦‚ä½•åœ¨ React ä¸­ä½¿ç”¨ filter() ç­›é€‰éœ€è¦æ¸²æŸ“çš„ç»„ä»¶å’Œä½¿ç”¨ map() æŠŠæ•°ç»„è½¬æ¢æˆç»„ä»¶æ•°ç»„ã€‚ 2.5.1 ä»æ•°ç»„ä¸­æ¸²æŸ“æ•°æ®è¿™é‡Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåˆ—è¡¨ã€‚ ul liå‡¯ç‘Ÿç³Â·çº¦ç¿°é€Š: æ•°å­¦å®¶/li lié©¬é‡Œå¥¥Â·è«åˆ©çº³: åŒ–å­¦å®¶/li liç©†ç½•é»˜å¾·Â·é˜¿åœæœå‹’Â·è¨æ‹‰å§†: ç‰©ç†å­¦å®¶/li liç€è¥¿Â·è±æ¸©Â·æœ±åˆ©äºš: åŒ–å­¦å®¶/li liè‹å¸ƒæ‹‰é©¬å°¼æ‰¬Â·é’±å¾·æ‹‰å¡å¡: å¤©ä½“ç‰©ç†å­¦å®¶/li/ul å¯ä»¥çœ‹åˆ°ï¼Œè¿™äº›åˆ—è¡¨é¡¹ä¹‹é—´å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯å…¶ä¸­çš„å†…å®¹æ•°æ®ã€‚æœªæ¥ä½ å¯èƒ½ä¼šç¢°åˆ°å¾ˆå¤šç±»ä¼¼çš„æƒ…å†µï¼Œåœ¨é‚£äº›åœºæ™¯ä¸­ï¼Œä½ æƒ³åŸºäºä¸åŒçš„æ•°æ®æ¸²æŸ“å‡ºç›¸ä¼¼çš„ç»„ä»¶ï¼Œæ¯”å¦‚è¯„è®ºåˆ—è¡¨æˆ–è€…ä¸ªäººèµ„æ–™çš„å›¾åº“ã€‚åœ¨è¿™æ ·çš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥æŠŠè¦ç”¨åˆ°çš„æ•°æ®å­˜å…¥ JavaScript å¯¹è±¡æˆ–æ•°ç»„ï¼Œç„¶åç”¨ map() æˆ– filter() è¿™æ ·çš„æ–¹æ³•æ¥æ¸²æŸ“å‡ºä¸€ä¸ªç»„ä»¶åˆ—è¡¨ã€‚ è¿™é‡Œç»™å‡ºä¸€ä¸ªç”±æ•°ç»„ç”Ÿæˆä¸€ç³»åˆ—åˆ—è¡¨é¡¹çš„ç®€å•ç¤ºä¾‹ï¼š é¦–å…ˆï¼ŒæŠŠæ•°æ® å­˜å‚¨ åˆ°æ•°ç»„ä¸­ï¼š const people = [ å‡¯ç‘Ÿç³Â·çº¦ç¿°é€Š: æ•°å­¦å®¶, é©¬é‡Œå¥¥Â·è«åˆ©çº³: åŒ–å­¦å®¶, ç©†ç½•é»˜å¾·Â·é˜¿åœæœå‹’Â·è¨æ‹‰å§†: ç‰©ç†å­¦å®¶, ç€è¥¿Â·è±æ¸©Â·æœ±åˆ©äºš: åŒ–å­¦å®¶, è‹å¸ƒæ‹‰é©¬å°¼æ‰¬Â·é’±å¾·æ‹‰å¡å¡: å¤©ä½“ç‰©ç†å­¦å®¶,]; éå† people è¿™ä¸ªæ•°ç»„ä¸­çš„æ¯ä¸€é¡¹ï¼Œå¹¶è·å¾—ä¸€ä¸ªæ–°çš„ JSX èŠ‚ç‚¹æ•°ç»„ listItemsï¼š const listItems = people.map(person = liperson/li); æŠŠ listItems ç”¨ ul åŒ…è£¹èµ·æ¥ï¼Œç„¶å è¿”å› å®ƒï¼š return ullistItems/ul; æ¥çœ‹çœ‹è¿è¡Œçš„ç»“æœï¼š const people = [ å‡¯ç‘Ÿç³Â·çº¦ç¿°é€Š: æ•°å­¦å®¶, é©¬é‡Œå¥¥Â·è«åˆ©çº³: åŒ–å­¦å®¶, ç©†ç½•é»˜å¾·Â·é˜¿åœæœå‹’Â·è¨æ‹‰å§†: ç‰©ç†å­¦å®¶, ç€è¥¿Â·è±æ¸©Â·æœ±åˆ©äºš: åŒ–å­¦å®¶, è‹å¸ƒæ‹‰é©¬å°¼æ‰¬Â·é’±å¾·æ‹‰å¡å¡: å¤©ä½“ç‰©ç†å­¦å®¶,];export default function List() const listItems = people.map(person = liperson/li ); return ullistItems/ul; æ³¨æ„ä¸Šé¢çš„æ²™ç›’å¯èƒ½ä¼šè¾“å‡ºè¿™æ ·ä¸€ä¸ªæ§åˆ¶å°é”™è¯¯ã€‚ ç­‰ä¼šæˆ‘ä»¬ä¼šå­¦åˆ°æ€ä¹ˆä¿®å¤å®ƒã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å¦‚ä½•æŠŠè¿™ä¸ªæ•°ç»„å˜å¾—æ›´åŠ ç»“æ„åŒ–ã€‚ 2.5.2 å¯¹æ•°ç»„é¡¹è¿›è¡Œè¿‡æ»¤è®©æˆ‘ä»¬æŠŠ people æ•°ç»„å˜å¾—æ›´åŠ ç»“æ„åŒ–ä¸€ç‚¹ã€‚ const people = [ id: 0, name: å‡¯ç‘Ÿç³Â·çº¦ç¿°é€Š, profession: æ•°å­¦å®¶,, id: 1, name: é©¬é‡Œå¥¥Â·è«åˆ©çº³, profession: åŒ–å­¦å®¶,, id: 2, name: ç©†ç½•é»˜å¾·Â·é˜¿åœæœå‹’Â·è¨æ‹‰å§†, profession: ç‰©ç†å­¦å®¶,, id: 3, name: ç€è¥¿Â·è±æ¸©Â·æœ±åˆ©äºš, profession: åŒ–å­¦å®¶,, id: 4, name: è‹å¸ƒæ‹‰é©¬å°¼æ‰¬Â·é’±å¾·æ‹‰å¡å¡, profession: å¤©ä½“ç‰©ç†å­¦å®¶,]; ç°åœ¨ï¼Œå‡è®¾ä½ åªæƒ³åœ¨å±å¹•ä¸Šæ˜¾ç¤ºèŒä¸šæ˜¯ åŒ–å­¦å®¶ çš„äººã€‚é‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ JavaScript çš„ filter() æ–¹æ³•æ¥è¿”å›æ»¡è¶³æ¡ä»¶çš„é¡¹ã€‚è¿™ä¸ªæ–¹æ³•ä¼šè®©æ•°ç»„çš„å­é¡¹ç»è¿‡ â€œè¿‡æ»¤å™¨â€ï¼ˆä¸€ä¸ªè¿”å›å€¼ä¸º true æˆ– false çš„å‡½æ•°ï¼‰çš„ç­›é€‰ï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ªåªåŒ…å«æ»¡è¶³æ¡ä»¶çš„é¡¹çš„æ–°æ•°ç»„ã€‚ æ—¢ç„¶ä½ åªæƒ³æ˜¾ç¤º profession å€¼æ˜¯ åŒ–å­¦å®¶ çš„äººï¼Œé‚£ä¹ˆè¿™é‡Œçš„ â€œè¿‡æ»¤å™¨â€ å‡½æ•°åº”è¯¥é•¿è¿™æ ·ï¼š(person) = person.profession === åŒ–å­¦å®¶ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹è¯¥æ€ä¹ˆæŠŠå®ƒä»¬ç»„åˆåœ¨ä¸€èµ·ï¼š é¦–å…ˆï¼Œåˆ›å»º ä¸€ä¸ªç”¨æ¥å­˜åŒ–å­¦å®¶ä»¬çš„æ–°æ•°ç»„ chemistsï¼Œè¿™é‡Œç”¨åˆ° filter() æ–¹æ³•è¿‡æ»¤ people æ•°ç»„æ¥å¾—åˆ°æ‰€æœ‰çš„åŒ–å­¦å®¶ï¼Œè¿‡æ»¤çš„æ¡ä»¶åº”è¯¥æ˜¯ person.profession === åŒ–å­¦å®¶ï¼š const chemists = people.filter(person = person.profession === åŒ–å­¦å®¶); æ¥ä¸‹æ¥ ç”¨ map æ–¹æ³•éå† chemists æ•°ç»„: const listItems = chemists.map(person = li img src=getImageUrl(person) alt=person.name / p bperson.name:/b + person.profession + å› person.accomplishmentè€Œé—»åä¸–ç•Œ /p /li); æœ€åï¼Œè¿”å› listItemsï¼š return ullistItems/ul; App.js import people from ./data.js;import getImageUrl from ./utils.js;export default function List() const chemists = people.filter(person = person.profession === åŒ–å­¦å®¶ ); const listItems = chemists.map(person = li img src=getImageUrl(person) alt=person.name / p bperson.name:/b + person.profession + å› person.accomplishmentè€Œé—»åä¸–ç•Œ /p /li ); return ullistItems/ul; data.js export const people = [ id: 0, name: å‡¯ç‘Ÿç³Â·çº¦ç¿°é€Š, profession: æ•°å­¦å®¶, accomplishment: å¤ªç©ºé£è¡Œç›¸å…³æ•°å€¼çš„æ ¸ç®—, imageId: MK3eW3A, , id: 1, name: é©¬é‡Œå¥¥Â·è«åˆ©çº³, profession: åŒ–å­¦å®¶, accomplishment: åŒ—æè‡­æ°§ç©ºæ´çš„å‘ç°, imageId: mynHUSa, , id: 2, name: ç©†ç½•é»˜å¾·Â·é˜¿åœæœå‹’Â·è¨æ‹‰å§†, profession: ç‰©ç†å­¦å®¶, accomplishment: å…³äºåŸºæœ¬ç²’å­é—´å¼±ç›¸äº’ä½œç”¨å’Œç”µç£ç›¸äº’ä½œç”¨çš„ç»Ÿä¸€ç†è®º, imageId: bE7W1ji, , id: 3, name: ç€è¥¿Â·è±æ¸©Â·æœ±åˆ©äºš, profession: åŒ–å­¦å®¶, accomplishment: å¼€åˆ›æ€§çš„å¯çš„æ¾è¯ç‰©ã€ç±»å›ºé†‡å’Œé¿å­•è¯çš„ç ”ç©¶, imageId: IOjWm71, , id: 4, name: è‹å¸ƒæ‹‰é©¬å°¼æ‰¬Â·é’±å¾·æ‹‰å¡å¡, profession: å¤©ä½“ç‰©ç†å­¦å®¶, accomplishment: ç™½çŸ®æ˜Ÿè´¨é‡è®¡ç®—, imageId: lrWQx8l, ,]; utils.js export function getImageUrl(person) return ( https://i.imgur.com/ + person.imageId + s.jpg ); å› ä¸ºç®­å¤´å‡½æ•°ä¼šéšå¼åœ°è¿”å›ä½äº = ä¹‹åçš„è¡¨è¾¾å¼ï¼Œæ‰€ä»¥ä½ å¯ä»¥çœç•¥ return è¯­å¥ã€‚ const listItems = chemists.map(person = li.../li // éšå¼åœ°è¿”å›ï¼); ä¸è¿‡ï¼Œå¦‚æœä½ çš„ = åé¢è·Ÿäº†ä¸€å¯¹èŠ±æ‹¬å· ï¼Œé‚£ä½ å¿…é¡»ä½¿ç”¨ return æ¥æŒ‡å®šè¿”å›å€¼ï¼ const listItems = chemists.map(person = // èŠ±æ‹¬å· return li.../li;); ç®­å¤´å‡½æ•° = åé¢çš„éƒ¨åˆ†è¢«ç§°ä¸º â€œå—å‡½æ•°ä½“â€ï¼Œå—å‡½æ•°ä½“æ”¯æŒå¤šè¡Œä»£ç çš„å†™æ³•ï¼Œä½†è¦ç”¨ return è¯­å¥æ‰èƒ½æŒ‡å®šè¿”å›å€¼ã€‚å‡å¦‚ä½ å¿˜äº†å†™ returnï¼Œé‚£è¿™ä¸ªå‡½æ•°ä»€ä¹ˆéƒ½ä¸ä¼šè¿”å›ï¼ 2.5.3 ç”¨ key ä¿æŒåˆ—è¡¨é¡¹çš„é¡ºåºå¦‚æœæŠŠä¸Šé¢ä»»ä½•ä¸€ä¸ªæ²™ç›’ç¤ºä¾‹åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€ï¼Œä½ å°±ä¼šå‘ç°æ§åˆ¶å°æœ‰è¿™æ ·ä¸€ä¸ªæŠ¥é”™ï¼š è¿™æ˜¯å› ä¸ºä½ å¿…é¡»ç»™æ•°ç»„ä¸­çš„æ¯ä¸€é¡¹éƒ½æŒ‡å®šä¸€ä¸ª keyâ€”â€”å®ƒå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–æ•°å­—çš„å½¢å¼ï¼Œåªè¦èƒ½å”¯ä¸€æ ‡è¯†å‡ºå„ä¸ªæ•°ç»„é¡¹å°±è¡Œï¼š li key=person.id.../li ç›´æ¥æ”¾åœ¨ map() æ–¹æ³•é‡Œçš„ JSX å…ƒç´ ä¸€èˆ¬éƒ½éœ€è¦æŒ‡å®š key å€¼ï¼ è¿™äº› key ä¼šå‘Šè¯‰ Reactï¼Œæ¯ä¸ªç»„ä»¶å¯¹åº”ç€æ•°ç»„é‡Œçš„å“ªä¸€é¡¹ï¼Œæ‰€ä»¥ React å¯ä»¥æŠŠå®ƒä»¬åŒ¹é…èµ·æ¥ã€‚è¿™åœ¨æ•°ç»„é¡¹è¿›è¡Œç§»åŠ¨ï¼ˆä¾‹å¦‚æ’åºï¼‰ã€æ’å…¥æˆ–åˆ é™¤ç­‰æ“ä½œæ—¶éå¸¸é‡è¦ã€‚ä¸€ä¸ªåˆé€‚çš„ key å¯ä»¥å¸®åŠ© React æ¨æ–­å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä»è€Œå¾—ä»¥æ­£ç¡®åœ°æ›´æ–° DOM æ ‘ã€‚ ç”¨ä½œ key çš„å€¼åº”è¯¥åœ¨æ•°æ®ä¸­æå‰å°±å‡†å¤‡å¥½ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶æ‰éšæ‰‹ç”Ÿæˆï¼š App.js import people from ./data.js;import getImageUrl from ./utils.js;export default function List() const listItems = people.map(person = li key=person.id img src=getImageUrl(person) alt=person.name / p bperson.name/b + person.profession + å› person.accomplishmentè€Œé—»åä¸–ç•Œ /p /li ); return ullistItems/ul; data.js export const people = [ id: 0, // åœ¨ JSX ä¸­ä½œä¸º key ä½¿ç”¨ name: å‡¯ç‘Ÿç³Â·çº¦ç¿°é€Š, profession: æ•°å­¦å®¶, accomplishment: å¤ªç©ºé£è¡Œç›¸å…³æ•°å€¼çš„æ ¸ç®—, imageId: MK3eW3A, , id: 1, // åœ¨ JSX ä¸­ä½œä¸º key ä½¿ç”¨ name: é©¬é‡Œå¥¥Â·è«åˆ©çº³, profession: åŒ–å­¦å®¶, accomplishment: åŒ—æè‡­æ°§ç©ºæ´çš„å‘ç°, imageId: mynHUSa, , id: 2, // åœ¨ JSX ä¸­ä½œä¸º key ä½¿ç”¨ name: ç©†ç½•é»˜å¾·Â·é˜¿åœæœå‹’Â·è¨æ‹‰å§†, profession: ç‰©ç†å­¦å®¶, accomplishment: å…³äºåŸºæœ¬ç²’å­é—´å¼±ç›¸äº’ä½œç”¨å’Œç”µç£ç›¸äº’ä½œç”¨çš„ç»Ÿä¸€ç†è®º, imageId: bE7W1ji, , id: 3, // åœ¨ JSX ä¸­ä½œä¸º key ä½¿ç”¨ name: ç€è¥¿Â·è±æ¸©Â·æœ±åˆ©äºš, profession: åŒ–å­¦å®¶, accomplishment: å¼€åˆ›æ€§çš„å¯çš„æ¾è¯ç‰©ã€ç±»å›ºé†‡å’Œé¿å­•è¯, imageId: IOjWm71, , id: 4, // åœ¨ JSX ä¸­ä½œä¸º key ä½¿ç”¨ name: è‹å¸ƒæ‹‰é©¬å°¼æ‰¬Â·é’±å¾·æ‹‰å¡å¡, profession: å¤©ä½“ç‰©ç†å­¦å®¶, accomplishment: ç™½çŸ®æ˜Ÿè´¨é‡è®¡ç®—, imageId: lrWQx8l, ,]; 2.5.4 å¦‚ä½•è®¾ç½® key å€¼ä¸åŒæ¥æºçš„æ•°æ®å¾€å¾€å¯¹åº”ä¸åŒçš„ key å€¼è·å–æ–¹å¼ï¼š æ¥è‡ªæ•°æ®åº“çš„æ•°æ®ï¼š å¦‚æœä½ çš„æ•°æ®æ˜¯ä»æ•°æ®åº“ä¸­è·å–çš„ï¼Œé‚£ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨æ•°æ®è¡¨ä¸­çš„ä¸»é”®ï¼Œå› ä¸ºå®ƒä»¬å¤©ç„¶å…·æœ‰å”¯ä¸€æ€§ã€‚ æœ¬åœ°äº§ç”Ÿæ•°æ®ï¼š å¦‚æœä½ æ•°æ®çš„äº§ç”Ÿå’Œä¿å­˜éƒ½åœ¨æœ¬åœ°ï¼ˆä¾‹å¦‚ç¬”è®°è½¯ä»¶é‡Œçš„ç¬”è®°ï¼‰ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªè‡ªå¢è®¡æ•°å™¨æˆ–è€…ä¸€ä¸ªç±»ä¼¼ uuid çš„åº“æ¥ç”Ÿæˆ keyã€‚ key éœ€è¦æ»¡è¶³çš„æ¡ä»¶ key å€¼åœ¨å…„å¼ŸèŠ‚ç‚¹ä¹‹é—´å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚ ä¸è¿‡ä¸è¦æ±‚å…¨å±€å”¯ä¸€ï¼Œåœ¨ä¸åŒçš„æ•°ç»„ä¸­å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ keyã€‚ key å€¼ä¸èƒ½æ”¹å˜ï¼Œå¦åˆ™å°±å¤±å»äº†ä½¿ç”¨ key çš„æ„ä¹‰ï¼æ‰€ä»¥åƒä¸‡ä¸è¦åœ¨æ¸²æŸ“æ—¶åŠ¨æ€åœ°ç”Ÿæˆ keyã€‚ React ä¸­ä¸ºä»€ä¹ˆéœ€è¦ keyï¼Ÿ è®¾æƒ³ä¸€ä¸‹ï¼Œå‡å¦‚ä½ æ¡Œé¢ä¸Šçš„æ–‡ä»¶éƒ½æ²¡æœ‰æ–‡ä»¶åï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ï¼Œä½ éœ€è¦é€šè¿‡æ–‡ä»¶çš„ä½ç½®é¡ºåºæ¥åŒºåˆ†å®ƒä»¬â€”â€”â€”ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼Œç¬¬äºŒä¸ªæ–‡ä»¶ï¼Œä»¥æ­¤ç±»æ¨ã€‚ä¹Ÿè®¸ä½ ä¹Ÿä¸æ˜¯ä¸èƒ½æ¥å—è¿™ç§æ–¹å¼ï¼Œå¯æ˜¯ä¸€æ—¦ä½ åˆ é™¤äº†å…¶ä¸­çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ç§ç»„ç»‡æ–¹å¼å°±ä¼šå˜å¾—æ··ä¹±æ— æ¯”ã€‚åŸæ¥çš„ç¬¬äºŒä¸ªæ–‡ä»¶å¯èƒ½ä¼šå˜æˆç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼Œç¬¬ä¸‰ä¸ªæ–‡ä»¶ä¼šæˆä¸ºç¬¬äºŒä¸ªæ–‡ä»¶â€¦â€¦ React é‡Œéœ€è¦ key å’Œæ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶éœ€è¦æœ‰æ–‡ä»¶åçš„é“ç†æ˜¯ç±»ä¼¼çš„ã€‚å®ƒä»¬ï¼ˆkey å’Œæ–‡ä»¶åï¼‰éƒ½è®©æˆ‘ä»¬å¯ä»¥ä»ä¼—å¤šçš„å…„å¼Ÿå…ƒç´ ä¸­å”¯ä¸€æ ‡è¯†å‡ºæŸä¸€é¡¹ï¼ˆJSX èŠ‚ç‚¹æˆ–æ–‡ä»¶ï¼‰ã€‚è€Œä¸€ä¸ªç²¾å¿ƒé€‰æ‹©çš„ key å€¼æ‰€èƒ½æä¾›çš„ä¿¡æ¯è¿œè¿œä¸æ­¢äºè¿™ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®ã€‚å³ä½¿å…ƒç´ çš„ä½ç½®åœ¨æ¸²æŸ“çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†æ”¹å˜ï¼Œå®ƒæä¾›çš„ key å€¼ä¹Ÿèƒ½è®© React åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ä¸€ç›´è®¤å¾—å®ƒã€‚ ä½ å¯èƒ½ä¼šæƒ³ç›´æ¥æŠŠæ•°ç»„é¡¹çš„ç´¢å¼•å½“ä½œ key å€¼æ¥ç”¨ï¼Œå®é™…ä¸Šï¼Œå¦‚æœä½ æ²¡æœ‰æ˜¾å¼åœ°æŒ‡å®š key å€¼ï¼ŒReact ç¡®å®é»˜è®¤ä¼šè¿™ä¹ˆåšã€‚ä½†æ˜¯æ•°ç»„é¡¹çš„é¡ºåºåœ¨æ’å…¥ã€åˆ é™¤æˆ–è€…é‡æ–°æ’åºç­‰æ“ä½œä¸­ä¼šå‘ç”Ÿæ”¹å˜ï¼Œæ­¤æ—¶æŠŠç´¢å¼•é¡ºåºç”¨ä½œ key å€¼ä¼šäº§ç”Ÿä¸€äº›å¾®å¦™ä¸”ä»¤äººå›°æƒ‘çš„ bugã€‚ ä¸ä¹‹ç±»ä¼¼ï¼Œè¯·ä¸è¦åœ¨è¿è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€åœ°äº§ç”Ÿ keyï¼Œåƒæ˜¯ key=Math.random() è¿™ç§æ–¹å¼ã€‚è¿™ä¼šå¯¼è‡´æ¯æ¬¡é‡æ–°æ¸²æŸ“åçš„ key å€¼éƒ½ä¸ä¸€æ ·ï¼Œä»è€Œä½¿å¾—æ‰€æœ‰çš„ç»„ä»¶å’Œ DOM å…ƒç´ æ¯æ¬¡éƒ½è¦é‡æ–°åˆ›å»ºã€‚è¿™ä¸ä»…ä¼šé€ æˆè¿è¡Œå˜æ…¢çš„é—®é¢˜ï¼Œæ›´æœ‰å¯èƒ½å¯¼è‡´ç”¨æˆ·è¾“å…¥çš„ä¸¢å¤±ã€‚æ‰€ä»¥ï¼Œä½¿ç”¨èƒ½ä»ç»™å®šæ•°æ®ä¸­ç¨³å®šå–å¾—çš„å€¼æ‰æ˜¯æ˜æ™ºçš„é€‰æ‹©ã€‚ æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œç»„ä»¶ä¸ä¼šæŠŠ key å½“ä½œ props çš„ä¸€éƒ¨åˆ†ã€‚Key çš„å­˜åœ¨åªå¯¹ React æœ¬èº«èµ·åˆ°æç¤ºä½œç”¨ã€‚å¦‚æœä½ çš„ç»„ä»¶éœ€è¦ä¸€ä¸ª IDï¼Œé‚£ä¹ˆè¯·æŠŠå®ƒä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ prop ä¼ ç»™ç»„ä»¶ï¼š Profile key=id userId=id /ã€‚ 2.6 ä¿æŒç»„ä»¶çº¯ç²¹éƒ¨åˆ† JavaScript å‡½æ•°æ˜¯ çº¯ç²¹ çš„ï¼Œè¿™ç±»å‡½æ•°é€šå¸¸è¢«ç§°ä¸ºçº¯å‡½æ•°ã€‚çº¯å‡½æ•°ä»…æ‰§è¡Œè®¡ç®—æ“ä½œï¼Œä¸åšå…¶ä»–æ“ä½œã€‚ä½ å¯ä»¥é€šè¿‡å°†ç»„ä»¶æŒ‰çº¯å‡½æ•°ä¸¥æ ¼ç¼–å†™ï¼Œä»¥é¿å…ä¸€äº›éšç€ä»£ç åº“çš„å¢é•¿è€Œå‡ºç°çš„ã€ä»¤äººå›°æ‰°çš„ bug ä»¥åŠä¸å¯é¢„æµ‹çš„è¡Œä¸ºã€‚ä½†ä¸ºäº†è·å¾—è¿™äº›å¥½å¤„ï¼Œä½ éœ€è¦éµå¾ªä¸€äº›è§„åˆ™ã€‚ 2.6.1 çº¯å‡½æ•°ï¼šç»„ä»¶ä½œä¸ºå…¬å¼åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼ˆå°¤å…¶æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¸–ç•Œä¸­ï¼‰ï¼Œçº¯å‡½æ•° é€šå¸¸å…·æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š åªè´Ÿè´£è‡ªå·±çš„ä»»åŠ¡ã€‚å®ƒä¸ä¼šæ›´æ”¹åœ¨è¯¥å‡½æ•°è°ƒç”¨å‰å°±å·²å­˜åœ¨çš„å¯¹è±¡æˆ–å˜é‡ã€‚ è¾“å…¥ç›¸åŒï¼Œåˆ™è¾“å‡ºç›¸åŒã€‚ç»™å®šç›¸åŒçš„è¾“å…¥ï¼Œçº¯å‡½æ•°åº”æ€»æ˜¯è¿”å›ç›¸åŒçš„ç»“æœã€‚ ä¸¾ä¸ªä½ éå¸¸ç†Ÿæ‚‰çš„çº¯å‡½æ•°ç¤ºä¾‹ï¼šæ•°å­¦ä¸­çš„å…¬å¼ã€‚ è€ƒè™‘å¦‚ä¸‹æ•°å­¦å…¬å¼ï¼šy 2xã€‚ è‹¥ x 2 åˆ™ y 4ã€‚æ°¸è¿œå¦‚æ­¤ã€‚ è‹¥ x 3 åˆ™ y 6ã€‚æ°¸è¿œå¦‚æ­¤ã€‚ è‹¥ x 3ï¼Œé‚£ä¹ˆ y å¹¶ä¸ä¼šå› ä¸ºæ—¶é—´æˆ–è‚¡å¸‚çš„å½±å“ï¼Œè€Œæœ‰æ—¶ç­‰äº 9 ã€ â€“1 æˆ– 2.5ã€‚ è‹¥ y 2x ä¸” x 3, é‚£ä¹ˆ y æ°¸è¿œ ç­‰äº 6. æˆ‘ä»¬ä½¿ç”¨ JavaScript çš„å‡½æ•°å®ç°ï¼Œçœ‹èµ·æ¥å°†ä¼šæ˜¯è¿™æ ·ï¼š function double(number) return 2 * number; ä¸Šè¿°ä¾‹å­ä¸­ï¼Œdouble() å°±æ˜¯ä¸€ä¸ª çº¯å‡½æ•°ã€‚å¦‚æœä½ ä¼ å…¥ 3 ï¼Œå®ƒå°†æ€»æ˜¯è¿”å› 6 ã€‚ React ä¾¿å›´ç»•ç€è¿™ä¸ªæ¦‚å¿µè¿›è¡Œè®¾è®¡ã€‚React å‡è®¾ä½ ç¼–å†™çš„æ‰€æœ‰ç»„ä»¶éƒ½æ˜¯çº¯å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºç›¸åŒçš„è¾“å…¥ï¼Œä½ æ‰€ç¼–å†™çš„ React ç»„ä»¶å¿…é¡»æ€»æ˜¯è¿”å›ç›¸åŒçš„ JSXã€‚ function Recipe( drinkers ) return ( ol liBoil drinkers cups of water./li liAdd drinkers spoons of tea and 0.5 * drinkers spoons of spice./li liAdd 0.5 * drinkers cups of milk to boil and sugar to taste./li /ol );export default function App() return ( section h1Spiced Chai Recipe/h1 h2For two/h2 Recipe drinkers=2 / h2For a gathering/h2 Recipe drinkers=4 / /section ); å½“ä½ ç»™å‡½æ•° Recipe ä¼ å…¥ drinkers=2 å‚æ•°æ—¶ï¼Œå®ƒå°†è¿”å›åŒ…å« 2 cups of water çš„ JSXã€‚æ°¸è¿œå¦‚æ­¤ã€‚ è€Œå½“ä½ ä¼ å…¥ drinkers=4 æ—¶ï¼Œå®ƒå°†è¿”å›åŒ…å« 4 cups of water çš„ JSXã€‚æ°¸è¿œå¦‚æ­¤ã€‚ å°±åƒæ•°å­¦å…¬å¼ä¸€æ ·ã€‚ ä½ å¯ä»¥æŠŠä½ çš„ç»„ä»¶å½“ä½œé£Ÿè°±ï¼šå¦‚æœä½ éµå¾ªå®ƒä»¬ï¼Œå¹¶ä¸”åœ¨çƒ¹é¥ªè¿‡ç¨‹ä¸­ä¸å¼•å…¥æ–°é£Ÿæï¼Œä½ æ¯æ¬¡éƒ½ä¼šå¾—åˆ°ç›¸åŒçš„èœè‚´ã€‚é‚£è¿™é“ â€œèœè‚´â€ å°±æ˜¯ç»„ä»¶ç”¨äº React æ¸²æŸ“ çš„ JSXã€‚ 2.6.2 å‰¯ä½œç”¨ï¼šï¼ˆä¸ç¬¦åˆï¼‰é¢„æœŸçš„åæœReact çš„æ¸²æŸ“è¿‡ç¨‹å¿…é¡»è‡ªå§‹è‡³ç»ˆæ˜¯çº¯ç²¹çš„ã€‚ç»„ä»¶åº”è¯¥åª è¿”å› å®ƒä»¬çš„ JSXï¼Œè€Œä¸ æ”¹å˜ åœ¨æ¸²æŸ“å‰ï¼Œå°±å·²å­˜åœ¨çš„ä»»ä½•å¯¹è±¡æˆ–å˜é‡ â€” è¿™å°†ä¼šä½¿å®ƒä»¬å˜å¾—ä¸çº¯ç²¹ï¼ ä»¥ä¸‹æ˜¯è¿åè¿™ä¸€è§„åˆ™çš„ç»„ä»¶ç¤ºä¾‹ï¼š let guest = 0;function Cup() // Badï¼šæ­£åœ¨æ›´æ”¹é¢„å…ˆå­˜åœ¨çš„å˜é‡ï¼ guest = guest + 1; return h2Tea cup for guest #guest/h2;export default function TeaSet() return ( Cup / Cup / Cup / / ); è¯¥ç»„ä»¶æ­£åœ¨è¯»å†™å…¶å¤–éƒ¨å£°æ˜çš„ guest å˜é‡ã€‚è¿™æ„å‘³ç€ å¤šæ¬¡è°ƒç”¨è¿™ä¸ªç»„ä»¶ä¼šäº§ç”Ÿä¸åŒçš„ JSXï¼å¹¶ä¸”ï¼Œå¦‚æœ å…¶ä»– ç»„ä»¶è¯»å– guest ï¼Œå®ƒä»¬ä¹Ÿä¼šäº§ç”Ÿä¸åŒçš„ JSXï¼Œå…¶ç»“æœå–å†³äºå®ƒä»¬ä½•æ—¶è¢«æ¸²æŸ“ï¼è¿™æ˜¯æ— æ³•é¢„æµ‹çš„ã€‚ å›åˆ°æˆ‘ä»¬çš„å…¬å¼ y 2x ï¼Œç°åœ¨å³ä½¿ x 2 ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½ç›¸ä¿¡ y 4 ã€‚æˆ‘ä»¬çš„æµ‹è¯•å¯èƒ½ä¼šå¤±è´¥ï¼Œæˆ‘ä»¬çš„ç”¨æˆ·å¯èƒ½ä¼šæ„Ÿåˆ°å›°æ‰°ï¼Œé£æœºå¯èƒ½ä¼šä»å¤©ç©ºå æ¯â€”â€”ä½ å°†çœ‹åˆ°è¿™ä¼šå¼•å‘å¤šä¹ˆæ‰‘æœ”è¿·ç¦»çš„ bugsï¼ ä½ å¯ä»¥ å°† guest ä½œä¸º prop ä¼ å…¥ æ¥ä¿®å¤æ­¤ç»„ä»¶ï¼š function Cup( guest ) return h2Tea cup for guest #guest/h2;export default function TeaSet() return ( Cup guest=1 / Cup guest=2 / Cup guest=3 / / ); ç°åœ¨ä½ çš„ç»„ä»¶å°±æ˜¯çº¯ç²¹çš„ï¼Œå› ä¸ºå®ƒè¿”å›çš„ JSX åªä¾èµ–äº guest propã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œä½ ä¸åº”è¯¥æœŸæœ›ä½ çš„ç»„ä»¶ä»¥ä»»ä½•ç‰¹å®šçš„é¡ºåºè¢«æ¸²æŸ“ã€‚è°ƒç”¨ y 5x å’Œ y 2x çš„å…ˆåé¡ºåºå¹¶ä¸é‡è¦ï¼šè¿™ä¸¤ä¸ªå…¬å¼ç›¸äº’ç‹¬ç«‹ã€‚åŒæ ·åœ°ï¼Œæ¯ä¸ªç»„ä»¶ä¹Ÿåº”è¯¥â€œç‹¬ç«‹æ€è€ƒâ€ï¼Œè€Œä¸æ˜¯åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­è¯•å›¾ä¸å…¶ä»–ç»„ä»¶åè°ƒï¼Œæˆ–è€…ä¾èµ–äºå…¶ä»–ç»„ä»¶ã€‚æ¸²æŸ“è¿‡ç¨‹å°±åƒæ˜¯ä¸€åœºå­¦æ ¡è€ƒè¯•ï¼šæ¯ä¸ªç»„ä»¶éƒ½åº”è¯¥è‡ªå·±è®¡ç®— JSXï¼ å°½ç®¡ä½ å¯èƒ½è¿˜æ²¡ä½¿ç”¨è¿‡ï¼Œä½†åœ¨ React ä¸­ï¼Œä½ å¯ä»¥åœ¨æ¸²æŸ“æ—¶è¯»å–ä¸‰ç§è¾“å…¥ï¼špropsï¼Œstate å’Œ contextã€‚ä½ åº”è¯¥å§‹ç»ˆå°†è¿™äº›è¾“å…¥è§†ä¸ºåªè¯»ã€‚ å½“ä½ æƒ³æ ¹æ®ç”¨æˆ·è¾“å…¥ æ›´æ”¹ æŸäº›å†…å®¹æ—¶ï¼Œä½ åº”è¯¥ è®¾ç½®çŠ¶æ€ï¼Œè€Œä¸æ˜¯ç›´æ¥å†™å…¥å˜é‡ã€‚å½“ä½ çš„ç»„ä»¶æ­£åœ¨æ¸²æŸ“æ—¶ï¼Œä½ æ°¸è¿œä¸åº”è¯¥æ”¹å˜é¢„å…ˆå­˜åœ¨çš„å˜é‡æˆ–å¯¹è±¡ã€‚ React æä¾›äº† â€œä¸¥æ ¼æ¨¡å¼â€ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹å¼€å‘æ—¶ï¼Œå®ƒå°†ä¼šè°ƒç”¨æ¯ä¸ªç»„ä»¶å‡½æ•°ä¸¤æ¬¡ã€‚é€šè¿‡é‡å¤è°ƒç”¨ç»„ä»¶å‡½æ•°ï¼Œä¸¥æ ¼æ¨¡å¼æœ‰åŠ©äºæ‰¾åˆ°è¿åè¿™äº›è§„åˆ™çš„ç»„ä»¶ã€‚ æˆ‘ä»¬æ³¨æ„åˆ°ï¼ŒåŸå§‹ç¤ºä¾‹æ˜¾ç¤ºçš„æ˜¯ â€œGuest #2â€ã€â€œGuest #4â€ å’Œ â€œGuest #6â€ï¼Œè€Œä¸æ˜¯ â€œGuest #1â€ã€â€œGuest #2â€ å’Œ â€œGuest #3â€ã€‚åŸæ¥çš„å‡½æ•°å¹¶ä¸çº¯ç²¹ï¼Œå› æ­¤è°ƒç”¨å®ƒä¸¤æ¬¡å°±å‡ºç°äº†é—®é¢˜ã€‚ä½†å¯¹äºä¿®å¤åçš„çº¯å‡½æ•°ç‰ˆæœ¬ï¼Œå³ä½¿è°ƒç”¨è¯¥å‡½æ•°ä¸¤æ¬¡ä¹Ÿèƒ½å¾—åˆ°æ­£ç¡®ç»“æœã€‚çº¯å‡½æ•°ä»…ä»…æ‰§è¡Œè®¡ç®—ï¼Œå› æ­¤è°ƒç”¨å®ƒä»¬ä¸¤æ¬¡ä¸ä¼šæ”¹å˜ä»»ä½•ä¸œè¥¿ â€” å°±åƒä¸¤æ¬¡è°ƒç”¨ double(2) å¹¶ä¸ä¼šæ”¹å˜è¿”å›å€¼ï¼Œä¸¤æ¬¡æ±‚è§£ y 2x ä¸ä¼šæ”¹å˜ y çš„å€¼ä¸€æ ·ã€‚ç›¸åŒçš„è¾“å…¥ï¼Œæ€»æ˜¯è¿”å›ç›¸åŒçš„è¾“å‡ºã€‚ ä¸¥æ ¼æ¨¡å¼åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä¸ç”Ÿæ•ˆï¼Œå› æ­¤å®ƒä¸ä¼šé™ä½åº”ç”¨ç¨‹åºçš„é€Ÿåº¦ã€‚å¦‚éœ€å¼•å…¥ä¸¥æ ¼æ¨¡å¼ï¼Œä½ å¯ä»¥ç”¨ React.StrictMode åŒ…è£¹æ ¹ç»„ä»¶ã€‚ä¸€äº›æ¡†æ¶ä¼šé»˜è®¤è¿™æ ·åšã€‚ 2.6.3 å±€éƒ¨ mutationï¼šç»„ä»¶çš„å°ç§˜å¯†ä¸Šè¿°ç¤ºä¾‹çš„é—®é¢˜å‡ºåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œç»„ä»¶æ”¹å˜äº† é¢„å…ˆå­˜åœ¨çš„ å˜é‡çš„å€¼ã€‚ä¸ºäº†è®©å®ƒå¬èµ·æ¥æ›´å¯æ€•ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†è¿™ç§ç°è±¡ç§°ä¸º çªå˜ï¼ˆmutationï¼‰ ã€‚çº¯å‡½æ•°ä¸ä¼šæ”¹å˜å‡½æ•°ä½œç”¨åŸŸå¤–çš„å˜é‡ã€æˆ–åœ¨å‡½æ•°è°ƒç”¨å‰åˆ›å»ºçš„å¯¹è±¡â€”â€”è¿™ä¼šä½¿å‡½æ•°å˜å¾—ä¸çº¯ç²¹ï¼ ä½†æ˜¯ï¼Œä½ å®Œå…¨å¯ä»¥åœ¨æ¸²æŸ“æ—¶æ›´æ”¹ä½  åˆšåˆš åˆ›å»ºçš„å˜é‡å’Œå¯¹è±¡ã€‚åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œä½ åˆ›å»ºä¸€ä¸ª [] æ•°ç»„ï¼Œå°†å…¶åˆ†é…ç»™ä¸€ä¸ª cups å˜é‡ï¼Œç„¶å push ä¸€æ‰“ cup è¿›å»ï¼š function Cup( guest ) return h2Tea cup for guest #guest/h2;export default function TeaGathering() let cups = []; for (let i = 1; i = 12; i++) cups.push(Cup key=i guest=i /); return cups; å¦‚æœ cups å˜é‡æˆ– [] æ•°ç»„æ˜¯åœ¨ TeaGathering å‡½æ•°ä¹‹å¤–åˆ›å»ºçš„ï¼Œè¿™å°†æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼å› ä¸ºå¦‚æœé‚£æ ·çš„è¯ï¼Œå½“ä½ è°ƒç”¨æ•°ç»„çš„ push æ–¹æ³•æ—¶ï¼Œå°±ä¼šæ›´æ”¹ é¢„å…ˆå­˜åœ¨çš„ å¯¹è±¡ã€‚ ä½†æ˜¯ï¼Œè¿™é‡Œä¸ä¼šæœ‰å½±å“ï¼Œå› ä¸ºæ¯æ¬¡æ¸²æŸ“æ—¶ï¼Œä½ éƒ½æ˜¯åœ¨ TeaGathering å‡½æ•°å†…éƒ¨åˆ›å»ºçš„å®ƒä»¬ã€‚TeaGathering ä¹‹å¤–çš„ä»£ç å¹¶ä¸ä¼šçŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆã€‚è¿™å°±è¢«ç§°ä¸º â€œå±€éƒ¨ mutationâ€ â€” å¦‚åŒè—åœ¨ç»„ä»¶é‡Œçš„å°ç§˜å¯†ã€‚ 2.6.4 å“ªäº›åœ°æ–¹ å¯èƒ½ å¼•å‘å‰¯ä½œç”¨å‡½æ•°å¼ç¼–ç¨‹åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºçº¯å‡½æ•°ï¼Œä½† æŸäº›äº‹ç‰© åœ¨ç‰¹å®šæƒ…å†µä¸‹ä¸å¾—ä¸å‘ç”Ÿæ”¹å˜ã€‚è¿™æ˜¯ç¼–ç¨‹çš„è¦ä¹‰ï¼è¿™äº›å˜åŠ¨åŒ…æ‹¬æ›´æ–°å±å¹•ã€å¯åŠ¨åŠ¨ç”»ã€æ›´æ”¹æ•°æ®ç­‰ï¼Œå®ƒä»¬è¢«ç§°ä¸º å‰¯ä½œç”¨ã€‚å®ƒä»¬æ˜¯ â€œé¢å¤–â€ å‘ç”Ÿçš„äº‹æƒ…ï¼Œä¸æ¸²æŸ“è¿‡ç¨‹æ— å…³ã€‚ åœ¨ React ä¸­ï¼Œ**å‰¯ä½œç”¨é€šå¸¸å±äº äº‹ä»¶å¤„ç†ç¨‹åº**ã€‚äº‹ä»¶å¤„ç†ç¨‹åºæ˜¯ React åœ¨ä½ æ‰§è¡ŒæŸäº›æ“ä½œï¼ˆå¦‚å•å‡»æŒ‰é’®ï¼‰æ—¶è¿è¡Œçš„å‡½æ•°ã€‚å³ä½¿äº‹ä»¶å¤„ç†ç¨‹åºæ˜¯åœ¨ä½ çš„ç»„ä»¶ å†…éƒ¨ å®šä¹‰çš„ï¼Œå®ƒä»¬ä¹Ÿä¸ä¼šåœ¨æ¸²æŸ“æœŸé—´è¿è¡Œï¼ å› æ­¤äº‹ä»¶å¤„ç†ç¨‹åºæ— éœ€æ˜¯çº¯å‡½æ•°ã€‚ å¦‚æœä½ ç”¨å°½ä¸€åˆ‡åŠæ³•ï¼Œä»æ— æ³•ä¸ºå‰¯ä½œç”¨æ‰¾åˆ°åˆé€‚çš„äº‹ä»¶å¤„ç†ç¨‹åºï¼Œä½ è¿˜å¯ä»¥è°ƒç”¨ç»„ä»¶ä¸­çš„ useEffect æ–¹æ³•å°†å…¶é™„åŠ åˆ°è¿”å›çš„ JSX ä¸­ã€‚è¿™ä¼šå‘Šè¯‰ React åœ¨æ¸²æŸ“ç»“æŸåæ‰§è¡Œå®ƒã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•åº”è¯¥æ˜¯ä½ æœ€åçš„æ‰‹æ®µã€‚ React ä¸ºä½•ä¾§é‡äºçº¯å‡½æ•°?ç¼–å†™çº¯å‡½æ•°éœ€è¦éµå¾ªä¸€äº›ä¹ æƒ¯å’Œè§„ç¨‹ã€‚ä½†å®ƒå¼€å¯äº†ç»å¦™çš„æœºé‡ï¼š ä½ çš„ç»„ä»¶å¯ä»¥åœ¨ä¸åŒçš„ç¯å¢ƒä¸‹è¿è¡Œ â€” ä¾‹å¦‚ï¼Œåœ¨æœåŠ¡å™¨ä¸Šï¼ç”±äºå®ƒä»¬é’ˆå¯¹ç›¸åŒçš„è¾“å…¥ï¼Œæ€»æ˜¯è¿”å›ç›¸åŒçš„ç»“æœï¼Œå› æ­¤ä¸€ä¸ªç»„ä»¶å¯ä»¥æ»¡è¶³å¤šä¸ªç”¨æˆ·è¯·æ±‚ã€‚ ä½ å¯ä»¥ä¸ºé‚£äº›è¾“å…¥æœªæ›´æ”¹çš„ç»„ä»¶æ¥ è·³è¿‡æ¸²æŸ“ï¼Œä»¥æé«˜æ€§èƒ½ã€‚è¿™æ˜¯å®‰å…¨çš„åšæ³•ï¼Œå› ä¸ºçº¯å‡½æ•°æ€»æ˜¯è¿”å›ç›¸åŒçš„ç»“æœï¼Œæ‰€ä»¥å¯ä»¥å®‰å…¨åœ°ç¼“å­˜å®ƒä»¬ã€‚ å¦‚æœåœ¨æ¸²æŸ“æ·±å±‚ç»„ä»¶æ ‘çš„è¿‡ç¨‹ä¸­ï¼ŒæŸäº›æ•°æ®å‘ç”Ÿäº†å˜åŒ–ï¼ŒReact å¯ä»¥é‡æ–°å¼€å§‹æ¸²æŸ“ï¼Œè€Œä¸ä¼šæµªè´¹æ—¶é—´å®Œæˆè¿‡æ—¶çš„æ¸²æŸ“ã€‚çº¯ç²¹æ€§ä½¿å¾—å®ƒéšæ—¶å¯ä»¥å®‰å…¨åœ°åœæ­¢è®¡ç®—ã€‚ æˆ‘ä»¬æ­£åœ¨æ„å»ºçš„æ¯ä¸ª React æ–°ç‰¹æ€§éƒ½åˆ©ç”¨åˆ°äº†çº¯å‡½æ•°ã€‚ä»æ•°æ®è·å–åˆ°åŠ¨ç”»å†åˆ°æ€§èƒ½ï¼Œä¿æŒç»„ä»¶çš„çº¯ç²¹å¯ä»¥å……åˆ†é‡Šæ”¾ React èŒƒå¼çš„èƒ½åŠ›ã€‚ 2.6.5 æ‘˜è¦ ä¸€ä¸ªç»„ä»¶å¿…é¡»æ˜¯çº¯ç²¹çš„ï¼Œå°±æ„å‘³ç€ï¼š åªè´Ÿè´£è‡ªå·±çš„ä»»åŠ¡ã€‚ å®ƒä¸ä¼šæ›´æ”¹åœ¨è¯¥å‡½æ•°è°ƒç”¨å‰å°±å·²å­˜åœ¨çš„å¯¹è±¡æˆ–å˜é‡ã€‚ è¾“å…¥ç›¸åŒï¼Œåˆ™è¾“å‡ºç›¸åŒã€‚ ç»™å®šç›¸åŒçš„è¾“å…¥ï¼Œç»„ä»¶åº”è¯¥æ€»æ˜¯è¿”å›ç›¸åŒçš„ JSXã€‚ æ¸²æŸ“éšæ—¶å¯èƒ½å‘ç”Ÿï¼Œå› æ­¤ç»„ä»¶ä¸åº”ä¾èµ–äºå½¼æ­¤çš„æ¸²æŸ“é¡ºåºã€‚ ä½ ä¸åº”è¯¥æ”¹å˜ä»»ä½•ç”¨äºç»„ä»¶æ¸²æŸ“çš„è¾“å…¥ã€‚è¿™åŒ…æ‹¬ propsã€state å’Œ contextã€‚é€šè¿‡ â€œè®¾ç½®â€ state æ¥æ›´æ–°ç•Œé¢ï¼Œè€Œä¸è¦æ”¹å˜é¢„å…ˆå­˜åœ¨çš„å¯¹è±¡ã€‚ åŠªåŠ›åœ¨ä½ è¿”å›çš„ JSX ä¸­è¡¨è¾¾ä½ çš„ç»„ä»¶é€»è¾‘ã€‚å½“ä½ éœ€è¦â€œæ”¹å˜äº‹ç‰©â€æ—¶ï¼Œä½ é€šå¸¸å¸Œæœ›åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­è¿›è¡Œã€‚ä½œä¸ºæœ€åçš„æ‰‹æ®µï¼Œä½ å¯ä»¥ä½¿ç”¨ useEffectã€‚ ç¼–å†™çº¯å‡½æ•°éœ€è¦ä¸€äº›ç»ƒä¹ ï¼Œä½†å®ƒå……åˆ†é‡Šæ”¾äº† React èŒƒå¼çš„èƒ½åŠ›ã€‚ 2.7 å°† UI è§†ä¸ºæ ‘å½“ React åº”ç”¨ç¨‹åºé€æ¸æˆå½¢æ—¶ï¼Œè®¸å¤šç»„ä»¶ä¼šå‡ºç°åµŒå¥—ã€‚é‚£ä¹ˆ React æ˜¯å¦‚ä½•è·Ÿè¸ªåº”ç”¨ç¨‹åºç»„ä»¶ç»“æ„çš„ï¼Ÿ React ä»¥åŠè®¸å¤šå…¶ä»– UI åº“ï¼Œå°† UI å»ºæ¨¡ä¸ºæ ‘ã€‚å°†åº”ç”¨ç¨‹åºè§†ä¸ºæ ‘å¯¹äºç†è§£ç»„ä»¶ä¹‹é—´çš„å…³ç³»ä»¥åŠè°ƒè¯•æ€§èƒ½å’ŒçŠ¶æ€ç®¡ç†ç­‰æœªæ¥å°†ä¼šé‡åˆ°çš„ä¸€äº›æ¦‚å¿µéå¸¸æœ‰ç”¨ã€‚ 2.7.1 æ ‘ç»“æ„æ ‘æ˜¯é¡¹ç›®å’Œ UI ä¹‹é—´çš„å…³ç³»æ¨¡å‹ï¼Œé€šå¸¸ä½¿ç”¨æ ‘ç»“æ„æ¥è¡¨ç¤º UIã€‚ä¾‹å¦‚ï¼Œæµè§ˆå™¨ä½¿ç”¨æ ‘ç»“æ„æ¥å»ºæ¨¡ HTMLï¼ˆDOMï¼‰ä¸CSSï¼ˆCSSOMï¼‰ã€‚ç§»åŠ¨å¹³å°ä¹Ÿä½¿ç”¨æ ‘æ¥è¡¨ç¤ºå…¶è§†å›¾å±‚æ¬¡ç»“æ„ã€‚ React ä»ç»„ä»¶ä¸­åˆ›å»º UI æ ‘ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒUI æ ‘æœ€åä¼šç”¨äºæ¸²æŸ“ DOMã€‚ æ°´å¹³æ’åˆ—çš„ä¸‰ä¸ªéƒ¨åˆ†çš„å›¾è¡¨ã€‚ç¬¬ä¸€éƒ¨åˆ†æœ‰ä¸‰ä¸ªå‚ç›´å †å çš„çŸ©å½¢ï¼Œå¹¶åˆ†åˆ«æ ‡è®°ä¸º Component Aã€Component B å’Œ Component Cã€‚å‘ä¸‹ä¸€ä¸ªçª—æ ¼è¿‡æ¸¡çš„æ˜¯ä¸€ä¸ªå¸¦æœ‰ React æ ‡å¿—çš„ç®­å¤´ï¼Œæ ‡è®°ä¸º Reactã€‚ä¸­é—´éƒ¨åˆ†åŒ…å«ä¸€æ£µç»„ä»¶æ ‘ï¼Œæ ¹èŠ‚ç‚¹æ ‡è®°ä¸º Aï¼Œæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹åˆ†åˆ«æ ‡è®°ä¸º B å’Œ Cã€‚ä¸‹ä¸€ä¸ªéƒ¨åˆ†å†æ¬¡ä½¿ç”¨å¸¦æœ‰ React æ ‡å¿—çš„ç®­å¤´è¿›è¡Œè¿‡æ¸¡ï¼Œæ ‡è®°ä¸º React DOMã€‚ç¬¬ä¸‰å’Œæœ€åä¸€ä¸ªéƒ¨åˆ†æ˜¯æµè§ˆå™¨çš„çº¿æ¡†å›¾ï¼ŒåŒ…å«ä¸€æ£µæœ‰ 8 ä¸ªèŠ‚ç‚¹çš„æ ‘ï¼Œå…¶ä¸­åªæœ‰ä¸€ä¸ªå­é›†è¢«çªå‡ºæ˜¾ç¤ºï¼ˆè¡¨ç¤ºä¸­é—´éƒ¨åˆ†çš„å­æ ‘ï¼‰ã€‚ ä¸æµè§ˆå™¨å’Œç§»åŠ¨å¹³å°ä¸€æ ·ï¼ŒReact è¿˜ä½¿ç”¨æ ‘ç»“æ„æ¥ç®¡ç†å’Œå»ºæ¨¡ React åº”ç”¨ç¨‹åºä¸­ç»„ä»¶ä¹‹é—´çš„å…³ç³»ã€‚è¿™äº›æ ‘æ˜¯æœ‰ç”¨çš„å·¥å…·ï¼Œç”¨äºç†è§£æ•°æ®å¦‚ä½•åœ¨ React åº”ç”¨ç¨‹åºä¸­æµåŠ¨ä»¥åŠå¦‚ä½•ä¼˜åŒ–å‘ˆç°å’Œåº”ç”¨ç¨‹åºå¤§å°ã€‚ 2.7.2 æ¸²æŸ“æ ‘ç»„ä»¶çš„ä¸€ä¸ªä¸»è¦ç‰¹æ€§æ˜¯èƒ½å¤Ÿç”±å…¶ä»–ç»„ä»¶ç»„åˆè€Œæˆã€‚åœ¨ åµŒå¥—ç»„ä»¶ ä¸­æœ‰çˆ¶ç»„ä»¶å’Œå­ç»„ä»¶çš„æ¦‚å¿µï¼Œå…¶ä¸­æ¯ä¸ªçˆ¶ç»„ä»¶æœ¬èº«å¯èƒ½æ˜¯å¦ä¸€ä¸ªç»„ä»¶çš„å­ç»„ä»¶ã€‚ å½“æ¸²æŸ“ React åº”ç”¨ç¨‹åºæ—¶ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªç§°ä¸ºæ¸²æŸ“æ ‘çš„æ ‘ä¸­å»ºæ¨¡è¿™ç§å…³ç³»ã€‚ ä¸‹é¢çš„ React åº”ç”¨ç¨‹åºæ¸²æŸ“äº†ä¸€äº›é¼“èˆäººå¿ƒçš„å¼•è¯­ã€‚ App.js import FancyText from ./FancyText;import InspirationGenerator from ./InspirationGenerator;import Copyright from ./Copyright;export default function App() return ( FancyText title text=Get Inspired App / InspirationGenerator Copyright year=2004 / /InspirationGenerator / ); FancyText.js export default function FancyText(title, text) return title ? h1 className=fancy titletext/h1 : h3 className=fancy cursivetext/h3 InspirationGenerator.js import * as React from react;import quotes from ./quotes;import FancyText from ./FancyText;export default function InspirationGenerator(children) const [index, setIndex] = React.useState(0); const quote = quotes[index]; const next = () = setIndex((index + 1) % quotes.length); return ( pYour inspirational quote is:/p FancyText text=quote / button onClick=nextInspire me again/button children / ); Copyright.js export default function Copyright(year) return p className=smallÂ©ï¸ year/p; quotes.js export default [ Donâ€™t let yesterday take up too much of today.â€ â€” Will Rogers, Ambition is putting a ladder against the sky., A joy thats shared is a joy made double., ]; é€šè¿‡ç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œå¯ä»¥æ„å»ºä¸Šé¢çš„æ¸²æŸ“æ ‘ã€‚ è¿™æ£µæ ‘ç”±èŠ‚ç‚¹ç»„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªç»„ä»¶ã€‚ä¾‹å¦‚ï¼ŒAppã€FancyTextã€Copyright ç­‰éƒ½æ˜¯æˆ‘ä»¬æ ‘ä¸­çš„èŠ‚ç‚¹ã€‚ åœ¨ React æ¸²æŸ“æ ‘ä¸­ï¼Œæ ¹èŠ‚ç‚¹æ˜¯åº”ç”¨ç¨‹åºçš„ æ ¹ç»„ä»¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ ¹ç»„ä»¶æ˜¯ Appï¼Œå®ƒæ˜¯ React æ¸²æŸ“çš„ç¬¬ä¸€ä¸ªç»„ä»¶ã€‚æ ‘ä¸­çš„æ¯ä¸ªç®­å¤´ä»çˆ¶ç»„ä»¶æŒ‡å‘å­ç»„ä»¶ã€‚ é‚£ä¹ˆæ¸²æŸ“æ ‘ä¸­çš„ HTML æ ‡ç­¾åœ¨å“ªé‡Œå‘¢ï¼Ÿä¹Ÿè®¸ä¼šæ³¨æ„åˆ°åœ¨ä¸Šé¢çš„æ¸²æŸ“æ ‘ä¸­ï¼Œæ²¡æœ‰æåˆ°æ¯ä¸ªç»„ä»¶æ¸²æŸ“çš„ HTML æ ‡ç­¾ã€‚è¿™æ˜¯å› ä¸ºæ¸²æŸ“æ ‘ä»…ç”± React ç»„ä»¶ ç»„æˆã€‚ React æ˜¯è·¨å¹³å°çš„ UI æ¡†æ¶ã€‚react.dev å±•ç¤ºäº†ä¸€äº›æ¸²æŸ“åˆ°ä½¿ç”¨ HTML æ ‡ç­¾ä½œä¸º UI åŸè¯­çš„ web çš„ç¤ºä¾‹ã€‚ä½†æ˜¯ React åº”ç”¨ç¨‹åºåŒæ ·å¯ä»¥æ¸²æŸ“åˆ°ç§»åŠ¨è®¾å¤‡æˆ–æ¡Œé¢å¹³å°ï¼Œè¿™äº›å¹³å°å¯èƒ½ä½¿ç”¨ä¸åŒçš„ UI åŸè¯­ï¼Œå¦‚ UIView æˆ– FrameworkElementã€‚ è¿™äº›å¹³å° UI åŸè¯­ä¸æ˜¯ React çš„ä¸€éƒ¨åˆ†ã€‚æ— è®ºåº”ç”¨ç¨‹åºæ¸²æŸ“åˆ°å“ªä¸ªå¹³å°ï¼ŒReact æ¸²æŸ“æ ‘éƒ½å¯ä»¥ä¸º React åº”ç”¨ç¨‹åºæä¾›è§è§£ã€‚ æ¸²æŸ“æ ‘è¡¨ç¤º React åº”ç”¨ç¨‹åºçš„å•ä¸ªæ¸²æŸ“è¿‡ç¨‹ã€‚åœ¨ æ¡ä»¶æ¸²æŸ“ ä¸­ï¼Œçˆ¶ç»„ä»¶å¯ä»¥æ ¹æ®ä¼ é€’çš„æ•°æ®æ¸²æŸ“ä¸åŒçš„å­ç»„ä»¶ã€‚ æˆ‘ä»¬å¯ä»¥æ›´æ–°åº”ç”¨ç¨‹åºä»¥æœ‰æ¡ä»¶åœ°æ¸²æŸ“åŠ±å¿—è¯­å½•æˆ–é¢œè‰²ã€‚ App.js import FancyText from ./FancyText;import InspirationGenerator from ./InspirationGenerator;import Copyright from ./Copyright;export default function App() return ( FancyText title text=Get Inspired App / InspirationGenerator Copyright year=2004 / /InspirationGenerator / ); FancyText.js export default function FancyText(title, text) return title ? h1 className=fancy titletext/h1 : h3 className=fancy cursivetext/h3 Color.js export default function Color(value) return div className=colorbox style=backgroundColor: value / InspirationGenerator.js import * as React from react;import inspirations from ./inspirations;import FancyText from ./FancyText;import Color from ./Color;export default function InspirationGenerator(children) const [index, setIndex] = React.useState(0); const inspiration = inspirations[index]; const next = () = setIndex((index + 1) % inspirations.length); return ( pYour inspirational inspiration.type is:/p inspiration.type === quote ? FancyText text=inspiration.value / : Color value=inspiration.value / button onClick=nextInspire me again/button children / ); Copyright.js export default function Copyright(year) return p className=smallÂ©ï¸ year/p; inspirations.js export default [ type: quote, value: Donâ€™t let yesterday take up too much of today.â€ â€” Will Rogers, type: color, value: #B73636, type: quote, value: Ambition is putting a ladder against the sky., type: color, value: #256266, type: quote, value: A joy thats shared is a joy made double., type: color, value: #F9F2B4,]; åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæ ¹æ® inspiration.type çš„å€¼å¯èƒ½ä¼šæ¸²æŸ“ FancyText æˆ– Colorã€‚æ¯æ¬¡æ¸²æŸ“è¿‡ç¨‹çš„æ¸²æŸ“æ ‘å¯èƒ½éƒ½ä¸åŒã€‚ å°½ç®¡æ¸²æŸ“æ ‘å¯èƒ½åœ¨ä¸åŒçš„æ¸²æŸ“è¿‡ç¨‹ä¸­æœ‰æ‰€ä¸åŒï¼Œä½†é€šå¸¸è¿™äº›æ ‘æœ‰åŠ©äºè¯†åˆ« React åº”ç”¨ç¨‹åºä¸­çš„é¡¶çº§å’Œå¶å­ç»„ä»¶ã€‚é¡¶çº§ç»„ä»¶æ˜¯ç¦»æ ¹ç»„ä»¶æœ€è¿‘çš„ç»„ä»¶ï¼Œå®ƒä»¬å½±å“å…¶ä¸‹æ‰€æœ‰ç»„ä»¶çš„æ¸²æŸ“æ€§èƒ½ï¼Œé€šå¸¸åŒ…å«æœ€å¤šå¤æ‚æ€§ã€‚å¶å­ç»„ä»¶ä½äºæ ‘çš„åº•éƒ¨ï¼Œæ²¡æœ‰å­ç»„ä»¶ï¼Œé€šå¸¸ä¼šé¢‘ç¹é‡æ–°æ¸²æŸ“ã€‚ è¯†åˆ«è¿™äº›ç»„ä»¶ç±»åˆ«æœ‰åŠ©äºç†è§£åº”ç”¨ç¨‹åºçš„æ•°æ®æµå’Œæ€§èƒ½ã€‚ 2.7.3 æ¨¡å—ä¾èµ–æ ‘åœ¨ React åº”ç”¨ç¨‹åºä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ ‘æ¥å»ºæ¨¡çš„å¦ä¸€ä¸ªå…³ç³»æ˜¯åº”ç”¨ç¨‹åºçš„æ¨¡å—ä¾èµ–å…³ç³»ã€‚å½“ æ‹†åˆ†ç»„ä»¶ å’Œé€»è¾‘åˆ°ä¸åŒçš„æ–‡ä»¶ä¸­æ—¶ï¼Œå°±åˆ›å»ºäº† JavaScript æ¨¡å—ï¼Œåœ¨è¿™äº›æ¨¡å—ä¸­å¯ä»¥å¯¼å‡ºç»„ä»¶ã€å‡½æ•°æˆ–å¸¸é‡ã€‚ æ¨¡å—ä¾èµ–æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæ¯ä¸ªåˆ†æ”¯ä»£è¡¨è¯¥æ¨¡å—ä¸­çš„ import è¯­å¥ã€‚ ä»¥ä¹‹å‰çš„ Inspirations åº”ç”¨ç¨‹åºä¸ºä¾‹ï¼Œå¯ä»¥æ„å»ºä¸€ä¸ªæ¨¡å—ä¾èµ–æ ‘ï¼Œç®€ç§°ä¾èµ–æ ‘ã€‚ æ ‘çš„æ ¹èŠ‚ç‚¹æ˜¯æ ¹æ¨¡å—ï¼Œä¹Ÿç§°ä¸ºå…¥å£æ–‡ä»¶ã€‚å®ƒé€šå¸¸åŒ…å«æ ¹ç»„ä»¶çš„æ¨¡å—ã€‚ ä¸åŒä¸€åº”ç”¨ç¨‹åºçš„æ¸²æŸ“æ ‘ç›¸æ¯”ï¼Œå­˜åœ¨ç›¸ä¼¼çš„ç»“æ„ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›æ˜¾è‘—çš„å·®å¼‚ï¼š æ„æˆæ ‘çš„èŠ‚ç‚¹ä»£è¡¨æ¨¡å—ï¼Œè€Œä¸æ˜¯ç»„ä»¶ã€‚ éç»„ä»¶æ¨¡å—ï¼Œå¦‚ inspirations.jsï¼Œåœ¨è¿™ä¸ªæ ‘ä¸­ä¹Ÿæœ‰æ‰€ä½“ç°ã€‚æ¸²æŸ“æ ‘ä»…å°è£…ç»„ä»¶ã€‚ Copyright.js å‡ºç°åœ¨ App.js ä¸‹ï¼Œä½†åœ¨æ¸²æŸ“æ ‘ä¸­ï¼ŒCopyright ä½œä¸º InspirationGenerator çš„å­ç»„ä»¶å‡ºç°ã€‚è¿™æ˜¯å› ä¸º InspirationGenerator æ¥å— JSX ä½œä¸º children propsï¼Œå› æ­¤å®ƒå°† Copyright ä½œä¸ºå­ç»„ä»¶æ¸²æŸ“ï¼Œä½†ä¸å¯¼å…¥è¯¥æ¨¡å—ã€‚ ä¾èµ–æ ‘å¯¹äºç¡®å®šè¿è¡Œ React åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ¨¡å—éå¸¸æœ‰ç”¨ã€‚åœ¨ä¸ºç”Ÿäº§ç¯å¢ƒæ„å»º React åº”ç”¨ç¨‹åºæ—¶ï¼Œé€šå¸¸ä¼šæœ‰ä¸€ä¸ªæ„å»ºæ­¥éª¤ï¼Œè¯¥æ­¥éª¤å°†æ†ç»‘æ‰€æœ‰å¿…è¦çš„ JavaScript ä»¥ä¾›å®¢æˆ·ç«¯ä½¿ç”¨ã€‚è´Ÿè´£æ­¤æ“ä½œçš„å·¥å…·ç§°ä¸º bundlerï¼ˆæ†ç»‘å™¨ï¼‰ï¼Œå¹¶ä¸” bundler å°†ä½¿ç”¨ä¾èµ–æ ‘æ¥ç¡®å®šåº”åŒ…å«å“ªäº›æ¨¡å—ã€‚ éšç€åº”ç”¨ç¨‹åºçš„å¢é•¿ï¼Œæ†ç»‘åŒ…å¤§å°é€šå¸¸ä¹Ÿä¼šå¢åŠ ã€‚å¤§å‹æ†ç»‘åŒ…å¤§å°å¯¹äºå®¢æˆ·ç«¯æ¥è¯´ä¸‹è½½å’Œè¿è¡Œæˆæœ¬é«˜æ˜‚ï¼Œå¹¶å»¶è¿Ÿ UI ç»˜åˆ¶çš„æ—¶é—´ã€‚äº†è§£åº”ç”¨ç¨‹åºçš„ä¾èµ–æ ‘å¯èƒ½æœ‰åŠ©äºè°ƒè¯•è¿™äº›é—®é¢˜ã€‚ 2.7.4 æ‘˜è¦ æ ‘æ˜¯è¡¨ç¤ºå®ä½“ä¹‹é—´å…³ç³»çš„å¸¸è§æ–¹å¼ï¼Œå®ƒä»¬ç»å¸¸ç”¨äºå»ºæ¨¡ UIã€‚ æ¸²æŸ“æ ‘è¡¨ç¤ºå•æ¬¡æ¸²æŸ“ä¸­ React ç»„ä»¶ä¹‹é—´çš„åµŒå¥—å…³ç³»ã€‚ ä½¿ç”¨æ¡ä»¶æ¸²æŸ“ï¼Œæ¸²æŸ“æ ‘å¯èƒ½ä¼šåœ¨ä¸åŒçš„æ¸²æŸ“è¿‡ç¨‹ä¸­å‘ç”Ÿå˜åŒ–ã€‚ä½¿ç”¨ä¸åŒçš„å±æ€§å€¼ï¼Œç»„ä»¶å¯èƒ½ä¼šæ¸²æŸ“ä¸åŒçš„å­ç»„ä»¶ã€‚ æ¸²æŸ“æ ‘æœ‰åŠ©äºè¯†åˆ«é¡¶çº§ç»„ä»¶å’Œå¶å­ç»„ä»¶ã€‚é¡¶çº§ç»„ä»¶ä¼šå½±å“å…¶ä¸‹æ‰€æœ‰ç»„ä»¶çš„æ¸²æŸ“æ€§èƒ½ï¼Œè€Œå¶å­ç»„ä»¶é€šå¸¸ä¼šé¢‘ç¹é‡æ–°æ¸²æŸ“ã€‚è¯†åˆ«å®ƒä»¬æœ‰åŠ©äºç†è§£å’Œè°ƒè¯•æ¸²æŸ“æ€§èƒ½é—®é¢˜ã€‚ ä¾èµ–æ ‘è¡¨ç¤º React åº”ç”¨ç¨‹åºä¸­çš„æ¨¡å—ä¾èµ–å…³ç³»ã€‚ æ„å»ºå·¥å…·ä½¿ç”¨ä¾èµ–æ ‘æ¥æ†ç»‘å¿…è¦çš„ä»£ç ä»¥éƒ¨ç½²åº”ç”¨ç¨‹åºã€‚ ä¾èµ–æ ‘æœ‰åŠ©äºè°ƒè¯•å¤§å‹æ†ç»‘åŒ…å¸¦æ¥çš„æ¸²æŸ“é€Ÿåº¦è¿‡æ…¢çš„é—®é¢˜ï¼Œä»¥åŠå‘ç°å“ªäº›æ†ç»‘ä»£ç å¯ä»¥è¢«ä¼˜åŒ–ã€‚ 3. äº¤äº’ç•Œé¢ä¸Šçš„æ§ä»¶ä¼šæ ¹æ®ç”¨æˆ·çš„è¾“å…¥è€Œæ›´æ–°ã€‚ä¾‹å¦‚ï¼Œç‚¹å‡»æŒ‰é’®åˆ‡æ¢è½®æ’­å›¾çš„å±•ç¤ºã€‚åœ¨ React ä¸­ï¼Œéšæ—¶é—´å˜åŒ–çš„æ•°æ®è¢«ç§°ä¸ºçŠ¶æ€ï¼ˆstateï¼‰ã€‚ä½ å¯ä»¥å‘ä»»ä½•ç»„ä»¶æ·»åŠ çŠ¶æ€ï¼Œå¹¶æŒ‰éœ€è¿›è¡Œæ›´æ–°ã€‚åœ¨æœ¬ç« èŠ‚ä¸­ï¼Œä½ å°†å­¦ä¹ å¦‚ä½•ç¼–å†™å¤„ç†äº¤äº’çš„ç»„ä»¶ï¼Œæ›´æ–°å®ƒä»¬çš„çŠ¶æ€ï¼Œå¹¶æ ¹æ®æ—¶é—´å˜åŒ–æ˜¾ç¤ºä¸åŒçš„æ•ˆæœã€‚ 3.1 å“åº”äº‹ä»¶ä½¿ç”¨ React å¯ä»¥åœ¨ JSX ä¸­æ·»åŠ  äº‹ä»¶å¤„ç†å‡½æ•°ã€‚å…¶ä¸­äº‹ä»¶å¤„ç†å‡½æ•°ä¸ºè‡ªå®šä¹‰å‡½æ•°ï¼Œå®ƒå°†åœ¨å“åº”äº¤äº’ï¼ˆå¦‚ç‚¹å‡»ã€æ‚¬åœã€è¡¨å•è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹ç­‰ï¼‰æ—¶è§¦å‘ã€‚ 3.1.1 æ·»åŠ äº‹ä»¶å¤„ç†å‡½æ•°å¦‚éœ€æ·»åŠ ä¸€ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œä½ éœ€è¦å…ˆå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç„¶å å°†å…¶ä½œä¸º prop ä¼ å…¥ åˆé€‚çš„ JSX æ ‡ç­¾ã€‚ä¾‹å¦‚ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæ²¡ç»‘å®šä»»ä½•äº‹ä»¶çš„æŒ‰é’®ï¼š export default function Button() return ( button æœªç»‘å®šä»»ä½•äº‹ä»¶ /button ); æŒ‰ç…§å¦‚ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼Œå³å¯è®©å®ƒåœ¨ç”¨æˆ·ç‚¹å‡»æ—¶æ˜¾ç¤ºæ¶ˆæ¯ï¼š åœ¨ Button ç»„ä»¶ å†…éƒ¨ å£°æ˜ä¸€ä¸ªåä¸º handleClick çš„å‡½æ•°ã€‚ å®ç°å‡½æ•°å†…éƒ¨çš„é€»è¾‘ï¼ˆä½¿ç”¨ alert æ¥æ˜¾ç¤ºæ¶ˆæ¯ï¼‰ã€‚ æ·»åŠ  onClick=handleClick åˆ° button JSX ä¸­ã€‚ export default function Button() function handleClick() alert(ç‚¹å‡»); return ( button onClick=handleClick ç‚¹å‡» /button ) ä½ å¯ä»¥å®šä¹‰ handleClick å‡½æ•°ç„¶å å°†å…¶ä½œä¸º prop ä¼ å…¥ buttonã€‚å…¶ä¸­ handleClick æ˜¯ä¸€ä¸ª äº‹ä»¶å¤„ç†å‡½æ•° ã€‚äº‹ä»¶å¤„ç†å‡½æ•°æœ‰å¦‚ä¸‹ç‰¹ç‚¹: é€šå¸¸åœ¨ä½ çš„ç»„ä»¶ å†…éƒ¨ å®šä¹‰ã€‚ åç§°ä»¥ handle å¼€å¤´ï¼Œåè·Ÿäº‹ä»¶åç§°ã€‚ æŒ‰ç…§æƒ¯ä¾‹ï¼Œé€šå¸¸å°†äº‹ä»¶å¤„ç†ç¨‹åºå‘½åä¸º handleï¼Œåæ¥äº‹ä»¶åã€‚ä½ ä¼šç»å¸¸çœ‹åˆ° onClick=handleClickï¼ŒonMouseEnter=handleMouseEnter ç­‰ã€‚ æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ JSX ä¸­å®šä¹‰ä¸€ä¸ªå†…è”çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼š button onClick=function handleClick() alert(ä½ ç‚¹å‡»äº†æˆ‘ï¼); æˆ–è€…ï¼Œç›´æ¥ä½¿ç”¨æ›´ä¸ºç®€æ´ç®­å¤´å‡½æ•°ï¼š button onClick=() = alert(ä½ ç‚¹å‡»äº†æˆ‘ï¼); ä»¥ä¸Šæ‰€æœ‰æ–¹å¼éƒ½æ˜¯ç­‰æ•ˆçš„ã€‚å½“å‡½æ•°ä½“è¾ƒçŸ­æ—¶ï¼Œå†…è”äº‹ä»¶å¤„ç†å‡½æ•°ä¼šå¾ˆæ–¹ä¾¿ã€‚ ä¼ é€’ç»™äº‹ä»¶å¤„ç†å‡½æ•°çš„å‡½æ•°åº”ç›´æ¥ä¼ é€’ï¼Œè€Œéè°ƒç”¨ã€‚ä¾‹å¦‚ï¼š ä¼ é€’ä¸€ä¸ªå‡½æ•°ï¼ˆæ­£ç¡®ï¼‰ è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼ˆé”™è¯¯ï¼‰ button onClick=handleClick button onClick=handleClick() åŒºåˆ«å¾ˆå¾®å¦™ã€‚åœ¨ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­ï¼ŒhandleClick å‡½æ•°ä½œä¸º onClick äº‹ä»¶å¤„ç†å‡½æ•°ä¼ é€’ã€‚è¿™ä¼šè®© React è®°ä½å®ƒï¼Œå¹¶ä¸”åªåœ¨ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶è°ƒç”¨ä½ çš„å‡½æ•°ã€‚ åœ¨ç¬¬äºŒä¸ªç¤ºä¾‹ä¸­ï¼ŒhandleClick() ä¸­æœ€åçš„ () ä¼šåœ¨ æ¸²æŸ“ è¿‡ç¨‹ä¸­ ç«‹å³ è§¦å‘å‡½æ•°ï¼Œå³ä½¿æ²¡æœ‰ä»»ä½•ç‚¹å‡»ã€‚è¿™æ˜¯å› ä¸ºä½äº JSX ä¹‹é—´çš„ JavaScript ä¼šç«‹å³æ‰§è¡Œã€‚ å½“ä½ ç¼–å†™å†…è”ä»£ç æ—¶ï¼ŒåŒæ ·çš„é™·é˜±å¯èƒ½ä¼šä»¥ä¸åŒçš„æ–¹å¼å‡ºç°ï¼š ä¼ é€’ä¸€ä¸ªå‡½æ•°ï¼ˆæ­£ç¡®ï¼‰ è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼ˆé”™è¯¯ï¼‰ button onClick=() = alert(...) button onClick=alert(...) å¦‚æœæŒ‰å¦‚ä¸‹æ–¹å¼ä¼ é€’å†…è”ä»£ç ï¼Œå¹¶ä¸ä¼šåœ¨ç‚¹å‡»æ—¶è§¦å‘ï¼Œè€Œæ˜¯ä¼šåœ¨æ¯æ¬¡ç»„ä»¶æ¸²æŸ“æ—¶è§¦å‘ï¼š // è¿™ä¸ª alert åœ¨ç»„ä»¶æ¸²æŸ“æ—¶è§¦å‘ï¼Œè€Œä¸æ˜¯ç‚¹å‡»æ—¶è§¦å‘ï¼button onClick=alert(ä½ ç‚¹å‡»äº†æˆ‘ï¼) å¦‚æœä½ æƒ³è¦å®šä¹‰å†…è”äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè¯·å°†å…¶åŒ…è£…åœ¨åŒ¿åå‡½æ•°ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š button onClick=() = alert(ä½ ç‚¹å‡»äº†æˆ‘ï¼) è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªç¨åè°ƒç”¨çš„å‡½æ•°ï¼Œè€Œä¸ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œå…¶å†…éƒ¨ä»£ç ã€‚ åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œä½ éƒ½åº”è¯¥ä¼ é€’ä¸€ä¸ªå‡½æ•°ï¼š button onClick=handleClick ä¼ é€’äº† handleClick å‡½æ•°ã€‚ button onClick=() = alert(...) ä¼ é€’äº† () = alert(...) å‡½æ•°ã€‚ äº†è§£æ›´å¤šç®­å¤´å‡½æ•°çš„ä¿¡æ¯ã€‚ 3.1.2 åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­è¯»å– propsç”±äºäº‹ä»¶å¤„ç†å‡½æ•°å£°æ˜äºç»„ä»¶å†…éƒ¨ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥ç›´æ¥è®¿é—®ç»„ä»¶çš„ propsã€‚ç¤ºä¾‹ä¸­çš„æŒ‰é’®ï¼Œå½“ç‚¹å‡»æ—¶ä¼šå¼¹å‡ºå¸¦æœ‰ message prop çš„ alertï¼š function AlertButton( message, children ) return ( button onClick=() = alert(message) children /button );export default function Toolbar() return ( div AlertButton message=æ­£åœ¨æ’­æ”¾ï¼ æ’­æ”¾ç”µå½± /AlertButton AlertButton message=æ­£åœ¨ä¸Šä¼ ï¼ ä¸Šä¼ å›¾ç‰‡ /AlertButton /div ); æ­¤å¤„æœ‰ä¸¤ä¸ªæŒ‰é’®ï¼Œä¼šå±•ç¤ºä¸åŒçš„æ¶ˆæ¯ã€‚ä½ å¯ä»¥å°è¯•æ›´æ”¹ä¼ é€’ç»™å®ƒä»¬çš„æ¶ˆæ¯ã€‚ 3.1.3 å°†äº‹ä»¶å¤„ç†å‡½æ•°ä½œä¸º props ä¼ é€’é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šåœ¨çˆ¶ç»„ä»¶ä¸­å®šä¹‰å­ç»„ä»¶çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚æ¯”å¦‚ï¼šç½®äºä¸åŒä½ç½®çš„ Button ç»„ä»¶ï¼Œå¯èƒ½æœ€ç»ˆæ‰§è¡Œçš„åŠŸèƒ½ä¹Ÿä¸åŒ â€”â€” ä¹Ÿè®¸æ˜¯æ’­æ”¾ç”µå½±ï¼Œä¹Ÿè®¸æ˜¯ä¸Šä¼ å›¾ç‰‡ã€‚ ä¸ºæ­¤ï¼Œå°†ç»„ä»¶ä»çˆ¶ç»„ä»¶æ¥æ”¶çš„ prop ä½œä¸ºäº‹ä»¶å¤„ç†å‡½æ•°ä¼ é€’ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š function Button( onClick, children ) return ( button onClick=onClick children /button );function PlayButton( movieName ) function handlePlayClick() alert(`æ­£åœ¨æ’­æ”¾ $movieNameï¼`); return ( Button onClick=handlePlayClick æ’­æ”¾ movieName /Button );function UploadButton() return ( Button onClick=() = alert(æ­£åœ¨ä¸Šä¼ ï¼) ä¸Šä¼ å›¾ç‰‡ /Button );export default function Toolbar() return ( div PlayButton movieName=é­”å¥³å®…æ€¥ä¾¿ / UploadButton / /div ); ç¤ºä¾‹ä¸­ï¼ŒToolbar ç»„ä»¶æ¸²æŸ“äº†ä¸€ä¸ª PlayButton ç»„ä»¶å’Œ UploadButton ç»„ä»¶ï¼š PlayButton å°† handlePlayClick ä½œä¸º onClick prop ä¼ å…¥ Button ç»„ä»¶å†…éƒ¨ã€‚ UploadButton å°† () = alert(æ­£åœ¨ä¸Šä¼ ï¼) ä½œä¸º onClick prop ä¼ å…¥ Button ç»„ä»¶å†…éƒ¨ã€‚ æœ€åï¼Œä½ çš„ Button ç»„ä»¶æ¥æ”¶ä¸€ä¸ªåä¸º onClick çš„ propã€‚å®ƒç›´æ¥å°†è¿™ä¸ª prop ä»¥ onClick=onClick æ–¹å¼ä¼ é€’ç»™æµè§ˆå™¨å†…ç½®çš„ buttonã€‚å½“ç‚¹å‡»æŒ‰é’®æ—¶ï¼ŒReact ä¼šè°ƒç”¨ä¼ å…¥çš„å‡½æ•°ã€‚ å¦‚æœä½ éµå¾ªæŸä¸ª è®¾è®¡ç³»ç»Ÿ æ—¶ï¼ŒæŒ‰é’®ä¹‹ç±»çš„ç»„ä»¶é€šå¸¸ä¼šåŒ…å«æ ·å¼ï¼Œä½†ä¸ä¼šæŒ‡å®šè¡Œä¸ºã€‚è€Œ PlayButton å’Œ UploadButton ä¹‹ç±»çš„ç»„ä»¶åˆ™ä¼šå‘ä¸‹ä¼ é€’äº‹ä»¶å¤„ç†å‡½æ•°ã€‚ 3.1.4 å‘½åäº‹ä»¶å¤„ç†å‡½æ•° propå†…ç½®ç»„ä»¶ï¼ˆbutton å’Œ divï¼‰ä»…æ”¯æŒ æµè§ˆå™¨äº‹ä»¶åç§°ï¼Œä¾‹å¦‚ onClickã€‚ä½†æ˜¯ï¼Œå½“ä½ æ„å»ºè‡ªå·±çš„ç»„ä»¶æ—¶ï¼Œä½ å¯ä»¥æŒ‰ä½ ä¸ªäººå–œå¥½å‘½åäº‹ä»¶å¤„ç†å‡½æ•°çš„ propã€‚ æŒ‰ç…§æƒ¯ä¾‹ï¼Œäº‹ä»¶å¤„ç†å‡½æ•° props åº”è¯¥ä»¥ on å¼€å¤´ï¼Œåè·Ÿä¸€ä¸ªå¤§å†™å­—æ¯ã€‚ ä¾‹å¦‚ï¼ŒButton ç»„ä»¶çš„ onClick prop æœ¬æ¥ä¹Ÿå¯ä»¥è¢«å‘½åä¸º onSmashï¼š function Button( onSmash, children ) return ( button onClick=onSmash children /button );export default function App() return ( div Button onSmash=() = alert(æ­£åœ¨æ’­æ”¾ï¼) æ’­æ”¾ç”µå½± /Button Button onSmash=() = alert(æ­£åœ¨ä¸Šä¼ ï¼) ä¸Šä¼ å›¾ç‰‡ /Button /div ); ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œbutton onClick=onSmash ä»£è¡¨æµè§ˆå™¨å†…ç½®çš„ buttonï¼ˆå°å†™ï¼‰ä»ç„¶éœ€è¦ä½¿ç”¨ onClick propï¼Œè€Œè‡ªå®šä¹‰çš„ Button ç»„ä»¶æ¥æ”¶åˆ°çš„ prop åç§°å¯ç”±ä½ å†³å®šï¼ å½“ä½ çš„ç»„ä»¶æ”¯æŒå¤šç§äº¤äº’æ—¶ï¼Œä½ å¯ä»¥æ ¹æ®ä¸åŒçš„åº”ç”¨ç¨‹åºå‘½åäº‹ä»¶å¤„ç†å‡½æ•° propã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª Toolbar ç»„ä»¶æ¥æ”¶ onPlayMovie å’Œ onUploadImage ä¸¤ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ï¼š export default function App() return ( Toolbar onPlayMovie=() = alert(æ­£åœ¨æ’­æ”¾ï¼) onUploadImage=() = alert(æ­£åœ¨ä¸Šä¼ ï¼) / );function Toolbar( onPlayMovie, onUploadImage ) return ( div Button onClick=onPlayMovie æ’­æ”¾ç”µå½± /Button Button onClick=onUploadImage ä¸Šä¼ å›¾ç‰‡ /Button /div );function Button( onClick, children ) return ( button onClick=onClick children /button ); è¯·æ³¨æ„ï¼ŒApp ç»„ä»¶å¹¶ä¸éœ€è¦çŸ¥é“ Toolbar å°†ä¼šå¯¹ onPlayMovie å’Œ onUploadImage åš ä»€ä¹ˆ ã€‚ä¸Šè¿°ç¤ºä¾‹æ˜¯ Toolbar çš„å®ç°ç»†èŠ‚ã€‚å…¶ä¸­ï¼ŒToolbar å°†å®ƒä»¬ä½œä¸º onClick å¤„ç†å‡½æ•°ä¼ é€’ç»™äº† Button ç»„ä»¶ï¼Œå…¶å®è¿˜å¯ä»¥é€šè¿‡é”®ç›˜å¿«æ·é”®æ¥è§¦å‘å®ƒä»¬ã€‚æ ¹æ®åº”ç”¨ç¨‹åºç‰¹å®šçš„äº¤äº’æ–¹å¼ï¼ˆå¦‚ onPlayMovieï¼‰æ¥å‘½å prop ï¼Œå¯ä»¥è®©ä½ çµæ´»åœ°æ›´æ”¹ä»¥åä½¿ç”¨å®ƒä»¬çš„æ–¹å¼ã€‚ ç¡®ä¿ä¸ºäº‹ä»¶å¤„ç†ç¨‹åºä½¿ç”¨é€‚å½“çš„ HTML æ ‡ç­¾ã€‚ä¾‹å¦‚ï¼Œè¦å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼Œè¯·ä½¿ç”¨ è€Œä¸æ˜¯ div onClick=handleClickã€‚ä½¿ç”¨çœŸæ­£çš„æµè§ˆå™¨ button å¯ç”¨å†…ç½®çš„æµè§ˆå™¨è¡Œä¸ºï¼Œå¦‚é”®ç›˜å¯¼èˆªã€‚å¦‚æœä½ ä¸å–œæ¬¢æŒ‰é’®çš„é»˜è®¤æµè§ˆå™¨æ ·å¼ï¼Œå¹¶ä¸”æƒ³è®©å®ƒçœ‹èµ·æ¥æ›´åƒä¸€ä¸ªé“¾æ¥æˆ–ä¸åŒçš„ UI å…ƒç´ ï¼Œä½ å¯ä»¥ä½¿ç”¨ CSS æ¥å®ç°ã€‚äº†è§£æœ‰å…³ç¼–å†™æ— éšœç¢æ ‡ç­¾çš„æ›´å¤šä¿¡æ¯ã€‚ 3.1.5 äº‹ä»¶ä¼ æ’­äº‹ä»¶å¤„ç†å‡½æ•°è¿˜å°†æ•è·ä»»ä½•æ¥è‡ªå­ç»„ä»¶çš„äº‹ä»¶ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šè¯´äº‹ä»¶ä¼šæ²¿ç€æ ‘å‘ä¸Šâ€œå†’æ³¡â€æˆ–â€œä¼ æ’­â€ï¼šå®ƒä»äº‹ä»¶å‘ç”Ÿçš„åœ°æ–¹å¼€å§‹ï¼Œç„¶åæ²¿ç€æ ‘å‘ä¸Šä¼ æ’­ã€‚ ä¸‹é¢è¿™ä¸ª div åŒ…å«ä¸¤ä¸ªæŒ‰é’®ã€‚div å’Œæ¯ä¸ªæŒ‰é’®éƒ½æœ‰è‡ªå·±çš„ onClick å¤„ç†å‡½æ•°ã€‚ä½ è®¤ä¸ºç‚¹å‡»æŒ‰é’®æ—¶ä¼šè§¦å‘å“ªäº›å¤„ç†å‡½æ•°ï¼Ÿ export default function Toolbar() return ( div className=Toolbar onClick=() = alert(ä½ ç‚¹å‡»äº† toolbar ï¼); button onClick=() = alert(æ­£åœ¨æ’­æ”¾ï¼) æ’­æ”¾ç”µå½± /button button onClick=() = alert(æ­£åœ¨ä¸Šä¼ ï¼) ä¸Šä¼ å›¾ç‰‡ /button /div ); å¦‚æœä½ ç‚¹å‡»ä»»ä¸€æŒ‰é’®ï¼Œå®ƒè‡ªèº«çš„ onClick å°†é¦–å…ˆæ‰§è¡Œï¼Œç„¶åçˆ¶çº§ div çš„ onClick ä¼šæ¥ç€æ‰§è¡Œã€‚å› æ­¤ä¼šå‡ºç°ä¸¤æ¡æ¶ˆæ¯ã€‚å¦‚æœä½ ç‚¹å‡» toolbar æœ¬èº«ï¼Œå°†åªæœ‰çˆ¶çº§ div çš„ onClick ä¼šæ‰§è¡Œã€‚ åœ¨ React ä¸­æ‰€æœ‰äº‹ä»¶éƒ½ä¼šä¼ æ’­ï¼Œé™¤äº† onScrollï¼Œå®ƒä»…é€‚ç”¨äºä½ é™„åŠ åˆ°çš„ JSX æ ‡ç­¾ã€‚ 3.1.6 é˜»æ­¢ä¼ æ’­äº‹ä»¶å¤„ç†å‡½æ•°æ¥æ”¶ä¸€ä¸ª äº‹ä»¶å¯¹è±¡ ä½œä¸ºå”¯ä¸€çš„å‚æ•°ã€‚æŒ‰ç…§æƒ¯ä¾‹ï¼Œå®ƒé€šå¸¸è¢«ç§°ä¸º e ï¼Œä»£è¡¨ â€œeventâ€ï¼ˆäº‹ä»¶ï¼‰ã€‚ä½ å¯ä»¥ä½¿ç”¨æ­¤å¯¹è±¡æ¥è¯»å–æœ‰å…³äº‹ä»¶çš„ä¿¡æ¯ã€‚ è¿™ä¸ªäº‹ä»¶å¯¹è±¡è¿˜å…è®¸ä½ é˜»æ­¢ä¼ æ’­ã€‚å¦‚æœä½ æƒ³é˜»æ­¢ä¸€ä¸ªäº‹ä»¶åˆ°è¾¾çˆ¶ç»„ä»¶ï¼Œä½ éœ€è¦åƒä¸‹é¢ Button ç»„ä»¶é‚£æ ·è°ƒç”¨ e.stopPropagation() ï¼š function Button( onClick, children ) return ( button onClick=e = e.stopPropagation(); onClick(); children /button );export default function Toolbar() return ( div className=Toolbar onClick=() = alert(ä½ ç‚¹å‡»äº† toolbar ï¼); Button onClick=() = alert(æ­£åœ¨æ’­æ”¾ï¼) æ’­æ”¾ç”µå½± /Button Button onClick=() = alert(æ­£åœ¨ä¸Šä¼ ï¼) ä¸Šä¼ å›¾ç‰‡ /Button /div ); å½“ä½ ç‚¹å‡»æŒ‰é’®æ—¶ï¼š React è°ƒç”¨äº†ä¼ é€’ç»™ button çš„ onClick å¤„ç†å‡½æ•°ã€‚ å®šä¹‰åœ¨Buttonä¸­çš„å¤„ç†å‡½æ•°æ‰§è¡Œäº†å¦‚ä¸‹æ“ä½œï¼š è°ƒç”¨ e.stopPropagation()ï¼Œé˜»æ­¢äº‹ä»¶è¿›ä¸€æ­¥å†’æ³¡ã€‚ è°ƒç”¨ onClick å‡½æ•°ï¼Œå®ƒæ˜¯ä» Toolbar ç»„ä»¶ä¼ é€’è¿‡æ¥çš„ propã€‚ åœ¨ Toolbar ç»„ä»¶ä¸­å®šä¹‰çš„å‡½æ•°ï¼Œæ˜¾ç¤ºæŒ‰é’®å¯¹åº”çš„ alertã€‚ ç”±äºä¼ æ’­è¢«é˜»æ­¢ï¼Œçˆ¶çº§ div çš„ onClick å¤„ç†å‡½æ•°ä¸ä¼šæ‰§è¡Œã€‚ ç”±äºè°ƒç”¨äº† e.stopPropagation()ï¼Œç‚¹å‡»æŒ‰é’®ç°åœ¨å°†åªæ˜¾ç¤ºä¸€ä¸ª alertï¼ˆæ¥è‡ª buttonï¼‰ï¼Œè€Œå¹¶éä¸¤ä¸ªï¼ˆåˆ†åˆ«æ¥è‡ª button å’Œçˆ¶çº§ toolbar divï¼‰ã€‚ç‚¹å‡»æŒ‰é’®ä¸ç‚¹å‡»å‘¨å›´çš„ toolbar ä¸åŒï¼Œå› æ­¤é˜»æ­¢ä¼ æ’­å¯¹è¿™ä¸ª UI æ˜¯æœ‰æ„ä¹‰çš„ã€‚ æ•è·é˜¶æ®µäº‹ä»¶æå°‘æ•°æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦æ•è·å­å…ƒç´ ä¸Šçš„æ‰€æœ‰äº‹ä»¶ï¼Œå³ä¾¿å®ƒä»¬é˜»æ­¢äº†ä¼ æ’­ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³å¯¹æ¯æ¬¡ç‚¹å‡»è¿›è¡ŒåŸ‹ç‚¹è®°å½•ï¼Œä¼ æ’­é€»è¾‘æš‚ä¸”ä¸è®ºã€‚é‚£ä¹ˆä½ å¯ä»¥é€šè¿‡åœ¨äº‹ä»¶åç§°æœ«å°¾æ·»åŠ  Capture æ¥å®ç°è¿™ä¸€ç‚¹ï¼š div onClickCapture=() = /* è¿™ä¼šé¦–å…ˆæ‰§è¡Œ */ button onClick=e = e.stopPropagation() / button onClick=e = e.stopPropagation() //div æ¯ä¸ªäº‹ä»¶åˆ†ä¸‰ä¸ªé˜¶æ®µä¼ æ’­ï¼š å®ƒå‘ä¸‹ä¼ æ’­ï¼Œè°ƒç”¨æ‰€æœ‰çš„ onClickCapture å¤„ç†å‡½æ•°ã€‚ å®ƒæ‰§è¡Œè¢«ç‚¹å‡»å…ƒç´ çš„ onClick å¤„ç†å‡½æ•°ã€‚ å®ƒå‘ä¸Šä¼ æ’­ï¼Œè°ƒç”¨æ‰€æœ‰çš„ onClick å¤„ç†å‡½æ•°ã€‚ æ•è·äº‹ä»¶å¯¹äºè·¯ç”±æˆ–æ•°æ®åˆ†æä¹‹ç±»çš„ä»£ç å¾ˆæœ‰ç”¨ï¼Œä½†ä½ å¯èƒ½ä¸ä¼šåœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­ä½¿ç”¨å®ƒä»¬ã€‚ 3.1.7 ä¼ é€’å¤„ç†å‡½æ•°ä½œä¸ºäº‹ä»¶ä¼ æ’­çš„æ›¿ä»£æ–¹æ¡ˆæ³¨æ„ï¼Œæ­¤å¤„çš„ç‚¹å‡»äº‹ä»¶å¤„ç†å‡½æ•°å…ˆæ‰§è¡Œäº†ä¸€è¡Œä»£ç ï¼Œç„¶åè°ƒç”¨äº†çˆ¶ç»„ä»¶ä¼ é€’çš„ onClick propï¼š function Button( onClick, children ) return ( button onClick=e = e.stopPropagation(); onClick(); children /button ); ä½ ä¹Ÿå¯ä»¥åœ¨è°ƒç”¨çˆ¶å…ƒç´  onClick å‡½æ•°ä¹‹å‰ï¼Œå‘è¿™ä¸ªå¤„ç†å‡½æ•°æ·»åŠ æ›´å¤šä»£ç ã€‚æ­¤æ¨¡å¼æ˜¯äº‹ä»¶ä¼ æ’­çš„å¦ä¸€ç§ æ›¿ä»£æ–¹æ¡ˆ ã€‚å®ƒè®©å­ç»„ä»¶å¤„ç†äº‹ä»¶ï¼ŒåŒæ—¶ä¹Ÿè®©çˆ¶ç»„ä»¶æŒ‡å®šä¸€äº›é¢å¤–çš„è¡Œä¸ºã€‚ä¸äº‹ä»¶ä¼ æ’­ä¸åŒï¼Œå®ƒå¹¶éè‡ªåŠ¨ã€‚ä½†ä½¿ç”¨è¿™ç§æ¨¡å¼çš„å¥½å¤„æ˜¯ä½ å¯ä»¥æ¸…æ¥šåœ°è¿½è¸ªå› æŸä¸ªäº‹ä»¶çš„è§¦å‘è€Œæ‰§è¡Œçš„æ•´æ¡ä»£ç é“¾ã€‚ å¦‚æœä½ ä¾èµ–äºäº‹ä»¶ä¼ æ’­ï¼Œè€Œä¸”å¾ˆéš¾è¿½è¸ªå“ªäº›å¤„ç†ç¨‹åºåœ¨æ‰§è¡Œï¼ŒåŠå…¶æ‰§è¡Œçš„åŸå› ï¼Œå¯ä»¥å°è¯•è¿™ç§æ–¹æ³•ã€‚ 3.1.8 é˜»æ­¢é»˜è®¤è¡Œä¸ºæŸäº›æµè§ˆå™¨äº‹ä»¶å…·æœ‰ä¸äº‹ä»¶ç›¸å…³è”çš„é»˜è®¤è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œç‚¹å‡» form è¡¨å•å†…éƒ¨çš„æŒ‰é’®ä¼šè§¦å‘è¡¨å•æäº¤äº‹ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹å°†é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢ï¼š export default function Signup() return ( form onSubmit=() = alert(æäº¤è¡¨å•ï¼) input / buttonå‘é€/button /form ); ä½ å¯ä»¥è°ƒç”¨äº‹ä»¶å¯¹è±¡ä¸­çš„ e.preventDefault() æ¥é˜»æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿï¼š export default function Signup() return ( form onSubmit=e = e.preventDefault(); alert(æäº¤è¡¨å•ï¼); input / buttonå‘é€/button /form ); ä¸è¦æ··æ·† e.stopPropagation() å’Œ e.preventDefault()ã€‚å®ƒä»¬éƒ½å¾ˆæœ‰ç”¨ï¼Œä½†äºŒè€…å¹¶ä¸ç›¸å…³ï¼š e.stopPropagation() é˜»æ­¢è§¦å‘ç»‘å®šåœ¨å¤–å±‚æ ‡ç­¾ä¸Šçš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚ e.preventDefault() é˜»æ­¢å°‘æ•°äº‹ä»¶çš„é»˜è®¤æµè§ˆå™¨è¡Œä¸ºã€‚ 3.1.9 äº‹ä»¶å¤„ç†å‡½æ•°å¯ä»¥åŒ…å«å‰¯ä½œç”¨å—ï¼Ÿå½“ç„¶å¯ä»¥ï¼äº‹ä»¶å¤„ç†å‡½æ•°æ˜¯æ‰§è¡Œå‰¯ä½œç”¨çš„æœ€ä½³ä½ç½®ã€‚ ä¸æ¸²æŸ“å‡½æ•°ä¸åŒï¼Œäº‹ä»¶å¤„ç†å‡½æ•°ä¸éœ€è¦æ˜¯ çº¯å‡½æ•°ï¼Œå› æ­¤å®ƒæ˜¯ç”¨æ¥ æ›´æ”¹ æŸäº›å€¼çš„ç»ä½³ä½ç½®ã€‚ä¾‹å¦‚ï¼Œæ›´æ”¹è¾“å…¥æ¡†çš„å€¼ä»¥å“åº”é”®å…¥ï¼Œæˆ–è€…æ›´æ”¹åˆ—è¡¨ä»¥å“åº”æŒ‰é’®çš„è§¦å‘ã€‚ä½†æ˜¯ï¼Œä¸ºäº†æ›´æ”¹æŸäº›ä¿¡æ¯ï¼Œä½ é¦–å…ˆéœ€è¦æŸç§æ–¹å¼å­˜å‚¨å®ƒã€‚åœ¨ React ä¸­ï¼Œè¿™æ˜¯é€šè¿‡ stateï¼ˆç»„ä»¶çš„è®°å¿†ï¼‰ æ¥å®Œæˆçš„ã€‚ 3.1.10 æ‘˜è¦ ä½ å¯ä»¥é€šè¿‡å°†å‡½æ•°ä½œä¸º prop ä¼ é€’ç»™å…ƒç´ å¦‚ button æ¥å¤„ç†äº‹ä»¶ã€‚ å¿…é¡»ä¼ é€’äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè€Œéå‡½æ•°è°ƒç”¨ï¼ onClick=handleClick ï¼Œä¸æ˜¯ onClick=handleClick()ã€‚ ä½ å¯ä»¥å•ç‹¬æˆ–è€…å†…è”å®šä¹‰äº‹ä»¶å¤„ç†å‡½æ•°ã€‚ äº‹ä»¶å¤„ç†å‡½æ•°åœ¨ç»„ä»¶å†…éƒ¨å®šä¹‰ï¼Œæ‰€ä»¥å®ƒä»¬å¯ä»¥è®¿é—® propsã€‚ ä½ å¯ä»¥åœ¨çˆ¶ç»„ä»¶ä¸­å®šä¹‰ä¸€ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå¹¶å°†å…¶ä½œä¸º prop ä¼ é€’ç»™å­ç»„ä»¶ã€‚ ä½ å¯ä»¥æ ¹æ®ç‰¹å®šäºåº”ç”¨ç¨‹åºçš„åç§°å®šä¹‰äº‹ä»¶å¤„ç†å‡½æ•°çš„ propã€‚ äº‹ä»¶ä¼šå‘ä¸Šä¼ æ’­ã€‚é€šè¿‡äº‹ä»¶çš„ç¬¬ä¸€ä¸ªå‚æ•°è°ƒç”¨ e.stopPropagation() æ¥é˜²æ­¢è¿™ç§æƒ…å†µã€‚ äº‹ä»¶å¯èƒ½å…·æœ‰ä¸éœ€è¦çš„æµè§ˆå™¨é»˜è®¤è¡Œä¸ºã€‚è°ƒç”¨ e.preventDefault() æ¥é˜»æ­¢è¿™ç§æƒ…å†µã€‚ ä»å­ç»„ä»¶æ˜¾å¼è°ƒç”¨äº‹ä»¶å¤„ç†å‡½æ•° prop æ˜¯äº‹ä»¶ä¼ æ’­çš„å¦ä¸€ç§ä¼˜ç§€æ›¿ä»£æ–¹æ¡ˆã€‚ 3.2 Stateï¼šç»„ä»¶çš„è®°å¿†ç»„ä»¶é€šå¸¸éœ€è¦æ ¹æ®äº¤äº’æ›´æ”¹å±å¹•ä¸Šæ˜¾ç¤ºçš„å†…å®¹ã€‚è¾“å…¥è¡¨å•åº”è¯¥æ›´æ–°è¾“å…¥å­—æ®µï¼Œå•å‡»è½®æ’­å›¾ä¸Šçš„â€œä¸‹ä¸€ä¸ªâ€åº”è¯¥æ›´æ”¹æ˜¾ç¤ºçš„å›¾ç‰‡ï¼Œå•å‡»â€œè´­ä¹°â€åº”è¯¥å°†å•†å“æ”¾å…¥è´­ç‰©è½¦ã€‚ç»„ä»¶éœ€è¦â€œè®°ä½â€æŸäº›ä¸œè¥¿ï¼šå½“å‰è¾“å…¥å€¼ã€å½“å‰å›¾ç‰‡ã€è´­ç‰©è½¦ã€‚åœ¨ React ä¸­ï¼Œè¿™ç§ç»„ä»¶ç‰¹æœ‰çš„è®°å¿†è¢«ç§°ä¸º stateã€‚ 3.2.1 å½“æ™®é€šçš„å˜é‡æ— æ³•æ»¡è¶³æ—¶ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ¸²æŸ“é›•å¡‘å›¾ç‰‡çš„ç»„ä»¶ã€‚ç‚¹å‡» â€œNextâ€ æŒ‰é’®åº”è¯¥æ˜¾ç¤ºä¸‹ä¸€ä¸ªé›•å¡‘å¹¶å°† index æ›´æ”¹ä¸º 1ï¼Œå†æ¬¡ç‚¹å‡»åˆæ›´æ”¹ä¸º 2ï¼Œä»¥æ­¤ç±»æ¨ã€‚ä½†è¿™ä¸ªç»„ä»¶ç°åœ¨ä¸èµ·ä½œç”¨ï¼š data.js export const sculptureList = [ name: Homenaje a la NeurocirugÃ­a, artist: Marta Colvin Andrade, description: Although Colvin is predominantly known for abstract themes that allude to pre-Hispanic symbols, this gigantic sculpture, an homage to neurosurgery, is one of her most recognizable public art pieces., url: https://i.imgur.com/Mx7dA2Y.jpg, alt: A bronze statue of two crossed hands delicately holding a human brain in their fingertips. , name: Floralis GenÃ©rica, artist: Eduardo Catalano, description: This enormous (75 ft. or 23m) silver flower is located in Buenos Aires. It is designed to move, closing its petals in the evening or when strong winds blow and opening them in the morning., url: https://i.imgur.com/ZF6s192m.jpg, alt: A gigantic metallic flower sculpture with reflective mirror-like petals and strong stamens.]; App.js import sculptureList from ./data.js;export default function Gallery() let index = 0; function handleClick() index = index + 1; let sculpture = sculptureList[index]; return ( button onClick=handleClick Next /button h2 isculpture.name /i by sculpture.artist /h2 h3 (index + 1 of sculptureList.length) /h3 img src=sculpture.url alt=sculpture.alt / p sculpture.description /p / ); handleClick() äº‹ä»¶å¤„ç†å‡½æ•°æ­£åœ¨æ›´æ–°å±€éƒ¨å˜é‡ indexã€‚ä½†å­˜åœ¨ä¸¤ä¸ªåŸå› ä½¿å¾—å˜åŒ–ä¸å¯è§ï¼š å±€éƒ¨å˜é‡æ— æ³•åœ¨å¤šæ¬¡æ¸²æŸ“ä¸­æŒä¹…ä¿å­˜ã€‚ å½“ React å†æ¬¡æ¸²æŸ“è¿™ä¸ªç»„ä»¶æ—¶ï¼Œå®ƒä¼šä»å¤´å¼€å§‹æ¸²æŸ“â€”â€”ä¸ä¼šè€ƒè™‘ä¹‹å‰å¯¹å±€éƒ¨å˜é‡çš„ä»»ä½•æ›´æ”¹ã€‚ æ›´æ”¹å±€éƒ¨å˜é‡ä¸ä¼šè§¦å‘æ¸²æŸ“ã€‚ React æ²¡æœ‰æ„è¯†åˆ°å®ƒéœ€è¦ä½¿ç”¨æ–°æ•°æ®å†æ¬¡æ¸²æŸ“ç»„ä»¶ã€‚ è¦ä½¿ç”¨æ–°æ•°æ®æ›´æ–°ç»„ä»¶ï¼Œéœ€è¦åšä¸¤ä»¶äº‹ï¼š ä¿ç•™ æ¸²æŸ“ä¹‹é—´çš„æ•°æ®ã€‚ è§¦å‘ React ä½¿ç”¨æ–°æ•°æ®æ¸²æŸ“ç»„ä»¶ï¼ˆé‡æ–°æ¸²æŸ“ï¼‰ã€‚ useState Hook æä¾›äº†è¿™ä¸¤ä¸ªåŠŸèƒ½ï¼š State å˜é‡ ç”¨äºä¿å­˜æ¸²æŸ“é—´çš„æ•°æ®ã€‚ State setter å‡½æ•° æ›´æ–°å˜é‡å¹¶è§¦å‘ React å†æ¬¡æ¸²æŸ“ç»„ä»¶ã€‚ 3.2.2 æ·»åŠ ä¸€ä¸ª state å˜é‡è¦æ·»åŠ  state å˜é‡ï¼Œå…ˆä»æ–‡ä»¶é¡¶éƒ¨çš„ React ä¸­å¯¼å…¥ useStateï¼š import useState from react; ç„¶åï¼Œæ›¿æ¢è¿™ä¸€è¡Œï¼š let index = 0; å°†å…¶ä¿®æ”¹ä¸º const [index, setIndex] = useState(0); index æ˜¯ä¸€ä¸ª state å˜é‡ï¼ŒsetIndex æ˜¯å¯¹åº”çš„ setter å‡½æ•°ã€‚ è¿™é‡Œçš„ [ å’Œ ] è¯­æ³•ç§°ä¸ºæ•°ç»„è§£æ„ï¼Œå®ƒå…è®¸ä½ ä»æ•°ç»„ä¸­è¯»å–å€¼ã€‚ useState è¿”å›çš„æ•°ç»„æ€»æ˜¯æ­£å¥½æœ‰ä¸¤é¡¹ã€‚ ä»¥ä¸‹å±•ç¤ºäº†å®ƒä»¬åœ¨ handleClick() ä¸­æ˜¯å¦‚ä½•å…±åŒèµ·ä½œç”¨çš„ï¼š function handleClick() setIndex(index + 1); ç°åœ¨ç‚¹å‡» â€œNextâ€ æŒ‰é’®åˆ‡æ¢å½“å‰é›•å¡‘ï¼š import useState from react;import sculptureList from ./data.js;export default function Gallery() const [index, setIndex] = useState(0); function handleClick() setIndex(index + 1); let sculpture = sculptureList[index]; return ( button onClick=handleClick Next /button h2 isculpture.name /i by sculpture.artist /h2 h3 (index + 1 of sculptureList.length) /h3 img src=sculpture.url alt=sculpture.alt / p sculpture.description /p / ); 3.2.3 é‡è§ä½ çš„ç¬¬ä¸€ä¸ª Hookåœ¨ React ä¸­ï¼ŒuseState ä»¥åŠä»»ä½•å…¶ä»–ä»¥â€œuseâ€å¼€å¤´çš„å‡½æ•°éƒ½è¢«ç§°ä¸º Hookã€‚ Hook æ˜¯ç‰¹æ®Šçš„å‡½æ•°ï¼Œåªåœ¨ React æ¸²æŸ“æ—¶æœ‰æ•ˆï¼ˆæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚è¯¦ç»†ä»‹ç»ï¼‰ã€‚å®ƒä»¬èƒ½è®©ä½  â€œhookâ€ åˆ°ä¸åŒçš„ React ç‰¹æ€§ä¸­å»ã€‚ State åªæ˜¯è¿™äº›ç‰¹æ€§ä¸­çš„ä¸€ä¸ªï¼Œä½ ä¹‹åè¿˜ä¼šé‡åˆ°å…¶ä»– Hookã€‚ Hooks â€”â€”ä»¥ use å¼€å¤´çš„å‡½æ•°â€”â€”åªèƒ½åœ¨ç»„ä»¶æˆ–è‡ªå®šä¹‰ Hook çš„æœ€é¡¶å±‚è°ƒç”¨ã€‚ ä½ ä¸èƒ½åœ¨æ¡ä»¶è¯­å¥ã€å¾ªç¯è¯­å¥æˆ–å…¶ä»–åµŒå¥—å‡½æ•°å†…è°ƒç”¨ Hookã€‚Hook æ˜¯å‡½æ•°ï¼Œä½†å°†å®ƒä»¬è§†ä¸ºå…³äºç»„ä»¶éœ€æ±‚çš„æ— æ¡ä»¶å£°æ˜ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚åœ¨ç»„ä»¶é¡¶éƒ¨ â€œuseâ€ React ç‰¹æ€§ï¼Œç±»ä¼¼äºåœ¨æ–‡ä»¶é¡¶éƒ¨â€œå¯¼å…¥â€æ¨¡å—ã€‚ 3.2.4 å‰–æ useStateå½“ä½ è°ƒç”¨ useState æ—¶ï¼Œä½ æ˜¯åœ¨å‘Šè¯‰ React ä½ æƒ³è®©è¿™ä¸ªç»„ä»¶è®°ä½ä¸€äº›ä¸œè¥¿ï¼š const [index, setIndex] = useState(0); åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œä½ å¸Œæœ› React è®°ä½ indexã€‚ æƒ¯ä¾‹æ˜¯å°†è¿™å¯¹è¿”å›å€¼å‘½åä¸º const [thing, setThing]ã€‚ä½ ä¹Ÿå¯ä»¥å°†å…¶å‘½åä¸ºä»»ä½•ä½ å–œæ¬¢çš„åç§°ï¼Œä½†éµç…§çº¦å®šä¿—æˆèƒ½ä½¿è·¨é¡¹ç›®åˆä½œæ›´æ˜“ç†è§£ã€‚ useState çš„å”¯ä¸€å‚æ•°æ˜¯ state å˜é‡çš„åˆå§‹å€¼ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œindex çš„åˆå§‹å€¼è¢«useState(0)è®¾ç½®ä¸º 0ã€‚ æ¯æ¬¡ä½ çš„ç»„ä»¶æ¸²æŸ“æ—¶ï¼ŒuseState éƒ½ä¼šç»™ä½ ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå€¼çš„æ•°ç»„ï¼š state å˜é‡ (index) ä¼šä¿å­˜ä¸Šæ¬¡æ¸²æŸ“çš„å€¼ã€‚ state setter å‡½æ•° (setIndex) å¯ä»¥æ›´æ–° state å˜é‡å¹¶è§¦å‘ React é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚ ä»¥ä¸‹æ˜¯å®é™…å‘ç”Ÿçš„æƒ…å†µï¼š const [index, setIndex] = useState(0); ç»„ä»¶è¿›è¡Œç¬¬ä¸€æ¬¡æ¸²æŸ“ã€‚ å› ä¸ºä½ å°† 0 ä½œä¸º index çš„åˆå§‹å€¼ä¼ é€’ç»™ useStateï¼Œå®ƒå°†è¿”å› [0, setIndex]ã€‚ React è®°ä½ 0 æ˜¯æœ€æ–°çš„ state å€¼ã€‚ ä½ æ›´æ–°äº† stateã€‚å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œå®ƒä¼šè°ƒç”¨ setIndex(index + 1)ã€‚ index æ˜¯ 0ï¼Œæ‰€ä»¥å®ƒæ˜¯ setIndex(1)ã€‚è¿™å‘Šè¯‰ React ç°åœ¨è®°ä½ index æ˜¯ 1 å¹¶è§¦å‘ä¸‹ä¸€æ¬¡æ¸²æŸ“ã€‚ ç»„ä»¶è¿›è¡Œç¬¬äºŒæ¬¡æ¸²æŸ“ã€‚React ä»ç„¶çœ‹åˆ° useState(0)ï¼Œä½†æ˜¯å› ä¸º React è®°ä½ äº†ä½ å°† index è®¾ç½®ä¸ºäº† 1ï¼Œå®ƒå°†è¿”å› [1, setIndex]ã€‚ ä»¥æ­¤ç±»æ¨ï¼ 3.2.5 èµ‹äºˆä¸€ä¸ªç»„ä»¶å¤šä¸ª state å˜é‡ä½ å¯ä»¥åœ¨ä¸€ä¸ªç»„ä»¶ä¸­æ‹¥æœ‰ä»»æ„å¤šç§ç±»å‹çš„ state å˜é‡ã€‚è¯¥ç»„ä»¶æœ‰ä¸¤ä¸ª state å˜é‡ï¼Œä¸€ä¸ªæ•°å­— index å’Œä¸€ä¸ªå¸ƒå°”å€¼ showMoreï¼Œç‚¹å‡» â€œShow Detailsâ€ ä¼šæ”¹å˜ showMore çš„å€¼ï¼š data.js export const sculptureList = [ name: Homenaje a la NeurocirugÃ­a, artist: Marta Colvin Andrade, description: Although Colvin is predominantly known for abstract themes that allude to pre-Hispanic symbols, this gigantic sculpture, an homage to neurosurgery, is one of her most recognizable public art pieces., url: https://i.imgur.com/Mx7dA2Y.jpg, alt: A bronze statue of two crossed hands delicately holding a human brain in their fingertips. , name: Floralis GenÃ©rica, artist: Eduardo Catalano, description: This enormous (75 ft. or 23m) silver flower is located in Buenos Aires. It is designed to move, closing its petals in the evening or when strong winds blow and opening them in the morning., url: https://i.imgur.com/ZF6s192m.jpg, alt: A gigantic metallic flower sculpture with reflective mirror-like petals and strong stamens.]; App.js import useState from react;import sculptureList from ./data.js;export default function Gallery() const [index, setIndex] = useState(0); const [showMore, setShowMore] = useState(false); function handleNextClick() setIndex(index + 1); function handleMoreClick() setShowMore(!showMore); let sculpture = sculptureList[index]; return ( button onClick=handleNextClick Next /button h2 isculpture.name /i by sculpture.artist /h2 h3 (index + 1 of sculptureList.length) /h3 button onClick=handleMoreClick showMore ? Hide : Show details /button showMore psculpture.description/p img src=sculpture.url alt=sculpture.alt / / ); å¦‚æœå®ƒä»¬ä¸ç›¸å…³ï¼Œé‚£ä¹ˆå­˜åœ¨å¤šä¸ª state å˜é‡æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œä¾‹å¦‚æœ¬ä¾‹ä¸­çš„ index å’Œ showMoreã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ å‘ç°ç»å¸¸åŒæ—¶æ›´æ”¹ä¸¤ä¸ª state å˜é‡ï¼Œé‚£ä¹ˆæœ€å¥½å°†å®ƒä»¬åˆå¹¶ä¸ºä¸€ä¸ªã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªåŒ…å«å¤šä¸ªå­—æ®µçš„è¡¨å•ï¼Œé‚£ä¹ˆæœ‰ä¸€ä¸ªå€¼ä¸ºå¯¹è±¡çš„ state å˜é‡æ¯”æ¯ä¸ªå­—æ®µå¯¹åº”ä¸€ä¸ª state å˜é‡æ›´æ–¹ä¾¿ã€‚ é€‰æ‹© state ç»“æ„åœ¨è¿™æ–¹é¢æœ‰æ›´å¤šæç¤ºã€‚ React å¦‚ä½•çŸ¥é“è¿”å›å“ªä¸ª stateä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼ŒuseState åœ¨è°ƒç”¨æ—¶æ²¡æœ‰ä»»ä½•å…³äºå®ƒå¼•ç”¨çš„æ˜¯å“ªä¸ª state å˜é‡çš„ä¿¡æ¯ã€‚æ²¡æœ‰ä¼ é€’ç»™ useState çš„â€œæ ‡è¯†ç¬¦â€ï¼Œå®ƒæ˜¯å¦‚ä½•çŸ¥é“è¦è¿”å›å“ªä¸ª state å˜é‡å‘¢ï¼Ÿå®ƒæ˜¯å¦ä¾èµ–äºè§£æå‡½æ•°ä¹‹ç±»çš„é­”æ³•ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚ ç›¸åï¼Œä¸ºäº†ä½¿è¯­æ³•æ›´ç®€æ´ï¼Œåœ¨åŒä¸€ç»„ä»¶çš„æ¯æ¬¡æ¸²æŸ“ä¸­ï¼ŒHooks éƒ½ä¾æ‰˜äºä¸€ä¸ªç¨³å®šçš„è°ƒç”¨é¡ºåºã€‚è¿™åœ¨å®è·µä¸­å¾ˆæœ‰æ•ˆï¼Œå› ä¸ºå¦‚æœä½ éµå¾ªä¸Šé¢çš„è§„åˆ™ï¼ˆâ€œåªåœ¨é¡¶å±‚è°ƒç”¨ Hooksâ€ï¼‰ï¼ŒHooks å°†å§‹ç»ˆä»¥ç›¸åŒçš„é¡ºåºè¢«è°ƒç”¨ã€‚æ­¤å¤–ï¼Œlinter æ’ä»¶ä¹Ÿå¯ä»¥æ•è·å¤§å¤šæ•°é”™è¯¯ã€‚ åœ¨ React å†…éƒ¨ï¼Œä¸ºæ¯ä¸ªç»„ä»¶ä¿å­˜äº†ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ª state å¯¹ã€‚å®ƒç»´æŠ¤å½“å‰ state å¯¹çš„ç´¢å¼•å€¼ï¼Œåœ¨æ¸²æŸ“ä¹‹å‰å°†å…¶è®¾ç½®ä¸º â€œ0â€ã€‚æ¯æ¬¡è°ƒç”¨ useState æ—¶ï¼ŒReact éƒ½ä¼šä¸ºä½ æä¾›ä¸€ä¸ª state å¯¹å¹¶å¢åŠ ç´¢å¼•å€¼ã€‚ä½ å¯ä»¥åœ¨æ–‡ç«  React Hooks: not magic, just arraysä¸­é˜…è¯»æœ‰å…³æ­¤æœºåˆ¶çš„æ›´å¤šä¿¡æ¯ã€‚ è¿™ä¸ªä¾‹å­æ²¡æœ‰ä½¿ç”¨ Reactï¼Œä½†å®ƒè®©ä½ äº†è§£ useState åœ¨å†…éƒ¨æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š button id=nextButton Next/buttonh3 id=header/h3button id=moreButton/buttonp id=description/pimg id=imagestyle* box-sizing: border-box; body font-family: sans-serif; margin: 20px; padding: 0; button display: block; margin-bottom: 10px; /style let componentHooks = [];let currentHookIndex = 0;// useState åœ¨ React ä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼ˆç®€åŒ–ç‰ˆï¼‰function useState(initialState) let pair = componentHooks[currentHookIndex]; if (pair) // è¿™ä¸æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“ // æ‰€ä»¥ state pair å·²ç»å­˜åœ¨ // å°†å…¶è¿”å›å¹¶ä¸ºä¸‹ä¸€æ¬¡ hook çš„è°ƒç”¨åšå‡†å¤‡ currentHookIndex++; return pair; // è¿™æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡è¿›è¡Œæ¸²æŸ“ // æ‰€ä»¥æ–°å»ºä¸€ä¸ª state pair ç„¶åå­˜å‚¨å®ƒ pair = [initialState, setState]; function setState(nextState) // å½“ç”¨æˆ·å‘èµ· state çš„å˜æ›´ï¼Œ // æŠŠæ–°çš„å€¼æ”¾å…¥ pair ä¸­ pair[0] = nextState; updateDOM(); // å­˜å‚¨è¿™ä¸ª pair ç”¨äºå°†æ¥çš„æ¸²æŸ“ // å¹¶ä¸”ä¸ºä¸‹ä¸€æ¬¡ hook çš„è°ƒç”¨åšå‡†å¤‡ componentHooks[currentHookIndex] = pair; currentHookIndex++; return pair;function Gallery() // æ¯æ¬¡è°ƒç”¨ useState() éƒ½ä¼šå¾—åˆ°æ–°çš„ pair const [index, setIndex] = useState(0); const [showMore, setShowMore] = useState(false); function handleNextClick() setIndex(index + 1); function handleMoreClick() setShowMore(!showMore); let sculpture = sculptureList[index]; // è¿™ä¸ªä¾‹å­æ²¡æœ‰ä½¿ç”¨ Reactï¼Œæ‰€ä»¥ // è¿”å›ä¸€ä¸ªå¯¹è±¡è€Œä¸æ˜¯ JSX return onNextClick: handleNextClick, onMoreClick: handleMoreClick, header: `$sculpture.name by $sculpture.artist`, counter: `$index + 1 of $sculptureList.length`, more: `$showMore ? Hide : Show details`, description: showMore ? sculpture.description : null, imageSrc: sculpture.url, imageAlt: sculpture.alt ;function updateDOM() // åœ¨æ¸²æŸ“ç»„ä»¶ä¹‹å‰ // é‡ç½®å½“å‰ Hook çš„ä¸‹æ ‡ currentHookIndex = 0; let output = Gallery(); // æ›´æ–° DOM ä»¥åŒ¹é…è¾“å‡ºç»“æœ // è¿™éƒ¨åˆ†å·¥ä½œç”± React ä¸ºä½ å®Œæˆ nextButton.onclick = output.onNextClick; header.textContent = output.header; moreButton.onclick = output.onMoreClick; moreButton.textContent = output.more; image.src = output.imageSrc; image.alt = output.imageAlt; if (output.description !== null) description.textContent = output.description; description.style.display = ; else description.style.display = none; let nextButton = document.getElementById(nextButton);let header = document.getElementById(header);let moreButton = document.getElementById(moreButton);let description = document.getElementById(description);let image = document.getElementById(image);let sculptureList = [ name: Homenaje a la NeurocirugÃ­a, artist: Marta Colvin Andrade, description: Although Colvin is predominantly known for abstract themes that allude to pre-Hispanic symbols, this gigantic sculpture, an homage to neurosurgery, is one of her most recognizable public art pieces., url: https://i.imgur.com/Mx7dA2Y.jpg, alt: A bronze statue of two crossed hands delicately holding a human brain in their fingertips. , name: Floralis GenÃ©rica, artist: Eduardo Catalano, description: This enormous (75 ft. or 23m) silver flower is located in Buenos Aires. It is designed to move, closing its petals in the evening or when strong winds blow and opening them in the morning., url: https://i.imgur.com/ZF6s192m.jpg, alt: A gigantic metallic flower sculpture with reflective mirror-like petals and strong stamens.];// ä½¿ UI åŒ¹é…å½“å‰ stateupdateDOM(); ä½ ä¸å¿…ç†è§£å®ƒå°±å¯ä»¥ä½¿ç”¨ Reactï¼Œä½†ä½ å¯èƒ½ä¼šå‘ç°è¿™æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å¿ƒæ™ºæ¨¡å‹ã€‚ 3.2.6 State æ˜¯éš”ç¦»ä¸”ç§æœ‰çš„App.js import Gallery from ./Gallery.js;export default function Page() return ( div className=Page Gallery / Gallery / /div ); Gallery.js import useState from react;import sculptureList from ./data.js;export default function Gallery() const [index, setIndex] = useState(0); const [showMore, setShowMore] = useState(false); function handleNextClick() setIndex(index + 1); function handleMoreClick() setShowMore(!showMore); let sculpture = sculptureList[index]; return ( section button onClick=handleNextClick Next /button h2 isculpture.name /i by sculpture.artist /h2 h3 (index + 1 of sculptureList.length) /h3 button onClick=handleMoreClick showMore ? Hide : Show details /button showMore psculpture.description/p img src=sculpture.url alt=sculpture.alt / /section ); data.js export const sculptureList = [ name: Homenaje a la NeurocirugÃ­a, artist: Marta Colvin Andrade, description: Although Colvin is predominantly known for abstract themes that allude to pre-Hispanic symbols, this gigantic sculpture, an homage to neurosurgery, is one of her most recognizable public art pieces., url: https://i.imgur.com/Mx7dA2Y.jpg, alt: A bronze statue of two crossed hands delicately holding a human brain in their fingertips. , name: Floralis GenÃ©rica, artist: Eduardo Catalano, description: This enormous (75 ft. or 23m) silver flower is located in Buenos Aires. It is designed to move, closing its petals in the evening or when strong winds blow and opening them in the morning., url: https://i.imgur.com/ZF6s192m.jpg, alt: A gigantic metallic flower sculpture with reflective mirror-like petals and strong stamens.]; è¿™å°±æ˜¯ state ä¸å£°æ˜åœ¨æ¨¡å—é¡¶éƒ¨çš„æ™®é€šå˜é‡ä¸åŒçš„åŸå› ã€‚ State ä¸ä¾èµ–äºç‰¹å®šçš„å‡½æ•°è°ƒç”¨æˆ–åœ¨ä»£ç ä¸­çš„ä½ç½®ï¼Œå®ƒçš„ä½œç”¨åŸŸâ€œåªé™äºâ€å±å¹•ä¸Šçš„æŸå—ç‰¹å®šåŒºåŸŸã€‚ä½ æ¸²æŸ“äº†ä¸¤ä¸ª Gallery / ç»„ä»¶ï¼Œæ‰€ä»¥å®ƒä»¬çš„ state æ˜¯åˆ†åˆ«å­˜å‚¨çš„ã€‚ è¿˜è¦æ³¨æ„ Page ç»„ä»¶â€œä¸çŸ¥é“â€å…³äº Gallery state çš„ä»»ä½•ä¿¡æ¯ï¼Œç”šè‡³ä¸çŸ¥é“å®ƒæ˜¯å¦æœ‰ä»»ä½• stateã€‚ä¸ props ä¸åŒï¼Œstate å®Œå…¨ç§æœ‰äºå£°æ˜å®ƒçš„ç»„ä»¶ã€‚çˆ¶ç»„ä»¶æ— æ³•æ›´æ”¹å®ƒã€‚è¿™ä½¿ä½ å¯ä»¥å‘ä»»ä½•ç»„ä»¶æ·»åŠ æˆ–åˆ é™¤ stateï¼Œè€Œä¸ä¼šå½±å“å…¶ä»–ç»„ä»¶ã€‚ å¦‚æœä½ å¸Œæœ›ä¸¤ä¸ªç”»å»Šä¿æŒå…¶ states åŒæ­¥æ€ä¹ˆåŠï¼Ÿåœ¨ React ä¸­æ‰§è¡Œæ­¤æ“ä½œçš„æ­£ç¡®æ–¹æ³•æ˜¯ä»å­ç»„ä»¶ä¸­åˆ é™¤ state å¹¶å°†å…¶æ·»åŠ åˆ°ç¦»å®ƒä»¬æœ€è¿‘çš„å…±äº«çˆ¶ç»„ä»¶ä¸­ã€‚æ¥ä¸‹æ¥çš„å‡ èŠ‚å°†ä¸“æ³¨äºç»„ç»‡å•ä¸ªç»„ä»¶çš„ stateï¼Œä½†æˆ‘ä»¬å°†åœ¨ç»„ä»¶é—´å…±äº« state ä¸­å›åˆ°è¿™ä¸ªä¸»é¢˜ã€‚ 3.2.7 æ‘˜è¦ å½“ä¸€ä¸ªç»„ä»¶éœ€è¦åœ¨å¤šæ¬¡æ¸²æŸ“é—´â€œè®°ä½â€æŸäº›ä¿¡æ¯æ—¶ä½¿ç”¨ state å˜é‡ã€‚ State å˜é‡æ˜¯é€šè¿‡è°ƒç”¨ useState Hook æ¥å£°æ˜çš„ã€‚ Hook æ˜¯ä»¥ use å¼€å¤´çš„ç‰¹æ®Šå‡½æ•°ã€‚å®ƒä»¬èƒ½è®©ä½  â€œhookâ€ åˆ°åƒ state è¿™æ ·çš„ React ç‰¹æ€§ä¸­ã€‚ Hook å¯èƒ½ä¼šè®©ä½ æƒ³èµ· importï¼šå®ƒä»¬éœ€è¦åœ¨éæ¡ä»¶è¯­å¥ä¸­è°ƒç”¨ã€‚è°ƒç”¨ Hook æ—¶ï¼ŒåŒ…æ‹¬ useStateï¼Œä»…åœ¨ç»„ä»¶æˆ–å¦ä¸€ä¸ª Hook çš„é¡¶å±‚è¢«è°ƒç”¨æ‰æœ‰æ•ˆã€‚ useState Hook è¿”å›ä¸€å¯¹å€¼ï¼šå½“å‰ state å’Œæ›´æ–°å®ƒçš„å‡½æ•°ã€‚ ä½ å¯ä»¥æ‹¥æœ‰å¤šä¸ª state å˜é‡ã€‚åœ¨å†…éƒ¨ï¼ŒReact æŒ‰é¡ºåºåŒ¹é…å®ƒä»¬ã€‚ State æ˜¯ç»„ä»¶ç§æœ‰çš„ã€‚å¦‚æœä½ åœ¨ä¸¤ä¸ªåœ°æ–¹æ¸²æŸ“å®ƒï¼Œåˆ™æ¯ä¸ªå‰¯æœ¬éƒ½æœ‰ç‹¬å±äºè‡ªå·±çš„ stateã€‚ 3.3 æ¸²æŸ“å’Œæäº¤ç»„ä»¶æ˜¾ç¤ºåˆ°å±å¹•ä¹‹å‰ï¼Œå…¶å¿…é¡»è¢« React æ¸²æŸ“ã€‚ç†è§£è¿™äº›å¤„ç†æ­¥éª¤å°†å¸®åŠ©ä½ æ€è€ƒä»£ç çš„æ‰§è¡Œè¿‡ç¨‹å¹¶èƒ½è§£é‡Šå…¶è¡Œä¸ºã€‚ æƒ³è±¡ä¸€ä¸‹ï¼Œä½ çš„ç»„ä»¶æ˜¯å¨æˆ¿é‡Œçš„å¨å¸ˆï¼ŒæŠŠé£Ÿæçƒ¹åˆ¶æˆç¾å‘³çš„èœè‚´ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼ŒReact å°±æ˜¯ä¸€åæœåŠ¡å‘˜ï¼Œä»–ä¼šå¸®å®¢æˆ·ä»¬ä¸‹å•å¹¶ä¸ºä»–ä»¬é€æ¥æ‰€ç‚¹çš„èœå“ã€‚è¿™ç§è¯·æ±‚å’Œæä¾› UI çš„è¿‡ç¨‹æ€»å…±åŒ…æ‹¬ä¸‰ä¸ªæ­¥éª¤ï¼š è§¦å‘ ä¸€æ¬¡æ¸²æŸ“ï¼ˆæŠŠå®¢äººçš„ç‚¹å•åˆ†å‘åˆ°å¨æˆ¿ï¼‰ æ¸²æŸ“ ç»„ä»¶ï¼ˆåœ¨å¨æˆ¿å‡†å¤‡è®¢å•ï¼‰ æäº¤ åˆ° DOMï¼ˆå°†èœå“æ”¾åœ¨æ¡Œå­ä¸Šï¼‰ 3.3.1 æ­¥éª¤ 1: è§¦å‘ä¸€æ¬¡æ¸²æŸ“æœ‰ä¸¤ç§åŸå› ä¼šå¯¼è‡´ç»„ä»¶çš„æ¸²æŸ“: ç»„ä»¶çš„ åˆæ¬¡æ¸²æŸ“ã€‚ ç»„ä»¶ï¼ˆæˆ–è€…å…¶ç¥–å…ˆä¹‹ä¸€ï¼‰çš„ çŠ¶æ€å‘ç”Ÿäº†æ”¹å˜ã€‚ åˆæ¬¡æ¸²æŸ“ å½“åº”ç”¨å¯åŠ¨æ—¶ï¼Œä¼šè§¦å‘åˆæ¬¡æ¸²æŸ“ã€‚æ¡†æ¶å’Œæ²™ç®±æœ‰æ—¶ä¼šéšè—è¿™éƒ¨åˆ†ä»£ç ï¼Œä½†å®ƒæ˜¯é€šè¿‡è°ƒç”¨ createRoot æ–¹æ³•å¹¶ä¼ å…¥ç›®æ ‡ DOM èŠ‚ç‚¹ï¼Œç„¶åç”¨ä½ çš„ç»„ä»¶è°ƒç”¨ render å‡½æ•°å®Œæˆçš„ï¼š index.js import Image from ./Image.js;import createRoot from react-dom/client;const root = createRoot(document.getElementById(root))root.render(Image /); image.js export default function Image() return ( img src=https://i.imgur.com/ZF6s192.jpg alt=Floralis GenÃ©rica by Eduardo Catalano: a gigantic metallic flower sculpture with reflective petals / ); è¯•ç€æ³¨é‡Šæ‰ root.render()ï¼Œç„¶åä½ å°†ä¼šçœ‹åˆ°ç»„ä»¶æ¶ˆå¤±ã€‚ çŠ¶æ€æ›´æ–°æ—¶é‡æ–°æ¸²æŸ“ ä¸€æ—¦ç»„ä»¶è¢«åˆæ¬¡æ¸²æŸ“ï¼Œä½ å°±å¯ä»¥é€šè¿‡ä½¿ç”¨ set å‡½æ•° æ›´æ–°å…¶çŠ¶æ€æ¥è§¦å‘ä¹‹åçš„æ¸²æŸ“ã€‚æ›´æ–°ç»„ä»¶çš„çŠ¶æ€ä¼šè‡ªåŠ¨å°†ä¸€æ¬¡æ¸²æŸ“é€å…¥é˜Ÿåˆ—ã€‚ï¼ˆä½ å¯ä»¥æŠŠè¿™ç§æƒ…å†µæƒ³è±¡æˆé¤å…å®¢äººåœ¨ç¬¬ä¸€æ¬¡ä¸‹å•ä¹‹ååˆç‚¹äº†èŒ¶ã€ç‚¹å¿ƒå’Œå„ç§ä¸œè¥¿ï¼Œå…·ä½“å–å†³äºä»–ä»¬çš„èƒƒå£ã€‚ï¼‰ 3.3.2 æ­¥éª¤ 2: React æ¸²æŸ“ä½ çš„ç»„ä»¶åœ¨ä½ è§¦å‘æ¸²æŸ“åï¼ŒReact ä¼šè°ƒç”¨ä½ çš„ç»„ä»¶æ¥ç¡®å®šè¦åœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„å†…å®¹ã€‚â€œæ¸²æŸ“ä¸­â€ å³ React åœ¨è°ƒç”¨ä½ çš„ç»„ä»¶ã€‚ åœ¨è¿›è¡Œåˆæ¬¡æ¸²æŸ“æ—¶, React ä¼šè°ƒç”¨æ ¹ç»„ä»¶ã€‚ å¯¹äºåç»­çš„æ¸²æŸ“, React ä¼šè°ƒç”¨å†…éƒ¨çŠ¶æ€æ›´æ–°è§¦å‘äº†æ¸²æŸ“çš„å‡½æ•°ç»„ä»¶ã€‚ è¿™ä¸ªè¿‡ç¨‹æ˜¯é€’å½’çš„ï¼šå¦‚æœæ›´æ–°åçš„ç»„ä»¶ä¼šè¿”å›æŸä¸ªå¦å¤–çš„ç»„ä»¶ï¼Œé‚£ä¹ˆ React æ¥ä¸‹æ¥å°±ä¼šæ¸²æŸ“ é‚£ä¸ª ç»„ä»¶ï¼Œè€Œå¦‚æœé‚£ä¸ªç»„ä»¶åˆè¿”å›äº†æŸä¸ªç»„ä»¶ï¼Œé‚£ä¹ˆ React æ¥ä¸‹æ¥å°±ä¼šæ¸²æŸ“ é‚£ä¸ª ç»„ä»¶ï¼Œä»¥æ­¤ç±»æ¨ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šæŒç»­ä¸‹å»ï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šçš„åµŒå¥—ç»„ä»¶å¹¶ä¸” React ç¡®åˆ‡çŸ¥é“å“ªäº›ä¸œè¥¿åº”è¯¥æ˜¾ç¤ºåˆ°å±å¹•ä¸Šä¸ºæ­¢ã€‚ åœ¨æ¥ä¸‹æ¥çš„ä¾‹å­ä¸­ï¼ŒReact å°†ä¼šè°ƒç”¨ Gallery() å’Œ Image() è‹¥å¹²æ¬¡ï¼š index.js import Gallery from ./Gallery.js;import createRoot from react-dom/client;const root = createRoot(document.getElementById(root))root.render(Gallery /); Gallery.js export default function Gallery() return ( section h1é¼“èˆäººå¿ƒçš„é›•å¡‘/h1 Image / Image / Image / /section );function Image() return ( img src=https://i.imgur.com/ZF6s192.jpg alt=Floralis GenÃ©rica by Eduardo Catalano: a gigantic metallic flower sculpture with reflective petals / ); åœ¨åˆæ¬¡æ¸²æŸ“ä¸­ï¼Œ React å°†ä¼šä¸ºsectionã€h1 å’Œä¸‰ä¸ª img æ ‡ç­¾ åˆ›å»º DOM èŠ‚ç‚¹ã€‚ åœ¨ä¸€æ¬¡é‡æ¸²æŸ“è¿‡ç¨‹ä¸­, React å°†è®¡ç®—å®ƒä»¬çš„å“ªäº›å±æ€§ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰è‡ªä¸Šæ¬¡æ¸²æŸ“ä»¥æ¥å·²æ›´æ”¹ã€‚åœ¨ä¸‹ä¸€æ­¥ï¼ˆæäº¤é˜¶æ®µï¼‰ä¹‹å‰ï¼Œå®ƒä¸ä¼šå¯¹è¿™äº›ä¿¡æ¯æ‰§è¡Œä»»ä½•æ“ä½œã€‚ æ¸²æŸ“å¿…é¡»å§‹ç»ˆæ˜¯ä¸€æ¬¡ çº¯è®¡ç®—: è¾“å…¥ç›¸åŒï¼Œè¾“å‡ºç›¸åŒã€‚ ç»™å®šç›¸åŒçš„è¾“å…¥ï¼Œç»„ä»¶åº”å§‹ç»ˆè¿”å›ç›¸åŒçš„ JSXã€‚ï¼ˆå½“æœ‰äººç‚¹äº†è¥¿çº¢æŸ¿æ²™æ‹‰æ—¶ï¼Œä»–ä»¬ä¸åº”è¯¥æ”¶åˆ°æ´‹è‘±æ²™æ‹‰ï¼ï¼‰ åªåšå®ƒè‡ªå·±çš„äº‹æƒ…ã€‚ å®ƒä¸åº”æ›´æ”¹ä»»ä½•å­˜åœ¨äºæ¸²æŸ“ä¹‹å‰çš„å¯¹è±¡æˆ–å˜é‡ã€‚ï¼ˆä¸€ä¸ªè®¢å•ä¸åº”æ›´æ”¹å…¶ä»–ä»»ä½•äººçš„è®¢å•ã€‚ï¼‰ å¦åˆ™ï¼Œéšç€ä»£ç åº“å¤æ‚æ€§çš„å¢åŠ ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ä»¤äººå›°æƒ‘çš„é”™è¯¯å’Œä¸å¯é¢„æµ‹çš„è¡Œä¸ºã€‚åœ¨ â€œä¸¥æ ¼æ¨¡å¼â€ ä¸‹å¼€å‘æ—¶ï¼ŒReact ä¼šè°ƒç”¨æ¯ä¸ªç»„ä»¶çš„å‡½æ•°ä¸¤æ¬¡ï¼Œè¿™å¯ä»¥å¸®åŠ©å‘ç°ç”±ä¸çº¯å‡½æ•°å¼•èµ·çš„é”™è¯¯ã€‚ æ€§èƒ½ä¼˜åŒ–å¦‚æœæ›´æ–°çš„ç»„ä»¶åœ¨æ ‘ä¸­çš„ä½ç½®éå¸¸é«˜ï¼Œæ¸²æŸ“æ›´æ–°åçš„ç»„ä»¶å†…éƒ¨æ‰€æœ‰åµŒå¥—ç»„ä»¶çš„é»˜è®¤è¡Œä¸ºå°†ä¸ä¼šè·å¾—æœ€ä½³æ€§èƒ½ã€‚å¦‚æœä½ é‡åˆ°äº†æ€§èƒ½é—®é¢˜ï¼Œæ€§èƒ½ ç« èŠ‚æè¿°äº†å‡ ç§å¯é€‰çš„è§£å†³æ–¹æ¡ˆ ã€‚ä¸è¦è¿‡æ—©è¿›è¡Œä¼˜åŒ–ï¼ 3.3.3 æ­¥éª¤ 3: React æŠŠæ›´æ”¹æäº¤åˆ° DOM ä¸Šåœ¨æ¸²æŸ“ï¼ˆè°ƒç”¨ï¼‰ä½ çš„ç»„ä»¶ä¹‹åï¼ŒReact å°†ä¼šä¿®æ”¹ DOMã€‚ å¯¹äºåˆæ¬¡æ¸²æŸ“ï¼Œ React ä¼šä½¿ç”¨ appendChild() DOM API å°†å…¶åˆ›å»ºçš„æ‰€æœ‰ DOM èŠ‚ç‚¹æ”¾åœ¨å±å¹•ä¸Šã€‚ å¯¹äºé‡æ¸²æŸ“ï¼Œ React å°†åº”ç”¨æœ€å°‘çš„å¿…è¦æ“ä½œï¼ˆåœ¨æ¸²æŸ“æ—¶è®¡ç®—ï¼ï¼‰ï¼Œä»¥ä½¿å¾— DOM ä¸æœ€æ–°çš„æ¸²æŸ“è¾“å‡ºç›¸äº’åŒ¹é…ã€‚ React ä»…åœ¨æ¸²æŸ“ä¹‹é—´å­˜åœ¨å·®å¼‚æ—¶æ‰ä¼šæ›´æ”¹ DOM èŠ‚ç‚¹ã€‚ ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒæ¯ç§’ä½¿ç”¨ä»çˆ¶ç»„ä»¶ä¼ é€’ä¸‹æ¥çš„ä¸åŒå±æ€§é‡æ–°æ¸²æŸ“ä¸€æ¬¡ã€‚æ³¨æ„ï¼Œä½ å¯ä»¥æ·»åŠ ä¸€äº›æ–‡æœ¬åˆ° input æ ‡ç­¾ï¼Œæ›´æ–°å®ƒçš„ valueï¼Œä½†æ˜¯æ–‡æœ¬ä¸ä¼šåœ¨ç»„ä»¶é‡æ¸²æŸ“æ—¶æ¶ˆå¤±ï¼š export default function Clock( time ) return ( h1time/h1 input / / ); è¿™ä¸ªä¾‹å­ä¹‹æ‰€ä»¥ä¼šæ­£å¸¸è¿è¡Œï¼Œæ˜¯å› ä¸ºåœ¨æœ€åä¸€æ­¥ä¸­ï¼ŒReact åªä¼šä½¿ç”¨æœ€æ–°çš„ time æ›´æ–° h1 æ ‡ç­¾çš„å†…å®¹ã€‚å®ƒçœ‹åˆ° input æ ‡ç­¾å‡ºç°åœ¨ JSX ä¸­ä¸ä¸Šæ¬¡ç›¸åŒçš„ä½ç½®ï¼Œå› æ­¤ React ä¸ä¼šä¿®æ”¹ input æ ‡ç­¾æˆ–å®ƒçš„ valueï¼ 3.3.4 å°¾å£°ï¼šæµè§ˆå™¨ç»˜åˆ¶åœ¨æ¸²æŸ“å®Œæˆå¹¶ä¸” React æ›´æ–° DOM ä¹‹åï¼Œæµè§ˆå™¨å°±ä¼šé‡æ–°ç»˜åˆ¶å±å¹•ã€‚å°½ç®¡è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºâ€œæµè§ˆå™¨æ¸²æŸ“â€ï¼ˆâ€œbrowser renderingâ€ï¼‰ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯å°†å®ƒç§°ä¸ºâ€œç»˜åˆ¶â€ï¼ˆâ€œpaintingâ€ï¼‰ï¼Œä»¥é¿å…åœ¨è¿™äº›æ–‡æ¡£çš„å…¶ä½™éƒ¨åˆ†ä¸­å‡ºç°æ··æ·†ã€‚ 3.3.5 æ‘˜è¦ åœ¨ä¸€ä¸ª React åº”ç”¨ä¸­ä¸€æ¬¡å±å¹•æ›´æ–°éƒ½ä¼šå‘ç”Ÿä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š è§¦å‘ æ¸²æŸ“ æäº¤ ä½ å¯ä»¥ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼å»æ‰¾åˆ°ç»„ä»¶ä¸­çš„é”™è¯¯ å¦‚æœæ¸²æŸ“ç»“æœä¸ä¸Šæ¬¡ä¸€æ ·ï¼Œé‚£ä¹ˆ React å°†ä¸ä¼šä¿®æ”¹ DOM 3.4 state å¦‚åŒä¸€å¼ å¿«ç…§ä¹Ÿè®¸ state å˜é‡çœ‹èµ·æ¥å’Œä¸€èˆ¬çš„å¯è¯»å†™çš„ JavaScript å˜é‡ç±»ä¼¼ã€‚ä½† state åœ¨å…¶è¡¨ç°å‡ºçš„ç‰¹æ€§ä¸Šæ›´åƒæ˜¯ä¸€å¼ å¿«ç…§ã€‚è®¾ç½®å®ƒä¸ä¼šæ›´æ”¹ä½ å·²æœ‰çš„ state å˜é‡ï¼Œä½†ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ã€‚ 3.4.1 è®¾ç½® state ä¼šè§¦å‘æ¸²æŸ“ä½ å¯èƒ½ä¼šè®¤ä¸ºä½ çš„ç”¨æˆ·ç•Œé¢ä¼šç›´æ¥å¯¹ç‚¹å‡»ä¹‹ç±»çš„ç”¨æˆ·è¾“å…¥åšå‡ºå“åº”å¹¶å‘ç”Ÿå˜åŒ–ã€‚åœ¨ React ä¸­ï¼Œå®ƒçš„å·¥ä½œæ–¹å¼ä¸è¿™ç§æ€ç»´æ¨¡å‹ç•¥æœ‰ä¸åŒã€‚åœ¨ä¸Šä¸€é¡µä¸­ï¼Œä½ çœ‹åˆ°äº†æ¥è‡ª React çš„é‡æ–°æ¸²æŸ“å’Œæäº¤ã€‚è¿™æ„å‘³ç€è¦ä½¿ç•Œé¢å¯¹è¾“å…¥åšå‡ºååº”ï¼Œä½ éœ€è¦è®¾ç½®å…¶ stateã€‚ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“ä½ æŒ‰ä¸‹ â€œsendâ€ æ—¶ï¼ŒsetIsSent(true) ä¼šé€šçŸ¥ React é‡æ–°æ¸²æŸ“ UIï¼š import useState from react;export default function Form() const [isSent, setIsSent] = useState(false); const [message, setMessage] = useState(Hi!); if (isSent) return h1Your message is on its way!/h1 return ( form onSubmit=(e) = e.preventDefault(); setIsSent(true); sendMessage(message); textarea placeholder=Message value=message onChange=e = setMessage(e.target.value) / button type=submitSend/button /form );function sendMessage(message) // ... å½“ä½ å•å‡»æŒ‰é’®æ—¶ä¼šå‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š æ‰§è¡Œ onSubmit äº‹ä»¶å¤„ç†å‡½æ•°ã€‚ setIsSent(true) å°† isSent è®¾ç½®ä¸º true å¹¶æ’åˆ—ä¸€ä¸ªæ–°çš„æ¸²æŸ“ã€‚ React æ ¹æ®æ–°çš„ isSent å€¼é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚ è®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹ state å’Œæ¸²æŸ“ä¹‹é—´çš„å…³ç³»ã€‚ 3.4.2 æ¸²æŸ“ä¼šåŠæ—¶ç”Ÿæˆä¸€å¼ å¿«ç…§â€œæ­£åœ¨æ¸²æŸ“â€ å°±æ„å‘³ç€ React æ­£åœ¨è°ƒç”¨ä½ çš„ç»„ä»¶â€”â€”ä¸€ä¸ªå‡½æ•°ã€‚ä½ ä»è¯¥å‡½æ•°è¿”å›çš„ JSX å°±åƒæ˜¯åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Š UI çš„å¿«ç…§ã€‚å®ƒçš„ propsã€äº‹ä»¶å¤„ç†å‡½æ•°å’Œå†…éƒ¨å˜é‡éƒ½æ˜¯ æ ¹æ®å½“å‰æ¸²æŸ“æ—¶çš„ state è¢«è®¡ç®—å‡ºæ¥çš„ã€‚ ä¸ç…§ç‰‡æˆ–ç”µå½±ç”»é¢ä¸åŒï¼Œä½ è¿”å›çš„ UI â€œå¿«ç…§â€æ˜¯å¯äº¤äº’çš„ã€‚å®ƒå…¶ä¸­åŒ…æ‹¬ç±»ä¼¼äº‹ä»¶å¤„ç†å‡½æ•°çš„é€»è¾‘ï¼Œè¿™äº›é€»è¾‘ç”¨äºæŒ‡å®šå¦‚ä½•å¯¹è¾“å…¥ä½œå‡ºå“åº”ã€‚React éšåä¼šæ›´æ–°å±å¹•æ¥åŒ¹é…è¿™å¼ å¿«ç…§ï¼Œå¹¶ç»‘å®šäº‹ä»¶å¤„ç†å‡½æ•°ã€‚å› æ­¤ï¼ŒæŒ‰ä¸‹æŒ‰é’®å°±ä¼šè§¦å‘ä½  JSX ä¸­çš„ç‚¹å‡»äº‹ä»¶å¤„ç†å‡½æ•°ã€‚ å½“ React é‡æ–°æ¸²æŸ“ä¸€ä¸ªç»„ä»¶æ—¶ï¼š React ä¼šå†æ¬¡è°ƒç”¨ä½ çš„å‡½æ•° å‡½æ•°ä¼šè¿”å›æ–°çš„ JSX å¿«ç…§ React ä¼šæ›´æ–°ç•Œé¢ä»¥åŒ¹é…è¿”å›çš„å¿«ç…§ ä½œä¸ºä¸€ä¸ªç»„ä»¶çš„è®°å¿†ï¼Œstate ä¸åŒäºåœ¨ä½ çš„å‡½æ•°è¿”å›ä¹‹åå°±ä¼šæ¶ˆå¤±çš„æ™®é€šå˜é‡ã€‚state å®é™…ä¸Šâ€œæ´»â€åœ¨ React æœ¬èº«ä¸­â€”â€”å°±åƒè¢«æ‘†åœ¨ä¸€ä¸ªæ¶å­ä¸Šï¼â€”â€”ä½äºä½ çš„å‡½æ•°ä¹‹å¤–ã€‚å½“ React è°ƒç”¨ä½ çš„ç»„ä»¶æ—¶ï¼Œå®ƒä¼šä¸ºç‰¹å®šçš„é‚£ä¸€æ¬¡æ¸²æŸ“æä¾›ä¸€å¼  state å¿«ç…§ã€‚ä½ çš„ç»„ä»¶ä¼šåœ¨å…¶ JSX ä¸­è¿”å›ä¸€å¼ åŒ…å«ä¸€æ•´å¥—æ–°çš„ props å’Œäº‹ä»¶å¤„ç†å‡½æ•°çš„ UI å¿«ç…§ ï¼Œå…¶ä¸­æ‰€æœ‰çš„å€¼éƒ½æ˜¯ æ ¹æ®é‚£ä¸€æ¬¡æ¸²æŸ“ä¸­ state çš„å€¼ è¢«è®¡ç®—å‡ºæ¥çš„ï¼ è¿™é‡Œæœ‰ä¸ªå‘ä½ å±•ç¤ºå…¶è¿è¡ŒåŸç†çš„å°ä¾‹å­ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ å¯èƒ½ä¼šä»¥ä¸ºç‚¹å‡»â€œ+3â€æŒ‰é’®ä¼šè°ƒç”¨ setNumber(number + 1) ä¸‰æ¬¡ä»è€Œä½¿è®¡æ•°å™¨é€’å¢ä¸‰æ¬¡ã€‚ çœ‹çœ‹ä½ ç‚¹å‡»â€œ+3â€æŒ‰é’®æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ? export default function Counter() const [number, setNumber] = useState(0); return ( h1number/h1 button onClick=() = setNumber(number + 1); setNumber(number + 1); setNumber(number + 1); +3/button / )// æ¯æ¬¡ç‚¹å‡»åªä¼š+1 è¯·æ³¨æ„ï¼Œæ¯æ¬¡ç‚¹å‡»åªä¼šè®© number é€’å¢ä¸€æ¬¡ï¼ è®¾ç½® state åªä¼šä¸ºä¸‹ä¸€æ¬¡æ¸²æŸ“å˜æ›´ state çš„å€¼ã€‚åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æœŸé—´ï¼Œnumber ä¸º 0ã€‚è¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆåœ¨ é‚£æ¬¡æ¸²æŸ“ä¸­çš„ onClick å¤„ç†å‡½æ•°ä¸­ï¼Œå³ä¾¿åœ¨è°ƒç”¨äº† setNumber(number + 1) ä¹‹åï¼Œnumber çš„å€¼ä¹Ÿä»ç„¶æ˜¯ 0ï¼š button onClick=() = setNumber(number + 1); setNumber(number + 1); setNumber(number + 1);+3/button ä»¥ä¸‹æ˜¯è¿™ä¸ªæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶å¤„ç†å‡½æ•°é€šçŸ¥ React è¦åšçš„äº‹æƒ…ï¼š setNumber(number + 1)ï¼šnumber æ˜¯ 0 æ‰€ä»¥ setNumber(0 + 1)ã€‚ React å‡†å¤‡åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æ—¶å°† number æ›´æ”¹ä¸º 1ã€‚ setNumber(number + 1)ï¼šnumber æ˜¯0 æ‰€ä»¥ setNumber(0 + 1)ã€‚ React å‡†å¤‡åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æ—¶å°† number æ›´æ”¹ä¸º 1ã€‚ setNumber(number + 1)ï¼šnumber æ˜¯0 æ‰€ä»¥ setNumber(0 + 1)ã€‚ React å‡†å¤‡åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æ—¶å°† number æ›´æ”¹ä¸º 1ã€‚ å°½ç®¡ä½ è°ƒç”¨äº†ä¸‰æ¬¡ setNumber(number + 1)ï¼Œä½†åœ¨ è¿™æ¬¡æ¸²æŸ“çš„ äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ number ä¼šä¸€ç›´æ˜¯ 0ï¼Œæ‰€ä»¥ä½ ä¼šä¸‰æ¬¡å°† state è®¾ç½®æˆ 1ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ä½ çš„äº‹ä»¶å¤„ç†å‡½æ•°æ‰§è¡Œå®Œä»¥åï¼ŒReact é‡æ–°æ¸²æŸ“çš„ç»„ä»¶ä¸­çš„ number ç­‰äº 1 è€Œä¸æ˜¯ 3ã€‚ ä½ è¿˜å¯ä»¥é€šè¿‡åœ¨å¿ƒé‡ŒæŠŠ state å˜é‡æ›¿æ¢æˆå®ƒä»¬åœ¨ä½ ä»£ç ä¸­çš„å€¼æ¥æƒ³è±¡è¿™ä¸ªè¿‡ç¨‹ã€‚ç”±äº è¿™æ¬¡æ¸²æŸ“ ä¸­çš„ state å˜é‡ number æ˜¯ 0ï¼Œå…¶äº‹ä»¶å¤„ç†å‡½æ•°çœ‹èµ·æ¥ä¼šåƒè¿™æ ·ï¼š button onClick=() = setNumber(0 + 1); setNumber(0 + 1); setNumber(0 + 1);+3/button å¯¹äºä¸‹ä¸€æ¬¡æ¸²æŸ“æ¥è¯´ï¼Œnumber æ˜¯ 1ï¼Œå› æ­¤ é‚£æ¬¡æ¸²æŸ“ä¸­çš„ ç‚¹å‡»äº‹ä»¶å¤„ç†å‡½æ•°çœ‹èµ·æ¥ä¼šåƒè¿™æ ·ï¼š button onClick=() = setNumber(1 + 1); setNumber(1 + 1); setNumber(1 + 1);+3/button è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå†æ¬¡ç‚¹å‡»æŒ‰é’®ä¼šå°†è®¡æ•°å™¨è®¾ç½®ä¸º 2ï¼Œä¸‹æ¬¡ç‚¹å‡»æ—¶ä¼šè®¾ä¸º 3ï¼Œä¾æ­¤ç±»æ¨ã€‚ 3.4.4 éšæ—¶é—´å˜åŒ–çš„ stateå¥½çš„ï¼Œåˆšæ‰é‚£äº›å¾ˆæœ‰æ„æ€ã€‚è¯•ç€çŒœçŒœç‚¹å‡»è¿™ä¸ªæŒ‰é’®ä¼šå‘å‡ºä»€ä¹ˆè­¦å‘Šï¼š import useState from react;export default function Counter() const [number, setNumber] = useState(0); return ( h1number/h1 button onClick=() = setNumber(number + 5); alert(number); +5/button / )// alertæ˜¾ç¤º0, numberæ¸²æŸ“ä¸º5 å¦‚æœä½ ä½¿ç”¨ä¹‹å‰æ›¿æ¢çš„æ–¹æ³•ï¼Œä½ å°±èƒ½çŒœåˆ°è¿™ä¸ªæç¤ºæ¡†å°†ä¼šæ˜¾ç¤º â€œ0â€ï¼š setNumber(0 + 5);alert(0); ä½†å¦‚æœä½ åœ¨è¿™ä¸ªæç¤ºæ¡†ä¸ŠåŠ ä¸Šä¸€ä¸ªå®šæ—¶å™¨ï¼Œ ä½¿å¾—å®ƒåœ¨ç»„ä»¶é‡æ–°æ¸²æŸ“ ä¹‹å æ‰è§¦å‘ï¼Œåˆä¼šæ€æ ·å‘¢ï¼Ÿæ˜¯ä¼šæ˜¾ç¤º â€œ0â€ è¿˜æ˜¯ â€œ5â€ ï¼ŸçŒœä¸€çŒœï¼ import useState from react;export default function Counter() const [number, setNumber] = useState(0); return ( h1number/h1 button onClick=() = setNumber(number + 5); setTimeout(() = alert(number); , 3000); +5/button / ) åˆ°æç¤ºæ¡†è¿è¡Œæ—¶ï¼ŒReact ä¸­å­˜å‚¨çš„ state å¯èƒ½å·²ç»å‘ç”Ÿäº†æ›´æ”¹ï¼Œä½†å®ƒæ˜¯ä½¿ç”¨ç”¨æˆ·ä¸ä¹‹äº¤äº’æ—¶çŠ¶æ€çš„å¿«ç…§è¿›è¡Œè°ƒåº¦çš„ï¼ ä¸€ä¸ª state å˜é‡çš„å€¼æ°¸è¿œä¸ä¼šåœ¨ä¸€æ¬¡æ¸²æŸ“çš„å†…éƒ¨å‘ç”Ÿå˜åŒ–ï¼Œ å³ä½¿å…¶äº‹ä»¶å¤„ç†å‡½æ•°çš„ä»£ç æ˜¯å¼‚æ­¥çš„ã€‚åœ¨ é‚£æ¬¡æ¸²æŸ“çš„ onClick å†…éƒ¨ï¼Œnumber çš„å€¼å³ä½¿åœ¨è°ƒç”¨ setNumber(number + 5) ä¹‹åä¹Ÿè¿˜æ˜¯ 0ã€‚å®ƒçš„å€¼åœ¨ React é€šè¿‡è°ƒç”¨ä½ çš„ç»„ä»¶â€œè·å– UI çš„å¿«ç…§â€æ—¶å°±è¢«â€œå›ºå®šâ€äº†ã€‚ è¿™é‡Œæœ‰ä¸ªç¤ºä¾‹èƒ½å¤Ÿè¯´æ˜ä¸Šè¿°ç‰¹æ€§ä¼šä½¿ä½ çš„äº‹ä»¶å¤„ç†å‡½æ•°æ›´ä¸å®¹æ˜“å‡ºç°è®¡æ—¶é”™è¯¯ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¼šåœ¨äº”ç§’å»¶è¿Ÿä¹‹åå‘é€ä¸€æ¡æ¶ˆæ¯çš„è¡¨å•ã€‚æƒ³è±¡ä»¥ä¸‹åœºæ™¯ï¼š ä½ æŒ‰ä¸‹â€œå‘é€â€æŒ‰é’®ï¼Œå‘ Alice å‘é€â€œä½ å¥½â€ã€‚ åœ¨äº”ç§’å»¶è¿Ÿç»“æŸä¹‹å‰ï¼Œå°†â€œToâ€å­—æ®µçš„å€¼æ›´æ”¹ä¸ºâ€œBobâ€ã€‚ ä½ è§‰å¾— alert ä¼šæ˜¾ç¤ºä»€ä¹ˆï¼Ÿå®ƒæ˜¯ä¼šæ˜¾ç¤ºâ€œä½ å‘ Alice è¯´äº†ä½ å¥½â€œè¿˜æ˜¯ä¼šæ˜¾ç¤ºâ€œä½ å‘ Bob è¯´äº†ä½ å¥½â€ï¼Ÿæ ¹æ®ä½ å·²ç»å­¦åˆ°çš„çŸ¥è¯†çŒœä¸€çŒœï¼Œç„¶ååŠ¨æ‰‹è¯•ä¸€è¯•ï¼š import useState from react;export default function Form() const [to, setTo] = useState(Alice); const [message, setMessage] = useState(ä½ å¥½); function handleSubmit(e) e.preventDefault(); setTimeout(() = alert(`ä½ å‘ $to è¯´äº†$message`); , 5000); return ( form onSubmit=handleSubmit label To: select value=to onChange=e = setTo(e.target.value) option value=AliceAlice/option option value=BobBob/option /select /label textarea placeholder=Message value=message onChange=e = setMessage(e.target.value) / button type=submitå‘é€/button /form ); React ä¼šä½¿ state çš„å€¼å§‹ç»ˆâ€œå›ºå®šâ€åœ¨ä¸€æ¬¡æ¸²æŸ“çš„å„ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°å†…éƒ¨ã€‚ä½ æ— éœ€æ‹…å¿ƒä»£ç è¿è¡Œæ—¶ state æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ã€‚ ä½†æ˜¯ï¼Œä¸‡ä¸€ä½ æƒ³åœ¨é‡æ–°æ¸²æŸ“ä¹‹å‰è¯»å–æœ€æ–°çš„ state æ€ä¹ˆåŠï¼Ÿä½ åº”è¯¥ä½¿ç”¨ çŠ¶æ€æ›´æ–°å‡½æ•°ï¼ 3.4.5 æ‘˜è¦ è®¾ç½® state è¯·æ±‚ä¸€æ¬¡æ–°çš„æ¸²æŸ“ã€‚ React å°† state å­˜å‚¨åœ¨ç»„ä»¶ä¹‹å¤–ï¼Œå°±åƒåœ¨æ¶å­ä¸Šä¸€æ ·ã€‚ å½“ä½ è°ƒç”¨ useState æ—¶ï¼ŒReact ä¼šä¸ºä½ æä¾›è¯¥æ¬¡æ¸²æŸ“ çš„ä¸€å¼  state å¿«ç…§ã€‚ å˜é‡å’Œäº‹ä»¶å¤„ç†å‡½æ•°ä¸ä¼šåœ¨é‡æ¸²æŸ“ä¸­â€œå­˜æ´»â€ã€‚æ¯ä¸ªæ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚ æ¯ä¸ªæ¸²æŸ“ï¼ˆä»¥åŠå…¶ä¸­çš„å‡½æ•°ï¼‰å§‹ç»ˆâ€œçœ‹åˆ°â€çš„æ˜¯ React æä¾›ç»™è¿™ä¸ª æ¸²æŸ“çš„ state å¿«ç…§ã€‚ ä½ å¯ä»¥åœ¨å¿ƒä¸­æ›¿æ¢äº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„ stateï¼Œç±»ä¼¼äºæ›¿æ¢æ¸²æŸ“çš„ JSXã€‚ è¿‡å»åˆ›å»ºçš„äº‹ä»¶å¤„ç†å‡½æ•°æ‹¥æœ‰çš„æ˜¯åˆ›å»ºå®ƒä»¬çš„é‚£æ¬¡æ¸²æŸ“ä¸­çš„ state å€¼ã€‚ 3.5 æŠŠä¸€ç³»åˆ— state æ›´æ–°åŠ å…¥é˜Ÿåˆ—è®¾ç½®ç»„ä»¶ state ä¼šæŠŠä¸€æ¬¡é‡æ–°æ¸²æŸ“åŠ å…¥é˜Ÿåˆ—ã€‚ä½†æœ‰æ—¶ä½ å¯èƒ½ä¼šå¸Œæœ›åœ¨ä¸‹æ¬¡æ¸²æŸ“åŠ å…¥é˜Ÿåˆ—ä¹‹å‰å¯¹ state çš„å€¼æ‰§è¡Œå¤šæ¬¡æ“ä½œã€‚ä¸ºæ­¤ï¼Œäº†è§£ React å¦‚ä½•æ‰¹é‡æ›´æ–° state ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚ 3.5.1 React ä¼šå¯¹ state æ›´æ–°è¿›è¡Œæ‰¹å¤„ç†åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œä½ å¯èƒ½ä¼šè®¤ä¸ºç‚¹å‡» â€œ+3â€ æŒ‰é’®ä¼šä½¿è®¡æ•°å™¨é€’å¢ä¸‰æ¬¡ï¼Œå› ä¸ºå®ƒè°ƒç”¨äº† setNumber(number + 1) ä¸‰æ¬¡ï¼š import useState from react;export default function Counter() const [number, setNumber] = useState(0); return ( h1number/h1 button onClick=() = setNumber(number + 1); setNumber(number + 1); setNumber(number + 1); +3/button / ) ä½†æ˜¯ï¼Œä½ å¯èƒ½è¿˜è®°å¾—ä¸Šä¸€èŠ‚ä¸­çš„å†…å®¹ï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“çš„ state å€¼éƒ½æ˜¯å›ºå®šçš„ï¼Œå› æ­¤æ— è®ºä½ è°ƒç”¨å¤šå°‘æ¬¡ setNumber(1)ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„äº‹ä»¶å¤„ç†å‡½æ•°å†…éƒ¨çš„ number å€¼æ€»æ˜¯ 0 ï¼š setNumber(0 + 1);setNumber(0 + 1);setNumber(0 + 1); ä½†æ˜¯è¿™é‡Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªå½±å“å› ç´ éœ€è¦è®¨è®ºã€‚React ä¼šç­‰åˆ°äº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„ æ‰€æœ‰ ä»£ç éƒ½è¿è¡Œå®Œæ¯•å†å¤„ç†ä½ çš„ state æ›´æ–°ã€‚ è¿™å°±æ˜¯é‡æ–°æ¸²æŸ“åªä¼šå‘ç”Ÿåœ¨æ‰€æœ‰è¿™äº› setNumber() è°ƒç”¨ ä¹‹å çš„åŸå› ã€‚ è¿™å¯èƒ½ä¼šè®©ä½ æƒ³èµ·é¤å…é‡Œå¸®ä½ ç‚¹èœçš„æœåŠ¡å‘˜ã€‚æœåŠ¡å‘˜ä¸ä¼šåœ¨ä½ è¯´ç¬¬ä¸€é“èœçš„æ—¶å€™å°±è·‘åˆ°å¨æˆ¿ï¼ç›¸åï¼Œä»–ä»¬ä¼šè®©ä½ æŠŠèœç‚¹å®Œï¼Œè®©ä½ ä¿®æ”¹èœå“ï¼Œç”šè‡³ä¼šå¸®æ¡Œä¸Šçš„å…¶ä»–äººç‚¹èœã€‚ è¿™è®©ä½ å¯ä»¥æ›´æ–°å¤šä¸ª state å˜é‡â€”â€”ç”šè‡³æ¥è‡ªå¤šä¸ªç»„ä»¶çš„ state å˜é‡â€”â€”è€Œä¸ä¼šè§¦å‘å¤ªå¤šçš„ é‡æ–°æ¸²æŸ“ã€‚ä½†è¿™ä¹Ÿæ„å‘³ç€åªæœ‰åœ¨ä½ çš„äº‹ä»¶å¤„ç†å‡½æ•°åŠå…¶ä¸­ä»»ä½•ä»£ç æ‰§è¡Œå®Œæˆ ä¹‹åï¼ŒUI æ‰ä¼šæ›´æ–°ã€‚è¿™ç§ç‰¹æ€§ä¹Ÿå°±æ˜¯ æ‰¹å¤„ç†ï¼Œå®ƒä¼šä½¿ä½ çš„ React åº”ç”¨è¿è¡Œå¾—æ›´å¿«ã€‚å®ƒè¿˜ä¼šå¸®ä½ é¿å…å¤„ç†åªæ›´æ–°äº†ä¸€éƒ¨åˆ† state å˜é‡çš„ä»¤äººå›°æƒ‘çš„â€œåŠæˆå“â€æ¸²æŸ“ã€‚ React ä¸ä¼šè·¨ å¤šä¸ª éœ€è¦åˆ»æ„è§¦å‘çš„äº‹ä»¶ï¼ˆå¦‚ç‚¹å‡»ï¼‰è¿›è¡Œæ‰¹å¤„ç†â€”â€”æ¯æ¬¡ç‚¹å‡»éƒ½æ˜¯å•ç‹¬å¤„ç†çš„ã€‚è¯·æ”¾å¿ƒï¼ŒReact åªä¼šåœ¨ä¸€èˆ¬æ¥è¯´å®‰å…¨çš„æƒ…å†µä¸‹æ‰è¿›è¡Œæ‰¹å¤„ç†ã€‚è¿™å¯ä»¥ç¡®ä¿ï¼Œä¾‹å¦‚ï¼Œå¦‚æœç¬¬ä¸€æ¬¡ç‚¹å‡»æŒ‰é’®ä¼šç¦ç”¨è¡¨å•ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡ç‚¹å‡»å°±ä¸ä¼šå†æ¬¡æäº¤å®ƒã€‚ 3.5.2 åœ¨ä¸‹æ¬¡æ¸²æŸ“å‰å¤šæ¬¡æ›´æ–°åŒä¸€ä¸ª stateè¿™æ˜¯ä¸€ä¸ªä¸å¸¸è§çš„ç”¨ä¾‹ï¼Œä½†æ˜¯å¦‚æœä½ æƒ³åœ¨ä¸‹æ¬¡æ¸²æŸ“ä¹‹å‰å¤šæ¬¡æ›´æ–°åŒä¸€ä¸ª stateï¼Œä½ å¯ä»¥åƒ setNumber(n = n + 1) è¿™æ ·ä¼ å…¥ä¸€ä¸ªæ ¹æ®é˜Ÿåˆ—ä¸­çš„å‰ä¸€ä¸ª state è®¡ç®—ä¸‹ä¸€ä¸ª state çš„ å‡½æ•°ï¼Œè€Œä¸æ˜¯åƒ setNumber(number + 1) è¿™æ ·ä¼ å…¥ ä¸‹ä¸€ä¸ª state å€¼ã€‚è¿™æ˜¯ä¸€ç§å‘Šè¯‰ React â€œç”¨ state å€¼åšæŸäº‹â€è€Œä¸æ˜¯ä»…ä»…æ›¿æ¢å®ƒçš„æ–¹æ³•ã€‚ ç°åœ¨å°è¯•é€’å¢è®¡æ•°å™¨ï¼š import useState from react;export default function Counter() const [number, setNumber] = useState(0); return ( h1number/h1 button onClick=() = setNumber(n = n + 1); setNumber(n = n + 1); setNumber(n = n + 1); +3/button / ) åœ¨è¿™é‡Œï¼Œn = n + 1 è¢«ç§°ä¸º æ›´æ–°å‡½æ•°ã€‚å½“ä½ å°†å®ƒä¼ é€’ç»™ä¸€ä¸ª state è®¾ç½®å‡½æ•°æ—¶ï¼š React ä¼šå°†æ­¤å‡½æ•°åŠ å…¥é˜Ÿåˆ—ï¼Œä»¥ä¾¿åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„æ‰€æœ‰å…¶ä»–ä»£ç è¿è¡Œåè¿›è¡Œå¤„ç†ã€‚ åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æœŸé—´ï¼ŒReact ä¼šéå†é˜Ÿåˆ—å¹¶ç»™ä½ æ›´æ–°ä¹‹åçš„æœ€ç»ˆ stateã€‚ setNumber(n = n + 1);setNumber(n = n + 1);setNumber(n = n + 1); ä¸‹é¢æ˜¯ React åœ¨æ‰§è¡Œäº‹ä»¶å¤„ç†å‡½æ•°æ—¶å¤„ç†è¿™å‡ è¡Œä»£ç çš„è¿‡ç¨‹ï¼š setNumber(n = n + 1)ï¼šn = n + 1 æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚React å°†å®ƒåŠ å…¥é˜Ÿåˆ—ã€‚ setNumber(n = n + 1)ï¼šn = n + 1 æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚React å°†å®ƒåŠ å…¥é˜Ÿåˆ—ã€‚ setNumber(n = n + 1)ï¼šn = n + 1 æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚React å°†å®ƒåŠ å…¥é˜Ÿåˆ—ã€‚ å½“ä½ åœ¨ä¸‹æ¬¡æ¸²æŸ“æœŸé—´è°ƒç”¨ useState æ—¶ï¼ŒReact ä¼šéå†é˜Ÿåˆ—ã€‚ä¹‹å‰çš„ number state çš„å€¼æ˜¯ 0ï¼Œæ‰€ä»¥è¿™å°±æ˜¯ React ä½œä¸ºå‚æ•° n ä¼ é€’ç»™ç¬¬ä¸€ä¸ªæ›´æ–°å‡½æ•°çš„å€¼ã€‚ç„¶å React ä¼šè·å–ä½ ä¸Šä¸€ä¸ªæ›´æ–°å‡½æ•°çš„è¿”å›å€¼ï¼Œå¹¶å°†å…¶ä½œä¸º n ä¼ é€’ç»™ä¸‹ä¸€ä¸ªæ›´æ–°å‡½æ•°ï¼Œä»¥æ­¤ç±»æ¨ï¼š æ›´æ–°é˜Ÿåˆ— n è¿”å›å€¼ n = n + 1 0 0 + 1 = 1 n = n + 1 1 1 + 1 = 2 n = n + 1 2 2 + 1 = 3 React ä¼šä¿å­˜ 3 ä¸ºæœ€ç»ˆç»“æœå¹¶ä» useState ä¸­è¿”å›ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ç‚¹å‡»â€œ+3â€æ­£ç¡®åœ°å°†å€¼å¢åŠ â€œ+3â€ã€‚ 3.5.3 å¦‚æœä½ åœ¨æ›¿æ¢ state åæ›´æ–° state ä¼šå‘ç”Ÿä»€ä¹ˆ?è¿™ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ä¼šæ€ä¹ˆæ ·ï¼Ÿä½ è®¤ä¸º number åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“ä¸­çš„å€¼æ˜¯ä»€ä¹ˆï¼Ÿ button onClick=() = setNumber(number + 5); setNumber(n = n + 1); import useState from react;export default function Counter() const [number, setNumber] = useState(0); return ( h1number/h1 button onClick=() = setNumber(number + 5); setNumber(n = n + 1); å¢åŠ æ•°å­—/button / ) è¿™æ˜¯äº‹ä»¶å¤„ç†å‡½æ•°å‘Šè¯‰ React è¦åšçš„äº‹æƒ…ï¼š setNumber(number + 5)ï¼šnumber ä¸º 0ï¼Œæ‰€ä»¥ setNumber(0 + 5)ã€‚React å°† â€œæ›¿æ¢ä¸º 5â€ æ·»åŠ åˆ°å…¶é˜Ÿåˆ—ä¸­ã€‚ setNumber(n = n + 1)ï¼šn = n + 1 æ˜¯ä¸€ä¸ªæ›´æ–°å‡½æ•°ã€‚ React å°† è¯¥å‡½æ•° æ·»åŠ åˆ°å…¶é˜Ÿåˆ—ä¸­ã€‚ åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æœŸé—´ï¼ŒReact ä¼šéå† state é˜Ÿåˆ—ï¼š æ›´æ–°é˜Ÿåˆ— n è¿”å›å€¼ â€œæ›¿æ¢ä¸º 5â€ 0ï¼ˆæœªä½¿ç”¨ï¼‰ 5 n = n + 1 5 5 + 1 = 6 React ä¼šä¿å­˜ 6 ä¸ºæœ€ç»ˆç»“æœå¹¶ä» useState ä¸­è¿”å›ã€‚ ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼ŒsetState(x) å®é™…ä¸Šä¼šåƒ setState(n = x) ä¸€æ ·è¿è¡Œï¼Œåªæ˜¯æ²¡æœ‰ä½¿ç”¨ nï¼ 3.5.4 å¦‚æœä½ åœ¨æ›´æ–° state åæ›¿æ¢ state ä¼šå‘ç”Ÿä»€ä¹ˆ ?è®©æˆ‘ä»¬å†çœ‹ä¸€ä¸ªä¾‹å­ã€‚ä½ è®¤ä¸º number åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“ä¸­çš„å€¼æ˜¯ä»€ä¹ˆï¼Ÿ button onClick=() = setNumber(number + 5); setNumber(n = n + 1); setNumber(42); import useState from react;export default function Counter() const [number, setNumber] = useState(0); return ( h1number/h1 button onClick=() = setNumber(number + 5); setNumber(n = n + 1); setNumber(42); alert(number) å¢åŠ æ•°å­—/button / ) ä»¥ä¸‹æ˜¯ React åœ¨æ‰§è¡Œäº‹ä»¶å¤„ç†å‡½æ•°æ—¶å¤„ç†è¿™å‡ è¡Œä»£ç çš„è¿‡ç¨‹ï¼š setNumber(number + 5)ï¼šnumber ä¸º 0ï¼Œæ‰€ä»¥ setNumber(0 + 5)ã€‚React å°† â€œæ›¿æ¢ä¸º 5â€ æ·»åŠ åˆ°å…¶é˜Ÿåˆ—ä¸­ã€‚ setNumber(n = n + 1)ï¼šn = n + 1 æ˜¯ä¸€ä¸ªæ›´æ–°å‡½æ•°ã€‚React å°†è¯¥å‡½æ•°æ·»åŠ åˆ°å…¶é˜Ÿåˆ—ä¸­ã€‚ setNumber(42)ï¼šReact å°† â€œæ›¿æ¢ä¸º 42â€ æ·»åŠ åˆ°å…¶é˜Ÿåˆ—ä¸­ã€‚ åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æœŸé—´ï¼ŒReact ä¼šéå† state é˜Ÿåˆ—ï¼š æ›´æ–°é˜Ÿåˆ— n è¿”å›å€¼ â€œæ›¿æ¢ä¸º 5â€ 0ï¼ˆæœªä½¿ç”¨ï¼‰ 5 n = n + 1 5 5 + 1 = 6 â€œæ›¿æ¢ä¸º 42â€ 6ï¼ˆæœªä½¿ç”¨ï¼‰ 42 ç„¶å React ä¼šä¿å­˜ 42 ä¸ºæœ€ç»ˆç»“æœå¹¶ä» useState ä¸­è¿”å›ã€‚ æ€»è€Œè¨€ä¹‹ï¼Œä»¥ä¸‹æ˜¯ä½ å¯ä»¥è€ƒè™‘ä¼ é€’ç»™ setNumber state è®¾ç½®å‡½æ•°çš„å†…å®¹ï¼š ä¸€ä¸ªæ›´æ–°å‡½æ•°ï¼ˆä¾‹å¦‚ï¼šn = n + 1ï¼‰ä¼šè¢«æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ã€‚ ä»»ä½•å…¶ä»–çš„å€¼ï¼ˆä¾‹å¦‚ï¼šæ•°å­— 5ï¼‰ä¼šå¯¼è‡´â€œæ›¿æ¢ä¸º 5â€è¢«æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œå·²ç»åœ¨é˜Ÿåˆ—ä¸­çš„å†…å®¹ä¼šè¢«å¿½ç•¥ã€‚ äº‹ä»¶å¤„ç†å‡½æ•°æ‰§è¡Œå®Œæˆåï¼ŒReact å°†è§¦å‘é‡æ–°æ¸²æŸ“ã€‚åœ¨é‡æ–°æ¸²æŸ“æœŸé—´ï¼ŒReact å°†å¤„ç†é˜Ÿåˆ—ã€‚æ›´æ–°å‡½æ•°ä¼šåœ¨æ¸²æŸ“æœŸé—´æ‰§è¡Œï¼Œå› æ­¤ æ›´æ–°å‡½æ•°å¿…é¡»æ˜¯ çº¯å‡½æ•° å¹¶ä¸”åª è¿”å› ç»“æœã€‚ä¸è¦å°è¯•ä»å®ƒä»¬å†…éƒ¨è®¾ç½® state æˆ–è€…æ‰§è¡Œå…¶ä»–å‰¯ä½œç”¨ã€‚åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼ŒReact ä¼šæ‰§è¡Œæ¯ä¸ªæ›´æ–°å‡½æ•°ä¸¤æ¬¡ï¼ˆä½†æ˜¯ä¸¢å¼ƒç¬¬äºŒä¸ªç»“æœï¼‰ä»¥ä¾¿å¸®åŠ©ä½ å‘ç°é”™è¯¯ã€‚ 3.5.5 å‘½åæƒ¯ä¾‹é€šå¸¸å¯ä»¥é€šè¿‡ç›¸åº” state å˜é‡çš„ç¬¬ä¸€ä¸ªå­—æ¯æ¥å‘½åæ›´æ–°å‡½æ•°çš„å‚æ•°ï¼š setEnabled(e = !e);setLastName(ln = ln.reverse());setFriendCount(fc = fc * 2); å¦‚æœä½ å–œæ¬¢æ›´å†—é•¿çš„ä»£ç ï¼Œå¦ä¸€ä¸ªå¸¸è§çš„æƒ¯ä¾‹æ˜¯é‡å¤ä½¿ç”¨å®Œæ•´çš„ state å˜é‡åç§°ï¼Œå¦‚ setEnabled(enabled = !enabled)ï¼Œæˆ–ä½¿ç”¨å‰ç¼€ï¼Œå¦‚ setEnabled(prevEnabled = !prevEnabled)ã€‚ 3.5.6 æ‘˜è¦ è®¾ç½® state ä¸ä¼šæ›´æ”¹ç°æœ‰æ¸²æŸ“ä¸­çš„å˜é‡ï¼Œä½†ä¼šè¯·æ±‚ä¸€æ¬¡æ–°çš„æ¸²æŸ“ã€‚ React ä¼šåœ¨äº‹ä»¶å¤„ç†å‡½æ•°æ‰§è¡Œå®Œæˆä¹‹åå¤„ç† state æ›´æ–°ã€‚è¿™è¢«ç§°ä¸ºæ‰¹å¤„ç†ã€‚ è¦åœ¨ä¸€ä¸ªäº‹ä»¶ä¸­å¤šæ¬¡æ›´æ–°æŸäº› stateï¼Œä½ å¯ä»¥ä½¿ç”¨ setNumber(n = n + 1) æ›´æ–°å‡½æ•°ã€‚ 3.6 æ›´æ–° state ä¸­çš„å¯¹è±¡state ä¸­å¯ä»¥ä¿å­˜ä»»æ„ç±»å‹çš„ JavaScript å€¼ï¼ŒåŒ…æ‹¬å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œä½ ä¸åº”è¯¥ç›´æ¥ä¿®æ”¹å­˜æ”¾åœ¨ React state ä¸­çš„å¯¹è±¡ã€‚ç›¸åï¼Œå½“ä½ æƒ³è¦æ›´æ–°ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼ˆæˆ–è€…å°†å…¶æ‹·è´ä¸€ä»½ï¼‰ï¼Œç„¶åå°† state æ›´æ–°ä¸ºæ­¤å¯¹è±¡ã€‚ 3.6.1 ä»€ä¹ˆæ˜¯ mutationï¼Ÿä½ å¯ä»¥åœ¨ state ä¸­å­˜æ”¾ä»»æ„ç±»å‹çš„ JavaScript å€¼ã€‚ const [x, setX] = useState(0); åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½ å·²ç»å°è¯•è¿‡åœ¨ state ä¸­å­˜æ”¾æ•°å­—ã€å­—ç¬¦ä¸²å’Œå¸ƒå°”å€¼ï¼Œè¿™äº›ç±»å‹çš„å€¼åœ¨ JavaScript ä¸­æ˜¯ä¸å¯å˜ï¼ˆimmutableï¼‰çš„ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä¸èƒ½è¢«æ”¹å˜æˆ–æ˜¯åªè¯»çš„ã€‚ä½ å¯ä»¥é€šè¿‡æ›¿æ¢å®ƒä»¬çš„å€¼ä»¥è§¦å‘ä¸€æ¬¡é‡æ–°æ¸²æŸ“ã€‚ setX(5); state x ä» 0 å˜ä¸º 5ï¼Œä½†æ˜¯æ•°å­— 0 æœ¬èº«å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚åœ¨ JavaScript ä¸­ï¼Œæ— æ³•å¯¹å†…ç½®çš„åŸå§‹å€¼ï¼Œå¦‚æ•°å­—ã€å­—ç¬¦ä¸²å’Œå¸ƒå°”å€¼ï¼Œè¿›è¡Œä»»ä½•æ›´æ”¹ã€‚ ç°åœ¨è€ƒè™‘ state ä¸­å­˜æ”¾å¯¹è±¡çš„æƒ…å†µï¼š const [position, setPosition] = useState( x: 0, y: 0 ); ä»æŠ€æœ¯ä¸Šæ¥è®²ï¼Œå¯ä»¥æ”¹å˜å¯¹è±¡è‡ªèº«çš„å†…å®¹ã€‚å½“ä½ è¿™æ ·åšæ—¶ï¼Œå°±åˆ¶é€ äº†ä¸€ä¸ª mutationï¼š position.x = 5; ç„¶è€Œï¼Œè™½ç„¶ä¸¥æ ¼æ¥è¯´ React state ä¸­å­˜æ”¾çš„å¯¹è±¡æ˜¯å¯å˜çš„ï¼Œä½†ä½ åº”è¯¥åƒå¤„ç†æ•°å­—ã€å¸ƒå°”å€¼ã€å­—ç¬¦ä¸²ä¸€æ ·å°†å®ƒä»¬è§†ä¸ºä¸å¯å˜çš„ã€‚å› æ­¤ä½ åº”è¯¥æ›¿æ¢å®ƒä»¬çš„å€¼ï¼Œè€Œä¸æ˜¯å¯¹å®ƒä»¬è¿›è¡Œä¿®æ”¹ã€‚ 3.6.2 å°† state è§†ä¸ºåªè¯»çš„æ¢å¥è¯è¯´ï¼Œä½ åº”è¯¥ æŠŠæ‰€æœ‰å­˜æ”¾åœ¨ state ä¸­çš„ JavaScript å¯¹è±¡éƒ½è§†ä¸ºåªè¯»çš„ã€‚ åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªå­˜æ”¾åœ¨ state ä¸­çš„å¯¹è±¡æ¥è¡¨ç¤ºæŒ‡é’ˆå½“å‰çš„ä½ç½®ã€‚å½“ä½ åœ¨é¢„è§ˆåŒºè§¦æ‘¸æˆ–ç§»åŠ¨å…‰æ ‡æ—¶ï¼Œçº¢è‰²çš„ç‚¹æœ¬åº”ç§»åŠ¨ã€‚ä½†æ˜¯å®é™…ä¸Šçº¢ç‚¹ä»åœç•™åœ¨åŸå¤„ï¼š import useState from react;export default function MovingDot() const [position, setPosition] = useState( x: 0, y: 0 ); return ( div onPointerMove=e = position.x = e.clientX; position.y = e.clientY; style= position: relative, width: 100vw, height: 100vh, div style= position: absolute, backgroundColor: red, borderRadius: 50%, transform: `translate($position.xpx, $position.ypx)`, left: -10, top: -10, width: 20, height: 20, / /div ); é—®é¢˜å‡ºåœ¨ä¸‹é¢è¿™æ®µä»£ç ä¸­ã€‚ onPointerMove=e = position.x = e.clientX; position.y = e.clientY; è¿™æ®µä»£ç ç›´æ¥ä¿®æ”¹äº† ä¸Šä¸€æ¬¡æ¸²æŸ“ä¸­ åˆ†é…ç»™ position çš„å¯¹è±¡ã€‚ä½†æ˜¯å› ä¸ºå¹¶æ²¡æœ‰ä½¿ç”¨ state çš„è®¾ç½®å‡½æ•°ï¼ŒReact å¹¶ä¸çŸ¥é“å¯¹è±¡å·²æ›´æ”¹ã€‚æ‰€ä»¥ React æ²¡æœ‰åšå‡ºä»»ä½•å“åº”ã€‚è¿™å°±åƒåœ¨åƒå®Œé¥­ä¹‹åæ‰å°è¯•å»æ”¹å˜è¦ç‚¹çš„èœä¸€æ ·ã€‚è™½ç„¶åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œç›´æ¥ä¿®æ”¹ state å¯èƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œä½†æˆ‘ä»¬å¹¶ä¸æ¨èè¿™ä¹ˆåšã€‚ä½ åº”è¯¥æŠŠåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å¯ä»¥è®¿é—®åˆ°çš„ state è§†ä¸ºåªè¯»çš„ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºäº†çœŸæ­£åœ° è§¦å‘ä¸€æ¬¡é‡æ–°æ¸²æŸ“ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡å¹¶æŠŠå®ƒä¼ é€’ç»™ state çš„è®¾ç½®å‡½æ•°ï¼š onPointerMove=e = setPosition( x: e.clientX, y: e.clientY ); é€šè¿‡ä½¿ç”¨ setPositionï¼Œä½ åœ¨å‘Šè¯‰ Reactï¼š ä½¿ç”¨è¿™ä¸ªæ–°çš„å¯¹è±¡æ›¿æ¢ position çš„å€¼ ç„¶åå†æ¬¡æ¸²æŸ“è¿™ä¸ªç»„ä»¶ ç°åœ¨ä½ å¯ä»¥çœ‹åˆ°ï¼Œå½“ä½ åœ¨é¢„è§ˆåŒºè§¦æ‘¸æˆ–ç§»åŠ¨å…‰æ ‡æ—¶ï¼Œçº¢ç‚¹ä¼šè·Ÿéšç€ä½ çš„æŒ‡é’ˆç§»åŠ¨ï¼š import useState from react;export default function MovingDot() const [position, setPosition] = useState( x: 0, y: 0 ); return ( div onPointerMove=e = setPosition( x: e.clientX, y: e.clientY ); style= position: relative, width: 100vw, height: 100vh, div style= position: absolute, backgroundColor: red, borderRadius: 50%, transform: `translate($position.xpx, $position.ypx)`, left: -10, top: -10, width: 20, height: 20, / /div ); å±€éƒ¨ mutation æ˜¯å¯ä»¥æ¥å—çš„åƒè¿™æ ·çš„ä»£ç æ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºå®ƒæ”¹å˜äº† state ä¸­ç°æœ‰çš„å¯¹è±¡ï¼š position.x = e.clientX;position.y = e.clientY; ä½†æ˜¯åƒè¿™æ ·çš„ä»£ç å°± æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œå› ä¸ºä½ æ”¹å˜çš„æ˜¯ä½ åˆšåˆšåˆ›å»ºçš„ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼š const nextPosition = ;nextPosition.x = e.clientX;nextPosition.y = e.clientY;setPosition(nextPosition); äº‹å®ä¸Šï¼Œå®ƒå®Œå…¨ç­‰åŒäºä¸‹é¢è¿™ç§å†™æ³•ï¼š setPosition( x: e.clientX, y: e.clientY); åªæœ‰å½“ä½ æ”¹å˜å·²ç»å¤„äº state ä¸­çš„ ç°æœ‰ å¯¹è±¡æ—¶ï¼Œmutation æ‰ä¼šæˆä¸ºé—®é¢˜ã€‚è€Œä¿®æ”¹ä¸€ä¸ªä½ åˆšåˆšåˆ›å»ºçš„å¯¹è±¡å°±ä¸ä¼šå‡ºç°ä»»ä½•é—®é¢˜ï¼Œå› ä¸º è¿˜æ²¡æœ‰å…¶ä»–çš„ä»£ç å¼•ç”¨å®ƒã€‚æ”¹å˜å®ƒå¹¶ä¸ä¼šæ„å¤–åœ°å½±å“åˆ°ä¾èµ–å®ƒçš„ä¸œè¥¿ã€‚è¿™å«åšâ€œå±€éƒ¨ mutationâ€ã€‚ä½ ç”šè‡³å¯ä»¥ åœ¨æ¸²æŸ“çš„è¿‡ç¨‹ä¸­ è¿›è¡Œâ€œå±€éƒ¨ mutationâ€çš„æ“ä½œã€‚è¿™ç§æ“ä½œæ—¢ä¾¿æ·åˆæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼ 3.6.3 ä½¿ç”¨å±•å¼€è¯­æ³•å¤åˆ¶å¯¹è±¡åœ¨ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œå§‹ç»ˆä¼šæ ¹æ®å½“å‰æŒ‡é’ˆçš„ä½ç½®åˆ›å»ºå‡ºä¸€ä¸ªæ–°çš„ position å¯¹è±¡ã€‚ä½†æ˜¯é€šå¸¸ï¼Œä½ ä¼šå¸Œæœ›æŠŠ ç°æœ‰ æ•°æ®ä½œä¸ºä½ æ‰€åˆ›å»ºçš„æ–°å¯¹è±¡çš„ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½åªæƒ³è¦æ›´æ–°è¡¨å•ä¸­çš„ä¸€ä¸ªå­—æ®µï¼Œå…¶ä»–çš„å­—æ®µä»ç„¶ä½¿ç”¨ä¹‹å‰çš„å€¼ã€‚ ä¸‹é¢çš„ä»£ç ä¸­ï¼Œè¾“å…¥æ¡†å¹¶ä¸ä¼šæ­£å¸¸è¿è¡Œï¼Œå› ä¸º onChange ç›´æ¥ä¿®æ”¹äº† state ï¼š import useState from react;export default function Form() const [person, setPerson] = useState( firstName: Barbara, lastName: Hepworth, email: bhepworth@sculpture.com ); function handleFirstNameChange(e) person.firstName = e.target.value; function handleLastNameChange(e) person.lastName = e.target.value; function handleEmailChange(e) person.email = e.target.value; return ( label First name: input value=person.firstName onChange=handleFirstNameChange / /label label Last name: input value=person.lastName onChange=handleLastNameChange / /label label Email: input value=person.email onChange=handleEmailChange / /label p person.firstName person.lastName (person.email) /p / ); ä¾‹å¦‚ï¼Œä¸‹é¢è¿™è¡Œä»£ç ä¿®æ”¹äº†ä¸Šä¸€æ¬¡æ¸²æŸ“ä¸­çš„ stateï¼š person.firstName = e.target.value; æƒ³è¦å®ç°ä½ çš„éœ€æ±‚ï¼Œæœ€å¯é çš„åŠæ³•å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡å¹¶å°†å®ƒä¼ é€’ç»™ setPersonã€‚ä½†æ˜¯åœ¨è¿™é‡Œï¼Œä½ è¿˜éœ€è¦ æŠŠå½“å‰çš„æ•°æ®å¤åˆ¶åˆ°æ–°å¯¹è±¡ä¸­ï¼Œå› ä¸ºä½ åªæ”¹å˜äº†å…¶ä¸­ä¸€ä¸ªå­—æ®µï¼š setPerson( firstName: e.target.value, // ä» input ä¸­è·å–æ–°çš„ first name lastName: person.lastName, email: person.email); ä½ å¯ä»¥ä½¿ç”¨ ... å¯¹è±¡å±•å¼€ è¯­æ³•ï¼Œè¿™æ ·ä½ å°±ä¸éœ€è¦å•ç‹¬å¤åˆ¶æ¯ä¸ªå±æ€§ã€‚ setPerson( ...person, // å¤åˆ¶ä¸Šä¸€ä¸ª person ä¸­çš„æ‰€æœ‰å­—æ®µ firstName: e.target.value // ä½†æ˜¯è¦†ç›– firstName å­—æ®µ ); ç°åœ¨è¡¨å•å¯ä»¥æ­£å¸¸è¿è¡Œäº†ï¼ å¯ä»¥çœ‹åˆ°ï¼Œä½ å¹¶æ²¡æœ‰ä¸ºæ¯ä¸ªè¾“å…¥æ¡†å•ç‹¬å£°æ˜ä¸€ä¸ª stateã€‚å¯¹äºå¤§å‹è¡¨å•ï¼Œå°†æ‰€æœ‰æ•°æ®éƒ½å­˜æ”¾åœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸­æ˜¯éå¸¸æ–¹ä¾¿çš„â€”â€”å‰ææ˜¯ä½ èƒ½å¤Ÿæ­£ç¡®åœ°æ›´æ–°å®ƒï¼ import useState from react;export default function Form() const [person, setPerson] = useState( firstName: Barbara, lastName: Hepworth, email: bhepworth@sculpture.com ); function handleFirstNameChange(e) setPerson( ...person, firstName: e.target.value ); function handleLastNameChange(e) setPerson( ...person, lastName: e.target.value ); function handleEmailChange(e) setPerson( ...person, email: e.target.value ); return ( label First name: input value=person.firstName onChange=handleFirstNameChange / /label label Last name: input value=person.lastName onChange=handleLastNameChange / /label label Email: input value=person.email onChange=handleEmailChange / /label p person.firstName person.lastName (person.email) /p / ); è¯·æ³¨æ„ ... å±•å¼€è¯­æ³•æœ¬è´¨æ˜¯æ˜¯â€œæµ…æ‹·è´â€â€”â€”å®ƒåªä¼šå¤åˆ¶ä¸€å±‚ã€‚è¿™ä½¿å¾—å®ƒçš„æ‰§è¡Œé€Ÿåº¦å¾ˆå¿«ï¼Œä½†æ˜¯ä¹Ÿæ„å‘³ç€å½“ä½ æƒ³è¦æ›´æ–°ä¸€ä¸ªåµŒå¥—å±æ€§æ—¶ï¼Œä½ å¿…é¡»å¾—å¤šæ¬¡ä½¿ç”¨å±•å¼€è¯­æ³•ã€‚ ä½¿ç”¨ä¸€ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°æ¥æ›´æ–°å¤šä¸ªå­—æ®µä½ ä¹Ÿå¯ä»¥åœ¨å¯¹è±¡çš„å®šä¹‰ä¸­ä½¿ç”¨ [ å’Œ ] æ‹¬å·æ¥å®ç°å±æ€§çš„åŠ¨æ€å‘½åã€‚ä¸‹é¢æ˜¯åŒä¸€ä¸ªä¾‹å­ï¼Œä½†å®ƒä½¿ç”¨äº†ä¸€ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°è€Œä¸æ˜¯ä¸‰ä¸ªï¼š import useState from react;export default function Form() const [person, setPerson] = useState( firstName: Barbara, lastName: Hepworth, email: bhepworth@sculpture.com ); function handleChange(e) setPerson( ...person, [e.target.name]: e.target.value ); return ( label First name: input name=firstName value=person.firstName onChange=handleChange / /label label Last name: input name=lastName value=person.lastName onChange=handleChange / /label label Email: input name=email value=person.email onChange=handleChange / /label p person.firstName person.lastName (person.email) /p / ); åœ¨è¿™é‡Œï¼Œe.target.name å¼•ç”¨äº† input è¿™ä¸ª DOM å…ƒç´ çš„ name å±æ€§ã€‚ 3.6.4 æ›´æ–°ä¸€ä¸ªåµŒå¥—å¯¹è±¡è€ƒè™‘ä¸‹é¢è¿™ç§ç»“æ„çš„åµŒå¥—å¯¹è±¡ï¼š const [person, setPerson] = useState( name: Niki de Saint Phalle, artwork: title: Blue Nana, city: Hamburg, image: https://i.imgur.com/Sd1AgUOm.jpg, ); å¦‚æœä½ æƒ³è¦æ›´æ–° person.artwork.city çš„å€¼ï¼Œç”¨ mutation æ¥å®ç°çš„æ–¹æ³•éå¸¸å®¹æ˜“ç†è§£ï¼š person.artwork.city = New Delhi; ä½†æ˜¯åœ¨ React ä¸­ï¼Œä½ éœ€è¦å°† state è§†ä¸ºä¸å¯å˜çš„ï¼ä¸ºäº†ä¿®æ”¹ city çš„å€¼ï¼Œä½ é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ artwork å¯¹è±¡ï¼ˆå…¶ä¸­é¢„å…ˆå¡«å……äº†ä¸Šä¸€ä¸ª artwork å¯¹è±¡ä¸­çš„æ•°æ®ï¼‰ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„ person å¯¹è±¡ï¼Œå¹¶ä½¿å¾—å…¶ä¸­çš„ artwork å±æ€§æŒ‡å‘æ–°åˆ›å»ºçš„ artwork å¯¹è±¡ï¼š const nextArtwork = ...person.artwork, city: New Delhi ;const nextPerson = ...person, artwork: nextArtwork ;setPerson(nextPerson); æˆ–è€…ï¼Œå†™æˆä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼š setPerson( ...person, // å¤åˆ¶å…¶å®ƒå­—æ®µçš„æ•°æ® artwork: // æ›¿æ¢ artwork å­—æ®µ ...person.artwork, // å¤åˆ¶ä¹‹å‰ person.artwork ä¸­çš„æ•°æ® city: New Delhi // ä½†æ˜¯å°† city çš„å€¼æ›¿æ¢ä¸º New Delhiï¼ ); è¿™è™½ç„¶çœ‹èµ·æ¥æœ‰ç‚¹å†—é•¿ï¼Œä½†å¯¹äºå¾ˆå¤šæƒ…å†µéƒ½èƒ½æœ‰æ•ˆåœ°è§£å†³é—®é¢˜ï¼š import useState from react;export default function Form() const [person, setPerson] = useState( name: Niki de Saint Phalle, artwork: title: Blue Nana, city: Hamburg, image: https://i.imgur.com/Sd1AgUOm.jpg, ); function handleNameChange(e) setPerson( ...person, name: e.target.value ); function handleTitleChange(e) setPerson( ...person, artwork: ...person.artwork, title: e.target.value ); function handleCityChange(e) setPerson( ...person, artwork: ...person.artwork, city: e.target.value ); function handleImageChange(e) setPerson( ...person, artwork: ...person.artwork, image: e.target.value ); return ( label Name: input value=person.name onChange=handleNameChange / /label label Title: input value=person.artwork.title onChange=handleTitleChange / /label label City: input value=person.artwork.city onChange=handleCityChange / /label label Image: input value=person.artwork.image onChange=handleImageChange / /label p iperson.artwork.title/i by person.name br / (located in person.artwork.city) /p img src=person.artwork.image alt=person.artwork.title / / ); å¯¹è±¡å¹¶éæ˜¯çœŸæ­£åµŒå¥—çš„ä¸‹é¢è¿™ä¸ªå¯¹è±¡ä»ä»£ç ä¸Šæ¥çœ‹æ˜¯â€œåµŒå¥—â€çš„ï¼š let obj = name: Niki de Saint Phalle, artwork: title: Blue Nana, city: Hamburg, image: https://i.imgur.com/Sd1AgUOm.jpg, ; ç„¶è€Œï¼Œå½“æˆ‘ä»¬æ€è€ƒå¯¹è±¡çš„ç‰¹æ€§æ—¶ï¼Œâ€œåµŒå¥—â€å¹¶ä¸æ˜¯ä¸€ä¸ªéå¸¸å‡†ç¡®çš„æ–¹å¼ã€‚å½“è¿™æ®µä»£ç è¿è¡Œçš„æ—¶å€™ï¼Œä¸å­˜åœ¨â€œåµŒå¥—â€çš„å¯¹è±¡ã€‚ä½ å®é™…ä¸Šçœ‹åˆ°çš„æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼š let obj1 = title: Blue Nana, city: Hamburg, image: https://i.imgur.com/Sd1AgUOm.jpg,;let obj2 = name: Niki de Saint Phalle, artwork: obj1; å¯¹è±¡ obj1 å¹¶ä¸å¤„äº obj2 çš„â€œå†…éƒ¨â€ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç ä¸­ï¼Œobj3 ä¸­çš„å±æ€§ä¹Ÿå¯ä»¥æŒ‡å‘ obj1ï¼š let obj1 = title: Blue Nana, city: Hamburg, image: https://i.imgur.com/Sd1AgUOm.jpg,;let obj2 = name: Niki de Saint Phalle, artwork: obj1;let obj3 = name: Copycat, artwork: obj1; å¦‚æœä½ ç›´æ¥ä¿®æ”¹ obj3.artwork.cityï¼Œå°±ä¼šåŒæ—¶å½±å“ obj2.artwork.city å’Œ obj1.cityã€‚è¿™æ˜¯å› ä¸º obj3.artworkã€obj2.artwork å’Œ obj1 éƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚å½“ä½ ç”¨â€œåµŒå¥—â€çš„æ–¹å¼çœ‹å¾…å¯¹è±¡æ—¶ï¼Œå¾ˆéš¾çœ‹å‡ºè¿™ä¸€ç‚¹ã€‚ç›¸åï¼Œå®ƒä»¬æ˜¯ç›¸äº’ç‹¬ç«‹çš„å¯¹è±¡ï¼Œåªä¸è¿‡æ˜¯ç”¨å±æ€§â€œæŒ‡å‘â€å½¼æ­¤è€Œå·²ã€‚ 3.6.5 ä½¿ç”¨ Immer ç¼–å†™ç®€æ´çš„æ›´æ–°é€»è¾‘å¦‚æœä½ çš„ state æœ‰å¤šå±‚çš„åµŒå¥—ï¼Œä½ æˆ–è®¸åº”è¯¥è€ƒè™‘ å°†å…¶æ‰å¹³åŒ–ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä¸æƒ³æ”¹å˜ state çš„æ•°æ®ç»“æ„ï¼Œä½ å¯èƒ½æ›´å–œæ¬¢ç”¨ä¸€ç§æ›´ä¾¿æ·çš„æ–¹å¼æ¥å®ç°åµŒå¥—å±•å¼€çš„æ•ˆæœã€‚Immer æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„åº“ï¼Œå®ƒå¯ä»¥è®©ä½ ä½¿ç”¨ç®€ä¾¿ä½†å¯ä»¥ç›´æ¥ä¿®æ”¹çš„è¯­æ³•ç¼–å†™ä»£ç ï¼Œå¹¶ä¼šå¸®ä½ å¤„ç†å¥½å¤åˆ¶çš„è¿‡ç¨‹ã€‚é€šè¿‡ä½¿ç”¨ Immerï¼Œä½ å†™å‡ºçš„ä»£ç çœ‹èµ·æ¥å°±åƒæ˜¯ä½ â€œæ‰“ç ´äº†è§„åˆ™â€è€Œç›´æ¥ä¿®æ”¹äº†å¯¹è±¡ï¼š updatePerson(draft = draft.artwork.city = Lagos;); ä½†æ˜¯ä¸åŒäºä¸€èˆ¬çš„ mutationï¼Œå®ƒå¹¶ä¸ä¼šè¦†ç›–ä¹‹å‰çš„ stateï¼ Immer æ˜¯å¦‚ä½•è¿è¡Œçš„ï¼Ÿç”± Immer æä¾›çš„ draft æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„å¯¹è±¡ï¼Œè¢«ç§°ä¸º Proxyï¼Œå®ƒä¼šè®°å½•ä½ ç”¨å®ƒæ‰€è¿›è¡Œçš„æ“ä½œã€‚è¿™å°±æ˜¯ä½ èƒ½å¤Ÿéšå¿ƒæ‰€æ¬²åœ°ç›´æ¥ä¿®æ”¹å¯¹è±¡çš„åŸå› æ‰€åœ¨ï¼ä»åŸç†ä¸Šè¯´ï¼ŒImmer ä¼šå¼„æ¸…æ¥š draft å¯¹è±¡çš„å“ªäº›éƒ¨åˆ†è¢«æ”¹å˜äº†ï¼Œå¹¶ä¼šä¾ç…§ä½ çš„ä¿®æ”¹åˆ›å»ºå‡ºä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ã€‚ å°è¯•ä½¿ç”¨ Immer: è¿è¡Œ npm install use-immer æ·»åŠ  Immer ä¾èµ– ç”¨ import useImmer from use-immer æ›¿æ¢æ‰ import useState from react ä¸‹é¢æˆ‘ä»¬æŠŠä¸Šé¢çš„ä¾‹å­ç”¨ Immer å®ç°ä¸€ä¸‹ï¼š import useImmer from use-immer;export default function Form() const [person, updatePerson] = useImmer( name: Niki de Saint Phalle, artwork: title: Blue Nana, city: Hamburg, image: https://i.imgur.com/Sd1AgUOm.jpg, ); function handleNameChange(e) updatePerson(draft = draft.name = e.target.value; ); function handleTitleChange(e) updatePerson(draft = draft.artwork.title = e.target.value; ); function handleCityChange(e) updatePerson(draft = draft.artwork.city = e.target.value; ); function handleImageChange(e) updatePerson(draft = draft.artwork.image = e.target.value; ); return ( label Name: input value=person.name onChange=handleNameChange / /label label Title: input value=person.artwork.title onChange=handleTitleChange / /label label City: input value=person.artwork.city onChange=handleCityChange / /label label Image: input value=person.artwork.image onChange=handleImageChange / /label p iperson.artwork.title/i by person.name br / (located in person.artwork.city) /p img src=person.artwork.image alt=person.artwork.title / / ); å¯ä»¥çœ‹åˆ°ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°å˜å¾—æ›´ç®€æ´äº†ã€‚ä½ å¯ä»¥éšæ„åœ¨ä¸€ä¸ªç»„ä»¶ä¸­åŒæ—¶ä½¿ç”¨ useState å’Œ useImmerã€‚å¦‚æœä½ æƒ³è¦å†™å‡ºæ›´ç®€æ´çš„æ›´æ–°å¤„ç†å‡½æ•°ï¼ŒImmer ä¼šæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œå°¤å…¶æ˜¯å½“ä½ çš„ state ä¸­æœ‰åµŒå¥—ï¼Œå¹¶ä¸”å¤åˆ¶å¯¹è±¡ä¼šå¸¦æ¥é‡å¤çš„ä»£ç æ—¶ã€‚ ä¸ºä»€ä¹ˆåœ¨ React ä¸­ä¸æ¨èç›´æ¥ä¿®æ”¹ stateï¼Ÿæœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š è°ƒè¯•ï¼šå¦‚æœä½ ä½¿ç”¨ console.log å¹¶ä¸”ä¸ç›´æ¥ä¿®æ”¹ stateï¼Œä½ ä¹‹å‰æ—¥å¿—ä¸­çš„ state çš„å€¼å°±ä¸ä¼šè¢«æ–°çš„ state å˜åŒ–æ‰€å½±å“ã€‚è¿™æ ·ä½ å°±å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ä¸¤æ¬¡æ¸²æŸ“ä¹‹é—´ state çš„å€¼å‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ– ä¼˜åŒ–ï¼šReact å¸¸è§çš„ ä¼˜åŒ–ç­–ç•¥ ä¾èµ–äºå¦‚æœä¹‹å‰çš„ props æˆ–è€… state çš„å€¼å’Œä¸‹ä¸€æ¬¡ç›¸åŒå°±è·³è¿‡æ¸²æŸ“ã€‚å¦‚æœä½ ä»æœªç›´æ¥ä¿®æ”¹ state ï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥å¾ˆå¿«çœ‹åˆ° state æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ã€‚å¦‚æœ prevObj === objï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥è‚¯å®šè¿™ä¸ªå¯¹è±¡å†…éƒ¨å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚ æ–°åŠŸèƒ½ï¼šæˆ‘ä»¬æ­£åœ¨æ„å»ºçš„ React çš„æ–°åŠŸèƒ½ä¾èµ–äº state è¢« åƒå¿«ç…§ä¸€æ ·çœ‹å¾… çš„ç†å¿µã€‚å¦‚æœä½ ç›´æ¥ä¿®æ”¹ state çš„å†å²ç‰ˆæœ¬ï¼Œå¯èƒ½ä¼šå½±å“ä½ ä½¿ç”¨è¿™äº›æ–°åŠŸèƒ½ã€‚ éœ€æ±‚å˜æ›´ï¼šæœ‰äº›åº”ç”¨åŠŸèƒ½åœ¨ä¸å‡ºç°ä»»ä½•ä¿®æ”¹çš„æƒ…å†µä¸‹ä¼šæ›´å®¹æ˜“å®ç°ï¼Œæ¯”å¦‚å®ç°æ’¤é”€æ¢å¤ã€å±•ç¤ºä¿®æ”¹å†å²ï¼Œæˆ–æ˜¯å…è®¸ç”¨æˆ·æŠŠè¡¨å•é‡ç½®æˆæŸä¸ªä¹‹å‰çš„å€¼ã€‚è¿™æ˜¯å› ä¸ºä½ å¯ä»¥æŠŠ state ä¹‹å‰çš„æ‹·è´ä¿å­˜åˆ°å†…å­˜ä¸­ï¼Œå¹¶é€‚æ—¶å¯¹å…¶è¿›è¡Œå†æ¬¡ä½¿ç”¨ã€‚å¦‚æœä¸€å¼€å§‹å°±ç”¨äº†ç›´æ¥ä¿®æ”¹ state çš„æ–¹å¼ï¼Œé‚£ä¹ˆåé¢è¦å®ç°è¿™æ ·çš„åŠŸèƒ½å°±ä¼šå˜å¾—éå¸¸å›°éš¾ã€‚ æ›´ç®€å•çš„å®ç°ï¼šReact å¹¶ä¸ä¾èµ–äº mutation ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦å¯¹å¯¹è±¡è¿›è¡Œä»»ä½•ç‰¹æ®Šæ“ä½œã€‚å®ƒä¸éœ€è¦åƒå¾ˆå¤šâ€œå“åº”å¼â€çš„è§£å†³æ–¹æ¡ˆä¸€æ ·å»åŠ«æŒå¯¹è±¡çš„å±æ€§ã€æ€»æ˜¯ç”¨ä»£ç†æŠŠå¯¹è±¡åŒ…è£¹èµ·æ¥ï¼Œæˆ–è€…åœ¨åˆå§‹åŒ–æ—¶åšå…¶ä»–å·¥ä½œã€‚è¿™ä¹Ÿæ˜¯ React å…è®¸ä½ æŠŠä»»ä½•å¯¹è±¡å­˜æ”¾åœ¨ state ä¸­â€”â€”ä¸ç®¡å¯¹è±¡æœ‰å¤šå¤§â€”â€”è€Œä¸ä¼šé€ æˆæœ‰ä»»ä½•é¢å¤–çš„æ€§èƒ½æˆ–æ­£ç¡®æ€§é—®é¢˜çš„åŸå› ã€‚ åœ¨å®è·µä¸­ï¼Œä½ ç»å¸¸å¯ä»¥â€œä¾¥å¹¸â€ç›´æ¥ä¿®æ”¹ state è€Œä¸å‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½ ä¸è¦è¿™æ ·åšï¼Œè¿™æ ·ä½ å°±å¯ä»¥ä½¿ç”¨æˆ‘ä»¬ç§‰æ‰¿ç€è¿™ç§ç†å¿µå¼€å‘çš„ React æ–°åŠŸèƒ½ã€‚æœªæ¥çš„è´¡çŒ®è€…ç”šè‡³æ˜¯ä½ æœªæ¥çš„è‡ªå·±éƒ½ä¼šæ„Ÿè°¢ä½ çš„ï¼ 3.6.6 æ‘˜è¦ å°† React ä¸­æ‰€æœ‰çš„ state éƒ½è§†ä¸ºä¸å¯ç›´æ¥ä¿®æ”¹çš„ã€‚ å½“ä½ åœ¨ state ä¸­å­˜æ”¾å¯¹è±¡æ—¶ï¼Œç›´æ¥ä¿®æ”¹å¯¹è±¡å¹¶ä¸ä¼šè§¦å‘é‡æ¸²æŸ“ï¼Œå¹¶ä¼šæ”¹å˜å‰ä¸€æ¬¡æ¸²æŸ“â€œå¿«ç…§â€ä¸­ state çš„å€¼ã€‚ ä¸è¦ç›´æ¥ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œè¦ä¸ºå®ƒåˆ›å»ºä¸€ä¸ª æ–° ç‰ˆæœ¬ï¼Œå¹¶é€šè¿‡æŠŠ state è®¾ç½®æˆè¿™ä¸ªæ–°ç‰ˆæœ¬æ¥è§¦å‘é‡æ–°æ¸²æŸ“ã€‚ ä½ å¯ä»¥ä½¿ç”¨è¿™æ ·çš„ ...obj, something: newValue å¯¹è±¡å±•å¼€è¯­æ³•æ¥åˆ›å»ºå¯¹è±¡çš„æ‹·è´ã€‚ å¯¹è±¡çš„å±•å¼€è¯­æ³•æ˜¯æµ…å±‚çš„ï¼šå®ƒçš„å¤åˆ¶æ·±åº¦åªæœ‰ä¸€å±‚ã€‚ æƒ³è¦æ›´æ–°åµŒå¥—å¯¹è±¡ï¼Œä½ éœ€è¦ä»ä½ æ›´æ–°çš„ä½ç½®å¼€å§‹è‡ªåº•å‘ä¸Šä¸ºæ¯ä¸€å±‚éƒ½åˆ›å»ºæ–°çš„æ‹·è´ã€‚ æƒ³è¦å‡å°‘é‡å¤çš„æ‹·è´ä»£ç ï¼Œå¯ä»¥ä½¿ç”¨ Immerã€‚ 3.7 æ›´æ–° state ä¸­çš„æ•°ç»„æ•°ç»„æ˜¯å¦å¤–ä¸€ç§å¯ä»¥å­˜å‚¨åœ¨ state ä¸­çš„ JavaScript å¯¹è±¡ï¼Œå®ƒè™½ç„¶æ˜¯å¯å˜çš„ï¼Œä½†æ˜¯å´åº”è¯¥è¢«è§†ä¸ºä¸å¯å˜ã€‚åŒå¯¹è±¡ä¸€æ ·ï¼Œå½“ä½ æƒ³è¦æ›´æ–°å­˜å‚¨äº state ä¸­çš„æ•°ç»„æ—¶ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼ˆæˆ–è€…åˆ›å»ºä¸€ä»½å·²æœ‰æ•°ç»„çš„æ‹·è´å€¼ï¼‰ï¼Œå¹¶ä½¿ç”¨æ–°æ•°ç»„è®¾ç½® stateã€‚ 3.7.1 åœ¨æ²¡æœ‰ mutation çš„å‰æä¸‹æ›´æ–°æ•°ç»„åœ¨ JavaScript ä¸­ï¼Œæ•°ç»„åªæ˜¯å¦ä¸€ç§å¯¹è±¡ã€‚åŒå¯¹è±¡ä¸€æ ·ï¼Œä½ éœ€è¦å°† React state ä¸­çš„æ•°ç»„è§†ä¸ºåªè¯»çš„ã€‚è¿™æ„å‘³ç€ä½ ä¸åº”è¯¥ä½¿ç”¨ç±»ä¼¼äº arr[0] = bird è¿™æ ·çš„æ–¹å¼æ¥é‡æ–°åˆ†é…æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œä¹Ÿä¸åº”è¯¥ä½¿ç”¨ä¼šç›´æ¥ä¿®æ”¹åŸå§‹æ•°ç»„çš„æ–¹æ³•ï¼Œä¾‹å¦‚ push() å’Œ pop()ã€‚ ç›¸åï¼Œæ¯æ¬¡è¦æ›´æ–°ä¸€ä¸ªæ•°ç»„æ—¶ï¼Œä½ éœ€è¦æŠŠä¸€ä¸ªæ–°çš„æ•°ç»„ä¼ å…¥ state çš„ setting æ–¹æ³•ä¸­ã€‚ä¸ºæ­¤ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨åƒ filter() å’Œ map() è¿™æ ·ä¸ä¼šç›´æ¥ä¿®æ”¹åŸå§‹å€¼çš„æ–¹æ³•ï¼Œä»åŸå§‹æ•°ç»„ç”Ÿæˆä¸€ä¸ªæ–°çš„æ•°ç»„ã€‚ç„¶åä½ å°±å¯ä»¥å°† state è®¾ç½®ä¸ºè¿™ä¸ªæ–°ç”Ÿæˆçš„æ•°ç»„ã€‚ ä¸‹é¢æ˜¯å¸¸è§æ•°ç»„æ“ä½œçš„å‚è€ƒè¡¨ã€‚å½“ä½ æ“ä½œ React state ä¸­çš„æ•°ç»„æ—¶ï¼Œä½ éœ€è¦é¿å…ä½¿ç”¨å·¦åˆ—çš„æ–¹æ³•ï¼Œè€Œé¦–é€‰å³åˆ—çš„æ–¹æ³•ï¼š é¿å…ä½¿ç”¨ (ä¼šæ”¹å˜åŸå§‹æ•°ç»„) æ¨èä½¿ç”¨ (ä¼šè¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼‰ æ·»åŠ å…ƒç´  pushï¼Œunshift concatï¼Œ[...arr] å±•å¼€è¯­æ³•ï¼ˆä¾‹å­ï¼‰ åˆ é™¤å…ƒç´  popï¼Œshiftï¼Œsplice filterï¼Œsliceï¼ˆä¾‹å­ï¼‰ æ›¿æ¢å…ƒç´  spliceï¼Œarr[i] = ... èµ‹å€¼ mapï¼ˆä¾‹å­ï¼‰ æ’åº reverseï¼Œsort å…ˆå°†æ•°ç»„å¤åˆ¶ä¸€ä»½ï¼ˆä¾‹å­ï¼‰ æˆ–è€…ï¼Œä½ å¯ä»¥ä½¿ç”¨ Immer ï¼Œè¿™æ ·ä½ ä¾¿å¯ä»¥ä½¿ç”¨è¡¨æ ¼ä¸­çš„æ‰€æœ‰æ–¹æ³•äº†ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œè™½ç„¶ slice å’Œ splice çš„åå­—ç›¸ä¼¼ï¼Œä½†ä½œç”¨å´è¿¥ç„¶ä¸åŒï¼š slice è®©ä½ å¯ä»¥æ‹·è´æ•°ç»„æˆ–æ˜¯æ•°ç»„çš„ä¸€éƒ¨åˆ†ã€‚ splice ä¼šç›´æ¥ä¿®æ”¹ åŸå§‹æ•°ç»„ï¼ˆæ’å…¥æˆ–è€…åˆ é™¤å…ƒç´ ï¼‰ã€‚ åœ¨ React ä¸­ï¼Œæ›´å¤šæƒ…å†µä¸‹ä½ ä¼šä½¿ç”¨ sliceï¼ˆæ²¡æœ‰ p ï¼ï¼‰ï¼Œå› ä¸ºä½ ä¸æƒ³æ”¹å˜ state ä¸­çš„å¯¹è±¡æˆ–æ•°ç»„ã€‚æ›´æ–°å¯¹è±¡è¿™ä¸€ç« èŠ‚è§£é‡Šäº†ä»€ä¹ˆæ˜¯ mutationï¼Œä»¥åŠä¸ºä»€ä¹ˆä¸æ¨èåœ¨ state é‡Œè¿™æ ·åšã€‚ 3.7.2 å‘æ•°ç»„ä¸­æ·»åŠ å…ƒç´ push() ä¼šç›´æ¥ä¿®æ”¹åŸå§‹æ•°ç»„ï¼Œè€Œä½ ä¸å¸Œæœ›è¿™æ ·ï¼š import useState from react;let nextId = 0;export default function List() const [name, setName] = useState(); const [artists, setArtists] = useState([]); return ( h1æŒ¯å¥‹äººå¿ƒçš„é›•å¡‘å®¶ä»¬ï¼š/h1 input value=name onChange=e = setName(e.target.value) / button onClick=() = artists.push( id: nextId++, name: name, ); æ·»åŠ /button ul artists.map(artist = ( li key=artist.idartist.name/li )) /ul / ); ç›¸åï¼Œä½ åº”è¯¥åˆ›å»ºä¸€ä¸ª æ–° æ•°ç»„ï¼Œå…¶åŒ…å«äº†åŸå§‹æ•°ç»„çš„æ‰€æœ‰å…ƒç´  ä»¥åŠ ä¸€ä¸ªåœ¨æœ«å°¾çš„æ–°å…ƒç´ ã€‚è¿™å¯ä»¥é€šè¿‡å¾ˆå¤šç§æ–¹æ³•å®ç°ï¼Œæœ€ç®€å•çš„ä¸€ç§å°±æ˜¯ä½¿ç”¨ ... æ•°ç»„å±•å¼€ è¯­æ³•ï¼š setArtists( // æ›¿æ¢ state [ // æ˜¯é€šè¿‡ä¼ å…¥ä¸€ä¸ªæ–°æ•°ç»„å®ç°çš„ ...artists, // æ–°æ•°ç»„åŒ…å«åŸæ•°ç»„çš„æ‰€æœ‰å…ƒç´  id: nextId++, name: name // å¹¶åœ¨æœ«å°¾æ·»åŠ äº†ä¸€ä¸ªæ–°çš„å…ƒç´  ]); import useState from react;let nextId = 0;export default function List() const [name, setName] = useState(); const [artists, setArtists] = useState([]); return ( h1æŒ¯å¥‹äººå¿ƒçš„é›•å¡‘å®¶ä»¬ï¼š/h1 input value=name onChange=e = setName(e.target.value) / button onClick=() = setArtists([ ...artists, id: nextId++, name: name ]); æ·»åŠ /button ul artists.map(artist = ( li key=artist.idartist.name/li )) /ul / ); æ•°ç»„å±•å¼€è¿ç®—ç¬¦è¿˜å…è®¸ä½ æŠŠæ–°æ·»åŠ çš„å…ƒç´ æ”¾åœ¨åŸå§‹çš„ ...artists ä¹‹å‰ï¼š setArtists([ id: nextId++, name: name , ...artists // å°†åŸæ•°ç»„ä¸­çš„å…ƒç´ æ”¾åœ¨æœ«å°¾]); è¿™æ ·ä¸€æ¥ï¼Œå±•å¼€æ“ä½œå°±å¯ä»¥å®Œæˆ push() å’Œ unshift() çš„å·¥ä½œï¼Œå°†æ–°å…ƒç´ æ·»åŠ åˆ°æ•°ç»„çš„æœ«å°¾å’Œå¼€å¤´ã€‚ 3.7.3 ä»æ•°ç»„ä¸­åˆ é™¤å…ƒç´ ä»æ•°ç»„ä¸­åˆ é™¤ä¸€ä¸ªå…ƒç´ æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å°†å®ƒè¿‡æ»¤å‡ºå»ã€‚æ¢å¥è¯è¯´ï¼Œä½ éœ€è¦ç”Ÿæˆä¸€ä¸ªä¸åŒ…å«è¯¥å…ƒç´ çš„æ–°æ•°ç»„ã€‚è¿™å¯ä»¥é€šè¿‡ filter æ–¹æ³•å®ç°ï¼Œä¾‹å¦‚ï¼š import useState from react;let initialArtists = [ id: 0, name: Marta Colvin Andrade , id: 1, name: Lamidi Olonade Fakeye, id: 2, name: Louise Nevelson,];export default function List() const [artists, setArtists] = useState( initialArtists ); return ( h1æŒ¯å¥‹äººå¿ƒçš„é›•å¡‘å®¶ä»¬ï¼š/h1 ul artists.map(artist = ( li key=artist.id artist.name button onClick=() = setArtists( artists.filter(a = a.id !== artist.id ) ); åˆ é™¤ /button /li )) /ul / ); ç‚¹å‡»â€œåˆ é™¤â€æŒ‰é’®å‡ æ¬¡ï¼Œå¹¶ä¸”æŸ¥çœ‹æŒ‰é’®å¤„ç†ç‚¹å‡»äº‹ä»¶çš„ä»£ç ã€‚ setArtists( artists.filter(a = a.id !== artist.id)); è¿™é‡Œï¼Œartists.filter(s = s.id !== artist.id) è¡¨ç¤ºâ€œåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œè¯¥æ•°ç»„ç”±é‚£äº› ID ä¸ artists.id ä¸åŒçš„ artists ç»„æˆâ€ã€‚æ¢å¥è¯è¯´ï¼Œæ¯ä¸ª artist çš„â€œåˆ é™¤â€æŒ‰é’®ä¼šæŠŠ é‚£ä¸€ä¸ª artist ä»åŸå§‹æ•°ç»„ä¸­è¿‡æ»¤æ‰ï¼Œå¹¶ä½¿ç”¨è¿‡æ»¤åçš„æ•°ç»„å†æ¬¡è¿›è¡Œæ¸²æŸ“ã€‚æ³¨æ„ï¼Œfilter å¹¶ä¸ä¼šæ”¹å˜åŸå§‹æ•°ç»„ã€‚ 3.7.4 è½¬æ¢æ•°ç»„å¦‚æœä½ æƒ³æ”¹å˜æ•°ç»„ä¸­çš„æŸäº›æˆ–å…¨éƒ¨å…ƒç´ ï¼Œä½ å¯ä»¥ç”¨ map() åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ã€‚ä½ ä¼ å…¥ map çš„å‡½æ•°å†³å®šäº†è¦æ ¹æ®æ¯ä¸ªå…ƒç´ çš„å€¼æˆ–ç´¢å¼•ï¼ˆæˆ–äºŒè€…éƒ½è¦ï¼‰å¯¹å…ƒç´ åšä½•å¤„ç†ã€‚ åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä¸€ä¸ªæ•°ç»„è®°å½•äº†ä¸¤ä¸ªåœ†å½¢å’Œä¸€ä¸ªæ­£æ–¹å½¢çš„åæ ‡ã€‚å½“ä½ ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œä»…æœ‰ä¸¤ä¸ªåœ†å½¢ä¼šå‘ä¸‹ç§»åŠ¨ 100 åƒç´ ã€‚è¿™æ˜¯é€šè¿‡ä½¿ç”¨ map() ç”Ÿæˆä¸€ä¸ªæ–°æ•°ç»„å®ç°çš„ã€‚ import useState from react;let initialShapes = [ id: 0, type: circle, x: 50, y: 100 , id: 1, type: square, x: 150, y: 100 , id: 2, type: circle, x: 250, y: 100 ,];export default function ShapeEditor() const [shapes, setShapes] = useState( initialShapes ); function handleClick() const nextShapes = shapes.map(shape = if (shape.type === square) // ä¸ä½œæ”¹å˜ return shape; else // è¿”å›ä¸€ä¸ªæ–°çš„åœ†å½¢ï¼Œä½ç½®åœ¨ä¸‹æ–¹ 50px å¤„ return ...shape, y: shape.y + 50, ; ); // ä½¿ç”¨æ–°çš„æ•°ç»„è¿›è¡Œé‡æ¸²æŸ“ setShapes(nextShapes); return ( button onClick=handleClick æ‰€æœ‰åœ†å½¢å‘ä¸‹ç§»åŠ¨ï¼ /button shapes.map(shape = ( div key=shape.id style= background: purple, position: absolute, left: shape.x, top: shape.y, borderRadius: shape.type === circle ? 50% : , width: 20, height: 20, / )) / ); 3.7.5 æ›¿æ¢æ•°ç»„ä¸­çš„å…ƒç´ æƒ³è¦æ›¿æ¢æ•°ç»„ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ æ˜¯éå¸¸å¸¸è§çš„ã€‚ç±»ä¼¼ arr[0] = bird è¿™æ ·çš„èµ‹å€¼è¯­å¥ä¼šç›´æ¥ä¿®æ”¹åŸå§‹æ•°ç»„ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¹Ÿåº”è¯¥ä½¿ç”¨ mapã€‚ è¦æ›¿æ¢ä¸€ä¸ªå…ƒç´ ï¼Œè¯·ä½¿ç”¨ map åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ã€‚åœ¨ä½ çš„ map å›è°ƒé‡Œï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å…ƒç´ çš„ç´¢å¼•ã€‚ä½¿ç”¨ç´¢å¼•æ¥åˆ¤æ–­æœ€ç»ˆæ˜¯è¿”å›åŸå§‹çš„å…ƒç´ ï¼ˆå³å›è°ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰è¿˜æ˜¯æ›¿æ¢æˆå…¶ä»–å€¼ï¼š import useState from react;let initialCounters = [ 0, 0, 0];export default function CounterList() const [counters, setCounters] = useState( initialCounters ); function handleIncrementClick(index) const nextCounters = counters.map((c, i) = if (i === index) // é€’å¢è¢«ç‚¹å‡»çš„è®¡æ•°å™¨æ•°å€¼ return c + 1; else // å…¶ä½™éƒ¨åˆ†ä¸å‘ç”Ÿå˜åŒ– return c; ); setCounters(nextCounters); return ( ul counters.map((counter, i) = ( li key=i counter button onClick=() = handleIncrementClick(i); +1/button /li )) /ul ); 3.7.6 å‘æ•°ç»„ä¸­æ’å…¥å…ƒç´ æœ‰æ—¶ï¼Œä½ ä¹Ÿè®¸æƒ³å‘æ•°ç»„ç‰¹å®šä½ç½®æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œè¿™ä¸ªä½ç½®æ—¢ä¸åœ¨æ•°ç»„å¼€å¤´ï¼Œä¹Ÿä¸åœ¨æœ«å°¾ã€‚ä¸ºæ­¤ï¼Œä½ å¯ä»¥å°†æ•°ç»„å±•å¼€è¿ç®—ç¬¦ ... å’Œ slice() æ–¹æ³•ä¸€èµ·ä½¿ç”¨ã€‚slice() æ–¹æ³•è®©ä½ ä»æ•°ç»„ä¸­åˆ‡å‡ºâ€œä¸€ç‰‡â€ã€‚ä¸ºäº†å°†å…ƒç´ æ’å…¥æ•°ç»„ï¼Œä½ éœ€è¦å…ˆå±•å¼€åŸæ•°ç»„åœ¨æ’å…¥ç‚¹ä¹‹å‰çš„åˆ‡ç‰‡ï¼Œç„¶åæ’å…¥æ–°å…ƒç´ ï¼Œæœ€åå±•å¼€åŸæ•°ç»„ä¸­å‰©ä¸‹çš„éƒ¨åˆ†ã€‚ ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæ’å…¥æŒ‰é’®æ€»æ˜¯ä¼šå°†å…ƒç´ æ’å…¥åˆ°æ•°ç»„ä¸­ç´¢å¼•ä¸º 1 çš„ä½ç½®ã€‚ import useState from react;let nextId = 3;const initialArtists = [ id: 0, name: Marta Colvin Andrade , id: 1, name: Lamidi Olonade Fakeye, id: 2, name: Louise Nevelson,];export default function List() const [name, setName] = useState(); const [artists, setArtists] = useState( initialArtists ); function handleClick() const insertAt = 1; // å¯èƒ½æ˜¯ä»»ä½•ç´¢å¼• const nextArtists = [ // æ’å…¥ç‚¹ä¹‹å‰çš„å…ƒç´ ï¼š ...artists.slice(0, insertAt), // æ–°çš„å…ƒç´ ï¼š id: nextId++, name: name , // æ’å…¥ç‚¹ä¹‹åçš„å…ƒç´ ï¼š ...artists.slice(insertAt) ]; setArtists(nextArtists); setName(); return ( h1æŒ¯å¥‹äººå¿ƒçš„é›•å¡‘å®¶ä»¬ï¼š/h1 input value=name onChange=e = setName(e.target.value) / button onClick=handleClick æ’å…¥ /button ul artists.map(artist = ( li key=artist.idartist.name/li )) /ul / ); 3.7.7 å…¶ä»–æ”¹å˜æ•°ç»„çš„æƒ…å†µæ€»ä¼šæœ‰ä¸€äº›äº‹ï¼Œæ˜¯ä½ ä»…ä»…ä¾é å±•å¼€è¿ç®—ç¬¦å’Œ map() æˆ–è€… filter() ç­‰ä¸ä¼šç›´æ¥ä¿®æ”¹åŸå€¼çš„æ–¹æ³•æ‰€æ— æ³•åšåˆ°çš„ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³ç¿»è½¬æ•°ç»„ï¼Œæˆ–æ˜¯å¯¹æ•°ç»„æ’åºã€‚è€Œ JavaScript ä¸­çš„ reverse() å’Œ sort() æ–¹æ³•ä¼šæ”¹å˜åŸæ•°ç»„ï¼Œæ‰€ä»¥ä½ æ— æ³•ç›´æ¥ä½¿ç”¨å®ƒä»¬ã€‚ ç„¶è€Œï¼Œä½ å¯ä»¥å…ˆæ‹·è´è¿™ä¸ªæ•°ç»„ï¼Œå†æ”¹å˜è¿™ä¸ªæ‹·è´åçš„å€¼ã€‚ ä¾‹å¦‚ï¼š import useState from react;const initialList = [ id: 0, title: Big Bellies , id: 1, title: Lunar Landscape , id: 2, title: Terracotta Army ,];export default function List() const [list, setList] = useState(initialList); function handleClick() const nextList = [...list]; nextList.reverse(); setList(nextList); return ( button onClick=handleClick ç¿»è½¬ /button ul list.map(artwork = ( li key=artwork.idartwork.title/li )) /ul / ); åœ¨è¿™æ®µä»£ç ä¸­ï¼Œä½ å…ˆä½¿ç”¨ [...list] å±•å¼€è¿ç®—ç¬¦åˆ›å»ºäº†ä¸€ä»½æ•°ç»„çš„æ‹·è´å€¼ã€‚å½“ä½ æœ‰äº†è¿™ä¸ªæ‹·è´å€¼åï¼Œä½ å°±å¯ä»¥ä½¿ç”¨åƒ nextList.reverse() æˆ– nextList.sort() è¿™æ ·ç›´æ¥ä¿®æ”¹åŸæ•°ç»„çš„æ–¹æ³•ã€‚ä½ ç”šè‡³å¯ä»¥é€šè¿‡ nextList[0] = something è¿™æ ·çš„æ–¹å¼å¯¹æ•°ç»„ä¸­çš„ç‰¹å®šå…ƒç´ è¿›è¡Œèµ‹å€¼ã€‚ ç„¶è€Œï¼Œå³ä½¿ä½ æ‹·è´äº†æ•°ç»„ï¼Œä½ è¿˜æ˜¯ä¸èƒ½ç›´æ¥ä¿®æ”¹å…¶å†…éƒ¨çš„å…ƒç´ ã€‚è¿™æ˜¯å› ä¸ºæ•°ç»„çš„æ‹·è´æ˜¯æµ…æ‹·è´â€”â€”æ–°çš„æ•°ç»„ä¸­ä¾ç„¶ä¿ç•™äº†ä¸åŸå§‹æ•°ç»„ç›¸åŒçš„å…ƒç´ ã€‚å› æ­¤ï¼Œå¦‚æœä½ ä¿®æ”¹äº†æ‹·è´æ•°ç»„å†…éƒ¨çš„æŸä¸ªå¯¹è±¡ï¼Œå…¶å®ä½ æ­£åœ¨ç›´æ¥ä¿®æ”¹å½“å‰çš„ stateã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåƒä¸‹é¢çš„ä»£ç å°±ä¼šå¸¦æ¥é—®é¢˜ã€‚ const nextList = [...list];nextList[0].seen = true; // é—®é¢˜ï¼šç›´æ¥ä¿®æ”¹äº† list[0] çš„å€¼setList(nextList); è™½ç„¶ nextList å’Œ list æ˜¯ä¸¤ä¸ªä¸åŒçš„æ•°ç»„ï¼Œ**nextList[0] å’Œ list[0] å´æŒ‡å‘äº†åŒä¸€ä¸ªå¯¹è±¡**ã€‚å› æ­¤ï¼Œé€šè¿‡æ”¹å˜ nextList[0].seenï¼Œlist[0].seen çš„å€¼ä¹Ÿè¢«æ”¹å˜äº†ã€‚è¿™æ˜¯ä¸€ç§ state çš„ mutation æ“ä½œï¼Œä½ åº”è¯¥é¿å…è¿™ä¹ˆåšï¼ä½ å¯ä»¥ç”¨ç±»ä¼¼äº æ›´æ–°åµŒå¥—çš„ JavaScript å¯¹è±¡ çš„æ–¹å¼è§£å†³è¿™ä¸ªé—®é¢˜â€”â€”æ‹·è´æƒ³è¦ä¿®æ”¹çš„ç‰¹å®šå…ƒç´ ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹å®ƒã€‚ä¸‹é¢æ˜¯å…·ä½“çš„æ“ä½œã€‚ 3.7.8 æ›´æ–°æ•°ç»„å†…éƒ¨çš„å¯¹è±¡å¯¹è±¡å¹¶ä¸æ˜¯ çœŸçš„ ä½äºæ•°ç»„â€œå†…éƒ¨â€ã€‚å¯èƒ½ä»–ä»¬åœ¨ä»£ç ä¸­çœ‹èµ·æ¥åƒæ˜¯åœ¨æ•°ç»„â€œå†…éƒ¨â€ï¼Œä½†å…¶å®æ•°ç»„ä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½æ˜¯è¿™ä¸ªæ•°ç»„â€œæŒ‡å‘â€çš„ä¸€ä¸ªå­˜å‚¨äºå…¶å®ƒä½ç½®çš„å€¼ã€‚è¿™å°±æ˜¯å½“ä½ åœ¨å¤„ç†ç±»ä¼¼ list[0] è¿™æ ·çš„åµŒå¥—å­—æ®µæ—¶éœ€è¦æ ¼å¤–å°å¿ƒçš„åŸå› ã€‚å…¶ä»–äººçš„è‰ºæœ¯å“æ¸…å•å¯èƒ½æŒ‡å‘äº†æ•°ç»„çš„åŒä¸€ä¸ªå…ƒç´ ï¼ å½“ä½ æ›´æ–°ä¸€ä¸ªåµŒå¥—çš„ state æ—¶ï¼Œä½ éœ€è¦ä»æƒ³è¦æ›´æ–°çš„åœ°æ–¹åˆ›å»ºæ‹·è´å€¼ï¼Œä¸€ç›´è¿™æ ·ï¼Œç›´åˆ°é¡¶å±‚ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™è¯¥æ€ä¹ˆåšã€‚ åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä¸¤ä¸ªä¸åŒçš„è‰ºæœ¯å“æ¸…å•æœ‰ç€ç›¸åŒçš„åˆå§‹ stateã€‚ä»–ä»¬æœ¬åº”è¯¥äº’ä¸å½±å“ï¼Œä½†æ˜¯å› ä¸ºä¸€æ¬¡ mutationï¼Œä»–ä»¬çš„ state è¢«æ„å¤–åœ°å…±äº«äº†ï¼Œå‹¾é€‰ä¸€ä¸ªæ¸…å•ä¸­çš„äº‹é¡¹ä¼šå½±å“å¦å¤–ä¸€ä¸ªæ¸…å•ï¼š import useState from react;let nextId = 3;const initialList = [ id: 0, title: Big Bellies, seen: false , id: 1, title: Lunar Landscape, seen: false , id: 2, title: Terracotta Army, seen: true ,];export default function BucketList() const [myList, setMyList] = useState(initialList); const [yourList, setYourList] = useState( initialList ); function handleToggleMyList(artworkId, nextSeen) const myNextList = [...myList]; const artwork = myNextList.find( a = a.id === artworkId ); artwork.seen = nextSeen; setMyList(myNextList); function handleToggleYourList(artworkId, nextSeen) const yourNextList = [...yourList]; const artwork = yourNextList.find( a = a.id === artworkId ); artwork.seen = nextSeen; setYourList(yourNextList); return ( h1è‰ºæœ¯æ„¿æœ›æ¸…å•/h1 h2æˆ‘æƒ³çœ‹çš„è‰ºæœ¯æ¸…å•ï¼š/h2 ItemList artworks=myList onToggle=handleToggleMyList / h2ä½ æƒ³çœ‹çš„è‰ºæœ¯æ¸…å•ï¼š/h2 ItemList artworks=yourList onToggle=handleToggleYourList / / );function ItemList( artworks, onToggle ) return ( ul artworks.map(artwork = ( li key=artwork.id label input type=checkbox checked=artwork.seen onChange=e = onToggle( artwork.id, e.target.checked ); / artwork.title /label /li )) /ul ); é—®é¢˜å‡ºåœ¨ä¸‹é¢è¿™æ®µä»£ç ä¸­: const myNextList = [...myList];const artwork = myNextList.find(a = a.id === artworkId);artwork.seen = nextSeen; // é—®é¢˜ï¼šç›´æ¥ä¿®æ”¹äº†å·²æœ‰çš„å…ƒç´ setMyList(myNextList); è™½ç„¶ myNextList è¿™ä¸ªæ•°ç»„æ˜¯æ–°çš„ï¼Œä½†æ˜¯å…¶å†…éƒ¨çš„å…ƒç´ æœ¬èº«ä¸åŸæ•°ç»„ myList æ˜¯ç›¸åŒçš„ã€‚å› æ­¤ï¼Œä¿®æ”¹ artwork.seenï¼Œå…¶å®æ˜¯åœ¨ä¿®æ”¹åŸå§‹çš„ artwork å¯¹è±¡ã€‚è€Œè¿™ä¸ª artwork å¯¹è±¡ä¹Ÿè¢« yourList ä½¿ç”¨ï¼Œè¿™æ ·å°±å¸¦æ¥äº† bugã€‚è¿™æ ·çš„ bug å¯èƒ½éš¾ä»¥æƒ³åˆ°ï¼Œä½†å¥½åœ¨å¦‚æœä½ é¿å…ç›´æ¥ä¿®æ”¹ stateï¼Œå®ƒä»¬å°±ä¼šæ¶ˆå¤±ã€‚ ä½ å¯ä»¥ä½¿ç”¨ map åœ¨æ²¡æœ‰ mutation çš„å‰æä¸‹å°†ä¸€ä¸ªæ—§çš„å…ƒç´ æ›¿æ¢æˆæ›´æ–°çš„ç‰ˆæœ¬ã€‚ setMyList(myList.map(artwork = if (artwork.id === artworkId) // åˆ›å»ºåŒ…å«å˜æ›´çš„ æ–° å¯¹è±¡ return ...artwork, seen: nextSeen ; else // æ²¡æœ‰å˜æ›´ return artwork; )); æ­¤å¤„çš„ ... æ˜¯ä¸€ä¸ªå¯¹è±¡å±•å¼€è¯­æ³•ï¼Œè¢«ç”¨æ¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ‹·è´. é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ²¡æœ‰ä»»ä½•ç°æœ‰çš„ state ä¸­çš„å…ƒç´ ä¼šè¢«æ”¹å˜ï¼Œbug ä¹Ÿå°±è¢«ä¿®å¤äº†ã€‚ import useState from react;let nextId = 3;const initialList = [ id: 0, title: Big Bellies, seen: false , id: 1, title: Lunar Landscape, seen: false , id: 2, title: Terracotta Army, seen: true ,];export default function BucketList() const [myList, setMyList] = useState(initialList); const [yourList, setYourList] = useState( initialList ); function handleToggleMyList(artworkId, nextSeen) setMyList(myList.map(artwork = if (artwork.id === artworkId) // åˆ›å»ºåŒ…å«å˜æ›´çš„*æ–°*å¯¹è±¡ return ...artwork, seen: nextSeen ; else // æ²¡æœ‰å˜æ›´ return artwork; )); function handleToggleYourList(artworkId, nextSeen) setYourList(yourList.map(artwork = if (artwork.id === artworkId) // åˆ›å»ºåŒ…å«å˜æ›´çš„*æ–°*å¯¹è±¡ return ...artwork, seen: nextSeen ; else // æ²¡æœ‰å˜æ›´ return artwork; )); return ( h1è‰ºæœ¯æ„¿æœ›æ¸…å•/h1 h2æˆ‘æƒ³çœ‹çš„è‰ºæœ¯æ¸…å•ï¼š/h2 ItemList artworks=myList onToggle=handleToggleMyList / h2ä½ æƒ³çœ‹çš„è‰ºæœ¯æ¸…å•ï¼š/h2 ItemList artworks=yourList onToggle=handleToggleYourList / / );function ItemList( artworks, onToggle ) return ( ul artworks.map(artwork = ( li key=artwork.id label input type=checkbox checked=artwork.seen onChange=e = onToggle( artwork.id, e.target.checked ); / artwork.title /label /li )) /ul ); é€šå¸¸æ¥è®²ï¼Œä½ åº”è¯¥åªç›´æ¥ä¿®æ”¹ä½ åˆšåˆšåˆ›å»ºçš„å¯¹è±¡ã€‚å¦‚æœä½ æ­£åœ¨æ’å…¥ä¸€ä¸ªæ–°çš„ artworkï¼Œä½ å¯ä»¥ä¿®æ”¹å®ƒï¼Œä½†æ˜¯å¦‚æœä½ æƒ³è¦æ”¹å˜çš„æ˜¯ state ä¸­å·²ç»å­˜åœ¨çš„ä¸œè¥¿ï¼Œä½ å°±éœ€è¦å…ˆæ‹·è´ä¸€ä»½äº†ã€‚ 3.7.9 ä½¿ç”¨ Immer ç¼–å†™ç®€æ´çš„æ›´æ–°é€»è¾‘åœ¨æ²¡æœ‰ mutation çš„å‰æä¸‹æ›´æ–°åµŒå¥—æ•°ç»„å¯èƒ½ä¼šå˜å¾—æœ‰ç‚¹é‡å¤ã€‚å°±åƒå¯¹å¯¹è±¡ä¸€æ ·: é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥ä¸éœ€è¦æ›´æ–°å¤„äºéå¸¸æ·±å±‚çº§çš„ state ã€‚å¦‚æœä½ æœ‰æ­¤ç±»éœ€æ±‚ï¼Œä½ æˆ–è®¸éœ€è¦è°ƒæ•´ä¸€ä¸‹æ•°æ®çš„ç»“æ„ï¼Œè®©æ•°æ®å˜å¾—æ‰å¹³ä¸€äº›ã€‚ å¦‚æœä½ ä¸æƒ³æ”¹å˜ state çš„æ•°æ®ç»“æ„ï¼Œä½ ä¹Ÿè®¸ä¼šæ›´å–œæ¬¢ä½¿ç”¨ Immer ï¼Œå®ƒè®©ä½ å¯ä»¥ç»§ç»­ä½¿ç”¨æ–¹ä¾¿çš„ï¼Œä½†ä¼šç›´æ¥ä¿®æ”¹åŸå€¼çš„è¯­æ³•ï¼Œå¹¶è´Ÿè´£ä¸ºä½ ç”Ÿæˆæ‹·è´å€¼ã€‚ ä¸‹é¢æ˜¯æˆ‘ä»¬ç”¨ Immer æ¥é‡å†™çš„è‰ºæœ¯æ„¿æœ›æ¸…å•çš„ä¾‹å­ï¼š import useState from react;import useImmer from use-immer;let nextId = 3;const initialList = [ id: 0, title: Big Bellies, seen: false , id: 1, title: Lunar Landscape, seen: false , id: 2, title: Terracotta Army, seen: true ,];export default function BucketList() const [myList, updateMyList] = useImmer( initialList ); const [yourList, updateYourList] = useImmer( initialList ); function handleToggleMyList(id, nextSeen) updateMyList(draft = const artwork = draft.find(a = a.id === id ); artwork.seen = nextSeen; ); function handleToggleYourList(artworkId, nextSeen) updateYourList(draft = const artwork = draft.find(a = a.id === artworkId ); artwork.seen = nextSeen; ); return ( h1è‰ºæœ¯æ„¿æœ›æ¸…å•/h1 h2æˆ‘æƒ³çœ‹çš„è‰ºæœ¯æ¸…å•ï¼š/h2 ItemList artworks=myList onToggle=handleToggleMyList / h2ä½ æƒ³çœ‹çš„è‰ºæœ¯æ¸…å•ï¼š/h2 ItemList artworks=yourList onToggle=handleToggleYourList / / );function ItemList( artworks, onToggle ) return ( ul artworks.map(artwork = ( li key=artwork.id label input type=checkbox checked=artwork.seen onChange=e = onToggle( artwork.id, e.target.checked ); / artwork.title /label /li )) /ul ); è¯·æ³¨æ„å½“ä½¿ç”¨ Immer æ—¶ï¼Œç±»ä¼¼ artwork.seen = nextSeen è¿™ç§ä¼šäº§ç”Ÿ mutation çš„è¯­æ³•ä¸ä¼šå†æœ‰ä»»ä½•é—®é¢˜äº†ï¼š updateMyTodos(draft = const artwork = draft.find(a = a.id === artworkId); artwork.seen = nextSeen;); è¿™æ˜¯å› ä¸ºä½ å¹¶ä¸æ˜¯åœ¨ç›´æ¥ä¿®æ”¹åŸå§‹çš„ stateï¼Œè€Œæ˜¯åœ¨ä¿®æ”¹ Immer æä¾›çš„ä¸€ä¸ªç‰¹æ®Šçš„ draft å¯¹è±¡ã€‚åŒç†ï¼Œä½ ä¹Ÿå¯ä»¥ä¸º draft çš„å†…å®¹ä½¿ç”¨ push() å’Œ pop() è¿™äº›ä¼šç›´æ¥ä¿®æ”¹åŸå€¼çš„æ–¹æ³•ã€‚ åœ¨å¹•åï¼ŒImmer æ€»æ˜¯ä¼šæ ¹æ®ä½ å¯¹ draft çš„ä¿®æ”¹æ¥ä»å¤´å¼€å§‹æ„å»ºä¸‹ä¸€ä¸ª stateã€‚è¿™ä½¿å¾—ä½ çš„äº‹ä»¶å¤„ç†ç¨‹åºéå¸¸çš„ç®€æ´ï¼ŒåŒæ—¶ä¹Ÿä¸ä¼šç›´æ¥ä¿®æ”¹ stateã€‚ 3.7.10 æ‘˜è¦ ä½ å¯ä»¥æŠŠæ•°ç»„æ”¾å…¥ state ä¸­ï¼Œä½†ä½ ä¸åº”è¯¥ç›´æ¥ä¿®æ”¹å®ƒã€‚ ä¸è¦ç›´æ¥ä¿®æ”¹æ•°ç»„ï¼Œè€Œæ˜¯åˆ›å»ºå®ƒçš„ä¸€ä»½ æ–°çš„ æ‹·è´ï¼Œç„¶åä½¿ç”¨æ–°çš„æ•°ç»„æ¥æ›´æ–°å®ƒçš„çŠ¶æ€ã€‚ ä½ å¯ä»¥ä½¿ç”¨ [...arr, newItem] è¿™æ ·çš„æ•°ç»„å±•å¼€è¯­æ³•æ¥å‘æ•°ç»„ä¸­æ·»åŠ å…ƒç´ ã€‚ ä½ å¯ä»¥ä½¿ç”¨ filter() å’Œ map() æ¥åˆ›å»ºä¸€ä¸ªç»è¿‡è¿‡æ»¤æˆ–è€…å˜æ¢çš„æ•°ç»„ã€‚ ä½ å¯ä»¥ä½¿ç”¨ Immer æ¥ä¿æŒä»£ç ç®€æ´ã€‚","tags":["React"],"categories":["å‰ç«¯"]},{"title":"rpcåŸºç¡€","path":"/2024/09/06/rpcåŸºç¡€/","content":"1. ç®€ä»‹1.1 æ¦‚è¿°RPCï¼ˆRemote Procedure Callï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰æ˜¯ä¸€ç§ç”¨äºå®ç°ä¸åŒè®¡ç®—æœºæˆ–è¿›ç¨‹ä¹‹é—´é€šä¿¡çš„åè®®æˆ–æœºåˆ¶ï¼Œä½¿å¾—ç¨‹åºå¯ä»¥åƒè°ƒç”¨æœ¬åœ°å‡½æ•°ä¸€æ ·è°ƒç”¨è¿œç¨‹è®¡ç®—æœºä¸Šçš„å‡½æ•°ã€‚RPC çš„æ ¸å¿ƒç›®çš„æ˜¯ä½¿å¾—åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç»„ä»¶ä¹‹é—´çš„äº¤äº’å˜å¾—ç®€æ´å’Œé€æ˜ã€‚ æ ¸å¿ƒæ¦‚å¿µ å®¢æˆ·ç«¯: å‘èµ· RPC è°ƒç”¨çš„ç¨‹åºæˆ–åº”ç”¨ã€‚å®ƒæ„é€ ä¸€ä¸ªè¯·æ±‚ï¼Œè°ƒç”¨ä¸€ä¸ªè¿œç¨‹æœåŠ¡çš„å‡½æ•°ã€‚ æœåŠ¡å™¨ç«¯: æä¾›è¿œç¨‹æœåŠ¡çš„ç¨‹åºæˆ–åº”ç”¨ã€‚å®ƒæ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œæ‰§è¡Œç›¸åº”çš„å‡½æ•°ï¼Œå¹¶è¿”å›ç»“æœã€‚ ä»£ç†ï¼ˆStubï¼‰: å®¢æˆ·ç«¯ä»£ç†ï¼ˆæˆ–ç§°ä¸ºå®¢æˆ·ç«¯å­˜æ ¹ï¼‰å’ŒæœåŠ¡å™¨ç«¯ä»£ç†ï¼ˆæˆ–ç§°ä¸ºæœåŠ¡å™¨ç«¯å­˜æ ¹ï¼‰æ˜¯åˆ†åˆ«åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ç”Ÿæˆçš„ä»£ç ï¼Œç”¨äºå¤„ç†è°ƒç”¨çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€æ•°æ®ä¼ è¾“ç­‰ä»»åŠ¡ã€‚å®¢æˆ·ç«¯ä»£ç†å°†è°ƒç”¨è¯·æ±‚è½¬æ¢ä¸ºç½‘ç»œæ¶ˆæ¯ï¼ŒæœåŠ¡å™¨ç«¯ä»£ç†åˆ™å°†ç½‘ç»œæ¶ˆæ¯è½¬æ¢ä¸ºå®é™…çš„å‡½æ•°è°ƒç”¨ã€‚ é€šä¿¡åè®®: å®šä¹‰å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’æ ¼å¼å’Œæ–¹å¼ã€‚å¸¸è§çš„é€šä¿¡åè®®åŒ…æ‹¬ HTTPã€gRPCã€JSON-RPC ç­‰ã€‚ åœ¨è¿œç¨‹è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„å‡½æ•°ä½“æ˜¯åœ¨è¿œç¨‹çš„æœºå™¨ä¸Šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œaddæ˜¯åœ¨å¦ä¸€ä¸ªè¿›ç¨‹ä¸­æ‰§è¡Œçš„ã€‚è¿™å°±å¸¦æ¥äº†å‡ ä¸ªæ–°é—®é¢˜ï¼š Call IDæ˜ å°„ã€‚æˆ‘ä»¬æ€ä¹ˆå‘Šè¯‰è¿œç¨‹æœºå™¨æˆ‘ä»¬è¦è°ƒç”¨addï¼Œè€Œä¸æ˜¯subæˆ–è€…Fooå‘¢ï¼Ÿåœ¨æœ¬åœ°è°ƒç”¨ä¸­ï¼Œå‡½æ•°ä½“æ˜¯ç›´æ¥é€šè¿‡å‡½æ•°æŒ‡é’ˆæ¥æŒ‡å®šçš„ï¼Œæˆ‘ä»¬è°ƒç”¨addï¼Œç¼–è¯‘å™¨å°±è‡ªåŠ¨å¸®æˆ‘ä»¬è°ƒç”¨å®ƒç›¸åº”çš„å‡½æ•°æŒ‡é’ˆã€‚ä½†æ˜¯åœ¨è¿œç¨‹è°ƒç”¨ä¸­ï¼Œå‡½æ•°æŒ‡é’ˆæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºä¸¤ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ã€‚æ‰€ä»¥ï¼Œåœ¨RPCä¸­ï¼Œæ‰€æœ‰çš„å‡½æ•°éƒ½å¿…é¡»æœ‰è‡ªå·±çš„ä¸€ä¸ªIDã€‚è¿™ä¸ªIDåœ¨æ‰€æœ‰è¿›ç¨‹ä¸­éƒ½æ˜¯å”¯ä¸€ç¡®å®šçš„ã€‚å®¢æˆ·ç«¯åœ¨åšè¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ—¶ï¼Œå¿…é¡»é™„ä¸Šè¿™ä¸ªIDã€‚ç„¶åæˆ‘ä»¬è¿˜éœ€è¦åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åˆ†åˆ«ç»´æŠ¤ä¸€ä¸ª {å‡½æ•° â€“ Call ID} çš„å¯¹åº”è¡¨ã€‚ä¸¤è€…çš„è¡¨ä¸ä¸€å®šéœ€è¦å®Œå…¨ç›¸åŒï¼Œä½†ç›¸åŒçš„å‡½æ•°å¯¹åº”çš„Call IDå¿…é¡»ç›¸åŒã€‚å½“å®¢æˆ·ç«¯éœ€è¦è¿›è¡Œè¿œç¨‹è°ƒç”¨æ—¶ï¼Œå®ƒå°±æŸ¥ä¸€ä¸‹è¿™ä¸ªè¡¨ï¼Œæ‰¾å‡ºç›¸åº”çš„Call IDï¼Œç„¶åæŠŠå®ƒä¼ ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä¹Ÿé€šè¿‡æŸ¥è¡¨ï¼Œæ¥ç¡®å®šå®¢æˆ·ç«¯éœ€è¦è°ƒç”¨çš„å‡½æ•°ï¼Œç„¶åæ‰§è¡Œç›¸åº”å‡½æ•°çš„ä»£ç ã€‚ åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚å®¢æˆ·ç«¯æ€ä¹ˆæŠŠå‚æ•°å€¼ä¼ ç»™è¿œç¨‹çš„å‡½æ•°å‘¢ï¼Ÿåœ¨æœ¬åœ°è°ƒç”¨ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠå‚æ•°å‹åˆ°æ ˆé‡Œï¼Œç„¶åè®©å‡½æ•°è‡ªå·±å»æ ˆé‡Œè¯»å°±è¡Œã€‚ä½†æ˜¯åœ¨è¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ—¶ï¼Œå®¢æˆ·ç«¯è·ŸæœåŠ¡ç«¯æ˜¯ä¸åŒçš„è¿›ç¨‹ï¼Œä¸èƒ½é€šè¿‡å†…å­˜æ¥ä¼ é€’å‚æ•°ã€‚ç”šè‡³æœ‰æ—¶å€™å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä½¿ç”¨çš„éƒ½ä¸æ˜¯åŒä¸€ç§è¯­è¨€ï¼ˆæ¯”å¦‚æœåŠ¡ç«¯ç”¨C++ï¼Œå®¢æˆ·ç«¯ç”¨Javaæˆ–è€…Pythonï¼‰ã€‚è¿™æ—¶å€™å°±éœ€è¦å®¢æˆ·ç«¯æŠŠå‚æ•°å…ˆè½¬æˆä¸€ä¸ªå­—èŠ‚æµï¼Œä¼ ç»™æœåŠ¡ç«¯åï¼Œå†æŠŠå­—èŠ‚æµè½¬æˆè‡ªå·±èƒ½è¯»å–çš„æ ¼å¼ã€‚è¿™ä¸ªè¿‡ç¨‹å«åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚åŒç†ï¼Œä»æœåŠ¡ç«¯è¿”å›çš„å€¼ä¹Ÿéœ€è¦åºåˆ—åŒ–ååºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚ ç½‘ç»œä¼ è¾“ã€‚è¿œç¨‹è°ƒç”¨å¾€å¾€ç”¨åœ¨ç½‘ç»œä¸Šï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ˜¯é€šè¿‡ç½‘ç»œè¿æ¥çš„ã€‚æ‰€æœ‰çš„æ•°æ®éƒ½éœ€è¦é€šè¿‡ç½‘ç»œä¼ è¾“ï¼Œå› æ­¤å°±éœ€è¦æœ‰ä¸€ä¸ªç½‘ç»œä¼ è¾“å±‚ã€‚ç½‘ç»œä¼ è¾“å±‚éœ€è¦æŠŠCall IDå’Œåºåˆ—åŒ–åçš„å‚æ•°å­—èŠ‚æµä¼ ç»™æœåŠ¡ç«¯ï¼Œç„¶åå†æŠŠåºåˆ—åŒ–åçš„è°ƒç”¨ç»“æœä¼ å›å®¢æˆ·ç«¯ã€‚åªè¦èƒ½å®Œæˆè¿™ä¸¤è€…çš„ï¼Œéƒ½å¯ä»¥ä½œä¸ºä¼ è¾“å±‚ä½¿ç”¨ã€‚å› æ­¤ï¼Œå®ƒæ‰€ä½¿ç”¨çš„åè®®å…¶å®æ˜¯ä¸é™çš„ï¼Œèƒ½å®Œæˆä¼ è¾“å°±è¡Œã€‚å°½ç®¡å¤§éƒ¨åˆ†RPCæ¡†æ¶éƒ½ä½¿ç”¨TCPåè®®ï¼Œä½†å…¶å®UDPä¹Ÿå¯ä»¥ï¼Œè€ŒgRPCå¹²è„†å°±ç”¨äº†HTTP2ã€‚Javaçš„Nettyä¹Ÿå±äºè¿™å±‚çš„ä¸œè¥¿ã€‚ è§£å†³äº†ä¸Šé¢ä¸‰ä¸ªæœºåˆ¶ï¼Œå°±èƒ½å®ç°RPCäº†ï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š clientç«¯è§£å†³çš„é—®é¢˜ï¼š 1. å°†è¿™ä¸ªè°ƒç”¨æ˜ å°„ä¸ºCall IDã€‚è¿™é‡Œå‡è®¾ç”¨æœ€ç®€å•çš„å­—ç¬¦ä¸²å½“Call IDçš„æ–¹æ³•2. å°†Call IDï¼Œaå’Œbåºåˆ—åŒ–ã€‚å¯ä»¥ç›´æ¥å°†å®ƒä»¬çš„å€¼ä»¥äºŒè¿›åˆ¶å½¢å¼æ‰“åŒ…3. æŠŠ2ä¸­å¾—åˆ°çš„æ•°æ®åŒ…å‘é€ç»™ServerAddrï¼Œè¿™éœ€è¦ä½¿ç”¨ç½‘ç»œä¼ è¾“å±‚4. ç­‰å¾…æœåŠ¡å™¨è¿”å›ç»“æœ4. å¦‚æœæœåŠ¡å™¨è°ƒç”¨æˆåŠŸï¼Œé‚£ä¹ˆå°±å°†ç»“æœååºåˆ—åŒ–ï¼Œå¹¶èµ‹ç»™total serverç«¯è§£å†³çš„é—®é¢˜ 1. åœ¨æœ¬åœ°ç»´æŠ¤ä¸€ä¸ªCall IDåˆ°å‡½æ•°æŒ‡é’ˆçš„æ˜ å°„call_id_mapï¼Œå¯ä»¥ç”¨dictå®Œæˆ2. ç­‰å¾…è¯·æ±‚ï¼ŒåŒ…æ‹¬å¤šçº¿ç¨‹çš„å¹¶å‘å¤„ç†èƒ½åŠ›3. å¾—åˆ°ä¸€ä¸ªè¯·æ±‚åï¼Œå°†å…¶æ•°æ®åŒ…ååºåˆ—åŒ–ï¼Œå¾—åˆ°Call ID4. é€šè¿‡åœ¨call_id_mapä¸­æŸ¥æ‰¾ï¼Œå¾—åˆ°ç›¸åº”çš„å‡½æ•°æŒ‡é’ˆ5. å°†aå’Œrbååºåˆ—åŒ–åï¼Œåœ¨æœ¬åœ°è°ƒç”¨addå‡½æ•°ï¼Œå¾—åˆ°ç»“æœ6. å°†ç»“æœåºåˆ—åŒ–åé€šè¿‡ç½‘ç»œè¿”å›ç»™Client æ‰€ä»¥è¦å®ç°ä¸€ä¸ªRPCæ¡†æ¶ï¼Œå…¶å®åªéœ€è¦æŒ‰ä»¥ä¸Šæµç¨‹å®ç°å°±åŸºæœ¬å®Œæˆäº†ã€‚ å…¶ä¸­ï¼š Call IDæ˜ å°„å¯ä»¥ç›´æ¥ä½¿ç”¨å‡½æ•°å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ•´æ•°IDã€‚æ˜ å°„è¡¨ä¸€èˆ¬å°±æ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨ã€‚ åºåˆ—åŒ–ååºåˆ—åŒ–å¯ä»¥è‡ªå·±å†™ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Protobufæˆ–è€…FlatBuffersä¹‹ç±»çš„ã€‚ ç½‘ç»œä¼ è¾“åº“å¯ä»¥è‡ªå·±å†™socketï¼Œæˆ–è€…ç”¨asioï¼ŒZeroMQï¼ŒNettyä¹‹ç±»ã€‚ å®é™…ä¸ŠçœŸæ­£çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œé™¤äº†ä¸Šé¢çš„åŸºæœ¬åŠŸèƒ½ä»¥å¤–è¿˜éœ€è¦æ›´å¤šçš„ç»†èŠ‚ï¼šç½‘ç»œé”™è¯¯ã€æµé‡æ§åˆ¶ã€è¶…æ—¶å’Œé‡è¯•ç­‰ã€‚ 1.2 rpcå¼€å‘è¦ç´ åˆ†æ1.2.1 rpcå¼€å‘çš„å››å¤§è¦ç´ RPCæŠ€æœ¯åœ¨æ¶æ„è®¾è®¡ä¸Šæœ‰å››éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼šå®¢æˆ·ç«¯ã€å®¢æˆ·ç«¯å­˜æ ¹ã€æœåŠ¡ç«¯ã€æœåŠ¡ç«¯å­˜æ ¹ã€‚ å®¢æˆ·ç«¯(Client)ï¼šæœåŠ¡è°ƒç”¨å‘èµ·æ–¹ï¼Œä¹Ÿç§°ä¸ºæœåŠ¡æ¶ˆè´¹è€…ã€‚ å®¢æˆ·ç«¯å­˜æ ¹(Client Stub)ï¼šè¯¥ç¨‹åºè¿è¡Œåœ¨å®¢æˆ·ç«¯æ‰€åœ¨çš„è®¡ç®—æœºæœºå™¨ä¸Šï¼Œä¸»è¦ç”¨æ¥å­˜å‚¨è¦è°ƒç”¨çš„æœåŠ¡å™¨çš„åœ°å€ï¼Œå¦å¤–ï¼Œè¯¥ç¨‹åºè¿˜è´Ÿè´£å°†å®¢æˆ·ç«¯è¯·æ±‚è¿œç«¯æœåŠ¡å™¨ç¨‹åºçš„æ•°æ®ä¿¡æ¯æ‰“åŒ…æˆæ•°æ®åŒ…ï¼Œé€šè¿‡ç½‘ç»œå‘é€ç»™æœåŠ¡ç«¯Stubç¨‹åºï¼›å…¶æ¬¡ï¼Œè¿˜è¦æ¥æ”¶æœåŠ¡ç«¯Stubç¨‹åºå‘é€çš„è°ƒç”¨ç»“æœæ•°æ®åŒ…ï¼Œå¹¶è§£æè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ æœåŠ¡ç«¯(Server)ï¼šè¿œç«¯çš„è®¡ç®—æœºæœºå™¨ä¸Šè¿è¡Œçš„ç¨‹åºï¼Œå…¶ä¸­æœ‰å®¢æˆ·ç«¯è¦è°ƒç”¨çš„æ–¹æ³•ã€‚ æœåŠ¡ç«¯å­˜æ ¹(Server Stub)ï¼šæ¥æ”¶å®¢æˆ·Stubç¨‹åºé€šè¿‡ç½‘ç»œå‘é€çš„è¯·æ±‚æ¶ˆæ¯æ•°æ®åŒ…ï¼Œå¹¶è°ƒç”¨æœåŠ¡ç«¯ä¸­çœŸæ­£çš„ç¨‹åºåŠŸèƒ½æ–¹æ³•ï¼Œå®ŒæˆåŠŸèƒ½è°ƒç”¨ï¼›å…¶æ¬¡ï¼Œå°†æœåŠ¡ç«¯æ‰§è¡Œè°ƒç”¨çš„ç»“æœè¿›è¡Œæ•°æ®å¤„ç†æ‰“åŒ…å‘é€ç»™å®¢æˆ·ç«¯Stubç¨‹åºã€‚ äº†è§£å®Œäº†RPCæŠ€æœ¯çš„ç»„æˆç»“æ„æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…·ä½“æ˜¯å¦‚ä½•å®ç°å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„è°ƒç”¨çš„ã€‚å®é™…ä¸Šï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨ç½‘ç»œä¸­çš„ä»»æ„ä¸¤å°è®¡ç®—æœºä¸Šå®ç°è¿œç¨‹è°ƒç”¨è¿‡ç¨‹ï¼Œè¦è§£å†³å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚ï¼š ä¸¤å°ç‰©ç†æœºå™¨åœ¨ç½‘ç»œä¸­è¦å»ºç«‹ç¨³å®šå¯é çš„é€šä¿¡è¿æ¥ã€‚ ä¸¤å°æœåŠ¡å™¨çš„é€šä¿¡åè®®çš„å®šä¹‰é—®é¢˜ï¼Œå³ä¸¤å°æœåŠ¡å™¨ä¸Šçš„ç¨‹åºå¦‚ä½•è¯†åˆ«å¯¹æ–¹çš„è¯·æ±‚å’Œè¿”å›ç»“æœã€‚ä¹Ÿå°±æ˜¯è¯´ä¸¤å°è®¡ç®—æœºå¿…é¡»éƒ½èƒ½å¤Ÿè¯†åˆ«å¯¹æ–¹å‘æ¥çš„ä¿¡æ¯ï¼Œå¹¶ä¸”èƒ½å¤Ÿè¯†åˆ«å‡ºå…¶ä¸­çš„è¯·æ±‚å«ä¹‰å’Œè¿”å›å«ä¹‰ï¼Œç„¶åæ‰èƒ½è¿›è¡Œå¤„ç†ã€‚è¿™å…¶å®å°±æ˜¯é€šä¿¡åè®®æ‰€è¦å®Œæˆçš„å·¥ä½œã€‚ åœ¨ä¸Šè¿°å›¾ä¸­ï¼Œé€šè¿‡1-10çš„æ­¥éª¤å›¾è§£çš„å½¢å¼ï¼Œè¯´æ˜äº†RPCæ¯ä¸€æ­¥çš„è°ƒç”¨è¿‡ç¨‹ã€‚å…·ä½“æè¿°ä¸ºï¼š 1ã€å®¢æˆ·ç«¯æƒ³è¦å‘èµ·ä¸€ä¸ªè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œé¦–å…ˆé€šè¿‡è°ƒç”¨æœ¬åœ°å®¢æˆ·ç«¯Stubç¨‹åºçš„æ–¹å¼è°ƒç”¨æƒ³è¦ä½¿ç”¨çš„åŠŸèƒ½æ–¹æ³•åï¼› 2ã€å®¢æˆ·ç«¯Stubç¨‹åºæ¥æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„åŠŸèƒ½è°ƒç”¨è¯·æ±‚ï¼Œå°†å®¢æˆ·ç«¯è¯·æ±‚è°ƒç”¨çš„æ–¹æ³•åï¼Œæºå¸¦çš„å‚æ•°ç­‰ä¿¡æ¯åšåºåˆ—åŒ–æ“ä½œï¼Œå¹¶æ‰“åŒ…æˆæ•°æ®åŒ…ã€‚ 3ã€å®¢æˆ·ç«¯StubæŸ¥æ‰¾åˆ°è¿œç¨‹æœåŠ¡å™¨ç¨‹åºçš„IPåœ°å€ï¼Œè°ƒç”¨Socketé€šä¿¡åè®®ï¼Œé€šè¿‡ç½‘ç»œå‘é€ç»™æœåŠ¡ç«¯ã€‚ 4ã€æœåŠ¡ç«¯Stubç¨‹åºæ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ•°æ®åŒ…ä¿¡æ¯ï¼Œå¹¶é€šè¿‡çº¦å®šå¥½çš„åè®®å°†æ•°æ®è¿›è¡Œååºåˆ—åŒ–ï¼Œå¾—åˆ°è¯·æ±‚çš„æ–¹æ³•åå’Œè¯·æ±‚å‚æ•°ç­‰ä¿¡æ¯ã€‚ 5ã€æœåŠ¡ç«¯Stubç¨‹åºå‡†å¤‡ç›¸å…³æ•°æ®ï¼Œè°ƒç”¨æœ¬åœ°Serverå¯¹åº”çš„åŠŸèƒ½æ–¹æ³•è¿›è¡Œï¼Œå¹¶ä¼ å…¥ç›¸åº”çš„å‚æ•°ï¼Œè¿›è¡Œä¸šåŠ¡å¤„ç†ã€‚ 6ã€æœåŠ¡ç«¯ç¨‹åºæ ¹æ®å·²æœ‰ä¸šåŠ¡é€»è¾‘æ‰§è¡Œè°ƒç”¨è¿‡ç¨‹ï¼Œå¾…ä¸šåŠ¡æ‰§è¡Œç»“æŸï¼Œå°†æ‰§è¡Œç»“æœè¿”å›ç»™æœåŠ¡ç«¯Stubç¨‹åºã€‚ 7ã€æœåŠ¡ç«¯Stubç¨‹åºå°†ç¨‹åºè°ƒç”¨ç»“æœæŒ‰ç…§çº¦å®šçš„åè®®è¿›è¡Œåºåˆ—åŒ–ï¼Œå¹¶é€šè¿‡ç½‘ç»œå‘é€å›å®¢æˆ·ç«¯Stubç¨‹åºã€‚ 8ã€å®¢æˆ·ç«¯Stubç¨‹åºæ¥æ”¶åˆ°æœåŠ¡ç«¯Stubå‘é€çš„è¿”å›æ•°æ®ï¼Œå¯¹æ•°æ®è¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼Œå¹¶å°†è°ƒç”¨è¿”å›çš„æ•°æ®ä¼ é€’ç»™å®¢æˆ·ç«¯è¯·æ±‚å‘èµ·è€…ã€‚ 9ã€å®¢æˆ·ç«¯è¯·æ±‚å‘èµ·è€…å¾—åˆ°è°ƒç”¨ç»“æœï¼Œæ•´ä¸ªRPCè°ƒç”¨è¿‡ç¨‹ç»“æŸã€‚ 1.2.2 rpcéœ€è¦ä½¿ç”¨åˆ°çš„æœ¯è¯­é€šè¿‡ä¸Šæ–‡ä¸€ç³»åˆ—çš„æ–‡å­—æè¿°å’Œè®²è§£ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†RPCçš„ç”±æ¥å’ŒRPCæ•´ä¸ªè°ƒç”¨è¿‡ç¨‹ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°RPCæ˜¯ä¸€ç³»åˆ—æ“ä½œçš„é›†åˆï¼Œå…¶ä¸­æ¶‰åŠåˆ°å¾ˆå¤šå¯¹æ•°æ®çš„æ“ä½œï¼Œä»¥åŠç½‘ç»œé€šä¿¡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯¹RPCä¸­æ¶‰åŠåˆ°çš„æŠ€æœ¯åšä¸€ä¸ªæ€»ç»“å’Œåˆ†æï¼š 1ã€åŠ¨æ€ä»£ç†æŠ€æœ¯ï¼š ä¸Šæ–‡ä¸­æˆ‘ä»¬æåˆ°çš„Client Stubå’ŒSever Stubç¨‹åºï¼Œåœ¨å…·ä½“çš„ç¼–ç å’Œå¼€å‘å®è·µè¿‡ç¨‹ä¸­ï¼Œéƒ½æ˜¯ä½¿ç”¨åŠ¨æ€ä»£ç†æŠ€æœ¯è‡ªåŠ¨ç”Ÿæˆçš„ä¸€æ®µç¨‹åºã€‚ 2ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼š åœ¨RPCè°ƒç”¨çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•°æ®éœ€è¦åœ¨ä¸€å°æœºå™¨ä¸Šä¼ è¾“åˆ°å¦å¤–ä¸€å°æœºå™¨ä¸Šã€‚åœ¨äº’è”ç½‘ä¸Šï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯ä»¥å­—èŠ‚çš„å½¢å¼è¿›è¡Œä¼ è¾“çš„ã€‚è€Œæˆ‘ä»¬åœ¨ç¼–ç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€éƒ½æ˜¯ä½¿ç”¨æ•°æ®å¯¹è±¡ï¼Œå› æ­¤æƒ³è¦åœ¨ç½‘ç»œä¸Šå°†æ•°æ®å¯¹è±¡å’Œç›¸å…³å˜é‡è¿›è¡Œä¼ è¾“ï¼Œå°±éœ€è¦å¯¹æ•°æ®å¯¹è±¡åšåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ“ä½œã€‚ åºåˆ—åŒ–ï¼šæŠŠå¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚åºåˆ—çš„è¿‡ç¨‹ç§°ä¸ºå¯¹è±¡çš„åºåˆ—åŒ–ï¼Œä¹Ÿå°±æ˜¯ç¼–ç çš„è¿‡ç¨‹ã€‚ ååºåˆ—åŒ–ï¼šæŠŠå­—èŠ‚åºåˆ—æ¢å¤ä¸ºå¯¹è±¡çš„è¿‡ç¨‹ç§°ä¸ºå¯¹è±¡çš„ååºåˆ—åŒ–ï¼Œä¹Ÿå°±æ˜¯è§£ç çš„è¿‡ç¨‹ã€‚ æˆ‘ä»¬å¸¸è§çš„Json,XMLç­‰ç›¸å…³æ¡†æ¶éƒ½å¯ä»¥å¯¹æ•°æ®åšåºåˆ—åŒ–å’Œååºåˆ—åŒ–ç¼–è§£ç æ“ä½œã€‚åé¢æˆ‘ä»¬è¦å­¦ä¹ çš„Protobufåè®®ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§æ•°æ®ç¼–è§£ç çš„åè®®ï¼Œåœ¨RPCæ¡†æ¶ä¸­ä½¿ç”¨çš„æ›´å¹¿æ³›ã€‚ 2. go rpc å¼€å‘Goè¯­è¨€çš„RPCåŒ…çš„è·¯å¾„ä¸ºnetrpcï¼Œä¹Ÿå°±æ˜¯æ”¾åœ¨äº†netåŒ…ç›®å½•ä¸‹é¢ã€‚ 2.1 hello world2.1.1 æœåŠ¡ç«¯package mainimport ( net net/rpc)type HelloService struct func (s *HelloService) Hello(request string, reply *string) error *reply = hello + request return nilfunc main() _ = rpc.RegisterName(HelloService, HelloService) listener, err := net.Listen(tcp, :1234) if err != nil panic(ç›‘å¬ç«¯å£å¤±è´¥) conn, err := listener.Accept() if err != nil panic(å»ºç«‹é“¾æ¥å¤±è´¥) rpc.ServeConn(conn) å…¶ä¸­Helloæ–¹æ³•å¿…é¡»æ»¡è¶³Goè¯­è¨€çš„RPCè§„åˆ™ï¼šæ–¹æ³•åªèƒ½æœ‰ä¸¤ä¸ªå¯åºåˆ—åŒ–çš„å‚æ•°ï¼Œå…¶ä¸­ç¬¬äºŒä¸ªå‚æ•°æ˜¯æŒ‡é’ˆç±»å‹ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªerrorç±»å‹ï¼ŒåŒæ—¶å¿…é¡»æ˜¯å…¬å¼€çš„æ–¹æ³•ã€‚ ç„¶åå°±å¯ä»¥å°†HelloServiceç±»å‹çš„å¯¹è±¡æ³¨å†Œä¸ºä¸€ä¸ªRPCæœåŠ¡ï¼š(TCP RPCæœåŠ¡)ã€‚ å…¶ä¸­rpc.Registerå‡½æ•°è°ƒç”¨ä¼šå°†å¯¹è±¡ç±»å‹ä¸­æ‰€æœ‰æ»¡è¶³RPCè§„åˆ™çš„å¯¹è±¡æ–¹æ³•æ³¨å†Œä¸ºRPCå‡½æ•°ï¼Œæ‰€æœ‰æ³¨å†Œçš„æ–¹æ³•ä¼šæ”¾åœ¨â€œHelloServiceâ€æœåŠ¡ç©ºé—´ä¹‹ä¸‹ã€‚ç„¶åæˆ‘ä»¬å»ºç«‹ä¸€ä¸ªå”¯ä¸€çš„TCPé“¾æ¥ï¼Œå¹¶ä¸”é€šè¿‡rpc.ServeConnå‡½æ•°åœ¨è¯¥TCPé“¾æ¥ä¸Šä¸ºå¯¹æ–¹æä¾›RPCæœåŠ¡ã€‚ 2.1.2 å®¢æˆ·ç«¯func main() client, err := rpc.Dial(tcp, localhost:1234) if err != nil log.Fatal(dialing:, err) var reply string err = client.Call(HelloService.Hello, world, reply) if err != nil log.Fatal(err) fmt.Println(reply) é¦–å…ˆæ˜¯é€šè¿‡rpc.Dialæ‹¨å·RPCæœåŠ¡ï¼Œç„¶åé€šè¿‡client.Callè°ƒç”¨å…·ä½“çš„RPCæ–¹æ³•ã€‚åœ¨è°ƒç”¨client.Callæ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨ç‚¹å·é“¾æ¥çš„RPCæœåŠ¡åå­—å’Œæ–¹æ³•åå­—ï¼Œç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æˆ‘ä»¬å®šä¹‰RPCæ–¹æ³•çš„ä¸¤ä¸ªå‚æ•°ã€‚ 2.2 rpc æ”¯æŒ jsonæ ‡å‡†åº“çš„RPCé»˜è®¤é‡‡ç”¨Goè¯­è¨€ç‰¹æœ‰çš„gobç¼–ç ï¼Œå› æ­¤ä»å…¶å®ƒè¯­è¨€è°ƒç”¨Goè¯­è¨€å®ç°çš„RPCæœåŠ¡å°†æ¯”è¾ƒå›°éš¾ã€‚åœ¨äº’è”ç½‘çš„å¾®æœåŠ¡æ—¶ä»£ï¼Œæ¯ä¸ªRPCä»¥åŠæœåŠ¡çš„ä½¿ç”¨è€…éƒ½å¯èƒ½é‡‡ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€ï¼Œå› æ­¤è·¨è¯­è¨€æ˜¯äº’è”ç½‘æ—¶ä»£RPCçš„ä¸€ä¸ªé¦–è¦æ¡ä»¶ã€‚å¾—ç›ŠäºRPCçš„æ¡†æ¶è®¾è®¡ï¼ŒGoè¯­è¨€çš„RPCå…¶å®ä¹Ÿæ˜¯å¾ˆå®¹æ˜“å®ç°è·¨è¯­è¨€æ”¯æŒçš„ã€‚ Goè¯­è¨€çš„RPCæ¡†æ¶æœ‰ä¸¤ä¸ªæ¯”è¾ƒæœ‰ç‰¹è‰²çš„è®¾è®¡ï¼šä¸€ä¸ªæ˜¯RPCæ•°æ®æ‰“åŒ…æ—¶å¯ä»¥é€šè¿‡æ’ä»¶å®ç°è‡ªå®šä¹‰çš„ç¼–ç å’Œè§£ç ï¼›å¦ ä¸€ä¸ªæ˜¯RPCå»ºç«‹åœ¨æŠ½è±¡çš„io.ReadWriteCloseræ¥å£ä¹‹ä¸Šçš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†RPCæ¶è®¾åœ¨ä¸åŒçš„é€šè®¯åè®®ä¹‹ä¸Šã€‚è¿™é‡Œæˆ‘ä»¬å°†å°è¯•é€šè¿‡å®˜æ–¹è‡ªå¸¦çš„net/rpc/jsonrpcæ‰©å±•å®ç°ä¸€ä¸ªè·¨è¯­è¨€çš„PPCã€‚ 2.2.1 æœåŠ¡ç«¯package mainimport ( net net/rpc net/rpc/jsonrpc)type HelloService struct func (s *HelloService) Hello(request string, reply *string) error *reply = hello + request return nilfunc main() rpc.RegisterName(HelloService, new(HelloService)) listener, err := net.Listen(tcp, :1234) if err != nil panic(å¯åŠ¨é”™è¯¯) for conn, err := listener.Accept() if err != nil panic(æ¥æ”¶) go rpc.ServeCodec(jsonrpc.NewServerCodec(conn)) ä»£ç ä¸­æœ€å¤§çš„å˜åŒ–æ˜¯ç”¨rpc.ServeCodecå‡½æ•°æ›¿ä»£äº†rpc.ServeConnå‡½æ•°ï¼Œä¼ å…¥çš„å‚æ•°æ˜¯é’ˆå¯¹æœåŠ¡ç«¯çš„jsonç¼–è§£ç å™¨ã€‚ 2.2.2 å®¢æˆ·ç«¯package mainimport ( fmt net net/rpc net/rpc/jsonrpc)func main() conn, err := net.Dial(tcp, localhost:1234) if err != nil panic(è¿æ¥é”™è¯¯) client := rpc.NewClientWithCodec(jsonrpc.NewClientCodec(conn)) var reply string err = client.Call(HelloService.Hello, imooc, reply) if err != nil panic(è°ƒç”¨é”™è¯¯) fmt.Println(reply) 2.3 æ”¹è¿› rpc è°ƒç”¨å‰é¢çš„rpcè°ƒç”¨è™½ç„¶ç®€å•ï¼Œä½†æ˜¯å’Œæ™®é€šçš„httpçš„è°ƒç”¨å·®å¼‚ä¸å¤§ï¼Œè¿™æ¬¡æˆ‘ä»¬è§£å†³ä¸‹é¢çš„é—®é¢˜ï¼š 2.3.1 serviceNameç»Ÿä¸€å’Œåç§°å†²çªçš„é—®é¢˜ serverç«¯å’Œclientç«¯å¦‚ä½•ç»Ÿä¸€serviceName å¤šä¸ªserverçš„åŒ…ä¸­serviceNameåŒåçš„é—®é¢˜ æ–°å»ºhandlerhandler.goæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š ä¸ºä»€ä¹ˆè¦æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Ÿ - è§£è€¦ package handlerconst HelloServiceName = handler/HelloService æœåŠ¡ç«¯ package mainimport ( net net/rpc start/rpc_ch01/handler)type HelloService struct func (s *HelloService) Hello(request string, reply *string) error *reply = hello + request return nilfunc main() _ = rpc.RegisterName(handler.HelloServiceName, HelloService) listener, err := net.Listen(tcp, :1234) if err != nil panic(ç›‘å¬ç«¯å£å¤±è´¥) conn, err := listener.Accept() if err != nil panic(å»ºç«‹é“¾æ¥å¤±è´¥) rpc.ServeConn(conn) å®¢æˆ·ç«¯ package mainimport ( fmt net/rpc start/rpc_ch01/handler)func main() client, err := rpc.Dial(tcp, localhost:1234) if err != nil panic(è¿æ¥åˆ°æœåŠ¡å™¨å¤±è´¥) var reply string err = client.Call(handler.HelloServiceName+.Hello, imooc, reply) if err != nil panic(æœåŠ¡è°ƒç”¨å¤±è´¥) fmt.Println(reply) 2.3.2 å±è”½HelloServiceNameå’ŒHelloå‡½æ•°åç§°1.æ–°å»ºHandler package handlertype HelloService structfunc (s *HelloService) Hello(request string, reply *string) error *reply = hello + request return nil handleré‡Œå°è£…å¤„ç†é€»è¾‘ã€‚ 2.æœåŠ¡ç«¯ä»£ç† package server_proxyimport net/rpcconst HelloServiceName = handler/HelloServicetype HelloServiceInterface interface Hello(request string, reply *string) errorfunc RegisterHelloService(srv HelloServiceInterface) error return rpc.RegisterName(HelloServiceName, srv) å°†æ³¨å†Œ rpc æœåŠ¡é€»è¾‘äº¤ç»™ä»£ç†ã€‚ 3.æœåŠ¡ç«¯ package mainimport ( net net/rpc start/rpc_ch01/handler start/rpc_ch01/server_proxy)func main() hellohandler := handler.HelloService // ç›´æ¥ä½¿ç”¨ä»£ç†æ³¨å†Œ rpc æœåŠ¡ _ = server_proxy.RegisterHelloService(hellohandler) listener, err := net.Listen(tcp, :1234) if err != nil panic(ç›‘å¬ç«¯å£å¤±è´¥) conn, err := listener.Accept() if err != nil panic(å»ºç«‹é“¾æ¥å¤±è´¥) rpc.ServeConn(conn) 4.å®¢æˆ·ç«¯ä»£ç† package client_proxyimport net/rpcconst HelloServiceName = handler/HelloServicetype HelloServiceClient struct *rpc.Clientfunc NewClient(address string) HelloServiceClient conn, err := rpc.Dial(tcp, address) if err != nil panic(è¿æ¥æœåŠ¡å™¨é”™è¯¯) return HelloServiceClientconnfunc (c *HelloServiceClient) Hello(request string, reply *string) error err := c.Call(HelloServiceName+.Hello, request, reply) if err != nil return err return nil å®¢æˆ·ç«¯ä»£ç†å°è£…è°ƒç”¨é€»è¾‘ã€‚ 5.å®¢æˆ·ç«¯ package mainimport ( fmt start/rpc_ch01/client_proxy)func main() client := client_proxy.NewClient(localhost:1234) var reply string // é€šè¿‡ä»£ç†ç›´æ¥ä¼ å‚è°ƒç”¨ err := client.Hello(bobby,reply) if err != nil panic(è°ƒç”¨å¤±è´¥) fmt.Println(reply) 3. grpcå…¥é—¨3.1 grpcå’Œprotobuf3.1.1 grpcgRPC æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€å¼€æºå’Œé€šç”¨çš„ RPC æ¡†æ¶ï¼Œé¢å‘ç§»åŠ¨å’Œ HTTP2 è®¾è®¡ã€‚ç›®å‰æä¾› Cã€Java å’Œ Go è¯­è¨€ç‰ˆæœ¬ï¼Œåˆ†åˆ«æ˜¯ï¼šgrpc, grpc-java, grpc-go. å…¶ä¸­ C ç‰ˆæœ¬æ”¯æŒ C, C++, Node.js, Python, Ruby, Objective-C, PHP å’Œ C# æ”¯æŒ. 3.1.2 protobufprotobuf å³ Protocol Buffersï¼Œæ˜¯ä¸€ç§è½»ä¾¿é«˜æ•ˆçš„ç»“æ„åŒ–æ•°æ®å­˜å‚¨æ ¼å¼ï¼Œä¸è¯­è¨€ã€å¹³å°æ— å…³ï¼Œå¯æ‰©å±•å¯åºåˆ—åŒ–ã€‚protobuf æ€§èƒ½å’Œæ•ˆç‡å¤§å¹…åº¦ä¼˜äº JSONã€XML ç­‰å…¶ä»–çš„ç»“æ„åŒ–æ•°æ®æ ¼å¼ã€‚protobuf æ˜¯ä»¥äºŒè¿›åˆ¶æ–¹å¼å­˜å‚¨çš„ï¼Œå ç”¨ç©ºé—´å°ï¼Œä½†ä¹Ÿå¸¦æ¥äº†å¯è¯»æ€§å·®çš„ç¼ºç‚¹ã€‚protobuf åœ¨é€šä¿¡åè®®å’Œæ•°æ®å­˜å‚¨ç­‰é¢†åŸŸåº”ç”¨å¹¿æ³›ã€‚ä¾‹å¦‚è‘—åçš„åˆ†å¸ƒå¼ç¼“å­˜å·¥å…· Memcached çš„ Go è¯­è¨€ç‰ˆæœ¬groupcache å°±ä½¿ç”¨äº† protobuf ä½œä¸ºå…¶ RPC æ•°æ®æ ¼å¼ã€‚ Protobuf åœ¨ .proto å®šä¹‰éœ€è¦å¤„ç†çš„ç»“æ„åŒ–æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ protoc å·¥å…·ï¼Œå°† .proto æ–‡ä»¶è½¬æ¢ä¸º Cã€C++ã€Golangã€Javaã€Python ç­‰å¤šç§è¯­è¨€çš„ä»£ç ï¼Œå…¼å®¹æ€§å¥½ï¼Œæ˜“äºä½¿ç”¨ã€‚ javaä¸­çš„dubbo dubbormihessian messagepack å¦‚æœä½ æ‡‚äº†åè®®å®Œå…¨æœ‰èƒ½åŠ›è‡ªå·±å»å®ç°ä¸€ä¸ªåè®® Protocol Buffer å…¶å® æ˜¯ Googleå‡ºå“çš„ä¸€ç§è½»é‡ é«˜æ•ˆçš„ç»“æ„åŒ–æ•°æ®å­˜å‚¨æ ¼å¼ï¼Œæ€§èƒ½æ¯” Jsonã€XML çœŸçš„å¼ºï¼å¤ªï¼å¤šï¼ protobufç»å†äº†protobuf2å’Œprotobuf3ï¼Œpb3æ¯”pb2ç®€åŒ–äº†å¾ˆå¤šï¼Œç›®å‰ä¸»æµçš„ç‰ˆæœ¬æ˜¯pb3 3.2 goä½¿ç”¨protobuf3.2.1 å®‰è£…protocä¸‹è½½ protoc https://github.com/protocolbuffers/protobuf/releases æ·»åŠ  protoc ç¯å¢ƒå˜é‡ æ£€æŸ¥ protoc --version å®‰è£… vscode æ’ä»¶ 3.2.2 ä½¿ç”¨1.ç¼–å†™protoæ–‡ä»¶ syntax = proto3;option go_package = .;proto;// this is a commentmessage Student string name = 1; bool male = 2; repeated int32 scores = 3; 2.ç”Ÿæˆæºç  protoc --go_out=. --go_opt=paths=source_relative --go-grpc_out=. --go-grpc_opt=paths=source_relative Student.proto 3.è°ƒç”¨ä»£ç  package mainimport ( encoding/json fmt log pb protobuf/proto google.golang.org/protobuf/proto)func main() student := pb.Student Name: geektutu, Male: true, Scores: []int3298, 85, 88, data, err := proto.Marshal(student) if err != nil log.Fatal(marshaling error: , err) data2, err := json.Marshal(student) if err != nil log.Fatal(marshaling error: , err) // protobuf data is: geektutubUX, len is: 17 fmt.Printf(protobuf data is: %s, len is: %d , string(data), len(data)) // json data is: name:geektutu,male:true,scores:[98,85,88], len is: 51 fmt.Printf(json data is: %s, len is: %d , string(data2), len(data2)) newStudent := pb.Student err = proto.Unmarshal(data, newStudent) if err != nil log.Fatal(unmarshaling error: , err) // Now student and newStudent contain the same data. if student.GetName() != newStudent.GetName() log.Fatalf(data mismatch %q != %q, student.GetName(), student.GetName()) 3.3 go ä½¿ç”¨ grpc1.ä¸‹è½½ä¾èµ– go get github.com/golang/protobuf/protoc-gen-go 2.protoæ–‡ä»¶ syntax = proto3;option go_package = .;proto;service Greeter rpc SayHello (HelloRequest) returns (HelloReply);message HelloRequest string name = 1;message HelloReply string message = 1; 3.ç”Ÿæˆgoä»£ç  protoc --go_out=. --go_opt=paths=source_relative --go-grpc_out=. --go-grpc_opt=paths=source_relative Hello.proto 4.æœåŠ¡ç«¯ package mainimport ( context fmt google.golang.org/grpc grpc_demo/hello net)type Server struct func (s *Server) SayHello(ctx context.Context,request *hello.HelloRequest)(*hello.HelloReply,error) return hello.HelloReplyMessage:Hello +request.Name,nilfunc main() g := grpc.NewServer() s := Server hello.RegisterGreeterServer(g,s) lis, err := net.Listen(tcp, fmt.Sprintf(:8080)) if err != nil panic(failed to listen: +err.Error()) g.Serve(lis) 5.å®¢æˆ·ç«¯ package mainimport ( context fmt google.golang.org/grpc grpc_demo/proto)func main() conn,err := grpc.Dial(127.0.0.1:8080,grpc.WithInsecure()) if err!=nil panic(err) defer conn.Close() c := hello.NewGreeterClient(conn) r,err := c.SayHello(context.Background(),hello.HelloRequestName:bobby) if err!=nil panic(err) fmt.Println(r.Message)","tags":["rpcã€grpc"],"categories":["Go"]},{"title":"protobufåŸºç¡€","path":"/2024/09/06/protobufåŸºç¡€/","content":"ç®€ä»‹æ¦‚è¿°Protocol Buffersï¼ˆprotobufï¼‰æ˜¯ç”± Google å¼€å‘çš„ä¸€ç§è¯­è¨€ä¸­ç«‹ã€å¹³å°ä¸­ç«‹ã€å¯æ‰©å±•çš„åºåˆ—åŒ–ç»“æ„æ•°æ®çš„æ–¹æ³•ã€‚ å®ƒç”¨äºå°†ç»“æ„åŒ–æ•°æ®åºåˆ—åŒ–ä¸ºå­—èŠ‚æµï¼Œå¹¶åœ¨ç½‘ç»œä¸­ä¼ è¾“æˆ–å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ã€‚protobuf çš„ä¸»è¦ä¼˜ç‚¹æ˜¯é«˜æ•ˆã€ç®€å•å’Œæ”¯æŒè·¨è¯­è¨€äº’æ“ä½œæ€§ã€‚ https://protobuf.dev/programming-guides/proto3/ https://grpc.io/docs/languages/go/quickstart/ å®‰è£…ä¸‹è½½ protocï¼š https://github.com/protocolbuffers/protobuf/releases æ·»åŠ  protoc ç¯å¢ƒå˜é‡ï¼š æ£€æŸ¥ï¼š protoc --version å®‰è£… vscode æ’ä»¶ Hello Worldæ–°å»º grpc é¡¹ç›®# åˆå§‹åŒ–go.modæ‰§è¡Œ go mod init grpc# å®‰è£… Go çš„åè®®ç¼–è¯‘å™¨æ’ä»¶go install google.golang.org/protobuf/cmd/protoc-gen-go@latestgo install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest ç”Ÿæˆ grpc goç¨‹åºsyntax = proto3;option go_package=.;proto;service Greeter rpc SayHello (HelloRequest) returns (HelloReply);message HelloRequest string name = 1;// 1æ˜¯ç¼–å· int32 age = 2; repeated string coures = 3;message HelloReply string message = 1;// protoc --go_out=. --go_opt=paths=source_relative --go-grpc_out=. --go-grpc_opt=paths=source_relative Hello.proto åœ¨Hello.protoç›®å½•æ‰§è¡Œç”Ÿæˆå‘½ä»¤ protoc --go_out=. --go_opt=paths=source_relative --go-grpc_out=. --go-grpc_opt=paths=source_relative Hello.proto 1.3.3 ç¼–å†™ Serverpackage mainimport ( context grpc/proto net google.golang.org/grpc)type Server struct proto.UnimplementedGreeterServer// SayHello implements proto.GreeterServer.func (s Server) SayHello(ctx context.Context, req *proto.HelloRequest) (*proto.HelloReply, error) return proto.HelloReplyMessage: hello + req.Name, nilfunc main() gServer := grpc.NewServer() proto.RegisterGreeterServer(gServer, Server) lis, err := net.Listen(tcp, :8080) if err != nil panic(err) gServer.Serve(lis)package mainimport ( context grpc/proto net google.golang.org/grpc)type Server struct proto.UnimplementedGreeterServer// SayHello implements proto.GreeterServer.func (s Server) SayHello(ctx context.Context, req *proto.HelloRequest) (*proto.HelloReply, error) return proto.HelloReplyMessage: hello + req.Name, nilfunc main() gServer := grpc.NewServer() proto.RegisterGreeterServer(gServer, Server) lis, err := net.Listen(tcp, :8080) if err != nil panic(err) gServer.Serve(lis) 1.3.4 ç¼–å†™ Clientpackage mainimport ( context fmt grpc/proto google.golang.org/grpc google.golang.org/grpc/credentials/insecure)func main() conn, err := grpc.NewClient(localhost:8080, grpc.WithTransportCredentials(insecure.NewCredentials())) if err != nil panic(err) defer conn.Close() c := proto.NewGreeterClient(conn) reply, _ := c.SayHello(context.Background(), proto.HelloRequestName: nige) fmt.Println(reply.Message) 1.3.5 è¿è¡Œç¨‹åº 2. å®šä¹‰ä¸€ä¸ªæ¶ˆæ¯https://protobuf.dev/programming-guides/proto3/ 2.1 å®šä¹‰æ¶ˆæ¯ç±»å‹å…ˆæ¥çœ‹ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­ã€‚å‡è®¾ä½ æƒ³å®šä¹‰ä¸€ä¸ªâ€æœç´¢è¯·æ±‚â€çš„æ¶ˆæ¯æ ¼å¼ï¼Œæ¯ä¸€ä¸ªè¯·æ±‚å«æœ‰ä¸€ä¸ªæŸ¥è¯¢å­—ç¬¦ä¸²ã€ä½ æ„Ÿå…´è¶£çš„æŸ¥è¯¢ç»“æœæ‰€åœ¨çš„é¡µæ•°ï¼Œä»¥åŠæ¯ä¸€é¡µå¤šå°‘æ¡æŸ¥è¯¢ç»“æœã€‚å¯ä»¥é‡‡ç”¨å¦‚ä¸‹çš„æ–¹å¼æ¥å®šä¹‰æ¶ˆæ¯ç±»å‹çš„.protoæ–‡ä»¶äº†ï¼š syntax = proto3;message SearchRequest string query = 1; // ç¼–å· int32 page_number = 2; // ç¼–å· int32 result_per_page = 3; // ç¼–å· æ–‡ä»¶çš„ç¬¬ä¸€è¡ŒæŒ‡å®šäº†ä½ æ­£åœ¨ä½¿ç”¨ proto3 è¯­æ³•ï¼šå¦‚æœä½ æ²¡æœ‰æŒ‡å®šè¿™ä¸ªï¼Œç¼–è¯‘å™¨ä¼šä½¿ç”¨ proto2ã€‚è¿™ä¸ªæŒ‡å®šè¯­æ³•è¡Œå¿…é¡»æ˜¯æ–‡ä»¶çš„éç©ºéæ³¨é‡Šçš„ç¬¬ä¸€ä¸ªè¡Œã€‚ SearchRequest æ¶ˆæ¯æ ¼å¼æœ‰3ä¸ªå­—æ®µï¼Œåœ¨æ¶ˆæ¯ä¸­æ‰¿è½½çš„æ•°æ®åˆ†åˆ«å¯¹åº”äºæ¯ä¸€ä¸ªå­—æ®µã€‚å…¶ä¸­æ¯ä¸ªå­—æ®µéƒ½æœ‰ä¸€ä¸ªåå­—å’Œä¸€ç§ç±»å‹ã€‚ 2.2 æŒ‡å®šå­—æ®µç±»å‹åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ‰€æœ‰å­—æ®µéƒ½æ˜¯æ ‡é‡ç±»å‹ï¼šä¸¤ä¸ªæ•´å‹ï¼ˆpage_numberå’Œresult_per_pageï¼‰ï¼Œä¸€ä¸ªstringç±»å‹ï¼ˆqueryï¼‰ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä¸ºå­—æ®µæŒ‡å®šå…¶ä»–çš„ç±»å‹ï¼ŒåŒ…æ‹¬æšä¸¾ï¼ˆenumerationsï¼‰æˆ–å…¶ä»–å¤åˆæ¶ˆæ¯ç±»å‹ã€‚ 2.3 åˆ†é…ç¼–å·å¿…é¡»åœ¨æ¶ˆæ¯å®šä¹‰ä¸­ä¸ºæ¯ä¸ªå­—æ®µæŒ‡å®šä¸€ä¸ªä»‹äº1å’Œ536,870,911ä¹‹é—´çš„æ•°å­—ï¼Œå¹¶é™„å¸¦ä»¥ä¸‹é™åˆ¶: ç»™å®šçš„æ•°å­—åœ¨è¯¥æ¶ˆæ¯çš„æ‰€æœ‰å­—æ®µä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚ åè®®ç¼“å†²ç¼–å·19,000è‡³19,999æ˜¯é¢„ç•™ä½œå®æ–½ä¹‹ç”¨ã€‚å¦‚æœåœ¨æ¶ˆæ¯ä¸­ä½¿ç”¨è¿™äº›ä¿ç•™å­—æ®µå·ä¹‹ä¸€ï¼Œåè®®ç¼“å†²åŒºç¼–è¯‘å™¨å°†å‘å‡ºå‘Šè­¦ã€‚ ä¸èƒ½ä½¿ç”¨ä»»ä½•ä»¥å‰ä¿ç•™çš„å­—æ®µå·æˆ–åˆ†é…ç»™æ‰©å±•åçš„ä»»ä½•å­—æ®µå·ã€‚ ç¼–å·ä¸åº”è¯¥è¢«é‡ç”¨ã€‚æ°¸è¿œä¸è¦ä»ä¿ç•™åˆ—è¡¨ä¸­å–å‡ºå­—æ®µç¼–å·ï¼Œä»¥ä¾¿ç”¨æ–°çš„å­—æ®µå®šä¹‰é‡ç”¨ã€‚è¯·å‚è§é‡ç”¨å­—æ®µæ•°çš„åæœã€‚ https://protobuf.dev/programming-guides/proto3/#consequences ä½¿ç”¨æ¶ˆæ¯ç±»å‹æ—¶ï¼Œä¸èƒ½æ›´æ”¹æ­¤ç¼–å·ï¼Œå› ä¸ºå®ƒä»¥æ¶ˆæ¯è¿æ¥æ ¼å¼æ ‡è¯†å­—æ®µã€‚â€œæ›´æ”¹â€å­—æ®µç¼–å·ç­‰åŒäºåˆ é™¤è¯¥å­—æ®µå¹¶åˆ›å»ºå…·æœ‰ç›¸åŒç±»å‹ä½†å…·æœ‰æ–°ç¼–å·çš„æ–°å­—æ®µã€‚æœ‰å…³å¦‚ä½•æ­£ç¡®æ‰§è¡Œæ­¤æ“ä½œçš„ä¿¡æ¯ï¼Œè¯·å‚è§åˆ é™¤å­—æ®µã€‚ https://protobuf.dev/programming-guides/proto3/#deleting æ³¨ï¼š[1,15]ä¹‹å†…çš„æ ‡è¯†å·åœ¨ç¼–ç çš„æ—¶å€™ä¼šå ç”¨ä¸€ä¸ªå­—èŠ‚ã€‚[16,2047]å†…çš„æ ‡è¯†å·åˆ™å ç”¨2ä¸ªå­—èŠ‚ã€‚æ‰€ä»¥åº”è¯¥ä¸ºé‚£äº›é¢‘ç¹å‡ºç°çš„æ¶ˆæ¯å…ƒç´ ä¿ç•™ [1,15]ä¹‹å†…çš„æ ‡è¯†å·ã€‚åˆ‡è®°ï¼šè¦ä¸ºå°†æ¥æœ‰èƒ½æ·»åŠ çš„ã€é¢‘ç¹å‡ºç°çš„æ ‡è¯†å·é¢„ç•™ä¸€äº›æ ‡è¯†å·ã€‚ 2.4 æŒ‡å®šå­—æ®µæ ‡ç­¾ç±»å‹åœ¨ Protocol Buffersï¼ˆprotobufï¼‰ä¸­ï¼Œæ¶ˆæ¯å­—æ®µå¯ä»¥æ˜¯ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š optionalï¼ˆå¯é€‰å­—æ®µï¼‰: çŠ¶æ€ å·²è®¾ç½®: å¦‚æœå­—æ®µè¢«æ˜¾å¼è®¾ç½®æˆ–ä»ä¼ è¾“æ•°æ®ä¸­è§£æå‡ºæ¥ï¼Œå®ƒä¼šè¢«åºåˆ—åŒ–åˆ°æ•°æ®æµä¸­ã€‚ æœªè®¾ç½®: å¦‚æœå­—æ®µæ²¡æœ‰è¢«è®¾ç½®ï¼Œå®ƒä¼šè¿”å›é»˜è®¤å€¼ï¼Œå¹¶ä¸”ä¸ä¼šè¢«åºåˆ—åŒ–åˆ°æ•°æ®æµä¸­ã€‚ æ£€æŸ¥: ä½ å¯ä»¥æ£€æŸ¥ä¸€ä¸ªå¯é€‰å­—æ®µæ˜¯å¦è¢«æ˜¾å¼è®¾ç½®ã€‚ repeatedï¼ˆé‡å¤å­—æ®µï¼‰: ç‰¹æ€§: è¿™ä¸ªå­—æ®µå¯ä»¥åœ¨æ¶ˆæ¯ä¸­å‡ºç°é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚æ‰€æœ‰çš„é‡å¤å€¼çš„é¡ºåºéƒ½ä¼šè¢«ä¿ç•™ã€‚ mapï¼ˆæ˜ å°„å­—æ®µï¼‰: ç‰¹æ€§: è¿™æ˜¯ä¸€ä¸ªé”®å€¼å¯¹çš„å­—æ®µç±»å‹ï¼Œç”¨äºè¡¨ç¤ºæ˜ å°„å…³ç³»ã€‚å…·ä½“ç»†èŠ‚å¯ä»¥å‚è€ƒæœ‰å…³æ˜ å°„å­—æ®µçš„æ–‡æ¡£ã€‚ éšå¼å­—æ®µå­˜åœ¨: é»˜è®¤çŠ¶æ€: å¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®šå­—æ®µæ ‡ç­¾ï¼Œåˆ™å‡å®šå­—æ®µä¸ºâ€œéšå¼å­—æ®µå­˜åœ¨â€çŠ¶æ€ã€‚ä½ ä¸èƒ½æ˜¾å¼è®¾ç½®ä¸€ä¸ªå­—æ®µä¸ºè¿™ç§çŠ¶æ€ã€‚ ç‰¹æ€§: ä¸€ä¸ªæ¶ˆæ¯ä¸­å¯ä»¥æœ‰é›¶ä¸ªæˆ–ä¸€ä¸ªè¿™æ ·çš„å­—æ®µï¼Œä½†ä¸èƒ½å¤šäºä¸€ä¸ªã€‚ä½ ä¹Ÿä¸èƒ½ç¡®å®šè¿™ç§ç±»å‹çš„å­—æ®µæ˜¯å¦æ˜¯ä»æ•°æ®æµä¸­è§£æå‡ºæ¥çš„ã€‚ä¸€ä¸ªéšå¼å­˜åœ¨çš„å­—æ®µä¼šè¢«åºåˆ—åŒ–åˆ°æ•°æ®æµä¸­ï¼Œé™¤éå®ƒæ˜¯é»˜è®¤å€¼ã€‚ proto3 ä¸­çš„é»˜è®¤æ‰“åŒ…ç¼–ç : å¯¹äº proto3 ä¸­çš„æ ‡é‡æ•°å€¼ç±»å‹çš„é‡å¤å­—æ®µï¼Œé»˜è®¤ä½¿ç”¨æ‰“åŒ…ç¼–ç ï¼ˆpacked encodingï¼‰ã€‚ä½ å¯ä»¥äº†è§£æ›´å¤šå…³äºæ‰“åŒ…ç¼–ç çš„å†…å®¹åœ¨ Protocol Buffer ç¼–ç æ–‡æ¡£ä¸­ã€‚ è¿™äº›å­—æ®µç±»å‹å’Œç‰¹æ€§å¸®åŠ©å®šä¹‰å’Œæ§åˆ¶å¦‚ä½•åœ¨ Protocol Buffers ä¸­å¤„ç†æ•°æ®ã€‚ 2.5 æ·»åŠ æ›´å¤šæ¶ˆæ¯ç±»å‹åœ¨ä¸€ä¸ª.protoæ–‡ä»¶ä¸­å¯ä»¥å®šä¹‰å¤šä¸ªæ¶ˆæ¯ç±»å‹ã€‚åœ¨å®šä¹‰å¤šä¸ªç›¸å…³çš„æ¶ˆæ¯çš„æ—¶å€™ï¼Œè¿™ä¸€ç‚¹ç‰¹åˆ«æœ‰ç”¨â€”â€”ä¾‹å¦‚ï¼Œå¦‚æœæƒ³å®šä¹‰ä¸SearchResponseæ¶ˆæ¯ç±»å‹å¯¹åº”çš„å›å¤æ¶ˆæ¯æ ¼å¼çš„è¯ï¼Œä½ å¯ä»¥å°†å®ƒæ·»åŠ åˆ°ç›¸åŒçš„.protoæ–‡ä»¶ä¸­ï¼Œå¦‚ï¼š message SearchRequest string query = 1; int32 page_number = 2; int32 result_per_page = 3;message SearchResponse string message = 1; 2.6 æ·»åŠ æ³¨é‡Šå‘.protoæ–‡ä»¶æ·»åŠ æ³¨é‡Šï¼Œå¯ä»¥ä½¿ç”¨CC++javaé£æ ¼çš„åŒæ–œæ ï¼ˆï¼‰ è¯­æ³•æ ¼å¼ï¼Œå¦‚ï¼š message SearchRequest string query = 1; int32 page_number = 2; // Which page number do we want? int32 result_per_page = 3; // Number of results to return per page. 2.7 åˆ é™¤å­—æ®µå¦‚æœåˆ é™¤æ“ä½œä¸å½“ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸¥é‡çš„é—®é¢˜ã€‚ å½“ä¸å†éœ€è¦æŸä¸ªå­—æ®µå¹¶ä¸”å·²ç»ä»å®¢æˆ·ç«¯ä»£ç ä¸­åˆ é™¤äº†æ‰€æœ‰å¼•ç”¨æ—¶ï¼Œå¯ä»¥ä»æ¶ˆæ¯ä¸­åˆ é™¤å­—æ®µå®šä¹‰ã€‚ä½†æ˜¯ï¼Œå¿…é¡»ä¿ç•™å·²åˆ é™¤çš„å­—æ®µå·ã€‚å¦‚æœä¸ä¿ç•™å­—æ®µç¼–å·ï¼Œé‚£ä¹ˆå¼€å‘äººå‘˜å°†æ¥å¯ä»¥é‡ç”¨è¯¥ç¼–å·ã€‚ è¿˜åº”è¯¥ä¿ç•™å­—æ®µåï¼Œä»¥å…è®¸ç»§ç»­è§£ææ¶ˆæ¯çš„ JSON å’Œ TextFormat ç¼–ç ã€‚ 2.8 ä¿ç•™æ ‡è¯†ç¬¦ï¼ˆReservedï¼‰å¦‚æœé€šè¿‡å®Œå…¨åˆ é™¤å­—æ®µæˆ–æ³¨é‡Šæ‰å­—æ®µæ¥æ›´æ–°æ¶ˆæ¯ç±»å‹ï¼Œæœªæ¥çš„å¼€å‘äººå‘˜åœ¨å¯¹ç±»å‹è¿›è¡Œæ›´æ–°æ—¶å¯ä»¥é‡ç”¨å­—æ®µç¼–å·ã€‚è¿™å¯èƒ½å¯¼è‡´ä¸¥é‡çš„é—®é¢˜ï¼Œå¦‚é‡ç”¨å­—æ®µæ•°å­—çš„åæœæ‰€è¿°ã€‚è¦ç¡®ä¿è¿™ç§æƒ…å†µä¸ä¼šå‘ç”Ÿï¼Œè¯·å°†å·²åˆ é™¤çš„å­—æ®µå·æ·»åŠ åˆ°ä¿ç•™åˆ—è¡¨ä¸­ã€‚ å¦‚æœæœªæ¥çš„å¼€å‘äººå‘˜è¯•å›¾ä½¿ç”¨è¿™äº›ä¿ç•™å­—æ®µç¼–å·ï¼Œåˆ™åè®®ç¼–è¯‘å™¨å°†ç”Ÿæˆé”™è¯¯æ¶ˆæ¯ã€‚ç°åœ¨æœ‰ä¸€ç§ç¡®ä¿ä¸ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µçš„æ–¹æ³•å°±æ˜¯æŒ‡å®šä¿ç•™æ ‡è¯†ç¬¦ï¼Œprotocol bufferçš„ç¼–è¯‘å™¨ä¼šè­¦å‘Šæœªæ¥å°è¯•ä½¿ç”¨è¿™äº›å­—æ®µæ ‡è¯†ç¬¦çš„ç”¨æˆ·ã€‚ message Foo reserved 2, 15, 9 to 11; reserved foo, bar; æ³¨ï¼šä¸è¦åœ¨åŒä¸€è¡Œreservedå£°æ˜ä¸­åŒæ—¶å£°æ˜å­—æ®µåå­—å’Œæ ‡è¯†å· 2.9 ä».protoæ–‡ä»¶ç”Ÿæˆäº†ä»€ä¹ˆï¼Ÿå½“ç”¨protocol bufferç¼–è¯‘å™¨æ¥è¿è¡Œ.protoæ–‡ä»¶æ—¶ï¼Œç¼–è¯‘å™¨å°†ç”Ÿæˆæ‰€é€‰æ‹©è¯­è¨€çš„ä»£ç ï¼Œè¿™äº›ä»£ç å¯ä»¥æ“ä½œåœ¨.protoæ–‡ä»¶ä¸­å®šä¹‰çš„æ¶ˆæ¯ç±»å‹ï¼ŒåŒ…æ‹¬è·å–ã€è®¾ç½®å­—æ®µå€¼ï¼Œå°†æ¶ˆæ¯åºåˆ—åŒ–åˆ°ä¸€ä¸ªè¾“å‡ºæµä¸­ï¼Œä»¥åŠä»ä¸€ä¸ªè¾“å…¥æµä¸­è§£ææ¶ˆæ¯ã€‚ å¯¹äº Javaï¼Œç¼–è¯‘å™¨ç”Ÿæˆä¸€ä¸ªã€‚Java æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ç”¨äºæ¯ç§æ¶ˆæ¯ç±»å‹çš„ç±»ï¼Œä»¥åŠç”¨äºåˆ›å»ºæ¶ˆæ¯ç±»å®ä¾‹çš„ç‰¹æ®Š Builder ç±»ã€‚ å¯¹äº Goï¼Œç¼–è¯‘å™¨ä¸ºæ–‡ä»¶ä¸­çš„æ¯ä¸ªæ¶ˆæ¯ç±»å‹ç”Ÿæˆä¸€ä¸ª. pb.Go æ–‡ä»¶ã€‚ ä½ å¯ä»¥ä»å¦‚ä¸‹çš„æ–‡æ¡£é“¾æ¥ä¸­è·å–æ¯ç§è¯­è¨€æ›´å¤šAPIã€‚API Reference 2.10 æ ‡é‡æ•°å€¼ç±»å‹ä¸€ä¸ªæ ‡é‡æ¶ˆæ¯å­—æ®µå¯ä»¥å«æœ‰ä¸€ä¸ªå¦‚ä¸‹çš„ç±»å‹â€”â€”è¯¥è¡¨æ ¼å±•ç¤ºäº†å®šä¹‰äº.protoæ–‡ä»¶ä¸­çš„ç±»å‹ï¼Œä»¥åŠä¸ä¹‹å¯¹åº”çš„ã€åœ¨è‡ªåŠ¨ç”Ÿæˆçš„è®¿é—®ç±»ä¸­å®šä¹‰çš„ç±»å‹ï¼š .proto Type Notes Python Type Go Type double float float64 float float float32 int32 ä½¿ç”¨å˜é•¿ç¼–ç ï¼Œå¯¹äºè´Ÿå€¼çš„æ•ˆç‡å¾ˆä½ï¼Œå¦‚æœä½ çš„åŸŸæœ‰å¯èƒ½æœ‰è´Ÿå€¼ï¼Œè¯·ä½¿ç”¨sint64æ›¿ä»£ int int32 uint32 ä½¿ç”¨å˜é•¿ç¼–ç  int uint32 uint64 ä½¿ç”¨å˜é•¿ç¼–ç  int uint64 sint32 ä½¿ç”¨å˜é•¿ç¼–ç ï¼Œè¿™äº›ç¼–ç åœ¨è´Ÿå€¼æ—¶æ¯”int32é«˜æ•ˆçš„å¤š int int32 sint64 ä½¿ç”¨å˜é•¿ç¼–ç ï¼Œæœ‰ç¬¦å·çš„æ•´å‹å€¼ã€‚ç¼–ç æ—¶æ¯”é€šå¸¸çš„int64é«˜æ•ˆã€‚ int int64 fixed32 æ€»æ˜¯4ä¸ªå­—èŠ‚ï¼Œå¦‚æœæ•°å€¼æ€»æ˜¯æ¯”æ€»æ˜¯æ¯”228å¤§çš„è¯ï¼Œè¿™ä¸ªç±»å‹ä¼šæ¯”uint32é«˜æ•ˆã€‚ int uint32 fixed64 æ€»æ˜¯8ä¸ªå­—èŠ‚ï¼Œå¦‚æœæ•°å€¼æ€»æ˜¯æ¯”æ€»æ˜¯æ¯”256å¤§çš„è¯ï¼Œè¿™ä¸ªç±»å‹ä¼šæ¯”uint64é«˜æ•ˆã€‚ int uint64 sfixed32 æ€»æ˜¯4ä¸ªå­—èŠ‚ int int32 sfixed64 æ€»æ˜¯8ä¸ªå­—èŠ‚ int int64 bool bool bool string ä¸€ä¸ªå­—ç¬¦ä¸²å¿…é¡»æ˜¯UTF-8ç¼–ç æˆ–è€…7-bit ASCIIç¼–ç çš„æ–‡æœ¬ã€‚ str string bytes å¯èƒ½åŒ…å«ä»»æ„é¡ºåºçš„å­—èŠ‚æ•°æ®ã€‚ str []byte ä½ å¯ä»¥åœ¨æ–‡ç« Protocol Buffer ç¼–ç ä¸­ï¼Œæ‰¾åˆ°æ›´å¤šâ€œåºåˆ—åŒ–æ¶ˆæ¯æ—¶å„ç§ç±»å‹å¦‚ä½•ç¼–ç â€çš„ä¿¡æ¯ã€‚ åœ¨javaä¸­ï¼Œæ— ç¬¦å·32ä½å’Œ64ä½æ•´å‹è¢«è¡¨ç¤ºæˆä»–ä»¬çš„æ•´å‹å¯¹åº”å½¢ä¼¼ï¼Œæœ€é«˜ä½è¢«å‚¨å­˜åœ¨æ ‡å¿—ä½ä¸­ã€‚ å¯¹äºæ‰€æœ‰çš„æƒ…å†µï¼Œè®¾å®šå€¼ä¼šæ‰§è¡Œç±»å‹æ£€æŸ¥ä»¥ç¡®ä¿æ­¤å€¼æ˜¯æœ‰æ•ˆã€‚ 64ä½æˆ–è€…æ— ç¬¦å·32ä½æ•´å‹åœ¨è§£ç æ—¶è¢«è¡¨ç¤ºæˆä¸ºilongï¼Œä½†æ˜¯åœ¨è®¾ç½®æ—¶å¯ä»¥ä½¿ç”¨intå‹å€¼è®¾å®šï¼Œåœ¨æ‰€æœ‰çš„æƒ…å†µä¸‹ï¼Œå€¼å¿…é¡»ç¬¦åˆå…¶è®¾ç½®å…¶ç±»å‹çš„è¦æ±‚ã€‚ pythonä¸­stringè¢«è¡¨ç¤ºæˆåœ¨è§£ç æ—¶è¡¨ç¤ºæˆunicodeã€‚ä½†æ˜¯ä¸€ä¸ªASCIIstringå¯ä»¥è¢«è¡¨ç¤ºæˆstrç±»å‹ã€‚ Integeråœ¨64ä½çš„æœºå™¨ä¸Šä½¿ç”¨ï¼Œstringåœ¨32ä½æœºå™¨ä¸Šä½¿ç”¨ã€‚ 2.11 é»˜è®¤å€¼åœ¨è§£ææ¶ˆæ¯æ—¶ï¼Œå¦‚æœç¼–ç çš„æ¶ˆæ¯ä¸åŒ…å«ç‰¹å®šçš„éšå¼å­˜åœ¨å…ƒç´ ï¼Œåˆ™è®¿é—®è§£æå¯¹è±¡ä¸­çš„ç›¸åº”å­—æ®µå°†è¿”å›è¯¥å­—æ®µçš„é»˜è®¤å€¼ã€‚è¿™äº›é»˜è®¤å€¼æ˜¯ç‰¹å®šäºç±»å‹çš„: å¯¹äºstringsï¼Œé»˜è®¤æ˜¯ä¸€ä¸ªç©ºstring å¯¹äºbytesï¼Œé»˜è®¤æ˜¯ä¸€ä¸ªç©ºçš„bytes å¯¹äºboolsï¼Œé»˜è®¤æ˜¯false å¯¹äºæ•°å€¼ç±»å‹ï¼Œé»˜è®¤æ˜¯0 å¯¹äºæšä¸¾ï¼Œé»˜è®¤æ˜¯ç¬¬ä¸€ä¸ªå®šä¹‰çš„æšä¸¾å€¼ï¼Œå¿…é¡»ä¸º0; å¯¹äºæ¶ˆæ¯å­—æ®µï¼Œå­—æ®µæ²¡æœ‰è¢«è®¾ç½®ï¼Œç¡®åˆ‡çš„å€¼æ˜¯æ ¹æ®è¯­è¨€ç¡®å®šçš„ï¼Œè¯¦è§generated code guide å¯¹äºå¯é‡å¤å­—æ®µçš„é»˜è®¤å€¼æ˜¯ç©ºï¼ˆé€šå¸¸æƒ…å†µä¸‹æ˜¯å¯¹åº”è¯­è¨€ä¸­ç©ºåˆ—è¡¨ï¼‰ã€‚ æ³¨æ„ï¼Œå¯¹äºæ ‡é‡æ¶ˆæ¯å­—æ®µï¼Œä¸€æ—¦è§£æäº†æ¶ˆæ¯ï¼Œå°±æ— æ³•åˆ¤æ–­å­—æ®µæ˜¯æ˜¾å¼è®¾ç½®ä¸ºé»˜è®¤å€¼(ä¾‹å¦‚ï¼Œå¸ƒå°”å€¼æ˜¯å¦è®¾ç½®ä¸º false) ï¼Œè¿˜æ˜¯æ ¹æœ¬æ²¡æœ‰è®¾ç½®: åœ¨å®šä¹‰æ¶ˆæ¯ç±»å‹æ—¶åº”è¯¥è®°ä½è¿™ä¸€ç‚¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸å¸Œæœ›æŸäº›è¡Œä¸ºåœ¨é»˜è®¤æƒ…å†µä¸‹ä¹Ÿä¼šå‘ç”Ÿï¼Œé‚£ä¹ˆå°±ä¸è¦æœ‰ä¸€ä¸ªå¸ƒå°”å€¼åœ¨è®¾ç½®ä¸º false æ—¶æ‰“å¼€æŸäº›è¡Œä¸ºã€‚è¿˜è¦æ³¨æ„ï¼Œå¦‚æœå°†æ ‡é‡æ¶ˆæ¯å­—æ®µè®¾ç½®ä¸ºé»˜è®¤å€¼ï¼Œåˆ™è¯¥å€¼å°†ä¸ä¼šåºåˆ—åŒ–ã€‚å¦‚æœå°†æµ®ç‚¹æ•°æˆ–åŒç²¾åº¦å€¼è®¾ç½®ä¸º + 0ï¼Œåˆ™ä¸ä¼šåºåˆ—åŒ–å®ƒï¼Œä½† -0è¢«è®¤ä¸ºæ˜¯ä¸åŒçš„ï¼Œå°†è¢«åºåˆ—åŒ–ã€‚ 2.12 æšä¸¾åœ¨å®šä¹‰æ¶ˆæ¯ç±»å‹æ—¶ï¼Œå¯èƒ½å¸Œæœ›å…¶ä¸­ä¸€ä¸ªå­—æ®µåªåŒ…å«é¢„å®šä¹‰çš„å€¼åˆ—è¡¨ä¸­çš„ä¸€ä¸ªã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ æƒ³ä¸ºæ¯ä¸ª SearchRequest æ·»åŠ ä¸€ä¸ªè¯­æ–™åº“å­—æ®µï¼Œå…¶ä¸­çš„è¯­æ–™åº“å¯ä»¥æ˜¯ UNIVERSALã€ WEBã€ IMAGESã€ LOCALã€ NEWSã€ PRODUCTS æˆ– VIDEOã€‚å¯ä»¥éå¸¸ç®€å•åœ°é€šè¿‡å‘æ¶ˆæ¯å®šä¹‰æ·»åŠ æšä¸¾ï¼Œå¹¶ä¸ºæ¯ä¸ªå¯èƒ½çš„å€¼æ·»åŠ ä¸€ä¸ªå¸¸é‡æ¥å®ç°è¿™ä¸€ç‚¹ã€‚ enum Corpus CORPUS_UNSPECIFIED = 0; CORPUS_UNIVERSAL = 1; CORPUS_WEB = 2; CORPUS_IMAGES = 3; CORPUS_LOCAL = 4; CORPUS_NEWS = 5; CORPUS_PRODUCTS = 6; CORPUS_VIDEO = 7;message SearchRequest string query = 1; int32 page_number = 2; int32 results_per_page = 3; Corpus corpus = 4; Corpus æšä¸¾çš„ç¬¬ä¸€ä¸ªå¸¸é‡æ˜ å°„ä¸ºé›¶: æ¯ä¸ªæšä¸¾å®šä¹‰å¿…é¡»åŒ…å«ä¸€ä¸ªå¸¸é‡ï¼Œè¯¥å¸¸é‡ä½œä¸ºå…¶ç¬¬ä¸€ä¸ªå…ƒç´ æ˜ å°„ä¸ºé›¶ã€‚è¿™æ˜¯å› ä¸º: å¿…é¡»æœ‰ä¸€ä¸ªé›¶å€¼ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨0ä½œä¸ºæ•°å­—é»˜è®¤å€¼ã€‚ é›¶å€¼éœ€è¦æˆä¸ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä»¥ä¾¿ä¸ Proto2è¯­ä¹‰å…¼å®¹ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªæšä¸¾å€¼æ˜¯é»˜è®¤å€¼ï¼Œé™¤éæ˜¾å¼æŒ‡å®šäº†ä¸åŒçš„å€¼ã€‚ å¯ä»¥é€šè¿‡ä¸ºä¸åŒçš„æšä¸¾å¸¸æ•°èµ‹ç›¸åŒçš„å€¼æ¥å®šä¹‰åˆ«åã€‚ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦å°† allow _ alias é€‰é¡¹è®¾ç½®ä¸º trueã€‚å¦åˆ™ï¼Œå½“å‘ç°åˆ«åæ—¶ï¼Œåè®®ç¼“å†²åŒºç¼–è¯‘å™¨å°†ç”Ÿæˆè­¦å‘Šæ¶ˆæ¯ã€‚å°½ç®¡æ‰€æœ‰åˆ«åå€¼åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œä½†åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­å§‹ç»ˆä½¿ç”¨ç¬¬ä¸€ä¸ªå€¼ã€‚ enum EnumAllowingAlias option allow_alias = true; EAA_UNSPECIFIED = 0; EAA_STARTED = 1; EAA_RUNNING = 1; EAA_FINISHED = 2;enum EnumNotAllowingAlias ENAA_UNSPECIFIED = 0; ENAA_STARTED = 1; // ENAA_RUNNING = 1; // Uncommenting this line will cause a warning message. ENAA_FINISHED = 2; æšä¸¾å¸¸é‡å¿…é¡»åœ¨32ä½æ•´å‹å€¼çš„èŒƒå›´å†…ã€‚å› ä¸ºenumå€¼æ˜¯ä½¿ç”¨å¯å˜ç¼–ç æ–¹å¼çš„ï¼Œå¯¹è´Ÿæ•°ä¸å¤Ÿé«˜æ•ˆï¼Œå› æ­¤ä¸æ¨èåœ¨enumä¸­ä½¿ç”¨è´Ÿæ•°ã€‚å¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œå¯ä»¥åœ¨ ä¸€ä¸ªæ¶ˆæ¯å®šä¹‰çš„å†…éƒ¨æˆ–å¤–éƒ¨å®šä¹‰æšä¸¾â€”â€”è¿™äº›æšä¸¾å¯ä»¥åœ¨.protoæ–‡ä»¶ä¸­çš„ä»»ä½•æ¶ˆæ¯å®šä¹‰é‡Œé‡ç”¨ã€‚å½“ç„¶ä¹Ÿå¯ä»¥åœ¨ä¸€ä¸ªæ¶ˆæ¯ä¸­å£°æ˜ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œè€Œåœ¨å¦ä¸€ä¸ªä¸åŒ çš„æ¶ˆæ¯ä¸­ä½¿ç”¨å®ƒâ€”â€”é‡‡ç”¨MessageType.EnumTypeçš„è¯­æ³•æ ¼å¼ã€‚ å½“å¯¹ä¸€ä¸ªä½¿ç”¨äº†æšä¸¾çš„.protoæ–‡ä»¶è¿è¡Œprotocol bufferç¼–è¯‘å™¨çš„æ—¶å€™ï¼Œç”Ÿæˆçš„ä»£ç ä¸­å°†æœ‰ä¸€ä¸ªå¯¹åº”çš„enumï¼ˆå¯¹Javaæˆ–C++æ¥è¯´ï¼‰ï¼Œæˆ–è€…ä¸€ä¸ªç‰¹æ®Šçš„EnumDescriptorç±»ï¼ˆå¯¹ Pythonæ¥è¯´ï¼‰ï¼Œå®ƒè¢«ç”¨æ¥åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ç±»ä¸­åˆ›å»ºä¸€ç³»åˆ—çš„æ•´å‹å€¼ç¬¦å·å¸¸é‡ï¼ˆsymbolic constantsï¼‰ã€‚ åœ¨ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæ— æ³•è¯†åˆ«çš„æšä¸¾å€¼ä¼šè¢«ä¿å­˜åœ¨æ¶ˆæ¯ä¸­ï¼Œè™½ç„¶è¿™ç§è¡¨ç¤ºæ–¹å¼éœ€è¦ä¾æ®æ‰€ä½¿ç”¨è¯­è¨€è€Œå®šã€‚åœ¨é‚£äº›æ”¯æŒå¼€æ”¾æšä¸¾ç±»å‹è¶…å‡ºæŒ‡å®šèŒƒå›´ä¹‹å¤–çš„è¯­è¨€ä¸­ï¼ˆä¾‹å¦‚C++å’ŒGoï¼‰ï¼Œä¸ºè¯†åˆ«çš„å€¼ä¼šè¢«è¡¨ç¤ºæˆæ‰€æ”¯æŒçš„æ•´å‹ã€‚åœ¨ä½¿ç”¨å°é—­æšä¸¾ç±»å‹çš„è¯­è¨€ä¸­ï¼ˆJavaï¼‰ï¼Œä½¿ç”¨æšä¸¾ä¸­çš„ä¸€ä¸ªç±»å‹æ¥è¡¨ç¤ºæœªè¯†åˆ«çš„å€¼ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨æ‰€æ”¯æŒæ•´å‹æ¥è®¿é—®ã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œå¦‚æœè§£æçš„æ¶ˆæ¯è¢«åºåˆ—å·ï¼Œæœªè¯†åˆ«çš„å€¼å°†ä¿æŒåŸæ ·ã€‚ å…³äºå¦‚ä½•åœ¨ä½ çš„åº”ç”¨ç¨‹åºçš„æ¶ˆæ¯ä¸­ä½¿ç”¨æšä¸¾çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹æ‰€é€‰æ‹©çš„è¯­è¨€generated code guide 3. ä½¿ç”¨å…¶ä»–ç±»å‹æ¶ˆæ¯3.1 å¯¼å…¥å®šä¹‰åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒResultæ¶ˆæ¯ç±»å‹ä¸SearchResponseæ˜¯å®šä¹‰åœ¨åŒä¸€æ–‡ä»¶ä¸­çš„ã€‚å¦‚æœæƒ³è¦ä½¿ç”¨çš„æ¶ˆæ¯ç±»å‹å·²ç»åœ¨å…¶ä»–.protoæ–‡ä»¶ä¸­å·²ç»å®šä¹‰è¿‡äº†å‘¢ï¼Ÿ ä½ å¯ä»¥é€šè¿‡å¯¼å…¥ï¼ˆimportingï¼‰å…¶ä»–.protoæ–‡ä»¶ä¸­çš„å®šä¹‰æ¥ä½¿ç”¨å®ƒä»¬ã€‚è¦å¯¼å…¥å…¶ä»–.protoæ–‡ä»¶çš„å®šä¹‰ï¼Œä½ éœ€è¦åœ¨ä½ çš„æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªå¯¼å…¥å£°æ˜ï¼Œå¦‚ï¼š import myproject/other_protos.proto; é»˜è®¤æƒ…å†µä¸‹ä½ åªèƒ½ä½¿ç”¨ç›´æ¥å¯¼å…¥çš„.protoæ–‡ä»¶ä¸­çš„å®šä¹‰. ç„¶è€Œï¼Œ æœ‰æ—¶å€™ä½ éœ€è¦ç§»åŠ¨ä¸€ä¸ª.protoæ–‡ä»¶åˆ°ä¸€ä¸ªæ–°çš„ä½ç½®ï¼Œ å¯ä»¥ä¸ç›´æ¥ç§»åŠ¨.protoæ–‡ä»¶ï¼Œ åªéœ€æ”¾å…¥ä¸€ä¸ªä¼ª .proto æ–‡ä»¶åœ¨è€çš„ä½ç½®ï¼Œ ç„¶åä½¿ç”¨import publicè½¬å‘æ–°çš„ä½ç½®ã€‚import public ä¾èµ–æ€§ä¼šé€šè¿‡ä»»æ„å¯¼å…¥åŒ…å«import publicå£°æ˜çš„protoæ–‡ä»¶ä¼ é€’ã€‚ä¾‹å¦‚ï¼š // è¿™æ˜¯æ–°çš„proto// All definitions are moved here // è¿™æ˜¯æ—§çš„proto// è¿™æ˜¯æ‰€æœ‰å®¢æˆ·ç«¯æ­£åœ¨å¯¼å…¥çš„åŒ…import public new.proto;import other.proto; // å®¢æˆ·ç«¯protoimport old.proto;// ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨æ–°æ—§ä¸¤ç§åŒ…çš„protoå®šä¹‰äº†ã€‚ é€šè¿‡åœ¨ç¼–è¯‘å™¨å‘½ä»¤è¡Œå‚æ•°ä¸­ä½¿ç”¨-I/--proto_pathprotocal ç¼–è¯‘å™¨ä¼šåœ¨æŒ‡å®šç›®å½•æœç´¢è¦å¯¼å…¥çš„æ–‡ä»¶ã€‚å¦‚æœæ²¡æœ‰ç»™å‡ºæ ‡å¿—ï¼Œç¼–è¯‘å™¨ä¼šæœç´¢ç¼–è¯‘å‘½ä»¤è¢«è°ƒç”¨çš„ç›®å½•ã€‚é€šå¸¸ä½ åªè¦æŒ‡å®šproto_pathæ ‡å¿—ä¸ºä½ çš„å·¥ç¨‹æ ¹ç›®å½•å°±å¥½ã€‚å¹¶ä¸”æŒ‡å®šå¥½å¯¼å…¥çš„æ­£ç¡®åç§°å°±å¥½ã€‚ 3.2 åµŒå¥—ç±»å‹ä½ å¯ä»¥åœ¨å…¶ä»–æ¶ˆæ¯ç±»å‹ä¸­å®šä¹‰ã€ä½¿ç”¨æ¶ˆæ¯ç±»å‹ï¼Œåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼ŒResultæ¶ˆæ¯å°±å®šä¹‰åœ¨SearchResponseæ¶ˆæ¯å†…ï¼Œå¦‚ï¼š message SearchResponse message Result string url = 1; string title = 2; repeated string snippets = 3; repeated Result results = 1; å¦‚æœä½ æƒ³åœ¨å®ƒçš„çˆ¶æ¶ˆæ¯ç±»å‹çš„å¤–éƒ¨é‡ç”¨è¿™ä¸ªæ¶ˆæ¯ç±»å‹ï¼Œä½ éœ€è¦ä»¥Parent.Typeçš„å½¢å¼ä½¿ç”¨å®ƒï¼Œå¦‚ï¼š message SomeOtherMessage SearchResponse.Result result = 1; å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥å°†æ¶ˆæ¯åµŒå¥—ä»»æ„å¤šå±‚ï¼Œå¦‚ï¼š message Outer // Level 0 message MiddleAA // Level 1 message Inner // Level 2 int64 ival = 1; bool booly = 2; message MiddleBB // Level 1 message Inner // Level 2 int32 ival = 1; bool booly = 2; 4. å®šä¹‰æœåŠ¡å¦‚æœæƒ³è¦å°†æ¶ˆæ¯ç±»å‹ç”¨åœ¨RPC(è¿œç¨‹æ–¹æ³•è°ƒç”¨)ç³»ç»Ÿä¸­ï¼Œå¯ä»¥åœ¨.protoæ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ªRPCæœåŠ¡æ¥å£ï¼Œprotocol bufferç¼–è¯‘å™¨å°†ä¼šæ ¹æ®æ‰€é€‰æ‹©çš„ä¸åŒè¯­è¨€ç”ŸæˆæœåŠ¡æ¥å£ä»£ç åŠå­˜æ ¹ã€‚å¦‚ï¼Œæƒ³è¦å®šä¹‰ä¸€ä¸ªRPCæœåŠ¡å¹¶å…·æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•èƒ½å¤Ÿæ¥æ”¶ SearchRequestå¹¶è¿”å›ä¸€ä¸ªSearchResponseï¼Œæ­¤æ—¶å¯ä»¥åœ¨.protoæ–‡ä»¶ä¸­è¿›è¡Œå¦‚ä¸‹å®šä¹‰ï¼š service SearchService rpc Search (SearchRequest) returns (SearchResponse); æœ€ç›´è§‚çš„ä½¿ç”¨protocol bufferçš„RPCç³»ç»Ÿæ˜¯gRPCä¸€ä¸ªç”±è°·æ­Œå¼€å‘çš„è¯­è¨€å’Œå¹³å°ä¸­çš„å¼€æºçš„PRCç³»ç»Ÿï¼ŒgRPCåœ¨ä½¿ç”¨protocl bufferæ—¶éå¸¸æœ‰æ•ˆï¼Œå¦‚æœä½¿ç”¨ç‰¹æ®Šçš„protocol bufferæ’ä»¶å¯ä»¥ç›´æ¥ä¸ºæ‚¨ä».protoæ–‡ä»¶ä¸­äº§ç”Ÿç›¸å…³çš„RPCä»£ç ã€‚ å¦‚æœä½ ä¸æƒ³ä½¿ç”¨gRPCï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨protocol bufferç”¨äºè‡ªå·±çš„RPCå®ç°ï¼Œä½ å¯ä»¥ä»proto2è¯­è¨€æŒ‡å—ä¸­æ‰¾åˆ°æ›´å¤šä¿¡æ¯ è¿˜æœ‰ä¸€äº›ç¬¬ä¸‰æ–¹å¼€å‘çš„PRCå®ç°ä½¿ç”¨Protocol Bufferã€‚å‚è€ƒç¬¬ä¸‰æ–¹æ’ä»¶wikiæŸ¥çœ‹è¿™äº›å®ç°çš„åˆ—è¡¨ã€‚","tags":["protobufã€Go"],"categories":["Go"]},{"title":"GormåŸºç¡€å­¦ä¹ ","path":"/2024/09/04/GormåŸºç¡€å­¦ä¹ /","content":"1. ç®€ä»‹1.1 æ¦‚è¿°GORM æ˜¯ä¸€ä¸ª Go è¯­è¨€ç¼–å†™çš„å¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆORMï¼‰åº“ï¼Œç”¨äºç®€åŒ–ä¸æ•°æ®åº“çš„äº¤äº’ã€‚å®ƒå…è®¸å¼€å‘è€…ä½¿ç”¨ Go è¯­è¨€ä¸­çš„ç»“æ„ä½“æ¥è¡¨ç¤ºæ•°æ® åº“ä¸­çš„è¡¨ï¼Œä»è€Œé€šè¿‡ç»“æ„ä½“å’Œæ–¹æ³•æ¥æ‰§è¡Œæ•°æ®åº“æ“ä½œï¼Œæ¯”å¦‚æŸ¥è¯¢ã€æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤è®°å½•ã€‚ 1.2 å®‰è£…go get -u gorm.io/gormgo get -u gorm.io/driver/mysql 1.3 å¿«é€Ÿå…¥é—¨package mainimport ( gorm.io/gorm gorm.io/driver/sqlite)type Product struct gorm.Model Code string Price uintfunc main() db, err := gorm.Open(sqlite.Open(test.db), gorm.Config) if err != nil panic(failed to connect database) // å¦‚æœè¡¨ä¸å­˜åœ¨ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªæ–°è¡¨ï¼›å¦‚æœè¡¨å·²ç»å­˜åœ¨ï¼Œå®ƒä¼šå¯¹è¡¨è¿›è¡Œå¿…è¦çš„æ›´æ–°ï¼Œä»¥åŒ¹é…ç»“æ„ä½“ä¸­çš„å­—æ®µå’Œæ ‡ç­¾ã€‚ db.AutoMigrate(Product) // Create db.Create(ProductCode: D42, Price: 100) // Read var product Product db.First(product, 1) // æ ¹æ®æ•´å‹ä¸»é”®æŸ¥æ‰¾ db.First(product, code = ?, D42) // æŸ¥æ‰¾ code å­—æ®µå€¼ä¸º D42 çš„è®°å½• // Update - å°† product çš„ price æ›´æ–°ä¸º 200 db.Model(product).Update(Price, 200) // Update - æ›´æ–°å¤šä¸ªå­—æ®µ db.Model(product).Updates(ProductPrice: 200, Code: F42) // ä»…æ›´æ–°éé›¶å€¼å­—æ®µ db.Model(product).Updates(map[string]interfacePrice: 200, Code: F42) // Delete - åˆ é™¤ product db.Delete(product, 1) 1.4 ç‰¹æ€§ å…¨åŠŸèƒ½ ORM å…³è” (Has Oneï¼ŒHas Manyï¼ŒBelongs Toï¼ŒMany To Manyï¼Œå¤šæ€ï¼Œå•è¡¨ç»§æ‰¿) Createï¼ŒSaveï¼ŒUpdateï¼ŒDeleteï¼ŒFind ä¸­é’©å­æ–¹æ³• æ”¯æŒ Preloadã€Joins çš„é¢„åŠ è½½ äº‹åŠ¡ï¼ŒåµŒå¥—äº‹åŠ¡ï¼ŒSave Pointï¼ŒRollback To Saved Point Contextã€é¢„ç¼–è¯‘æ¨¡å¼ã€DryRun æ¨¡å¼ æ‰¹é‡æ’å…¥ï¼ŒFindInBatchesï¼ŒFindCreate with Mapï¼Œä½¿ç”¨ SQL è¡¨è¾¾å¼ã€Context Valuer è¿›è¡Œ CRUD SQL æ„å»ºå™¨ï¼ŒUpsertï¼Œæ•°æ®åº“é”ï¼ŒOptimizerIndexComment Hintï¼Œå‘½åå‚æ•°ï¼Œå­æŸ¥è¯¢ å¤åˆä¸»é”®ï¼Œç´¢å¼•ï¼Œçº¦æŸ Auto Migration è‡ªå®šä¹‰ Logger çµæ´»çš„å¯æ‰©å±•æ’ä»¶ APIï¼šDatabase Resolverï¼ˆå¤šæ•°æ®åº“ï¼Œè¯»å†™åˆ†ç¦»ï¼‰ã€Prometheusâ€¦ æ¯ä¸ªç‰¹æ€§éƒ½ç»è¿‡äº†æµ‹è¯•çš„é‡é‡è€ƒéªŒ å¼€å‘è€…å‹å¥½ 2. æ¨¡å‹GORM é€šè¿‡å°† Go ç»“æ„ä½“ï¼ˆGo structsï¼‰ æ˜ å°„åˆ°æ•°æ®åº“è¡¨æ¥ç®€åŒ–æ•°æ®åº“äº¤äº’ã€‚ äº†è§£å¦‚ä½•åœ¨GORMä¸­å®šä¹‰æ¨¡å‹ï¼Œæ˜¯å……åˆ†åˆ©ç”¨GORMå…¨éƒ¨åŠŸ èƒ½çš„åŸºç¡€ã€‚ 2.1 æ¨¡å‹å®šä¹‰æ¨¡å‹æ˜¯ä½¿ç”¨æ™®é€šç»“æ„ä½“å®šä¹‰çš„ã€‚ è¿™äº›ç»“æ„ä½“å¯ä»¥åŒ…å«å…·æœ‰åŸºæœ¬Goç±»å‹ã€æŒ‡é’ˆæˆ–è¿™äº›ç±»å‹çš„åˆ«åï¼Œç”šè‡³æ˜¯è‡ªå®šä¹‰ç±»å‹ï¼ˆåªéœ€è¦å®ç° database/sql åŒ…ä¸­çš„Scannerå’ŒValueræ¥å£ï¼‰ã€‚ è€ƒè™‘ä»¥ä¸‹ user æ¨¡å‹çš„ç¤ºä¾‹ï¼š type User struct ID uint // Standard field for the primary key Name string // ä¸€ä¸ªå¸¸è§„å­—ç¬¦ä¸²å­—æ®µ Email *string // ä¸€ä¸ªæŒ‡å‘å­—ç¬¦ä¸²çš„æŒ‡é’ˆ, allowing for null values Age uint8 // ä¸€ä¸ªæœªç­¾åçš„8ä½æ•´æ•° Birthday *time.Time // A pointer to time.Time, can be null MemberNumber sql.NullString // Uses sql.NullString to handle nullable strings ActivatedAt sql.NullTime // Uses sql.NullTime for nullable time fields CreatedAt time.Time // åˆ›å»ºæ—¶é—´ï¼ˆç”±GORMè‡ªåŠ¨ç®¡ç†ï¼‰ UpdatedAt time.Time // æœ€åä¸€æ¬¡æ›´æ–°æ—¶é—´ï¼ˆç”±GORMè‡ªåŠ¨ç®¡ç†ï¼‰ åœ¨æ­¤æ¨¡å‹ä¸­ï¼š å…·ä½“æ•°å­—ç±»å‹å¦‚ uintã€stringå’Œ uint8 ç›´æ¥ä½¿ç”¨ã€‚ æŒ‡å‘ *string å’Œ *time.Time ç±»å‹çš„æŒ‡é’ˆè¡¨ç¤ºå¯ç©ºå­—æ®µã€‚ æ¥è‡ª database/sql åŒ…çš„ sql.NullString å’Œ sql.NullTime ç”¨äºå…·æœ‰æ›´å¤šæ§åˆ¶çš„å¯ç©ºå­—æ®µã€‚ CreatedAt å’Œ UpdatedAt æ˜¯ç‰¹æ®Šå­—æ®µï¼Œå½“è®°å½•è¢«åˆ›å»ºæˆ–æ›´æ–°æ—¶ï¼ŒGORM ä¼šè‡ªåŠ¨å‘å†…å¡«å……å½“å‰æ—¶é—´ã€‚ 2.2 çº¦å®š ä¸»é”®ï¼šGORM ä½¿ç”¨ä¸€ä¸ªåä¸ºID çš„å­—æ®µä½œä¸ºæ¯ä¸ªæ¨¡å‹çš„é»˜è®¤ä¸»é”®ã€‚ è¡¨åï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒGORM å°†ç»“æ„ä½“åç§°è½¬æ¢ä¸º snake_case å¹¶ä¸ºè¡¨ååŠ ä¸Šå¤æ•°å½¢å¼ã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ª User ç»“æ„ä½“åœ¨æ•°æ®åº“ä¸­çš„è¡¨åå˜ä¸º users ã€‚ åˆ—åï¼šGORM è‡ªåŠ¨å°†ç»“æ„ä½“å­—æ®µåç§°è½¬æ¢ä¸º snake_case ä½œä¸ºæ•°æ®åº“ä¸­çš„åˆ—åã€‚ æ—¶é—´æˆ³å­—æ®µï¼šGORMä½¿ç”¨å­—æ®µ CreatedAt å’Œ UpdatedAt æ¥è‡ªåŠ¨è·Ÿè¸ªè®°å½•çš„åˆ›å»ºå’Œæ›´æ–°æ—¶é—´ã€‚ éµå¾ªè¿™äº›çº¦å®šå¯ä»¥å¤§å¤§å‡å°‘éœ€è¦ç¼–å†™çš„é…ç½®æˆ–ä»£ç é‡ã€‚ ä½†æ˜¯ï¼ŒGORMä¹Ÿå…·æœ‰çµæ´»æ€§ï¼Œå…è®¸æ ¹æ®è‡ªå·±çš„éœ€æ±‚è‡ªå®šä¹‰è¿™äº›è®¾ç½®ã€‚ å¯ä»¥åœ¨GORMçš„çº¦å®šæ–‡æ¡£ä¸­äº†è§£æ›´å¤šå…³äºè‡ªå®šä¹‰è¿™äº›çº¦å®šçš„ä¿¡æ¯ã€‚ 2.3 gorm.ModelGORMæä¾›äº†ä¸€ä¸ªé¢„å®šä¹‰çš„ç»“æ„ä½“ï¼Œåä¸ºgorm.Modelï¼Œå…¶ä¸­åŒ…å«å¸¸ç”¨å­—æ®µï¼š // gorm.Model çš„å®šä¹‰type Model struct ID uint `gorm:primaryKey` CreatedAt time.Time UpdatedAt time.Time DeletedAt gorm.DeletedAt `gorm:index` å°†å…¶åµŒå…¥åœ¨æ‚¨çš„ç»“æ„ä½“ä¸­: æ‚¨å¯ä»¥ç›´æ¥åœ¨æ‚¨çš„ç»“æ„ä½“ä¸­åµŒå…¥ gorm.Model ï¼Œä»¥ä¾¿è‡ªåŠ¨åŒ…å«è¿™äº›å­—æ®µã€‚ è¿™å¯¹äºåœ¨ä¸åŒæ¨¡å‹ä¹‹é—´ä¿æŒä¸€è‡´æ€§å¹¶åˆ©ç”¨GORMå†…ç½®çš„çº¦å®šéå¸¸æœ‰ç”¨ï¼Œè¯·å‚è€ƒåµŒå…¥ç»“æ„ã€‚ åŒ…å«çš„å­—æ®µï¼š ID ï¼šæ¯ä¸ªè®°å½•çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆä¸»é”®ï¼‰ã€‚ CreatedAt ï¼šåœ¨åˆ›å»ºè®°å½•æ—¶è‡ªåŠ¨è®¾ç½®ä¸ºå½“å‰æ—¶é—´ã€‚ UpdatedAtï¼šæ¯å½“è®°å½•æ›´æ–°æ—¶ï¼Œè‡ªåŠ¨æ›´æ–°ä¸ºå½“å‰æ—¶é—´ã€‚ DeletedAtï¼šç”¨äºè½¯åˆ é™¤ï¼ˆå°†è®°å½•æ ‡è®°ä¸ºå·²åˆ é™¤ï¼Œè€Œå®é™…ä¸Šå¹¶æœªä»æ•°æ®åº“ä¸­åˆ é™¤ï¼‰ã€‚ 2.4 é«˜çº§é€‰é¡¹2.4.1 åµŒå…¥ç»“æ„ä½“å¯¹äºåŒ¿åå­—æ®µï¼ŒGORM ä¼šå°†å…¶å­—æ®µåŒ…å«åœ¨çˆ¶ç»“æ„ä½“ä¸­ï¼Œä¾‹å¦‚ï¼š type User struct gorm.Model Name string// ç­‰æ•ˆäºtype User struct ID uint `gorm:primaryKey` CreatedAt time.Time UpdatedAt time.Time DeletedAt gorm.DeletedAt `gorm:index` Name string å¯¹äºæ­£å¸¸çš„ç»“æ„ä½“å­—æ®µï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡æ ‡ç­¾ embedded å°†å…¶åµŒå…¥ï¼Œä¾‹å¦‚ï¼š type Author struct Name string Email stringtype Blog struct ID int Author Author `gorm:embedded` Upvotes int32// ç­‰æ•ˆäºtype Blog struct ID int64 Name string Email string Upvotes int32 å¹¶ä¸”ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ ‡ç­¾ embeddedPrefix æ¥ä¸º db ä¸­çš„å­—æ®µåæ·»åŠ å‰ç¼€ï¼Œä¾‹å¦‚ï¼š type Blog struct ID int Author Author `gorm:embedded;embeddedPrefix:author_` Upvotes int32// ç­‰æ•ˆäºtype Blog struct ID int64 AuthorName string AuthorEmail string Upvotes int32 2.4.2 å­—æ®µæ ‡ç­¾ æ ‡ç­¾å è¯´æ˜ column æŒ‡å®š db åˆ—å type åˆ—æ•°æ®ç±»å‹ï¼Œæ¨èä½¿ç”¨å…¼å®¹æ€§å¥½çš„é€šç”¨ç±»å‹ï¼Œä¾‹å¦‚ï¼šæ‰€æœ‰æ•°æ®åº“éƒ½æ”¯æŒ boolã€intã€uintã€floatã€stringã€timeã€bytes å¹¶ä¸”å¯ä»¥å’Œå…¶ä»–æ ‡ç­¾ä¸€èµ·ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼šnot nullã€size, autoIncrementâ€¦ åƒ varbinary(8) è¿™æ ·æŒ‡å®šæ•°æ®åº“æ•°æ®ç±»å‹ä¹Ÿæ˜¯æ”¯æŒçš„ã€‚åœ¨ä½¿ç”¨æŒ‡å®šæ•°æ®åº“æ•°æ®ç±»å‹æ—¶ï¼Œå®ƒéœ€è¦æ˜¯å®Œæ•´çš„æ•°æ®åº“æ•°æ®ç±»å‹ï¼Œå¦‚ï¼šMEDIUMINT UNSIGNED not NULL AUTO_INCREMENT serializer æŒ‡å®šå°†æ•°æ®åºåˆ—åŒ–æˆ–ååºåˆ—åŒ–åˆ°æ•°æ®åº“ä¸­çš„åºåˆ—åŒ–å™¨, ä¾‹å¦‚: serializer:json/gob/unixtime size å®šä¹‰åˆ—æ•°æ®ç±»å‹çš„å¤§å°æˆ–é•¿åº¦ï¼Œä¾‹å¦‚ size: 256 primaryKey å°†åˆ—å®šä¹‰ä¸ºä¸»é”® unique å°†åˆ—å®šä¹‰ä¸ºå”¯ä¸€é”® default å®šä¹‰åˆ—çš„é»˜è®¤å€¼ precision æŒ‡å®šåˆ—çš„ç²¾åº¦ scale æŒ‡å®šåˆ—å¤§å° not null æŒ‡å®šåˆ—ä¸º NOT NULL autoIncrement æŒ‡å®šåˆ—ä¸ºè‡ªåŠ¨å¢é•¿ autoIncrementIncrement è‡ªåŠ¨æ­¥é•¿ï¼Œæ§åˆ¶è¿ç»­è®°å½•ä¹‹é—´çš„é—´éš” embedded åµŒå¥—å­—æ®µ embeddedPrefix åµŒå…¥å­—æ®µçš„åˆ—åå‰ç¼€ autoCreateTime åˆ›å»ºæ—¶è¿½è¸ªå½“å‰æ—¶é—´ï¼Œå¯¹äº int å­—æ®µï¼Œå®ƒä¼šè¿½è¸ªæ—¶é—´æˆ³ç§’æ•°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ nanomilli æ¥è¿½è¸ªçº³ç§’ã€æ¯«ç§’æ—¶é—´æˆ³ï¼Œä¾‹å¦‚ï¼šautoCreateTime:nano autoUpdateTime åˆ›å»ºæ›´æ–°æ—¶è¿½è¸ªå½“å‰æ—¶é—´ï¼Œå¯¹äº int å­—æ®µï¼Œå®ƒä¼šè¿½è¸ªæ—¶é—´æˆ³ç§’æ•°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ nanomilli æ¥è¿½è¸ªçº³ç§’ã€æ¯«ç§’æ—¶é—´æˆ³ï¼Œä¾‹å¦‚ï¼šautoUpdateTime:milli index æ ¹æ®å‚æ•°åˆ›å»ºç´¢å¼•ï¼Œå¤šä¸ªå­—æ®µä½¿ç”¨ç›¸åŒçš„åç§°åˆ™åˆ›å»ºå¤åˆç´¢å¼•ï¼ŒæŸ¥çœ‹ ç´¢å¼• è·å–è¯¦æƒ… uniqueIndex ä¸ index ç›¸åŒï¼Œä½†åˆ›å»ºçš„æ˜¯å”¯ä¸€ç´¢å¼• check åˆ›å»ºæ£€æŸ¥çº¦æŸï¼Œä¾‹å¦‚ check:age 13ï¼ŒæŸ¥çœ‹ çº¦æŸ è·å–è¯¦æƒ… - è®¾ç½®å­—æ®µå†™å…¥çš„æƒé™ï¼Œ -:create åªåˆ›å»ºã€-:update åªæ›´æ–°ã€-:false æ— å†™å…¥æƒé™ã€- åˆ›å»ºå’Œæ›´æ–°æƒé™ - è®¾ç½®å­—æ®µè¯»çš„æƒé™ï¼Œ-:false æ— è¯»æƒé™ - å¿½ç•¥è¯¥å­—æ®µï¼Œ- è¡¨ç¤ºæ— è¯»å†™ï¼Œ-:migration è¡¨ç¤ºæ— è¿ç§»æƒé™ï¼Œ-:all è¡¨ç¤ºæ— è¯»å†™è¿ç§»æƒé™ comment è¿ç§»æ—¶ä¸ºå­—æ®µæ·»åŠ æ³¨é‡Š GORM å…è®¸é€šè¿‡æ ‡ç­¾ä¸ºå…³è”é…ç½®å¤–é”®ã€çº¦æŸã€many2many è¡¨ï¼Œè¯¦æƒ…è¯·å‚è€ƒ å…³è”éƒ¨åˆ† type Order struct ID uint `gorm:primaryKey;autoIncrement` OrderNumber string `gorm:type:varchar(50);uniqueIndex;not null` // è®¢å•å·ï¼Œå”¯ä¸€ï¼Œä¸èƒ½ä¸ºç©º Amount float64 `gorm:type:decimal(12,2);not null` // é‡‘é¢ï¼Œæœ€å¤š 12 ä½ï¼Œ2 ä½å°æ•°ï¼Œä¸èƒ½ä¸ºç©º Status string `gorm:type:varchar(20);default:pending` // çŠ¶æ€ï¼Œé»˜è®¤å€¼ pending UserID uint `gorm:index` // å¤–é”®ç´¢å¼• User User `gorm:foreignKey:UserID` // å…³è” User è¡¨ CreatedAt time.Time UpdatedAt time.Time 3. CRUD3.1 åˆ›å»º3.1.1 åˆ›å»ºè®°å½•package mainimport (\tfmt\ttime\tgorm.io/driver/mysql\tgorm.io/gorm)type User struct ID uint `gorm:primaryKey` // ä¸»é”®\tName string `gorm:size:100;not null` // å­—ç¬¦ä¸²å­—æ®µï¼Œæœ€å¤§é•¿åº¦ 100ï¼Œä¸èƒ½ä¸ºç©º\tAge int `gorm:default:18` // é»˜è®¤å€¼ 18\tBirthday time.Time\tCreatedAt time.Time\tUpdatedAt time.Timefunc main() dsn := root:strong_root_password@tcp(www.devlop.com:3306)/test?charset=utf8mb4parseTime=Trueloc=Local\tdb, err := gorm.Open(mysql.Open(dsn), gorm.Config)\tif err != nil panic(failed to connect database) user := UserName: å¼ ä¸‰, Age: 18, Birthday: time.Now()\tdb.AutoMigrate(User) res := db.Create(user) fmt.Println(user.ID) // è¿”å›æ’å…¥æ•°æ®çš„ä¸»é”®\tfmt.Println(res.Error) // è¿”å› error\tfmt.Println(res.RowsAffected) // è¿”å›æ’å…¥è®°å½•çš„æ¡æ•° users := []User Name: é‡Œæ–¯, Age: 19, Birthday: time.Now(), Name: é‡Œæ–¯2, Age: 191, Birthday: time.Now(), // åˆ›å»ºå¤šæ¡è®°å½•\tres := db.Create(users) æ³¨æ„ï¼šä¼ é€’è¿‡å»çš„æ˜¯ç»“æ„ä½“æŒ‡é’ˆ 3.1.2 ç”¨æŒ‡å®šå­—æ®µåˆ›å»ºè®°å½•package mainimport (\ttime\tgorm.io/driver/mysql\tgorm.io/gorm)type User struct ID uint `gorm:primaryKey` // ä¸»é”®\tName string `gorm:size:100;not null` // å­—ç¬¦ä¸²å­—æ®µï¼Œæœ€å¤§é•¿åº¦ 100ï¼Œä¸èƒ½ä¸ºç©º\tAge int `gorm:default:18` // é»˜è®¤å€¼ 18\tBirthday time.Time\tCreatedAt time.Time\tUpdatedAt time.Timefunc main() dsn := root:strong_root_password@tcp(www.devlop.com:3306)/test?charset=utf8mb4parseTime=Trueloc=Local\tdb, err := gorm.Open(mysql.Open(dsn), gorm.Config)\tif err != nil panic(failed to connect database) user := UserName: Jinzhu, Age: 18, Birthday: time.Now() // åˆ›å»ºè®°å½•å¹¶ä¸ºæŒ‡å®šå­—æ®µèµ‹å€¼ // INSERT INTO `users` (`name`,`age`,`created_at`) VALUES (jinzhu, 18, 2024-09-04 17:31:05.456)\tdb.Select(Name, Age, CreatedAt).Create(user) // åˆ›å»ºè®°å½•å¹¶å¿½ç•¥ä¼ é€’ç»™ â€˜Omitâ€™ çš„å­—æ®µå€¼ // INSERT INTO `users` (`birthday`,`updated_at`) VALUES (2024-09-04 17:31:05.456, 2024-09-04 17:31:05.456) db.Omit(Name, Age, CreatedAt).Create(user) 3.1.3 ä½¿ç”¨Mapåˆ›å»ºGORMæ”¯æŒé€šè¿‡ map[string]interface ä¸ []map[string]interfaceæ¥åˆ›å»ºè®°å½•ã€‚ db.Model(User).Create(map[string]interface Name: jinzhu, Age: 18,)// batch insert from `[]map[string]interface`db.Model(User).Create([]map[string]interface Name: jinzhu_1, Age: 18, Name: jinzhu_2, Age: 20,) æ³¨æ„å½“ä½¿ç”¨mapæ¥åˆ›å»ºæ—¶ï¼Œé’©å­æ–¹æ³•ä¸ä¼šæ‰§è¡Œï¼Œå…³è”ä¸ä¼šè¢«ä¿å­˜ä¸”ä¸ä¼šå›å†™ä¸»é”®ã€‚ 3.1.4 æ‰¹é‡æ’å…¥package mainimport (\tfmt\ttime\tgorm.io/driver/mysql\tgorm.io/gorm)type User struct ID uint `gorm:primaryKey` // ä¸»é”®\tName string `gorm:size:100;not null` // å­—ç¬¦ä¸²å­—æ®µï¼Œæœ€å¤§é•¿åº¦ 100ï¼Œä¸èƒ½ä¸ºç©º\tAge int `gorm:default:18` // é»˜è®¤å€¼ 18\tCreatedAt time.Time\tUpdatedAt time.Timefunc main() dsn := root:strong_root_password@tcp(www.devlop.com:3306)/test?charset=utf8mb4parseTime=Trueloc=Local\tdb, err := gorm.Open(mysql.Open(dsn), gorm.Config)\tif err != nil panic(failed to connect database) var users = []UserName: jinzhu1, Name: jinzhu2, Name: jinzhu3\tdb.Create(users)\tfor _, user := range users fmt.Println(user.ID) // 1,2,3 å¯ä»¥é€šè¿‡db.CreateInBatchesæ–¹æ³•æ¥æŒ‡å®šæ‰¹é‡æ’å…¥çš„æ‰¹æ¬¡å¤§å°ã€‚ var users = []UserName: jinzhu1, Name: jinzhu2, Name: jinzhu3// batch size 2// è¿™é‡Œå¯ä»¥ç”¨usersæˆ–usersdb.CreateInBatches(users, 2) æ³¨æ„ ä½¿ç”¨CreateBatchSize é€‰é¡¹åˆå§‹åŒ–GORMå®ä¾‹åï¼Œæ­¤åè¿›è¡Œåˆ›å»º å…³è”æ“ä½œæ—¶æ‰€æœ‰çš„INSERTè¡Œä¸ºéƒ½ä¼šéµå¾ªåˆå§‹åŒ–æ—¶çš„é…ç½®ã€‚ db, err := gorm.Open(sqlite.Open(gorm.db), gorm.Config CreateBatchSize: 1000,)db := db.Session(gorm.SessionCreateBatchSize: 1000)users = [5000]UserName: jinzhu, Pets: []Petpet1, pet2, pet3...db.Create(users)// INSERT INTO users xxx (5 batches)// INSERT INTO pets xxx (15 batches) 3.1.5 åˆ›å»ºé’©å­GROMå…è®¸ç”¨æˆ·é€šè¿‡å®ç°è¿™äº›æ¥å£ BeforeSave, BeforeCreate, AfterSave, AfterCreateæ¥è‡ªå®šä¹‰é’©å­ã€‚ è¿™äº›é’©å­æ–¹æ³•ä¼šåœ¨åˆ›å»ºä¸€æ¡è®°å½•æ—¶è¢«è°ƒç”¨ï¼Œå…³äºé’©å­çš„ç”Ÿå‘½å‘¨æœŸè¯·å‚é˜…Hooksã€‚ func (u *User) BeforeCreate(tx *gorm.DB) (err error) u.UUID = uuid.New() if u.Role == admin return errors.New(invalid role) return å¦‚æœä½ æƒ³è·³è¿‡Hooksæ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨SkipHooksä¼šè¯æ¨¡å¼ï¼Œä¾‹å­å¦‚ä¸‹ DB.Session(gorm.SessionSkipHooks: true).Create(user)DB.Session(gorm.SessionSkipHooks: true).Create(users)DB.Session(gorm.SessionSkipHooks: true).CreateInBatches(users, 100) 3.2 æŸ¥è¯¢3.2.1 æŸ¥è¯¢å•ä¸ªå¯¹è±¡GORM æä¾›äº† Firstã€Takeã€Last æ–¹æ³•ï¼Œä»¥ä¾¿ä»æ•°æ®åº“ä¸­æ£€ç´¢å•ä¸ªå¯¹è±¡ã€‚å½“æŸ¥è¯¢æ•°æ®åº“æ—¶å®ƒæ·»åŠ äº† LIMIT 1 æ¡ä»¶ï¼Œä¸”æ²¡æœ‰æ‰¾åˆ°è®°å½•æ—¶ï¼Œå®ƒä¼šè¿”å› ErrRecordNotFound é”™è¯¯ã€‚ package mainimport (\tfmt\ttime\tgorm.io/driver/mysql\tgorm.io/gorm)type User struct ID uint `gorm:primaryKey` // ä¸»é”®\tName string `gorm:size:100;not null` // å­—ç¬¦ä¸²å­—æ®µï¼Œæœ€å¤§é•¿åº¦ 100ï¼Œä¸èƒ½ä¸ºç©º\tAge int `gorm:default:18` // é»˜è®¤å€¼ 18\tCreatedAt time.Time\tUpdatedAt time.Timefunc main() dsn := root:strong_root_password@tcp(www.devlop.com:3306)/test?charset=utf8mb4parseTime=Trueloc=Local\tdb, err := gorm.Open(mysql.Open(dsn), gorm.Config)\tif err != nil panic(failed to connect database) var user User // è·å–ç¬¬ä¸€æ¡è®°å½•ï¼ˆä¸»é”®å‡åºï¼‰ db.First(user) // SELECT * FROM users ORDER BY id LIMIT 1; fmt.Println(user) // 21 jinzhu 19 0001-01-01 00:00:00 +0000 UTC 0001-01-01 00:00:00 +0000 UTC // è·å–ä¸€æ¡è®°å½•ï¼Œæ²¡æœ‰æŒ‡å®šæ’åºå­—æ®µ db.Take(user) // SELECT * FROM users LIMIT 1; fmt.Println(user) // 21 jinzhu 19 0001-01-01 00:00:00 +0000 UTC 0001-01-01 00:00:00 +0000 UTC // è·å–æœ€åä¸€æ¡è®°å½•ï¼ˆä¸»é”®é™åºï¼‰ db.Last(user) // SELECT * FROM users ORDER BY id DESC LIMIT 1; result := db.First(user) result.RowsAffected // è¿”å›æ‰¾åˆ°çš„è®°å½•æ•° result.Error // returns error or nil // æ£€æŸ¥ ErrRecordNotFound é”™è¯¯ errors.Is(result.Error, gorm.ErrRecordNotFound) å¦‚æœä½ æƒ³é¿å…ErrRecordNotFoundé”™è¯¯ï¼Œä½ å¯ä»¥ä½¿ç”¨Findï¼Œæ¯”å¦‚db.Limit(1).Find(user)ï¼ŒFindæ–¹æ³•å¯ä»¥æ¥å—structå’Œsliceçš„æ•°æ®ã€‚ å¯¹å•ä¸ªå¯¹è±¡ä½¿ç”¨Findè€Œä¸å¸¦limitï¼Œdb.Find(user)å°†ä¼šæŸ¥è¯¢æ•´ä¸ªè¡¨å¹¶ä¸”åªè¿”å›ç¬¬ä¸€ä¸ªå¯¹è±¡ï¼Œåªæ˜¯æ€§èƒ½ä¸é«˜å¹¶ä¸”ä¸ç¡®å®šçš„ã€‚ First and Last æ–¹æ³•ä¼šæŒ‰ä¸»é”®æ’åºæ‰¾åˆ°ç¬¬ä¸€æ¡è®°å½•å’Œæœ€åä¸€æ¡è®°å½• (åˆ†åˆ«)ã€‚ åªæœ‰åœ¨ç›®æ ‡ struct æ˜¯æŒ‡é’ˆæˆ–è€…é€šè¿‡ db.Model() æŒ‡å®šçš„ model æ—¶ï¼Œè¯¥æ–¹æ³•æ‰æœ‰æ•ˆã€‚ æ­¤å¤–ï¼Œå¦‚æœç›¸å…³ model æ²¡æœ‰å®šä¹‰ä¸»é”®ï¼Œé‚£ä¹ˆå°†æŒ‰ model çš„ç¬¬ä¸€ä¸ªå­—æ®µè¿›è¡Œæ’åºã€‚ ä¾‹å¦‚ï¼š var user Uservar users []User// works because destination struct is passed in// è¿™é‡Œä½¿ç”¨äº†useræ¨¡å‹ï¼Œèƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œdb.First(user)// SELECT * FROM `users` ORDER BY `users`.`id` LIMIT 1// works because model is specified using `db.Model()`result := map[string]interface// è¿™é‡Œä½¿ç”¨äº†db.Model()èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œdb.Model(User).First(result)// SELECT * FROM `users` ORDER BY `users`.`id` LIMIT 1// doesnt work// ä¸¤è€…éƒ½æ²¡ç”¨ä½¿ç”¨FirstæŸ¥è¯¢ä¸ä¼šæ­£å¸¸æ‰§è¡Œresult := map[string]interfacedb.Table(users).First(result)// works with Takeresult := map[string]interface// ä½¿ç”¨takeæ–¹æ³•æ­£å¸¸æ‰§è¡Œ// map[age:19 birthday:nil created_at:nil id:21 name:jinzhu updated_at:nil]db.Table(users).Take(result)// no primary key defined, results will be ordered by first field (i.e., `Code`)type Language struct Code string Name stringdb.First(Language)// SELECT * FROM `languages` ORDER BY `languages`.`code` LIMIT 1 3.2.2 æ ¹æ®ä¸»é”®æŸ¥è¯¢å¦‚æœä¸»é”®æ˜¯æ•°å­—ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ å†…è”æ¡ä»¶ æ¥æ£€ç´¢å¯¹è±¡ã€‚ å½“ä½¿ç”¨å­—ç¬¦ä¸²æ—¶ï¼Œéœ€è¦é¢å¤–çš„æ³¨æ„æ¥é¿å…SQLæ³¨å…¥ï¼›æŸ¥çœ‹ Security éƒ¨åˆ†æ¥äº†è§£è¯¦æƒ…ã€‚ db.First(user, 10)// SELECT * FROM users WHERE id = 10;db.First(user, 10)// SELECT * FROM users WHERE id = 10;db.Find(users, []int1,2,3)// SELECT * FROM users WHERE id IN (1,2,3); å¦‚æœä¸»é”®æ˜¯å­—ç¬¦ä¸²(ä¾‹å¦‚åƒuuid)ï¼ŒæŸ¥è¯¢å°†è¢«å†™æˆå¦‚ä¸‹ï¼š db.First(user, id = ?, 1b74413f-f3b8-409f-ac47-e8c062e3472a)// SELECT * FROM users WHERE id = 1b74413f-f3b8-409f-ac47-e8c062e3472a; å½“ç›®æ ‡å¯¹è±¡æœ‰ä¸€ä¸ªä¸»é”®å€¼æ—¶ï¼Œå°†ä½¿ç”¨ä¸»é”®æ„å»ºæŸ¥è¯¢æ¡ä»¶ï¼Œä¾‹å¦‚ï¼š var user = UserID: 10db.First(user)// SELECT * FROM users WHERE id = 10;var result Userdb.Model(UserID: 10).First(result)// SELECT * FROM users WHERE id = 10; NOTE: å¦‚æœä½¿ç”¨ gorm çš„ç‰¹å®šå­—æ®µç±»å‹ï¼ˆä¾‹å¦‚ gorm.DeletedAtï¼‰ï¼Œå®ƒå°†è¿è¡Œä¸åŒçš„æŸ¥è¯¢æ¥æ£€ç´¢å¯¹è±¡ã€‚ type User struct ID string `gorm:primarykey;size:16` Name string `gorm:size:24` DeletedAt gorm.DeletedAt `gorm:index`var user = UserID: 15db.First(user)// SELECT * FROM `users` WHERE `users`.`id` = 15 AND `users`.`deleted_at` IS NUL 3.2.3 æŸ¥è¯¢å…¨éƒ¨å¯¹è±¡package mainimport (\tfmt\ttime\tgorm.io/driver/mysql\tgorm.io/gorm)type User struct ID uint `gorm:primaryKey` // ä¸»é”®\tName string `gorm:size:100;not null` // å­—ç¬¦ä¸²å­—æ®µï¼Œæœ€å¤§é•¿åº¦ 100ï¼Œä¸èƒ½ä¸ºç©º\tAge int `gorm:default:18` // é»˜è®¤å€¼ 18\tCreatedAt time.Time\tUpdatedAt time.Timefunc main() dsn := root:strong_root_password@tcp(www.devlop.com:3306)/test?charset=utf8mb4parseTime=Trueloc=Local\tdb, err := gorm.Open(mysql.Open(dsn), gorm.Config)\tif err != nil panic(failed to connect database) var users []User // SELECT * FROM users; result := db.Find(users)\tfmt.Println(users) result.RowsAffected // returns found records count, equals `len(users)`\tresult.Error // returns error 3.2.4 æ¡ä»¶æŸ¥è¯¢3.2.4.1 string// Get first matched recorddb.Where(name = ?, jinzhu).First(user)// SELECT * FROM users WHERE name = jinzhu ORDER BY id LIMIT 1;// Get all matched recordsdb.Where(name ?, jinzhu).Find(users)// SELECT * FROM users WHERE name jinzhu;// INdb.Where(name IN ?, []stringjinzhu, jinzhu 2).Find(users)// SELECT * FROM users WHERE name IN (jinzhu,jinzhu 2);// LIKEdb.Where(name LIKE ?, %jin%).Find(users)// SELECT * FROM users WHERE name LIKE %jin%;// ANDdb.Where(name = ? AND age = ?, jinzhu, 22).Find(users)// SELECT * FROM users WHERE name = jinzhu AND age = 22;// Timedb.Where(updated_at ?, lastWeek).Find(users)// SELECT * FROM users WHERE updated_at 2000-01-01 00:00:00;// BETWEENdb.Where(created_at BETWEEN ? AND ?, lastWeek, today).Find(users)// SELECT * FROM users WHERE created_at BETWEEN 2000-01-01 00:00:00 AND 2000-01-08 00:00:00; å¦‚æœå¯¹è±¡è®¾ç½®äº†ä¸»é”®ï¼Œæ¡ä»¶æŸ¥è¯¢å°†ä¸ä¼šè¦†ç›–ä¸»é”®çš„å€¼ï¼Œè€Œæ˜¯ç”¨ And è¿æ¥æ¡ä»¶ã€‚ ä¾‹å¦‚ï¼š var user = UserID: 10db.Where(id = ?, 20).First(user)// SELECT * FROM users WHERE id = 10 and id = 20 ORDER BY id ASC LIMIT 1 è¿™ä¸ªæŸ¥è¯¢å°†ä¼šç»™å‡ºrecord not foundé”™è¯¯ æ‰€ä»¥ï¼Œåœ¨ä½ æƒ³è¦ä½¿ç”¨ä¾‹å¦‚ user è¿™æ ·çš„å˜é‡ä»æ•°æ®åº“ä¸­è·å–æ–°å€¼å‰ï¼Œéœ€è¦å°†ä¾‹å¦‚ id è¿™æ ·çš„ä¸»é”®è®¾ç½®ä¸ºnilã€‚ 3.2.4.2 sturcmap// Structdb.Where(UserName: jinzhu, Age: 20).First(user)// SELECT * FROM users WHERE name = jinzhu AND age = 20 ORDER BY id LIMIT 1;// Mapdb.Where(map[string]interfacename: jinzhu, age: 20).Find(users)// SELECT * FROM users WHERE name = jinzhu AND age = 20;// Slice of primary keysdb.Where([]int6420, 21, 22).Find(users)// SELECT * FROM users WHERE id IN (20, 21, 22); NOTE When querying with struct, GORM will only query with non-zero fields, that means if your fieldâ€™s value is 0, , false or other zero values, it wonâ€™t be used to build query conditions, for example: å½“ä½¿ç”¨ struct æ¨¡å¼æŸ¥è¯¢ä¸”å­—æ®µä¸º0å€¼æ—¶ï¼Œè¿™ä¸ªå­—æ®µä¸ä¼šå‡ºç°å†æ„å»ºçš„ sql è¯­å¥ä¸­ï¼š db.Where(UserName: jinzhu, Age: 0).Find(users)// SELECT * FROM users WHERE name = jinzhu; To include zero values in the query conditions, you can use a map, which will include all key-values as query conditions, for example: å¦‚æœè¦åŒ…å«é›¶å€¼å­—æ®µä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ mapï¼š db.Where(map[string]interfaceName: jinzhu, Age: 0).Find(users)// SELECT * FROM users WHERE name = jinzhu AND age = 0; ä¹Ÿå¯ä»¥åœ¨ struct ä¸­æŒ‡å®šå­—æ®µï¼š db.Where(UserName: jinzhu, name, Age).Find(users)// SELECT * FROM users WHERE name = jinzhu AND age = 0;db.Where(UserName: jinzhu, Age).Find(users)// SELECT * FROM users WHERE age = 0; 3.2.4.3 å†…è”æŸ¥è¯¢æŸ¥è¯¢æ¡ä»¶å¯ä»¥ä»¥ç±»ä¼¼äº Where çš„æ–¹å¼å†…è”åˆ° First å’Œ Find ç­‰æ–¹æ³•ä¸­ã€‚ // Get by primary key if it were a non-integer typedb.First(user, id = ?, string_primary_key)// SELECT * FROM users WHERE id = string_primary_key;// Plain SQLdb.Find(user, name = ?, jinzhu)// SELECT * FROM users WHERE name = jinzhu;db.Find(users, name ? AND age ?, jinzhu, 20)// SELECT * FROM users WHERE name jinzhu AND age 20;// Structdb.Find(users, UserAge: 20)// SELECT * FROM users WHERE age = 20;// Mapdb.Find(users, map[string]interfaceage: 20)// SELECT * FROM users WHERE age = 20; 3.2.4.4 Notdb.Not(name = ?, jinzhu).First(user)// SELECT * FROM users WHERE NOT name = jinzhu ORDER BY id LIMIT 1;// Not Indb.Not(map[string]interfacename: []stringjinzhu, jinzhu 2).Find(users)// SELECT * FROM users WHERE name NOT IN (jinzhu, jinzhu 2);// Structdb.Not(UserName: jinzhu, Age: 18).First(user)// SELECT * FROM users WHERE name jinzhu AND age 18 ORDER BY id LIMIT 1;// Not In slice of primary keysdb.Not([]int641,2,3).First(user)// SELECT * FROM users WHERE id NOT IN (1,2,3) ORDER BY id LIMIT 1; 3.2.4.5 Ordb.Where(role = ?, admin).Or(role = ?, super_admin).Find(users)// SELECT * FROM users WHERE role = admin OR role = super_admin;// Structdb.Where(name = jinzhu).Or(UserName: jinzhu 2, Age: 18).Find(users)// SELECT * FROM users WHERE name = jinzhu OR (name = jinzhu 2 AND age = 18);// Mapdb.Where(name = jinzhu).Or(map[string]interfacename: jinzhu 2, age: 18).Find(users)// SELECT * FROM users WHERE name = jinzhu OR (name = jinzhu 2 AND age = 18); 3.2.4.5 é€‰æ‹©ç‰¹å®šå­—æ®µGorm å¯ä»¥é€‰æ‹©æŒ‡å®šè¦ä»æ•°æ®åº“æ£€ç´¢çš„å­—æ®µã€‚å¦åˆ™ï¼Œå°†é»˜è®¤é€‰æ‹©æ‰€æœ‰å­—æ®µã€‚ db.Select(name, age).Find(users)// SELECT name, age FROM users;db.Select([]stringname, age).Find(users)// SELECT name, age FROM users;db.Table(users).Select(COALESCE(age,?), 42).Rows()// SELECT COALESCE(age,42) FROM users; 3.2.4.6 æ’åºdb.Order(age desc, name).Find(users)// SELECT * FROM users ORDER BY age desc, name;// Multiple ordersdb.Order(age desc).Order(name).Find(users)// SELECT * FROM users ORDER BY age desc, name; 3.2.4.7 Limit Offsetdb.Limit(3).Find(users)// SELECT * FROM users LIMIT 3;// Cancel limit condition with -1db.Limit(10).Find(users1)// SELECT * FROM users LIMIT 10; (users1)db.Limit(-1).Find(users2)// SELECT * FROM users; (users2)db.Offset(3).Find(users)// SELECT * FROM users OFFSET 3;db.Limit(10).Offset(5).Find(users)// SELECT * FROM users OFFSET 5 LIMIT 10;// Cancel offset condition with -1db.Offset(10).Find(users1).Offset(-1).Find(users2)// SELECT * FROM users OFFSET 10; (users1)// SELECT * FROM users; (users2) 3.2.4.8 Group By Havingtype result struct Date time.Time Total intdb.Model(User).Select(name, sum(age) as total).Where(name LIKE ?, group%).Group(name).First(result)// SELECT name, sum(age) as total FROM `users` WHERE name LIKE group% GROUP BY `name` LIMIT 1db.Model(User).Select(name, sum(age) as total).Group(name).Having(name = ?, group).Find(result)// SELECT name, sum(age) as total FROM `users` GROUP BY `name` HAVING name = group 3.2.4.9 Distinctdb.Distinct(name, age).Order(name, age desc).Find(results) 3.2.4.9 Scantype Result struct Name string Age intvar result Resultdb.Table(users).Select(name, age).Where(name = ?, Antonio).Scan(result)// Raw SQLdb.Raw(SELECT name, age FROM users WHERE name = ?, Antonio).Scan(result) 3.2.4.10 Joinstype result struct Name string Email stringdb.Model(User).Select(users.name, emails.email).Joins(left join emails on emails.user_id = users.id).Scan(result)// SELECT users.name, emails.email FROM `users` left join emails on emails.user_id = users.idrows, err := db.Table(users).Select(users.name, emails.email).Joins(left join emails on emails.user_id = users.id).Rows()for rows.Next() ...db.Table(users).Select(users.name, emails.email).Joins(left join emails on emails.user_id = users.id).Scan(results)// multiple joins with parameterdb.Joins(JOIN emails ON emails.user_id = users.id AND emails.email = ?, jinzhu@example.org).Joins(JOIN credit_cards ON credit_cards.user_id = users.id).Where(credit_cards.number = ?, 411111111111).Find(user) 4. é«˜çº§æŸ¥è¯¢4.1 ScopeGORMä¸­çš„ Scopes æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç‰¹æ€§ï¼Œå…è®¸å°†å¸¸ç”¨çš„æŸ¥è¯¢æ¡ä»¶å®šä¹‰ä¸ºå¯é‡ç”¨çš„æ–¹æ³•ï¼Œä½¿ä»£ç æ›´åŠ æ¨¡å—åŒ–å’Œå¯è¯»ã€‚ 4.1.1 æŸ¥è¯¢Scope æŸ¥è¯¢ç¤ºä¾‹ï¼š func AmountGreaterThan1000(db *gorm.DB) *gorm.DB return db.Where(amount ?, 1000)func PaidWithCreditCard(db *gorm.DB) *gorm.DB return db.Where(pay_mode_sign = ?, C)func PaidWithCod(db *gorm.DB) *gorm.DB return db.Where(pay_mode_sign = ?, C)func OrderStatus(status []string) func (db *gorm.DB) *gorm.DB return func (db *gorm.DB) *gorm.DB return db.Where(status IN (?), status) db.Scopes(AmountGreaterThan1000, PaidWithCreditCard).Find(orders)// æŸ¥æ‰¾æ‰€æœ‰é‡‘é¢å¤§äº 1000 çš„ä¿¡ç”¨å¡è®¢å•db.Scopes(AmountGreaterThan1000, PaidWithCod).Find(orders)// æŸ¥æ‰¾æ‰€æœ‰é‡‘é¢å¤§äº 1000 çš„ COD è®¢å•db.Scopes(AmountGreaterThan1000, OrderStatus([]stringpaid, shipped)).Find(orders)// æŸ¥æ‰¾æ‰€æœ‰é‡‘é¢å¤§äº1000 çš„å·²ä»˜æ¬¾æˆ–å·²å‘è´§è®¢å• 4.1.2 åˆ†é¡µfunc Paginate(r *http.Request) func(db *gorm.DB) *gorm.DB return func (db *gorm.DB) *gorm.DB q := r.URL.Query() page, _ := strconv.Atoi(q.Get(page)) if page = 0 page = 1 pageSize, _ := strconv.Atoi(q.Get(page_size)) switch case pageSize 100: pageSize = 100 case pageSize = 0: pageSize = 10 offset := (page - 1) * pageSize return db.Offset(offset).Limit(pageSize) db.Scopes(Paginate(r)).Find(users)db.Scopes(Paginate(r)).Find(articles) 4.2 CountGORMä¸­çš„ Count æ–¹æ³•ç”¨äºæ£€ç´¢åŒ¹é…ç»™å®šæŸ¥è¯¢çš„è®°å½•æ•°ã€‚ è¿™æ˜¯äº†è§£æ•°æ®é›†å¤§å°çš„ä¸€ä¸ªæœ‰ç”¨çš„åŠŸèƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¶‰åŠæœ‰æ¡ä»¶æŸ¥è¯¢æˆ–æ•°æ®åˆ†æçš„æƒ…å†µä¸‹ã€‚ 4.2.1 å¾—åˆ°åŒ¹é…è®°å½•çš„ Countå¯ä»¥ä½¿ç”¨ Count æ¥ç¡®å®šç¬¦åˆæ‚¨çš„æŸ¥è¯¢ä¸­ç¬¦åˆç‰¹å®šæ ‡å‡†çš„è®°å½•çš„æ•°é‡ã€‚ var count int64// è®¡æ•° æœ‰ç€ç‰¹å®šåå­—çš„ usersdb.Model(User).Where(name = ?, jinzhu).Or(name = ?, jinzhu 2).Count(count)// SQL: SELECT count(1) FROM users WHERE name = jinzhu OR name = jinzhu 2// è®¡æ•° æœ‰ç€å•ä¸€åå­—æ¡ä»¶ï¼ˆsingle name conditionï¼‰çš„ usersdb.Model(User).Where(name = ?, jinzhu).Count(count)// SQL: SELECT count(1) FROM users WHERE name = jinzhu// åœ¨ä¸åŒçš„è¡¨ä¸­å¯¹è®°å½•è®¡æ•°db.Table(deleted_users).Count(count)// SQL: SELECT count(1) FROM deleted_users 4.2.2 **é…åˆ Distinct å’Œ Group **GORMè¿˜å…è®¸å¯¹ä¸åŒçš„å€¼è¿›è¡Œè®¡æ•°å¹¶å¯¹ç»“æœè¿›è¡Œåˆ†ç»„ã€‚ // ä¸ºä¸åŒ name è®¡æ•°db.Model(User).Distinct(name).Count(count)// SQL: SELECT COUNT(DISTINCT(`name`)) FROM `users`// ä½¿ç”¨è‡ªå®šä¹‰é€‰æ‹©ï¼ˆcustom selectï¼‰è®¡æ•°ä¸åŒçš„å€¼db.Table(deleted_users).Select(count(distinct(name))).Count(count)// SQL: SELECT count(distinct(name)) FROM deleted_users// åˆ†ç»„è®°å½•è®¡æ•°users := []User Name: name1, Name: name2, Name: name3, Name: name3,db.Model(User).Group(name).Count(count)// æŒ‰åç§°åˆ†ç»„åè®¡æ•°// count = 3","tags":["Goã€Gorm"]},{"title":"GinåŸºç¡€å­¦ä¹ ","path":"/2024/09/03/GinåŸºç¡€å­¦ä¹ /","content":"1. ç®€ä»‹1.1 æ¦‚è¿°Gin æ˜¯ä¸€ä¸ªç”¨ Go (Golang) ç¼–å†™çš„ HTTP Web æ¡†æ¶ã€‚å®ƒå…·æœ‰ç±»ä¼¼ Martini çš„ APIï¼Œç”±äºä½¿ç”¨ httprouterï¼Œæ€§èƒ½æ¯” Martini å¿« 40 å€ã€‚ 1.2 å®‰è£…1.ä¸‹è½½å¹¶å®‰è£… ginï¼š go get -u github.com/gin-gonic/gin 2.å°† gin å¼•å…¥åˆ°ä»£ç ä¸­ï¼š import github.com/gin-gonic/gin 1.3 Hello Worldpackage mainimport ( net/http github.com/gin-gonic/gin)func main() r := gin.Default() r.GET(/hello, func(ctx *gin.Context) ctx.String(http.StatusOK, hello world) ) r.Run(:8000) 2. è·¯ç”±2.1 æ¦‚è¿°åœ¨Ginæ¡†æ¶ä¸­ï¼Œâ€è·¯ç”±â€ï¼ˆRouterï¼‰æ˜¯å¤„ç†HTTPè¯·æ±‚å¹¶å°†å…¶åˆ†å‘åˆ°é€‚å½“å¤„ç†ç¨‹åºçš„æœºåˆ¶ã€‚ åœ¨Ginä¸­ï¼Œä½ å¯ä»¥å®šä¹‰å„ç§HTTPè¯·æ±‚æ–¹æ³•ï¼ˆå¦‚GETã€POSTã€PUTã€DELETEç­‰ï¼‰çš„è·¯ç”±ã€‚æ¯ä¸ªè·¯ç”±éƒ½å…³è”ä¸€ä¸ªç‰¹å®š çš„å¤„ç†å‡½æ•°ï¼ˆhandlerï¼‰ã€‚ä¾‹å¦‚ï¼š r := gin.Default()r.GET(/ping, func(c *gin.Context) c.JSON(200, gin.H message: pong, )) 2.2 è·¯ç”±è§„åˆ™ä¸€æ¡è·¯ç”±è§„åˆ™ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š httpè¯·æ±‚æ–¹æ³• urlè·¯å¾„ æ§åˆ¶å™¨å‡½æ•° httpè¯·æ±‚æ–¹æ³• å¸¸ç”¨çš„httpè¯·æ±‚æ–¹æ³•æœ‰ä¸‹é¢4ç§: GET POST PUT DELETE urlè·¯å¾„ urlè·¯å¾„æœ‰ä¸‰ç§å†™æ³•ï¼š é™æ€urlè·¯å¾„ å¸¦è·¯å¾„å‚æ•°çš„urlè·¯å¾„ å¸¦æ˜Ÿå·ï¼ˆ*ï¼‰æ¨¡ç³ŠåŒ¹é…å‚æ•°çš„urlè·¯å¾„ // ä¾‹å­1ï¼Œ é™æ€Urlè·¯å¾„, å³ä¸å¸¦ä»»ä½•å‚æ•°çš„urlè·¯å¾„/users/center/user/111/food/12// ä¾‹å­2ï¼Œå¸¦è·¯å¾„å‚æ•°çš„urlè·¯å¾„ï¼Œurlè·¯å¾„ä¸Šé¢å¸¦æœ‰å‚æ•°,å‚æ•°ç”±å†’å·ï¼ˆ:ï¼‰è·Ÿç€ä¸€ä¸ªå­—ç¬¦ä¸²å®šä¹‰ã€‚// è·¯å¾„å‚æ•°å€¼å¯ä»¥æ˜¯æ•°å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²//å®šä¹‰å‚æ•°:idï¼Œ å¯ä»¥åŒ¹é…/user/1, /user/899 /user/xiaoli è¿™ç±»Urlè·¯å¾„/user/:id//å®šä¹‰å‚æ•°:idï¼Œ å¯ä»¥åŒ¹é…/food/2, /food/100 /food/apple è¿™ç±»Urlè·¯å¾„/food/:id//å®šä¹‰å‚æ•°:typeå’Œ:pageï¼Œ å¯ä»¥åŒ¹é…/foods/2/1, /food/100/25 /food/apple/30 è¿™ç±»Urlè·¯å¾„/foods/:type/:page// ä¾‹å­3. å¸¦æ˜Ÿå·ï¼ˆ*ï¼‰æ¨¡ç³ŠåŒ¹é…å‚æ•°çš„urlè·¯å¾„// æ˜Ÿå·ä»£è¡¨åŒ¹é…ä»»æ„è·¯å¾„çš„æ„æ€, å¿…é¡»åœ¨*å·åé¢æŒ‡å®šä¸€ä¸ªå‚æ•°åï¼Œåé¢å¯ä»¥é€šè¿‡è¿™ä¸ªå‚æ•°è·å–*å·åŒ¹é…çš„å†…å®¹ã€‚//ä»¥/foods/ å¼€å¤´çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ¹é…//åŒ¹é…ï¼š/foods/1ï¼Œ /foods/200, /foods/1/20, /foods/apple/1 /foods/*path//å¯ä»¥é€šè¿‡pathå‚æ•°è·å–*å·åŒ¹é…çš„å†…å®¹ã€‚ æ§åˆ¶å™¨å‡½æ•° æ§åˆ¶å™¨å‡½æ•°å®šä¹‰ï¼š func HandlerFunc(c *gin.Context) æ§åˆ¶å™¨å‡½æ•°æ¥å—ä¸€ä¸ªä¸Šä¸‹æ–‡å‚æ•°ã€‚å¯ä»¥é€šè¿‡ä¸Šä¸‹æ–‡å‚æ•°ï¼Œè·å–httpè¯·æ±‚å‚æ•°ï¼Œå“åº”httpè¯·æ±‚ã€‚ 2.3 è·¯ç”±å®šä¹‰ä¾‹å­//å®ä¾‹åŒ–ginå®ä¾‹å¯¹è±¡ã€‚r := gin.Default() //å®šä¹‰postè¯·æ±‚, urlè·¯å¾„ä¸ºï¼š/users, ç»‘å®šsaveUseræ§åˆ¶å™¨å‡½æ•°r.POST(/users, saveUser)//å®šä¹‰getè¯·æ±‚ï¼Œurlè·¯å¾„ä¸ºï¼š/users/:id ï¼ˆ:idæ˜¯å‚æ•°ï¼Œä¾‹å¦‚: /users/10, ä¼šåŒ¹é…è¿™ä¸ªurlæ¨¡å¼ï¼‰ï¼Œç»‘å®šgetUseræ§åˆ¶å™¨å‡½æ•°r.GET(/users/:id, getUser)//å®šä¹‰putè¯·æ±‚r.PUT(/users/:id, updateUser)//å®šä¹‰deleteè¯·æ±‚r.DELETE(/users/:id, deleteUser)//æ§åˆ¶å™¨å‡½æ•°å®ç°func saveUser(c *gin.Context) ...å¿½ç•¥å®ç°...func getUser(c *gin.Context) ...å¿½ç•¥å®ç°...func updateUser(c *gin.Context) ...å¿½ç•¥å®ç°...func deleteUser(c *gin.Context) ...å¿½ç•¥å®ç°... 2.4 åˆ†ç»„è·¯ç”±åœ¨åšapiå¼€å‘çš„æ—¶å€™ï¼Œå¦‚æœè¦æ”¯æŒå¤šä¸ªapiç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ†ç»„è·¯ç”±æ¥å®ç°apiç‰ˆæœ¬å¤„ç†ã€‚ func main() router := gin.Default() // åˆ›å»ºv1ç»„ v1 := router.Group(/v1) // åœ¨v1è¿™ä¸ªåˆ†ç»„ä¸‹ï¼Œæ³¨å†Œè·¯ç”± v1.POST(/login, loginEndpoint) v1.POST(/submit, submitEndpoint) v1.POST(/read, readEndpoint) // åˆ›å»ºv2ç»„ v2 := router.Group(/v2) // åœ¨v2è¿™ä¸ªåˆ†ç»„ä¸‹ï¼Œæ³¨å†Œè·¯ç”± v2.POST(/login, loginEndpoint) v2.POST(/submit, submitEndpoint) v2.POST(/read, readEndpoint) router.Run(:8080) ä¸Šé¢çš„ä¾‹å­å°†ä¼šæ³¨å†Œä¸‹é¢çš„è·¯ç”±ä¿¡æ¯ï¼š v1login v1submit v1read v2login v2submit v2read è·¯ç”±åˆ†ç»„ï¼Œå…¶å®å°±æ˜¯è®¾ç½®äº†åŒä¸€ç±»è·¯ç”±çš„urlå‰ç¼€ã€‚ 3. Ginå¤„ç†è¯·æ±‚å‚æ•°3.1 å¤„ç†Getè¯·æ±‚å‚æ•°3.1.1 è·å–APIå‚æ•° å¯ä»¥é€šè¿‡Contextçš„Paramæ–¹æ³•æ¥è·å–APIå‚æ•° localhost:8000xxxzhangsan package mainimport ( net/http strings github.com/gin-gonic/gin)func main() r := gin.Default() // http://localhost:8000/user/gege/daji r.GET(/user/:name/*action, func(c *gin.Context) name := c.Param(name) action := c.Param(action) //æˆªå–/ action = strings.Trim(action, /) c.String(http.StatusOK, name+ is +action) ) //é»˜è®¤ä¸ºç›‘å¬8080ç«¯å£ r.Run(:8000) 3.1.2 è·å–urlå‚æ•°Getè¯·æ±‚urlä¾‹å­ï¼š*path?id1234nameManuvalue*111 è·å–Getè¯·æ±‚å‚æ•°çš„å¸¸ç”¨å‡½æ•°ï¼š func (c *Context) Query(key string) string func (c *Context) DefaultQuery(key, defaultValue string) string func (c *Context) GetQuery(key string) (string, bool) func Handler(c *gin.Context) //è·å–nameå‚æ•°, é€šè¿‡Queryè·å–çš„å‚æ•°å€¼æ˜¯Stringç±»å‹ã€‚ name := c.Query(name) //è·å–nameå‚æ•°, è·ŸQueryå‡½æ•°çš„åŒºåˆ«æ˜¯ï¼Œå¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°è®¾ç½®é»˜è®¤å€¼ã€‚ value := c.DefaultQuery(value, vvv) //è·å–idå‚æ•°, é€šè¿‡GetQueryè·å–çš„å‚æ•°å€¼ä¹Ÿæ˜¯Stringç±»å‹, // åŒºåˆ«æ˜¯GetQueryè¿”å›ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å‚æ•°å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å‚æ•°æ˜¯å¦å­˜åœ¨çš„boolå€¼ï¼Œå¯ä»¥ç”¨æ¥åˆ¤æ–­å‚æ•°æ˜¯å¦å­˜åœ¨ã€‚ id, ok := c.GetQuery(id) if !ok // å‚æ•°ä¸å­˜åœ¨ æç¤ºï¼šGetQueryå‡½æ•°ï¼Œåˆ¤æ–­å‚æ•°æ˜¯å¦å­˜åœ¨çš„é€»è¾‘æ˜¯ï¼Œå‚æ•°å€¼ä¸ºç©ºï¼Œå‚æ•°ä¹Ÿç®—å­˜åœ¨ï¼Œåªæœ‰æ²¡æœ‰æäº¤å‚æ•°ï¼Œæ‰ç®—å‚æ•°ä¸å­˜åœ¨ã€‚ 3.2 å¤„ç†Postè¯·æ±‚å‚æ•°è¡¨å•ä¼ è¾“ä¸ºpostè¯·æ±‚ï¼Œhttpå¸¸è§çš„ä¼ è¾“æ ¼å¼ä¸ºå››ç§ï¼š applicationjson applicationx-www-form-urlencoded applicationxml multipartform-data è·å–Postè¯·æ±‚å‚æ•°çš„å¸¸ç”¨å‡½æ•°ï¼š func (c *Context) PostForm(key string) string func (c *Context) DefaultPostForm(key, defaultValue string) string PostFormçš„åŒºåˆ«æ˜¯å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°è®¾ç½®å‚æ•°é»˜è®¤å€¼ func (c *Context) GetPostForm(key string) (string, bool) GetPostFormè¿”å›ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å‚æ•°å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å‚æ•°æ˜¯å¦å­˜åœ¨çš„boolå€¼ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta name=viewport content=width=device-width, initial-scale=1.0 meta http-equiv=X-UA-Compatible content=ie=edge titleDocument/title/headbody form action=http://localhost:8080/form method=post action=application/x-www-form-urlencoded ç”¨æˆ·åï¼šinput type=text name=username placeholder=è¯·è¾“å…¥ä½ çš„ç”¨æˆ·å br å¯†nbsp;nbsp;nbsp;ç ï¼šinput type=password name=userpassword placeholder=è¯·è¾“å…¥ä½ çš„å¯†ç  br input type=submit value=æäº¤ /form/body/html package mainimport ( fmt net/http github.com/gin-gonic/gin)func main() r := gin.Default() r.POST(/form, func(c *gin.Context) types := c.DefaultPostForm(type, post) username := c.PostForm(username) userpassword := c.PostForm(userpassword) c.String(http.StatusOK, fmt.Sprintf(username:%s, password:%s, type:%s, username, userpassword, types)) ) r.Run() 4. æ•°æ®è§£æå’Œç»‘å®š4.1 Json æ•°æ®è§£æå’Œç»‘å®šå®¢æˆ·ç«¯ä¼ å‚ï¼Œåç«¯æ¥æ”¶å¹¶è§£æåˆ°ç»“æ„ä½“ package mainimport ( github.com/gin-gonic/gin net/http)// å®šä¹‰æ¥æ”¶æ•°æ®çš„ç»“æ„ä½“type Login struct // binding:requiredä¿®é¥°çš„å­—æ®µï¼Œè‹¥æ¥æ”¶ä¸ºç©ºå€¼ï¼Œåˆ™æŠ¥é”™ï¼Œæ˜¯å¿…é¡»å­—æ®µ User string `form:username json:user uri:user xml:user binding:required` Pssword string `form:password json:password uri:password xml:password binding:required`func main() // 1.åˆ›å»ºè·¯ç”± // é»˜è®¤ä½¿ç”¨äº†2ä¸ªä¸­é—´ä»¶Logger(), Recovery() r := gin.Default() // JSONç»‘å®š r.POST(loginJSON, func(c *gin.Context) // å£°æ˜æ¥æ”¶çš„å˜é‡ var json Login // å°†requestçš„bodyä¸­çš„æ•°æ®ï¼Œè‡ªåŠ¨æŒ‰ç…§jsonæ ¼å¼è§£æåˆ°ç»“æ„ä½“ if err := c.ShouldBindJSON(json); err != nil // è¿”å›é”™è¯¯ä¿¡æ¯ // gin.Hå°è£…äº†ç”Ÿæˆjsonæ•°æ®çš„å·¥å…· c.JSON(http.StatusBadRequest, gin.Herror: err.Error()) return // åˆ¤æ–­ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡® if json.User != root || json.Pssword != admin c.JSON(http.StatusBadRequest, gin.Hstatus: 304) return c.JSON(http.StatusOK, gin.Hstatus: 200) ) r.Run(:8000) curl http://localhost:8000/loginJSON -H content-type:application/json -d \\user\\:\\root\\,\\password\\:\\root\\ -X POST` 4.2 è¡¨å•æ•°æ®è§£æå’Œç»‘å®š!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta name=viewport content=width=device-width, initial-scale=1.0 meta http-equiv=X-UA-Compatible content=ie=edge titleDocument/title/headbody form action=http://localhost:8000/loginForm method=post enctype=application/x-www-form-urlencoded ç”¨æˆ·åinput type=text name=usernamebr å¯†ç input type=password name=password input type=submit value=æäº¤ /form/body/html package mainimport ( net/http github.com/gin-gonic/gin)// å®šä¹‰æ¥æ”¶æ•°æ®çš„ç»“æ„ä½“type Login struct // binding:requiredä¿®é¥°çš„å­—æ®µï¼Œè‹¥æ¥æ”¶ä¸ºç©ºå€¼ï¼Œåˆ™æŠ¥é”™ï¼Œæ˜¯å¿…é¡»å­—æ®µ User string `form:username json:user uri:user xml:user binding:required` Pssword string `form:password json:password uri:password xml:password binding:required`func main() // 1.åˆ›å»ºè·¯ç”± // é»˜è®¤ä½¿ç”¨äº†2ä¸ªä¸­é—´ä»¶Logger(), Recovery() r := gin.Default() // JSONç»‘å®š r.POST(/loginForm, func(c *gin.Context) // å£°æ˜æ¥æ”¶çš„å˜é‡ var form Login // Bind()é»˜è®¤è§£æå¹¶ç»‘å®šformæ ¼å¼ // æ ¹æ®è¯·æ±‚å¤´ä¸­content-typeè‡ªåŠ¨æ¨æ–­ if err := c.Bind(form); err != nil c.JSON(http.StatusBadRequest, gin.Herror: err.Error()) return // åˆ¤æ–­ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡® if form.User != root || form.Pssword != admin c.JSON(http.StatusBadRequest, gin.Hstatus: 304) return c.JSON(http.StatusOK, gin.Hstatus: 200) ) r.Run(:8000) 4.3 urlæ•°æ®è§£æå’Œç»‘å®špackage mainimport ( net/http github.com/gin-gonic/gin)// å®šä¹‰æ¥æ”¶æ•°æ®çš„ç»“æ„ä½“type Login struct // binding:requiredä¿®é¥°çš„å­—æ®µï¼Œè‹¥æ¥æ”¶ä¸ºç©ºå€¼ï¼Œåˆ™æŠ¥é”™ï¼Œæ˜¯å¿…é¡»å­—æ®µ User string `form:username json:user uri:user xml:user binding:required` Pssword string `form:password json:password uri:password xml:password binding:required`func main() // 1.åˆ›å»ºè·¯ç”± // é»˜è®¤ä½¿ç”¨äº†2ä¸ªä¸­é—´ä»¶Logger(), Recovery() r := gin.Default() // JSONç»‘å®š r.GET(/:user/:password, func(c *gin.Context) // å£°æ˜æ¥æ”¶çš„å˜é‡ var login Login // ShouldBindUri()é»˜è®¤è§£æå¹¶ç»‘å®šuriæ ¼å¼ // æ ¹æ®è¯·æ±‚å¤´ä¸­content-typeè‡ªåŠ¨æ¨æ–­ if err := c.ShouldBindUri(login); err != nil c.JSON(http.StatusBadRequest, gin.Herror: err.Error()) return // åˆ¤æ–­ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡® if login.User != root || login.Pssword != admin c.JSON(http.StatusBadRequest, gin.Hstatus: 304) return c.JSON(http.StatusOK, gin.Hstatus: 200) ) r.Run(:8000) 5. Ginå¤„ç†è¯·æ±‚å“åº”Ginæ¡†æ¶æ”¯æŒä»¥å­—ç¬¦ä¸²ã€jsonã€xmlã€æ–‡ä»¶ç­‰æ ¼å¼å“åº”è¯·æ±‚ã€‚ gin.Contextä¸Šä¸‹æ–‡å¯¹è±¡æ”¯æŒå¤šç§è¿”å›å¤„ç†ç»“æœï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸åŒçš„å“åº”æ–¹å¼ã€‚ 5.1 å­—ç¬¦ä¸²å“åº”é€šè¿‡Stringå‡½æ•°è¿”å›å­—ç¬¦ä¸²ã€‚ å‡½æ•°å®šä¹‰ï¼š func (c *Context) String(code int, format string, values ...interface) å‚æ•°è¯´æ˜ï¼š å‚æ•° è¯´æ˜ code httpçŠ¶æ€ç  format è¿”å›ç»“æœï¼Œæ”¯æŒç±»ä¼¼Sprintfå‡½æ•°ä¸€æ ·çš„å­—ç¬¦ä¸²æ ¼å¼å®šä¹‰ï¼Œä¾‹å¦‚,%d ä»£è¡¨æ’å…¥æ•´æ•°ï¼Œ%sä»£è¡¨æ’å…¥å­—ç¬¦ä¸² values ä»»æ„ä¸ªformatå‚æ•°å®šä¹‰çš„å­—ç¬¦ä¸²æ ¼å¼å‚æ•° package mainimport ( net/http github.com/gin-gonic/gin)func main() r := gin.Default() r.GET(string, func(c *gin.Context) c.String(http.StatusOK, hello ä½ å¥½å¥½ï¼) c.String(http.StatusOK, æ¬¢è¿%s, ä½ æ˜¯%s, èµµå¤§å¦ˆ, æœ€é“çš„ä»”ï¼) ) r.Run() 5.2 Jsonæ ¼å¼å“åº”package mainimport ( net/http github.com/gin-gonic/gin)func main() r := gin.Default() r.GET(/json, func(c *gin.Context) c.JSON(http.StatusOK, gin.Hmessage: json, status: 200) ) r.GET(/struct, func(c *gin.Context) var msg struct Name string Message string Number int msg.Name = root msg.Message = message msg.Number = 123 c.JSON(200, msg) ) r.Run() 5.3 XMLæ ¼å¼å“åº”package mainimport github.com/gin-gonic/gin// User å®šä¹‰, é»˜è®¤structçš„åå­—å°±æ˜¯xmlçš„æ ¹èŠ‚ç‚¹åå­—ï¼Œè¿™é‡Œè½¬æ¢æˆxmlåæ ¹èŠ‚ç‚¹çš„åå­—ä¸ºUser.type User struct Name string `xml:name` // é€šè¿‡xmlæ ‡ç­¾å®šä¹‰structå­—æ®µè½¬æ¢æˆxmlå­—æ®µçš„åå­—ã€‚ Email string `xml:email`func main() r := gin.Default() r.GET(xml, func(c *gin.Context) //åˆå§‹åŒ–userå¯¹è±¡ u := User Name: tizi365, Email: tizi@tizi365.com, //è¿”å›xmlæ•°æ® //è¿”å›ç»“æœï¼š // ?xml version=1.0 encoding=UTF-8? // Usernametizi365/nameemailtizi@tizi365.com/email/User c.XML(200, u) ) r.Run() 6. æ–‡ä»¶ä¸Šä¼ ä¸‹è½½6.1 æ–‡ä»¶ä¸Šä¼ !doctype htmlhtml lang=enhead meta charset=utf-8 titleSingle file upload/title/headbodyh1ä¸Šä¼ æ–‡ä»¶æ¼”ç¤º/h1form action=http://localhost:8080/upload method=post enctype=multipart/form-data æ–‡ä»¶: input type=file name=filebrbr input type=submit value=ä¸Šä¼ æ–‡ä»¶/form/body/html package mainimport ( fmt log net/http github.com/gin-gonic/gin)func main() r := gin.Default() // è®¾ç½®æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶ï¼Œé»˜è®¤æ˜¯32m r.MaxMultipartMemory = 64 20 r.POST(/upload, func(c *gin.Context) // è·å–ä¸Šä¼ æ–‡ä»¶ï¼Œè¿”å›çš„æ˜¯multipart.FileHeaderå¯¹è±¡ï¼Œä»£è¡¨ä¸€ä¸ªæ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«äº†æ–‡ä»¶åä¹‹ç±»çš„è¯¦ç»†ä¿¡æ¯ // fileæ˜¯è¡¨å•å­—æ®µåå­— file, _ := c.FormFile(file) log.Println(file.Filename) // å°†ä¸Šä¼ çš„æ–‡ä»¶ï¼Œä¿å­˜åˆ°./data/1.txt æ–‡ä»¶ä¸­ err := c.SaveUploadedFile(file, ./data/1.txt) if err != nil fmt.Println(err.Error()) c.String(http.StatusBadRequest, fmt.Sprintf(%s upload failed, file.Filename)) return c.String(http.StatusOK, fmt.Sprintf(%s uploaded, file.Filename)) ) r.Run() 6.2 æ–‡ä»¶ä¸‹è½½package mainimport github.com/gin-gonic/ginfunc main() r := gin.Default() r.GET(down1, func(c *gin.Context) //é€šè¿‡Fileå‡½æ•°ï¼Œç›´æ¥è¿”å›æœ¬åœ°æ–‡ä»¶ï¼Œå‚æ•°ä¸ºæœ¬åœ°æ–‡ä»¶åœ°å€ã€‚ //å‡½æ•°è¯´æ˜ï¼šc.File(æ–‡ä»¶è·¯å¾„) //åœ¨æµè§ˆå™¨ä¸­ç›´æ¥æ˜¾ç¤º c.File(./data/1.txt) ) r.GET(down2, func(c *gin.Context) //é€šè¿‡FileAttachmentå‡½æ•°ï¼Œè¿”å›æœ¬åœ°æ–‡ä»¶ï¼Œç±»ä¼¼Fileå‡½æ•°ï¼ŒåŒºåˆ«æ˜¯å¯ä»¥æŒ‡å®šä¸‹è½½çš„æ–‡ä»¶åã€‚ //å‡½æ•°è¯´æ˜: c.FileAttachment(æ–‡ä»¶è·¯å¾„, ä¸‹è½½çš„æ–‡ä»¶å) //åœ¨æµè§ˆå™¨ä¸­ç›´æ¥ä¸‹è½½ c.FileAttachment(./data/1.txt, 2.txt) ) r.Run() 7. Ginä¸­é—´ä»¶7.1 æ¦‚è¿°åœ¨Ginæ¡†æ¶ä¸­ï¼Œä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰æŒ‡çš„æ˜¯å¯ä»¥æ‹¦æˆªhttpè¯·æ±‚-å“åº”ç”Ÿå‘½å‘¨æœŸçš„ç‰¹æ®Šå‡½æ•°ï¼Œåœ¨è¯·æ±‚-å“åº”ç”Ÿå‘½å‘¨æœŸä¸­å¯ä»¥æ³¨å†Œå¤šä¸ªä¸­é—´ä»¶ï¼Œæ¯ä¸ªä¸­é—´ä»¶æ‰§è¡Œä¸åŒçš„åŠŸèƒ½ï¼Œä¸€ä¸ªä¸­é—´æ‰§è¡Œå®Œå†è½®åˆ°ä¸‹ä¸€ä¸ªä¸­é—´ä»¶æ‰§è¡Œã€‚ ä¸­é—´ä»¶çš„å¸¸è§åº”ç”¨åœºæ™¯å¦‚ä¸‹ï¼š è¯·æ±‚é™é€Ÿ apiæ¥å£ç­¾åå¤„ç† æƒé™æ ¡éªŒ ç»Ÿä¸€é”™è¯¯å¤„ç† æç¤ºï¼šå¦‚æœä½ æƒ³æ‹¦æˆªæ‰€æœ‰è¯·æ±‚åšä¸€äº›äº‹æƒ…éƒ½å¯ä»¥å¼€å‘ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°å»å®ç°ã€‚ Ginæ”¯æŒè®¾ç½®å…¨å±€ä¸­é—´ä»¶å’Œé’ˆå¯¹è·¯ç”±åˆ†ç»„è®¾ç½®ä¸­é—´ä»¶ï¼Œè®¾ç½®å…¨å±€ä¸­é—´ä»¶æ„æ€å°±æ˜¯ä¼šæ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œé’ˆå¯¹åˆ†ç»„è·¯ç”±è®¾ç½®ä¸­é—´ä»¶ï¼Œæ„æ€å°±æ˜¯ä»…å¯¹è¿™ä¸ªåˆ†ç»„ä¸‹çš„è·¯ç”±èµ·ä½œç”¨ã€‚ 7.2 å…¨å±€ä¸­é—´ä»¶package main// å¯¼å…¥ginåŒ…import ( log time github.com/gin-gonic/gin)// è‡ªå®šä¹‰ä¸ªæ—¥å¿—ä¸­é—´ä»¶func Logger() gin.HandlerFunc return func(c *gin.Context) t := time.Now() // å¯ä»¥é€šè¿‡ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œè®¾ç½®ä¸€äº›ä¾é™„åœ¨ä¸Šä¸‹æ–‡å¯¹è±¡é‡Œé¢çš„é”®/å€¼æ•°æ® c.Set(example, 12345) // åœ¨è¿™é‡Œå¤„ç†è¯·æ±‚åˆ°è¾¾æ§åˆ¶å™¨å‡½æ•°ä¹‹å‰çš„é€»è¾‘ // è°ƒç”¨ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œæˆ–è€…æ§åˆ¶å™¨å¤„ç†å‡½æ•°ï¼Œå…·ä½“å¾—çœ‹æ³¨å†Œäº†å¤šå°‘ä¸ªä¸­é—´ä»¶ã€‚ c.Next() // åœ¨è¿™é‡Œå¯ä»¥å¤„ç†è¯·æ±‚è¿”å›ç»™ç”¨æˆ·ä¹‹å‰çš„é€»è¾‘ latency := time.Since(t) log.Print(latency) // ä¾‹å¦‚ï¼ŒæŸ¥è¯¢è¯·æ±‚çŠ¶æ€å— status := c.Writer.Status() log.Println(status) func main() r := gin.New() // æ³¨å†Œä¸Šé¢è‡ªå®šä¹‰çš„æ—¥å¿—ä¸­é—´ä»¶ r.Use(Logger()) r.GET(/test, func(c *gin.Context) // æŸ¥è¯¢æˆ‘ä»¬ä¹‹å‰åœ¨æ—¥å¿—ä¸­é—´ä»¶ï¼Œæ³¨å…¥çš„é”®å€¼æ•°æ® example := c.MustGet(example).(string) // it would print: 12345 log.Println(example) ) // Listen and serve on 0.0.0.0:8080 r.Run(:8080) 7.3 å±€éƒ¨ä¸­é—´ä»¶package mainimport ( fmt time github.com/gin-gonic/gin)func MiddleWare() gin.HandlerFunc return func(c *gin.Context) t := time.Now() fmt.Println(ä¸­é—´ä»¶å¼€å§‹æ‰§è¡Œäº†) // è®¾ç½®å˜é‡åˆ°Contextçš„keyä¸­ï¼Œå¯ä»¥é€šè¿‡Get()å– c.Set(request, ä¸­é—´ä»¶) // æ‰§è¡Œå‡½æ•° c.Next() // ä¸­é—´ä»¶æ‰§è¡Œå®Œåç»­çš„ä¸€äº›äº‹æƒ… status := c.Writer.Status() fmt.Println(ä¸­é—´ä»¶æ‰§è¡Œå®Œæ¯•, status) t2 := time.Since(t) fmt.Println(time:, t2) func main() // 1.åˆ›å»ºè·¯ç”± // é»˜è®¤ä½¿ç”¨äº†2ä¸ªä¸­é—´ä»¶Logger(), Recovery() r := gin.Default() // å±€éƒ¨ä¸­é—´é”®ä½¿ç”¨,æ³¨å†Œåˆ°äº†æ–¹æ³•å¤„ç†å‡½æ•°ä¸Š r.GET(/ce, MiddleWare(), func(c *gin.Context) // å–å€¼ req, _ := c.Get(request) fmt.Println(request:, req) // é¡µé¢æ¥æ”¶ c.JSON(200, gin.Hrequest: req) ) r.Run() 8. ä¼šè¯æ§åˆ¶8.1 Cookieä»‹ç» HTTPæ˜¯æ— çŠ¶æ€åè®®ï¼ŒæœåŠ¡å™¨ä¸èƒ½è®°å½•æµè§ˆå™¨çš„è®¿é—®çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´æœåŠ¡å™¨ä¸èƒ½åŒºåˆ†ä¸¤æ¬¡è¯·æ±‚æ˜¯å¦ç”±åŒä¸€ä¸ªå®¢æˆ·ç«¯å‘å‡º Cookieå°±æ˜¯è§£å†³HTTPåè®®æ— çŠ¶æ€çš„æ–¹æ¡ˆä¹‹ä¸€ï¼Œä¸­æ–‡æ˜¯å°ç”œé¥¼çš„æ„æ€ Cookieå®é™…ä¸Šå°±æ˜¯æœåŠ¡å™¨ä¿å­˜åœ¨æµè§ˆå™¨ä¸Šçš„ä¸€æ®µä¿¡æ¯ã€‚æµè§ˆå™¨æœ‰äº†Cookieä¹‹åï¼Œæ¯æ¬¡å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶éƒ½ä¼šåŒæ—¶å°†è¯¥ä¿¡æ¯å‘é€ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œå°±å¯ä»¥æ ¹æ®è¯¥ä¿¡æ¯å¤„ç†è¯·æ±‚ Cookieç”±æœåŠ¡å™¨åˆ›å»ºï¼Œå¹¶å‘é€ç»™æµè§ˆå™¨ï¼Œæœ€ç»ˆç”±æµè§ˆå™¨ä¿å­˜ 8.2 Cookieä½¿ç”¨SetCookieå‡½æ•°å®šä¹‰ï¼š func (c *Context) SetCookie(name, value string, maxAge int, path, domain string, secure, httpOnly bool) å‚æ•°è¯´æ˜ï¼š å‚æ•°å ç±»å‹ è¯´æ˜ name string cookieåå­— value string cookieå€¼ maxAge int æœ‰æ•ˆæ—¶é—´ï¼Œå•ä½æ˜¯ç§’ï¼ŒMaxAge0 å¿½ç•¥MaxAgeå±æ€§ï¼ŒMaxAge0 ç›¸å½“äºåˆ é™¤cookie, é€šå¸¸å¯ä»¥è®¾ç½®-1ä»£è¡¨åˆ é™¤ï¼ŒMaxAge0 å¤šå°‘ç§’åcookieå¤±æ•ˆ path string cookieè·¯å¾„ domain string cookieä½œç”¨åŸŸ secure bool Securetrueï¼Œé‚£ä¹ˆè¿™ä¸ªcookieåªèƒ½ç”¨httpsåè®®å‘é€ç»™æœåŠ¡å™¨ httpOnly bool è®¾ç½®HttpOnlytrueçš„cookieä¸èƒ½è¢«jsè·å–åˆ° package mainimport ( github.com/gin-gonic/gin fmt)func main() // 1.åˆ›å»ºè·¯ç”± // é»˜è®¤ä½¿ç”¨äº†2ä¸ªä¸­é—´ä»¶Logger(), Recovery() r := gin.Default() // æœåŠ¡ç«¯è¦ç»™å®¢æˆ·ç«¯cookie r.GET(cookie, func(c *gin.Context) // è·å–å®¢æˆ·ç«¯æ˜¯å¦æºå¸¦cookie cookie, err := c.Cookie(key_cookie) if err != nil cookie = NotSet // ç»™å®¢æˆ·ç«¯è®¾ç½®cookie // maxAge int, å•ä½ä¸ºç§’ // path,cookieæ‰€åœ¨ç›®å½• // domain string,åŸŸå // secure æ˜¯å¦æ™ºèƒ½é€šè¿‡httpsè®¿é—® // httpOnly bool æ˜¯å¦å…è®¸åˆ«äººé€šè¿‡jsè·å–è‡ªå·±çš„cookie c.SetCookie(key_cookie, value_cookie, 60, /, localhost, false, true) fmt.Printf(cookieçš„å€¼æ˜¯ï¼š %s , cookie) ) r.Run() 9. å‚æ•°éªŒè¯9.1 ç»“æ„ä½“éªŒè¯ç”¨ginæ¡†æ¶çš„æ•°æ®éªŒè¯ï¼Œå¯ä»¥ä¸ç”¨è§£ææ•°æ®ï¼Œå‡å°‘if elseï¼Œä¼šç®€æ´è®¸å¤šã€‚ package mainimport ( fmt time github.com/gin-gonic/gin)// Person ..type Person struct //ä¸èƒ½ä¸ºç©ºå¹¶ä¸”å¤§äº10 Age int `form:age binding:required,gt=10` Name string `form:name binding:required` Birthday time.Time `form:birthday time_format:2006-01-02 time_utc:1`func main() r := gin.Default() r.GET(/validate, func(c *gin.Context) var person Person if err := c.ShouldBind(person); err != nil c.String(500, fmt.Sprint(err)) return c.String(200, fmt.Sprintf(%#v, person)) ) r.Run() 9.2 è‡ªå®šä¹‰éªŒè¯package mainimport ( net/http github.com/gin-gonic/gin github.com/gin-gonic/gin/binding github.com/go-playground/validator/v10)/* å¯¹ç»‘å®šè§£æåˆ°ç»“æ„ä½“ä¸Šçš„å‚æ•°ï¼Œè‡ªå®šä¹‰éªŒè¯åŠŸèƒ½ æ¯”å¦‚æˆ‘ä»¬è¦å¯¹ name å­—æ®µåšæ ¡éªŒï¼Œè¦ä¸èƒ½ä¸ºç©ºï¼Œå¹¶ä¸”ä¸ç­‰äº admin ï¼Œç±»ä¼¼è¿™ç§éœ€æ±‚ï¼Œå°±æ— æ³• binding ç°æˆçš„æ–¹æ³• éœ€è¦æˆ‘ä»¬è‡ªå·±éªŒè¯æ–¹æ³•æ‰èƒ½å®ç° å®˜ç½‘ç¤ºä¾‹ï¼ˆhttps://godoc.org/gopkg.in/go-playground/validator.v10#hdr-Custom_Functionsï¼‰ è¿™é‡Œéœ€è¦ä¸‹è½½å¼•å…¥ä¸‹ gopkg.in/go-playground/validator.v10*/type Person struct Age int `form:age binding:required,gt=10` // 2ã€åœ¨å‚æ•° binding ä¸Šä½¿ç”¨è‡ªå®šä¹‰çš„æ ¡éªŒæ–¹æ³•å‡½æ•°æ³¨å†Œæ—¶å€™çš„åç§° Name string `form:name binding:NotNullAndAdmin` Address string `form:address binding:required`// 1ã€è‡ªå®šä¹‰çš„æ ¡éªŒæ–¹æ³•func nameNotNullAndAdmin(fl validator.FieldLevel) bool if value, ok := fl.Field().Interface().(string); ok // å­—æ®µä¸èƒ½ä¸ºç©ºï¼Œå¹¶ä¸”ä¸ç­‰äº admin return value != !(admin == value) return truefunc main() r := gin.Default() // 3ã€å°†æˆ‘ä»¬è‡ªå®šä¹‰çš„æ ¡éªŒæ–¹æ³•æ³¨å†Œåˆ° validatorä¸­ if v, ok := binding.Validator.Engine().(*validator.Validate); ok // è¿™é‡Œçš„ key å’Œ fn å¯ä»¥ä¸ä¸€æ ·æœ€ç»ˆåœ¨ struct ä½¿ç”¨çš„æ˜¯ key v.RegisterValidation(NotNullAndAdmin, nameNotNullAndAdmin) /* http://127.0.0.1:8080/testing?name=age=12address=beijing http://127.0.0.1:8080/testing?name=adminage=12address=beijing http://127.0.0.1:8080/testing?name=gagaage=12address=beijing */ r.GET(/testing, func(c *gin.Context) var person Person if e := c.ShouldBind(person); e == nil c.String(http.StatusOK, %v, person) else c.String(http.StatusOK, person bind err:%v, e.Error()) ) r.Run() 9.3 å¤šè¯­è¨€ç¿»è¯‘å½“ä¸šåŠ¡ç³»ç»Ÿå¯¹éªŒè¯ä¿¡æ¯æœ‰ç‰¹æ®Šéœ€æ±‚æ—¶ï¼Œä¾‹å¦‚ï¼šè¿”å›ä¿¡æ¯éœ€è¦è‡ªå®šä¹‰ï¼Œæ‰‹æœºç«¯è¿”å›çš„ä¿¡æ¯éœ€è¦æ˜¯ä¸­æ–‡è€Œpcç«¯å‘æŒ¥è¿”å›çš„ä¿¡æ¯éœ€è¦æ—¶è‹±æ–‡ï¼Œå¦‚ ä½•åšåˆ°è¯·æ±‚ä¸€ä¸ªæ¥å£æ»¡è¶³ä¸Šè¿°ä¸‰ç§æƒ…å†µã€‚ package mainimport ( fmt github.com/gin-gonic/gin github.com/go-playground/locales/en github.com/go-playground/locales/zh ut github.com/go-playground/universal-translator en_translations github.com/go-playground/validator/v10/translations/en zh_translations github.com/go-playground/validator/v10/translations/zh github.com/go-playground/validator/v10)var ( Uni *ut.UniversalTranslator Validate *validator.Validate)type User struct Username string `form:user_name validate:required` Tagline string `form:tag_line validate:required,lt=10` Tagline2 string `form:tag_line2 validate:required,gt=1`func main() en := en.New() zh := zh.New() Uni = ut.New(en, zh, en) Validate = validator.New() route := gin.Default() route.GET(/test, startPage) route.POST(/test, startPage) route.Run(:8080)func startPage(c *gin.Context) //è¿™éƒ¨åˆ†åº”æ”¾åˆ°ä¸­é—´ä»¶ä¸­ locale := c.DefaultQuery(locale, zh) trans, _ := Uni.GetTranslator(locale) switch locale case zh: zh_translations.RegisterDefaultTranslations(Validate, trans) break case en: en_translations.RegisterDefaultTranslations(Validate, trans) break default: zh_translations.RegisterDefaultTranslations(Validate, trans) break //è‡ªå®šä¹‰é”™è¯¯å†…å®¹ Validate.RegisterTranslation(required, trans, func(ut ut.Translator) error return ut.Add(required, 0 must have a value!, true) // see universal-translator for details , func(ut ut.Translator, fe validator.FieldError) string t, _ := ut.T(required, fe.Field()) return t ) //è¿™å—åº”è¯¥æ”¾åˆ°å…¬å…±éªŒè¯æ–¹æ³•ä¸­ user := User c.ShouldBind(user) fmt.Println(user) err := Validate.Struct(user) if err != nil errs := err.(validator.ValidationErrors) sliceErrs := []string for _, e := range errs sliceErrs = append(sliceErrs, e.Translate(trans)) c.String(200, fmt.Sprintf(%#v, sliceErrs)) c.String(200, fmt.Sprintf(%#v, user)) æ­£ç¡®çš„é“¾æ¥ï¼šhttp://localhost:8080/test?user_name=æ¯è—¤tag_line=9tag_line2=33locale=zhè¿”å›è‹±æ–‡çš„éªŒè¯ä¿¡æ¯:http://localhost:8080/test?user_name=æ¯è—¤tag_line=9tag_line2=3locale=en http://localhost:8080/test?user_name=æ¯è—¤tag_line=9tag_line2=3locale=zh è¿”å›ä¸­æ–‡çš„éªŒè¯ä¿¡æ¯","tags":["Ginã€GO"],"categories":["Go"]},{"title":"Docker+jenkins+Springbootéƒ¨ç½²æœåŠ¡","path":"/2024/08/22/Docker-jenkins-Springbootéƒ¨ç½²æœåŠ¡/","content":"1. Dockerå®‰è£…Docker CE æ˜¯å…è´¹çš„ Docker äº§å“çš„æ–°åç§°ï¼ŒDocker CE åŒ…å«äº†å®Œæ•´çš„ Docker å¹³å°ï¼Œéå¸¸é€‚åˆå¼€å‘äººå‘˜å’Œè¿ç»´å›¢é˜Ÿæ„å»ºå®¹å™¨ APPã€‚ CentOS 7ï¼ˆä½¿ç”¨ yum è¿›è¡Œå®‰è£…ï¼‰ # step 1: å®‰è£…å¿…è¦çš„ä¸€äº›ç³»ç»Ÿå·¥å…·sudo yum install -y yum-utils device-mapper-persistent-data lvm2## è¿™æ­¥å¦‚æœæ‹‰å–è¶…æ—¶å¯ä»¥ä¿®æ”¹yumæº#ä¸‹è½½ ali yum æº#http://mirrors.aliyun.com/repo/Centos-7.repo#cd /etc/yum.repos.d#cp CentOS-Base.repo CentOS-Base.repo.bak#æ›¿æ¢repo#mv Centos-7.repo CentOS-Base.repo#yum clean all yum makecache#yum -y update# Step 2: æ·»åŠ è½¯ä»¶æºä¿¡æ¯sudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo# PS:å¦‚æœå‡ºç°å¦‚ä¸‹é”™è¯¯ä¿¡æ¯Loaded plugins: fastestmirroradding repo from: https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repograbbing file https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo to /etc/yum.repos.d/docker-ce.repoCould not fetch/save url https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo to file /etc/yum.repos.d/docker-ce.repo: [Errno 14] curl#60 - Peers Certificate issuer is not recognized.# ç¼–è¾‘ /etc/yum.conf æ–‡ä»¶, åœ¨ [main] ä¸‹é¢æ·»åŠ  sslverify=0 å‚æ•°vi /etc/yum.conf# é…ç½®å¦‚ä¸‹----------------------[main]sslverify=0# -----------------------------# Step 3: æ›´æ–°å¹¶å®‰è£…Docker-CEsudo yum makecache fastsudo yum -y install docker-ce# Step 4: å¼€å¯DockeræœåŠ¡sudo service docker start# Step 5: è®¾ç½®å¼€æœºå¯åŠ¨systemctl start dockersystemctl enable docker# æ³¨æ„ï¼š# å®˜æ–¹è½¯ä»¶æºé»˜è®¤å¯ç”¨äº†æœ€æ–°çš„è½¯ä»¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡ç¼–è¾‘è½¯ä»¶æºçš„æ–¹å¼è·å–å„ä¸ªç‰ˆæœ¬çš„è½¯ä»¶åŒ…ã€‚ä¾‹å¦‚å®˜æ–¹å¹¶æ²¡æœ‰å°†æµ‹è¯•ç‰ˆæœ¬çš„è½¯ä»¶æºç½®ä¸ºå¯ç”¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¼€å¯ã€‚åŒç†å¯ä»¥å¼€å¯å„ç§æµ‹è¯•ç‰ˆæœ¬ç­‰ã€‚# vim /etc/yum.repos.d/docker-ee.repo# å°†[docker-ce-test]ä¸‹æ–¹çš„enabled=0ä¿®æ”¹ä¸ºenabled=1## å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„Docker-CE:# Step 1: æŸ¥æ‰¾Docker-CEçš„ç‰ˆæœ¬:# yum list docker-ce.x86_64 --showduplicates | sort -r# Loading mirror speeds from cached hostfile# Loaded plugins: branch, fastestmirror, langpacks# docker-ce.x86_64 17.03.1.ce-1.el7.centos docker-ce-stable# docker-ce.x86_64 17.03.1.ce-1.el7.centos @docker-ce-stable# docker-ce.x86_64 17.03.0.ce-1.el7.centos docker-ce-stable# Available Packages# Step2: å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„Docker-CE: (VERSIONä¾‹å¦‚ä¸Šé¢çš„17.03.0.ce.1-1.el7.centos)# sudo yum -y install docker-ce-[VERSION] 2. æ·»åŠ Dockeré•œåƒæºåŠ é€Ÿé•œåƒåœ°å€ï¼šhttps://status.1panel.top/status/docker sudo mkdir -p /etc/dockersudo tee /etc/docker/daemon.json -EOF registry-mirrors: [ https://docker.1panel.top, https://registry-1.docker.io, https://docker.m.daocloud.io ]EOFsudo systemctl daemon-reloadsudo systemctl restart docker# é‡å¯dockerservice docker restart 3. å®‰è£…docker compose# github: https://github.com/docker/compose/releases/tag/v2.20.2 # å›½å†…ä¸‹è½½åœ°å€ï¼šhttps://gitee.com/smilezgy/compose/releases/tag/v2.20.2curl -SL \\https://github.com/docker/compose/releases/download/v2.20.2/docker-compose-linux-x86_64 \\-o /usr/local/bin/docker-compose # æˆ–è€…æ‰‹åŠ¨ä¸‹è½½, ä¸Šä¼ åˆ°æœåŠ¡å™¨åæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤(use)# åœ¨ docker-compose-linux-x86_64 æ–‡ä»¶åŒä¸€ç›®å½•ä¸‹æ‰§è¡Œcp docker-compose-linux-x86_64 /usr/local/bin/docker-composechmod +x /usr/local/bin/docker-compose# æ³¨æ„dockerç‰ˆæœ¬ 4. å®‰è£…jenkinsç¼–å†™Dockercompose.yml version: 3.8# æ‰§è¡Œè„šæœ¬ï¼›docker-compose -f docker-compose-v1.0.yml up -dservices: jenkins: image: jenkins/jenkins:2.473 container_name: jenkins privileged: true user: root ports: - 9090:8080 - 50001:50000 volumes: - ./jenkins_home:/var/jenkins_home # å¦‚æœä¸é…ç½®åˆ°äº‘æœåŠ¡å™¨è·¯å¾„ä¸‹ï¼Œåˆ™å¯ä»¥é…ç½® jenkins_home ä¼šåˆ›å»ºä¸€ä¸ªæ•°æ®å·ä½¿ç”¨ - /var/run/docker.sock:/var/run/docker.sock - /usr/bin/docker:/usr/local/bin/docker # è¿™ä¸¤ä¸ªé…ç½®æ˜¯jenkinsä½¿ç”¨å®¿ä¸»æœºdocker environment: - JAVA_OPTS=-Djenkins.install.runSetupWizard=false # ç¦æ­¢å®‰è£…å‘å¯¼ã€Œå¦‚æœéœ€è¦å¯†ç åˆ™ä¸è¦é…ç½®ã€docker exec jenkins cat /var/jenkins_home/secrets/initialAdminPassword restart: unless-stoppedvolumes: jenkins_home: æ‰§è¡Œå®‰è£… docker-compose -f Dockercompose.yml up -d 5. é…ç½® jenkisè·å–ç™»å½•å¯†ç  è´¦å·ï¼šadmindocker exec jenkins cat /var/jenkins_home/secrets/initialAdminPassword æ·»åŠ æ’ä»¶ 1~2æ­¥ï¼Œè®¾ç½®é•œåƒæºï¼Œè®¾ç½®åé‡å¯ä¸€ä¸‹ Jenkinsã€‚ é•œåƒæºåœ°å€ï¼šhttps://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json 3~4æ­¥ï¼Œä¸‹è½½æ’ä»¶ï¼Œå…ˆä¸‹è½½å®‰è£… chinese æ±‰åŒ–æ’ä»¶ï¼Œæ–¹ä¾¿ä¸å¤ªç†Ÿæ‚‰ Jenkins çš„ä¼™ä¼´æ›´å¥½çš„çŸ¥é“é¡µé¢éƒ½æ˜¯å•¥å†…å®¹ã€‚ 5æ­¥ï¼Œæ‰€æœ‰çš„æ’ä»¶å®‰è£…å®Œæˆåï¼Œéƒ½éœ€è¦é‡å¯æ‰ä¼šç”Ÿæ•ˆã€‚å®‰è£…å®Œ chinese æ’ä»¶ï¼Œé‡å¯åœ¨è¿›å…¥åˆ° Jenkins å°±æ˜¯æ±‰åŒ–çš„é¡µé¢äº† é™¤äº†ä»¥ä¸Šæ­¥éª¤ï¼Œä½ è¿˜éœ€è¦åŒæ ·çš„æ–¹å¼å®‰è£… mavenã€gitã€docker æ’ä»¶ã€‚ ä¸Šä¼ maven åœ¨å®¿ä¸»æœºä¸­ä¸Šä¼ mavenå¹¶æ‹·è´åˆ°å®¹å™¨ä¸­ ä¿®æ”¹mavenä¸­configé…ç½® ?xml version=1.0 encoding=UTF-8?!--Licensed to the Apache Software Foundation (ASF) under oneor more contributor license agreements. See the NOTICE filedistributed with this work for additional informationregarding copyright ownership. The ASF licenses this fileto you under the Apache License, Version 2.0 (theLicense); you may not use this file except in compliancewith the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0Unless required by applicable law or agreed to in writing,software distributed under the License is distributed on anAS IS BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANYKIND, either express or implied. See the License for thespecific language governing permissions and limitationsunder the License.--!-- | This is the configuration file for Maven. It can be specified at two levels: | | 1. User Level. This settings.xml file provides configuration for a single user, | and is normally provided in $user.home/.m2/settings.xml. | | NOTE: This location can be overridden with the CLI option: | | -s /path/to/user/settings.xml | | 2. Global Level. This settings.xml file provides configuration for all Maven | users on a machine (assuming theyre all using the same Maven | installation). Its normally provided in | $maven.conf/settings.xml. | | NOTE: This location can be overridden with the CLI option: | | -gs /path/to/global/settings.xml | | The sections in this sample file are intended to give you a running start at | getting the most out of your Maven installation. Where appropriate, the default | values (values used when the setting is not specified) are provided. | |--settings xmlns=http://maven.apache.org/SETTINGS/1.2.0 xmlns:xsi=http://www.w3.org/2001/XMLSchema-instance xsi:schemaLocation=http://maven.apache.org/SETTINGS/1.2.0 https://maven.apache.org/xsd/settings-1.2.0.xsd !-- localRepository | The path to the local repository maven will use to store artifacts. | | Default: $user.home/.m2/repository localRepository/path/to/local/repo/localRepository -- localRepository/user/local/maven/repository/localRepository !-- interactiveMode | This will determine whether maven prompts you when it needs input. If set to false, | maven will use a sensible default value, perhaps based on some other setting, for | the parameter in question. | | Default: true interactiveModetrue/interactiveMode -- !-- offline | Determines whether maven should attempt to connect to the network when executing a build. | This will have an effect on artifact downloads, artifact deployment, and others. | | Default: false offlinefalse/offline -- !-- pluginGroups | This is a list of additional group identifiers that will be searched when resolving plugins by their prefix, i.e. | when invoking a command line like mvn prefix:goal. Maven will automatically add the group identifiers | org.apache.maven.plugins and org.codehaus.mojo if these are not already contained in the list. |-- pluginGroups !-- pluginGroup | Specifies a further group identifier to use for plugin lookup. pluginGroupcom.your.plugins/pluginGroup -- /pluginGroups !-- proxies | This is a list of proxies which can be used on this machine to connect to the network. | Unless otherwise specified (by system property or command-line switch), the first proxy | specification in this list marked as active will be used. |-- proxies !-- proxy | Specification for one proxy, to be used in connecting to the network. | proxy idoptional/id activetrue/active protocolhttp/protocol usernameproxyuser/username passwordproxypass/password hostproxy.host.net/host port80/port nonProxyHostslocal.net|some.host.com/nonProxyHosts /proxy -- /proxies !-- servers | This is a list of authentication profiles, keyed by the server-id used within the system. | Authentication profiles can be used whenever maven must make a connection to a remote server. |-- servers !-- server | Specifies the authentication information to use when connecting to a particular server, identified by | a unique name within the system (referred to by the id attribute below). | | NOTE: You should either specify username/password OR privateKey/passphrase, since these pairings are | used together. | server iddeploymentRepo/id usernamerepouser/username passwordrepopwd/password /server -- !-- Another sample, using keys to authenticate. server idsiteServer/id privateKey/path/to/private/key/privateKey passphraseoptional; leave empty if not used./passphrase /server -- /servers !-- mirrors | This is a list of mirrors to be used in downloading artifacts from remote repositories. | | It works like this: a POM may declare a repository to use in resolving certain artifacts. | However, this repository may have problems with heavy traffic at times, so people have mirrored | it to several places. | | That repository definition will have a unique id, so we can create a mirror reference for that | repository, to be used as an alternate download site. The mirror site will be the preferred | server for that repository. |-- mirrors !-- mirror | Specifies a repository mirror site to use instead of a given repository. The repository that | this mirror serves has an ID that matches the mirrorOf element of this mirror. IDs are used | for inheritance and direct lookup purposes, and must be unique across the set of mirrors. | mirror idmirrorId/id mirrorOfrepositoryId/mirrorOf nameHuman Readable Name for this Mirror./name urlhttp://my.repository.com/repo/path/url /mirror mirror idmaven-default-http-blocker/id mirrorOfexternal:http:*/mirrorOf namePseudo repository to mirror external repositories initially using HTTP./name urlhttp://0.0.0.0//url blockedtrue/blocked /mirror -- mirror idalimaven/id namealiyun maven/name urlhttp://maven.aliyun.com/nexus/content/groups/public//url mirrorOfcentral/mirrorOf /mirror /mirrors !-- profiles | This is a list of profiles which can be activated in a variety of ways, and which can modify | the build process. Profiles provided in the settings.xml are intended to provide local machine- | specific paths and repository locations which allow the build to work in the local environment. | | For example, if you have an integration testing plugin - like cactus - that needs to know where | your Tomcat instance is installed, you can provide a variable here such that the variable is | dereferenced during the build process to configure the cactus plugin. | | As noted above, profiles can be activated in a variety of ways. One way - the activeProfiles | section of this document (settings.xml) - will be discussed later. Another way essentially | relies on the detection of a system property, either matching a particular value for the property, | or merely testing its existence. Profiles can also be activated by JDK version prefix, where a | value of 1.4 might activate a profile when the build is executed on a JDK version of 1.4.2_07. | Finally, the list of active profiles can be specified directly from the command line. | | NOTE: For profiles defined in the settings.xml, you are restricted to specifying only artifact | repositories, plugin repositories, and free-form properties to be used as configuration | variables for plugins in the POM. | |-- profiles !-- profile | Specifies a set of introductions to the build process, to be activated using one or more of the | mechanisms described above. For inheritance purposes, and to activate profiles via activatedProfiles/ | or the command line, profiles have to have an ID that is unique. | | An encouraged best practice for profile identification is to use a consistent naming convention | for profiles, such as env-dev, env-test, env-production, user-jdcasey, user-brett, etc. | This will make it more intuitive to understand what the set of introduced profiles is attempting | to accomplish, particularly when you only have a list of profile ids for debug. | | This profile example uses the JDK version to trigger activation, and provides a JDK-specific repo. profile idjdk-1.4/id activation jdk1.4/jdk /activation repositories repository idjdk14/id nameRepository for JDK 1.4 builds/name urlhttp://www.myhost.com/maven/jdk14/url layoutdefault/layout snapshotPolicyalways/snapshotPolicy /repository /repositories /profile -- !-- | Here is another profile, activated by the system property target-env with a value of dev, | which provides a specific path to the Tomcat instance. To use this, your plugin configuration | might hypothetically look like: | | ... | plugin | groupIdorg.myco.myplugins/groupId | artifactIdmyplugin/artifactId | | configuration | tomcatLocation$tomcatPath/tomcatLocation | /configuration | /plugin | ... | | NOTE: If you just wanted to inject this configuration whenever someone set target-env to | anything, you could just leave off the value/ inside the activation-property. | profile idenv-dev/id activation property nametarget-env/name valuedev/value /property /activation properties tomcatPath/path/to/tomcat/instance/tomcatPath /properties /profile -- /profiles !-- activeProfiles | List of profiles that are active for all builds. | activeProfiles activeProfilealwaysActiveProfile/activeProfile activeProfileanotherAlwaysActiveProfile/activeProfile /activeProfiles --/settings docker cp apache-maven-3.9.9 jenkins:/opt/maven å…¨å±€å·¥å…·é…ç½® 6. éƒ¨ç½²æµæ°´çº¿æ–°å»ºä»»åŠ¡ é…ç½®æµæ°´çº¿ æ³¨æ„ï¼šå¦‚æœæ˜¯æ‹‰å–Githubä»£ç éœ€è¦é…ç½®SSHæ–¹å¼ï¼Œpwæ–¹å¼Githubä¸æ”¯æŒ # å…ˆåˆ é™¤ä¹‹å‰çš„å®¹å™¨å’Œé•œåƒæ–‡ä»¶if [ $(docker ps -a | grep zuqiushequguanlixitong) ]; thendocker stop zuqiushequguanlixitongdocker rm zuqiushequguanlixitongfiif [ $(docker images -q zuqiushequguanlixitong) ]; thendocker rmi zuqiushequguanlixitongfi# é‡æ–°ç”Ÿæˆcd /var/jenkins_home/workspace/zuqiushequguanlixitongdocker build -t lianyutian/zuqiushequguanlixitong .docker run -itd -p 8091:8091 --name zuqiushequguanlixitong lianyutian/zuqiushequguanlixitong æ‰§è¡Œéƒ¨ç½²","tags":["CICD"]},{"title":"ArrayBlockingQueueè¯¦è§£","path":"/2024/05/31/ArrayBlockingQueueè¯¦è§£/","content":"ä½¿ç”¨åœºæ™¯æœ‰è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œä¸¤ä¸ªçº¿ç¨‹éœ€è¦äº¤æ¢æ•°æ®ã€‚ä¸€ä¸ªçº¿ç¨‹ç”Ÿäº§æ•°æ®ï¼Œä¸€ä¸ªçº¿ç¨‹æ¶ˆè´¹æ•°æ®ã€‚æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨é˜Ÿåˆ—ã€‚ /** * @author lm * @since 2024-06-03 16:34:54 * @version 1.0 */public class QueueTest public static void main(String[] args) throws IOException ArrayDequeString arrayDeque = new ArrayDeque(10); Product product = new Product(arrayDeque); Consumer consumer = new Consumer(arrayDeque); new Thread(product).start(); new Thread(consumer).start(); static class Product implements Runnable private final ArrayDequeString queue; public Product(ArrayDequeString arrayQueue) this.queue = arrayQueue; @Override public void run() while (true) queue.offer(æµ‹è¯•æ¶ˆæ¯); System.out.println(queue.size()); static class Consumer implements Runnable private ArrayDequeString queue; public Consumer(ArrayDequeString arrayQueue) this.queue = arrayQueue; @Override public void run() try while (true) Thread.sleep(1000); System.out.println(queue.poll()); catch (InterruptedException e) e.printStackTrace(); åœ¨ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸€ä¸ªçº¿ç¨‹ç”Ÿäº§æ¶ˆæ¯ï¼Œä¸€ä¸ªçº¿ç¨‹æ¶ˆè´¹æ¶ˆæ¯ã€‚ä½†æ˜¯è¿™é‡Œå­˜åœ¨2ä¸ªé—®é¢˜ï¼š æˆ‘ä»¬æ§åˆ¶ä¸äº†é˜Ÿåˆ—çš„å­˜å‚¨æ•°æ®çš„ä¸Šé™ï¼Œå½“é˜Ÿåˆ—ä¸­æ•°æ®è¶…å‡ºåˆå§‹åŒ–å¤§å°æ—¶ï¼Œé˜Ÿåˆ—ä¼šè‡ªåŠ¨æ‰©å®¹ï¼› å½“é˜Ÿåˆ—æ•°æ®ä¸ºç©ºæ—¶ï¼Œæ¶ˆè´¹çº¿ç¨‹è¿˜æ˜¯ä¼šä¸æ–­å°è¯•æ‹‰å–æ•°æ®ä½¿å¾—CPUç©ºè½¬ï¼› æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨ArrayBlockingQueueæ¥è¿›è¡Œæ”¹é€ ã€‚ /** * @author lm * @since 2024-06-03 16:34:54 * @version 1.0 */public class ArrayBlockTest public static void main(String[] args) throws IOException ArrayBlockingQueue arrayBlockingQueue = new ArrayBlockingQueue(10); Product product = new Product(arrayBlockingQueue); Consumer consumer = new Consumer(arrayBlockingQueue); new Thread(product).start(); new Thread(consumer).start(); static class Product implements Runnable private ArrayBlockingQueue queue; public Product(ArrayBlockingQueue arrayBlockingQueue) this.queue = arrayBlockingQueue; @Override public void run() try while (true) queue.put(æµ‹è¯•æ¶ˆæ¯); System.out.println(queue.size()); catch (InterruptedException e) e.printStackTrace(); static class Consumer implements Runnable private ArrayBlockingQueue queue; public Consumer(ArrayBlockingQueue arrayBlockingQueue) this.queue = arrayBlockingQueue; @Override public void run() try while (true) Thread.sleep(1000); System.out.println(queue.take()); catch (InterruptedException e) e.printStackTrace(); ArrayBlockingQueueæ˜¯ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ã€‚æˆ‘ä»¬æ¥è§£æä¸‹é˜»å¡é˜Ÿåˆ—è¿™å››ä¸ªå­—ï¼Œé˜Ÿåˆ—æ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„æ•°æ®æœºæ„ï¼Œé˜»å¡æ˜¯å½“é˜Ÿåˆ—ä¸ºç©ºæ—¶è·å–é˜Ÿåˆ—æ•°æ®æ“ä½œä¼šè¢«é˜»å¡ï¼Œå½“é˜Ÿåˆ—æ»¡æ—¶å…¥é˜Ÿåˆ—æ“ä½œä¼šè¢«é˜»å¡ã€‚é€šè¿‡é˜»å¡ï¼Œæˆ‘ä»¬å¯ä»¥è§£å†³ä¸Šè¿°ä¸¤ä¸ªé—®é¢˜ã€‚é€šè¿‡åˆå§‹åŒ–å®¹é‡æ§åˆ¶é˜Ÿåˆ—å¤§å°ï¼Œé€šè¿‡é˜»å¡é˜²æ­¢CPUç©ºè½¬ã€‚ åŸç†è§£æå…¥é˜Ÿåˆ—æµç¨‹/** * Inserts the specified element at the tail of this queue, waiting * for space to become available if the queue is full. * * @throws InterruptedException @inheritDoc * @throws NullPointerException @inheritDoc */public void put(E e) throws InterruptedException // åˆ¤æ–­æ•°æ®æ˜¯å¦ä¸ºç©º,ä¸ºç©ºæŠ›å‡ºNullPointerException Objects.requireNonNull(e); final ReentrantLock lock = this.lock; // è¿™é‡Œä½¿ç”¨ReentrantLocké”ä½,å› ä¸ºå¯èƒ½å­˜åœ¨å¤šä¸ªçº¿ç¨‹å¾€è¯¥é˜Ÿåˆ—ä¸­å­˜æ”¾æ•°æ® // é”ä½ä¸ºäº†å¹¶å‘å®‰å…¨ä¸”å¯å“åº”ä¸­æ–­æ“ä½œ lock.lockInterruptibly(); try // åˆ¤æ–­å½“å‰é˜Ÿåˆ—ä¸­çš„æ•°æ®æ˜¯å¦å·²æ»¡ while (count == items.length) // æ»¡äº†å°±å°†notFullè¿™ä¸ªConditionæ¡ä»¶é˜Ÿåˆ—é˜»å¡ä½ notFull.await(); // å°†æ•°æ®å­˜å…¥é˜Ÿåˆ— enqueue(e); finally lock.unlock(); æˆ‘ä»¬æ¨¡æ‹Ÿç”Ÿäº§çº¿ç¨‹ç¬¬ä¸€æ¬¡å¾€é˜Ÿåˆ—æ’å…¥æ•°æ®, æ‰€ä»¥æ¥ä¸‹æ¥çœ‹enqueue(e)æ–¹æ³• /** * Inserts element at current put position, advances, and signals. * Call only when holding lock. */private void enqueue(E e) // assert lock.isHeldByCurrentThread(); // assert lock.getHoldCount() == 1; // assert items[putIndex] == null; // ArrayBlockingQueueåº•å±‚æ•°æ®ç»“æ„æ˜¯æ•°ç»„,è¿™é‡Œè·å–åˆ°å­˜æ”¾æ•°æ®çš„æ•°ç»„ final Object[] items = this.items; // å°†æ•°æ®å­˜å…¥æ•°ç»„,putIndexæ˜¯å­˜å…¥ç»„æ•°é˜Ÿåˆ—ä¸­çš„æ•°æ®ç´¢å¼• items[putIndex] = e; // æ³¨æ„è¿™é‡Œæ˜¯ä¸ªå¾ªç¯é˜Ÿåˆ—ï¼Œè®¡ç®—ä¸‹æ ‡ if (++putIndex == items.length) putIndex = 0; // é˜Ÿåˆ—å­˜å‚¨æ•°æ®é‡+1 count++; // å”¤é†’notEmptyè¿™ä¸ªConditionæ¡ä»¶é˜Ÿåˆ—ï¼Œè°ƒç”¨take()æ–¹æ³•æ—¶æ²¡æœ‰æ•°æ®ä¼šè°ƒç”¨notEmpty.await(); notEmpty.signal(); æ¥ä¸‹æ¥çœ‹ä¸‹é˜Ÿåˆ—å¦‚æœæ»¡äº†ï¼Œæµç¨‹è¿›å…¥notFull.await();æ–¹æ³•ï¼š /** * Implements interruptible condition wait. * ol * liIf current thread is interrupted, throw InterruptedException. * liSave lock state returned by @link #getState. * liInvoke @link #release with saved state as argument, * throwing IllegalMonitorStateException if it fails. * liBlock until signalled or interrupted. * liReacquire by invoking specialized version of * @link #acquire with saved state as argument. * liIf interrupted while blocked in step 4, throw InterruptedException. * /ol */public final void await() throws InterruptedException if (Thread.interrupted()) throw new InterruptedException(); // åˆ›å»ºä¸€ä¸ªConditionNode ConditionNode node = new ConditionNode(); int savedState = enableWait(node); LockSupport.setCurrentBlocker(this); // for back-compatibility boolean interrupted = false, cancelled = false, rejected = false; while (!canReacquire(node)) if (interrupted |= Thread.interrupted()) if (cancelled = (node.getAndUnsetStatus(COND) COND) != 0) break; // else interrupted after signal else if ((node.status COND) != 0) try if (rejected) node.block(); else ForkJoinPool.managedBlock(node); catch (RejectedExecutionException ex) rejected = true; catch (InterruptedException ie) interrupted = true; else Thread.onSpinWait(); // awoke while enqueuing LockSupport.setCurrentBlocker(null); node.clearStatus(); acquire(node, savedState, false, false, false, 0L); if (interrupted) if (cancelled) unlinkCancelledWaiters(node); throw new InterruptedException(); Thread.currentThread().interrupt(); æ¥çœ‹ä¸‹await()æ–¹æ³•åšäº†äº›ä»€ä¹ˆï¼Œé¦–å…ˆåˆ¤æ–­çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­äº†å¦‚æœè¢«ä¸­æ–­ç›´æ¥æŠ›å‡ºä¸­æ–­å¼‚å¸¸ã€‚ æ¥ä¸‹æ¥åˆ›å»ºäº†ä¸€ä¸ªConditionNodeï¼Œçœ‹ä¸‹ConditionNodeç»“æ„ï¼š // Concrete classes tagged by typestatic final class ExclusiveNode extends Node static final class SharedNode extends Node static final class ConditionNode extends Node implements ForkJoinPool.ManagedBlocker ConditionNode nextWaiter; // link to next waiting node /** * Allows Conditions to be used in ForkJoinPools without * risking fixed pool exhaustion. This is usable only for * untimed Condition waits, not timed versions. */ public final boolean isReleasable() return status = 1 || Thread.currentThread().isInterrupted(); public final boolean block() while (!isReleasable()) LockSupport.park(); return true; å’ŒExclusiveNodeã€SharedNodeä¸€æ ·è¿˜æ˜¯ç»§æ‰¿Nodeç±»ï¼Œä¸è¿‡é¢å¤–ç»§æ‰¿äº†ForkJoinPool.ManagedBlockerä¸”æä¾›äº†isReleasable()å’Œblock()ä¸¤ä¸ªæ–¹æ³•ã€‚ æ¥ä¸‹æ¥çœ‹ä¸‹int savedState = enableWait(node); /** * Adds node to condition list and releases lock. * * @param node the node * @return savedState to reacquire after wait */private int enableWait(ConditionNode node) // åˆ¤æ–­è·å–åˆ°é”çš„æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹ if (isHeldExclusively()) // å°†å½“å‰çº¿ç¨‹èµ‹å€¼ç»™nodeçš„waiter node.waiter = Thread.currentThread(); // è®¾ç½®èŠ‚ç‚¹çš„statusçŠ¶æ€ä¸º3 // 10 (COND, äºŒè¿›åˆ¶) | 01 (WAITING, äºŒè¿›åˆ¶) // 11 (ç»“æœ, å³ 3 in decimal) node.setStatusRelaxed(COND | WAITING); // è®¾ç½®å°¾èŠ‚ç‚¹ ConditionNode last = lastWaiter; if (last == null) firstWaiter = node; else last.nextWaiter = node; lastWaiter = node; // è·å–å½“å‰stateå€¼ int savedState = getState(); // å°è¯•ä¸‹é‡Šæ”¾é” if (release(savedState)) return savedState; // èŠ‚ç‚¹çŠ¶æ€è®¾ç½®ä¸ºå–æ¶ˆ node.status = CANCELLED; // lock not held or inconsistent throw new IllegalMonitorStateException(); æ ¹æ®æ–¹æ³•æè¿°å¯ä»¥ç›´åˆ°è¿™ä¸ªæ–¹æ³•ä¸»è¦ä½œç”¨å°±æ˜¯å°†å½“å‰çº¿ç¨‹å°è£…å…¥ConditionNodeå¹¶æ”¾å…¥conditionæ¡ä»¶é˜Ÿåˆ—ä¸­ï¼Œç„¶åé‡Šæ”¾é”ã€‚ ä¸»è¦çœ‹ä¸‹release(savedState)è¿™ä¸ªæ–¹æ³•ï¼š /** * Releases in exclusive mode. Implemented by unblocking one or * more threads if @link #tryRelease returns true. * This method can be used to implement method @link Lock#unlock. * * @param arg the release argument. This value is conveyed to * @link #tryRelease but is otherwise uninterpreted and * can represent anything you like. * @return the value returned from @link #tryRelease */public final boolean release(int arg) // å°è¯•é‡Šæ”¾é” if (tryRelease(arg)) // å¦‚æœé‡Šæ”¾é”æˆåŠŸï¼Œå›å»å”¤é†’æ¡ä»¶é˜Ÿåˆ—ä¸­çš„ç­‰å¾…çš„èŠ‚ç‚¹ signalNext(head); return true; return false;private static void signalNext(Node h) Node s; if (h != null (s = h.next) != null s.status != 0) s.getAndUnsetStatus(WAITING); LockSupport.unpark(s.waiter); æ¥ä¸‹æ¥å›åˆ°await()æ–¹æ³•ä¸­ï¼š /** * Implements interruptible condition wait. * ol * liIf current thread is interrupted, throw InterruptedException. * liSave lock state returned by @link #getState. * liInvoke @link #release with saved state as argument, * throwing IllegalMonitorStateException if it fails. * liBlock until signalled or interrupted. * liReacquire by invoking specialized version of * @link #acquire with saved state as argument. * liIf interrupted while blocked in step 4, throw InterruptedException. * /ol */public final void await() throws InterruptedException if (Thread.interrupted()) throw new InterruptedException(); // åˆ›å»ºä¸€ä¸ªConditionNode ConditionNode node = new ConditionNode(); // å°†nodeèŠ‚ç‚¹åŠ å…¥æ¡ä»¶é˜Ÿåˆ—å¹¶é‡Šæ”¾é” int savedState = enableWait(node); LockSupport.setCurrentBlocker(this); // for back-compatibility boolean interrupted = false, cancelled = false, rejected = false; while (!canReacquire(node)) if (interrupted |= Thread.interrupted()) if (cancelled = (node.getAndUnsetStatus(COND) COND) != 0) break; // else interrupted after signal else if ((node.status COND) != 0) try if (rejected) node.block(); else ForkJoinPool.managedBlock(node); catch (RejectedExecutionException ex) rejected = true; catch (InterruptedException ie) interrupted = true; else Thread.onSpinWait(); // awoke while enqueuing LockSupport.setCurrentBlocker(null); node.clearStatus(); acquire(node, savedState, false, false, false, 0L); if (interrupted) if (cancelled) unlinkCancelledWaiters(node); throw new InterruptedException(); Thread.currentThread().interrupt(); æˆ‘ä»¬æ¥çœ‹ä¸‹canReacquireæ–¹æ³•ä½œç”¨ï¼š /** * Returns true if a node that was initially placed on a condition * queue is now ready to reacquire on sync queue. * @param node the node * @return true if is reacquiring */private boolean canReacquire(ConditionNode node) // check links, not status to avoid enqueue race return node != null node.prev != null isEnqueued(node);/** Returns true if node is found in traversal from tail */final boolean isEnqueued(Node node) for (Node t = tail; t != null; t = t.prev) if (t == node) return true; return false; è¿™é‡Œçš„ä»£ç è¦ç»“åˆå”¤é†’çš„ä»£ç æ¥çœ‹ï¼š /** * Moves the longest-waiting thread, if one exists, from the * wait queue for this condition to the wait queue for the * owning lock. * * @throws IllegalMonitorStateException if @link #isHeldExclusively * returns @code false */public final void signal() ConditionNode first = firstWaiter; if (!isHeldExclusively()) throw new IllegalMonitorStateException(); if (first != null) // ç§»åŠ¨æ¡ä»¶é˜Ÿåˆ—ä¸­ç­‰å¾…èŠ‚ç‚¹åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ doSignal(first, false);/** * Removes and transfers one or all waiters to sync queue. */private void doSignal(ConditionNode first, boolean all) while (first != null) ConditionNode next = first.nextWaiter; if ((firstWaiter = next) == null) lastWaiter = null; if ((first.getAndUnsetStatus(COND) COND) != 0) enqueue(first); if (!all) break; first = next; /** * Enqueues the node unless null. (Currently used only for * ConditionNodes; other cases are interleaved with acquires.) */final void enqueue(Node node) if (node != null) for (;;) // åŒæ­¥é˜Ÿåˆ—ä¸­å°¾èŠ‚ç‚¹èµ‹å€¼ç»™t Node t = tail; node.setPrevRelaxed(t); // avoid unnecessary fence if (t == null) // initialize // åˆå§‹åŒ–åŒæ­¥é˜Ÿåˆ— tryInitializeHead(); // å°†åŒæ­¥é˜Ÿåˆ—ä¸­å°¾èŠ‚ç‚¹tailè®¾ç½®ä¸ºæ¡ä»¶é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹ else if (casTail(t, node)) // å°†åŸå°¾èŠ‚ç‚¹nextæŒ‡å‘å½“å‰èŠ‚ç‚¹ t.next = node; if (t.status 0) // wake up to clean link LockSupport.unpark(node.waiter); break; ç»“åˆæ¥çœ‹ï¼ŒcanReacquire()æ–¹æ³•å°±æ˜¯åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚ æ¥ç€å¾€ä¸‹çœ‹ï¼Œå¦‚æœèŠ‚ç‚¹ä¸åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­åˆ™è¿›å…¥whileä»£ç å—ï¼š public final void await() throws InterruptedException if (Thread.interrupted()) throw new InterruptedException(); // åˆ›å»ºä¸€ä¸ªConditionNode ConditionNode node = new ConditionNode(); // å°†nodeèŠ‚ç‚¹åŠ å…¥æ¡ä»¶é˜Ÿåˆ—å¹¶é‡Šæ”¾é” int savedState = enableWait(node); LockSupport.setCurrentBlocker(this); // for back-compatibility boolean interrupted = false, cancelled = false, rejected = false; while (!canReacquire(node)) // åˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸­æ–­ if (interrupted |= Thread.interrupted()) if (cancelled = (node.getAndUnsetStatus(COND) COND) != 0) break; // else interrupted after signal // åˆ¤æ–­èŠ‚ç‚¹çŠ¶æ€æ˜¯å¦æ˜¯waitçŠ¶æ€ else if ((node.status COND) != 0) try if (rejected) node.block(); else // é˜»å¡å½“å‰çº¿ç¨‹ ForkJoinPool.managedBlock(node); catch (RejectedExecutionException ex) rejected = true; catch (InterruptedException ie) interrupted = true; else // å¦‚æœèŠ‚ç‚¹çŠ¶æ€æ—¢ä¸æ˜¯CONDï¼Œä¹Ÿä¸æ˜¯åœ¨å…¥é˜Ÿæ—¶è¢«å”¤é†’çš„ï¼Œåˆ™è°ƒç”¨Thread.onSpinWait()è¿›è¡Œè‡ªæ—‹ç­‰å¾…ã€‚ Thread.onSpinWait(); // awoke while enqueuing // è¿™é‡Œçš„ä»£ç æ˜¯åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­è¢«å”¤é†’çš„çº¿ç¨‹ä¼šç»§ç»­æ‰§è¡Œ LockSupport.setCurrentBlocker(null); node.clearStatus(); // å°è¯•è·å–é” acquire(node, savedState, false, false, false, 0L); if (interrupted) if (cancelled) unlinkCancelledWaiters(node); throw new InterruptedException(); Thread.currentThread().interrupt(); æ€»ç»“ä¸‹æ•´ä¸ªå…¥é˜Ÿåˆ—çš„æµç¨‹ï¼š è·å–ReentrantLocké” åˆ¤æ–­é˜Ÿåˆ—å®¹é‡æ˜¯å¦å·²æ»¡ å®¹é‡ä¸æ»¡åˆ™å°†å¯¹è±¡æ”¾å…¥é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—å®¹é‡countåŠ 1 å”¤é†’notEmptyæ¡ä»¶é˜Ÿåˆ—ä¸Šç­‰å¾…çš„èŠ‚ç‚¹çº¿ç¨‹ å¦‚æœé˜Ÿåˆ—å®¹é‡æ»¡äº† è°ƒç”¨notEmptyæ¡ä»¶é˜Ÿåˆ—çš„awaitæ–¹æ³• å°†å½“å‰çº¿ç¨‹å°è£…æˆConditionNode åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦åœ¨åŒæ­¥é˜Ÿé‡Œä¸­ï¼ˆè°ƒç”¨notFull.signal()æ–¹æ³•ä¼šå°†æ¡ä»¶é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼‰ ä¸åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œé˜»å¡å½“å‰çº¿ç¨‹ å‡ºé˜Ÿåˆ—æµç¨‹ç±»ä¼¼å°±ä¸å†è¯¦ç»†çœ‹äº†ã€‚ å…¥é˜Ÿå‡ºé˜ŸAPIå…¥é˜ŸAPIputã€offerã€add /** * Inserts the specified element at the tail of this queue, waiting * for space to become available if the queue is full. * * @throws InterruptedException @inheritDoc * @throws NullPointerException @inheritDoc */public void put(E e) throws InterruptedException Objects.requireNonNull(e); final ReentrantLock lock = this.lock; lock.lockInterruptibly(); try while (count == items.length) notFull.await(); enqueue(e); finally lock.unlock(); /** * Inserts the specified element at the tail of this queue if it is * possible to do so immediately without exceeding the queues capacity, * returning @code true upon success and @code false if this queue * is full. This method is generally preferable to method @link #add, * which can fail to insert an element only by throwing an exception. * * @throws NullPointerException if the specified element is null */public boolean offer(E e) Objects.requireNonNull(e); final ReentrantLock lock = this.lock; lock.lock(); try if (count == items.length) return false; else enqueue(e); return true; finally lock.unlock(); /** * Inserts the specified element into this queue if it is possible to do so * immediately without violating capacity restrictions, returning * @code true upon success and throwing an @code IllegalStateException * if no space is currently available. * * pThis implementation returns @code true if @code offer succeeds, * else throws an @code IllegalStateException. * * @param e the element to add * @return @code true (as specified by @link Collection#add) * @throws IllegalStateException if the element cannot be added at this * time due to capacity restrictions * @throws ClassCastException if the class of the specified element * prevents it from being added to this queue * @throws NullPointerException if the specified element is null and * this queue does not permit null elements * @throws IllegalArgumentException if some property of this element * prevents it from being added to this queue */public boolean add(E e) if (offer(e)) return true; else throw new IllegalStateException(Queue full); ä¸‰è€…åŒºåˆ«ï¼š putåœ¨é˜Ÿåˆ—æ»¡æ—¶ä¼šé˜»å¡ offeråœ¨é˜Ÿåˆ—æ»¡æ—¶ä¼šç›´æ¥è¿”å›false addè¿˜æ˜¯è°ƒç”¨offerï¼Œä¸è¿‡é˜Ÿåˆ—æ»¡æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ å‡ºé˜ŸAPItakeã€pollã€peek public E take() throws InterruptedException final ReentrantLock lock = this.lock; lock.lockInterruptibly(); try while (count == 0) notEmpty.await(); return dequeue(); finally lock.unlock(); public E poll() final ReentrantLock lock = this.lock; lock.lock(); try return (count == 0) ? null : dequeue(); finally lock.unlock(); public E peek() final ReentrantLock lock = this.lock; lock.lock(); try return itemAt(takeIndex); // null when queue is empty finally lock.unlock(); ä¸‰è€…åŒºåˆ«ï¼š takeåœ¨é˜Ÿåˆ—ç©ºæ—¶ä¼šé˜»å¡ pollåœ¨é˜Ÿåˆ—ç©ºæ—¶ä¼šç›´æ¥è¿”å›null peekç›´æ¥è¿”å›takeIndexä¸‹æ ‡å¯¹åº”çš„æ•°æ®","tags":["ArrayBlockingQueue"],"categories":["é˜Ÿåˆ—"]},{"title":"ReentrantLockè¯¦è§£","path":"/2024/05/29/ReentrantLockè¯¦è§£/","content":"1. é”ç¤ºä¾‹ åŸºäºJDK17 ä»Šå¤©æ¥çœ‹ä¸‹ReentrantLocké”å®ç°çš„åŸç†ï¼Œä¸å¤šBBå…ˆçœ‹ä¸€æ®µä»£ç ã€‚ /** * ReentrantLockTest * * @author lm * @since 2024-05-29 16:45:43 * @version 1.0 */public class ReentrantLockTest public static void main(String[] args) TicketCenter ticketCenter = new TicketCenter(); new Thread(new Consumer(ticketCenter), 1å·å”®ç¥¨çª—å£).start(); new Thread(new Consumer(ticketCenter), 2å·å”®ç¥¨çª—å£).start(); new Thread(new Consumer(ticketCenter), 3å·å”®ç¥¨çª—å£).start(); /** * å”®ç¥¨ä¸­å¿ƒ */class TicketCenter // æ ¹æ®éœ€æ±‚ï¼šå®šä¹‰50å¼ è½¦ç¥¨ private int capacity = 50; // æ ¹æ®éœ€æ±‚ï¼šsale æ–¹æ³•åˆ›å»º public void sale() try //æ²¡æœ‰ç¥¨çš„æƒ…å†µä¸‹ï¼Œåœæ­¢å”®ç¥¨ while (capacity == 0) System.out.println(è­¦å‘Šï¼šçº¿ç¨‹( + Thread.currentThread().getName() + )å‡†å¤‡å”®ç¥¨ï¼Œä½†å½“å‰æ²¡æœ‰å‰©ä½™è½¦ç¥¨); Thread.sleep(10000000000L); //å¦‚æœæœ‰ç¥¨ï¼Œåˆ™å”®å– -1 capacity--; System.out.println(çº¿ç¨‹( + Thread.currentThread().getName() + )å”®å‡ºä¸€å¼ ç¥¨ã€‚ + å½“å‰å‰©ä½™ç¥¨æ•° + capacity + ä¸ª); catch (InterruptedException e) throw new RuntimeException(e); /** * å”®ç¥¨çª—å£ */class Consumer implements Runnable private TicketCenter TicketCenter; public Consumer(TicketCenter TicketCenter) this.TicketCenter = TicketCenter; public void run() while (true) //è°ƒç”¨sale æ–¹æ³• TicketCenter.sale(); è¿™æ˜¯ä¸€æ®µå¾ˆç®€å•çš„ä»£ç ï¼Œå®šä¹‰ä¸ªå”®ç¥¨ä¸­å¿ƒã€‚å”®ç¥¨ä¸­å¿ƒé‡Œå®šä¹‰äº†å…±äº«å˜é‡capacityè½¦ç¥¨æ•°ã€‚å†å®šä¹‰ä¸€ä¸ªå”®ç¥¨çª—å£ç±»ï¼Œè´Ÿè´£è½¦ç¥¨çš„å”®å–ã€‚å¾ˆæ˜æ˜¾æ­¤æ—¶ä¼šæœ‰å¤šçº¿ç¨‹å¹¶å‘é—®é¢˜ï¼Œå¤šä¸ªçª—å£åŒæ—¶å–ç¥¨æ—¶sale()æ–¹æ³•æœªåŠ é”ï¼Œå¤šä¸ªçº¿ç¨‹ä¼šåŒæ—¶æ“ä½œcapacityå˜é‡ã€‚æ­¤æ—¶ä¼šå¯¼è‡´è¶…å–çš„ç°è±¡ã€‚æ‰€ä»¥æˆ‘ä»¬è¦å¯¹saleæ–¹æ³•åŠ æŠŠé”ã€‚ class TicketCenter private ReentrantLock lock = new ReentrantLock(); // æ ¹æ®éœ€æ±‚ï¼šsale æ–¹æ³•åˆ›å»º public void sale() try lock.lock(); // å”®ç¥¨é€»è¾‘ ... finally lock.unlock(); åŠ é”ååŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ¥è®¿é—®ä¸‹é¢çš„å”®ç¥¨é€»è¾‘ï¼Œä¸ä¼šå¯¼è‡´è¶…å–ç°è±¡ã€‚æ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬æ·±å…¥lock()æ–¹æ³•ï¼Œæ¢ç©¶ä¸‹lock()çš„åŠ é”é€»è¾‘ã€‚ 2. åŠ é”æµç¨‹/** * Acquires the lock. * * pAcquires the lock if it is not held by another thread and returns * immediately, setting the lock hold count to one. * * pIf the current thread already holds the lock then the hold * count is incremented by one and the method returns immediately. * * pIf the lock is held by another thread then the * current thread becomes disabled for thread scheduling * purposes and lies dormant until the lock has been acquired, * at which time the lock hold count is set to one. */public void lock() sync.lock(); æ¥çœ‹ä¸‹è¿™ä¸ªæ–¹æ³•çš„å®šä¹‰ï¼š ç”³è¯·ä¸€æŠŠé” å¦‚æœé”æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œé‚£ä¹ˆç«‹é©¬è¿”å›å¹¶é”å®šä¹Ÿå°±æ˜¯è®¾ç½®state1 å¦‚æœé”å·²ç»è¢«å½“å‰çº¿ç¨‹æŒæœ‰äº†ï¼Œé‚£ä¹ˆstate+1ç„¶åç«‹é©¬è¿”å› å¦‚æœé”è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°±ä¸å¯ç”¨ï¼ˆé˜»å¡ï¼‰ç›´åˆ°ç”³è¯·åˆ°é”ã€‚åŒæ—¶ä¹Ÿä¼šè®¾ç½®state1 å†æ¥çœ‹ä¸‹å®ç°ï¼š final void lock() if (!initialTryLock()) acquire(1); initialTryLock()è¯¥æ–¹æ³•æœ‰ä¸¤ä¸ªå®ç°ï¼Œå…¬å¹³é”å’Œéå…¬å¹³é”ï¼š æˆ‘ä»¬å…ˆçœ‹éå…¬å¹³é”ï¼š final boolean initialTryLock() Thread current = Thread.currentThread(); if (compareAndSetState(0, 1)) // first attempt is unguarded setExclusiveOwnerThread(current); return true; else if (getExclusiveOwnerThread() == current) int c = getState() + 1; if (c 0) // overflow throw new Error(Maximum lock count exceeded); setState(c); return true; else return false; é¦–å…ˆè·å–å½“å‰çº¿ç¨‹ ç›´æ¥å°è¯•ä½¿ç”¨CASå»åŠ é”ï¼ˆè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç§°ä¸ºéå…¬å¹³çš„åŸå› ï¼‰ åŠ é”æˆåŠŸï¼Œè®¾ç½®æŒæœ‰è¿™æŠŠé”çš„çº¿ç¨‹ä¸ºå½“å‰çº¿ç¨‹ è¿”å›trueåŠ é”æˆåŠŸ else if (getExclusiveOwnerThread() == current)è¿™ä¸€è¡Œåˆ¤æ–­å°±æ˜¯é‡å…¥é€»è¾‘äº†ï¼Œå¦‚æœæŒæœ‰è¿™æŠŠé”çš„å°±æ˜¯å½“å‰çº¿ç¨‹é‚£ä¹ˆå°†stateå€¼+1ç„¶åè¿”å›trueåŠ é”æˆåŠŸã€‚ å‰©ä½™å°±æ˜¯åŠ é”å¤±è´¥äº†ã€‚ å¥½ï¼Œç°åœ¨æ ¹æ®è¿”å›å€¼å†è¿”å›çœ‹çœ‹ï¼š final void lock() if (!initialTryLock()) acquire(1); åŠ é”æˆåŠŸè¿”å›trueï¼Œæ²¡å•¥å¯è¯´çš„ã€‚ åŠ é”å¤±è´¥æ—¶ï¼Œå°±å»æ‰§è¡Œacquire(1)æ–¹æ³•ã€‚ æ¥ä¸‹æ¥å°±çœ‹è¿™ä¸ªæ–¹æ³•acquire(1)ï¼š public final void acquire(int arg) if (!tryAcquire(arg)) acquire(null, arg, false, false, false, 0L); è¿›å…¥æ–¹æ³•å…ˆçœ‹tryAcquire(arg)ï¼Œè¿™ä¸ªæ˜¯AQSæä¾›çš„ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ï¼Œä¸»è¦è¿˜æ˜¯çœ‹å…·ä½“å®ç°ã€‚è¿˜æ˜¯ä»¥éå…¬å¹³ä¸ºä¾‹ï¼š protected final boolean tryAcquire(int acquires) if (getState() == 0 compareAndSetState(0, acquires)) setExclusiveOwnerThread(Thread.currentThread()); return true; return false; è¿™æ®µä»£ç æœ‰ä¸Šé¢åŸºç¡€å¾ˆå®¹æ˜“å°±çœ‹æ‡‚äº†ï¼Œé¦–å…ˆè·å–stateå€¼ã€‚state0å°±è¯´æ˜å½“å‰é”æ²¡æœ‰è¢«æŒæœ‰ï¼Œç„¶åå°è¯•åŠ é”ï¼ˆå› ä¸ºæ˜¯å¤šçº¿ç¨‹ç¯å¢ƒå¯èƒ½ä¸Šä¸€ç§’ä½ çš„getState() 0 ä¸‹ä¸€ç§’stateçš„å€¼å°±è¢«æ”¹äº†ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨CASå°è¯•è¯¥å€¼åŠ é”ï¼‰ã€‚æˆåŠŸå°±è®¾ç½®æŒæœ‰é”çš„æ˜¯å½“å‰çº¿ç¨‹ç„¶åè¿”å›åŠ é”æˆåŠŸï¼Œå¤±è´¥è¿”å›falseã€‚ å›åˆ°acquire(arg)æ–¹æ³•ï¼Œå…ˆçœ‹ä¸‹æ–¹æ³•çš„å®šä¹‰ï¼š /** * ä¸»è¦è·å–é”çš„æ–¹æ³•ï¼Œè¢«æ‰€æœ‰å¯¼å‡ºçš„è·å–æ–¹æ³•è°ƒç”¨ã€‚ * * @param node é”èŠ‚ç‚¹ * @param arg åŠ é”å€¼ * @param shared å¦‚æœä¸ºtrueï¼Œåˆ™ä¸ºå…±äº«æ¨¡å¼ï¼Œå¦åˆ™ä¸ºç‹¬å æ¨¡å¼ * @param interruptible æ˜¯å¦éœ€è¦ä¸­æ–­ * @param timed å¦‚æœä¸ºtrueï¼Œåˆ™ä½¿ç”¨å®šæ—¶ç­‰å¾… * @param time å¦‚æœå®šæ—¶ï¼Œè¡¨ç¤ºè¶…æ—¶æ—¶é—´ * @return å¦‚æœåŠ é”æˆåŠŸè¿”å›æ­£æ•°ï¼Œå¦‚æœè¶…æ—¶è¿”å›0ï¼Œå¦‚æœä¸­æ–­è¿”å›è´Ÿæ•° */final int acquire(Node node, int arg, boolean shared, boolean interruptible, boolean timed, long time) å®Œæ•´çš„æ–¹æ³•ï¼š /** * Main acquire method, invoked by all exported acquire methods. * * @param node null unless a reacquiring Condition * @param arg the acquire argument * @param shared true if shared mode else exclusive * @param interruptible if abort and return negative on interrupt * @param timed if true use timed waits * @param time if timed, the System.nanoTime value to timeout * @return positive if acquired, 0 if timed out, negative if interrupted */final int acquire(Node node, int arg, boolean shared, boolean interruptible, boolean timed, long time) Thread current = Thread.currentThread(); byte spins = 0, postSpins = 0; // retries upon unpark of first thread boolean interrupted = false, first = false; Node pred = null; // predecessor of node when enqueued /* * Repeatedly: * Check if node now first * if so, ensure head stable, else ensure valid predecessor * if node is first or not yet enqueued, try acquiring * else if node not yet created, create it * else if not yet enqueued, try once to enqueue * else if woken from park, retry (up to postSpins times) * else if WAITING status not set, set and retry * else park and clear WAITING status, and check cancellation */ for (;;) if (!first (pred = (node == null) ? null : node.prev) != null !(first = (head == pred))) if (pred.status 0) cleanQueue(); // predecessor cancelled continue; else if (pred.prev == null) Thread.onSpinWait(); // ensure serialization continue; if (first || pred == null) boolean acquired; try if (shared) acquired = (tryAcquireShared(arg) = 0); else acquired = tryAcquire(arg); catch (Throwable ex) cancelAcquire(node, interrupted, false); throw ex; if (acquired) if (first) node.prev = null; head = node; pred.next = null; node.waiter = null; if (shared) signalNextIfShared(node); if (interrupted) current.interrupt(); return 1; if (node == null) // allocate; retry before enqueue if (shared) node = new SharedNode(); else node = new ExclusiveNode(); else if (pred == null) // try to enqueue node.waiter = current; Node t = tail; node.setPrevRelaxed(t); // avoid unnecessary fence if (t == null) tryInitializeHead(); else if (!casTail(t, node)) node.setPrevRelaxed(null); // back out else t.next = node; else if (first spins != 0) --spins; // reduce unfairness on rewaits Thread.onSpinWait(); else if (node.status == 0) node.status = WAITING; // enable signal and recheck else long nanos; spins = postSpins = (byte)((postSpins 1) | 1); if (!timed) LockSupport.park(this); else if ((nanos = time - System.nanoTime()) 0L) LockSupport.parkNanos(this, nanos); else break; node.clearStatus(); if ((interrupted |= Thread.interrupted()) interruptible) break; return cancelAcquire(node, interrupted, interruptible); æˆ‘ä»¬å‡è®¾é”å·²ç»è¢«ç¬¬ä¸€ä¸ªçº¿ç¨‹å æœ‰äº†ï¼Œä¸”é”è¿˜æœªé‡Šæ”¾ã€‚ä»¥ç¬¬äºŒä¸ªçº¿ç¨‹è¿›å…¥è¯¥æ–¹æ³•çš„è§†è§’èµ°ä¸‹è¿™ä¸ªæµç¨‹ï¼š Thread current = Thread.currentThread();byte spins = 0, postSpins = 0; // retries upon unpark of first threadboolean interrupted = false, first = false;Node pred = null; // predecessor of node when enqueued é¦–å…ˆè·å–åˆ°å½“å‰çº¿ç¨‹å¹¶è®¾ç½®ç»™currentå˜é‡ï¼Œå…ˆä¸ç®¡spinsã€postSpinsçš„å«ä¹‰ã€‚firstä»£è¡¨æ˜¯å¦æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œpredå°±æ˜¯å‰ç½®èŠ‚ç‚¹ã€‚ è¿›å…¥forå¾ªç¯ï¼Œå¼€å§‹ç¬¬ä¸€æ¬¡å¾ªç¯ï¼š if (!first (pred = (node == null) ? null : node.prev) != null !(first = (head == pred))) pred = nullä¸æ»¡è¶³!=nullçš„æ¡ä»¶ï¼Œæ‰€ä»¥è¿›å…¥ç¬¬äºŒä¸ªæ¡ä»¶ï¼š if (first || pred == null) ç»è¿‡ç¬¬ä¸€ä¸ªifæ¡ä»¶predè¿˜æ˜¯è¢«è®¾ç½®ä¸ºäº†nullï¼Œæ‰€ä»¥æ¡ä»¶æ»¡è¶³è¿›å…¥ifä»£ç ï¼š //node,arg,shared,interruptible,timed,timeacquire(null, arg, false, false, false, 0L); if (first || pred == null) boolean acquired; try if (shared) acquired = (tryAcquireShared(arg) = 0); else acquired = tryAcquire(arg); catch (Throwable ex) cancelAcquire(node, interrupted, false); throw ex; if (acquired) if (first) node.prev = null; head = node; pred.next = null; node.waiter = null; if (shared) signalNextIfShared(node); if (interrupted) current.interrupt(); return 1; sharedä¸ºfalseï¼Œæ‰€ä»¥èµ°tryAcquire(arg)ï¼Œè¿™ä¸ªæ–¹æ³•ä¸Šé¢å·²ç»ä»‹ç»äº†ã€‚ä¸»è¦åŠŸèƒ½å°±æ˜¯å»åˆ¤æ–­æ˜¯é”æ˜¯å¦è¢«é‡Šæ”¾ï¼Œå¦‚æœé”è¢«é‡Šæ”¾äº†å°±å°è¯•å»åŠ ä¸‹é”ã€‚æˆ‘ä»¬å‡è®¾çš„æ˜¯é”è¿˜æœªè¢«é‡Šæ”¾ï¼Œæ‰€ä»¥è¯¥æ–¹æ³•è¿”å›falseã€‚é‚£ä¹ˆæ¥ä¸‹æ¥çš„if (acquired)ä¸‹çš„é€»è¾‘å°±ä¸èµ°äº†ã€‚æ¥ç€å¾€ä¸‹çœ‹ï¼š if (node == null) if (shared) node = new SharedNode(); else node = new ExclusiveNode(); nodeä¼ é€’è¿‡æ¥æ—¶æ˜¯ä¸ºnullçš„ï¼Œæ‰€ä»¥è¿›å…¥ifé€»è¾‘ã€‚nodeè¢«åŒ…è£…æˆä¸€ä¸ªç‹¬å çš„ExclusiveNodeã€‚åç»­éƒ½æ˜¯else ifæˆ–elseéƒ½ä¸èµ°ï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡å¾ªç¯ç»“æŸã€‚ å¼€å§‹ç¬¬äºŒæ¬¡forå¾ªç¯ï¼š if (!first (pred = (node == null) ? null : node.prev) != null !(first = (head == pred))) è¿˜æ˜¯è¿™ä¸ªåˆ¤æ–­ï¼Œä¸è¿‡è¿™æ¬¡nodeä¸ä¸ºnulläº†ã€‚node = new ExclusiveNode()ï¼Œæ‰€ä»¥pred = node.prevï¼Œä¹Ÿå°±æ˜¯nullï¼Œæ‰€ä»¥åˆåœ¨è¿™ä¸­æ–­äº†ã€‚ if (first || pred == null) pred == nullæ¡ä»¶ç¬¦åˆï¼Œè¿˜æ˜¯è¿›å…¥è¯¥ifé€»è¾‘ï¼Œåˆå»å°è¯•è·å–é”ï¼ˆæˆ‘ä»¬çš„å‰æé”æ²¡é‡Šæ”¾ï¼‰æ‰€ä»¥åŠ é”å¤±è´¥ç»§ç»­å¾€ä¸‹èµ°ã€‚ if (node == null) ç¬¬äºŒæ¬¡å¾ªç¯ï¼Œè¿™ä¸ªæ¡ä»¶å°±ä¸æˆç«‹äº†ã€‚node = new ExclusiveNode()èµ°else ifåˆ†æ”¯ï¼š else if (pred == null) predæ­¤æ—¶è¿˜æ˜¯ä¸ºnullçš„ï¼Œè¿™ä¸ªåˆ†æ”¯æ»¡è¶³ï¼Œèµ°è¯¥é€»è¾‘ï¼š else if (pred == null) // try to enqueue node.waiter = current; Node t = tail; // å°†å°¾èŠ‚ç‚¹è®¾ç½®ä¸ºnodeçš„å‰ç½®èŠ‚ç‚¹ node.setPrevRelaxed(t); // avoid unnecessary fence if (t == null) tryInitializeHead(); else if (!casTail(t, node)) node.setPrevRelaxed(null); // back out else t.next = node; å°†node.waiterè®¾ç½®ä¸ºå½“å‰çº¿ç¨‹ï¼Œå°†å°¾èŠ‚ç‚¹èµ‹å€¼ç»™tï¼Œå°†å°¾èŠ‚ç‚¹è®¾ç½®ä¸ºnodeçš„å‰ç½®èŠ‚ç‚¹ã€‚æ­¤æ—¶tailèŠ‚ç‚¹è¿˜æ˜¯nullï¼Œæ‰€ä»¥èµ°tryInitializeHead()å°è¯•åˆå§‹åŒ–å¤´èŠ‚ç‚¹ã€‚çœ‹ä¸‹è¿™ä¸ªæ–¹æ³•ï¼š private void tryInitializeHead() Node h = new ExclusiveNode(); if (U.compareAndSetReference(this, HEAD, null, h)) tail = h; èµ‹å€¼hä¸ºä¸€ä¸ªç‹¬å èŠ‚ç‚¹ï¼Œå°†å¯¹è±¡çš„HEADå­—æ®µçš„å€¼ä»nullæ›´æ–°ä¸ºhï¼Œä½†åªæœ‰å½“HEADå­—æ®µå½“å‰çš„å€¼ä¸ºnullæ—¶æ‰èƒ½æˆåŠŸæ›´æ–°(æˆ‘ä»¬å·²ç¬¬äºŒä¸ªçº¿ç¨‹ç¬¬ä¸€æ¬¡è¿›å…¥è¿™ä¸ªæ–¹æ³•ä¸ºå‰æ)ã€‚æ‰€ä»¥æ˜¯æ›´æ–°æˆåŠŸçš„ï¼Œå¹¶å°†å°¾èŠ‚ç‚¹ä¹ŸæŒ‡å‘äº†hï¼Œæ­¤æ—¶HEAD tail hã€‚æ¥ä¸‹æ¥çš„åˆ†æ”¯å°±ä¸èµ°äº†ã€‚ å¼€å§‹ç¬¬ä¸‰æ¬¡forå¾ªç¯ï¼š if (!first (pred = (node == null) ? null : node.prev) != null !(first = (head == pred))) node.prevè¿˜æ˜¯nullï¼Œä¸æ»¡è¶³èµ°ä¸‹ä¸€ä¸ªåˆ†æ”¯ï¼š if (first || pred == null) predè¿˜æ˜¯nullï¼Œå’Œç¬¬äºŒæ¬¡å¾ªç¯ä¸€è‡´ï¼Œç”³è¯·é”å¤±è´¥ç»§ç»­èµ°ã€‚nodeä¸ä¸ºnullï¼Œpredä¸ºnullæ‰€ä»¥èµ°è¿™ä¸ªåˆ†æ”¯ï¼š else if (pred == null) // try to enqueue node.waiter = current; Node t = tail; // å°†å°¾èŠ‚ç‚¹è®¾ç½®ä¸ºnodeçš„å‰ç½®èŠ‚ç‚¹ node.setPrevRelaxed(t); // avoid unnecessary fence if (t == null) tryInitializeHead(); else if (!casTail(t, node)) node.setPrevRelaxed(null); // back out else t.next = node; æ­¤æ—¶tailä¸ä¸ºnulläº†ï¼Œtail h new ExclusiveNode()ï¼Œæ‰€ä»¥ node.setPrevRelaxed(t)è¿™ä¸ªæ–¹æ³•å°† node.prev = tail = hï¼Œç»§ç»­èµ° else if (!casTail(t, node)) private boolean casTail(Node c, Node v) return U.compareAndSetReference(this, TAIL, c, v); casTail(t, node)æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œå°è¯•å°†å½“å‰é“¾è¡¨çš„å°¾èŠ‚ç‚¹â€œTAILâ€æ›´æ–°ä¸ºâ€œnodeâ€ï¼Œåªæœ‰åœ¨â€œtâ€ç­‰äºæœŸæœ›å€¼æ—¶æ‰ä¼šæˆåŠŸæ›´æ–°ï¼Œå¹¶è¿”å›trueï¼›å¦åˆ™ï¼Œè¿”å›falseã€‚ æˆ‘ä»¬å‡è®¾çš„æ˜¯å•çº¿ç¨‹ç¯å¢ƒï¼Œæ‰€ä»¥æ›´æ–°æ˜¯ä¸€ä¼šæˆåŠŸçš„ã€‚æ‰€ä»¥æ­¤æ—¶TAIL node ï¼ŒHEAD t æ‰€ä»¥è¯¥åˆ¤æ–­ä¼šè¿”å›flaseç»§ç»­èµ°elseåˆ†æ”¯ï¼š else t.next = node; èµ°å®Œè¯¥é€»è¾‘ï¼Œæ­¤æ—¶é“¾è¡¨ä¸ºHEAD - node = TAILã€‚ å¼€å§‹ç¬¬å››æ¬¡forå¾ªç¯ï¼š if (!first (pred = (node == null) ? null : node.prev) != null !(first = (head == pred))) æ­¤æ—¶node ! nullï¼Œnode.prev HEADï¼Œæ‰€ä»¥pred HEADï¼Œ!(first = (head == pred))æ­¤æ—¶headæ˜¯ç­‰äºpredçš„æ‰€ä»¥åœ¨æ­¤ä¸­æ–­ï¼Œfirstè¢«èµ‹å€¼ä¸ºtrueã€‚ç»§ç»­å¾€ä¸‹èµ°ï¼š if (first || pred == null) æ­¤æ—¶firsttrueï¼Œpred ! nullæ‰€ä»¥è¿˜æ˜¯å»å°è¯•è·å–é”ï¼Œå’Œç¬¬ä¸‰æ¬¡å¾ªç¯ä¸€è‡´ï¼Œç”³è¯·é”å¤±è´¥ç»§ç»­èµ°ã€‚nodeä¸ä¸ºnullï¼Œpredä¸ä¸ºnullï¼Œspins 0æ‰€ä»¥èµ°è¿™ä¸ªåˆ†æ”¯ï¼š else if (node.status == 0) node.status = WAITING; å°†nodeçš„çŠ¶æ€è®¾ç½®ä¸ºç­‰å¾…æ ‡è¯†ã€‚ å¼€å§‹ç¬¬äº”æ¬¡forå¾ªç¯ï¼š ç®€è¦è¯´ä¸‹è¿‡ç¨‹ï¼Œè¿˜æ˜¯å°è¯•å»è·å–é”ç„¶åå¤±è´¥ï¼Œæœ€åèµ°åˆ°æœ€åçš„elseåˆ†æ”¯ã€‚ else long nanos; spins = postSpins = (byte)((postSpins 1) | 1); if (!timed) LockSupport.park(this); else if ((nanos = time - System.nanoTime()) 0L) LockSupport.parkNanos(this, nanos); else break; node.clearStatus(); if ((interrupted |= Thread.interrupted()) interruptible) break; å…³æ³¨è¿™ä¸€è¡ŒLockSupport.park(this);å¦‚æœæ²¡è®¾ç½®æ—¶é—´é‚£ä¹ˆå°±ä¸€ç›´parkä¸‹å»ï¼Œå¦‚æœè®¾ç½®äº†æ—¶é—´å°±parkå®šæ—¶çš„æ—¶é—´ã€‚ä»€ä¹ˆæ—¶å€™å”¤é†’parkçš„çº¿ç¨‹ï¼Œè¿™ä¸ªç­‰æˆ‘ä»¬å»çœ‹unlock()çš„ä»£ç å°±ä¼šçŸ¥é“ã€‚ ç°åœ¨æˆ‘ä»¬æ€»ç»“ä¸‹æ•´ä¸ªåŠ é”æµç¨‹ï¼š è°ƒç”¨lock()æ–¹æ³•å°è¯•åŠ é”ï¼› åŠ é”ä¸æˆåŠŸè°ƒç”¨acquire(1)ï¼› è°ƒç”¨tryAcquire(arg)å†å°è¯•è·å–é”ï¼› è·å–é”å¤±è´¥è°ƒç”¨acquire(null, arg, false, false, false, 0L); è¿›è¡Œ5è½®forå¾ªç¯ï¼› ç¬¬ä¸€è½®forå¾ªç¯ï¼šå°†nodeèµ‹å€¼ä¸ºä¸€ä¸ªç‹¬å çš„ExclusiveNodeï¼› ç¬¬äºŒè½®forå¾ªç¯ï¼šnode.waiterè®¾ç½®ä¸ºå½“å‰çº¿ç¨‹ï¼Œèµ‹å€¼hä¸ºä¸€ä¸ªç‹¬å èŠ‚ç‚¹ï¼Œå°†å¯¹è±¡çš„HEADå­—æ®µçš„å€¼ä»nullæ›´æ–°ä¸ºhï¼Œæ­¤æ—¶HEAD TAIL hï¼› ç¬¬ä¸‰è½®forå¾ªç¯ï¼šèµ°å®Œå¾ªç¯ï¼Œæ­¤æ—¶é“¾è¡¨ä¸ºHEAD - node = TAILã€‚ ç¬¬å››è½®forå¾ªç¯ï¼šå°†nodeçš„çŠ¶æ€è®¾ç½®ä¸ºç­‰å¾…æ ‡è¯†ã€‚ ç¬¬äº”è½®forå¾ªç¯ï¼šå°†å½“å‰çº¿ç¨‹parkã€‚ 3. å¤šçº¿ç¨‹ä¸‹åŠ é”ç°åœ¨æˆ‘ä»¬å›è¿‡å¤´æ¥çœ‹ä¸‹ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹å»åŠ é”ä¼šå‘ç”Ÿä»€ä¹ˆåœºæ™¯ï¼Ÿè·³è¿‡å…¶ä»–æ–¹æ³•ï¼Œä¸»è¦çœ‹ä¸‹acquireæ–¹æ³•ã€‚æˆ‘ä»¬å‡è®¾é”è¿˜æ˜¯æœªè¢«é‡Šæ”¾ï¼ŒåŒæ—¶è¿˜æœ‰2ä¸ªçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼š æ‰§è¡Œç¬¬ä¸€è½®å¾ªç¯ï¼Œä¸¤ä¸ªçº¿ç¨‹éƒ½å°†nodeå˜é‡èµ‹å€¼ä¸ºExclusiveNodeï¼› æ‰§è¡Œç¬¬äºŒè½®å¾ªç¯ï¼š // æˆ‘ä»¬å‡è®¾ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶é—´æ˜¯åŒæ­¥çš„else if (pred == null) // try to enqueue node.waiter = current; // æ­¤æ—¶t = tail = null Node t = tail; // node.prev = t = null node.setPrevRelaxed(t); // avoid unnecessary fence if (t == null) tryInitializeHead(); else if (!casTail(t, node)) node.setPrevRelaxed(null); // back out else t.next = node; // åŒæ—¶è¿›å…¥è¯¥æ–¹æ³•private void tryInitializeHead() Node h = new ExclusiveNode(); // è¿™é‡Œä½¿ç”¨cas,åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡ŒæˆåŠŸã€‚å‡è®¾Açº¿ç¨‹æ‰§è¡ŒæˆåŠŸï¼Œæ‰€ä»¥æ­¤æ—¶Açº¿ç¨‹ä¸­tail = hï¼ŒBçº¿ç¨‹ä¸­tail = h // (tailæ˜¯ä¸ªvolatileä¿®é¥°çš„å˜é‡ï¼ŒBçº¿ç¨‹ä¼šæ”¾å¼ƒè‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„å€¼ï¼Œåˆ·æ–°ä¸ºAçº¿ç¨‹ä¿®æ”¹åçš„å€¼) // å› ä¸ºHEADæ˜¯ä¸ªå…±äº«å˜é‡ï¼Œæ‰€ä»¥Aã€Bä¸¤ä¸ªçº¿ç¨‹ä¸­çš„HEAD = h if (U.compareAndSetReference(this, HEAD, null, h)) tail = h; æ‰§è¡Œç¬¬ä¸‰è½®å¾ªç¯ï¼š // è¿˜æ˜¯åŒæ—¶è¿›å…¥è¯¥åˆ†æ”¯else if (pred == null) // try to enqueue node.waiter = current; // æ­¤æ—¶Açº¿ç¨‹tA = tail = hï¼ŒBçº¿ç¨‹tB = tail = h Node t = tail; // nodeA.prev = t = h // nodeB.prev = t = h node.setPrevRelaxed(t); // avoid unnecessary fence if (t == null) tryInitializeHead(); // è¿™é‡Œåˆæ˜¯casï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ›´æ–°æˆåŠŸï¼Œæˆ‘ä»¬è¿˜æ˜¯å‡è®¾Açº¿ç¨‹æ›´æ–°æˆåŠŸ // æ­¤æ—¶å˜æˆäº†Açº¿ç¨‹ï¼štail = nodeAï¼ŒBçº¿ç¨‹ä¸­ï¼štail = nodeA else if (!casTail(t, node)) // Bçº¿ç¨‹å› ä¸ºæ›´æ–°å¤±è´¥ï¼Œä¼šè¿›å…¥è¯¥åˆ†æ”¯ï¼šnodeB.prev = tï¼Œæ›´æ–°ä¸ºnodeB.prev = null node.setPrevRelaxed(null); // back out else // Açº¿ç¨‹è¿›å…¥è¿™ä¸ªåˆ†æ”¯ï¼Œh.next = nodeAã€‚é“¾è¡¨ä¸º h - nodeA t.next = node; æ‰§è¡Œç¬¬å››è½®å¾ªç¯ï¼š // è¿˜æ˜¯Aã€Bçº¿ç¨‹åŒæ—¶è¿›å…¥ï¼ŒAçº¿ç¨‹ä¸­nodeA.prev = hï¼ŒBçº¿ç¨‹ä¸­nodeB.prev = nullã€‚// æ‰€ä»¥predA = hï¼ŒpredB = nullã€‚// æ‰€ä»¥firstA = trueï¼ŒfirstB = falseã€‚if (!first (pred = (node == null) ? null : node.prev) != null !(first = (head == pred))) æ­¤æ—¶Bçº¿ç¨‹ä¼šè¿›å…¥è¯¥åˆ†æ”¯ï¼š // Bçº¿ç¨‹è¿›å…¥è¯¥åˆ†æ”¯else if (pred == null) // try to enqueue node.waiter = current; // tB = tail = nodeA Node t = tail; // nodeB.prev = t = tail = nodeA node.setPrevRelaxed(t); // avoid unnecessary fence if (t == null) tryInitializeHead(); // è¿™é‡Œåˆæ˜¯casï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ›´æ–°æˆåŠŸï¼Œè¿™æ¬¡æ˜¯Bçº¿ç¨‹æ›´æ–°æˆåŠŸ // tail = nodeB else if (!casTail(t, node)) node.setPrevRelaxed(null); // back out else // Bçº¿ç¨‹è¿›å…¥è¿™ä¸ªåˆ†æ”¯ï¼ŒnodeA.next = nodeBã€‚æ­¤æ—¶é“¾è¡¨ä¸º h - nodeA - nodeB t.next = node; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨æ‰§è¡Œåˆ°ç¬¬å››è½®å¾ªç¯çš„æ—¶å€™å°±å·²ç»å½¢æˆäº†ä¸€ä¸ªé“¾è¡¨åç»­å”¤é†’çš„æ—¶å€™ä¹Ÿæ˜¯æ ¹æ®è¿™ä¸ªé“¾è¡¨çš„é¡ºåºæ¥è¿›è¡Œå”¤é†’çº¿ç¨‹æ“ä½œçš„ æ­¤æ—¶Açº¿ç¨‹ä¼šè¿›å…¥è¯¥åˆ†æ”¯å°†nodeçš„çŠ¶æ€è®¾ç½®ä¸ºWAITINGï¼ˆ1ï¼‰ else if (node.status == 0) node.status = WAITING; Aã€Bçº¿ç¨‹è¿›å…¥ç¬¬äº”è½®å¾ªç¯ï¼ŒAçº¿ç¨‹åœ¨è¯¥è½®å¾ªç¯ä¸­ä¼šè¿›å…¥parkçŠ¶æ€ï¼ŒBçº¿ç¨‹ä¼šé‡å¤Açº¿ç¨‹ä¸­ç¬¬å››è½®å¾ªç¯å°†è‡ªèº«nodeçŠ¶æ€è®¾ç½®ä¸ºWAITINGå¹¶åœ¨ä¸‹è½®å¾ªç¯ä¸­ä¹Ÿè¿›å…¥parkçŠ¶æ€ã€‚ 4. å…¬å¹³é”åŠ é”public final boolean hasQueuedThreads() for (Node p = tail, h = head; p != h p != null; p = p.prev) if (p.status = 0) return true; return false; ä¸»è¦å°±æ˜¯å¤šäº†è¿™ä¹ˆä¸€ä¸ªåˆ¤æ–­ï¼Œé€šè¿‡ä»åå‘å‰éå†åˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰æ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹èŠ‚ç‚¹ã€‚å¦‚æœæœ‰å°±ä¸å»CASæŠ¢é”ï¼Œæ²¡æœ‰ç­‰å¾…èŠ‚ç‚¹å°±å°è¯•å»è·å–é”ã€‚ 5. è§£é”æµç¨‹/** * Attempts to release this lock. * * pIf the current thread is the holder of this lock then the hold * count is decremented. If the hold count is now zero then the lock * is released. If the current thread is not the holder of this * lock then @link IllegalMonitorStateException is thrown. * * @throws IllegalMonitorStateException if the current thread does not * hold this lock */public void unlock() sync.release(1); é‡Šæ”¾ä¸€æŠŠé” å¦‚æœæ˜¯æŒæœ‰é”çš„å½“å‰çº¿ç¨‹é‚£ä¹ˆå°†state - 1ï¼Œå½“stateå€¼ä¸º0çš„æ—¶å€™é‡Šæ”¾é”ã€‚ å¦‚æœä¸æ˜¯æŒæœ‰é”çš„çº¿ç¨‹è¿›å…¥è¯¥æ–¹æ³•é‚£ä¹ˆæŠ›å‡ºå¼‚å¸¸ public final boolean release(int arg) if (tryRelease(arg)) signalNext(head); return true; return false; protected final boolean tryRelease(int releases) // è·å–stateå½“å‰å€¼ - 1 int c = getState() - releases; // åˆ¤æ–­æŒæœ‰é”çš„çº¿ç¨‹æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹ if (getExclusiveOwnerThread() != Thread.currentThread()) throw new IllegalMonitorStateException(); boolean free = (c == 0); if (free) // å½“state = 0ï¼Œé‡Šæ”¾é”å¹¶å°†ExclusiveOwnerThreadè®¾ä¸ºnull setExclusiveOwnerThread(null); // å°†stateè®¾ä¸º0 setState(c); return free; private static void signalNext(Node h) Node s; // è·å–åˆ°nodeèŠ‚ç‚¹ if (h != null (s = h.next) != null s.status != 0) // æ ‡è®°ä¸ºstatus s.getAndUnsetStatus(WAITING); // å”¤é†’nodeèŠ‚ç‚¹ä¸Šç­‰å¾…çš„çº¿ç¨‹ LockSupport.unpark(s.waiter); å”¤é†’åçš„çº¿ç¨‹ä¼šä»lockä¸­LockSupport.park(this)å¤„å¼€å§‹æ‰§è¡Œï¼Œå†æ¬¡å¼€å§‹forå¾ªç¯ else long nanos; spins = postSpins = (byte)((postSpins 1) | 1); if (!timed) LockSupport.park(this); else if ((nanos = time - System.nanoTime()) 0L) LockSupport.parkNanos(this, nanos); else break; // å°†statusçŠ¶æ€ç½®ä¸º0 node.clearStatus(); if ((interrupted |= Thread.interrupted()) interruptible) break; // firstæ˜¯ä¸ºtrueçš„if (first || pred == null) boolean acquired; try if (shared) acquired = (tryAcquireShared(arg) = 0); else // å°è¯•è·å–é” acquired = tryAcquire(arg); catch (Throwable ex) cancelAcquire(node, interrupted, false); throw ex; // åŠ é”æˆåŠŸ if (acquired) if (first) // æ–­å¼€nodeAæŒ‡å‘headçš„æŒ‡é’ˆ(æ–¹ä¾¿GC) node.prev = null; // head = nodeA head = node; // æ–­å¼€headæŒ‡å‘nodeAçš„æŒ‡é’ˆ(æ–¹ä¾¿GC) pred.next = null; node.waiter = null; if (shared) signalNextIfShared(node); if (interrupted) current.interrupt(); return 1; ReentrantLockçš„åŠ è§£é”æµç¨‹åˆ°è¿™å°±è¯´çš„å·®ä¸å¤šäº†ï¼ŒReentrantLockä½¿ç”¨çš„æ˜¯AQSä¸­çš„ç‹¬å æ¨¡å‹ã€‚å…±äº«æ¨¡å‹å¯ä»¥çœ‹ä¸‹CountDownLatchã€‚","tags":["ReentrantLock"],"categories":["é”"]},{"title":"ç¡…è°·ç”„é€‰","path":"/2024/01/04/2024-01-04-ç¡…è°·ç”„é€‰/","content":"1. é¡¹ç›®åˆå§‹åŒ–1.1 ç¯å¢ƒå‡†å¤‡ node v16.19.1 pnpm 8.12.1 npm i -g pnpm 1.2 åˆå§‹åŒ–é¡¹ç›® pnpm create vite é€‰æ‹©vueã€TypeScript è¿›å…¥é¡¹ç›® // å®‰è£…ä¾èµ–pnpm i// å®‰è£…å®Œä¾èµ–è¿è¡Œç¨‹åºpnpm run dev 2. é¡¹ç›®é…ç½®2.1 eslinté…ç½® ä½œç”¨ eslintä¸­æ–‡å®˜ç½‘:http://eslint.cn/ ESLintæœ€åˆæ˜¯ç”±Nicholas C. Zakas äº2013å¹´6æœˆåˆ›å»ºçš„å¼€æºé¡¹ç›®ã€‚å®ƒçš„ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªæ’ä»¶åŒ–çš„javascriptä»£ç æ£€æµ‹å·¥å…· æ­¥éª¤ é¦–å…ˆå®‰è£…eslint pnpm i eslint -D ç”Ÿæˆé…ç½®æ–‡ä»¶:.eslint.cjs npx eslint --init .eslint.cjsé…ç½®æ–‡ä»¶è§£æ module.exports = //è¿è¡Œç¯å¢ƒ env: browser: true,//æµè§ˆå™¨ç«¯ es2021: true,//es2021 , //è§„åˆ™ç»§æ‰¿ extends: [ //å…¨éƒ¨è§„åˆ™é»˜è®¤æ˜¯å…³é—­çš„,è¿™ä¸ªé…ç½®é¡¹å¼€å¯æ¨èè§„åˆ™,æ¨èè§„åˆ™å‚ç…§æ–‡æ¡£ //æ¯”å¦‚:å‡½æ•°ä¸èƒ½é‡åã€å¯¹è±¡ä¸èƒ½å‡ºç°é‡å¤key eslint:recommended, //vue3è¯­æ³•è§„åˆ™ plugin:vue/vue3-essential, //tsè¯­æ³•è§„åˆ™ plugin:@typescript-eslint/recommended ], //è¦ä¸ºç‰¹å®šç±»å‹çš„æ–‡ä»¶æŒ‡å®šå¤„ç†å™¨ overrides: [ ], //æŒ‡å®šè§£æå™¨:è§£æå™¨ //Esprima é»˜è®¤è§£æå™¨ //Babel-ESLint babelè§£æå™¨ //@typescript-eslint/parser tsè§£æå™¨ parser: @typescript-eslint/parser, //æŒ‡å®šè§£æå™¨é€‰é¡¹ parserOptions: ecmaVersion: latest,//æ ¡éªŒECMAæœ€æ–°ç‰ˆæœ¬ sourceType: module//è®¾ç½®ä¸ºscriptï¼ˆé»˜è®¤ï¼‰ï¼Œæˆ–è€…moduleä»£ç åœ¨ECMAScriptæ¨¡å—ä¸­ , //ESLintæ”¯æŒä½¿ç”¨ç¬¬ä¸‰æ–¹æ’ä»¶ã€‚åœ¨ä½¿ç”¨æ’ä»¶ä¹‹å‰ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨npmå®‰è£…å®ƒ //è¯¥eslint-plugin-å‰ç¼€å¯ä»¥ä»æ’ä»¶åç§°è¢«çœç•¥ plugins: [ vue, @typescript-eslint ], //eslintè§„åˆ™ rules: å®‰è£…vue3ç¯å¢ƒä»£ç æ ¡éªŒæ’ä»¶ æ’ä»¶ä½œç”¨ # è®©æ‰€æœ‰ä¸prettierè§„åˆ™å­˜åœ¨å†²çªçš„Eslint ruleså¤±æ•ˆï¼Œå¹¶ä½¿ç”¨prettierè¿›è¡Œä»£ç æ£€æŸ¥eslint-config-prettier,eslint-plugin-import,eslint-plugin-node,# è¿è¡Œæ›´æ¼‚äº®çš„Eslintï¼Œä½¿prettierè§„åˆ™ä¼˜å…ˆçº§æ›´é«˜ï¼ŒEslintä¼˜å…ˆçº§ä½eslint-plugin-prettier,# vue.jsçš„Eslintæ’ä»¶ï¼ˆæŸ¥æ‰¾vueè¯­æ³•é”™è¯¯ï¼Œå‘ç°é”™è¯¯æŒ‡ä»¤ï¼ŒæŸ¥æ‰¾è¿è§„é£æ ¼æŒ‡å—eslint-plugin-vue,# è¯¥è§£æå™¨å…è®¸ä½¿ç”¨Eslintæ ¡éªŒæ‰€æœ‰babel code@babel/eslint-parser, å®‰è£…æŒ‡ä»¤ pnpm install -D eslint-plugin-import eslint-plugin-vue eslint-plugin-node eslint-plugin-prettier eslint-config-prettier eslint-plugin-node @babel/eslint-parser ä¿®æ”¹.eslintrc.cjsé…ç½®æ–‡ä»¶ // @see https://eslint.bootcss.com/docs/rules/module.exports = env: browser: true, es2021: true, node: true, jest: true, , /* æŒ‡å®šå¦‚ä½•è§£æè¯­æ³• */ parser: vue-eslint-parser, /** ä¼˜å…ˆçº§ä½äº parse çš„è¯­æ³•è§£æé…ç½® */ parserOptions: ecmaVersion: latest, sourceType: module, parser: @typescript-eslint/parser, jsxPragma: React, ecmaFeatures: jsx: true, , , /* ç»§æ‰¿å·²æœ‰çš„è§„åˆ™ */ extends: [ eslint:recommended, plugin:vue/vue3-essential, plugin:@typescript-eslint/recommended, plugin:prettier/recommended, ], plugins: [vue, @typescript-eslint], /* * off æˆ– 0 == å…³é—­è§„åˆ™ * warn æˆ– 1 == æ‰“å¼€çš„è§„åˆ™ä½œä¸ºè­¦å‘Šï¼ˆä¸å½±å“ä»£ç æ‰§è¡Œï¼‰ * error æˆ– 2 == è§„åˆ™ä½œä¸ºä¸€ä¸ªé”™è¯¯ï¼ˆä»£ç ä¸èƒ½æ‰§è¡Œï¼Œç•Œé¢æŠ¥é”™ï¼‰ */ rules: // eslintï¼ˆhttps://eslint.bootcss.com/docs/rules/ï¼‰ no-var: error, // è¦æ±‚ä½¿ç”¨ let æˆ– const è€Œä¸æ˜¯ var no-multiple-empty-lines: [warn, max: 1 ], // ä¸å…è®¸å¤šä¸ªç©ºè¡Œ no-console: process.env.NODE_ENV === production ? error : off, no-debugger: process.env.NODE_ENV === production ? error : off, no-unexpected-multiline: error, // ç¦æ­¢ç©ºä½™çš„å¤šè¡Œ no-useless-escape: off, // ç¦æ­¢ä¸å¿…è¦çš„è½¬ä¹‰å­—ç¬¦ // typeScript (https://typescript-eslint.io/rules) @typescript-eslint/no-unused-vars: error, // ç¦æ­¢å®šä¹‰æœªä½¿ç”¨çš„å˜é‡ @typescript-eslint/prefer-ts-expect-error: error, // ç¦æ­¢ä½¿ç”¨ @ts-ignore @typescript-eslint/no-explicit-any: off, // ç¦æ­¢ä½¿ç”¨ any ç±»å‹ @typescript-eslint/no-non-null-assertion: off, @typescript-eslint/no-namespace: off, // ç¦æ­¢ä½¿ç”¨è‡ªå®šä¹‰ TypeScript æ¨¡å—å’Œå‘½åç©ºé—´ã€‚ @typescript-eslint/semi: off, // eslint-plugin-vue (https://eslint.vuejs.org/rules/) vue/multi-word-component-names: off, // è¦æ±‚ç»„ä»¶åç§°å§‹ç»ˆä¸º â€œ-â€ é“¾æ¥çš„å•è¯ vue/script-setup-uses-vars: error, // é˜²æ­¢script setupä½¿ç”¨çš„å˜é‡templateè¢«æ ‡è®°ä¸ºæœªä½¿ç”¨ vue/no-mutating-props: off, // ä¸å…è®¸ç»„ä»¶ propçš„æ”¹å˜ vue/attribute-hyphenation: off, // å¯¹æ¨¡æ¿ä¸­çš„è‡ªå®šä¹‰ç»„ä»¶å¼ºåˆ¶æ‰§è¡Œå±æ€§å‘½åæ ·å¼ , é…ç½®å¿½ç•¥æ–‡ä»¶ æ–°å»º.eslintignoreå¿½ç•¥æ–‡ä»¶æ·»åŠ å¿½ç•¥ distnode_modules ä¿®æ”¹è¿è¡Œè„šæœ¬ scripts: // æ‰§è¡Œ`pnpm run dev`ç›´æ¥æ‰“å¼€æµè§ˆå™¨ dev: vite --open, ... // eslintæ£€æŸ¥srcç›®å½•ä¸‹æºç  lint: eslint src, // eslintä¿®å¤srcç›®å½•ä¸‹æºç  fix: eslint src --fix 2.2 prettieré…ç½® ä½œç”¨ æœ‰äº†eslintï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰prettierï¼Ÿeslinté’ˆå¯¹çš„æ˜¯javascriptï¼Œä»–æ˜¯ä¸€ä¸ªæ£€æµ‹å·¥å…·ï¼ŒåŒ…å«jsè¯­æ³•ä»¥åŠå°‘éƒ¨åˆ†æ ¼å¼é—®é¢˜ï¼Œåœ¨eslintçœ‹æ¥ï¼Œè¯­æ³•å¯¹äº†å°±èƒ½ä¿è¯ä»£ç æ­£å¸¸è¿è¡Œï¼Œæ ¼å¼é—®é¢˜å±äºå…¶æ¬¡ï¼› è€Œprettierå±äºæ ¼å¼åŒ–å·¥å…·ï¼Œå®ƒçœ‹ä¸æƒ¯æ ¼å¼ä¸ç»Ÿä¸€ï¼Œæ‰€ä»¥å®ƒå°±æŠŠeslintæ²¡å¹²å¥½çš„äº‹æ¥ç€å¹²ï¼Œå¦å¤–ï¼Œprettieræ”¯æŒåŒ…å«jsåœ¨å†…çš„å¤šç§è¯­è¨€ã€‚ æ€»ç»“èµ·æ¥ï¼Œeslintå’Œprettierè¿™ä¿©å…„å¼Ÿä¸€ä¸ªä¿è¯jsä»£ç è´¨é‡ï¼Œä¸€ä¸ªä¿è¯ä»£ç ç¾è§‚ã€‚ å®‰è£…ä¾èµ– pnpm install -D eslint-plugin-prettier prettier eslint-config-prettier æ·»åŠ è§„åˆ™ æ–°å»º.prettierrc.jsonæ–‡ä»¶æ·»åŠ è§„åˆ™ singleQuote: true, semi: false, bracketSpacing: true, htmlWhitespaceSensitivity: ignore, endOfLine: auto, trailingComma: all, tabWidth: 2 æ·»åŠ å¿½ç•¥ æ–°å»º.prettierignoreæ–‡ä»¶æ·»åŠ å¿½ç•¥æ–‡ä»¶ /dist/*/html/*.local/node_modules/****/*.svg**/*.sh/public/* ä¿®å¤ä»£ç  é€šè¿‡pnpm run lintå»æ£€æµ‹è¯­æ³•ï¼Œå¦‚æœå‡ºç°ä¸è§„èŒƒæ ¼å¼,é€šè¿‡pnpm run fixä¿®æ”¹ 2.3 stylelinté…ç½® ä½œç”¨ stylelintä¸ºcssçš„lintå·¥å…·ã€‚å¯æ ¼å¼åŒ–cssä»£ç ï¼Œæ£€æŸ¥cssè¯­æ³•é”™è¯¯ä¸ä¸åˆç†çš„å†™æ³•ï¼ŒæŒ‡å®šcssä¹¦å†™é¡ºåºç­‰ã€‚ å®‰è£…ä¾èµ– æœ¬é¡¹ç›®ä¸­ä½¿ç”¨scssä½œä¸ºé¢„å¤„ç†å™¨ï¼Œå®‰è£…ä»¥ä¸‹ä¾èµ– pnpm add sass sass-loader stylelint postcss postcss-scss postcss-html stylelint-config-prettier stylelint-config-recess-order stylelint-config-recommended-scss stylelint-config-standard stylelint-config-standard-vue stylelint-scss stylelint-order stylelint-config-standard-scss -D é…ç½®æ–‡ä»¶ æ–°å»º.stylelintrc.cjsé…ç½®æ–‡ä»¶ å®˜ç½‘:https://stylelint.bootcss.com/ // @see https://stylelint.bootcss.com/module.exports = extends: [ stylelint-config-standard, // é…ç½®stylelintæ‹“å±•æ’ä»¶ stylelint-config-html/vue, // é…ç½® vue ä¸­ template æ ·å¼æ ¼å¼åŒ– stylelint-config-standard-scss, // é…ç½®stylelint scssæ’ä»¶ stylelint-config-recommended-vue/scss, // é…ç½® vue ä¸­ scss æ ·å¼æ ¼å¼åŒ– stylelint-config-recess-order, // é…ç½®stylelint csså±æ€§ä¹¦å†™é¡ºåºæ’ä»¶, stylelint-config-prettier, // é…ç½®stylelintå’Œprettierå…¼å®¹ ], overrides: [ files: [**/*.(scss|css|vue|html)], customSyntax: postcss-scss, , files: [**/*.(html|vue)], customSyntax: postcss-html, , ], ignoreFiles: [ **/*.js, **/*.jsx, **/*.tsx, **/*.ts, **/*.json, **/*.md, **/*.yaml, ], /** * null = å…³é—­è¯¥è§„åˆ™ * always = å¿…é¡» */ rules: value-keyword-case: null, // åœ¨ css ä¸­ä½¿ç”¨ v-bindï¼Œä¸æŠ¥é”™ no-descending-specificity: null, // ç¦æ­¢åœ¨å…·æœ‰è¾ƒé«˜ä¼˜å…ˆçº§çš„é€‰æ‹©å™¨åå‡ºç°è¢«å…¶è¦†ç›–çš„è¾ƒä½ä¼˜å…ˆçº§çš„é€‰æ‹©å™¨ function-url-quotes: always, // è¦æ±‚æˆ–ç¦æ­¢ URL çš„å¼•å· always(å¿…é¡»åŠ ä¸Šå¼•å·)|never(æ²¡æœ‰å¼•å·) no-empty-source: null, // å…³é—­ç¦æ­¢ç©ºæºç  selector-class-pattern: null, // å…³é—­å¼ºåˆ¶é€‰æ‹©å™¨ç±»åçš„æ ¼å¼ property-no-unknown: null, // ç¦æ­¢æœªçŸ¥çš„å±æ€§(true ä¸ºä¸å…è®¸) block-opening-brace-space-before: always, //å¤§æ‹¬å·ä¹‹å‰å¿…é¡»æœ‰ä¸€ä¸ªç©ºæ ¼æˆ–ä¸èƒ½æœ‰ç©ºç™½ç¬¦ value-no-vendor-prefix: null, // å…³é—­ å±æ€§å€¼å‰ç¼€ --webkit-box property-no-vendor-prefix: null, // å…³é—­ å±æ€§å‰ç¼€ -webkit-mask selector-pseudo-class-no-unknown: [ // ä¸å…è®¸æœªçŸ¥çš„é€‰æ‹©å™¨ true, ignorePseudoClasses: [global, v-deep, deep], // å¿½ç•¥å±æ€§ï¼Œä¿®æ”¹elementé»˜è®¤æ ·å¼çš„æ—¶å€™èƒ½ä½¿ç”¨åˆ° , ], , é…ç½®å¿½ç•¥ æ–°å»º.stylelintignoreå¿½ç•¥æ–‡ä»¶ /node_modules/*/dist/*/html/*/public/* æ–°å¢è¿è¡Œè„šæœ¬ scripts: lint:style: stylelint src/**/*.css,scss,vue --cache --fix åŒä¸€é…ç½® æœ€åé…ç½®ç»Ÿä¸€çš„prettieræ¥æ ¼å¼åŒ–æˆ‘ä»¬çš„jså’Œcssï¼Œhtmlä»£ç  scripts: dev: vite --open, build: vue-tsc vite build, preview: vite preview, lint: eslint src, fix: eslint src --fix, format: prettier --write \\./**/*.html,vue,ts,js,json,md\\, lint:eslint: eslint src/**/*.ts,vue --cache --fix, lint:style: stylelint src/**/*.css,scss,vue --cache --fix, å½“æˆ‘ä»¬è¿è¡Œpnpm run formatçš„æ—¶å€™ï¼Œä¼šæŠŠä»£ç ç›´æ¥æ ¼å¼åŒ– 2.4 huskyé…ç½® ä½œç”¨ åœ¨ä¸Šé¢æˆ‘ä»¬å·²ç»é›†æˆå¥½äº†æˆ‘ä»¬ä»£ç æ ¡éªŒå·¥å…·ï¼Œä½†æ˜¯éœ€è¦æ¯æ¬¡æ‰‹åŠ¨çš„å»æ‰§è¡Œå‘½ä»¤æ‰ä¼šæ ¼å¼åŒ–æˆ‘ä»¬çš„ä»£ç ã€‚å¦‚æœæœ‰äººæ²¡æœ‰æ ¼å¼åŒ–å°±æäº¤äº†è¿œç¨‹ä»“åº“ä¸­ï¼Œé‚£è¿™ä¸ªè§„èŒƒå°±æ²¡ä»€ä¹ˆç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼ºåˆ¶è®©å¼€å‘äººå‘˜æŒ‰ç…§ä»£ç è§„èŒƒæ¥æäº¤ã€‚ è¦åšåˆ°è¿™ä»¶äº‹æƒ…ï¼Œå°±éœ€è¦åˆ©ç”¨huskyåœ¨ä»£ç æäº¤ä¹‹å‰è§¦å‘git hook(gitåœ¨å®¢æˆ·ç«¯çš„é’©å­)ï¼Œç„¶åæ‰§è¡Œpnpm run formatæ¥è‡ªåŠ¨çš„æ ¼å¼åŒ–æˆ‘ä»¬çš„ä»£ç ã€‚ å®‰è£… husky pnpm install -D husky åˆå§‹åŒ– npx husky-init ä¼šåœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆä¸ªä¸€ä¸ª.huskyç›®å½•ï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸‹é¢ä¼šæœ‰ä¸€ä¸ªpre-commitæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶é‡Œé¢çš„å‘½ä»¤åœ¨æˆ‘ä»¬æ‰§è¡Œcommitçš„æ—¶å€™å°±ä¼šæ‰§è¡Œ åœ¨.husky/pre-commitæ–‡ä»¶æ·»åŠ å¦‚ä¸‹å‘½ä»¤ #!/usr/bin/env sh. $(dirname -- $0)/_/husky.shpnpm run format å½“æˆ‘ä»¬å¯¹ä»£ç è¿›è¡Œcommitæ“ä½œçš„æ—¶å€™ï¼Œå°±ä¼šæ‰§è¡Œå‘½ä»¤ï¼Œå¯¹ä»£ç è¿›è¡Œæ ¼å¼åŒ–ï¼Œç„¶åå†æäº¤ã€‚ 2.5 commitlinté…ç½® ä½œç”¨ å¯¹äºæˆ‘ä»¬çš„commitä¿¡æ¯ï¼Œä¹Ÿæ˜¯æœ‰ç»Ÿä¸€è§„èŒƒçš„ï¼Œä¸èƒ½éšä¾¿å†™,è¦è®©æ¯ä¸ªäººéƒ½æŒ‰ç…§ç»Ÿä¸€çš„æ ‡å‡†æ¥æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨commitlintæ¥å®ç°ã€‚ å®‰è£…ä¾èµ– pnpm add @commitlint/config-conventional @commitlint/cli -D æ·»åŠ é…ç½® æ–°å»ºcommitlint.config.cjs(æ³¨æ„æ˜¯cjs) module.exports = extends: [@commitlint/config-conventional], // æ ¡éªŒè§„åˆ™ rules: type-enum: [ 2, always, [ feat, fix, docs, style, refactor, perf, test, chore, revert, build, ], ], type-case: [0], type-empty: [0], scope-empty: [0], scope-case: [0], subject-full-stop: [0, never], subject-case: [0, never], header-max-length: [0, always, 72], , åœ¨package.jsonä¸­é…ç½®scriptså‘½ä»¤ # åœ¨scripsä¸­æ·»åŠ ä¸‹é¢çš„ä»£ç scripts: commitlint: commitlint --config commitlint.config.cjs -e -V , é…ç½®ç»“æŸï¼Œç°åœ¨å½“æˆ‘ä»¬å¡«å†™commitä¿¡æ¯çš„æ—¶å€™ï¼Œå‰é¢å°±éœ€è¦å¸¦ç€ä¸‹é¢çš„subject feat,//æ–°ç‰¹æ€§ã€æ–°åŠŸèƒ½fix,//ä¿®æ”¹bugdocs,//æ–‡æ¡£ä¿®æ”¹style,//ä»£ç æ ¼å¼ä¿®æ”¹, æ³¨æ„ä¸æ˜¯ css ä¿®æ”¹refactor,//ä»£ç é‡æ„perf,//ä¼˜åŒ–ç›¸å…³ï¼Œæ¯”å¦‚æå‡æ€§èƒ½ã€ä½“éªŒtest,//æµ‹è¯•ç”¨ä¾‹ä¿®æ”¹chore,//å…¶ä»–ä¿®æ”¹, æ¯”å¦‚æ”¹å˜æ„å»ºæµç¨‹ã€æˆ–è€…å¢åŠ ä¾èµ–åº“ã€å·¥å…·ç­‰revert,//å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬build,//ç¼–è¯‘ç›¸å…³çš„ä¿®æ”¹ï¼Œä¾‹å¦‚å‘å¸ƒç‰ˆæœ¬ã€å¯¹é¡¹ç›®æ„å»ºæˆ–è€…ä¾èµ–çš„æ”¹åŠ¨ é…ç½®husky npx husky add .husky/commit-msg åœ¨ç”Ÿæˆçš„commit-msgæ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢çš„å‘½ä»¤ #!/usr/bin/env sh. $(dirname -- $0)/_/husky.shpnpm commitlint å½“æˆ‘ä»¬ commit æäº¤ä¿¡æ¯æ—¶ï¼Œå°±ä¸èƒ½å†éšæ„å†™äº†ï¼Œå¿…é¡»æ˜¯ git commit -m â€˜fix: xxxâ€™ ç¬¦åˆç±»å‹çš„æ‰å¯ä»¥ éœ€è¦æ³¨æ„çš„æ˜¯ç±»å‹çš„åé¢éœ€è¦ç”¨è‹±æ–‡çš„ :ï¼Œå¹¶ä¸”å†’å·åé¢æ˜¯éœ€è¦ç©ºä¸€æ ¼çš„ï¼Œè¿™ä¸ªæ˜¯ä¸èƒ½çœç•¥çš„ 2.6 å¼ºåˆ¶ä½¿ç”¨pnpmåŒ…ç®¡ç†å™¨å·¥å…· ä½œç”¨ å›¢é˜Ÿå¼€å‘é¡¹ç›®çš„æ—¶å€™ï¼Œéœ€è¦ç»Ÿä¸€åŒ…ç®¡ç†å™¨å·¥å…·,å› ä¸ºä¸åŒåŒ…ç®¡ç†å™¨å·¥å…·ä¸‹è½½åŒä¸€ä¸ªä¾èµ–,å¯èƒ½ç‰ˆæœ¬ä¸ä¸€æ ·,å¯¼è‡´é¡¹ç›®å‡ºç°bugé—®é¢˜,å› æ­¤åŒ…ç®¡ç†å™¨å·¥å…·éœ€è¦ç»Ÿä¸€ç®¡ç†ï¼ï¼ï¼ åˆ›å»ºé…ç½® åœ¨æ ¹ç›®å½•åˆ›å»ºscritps/preinstall.jsæ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢çš„å†…å®¹ if (!/pnpm/.test(process.env.npm_execpath || )) console.warn( `\\u001b[33mThis repository must using pnpm as the package manager ` + ` for scripts to work properly.\\u001b[39m `, ) process.exit(1) é…ç½®å‘½ä»¤ scripts: preinstall: node ./scripts/preinstall.js å½“æˆ‘ä»¬ä½¿ç”¨npmæˆ–è€…yarnæ¥å®‰è£…åŒ…çš„æ—¶å€™ï¼Œå°±ä¼šæŠ¥é”™äº†ã€‚åŸç†å°±æ˜¯åœ¨installçš„æ—¶å€™ä¼šè§¦å‘preinstallï¼ˆnpmæä¾›çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼‰è¿™ä¸ªæ–‡ä»¶é‡Œé¢çš„ä»£ç ã€‚ 3. é¡¹ç›®é›†æˆ3.1 é›†æˆelement-plus å®˜ç½‘ å®˜ç½‘åœ°å€:https://element-plus.gitee.io/zh-CN/ å®‰è£…ä¾èµ– pnpm install element-plus@2.3.4 @element-plus/icons-vue é…ç½® å…¥å£æ–‡ä»¶main.tså…¨å±€å®‰è£…element-plus,element-plusé»˜è®¤æ”¯æŒè¯­è¨€è‹±è¯­è®¾ç½®ä¸ºä¸­æ–‡ import createApp from vueimport App from ./App.vueimport ElementPlus from element-plusimport element-plus/dist/index.css//@ts-expect-errorå¿½ç•¥å½“å‰æ–‡ä»¶tsç±»å‹çš„æ£€æµ‹å¦åˆ™æœ‰çº¢è‰²æç¤º(æ‰“åŒ…ä¼šå¤±è´¥)import zhCn from element-plus/dist/locale/zh-cn.mjsconst app = createApp(App)app .use(ElementPlus, locale: zhCn, ) .mount(#app) æŒ‡å®šå…¨å±€ç»„ä»¶ç±»å‹ åœ¨ tsconfig.json ä¸­é€šè¿‡ compilerOptions.type æŒ‡å®šå…¨å±€ç»„ä»¶ç±»å‹ // tsconfig.json compilerOptions: // ... types: [element-plus/global] 3.2 srcåˆ«åçš„é…ç½® é…ç½®vite.config.ts åœ¨å¼€å‘é¡¹ç›®çš„æ—¶å€™æ–‡ä»¶ä¸æ–‡ä»¶å…³ç³»å¯èƒ½å¾ˆå¤æ‚ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç»™srcæ–‡ä»¶å¤¹é…ç½®ä¸€ä¸ªåˆ«åï¼ï¼ï¼ // vite.config.tsimport defineConfig from viteimport vue from @vitejs/plugin-vueimport path from pathexport default defineConfig( plugins: [vue()], resolve: alias: @: path.resolve(./src) // ç›¸å¯¹è·¯å¾„åˆ«åé…ç½®ï¼Œä½¿ç”¨ @ ä»£æ›¿ src ) tsconfig.jsoné…ç½® // tsconfig.json compilerOptions: baseUrl: ./, // è§£æéç›¸å¯¹æ¨¡å—çš„åŸºåœ°å€ï¼Œé»˜è®¤æ˜¯å½“å‰ç›®å½• paths: //è·¯å¾„æ˜ å°„ï¼Œç›¸å¯¹äºbaseUrl @/*: [src/*] 3.3 ç¯å¢ƒå˜é‡é…ç½® ä½œç”¨ é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè‡³å°‘ä¼šç»å†å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒ(å³æ­£å¼ç¯å¢ƒ)ä¸‰ä¸ªé˜¶æ®µã€‚ä¸åŒé˜¶æ®µè¯·æ±‚çš„çŠ¶æ€(å¦‚æ¥å£åœ°å€ç­‰)ä¸å°½ç›¸åŒï¼Œè‹¥æ‰‹åŠ¨åˆ‡æ¢æ¥å£åœ°å€æ˜¯ç›¸å½“ç¹çä¸”æ˜“å‡ºé”™çš„ã€‚äºæ˜¯ç¯å¢ƒå˜é‡é…ç½®çš„éœ€æ±‚å°±åº”è¿è€Œç”Ÿï¼Œæˆ‘ä»¬åªéœ€åšç®€å•çš„é…ç½®ï¼ŒæŠŠç¯å¢ƒçŠ¶æ€åˆ‡æ¢çš„å·¥ä½œäº¤ç»™ä»£ç ã€‚ ç¯å¢ƒ å¼€å‘ç¯å¢ƒï¼ˆdevelopmentï¼‰ é¡¾åæ€ä¹‰ï¼Œå¼€å‘ä½¿ç”¨çš„ç¯å¢ƒï¼Œæ¯ä½å¼€å‘äººå‘˜åœ¨è‡ªå·±çš„devåˆ†æ”¯ä¸Šå¹²æ´»ï¼Œå¼€å‘åˆ°ä¸€å®šç¨‹åº¦ï¼ŒåŒäº‹ä¼šåˆå¹¶ä»£ç ï¼Œè¿›è¡Œè”è°ƒã€‚ æµ‹è¯•ç¯å¢ƒï¼ˆtestingï¼‰ æµ‹è¯•åŒäº‹å¹²æ´»çš„ç¯å¢ƒå•¦ï¼Œä¸€èˆ¬ä¼šç”±æµ‹è¯•åŒäº‹è‡ªå·±æ¥éƒ¨ç½²ï¼Œç„¶ååœ¨æ­¤ç¯å¢ƒè¿›è¡Œæµ‹è¯• ç”Ÿäº§ç¯å¢ƒï¼ˆproductionï¼‰ ç”Ÿäº§ç¯å¢ƒæ˜¯æŒ‡æ­£å¼æä¾›å¯¹å¤–æœåŠ¡çš„ï¼Œä¸€èˆ¬ä¼šå…³æ‰é”™è¯¯æŠ¥å‘Šï¼Œæ‰“å¼€é”™è¯¯æ—¥å¿—ã€‚(æ­£å¼æä¾›ç»™å®¢æˆ·ä½¿ç”¨çš„ç¯å¢ƒ) é…ç½® é¡¹ç›®æ ¹ç›®å½•åˆ†åˆ«æ·»åŠ  å¼€å‘ã€ç”Ÿäº§å’Œæµ‹è¯•ç¯å¢ƒçš„æ–‡ä»¶! .env.development.env.production.env.test æ·»åŠ é…ç½® .env.development # å˜é‡å¿…é¡»ä»¥ VITE_ ä¸ºå‰ç¼€æ‰èƒ½æš´éœ²ç»™å¤–éƒ¨è¯»å–NODE_ENV = developmentVITE_APP_TITLE = åå°å¼€å‘æ¨¡æ¿VITE_APP_BASE_API = /dev-api .env.production NODE_ENV = productionVITE_APP_TITLE = åå°å¼€å‘æ¨¡æ¿VITE_APP_BASE_API = /prod-api .env.test # å˜é‡å¿…é¡»ä»¥ VITE_ ä¸ºå‰ç¼€æ‰èƒ½æš´éœ²ç»™å¤–éƒ¨è¯»å–NODE_ENV = testVITE_APP_TITLE = åå°å¼€å‘æ¨¡æ¿VITE_APP_BASE_API = /test-api é…ç½®è¿è¡Œå‘½ä»¤ï¼špackage.json scripts: build:test: vue-tsc vite build --mode test, build:pro: vue-tsc vite build --mode production , é€šè¿‡import.meta.envè·å–ç¯å¢ƒå˜é‡ template divHello/div/templatescript lang=tsconsole.log(import.meta.env)export default /scriptstyle/style 3.4 SVGå›¾æ ‡é…ç½®3.4.1 å›¾æ ‡é…ç½® ä½œç”¨ åœ¨å¼€å‘é¡¹ç›®çš„æ—¶å€™ç»å¸¸ä¼šç”¨åˆ°svgçŸ¢é‡å›¾,è€Œä¸”æˆ‘ä»¬ä½¿ç”¨SVGä»¥åï¼Œé¡µé¢ä¸ŠåŠ è½½çš„ä¸å†æ˜¯å›¾ç‰‡èµ„æºã€‚ è¿™å¯¹é¡µé¢æ€§èƒ½æ¥è¯´æ˜¯ä¸ªå¾ˆå¤§çš„æå‡ï¼Œè€Œä¸”æˆ‘ä»¬SVGæ–‡ä»¶æ¯”imgè¦å°çš„å¾ˆå¤šï¼Œæ”¾åœ¨é¡¹ç›®ä¸­å‡ ä¹ä¸å ç”¨èµ„æºã€‚ å®‰è£…ä¾èµ– pnpm install vite-plugin-svg-icons -D é…ç½® åœ¨vite.config.tsä¸­é…ç½®æ’ä»¶ import createSvgIconsPlugin from vite-plugin-svg-iconsimport path from pathexport default () = return plugins: [ createSvgIconsPlugin( // Specify the icon folder to be cached iconDirs: [path.resolve(process.cwd(), src/assets/icons)], // Specify symbolId format symbolId: icon-[dir]-[name], ), ], å…¥å£æ–‡ä»¶å¯¼å…¥ // main.tsimport virtual:svg-icons-register 3.4.2 å°è£…ä¸ºå…¨å±€ç»„ä»¶ ä½œç”¨ å› ä¸ºé¡¹ç›®å¾ˆå¤šæ¨¡å—éœ€è¦ä½¿ç”¨å›¾æ ‡,å› æ­¤æŠŠå®ƒå°è£…ä¸ºå…¨å±€ç»„ä»¶ï¼ï¼ï¼ ç¤ºä¾‹ åœ¨srccomponentsç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªSvgIconç»„ä»¶ template div svg :style= width: width, height: height use :xlink:href=prefix + name :fill=color/use /svg /div/templatescript setup lang=tsdefineProps( //xlink:hrefå±æ€§å€¼çš„å‰ç¼€ prefix: type: String, default: #icon-, , //svgçŸ¢é‡å›¾çš„åå­— name: String, //svgå›¾æ ‡çš„é¢œè‰² color: type: String, default: , , //svgå®½åº¦ width: type: String, default: 16px, , //svgé«˜åº¦ height: type: String, default: 16px, ,)/scriptstyle scoped/style æ³¨å†Œå…¨å±€ç»„ä»¶ åœ¨srccomponentsæ–‡ä»¶å¤¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªindex.tsæ–‡ä»¶ï¼šç”¨äºæ³¨å†Œcomponentsæ–‡ä»¶å¤¹å†…éƒ¨å…¨éƒ¨å…¨å±€ç»„ä»¶ï¼ï¼ï¼ // index.tsimport SvgIcon from ./SvgIcon/index.vue;import type App, Component from vue;const components: [name: string]: Component = SvgIcon ;export default install(app: App) Object.keys(components).forEach((key: string) = app.component(key, components[key]); ) å…¥å£æ–‡ä»¶ä½¿ç”¨è‡ªå®šä¹‰æ’ä»¶ import gloablComponent from ./components/index;app.use(gloablComponent); 3.5 é›†æˆsass ä½œç”¨ æˆ‘ä»¬ç›®å‰åœ¨ç»„ä»¶å†…éƒ¨å·²ç»å¯ä»¥ä½¿ç”¨scssæ ·å¼,å› ä¸ºåœ¨é…ç½®styleLintå·¥å…·çš„æ—¶å€™ï¼Œé¡¹ç›®å½“ä¸­å·²ç»å®‰è£…è¿‡sass sass-loader,å› æ­¤æˆ‘ä»¬å†ç»„ä»¶å†…å¯ä»¥ä½¿ç”¨scssè¯­æ³•ï¼ï¼ï¼éœ€è¦åŠ ä¸Šlangâ€scssâ€ style scoped lang=scss/style å…¨å±€æ ·å¼ åœ¨srcstylesç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªindex.scssæ–‡ä»¶ï¼Œå½“ç„¶é¡¹ç›®ä¸­éœ€è¦ç”¨åˆ°æ¸…é™¤é»˜è®¤æ ·å¼ï¼Œå› æ­¤åœ¨index.scsså¼•å…¥reset.scss reset.scss *,*:after,*:before box-sizing: border-box; outline: none;html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video font: inherit; font-size: 100%; margin: 0; padding: 0; vertical-align: baseline; border: 0;article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section display: block;body line-height: 1;ol,ul list-style: none;blockquote,q quotes: none; :before, :after content: ; content: none; sub,sup font-size: 75%; line-height: 0; position: relative; vertical-align: baseline;sup top: -.5em;sub bottom: -.25em;table border-spacing: 0; border-collapse: collapse;input,textarea,button font-family: inhert; font-size: inherit; color: inherit;select text-indent: .01px; text-overflow: ; border: 0; border-radius: 0; -webkit-appearance: none; -moz-appearance: none;select::-ms-expand display: none;code,pre font-family: monospace, monospace; font-size: 1em; index.scss //å¼•å…¥æ¸…é™¤é»˜è®¤æ ·å¼@import ./reset.scss;//æ»šåŠ¨æ¡å¤–è§‚è®¾ç½®::-webkit-scrollbar width: 10px;::-webkit-scrollbar-track background: $base-menu-background;::-webkit-scrollbar-thumb width: 10px; background-color: yellowgreen; border-radius: 10px; å…¥å£æ–‡ä»¶å¼•å…¥ // main.tsimport @/styles ä½†æ˜¯ä½ ä¼šå‘ç°åœ¨srcstylesindex.scsså…¨å±€æ ·å¼æ–‡ä»¶ä¸­æ²¡æœ‰åŠæ³•ä½¿ç”¨$å˜é‡.å› æ­¤éœ€è¦ç»™é¡¹ç›®ä¸­å¼•å…¥å…¨å±€å˜é‡$. åœ¨stylevariable.scssåˆ›å»ºä¸€ä¸ªvariable.scssæ–‡ä»¶ï¼ åœ¨vite.config.tsæ–‡ä»¶é…ç½®å¦‚ä¸‹: export default defineConfig((config) = css: preprocessorOptions: scss: javascriptEnabled: true, additionalData: @import ./src/styles/variable.scss;, , , , @import ./src/styles/variable.less;åé¢çš„;ä¸è¦å¿˜è®°ï¼Œä¸ç„¶ä¼šæŠ¥é”™! é…ç½®å®Œæ¯•ä½ ä¼šå‘ç°scssæä¾›è¿™äº›å…¨å±€å˜é‡å¯ä»¥åœ¨ç»„ä»¶æ ·å¼ä¸­ä½¿ç”¨äº†ï¼ï¼ï¼ 3.6 mockæ•°æ® å®‰è£…ä¾èµ– https://www.npmjs.com/package/vite-plugin-mock pnpm install vite-plugin-mock@2.9.6 -D é…ç½®å¯ç”¨æ’ä»¶ // vite.config.js//mockæ’ä»¶æä¾›æ–¹æ³•import viteMockServe from vite-plugin-mockexport default defineConfig(( command ) = return plugins: [ viteMockServe( localEnabled: command === serve, //ä¿è¯å¼€å‘é˜¶æ®µå¯ä»¥ä½¿ç”¨mockæ¥å£ ), ], ) æµ‹è¯• åœ¨æ ¹ç›®å½•åˆ›å»ºmockæ–‡ä»¶å¤¹:å»åˆ›å»ºæˆ‘ä»¬éœ€è¦mockæ•°æ®ä¸æ¥å£ï¼ï¼ï¼ åœ¨mockæ–‡ä»¶å¤¹å†…éƒ¨åˆ›å»ºä¸€ä¸ªuser.tsæ–‡ä»¶ //createUserList:æ¬¡å‡½æ•°æ‰§è¡Œä¼šè¿”å›ä¸€ä¸ªæ•°ç»„,æ•°ç»„é‡Œé¢åŒ…å«ä¸¤ä¸ªç”¨æˆ·ä¿¡æ¯function createUserList() return [ userId: 1, avatar: https://wpimg.wallstcn.com/f778738c-e4f8-4870-b634-56703b4acafe.gif, username: admin, password: 111111, desc: å¹³å°ç®¡ç†å‘˜, roles: [å¹³å°ç®¡ç†å‘˜], buttons: [cuser.detail], routes: [home], token: Admin Token, , userId: 2, avatar: https://wpimg.wallstcn.com/f778738c-e4f8-4870-b634-56703b4acafe.gif, username: system, password: 111111, desc: ç³»ç»Ÿç®¡ç†å‘˜, roles: [ç³»ç»Ÿç®¡ç†å‘˜], buttons: [cuser.detail, cuser.user], routes: [home], token: System Token, , ]//å¯¹å¤–æš´éœ²ä¸€ä¸ªæ•°ç»„:æ•°ç»„é‡Œé¢åŒ…å«ä¸¤ä¸ªæ¥å£//ç™»å½•å‡çš„æ¥å£//è·å–ç”¨æˆ·ä¿¡æ¯çš„å‡çš„æ¥å£export default [ // ç”¨æˆ·ç™»å½•æ¥å£ url: /api/user/login, //è¯·æ±‚åœ°å€ method: post, //è¯·æ±‚æ–¹å¼ response: ( body ) = //è·å–è¯·æ±‚ä½“æºå¸¦è¿‡æ¥çš„ç”¨æˆ·åä¸å¯†ç  const username, password = body //è°ƒç”¨è·å–ç”¨æˆ·ä¿¡æ¯å‡½æ•°,ç”¨äºåˆ¤æ–­æ˜¯å¦æœ‰æ­¤ç”¨æˆ· const checkUser = createUserList().find( (item) = item.username === username item.password === password, ) //æ²¡æœ‰ç”¨æˆ·è¿”å›å¤±è´¥ä¿¡æ¯ if (!checkUser) return code: 201, data: message: è´¦å·æˆ–è€…å¯†ç ä¸æ­£ç¡® //å¦‚æœæœ‰è¿”å›æˆåŠŸä¿¡æ¯ const token = checkUser return code: 200, data: token , , // è·å–ç”¨æˆ·ä¿¡æ¯ url: /api/user/info, method: get, response: (request) = //è·å–è¯·æ±‚å¤´æºå¸¦token const token = request.headers.token //æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯æ˜¯å¦åŒ…å«æœ‰æ¬¡tokenç”¨æˆ· const checkUser = createUserList().find((item) = item.token === token) //æ²¡æœ‰è¿”å›å¤±è´¥çš„ä¿¡æ¯ if (!checkUser) return code: 201, data: message: è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥ //å¦‚æœæœ‰è¿”å›æˆåŠŸä¿¡æ¯ return code: 200, data: checkUser , ,] å®‰è£…axios pnpm install axios æµ‹è¯• // main.tsimport axios from axiosaxios( url: /api/user/login, method: post, data: username: admin, password: 111111, ,) 3.7 axiosäºŒæ¬¡å°è£… ä½œç”¨ ä½¿ç”¨è¯·æ±‚æ‹¦æˆªå™¨ï¼Œå¯ä»¥åœ¨è¯·æ±‚æ‹¦æˆªå™¨ä¸­å¤„ç†ä¸€äº›ä¸šåŠ¡(å¼€å§‹è¿›åº¦æ¡ã€è¯·æ±‚å¤´æºå¸¦å…¬å…±å‚æ•°) ä½¿ç”¨å“åº”æ‹¦æˆªå™¨ï¼Œå¯ä»¥åœ¨å“åº”æ‹¦æˆªå™¨ä¸­å¤„ç†ä¸€äº›ä¸šåŠ¡(è¿›åº¦æ¡ç»“æŸã€ç®€åŒ–æœåŠ¡å™¨è¿”å›çš„æ•°æ®ã€å¤„ç†httpç½‘ç»œé”™è¯¯) ç¤ºä¾‹ åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºutilsrequest.ts import axios from axiosimport ElMessage from element-plus//åˆ›å»ºaxioså®ä¾‹const request = axios.create( baseURL: import.meta.env.VITE_APP_BASE_API, timeout: 5000,)//è¯·æ±‚æ‹¦æˆªå™¨request.interceptors.request.use((config) = return config)//å“åº”æ‹¦æˆªå™¨request.interceptors.response.use( (response) = return response.data , (error) = //å¤„ç†ç½‘ç»œé”™è¯¯ let msg = const status = error.response.status switch (status) case 401: msg = tokenè¿‡æœŸ break case 403: msg = æ— æƒè®¿é—® break case 404: msg = è¯·æ±‚åœ°å€é”™è¯¯ break case 500: msg = æœåŠ¡å™¨å‡ºç°é—®é¢˜ break default: msg = æ— ç½‘ç»œ ElMessage( type: error, message: msg, ) return Promise.reject(error) ,)export default request 4. è·¯ç”±é…ç½® å®‰è£…ä¾èµ– pnpm i vue-router è·¯ç”±é›å½¢ ä»¥src\\views\\login\\index.vueä¸ºä¾‹ï¼Œåˆ›å»ºè·¯ç”±ç•Œé¢ template divä¸€çº§è·¯ç”±login/div/templatescript setup lang=ts/scriptstyle lang=scss/style åˆ›å»ºè·¯ç”±src\\router\\router.tsæ–‡ä»¶ï¼Œå®šä¹‰è·¯ç”± // å¯¹å¤–æš´éœ²é…ç½®è·¯ç”±(å¸¸é‡è·¯ç”±)export const constantRoute = [ //ç™»å½•è·¯ç”± path: /login, component: () = import(@/views/login/index.vue), name: login, //å‘½åè·¯ç”± , // ç™»å½•æˆåŠŸä»¥åå±•ç¤ºæ•°æ®çš„è·¯ç”± path: /, component: () = import(@/views/home/index.vue), name: layout, , path: /404, component: () = import(@/views/404/index.vue), name: 404, , // é‡å®šå‘ path: /:pathMatch(.*)*, redirect: /404, name: Any, ,] åˆ›å»ºsrc\\router\\index.tsè·¯ç”± // é€šè¿‡vue-routeræ’ä»¶å®ç°æ¨¡æ¿è·¯ç”±é…ç½®import createRouter, createWebHashHistory from vue-routerimport constantRoute from ./router// åˆ›å»ºè·¯ç”±å™¨const router = createRouter( // è·¯ç”±æ¨¡å¼hash history: createWebHashHistory(), routes: constantRoute, // æ»šåŠ¨è¡Œä¸º scrollBehavior() return left: 0, top: 0, ,)export default router åœ¨main.tsä¸­æŒ‚è½½è·¯ç”± // å¯¼å…¥è·¯ç”±ç»„ä»¶import router from ./router// è·å–åº”ç”¨å®ä¾‹å¯¹è±¡const app = createApp(App)// ä½¿ç”¨è·¯ç”±ç»„ä»¶app.use(router) æŒ‡å®šè·¯ç”±å‡ºå£ !-- App.vue --template divrouter-view/router-view/div/templatescript setup lang=ts/scriptstyle/style 5. ç™»å½•æ¨¡å—5.1 ç™»å½•ç•Œé¢ ç¼–å†™ç™»å½•ç•Œé¢ !-- src/views/login/index.vue --template div class=login_container el-row el-col :span=12 :xs=0/el-col el-col :span=12 :xs=24 el-form class=login_form h1Hello/h1 h2æ¬¢è¿æ¥åˆ°XXX/h2 el-form-item el-input :prefix-icon=User v-model=loginForm.username /el-input /el-form-item el-form-item el-input type=password :prefix-icon=Lock v-model=loginForm.password show-password /el-input /el-form-item el-form-item el-button :loading=loadType class=login_btn type=primary size=default @click=login ç™»å½• /el-button /el-form-item /el-form /el-col /el-row /div/templatescript setup lang=tsimport User, Lock from @element-plus/icons-vueimport reactive from vue// ç™»å½•æ•ˆæœlet loadType = ref(false)//æ”¶é›†è´¦å·ä¸å¯†ç æ•°æ®let loginForm = reactive( username: admin, password: 111111 )/scriptstyle lang=scss scoped.login_container width: 100%; height: 100vh; background: url(@/assets/images/background.jpg) no-repeat; background-size: cover; .login_form position: relative; width: 80%; top: 30vh; background: url(@/assets/images/login_form.png) no-repeat; background-size: cover; padding: 40px; h1 color: white; font-size: 40px; h2 color: white; font-size: 20px; margin: 20px 0px; .login_btn width: 100%; /style 5.2 ç¼–å†™è¯·æ±‚ç™»å½•API æ¥å£è¯·æ±‚å‚æ•°åŠè¿”å›ç±»å‹ // ç”¨æˆ·ç™»å½•æ¥å£ url: /dev-api/user/login, //è¯·æ±‚åœ°å€ method: post, //è¯·æ±‚æ–¹å¼ response: ( body ) = //è·å–è¯·æ±‚ä½“æºå¸¦è¿‡æ¥çš„ç”¨æˆ·åä¸å¯†ç  const username, password = body //è°ƒç”¨è·å–ç”¨æˆ·ä¿¡æ¯å‡½æ•°,ç”¨äºåˆ¤æ–­æ˜¯å¦æœ‰æ­¤ç”¨æˆ· const checkUser = createUserList().find( (item) = item.username === username item.password === password, ) //æ²¡æœ‰ç”¨æˆ·è¿”å›å¤±è´¥ä¿¡æ¯ if (!checkUser) return code: 201, data: message: è´¦å·æˆ–è€…å¯†ç ä¸æ­£ç¡® //å¦‚æœæœ‰è¿”å›æˆåŠŸä¿¡æ¯ const token = checkUser return code: 200, data: token ,, // ç™»å½•æ¥å£è¿”å›æ•°æ®ç±»å‹ userId: 1, avatar: https://wpimg.wallstcn.com/f778738c-e4f8-4870-b634-56703b4acafe.gif, username: admin, password: 111111, desc: å¹³å°ç®¡ç†å‘˜, roles: [å¹³å°ç®¡ç†å‘˜], buttons: [cuser.detail], routes: [home], token: Admin Token,, æ ¹æ®ç™»å½•æ¥å£ç¼–å†™æ•°æ®ç±»å‹type // src/api/user/type.ts// ç™»å½•æ¥å£éœ€è¦æºå¸¦å‚æ•°tsç±»å‹export interface loginForm username: string password: string// ? å¯é€‰å‚æ•°export interface dataType token?: string message?: string// ç™»å½•æ¥å£è¿”å›æ•°æ®ç±»å‹export interface loginResponseData code: number data: dataType ç¼–å†™ç™»å½•æ¥å£ // src/api/user/index.ts// åŒä¸€ç®¡ç†ç”¨æˆ·ç›¸å…³çš„æ¥å£import request from @/utils/requestimport loginForm, loginResponseData from ./type// ç»Ÿä¸€ç®¡ç†APIenum API LOGIN_URL = /user/login,// æš´éœ²è¯·æ±‚å‡½æ•°// ç™»å½•æ¥å£export const reqLogin = (data: loginForm) = request.postany, loginResponseData(API.LOGIN_URL, data) 5.3 ç”¨æˆ·æ•°æ®å­˜å‚¨pinia å®‰è£…ä¾èµ– pnpm i pinia@2.0.34 åˆ›å»ºpiniaä»“åº“ // src/store/index.ts//ä»“åº“å¤§ä»“åº“import createPinia from pinia//åˆ›å»ºå¤§ä»“åº“const pinia = createPinia()//å¯¹å¤–æš´éœ²ï¼šå…¥å£æ–‡ä»¶éœ€è¦å®‰è£…ä»“åº“export default pinia æŒ‚è½½pinia // main.ts// å¯¼å…¥piniaimport pinia from ./storeapp.use(pinia) åˆ›å»ºUserStateæ•°æ®ç±»å‹ // src/store/modules/type/type.tsexport interface UserState token: string | null tokenç›¸å…³å·¥å…·æ–¹æ³• // src/utils/token.ts// å°è£…æœ¬åœ°å­˜å‚¨å’Œè¯»å–æ•°æ®çš„æ–¹æ³•export const SET_TOKEN = (token: string) = localStorage.setItem(TOKEN, token)export const GET_TOKEN = (): string | null = return localStorage.getItem(TOKEN) åˆ›å»ºç”¨æˆ·ç›¸å…³ä»“åº“ // src/store/modules/user.ts// åˆ›å»ºç”¨æˆ·ç›¸å…³çš„å°ä»“åº“import defineStore from piniaimport loginForm, loginResponseData from @/api/user/typeimport reqLogin from @/api/userimport GET_TOKEN, SET_TOKEN from @/utils/tokenimport UserState from ./type/type// åˆ›å»ºç”¨æˆ·å°ä»“åº“const useUserStore = defineStore(User, // ç”¨æˆ·ä»“åº“å­˜å‚¨æ•°æ®åœ°æ–¹ state(): UserState return token: GET_TOKEN(), , // å¤„ç†å¼‚æ­¥|é€»è¾‘åœ°æ–¹ actions: async userLogin(data: loginForm) const result: loginResponseData = await reqLogin(data) console.log(result) if (result.code === 200) this.token = result.data.token as string //localStorage.setItem(TOKEN, this.token) SET_TOKEN(this.token) return OK else return Promise.reject(new Error(result.data.message)) , , getters: ,)// å¯¹å¤–æš´éœ²å°ä»“åº“export default useUserStore 5.4 ç™»å½•æŒ‰é’®ç‚¹å‡»äº‹ä»¶ ç™»å½• !-- src/views/login/index.vue --script setup lang=tsimport User, Lock from @element-plus/icons-vueimport reactive, ref from vueimport useUserStore from @/store/modules/userimport useRouter from vue-routerimport ElNotification from element-plus// ç™»å½•æ•ˆæœlet loadType = ref(false)//æ”¶é›†è´¦å·ä¸å¯†ç æ•°æ®let loginForm = reactive( username: admin, password: 111111 )const router = useRouter()let userStore = useUserStore()// ç™»å½•const login = async () = loadType.value = true try await userStore.userLogin(loginForm) router.push(/) ElNotification( type: success, message: ç™»å½•æˆåŠŸ, ) loadType.value = false catch (error) loadType.value = false ElNotification( type: error, message: (error as Error).message, ) /script 5.5 ç™»å½•æç¤º éœ€æ±‚ ä¿®æ”¹ç™»å½•æç¤º æä¾›æ—¶é—´å‡½æ•° // src/utils/time.tsexport const getTime = () = let message = const hours = new Date().getHours() if (hours = 9) message = æ—©ä¸Š else if (hours = 12) message = ä¸Šåˆ else if (hours = 18) message = ä¸‹åˆ else message = æ™šä¸Š return message ä¿®æ”¹æç¤º // ç™»å½•const login = async () = loadType.value = true try await userStore.userLogin(loginForm) router.push(/) ElNotification( type: success, message: æ¬¢è¿å›æ¥, // ä¿®æ”¹æç¤º title: `HI,$getTime()å¥½`, ) loadType.value = false catch (error) loadType.value = false ElNotification( type: error, message: (error as Error).message, ) 5.6 ç™»å½•è¡¨å•æ ¡éªŒ ç»‘å®šè¡¨å• https://element-plus.org/zh-CN/component/form.html#%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8C el-form class=login_form !-- è¡¨å•è§„åˆ™ -- :rules=rules !-- è¡¨å•æ•°æ® -- :model=loginForm !-- é€šè¿‡refè·å–è¡¨å•ç»„ä»¶ -- ref=loginFormRef å®šä¹‰è§„åˆ™ //å®šä¹‰è¡¨å•æ ¡éªŒéœ€è¦çš„é…ç½®å¯¹è±¡const rules = username: [ //è§„åˆ™å¯¹è±¡å±æ€§: required: true, // required,ä»£è¡¨è¿™ä¸ªå­—æ®µåŠ¡å¿…è¦æ ¡éªŒçš„ min: 5, //min:æ–‡æœ¬é•¿åº¦è‡³å°‘å¤šå°‘ä½ max: 10, // max:æ–‡æœ¬é•¿åº¦æœ€å¤šå¤šå°‘ä½ message: é•¿åº¦åº”ä¸º6-10ä½, // message:é”™è¯¯çš„æç¤ºä¿¡æ¯ trigger: change, //trigger:è§¦å‘æ ¡éªŒè¡¨å•çš„æ—¶æœº change-æ–‡æœ¬å‘ç”Ÿå˜åŒ–è§¦å‘æ ¡éªŒ, blur:å¤±å»ç„¦ç‚¹çš„æ—¶å€™è§¦å‘æ ¡éªŒè§„åˆ™ , ], password: [ required: true, min: 6, max: 10, message: é•¿åº¦åº”ä¸º6-15ä½, trigger: change, , ],// è·å–è¡¨å•ç»„ä»¶const loginFormRef = ref() æ‰§è¡Œæ ¡éªŒ // ç™»å½•const login = async () = //ä¿è¯å…¨éƒ¨è¡¨å•é¡¹æ ¡éªŒé€šè¿‡ await loginFormRef.value.validate() ... 5.7 è‡ªå®šä¹‰æ ¡éªŒ è‡ªå®šä¹‰è§„åˆ™ æœ‰æ—¶å€™é»˜è®¤çš„æ ¡éªŒè§„åˆ™ä¸æ»¡è¶³æ ¡éªŒè¦æ±‚ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥è‡ªå®šä¹‰æ ¡éªŒè§„åˆ™å‡½æ•° //è‡ªå®šä¹‰æ ¡éªŒè§„åˆ™å‡½æ•°const validatorUserName = (_rule: any, value: any, callback: any) = //ruleï¼šæ ¡éªŒè§„åˆ™å¯¹è±¡ //value:è¡¨å•å…ƒç´ æ–‡æœ¬å†…å®¹ //callback:ç¬¦åˆæ¡ä»¶ï¼Œcallbackæ”¾è¡Œé€šè¿‡ï¼Œä¸ç¬¦åˆï¼šæ³¨å…¥é”™è¯¯æç¤ºä¿¡æ¯ if (value.length = 5) callback() else callback(new Error(è´¦å·é•¿åº¦è‡³å°‘5ä½)) const validatorPassword = (_rule: any, value: any, callback: any) = if (value.length = 6) callback() else callback(new Error(å¯†ç é•¿åº¦è‡³å°‘6ä½)) æ·»åŠ è§„åˆ™ //å®šä¹‰è¡¨å•æ ¡éªŒéœ€è¦çš„é…ç½®å¯¹è±¡const rules = username: [ validator: validatorUserName, trigger: change , ], password: [ validator: validatorPassword, trigger: change , ], 6. Layoutæ¨¡å—6.1 ä¸»ç•Œé¢ ä¸»ç•Œé¢ !-- src/layout/index.vue --template div class=layout_container !-- å·¦ä¾§èœå• -- div class=layout_slider/div !-- é¡¶éƒ¨å¯¼èˆª -- div class=layout_tabbar/div !-- å†…å®¹å±•ç¤ºåŒºåŸŸ -- div class=layout_main p style=height: 1000000px/p /div /div/templatescript setup lang=ts/scriptstyle lang=scss scoped.layout_container width: 100%; height: 100vh; .layout_slider width: $base-menu-width; height: 100vh; background: $base-menu-background; .layout_tabbar position: fixed; width: calc(100% - $base-menu-width); height: $base-tabbar-height; background: cyan; top: 0; left: $base-menu-width; .layout_main position: absolute; width: calc(100% - $base-menu-width); height: calc(100vh - $base-tabbar-height); background-color: yellowgreen; left: $base-menu-width; top: $base-tabbar-height; padding: 20px; overflow: auto; /style å®šä¹‰å…¨å±€å˜é‡ // scr/styles/variable.scss// é¡¹ç›®æä¾›scsså…¨å±€å˜é‡//å·¦ä¾§çš„èœå•çš„å®½åº¦$base-menu-width:260px;//å·¦ä¾§èœå•çš„èƒŒæ™¯é¢œè‰²$base-menu-background:#001529;$base-menu-min-width:50px;// é¡¶éƒ¨å¯¼èˆªçš„é«˜åº¦$base-tabbar-height:50px; å®šä¹‰æ»šåŠ¨æ¡æ ·å¼ // scr/styles/index.scss//å¼•å…¥æ¸…é™¤é»˜è®¤æ ·å¼@import ./reset.scss;//æ»šåŠ¨æ¡å¤–è§‚è®¾ç½®::-webkit-scrollbar width: 10px;::-webkit-scrollbar-thumb width: 10px; background-color: yellowgreen; border-radius: 10px; 6.2 å°è£…LOGO åˆ›å»ºlogoç»„ä»¶ !-- src/layout/logo/index.vue --template div class=logo img src=../../../../public/logo.png alt= / pxxxåå°ç®¡ç†/p /div/templatescript setup lang=ts/scriptstyle lang=scss scoped.logo width: 100%; height: $base-menu-logo-height; color: white; display: flex; align-items: center; padding: 20px; img width: 40px; height: 40px; p font-size: $base-logo-title-fontSize; margin-left: 10px; /style æ·»åŠ logoå…¨å±€å˜é‡ // scr/styles/variable.scss//å·¦ä¾§èœå•logoé«˜åº¦è®¾ç½®$base-menu-logo-height:50px;//å·¦ä¾§èœå•logoå³ä¾§æ–‡å­—å¤§å°$base-logo-title-fontSize:20px; å¼•å…¥logoç»„ä»¶ template div class=layout_container !-- å·¦ä¾§èœå• -- div class=layout_slider !-- å¼•å…¥logo -- Logo/Logo /div !-- é¡¶éƒ¨å¯¼èˆª -- div class=layout_tabbar/div !-- å†…å®¹å±•ç¤ºåŒºåŸŸ -- div class=layout_main p style=height: 1000000px/p /div /div/templatescript setup lang=tsimport Logo from @/views/layout/logo/index.vue/script æŠ½å–é…ç½® ä¸ºäº†æ–¹ä¾¿ä»¥åå¯¹logoä»¥åŠæ ‡é¢˜çš„ä¿®æ”¹ï¼Œå¯ä»¥å°†logoå†…å®¹æŠ½å–åˆ°é…ç½®æ–‡ä»¶ä¸­ // src/setting.ts//ç”¨äºé¡¹ç›®logo|æ ‡é¢˜é…ç½®export default title: ç¡…è°·ç”„é€‰è¿è¥å¹³å°, //é¡¹ç›®çš„æ ‡é¢˜ logo: /public/logo.png, //é¡¹ç›®logoè®¾ç½® logoHidden: true, //logoç»„ä»¶æ˜¯å¦éšè— ä¿®æ”¹logoç»„ä»¶ template div class=logo v-if=!setting.logoHidden img :src=setting.logo alt= / p setting.title /p /div/templatescript setup lang=tsimport setting from @/setting/script 6.3 å·¦ä¾§é™æ€èœå•ç»„ä»¶ å·¦ä¾§æ»šåŠ¨æ¡ https://element-plus.org/zh-CN/component/scrollbar.html template div class=layout_container !-- å·¦ä¾§èœå• -- div class=layout_slider !-- logo -- Logo/Logo !-- æ»šåŠ¨ç»„ä»¶ -- el-scrollbar class=scrollbar p v-for=item in 2000 :key=item class=scrollbar-demo-item item /p /el-scrollbar /div !-- é¡¶éƒ¨å¯¼èˆª -- div class=layout_tabbar/div !-- å†…å®¹å±•ç¤ºåŒºåŸŸ -- div class=layout_main p style=height: 1000000px/p /div /div/templatestyle lang=scss scoped.layout_container width: 100%; height: 100vh; // è®¾ç½®å­—ä½“é¢œè‰² color: white; .layout_slider width: $base-menu-width; height: 100vh; background: $base-menu-background; // è®¾ç½®æ»šåŠ¨æ¡æ ·å¼ .scrollbar width: 100%; height: calc(100vh - $base-menu-logo-height); // æ¶ˆé™¤æ»šåŠ¨border .el-menu border-right: 0; .layout_tabbar position: fixed; width: calc(100% - $base-menu-width); height: $base-tabbar-height; background: cyan; top: 0; left: $base-menu-width; .layout_main position: absolute; width: calc(100% - $base-menu-width); height: calc(100vh - $base-tabbar-height); background-color: yellowgreen; left: $base-menu-width; top: $base-tabbar-height; padding: 20px; overflow: auto; /style èœå•ç»„ä»¶ https://element-plus.org/zh-CN/component/menu.html template div class=layout_container !-- å·¦ä¾§èœå• -- div class=layout_slider !-- logo -- Logo/Logo !-- æ»šåŠ¨ç»„ä»¶ -- el-scrollbar !-- èœå•ç»„ä»¶ -- el-menu background-color=#001529 text-color=white el-menu-item index=1é¦–é¡µ/el-menu-item el-menu-item index=2æ•°æ®å¤§å±/el-menu-item !-- æŠ˜å èœå• -- el-sub-menu index=3 template #title spanæƒé™ç®¡ç†/span /template el-menu-item index=3-1ç”¨æˆ·ç®¡ç†/el-menu-item el-menu-item index=3-2è§’è‰²ç®¡ç†/el-menu-item el-menu-item index=3-3èœå•ç®¡ç†/el-menu-item /el-sub-menu /el-menu /el-scrollbar /div !-- é¡¶éƒ¨å¯¼èˆª -- div class=layout_tabbar/div !-- å†…å®¹å±•ç¤ºåŒºåŸŸ -- div class=layout_main p style=height: 1000000px/p /div /div/template 6.4 åŠ¨æ€èœå•ç»„ä»¶ å°è£…ç»„ä»¶ src\\layout\\menu\\index.vue template !-- èœå•ç»„ä»¶ -- el-menu background-color=#001529 text-color=white el-menu-item index=1é¦–é¡µ/el-menu-item el-menu-item index=2æ•°æ®å¤§å±/el-menu-item !-- æŠ˜å èœå• -- el-sub-menu index=3 template #title spanæƒé™ç®¡ç†/span /template el-menu-item index=3-1ç”¨æˆ·ç®¡ç†/el-menu-item el-menu-item index=3-2è§’è‰²ç®¡ç†/el-menu-item el-menu-item index=3-3èœå•ç®¡ç†/el-menu-item /el-sub-menu /el-menu/templatescript setup lang=ts/scriptstyle lang=scss scoped/style src\\layout\\index.vue template div class=layout_container !-- å·¦ä¾§èœå• -- div class=layout_slider !-- logo -- Logo/Logo !-- æ»šåŠ¨ç»„ä»¶ -- el-scrollbar class=scrollbar Menu/Menu /el-scrollbar /div !-- é¡¶éƒ¨å¯¼èˆª -- div class=layout_tabbar/div !-- å†…å®¹å±•ç¤ºåŒºåŸŸ -- div class=layout_main p style=height: 1000000px/p /div /div/templatescript setup lang=tsimport Logo from ./logo/index.vueimport Menu from ./menu/index.vue/script è·¯ç”±ä¿¡æ¯å­˜å…¥pinia å®šä¹‰è·¯ç”±ç±»å‹ src\\store\\modules\\type\\type.ts import RouteRecordRaw from vue-routerexport interface UserState token: string | null menuRoutes: RouteRecordRaw[] // è·¯ç”±ç±»å‹ è·¯ç”±ä¿¡æ¯å­˜å…¥state import constantRoute from @/router/router// åˆ›å»ºç”¨æˆ·ä»“åº“const useUserStore = defineStore(User, // ç”¨æˆ·ä»“åº“å­˜å‚¨æ•°æ®åœ°æ–¹ state(): UserState return token: GET_TOKEN(), menuRoutes: constantRoute, , ...) è·¯ç”±æ·»åŠ metaä¿¡æ¯ src\\router\\router.ts // å¯¹å¤–æš´éœ²é…ç½®è·¯ç”±(å¸¸é‡è·¯ç”±)export const constantRoute = [ //ç™»å½• path: /login, component: () = import(@/views/login/index.vue), name: login, meta: title: ç™»å½•, //èœå•æ ‡é¢˜ , , //ç™»å½•æˆåŠŸä»¥åå±•ç¤ºæ•°æ®çš„è·¯ç”± path: /, component: () = import(@/layout/index.vue), name: layout, meta: title: layout, , redirect: /home, children: [ path: /home, component: () = import(@/views/home/index.vue), meta: title: é¦–é¡µ, , , path: /home2, component: () = import(@/views/home/index.vue), meta: title: é¦–é¡µ2, , , ], , //404 path: /404, component: () = import(@/views/404/index.vue), name: 404, meta: title: 404, , ,] çˆ¶ç»„ä»¶è·å–è·¯ç”±ä¿¡æ¯å¹¶ä¼ é€’ç»™å­ç»„ä»¶ src\\layout\\index.vue template div class=layout_container !-- å·¦ä¾§èœå• -- div class=layout_slider !-- logo -- Logo/Logo !-- æ»šåŠ¨ç»„ä»¶ -- el-scrollbar class=scrollbar el-menu background-color=#001529 text-color=white // ä¼ é€’è·¯ç”±æ•°æ® Menu :menuList=userStore.menuRoutes/Menu /el-menu /el-scrollbar /div !-- é¡¶éƒ¨å¯¼èˆª -- div class=layout_tabbar/div !-- å†…å®¹å±•ç¤ºåŒºåŸŸ -- div class=layout_main p style=height: 1000000px/p /div /div/templatescript setup lang=tsimport Logo from ./logo/index.vueimport Menu from ./menu/index.vueimport useUserStore from @/store/modules/user// è·å–ç”¨æˆ·ä»“åº“const userStore = useUserStore()/script å­ç»„ä»¶æ ¹æ®è·¯ç”±æ•°æ®åŠ¨æ€åˆ›å»ºèœå• src\\layout\\menu\\index.vue template template v-for=item in menuList :key=item.path !-- æ²¡æœ‰å­è·¯ç”± -- el-menu-item v-if=!item.children :index=item.path template #title spanæ ‡/span span item.meta.title /span /template /el-menu-item !-- æœ‰å­è·¯ç”±ä½†åªæœ‰ä¸€ä¸ªå­è·¯ç”± -- el-menu-item v-if=item.children item.children.length === 1 :index=item.children[0].path template #title spanæ ‡/span span item.children[0].meta.title /span /template /el-menu-item !-- æœ‰å­è·¯ç”±ä¸”ä¸ªæ•°å¤§äºä¸€ä¸ª -- el-sub-menu :index=item.path v-if=item.children item.children.length = 2 template #title span item.meta.title /span /template !-- é€’å½’åˆ›å»ºèœå• -- Menu :menuList=item.children/Menu /el-sub-menu /template/templatescript setup lang=ts//è·å–çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„å…¨éƒ¨è·¯ç”±æ•°ç»„defineProps([menuList])/scriptscript lang=tsexport default // eslint-disable-next-line vue/no-reserved-component-names name: Menu,/scriptstyle lang=scss scoped/style æ³¨æ„ï¼šå½“å­è·¯ç”±ä¸ªæ•°å¤§äºç­‰äºä¸€ä¸ªæ—¶ï¼Œå¹¶ä¸”æˆ–è®¸å­è·¯ç”±è¿˜æœ‰åä»£è·¯ç”±æ—¶ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†é€’å½’ç»„ä»¶ã€‚é€’å½’ç»„ä»¶éœ€è¦å‘½åï¼ˆå¦å¤–ä½¿ç”¨ä¸€ä¸ªscriptæ ‡ç­¾ï¼Œvue2æ ¼å¼ï¼‰ã€‚ èœå•éšè— æ·»åŠ metaä¿¡æ¯ src\\router\\router.ts // å¯¹å¤–æš´éœ²é…ç½®è·¯ç”±(å¸¸é‡è·¯ç”±)export const constantRoute = [ //ç™»å½• path: /login, component: () = import(@/views/login/index.vue), name: login, meta: title: ç™»å½•, //èœå•æ ‡é¢˜ hidden: true, //ä»£è¡¨è·¯ç”±æ ‡é¢˜åœ¨èœå•ä¸­æ˜¯å¦éšè— true:éšè— false:ä¸éšè— , , //ç™»å½•æˆåŠŸä»¥åå±•ç¤ºæ•°æ®çš„è·¯ç”± path: /, component: () = import(@/layout/index.vue), name: layout, meta: title: layout, hidden: false, , redirect: /home, children: [ path: /home, component: () = import(@/views/home/index.vue), meta: title: é¦–é¡µ, hidden: false, , , path: /home2, component: () = import(@/views/home/index.vue), meta: title: é¦–é¡µ2, hidden: false, icon: HomeFilled, , , ], , //404 path: /404, component: () = import(@/views/404/index.vue), name: 404, meta: title: 404, hidden: true, , ,] ä¸ºæ–¹ä¾¿åˆ¤æ–­ä¿®æ”¹menuç»„ä»¶ src\\layout\\menu\\index.vue template template v-for=item in menuList :key=item.path !-- æ²¡æœ‰å­è·¯ç”± -- template v-if=!item.children el-menu-item v-if=!item.meta.hidden :index=item.path template #title spanæ ‡/span span item.meta.title /span /template /el-menu-item /template !-- æœ‰å­è·¯ç”±ä½†åªæœ‰ä¸€ä¸ªå­è·¯ç”± -- template v-if=item.children item.children.length === 1 el-menu-item v-if=!item.children[0].meta.hidden :index=item.children[0].path template #title spanæ ‡/span span item.children[0].meta.title /span /template /el-menu-item /template !-- æœ‰å­è·¯ç”±ä¸”ä¸ªæ•°å¤§äºä¸€ä¸ª -- el-sub-menu v-if=item.children item.children.length = 2 :index=item.path template #title span item.meta.title /span /template !-- é€’å½’åˆ›å»ºèœå• -- Menu :menuList=item.children/Menu /el-sub-menu /template/templatescript setup lang=ts//è·å–çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„å…¨éƒ¨è·¯ç”±æ•°ç»„defineProps([menuList])/scriptscript lang=tsexport default // eslint-disable-next-line vue/no-reserved-component-names name: Menu,/scriptstyle lang=scss scoped/style æ·»åŠ èœå•å›¾æ ‡ æ³¨å†Œå›¾æ ‡ç»„ä»¶ src\\components\\index.ts import SvgIcon from ./SvgIcon/index.vueimport type App, Component from vue//å¼•å…¥element-plusæä¾›å…¨éƒ¨å›¾æ ‡ç»„ä»¶import * as ElementPlusIconsVue from @element-plus/icons-vueconst components: [name: string]: Component = SvgIcon //å¯¹å¤–æš´éœ²æ’ä»¶å¯¹è±¡export default //åŠ¡å¿…å«åšinstallæ–¹æ³• install(app: App) //æ³¨å†Œé¡¹ç›®å…¨éƒ¨çš„å…¨å±€ç»„ä»¶ Object.keys(components).forEach((key) = //æ³¨å†Œä¸ºå…¨å±€ç»„ä»¶ app.component(key, components[key]) ) //å°†element-plusæä¾›å…¨éƒ¨å›¾æ ‡æ³¨å†Œä¸ºå…¨å±€ç»„ä»¶ for (const [key, component] of Object.entries(ElementPlusIconsVue)) app.component(key, component) , æ·»åŠ metaä¿¡æ¯ https://element-plus.org/zh-CN/component/icon.html src\\router\\router.ts // å¯¹å¤–æš´éœ²é…ç½®è·¯ç”±(å¸¸é‡è·¯ç”±)export const constantRoute = [ //ç™»å½• path: /login, component: () = import(@/views/login/index.vue), name: login, meta: title: ç™»å½•, //èœå•æ ‡é¢˜ hidden: false, //ä»£è¡¨è·¯ç”±æ ‡é¢˜åœ¨èœå•ä¸­æ˜¯å¦éšè— true:éšè— false:ä¸éšè— icon: Promotion, //èœå•æ–‡å­—å·¦ä¾§çš„å›¾æ ‡,æ”¯æŒelement-pluså…¨éƒ¨å›¾æ ‡ , , //ç™»å½•æˆåŠŸä»¥åå±•ç¤ºæ•°æ®çš„è·¯ç”± path: /, component: () = import(@/layout/index.vue), name: layout, meta: title: , hidden: false, icon: , , redirect: /home, children: [ path: /home, component: () = import(@/views/home/index.vue), meta: title: é¦–é¡µ, hidden: false, icon: HomeFilled, , , ], , //404 path: /404, component: () = import(@/views/404/index.vue), name: 404, meta: title: 404, hidden: false, icon: DocumentDelete, , ,] ä¿®æ”¹menuç»„ä»¶ src\\layout\\menu\\index.vue template template v-for=item in menuList :key=item.path !--æ²¡æœ‰å­è·¯ç”±-- template v-if=!item.children el-menu-item :index=item.path v-if=!item.meta.hidden !-- å›¾æ ‡ -- el-icon component :is=item.meta.icon/component /el-icon template #title span item.meta.title /span /template /el-menu-item /template !-- æœ‰å­è·¯ç”±ä½†æ˜¯åªæœ‰ä¸€ä¸ªå­è·¯ç”± -- template v-if=item.children item.children.length == 1 el-menu-item :index=item.children[0].path v-if=!item.children[0].meta.hidden !-- å›¾æ ‡ -- el-icon component :is=item.children[0].meta.icon/component /el-icon template #title span item.children[0].meta.title /span /template /el-menu-item /template !-- æœ‰å­è·¯ç”±ä¸”ä¸ªæ•°å¤§äºä¸€ä¸ª1 -- el-sub-menu :index=item.path v-if=item.children item.children.length 1 template #title !-- å›¾æ ‡ -- el-icon component :is=item.meta.icon/component /el-icon span item.meta.title /span /template Menu :menuList=item.children/Menu /el-sub-menu /template/templatescript setup lang=ts//è·å–çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„å…¨éƒ¨è·¯ç”±æ•°ç»„defineProps([menuList])/scriptscript lang=tsexport default // eslint-disable-next-line vue/no-reserved-component-names name: Menu,/scriptstyle lang=scss scoped/style è·¯ç”±è·³è½¬ ç‚¹å‡»èœå•æ—¶éœ€è¦è·³è½¬è‡³å¯¹åº”è·¯ç”±ç•Œé¢ï¼Œ@click=goRoute(item.path) template template v-for=item in menuList :key=item.path !--æ²¡æœ‰å­è·¯ç”±-- template v-if=!item.children el-menu-item :index=item.path v-if=!item.meta.hidden @click=goRoute(item.path) el-icon !-- å›¾æ ‡ -- component :is=item.meta.icon/component /el-icon template #title span item.meta.title /span /template /el-menu-item /template !-- æœ‰å­è·¯ç”±ä½†æ˜¯åªæœ‰ä¸€ä¸ªå­è·¯ç”± -- template v-if=item.children item.children.length == 1 el-menu-item :index=item.children[0].path v-if=!item.children[0].meta.hidden @click=goRoute(item.children[0].path) el-icon component :is=item.children[0].meta.icon/component /el-icon template #title span item.children[0].meta.title /span /template /el-menu-item /template !-- æœ‰å­è·¯ç”±ä¸”ä¸ªæ•°å¤§äºä¸€ä¸ª1 -- el-sub-menu :index=item.path v-if=item.children item.children.length 1 template #title el-icon component :is=item.meta.icon/component /el-icon span item.meta.title /span /template Menu :menuList=item.children/Menu /el-sub-menu /template/templatescript setup lang=tsimport useRouter from vue-router// è·å–çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„å…¨éƒ¨è·¯ç”±æ•°ç»„defineProps([menuList])const route = useRouter()// æ ¹æ®è·¯ç”±è·¯å¾„è·³è½¬const goRoute = (path: string) = route.push(path)/scriptscript lang=tsexport default // eslint-disable-next-line vue/no-reserved-component-names name: Menu,/scriptstyle lang=scss scoped/style 6.5 å°è£…Mainç»„ä»¶ å°è£…å†…å®¹å±•ç¤ºåŒºåŸŸç»„ä»¶ï¼Œæ·»åŠ è·¯ç”±è·³è½¬åŠ¨ç”» https://router.vuejs.org/zh/guide/advanced/transitions.html src\\layout\\main\\index.vue template !-- è·¯ç”±ç»„ä»¶å‡ºå£çš„ä½ç½® -- router-view v-slot= Component transition name=fade !-- æ¸²æŸ“layoutä¸€çº§è·¯ç”±çš„å­è·¯ç”± -- component :is=Component / /transition /router-view/templatescript setup lang=ts/scriptstyle lang=scss scoped.fade-enter-from opacity: 0;.fade-enter-active transition: all 0.3s;.fade-enter-to opacity: 1;/style ä¿®æ”¹layout src\\layout\\index.vue template div class=layout_container !-- å·¦ä¾§èœå• -- div class=layout_slider !-- logo -- Logo/Logo !-- æ»šåŠ¨ç»„ä»¶ -- el-scrollbar class=scrollbar el-menu background-color=#001529 text-color=white Menu :menuList=userStore.menuRoutes/Menu /el-menu /el-scrollbar /div !-- é¡¶éƒ¨å¯¼èˆª -- div class=layout_tabbar/div !-- å†…å®¹å±•ç¤ºåŒºåŸŸ -- div class=layout_main Main/Main /div /div/template 6.6 é…ç½®å…¨è·¯ç”± é…ç½®è·¯ç”± src\\router\\router.ts // å¯¹å¤–æš´éœ²é…ç½®è·¯ç”±(å¸¸é‡è·¯ç”±)export const constantRoute = [ //ç™»å½• path: /login, component: () = import(@/views/login/index.vue), name: login, meta: title: ç™»å½•, //èœå•æ ‡é¢˜ hidden: true, //ä»£è¡¨è·¯ç”±æ ‡é¢˜åœ¨èœå•ä¸­æ˜¯å¦éšè— true:éšè— false:ä¸éšè— icon: Promotion, //èœå•æ–‡å­—å·¦ä¾§çš„å›¾æ ‡,æ”¯æŒelement-pluså…¨éƒ¨å›¾æ ‡ , , //ç™»å½•æˆåŠŸä»¥åå±•ç¤ºæ•°æ®çš„è·¯ç”± path: /, component: () = import(@/layout/index.vue), name: layout, meta: title: , hidden: false, icon: , , redirect: /home, children: [ path: /home, component: () = import(@/views/home/index.vue), meta: title: é¦–é¡µ, hidden: false, icon: HomeFilled, , , ], , //404 path: /404, component: () = import(@/views/404/index.vue), name: 404, meta: title: 404, hidden: true, icon: DocumentDelete, , , path: /acl, component: () = import(@/layout/index.vue), name: Acl, meta: hidden: false, title: æƒé™ç®¡ç†, icon: Lock, , redirect: /acl/user, children: [ path: /acl/user, component: () = import(@/views/acl/user/index.vue), name: User, meta: hidden: false, title: ç”¨æˆ·ç®¡ç†, icon: User, , , path: /acl/role, component: () = import(@/views/acl/role/index.vue), name: Role, meta: hidden: false, title: è§’è‰²ç®¡ç†, icon: UserFilled, , , path: /acl/permission, component: () = import(@/views/acl/permission/index.vue), name: Permission, meta: hidden: false, title: èœå•ç®¡ç†, icon: Monitor, , , ], , path: /product, component: () = import(@/layout/index.vue), name: Product, meta: title: å•†å“ç®¡ç†, icon: Goods, , redirect: /product/trademark, children: [ path: /product/trademark, component: () = import(@/views/product/trademark/index.vue), name: Trademark, meta: title: å“ç‰Œç®¡ç†, icon: ShoppingCartFull, , , path: /product/attr, component: () = import(@/views/product/attr/index.vue), name: Attr, meta: title: å±æ€§ç®¡ç†, icon: ChromeFilled, , , path: /product/spu, component: () = import(@/views/product/spu/index.vue), name: Spu, meta: title: SPUç®¡ç†, icon: Calendar, , , path: /product/sku, component: () = import(@/views/product/sku/index.vue), name: Sku, meta: title: SKUç®¡ç†, icon: Orange, , , ], ,] åˆ›å»ºç›¸åº”ç»„ä»¶ 6.7 èœå•åˆ·æ–°å±•ç¤º é—®é¢˜ å½“é¡µé¢åˆ·æ–°æ—¶ï¼Œèœå•ä¼šè‡ªåŠ¨æ”¶èµ·ã€‚ä½¿ç”¨element-plusçš„default-active å¤„ç† å¤„ç† https://element-plus.org/zh-CN/component/menu.html#menu-attributes template div class=layout_container !-- å·¦ä¾§èœå• -- div class=layout_slider !-- logo -- Logo/Logo !-- æ»šåŠ¨ç»„ä»¶ -- el-scrollbar class=scrollbar el-menu background-color=#001529 text-color=white :default-active=route.path Menu :menuList=userStore.menuRoutes/Menu /el-menu /el-scrollbar /div !-- é¡¶éƒ¨å¯¼èˆª -- div class=layout_tabbar/div !-- å†…å®¹å±•ç¤ºåŒºåŸŸ -- div class=layout_main Main/Main /div /div/templatescript setup lang=tsimport Logo from ./logo/index.vueimport Menu from ./menu/index.vueimport useUserStore from @/store/modules/userimport Main from ./main/index.vueimport useRoute from vue-routerconst userStore = useUserStore()// è·å–è·¯ç”±const route = useRoute()/script 6.8 é¡¶éƒ¨tabbarç»„ä»¶ æ·»åŠ é™æ€ç•Œé¢ https://element-plus.org/zh-CN/component/breadcrumb.html https://element-plus.org/zh-CN/component/dropdown.html src\\layout\\tabbar\\index.vue template div class=tabbar div class=tabbar_left !-- é¡¶éƒ¨å·¦ä¾§çš„å›¾æ ‡ -- el-icon style=margin-right: 10px Expand/Expand /el-icon !-- å·¦ä¾§çš„é¢åŒ…å±‘ -- el-breadcrumb separator-icon=ArrowRight el-breadcrumb-itemæƒé™ç®¡ç†/el-breadcrumb-item el-breadcrumb-itemç”¨æˆ·ç®¡ç†/el-breadcrumb-item /el-breadcrumb /div div class=tabbar_right el-button size=small icon=Refresh circle/el-button el-button size=small icon=FullScreen circle/el-button el-button size=small icon=Setting circle/el-button img src=../../../public/logo.png style=width: 24px; height: 24px; margin: 0px 10px / !-- ä¸‹æ‹‰èœå• -- el-dropdown span class=el-dropdown-link admin el-icon class=el-icon--right arrow-down / /el-icon /span template #dropdown el-dropdown-menu el-dropdown-itemé€€å‡ºç™»é™†/el-dropdown-item /el-dropdown-menu /template /el-dropdown /div /div/templatescript setup lang=ts/scriptstyle lang=scss scoped.tabbar width: 100%; height: 100%; display: flex; justify-content: space-between; background-image: linear-gradient( to right, rgb(236, 229, 229), rgb(151, 136, 136), rgb(240, 234, 234) ); .tabbar_left display: flex; align-items: center; margin-left: 20px; .tabbar_right display: flex; align-items: center; /style æ‹†åˆ†ç»„ä»¶ src\\layout\\tabbar\\breadcrumb\\index.vue template !-- é¡¶éƒ¨å·¦ä¾§çš„å›¾æ ‡ -- el-icon style=margin-right: 10px Expand/Expand /el-icon !-- å·¦ä¾§çš„é¢åŒ…å±‘ -- el-breadcrumb separator-icon=ArrowRight el-breadcrumb-itemæƒé™æŒ‚å†/el-breadcrumb-item el-breadcrumb-itemç”¨æˆ·ç®¡ç†/el-breadcrumb-item /el-breadcrumb/templatescript setup lang=ts/scriptstyle lang=scss scoped/style src\\layout\\tabbar\\setting\\index.vue template el-button size=small icon=Refresh circle/el-button el-button size=small icon=FullScreen circle/el-button el-button size=small icon=Setting circle/el-button img src=../../../../public/logo.png style=width: 24px; height: 24px; margin: 0px 10px / !-- ä¸‹æ‹‰èœå• -- el-dropdown span class=el-dropdown-link admin el-icon class=el-icon--right arrow-down / /el-icon /span template #dropdown el-dropdown-menu el-dropdown-itemé€€å‡ºç™»é™†/el-dropdown-item /el-dropdown-menu /template /el-dropdown/templatescript setup lang=ts/scriptstyle lang=scss scoped/style src\\layout\\tabbar\\index.vue template div class=tabbar div class=tabbar_left Breadcrumb/Breadcrumb /div div class=tabbar_right Setting/Setting /div /div/templatescript setup lang=tsimport Breadcrumb from ./breadcrumb/index.vueimport Setting from ./setting/index.vue/script 6.9 èœå•æŠ˜å  ä¿®æ”¹æŠ˜å å›¾æ ‡ æ·»åŠ ç‚¹å‡»äº‹ä»¶æ ¹æ®æŠ˜å çŠ¶æ€åˆ¤æ–­ï¼Œå±•ç¤ºä¸åŒå›¾æ ‡ https://cn.vuejs.org/guide/essentials/component-basics.html#dynamic-components src\\layout\\tabbar\\breadcrumb\\index.vue template !-- é¡¶éƒ¨å·¦ä¾§çš„å›¾æ ‡ -- el-icon style=margin-right: 10px @click=changeIcon !-- åŠ¨æ€åˆ‡æ¢å›¾æ ‡ -- component :is=settingStore.fold ? Fold : Expand/component /el-icon !-- å·¦ä¾§çš„é¢åŒ…å±‘ -- el-breadcrumb separator-icon=ArrowRight el-breadcrumb-itemæƒé™ç®¡ç†/el-breadcrumb-item el-breadcrumb-itemç”¨æˆ·ç®¡ç†/el-breadcrumb-item /el-breadcrumb/templatescript setup lang=tsimport useSettingStore from @/store/modules/setting//è·å–layouté…ç½®ç›¸å…³çš„ä»“åº“let settingStore = useSettingStore()const changeIcon = () = console.log(settingStore.fold) settingStore.fold = !settingStore.fold/scriptstyle lang=scss scoped/style å› ä¸ºæ•´ä¸ªå·¦ä¾§æ ã€é¡¶éƒ¨tabbaræ å’Œmainç•Œé¢éƒ½å—åˆ°æŠ˜å æ•ˆæœå½±å“ï¼Œæ‰€ä»¥å°†æŠ˜å çŠ¶æ€å­˜å…¥pinia æ–°å»ºsettingä»“åº“ src\\store\\modules\\setting.ts //å°ä»“åº“ï¼šlayoutç»„ä»¶ç›¸å…³é…ç½®ä»“åº“import defineStore from piniaconst useSettingStore = defineStore(SettingStore, state: () = return fold: false, //ç”¨æˆ·æ§åˆ¶èœå•æŠ˜å è¿˜æ˜¯æ”¶èµ·çš„æ§åˆ¶ ,)export default useSettingStore è”åŠ¨æ›´æ–°å·¦ä¾§èœå•æ  ç‚¹å‡»æŠ˜å æ—¶ï¼ŒåŠ¨æ€ä¿®æ”¹å·¦ä¾§èœå•æ å®½åº¦ã€‚ æ·»åŠ å…¨å±€å±æ€§ src\\styles\\variable.scss //å·¦ä¾§èœå•æœ€å°å®½åº¦$base-menu-min-width:50px; ç»‘å®šåŠ¨æ€å±æ€§ src\\layout\\index.vue template div class=layout_container !-- å·¦ä¾§èœå• -- div class=layout_slider :class= fold: settingStore.fold ? true : false /div /div/templatescript setup lang=tsimport useSettingStore from @/store/modules/settingconst settingStore = useSettingStore()/scriptstyle lang=scss scoped.layout_container width: 100%; height: 100vh; color: white; .layout_slider width: $base-menu-width; height: 100vh; background: $base-menu-background; transition: all 0.1s; // æ·»åŠ å·¦ä¾§èœå•æœ€å°å®½åº¦ .fold width: $base-menu-min-width; .scrollbar width: 100%; height: calc(100vh - $base-menu-logo-height); .el-menu border-right: 0; /style å·¦ä¾§èœå•æ ä¿®æ”¹æŠ˜å çŠ¶æ€ï¼šcollapse https://element-plus.org/zh-CN/component/menu.html#menu-attributes src\\layout\\index.vue template div class=layout_container !-- å·¦ä¾§èœå• -- div class=layout_slider :class= fold: settingStore.fold ? true : false !-- logo -- Logo/Logo !-- æ»šåŠ¨ç»„ä»¶ -- el-scrollbar class=scrollbar el-menu background-color=#001529 text-color=white :default-active=route.path :collapse=settingStore.fold Menu :menuList=userStore.menuRoutes/Menu /el-menu /el-scrollbar /div /div/template è”åŠ¨æ›´æ–°tabbar template div class=layout_container !-- é¡¶éƒ¨å¯¼èˆª -- div class=layout_tabbar :class= fold: settingStore.fold ? true : false Tabbar/Tabbar /div /div/templatescript setup lang=tsimport useSettingStore from @/store/modules/setting const settingStore = useSettingStore()/scriptstyle lang=scss scoped .layout_tabbar position: fixed; width: calc(100% - $base-menu-width); height: $base-tabbar-height; background: cyan; top: 0; left: $base-menu-width; transition: all 0.1s; .fold // å®½åº¦ = ç•Œé¢å®½åº¦ - æŠ˜å åèœå•æ æ‰€å å®½åº¦ width: calc(100vw - $base-menu-min-width); // è·ç¦»æŠ˜å åèœå•æ å®½åº¦ left: $base-menu-min-width; /style è”åŠ¨æ›´æ–°main template div class=layout_container !-- å†…å®¹å±•ç¤ºåŒºåŸŸ -- div class=layout_main :class= fold: settingStore.fold ? true : false Main/Main /div /div/templatescript setup lang=tsimport useSettingStore from @/store/modules/settingconst settingStore = useSettingStore()/scriptstyle lang=scss scoped .layout_main position: absolute; width: calc(100% - $base-menu-width); height: calc(100vh - $base-tabbar-height); background-color: yellowgreen; left: $base-menu-width; top: $base-tabbar-height; padding: 20px; overflow: auto; transition: all 0.1s; .fold width: calc(100vw - $base-menu-min-width); left: $base-menu-min-width; /style 6.10 åŠ¨æ€æ›´æ–°é¢åŒ…å±‘ è·å–è·¯ç”± ä½¿ç”¨route.matchedå‡½æ•°ï¼Œæ­¤å‡½æ•°èƒ½å¾—åˆ°å½“å‰è·¯ç”±çš„ä¿¡æ¯ ä¿®æ”¹ç•Œé¢ src\\layout\\tabbar\\breadcrumb\\index.vue template !-- å·¦ä¾§çš„é¢åŒ…å±‘ -- el-breadcrumb separator-icon=ArrowRight el-breadcrumb-item v-for=(item, index) in route.matched :key=index v-show=item.meta.title :to=item.path item.meta.title /el-breadcrumb-item /el-breadcrumb/templatescript setup lang=tsimport useSettingStore from @/store/modules/settingimport useRoute from vue-router// è·å–layouté…ç½®ç›¸å…³çš„ä»“åº“let settingStore = useSettingStore()// è·¯ç”±const route = useRoute()const changeIcon = () = console.log(settingStore.fold) settingStore.fold = !settingStore.fold/scriptstyle lang=scss scoped/style v-showæ§åˆ¶æ— æ ‡é¢˜æ—¶ä¸æ˜¾ç¤º è®¾ç½®ç‚¹å‡»æƒé™ç®¡ç†æ—¶è‡ªåŠ¨è·³è½¬åˆ°ç”¨æˆ·ç®¡ç† src\\router\\router.ts path: /acl, component: () = import(@/layout/index.vue), name: Acl, meta: hidden: false, title: æƒé™ç®¡ç†, icon: Lock, , redirect: /acl/user, 6.11 åˆ·æ–°åŠŸèƒ½å®ç° åœ¨settingä»“åº“æ·»åŠ refreshå±æ€§ src\\store\\modules\\setting.ts //å°ä»“åº“ï¼šlayoutç»„ä»¶ç›¸å…³é…ç½®ä»“åº“import defineStore from piniaconst useSettingStore = defineStore(SettingStore, state: () = return fold: false, //ç”¨æˆ·æ§åˆ¶èœå•æŠ˜å è¿˜æ˜¯æ”¶èµ·çš„æ§åˆ¶ refresh: false, //ç”¨äºæ§åˆ¶åˆ·æ–°æ•ˆæœ ,)export default useSettingStore åœ¨setting.vueç»„ä»¶ä¸­é…ç½®åˆ·æ–°æŒ‰é’®ç‚¹å‡»äº‹ä»¶ src\\layout\\tabbar\\setting\\index.vue template el-button size=small icon=Refresh circle @click=updateRefresh /el-button/templatescript setup lang=tsimport useSettingStore from @/store/modules/settingconst settingStore = useSettingStore()const updateRefresh = () = settingStore.refresh = !settingStore.refresh/scriptstyle lang=scss scoped/style åœ¨mainç»„ä»¶ä¸­ç›‘å¬æŒ‰é’®çŠ¶æ€å€¼ï¼ŒçŠ¶æ€å€¼å˜åŒ–å°±é‡å»ºè·¯ç”±ç»„ä»¶ src\\layout\\main\\index.vue template !-- è·¯ç”±ç»„ä»¶å‡ºå£çš„ä½ç½® -- router-view v-slot= Component transition name=fade div v-if=flag !-- æ¸²æŸ“layoutä¸€çº§è·¯ç”±çš„å­è·¯ç”± -- component :is=Component / /div /transition /router-view/templatescript setup lang=tsimport ref, watch, nextTick from vueimport useSettingStore from @/store/modules/settingconst settingStore = useSettingStore()//æ§åˆ¶å½“å‰ç»„ä»¶æ˜¯å¦é”€æ¯é‡å»ºlet flag = ref(true)//ç›‘å¬ä»“åº“å†…éƒ¨çš„æ•°æ®æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœå‘ç”Ÿå˜åŒ–ï¼Œè¯´æ˜ç”¨æˆ·ç‚¹å‡»è¿‡åˆ·æ–°æŒ‰é’®watch( () = settingStore.refresh, () = //ç‚¹å‡»åˆ·æ–°æŒ‰é’®ï¼šè·¯ç”±ç»„ä»¶é”€æ¯ flag.value = false // å¼‚æ­¥åˆ·æ–°ï¼Œvueé‡å»ºDOMåä¼šè°ƒç”¨è¯¥æ–¹æ³• // https://lianyutian.github.io/posts/dd58b23f.html 9.5ç« èŠ‚ nextTick(() = flag.value = true ) ,)/script 6.12 å…¨å±åŠŸèƒ½å®ç° ç»‘å®šå…¨å±æŒ‰é’®ç‚¹å‡»äº‹ä»¶ src\\layout\\tabbar\\setting\\index.vue template el-button size=small icon=FullScreen circle @click=fullScreen /el-buttonscript setup lang=ts// å…¨å±åŠŸèƒ½const fullScreen = () = // DOMå¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼šå¯ä»¥ç”¨æ¥åˆ¤æ–­å½“å‰æ˜¯ä¸æ˜¯å…¨å±çš„æ¨¡å¼ã€å…¨å±ï¼štrueï¼Œä¸æ˜¯å…¨å±ï¼šfalseã€‘ let full = document.fullscreenElement // åˆ‡æ¢æˆå…¨å± if (!full) // æ–‡æ¡£æ ¹èŠ‚ç‚¹çš„æ–¹æ³•requestFullscreenå®ç°å…¨å± document.documentElement.requestFullscreen() else // é€€å‡ºå…¨å± document.exitFullscreen() /scriptstyle lang=scss scoped/style 7. ç™»å½•åŠŸèƒ½å®Œå–„7.1 è·å–ç”¨æˆ·ä¿¡æ¯ æ·»åŠ ç”¨æˆ·stateå­˜å‚¨ç±»å‹å’Œå±æ€§ src\\store\\modules\\type\\type.ts import RouteRecordRaw from vue-routerexport interface UserState token: string | null menuRoutes: RouteRecordRaw[] username: string avatar: string src\\store\\modules\\user.ts // åˆ›å»ºç”¨æˆ·å°ä»“åº“const useUserStore = defineStore(UserStore, // ç”¨æˆ·ä»“åº“å­˜å‚¨æ•°æ®åœ°æ–¹ state(): UserState return token: GET_TOKEN(), menuRoutes: constantRoute, username: , avatar: , // ç”¨æˆ·å¤´åƒ , æ·»åŠ è·å–ä¿¡æ¯æ–¹æ³• userInfoAction src\\store\\modules\\user.ts // src/store/modules/user.ts// åˆ›å»ºç”¨æˆ·ç›¸å…³çš„ä»“åº“import defineStore from piniaimport loginForm, loginResponseData from @/api/user/typeimport reqLogin, reqUserInfo from @/api/userimport GET_TOKEN, SET_TOKEN from @/utils/tokenimport UserState from ./type/typeimport constantRoute from @/router/router// åˆ›å»ºç”¨æˆ·å°ä»“åº“const useUserStore = defineStore(UserStore, // ç”¨æˆ·ä»“åº“å­˜å‚¨æ•°æ®åœ°æ–¹ state(): UserState return token: GET_TOKEN(), menuRoutes: constantRoute, username: , avatar: , , // å¤„ç†å¼‚æ­¥|é€»è¾‘åœ°æ–¹ actions: // è·å–ç”¨æˆ·ä¿¡æ¯ async userInfoAction() const result = await reqUserInfo() if (result.code === 200) this.username = result.data.checkUser.username this.avatar = result.data.checkUser.avatar , , getters: ,)// å¯¹å¤–æš´éœ²å°ä»“åº“export default useUserStore ä¿®æ”¹è¯·æ±‚æºå¸¦tokenä¿¡æ¯ æ­¤å‰è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæœªæºå¸¦tokenä¼šè·å–ä¸åˆ°ç”¨æˆ·ä¿¡æ¯ src\\utils\\request.ts import axios from axiosimport ElMessage from element-plusimport useUserStore from @/store/modules/user//åˆ›å»ºaxioså®ä¾‹const request = axios.create( baseURL: import.meta.env.VITE_APP_BASE_API, timeout: 5000,)//è¯·æ±‚æ‹¦æˆªå™¨request.interceptors.request.use((config) = //è·å–ç”¨æˆ·ç›¸å…³çš„å°ä»“åº“ï¼Œè·å–tokenï¼Œç™»å½•æˆåŠŸä»¥åæºå¸¦ä¸ªiæœåŠ¡å™¨ const userStore = useUserStore() if (userStore.token) config.headers.token = userStore.token //configé…ç½®å¯¹è±¡ï¼Œheadersè¯·æ±‚å¤´ï¼Œç»å¸¸ç»™æœåŠ¡å™¨ç«¯æºå¸¦å…¬å…±å‚æ•° //è¿”å›é…ç½®å¯¹è±¡ return config) homeç»„ä»¶æŒ‚è½½è·å–ç”¨æˆ·ä¿¡æ¯ ç™»å½•ä¹‹åé¡µé¢ï¼ˆhomeï¼‰ä¸Šæ¥å°±è¦è·å–ç”¨æˆ·ä¿¡æ¯ã€‚å¹¶ä¸”å°†å®ƒä½¿ç”¨åˆ°é¡µé¢ä¸­ src\\views\\home\\index.vue template divä¸€çº§è·¯ç”±home/div/templatescript setup lang=tsimport onMounted from vueimport useUserStore from @/store/modules/userconst userStore = useUserStore()onMounted(() = userStore.userInfoAction())/script ä¿®æ”¹è®¾ç½®ç»„ä»¶ä¸­çš„ç”¨æˆ·ä¿¡æ¯ src\\layout\\tabbar\\setting\\index.vue template img :src=userStore.avatar style=width: 24px; height: 24px; margin: 0px 10px / !-- ä¸‹æ‹‰èœå• -- el-dropdown span class=el-dropdown-link userStore.username el-icon class=el-icon--right arrow-down / /el-icon /span template #dropdown el-dropdown-menu el-dropdown-itemé€€å‡ºç™»é™†/el-dropdown-item /el-dropdown-menu /template /el-dropdown/templatescript setup lang=tsimport useSettingStore from @/store/modules/settingimport useUserStore from @/store/modules/userimport useStore from element-plus/es/components/table/src/store/index.mjsconst userStore = useUserStore()/script 7.2 é€€å‡ºç™»å½• ç»‘å®šé€€å‡ºç™»å½•æŒ‰é’®ç‚¹å‡»äº‹ä»¶ src\\layout\\tabbar\\setting\\index.vue template !-- ä¸‹æ‹‰èœå• -- el-dropdown template #dropdown el-dropdown-menu el-dropdown-item @click=logouté€€å‡ºç™»é™†/el-dropdown-item /el-dropdown-menu /template /el-dropdown/templatescript setup lang=tsimport useSettingStore from @/store/modules/settingimport useUserStore from @/store/modules/userimport useRouter, useRoute from vue-routerconst userStore = useUserStore()// é€€å‡ºç™»å½•const router = useRouter()const route = useRoute()const logout = () = //ç¬¬ä¸€ä»¶äº‹ï¼šéœ€è¦é¡¹æœåŠ¡å™¨å‘è¯·æ±‚ã€é€€å‡ºç™»å½•æ¥å£ã€‘ï¼ˆæˆ‘ä»¬è¿™é‡Œæ²¡æœ‰ï¼‰ //ç¬¬äºŒä»¶äº‹ï¼šä»“åº“å½“ä¸­å’Œå…³äºç”¨æˆ·çš„ç›¸å…³çš„æ•°æ®æ¸…ç©º userStore.userLogoutAction() //ç¬¬ä¸‰ä»¶äº‹ï¼šè·³è½¬åˆ°ç™»é™†é¡µé¢ router.push( path: /login, query: redirect: route.path )/script æºå¸¦çš„queryå‚æ•°æ–¹ä¾¿ä¸‹æ¬¡ç™»é™†æ—¶ç›´æ¥è·³è½¬åˆ°å½“æ—¶æ¨å‡ºçš„ç•Œé¢ æ¸…ç©ºç”¨æˆ·ä¿¡æ¯ src\\store\\modules\\user.ts // src/store/modules/user.ts// åˆ›å»ºç”¨æˆ·ç›¸å…³çš„ä»“åº“import defineStore from piniaimport loginForm, loginResponseData from @/api/user/typeimport reqLogin, reqUserInfo from @/api/userimport GET_TOKEN, SET_TOKEN, REMOVE_TOKEN from @/utils/tokenimport UserState from ./type/typeimport constantRoute from @/router/router// åˆ›å»ºç”¨æˆ·å°ä»“åº“const useUserStore = defineStore(UserStore, // ç”¨æˆ·ä»“åº“å­˜å‚¨æ•°æ®åœ°æ–¹ state(): UserState return token: GET_TOKEN(), menuRoutes: constantRoute, username: , avatar: , // ç”¨æˆ·å¤´åƒ , // å¤„ç†å¼‚æ­¥|é€»è¾‘åœ°æ–¹ actions: // é€€å‡ºç™»å½• userLogoutAction() //å½“å‰æ²¡æœ‰mockæ¥å£ï¼ˆä¸åšï¼‰ï¼šæœåŠ¡å™¨æ•°æ®tokenå¤±æ•ˆ //æœ¬åœ°æ•°æ®æ¸…ç©º this.token = this.username = this.avatar = REMOVE_TOKEN() , , getters: ,)// å¯¹å¤–æš´éœ²å°ä»“åº“export default useUserStore æ·»åŠ æ¸…é™¤tokenæ–¹æ³• src\\utils\\token.ts export const REMOVE_TOKEN = () = localStorage.removeItem(TOKEN) ç™»å½•æ—¶åˆ¤æ–­æ˜¯å¦æœ‰queryå‚æ•° src\\views\\login\\index.vue script setup lang=tsconst router = useRouter()const route = useRoute()let userStore = useUserStore()// ç™»å½•const login = async () = //ä¿è¯å…¨éƒ¨è¡¨å•é¡¹æ ¡éªŒé€šè¿‡ await loginFormRef.value.validate() loadType.value = true try await userStore.userLoginAction(loginForm) //ç¼–ç¨‹å¼å¯¼èˆªè·³è½¬åˆ°å±•ç¤ºæ•°æ®é¦–é¡µ //åˆ¤æ–­ç™»å½•çš„æ—¶å€™,è·¯ç”±è·¯å¾„å½“ä¸­æ˜¯å¦æœ‰queryå‚æ•°ï¼Œå¦‚æœæœ‰å°±å¾€queryå‚æ•°æŒ‘æˆ˜ï¼Œæ²¡æœ‰è·³è½¬åˆ°é¦–é¡µ let redirect: any = route.query.redirect router.push( path: redirect || / ) ElNotification( type: success, message: æ¬¢è¿å›æ¥, title: `HI,$getTime()å¥½`, ) loadType.value = false catch (error) loadType.value = false ElNotification( type: error, message: (error as Error).message, ) /script æ­¤æ—¶ä¸åœ¨é¦–é¡µç•Œé¢é€€å‡ºç™»å½•ä¼šæœ‰ç™»å½•åå†ç™»å½•è·å–ä¸åˆ°ç”¨æˆ·ä¿¡æ¯çš„bugï¼Œåé¢ä¿®å¤ 7.3 è·¯ç”±é‰´æƒ å®‰è£…è¿›åº¦æ¡ç»„ä»¶ pnpm i nprogress æ–°å»ºpermisstion.ts src\\permisstion.ts //è·¯ç”±é‰´æƒï¼šé‰´æƒï¼šé¡¹ç›®å½“ä¸­è·¯ç”±èƒ½ä¸èƒ½è¢«è®¿é—®çš„æƒé™import router from @/routerimport setting from ./settingimport nprogress from nprogress//å¼•å…¥è¿›åº¦æ¡æ ·å¼import nprogress/nprogress.css//è¿›åº¦æ¡çš„åŠ è½½åœ†åœˆä¸è¦nprogress.configure( showSpinner: false )//è·å–ç”¨æˆ·ç›¸å…³çš„å°ä»“åº“å†…éƒ¨tokenæ•°æ®ï¼Œå»åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»é™†æˆåŠŸimport useUserStore from @/store/modules/user//ä¸ºä»€ä¹ˆè¦å¼•piniaimport pinia from ./storeconst userStore = useUserStore(pinia)//å…¨å±€å‰ç½®å®ˆå«router.beforeEach(async (to: any, from: any, next: any) = //ç½‘é¡µçš„åå­— document.title = `$setting.title-$to.meta.title` //è®¿é—®æŸä¸€ä¸ªè·¯ç”±ä¹‹å‰çš„å®ˆå« nprogress.start() //è·å–tokenï¼Œå»åˆ¤æ–­ç”¨æˆ·ç™»å½•ã€è¿˜æ˜¯æœªç™»å½• const token = userStore.token //è·å–ç”¨æˆ·åå­— const username = userStore.username //ç”¨æˆ·ç™»å½•åˆ¤æ–­ if (token) //ç™»é™†æˆåŠŸï¼Œè®¿é—®loginã€‚æŒ‡å‘é¦–é¡µ if (to.path == /login) next(/home) else //ç™»é™†æˆåŠŸè®¿é—®å…¶ä½™çš„ï¼Œæ”¾è¡Œ //æœ‰ç”¨æˆ·ä¿¡æ¯ if (username) //æ”¾è¡Œ next() else //å¦‚æœæ²¡æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œåœ¨æ”¶å°¾è¿™é‡Œå‘è¯·æ±‚è·å–åˆ°äº†ç”¨æˆ·ä¿¡æ¯å†æ”¾è¡Œ try //è·å–ç”¨æˆ·ä¿¡æ¯ await userStore.userInfoAction() next() catch (error) //tokenè¿‡æœŸ|ç”¨æˆ·æ‰‹åŠ¨å¤„ç†token //é€€å‡ºç™»é™†-ç”¨æˆ·ç›¸å…³çš„æ•°æ®æ¸…ç©º userStore.userLogoutAction() next( path: /login, query: redirect: to.path ) else //ç”¨æˆ·æœªç™»å½• if (to.path == /login) next() else next( path: /login, query: redirect: to.path ) next())//å…¨å±€åç½®å®ˆå«router.afterEach((to: any, from: any) = // to and from are both route objects. nprogress.done())//ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šä»»æ„è·¯ç”±åˆ‡æ¢å®ç°è¿›åº¦æ¡ä¸šåŠ¡ ----nprogress//ç¬¬äºŒä¸ªé—®é¢˜ï¼šè·¯ç”±é‰´æƒ//å…¨éƒ¨è·¯ç”±ç»„ä»¶ ï¼šç™»å½•|404|ä»»æ„è·¯ç”±|é¦–é¡µ|æƒé™ç®¡ç†ï¼ˆä¸‰ä¸ªå­è·¯ç”±ï¼‰|//ç”¨æˆ·æœªç™»å½• ï¼šå¯ä»¥è®¿é—®login å…¶ä½™éƒ½ä¸è¡Œ//ç™»é™†æˆåŠŸï¼šä¸å¯ä»¥è®¿é—®login å…¶ä½™éƒ½å¯ä»¥ é—®é¢˜ï¼Ÿ ä¸å¼•å…¥piniaæ—¶ å…¨å±€è·¯ç”±å®ˆå«å°†è·å–ç”¨æˆ·ä¿¡æ¯çš„è¯·æ±‚æ”¾åœ¨äº†è·³è½¬ä¹‹å‰ã€‚å®ç°äº†åˆ·æ–°åç”¨æˆ·ä¿¡æ¯ä¸¢å¤±çš„åŠŸèƒ½ 7.4 æ›¿ä»£çœŸå®æ¥å£ ä¿®æ”¹æœåŠ¡å .env.development VITE_SERVE = http://sph-api.atguigu.cn .env.production VITE_SERVE = http://sph-api.atguigu.cn .env.test VITE_SERVE = http://sph-api.atguigu.cn ä»£ç†è·¨åŸŸ https://cn.vitejs.dev/config/server-options.html#server-proxy vite.config.ts // vite.config.tsimport defineConfig, loadEnv from viteexport default defineConfig(( command, mode ) = //è·å–å„ç§ç¯å¢ƒä¸‹çš„å¯¹åº”çš„å˜é‡ const env = loadEnv(mode, process.cwd()) return //ä»£ç†è·¨åŸŸ server: proxy: [env.VITE_APP_BASE_API]: //è·å–æ•°æ®æœåŠ¡å™¨åœ°å€çš„è®¾ç½® target: env.VITE_SERVE, //éœ€è¦ä»£ç†è·¨åŸŸ changeOrigin: true, //è·¯å¾„é‡å†™ rewrite: (path) = path.replace(/^\\/api/, ), , [env.VITE_APP_BASE_API]: //è·å–æ•°æ®æœåŠ¡å™¨åœ°å€çš„è®¾ç½® target: env.VITE_SERVE, //éœ€è¦ä»£ç†è·¨åŸŸ changeOrigin: true, //è·¯å¾„é‡å†™ rewrite: (path) = path.replace(/^\\/api/, ), , , , ) æ ¹æ®æ¥å£æ–‡æ¡£é‡å†™æ•°æ®ç±»å‹ http://139.198.104.58:8212/swagger-ui.html#!/index45controller/loginUsingPOST src\\api\\user\\type.ts //ç™»å½•æ¥å£éœ€è¦æºå¸¦å‚æ•°ç±»å‹export interface loginFormData username: string password: string//å®šä¹‰å…¨éƒ¨æ¥å£è¿”å›æ•°æ®éƒ½æœ‰çš„æ•°æ®ç±»å‹export interface ResponseData code: number message: string ok: boolean//å®šä¹‰ç™»å½•æ¥å£è¿”å›æ•°æ®ç±»å‹export interface loginResponseData extends ResponseData data: string//å®šä¹‰è·å–ç”¨æˆ·ä¿¡æ¯è¿”å›çš„æ•°æ®ç±»å‹export interface userInfoResponseData extends ResponseData data: routes: string[] button: string[] roles: string[] name: string avatar: string ä¿®æ”¹ç™»å½•è¯·æ±‚æ•°æ®ç±»å‹ src\\api\\user\\index.ts // åŒä¸€ç®¡ç†ç”¨æˆ·ç›¸å…³çš„æ¥å£import request from @/utils/requestimport loginFormData, loginResponseData, userInfoResponseData from ./type// ç»Ÿä¸€ç®¡ç†APIenum API // LOGIN_URL = /user/login, // USERINFO_URL = user/info, LOGIN_URL = /admin/acl/index/login, USERINFO_URL = /admin/acl/index/info, LOGOUT_URL = /admin/acl/index/logout,// æš´éœ²è¯·æ±‚å‡½æ•°// ç™»å½•æ¥å£export const reqLogin = (data: loginFormData) = request.postany, loginResponseData(API.LOGIN_URL, data)// è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£export const reqUserInfo = () = request.getany, userInfoResponseData(API.USERINFO_URL) src\\store\\modules\\user.ts // src/store/modules/user.ts// åˆ›å»ºç”¨æˆ·ç›¸å…³çš„ä»“åº“import defineStore from piniaimport loginFormData, loginResponseData, userInfoResponseData, from @/api/user/typeimport reqLogin, reqUserInfo from @/api/userimport GET_TOKEN, SET_TOKEN, REMOVE_TOKEN from @/utils/tokenimport UserState from ./type/typeimport constantRoute from @/router/router// åˆ›å»ºç”¨æˆ·å°ä»“åº“const useUserStore = defineStore(UserStore, // ç”¨æˆ·ä»“åº“å­˜å‚¨æ•°æ®åœ°æ–¹ state(): UserState return token: GET_TOKEN(), menuRoutes: constantRoute, username: , avatar: , // ç”¨æˆ·å¤´åƒ , // å¤„ç†å¼‚æ­¥|é€»è¾‘åœ°æ–¹ actions: // ç”¨æˆ·ç™»å½• async userLoginAction(data: loginFormData) const result: loginResponseData = await reqLogin(data) if (result.code === 200) this.token = result.data as string //localStorage.setItem(TOKEN, this.token) SET_TOKEN(this.token) return OK else return Promise.reject(new Error(result.data)) , // è·å–ç”¨æˆ·ä¿¡æ¯ async userInfoAction() const result: userInfoResponseData = await reqUserInfo() if (result.code === 200) this.username = result.data.name this.avatar = result.data.avatar else return Promise.reject(new Error(result.message)) , // é€€å‡ºç™»å½• userLogoutAction() //å½“å‰æ²¡æœ‰mockæ¥å£ï¼ˆä¸åšï¼‰ï¼šæœåŠ¡å™¨æ•°æ®tokenå¤±æ•ˆ //æœ¬åœ°æ•°æ®æ¸…ç©º this.token = this.username = this.avatar = REMOVE_TOKEN() , , getters: ,)// å¯¹å¤–æš´éœ²å°ä»“åº“export default useUserStore 7.5 é€€å‡ºç™»å½• æ·»åŠ é€€å‡ºç™»å½•API src\\api\\user\\index.ts // åŒä¸€ç®¡ç†ç”¨æˆ·ç›¸å…³çš„æ¥å£import request from @/utils/requestimport ResponseData, from ./type// ç»Ÿä¸€ç®¡ç†APIenum API LOGOUT_URL = /admin/acl/index/logout,//é€€å‡ºç™»å½•export const reqLogout = () = return request.postany, ResponseData(API.LOGOUT_URL) ä¿®æ”¹é€€å‡ºç™»å½•ç‚¹å‡»äº‹ä»¶ src\\layout\\tabbar\\setting\\index.vue template !-- ä¸‹æ‹‰èœå• -- el-dropdown span class=el-dropdown-link userStore.username el-icon class=el-icon--right arrow-down / /el-icon /span template #dropdown el-dropdown-menu el-dropdown-item @click=logouté€€å‡ºç™»é™†/el-dropdown-item /el-dropdown-menu /template /el-dropdown/templatescript setup lang=ts// é€€å‡ºç™»å½•const router = useRouter()const route = useRoute()const logout = async () = //ç¬¬ä¸€ä»¶äº‹ï¼šéœ€è¦é¡¹æœåŠ¡å™¨å‘è¯·æ±‚ã€é€€å‡ºç™»å½•æ¥å£ã€‘ //ç¬¬äºŒä»¶äº‹ï¼šä»“åº“å½“ä¸­å’Œå…³äºç”¨æˆ·çš„ç›¸å…³çš„æ•°æ®æ¸…ç©º await userStore.userLogoutAction() //ç¬¬ä¸‰ä»¶äº‹ï¼šè·³è½¬åˆ°ç™»é™†é¡µé¢ router.push( path: /login, query: redirect: route.path )/script æ³¨æ„ï¼šéœ€è¦æ·»åŠ awaité˜»å¡é€€å‡ºç™»å½•æ–¹æ³• ä¿®æ”¹permisstion.ts await userStore.userLogoutAction() src\\permisstion.ts //å…¨å±€å‰ç½®å®ˆå«router.beforeEach(async (to: any, from: any, next: any) = //ç½‘é¡µçš„åå­— document.title = `$setting.title-$to.meta.title` //è®¿é—®æŸä¸€ä¸ªè·¯ç”±ä¹‹å‰çš„å®ˆå« nprogress.start() //è·å–tokenï¼Œå»åˆ¤æ–­ç”¨æˆ·ç™»å½•ã€è¿˜æ˜¯æœªç™»å½• const token = userStore.token //è·å–ç”¨æˆ·åå­— const username = userStore.username //ç”¨æˆ·ç™»å½•åˆ¤æ–­ if (token) //ç™»é™†æˆåŠŸï¼Œè®¿é—®loginã€‚æŒ‡å‘é¦–é¡µ if (to.path == /login) next(/home) else //ç™»é™†æˆåŠŸè®¿é—®å…¶ä½™çš„ï¼Œæ”¾è¡Œ //æœ‰ç”¨æˆ·ä¿¡æ¯ if (username) //æ”¾è¡Œ next() else //å¦‚æœæ²¡æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œåœ¨æ”¶å°¾è¿™é‡Œå‘è¯·æ±‚è·å–åˆ°äº†ç”¨æˆ·ä¿¡æ¯å†æ”¾è¡Œ try ... catch (error) //tokenè¿‡æœŸ|ç”¨æˆ·æ‰‹åŠ¨å¤„ç†token //é€€å‡ºç™»é™†-ç”¨æˆ·ç›¸å…³çš„æ•°æ®æ¸…ç©º await userStore.userLogoutAction() next( path: /login, query: redirect: to.path ) else ... )//å…¨å±€åç½®å®ˆå«// eslint-disable-next-line @typescript-eslint/no-unused-varsrouter.afterEach((to: any, from: any) = // to and from are both route objects. nprogress.done())//ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šä»»æ„è·¯ç”±åˆ‡æ¢å®ç°è¿›åº¦æ¡ä¸šåŠ¡ ----nprogress//ç¬¬äºŒä¸ªé—®é¢˜ï¼šè·¯ç”±é‰´æƒ//å…¨éƒ¨è·¯ç”±ç»„ä»¶ ï¼šç™»å½•|404|ä»»æ„è·¯ç”±|é¦–é¡µ|æƒé™ç®¡ç†ï¼ˆä¸‰ä¸ªå­è·¯ç”±ï¼‰|//ç”¨æˆ·æœªç™»å½• ï¼šå¯ä»¥è®¿é—®login å…¶ä½™éƒ½ä¸è¡Œ//ç™»é™†æˆåŠŸï¼šä¸å¯ä»¥è®¿é—®login å…¶ä½™éƒ½å¯ä»¥ 8. å“ç‰Œç®¡ç†8.1 å“ç‰Œæ•°æ®å±•ç¤º æ·»åŠ å“ç‰Œç®¡ç†ç•Œé¢ https://element-plus.org/zh-CN/component/card.html#%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95 https://element-plus.org/zh-CN/component/table.html https://element-plus.org/zh-CN/component/pagination.html src\\views\\product\\trademark\\index.vue template el-card class=box-card !-- å¡ç‰‡é¡¶éƒ¨æ·»åŠ å“ç‰ŒæŒ‰é’® -- el-button type=primary size=default icon=Plusæ·»åŠ å“ç‰Œ/el-button !-- è¡¨æ ¼ç»„ä»¶ï¼Œç”¨äºå±•ç¤ºå·²æœ‰çš„æ•°æ® -- !-- table ---border:æ˜¯å¦æœ‰çºµå‘çš„è¾¹æ¡† table-column ---lableï¼šæŸä¸€ä¸ªåˆ—è¡¨ ---widthï¼šè®¾ç½®è¿™ä¸€åˆ—çš„å®½åº¦ ---alignï¼šè®¾ç½®è¿™ä¸€åˆ—å¯¹é½æ–¹å¼ -- el-table style=margin: 10px 0px border el-table-column label=åºå· width=80px align=center /el-table-column el-table-column label=å“ç‰Œåç§°/el-table-column el-table-column label=å“ç‰ŒLOGO/el-table-column el-table-column label=å“ç‰Œæ“ä½œ/el-table-column /el-table !-- åˆ†é¡µå™¨ç»„ä»¶ -- !-- pagination ---v-model:current-pageï¼šè®¾ç½®å½“å‰åˆ†é¡µå™¨é¡µç  ---v-model:page-size:è®¾ç½®æ¯ä¸€ä¹Ÿå±•ç¤ºæ•°æ®æ¡æ•° ---page-sizesï¼šæ¯é¡µæ˜¾ç¤ºä¸ªæ•°é€‰æ‹©å™¨çš„é€‰é¡¹è®¾ç½® ---background:èƒŒæ™¯é¢œè‰² ---layoutï¼šåˆ†é¡µå™¨6ä¸ªå­ç»„ä»¶å¸ƒå±€çš„è°ƒæ•´ -æŠŠåé¢çš„å­ç»„ä»¶é¡¶åˆ°å³ä¾§ -- el-pagination v-model:current-page=pageNo v-model:page-size=limit :page-sizes=[3, 5, 7, 9] :background=true layout= prev, pager, next, jumper,-,total, sizes, :total=400 / /el-card/templatescript setup lang=ts//å¼•å…¥ç»„åˆå¼APIå‡½æ•°import ref from vue//å½“å‰é¡µç let pageNo = refnumber(1)//æ¯ä¸€é¡µå±•ç¤ºçš„æ•°æ®let limit = refnumber(3)/scriptstyle lang=scss scoped/style å®šä¹‰å“ç‰Œæ¥å£æ•°æ®ç±»å‹ src\\api\\product\\trademark\\type.ts export interface ResponseData code: number message: string ok: boolean//å·²æœ‰çš„å“ç‰Œçš„tsæ•°æ®ç±»å‹export interface TradeMark id?: number tmName: string logoUrl: string//åŒ…å«å…¨éƒ¨å“ç‰Œæ•°æ®çš„tsç±»å‹export type Records = TradeMark[]//è·å–çš„å·²æœ‰å…¨éƒ¨å“ç‰Œçš„æ•°æ®tsç±»å‹export interface TradeMarkResponseData extends ResponseData data: records: Records total: number size: number current: number searchCount: boolean pages: number å®šä¹‰è·å–å“ç‰Œæ•°æ®æ¥å£ src\\api\\product\\trademark\\index.ts //ä¹¦å†™å“ç‰Œç®¡ç†æ¨¡å—æ¥å£import request from @/utils/requestimport type TradeMarkResponseData from ./type//å“ç‰Œç®¡ç†æ¨¡å—æ¥å£åœ°å€enum API //è·å–å·²æœ‰å“ç‰Œæ¥å£ TRADEMARK_URL = /admin/product/baseTrademark/,//è·å–å·²æœ‰å“ç‰Œçš„æ¥å£æ–¹æ³•//page:è·å–ç¬¬å‡ é¡µ ---é»˜è®¤ç¬¬ä¸€é¡µ//limit:è·å–å‡ ä¸ªå·²æœ‰å“ç‰Œçš„æ•°æ®export const reqHasTrademark = (page: number, limit: number) = request.getany, TradeMarkResponseData( API.TRADEMARK_URL + `$page/$limit`, ) æ¸²æŸ“å±•ç¤ºç•Œé¢ src\\views\\product\\trademark\\index.vue template el-card class=box-card !-- å¡ç‰‡é¡¶éƒ¨æ·»åŠ å“ç‰ŒæŒ‰é’® -- el-button type=primary size=default icon=Plusæ·»åŠ å“ç‰Œ/el-button !-- è¡¨æ ¼ç»„ä»¶ï¼Œç”¨äºå±•ç¤ºå·²æœ‰çš„æ•°æ® -- !-- table ---border:æ˜¯å¦æœ‰çºµå‘çš„è¾¹æ¡† table-column ---lableï¼šæŸä¸€ä¸ªåˆ—è¡¨ ---widthï¼šè®¾ç½®è¿™ä¸€åˆ—çš„å®½åº¦ ---alignï¼šè®¾ç½®è¿™ä¸€åˆ—å¯¹é½æ–¹å¼ -- el-table style=margin: 10px 0px border :data=trademarkArr el-table-column label=åºå· width=80px align=center prop=id /el-table-column el-table-column label=å“ç‰Œåç§° prop=tmName/el-table-column el-table-column label=å“ç‰ŒLOGO !-- https://lianyutian.github.io/posts/dd58b23f.html 10.4ä½œç”¨åŸŸæ’æ§½ -- template #default= row img :src=row.logoUrl style=width: 100px; height: 100px / /template /el-table-column el-table-column label=å“ç‰Œæ“ä½œ template #default= el-button type=primary size=small icon=Edit/el-button el-button type=primary size=small icon=Delete/el-button /template /el-table-column /el-table !-- åˆ†é¡µå™¨ç»„ä»¶ -- !-- pagination ---v-model:current-pageï¼šè®¾ç½®å½“å‰åˆ†é¡µå™¨é¡µç  ---v-model:page-size:è®¾ç½®æ¯ä¸€ä¹Ÿå±•ç¤ºæ•°æ®æ¡æ•° ---page-sizesï¼šæ¯é¡µæ˜¾ç¤ºä¸ªæ•°é€‰æ‹©å™¨çš„é€‰é¡¹è®¾ç½® ---background:èƒŒæ™¯é¢œè‰² ---layoutï¼šåˆ†é¡µå™¨6ä¸ªå­ç»„ä»¶å¸ƒå±€çš„è°ƒæ•´ -æŠŠåé¢çš„å­ç»„ä»¶é¡¶åˆ°å³ä¾§ -- el-pagination v-model:current-page=pageNo v-model:page-size=limit :page-sizes=[3, 5, 7, 9] :background=true layout= prev, pager, next, jumper,-,total, sizes, :total=total @current-change=getHasTrademark @size-change=sizeChange / /el-card/templatescript setup lang=tsimport reqHasTrademark from @/api/product/trademark// å¼•å…¥ç»„åˆå¼APIå‡½æ•°import ref, onMounted from vue// å½“å‰é¡µç let pageNo = refnumber(1)// æ¯ä¸€é¡µå±•ç¤ºçš„æ•°æ®let limit = refnumber(3)// å­˜å‚¨å·²æœ‰å“ç‰Œæ•°æ®æ€»æ•°let total = refnumber(0)// å­˜å‚¨å·²æœ‰å“ç‰Œçš„æ•°æ®let trademarkArr = refany([])// è·å–å·²æœ‰å“ç‰Œçš„æ¥å£å°è£…ä¸ºä¸€ä¸ªå‡½æ•°:åœ¨ä»»ä½•æƒ…å†µä¸‹å‘è·å–æ•°æ®,è°ƒç”¨æ¬¡å‡½æ•°å³å¯// çˆ¶å­ç»„ä»¶é€šä¿¡ https://lianyutian.github.io/posts/dd58b23f.html 8.3å­ä¼ çˆ¶const getHasTrademark = async (page = 1) = // å½“å‰é¡µç  pageNo.value = page let result = await reqHasTrademark(pageNo.value, limit.value) if (result.code == 200) //å­˜å‚¨å·²æœ‰å“ç‰Œæ€»ä¸ªæ•° total.value = result.data.total trademarkArr.value = result.data.records // å½“ä¸‹æ‹‰èœå•å‘ç”Ÿå˜åŒ–çš„æ—¶å€™è§¦å‘æ­¤æ–¹æ³•// è¿™ä¸ªè‡ªå®šä¹‰äº‹ä»¶,åˆ†é¡µå™¨ç»„ä»¶ä¼šå°†ä¸‹æ‹‰èœå•é€‰ä¸­æ•°æ®è¿”å›const sizeChange = () = // å½“å‰æ¯ä¸€é¡µçš„æ•°æ®é‡å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå½“å‰é¡µç å½’1 getHasTrademark()// ç»„ä»¶æŒ‚è½½å®Œæ¯•é’©å­---å‘ä¸€æ¬¡è¯·æ±‚,è·å–ç¬¬ä¸€é¡µã€ä¸€é¡µä¸‰ä¸ªå·²æœ‰å“ç‰Œæ•°æ®onMounted(() = getHasTrademark())/scriptstyle lang=scss scoped/style current-changeæ–¹æ³•è§¦å‘æ—¶ï¼Œå®ƒä¼šç»™çˆ¶ç»„ä»¶ä¼ é€’å¹¶æ³¨å…¥ä¸€ä¸ªå‚æ•°ï¼ˆç‚¹å‡»çš„é¡µç ï¼‰ï¼Œç›¸å½“äºæŠŠè¿™ä¸ªå‚æ•°ä¼ é€’ç»™äº†getHasTrademarkå‡½æ•°ï¼Œå› æ­¤èƒ½å¤Ÿè·³è½¬åˆ°æ­£ç¡®çš„é¡µç æ•° 8.2 æ–°å¢å“ç‰Œ æ·»åŠ å¯¹è¯æ¡†ç•Œé¢ https://element-plus.org/zh-CN/component/dialog.html#dialog-%E5%AF%B9%E8%AF%9D%E6%A1%86 https://element-plus.org/zh-CN/component/upload.html#%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95 src\\views\\product\\trademark\\index.vue template !-- å¯¹è¯æ¡†ç»„ä»¶:åœ¨æ·»åŠ å“ç‰Œä¸ä¿®æ”¹å·²æœ‰å“ç‰Œçš„ä¸šåŠ¡æ—¶å€™ä½¿ç”¨ç»“æ„ -- !-- v-model:å±æ€§ç”¨æˆ·æ§åˆ¶å¯¹è¯æ¡†çš„æ˜¾ç¤ºä¸éšè—çš„ trueæ˜¾ç¤º falseéšè— title:è®¾ç½®å¯¹è¯æ¡†å·¦ä¸Šè§’æ ‡é¢˜ -- el-dialog v-model=dialogFormVisible title=æ·»åŠ å“ç‰Œ el-form style=width: 80% el-form-item label=å“ç‰Œåç§° label-width=80px el-input / /el-form-item el-form-item label=å“ç‰ŒLOGO label-width=80px el-upload class=avatar-uploader action=https://run.mocky.io/v3/9d059bf9-4660-45f2-925d-ce80ad6c4d15 :show-file-list=false :on-success=handleAvatarSuccess :before-upload=beforeAvatarUpload img v-if=imageUrl :src=imageUrl class=avatar / el-icon v-else class=avatar-uploader-iconPlus //el-icon /el-upload /el-form-item /el-form !-- https://lianyutian.github.io/posts/dd58b23f.html 10.3å…·åæ’æ§½ -- template #footer span class=dialog-footer el-button @click=dialogFormVisible = falseå–æ¶ˆ/el-button el-button type=primary @click=dialogFormVisible = false ç¡®è®¤ /el-button /span /template /el-dialog/templatescript setup lang=ts// å¼•å…¥ç»„åˆå¼APIå‡½æ•°import ref from vue// å¯¹è¯æ¡†æ˜¯å¦å±•ç¤ºlet dialogFormVisible = ref(false)/scriptstyle.avatar-uploader .el-upload border: 1px dashed var(--el-border-color); border-radius: 6px; cursor: pointer; position: relative; overflow: hidden; transition: var(--el-transition-duration-fast);.avatar-uploader .el-upload:hover border-color: var(--el-color-primary);.el-icon.avatar-uploader-icon font-size: 28px; color: #8c939d; width: 178px; height: 178px; text-align: center;/style æ·»åŠ æ–°å¢å“ç‰ŒAPI src\\api\\product\\trademark\\index.ts //ä¹¦å†™å“ç‰Œç®¡ç†æ¨¡å—æ¥å£import request from @/utils/requestimport type TradeMarkResponseData, TradeMark from ./type//å“ç‰Œç®¡ç†æ¨¡å—æ¥å£åœ°å€enum API //æ·»åŠ å“ç‰Œ ADDTRADEMARK_URL = /admin/product/baseTrademark/save, //ä¿®æ”¹å·²æœ‰å“ç‰Œ UPDATETRADEMARK_URL = /admin/product/baseTrademark/update,//æ·»åŠ ä¸ä¿®æ”¹å·²æœ‰å“ç‰Œæ¥å£æ–¹æ³•export const reqAddOrUpdateTrademark = (data: TradeMark) = //ä¿®æ”¹å·²æœ‰å“ç‰Œçš„æ•°æ® if (data.id) return request.putany, any(API.UPDATETRADEMARK_URL, data) else //æ–°å¢å“ç‰Œ return request.postany, any(API.ADDTRADEMARK_URL, data) ç»‘å®šå¯¹è¯æ¡†æ•°æ® src\\views\\product\\trademark\\index.vue script setup lang=ts// å¯¹è¯æ¡†åŠŸèƒ½é€»è¾‘let dialogFormVisible = ref(false)// å®šä¹‰æ”¶é›†æ–°å¢å“ç‰Œæ•°æ®let trademarkParams = reactiveTradeMark( tmName: , logoUrl: ,)/script ç»‘å®šå“ç‰ŒåŠå›¾ç‰‡ä¸Šä¼ äº‹ä»¶ src\\views\\product\\trademark\\index.vue template el-card class=box-card !-- å¡ç‰‡é¡¶éƒ¨æ·»åŠ å“ç‰ŒæŒ‰é’® -- el-button type=primary size=default icon=Plus @click=addTrademark æ·»åŠ å“ç‰Œ /el-button /el-card !-- å¯¹è¯æ¡†ç»„ä»¶:åœ¨æ·»åŠ å“ç‰Œä¸ä¿®æ”¹å·²æœ‰å“ç‰Œçš„ä¸šåŠ¡æ—¶å€™ä½¿ç”¨ç»“æ„ -- !-- v-model:å±æ€§ç”¨æˆ·æ§åˆ¶å¯¹è¯æ¡†çš„æ˜¾ç¤ºä¸éšè—çš„ trueæ˜¾ç¤º falseéšè— title:è®¾ç½®å¯¹è¯æ¡†å·¦ä¸Šè§’æ ‡é¢˜ -- el-dialog v-model=dialogFormVisible title=æ·»åŠ å“ç‰Œ el-form style=width: 80% el-form-item label=å“ç‰Œåç§° label-width=80px el-input v-model=trademarkParams.tmName / /el-form-item el-form-item label=å“ç‰ŒLOGO label-width=80px !-- classï¼šå¸¦çš„ä¸€äº›æ ·å¼ï¼Œéœ€å¤åˆ¶åˆ°styleä¸­ actionï¼šå›¾ç‰‡ä¸Šä¼ è·¯å¾„éœ€è¦ä¹¦å†™/api,å¦åˆ™ä»£ç†æœåŠ¡å™¨ä¸å‘é€è¿™æ¬¡postè¯·æ±‚ :show-file-listï¼šæ˜¯å¦å±•ç¤ºå·²ç»ä¸Šä¼ çš„æ–‡ä»¶ :on-successï¼šå›¾ç‰‡ä¸Šä¼ æˆåŠŸé’©å­ï¼ˆæ”¶é›†äº†ä¸Šä¼ å›¾ç‰‡çš„åœ°å€ï¼‰ :before-uploadï¼šä¸Šä¼ å›¾ç‰‡ä¹‹å‰çš„é’©å­å‡½æ•° -- el-upload class=avatar-uploader action=api/admin/product/fileUpload :show-file-list=false :on-success=handleAvatarSuccess :before-upload=beforeAvatarUpload img v-if=trademarkParams.logoUrl :src=trademarkParams.logoUrl class=avatar / el-icon v-else class=avatar-uploader-iconPlus //el-icon /el-upload /el-form-item /el-form !-- https://lianyutian.github.io/posts/dd58b23f.html 10.3å…·åæ’æ§½ -- template #footer span class=dialog-footer el-button @click=dialogFormVisible = falseå–æ¶ˆ/el-button el-button type=primary @click=confirmç¡®è®¤/el-button /span /template /el-dialog/templatescript setup lang=ts// å¯¹è¯æ¡†åŠŸèƒ½é€»è¾‘let dialogFormVisible = ref(false)// å®šä¹‰æ”¶é›†æ–°å¢å“ç‰Œæ•°æ®let trademarkParams = reactiveTradeMark( tmName: , logoUrl: ,)//æ·»åŠ å“ç‰ŒæŒ‰é’®çš„å›è°ƒconst addTrademark = () = //å¯¹è¯æ¡†æ˜¾ç¤º dialogFormVisible.value = true //æ¸…ç©ºæ”¶é›†æ•°æ® trademarkParams.tmName = trademarkParams.logoUrl = //ä¸Šä¼ å›¾ç‰‡ç»„ä»¶-ä¸Šä¼ å›¾ç‰‡ä¹‹å‰è§¦å‘çš„é’©å­å‡½æ•°const beforeAvatarUpload: UploadProps[beforeUpload] = (rawFile) = //é’©å­æ˜¯åœ¨å›¾ç‰‡ä¸Šä¼ æˆåŠŸä¹‹å‰è§¦å‘,ä¸Šä¼ æ–‡ä»¶ä¹‹å‰å¯ä»¥çº¦æŸæ–‡ä»¶ç±»å‹ä¸å¤§å° //è¦æ±‚:ä¸Šä¼ æ–‡ä»¶æ ¼å¼png|jpg|gif 4M if ( rawFile.type == image/png || rawFile.type == image/jpeg || rawFile.type == image/gif ) if (rawFile.size / 1024 / 1024 4) return true else ElMessage( type: error, message: ä¸Šä¼ æ–‡ä»¶å¤§å°å°äº4M, ) return false else ElMessage( type: error, message: ä¸Šä¼ æ–‡ä»¶æ ¼å¼åŠ¡å¿…PNG|JPG|GIF, ) return false //å›¾ç‰‡ä¸Šä¼ æˆåŠŸé’©å­const handleAvatarSuccess: UploadProps[onSuccess] = (response) = //response:å³ä¸ºå½“å‰è¿™æ¬¡ä¸Šä¼ å›¾ç‰‡postè¯·æ±‚æœåŠ¡å™¨è¿”å›çš„æ•°æ® //æ”¶é›†ä¸Šä¼ å›¾ç‰‡çš„åœ°å€,æ·»åŠ ä¸€ä¸ªæ–°çš„å“ç‰Œçš„æ—¶å€™å¸¦ç»™æœåŠ¡å™¨ trademarkParams.logoUrl = response.data //å›¾ç‰‡ä¸Šä¼ æˆåŠŸ,æ¸…é™¤æ‰å¯¹åº”å›¾ç‰‡æ ¡éªŒç»“æœ //formRef.value.clearValidate(logoUrl)//ç¡®è®¤æ·»åŠ å“ç‰Œconst confirm = async () = //åœ¨ä½ å‘è¯·æ±‚ä¹‹å‰,è¦å¯¹äºæ•´ä¸ªè¡¨å•è¿›è¡Œæ ¡éªŒ //è°ƒç”¨è¿™ä¸ªæ–¹æ³•è¿›è¡Œå…¨éƒ¨è¡¨å•ç›¸æ ¡éªŒ,å¦‚æœæ ¡éªŒå…¨éƒ¨é€šè¿‡ï¼Œåœ¨æ‰§è¡Œåé¢çš„è¯­æ³• // await formRef.value.validate() let result: any = await reqAddOrUpdateTrademark(trademarkParams) //æ·»åŠ |ä¿®æ”¹å·²æœ‰å“ç‰Œ if (result.code == 200) //å…³é—­å¯¹è¯æ¡† dialogFormVisible.value = false //å¼¹å‡ºæç¤ºä¿¡æ¯ ElMessage( type: success, message: trademarkParams.id ? ä¿®æ”¹å“ç‰ŒæˆåŠŸ : æ·»åŠ å“ç‰ŒæˆåŠŸ, ) //å†æ¬¡å‘è¯·æ±‚è·å–å·²æœ‰å…¨éƒ¨çš„å“ç‰Œæ•°æ® getHasTrademark(trademarkParams.id ? pageNo.value : 1) else //æ·»åŠ å“ç‰Œå¤±è´¥ ElMessage( type: error, message: trademarkParams.id ? ä¿®æ”¹å“ç‰Œå¤±è´¥ : æ·»åŠ å“ç‰Œå¤±è´¥, ) //å…³é—­å¯¹è¯æ¡† dialogFormVisible.value = false /script 8.3 ä¿®æ”¹å“ç‰Œ ç»‘å®šç‚¹å‡»äº‹ä»¶ template el-table-column label=å“ç‰Œæ“ä½œ !-- row å›ä¼ ç¼–è¾‘æ•°æ® -- template #default= row el-button type=primary size=small icon=Edit @click=updateTrademark(row) /el-button el-button type=primary size=small icon=Delete/el-button /template /el-table-column/templatescript setup lang=ts//ä¿®æ”¹å“ç‰Œ//row:rowå³ä¸ºå½“å‰å·²æœ‰çš„å“ç‰Œconst updateTrademark = async (row: TradeMark) = //å¯¹è¯æ¡†æ˜¾ç¤º dialogFormVisible.value = true //ES6è¯­æ³•åˆå¹¶å¯¹è±¡ Object.assign(trademarkParams, row)/script 8.4 å“ç‰Œè¡¨å•æ ¡éªŒ ç»‘å®šå‚æ•° https://element-plus.org/zh-CN/component/form.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%A1%E9%AA%8C%E8%A7%84%E5%88%99 :modelï¼šæ ¡éªŒçš„æ•°æ® :rulesï¼šæ ¡éªŒè§„åˆ™ refâ€formRefâ€ï¼šè¡¨å•å®ä¾‹ propï¼šè¡¨å•å…ƒç´ æ ¡éªŒçš„æ•°æ®ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¡¨å•ç»‘å®šçš„æ•°æ® el-form style=width: 80% :model=trademarkParams :rules=rules ref=formRef el-form-item label=å“ç‰Œåç§° label-width=80px prop=tmName el-input placeholder=è¯·è¾“å…¥å“ç‰Œåç§° v-model=trademarkParams.tmName / /el-form-item el-form-item label=å“ç‰ŒLOGO label-width=80px prop=logoUrl ... /el-form-item /el-form æ·»åŠ è‡ªå®šä¹‰è§„åˆ™ //å“ç‰Œè‡ªå®šä¹‰æ ¡éªŒè§„åˆ™æ–¹æ³•const validatorTmName = (rule: any, value: any, callBack: any) = //æ˜¯å½“è¡¨å•å…ƒç´ è§¦å‘bluræ—¶å€™,ä¼šè§¦å‘æ­¤æ–¹æ³• //è‡ªå®šä¹‰æ ¡éªŒè§„åˆ™ if (value.trim().length = 2) callBack() else //æ ¡éªŒæœªé€šè¿‡è¿”å›çš„é”™è¯¯çš„æç¤ºä¿¡æ¯ callBack(new Error(å“ç‰Œåç§°ä½æ•°å¤§äºç­‰äºä¸¤ä½)) //å“ç‰ŒLOGOå›¾ç‰‡çš„è‡ªå®šä¹‰æ ¡éªŒè§„åˆ™æ–¹æ³•const validatorLogoUrl = (rule: any, value: any, callBack: any) = //å¦‚æœå›¾ç‰‡ä¸Šä¼  if (value) callBack() else callBack(new Error(LOGOå›¾ç‰‡åŠ¡å¿…ä¸Šä¼ )) æ·»åŠ rules //è¡¨å•æ ¡éªŒè§„åˆ™å¯¹è±¡const rules = tmName: [ //required:è¿™ä¸ªå­—æ®µåŠ¡å¿…æ ¡éªŒ,è¡¨å•é¡¹å‰é¢å‡ºæ¥äº”è§’æ˜Ÿ //trigger:ä»£è¡¨è§¦å‘æ ¡éªŒè§„åˆ™æ—¶æœº[blurã€change] required: true, trigger: blur, validator: validatorTmName , ], logoUrl: [ required: true, validator: validatorLogoUrl ], é—®é¢˜1 å›¾ç‰‡æ ¡éªŒæ—¶æœº å› ä¸ºimgæ˜¯å›¾ç‰‡ï¼Œä¸å¥½åˆ¤æ–­ã€‚å› æ­¤ä½¿ç”¨è¡¨å•çš„validateå±æ€§ï¼Œå…¨éƒ¨æ ¡éªŒï¼Œæ”¾åœ¨ç¡®è®¤æŒ‰é’®çš„å›è°ƒå‡½æ•°ä¸­ const confirm = async () = //åœ¨ä½ å‘è¯·æ±‚ä¹‹å‰,è¦å¯¹äºæ•´ä¸ªè¡¨å•è¿›è¡Œæ ¡éªŒ //è°ƒç”¨è¿™ä¸ªæ–¹æ³•è¿›è¡Œå…¨éƒ¨è¡¨å•ç›¸æ ¡éªŒ,å¦‚æœæ ¡éªŒå…¨éƒ¨é€šè¿‡ï¼Œåœ¨æ‰§è¡Œåé¢çš„è¯­æ³• await formRef.value.validate() ... é—®é¢˜2 æ¸…é™¤æ ¡éªŒä¿¡æ¯1 å½“å›¾ç‰‡æ²¡æœ‰ä¸Šä¼ ç‚¹å‡»ç¡®è®¤åä¼šå‡ºæ¥æ ¡éªŒçš„æç¤ºä¿¡æ¯ï¼Œæˆ‘ä»¬ä¸Šä¼ å›¾ç‰‡åæ ¡éªŒä¿¡æ¯åº”è¯¥æ¶ˆå¤±ã€‚ä½¿ç”¨è¡¨å•çš„clearValidateå±æ€§ //å›¾ç‰‡ä¸Šä¼ æˆåŠŸé’©å­const handleAvatarSuccess: UploadProps[onSuccess] = ( ...) = ... //å›¾ç‰‡ä¸Šä¼ æˆåŠŸ,æ¸…é™¤æ‰å¯¹åº”å›¾ç‰‡æ ¡éªŒç»“æœ formRef.value.clearValidate(logoUrl) æ¸…é™¤æ ¡éªŒä¿¡æ¯2 å½“æˆ‘ä»¬æœªå¡«å†™ä¿¡æ¯å»ç‚¹å‡»ç¡®è®¤æŒ‰é’®æ—¶ï¼Œä¼šå¼¹å‡º2ä¸ªæ ¡éªŒä¿¡æ¯ã€‚å½“æˆ‘ä»¬å…³é—­åå†æ‰“å¼€ï¼Œæ ¡éªŒä¿¡æ¯è¿˜åœ¨ã€‚å› ä¸ºï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ·»åŠ å“ç‰ŒæŒ‰é’®æ—¶æ¸…é™¤æ ¡éªŒä¿¡æ¯ã€‚ä½†æ˜¯å› ä¸ºç‚¹å‡»æ·»åŠ å“ç‰Œï¼Œè¡¨å•è¿˜æ²¡æœ‰åŠ è½½ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ¢ä¸ªå†™æ³•ã€‚ //æ·»åŠ å“ç‰ŒæŒ‰é’®çš„å›è°ƒconst addTrademark = () = //å¯¹è¯æ¡†æ˜¾ç¤º dialogFormVisible.value = true //æ¸…ç©ºæ”¶é›†æ•°æ® trademarkParams.id = 0 trademarkParams.tmName = trademarkParams.logoUrl = //ç¬¬ä¸€ç§å†™æ³•:tsçš„é—®å·è¯­æ³• formRef.value?.clearValidate(tmName) formRef.value?.clearValidate(logoUrl) /* nextTick(() = formRef.value.clearValidate(tmName) formRef.value.clearValidate(logoUrl) ) */ åŒç†ï¼Œä¿®æ”¹æŒ‰é’®ä¹Ÿéœ€è¦æ¸…é™¤æ ¡éªŒä¿¡æ¯ //ä¿®æ”¹å·²æœ‰å“ç‰Œçš„æŒ‰é’®çš„å›è°ƒ//row:rowå³ä¸ºå½“å‰å·²æœ‰çš„å“ç‰Œconst updateTrademark = (row: TradeMark) = //æ¸…ç©ºæ ¡éªŒè§„åˆ™é”™è¯¯æç¤ºä¿¡æ¯ nextTick(() = formRef.value.clearValidate(tmName) formRef.value.clearValidate(logoUrl) ) ... 8.5 åˆ é™¤å“ç‰Œ æ·»åŠ API src\\api\\product\\trademark\\index.ts //ä¹¦å†™å“ç‰Œç®¡ç†æ¨¡å—æ¥å£import request from @/utils/requestimport type TradeMarkResponseData, TradeMark from ./type//å“ç‰Œç®¡ç†æ¨¡å—æ¥å£åœ°å€enum API //åˆ é™¤å·²æœ‰å“ç‰Œ DELETE_URL = /admin/product/baseTrademark/remove/,//åˆ é™¤æŸä¸€ä¸ªå·²æœ‰å“ç‰Œçš„æ•°æ®export const reqDeleteTrademark = (id: number) = request.deleteany, any(API.DELETE_URL + id) æ·»åŠ æ°”æ³¡ç»„ä»¶ https://element-plus.org/zh-CN/component/popconfirm.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%B9%E5%87%BA%E6%A1%86%E7%9A%84%E5%86%85%E5%AE%B9 src\\views\\product\\trademark\\index.vue template el-card class=box-card el-table el-table-column label=å“ç‰Œæ“ä½œ !-- row å›ä¼ ç¼–è¾‘æ•°æ® -- template #default= row el-button type=primary size=small icon=Edit @click=updateTrademark(row) /el-button el-popconfirm :title=`æ‚¨ç¡®å®šè¦åˆ é™¤$row.tmName?` width=250px icon=Delete @confirm=removeTradeMark(row.id) template #reference el-button type=primary size=small icon=Delete/el-button /template /el-popconfirm /template /el-table-column /el-table /el-card/template ç»‘å®šåˆ é™¤äº‹ä»¶ script setup lang=ts// åˆ é™¤å“ç‰Œ//æ°”æ³¡ç¡®è®¤æ¡†ç¡®å®šæŒ‰é’®çš„å›è°ƒconst removeTradeMark = async (id: number) = //ç‚¹å‡»ç¡®å®šæŒ‰é’®åˆ é™¤å·²æœ‰å“ç‰Œè¯·æ±‚ let result = await reqDeleteTrademark(id) if (result.code == 200) //åˆ é™¤æˆåŠŸæç¤ºä¿¡æ¯ ElMessage( type: success, message: åˆ é™¤å“ç‰ŒæˆåŠŸ, ) //å†æ¬¡è·å–å·²æœ‰çš„å“ç‰Œæ•°æ® getHasTrademark( trademarkArr.value.length 1 ? pageNo.value : pageNo.value - 1, ) else ElMessage( type: error, message: åˆ é™¤å“ç‰Œå¤±è´¥, ) /script 9. å±æ€§ç®¡ç† å±æ€§ç®¡ç†åˆ†ä¸ºä¸Šé¢éƒ¨åˆ†çš„ä¸‰çº§åˆ†ç±»æ¨¡å—ä»¥åŠä¸‹é¢çš„æ·»åŠ å±æ€§éƒ¨åˆ†ã€‚æˆ‘ä»¬å°†ä¸‰çº§åˆ†ç±»æ¨¡å—å•ç‹¬æå–å‡ºæ¥åšæˆå…¨å±€ç»„ä»¶ 9.1 ä¸‰çº§åˆ†ç±»ç»„ä»¶ æ·»åŠ é™æ€ç•Œé¢ src\\components\\Category\\index.vue template !-- ä¸‰çº§åˆ†ç±»å…¨å±€ç»„ä»¶-- Category/Category el-card style=margin: 10px 0px el-button type=primary size=default icon=Plusæ·»åŠ å±æ€§/el-button el-table border style=margin: 10px 0px el-table-column label=åºå· type=index align=center width=80px /el-table-column el-table-column label=å±æ€§åç§° width=120px/el-table-column el-table-column label=å±æ€§å€¼åç§°/el-table-column el-table-column label=æ“ä½œ width=120px/el-table-column /el-table /el-card/templatescript setup lang=ts/scriptstyle lang=scss scoped/style src\\views\\product\\attr\\index.vue template !-- ä¸‰çº§åˆ†ç±»å…¨å±€ç»„ä»¶-- Category/Category el-card style=margin: 10px 0px el-button type=primary size=default icon=Plusæ·»åŠ å±æ€§/el-button el-table border style=margin: 10px 0px el-table-column label=åºå· type=index align=center width=80px /el-table-column el-table-column label=å±æ€§åç§° width=120px/el-table-column el-table-column label=å±æ€§å€¼åç§°/el-table-column el-table-column label=æ“ä½œ width=120px/el-table-column /el-table /el-card/templatescript setup lang=ts/scriptstyle lang=scss scoped/style å…¨å±€é…ç½®ä¸­å¼•å…¥ç»„ä»¶ src\\components\\index.ts import SvgIcon from ./SvgIcon/index.vueimport Category from ./Category/index.vueimport type App, Component from vue//å¼•å…¥element-plusæä¾›å…¨éƒ¨å›¾æ ‡ç»„ä»¶import * as ElementPlusIconsVue from @element-plus/icons-vueconst components: [name: string]: Component = SvgIcon, Category æ·»åŠ è·å–åˆ†ç±»æ¥å£ç±»å‹ src\\api\\product\\attr\\type.ts //åˆ†ç±»ç›¸å…³çš„æ•°æ®tsç±»å‹export interface ResponseData code: number message: string ok: boolean//åˆ†ç±»tsç±»å‹export interface CategoryObj id: number | string name: string category1Id?: number category2Id?: number//ç›¸åº”çš„åˆ†ç±»æ¥å£è¿”å›æ•°æ®çš„ç±»å‹export interface CategoryResponseData extends ResponseData data: CategoryObj[] æ·»åŠ è·å–è·å–åˆ†ç±»æ¥å£ src\\api\\product\\attr\\index.ts //è¿™é‡Œä¹¦å†™å±æ€§ç›¸å…³çš„APIæ–‡ä»¶import request from @/utils/requestimport CategoryResponseData from ./type//å±æ€§ç®¡ç†æ¨¡å—æ¥å£åœ°å€enum API //è·å–ä¸€çº§åˆ†ç±»æ¥å£åœ°å€ C1_URL = /admin/product/getCategory1, //è·å–äºŒçº§åˆ†ç±»æ¥å£åœ°å€ C2_URL = /admin/product/getCategory2/, //è·å–ä¸‰çº§åˆ†ç±»æ¥å£åœ°å€ C3_URL = /admin/product/getCategory3/,//è·å–ä¸€çº§åˆ†ç±»çš„æ¥å£æ–¹æ³•export const reqC1 = () = request.getany, CategoryResponseData(API.C1_URL)//è·å–äºŒçº§åˆ†ç±»çš„æ¥å£æ–¹æ³•export const reqC2 = (category1Id: number | string) = return request.getany, CategoryResponseData(API.C2_URL + category1Id)//è·å–ä¸‰çº§åˆ†ç±»çš„æ¥å£æ–¹æ³•export const reqC3 = (category2Id: number | string) = return request.getany, CategoryResponseData(API.C3_URL + category2Id) å¼•å…¥pinia ä¸ºä»€ä¹ˆè¦ä½¿ç”¨piniaå‘¢ï¼Ÿ åœ¨ä¸‹é¢çš„æ·»åŠ å±æ€§é‚£éƒ¨åˆ†ï¼Œçˆ¶ç»„ä»¶è¦ç”¨åˆ°ä¸‰çº§åˆ†ç±»ç»„ä»¶çš„ä¿¡æ¯ï¼ˆidï¼‰ï¼Œæ‰€ä»¥å°†æ•°æ®æ”¾åœ¨piniaä¸­æ˜¯æœ€æ–¹ä¾¿çš„ã€‚ æ·»åŠ CategoryStateç±»å‹ src\\store\\modules\\type\\type.ts //å®šä¹‰åˆ†ç±»ä»“åº“stateå¯¹è±¡çš„tsç±»å‹export interface CategoryState c1Id: string | number c1Arr: CategoryObj[] c2Arr: CategoryObj[] c2Id: string | number c3Arr: CategoryObj[] c3Id: string | number æ·»åŠ store action src\\store\\modules\\category.ts //å•†å“åˆ†ç±»å…¨å±€ç»„ä»¶çš„å°ä»“åº“import defineStore from piniaimport reqC1, reqC2, reqC3 from @/api/product/attrimport CategoryResponseData from @/api/product/attr/typeimport CategoryState from ./type/typeconst useCategoryStore = defineStore(Category, state(): CategoryState return //å­˜å‚¨ä¸€çº§åˆ†ç±»çš„æ•°æ® c1Arr: [], //å­˜å‚¨ä¸€çº§åˆ†ç±»çš„ID c1Id: , c2Arr: [], c2Id: , c3Arr: [], c3Id: , , actions: //è·å–ä¸€çº§åˆ†ç±»çš„æ–¹æ³• async getC1Action() //å‘è¯·æ±‚è·å–ä¸€çº§åˆ†ç±»çš„æ•°æ® const result: CategoryResponseData = await reqC1() if (result.code == 200) this.c1Arr = result.data , //è·å–äºŒçº§åˆ†ç±»çš„æ–¹æ³• async getC2Action(category1Id: string | number) //å‘è¯·æ±‚è·å–ä¸€çº§åˆ†ç±»çš„æ•°æ® const result: CategoryResponseData = await reqC2(category1Id) if (result.code == 200) this.c2Arr = result.data , //è·å–ä¸‰çº§åˆ†ç±»çš„æ–¹æ³• async getC3Action(category2Id: string | number) //å‘è¯·æ±‚è·å–ä¸€çº§åˆ†ç±»çš„æ•°æ® const result: CategoryResponseData = await reqC3(category2Id) if (result.code == 200) this.c3Arr = result.data , , getters: ,)export default useCategoryStore æ¸²æŸ“ä¸€çº§åˆ†ç±» src\\components\\Category\\index.vue template el-card el-form inline el-form-item label=ä¸€çº§åˆ†ç±» el-select v-model=categoryStore.c1Id !-- label:å³ä¸ºå±•ç¤ºæ•°æ® value:å³ä¸ºselectä¸‹æ‹‰èœå•æ”¶é›†çš„æ•°æ® -- el-option v-for=c1 in categoryStore.c1Arr :key=c1.id :label=c1.name :value=c1.id /el-option /el-select /el-form-item /el-form /el-card/templatescript setup lang=ts//å¼•å…¥ç»„ä»¶æŒ‚è½½å®Œæ¯•æ–¹æ³•import onMounted from vue//å¼•å…¥åˆ†ç±»ç›¸å…³çš„ä»“åº“import useCategoryStore from @/store/modules/categorylet categoryStore = useCategoryStore()//åˆ†ç±»å…¨å±€ç»„ä»¶æŒ‚è½½å®Œæ¯•,é€šçŸ¥ä»“åº“å‘è¯·æ±‚è·å–ä¸€çº§åˆ†ç±»çš„æ•°æ®onMounted(() = getC1())//é€šçŸ¥ä»“åº“è·å–ä¸€çº§åˆ†ç±»çš„æ–¹æ³•const getC1 = () = //é€šçŸ¥åˆ†ç±»ä»“åº“å‘è¯·æ±‚è·å–ä¸€çº§åˆ†ç±»çš„æ•°æ® categoryStore.getC1Action()/scriptstyle lang=scss scoped/style æ¸²æŸ“äºŒçº§å’Œä¸‰çº§åˆ†ç±» äºŒçº§åˆ†ç±»éœ€è¦é¦–å…ˆæ‹¿åˆ°ä¸€çº§åˆ†ç±»çš„idï¼Œå†æ ¹æ®ä¸€çº§åˆ†ç±»idæŸ¥è¯¢äºŒçº§åˆ†ç±» ä¸€çº§åˆ†ç±»é€‰å®šæ—¶ä¼šè§¦å‘changeå‡½æ•°ï¼ˆhttps://element-plus.org/zh-CN/component/select.html#select-eventsï¼‰ src\\components\\Category\\index.vue template el-card el-form inline el-form-item label=ä¸€çº§åˆ†ç±» el-select v-model=categoryStore.c1Id @change=handler !-- label:å³ä¸ºå±•ç¤ºæ•°æ® value:å³ä¸ºselectä¸‹æ‹‰èœå•æ”¶é›†çš„æ•°æ® -- el-option v-for=c1 in categoryStore.c1Arr :key=c1.id :label=c1.name :value=c1.id /el-option /el-select /el-form-item el-form-item label=äºŒçº§åˆ†ç±» el-select v-model=categoryStore.c2Id @change=handler2 !-- label:å³ä¸ºå±•ç¤ºæ•°æ® value:å³ä¸ºselectä¸‹æ‹‰èœå•æ”¶é›†çš„æ•°æ® -- el-option v-for=c2 in categoryStore.c2Arr :key=c2.id :label=c2.name :value=c2.id /el-option /el-select /el-form-item el-form-item label=ä¸‰çº§åˆ†ç±» el-select v-model=categoryStore.c3Id !-- label:å³ä¸ºå±•ç¤ºæ•°æ® value:å³ä¸ºselectä¸‹æ‹‰èœå•æ”¶é›†çš„æ•°æ® -- el-option v-for=c3 in categoryStore.c3Arr :key=c3.id :label=c3.name :value=c3.id /el-option /el-select /el-form-item /el-form /el-card/templatescript setup lang=ts//å¼•å…¥ç»„ä»¶æŒ‚è½½å®Œæ¯•æ–¹æ³•import onMounted from vue//å¼•å…¥åˆ†ç±»ç›¸å…³çš„ä»“åº“import useCategoryStore from @/store/modules/categorylet categoryStore = useCategoryStore()//åˆ†ç±»å…¨å±€ç»„ä»¶æŒ‚è½½å®Œæ¯•,é€šçŸ¥ä»“åº“å‘è¯·æ±‚è·å–ä¸€çº§åˆ†ç±»çš„æ•°æ®onMounted(() = getC1())//é€šçŸ¥ä»“åº“è·å–ä¸€çº§åˆ†ç±»çš„æ–¹æ³•const getC1 = () = //é€šçŸ¥åˆ†ç±»ä»“åº“å‘è¯·æ±‚è·å–ä¸€çº§åˆ†ç±»çš„æ•°æ® categoryStore.getC1Action()//äºŒçº§åˆ†ç±»//æ­¤æ–¹æ³•å³ä¸ºä¸€çº§åˆ†ç±»ä¸‹æ‹‰èœå•çš„changeäº‹ä»¶(é€‰ä¸­å€¼çš„æ—¶å€™ä¼šè§¦å‘,ä¿è¯ä¸€çº§åˆ†ç±»IDæœ‰äº†)//ä¼šå°†ä¸€çº§åˆ†ç±»çš„idå›ä¼ const handler = (value: string | number) = //é€šçŸ¥ä»“åº“è·å–äºŒçº§åˆ†ç±»çš„æ•°æ® categoryStore.getC2Action(value)//ä¸‰çº§åˆ†ç±»//æ­¤æ–¹æ³•å³ä¸ºäºŒçº§åˆ†ç±»ä¸‹æ‹‰èœå•çš„changeäº‹ä»¶(é€‰ä¸­å€¼çš„æ—¶å€™ä¼šè§¦å‘,ä¿è¯äºŒçº§åˆ†ç±»IDæœ‰äº†)const handler2 = (value: string | number) = //é€šçŸ¥ä»“åº“è·å–ä¸‰çº§åˆ†ç±»çš„æ•°æ® categoryStore.getC3Action(value)/scriptstyle lang=scss scoped/style é—®é¢˜ å½“æˆ‘ä»¬é€‰æ‹©å¥½ä¸‰çº§èœå•åï¼Œæ­¤æ—¶ä¿®æ”¹ä¸€çº§èœå•ã€‚äºŒã€ä¸‰çº§èœå•åº”è¯¥æ¸…ç©ºã€‚ä¿®æ”¹äºŒçº§èœå•ï¼Œä¸‰çº§èœå•åº”è¯¥æ¸…ç©ºã€‚ src\\components\\Category\\index.vue script setup lang=ts// äºŒçº§åˆ†ç±»//æ­¤æ–¹æ³•å³ä¸ºä¸€çº§åˆ†ç±»ä¸‹æ‹‰èœå•çš„changeäº‹ä»¶(é€‰ä¸­å€¼çš„æ—¶å€™ä¼šè§¦å‘,ä¿è¯ä¸€çº§åˆ†ç±»IDæœ‰äº†)const handler = (value: string | number) = //éœ€è¦å°†äºŒçº§ã€ä¸‰çº§åˆ†ç±»çš„æ•°æ®æ¸…ç©º categoryStore.c2Id = categoryStore.c3Arr = [] categoryStore.c3Id = //é€šçŸ¥ä»“åº“è·å–äºŒçº§åˆ†ç±»çš„æ•°æ® categoryStore.getC2Action(value)// ä¸‰çº§åˆ†ç±»//æ­¤æ–¹æ³•å³ä¸ºäºŒçº§åˆ†ç±»ä¸‹æ‹‰èœå•çš„changeäº‹ä»¶(é€‰ä¸­å€¼çš„æ—¶å€™ä¼šè§¦å‘,ä¿è¯äºŒçº§åˆ†ç±»IDæœ‰äº†)const handler2 = (value: string | number) = //éœ€è¦å°†ä¸‰çº§åˆ†ç±»çš„æ•°æ®æ¸…ç©º categoryStore.c3Arr = [] categoryStore.c3Id = //é€šçŸ¥ä»“åº“è·å–ä¸‰çº§åˆ†ç±»çš„æ•°æ® categoryStore.getC3Action(value)/script æ²¡é€‰æ‹©å¥½ä¸‰çº§èœå•ä¹‹å‰ï¼Œæ·»åŠ å±æ€§æŒ‰é’®åº”è¯¥å¤„äºç¦ç”¨çŠ¶æ€ src\\views\\product\\attr\\index.vue template !-- ä¸‰çº§åˆ†ç±»å…¨å±€ç»„ä»¶-- Category/Category el-card style=margin: 10px 0px el-button type=primary size=default icon=Plus :disabled=categoryStore.c3Id ? false : true æ·»åŠ å±æ€§ /el-button /el-card/templatescript setup lang=tsimport useCategoryStore from @/store/modules/categoryconst categoryStore = useCategoryStore()/scriptstyle lang=scss scoped/style 9.2 å±•ç¤ºå±æ€§ å±æ€§ç±»å‹ src\\api\\product\\attr\\type.ts //å±æ€§å€¼å¯¹è±¡çš„tsç±»å‹export interface AttrValue id?: number valueName: string attrId?: number flag?: boolean//å­˜å‚¨æ¯ä¸€ä¸ªå±æ€§å€¼çš„æ•°ç»„ç±»å‹export type AttrValueList = AttrValue[]//å±æ€§å¯¹è±¡export interface Attr id?: number attrName: string categoryId: number | string categoryLevel: number attrValueList: AttrValueList//å­˜å‚¨æ¯ä¸€ä¸ªå±æ€§å¯¹è±¡çš„æ•°ç»„tsç±»å‹export type AttrList = Attr[]//å±æ€§æ¥å£è¿”å›çš„æ•°æ®tsç±»å‹export interface AttrResponseData extends ResponseData data: Attr[] æ·»åŠ è¯·æ±‚API src\\api\\product\\attr\\index.ts //è¿™é‡Œä¹¦å†™å±æ€§ç›¸å…³çš„APIæ–‡ä»¶import request from @/utils/requestimport AttrResponseData, CategoryResponseData from ./type//å±æ€§ç®¡ç†æ¨¡å—æ¥å£åœ°å€enum API //è·å–åˆ†ç±»ä¸‹å·²æœ‰çš„å±æ€§ä¸å±æ€§å€¼ ATTR_URL = /admin/product/attrInfoList/,//è·å–å¯¹åº”åˆ†ç±»ä¸‹å·²æœ‰çš„å±æ€§ä¸å±æ€§å€¼æ¥å£export const reqAttr = ( category1Id: string | number, category2Id: string | number, category3Id: string | number,) = return request.getany, AttrResponseData( API.ATTR_URL + `$category1Id/$category2Id/$category3Id`, ) æ¸²æŸ“å±æ€§å±•ç¤ºç•Œé¢ src\\views\\product\\attr\\index.vue template !-- ä¸‰çº§åˆ†ç±»å…¨å±€ç»„ä»¶-- Category/Category el-card style=margin: 10px 0px el-button type=primary size=default icon=Plus :disabled=categoryStore.c3Id ? false : true æ·»åŠ å±æ€§ /el-button el-table border style=margin: 10px 0px :data=attrArr el-table-column label=åºå· type=index align=center width=80px /el-table-column el-table-column label=å±æ€§åç§° width=120px prop=attrName /el-table-column el-table-column label=å±æ€§å€¼åç§° !-- rowï¼šå·²æœ‰çš„å±æ€§å¯¹è±¡ -- template #default= row el-tag style=margin: 5px v-for=item in row.attrValueList :key=item.id item.valueName /el-tag /template /el-table-column el-table-column label=æ“ä½œ width=120px !-- rowï¼šå·²æœ‰çš„å±æ€§å¯¹è±¡ -- template #default !-- ä¿®æ”¹å·²æœ‰å±æ€§çš„æŒ‰é’® -- el-button type=primary size=small icon=Edit/el-button el-button type=primary size=small icon=Delete/el-button /template /el-table-column /el-table /el-card/templatescript setup lang=tsimport useCategoryStore from @/store/modules/categoryimport watch, ref from vueimport reqAttr from @/api/product/attrimport AttrResponseData, Attr from @/api/product/attr/typeconst categoryStore = useCategoryStore()// ç›‘å¬c3Idå˜åŒ–watch( () = categoryStore.c3Id, () = //æ¸…ç©ºä¸Šä¸€æ¬¡æŸ¥è¯¢çš„å±æ€§ä¸å±æ€§å€¼ attrArr.value = [] //ä¿è¯ä¸‰çº§åˆ†ç±»å¾—æœ‰æ‰èƒ½å‘è¯·æ±‚ if (!categoryStore.c3Id) return //è·å–åˆ†ç±»çš„ID getAttr() ,)//å­˜å‚¨å·²æœ‰çš„å±æ€§ä¸å±æ€§å€¼let attrArr = refAttr[]([])//è·å–å·²æœ‰çš„å±æ€§ä¸å±æ€§å€¼æ–¹æ³•const getAttr = async () = const c1Id, c2Id, c3Id = categoryStore //è·å–åˆ†ç±»ä¸‹çš„å·²æœ‰çš„å±æ€§ä¸å±æ€§å€¼ let result: AttrResponseData = await reqAttr(c1Id, c2Id, c3Id) if (result.code == 200) attrArr.value = result.data /scriptstyle lang=scss scoped/style å±æ€§å±•ç¤ºæ—¶æœºï¼šéœ€è¦ç­‰ä¸‰çº§åˆ†ç±»ç¡®è®¤åæ‰å–è¯·æ±‚æ•°æ®ï¼Œéœ€è¦ç›‘å¬c3Id c3Idå˜åŒ–æ—¶éœ€è¦æ¸…é™¤ä¸Šæ¬¡çš„å±æ€§å±•ç¤º éœ€è¦ä¿è¯åªæœ‰åœ¨c3Idæ•°æ®ä¸ä¸ºç©ºæ—¶æ‰å»è¯·æ±‚å±æ€§æ•°æ® 9.3 æ·»åŠ å±æ€§ æ·»åŠ å±æ€§å€¼çš„æ€»ä½“æ€è·¯æ˜¯ï¼šæ”¶é›†è¡¨å•çš„æ•°æ®ï¼ˆç»‘å®šå¯¹åº”çš„è¡¨å•é¡¹ç­‰ï¼‰- å‘é€è¯·æ±‚ï¼ˆæŒ‰é’®å›è°ƒå‡½æ•°ï¼Œæºå¸¦çš„å‚æ•°ï¼‰-æ›´æ–°é¡µé¢ é™æ€é¡µé¢ src\\views\\product\\attr\\index.vue el-card style=margin: 10px 0px div ... /div div !-- å±•ç¤ºæ·»åŠ å±æ€§ä¸ä¿®æ”¹æ•°æ®çš„ç»“æ„ -- el-form :inline=true el-form-item label=å±æ€§åç§° el-input placeholder=è¯·ä½ è¾“å…¥å±æ€§åç§°/el-input /el-form-item /el-form el-button type=primary size=default icon=Plus æ·»åŠ å±æ€§å€¼ /el-button el-button type=primary size=defaultå–æ¶ˆ/el-button el-table border style=margin: 10px 0px el-table-column label=åºå· width=80px type=index align=center /el-table-column el-table-column label=å±æ€§å€¼åç§° !-- row:å³ä¸ºå½“å‰å±æ€§å€¼å¯¹è±¡ -- template el-input size=small placeholder=è¯·ä½ è¾“å…¥å±æ€§å€¼åç§°/el-input /template /el-table-column el-table-column label=å±æ€§å€¼æ“ä½œ template el-button type=primary size=small icon=Delete/el-button /template /el-table-column /el-table el-button type=primary size=defaultä¿å­˜/el-button el-button type=primary size=defaultå–æ¶ˆ/el-button /div /el-card å®šä¹‰å˜é‡æ§åˆ¶å±•ç¤ºå±æ€§ç®¡ç†ç•Œé¢è¿˜æ˜¯æ·»åŠ å±æ€§ç•Œé¢ src\\views\\product\\attr\\index.vue // å®šä¹‰å˜é‡æ§åˆ¶æ·»åŠ å±æ€§ç•Œé¢æ˜¯å¦å±•ç¤º,å®šä¹‰cardç»„ä»¶å†…å®¹åˆ‡æ¢å˜é‡let scene = refnumber(0) //scene=0,æ˜¾ç¤ºtable,scene=1,å±•ç¤ºæ·»åŠ ä¸ä¿®æ”¹å±æ€§ç»“æ„ ç»‘å®šæ§åˆ¶å±æ€§ template !-- ä¸‰çº§åˆ†ç±»å…¨å±€ç»„ä»¶-- Category/Category el-card style=margin: 10px 0px div v-if=scene === 0 !-- å±•ç¤ºå±æ€§ç®¡ç† -- ... /div div v-if=scene === 1 !-- å±•ç¤ºæ·»åŠ å±æ€§ä¸ä¿®æ”¹æ•°æ®çš„ç»“æ„ -- ... /div /el-card/template è¿›å…¥æ·»åŠ å±æ€§ç•Œé¢æ—¶ï¼Œä¸‰çº§åˆ†ç±»æŒ‰é’®åº”è¯¥å¤„äºç¦ç”¨çŠ¶æ€ã€‚å°†çˆ¶ç»„ä»¶ä¸­sceneä¼ é€’ç»™å­ç»„ä»¶Category template !-- ä¸‰çº§åˆ†ç±»å…¨å±€ç»„ä»¶-- Category :scene=scene/Category/template å­ç»„ä»¶æ¥æ”¶sceneï¼Œå¹¶æ ¹æ®sceneå€¼æ§åˆ¶é€‰é¡¹æ˜¯å¦ç¦ç”¨ src\\components\\Category\\index.vue template el-card el-form inline el-form-item label=ä¸€çº§åˆ†ç±» el-select :disabled=scene === 0 ? false : true v-model=categoryStore.c1Id @change=handler ... /el-select /el-form-item el-form-item label=äºŒçº§åˆ†ç±» el-select :disabled=scene === 0 ? false : true v-model=categoryStore.c2Id @change=handler2 ... /el-select /el-form-item el-form-item label=ä¸‰çº§åˆ†ç±» el-select :disabled=scene === 0 ? false : true v-model=categoryStore.c3Id ... /el-select /el-form-item /el-form /el-card/templatescript setup lang=ts//æ¥æ”¶çˆ¶ç»„ä»¶ä¼ é€’çš„æ˜¯å¦ç¦ç”¨æ ‡è¯†defineProps([scene])/scriptstyle lang=scss scoped/style æ·»åŠ å±æ€§æŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶ src\\views\\product\\attr\\index.vue template !-- ä¸‰çº§åˆ†ç±»å…¨å±€ç»„ä»¶-- Category :scene=scene/Category el-card style=margin: 10px 0px div v-if=scene === 0 el-button type=primary size=default icon=Plus :disabled=categoryStore.c3Id ? false : true @click=addAttr æ·»åŠ å±æ€§ /el-button ... /div ... /el-card/templatescript setup lang=ts//å®šä¹‰å˜é‡æ§åˆ¶æ·»åŠ å±æ€§ç•Œé¢æ˜¯å¦å±•ç¤º,å®šä¹‰cardç»„ä»¶å†…å®¹åˆ‡æ¢å˜é‡let scene = refnumber(0) //scene=0,æ˜¾ç¤ºtable,scene=1,å±•ç¤ºæ·»åŠ ä¸ä¿®æ”¹å±æ€§ç»“æ„//æ·»åŠ å±æ€§æŒ‰é’®å›è°ƒconst addAttr = () = //åˆ‡æ¢ä¸ºæ·»åŠ ä¸ä¿®æ”¹å±æ€§çš„ç»“æ„ scene.value = 1/scriptstyle lang=scss scoped/style ç‚¹å‡»æ·»åŠ å±æ€§å€¼æ—¶ï¼Œåˆ—è¡¨ä¸­æ·»åŠ ä¸€æ¡å±æ€§ å®šä¹‰å˜é‡æ”¶é›†å±æ€§å€¼åˆ—è¡¨æ•°æ® //æ”¶é›†æ–°å¢çš„å±æ€§çš„æ•°æ®let attrParams = reactiveAttr( attrName: , //æ–°å¢çš„å±æ€§çš„åå­— attrValueList: [ //æ–°å¢çš„å±æ€§å€¼æ•°ç»„ ], categoryId: , //ä¸‰çº§åˆ†ç±»çš„ID categoryLevel: 3, //ä»£è¡¨çš„æ˜¯ä¸‰çº§åˆ†ç±») æ·»åŠ å±æ€§å€¼æŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶ æ¯æ¬¡ç‚¹å‡»æ·»åŠ å±æ€§å€¼æŒ‰é’®æ—¶ï¼Œæ–°å¢ä¸€æ¡ç©ºæ•°æ® template div v-if=scene === 1 !-- å±•ç¤ºæ·»åŠ å±æ€§ä¸ä¿®æ”¹æ•°æ®çš„ç»“æ„ -- el-form :inline=true el-form-item label=å±æ€§åç§° el-input placeholder=è¯·ä½ è¾“å…¥å±æ€§åç§° /el-input /el-form-item /el-form el-button type=primary size=default icon=Plus @click=addAttrValue æ·»åŠ å±æ€§å€¼ /el-button ...\t/div/templatescrpit setup lang=ts //æ·»åŠ å±æ€§å€¼ const addAttrValue = () = attrParams.attrValueList.push( valueName: , )/scrpit æ¸²æŸ“å±æ€§åˆ—è¡¨ template !-- ä¸‰çº§åˆ†ç±»å…¨å±€ç»„ä»¶-- Category :scene=scene/Category el-card style=margin: 10px 0px div v-if=scene === 0 ... /div div v-if=scene === 1 !-- å±•ç¤ºæ·»åŠ å±æ€§ä¸ä¿®æ”¹æ•°æ®çš„ç»“æ„ -- el-form :inline=true el-form-item label=å±æ€§åç§° el-input placeholder=è¯·ä½ è¾“å…¥å±æ€§åç§° v-model=attrParams.attrName /el-input /el-form-item /el-form el-button type=primary size=default icon=Plus @click=addAttrValue æ·»åŠ å±æ€§å€¼ /el-button el-button type=primary size=defaultå–æ¶ˆ/el-button el-table border style=margin: 10px 0px :data=attrParams.attrValueList el-table-column label=åºå· width=80px type=index align=center /el-table-column el-table-column label=å±æ€§å€¼ !-- row:å³ä¸ºå½“å‰å±æ€§å€¼å¯¹è±¡ -- template #default= row el-input size=small placeholder=è¯·ä½ è¾“å…¥å±æ€§å€¼ v-model=row.valueName /el-input /template /el-table-column el-table-column label=å±æ€§å€¼æ“ä½œ template #default el-button type=primary size=small icon=Delete /el-button /template /el-table-column /el-table el-button type=primary size=default ä¿å­˜ /el-button el-button type=primary size=defaultå–æ¶ˆ/el-button /div /el-card/template åˆ‡æ¢å±æ€§å€¼å±•ç¤ºå½¢æ€ å±æ€§å€¼è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹æ—¶å°†è¾“å…¥æ¡†åˆ‡æ¢æˆç›´æ¥å±•ç¤ºå±æ€§å€¼ æ·»åŠ é™æ€ç•Œé¢ el-table-column label=å±æ€§å€¼ !-- row:å³ä¸ºå½“å‰å±æ€§å€¼å¯¹è±¡ -- template #default= row, $index el-input size=small placeholder=è¯·ä½ è¾“å…¥å±æ€§å€¼ v-model=row.valueName v-if=row.flag /el-input div v-else row.valueName /div /template/el-table-column flagæ”¾åœ¨å“ªï¼Ÿç”±äºæ¯ä¸€ä¸ªå±æ€§å€¼å¯¹è±¡éƒ½éœ€è¦ä¸€ä¸ªflagå±æ€§ï¼Œå› æ­¤å°†flagçš„æ·»åŠ æ”¾åœ¨æ·»åŠ å±æ€§å€¼çš„æŒ‰é’®çš„å›è°ƒä¸Šã€‚ï¼ˆæ³¨æ„ä¿®æ”¹å±æ€§å€¼çš„typeï¼‰ src\\api\\product\\attr\\type.ts //å±æ€§å€¼å¯¹è±¡çš„tsç±»å‹export interface AttrValue id?: number valueName: string attrId?: number flag?: boolean src\\views\\product\\attr\\index.vue //æ·»åŠ å±æ€§å€¼const addAttrValue = () = attrParams.attrValueList.push( valueName: , flag: true, //æ§åˆ¶æ¯ä¸€ä¸ªå±æ€§å€¼ç¼–è¾‘æ¨¡å¼ä¸åˆ‡æ¢æ¨¡å¼çš„åˆ‡æ¢ ) å±æ€§è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹æ—¶éœ€è¦åˆ‡æ¢æˆç›´æ¥å±•ç¤ºï¼Œç‚¹å‡»å±æ€§å€¼æ—¶åˆ‡æ¢æˆè¾“å…¥æ¡† template el-table-column label=å±æ€§å€¼ !-- row:å³ä¸ºå½“å‰å±æ€§å€¼å¯¹è±¡ -- template #default= row, $index el-input size=small placeholder=è¯·ä½ è¾“å…¥å±æ€§å€¼ v-model=row.valueName v-if=row.flag @blur=toLook(row, $index) /el-input div v-else @click=toEdit(row, $index) row.valueName /div /template /el-table-column/template scrpit setup lang=ts//å±æ€§å€¼è¡¨å•å…ƒç´ å¤±å´ç„¦ç‚¹äº‹ä»¶å›è°ƒconst toLook = (row: AttrValue, $index: number) = //ç›¸åº”çš„å±æ€§å€¼å¯¹è±¡flag:å˜ä¸ºfalse,å±•ç¤ºdiv row.flag = false//å±æ€§å€¼divç‚¹å‡»äº‹ä»¶const toEdit = (row: AttrValue, $index: number) = //ç›¸åº”çš„å±æ€§å€¼å¯¹è±¡flag:å˜ä¸ºtrue,å±•ç¤ºinput row.flag = true/scrpit æ§åˆ¶ç‚¹å‡»å±æ€§å€¼æ—¶è¾“å…¥æ¡†è‡ªåŠ¨èšç„¦ template el-table-column label=å±æ€§å€¼ !-- row:å³ä¸ºå½“å‰å±æ€§å€¼å¯¹è±¡ -- template #default= row, $index el-input size=small placeholder=è¯·ä½ è¾“å…¥å±æ€§å€¼ v-model=row.valueName v-if=row.flag @blur=toLook(row, $index) :ref=(inupt: any) = (inputArr[$index] = inupt) /el-input div v-else @click=toEdit(row, $index) row.valueName /div /template /el-table-column/template scrpit setup lang=ts//å‡†å¤‡ä¸€ä¸ªæ•°ç»„:å°†æ¥å­˜å‚¨å¯¹åº”çš„ç»„ä»¶å®ä¾‹el-inputlet inputArr = refany([])//å±æ€§å€¼divç‚¹å‡»äº‹ä»¶const toEdit = (row: AttrValue, $index: number) = //ç›¸åº”çš„å±æ€§å€¼å¯¹è±¡flag:å˜ä¸ºtrue,å±•ç¤ºinput row.flag = true //nextTick:å“åº”å¼æ•°æ®å‘ç”Ÿå˜åŒ–,è·å–æ›´æ–°çš„DOM(ç»„ä»¶å®ä¾‹) nextTick(() = inputArr.value[$index].focus() )/scrpit å±æ€§å€¼æ“ä½œç»‘å®šç‚¹å‡»äº‹ä»¶ ç‚¹å‡»æ—¶å°†å±æ€§å€¼æ•°ç»„ä¸­å»é™¤è¯¥æ¡æ•°æ® el-table-column label=å±æ€§å€¼æ“ä½œ template #default= index el-button type=primary size=small icon=Delete @click=attrParams.attrValueList.splice(index, 1) /el-button /template/el-table-column ç»‘å®šä¿å­˜æŒ‰é’®ç‚¹å‡»äº‹ä»¶ ç•Œé¢ el-button type=primary size=default @click=save(attrParams) ä¿å­˜/el-button æ·»åŠ API src\\api\\product\\attr\\index.ts //è¿™é‡Œä¹¦å†™å±æ€§ç›¸å…³çš„APIæ–‡ä»¶import request from @/utils/requestimport AttrResponseData, CategoryResponseData from ./type//å±æ€§ç®¡ç†æ¨¡å—æ¥å£åœ°å€enum API //æ·»åŠ æˆ–è€…ä¿®æ”¹å·²æœ‰çš„å±æ€§çš„æ¥å£ ADDORUPDATEATTR_URL = /admin/product/saveAttrInfo,//æ–°å¢æˆ–è€…ä¿®æ”¹å·²æœ‰çš„å±æ€§æ¥å£export const reqAddOrUpdateAttr = (data: Attr) = request.postany, any(API.ADDORUPDATEATTR_URL, data) å®šä¹‰ç‚¹å‡»äº‹ä»¶å‡½æ•° //ä¿å­˜å±æ€§æŒ‰é’®å›è°ƒconst save = async (attrParams: Attr) = //å‘è¯·æ±‚ let result: any = await reqAddOrUpdateAttr(attrParams) //æ·»åŠ å±æ€§|ä¿®æ”¹å·²æœ‰çš„å±æ€§å·²ç»æˆåŠŸ if (result.code == 200) //åˆ‡æ¢åœºæ™¯ scene.value = 0 //æç¤ºä¿¡æ¯ ElMessage( type: success, message: attrParams.id ? ä¿®æ”¹æˆåŠŸ : æ·»åŠ æˆåŠŸ, ) //è·å–å…¨éƒ¨å·²æœ‰çš„å±æ€§ä¸å±æ€§å€¼ï¼ˆæ›´æ–°é¡µé¢ï¼‰ getAttr() else ElMessage( type: error, message: attrParams.id ? ä¿®æ”¹å¤±è´¥ : æ·»åŠ å¤±è´¥, ) 9.4 ä¿®æ”¹å±æ€§ ç»‘å®šä¿®æ”¹æŒ‰é’®ç‚¹å‡»äº‹ä»¶ el-table-column label=æ“ä½œ width=120px !-- rowï¼šå·²æœ‰çš„å±æ€§å¯¹è±¡ -- template #default= row !-- ä¿®æ”¹å·²æœ‰å±æ€§çš„æŒ‰é’® -- el-button type=primary size=small icon=Edit @click=updateAttr(row) /el-button /template/el-table-column å®šä¹‰å‡½æ•° //tableè¡¨æ ¼ä¿®æ”¹å·²æœ‰å±æ€§æŒ‰é’®çš„å›è°ƒconst updateAttr = (row: Attr) = //åˆ‡æ¢ä¸ºæ·»åŠ ä¸ä¿®æ”¹å±æ€§çš„ç»“æ„ scene.value = 1 //å°†å·²æœ‰çš„å±æ€§å¯¹è±¡èµ‹å€¼ç»™attrParamså¯¹è±¡å³ä¸º //ES6-Object.assignè¿›è¡Œå¯¹è±¡çš„åˆå¹¶ Object.assign(attrParams, JSON.parse(JSON.stringify(row))) 9.5 åˆ é™¤å±æ€§ ç»‘å®šç‚¹å‡»äº‹ä»¶ el-table-column label=æ“ä½œ width=120px el-popconfirm :title=`ä½ ç¡®å®šåˆ é™¤$row.attrName` width=200px @confirm=deleteAttr(row.id) template #reference el-button type=primary size=small icon=Delete /el-button /template /el-popconfirm /template/el-table-column å®šä¹‰API //è¿™é‡Œä¹¦å†™å±æ€§ç›¸å…³çš„APIæ–‡ä»¶import request from @/utils/requestimport AttrResponseData, CategoryResponseData from ./type//å±æ€§ç®¡ç†æ¨¡å—æ¥å£åœ°å€enum API //åˆ é™¤æŸä¸€ä¸ªå·²æœ‰çš„å±æ€§ DELETEATTR_URL = /admin/product/deleteAttr/,//åˆ é™¤æŸä¸€ä¸ªå·²æœ‰çš„å±æ€§ä¸šåŠ¡export const reqRemoveAttr = (attrId: number) = request.deleteany, any(API.DELETEATTR_URL + attrId) å®šä¹‰ç‚¹å‡»å‡½æ•° //åˆ é™¤æŸä¸€ä¸ªå·²æœ‰çš„å±æ€§æ–¹æ³•å›è°ƒconst deleteAttr = async (attrId: number) = //å‘ç›¸åº”çš„åˆ é™¤å·²æœ‰çš„å±æ€§çš„è¯·æ±‚ let result: any = await reqRemoveAttr(attrId) //åˆ é™¤æˆåŠŸ if (result.code == 200) ElMessage( type: success, message: åˆ é™¤æˆåŠŸ, ) //è·å–ä¸€æ¬¡å·²æœ‰çš„å±æ€§ä¸å±æ€§å€¼ getAttr() else ElMessage( type: error, message: åˆ é™¤å¤±è´¥, ) 9.6 æ·»åŠ æ ¡éªŒ æ— å±æ€§åç§°æ—¶ï¼Œç¦ç”¨æ·»åŠ å±æ€§å€¼æŒ‰é’® el-button type=primary size=default icon=Plus @click=addAttrValue :disabled=attrParams.attrName === ? true : false æ·»åŠ å±æ€§å€¼/el-button æ·»åŠ å±æ€§å€¼æ—¶ï¼Œæ ¡éªŒå±æ€§å€¼æ˜¯å¦ä¸ºç©º // éæ³•æ ¡éªŒconst check = (len: number) = //éæ³•æƒ…å†µåˆ¤æ–­1 if (attrParams.attrValueList[len - 1].valueName.trim() == ) //åˆ é™¤è°ƒç”¨å¯¹åº”å±æ€§å€¼ä¸ºç©ºçš„å…ƒç´  attrParams.attrValueList.splice(len - 1, 1) //æç¤ºä¿¡æ¯ ElMessage( type: error, message: å±æ€§å€¼ä¸èƒ½ä¸ºç©º, ) return //æ·»åŠ å±æ€§å€¼const addAttrValue = () = // æ ¡éªŒå¦‚æœæ˜¯ const len = attrParams.attrValueList.length if (len = 1) //éæ³•æƒ…å†µåˆ¤æ–­1 check(len) attrParams.attrValueList.push( valueName: , flag: true, //æ§åˆ¶æ¯ä¸€ä¸ªå±æ€§å€¼ç¼–è¾‘æ¨¡å¼ä¸åˆ‡æ¢æ¨¡å¼çš„åˆ‡æ¢ ) å±æ€§å€¼è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹æ—¶æ ¡éªŒ //å±æ€§å€¼è¡¨å•å…ƒç´ å¤±å´ç„¦ç‚¹äº‹ä»¶å›è°ƒconst toLook = (row: AttrValue, $index: number) = //éæ³•æƒ…å†µåˆ¤æ–­1 if (row.valueName.trim() == ) //åˆ é™¤è°ƒç”¨å¯¹åº”å±æ€§å€¼ä¸ºç©ºçš„å…ƒç´  attrParams.attrValueList.splice($index, 1) //æç¤ºä¿¡æ¯ ElMessage( type: error, message: å±æ€§å€¼ä¸èƒ½ä¸ºç©º, ) return //éæ³•æƒ…å†µ2 let repeat = attrParams.attrValueList.find((item) = //åˆ‡è®°æŠŠå½“å‰å¤±å´ç„¦ç‚¹å±æ€§å€¼å¯¹è±¡ä»å½“å‰æ•°ç»„æ‰£é™¤åˆ¤æ–­ if (item != row) return item.valueName === row.valueName ) if (repeat) //å°†é‡å¤çš„å±æ€§å€¼ä»æ•°ç»„å½“ä¸­å¹²æ‰ attrParams.attrValueList.splice($index, 1) //æç¤ºä¿¡æ¯ ElMessage( type: error, message: å±æ€§å€¼ä¸èƒ½é‡å¤, ) return //ç›¸åº”çš„å±æ€§å€¼å¯¹è±¡flag:å˜ä¸ºfalse,å±•ç¤ºdiv row.flag = false 9.7 åŠŸèƒ½å®Œå–„ æ·»åŠ å±æ€§æ—¶ï¼Œè‡ªåŠ¨èšç„¦åˆ°å±æ€§å€¼è¾“å…¥æ¡† //æ·»åŠ å±æ€§å€¼const addAttrValue = () = // æ ¡éªŒå¦‚æœæ˜¯ const len = attrParams.attrValueList.length if (len = 1) //éæ³•æƒ…å†µåˆ¤æ–­1 check(len) attrParams.attrValueList.push( valueName: , flag: true, //æ§åˆ¶æ¯ä¸€ä¸ªå±æ€§å€¼ç¼–è¾‘æ¨¡å¼ä¸åˆ‡æ¢æ¨¡å¼çš„åˆ‡æ¢ ) nextTick(() = inputArr.value[len].focus() ) æ·»åŠ å±æ€§æŒ‰é’®å¢åŠ idå±æ€§ï¼Œæ¸…ç©ºidå¦åˆ™ä¼šå‡ºç°å…ˆç‚¹å‡»ä¿®æ”¹å±æ€§ï¼Œå†ç‚¹å‡»æ–°å¢å±æ€§ä¼šå˜æˆä¿®æ”¹å±æ€§ //æ·»åŠ å±æ€§æŒ‰é’®å›è°ƒconst addAttr = () = //æ¯ä¸€æ¬¡ç‚¹å‡»çš„æ—¶å€™,å…ˆæ¸…ç©ºä¸€ä¸‹æ•°æ®å†æ”¶é›†æ•°æ®ï¼Œä¸»è¦æ”¶é›†ä¸‰çº§åˆ†ç±»çš„ID Object.assign(attrParams, attrName: , //æ–°å¢çš„å±æ€§çš„åå­— attrValueList: [ //æ–°å¢çš„å±æ€§å€¼æ•°ç»„ ], categoryId: categoryStore.c3Id, //ä¸‰çº§åˆ†ç±»çš„ID categoryLevel: 3, //ä»£è¡¨çš„æ˜¯ä¸‰çº§åˆ†ç±» id: null, ) //åˆ‡æ¢ä¸ºæ·»åŠ ä¸ä¿®æ”¹å±æ€§çš„ç»“æ„ scene.value = 1 æ·»åŠ å–æ¶ˆæŒ‰é’®é€»è¾‘ æ·»åŠ å±æ€§å€¼çš„å–æ¶ˆ æ¸…ç©ºå±æ€§å€¼åˆ—è¡¨ el-button type=primary size=default @click=attrParams.attrValueList = [] å–æ¶ˆ/el-button å–æ¶ˆè¿”å›å±æ€§å±•ç¤ºç•Œé¢ el-button type=primary size=default @click=scene = 0 å–æ¶ˆ/el-button è·¯ç”±åˆ‡æ¢æ—¶æ¸…ç©ºåˆ†ç±»ä»“åº“ //è·¯ç”±ç»„ä»¶é”€æ¯çš„æ—¶å€™ï¼ŒæŠŠä»“åº“åˆ†ç±»ç›¸å…³çš„æ•°æ®æ¸…ç©ºonBeforeUnmount(() = //æ¸…ç©ºä»“åº“çš„æ•°æ® categoryStore.$reset()) 10. SPUç®¡ç†10.1 SPUå±•ç¤º é™æ€é¡µé¢ src\\views\\product\\spu\\index.vue template div !-- ä¸‰çº§åˆ†ç±» -- Category :scene=scene/Category el-card style=margin: 10px 0px el-button type=primary size=default icon=Plusæ·»åŠ SPU/el-button el-table border style=margin: 10px 0px el-table-column label=åºå· type=index align=center width=80px /el-table-column el-table-column label=SPUåç§°/el-table-column el-table-column label=SPUæè¿°/el-table-column el-table-column label=SPUæ“ä½œ/el-table-column /el-table /el-card !-- åˆ†é¡µå™¨ -- el-pagination v-model:current-page=pageNo v-model:page-size=pageSize :page-sizes=[3, 5, 7, 9] :background=true layout= prev, pager, next, jumper,-, sizes,total :total=400 / /div/templatescript setup lang=tsimport ref from vue//åœºæ™¯çš„æ•°æ®let scene = refnumber(0)//åˆ†é¡µå™¨é»˜è®¤é¡µç let pageNo = refnumber(1)//æ¯ä¸€é¡µå±•ç¤ºå‡ æ¡æ•°æ®let pageSize = refnumber(3)/scriptstyle lang=scss scoped/style SPUæ•°æ®ç±»å‹ src\\api\\product\\spu\\type.ts //æœåŠ¡å™¨å…¨éƒ¨æ¥å£è¿”å›çš„æ•°æ®ç±»å‹export interface ResponseData code: number message: string ok: boolean//SPUæ•°æ®çš„tsç±»å‹:éœ€è¦ä¿®æ”¹export interface SpuData category3Id: number id?: number spuName: string tmId: number description: string spuImageList: null spuSaleAttrList: null//æ•°ç»„:å…ƒç´ éƒ½æ˜¯å·²æœ‰SPUæ•°æ®ç±»å‹export type Records = SpuData[]//å®šä¹‰è·å–å·²æœ‰çš„SPUæ¥å£è¿”å›çš„æ•°æ®tsç±»å‹export interface HasSpuResponseData extends ResponseData data: records: Records total: number size: number current: number searchCount: boolean pages: number è·å–SPU API src\\api\\product\\spu\\index.ts //SPUç®¡ç†æ¨¡å—çš„æ¥å£import request from @/utils/requestimport type HasSpuResponseData from ./typeenum API //è·å–å·²æœ‰çš„SPUçš„æ•°æ® HASSPU_URL = /admin/product/,//è·å–æŸä¸€ä¸ªä¸‰çº§åˆ†ç±»ä¸‹å·²æœ‰çš„SPUæ•°æ®export const reqHasSpu = ( page: number, limit: number, category3Id: string | number,) = return request.getany, HasSpuResponseData( API.HASSPU_URL + `$page/$limit?category3Id=$category3Id`, ) æ¸²æŸ“å±•ç¤ºç•Œé¢ src\\views\\product\\spu\\index.vue template div !-- ä¸‰çº§åˆ†ç±» -- Category :scene=scene/Category el-card style=margin: 10px 0px el-button type=primary size=default icon=Plus :disabled=categoryStore.c3Id ? false : true æ·»åŠ SPU /el-button el-table border style=margin: 10px 0px :data=records el-table-column label=åºå· type=index align=center width=80px /el-table-column el-table-column label=SPUåç§° prop=spuName/el-table-column el-table-column label=SPUæè¿° prop=description/el-table-column el-table-column label=SPUæ“ä½œ/el-table-column /el-table /el-card !-- åˆ†é¡µå™¨ -- el-pagination v-model:current-page=pageNo v-model:page-size=pageSize :page-sizes=[3, 5, 7, 9] :background=true layout=prev, pager, next, jumper,-, sizes,total :total=total @current-change=getHasSpu @size-change=changeSize / /div/templatescript setup lang=tsimport ref, watch from vueimport useCategoryStore from @/store/modules/categoryimport reqHasSpu from @/api/product/spuimport HasSpuResponseData from @/api/product/spu/type//åˆ†ç±»ä»“åº“æ•°æ®const categoryStore = useCategoryStore()//åœºæ™¯çš„æ•°æ®let scene = refnumber(0)//åˆ†é¡µå™¨é»˜è®¤é¡µç let pageNo = refnumber(1)//æ¯ä¸€é¡µå±•ç¤ºå‡ æ¡æ•°æ®let pageSize = refnumber(3)// å­˜å‚¨å·²æœ‰å“ç‰Œæ•°æ®æ€»æ•°let total = refnumber(0)// å­˜å‚¨å·²æœ‰SPUçš„æ•°æ®let records = refany([])//æ­¤æ–¹æ³•æ‰§è¡Œ:å¯ä»¥è·å–æŸä¸€ä¸ªä¸‰çº§åˆ†ç±»ä¸‹å…¨éƒ¨çš„å·²æœ‰çš„SPUconst getHasSpu = async (pager = 1) = console.log(pager) //ä¿®æ”¹å½“å‰é¡µç  pageNo.value = pager let result: HasSpuResponseData = await reqHasSpu( pageNo.value, pageSize.value, categoryStore.c3Id, ) if (result.code == 200) records.value = result.data.records total.value = result.data.total // ç›‘å¬c3Idå˜åŒ–watch( () = categoryStore.c3Id, () = //æ¸…ç©ºä¸Šä¸€æ¬¡æŸ¥è¯¢çš„SPU records.value = [] //ä¿è¯ä¸‰çº§åˆ†ç±»å¾—æœ‰æ‰èƒ½å‘è¯·æ±‚ if (!categoryStore.c3Id) return //è·å–SPU getHasSpu() ,)//åˆ†é¡µå™¨ä¸‹æ‹‰èœå•å‘ç”Ÿå˜åŒ–çš„æ—¶å€™è§¦å‘const changeSize = () = getHasSpu()/scriptstyle lang=scss scoped/style 10.2 æ·»åŠ SPUå­ç»„ä»¶ åŸå›  ç”±äºSPUæ¨¡å—éœ€è¦åœ¨ä¸‰ä¸ªåœºæ™¯è¿›è¡Œåˆ‡æ¢ï¼Œå…¨éƒ½æ”¾åœ¨ä¸€ä¸ªç»„ä»¶é‡Œé¢çš„è¯ä¼šæ˜¾å¾—å¾ˆè‡ƒè‚¿ã€‚å› æ­¤æˆ‘ä»¬å°†å®ƒæ”¾åˆ°ä¸‰ä¸ªç»„ä»¶å½“ä¸­ã€‚ ä½¿ç”¨v-showæ¥å±•ç¤ºé¡µé¢ï¼šv-ifæ˜¯é”€æ¯ç»„ä»¶ï¼Œv-showæ˜¯éšè—ç»„ä»¶ã€‚åœ¨åˆåŠ è½½çš„æ—¶å€™v-ifæ¯”è¾ƒå¿«ï¼Œä½†æ˜¯åœ¨é¢‘ç¹åˆ‡æ¢çš„æ—¶å€™v-ifä»»åŠ¡é‡ã€‚ é™æ€ç•Œé¢ src\\views\\product\\spu\\spuForm.vue template el-card style=margin: 10px 0px el-form label-width=100px el-form-item label=SPUåç§° el-input placeholder=è¯·ä½ è¾“å…¥SPUåç§°/el-input /el-form-item el-form-item label=SPUå“ç‰Œ el-select el-option label=åä¸º/el-option el-option label=oppo/el-option el-option label=vivo/el-option /el-select /el-form-item el-form-item label=SPUæè¿° el-input type=textarea placeholder=è¯·ä½ è¾“å…¥SPUæè¿°/el-input /el-form-item el-form-item label=SPUå›¾ç‰‡ el-upload action=https://run.mocky.io/v3/9d059bf9-4660-45f2-925d-ce80ad6c4d15 list-type=picture-card el-iconPlus //el-icon /el-upload el-dialog img w-full src= alt=Preview Image / /el-dialog /el-form-item el-form-item label=SPUé”€å”®å±æ€§ size=normal !-- å±•ç¤ºé”€å”®å±æ€§çš„ä¸‹æ‹‰èœå• -- el-select el-option label=åä¸º/el-option el-option label=oppo/el-option el-option label=vivo/el-option /el-select el-button style=margin-left: 10px type=primary size=default icon=Plus æ·»åŠ å±æ€§ /el-button !-- tableå±•ç¤ºé”€å”®å±æ€§ä¸å±æ€§å€¼çš„åœ°æ–¹ -- el-table border style=margin: 10px 0px el-table-column label=åºå· type=index align=center width=80px /el-table-column el-table-column label=é”€å”®å±æ€§åå­— width=120px prop=saleAttrName /el-table-column el-table-column label=é”€å”®å±æ€§å€¼ !-- row:å³ä¸ºå½“å‰SPUå·²æœ‰çš„é”€å”®å±æ€§å¯¹è±¡ -- /el-table-column el-table-column label=æ“ä½œ width=120px/el-table-column /el-table /el-form-item el-form-item el-button type=primary size=defaultä¿å­˜/el-button el-button type=primary size=default å–æ¶ˆ /el-button /el-form-item /el-form /el-card/templatescript setup lang=ts/script æ·»åŠ ã€ä¿®æ”¹SPUæŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶ src\\views\\product\\spu\\index.vue template div !-- ä¸‰çº§åˆ†ç±» -- Category :scene=scene/Category !-- SPUå±•ç¤ºé¡µé¢ -- div v-show=scene === 0 el-card style=margin: 10px 0px el-button type=primary size=default icon=Plus :disabled=categoryStore.c3Id ? false : true @click=addSpu æ·»åŠ SPU /el-button el-table border style=margin: 10px 0px :data=records el-table-column label=åºå· type=index align=center width=80px /el-table-column el-table-column label=SPUåç§° prop=spuName/el-table-column el-table-column label=SPUæè¿° prop=description/el-table-column el-table-column label=SPUæ“ä½œ !-- row å›ä¼ ç¼–è¾‘æ•°æ® -- template #default= row el-button type=primary size=small icon=Edit @click=updateSpu /el-button /template /el-table-column /el-table /el-card /div !-- SPUç¼–è¾‘é¡µé¢ -- SpuForm v-show=scene === 1 @changeScene=changeScene/SpuForm !-- åˆ†é¡µå™¨ -- el-pagination v-model:current-page=pageNo v-model:page-size=pageSize :page-sizes=[3, 5, 7, 9] :background=true layout=prev, pager, next, jumper,-, sizes,total :total=total @current-change=getHasSpu @size-change=changeSize / /div/template script setup lang=ts//æ·»åŠ æ–°çš„SPUæŒ‰é’®çš„å›è°ƒconst addSpu = () = //åˆ‡æ¢ä¸ºåœºæ™¯1:æ·»åŠ ä¸ä¿®æ”¹å·²æœ‰SPUç»“æ„-SpuForm scene.value = 1//ä¿®æ”¹å·²æœ‰çš„SPUçš„æŒ‰é’®çš„å›è°ƒconst updateSpu = () = //åˆ‡æ¢ä¸ºåœºæ™¯1:æ·»åŠ ä¸ä¿®æ”¹å·²æœ‰SPUç»“æ„-SpuForm scene.value = 1const changeScene = () = scene.value = 0/script å­ç»„ä»¶å–æ¶ˆæŒ‰é’®å›è°ƒ src\\views\\product\\spu\\spuForm.vue template el-button size=default @click=cancle å–æ¶ˆ /el-button/template script setup lang=ts//å®šä¹‰å­ä¼ çˆ¶const emit = defineEmits([changeScene])//å–æ¶ˆæŒ‰é’®çš„å›è°ƒconst cancle = () = emit(changeScene, 0)/script 10.3 æ·»åŠ SPUæ¨¡å—ç±»å‹API10.3.1 SPUå“ç‰Œ ç±»å‹ src\\api\\product\\spu\\type.ts //å“ç‰Œæ•°æ®çš„TSç±»å‹export interface Trademark id: number tmName: string logoUrl: string//å“ç‰Œæ¥å£è¿”å›çš„æ•°æ®tsç±»å‹export interface AllTradeMark extends ResponseData data: Trademark[] API src\\api\\product\\spu\\index.ts enum API //è·å–å·²æœ‰çš„SPUçš„æ•°æ® HASSPU_URL = /admin/product/, //è·å–å…¨éƒ¨å“ç‰Œçš„æ•°æ® ALLTRADEMARK_URL = /admin/product/baseTrademark/getTrademarkList,//è·å–å…¨éƒ¨çš„SPUçš„å“ç‰Œçš„æ•°æ®export const reqAllTradeMark = () = return request.getany, AllTradeMark(API.ALLTRADEMARK_URL) 10.3.2 SPUå›¾ç‰‡ ç±»å‹ //å•†å“å›¾ç‰‡çš„tsç±»å‹export interface SpuImg id?: number imgName?: string imgUrl?: string createTime?: string updateTime?: string spuId?: number//å·²æœ‰çš„SPUçš„ç…§ç‰‡å¢™æ•°æ®çš„ç±»å‹export interface SpuHasImg extends ResponseData data: SpuImg[] API enum API //è·å–å·²æœ‰çš„SPUçš„æ•°æ® HASSPU_URL = /admin/product/, //è·å–å…¨éƒ¨å“ç‰Œçš„æ•°æ® ALLTRADEMARK_URL = /admin/product/baseTrademark/getTrademarkList, //è·å–æŸä¸ªSPUä¸‹çš„å…¨éƒ¨çš„å”®å–å•†å“çš„å›¾ç‰‡æ•°æ® IMAGE_URL = /admin/product/spuImageList/,//è·å–æŸä¸€ä¸ªå·²æœ‰çš„SPUä¸‹å…¨éƒ¨å•†å“çš„å›¾ç‰‡åœ°å€export const reqSpuImageList = (spuId: number) = return request.getany, SpuHasImg(API.IMAGE_URL + spuId) 10.3.3 å…¨éƒ¨é”€å”®å±æ€§ ç±»å‹ //å·²æœ‰çš„å…¨éƒ¨SPUçš„è¿”å›æ•°æ®tsç±»å‹export interface HasSaleAttr id: number name: stringexport interface HasSaleAttrResponseData extends ResponseData data: HasSaleAttr[] API enum API //è·å–å·²æœ‰çš„SPUçš„æ•°æ® HASSPU_URL = /admin/product/, //è·å–å…¨éƒ¨å“ç‰Œçš„æ•°æ® ALLTRADEMARK_URL = /admin/product/baseTrademark/getTrademarkList, //è·å–æŸä¸ªSPUä¸‹çš„å…¨éƒ¨çš„å”®å–å•†å“çš„å›¾ç‰‡æ•°æ® IMAGE_URL = /admin/product/spuImageList/, //è·å–æ•´ä¸ªé¡¹ç›®å…¨éƒ¨çš„é”€å”®å±æ€§[é¢œè‰²ã€ç‰ˆæœ¬ã€å°ºç ] ALLSALEATTR_URL = /admin/product/baseSaleAttrList,//è·å–å…¨éƒ¨çš„é”€å”®å±æ€§export const reqAllSaleAttr = () = return request.getany, HasSaleAttrResponseData(API.ALLSALEATTR_URL) 10.3.4 é”€å”®å±æ€§åŠå…¶å€¼åˆ—è¡¨ ç±»å‹ export interface SpuSaleAttrValue id?: number createTime?: Date updateTime?: Date spuId?: number baseSaleAttrId: number saleAttrValueName: string saleAttrName?: string isChecked?: boolean//é”€å”®å±æ€§å¯¹è±¡tsç±»å‹export interface SaleAttr id?: number createTime?: string updateTime?: string spuId?: number baseSaleAttrId: number saleAttrName: string spuSaleAttrValueList: SpuSaleAttrValue[] flag?: boolean//SPUå·²æœ‰çš„é”€å”®å±æ€§æ¥å£è¿”å›æ•°æ®tsç±»å‹export interface SaleAttrResponseData extends ResponseData data: SaleAttr[] API enum API //è·å–å·²æœ‰çš„SPUçš„æ•°æ® HASSPU_URL = /admin/product/, //è·å–å…¨éƒ¨å“ç‰Œçš„æ•°æ® ALLTRADEMARK_URL = /admin/product/baseTrademark/getTrademarkList, //è·å–æŸä¸ªSPUä¸‹çš„å…¨éƒ¨çš„å”®å–å•†å“çš„å›¾ç‰‡æ•°æ® IMAGE_URL = /admin/product/spuImageList/, //è·å–æ•´ä¸ªé¡¹ç›®å…¨éƒ¨çš„é”€å”®å±æ€§[é¢œè‰²ã€ç‰ˆæœ¬ã€å°ºç ] ALLSALEATTR_URL = /admin/product/baseSaleAttrList, //è·å–æŸä¸€ä¸ªSPUä¸‹å…¨éƒ¨çš„å·²æœ‰çš„é”€å”®å±æ€§æ¥å£åœ°å€ SPUHASSALEATTR_URL = /admin/product/spuSaleAttrList/,//è·å–æŸä¸€ä¸ªå·²æœ‰çš„SPUæ‹¥æœ‰å¤šå°‘ä¸ªé”€å”®å±æ€§export const reqSpuHasSaleAttr = (spuId: number) = return request.getany, SaleAttrResponseData(API.SPUHASSALEATTR_URL + spuId) 10.4 è·å–SPUçš„æ•°æ® è¯´æ˜ SPUçš„æ•°æ®åº”è¯¥åˆ†ä¸º5éƒ¨åˆ†ï¼š ç¬¬ä¸€éƒ¨åˆ†ï¼šçˆ¶ç»„ä»¶ä¸­çš„å±•ç¤ºçš„æ•°æ®ï¼Œå½“æˆ‘ä»¬ç‚¹å‡»ç¼–è¾‘SPUæŒ‰é’®æ—¶éœ€è¦ä»çˆ¶ç»„ä»¶ï¼ˆå±•ç¤ºSPUé¡µé¢ï¼‰ä¼ é€’åˆ°æ·»åŠ SPUé¡µé¢ å…¶ä½™å››éƒ¨åˆ†ç”±10.3ä¸­æ¥å£è·å– é—®é¢˜1ï¼šå­ç»„ä»¶éœ€è¦ç”¨åˆ°çˆ¶ç»„ä»¶ä¸­çš„æ•°æ®ï¼Œåº”è¯¥æ€ä¹ˆåŠï¼Ÿ è¦ä¼ é€’çš„æ•°æ®æ˜¯æŒ‡å®šçš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç‚¹å‡»ä¿®æ”¹æ—¶çš„æ•°æ®ã€‚é€šè¿‡refçš„æ–¹å¼ï¼Œæ‹¿åˆ°å­ç»„ä»¶æ—¶çš„å®ä¾‹ï¼Œå†è°ƒç”¨å­ç»„ä»¶æš´éœ²çš„æ–¹\tæ³•å°†æ•°æ®åšä¸ºå‚æ•°ä¼ é€’è¿‡å»ã€‚ é—®é¢˜2ï¼šå…¶ä½™4ä¸ªéƒ¨åˆ†çš„æ•°æ®ä»€ä¹ˆæ—¶å€™è·å–ï¼Ÿ åŒæ ·çš„åœ¨ç‚¹å‡»ä¿®æ”¹æŒ‰é’®æ—¶è·å–ï¼Œé—®é¢˜ä¸€ä¸­é€šè¿‡è°ƒç”¨å­ç»„ä»¶çš„å‡½æ•°ä¼ é€’æ•°æ®ï¼Œæˆ‘ä»¬åŒæ—¶ä¹Ÿåœ¨è¿™ä¸ªå‡½æ•°ä¸­å‘è¯·æ±‚å¾—åˆ°æ•°æ® æ•°æ® çˆ¶ç»„ä»¶ä¼ é€’æ•°æ® src\\views\\product\\spu\\index.vue !-- SPUå±•ç¤ºé¡µé¢ --div v-show=scene === 0 el-card style=margin: 10px 0px ... el-table-column label=SPUæ“ä½œ !-- row å›ä¼ ç¼–è¾‘æ•°æ® -- template #default= row el-button type=primary size=small icon=Edit @click=updateSpu(row) /el-button /template /el-table-column /el-card/div!-- SPUç¼–è¾‘é¡µé¢ --SpuForm v-show=scene === 1 ref=spu @changeScene=changeScene/SpuForm å­ç»„ä»¶å¯¹å¤–æš´éœ²åˆå§‹åŒ–æ•°æ®å‡½æ•° src\\api\\product\\spu\\type.ts //SPUæ•°æ®çš„tsç±»å‹:éœ€è¦ä¿®æ”¹export interface SpuData category3Id: number id?: number spuName: string tmId: number description: string spuImageList: null | SpuImg[] spuSaleAttrList: null | SaleAttr[] src\\views\\product\\spu\\spuForm.vue //å­˜å‚¨å·²æœ‰çš„SPUè¿™äº›æ•°æ®let allTradeMark = refTrademark[]([])//å•†å“å›¾ç‰‡let imgList = refSpuImg[]([])//å·²æœ‰çš„SPUé”€å”®å±æ€§let saleAttr = refSaleAttr[]([])//å…¨éƒ¨é”€å”®å±æ€§let allSaleAttr = refHasSaleAttr[]([])//å­˜å‚¨å·²æœ‰çš„SPUå¯¹è±¡let spuParams = refSpuData( category3Id: 0, //æ”¶é›†ä¸‰çº§åˆ†ç±»çš„ID spuName: , //SPUçš„åå­— description: , //SPUçš„æè¿° tmId: , //å“ç‰Œçš„ID spuImageList: [], spuSaleAttrList: [],)//å­ç»„ä»¶æ•°æ®åˆå§‹åŒ–æ–¹æ³•const initHasSpuData = async (spu: SpuData) = //å­˜å‚¨å·²æœ‰çš„SPUå¯¹è±¡,å°†æ¥åœ¨æ¨¡æ¿ä¸­å±•ç¤º spuParams.value = spu //spu:å³ä¸ºçˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„å·²æœ‰çš„SPUå¯¹è±¡[ä¸å®Œæ•´] //è·å–å…¨éƒ¨å“ç‰Œçš„æ•°æ® let result: AllTradeMark = await reqAllTradeMark() //è·å–æŸä¸€ä¸ªå“ç‰Œæ——ä¸‹å…¨éƒ¨å”®å–å•†å“çš„å›¾ç‰‡ let result1: SpuHasImg = await reqSpuImageList(spu.id as number) //è·å–å·²æœ‰çš„SPUé”€å”®å±æ€§çš„æ•°æ® let result2: SaleAttrResponseData = await reqSpuHasSaleAttr(spu.id as number) //è·å–æ•´ä¸ªé¡¹ç›®å…¨éƒ¨SPUçš„é”€å”®å±æ€§ let result3: HasSaleAttrResponseData = await reqAllSaleAttr() //å­˜å‚¨å…¨éƒ¨å“ç‰Œçš„æ•°æ® allTradeMark.value = result.data //SPUå¯¹åº”å•†å“å›¾ç‰‡ imgList.value = result1.data.map((item) = return name: item.imgName as string, url: item.imgUrl, ) //å­˜å‚¨å·²æœ‰çš„SPUçš„é”€å”®å±æ€§ saleAttr.value = result2.data //å­˜å‚¨å…¨éƒ¨çš„é”€å”®å±æ€§ allSaleAttr.value = result3.data//å¯¹å¤–æš´éœ²defineExpose( initHasSpuData ) çˆ¶ç»„ä»¶ç‚¹å‡»ç¼–è¾‘æ—¶åŒæ—¶è°ƒç”¨å­ç»„ä»¶æš´éœ²çš„æ–¹æ³• //è·å–å­ç»„ä»¶å®ä¾‹const spu = refany()//ä¿®æ”¹å·²æœ‰çš„SPUçš„æŒ‰é’®çš„å›è°ƒconst updateSpu = (row: SpuData) = //åˆ‡æ¢ä¸ºåœºæ™¯1:æ·»åŠ ä¸ä¿®æ”¹å·²æœ‰SPUç»“æ„-SpuForm scene.value = 1 //è°ƒç”¨å­ç»„ä»¶å®ä¾‹æ–¹æ³•è·å–å®Œæ•´å·²æœ‰çš„SPUçš„æ•°æ® spu.value.initHasSpuData(row) 10.5 æ¸²æŸ“æ·»åŠ SPUé¡µé¢10.5.1 æ¸²æŸ“å“ç‰Œã€åç§°ã€å›¾ç‰‡å¢™ æ¸²æŸ“é¡µé¢ src\\views\\product\\spu\\spuForm.vue template el-card style=margin: 10px 0px el-form label-width=100px el-form-item label=SPUåç§° el-input placeholder=è¯·ä½ è¾“å…¥SPUåç§° v-model=spuParams.spuName /el-input /el-form-item el-form-item label=SPUå“ç‰Œ el-select v-model=spuParams.tmId el-option v-for=item in allTradeMark :label=item.tmName :key=item.id :value=item.id /el-option /el-select /el-form-item el-form-item label=SPUæè¿° el-input type=textarea placeholder=è¯·ä½ è¾“å…¥SPUæè¿° v-model=spuParams.description /el-input /el-form-item el-form-item label=SPUå›¾ç‰‡ el-upload list-type=picture-card v-model:file-list=imgList action=api/admin/product/fileUpload :on-preview=handlePictureCardPreview :before-upload=handlerUpload el-iconPlus //el-icon /el-upload !-- é¢„è§ˆç…§ç‰‡ -- el-dialog v-model=dialogVisible img :src=dialogImageUrl alt=Preview Image style=width: 100%; height: 100% / /el-dialog /el-form-item ... /el-form /el-card/templatescript setup lang=ts//æ§åˆ¶å¯¹è¯æ¡†çš„æ˜¾ç¤ºä¸éšè—let dialogVisible = refboolean(false)//å­˜å‚¨é¢„è§ˆå›¾ç‰‡åœ°å€let dialogImageUrl = refstring()//ç…§ç‰‡å¢™ç‚¹å‡»é¢„è§ˆæŒ‰é’®çš„æ—¶å€™è§¦å‘çš„é’©å­const handlePictureCardPreview = (file: any) = dialogImageUrl.value = file.url //å¯¹è¯æ¡†å¼¹å‡ºæ¥ dialogVisible.value = true//ç…§ç‰‡ä¸Šä¼ æˆåŠŸä¹‹å‰çš„é’©å­çº¦æŸæ–‡ä»¶çš„å¤§å°ä¸ç±»å‹const handlerUpload = (file: any) = if ( file.type == image/png || file.type == image/jpeg || file.type == image/gif ) if (file.size / 1024 / 1024 3) return true else ElMessage( type: error, message: ä¸Šä¼ æ–‡ä»¶åŠ¡å¿…å°äº3M, ) return false else ElMessage( type: error, message: ä¸Šä¼ æ–‡ä»¶åŠ¡å¿…PNG|JPG|GIF, ) return false /script 10.5.2 æ¸²æŸ“é”€å”®å±æ€§ å·²æœ‰å±æ€§åˆ—è¡¨ template ... el-form-item label=SPUé”€å”®å±æ€§ !-- tableå±•ç¤ºé”€å”®å±æ€§ä¸å±æ€§å€¼çš„åœ°æ–¹ -- el-table border style=margin: 10px 0px :data=saleAttr el-table-column label=åºå· type=index align=center width=80px /el-table-column el-table-column label=é”€å”®å±æ€§åå­— width=120px prop=saleAttrName /el-table-column el-table-column label=é”€å”®å±æ€§å€¼ !-- row:å³ä¸ºå½“å‰SPUå·²æœ‰çš„é”€å”®å±æ€§å¯¹è±¡ -- template #default= row, index el-tag style=margin: 5px v-for=item in row.spuSaleAttrValueList :key=item.id closable @close=row.spuSaleAttrValueList.splice(index, 1) item.saleAttrValueName /el-tag /template /el-table-column el-table-column label=æ“ä½œ width=120px template #default= index el-button type=danger size=small icon=Delete @click=saleAttr.splice(index, 1) /el-button /template /el-table-column /el-table /el-form-item .../templatescript setup lang=ts/script é”€å”®å±æ€§åˆ—è¡¨ä¸­æ·»åŠ æŒ‰é’®ä¸inputçš„åˆ‡æ¢ script setup lang=ts//è·å–å±æ€§å€¼è¾“å…¥æ¡†å®ä¾‹const inputRef = ref()//å±æ€§å€¼æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶const toEdit = (row: SaleAttr) = //ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™,inputç»„ä»¶å°±å‡ºæ¥-ç¼–è¾‘æ¨¡å¼ row.flag = true row.saleAttrValue = //ç‚¹å‡»æŒ‰é’®åè‡ªåŠ¨èšç„¦åˆ°è¾“å…¥æ¡† nextTick(() = inputRef.value.focus() )//è¡¨å•å…ƒç´ å¤±å´ç„¦ç‚¹çš„äº‹ä»¶å›è°ƒconst toLook = (row: SaleAttr) = //æ•´ç†æ”¶é›†çš„å±æ€§çš„IDä¸å±æ€§å€¼çš„åå­— const baseSaleAttrId, saleAttrValue = row //æ•´ç†æˆæœåŠ¡å™¨éœ€è¦çš„å±æ€§å€¼å½¢å¼ let newSaleAttrValue: SpuSaleAttrValue = baseSaleAttrId: baseSaleAttrId as number, saleAttrValueName: saleAttrValue as string, //éæ³•æƒ…å†µåˆ¤æ–­ if ((saleAttrValue as string).trim() == ) ElMessage( type: error, message: å±æ€§å€¼ä¸èƒ½ä¸ºç©ºçš„, ) return //åˆ¤æ–­å±æ€§å€¼æ˜¯å¦åœ¨æ•°ç»„å½“ä¸­å­˜åœ¨ let repeat = row.spuSaleAttrValueList.find((item) = return item.saleAttrValueName == saleAttrValue ) if (repeat) ElMessage( type: error, message: å±æ€§å€¼é‡å¤, ) return //è¿½åŠ æ–°çš„å±æ€§å€¼å¯¹è±¡ row.spuSaleAttrValueList.push(newSaleAttrValue) //åˆ‡æ¢ä¸ºæŸ¥çœ‹æ¨¡å¼ row.flag = false/script è®¡ç®—å‡ºè¿˜æœªæ‹¥æœ‰çš„é”€å”®å±æ€§ //è®¡ç®—å‡ºå½“å‰SPUè¿˜æœªæ‹¥æœ‰çš„é”€å”®å±æ€§let unSelectSaleAttr = computed(() = //å…¨éƒ¨é”€å”®å±æ€§:é¢œè‰²ã€ç‰ˆæœ¬ã€å°ºç  //å·²æœ‰çš„é”€å”®å±æ€§:é¢œè‰²ã€ç‰ˆæœ¬ let unSelectArr = allSaleAttr.value.filter((item) = return saleAttr.value.every((item1) = return item.name != item1.saleAttrName ) ) return unSelectArr) 10.5.3 ä¿å­˜ API src\\api\\product\\spu\\index.ts //SPUç®¡ç†æ¨¡å—çš„æ¥å£import request from @/utils/requestimport type HasSpuResponseData from ./typeenum API //è¿½åŠ ä¸€ä¸ªæ–°çš„SPU ADDSPU_URL = /admin/product/saveSpuInfo, //æ›´æ–°å·²æœ‰çš„SPU UPDATESPU_URL = /admin/product/updateSpuInfo,//æ·»åŠ ä¸€ä¸ªæ–°çš„SPUçš„//æ›´æ–°å·²æœ‰çš„SPUæ¥å£//data:å³ä¸ºæ–°å¢çš„SPU|æˆ–è€…å·²æœ‰çš„SPUå¯¹è±¡export const reqAddOrUpdateSpu = (data: any) = //å¦‚æœSPUå¯¹è±¡æ‹¥æœ‰ID,æ›´æ–°å·²æœ‰çš„SPU if (data.id) return request.postany, any(API.UPDATESPU_URL, data) else return request.postany, any(API.ADDSPU_URL, data) ä¿æ•´ç†æ•°æ®+å‘é€è¯·æ±‚+é€šçŸ¥çˆ¶ç»„ä»¶æ›´æ–°é¡µé¢ //ä¿å­˜æŒ‰é’®çš„å›è°ƒconst save = async () = //æ•´ç†å‚æ•° //å‘è¯·æ±‚:æ·»åŠ SPU|æ›´æ–°å·²æœ‰çš„SPU //æˆåŠŸ //å¤±è´¥ //1:ç…§ç‰‡å¢™çš„æ•°æ® spuParams.value.spuImageList = imgList.value.map((item: any) = return imgName: item.name, //å›¾ç‰‡çš„åå­— imgUrl: (item.response item.response.data) || item.url, ) //2:æ•´ç†é”€å”®å±æ€§çš„æ•°æ® spuParams.value.spuSaleAttrList = saleAttr.value let result = await reqAddOrUpdateSpu(spuParams.value) if (result.code == 200) ElMessage( type: success, message: spuParams.value.id ? æ›´æ–°æˆåŠŸ : æ·»åŠ æˆåŠŸ, ) //é€šçŸ¥çˆ¶ç»„ä»¶åˆ‡æ¢åœºæ™¯ä¸º0 emit(changeScene, flag: 0, ) else ElMessage( type: success, message: spuParams.value.id ? æ›´æ–°æˆåŠŸ : æ·»åŠ æˆåŠŸ, ) è·³è½¬é¡µé¢ åœ¨æ·»åŠ å’Œä¿®æ”¹spuå±æ€§åï¼Œè·³è½¬çš„é¡µé¢ä¸ä¸€æ ·ã€‚ä¿®æ”¹åº”è¯¥è·³è½¬åˆ°å½“å‰é¡µé¢ï¼Œæ·»åŠ åº”è¯¥è·³è½¬åˆ°ç¬¬ä¸€é¡µã€‚å¦‚ä½•åŒºåˆ†ï¼ŸspuParams.value.idå±æ€§ä¿®æ”¹æŒ‰é’®çš„spuParamsæ˜¯è‡ªå¸¦è¿™ä¸ªå±æ€§çš„ï¼Œè€Œæ·»åŠ æŒ‰é’®æ²¡æœ‰è¿™ä¸ªå±æ€§ã€‚å› æ­¤åœ¨ä¿å­˜çš„æ—¶å€™é€šè¿‡è¿™ä¸ªå±æ€§å‘ŠçŸ¥çˆ¶ç»„ä»¶ã€‚ src\\views\\product\\spu\\spuForm.vue //ä¿å­˜æŒ‰é’®çš„å›è°ƒconst save = async () = ... //é€šçŸ¥çˆ¶ç»„ä»¶åˆ‡æ¢åœºæ™¯ä¸º0 $emit(changeScene, flag: 0, params: spuParams.value.id ? update : add, ) ... src\\views\\product\\spu\\index.vue //å­ç»„ä»¶SpuFormç»‘å®šè‡ªå®šä¹‰äº‹ä»¶:ç›®å‰æ˜¯è®©å­ç»„ä»¶é€šçŸ¥çˆ¶ç»„ä»¶åˆ‡æ¢åœºæ™¯ä¸º0const changeScene = (obj: any) = //å­ç»„ä»¶Spuformç‚¹å‡»å–æ¶ˆå˜ä¸ºåœºæ™¯0:å±•ç¤ºå·²æœ‰çš„SPU scene.value = obj.flag if (obj.params == update) //æ›´æ–°ç•™åœ¨å½“å‰é¡µ getHasSpu(pageNo.value) else //æ·»åŠ ç•™åœ¨ç¬¬ä¸€é¡µ getHasSpu() 10.5.4 æ·»åŠ SPU ç»‘å®šæŒ‰é’®ç‚¹å‡»äº‹ä»¶ æ·»åŠ å’Œä¿®æ”¹æŒ‰é’®ä¸åŒçš„åœ°æ–¹åœ¨äºå¯¹äºæ•°æ®çš„æ¥æºä¸åŒï¼Œä¿®æ”¹æŒ‰é’®æ˜¯ä¸€éƒ¨åˆ†ï¼ˆspuParamsï¼‰æ¥æºäºçˆ¶ç»„ä»¶ä¼ é€’çš„æ•°æ®ï¼Œå°†ä»–ä»¬ä¸ç»„ä»¶ç»‘å®šï¼Œåœ¨æ•°æ®ä¸Šå±•ç¤ºã€‚æ·»åŠ æŒ‰é’®çˆ¶ç»„ä»¶åªéœ€è¦ä¼ é€’category3Idå°±è¡Œï¼Œå…¶ä»–çš„è‡ªå·±æ”¶é›†ã€‚ src\\views\\product\\spu\\index.vue //æ·»åŠ æ–°çš„SPUæŒ‰é’®çš„å›è°ƒconst addSpu = () = //åˆ‡æ¢ä¸ºåœºæ™¯1:æ·»åŠ ä¸ä¿®æ”¹å·²æœ‰SPUç»“æ„-SpuForm scene.value = 1 //ç‚¹å‡»æ·»åŠ SPUæŒ‰é’®,è°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•åˆå§‹åŒ–æ•°æ® spu.value.initAddSpu(categoryStore.c3Id) å­ç»„ä»¶æä¾›æ·»åŠ æ—¶æ•°æ®åˆå§‹åŒ–æ–¹æ³• src\\views\\product\\spu\\spuForm.vue //æ·»åŠ ä¸€ä¸ªæ–°çš„SPUåˆå§‹åŒ–è¯·æ±‚æ–¹æ³•const initAddSpu = async (c3Id: number | string) = //æ¸…ç©ºæ•°æ® Object.assign(spuParams.value, category3Id: , //æ”¶é›†ä¸‰çº§åˆ†ç±»çš„ID spuName: , //SPUçš„åå­— description: , //SPUçš„æè¿° tmId: , //å“ç‰Œçš„ID spuImageList: [], spuSaleAttrList: [], ) //æ¸…ç©ºç…§ç‰‡ imgList.value = [] //æ¸…ç©ºé”€å”®å±æ€§ saleAttr.value = [] saleAttrIdAndValueName.value = //å­˜å‚¨ä¸‰çº§åˆ†ç±»çš„ID spuParams.value.category3Id = c3Id as number //è·å–å…¨éƒ¨å“ç‰Œçš„æ•°æ® let result: AllTradeMark = await reqAllTradeMark() let result1: HasSaleAttrResponseData = await reqAllSaleAttr() //å­˜å‚¨æ•°æ® allTradeMark.value = result.data allSaleAttr.value = result1.data//å¯¹å¤–æš´éœ²defineExpose( initHasSpuData, initAddSpu ) 10.6 SKUåˆ—è¡¨10.6.1 æ·»åŠ SKU12. ç”¨æˆ·ç®¡ç†12.1 ç”¨æˆ·ç®¡ç†å±•ç¤º é™æ€é¡µé¢ src\\views\\acl\\user\\index.vue template el-card style=height: 80px el-form :inline=true class=form el-form-item label=ç”¨æˆ·å: el-input placeholder=è¯·ä½ è¾“å…¥æœç´¢ç”¨æˆ·å/el-input /el-form-item el-form-item el-button type=primary size=defaultæœç´¢/el-button el-button size=default @click=reseté‡ç½®/el-button /el-form-item /el-form /el-card el-card style=margin: 10px 0px el-button type=primary size=defaultæ·»åŠ ç”¨æˆ·/el-button el-button type=danger size=defaultæ‰¹é‡åˆ é™¤/el-button !-- tableå±•ç¤ºç”¨æˆ·ä¿¡æ¯ -- el-table style=margin: 10px 0px border el-table-column type=selection align=center/el-table-column el-table-column label=# align=center type=index/el-table-column el-table-column label=ID align=center/el-table-column el-table-column label=ç”¨æˆ·åå­— align=center show-overflow-tooltip /el-table-column el-table-column label=ç”¨æˆ·åç§° align=center show-overflow-tooltip /el-table-column el-table-column label=ç”¨æˆ·è§’è‰² align=center show-overflow-tooltip /el-table-column el-table-column label=åˆ›å»ºæ—¶é—´ align=center show-overflow-tooltip /el-table-column el-table-column label=æ›´æ–°æ—¶é—´ align=center show-overflow-tooltip /el-table-column el-table-column label=æ“ä½œ width=300px align=center /el-table-column /el-table !-- åˆ†é¡µå™¨ -- el-pagination v-model:current-page=pageNo v-model:page-size=pageSize :page-sizes=[5, 7, 9, 11] :background=true layout=prev, pager, next, jumper,-,sizes,total :total=400 / /el-card/template ç”¨æˆ·ä¿¡æ¯APIæ•°æ®ç±»å‹ src\\api\\acl\\user\\type.ts //è´¦å·ä¿¡æ¯çš„tsç±»å‹export interface ResponseData code: number message: string ok: boolean//ä»£è¡¨ä¸€ä¸ªè´¦å·ä¿¡æ¯çš„tsç±»å‹export interface User id?: number createTime?: string updateTime?: string username?: string password?: string name?: string phone?: null roleName?: string//æ•°ç»„åŒ…å«å…¨éƒ¨çš„ç”¨æˆ·ä¿¡æ¯export type Records = User[]//è·å–å…¨éƒ¨ç”¨æˆ·ä¿¡æ¯æ¥å£è¿”å›çš„æ•°æ®tsç±»å‹export interface UserResponseData extends ResponseData data: records: Records total: number size: number current: number pages: number ç”¨æˆ·ä¿¡æ¯API src\\api\\acl\\user\\index.ts //ç”¨æˆ·ç®¡ç†æ¨¡å—çš„æ¥å£import request from @/utils/requestimport type UserResponseData from ./type//æšä¸¾åœ°å€enum API //è·å–å…¨éƒ¨å·²æœ‰ç”¨æˆ·è´¦å·ä¿¡æ¯ ALLUSER_URL = /admin/acl/user/,//è·å–ç”¨æˆ·è´¦å·ä¿¡æ¯çš„æ¥å£export const reqUserInfo = (page: number, limit: number) = return request.getany, UserResponseData( API.ALLUSER_URL + `$page/$limit`, ) æ¸²æŸ“é¡µé¢ src\\views\\acl\\user\\index.vue template el-card style=height: 80px el-form :inline=true class=form ref=formRef el-form-item label=ç”¨æˆ·å: el-input placeholder=è¯·ä½ è¾“å…¥æœç´¢ç”¨æˆ·å/el-input /el-form-item el-form-item el-button type=primary size=defaultæœç´¢/el-button el-button size=default @click=reset(formRef)é‡ç½®/el-button /el-form-item /el-form /el-card el-card style=margin: 10px 0px el-button type=primary size=default æ·»åŠ ç”¨æˆ· /el-button el-button type=danger size=defaultæ‰¹é‡åˆ é™¤/el-button !-- tableå±•ç¤ºç”¨æˆ·ä¿¡æ¯ -- el-table style=margin: 10px 0px border :data=userArr el-table-column type=selection align=center/el-table-column el-table-column label=åºå· align=center type=index /el-table-column el-table-column label=ID align=center prop=id/el-table-column el-table-column label=ç”¨æˆ·åå­— align=center show-overflow-tooltip prop=username /el-table-column el-table-column label=ç”¨æˆ·åç§° align=center show-overflow-tooltip prop=name /el-table-column el-table-column label=ç”¨æˆ·è§’è‰² align=center show-overflow-tooltip prop=roleName /el-table-column el-table-column label=åˆ›å»ºæ—¶é—´ align=center show-overflow-tooltip prop=createTime /el-table-column el-table-column label=æ›´æ–°æ—¶é—´ align=center show-overflow-tooltip prop=updateTime /el-table-column el-table-column label=æ“ä½œ width=300px align=center /el-table-column /el-table !-- åˆ†é¡µå™¨ -- el-pagination v-model:current-page=pageNo v-model:page-size=limit :page-sizes=[3, 5, 7, 9] :background=true layout=prev, pager, next, jumper,-,sizes,total :total=total @current-change=getHasUser @size-change=sizeChange / /el-card/templatescript setup lang=tsimport FormInstance from element-plusimport onMounted, ref from vueimport Records, UserResponseData from @/api/acl/user/typeimport reqUserInfo from @/api/acl/userconst formRef = refFormInstance()const reset = (formEl: FormInstance | undefined) = if (!formEl) return formEl.resetFields()//ç”¨æˆ·æ€»ä¸ªæ•°let total = refnumber(0)//å­˜å‚¨å…¨éƒ¨ç”¨æˆ·çš„æ•°ç»„let userArr = refRecords([])onMounted(() = getHasUser())// å½“å‰é¡µç let pageNo = refnumber(1)// æ¯ä¸€é¡µå±•ç¤ºçš„æ•°æ®let limit = refnumber(3)// å­˜å‚¨å·²æœ‰å“ç‰Œæ•°æ®æ€»æ•°//è·å–å…¨éƒ¨å·²æœ‰çš„ç”¨æˆ·ä¿¡æ¯const getHasUser = async (pager = 1) = //æ”¶é›†å½“å‰é¡µç  pageNo.value = pager let result: UserResponseData = await reqUserInfo( pageNo.value, limit.value, /* keyword.value, */ ) if (result.code == 200) total.value = result.data.total userArr.value = result.data.records // å½“ä¸‹æ‹‰èœå•å‘ç”Ÿå˜åŒ–çš„æ—¶å€™è§¦å‘æ­¤æ–¹æ³•// è¿™ä¸ªè‡ªå®šä¹‰äº‹ä»¶,åˆ†é¡µå™¨ç»„ä»¶ä¼šå°†ä¸‹æ‹‰èœå•é€‰ä¸­æ•°æ®è¿”å›const sizeChange = () = // å½“å‰æ¯ä¸€é¡µçš„æ•°æ®é‡å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå½“å‰é¡µç å½’1 getHasUser()/script 12.2 æ·»åŠ ç”¨æˆ· é™æ€é¡µé¢ template el-card style=margin: 10px 0px el-button type=primary size=default @click=addUser æ·»åŠ ç”¨æˆ· /el-button ... /el-card !-- æŠ½å±‰ç»“æ„:å®Œæˆæ·»åŠ æ–°çš„ç”¨æˆ·è´¦å·|æ›´æ–°å·²æœ‰çš„è´¦å·ä¿¡æ¯ -- el-drawer v-model=drawer !-- å¤´éƒ¨æ ‡é¢˜:å°†æ¥æ–‡å­—å†…å®¹åº”è¯¥åŠ¨æ€çš„ -- template #header h4æ·»åŠ ç”¨æˆ·/h4 /template !-- èº«ä½“éƒ¨åˆ† -- template #default el-form el-form-item label=ç”¨æˆ·å§“å el-input placeholder=è¯·æ‚¨è¾“å…¥ç”¨æˆ·å§“å/el-input /el-form-item el-form-item label=ç”¨æˆ·æ˜µç§° el-input placeholder=è¯·æ‚¨è¾“å…¥ç”¨æˆ·æ˜µç§°/el-input /el-form-item el-form-item label=ç”¨æˆ·å¯†ç  el-input placeholder=è¯·æ‚¨è¾“å…¥ç”¨æˆ·å¯†ç /el-input /el-form-item /el-form /template template #footer div style=flex: auto el-buttonå–æ¶ˆ/el-button el-button type=primaryç¡®å®š/el-button /div /template /el-drawer/templatescript setup lang=ts...//æ·»åŠ ç”¨æˆ·const drawer = ref(false)const addUser = () = drawer.value = true/script æ•°æ®ç±»å‹ src\\api\\acl\\user\\type.ts //ä»£è¡¨ä¸€ä¸ªè´¦å·ä¿¡æ¯çš„tsç±»å‹export interface User id?: number createTime?: string updateTime?: string username?: string password?: string name?: string phone?: null roleName?: string æ·»åŠ ç”¨æˆ·API src\\api\\acl\\user\\index.ts //æšä¸¾åœ°å€enum API //æ·»åŠ ä¸€ä¸ªæ–°çš„ç”¨æˆ·è´¦å· ADDUSER_URL = /admin/acl/user/save, //æ›´æ–°å·²æœ‰çš„ç”¨æˆ·è´¦å· UPDATEUSER_URL = /admin/acl/user/update,//æ·»åŠ ç”¨æˆ·ä¸æ›´æ–°å·²æœ‰ç”¨æˆ·çš„æ¥å£export const reqAddOrUpdateUser = (data: User) = //æºå¸¦å‚æ•°æœ‰IDæ›´æ–° if (data.id) return request.putany, any(API.UPDATEUSER_URL, data) else return request.postany, any(API.ADDUSER_URL, data) æ¸²æŸ“é¡µé¢ src\\views\\acl\\user\\index.vue template el-card style=margin: 10px 0px el-button type=primary size=default @click=addUser æ·»åŠ ç”¨æˆ· /el-button /el-card !-- æŠ½å±‰ç»“æ„:å®Œæˆæ·»åŠ æ–°çš„ç”¨æˆ·è´¦å·|æ›´æ–°å·²æœ‰çš„è´¦å·ä¿¡æ¯ -- el-drawer v-model=drawer !-- å¤´éƒ¨æ ‡é¢˜:å°†æ¥æ–‡å­—å†…å®¹åº”è¯¥åŠ¨æ€çš„ -- template #header h4æ·»åŠ ç”¨æˆ·/h4 /template !-- èº«ä½“éƒ¨åˆ† -- template #default el-form :model=userParams el-form-item label=ç”¨æˆ·å§“å el-input placeholder=è¯·æ‚¨è¾“å…¥ç”¨æˆ·å§“å v-model=userParams.username /el-input /el-form-item el-form-item label=ç”¨æˆ·æ˜µç§° el-input placeholder=è¯·æ‚¨è¾“å…¥ç”¨æˆ·æ˜µç§° v-model=userParams.name /el-input /el-form-item el-form-item label=ç”¨æˆ·å¯†ç  el-input placeholder=è¯·æ‚¨è¾“å…¥ç”¨æˆ·å¯†ç  v-model=userParams.password /el-input /el-form-item /el-form /template template #footer div style=flex: auto el-button @click=drawer = falseå–æ¶ˆ/el-button el-button type=primary @click=saveç¡®å®š/el-button /div /template /el-drawer/templatescript setup lang=ts//æ·»åŠ ç”¨æˆ·const drawer = ref(false)let formRef = refany()const addUser = () = //æŠ½å±‰æ˜¾ç¤ºå‡ºæ¥ drawer.value = true //æ¸…ç©ºæ•°æ® Object.assign(userParams, id: 0, username: , name: , password: , ) //æ¸…é™¤ä¸Šä¸€æ¬¡çš„é”™è¯¯çš„æç¤ºä¿¡æ¯ nextTick(() = formRef.value.clearValidate(username) formRef.value.clearValidate(name) formRef.value.clearValidate(password) )//æ”¶é›†ç”¨æˆ·ä¿¡æ¯çš„å“åº”å¼æ•°æ®let userParams = reactiveUser( username: , name: , password: ,)//ä¿å­˜æŒ‰é’®çš„å›è°ƒconst save = async () = //ä¿å­˜æŒ‰é’®:æ·»åŠ æ–°çš„ç”¨æˆ·|æ›´æ–°å·²æœ‰çš„ç”¨æˆ·è´¦å·ä¿¡æ¯ let result: any = await reqAddOrUpdateUser(userParams) //æ·»åŠ æˆ–è€…æ›´æ–°æˆåŠŸ if (result.code == 200) //å…³é—­æŠ½å±‰ drawer.value = false //æç¤ºæ¶ˆæ¯ ElMessage( type: success, message: userParams.id ? æ›´æ–°æˆåŠŸ : æ·»åŠ æˆåŠŸ, ) //è·å–æœ€æ–°çš„å…¨éƒ¨è´¦å·çš„ä¿¡æ¯ getHasUser(userParams.id ? pageNo.value : 1) else //å…³é—­æŠ½å±‰ drawer.value = false //æç¤ºæ¶ˆæ¯ ElMessage( type: error, message: userParams.id ? æ›´æ–°å¤±è´¥ : æ·»åŠ å¤±è´¥, ) /script å‚æ•°æ ¡éªŒ template el-card style=margin: 10px 0px el-button type=primary size=default @click=addUser æ·»åŠ ç”¨æˆ· /el-button /el-card !-- æŠ½å±‰ç»“æ„:å®Œæˆæ·»åŠ æ–°çš„ç”¨æˆ·è´¦å·|æ›´æ–°å·²æœ‰çš„è´¦å·ä¿¡æ¯ -- el-drawer v-model=drawer !-- å¤´éƒ¨æ ‡é¢˜:å°†æ¥æ–‡å­—å†…å®¹åº”è¯¥åŠ¨æ€çš„ -- template #header h4 userParams.id ? æ›´æ–°ç”¨æˆ· : æ·»åŠ ç”¨æˆ· /h4 /template !-- èº«ä½“éƒ¨åˆ† -- template #default el-form :model=userParams :rules=rules ref=formRef el-form-item label=ç”¨æˆ·å§“å prop=username el-input placeholder=è¯·æ‚¨è¾“å…¥ç”¨æˆ·å§“å v-model=userParams.username /el-input /el-form-item el-form-item label=ç”¨æˆ·æ˜µç§° prop=name el-input placeholder=è¯·æ‚¨è¾“å…¥ç”¨æˆ·æ˜µç§° v-model=userParams.name /el-input /el-form-item el-form-item label=ç”¨æˆ·å¯†ç  prop=password v-if=!userParams.id el-input placeholder=è¯·æ‚¨è¾“å…¥ç”¨æˆ·å¯†ç  v-model=userParams.password /el-input /el-form-item /el-form /template template #footer div style=flex: auto el-button @click=drawer = falseå–æ¶ˆ/el-button el-button type=primary @click=saveç¡®å®š/el-button /div /template /el-drawer/templatescript setup lang=ts//æ·»åŠ ç”¨æˆ·const drawer = ref(false)let formRef = refany()const addUser = () = //æŠ½å±‰æ˜¾ç¤ºå‡ºæ¥ drawer.value = true //æ¸…ç©ºæ•°æ® Object.assign(userParams, id: 0, username: , name: , password: , ) //æ¸…é™¤ä¸Šä¸€æ¬¡çš„é”™è¯¯çš„æç¤ºä¿¡æ¯ nextTick(() = formRef.value.clearValidate(username) formRef.value.clearValidate(name) formRef.value.clearValidate(password) )//æ”¶é›†ç”¨æˆ·ä¿¡æ¯çš„å“åº”å¼æ•°æ®let userParams = reactiveUser( username: , name: , password: ,)//ä¿å­˜æŒ‰é’®çš„å›è°ƒconst save = async () = //ç‚¹å‡»ä¿å­˜æŒ‰é’®çš„æ—¶å€™,åŠ¡å¿…éœ€è¦ä¿è¯è¡¨å•å…¨éƒ¨å¤åˆæ¡ä»¶åœ¨å»å‘è¯·æ±‚ await formRef.value.validate() //ä¿å­˜æŒ‰é’®:æ·»åŠ æ–°çš„ç”¨æˆ·|æ›´æ–°å·²æœ‰çš„ç”¨æˆ·è´¦å·ä¿¡æ¯ let result: any = await reqAddOrUpdateUser(userParams) //æ·»åŠ æˆ–è€…æ›´æ–°æˆåŠŸ if (result.code == 200) //å…³é—­æŠ½å±‰ drawer.value = false //æç¤ºæ¶ˆæ¯ ElMessage( type: success, message: userParams.id ? æ›´æ–°æˆåŠŸ : æ·»åŠ æˆåŠŸ, ) //è·å–æœ€æ–°çš„å…¨éƒ¨è´¦å·çš„ä¿¡æ¯ getHasUser(userParams.id ? pageNo.value : 1) else //å…³é—­æŠ½å±‰ drawer.value = false //æç¤ºæ¶ˆæ¯ ElMessage( type: error, message: userParams.id ? æ›´æ–°å¤±è´¥ : æ·»åŠ å¤±è´¥, ) //æ ¡éªŒç”¨æˆ·åå­—å›è°ƒå‡½æ•°const validatorUsername = (_rule: any, value: any, callBack: any) = //ç”¨æˆ·åå­—|æ˜µç§°,é•¿åº¦è‡³å°‘äº”ä½ if (value.trim().length = 5) callBack() else callBack(new Error(ç”¨æˆ·åå­—è‡³å°‘äº”ä½)) //æ ¡éªŒç”¨æˆ·åå­—å›è°ƒå‡½æ•°const validatorName = (_rule: any, value: any, callBack: any) = //ç”¨æˆ·åå­—|æ˜µç§°,é•¿åº¦è‡³å°‘äº”ä½ if (value.trim().length = 5) callBack() else callBack(new Error(ç”¨æˆ·æ˜µç§°è‡³å°‘äº”ä½)) const validatorPassword = (_rule: any, value: any, callBack: any) = //ç”¨æˆ·åå­—|æ˜µç§°,é•¿åº¦è‡³å°‘äº”ä½ if (value.trim().length = 6) callBack() else callBack(new Error(ç”¨æˆ·å¯†ç è‡³å°‘å…­ä½)) //è¡¨å•æ ¡éªŒçš„è§„åˆ™å¯¹è±¡const rules = //ç”¨æˆ·åå­— username: [ required: true, trigger: blur, validator: validatorUsername ], //ç”¨æˆ·æ˜µç§° name: [ required: true, trigger: blur, validator: validatorName ], //ç”¨æˆ·çš„å¯†ç  password: [ required: true, trigger: blur, validator: validatorPassword ],/script 12.3 æ›´æ–°ç”¨æˆ· æ ‡é¢˜åº”è¯¥è¯¥ä¸ºæ›´æ–°ç”¨æˆ·ï¼Œæ²¡æœ‰è¾“å…¥å¯†ç ã€‚å› ä¸ºä¿®æ”¹ä¸šåŠ¡æ—¶æˆ‘ä»¬éœ€è¦ç”¨åˆ°ç”¨æˆ·idï¼Œå› æ­¤å†ä¿®æ”¹æŒ‰é’®å­˜å‚¨è´¦å·ä¿¡æ¯èµ‹å€¼äº†ç”¨æˆ·çš„idã€‚ æˆ‘ä»¬æ ¹æ®è¿™ä¸ªidæ¥å†³å®šæˆ‘ä»¬çš„ç•Œé¢ã€‚ åˆå§‹åŒ–ç”¨æˆ·idï¼šæˆ‘ä»¬å†ä¿®æ”¹çš„æ—¶å€™å°†rowçš„å€¼å¤åˆ¶ç»™userParamsï¼Œå› æ­¤åœ¨å±•ç¤ºæŠ½å±‰çš„æ—¶å€™å°±ä¼šå˜æ¢ //æ›´æ–°å·²æœ‰çš„ç”¨æˆ·æŒ‰é’®çš„å›è°ƒ//row:å³ä¸ºå·²æœ‰ç”¨æˆ·çš„è´¦å·ä¿¡æ¯const updateUser = (row: User) = //æŠ½å±‰æ˜¾ç¤ºå‡ºæ¥ drawer.value = true //å­˜å‚¨æ”¶é›†å·²æœ‰çš„è´¦å·ä¿¡æ¯ Object.assign(userParams, row) //æ¸…é™¤ä¸Šä¸€æ¬¡çš„é”™è¯¯çš„æç¤ºä¿¡æ¯ nextTick(() = formRef.value.clearValidate(username) formRef.value.clearValidate(name) ) æ›´æ”¹å½“å‰å¸å·ä¹‹åï¼Œåº”è¯¥é‡æ–°ç™»é™† //ä¿å­˜æŒ‰é’®çš„å›è°ƒ const save = async () = ... //æ·»åŠ æˆ–è€…æ›´æ–°æˆåŠŸ //è·å–æœ€æ–°çš„å…¨éƒ¨è´¦å·çš„ä¿¡æ¯ getHasUser(userParams.id ? pageNo.value : 1) //æµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡ window.location.reload() ### 12.4 åˆ†é…è§’è‰²1. é™æ€é¡µé¢ `src\\views\\acl\\user\\index.vue` ```html !-- æŠ½å±‰ç»“æ„:å®Œæˆæ·»åŠ æ–°çš„ç”¨æˆ·è´¦å·|æ›´æ–°å·²æœ‰çš„è´¦å·ä¿¡æ¯ -- el-drawer v-model=drawer ... /el-drawer !-- æŠ½å±‰ç»“æ„:ç”¨æˆ·æŸä¸€ä¸ªå·²æœ‰çš„è´¦å·è¿›è¡ŒèŒä½åˆ†é… -- el-drawer v-model=drawer1 template #header h4åˆ†é…è§’è‰²(èŒä½)/h4 /template template #default el-form el-form-item label=ç”¨æˆ·å§“å el-input :disabled=true/el-input /el-form-item el-form-item label=èŒä½åˆ—è¡¨ el-checkbox @change=handleCheckAllChange v-model=checkAll :indeterminate=isIndeterminate å…¨é€‰ /el-checkbox !-- æ˜¾ç¤ºèŒä½çš„çš„å¤é€‰æ¡† -- el-checkbox-group @change=handleCheckedCitiesChange el-checkbox /el-checkbox /el-checkbox-group /el-form-item /el-form /template template #footer div style=flex: auto el-button @click=drawer1 = falseå–æ¶ˆ/el-button el-button type=primary @click=confirmClickç¡®å®š/el-button /div /template /el-drawer ç±»å‹ src\\api\\acl\\user\\type.ts //ä»£è¡¨ä¸€ä¸ªèŒä½çš„tsç±»å‹export interface RoleData id?: number createTime?: string updateTime?: string roleName: string remark: null//å…¨éƒ¨èŒä½çš„åˆ—è¡¨export type AllRole = RoleData[]//è·å–å…¨éƒ¨èŒä½çš„æ¥å£è¿”å›çš„æ•°æ®tsç±»å‹export interface AllRoleResponseData extends ResponseData data: assignRoles: AllRole allRolesList: AllRole //ç»™ç”¨æˆ·åˆ†é…èŒä½æ¥å£æºå¸¦å‚æ•°çš„tsç±»å‹export interface SetRoleData roleIdList: number[] userId: number API src\\api\\acl\\user\\index.ts //æšä¸¾åœ°å€enum API ALLROLE_URL = /admin/acl/user/toAssign, SETROLE_URL = /admin/acl/user/doAssignRole,//è·å–å…¨éƒ¨èŒä½ä»¥åŠåŒ…å«å½“å‰ç”¨æˆ·çš„å·²æœ‰çš„èŒä½export const reqAllRole = (userId: number) = return request.getany, AllRoleResponseData(API.ALLROLE_URL + `/$userId`)//åˆ†é…èŒä½export const reqSetUserRole = (data: SetRoleData) = return request.postany, any(API.SETROLE_URL, data) å±•ç¤ºé¡µé¢ templateel-drawer v-model=drawer1 template #header h4åˆ†é…è§’è‰²(èŒä½)/h4 /template template #default el-form el-form-item label=ç”¨æˆ·å§“å el-input v-model=userParams.username :disabled=true/el-input /el-form-item el-form-item label=èŒä½åˆ—è¡¨ el-checkbox @change=handleCheckAllChange v-model=checkAll :indeterminate=isIndeterminate å…¨é€‰ /el-checkbox !-- æ˜¾ç¤ºèŒä½çš„çš„å¤é€‰æ¡† -- el-checkbox-group v-model=userRole @change=handleCheckedCitiesChange el-checkbox v-for=(role, index) in allRole :key=index :label=role role.roleName /el-checkbox /el-checkbox-group /el-form-item /el-form /template template #footer div style=flex: auto el-button @click=drawer1 = falseå–æ¶ˆ/el-button el-button type=primary @click=confirmClickç¡®å®š/el-button /div /template /el-drawer/templatescript setup lang=ts//åˆ†é…è§’è‰²let drawer1 = ref(false)//å­˜å‚¨å…¨éƒ¨èŒä½çš„æ•°æ®let allRole = refAllRole([])//å½“å‰ç”¨æˆ·å·²æœ‰çš„èŒä½let userRole = refAllRole([])//åˆ†é…è§’è‰²æŒ‰é’®çš„å›è°ƒconst setRole = async (row: User) = //å­˜å‚¨å·²æœ‰çš„ç”¨æˆ·ä¿¡æ¯ Object.assign(userParams, row) //è·å–å…¨éƒ¨çš„èŒä½çš„æ•°æ®ä¸å½“å‰ç”¨æˆ·å·²æœ‰çš„èŒä½çš„æ•°æ® let result: AllRoleResponseData = await reqAllRole(userParams.id as number) if (result.code == 200) //å­˜å‚¨å…¨éƒ¨çš„èŒä½ allRole.value = result.data.allRolesList //å­˜å‚¨å½“å‰ç”¨æˆ·å·²æœ‰çš„èŒä½ userRole.value = result.data.assignRoles //æŠ½å±‰æ˜¾ç¤ºå‡ºæ¥ drawer1.value = true //æ”¶é›†é¡¶éƒ¨å¤é€‰æ¡†å…¨é€‰æ•°æ®let checkAll = refboolean(false)//æ§åˆ¶é¡¶éƒ¨å…¨é€‰å¤é€‰æ¡†ä¸ç¡®å®šçš„æ ·å¼let isIndeterminate = refboolean(true)//é¡¶éƒ¨çš„å…¨éƒ¨å¤é€‰æ¡†çš„changeäº‹ä»¶const handleCheckAllChange = (val: any) = //val:true(å…¨é€‰)|false(æ²¡æœ‰å…¨é€‰) //å°†æ‰€æœ‰è§’è‰²èµ‹ç»™ç”¨æˆ·è§’è‰² userRole.value = val ? allRole.value : [] //ä¸ç¡®å®šçš„æ ·å¼(ç¡®å®šæ ·å¼)- isIndeterminate.value = false//é¡¶éƒ¨å…¨éƒ¨çš„å¤é€‰æ¡†çš„changeäº‹ä»¶const handleCheckedCitiesChange = (value: string | any[]) = //é¡¶éƒ¨å¤é€‰æ¡†çš„å‹¾é€‰æ•°æ® //ä»£è¡¨:å‹¾é€‰ä¸Šçš„é¡¹ç›®ä¸ªæ•°ä¸å…¨éƒ¨çš„èŒä½ä¸ªæ•°ç›¸ç­‰ï¼Œé¡¶éƒ¨çš„å¤é€‰æ¡†å‹¾é€‰ä¸Š checkAll.value = value.length === allRole.value.length //ä¸ç¡®å®šçš„æ ·å¼ isIndeterminate.value = value.length !== allRole.value.length//ç¡®å®šæŒ‰é’®çš„å›è°ƒ(åˆ†é…èŒä½)const confirmClick = async () = //æ”¶é›†å‚æ•° let data: SetRoleData = userId: userParams.id as number, roleIdList: userRole.value.map((item) = return item.id as number ), //åˆ†é…ç”¨æˆ·çš„èŒä½ let result: any = await reqSetUserRole(data) if (result.code == 200) //æç¤ºä¿¡æ¯ ElMessage( type: success, message: åˆ†é…èŒåŠ¡æˆåŠŸ ) //å…³é—­æŠ½å±‰ drawer1.value = false //è·å–æ›´æ–°å®Œæ¯•ç”¨æˆ·çš„ä¿¡æ¯,æ›´æ–°å®Œæ¯•ç•™åœ¨å½“å‰é¡µ getHasUser(pageNo.value) /script å…¨é€‰éƒ¨åˆ†ï¼š @changeï¼šå…¨é€‰æ¡†ç‚¹å‡»æ—¶çš„å›è°ƒã€‚ v-modelï¼šç»‘å®šçš„æ•°æ®ï¼Œæ ¹æ®è¿™ä¸ªå€¼å†³å®šæ˜¯å¦å…¨é€‰ã€‚ :indeterminateï¼šä¸ç¡®å®šçŠ¶æ€ï¼Œæ—¢æ²¡æœ‰å…¨é€‰ä¹Ÿæ²¡æœ‰å…¨ä¸é€‰ï¼ˆ-ï¼‰ã€‚ å¤é€‰æ¡†éƒ¨åˆ†ï¼šv-for=(role, index) in allRoleï¼šéå†allRoleã€‚ :label=roleï¼šæ”¶é›†çš„æ•°æ®ï¼ˆå‹¾ä¸Šçš„æ•°æ®ï¼‰ã€‚ v-model=userRoleï¼šç»‘å®šæ”¶é›†çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ”¶é›†çš„æ•°æ®å­˜å‚¨åˆ°userRoleä¸­ã€‚ @changeï¼šå‹¾é€‰å˜åŒ–æ—¶çš„å›è°ƒã€‚ 12.5 åˆ é™¤ ç»‘å®šç‚¹å‡»äº‹ä»¶ !-- æ‰¹é‡åˆ é™¤ --el-button type=danger size=default @click=dialogFormVisible = true :disabled=selectIdArr.length === 0 æ‰¹é‡åˆ é™¤ /el-button el-dialog v-model=dialogFormVisible title=æ‰¹é‡åˆ é™¤ !-- https://lianyutian.github.io/posts/dd58b23f.html 10.3å…·åæ’æ§½ -- template #header spanæ‚¨ç¡®å®šè¦åˆ é™¤è¯¥ç”¨æˆ·å—ï¼Ÿ/span /template template #default el-button @click=dialogFormVisible = falseå–æ¶ˆ/el-button el-button type=primary @click=confirmç¡®è®¤/el-button /template/el-dialog...!-- row å•è¡Œåˆ é™¤ --el-table-column label=æ“ä½œ width=300px align=center !-- row å›ä¼ ç¼–è¾‘æ•°æ® -- template #default= row !-- åˆ†é…è§’è‰² -- el-button size=small icon=User @click=setRole(row) åˆ†é…è§’è‰² /el-button !-- ç¼–è¾‘ -- el-button type=primary size=small icon=Edit @click=updateUser(row) ç¼–è¾‘ /el-button el-popconfirm :title=`æ‚¨ç¡®å®šè¦åˆ é™¤$row.username?` width=250px icon=Delete @confirm=deleteUser(row.id) template #reference el-button type=danger size=small icon=Delete åˆ é™¤ /el-button /template /el-popconfirm /template /el-table-column API enum API //åˆ é™¤æŸä¸€ä¸ªè´¦å· DELETEUSER_URL = /admin/acl/user/remove/, //æ‰¹é‡åˆ é™¤çš„æ¥å£ DELETEALLUSER_URL = /admin/acl/user/batchRemove,//åˆ é™¤æŸä¸€ä¸ªè´¦å·çš„ä¿¡æ¯export const reqRemoveUser = (userId: number) = return request.deleteany, any(API.DELETEUSER_URL + userId)//æ‰¹é‡åˆ é™¤çš„æ¥å£export const reqSelectUser = (idList: number[]) = return request.delete(API.DELETEALLUSER_URL, data: idList ) æ¸²æŸ“é¡µé¢ //åˆ é™¤æŸä¸€ä¸ªç”¨æˆ·const deleteUser = async (userId: number) = let result: any = await reqRemoveUser(userId) if (result.code == 200) ElMessage( type: success, message: åˆ é™¤æˆåŠŸ ) getHasUser(userArr.value.length 1 ? pageNo.value : pageNo.value - 1) //tableå¤é€‰æ¡†å‹¾é€‰çš„æ—¶å€™ä¼šè§¦å‘çš„äº‹ä»¶let selectIdArr = ref([])console.log(selectIdArr.value.length)const handleSelectionChange = (value: any) = selectIdArr.value = value//æ‰¹é‡åˆ é™¤æŒ‰é’®çš„å›è°ƒconst deleteSelectUser = async () = //æ•´ç†æ‰¹é‡åˆ é™¤çš„å‚æ•° let idsList: any = selectIdArr.value.map((item: id: any ) = return item.id ) //æ‰¹é‡åˆ é™¤çš„è¯·æ±‚ let result: any = await reqSelectUser(idsList) if (result.code == 200) ElMessage( type: success, message: åˆ é™¤æˆåŠŸ ) getHasUser(userArr.value.length 1 ? pageNo.value : pageNo.value - 1) let dialogFormVisible = ref(false)const confirm = () = deleteSelectUser() dialogFormVisible.value = false 12.6 æœç´¢å’Œé‡ç½® æœç´¢ä¸šåŠ¡ä¸è·å–åˆå§‹æ•°æ®çš„è¯·æ±‚æ˜¯åŒä¸€ä¸ªï¼Œå› æ­¤æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹è·å–åˆå§‹ä¸šåŠ¡çš„è¯·æ±‚ã€‚æ›´å…·æ˜¯å¦å†™é“usernameæ¥åˆ¤æ–­ã€‚ //è·å–ç”¨æˆ·è´¦å·ä¿¡æ¯çš„æ¥å£export const reqUserInfo = (page: number, limit: number, username: string) = if (username) return request.getany, UserResponseData( API.ALLUSER_URL + `$page/$limit/?username=$username`, ) else return request.getany, UserResponseData( API.ALLUSER_URL + `$page/$limit`, ) æ¸²æŸ“é¡µé¢ template el-form :inline=true class=form el-form-item label=ç”¨æˆ·å: el-input placeholder=è¯·ä½ è¾“å…¥æœç´¢ç”¨æˆ·å v-model=keyword/el-input /el-form-item el-form-item el-button type=primary size=default @click=search æœç´¢ /el-button el-button size=default @click=reseté‡ç½®/el-button /el-form-item /el-form/templatescript setup lang=tslet keyword = ref()//æœç´¢æŒ‰é’®çš„å›è°ƒconst search = () = //æ ¹æ®å…³é”®å­—è·å–ç›¸åº”çš„ç”¨æˆ·æ•°æ® getHasUser() //æ¸…ç©ºå…³é”®å­— keyword.value = //é‡ç½®import useLayOutSettingStore from @/store/modules/setting//è·å–æ¨¡æ¿settingä»“åº“let settingStore = useLayOutSettingStore()//é‡ç½®æŒ‰é’®const reset = () = settingStore.refresh = !settingStore.refresh/script 13. è§’è‰²ç®¡ç†13.1 è§’è‰²ç®¡ç†å±•ç¤º é™æ€é¡µé¢ src\\views\\acl\\role\\index.vue template el-card style=height: 80px el-form :inline=true class=form el-form-item label=èŒä½æœç´¢ el-input placeholder=è¯·ä½ è¾“å…¥æœç´¢èŒä½å…³é”®å­—/el-input /el-form-item el-form-item el-button type=primary size=defaultæœç´¢/el-button el-button size=defaulté‡ç½®/el-button /el-form-item /el-form /el-card el-card style=margin: 10px 0px el-button type=primary size=defaultæ·»åŠ èŒä½/el-button el-table border style=margin: 10px 0px el-table-column type=index align=center label=#/el-table-column el-table-column label=ID align=center prop=id/el-table-column el-table-column label=èŒä½åç§° align=center prop=roleName show-overflow-tooltip /el-table-column el-table-column label=åˆ›å»ºæ—¶é—´ align=center show-overflow-tooltip prop=createTime /el-table-column el-table-column label=æ›´æ–°æ—¶é—´ align=center show-overflow-tooltip prop=updateTime /el-table-column el-table-column label=æ“ä½œ width=280px align=center !-- row:å·²æœ‰çš„èŒä½å¯¹è±¡ -- template #= row, $index el-button size=small icon=User åˆ†é…æƒé™ /el-button el-button type=primary size=small icon=Editç¼–è¾‘/el-button el-popconfirm :title=`ä½ ç¡®å®šè¦åˆ é™¤$row.roleName?` width=260px template #reference el-button type=danger size=small icon=Delete åˆ é™¤ /el-button /template /el-popconfirm /template /el-table-column /el-table /el-card el-pagination v-model:current-page=pageNo v-model:page-size=pageSize :page-sizes=[10, 20, 30, 40] :background=true layout=prev, pager, next, jumper,-,sizes,total :total=400 @current-change=getHasRole @size-change=sizeChange //template æ•°æ®ç±»å‹ src\\api\\acl\\role\\type.ts export interface ResponseData code: number message: string ok: boolean//èŒä½æ•°æ®ç±»å‹export interface RoleData id?: number createTime?: string updateTime?: string roleName: string remark?: null//å…¨éƒ¨èŒä½çš„æ•°ç»„çš„tsç±»å‹export type Records = RoleData[]//å…¨éƒ¨èŒä½æ•°æ®çš„ç›¸åº”çš„tsç±»å‹export interface RoleResponseData extends ResponseData data: records: Records total: number size: number current: number orders: [] optimizeCountSql: boolean hitCount: boolean countId: null maxLimit: null searchCount: boolean pages: number API src\\api\\acl\\role\\index.ts //è§’è‰²ç®¡ç†æ¨¡å—çš„çš„æ¥å£import request from @/utils/requestimport type RoleResponseData from ./type//æšä¸¾åœ°å€enum API //è·å–å…¨éƒ¨çš„èŒä½æ¥å£ ALLROLE_URL = /admin/acl/role/,//è·å–å…¨éƒ¨çš„è§’è‰²export const reqAllRoleList = ( page: number, limit: number, roleName: string,) = return request.getany, RoleResponseData( API.ALLROLE_URL + `$page/$limit/?roleName=$roleName`, ) æ¸²æŸ“é¡µé¢ template el-card style=height: 80px ... /el-card el-card style=margin: 10px 0px el-button type=primary size=defaultæ·»åŠ èŒä½/el-button el-table border style=margin: 10px 0px :data=allRole el-table-column type=index align=center label=#/el-table-column el-table-column label=ID align=center prop=id/el-table-column el-table-column label=èŒä½åç§° align=center prop=roleName show-overflow-tooltip /el-table-column el-table-column label=åˆ›å»ºæ—¶é—´ align=center show-overflow-tooltip prop=createTime /el-table-column el-table-column label=æ›´æ–°æ—¶é—´ align=center show-overflow-tooltip prop=updateTime /el-table-column el-table-column label=æ“ä½œ width=280px align=center !-- row:å·²æœ‰çš„èŒä½å¯¹è±¡ -- template #default= row el-button size=small icon=Useråˆ†é…æƒé™/el-button el-button type=primary size=small icon=Editç¼–è¾‘/el-button el-popconfirm :title=`ä½ ç¡®å®šè¦åˆ é™¤$row.roleName?` width=260px template #reference el-button type=danger size=small icon=Delete åˆ é™¤ /el-button /template /el-popconfirm /template /el-table-column /el-table /el-card el-pagination v-model:current-page=pageNo v-model:page-size=pageSize :page-sizes=[3, 5, 7, 9] :background=true layout=prev, pager, next, jumper,-,sizes,total :total=total @current-change=getHasRole @size-change=sizeChange //templatescript setup lang=tsimport reqAllRoleList from @/api/acl/role/indeximport Records, RoleResponseData from @/api/acl/role/typeimport ref, onMounted from vue//å½“å‰é¡µç let pageNo = refnumber(1)//ä¸€é¡µå±•ç¤ºå‡ æ¡æ•°æ®let pageSize = refnumber(10)//æœç´¢èŒä½å…³é”®å­—let keyword = refstring()//æ€»è¡Œæ•°let total = refnumber(0)//æ€»è§’è‰²é›†åˆlet allRole = refRecords()//ç»„ä»¶æŒ‚è½½å®Œæ¯•onMounted(() = //è·å–èŒä½è¯·æ±‚ getHasRole())//è·å–å…¨éƒ¨ç”¨æˆ·ä¿¡æ¯çš„æ–¹æ³•|åˆ†é¡µå™¨å½“å‰é¡µç å‘ç”Ÿå˜åŒ–çš„å›è°ƒconst getHasRole = async (pager = 1) = //ä¿®æ”¹å½“å‰é¡µç  pageNo.value = pager let result: RoleResponseData = await reqAllRoleList( pageNo.value, pageSize.value, keyword.value, ) if (result.code == 200) total.value = result.data.total allRole.value = result.data.records // å½“ä¸‹æ‹‰èœå•å‘ç”Ÿå˜åŒ–çš„æ—¶å€™è§¦å‘æ­¤æ–¹æ³•// è¿™ä¸ªè‡ªå®šä¹‰äº‹ä»¶,åˆ†é¡µå™¨ç»„ä»¶ä¼šå°†ä¸‹æ‹‰èœå•é€‰ä¸­æ•°æ®è¿”å›const sizeChange = () = // å½“å‰æ¯ä¸€é¡µçš„æ•°æ®é‡å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå½“å‰é¡µç å½’1 getHasRole()/script 13.2 æœç´¢å’Œé‡ç½® æ¸²æŸ“é¡µé¢ template el-card style=height: 80px el-form :inline=true class=form el-form-item label=èŒä½æœç´¢ el-input placeholder=è¯·ä½ è¾“å…¥æœç´¢èŒä½å…³é”®å­— v-model=keyword /el-input /el-form-item el-form-item el-button type=primary size=default @click=search æœç´¢ /el-button el-button size=default @click=reseté‡ç½®/el-button /el-form-item /el-form /el-card/templatescript setup lang=ts//æœç´¢const search = () = //å†æ¬¡å‘è¯·æ±‚æ ¹æ®å…³é”®å­— getHasRole() keyword.value = //é‡ç½®import useLayOutSettingStore from @/store/modules/setting//è·å–æ¨¡æ¿settingä»“åº“let settingStore = useLayOutSettingStore()//é‡ç½®æŒ‰é’®const reset = () = settingStore.refresh = !settingStore.refresh/script 13.3 æ·»åŠ ä¿®æ”¹èŒä½ é™æ€é¡µé¢ !-- æ·»åŠ èŒä½ä¸æ›´æ–°å·²æœ‰èŒä½çš„ç»“æ„:å¯¹è¯æ¡† -- el-dialog v-model=dialogVisite title=æ·»åŠ èŒä½ el-form ref=roleForm :rules=rules :model=roleParams el-form-item label=èŒä½åç§° el-input placeholder=è¯·ä½ è¾“å…¥èŒä½åç§° v-model=roleParams.roleName /el-input /el-form-item /el-form template #footer el-button type=primary size=default @click=dialogVisite = false å–æ¶ˆ /el-button el-button type=primary size=default @click=saveç¡®å®š/el-button /template /el-dialog API //æšä¸¾åœ°å€enum API //æ–°å¢å²—ä½çš„æ¥å£åœ°å€ ADDROLE_URL = /admin/acl/role/save, //æ›´æ–°å·²æœ‰çš„èŒä½ UPDATEROLE_URL = /admin/acl/role/update,//æ·»åŠ èŒä½ä¸æ›´æ–°å·²æœ‰èŒä½æ¥å£export const reqAddOrUpdateRole = (data: RoleData) = if (data.id) return request.putany, any(API.UPDATEROLE_URL, data) else return request.postany, any(API.ADDROLE_URL, data) æ¸²æŸ“é¡µé¢ template !-- è§’è‰²ç•Œé¢å±•ç¤º -- el-card style=margin: 10px 0px el-button type=primary size=default @click=addRole æ·»åŠ èŒä½ /el-button el-table border style=margin: 10px 0px :data=allRole ... el-table-column label=æ“ä½œ width=280px align=center !-- row:å·²æœ‰çš„èŒä½å¯¹è±¡ -- template #default= row el-button size=small icon=Useråˆ†é…æƒé™/el-button el-button type=primary size=small icon=Edit @click=updateRole(row) ç¼–è¾‘ /el-button /template /el-table-column /el-table /el-card !-- æ·»åŠ èŒä½ä¸æ›´æ–°å·²æœ‰èŒä½çš„ç»“æ„:å¯¹è¯æ¡† -- el-dialog v-model=dialogVisite title=æ·»åŠ èŒä½ el-form ref=roleForm :rules=rules :model=roleParams el-form-item label=èŒä½åç§° el-input placeholder=è¯·ä½ è¾“å…¥èŒä½åç§° v-model=roleParams.roleName /el-input /el-form-item /el-form template #footer el-button type=primary size=default @click=dialogVisite = false å–æ¶ˆ /el-button el-button type=primary size=default @click=saveç¡®å®š/el-button /template /el-dialog/templatescript setup lang=ts//æ·»åŠ ä¿®æ”¹èŒä½let dialogVisite = refboolean(false)//èŒä½å‚æ•°let roleParams = reactiveRoleData( id: 0, roleName: ,)//æ·»åŠ èŒä½è¡¨å•å®ä¾‹let roleForm = ref()//æ·»åŠ èŒä½æŒ‰é’®çš„å›è°ƒconst addRole = () = //å¯¹è¯æ¡†æ˜¾ç¤ºå‡ºæ¥ dialogVisite.value = true //æ¸…ç©ºæ•°æ® Object.assign(roleParams, roleName: , id: 0, ) //æ¸…ç©ºä¸Šä¸€æ¬¡è¡¨å•æ ¡éªŒé”™è¯¯ç»“æœ nextTick(() = roleForm.value.clearValidate(roleName) )//æ›´æ–°å·²æœ‰çš„èŒä½æŒ‰é’®çš„å›è°ƒconst updateRole = (row: RoleData) = //æ˜¾ç¤ºå‡ºå¯¹è¯æ¡† dialogVisite.value = true //å­˜å‚¨å·²æœ‰çš„èŒä½----å¸¦æœ‰IDçš„ Object.assign(roleParams, row) //æ¸…ç©ºä¸Šä¸€æ¬¡è¡¨å•æ ¡éªŒé”™è¯¯ç»“æœ nextTick(() = roleForm.value.clearValidate(roleName) )//è‡ªå®šä¹‰æ ¡éªŒè§„åˆ™çš„å›è°ƒconst validatorRoleName = (_rule: any, value: any, callBack: any) = if (value.trim().length = 2) callBack() else callBack(new Error(èŒä½åç§°è‡³å°‘ä¸¤ä½)) //èŒä½æ ¡éªŒè§„åˆ™const rules = roleName: [ required: true, trigger: blur, validator: validatorRoleName ],//ç¡®å®šæŒ‰é’®çš„å›è°ƒconst save = async () = //è¡¨å•æ ¡éªŒç»“æœ,ç»“æœé€šè¿‡åœ¨å‘è¯·æ±‚ã€ç»“æœæ²¡æœ‰é€šè¿‡ä¸åº”è¯¥åœ¨å‘ç”Ÿè¯·æ±‚ await roleForm.value.validate() //æ·»åŠ èŒä½|æ›´æ–°èŒä½çš„è¯·æ±‚ let result: any = await reqAddOrUpdateRole(roleParams) if (result.code == 200) //æç¤ºæ–‡å­— ElMessage( type: success, message: roleParams.id ? æ›´æ–°æˆåŠŸ : æ·»åŠ æˆåŠŸ, ) //å¯¹è¯æ¡†æ˜¾ç¤º dialogVisite.value = false //å†æ¬¡è·å–å…¨éƒ¨çš„å·²æœ‰çš„èŒä½ getHasRole(roleParams.id ? pageNo.value : 1) /script 13.4 åˆ†é…è§’è‰²æƒé™ é™æ€é¡µé¢ !-- æŠ½å±‰ç»„ä»¶:åˆ†é…èŒä½çš„èœå•æƒé™ä¸æŒ‰é’®çš„æƒé™ --el-drawer v-model=drawer template #header h4åˆ†é…èœå•ä¸æŒ‰é’®çš„æƒé™/h4 /template template #default !-- æ ‘å½¢æ§ä»¶ -- el-tree ref=tree :data=menuArr show-checkbox node-key=id default-expand-all :default-checked-keys=selectArr :props=defaultProps / /template template #footer div style=flex: auto el-button @click=drawer = falseå–æ¶ˆ/el-button el-button type=primary @click=handlerç¡®å®š/el-button /div /template/el-drawer https://element-plus.org/zh-CN/component/tree.html#%E6%A0%91%E8%8A%82%E7%82%B9%E7%9A%84%E9%80%89%E6%8B%A9 æ ‘å½¢æ§ä»¶ dataï¼šå±•ç¤ºçš„æ•°æ® show-checkboxï¼šèŠ‚ç‚¹æ˜¯å¦å¯è¢«é€‰æ‹© node-keyï¼šæ¯ä¸ªæ ‘èŠ‚ç‚¹ç”¨æ¥ä½œä¸ºå”¯ä¸€æ ‡è¯†çš„å±æ€§ï¼Œæ•´æ£µæ ‘åº”è¯¥æ˜¯å”¯ä¸€çš„ default-expand-allï¼šé»˜è®¤å±•å¼€æ‰€æœ‰èŠ‚ç‚¹ default-checked-keysï¼šé»˜è®¤å‹¾é€‰çš„èŠ‚ç‚¹çš„ key çš„æ•°ç»„ propsï¼šå±æ€§ï¼š labelï¼šæŒ‡å®šèŠ‚ç‚¹æ ‡ç­¾ä¸ºèŠ‚ç‚¹å¯¹è±¡çš„æŸä¸ªå±æ€§å€¼ children:æŒ‡å®šå­æ ‘ä¸ºèŠ‚ç‚¹å¯¹è±¡çš„æŸä¸ªå±æ€§å€¼ getHalfCheckedKeys åœ¨ element-plus ä¸­çš„ getHalfCheckedNodes æ¶‰åŠåˆ°æ ‘å½¢æ§ä»¶ï¼ˆTree Componentï¼‰çš„åŠé€‰çŠ¶æ€ã€‚åœ¨æ ‘å½¢æ§ä»¶ä¸­ï¼ŒèŠ‚ç‚¹å¯ä»¥æœ‰ä¸‰ç§çŠ¶æ€ï¼šé€‰ä¸­ã€æœªé€‰ä¸­å’ŒåŠé€‰ä¸­ã€‚ åŠé€‰ä¸­çŠ¶æ€é€šå¸¸è¡¨ç¤ºè¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸­æœ‰éƒ¨åˆ†èŠ‚ç‚¹è¢«é€‰ä¸­ï¼Œè€Œä¸æ˜¯å…¨éƒ¨ã€‚è¿™ç§çŠ¶æ€åœ¨æ ‘å½¢ç»“æ„ä¸­å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸ç”¨æˆ·é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹çš„ä¸€éƒ¨åˆ†å­èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯å¼ºåˆ¶ç”¨æˆ·åªèƒ½å…¨é€‰æˆ–å…¨ä¸é€‰ã€‚ æ•°æ®ç±»å‹ //èœå•ä¸æŒ‰é’®æ•°æ®çš„tsç±»å‹export interface MenuData id: number createTime: string updateTime: string pid: number name: string code: string toCode: string type: number status: null level: number children?: MenuList select: booleanexport type MenuList = MenuData[]export interface MenuResponseData extends ResponseData data: MenuList API //æšä¸¾åœ°å€enum API //è·å–å…¨éƒ¨çš„èœå•ä¸æŒ‰é’®çš„æ•°æ® ALLPERMISSTION = /admin/acl/permission/toAssign/, //ç»™ç›¸åº”çš„èŒä½åˆ†é…æƒé™ SETPERMISTION_URL = /admin/acl/permission/doAssign/?,//è·å–å…¨éƒ¨èœå•ä¸æŒ‰é’®æƒé™æ•°æ®export const reqAllMenuList = (roleId: number) = return request.getany, MenuResponseData(API.ALLPERMISSTION + roleId)//ç»™ç›¸åº”çš„èŒä½ä¸‹å‘æƒé™export const reqSetPermisstion = (roleId: number, permissionId: number[]) = return request.post( API.SETPERMISTION_URL + `roleId=$roleIdpermissionId=$permissionId`, ) é¡µé¢æ¸²æŸ“ template ... !-- æŠ½å±‰ç»„ä»¶:åˆ†é…èŒä½çš„èœå•æƒé™ä¸æŒ‰é’®çš„æƒé™ -- el-drawer v-model=drawer template #header h4åˆ†é…èœå•ä¸æŒ‰é’®çš„æƒé™/h4 /template template #default !-- æ ‘å½¢æ§ä»¶ -- el-tree ref=tree :data=menuArr show-checkbox node-key=id default-expand-all :default-checked-keys=selectArr :props=defaultProps / /template template #footer div style=flex: auto el-button @click=drawer = falseå–æ¶ˆ/el-button el-button type=primary @click=handlerç¡®å®š/el-button /div /template /el-drawer/templatescript setup lang=ts//å‡†å¤‡ä¸€ä¸ªæ•°ç»„:æ•°ç»„ç”¨äºå­˜å‚¨å‹¾é€‰çš„èŠ‚ç‚¹çš„ID(å››çº§çš„)let selectArr = refnumber[]([])//å®šä¹‰æ•°ç»„å­˜å‚¨ç”¨æˆ·æƒé™çš„æ•°æ®let menuArr = refMenuList([])//è·å–treeç»„ä»¶å®ä¾‹let tree = refany()//æ§åˆ¶æŠ½å±‰æ˜¾ç¤ºä¸éšè—let drawer = refboolean(false)//å·²æœ‰çš„èŒä½çš„æ•°æ®const setPermisstion = async (row: RoleData) = //æŠ½å±‰æ˜¾ç¤ºå‡ºæ¥ drawer.value = true //æ”¶é›†å½“å‰è¦åˆ†ç±»æƒé™çš„èŒä½çš„æ•°æ® Object.assign(roleParams, row) //æ ¹æ®èŒä½è·å–æƒé™çš„æ•°æ® let result: MenuResponseData = await reqAllMenuList(roleParams.id as number) if (result.code === 200) menuArr.value = result.data selectArr.value = filterSelectArr(menuArr.value, []) const defaultProps = children: children, label: name,//è¿‡æ»¤å‡ºé€‰ä¸­çš„å››çº§id//è·å–å·²åˆ†é…æƒé™çš„idï¼Œè¿™é‡Œæˆ‘ä»¬åªéœ€è¦æ”¶é›†æœ€åä¸€å±‚çš„idå³å¯ï¼Œå› ä¸ºç»„ä»¶ä¼šè‡ªåŠ¨æ ¹æ®æœ€åä¸€å±‚çš„é€‰æ‹©æƒ…å†µå†³å®šä¸Šå±‚çš„é€‰æ‹©çŠ¶å†µã€‚const filterSelectArr = (allData: any, initArr: any) = allData.forEach((item: any) = if (item.select item.level == 4) initArr.push(item.id) if (item.children item.children.length 0) filterSelectArr(item.children, initArr) ) return initArr//æŠ½å±‰ç¡®å®šæŒ‰é’®çš„å›è°ƒconst handler = async () = //èŒä½çš„ID const roleId = roleParams.id as number //é€‰ä¸­èŠ‚ç‚¹çš„ID let arr = tree.value.getCheckedKeys() //åŠé€‰çš„ID let arr1 = tree.value.getHalfCheckedKeys() let permissionId = arr.concat(arr1) //ä¸‹å‘æƒé™ let result: any = await reqSetPermisstion(roleId, permissionId) if (result.code === 200) //æŠ½å±‰å…³é—­ drawer.value = false ElMessage( type: success, message: åˆ†é…æƒé™æˆåŠŸ, ) else drawer.value = false ElMessage( type: error, message: result.data.message ) return getHasRole(allRole.value.length 1 ? pageNo.value : pageNo.value - 1)/script 13.5 åˆ é™¤è§’è‰² API enum API //åˆ é™¤å·²æœ‰çš„èŒä½ REMOVEROLE_URL = /admin/acl/role/remove/,//åˆ é™¤å·²æœ‰çš„èŒä½export const reqRemoveRole = (roleId: number) = return request.deleteany, any(API.REMOVEROLE_URL + roleId) æ¸²æŸ“é¡µé¢ el-popconfirm :title=`ä½ ç¡®å®šè¦åˆ é™¤$row.roleName?` width=260px @confirm=removeRole(row.id) template #reference el-button type=danger size=small icon=Delete åˆ é™¤ /el-button /template/el-popconfirm//åˆ é™¤å·²æœ‰çš„èŒä½const removeRole = async (id: number) = let result: any = await reqRemoveRole(id) if (result.code === 200) //æç¤ºä¿¡æ¯ ElMessage( type: success, message: åˆ é™¤æˆåŠŸ ) getHasRole(allRole.value.length 1 ? pageNo.value : pageNo.value - 1) 14. èœå•ç®¡ç†14.1 èœå•å±•ç¤º é™æ€é¡µé¢ src\\views\\acl\\permission\\index.vue template div el-table style=width: 100%; margin-bottom: 20px row-key=id border el-table-column label=åç§°/el-table-column el-table-column label=æƒé™å€¼/el-table-column el-table-column label=ä¿®æ”¹æ—¶é—´/el-table-column el-table-column label=æ“ä½œ !-- row:å³ä¸ºå·²æœ‰çš„èœå•å¯¹è±¡|æŒ‰é’®çš„å¯¹è±¡çš„æ•°æ® -- template el-button size=small xxxx /el-button el-button type=primary size=small ç¼–è¾‘ /el-button el-button type=danger size=small åˆ é™¤ /el-button /template /el-table-column /el-table /div/templatescript setup lang=ts/scriptstyle lang=scss scoped/style æ•°æ®ç±»å‹ src\\api\\acl\\permission\\type.ts //æ•°æ®ç±»å‹å®šä¹‰export interface ResponseData code: number message: string ok: boolean//èœå•æ•°æ®ä¸æŒ‰é’®æ•°æ®çš„tsç±»å‹export interface Permisstion id?: number createTime: string updateTime: string pid: number name: string code: null toCode: null type: number status: null level: number children?: PermisstionList select: booleanexport type PermisstionList = Permisstion[]//èœå•æ¥å£è¿”å›çš„æ•°æ®ç±»å‹export interface PermisstionResponseData extends ResponseData data: PermisstionList API src\\api\\acl\\permission\\index.ts import request from @/utils/requestimport type PermisstionResponseData from ./type//æšä¸¾åœ°å€enum API //è·å–å…¨éƒ¨èœå•ä¸æŒ‰é’®çš„æ ‡è¯†æ•°æ® ALLPERMISSTION_URL = /admin/acl/permission,//è·å–èœå•æ•°æ®export const reqAllPermisstion = () = return request.getany, PermisstionResponseData(API.ALLPERMISSTION_URL) æ¸²æŸ“é¡µé¢ src\\views\\acl\\permission\\index.vue template div el-table :data=permisstionArr style=width: 100%; margin-bottom: 20px row-key=id border el-table-column label=åç§° prop=name/el-table-column el-table-column label=æƒé™å€¼ prop=code/el-table-column el-table-column label=ä¿®æ”¹æ—¶é—´ prop=updateTime/el-table-column el-table-column label=æ“ä½œ !-- row:å³ä¸ºå·²æœ‰çš„èœå•å¯¹è±¡|æŒ‰é’®çš„å¯¹è±¡çš„æ•°æ® -- template #default= row el-button size=small :disabled=row.level == 4 ? true : false row.level == 3 ? æ·»åŠ åŠŸèƒ½ : æ·»åŠ èœå• /el-button el-button type=primary size=small :disabled=row.level == 1 ? true : false ç¼–è¾‘ /el-button el-button type=danger size=small :disabled=row.level == 1 ? true : false åˆ é™¤ /el-button /template /el-table-column /el-table /div/templatescript setup lang=tsimport onMounted, ref from vueimport PermisstionList, PermisstionResponseData, from @/api/acl/permission/typeimport reqAllPermisstion from @/api/acl/permission/index//å­˜å‚¨èœå•çš„æ•°æ®let permisstionArr = refPermisstionList([])//è·å–èœå•æ•°æ®çš„æ–¹æ³•const getHasPermisstion = async () = let result: PermisstionResponseData = await reqAllPermisstion() if (result.code == 200) permisstionArr.value = result.data //ç»„ä»¶æŒ‚è½½å®Œæ¯•onMounted(() = getHasPermisstion())/scriptstyle lang=scss scoped/style 14.2 æ·»åŠ ç¼–è¾‘èœå• é™æ€é¡µé¢ !-- å¯¹è¯æ¡†ç»„ä»¶:æ·»åŠ æˆ–è€…æ›´æ–°å·²æœ‰çš„èœå•çš„æ•°æ®ç»“æ„ --el-dialog !-- è¡¨å•ç»„ä»¶:æ”¶é›†æ–°å¢ä¸å·²æœ‰çš„èœå•çš„æ•°æ® -- el-form el-form-item label=åç§° el-input placeholder=è¯·ä½ è¾“å…¥èœå•åç§° /el-input /el-form-item el-form-item label=æƒé™ el-input placeholder=è¯·ä½ è¾“å…¥æƒé™æ•°å€¼ /el-input /el-form-item /el-form template #footer span class=dialog-footer el-buttonå–æ¶ˆ/el-button el-button type=primaryç¡®å®š/el-button /span /template/el-dialog æ•°æ®ç±»å‹ //æ·»åŠ ä¸ä¿®æ”¹èœå•æºå¸¦çš„å‚æ•°çš„tsç±»å‹export interface MenuParams id?: number //ID code: string //æƒé™æ•°å€¼ level: number //å‡ çº§èœå• name: string //èœå•çš„åå­— pid: number //èœå•çš„ID API //ç»™æŸä¸€çº§èœå•æ–°å¢ä¸€ä¸ªå­èœå•ADDMENU_URL = /admin/acl/permission/save,//æ›´æ–°æŸä¸€ä¸ªå·²æœ‰çš„èœå•UPDATE_URL = /admin/acl/permission/update,//æ·»åŠ ä¸æ›´æ–°èœå•çš„æ–¹æ³•export const reqAddOrUpdateMenu = (data: MenuParams) = if (data.id) return request.putany, any(API.UPDATE_URL, data) else return request.postany, any(API.ADDMENU_URL, data) æ¸²æŸ“é¡µé¢ template !-- å¯¹è¯æ¡†ç»„ä»¶:æ·»åŠ æˆ–è€…æ›´æ–°å·²æœ‰çš„èœå•çš„æ•°æ®ç»“æ„ -- el-dialog v-model=dialogVisible :title=menuData.id ? æ›´æ–°èœå• : æ·»åŠ èœå• !-- è¡¨å•ç»„ä»¶:æ”¶é›†æ–°å¢ä¸å·²æœ‰çš„èœå•çš„æ•°æ® -- el-form el-form-item label=åç§° el-input placeholder=è¯·ä½ è¾“å…¥èœå•åç§° v-model=menuData.name /el-input /el-form-item el-form-item label=æƒé™ el-input placeholder=è¯·ä½ è¾“å…¥æƒé™æ•°å€¼ v-model=menuData.code /el-input /el-form-item /el-form template #footer span class=dialog-footer el-button @click=dialogVisible = falseå–æ¶ˆ/el-button el-button type=primary @click=saveç¡®å®š/el-button /span /template /el-dialog /div/templatescript setup lang=ts//æºå¸¦çš„å‚æ•°let menuData = reactiveMenuParams( code: , level: 0, name: , pid: 0,)let dialogVisible = ref(false)//æ·»åŠ èœå•æŒ‰é’®çš„å›è°ƒconst addPermission = (row: Permission) = //æ¸…ç©ºæ•°æ® Object.assign(menuData, id: 0, code: , level: 0, name: , pid: 0, ) //å¯¹è¯æ¡†æ˜¾ç¤ºå‡ºæ¥ dialogVisible.value = true //æ”¶é›†æ–°å¢çš„èœå•çš„levelæ•°å€¼ menuData.level = row.level + 1 //ç»™è°æ–°å¢å­èœå• menuData.pid = row.id as number//ç¼–è¾‘å·²æœ‰çš„èœå•const updatePermisstion = (row: Permission) = dialogVisible.value = true //ç‚¹å‡»ä¿®æ”¹æŒ‰é’®:æ”¶é›†å·²æœ‰çš„èœå•çš„æ•°æ®è¿›è¡Œæ›´æ–° Object.assign(menuData, row)//ç¡®å®šæŒ‰é’®çš„å›è°ƒconst save = async () = //å‘è¯·æ±‚:æ–°å¢å­èœå•|æ›´æ–°æŸä¸€ä¸ªå·²æœ‰çš„èœå•çš„æ•°æ® let result: any = await reqAddOrUpdateMenu(menuData) if (result.code == 200) //å¯¹è¯æ¡†éšè— dialogVisible.value = false //æç¤ºä¿¡æ¯ ElMessage( type: success, message: menuData.id ? æ›´æ–°æˆåŠŸ : æ·»åŠ æˆåŠŸ, ) //å†æ¬¡è·å–å…¨éƒ¨æœ€æ–°çš„èœå•çš„æ•°æ® getHasPermisstion() /scriptstyle lang=scss scoped/style 14.3 åˆ é™¤ API //åˆ é™¤å·²æœ‰çš„èœå• DELETEMENU_URL = /admin/acl/permission/remove/,//åˆ é™¤æŸä¸€ä¸ªå·²æœ‰çš„èœå•export const reqRemoveMenu = (id: number) = return request.deleteany, any(API.DELETEMENU_URL + id) æ¸²æŸ“é¡µé¢ template div !-- èœå•å±•ç¤ºé¡µé¢ -- el-table :data=permisstionArr style=width: 100%; margin-bottom: 20px row-key=id border el-table-column label=æ“ä½œ !-- row:å³ä¸ºå·²æœ‰çš„èœå•å¯¹è±¡|æŒ‰é’®çš„å¯¹è±¡çš„æ•°æ® -- template #default= row el-popconfirm :title=`æ‚¨ç¡®å®šè¦åˆ é™¤$row.name?` width=260px @confirm=removeMenu(row.id) template #reference el-button type=danger size=small :disabled=row.level == 1 ? true : false åˆ é™¤ /el-button /template /el-popconfirm /template /el-table-column /el-table /div/templatescript setup lang=ts//åˆ é™¤æŒ‰é’®å›è°ƒconst removeMenu = async (id: number) = let result = await reqRemoveMenu(id) if (result.code === 200) ElMessage( type: success, message: åˆ é™¤æˆåŠŸ ) else ElMessage( type: error, message: åˆ é™¤å¤±è´¥ ) getHasPermisstion()/scriptstyle lang=scss scoped/style 15. é¦–é¡µæ¨¡å— æ¸²æŸ“é¡µé¢ src\\views\\home\\index.vue template div el-card div class=box img :src=userStore.avatar alt= class=avatar / div class=bottom h3 class=title getTime() å¥½å‘€ï¼Œ userStore.username /h3 p class=subtitleç¡…è°·ç”„é€‰è¿è¥å¹³å°/p /div /div /el-card div class=bottoms svg-icon name=welcome width=800px height=400px/svg-icon /div /div/templatescript setup lang=tsimport getTime from @/utils/time//å¼•å…¥ç”¨æˆ·ç›¸å…³çš„ä»“åº“,è·å–å½“å‰ç”¨æˆ·çš„å¤´åƒã€æ˜µç§°import useUserStore from @/store/modules/user//è·å–å­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„ä»“åº“å¯¹è±¡let userStore = useUserStore()/scriptstyle lang=scss scoped.box display: flex; .avatar width: 100px; height: 100px; border-radius: 50%; .bottom margin-left: 20px; .title font-size: 30px; font-weight: 900; margin-bottom: 30px; .subtitle font-style: italic; color: skyblue; .bottoms margin-top: 10px; display: flex; justify-content: center;/style 16. settingæŒ‰é’®æ¨¡å—16.1 æš—é»‘æ¨¡å¼ é™æ€é¡µé¢ src\\layout\\tabbar\\setting\\index.vue template el-popover placement=bottom title=ä¸»é¢˜è®¾ç½® :width=300 trigger=hover !-- è¡¨å•å…ƒç´  -- el-form el-form-item label=æš—é»‘æ¨¡å¼ el-switch @change=changeDark v-model=dark class=mt-2 inline-prompt active-icon=MoonNight inactive-icon=Sunny / /el-form-item /el-form template #reference el-button size=small icon=Setting circle/el-button /template /el-popover/templatescript setup lang=ts/scriptscript lang=tsexport default name: Setting,/scriptstyle lang=scss scoped/style https://element-plus.org/zh-CN/component/popover.html#%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95 https://element-plus.org/zh-CN/component/switch.html#%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95 https://element-plus.org/zh-CN/guide/dark-mode.html#%E6%9A%97%E9%BB%91%E6%A8%A1%E5%BC%8F js src\\main.ts //æš—é»‘æ¨¡å¼éœ€è¦çš„æ ·å¼import element-plus/theme-chalk/dark/css-vars.css åˆ‡æ¢å›è°ƒ src\\layout\\tabbar\\setting\\index.vue //æ”¶é›†å¼€å…³çš„æ•°æ®let dark = refboolean(false)//switchå¼€å…³çš„changäº‹ä»¶è¿›è¡Œæš—é»‘æ¨¡å¼çš„åˆ‡æ¢const changeDark = () = //è·å–HTMLæ ¹èŠ‚ç‚¹ let html = document.documentElement //åˆ¤æ–­HTMLæ ‡ç­¾æ˜¯å¦æœ‰ç±»ådark dark.value ? (html.className = dark) : (html.className = ) 16.2 ä¸»é¢˜é¢œè‰² é™æ€é¡µé¢ src\\layout\\tabbar\\setting\\index.vue el-popover placement=bottom title=ä¸»é¢˜è®¾ç½® :width=300 trigger=hover !-- è¡¨å•å…ƒç´  -- el-form el-form-item label=ä¸»é¢˜é¢œè‰² el-color-picker @change=setColor v-model=color size=small show-alpha :predefine=predefineColors / /el-form-item /el-form template #reference el-button size=small icon=Setting circle/el-button /template /el-popover https://element-plus.org/zh-CN/component/color-picker.html#%E9%A2%84%E5%AE%9A%E4%B9%89%E9%A2%9C%E8%89%B2 https://element-plus.org/zh-CN/guide/theming.html#%E9%80%9A%E8%BF%87-css-%E5%8F%98%E9%87%8F%E8%AE%BE%E7%BD%AE js src\\layout\\tabbar\\setting\\index.vue //è‡ªå®šä¹‰ä¸»é¢˜//é¢œè‰²ç»„ä»¶ç»„ä»¶çš„æ•°æ®const color = ref(rgba(255, 69, 0, 0.68))const predefineColors = ref([ #ff4500, #ff8c00, #ffd700, #90ee90, #00ced1, #1e90ff, #c71585, rgba(255, 69, 0, 0.68), rgb(255, 120, 0), hsv(51, 100, 98), hsva(120, 40, 94, 0.5), hsl(181, 100%, 37%), hsla(209, 100%, 56%, 0.73), #c7158577,])//ä¸»é¢˜é¢œè‰²çš„è®¾ç½®const setColor = () = //é€šçŸ¥jsä¿®æ”¹æ ¹èŠ‚ç‚¹çš„æ ·å¼å¯¹è±¡çš„å±æ€§ä¸å±æ€§å€¼ const html = document.documentElement html.style.setProperty(--el-color-primary, color.value) 17. èœå•æƒé™17.1 æ‹†åˆ†è·¯ç”± æ‹†åˆ†å¸¸é‡è·¯ç”±å’Œå¼‚æ­¥è·¯ç”± src\\router\\router.ts //å¯¹å¤–æš´éœ²é…ç½®è·¯ç”±(å¸¸é‡è·¯ç”±)export const constantRoute = [ //ç™»å½•è·¯ç”± path: /login, component: () = import(@/views/login/index.vue), name: login, //å‘½åè·¯ç”± meta: title: ç™»å½•, //èœå•æ ‡é¢˜ hidden: true, //è·¯ç”±çš„æ ‡é¢˜åœ¨èœå•ä¸­æ˜¯å¦éšè— , , //ç™»å½•æˆåŠŸä»¥åå±•ç¤ºæ•°æ®çš„è·¯ç”± path: /, component: () = import(@/layout/index.vue), name: layout, meta: hidden: false, , redirect: /home, children: [ path: /home, component: () = import(@/views/home/index.vue), meta: title: é¦–é¡µ, hidden: false, icon: HomeFilled, , , ], , path: /404, component: () = import(@/views/404/index.vue), name: 404, meta: title: 404, hidden: true, , , path: /screen, component: () = import(@/views/screen/index.vue), name: Screen, meta: hidden: false, title: æ•°æ®å¤§å±, icon: Platform, , ,]//å¼‚æ­¥è·¯ç”±export const asnycRoute = [ path: /acl, component: () = import(@/layout/index.vue), name: Acl, meta: hidden: false, title: æƒé™ç®¡ç†, icon: Lock, , redirect: /acl/user, children: [ path: /acl/user, component: () = import(@/views/acl/user/index.vue), name: User, meta: hidden: false, title: ç”¨æˆ·ç®¡ç†, icon: User, , , path: /acl/role, component: () = import(@/views/acl/role/index.vue), name: Role, meta: hidden: false, title: è§’è‰²ç®¡ç†, icon: UserFilled, , , path: /acl/permission, component: () = import(@/views/acl/permission/index.vue), name: Permission, meta: hidden: false, title: èœå•ç®¡ç†, icon: Monitor, , , ], , path: /product, component: () = import(@/layout/index.vue), name: Product, meta: hidden: false, title: å•†å“ç®¡ç†, icon: Goods, , redirect: /product/trademark, children: [ path: /product/trademark, component: () = import(@/views/product/trademark/index.vue), name: Trademark, meta: hidden: false, title: å“ç‰Œç®¡ç†, icon: ShoppingCartFull, , , path: /product/attr, component: () = import(@/views/product/attr/index.vue), name: Attr, meta: hidden: false, title: å±æ€§ç®¡ç†, icon: CollectionTag, , , path: /product/spu, component: () = import(@/views/product/spu/index.vue), name: Spu, meta: hidden: false, title: SPUç®¡ç†, icon: Calendar, , , path: /product/sku, component: () = import(@/views/product/sku/index.vue), name: Sku, meta: hidden: false, title: SKUç®¡ç†, icon: Orange, , , ], ,]//ä»»æ„è·¯ç”±//ä»»æ„è·¯ç”±export const anyRoute = //ä»»æ„è·¯ç”± path: /:pathMatch(.*)*, redirect: /404, name: Any, meta: title: ä»»æ„è·¯ç”±, hidden: true, icon: DataLine, , 17.2 åŠ¨æ€è·¯ç”± æ ¹æ®ç”¨æˆ·è¿”å›æ‰€æ‹¥æœ‰çš„è·¯ç”±æƒé™ï¼Œè¿‡æ»¤å‡ºå¯ä»¥å±•ç¤ºçš„è·¯ç”± src\\store\\modules\\user.ts //å¼•å…¥æ·±æ‹·è´æ–¹æ³•//@ts-expect-errorimport cloneDeep from lodash/cloneDeep//ç”¨äºè¿‡æ»¤å½“å‰ç”¨æˆ·éœ€è¦å±•ç¤ºçš„å¼‚æ­¥è·¯ç”±function filterAsyncRoute(asnycRoute: any, routes: any) return asnycRoute.filter((item: any) = if (routes.includes(item.name)) if (item.children item.children.length 0) //ç¡…è°·333è´¦å·:product\\trademark\\attr\\sku item.children = filterAsyncRoute(item.children, routes) return true )// åˆ›å»ºç”¨æˆ·å°ä»“åº“const useUserStore = defineStore(UserStore, // å¤„ç†å¼‚æ­¥|é€»è¾‘åœ°æ–¹ actions: // è·å–ç”¨æˆ·ä¿¡æ¯ async userInfoAction() const result: userInfoResponseData = await reqUserInfo() if (result.code === 200) this.username = result.data.name this.avatar = result.data.avatar //è®¡ç®—å½“å‰ç”¨æˆ·éœ€è¦å±•ç¤ºçš„å¼‚æ­¥è·¯ç”± const userAsyncRoute = filterAsyncRoute( cloneDeep(asnycRoute), result.data.routes, ) //èœå•éœ€è¦çš„æ•°æ®æ•´ç†å®Œæ¯• this.menuRoutes = [...constantRoute, ...userAsyncRoute, anyRoute] //ç›®å‰è·¯ç”±å™¨ç®¡ç†çš„åªæœ‰å¸¸é‡è·¯ç”±:ç”¨æˆ·è®¡ç®—å®Œæ¯•å¼‚æ­¥è·¯ç”±ã€ä»»æ„è·¯ç”±åŠ¨æ€è¿½åŠ  ;[...userAsyncRoute, anyRoute].forEach((route: any) = router.addRoute(route) ) return ok else return Promise.reject(new Error(result.message)) , , getters: ,) è·¯ç”±åŠ è½½é—®é¢˜ è¿™æ ·é…ç½®è·¯ç”±åï¼Œå¦‚æœä½ è®¿é—®çš„æ˜¯å¼‚æ­¥è·¯ç”±ï¼Œä¼šåœ¨åˆ·æ–°çš„æ—¶å€™å‡ºç°ç©ºç™½é¡µé¢ã€‚åŸå› æ˜¯å¼‚æ­¥è·¯ç”±æ˜¯å¼‚æ­¥è·å–çš„ï¼ŒåŠ è½½çš„æ—¶å€™è¿˜æ²¡æœ‰ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨è·¯ç”±å®ˆå«æ–‡ä»¶ä¸­æ”¹å†™ã€‚next( ...to )è¿™ä¸ªçš„æ„æ€å°±æ˜¯ä¸€ç›´åŠ è½½ã€‚ src\\permisstion.ts //å…¨å±€å‰ç½®å®ˆå«router.beforeEach(async (to: any, from: any, next: any) = ... //ç”¨æˆ·ç™»å½•åˆ¤æ–­ if (token) //ç™»é™†æˆåŠŸï¼Œè®¿é—®loginã€‚æŒ‡å‘é¦–é¡µ if (to.path == /login) next(/home) else //ç™»é™†æˆåŠŸè®¿é—®å…¶ä½™çš„ï¼Œæ”¾è¡Œ //æœ‰ç”¨æˆ·ä¿¡æ¯ if (username) //æ”¾è¡Œ next() else //å¦‚æœæ²¡æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œåœ¨æ”¶å°¾è¿™é‡Œå‘è¯·æ±‚è·å–åˆ°äº†ç”¨æˆ·ä¿¡æ¯å†æ”¾è¡Œ try //è·å–ç”¨æˆ·ä¿¡æ¯ await userStore.userInfoAction() //ä¸‡ä¸€åˆ·æ–°çš„æ—¶å€™æ˜¯å¼‚æ­¥è·¯ç”±ï¼Œæœ‰å¯èƒ½è·å–åˆ°ç”¨æˆ·ä¿¡æ¯ä½†æ˜¯å¼‚æ­¥è·¯ç”±æ²¡æœ‰åŠ è½½å®Œæ¯•ï¼Œå‡ºç°ç©ºç™½æ•ˆæœ next( ...to ) catch (error) //tokenè¿‡æœŸ|ç”¨æˆ·æ‰‹åŠ¨å¤„ç†token //é€€å‡ºç™»é™†-ç”¨æˆ·ç›¸å…³çš„æ•°æ®æ¸…ç©º await userStore.userLogoutAction() next( path: /login, query: redirect: to.path ) else ...) 17.3 æŒ‰é’®æƒé™ ä¿®æ”¹æ•°æ®ç±»å‹ src\\store\\modules\\type\\type.ts export interface UserState ... //å­˜å‚¨å½“å‰ç”¨æˆ·æ˜¯å¦åŒ…å«æŸä¸€ä¸ªæŒ‰é’® buttons: string[] è‡ªå®šä¹‰æŒ‡ä»¤ src\\directive\\has.ts import pinia from @/storeimport useUserStore from @/store/modules/userconst userStore = useUserStore(pinia)export const isHasButton = (app: any) = //è·å–å¯¹åº”çš„ç”¨æˆ·ä»“åº“ //å…¨å±€è‡ªå®šä¹‰æŒ‡ä»¤:å®ç°æŒ‰é’®çš„æƒé™ app.directive(has, //ä»£è¡¨ä½¿ç”¨è¿™ä¸ªå…¨å±€è‡ªå®šä¹‰æŒ‡ä»¤çš„DOM|ç»„ä»¶æŒ‚è½½å®Œæ¯•çš„æ—¶å€™ä¼šæ‰§è¡Œä¸€æ¬¡ mounted(el: any, options: any) //è‡ªå®šä¹‰æŒ‡ä»¤å³ä¾§çš„æ•°å€¼:å¦‚æœåœ¨ç”¨æˆ·ä¿¡æ¯buttonsæ•°ç»„å½“ä¸­æ²¡æœ‰ //ä»DOMæ ‘ä¸Šå¹²æ‰ //elå°±æ˜¯domå…ƒç´  //options:ä¼ å…¥è¿›æ¥çš„å€¼ if (!userStore.buttons.includes(options.value)) el.parentNode.removeChild(el) , ) src\\main.ts import isHasButton from ./directive/has// è·å–åº”ç”¨å®ä¾‹å¯¹è±¡const app = createApp(App)...isHasButton(app)// å°†åº”ç”¨æŒ‚è½½åˆ°æŒ‚è½½ç‚¹ä¸Šapp.mount(#app) ä½¿ç”¨ el-button size=small :disabled=row.level == 4 ? true : false @click=addPermission(row) v-has=`btn.Permission.add` row.level == 3 ? æ·»åŠ åŠŸèƒ½ : æ·»åŠ èœå• /el-button åœ¨éœ€è¦æ§åˆ¶æƒé™çš„æŒ‰é’®ä¸Šæ·»åŠ  v-has=æŒ‰é’®æƒé™åæ¥åˆ¤æ–­æŒ‰é’®æ˜¯å¦æœ‰æƒé™ åœ¨buttonsé‡ŒåŒ…å«äº†ç”¨æˆ·æ‰€æ‹¥æœ‰çš„æ‰€æœ‰æŒ‰é’®æƒé™æ•°æ® â€‹","tags":["Vue3","Pina","å‰ç«¯é¡¹ç›®"],"categories":["å®æˆ˜"]},{"title":"vue3åŸºç¡€","path":"/2023/12/22/2023-12-22-vue3åŸºç¡€/","content":"1. Vue3ä¼˜åŠ¿ ä¼˜åŠ¿ 2. åˆ›å»ºé¡¹ç›® create-vue create-vueæ˜¯Vueå®˜æ–¹æ–°çš„è„šæ‰‹æ¶å·¥å…·ï¼Œåº•å±‚åˆ‡æ¢åˆ°äº† vite ï¼ˆä¸‹ä¸€ä»£å‰ç«¯å·¥å…·é“¾ï¼‰ï¼Œä¸ºå¼€å‘æä¾›æé€Ÿå“åº” åˆ›å»ºé¡¹ç›® å‰ç½®æ¡ä»¶ - å·²å®‰è£…16.0æˆ–æ›´é«˜ç‰ˆæœ¬çš„Node.js æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œè¿™ä¸€æŒ‡ä»¤å°†ä¼šå®‰è£…å¹¶æ‰§è¡Œ create-vue npm init vue@latest ç†Ÿæ‚‰å…³é”®é…ç½® 3. ç»„åˆå¼API3.1 setup æ‰§è¡Œæ—¶æœº åœ¨beforeCreateé’©å­ä¹‹å‰æ‰§è¡Œ åŸºæœ¬è¯­æ³• script export default setup() const message = this is message const logMessage = ()= console.log(message) // å¿…é¡»returnæ‰å¯ä»¥ return message, logMessage /scripttemplate div message /div button @click=logMessageç‚¹å‡»/button/template è¯­æ³•ç³– scriptæ ‡ç­¾æ·»åŠ  setupæ ‡è®°ï¼Œä¸éœ€è¦å†å†™å¯¼å‡ºè¯­å¥ï¼Œé»˜è®¤ä¼šæ·»åŠ å¯¼å‡ºè¯­å¥ template div class=person h2å§“åï¼šname/h2 h2å¹´é¾„ï¼šage/h2 button @click=changNameä¿®æ”¹åå­—/button button @click=changAgeå¹´é¾„+1/button button @click=showTelç‚¹æˆ‘æŸ¥çœ‹è”ç³»æ–¹å¼/button /div/templatescript lang=ts export default name:Person, /script!-- ä¸‹é¢çš„å†™æ³•æ˜¯setupè¯­æ³•ç³– --script setup lang=ts console.log(this) //undefined // æ•°æ®ï¼ˆæ³¨æ„ï¼šæ­¤æ—¶çš„nameã€ageã€teléƒ½ä¸æ˜¯å“åº”å¼æ•°æ®ï¼‰ let name = å¼ ä¸‰ let age = 18 let tel = 13888888888 // æ–¹æ³• function changName() name = æå››//æ³¨æ„ï¼šæ­¤æ—¶è¿™ä¹ˆä¿®æ”¹nameé¡µé¢æ˜¯ä¸å˜åŒ–çš„ function changAge() console.log(age) age += 1 //æ³¨æ„ï¼šæ­¤æ—¶è¿™ä¹ˆä¿®æ”¹ageé¡µé¢æ˜¯ä¸å˜åŒ–çš„ function showTel() alert(tel) /script 3.2 reactiveå’Œrefå‡½æ•°3.2.1 reactive ä½œç”¨ æ¥å—å¯¹è±¡ç±»å‹æ•°æ®çš„å‚æ•°ä¼ å…¥å¹¶è¿”å›ä¸€ä¸ªå“åº”å¼çš„å¯¹è±¡ è¯­æ³• let å“åº”å¼å¯¹è±¡= reactive(æºå¯¹è±¡) è¿”å›å€¼ ä¸€ä¸ªProxyçš„å®ä¾‹å¯¹è±¡ï¼Œç®€ç§°ï¼šå“åº”å¼å¯¹è±¡ æ³¨æ„ç‚¹ reactiveå®šä¹‰çš„å“åº”å¼æ•°æ®æ˜¯â€œæ·±å±‚æ¬¡â€çš„ ç¤ºä¾‹ template div class=person h2æ±½è½¦ä¿¡æ¯ï¼šä¸€å° car.brand æ±½è½¦ï¼Œä»·å€¼ car.price ä¸‡/h2 h2æ¸¸æˆåˆ—è¡¨ï¼š/h2 ul li v-for=g in games :key=g.id g.name /li /ul h2æµ‹è¯•ï¼šobj.a.b.c.d/h2 button @click=changeCarPriceä¿®æ”¹æ±½è½¦ä»·æ ¼/button button @click=changeFirstGameä¿®æ”¹ç¬¬ä¸€æ¸¸æˆ/button button @click=testæµ‹è¯•/button /div/templatescript lang=ts setup name=Personimport reactive from vue// æ•°æ®let car = reactive( brand: å¥”é©°, price: 100 )let games = reactive([ id: ahsgdyfa01, name: è‹±é›„è”ç›Ÿ , id: ahsgdyfa02, name: ç‹è€…è£è€€ , id: ahsgdyfa03, name: åŸç¥ ])let obj = reactive( a: b: c: d:666 )function changeCarPrice() car.price += 10function changeFirstGame() games[0].name = æµæ˜Ÿè´è¶å‰‘function test() obj.a.b.c.d = 999/script 3.2.2 ref ä½œç”¨ å®šä¹‰å“åº”å¼å˜é‡ è¯­æ³• let xxx = ref(åˆå§‹å€¼) è¿”å›å€¼ ä¸€ä¸ªRefImplçš„å®ä¾‹å¯¹è±¡ï¼Œç®€ç§°refå¯¹è±¡æˆ–refï¼Œrefå¯¹è±¡çš„valueå±æ€§æ˜¯å“åº”å¼çš„ æ³¨æ„ç‚¹ JSä¸­æ“ä½œæ•°æ®éœ€è¦ï¼šxxx.valueï¼Œä½†æ¨¡æ¿ä¸­ä¸éœ€è¦.valueï¼Œç›´æ¥ä½¿ç”¨å³å¯ å¯¹äºlet name = ref(å¼ ä¸‰)æ¥è¯´ï¼Œnameä¸æ˜¯å“åº”å¼çš„ï¼Œname.valueæ˜¯å“åº”å¼çš„ ç¤ºä¾‹ template div class=person h2å§“åï¼šname/h2 h2å¹´é¾„ï¼šage/h2 button @click=changeNameä¿®æ”¹åå­—/button button @click=changeAgeå¹´é¾„+1/button button @click=showTelç‚¹æˆ‘æŸ¥çœ‹è”ç³»æ–¹å¼/button /div/templatescript setup lang=ts name=Person import ref from vue // nameå’Œageæ˜¯ä¸€ä¸ªRefImplçš„å®ä¾‹å¯¹è±¡ï¼Œç®€ç§°refå¯¹è±¡ï¼Œå®ƒä»¬çš„valueå±æ€§æ˜¯å“åº”å¼çš„ã€‚ let name = ref(å¼ ä¸‰) let age = ref(18) // telå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²ï¼Œä¸æ˜¯å“åº”å¼çš„ let tel = 13888888888 function changeName() // JSä¸­æ“ä½œrefå¯¹è±¡æ—¶å€™éœ€è¦.value name.value = æå›› console.log(name.value) // æ³¨æ„ï¼šnameä¸æ˜¯å“åº”å¼çš„ï¼Œname.valueæ˜¯å“åº”å¼çš„ï¼Œæ‰€ä»¥å¦‚ä¸‹ä»£ç å¹¶ä¸ä¼šå¼•èµ·é¡µé¢çš„æ›´æ–°ã€‚ // name = ref(zhang-san) function changeAge() // JSä¸­æ“ä½œrefå¯¹è±¡æ—¶å€™éœ€è¦.value age.value += 1 console.log(age.value) function showTel() alert(tel) /script 3.2.3 å¯¹æ¯” éƒ½æ˜¯ç”¨æ¥ç”Ÿæˆå“åº”å¼æ•°æ® ä¸åŒç‚¹ reactiveä¸èƒ½å¤„ç†ç®€å•ç±»å‹çš„æ•°æ® refå‚æ•°ç±»å‹æ”¯æŒæ›´å¥½ï¼Œä½†æ˜¯å¿…é¡»é€šè¿‡.valueåšè®¿é—®ä¿®æ”¹ refå‡½æ•°å†…éƒ¨çš„å®ç°ä¾èµ–äºreactiveå‡½æ•° reactiveé‡æ–°åˆ†é…ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä¼šå¤±å»å“åº”å¼ï¼ˆå¯ä»¥ä½¿ç”¨Object.assignå»æ•´ä½“æ›¿æ¢ï¼‰ ä½¿ç”¨åŸåˆ™ è‹¥éœ€è¦ä¸€ä¸ªåŸºæœ¬ç±»å‹çš„å“åº”å¼æ•°æ®ï¼Œå¿…é¡»ä½¿ç”¨ref è‹¥éœ€è¦ä¸€ä¸ªå“åº”å¼å¯¹è±¡ï¼Œå±‚çº§ä¸æ·±ï¼Œrefã€reactiveéƒ½å¯ä»¥ è‹¥éœ€è¦ä¸€ä¸ªå“åº”å¼å¯¹è±¡ï¼Œä¸”å±‚çº§è¾ƒæ·±ï¼Œæ¨èä½¿ç”¨reactive 3.2.4 toRefs ä¸ toRef ä½œç”¨ å°†ä¸€ä¸ªå“åº”å¼å¯¹è±¡ä¸­çš„æ¯ä¸€ä¸ªå±æ€§ï¼Œè½¬æ¢ä¸ºrefå¯¹è±¡ å¤‡æ³¨ toRefsä¸toRefåŠŸèƒ½ä¸€è‡´ï¼Œä½†toRefså¯ä»¥æ‰¹é‡è½¬æ¢ ç¤ºä¾‹ template div class=person h2å§“åï¼šperson.name/h2 h2å¹´é¾„ï¼šperson.age/h2 h2æ€§åˆ«ï¼šperson.gender/h2 button @click=changeNameä¿®æ”¹åå­—/button button @click=changeAgeä¿®æ”¹å¹´é¾„/button button @click=changeGenderä¿®æ”¹æ€§åˆ«/button /div/templatescript lang=ts setup name=Person import ref,reactive,toRefs,toRef from vue // æ•°æ® let person = reactive(name:å¼ ä¸‰, age:18, gender:ç”·) // é€šè¿‡toRefså°†personå¯¹è±¡ä¸­çš„nä¸ªå±æ€§æ‰¹é‡å–å‡ºï¼Œä¸”ä¾ç„¶ä¿æŒå“åº”å¼çš„èƒ½åŠ› let name,gender = toRefs(person) // é€šè¿‡toRefå°†personå¯¹è±¡ä¸­çš„genderå±æ€§å–å‡ºï¼Œä¸”ä¾ç„¶ä¿æŒå“åº”å¼çš„èƒ½åŠ› let age = toRef(person,age) // æ–¹æ³• function changeName() name.value += ~ function changeAge() age.value += 1 function changeGender() gender.value = å¥³ /script 3.3 computed ä½œç”¨ è®¡ç®—å±æ€§åŸºæœ¬æ€æƒ³å’ŒVue2ä¿æŒä¸€è‡´ï¼Œç»„åˆå¼APIä¸‹çš„è®¡ç®—å±æ€§åªæ˜¯ä¿®æ”¹äº†APIå†™æ³• ç¤ºä¾‹ template div class=person å§“ï¼šinput type=text v-model=firstName br åï¼šinput type=text v-model=lastName br å…¨åï¼šspanfullName/span br button @click=changeFullNameå…¨åæ”¹ä¸ºï¼šli-si/button /div/templatescript setup lang=ts name=App import ref,computed from vue let firstName = ref(zhang) let lastName = ref(san) // è®¡ç®—å±æ€§â€”â€”åªè¯»å–ï¼Œä¸ä¿®æ”¹ /* let fullName = computed(()= return firstName.value + - + lastName.value ) */ // è®¡ç®—å±æ€§â€”â€”æ—¢è¯»å–åˆä¿®æ”¹ let fullName = computed( // è¯»å– get() return firstName.value + - + lastName.value , // ä¿®æ”¹ set(val) console.log(æœ‰äººä¿®æ”¹äº†fullName,val) firstName.value = val.split(-)[0] lastName.value = val.split(-)[1] ) function changeFullName() fullName.value = li-si /script 3.4 watch ä½œç”¨ ç›‘è§†æ•°æ®çš„å˜åŒ–ï¼ˆå’ŒVue2ä¸­çš„watchä½œç”¨ä¸€è‡´ï¼‰ ç‰¹ç‚¹ Vue3ä¸­çš„watchåªèƒ½ç›‘è§†ä»¥ä¸‹å››ç§æ•°æ® refå®šä¹‰çš„æ•°æ®ã€‚ reactiveå®šä¹‰çš„æ•°æ®ã€‚ å‡½æ•°è¿”å›ä¸€ä¸ªå€¼ï¼ˆgetterå‡½æ•°ï¼‰ã€‚ ä¸€ä¸ªåŒ…å«ä¸Šè¿°å†…å®¹çš„æ•°ç»„ã€‚ 3.4.1 ä¾¦å¬refå®šä¹‰çš„ã€åŸºæœ¬ç±»å‹ã€‘ ç›‘è§†refå®šä¹‰çš„ã€åŸºæœ¬ç±»å‹ã€‘æ•°æ®ï¼šç›´æ¥å†™æ•°æ®åå³å¯ï¼Œç›‘è§†çš„æ˜¯å…¶valueå€¼çš„æ”¹å˜ã€‚ template div class=person h1æƒ…å†µä¸€ï¼šç›‘è§†ã€refã€‘å®šä¹‰çš„ã€åŸºæœ¬ç±»å‹ã€‘æ•°æ®/h1 h2å½“å‰æ±‚å’Œä¸ºï¼šsum/h2 button @click=changeSumç‚¹æˆ‘sum+1/button /div/templatescript lang=ts setup name=Person import ref,watch from vue // æ•°æ® let sum = ref(0) // æ–¹æ³• function changeSum() sum.value += 1 // ç›‘è§†ï¼Œæƒ…å†µä¸€ï¼šç›‘è§†ã€refã€‘å®šä¹‰çš„ã€åŸºæœ¬ç±»å‹ã€‘æ•°æ® const stopWatch = watch(sum,(newValue,oldValue)= console.log(sumå˜åŒ–äº†,newValue,oldValue) if(newValue = 10) stopWatch() )/script 3.4.2 ç›‘è§†refå®šä¹‰çš„ã€å¯¹è±¡ç±»å‹ã€‘ ç›‘è§†refå®šä¹‰çš„ã€å¯¹è±¡ç±»å‹ã€‘æ•°æ® ç›´æ¥å†™æ•°æ®åï¼Œç›‘è§†çš„æ˜¯å¯¹è±¡çš„ã€åœ°å€å€¼ã€‘ï¼Œè‹¥æƒ³ç›‘è§†å¯¹è±¡å†…éƒ¨çš„æ•°æ®ï¼Œè¦æ‰‹åŠ¨å¼€å¯æ·±åº¦ç›‘è§†ã€‚ æ³¨æ„ è‹¥ä¿®æ”¹çš„æ˜¯refå®šä¹‰çš„å¯¹è±¡ä¸­çš„å±æ€§ï¼ŒnewValue å’Œ oldValue éƒ½æ˜¯æ–°å€¼ï¼Œå› ä¸ºå®ƒä»¬æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚ è‹¥ä¿®æ”¹æ•´ä¸ªrefå®šä¹‰çš„å¯¹è±¡ï¼ŒnewValue æ˜¯æ–°å€¼ï¼Œ oldValue æ˜¯æ—§å€¼ï¼Œå› ä¸ºä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡äº†ã€‚ ç¤ºä¾‹ template div class=person h1æƒ…å†µäºŒï¼šç›‘è§†ã€refã€‘å®šä¹‰çš„ã€å¯¹è±¡ç±»å‹ã€‘æ•°æ®/h1 h2å§“åï¼š person.name /h2 h2å¹´é¾„ï¼š person.age /h2 button @click=changeNameä¿®æ”¹åå­—/button button @click=changeAgeä¿®æ”¹å¹´é¾„/button button @click=changePersonä¿®æ”¹æ•´ä¸ªäºº/button /div/templatescript lang=ts setup name=Person import ref,watch from vue // æ•°æ® let person = ref( name:å¼ ä¸‰, age:18 ) // æ–¹æ³• function changeName() person.value.name += ~ function changeAge() person.value.age += 1 function changePerson() person.value = name:æå››,age:90 /* ç›‘è§†ï¼Œæƒ…å†µä¸€ï¼šç›‘è§†ã€refã€‘å®šä¹‰çš„ã€å¯¹è±¡ç±»å‹ã€‘æ•°æ®ï¼Œç›‘è§†çš„æ˜¯å¯¹è±¡çš„åœ°å€å€¼ï¼Œè‹¥æƒ³ç›‘è§†å¯¹è±¡å†…éƒ¨å±æ€§çš„å˜åŒ–ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯æ·±åº¦ç›‘è§† watchçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ï¼šè¢«ç›‘è§†çš„æ•°æ® watchçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ï¼šç›‘è§†çš„å›è°ƒ watchçš„ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ï¼šé…ç½®å¯¹è±¡ï¼ˆdeepã€immediateç­‰ç­‰.....ï¼‰ */ watch(person,(newValue,oldValue)= console.log(personå˜åŒ–äº†,newValue,oldValue) ,deep:true) /script 3.4.3 æ·±åº¦ç›‘è§† ç›‘è§†reactiveå®šä¹‰çš„ã€å¯¹è±¡ç±»å‹ã€‘æ•°æ®ï¼Œä¸”é»˜è®¤å¼€å¯äº†æ·±åº¦ç›‘è§†ã€‚ é€šè¿‡watchç›‘å¬çš„refå¯¹è±¡é»˜è®¤æ˜¯æµ…å±‚ä¾¦å¬çš„ï¼Œç›´æ¥ä¿®æ”¹åµŒå¥—çš„å¯¹è±¡å±æ€§ä¸ä¼šè§¦å‘å›è°ƒæ‰§è¡Œï¼Œéœ€è¦å¼€å¯deepã€‚ template div class=person h1æƒ…å†µä¸‰ï¼šç›‘è§†ã€reactiveã€‘å®šä¹‰çš„ã€å¯¹è±¡ç±»å‹ã€‘æ•°æ®/h1 h2å§“åï¼š person.name /h2 h2å¹´é¾„ï¼š person.age /h2 button @click=changeNameä¿®æ”¹åå­—/button button @click=changeAgeä¿®æ”¹å¹´é¾„/button button @click=changePersonä¿®æ”¹æ•´ä¸ªäºº/button hr h2æµ‹è¯•ï¼šobj.a.b.c/h2 button @click=testä¿®æ”¹obj.a.b.c/button /div/templatescript lang=ts setup name=Person import reactive,watch from vue // æ•°æ® let person = reactive( name:å¼ ä¸‰, age:18 ) let obj = reactive( a: b: c:666 ) // æ–¹æ³• function changeName() person.name += ~ function changeAge() person.age += 1 function changePerson() Object.assign(person,name:æå››,age:80) function test() obj.a.b.c = 888 // ç›‘è§†ï¼Œæƒ…å†µä¸‰ï¼šç›‘è§†ã€reactiveã€‘å®šä¹‰çš„ã€å¯¹è±¡ç±»å‹ã€‘æ•°æ®ï¼Œä¸”é»˜è®¤æ˜¯å¼€å¯æ·±åº¦ç›‘è§†çš„ watch(person,(newValue,oldValue)= console.log(personå˜åŒ–äº†,newValue,oldValue) ) watch(obj,(newValue,oldValue)= console.log(Objå˜åŒ–äº†,newValue,oldValue) )/script 3.4.4 ç›‘è§†ã€å¯¹è±¡ç±»å‹ã€‘ä¸­çš„å±æ€§ ç›‘è§†refæˆ–reactiveå®šä¹‰çš„ã€å¯¹è±¡ç±»å‹ã€‘æ•°æ®ä¸­çš„æŸä¸ªå±æ€§ï¼Œæ³¨æ„ç‚¹å¦‚ä¸‹ï¼š è‹¥è¯¥å±æ€§å€¼ä¸æ˜¯ã€å¯¹è±¡ç±»å‹ã€‘ï¼Œéœ€è¦å†™æˆå‡½æ•°å½¢å¼ã€‚ è‹¥è¯¥å±æ€§å€¼æ˜¯ä¾ç„¶æ˜¯ã€å¯¹è±¡ç±»å‹ã€‘ï¼Œå¯ç›´æ¥ç¼–å†™ï¼Œä¹Ÿå¯å†™æˆå‡½æ•°ï¼Œå»ºè®®å†™æˆå‡½æ•°ã€‚ ç»“è®ºï¼šç›‘è§†çš„è¦æ˜¯å¯¹è±¡é‡Œçš„å±æ€§ï¼Œé‚£ä¹ˆæœ€å¥½å†™å‡½æ•°å¼ï¼Œæ³¨æ„ç‚¹ï¼šè‹¥æ˜¯å¯¹è±¡ç›‘è§†çš„æ˜¯åœ°å€å€¼ï¼Œéœ€è¦å…³æ³¨å¯¹è±¡å†…éƒ¨ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯æ·±åº¦ç›‘è§†ã€‚ ç¤ºä¾‹ template div class=person h1æƒ…å†µå››ï¼šç›‘è§†ã€refã€‘æˆ–ã€reactiveã€‘å®šä¹‰çš„ã€å¯¹è±¡ç±»å‹ã€‘æ•°æ®ä¸­çš„æŸä¸ªå±æ€§/h1 h2å§“åï¼š person.name /h2 h2å¹´é¾„ï¼š person.age /h2 h2æ±½è½¦ï¼š person.car.c1 ã€ person.car.c2 /h2 button @click=changeNameä¿®æ”¹åå­—/button button @click=changeAgeä¿®æ”¹å¹´é¾„/button button @click=changeC1ä¿®æ”¹ç¬¬ä¸€å°è½¦/button button @click=changeC2ä¿®æ”¹ç¬¬äºŒå°è½¦/button button @click=changeCarä¿®æ”¹æ•´ä¸ªè½¦/button /div/templatescript lang=ts setup name=Person import reactive,watch from vue // æ•°æ® let person = reactive( name:å¼ ä¸‰, age:18, car: c1:å¥”é©°, c2:å®é©¬ ) // æ–¹æ³• function changeName() person.name += ~ function changeAge() person.age += 1 function changeC1() person.car.c1 = å¥¥è¿ª function changeC2() person.car.c2 = å¤§ä¼— function changeCar() person.car = c1:é›…è¿ª,c2:çˆ±ç› // ç›‘è§†ï¼Œæƒ…å†µå››ï¼šç›‘è§†å“åº”å¼å¯¹è±¡ä¸­çš„æŸä¸ªå±æ€§ï¼Œä¸”è¯¥å±æ€§æ˜¯åŸºæœ¬ç±»å‹çš„ï¼Œè¦å†™æˆå‡½æ•°å¼ /* watch(()= person.name,(newValue,oldValue)= console.log(person.nameå˜åŒ–äº†,newValue,oldValue) ) */ // ç›‘è§†ï¼Œæƒ…å†µå››ï¼šç›‘è§†å“åº”å¼å¯¹è±¡ä¸­çš„æŸä¸ªå±æ€§ï¼Œä¸”è¯¥å±æ€§æ˜¯å¯¹è±¡ç±»å‹çš„ï¼Œå¯ä»¥ç›´æ¥å†™ï¼Œä¹Ÿèƒ½å†™å‡½æ•°ï¼Œæ›´æ¨èå†™å‡½æ•° watch(()=person.car,(newValue,oldValue)= console.log(person.carå˜åŒ–äº†,newValue,oldValue) ,deep:true)/script 3.4.5 ç›‘è§†çš„å¤šä¸ªæ•°æ® ç›‘å¬å¤šä¸ªæ•°æ® template div class=person h1æƒ…å†µäº”ï¼šç›‘è§†ä¸Šè¿°çš„å¤šä¸ªæ•°æ®/h1 h2å§“åï¼š person.name /h2 h2å¹´é¾„ï¼š person.age /h2 h2æ±½è½¦ï¼š person.car.c1 ã€ person.car.c2 /h2 button @click=changeNameä¿®æ”¹åå­—/button button @click=changeAgeä¿®æ”¹å¹´é¾„/button button @click=changeC1ä¿®æ”¹ç¬¬ä¸€å°è½¦/button button @click=changeC2ä¿®æ”¹ç¬¬äºŒå°è½¦/button button @click=changeCarä¿®æ”¹æ•´ä¸ªè½¦/button /div/templatescript lang=ts setup name=Person import reactive,watch from vue // æ•°æ® let person = reactive( name:å¼ ä¸‰, age:18, car: c1:å¥”é©°, c2:å®é©¬ ) // æ–¹æ³• function changeName() person.name += ~ function changeAge() person.age += 1 function changeC1() person.car.c1 = å¥¥è¿ª function changeC2() person.car.c2 = å¤§ä¼— function changeCar() person.car = c1:é›…è¿ª,c2:çˆ±ç› // ç›‘è§†ï¼Œæƒ…å†µäº”ï¼šç›‘è§†ä¸Šè¿°çš„å¤šä¸ªæ•°æ® watch([()=person.name,person.car],(newValue,oldValue)= console.log(person.carå˜åŒ–äº†,newValue,oldValue) ,deep:true)/script 3.4.6 immediate ä½œç”¨ åœ¨ä¾¦å¬å™¨åˆ›å»ºæ—¶ç«‹å³å‡ºå‘å›è°ƒï¼Œå“åº”å¼æ•°æ®å˜åŒ–ä¹‹åç»§ç»­æ‰§è¡Œå›è°ƒ ç¤ºä¾‹ script setup // 1. å¯¼å…¥watch import ref, watch from vue const count = ref(0) // 2. è°ƒç”¨watch ä¾¦å¬å˜åŒ– watch(count, (newValue, oldValue)= console.log(`countå‘ç”Ÿäº†å˜åŒ–,è€å€¼ä¸º$oldValue,æ–°å€¼ä¸º$newValue`) , immediate: true )/script 3.5 watchEffect ä½œç”¨ ç«‹å³è¿è¡Œä¸€ä¸ªå‡½æ•°ï¼ŒåŒæ—¶å“åº”å¼åœ°è¿½è¸ªå…¶ä¾èµ–ï¼Œå¹¶åœ¨ä¾èµ–æ›´æ”¹æ—¶é‡æ–°æ‰§è¡Œè¯¥å‡½æ•° watchå¯¹æ¯”watchEffect éƒ½èƒ½ç›‘å¬å“åº”å¼æ•°æ®çš„å˜åŒ–ï¼Œä¸åŒçš„æ˜¯ç›‘å¬æ•°æ®å˜åŒ–çš„æ–¹å¼ä¸åŒ watchï¼šè¦æ˜ç¡®æŒ‡å‡ºç›‘è§†çš„æ•°æ® watchEffectï¼šä¸ç”¨æ˜ç¡®æŒ‡å‡ºç›‘è§†çš„æ•°æ®ï¼ˆå‡½æ•°ä¸­ç”¨åˆ°å“ªäº›å±æ€§ï¼Œé‚£å°±ç›‘è§†å“ªäº›å±æ€§ï¼‰ã€‚ ç¤ºä¾‹ template div class=person h1éœ€æ±‚ï¼šæ°´æ¸©è¾¾åˆ°50â„ƒï¼Œæˆ–æ°´ä½è¾¾åˆ°20cmï¼Œåˆ™è”ç³»æœåŠ¡å™¨/h1 h2 id=demoæ°´æ¸©ï¼štemp/h2 h2æ°´ä½ï¼šheight/h2 button @click=changePriceæ°´æ¸©+1/button button @click=changeSumæ°´ä½+10/button /div /template script lang=ts setup name=Person import ref,watch,watchEffect from vue // æ•°æ® let temp = ref(0) let height = ref(0) // æ–¹æ³• function changePrice() temp.value += 10 function changeSum() height.value += 1 // ç”¨watchå®ç°ï¼Œéœ€è¦æ˜ç¡®çš„æŒ‡å‡ºè¦ç›‘è§†ï¼štempã€height watch([temp,height],(value)= // ä»valueä¸­è·å–æœ€æ–°çš„tempå€¼ã€heightå€¼ const [newTemp,newHeight] = value // å®¤æ¸©è¾¾åˆ°50â„ƒï¼Œæˆ–æ°´ä½è¾¾åˆ°20cmï¼Œç«‹åˆ»è”ç³»æœåŠ¡å™¨ if(newTemp = 50 || newHeight = 20) console.log(è”ç³»æœåŠ¡å™¨) ) // ç”¨watchEffectå®ç°ï¼Œä¸ç”¨ const stopWtach = watchEffect(()= // å®¤æ¸©è¾¾åˆ°50â„ƒï¼Œæˆ–æ°´ä½è¾¾åˆ°20cmï¼Œç«‹åˆ»è”ç³»æœåŠ¡å™¨ if(temp.value = 50 || height.value = 20) console.log(document.getElementById(demo)?.innerText) console.log(è”ç³»æœåŠ¡å™¨) // æ°´æ¸©è¾¾åˆ°100ï¼Œæˆ–æ°´ä½è¾¾åˆ°50ï¼Œå–æ¶ˆç›‘è§† if(temp.value === 100 || height.value === 50) console.log(æ¸…ç†äº†) stopWtach() ) /script### 3.6 æ ‡ç­¾çš„ ref å±æ€§1. ä½œç”¨ ç”¨äºæ³¨å†Œæ¨¡æ¿å¼•ç”¨ - ç”¨åœ¨æ™®é€š`DOM`æ ‡ç­¾ä¸Šï¼Œè·å–çš„æ˜¯`DOM`èŠ‚ç‚¹ã€‚ - ç”¨åœ¨ç»„ä»¶æ ‡ç­¾ä¸Šï¼Œè·å–çš„æ˜¯ç»„ä»¶å®ä¾‹å¯¹è±¡ã€‚2. æ™®é€š`DOM`æ ‡ç­¾ä¸Š ```html template div class=person h1 ref=title1å°šç¡…è°·/h1 h2 ref=title2å‰ç«¯/h2 h3 ref=title3Vue/h3 input type=text ref=inpt brbr button @click=showLogç‚¹æˆ‘æ‰“å°å†…å®¹/button /div /template script lang=ts setup name=Person import ref from vue let title1 = ref() let title2 = ref() let title3 = ref() function showLog() // é€šè¿‡idè·å–å…ƒç´  const t1 = document.getElementById(title1) // æ‰“å°å†…å®¹ console.log((t1 as HTMLElement).innerText) console.log((HTMLElementt1).innerText) console.log(t1?.innerText) /************************************/ // é€šè¿‡refè·å–å…ƒç´  console.log(title1.value) console.log(title2.value) console.log(title3.value) /script ç»„ä»¶æ ‡ç­¾ä¸Š !-- çˆ¶ç»„ä»¶App.vue --template Person ref=ren/ button @click=testæµ‹è¯•/button/templatescript lang=ts setup name=App import Person from ./components/Person.vue import ref from vue let ren = ref() function test() console.log(ren.value.name) console.log(ren.value.age) /script!-- å­ç»„ä»¶Person.vueä¸­è¦ä½¿ç”¨defineExposeæš´éœ²å†…å®¹ --script lang=ts setup name=Person import ref,defineExpose from vue // æ•°æ® let name = ref(å¼ ä¸‰) let age = ref(18) /****************************/ /****************************/ // ä½¿ç”¨defineExposeå°†ç»„ä»¶ä¸­çš„æ•°æ®äº¤ç»™å¤–éƒ¨ defineExpose(name,age)/script æ³¨æ„ refç»‘å®šçš„æ ‡è¯†åè¦å’Œå®šä¹‰çš„refå¯¹è±¡åä¸€è‡´ 3.7 ç”Ÿå‘½å‘¨æœŸå‡½æ•° æ¦‚å¿µ Vueç»„ä»¶å®ä¾‹åœ¨åˆ›å»ºæ—¶è¦ç»å†ä¸€ç³»åˆ—çš„åˆå§‹åŒ–æ­¥éª¤ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­Vueä¼šåœ¨åˆé€‚çš„æ—¶æœºï¼Œè°ƒç”¨ç‰¹å®šçš„å‡½æ•°ï¼Œä»è€Œè®©å¼€å‘è€…æœ‰æœºä¼šåœ¨ç‰¹å®šé˜¶æ®µè¿è¡Œè‡ªå·±çš„ä»£ç ï¼Œè¿™äº›ç‰¹å®šçš„å‡½æ•°ç»Ÿç§°ä¸ºï¼šç”Ÿå‘½å‘¨æœŸé’©å­ è§„å¾‹ ç”Ÿå‘½å‘¨æœŸæ•´ä½“åˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯ï¼šåˆ›å»ºã€æŒ‚è½½ã€æ›´æ–°ã€é”€æ¯ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æœ‰ä¸¤ä¸ªé’©å­ï¼Œä¸€å‰ä¸€åã€‚ Vue2çš„ç”Ÿå‘½å‘¨æœŸ åˆ›å»ºé˜¶æ®µï¼šbeforeCreateã€created æŒ‚è½½é˜¶æ®µï¼šbeforeMountã€mounted æ›´æ–°é˜¶æ®µï¼šbeforeUpdateã€updated é”€æ¯é˜¶æ®µï¼šbeforeDestroyã€destroyed Vue3çš„ç”Ÿå‘½å‘¨æœŸ åˆ›å»ºé˜¶æ®µï¼šsetup æŒ‚è½½é˜¶æ®µï¼šonBeforeMountã€onMounted æ›´æ–°é˜¶æ®µï¼šonBeforeUpdateã€onUpdated å¸è½½é˜¶æ®µï¼šonBeforeUnmountã€onUnmounted å¸¸ç”¨çš„é’©å­ onMounted(æŒ‚è½½å®Œæ¯•)ã€onUpdated(æ›´æ–°å®Œæ¯•)ã€onBeforeUnmount(å¸è½½ä¹‹å‰) ç¤ºä¾‹ template div class=person h2å½“å‰æ±‚å’Œä¸ºï¼š sum /h2 button @click=changeSumç‚¹æˆ‘sum+1/button /div/template!-- vue3å†™æ³• --script lang=ts setup name=Person import ref, onBeforeMount, onMounted, onBeforeUpdate, onUpdated, onBeforeUnmount, onUnmounted from vue // æ•°æ® let sum = ref(0) // æ–¹æ³• function changeSum() sum.value += 1 console.log(setup) // ç”Ÿå‘½å‘¨æœŸé’©å­ onBeforeMount(()= console.log(æŒ‚è½½ä¹‹å‰) ) onMounted(()= console.log(æŒ‚è½½å®Œæ¯•) ) onBeforeUpdate(()= console.log(æ›´æ–°ä¹‹å‰) ) onUpdated(()= console.log(æ›´æ–°å®Œæ¯•) ) onBeforeUnmount(()= console.log(å¸è½½ä¹‹å‰) ) onUnmounted(()= console.log(å¸è½½å®Œæ¯•) )/script 3.8 è‡ªå®šä¹‰hook ä»€ä¹ˆæ˜¯hookï¼Ÿ æœ¬è´¨æ˜¯ä¸€ä¸ªå‡½æ•°ï¼ŒæŠŠsetupå‡½æ•°ä¸­ä½¿ç”¨çš„Composition APIè¿›è¡Œäº†å°è£…ï¼Œç±»ä¼¼äºvue2.xä¸­çš„mixin è‡ªå®šä¹‰hookçš„ä¼˜åŠ¿ å¤ç”¨ä»£ç , è®©setupä¸­çš„é€»è¾‘æ›´æ¸…æ¥šæ˜“æ‡‚ ç¤ºä¾‹ useSum.ts import ref,onMounted from vueexport default function() let sum = ref(0) const increment = ()= sum.value += 1 const decrement = ()= sum.value -= 1 onMounted(()= increment() ) //å‘å¤–éƒ¨æš´éœ²æ•°æ® return sum,increment,decrement useDog.ts import reactive,onMounted from vueimport axios,AxiosError from axiosexport default function() let dogList = reactivestring[]([]) // æ–¹æ³• async function getDog() try // å‘è¯·æ±‚ let data = await axios.get(https://dog.ceo/api/breed/pembroke/images/random) // ç»´æŠ¤æ•°æ® dogList.push(data.message) catch (error) // å¤„ç†é”™è¯¯ const err = AxiosErrorerror console.log(err.message) // æŒ‚è½½é’©å­ onMounted(()= getDog() ) //å‘å¤–éƒ¨æš´éœ²æ•°æ® return dogList,getDog ç»„ä»¶ä¸­å…·ä½“ä½¿ç”¨ template h2å½“å‰æ±‚å’Œä¸ºï¼šsum/h2 button @click=incrementç‚¹æˆ‘+1/button button @click=decrementç‚¹æˆ‘-1/button hr img v-for=(u,index) in dogList.urlList :key=index :src=(u as string) span v-show=dogList.isLoadingåŠ è½½ä¸­....../spanbr button @click=getDogå†æ¥ä¸€åªç‹—/button/templatescript lang=ts import defineComponent from vue export default defineComponent( name:App, )/scriptscript setup lang=ts import useSum from ./hooks/useSum import useDog from ./hooks/useDog let sum,increment,decrement = useSum() let dogList,getDog = useDog()/script 4. ç»„ä»¶é€šä¿¡4.1 çˆ¶ä¼ å­ çˆ¶ä¼ å­ çˆ¶ç»„ä»¶ä¸­ç»™å­ç»„ä»¶ç»‘å®šå±æ€§ å­ç»„ä»¶å†…éƒ¨é€šè¿‡propsé€‰é¡¹æ¥æ”¶æ•°æ® ç¤ºä¾‹ 4.2 å­ä¼ çˆ¶ å­ä¼ çˆ¶ çˆ¶ç»„ä»¶ä¸­ç»™å­ç»„ä»¶æ ‡ç­¾é€šè¿‡@ç»‘å®šäº‹ä»¶ å­ç»„ä»¶å†…éƒ¨é€šè¿‡ emit æ–¹æ³•è§¦å‘äº‹ä»¶ ç¤ºä¾‹ 4.3 defineExpose defineExpose é»˜è®¤æƒ…å†µä¸‹åœ¨ script setupè¯­æ³•ç³–ä¸‹ç»„ä»¶å†…éƒ¨çš„å±æ€§å’Œæ–¹æ³•æ˜¯ä¸å¼€æ”¾ç»™çˆ¶ç»„ä»¶è®¿é—®çš„ï¼Œå¯ä»¥é€šè¿‡defineExposeç¼–è¯‘å®æŒ‡å®šå“ªäº›å±æ€§å’Œæ–¹æ³•å®¹è®¸è®¿é—®è¯´æ˜ï¼šæŒ‡å®štestMessageå±æ€§å¯ä»¥è¢«è®¿é—®åˆ° 4.4 provideå’Œinject ä½œç”¨å’Œåœºæ™¯ é¡¶å±‚ç»„ä»¶å‘ä»»æ„çš„åº•å±‚ç»„ä»¶ä¼ é€’æ•°æ®å’Œæ–¹æ³•ï¼Œå®ç°è·¨å±‚ç»„ä»¶é€šä¿¡ è·¨å±‚ä¼ é€’æ™®é€šæ•°æ® å®ç°æ­¥éª¤ é¡¶å±‚ç»„ä»¶é€šè¿‡ provide å‡½æ•°æä¾›æ•°æ® åº•å±‚ç»„ä»¶é€šè¿‡ inject å‡½æ•°æä¾›æ•°æ® è·¨å±‚ä¼ é€’å“åº”å¼æ•°æ® åœ¨è°ƒç”¨provideå‡½æ•°æ—¶ï¼Œç¬¬äºŒä¸ªå‚æ•°è®¾ç½®ä¸ºrefå¯¹è±¡ è·¨å±‚ä¼ é€’æ–¹æ³• é¡¶å±‚ç»„ä»¶å¯ä»¥å‘åº•å±‚ç»„ä»¶ä¼ é€’æ–¹æ³•ï¼Œåº•å±‚ç»„ä»¶è°ƒç”¨æ–¹æ³•ä¿®æ”¹é¡¶å±‚ç»„ä»¶çš„æ•°æ® 5. defineOptions èƒŒæ™¯è¯´æ˜ æœ‰ script setup ä¹‹å‰ï¼Œå¦‚æœè¦å®šä¹‰ props, emits å¯ä»¥è½»è€Œæ˜“ä¸¾åœ°æ·»åŠ ä¸€ä¸ªä¸ setup å¹³çº§çš„å±æ€§ã€‚ ä½†æ˜¯ç”¨äº† script setup åï¼Œå°±æ²¡æ³•è¿™ä¹ˆå¹²äº† setup å±æ€§å·²ç»æ²¡æœ‰äº†ï¼Œè‡ªç„¶æ— æ³•æ·»åŠ ä¸å…¶å¹³çº§çš„å±æ€§ã€‚ ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œå¼•å…¥äº† defineProps ä¸ defineEmits è¿™ä¸¤ä¸ªå®ã€‚ä½†è¿™åªè§£å†³äº† props ä¸ emits è¿™ä¸¤ä¸ªå±æ€§ã€‚ å¦‚æœæˆ‘ä»¬è¦å®šä¹‰ç»„ä»¶çš„ name æˆ–å…¶ä»–è‡ªå®šä¹‰çš„å±æ€§ï¼Œè¿˜æ˜¯å¾—å›åˆ°æœ€åŸå§‹çš„ç”¨æ³•â€”â€”å†æ·»åŠ ä¸€ä¸ªæ™®é€šçš„ script æ ‡ç­¾ã€‚ è¿™æ ·å°±ä¼šå­˜åœ¨ä¸¤ä¸ª script æ ‡ç­¾ã€‚è®©äººæ— æ³•æ¥å—ã€‚ æ‰€ä»¥åœ¨ Vue 3.3 ä¸­æ–°å¼•å…¥äº† defineOptions å®ã€‚é¡¾åæ€ä¹‰ï¼Œä¸»è¦æ˜¯ç”¨æ¥å®šä¹‰ Options API çš„é€‰é¡¹ã€‚å¯ä»¥ç”¨ defineOptions å®šä¹‰ä»»æ„çš„é€‰é¡¹ï¼Œ props, emits, expose, slots é™¤å¤–ï¼ˆå› ä¸ºè¿™äº›å¯ä»¥ä½¿ç”¨ defineXXX æ¥åšåˆ°ï¼‰ ç¤ºä¾‹ 6. pina6.1 æ­å»º pinia ç¯å¢ƒ ç¬¬ä¸€æ­¥ npm install pinia ç¬¬äºŒæ­¥ æ“ä½œsrc/main.ts import createApp from vueimport App from ./App.vue/* å¼•å…¥createPiniaï¼Œç”¨äºåˆ›å»ºpinia */import createPinia from pinia/* åˆ›å»ºpinia */const pinia = createPinia()const app = createApp(App)/* ä½¿ç”¨æ’ä»¶ */app.use(pinia)app.mount(#app) 6.2 å­˜å‚¨+è¯»å–æ•°æ® Storeæ˜¯ä¸€ä¸ªä¿å­˜ï¼šçŠ¶æ€ã€ä¸šåŠ¡é€»è¾‘ çš„å®ä½“ï¼Œæ¯ä¸ªç»„ä»¶éƒ½å¯ä»¥è¯»å–ã€å†™å…¥å®ƒã€‚ å®ƒæœ‰ä¸‰ä¸ªæ¦‚å¿µï¼šstateã€getterã€actionï¼Œç›¸å½“äºç»„ä»¶ä¸­çš„ï¼š dataã€ computed å’Œ methodsã€‚ å…·ä½“ç¼–ç ï¼šsrc/store/count.ts // å¼•å…¥defineStoreç”¨äºåˆ›å»ºstoreimport defineStore from pinia// å®šä¹‰å¹¶æš´éœ²ä¸€ä¸ªstoreexport const useCountStore = defineStore(count, // åŠ¨ä½œ actions:, // çŠ¶æ€ state() return sum:6 , // è®¡ç®— getters:) å…·ä½“ç¼–ç ï¼šsrc/store/talk.ts // å¼•å…¥defineStoreç”¨äºåˆ›å»ºstoreimport defineStore from pinia// å®šä¹‰å¹¶æš´éœ²ä¸€ä¸ªstoreexport const useTalkStore = defineStore(talk, // åŠ¨ä½œ actions:, // çŠ¶æ€ state() return talkList:[ id:yuysada01,content:ä½ ä»Šå¤©æœ‰ç‚¹æ€ªï¼Œå“ªé‡Œæ€ªï¼Ÿæ€ªå¥½çœ‹çš„ï¼, id:yuysada02,content:è‰è“ã€è“è“ã€è”“è¶Šè“ï¼Œä½ æƒ³æˆ‘äº†æ²¡ï¼Ÿ, id:yuysada03,content:å¿ƒé‡Œç»™ä½ ç•™äº†ä¸€å—åœ°ï¼Œæˆ‘çš„æ­»å¿ƒå¡Œåœ° ] , // è®¡ç®— getters:) ç»„ä»¶ä¸­ä½¿ç”¨stateä¸­çš„æ•°æ® template h2å½“å‰æ±‚å’Œä¸ºï¼š sumStore.sum /h2/templatescript setup lang=ts name=Count // å¼•å…¥å¯¹åº”çš„useXxxxxStore import useSumStore from @/store/sum // è°ƒç”¨useXxxxxStoreå¾—åˆ°å¯¹åº”çš„store const sumStore = useSumStore()/script template ul li v-for=talk in talkStore.talkList :key=talk.id talk.content /li /ul/templatescript setup lang=ts name=Count import axios from axios import useTalkStore from @/store/talk const talkStore = useTalkStore()/script 6.3 ä¿®æ”¹æ•°æ® ç¬¬ä¸€ç§ä¿®æ”¹æ–¹å¼ï¼Œç›´æ¥ä¿®æ”¹ countStore.sum = 666 ç¬¬äºŒç§ä¿®æ”¹æ–¹å¼ï¼šæ‰¹é‡ä¿®æ”¹ countStore.$patch( sum:999, school:atguigu) ç¬¬ä¸‰ç§ä¿®æ”¹æ–¹å¼ï¼šå€ŸåŠ©actionä¿®æ”¹ï¼ˆactionä¸­å¯ä»¥ç¼–å†™ä¸€äº›ä¸šåŠ¡é€»è¾‘ï¼‰ import defineStore from piniaexport const useCountStore = defineStore(count, /*************/ actions: //åŠ  increment(value:number) if (this.sum 10) //æ“ä½œcountStoreä¸­çš„sum this.sum += value , //å‡ decrement(value:number) if(this.sum 1) this.sum -= value , /*************/) ç»„ä»¶ä¸­è°ƒç”¨actionå³å¯ // ä½¿ç”¨countStoreconst countStore = useCountStore()// è°ƒç”¨å¯¹åº”actioncountStore.incrementOdd(n.value) 6.4 storeToRefs å€ŸåŠ©storeToRefså°†storeä¸­çš„æ•°æ®è½¬ä¸ºrefå¯¹è±¡ï¼Œæ–¹ä¾¿åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ã€‚ æ³¨æ„ï¼špiniaæä¾›çš„storeToRefsåªä¼šå°†æ•°æ®åšè½¬æ¢ï¼Œè€ŒVueçš„toRefsä¼šè½¬æ¢storeä¸­æ•°æ®ã€‚ template div class=count h2å½“å‰æ±‚å’Œä¸ºï¼šsum/h2 /div/templatescript setup lang=ts name=Count import useCountStore from @/store/count /* å¼•å…¥storeToRefs */ import storeToRefs from pinia /* å¾—åˆ°countStore */ const countStore = useCountStore() /* ä½¿ç”¨storeToRefsè½¬æ¢countStoreï¼Œéšåè§£æ„ */ const sum = storeToRefs(countStore)/script 6.5 getters æ¦‚å¿µï¼šå½“stateä¸­çš„æ•°æ®ï¼Œéœ€è¦ç»è¿‡å¤„ç†åå†ä½¿ç”¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨gettersé…ç½®ã€‚ è¿½åŠ gettersé…ç½®ã€‚ // å¼•å…¥defineStoreç”¨äºåˆ›å»ºstoreimport defineStore from pinia// å®šä¹‰å¹¶æš´éœ²ä¸€ä¸ªstoreexport const useCountStore = defineStore(count, // åŠ¨ä½œ actions: /************/ , // çŠ¶æ€ state() return sum:1, school:atguigu , // è®¡ç®— getters: bigSum:(state):number = state.sum *10, upperSchool():string return this. school.toUpperCase() ) ç»„ä»¶ä¸­è¯»å–æ•°æ®ï¼š const increment,decrement = countStorelet sum,school,bigSum,upperSchool = storeToRefs(countStore) 6.6 $subscribe é€šè¿‡ store çš„ $subscribe() æ–¹æ³•ä¾¦å¬ state åŠå…¶å˜åŒ– talkStore.$subscribe((mutate,state)= console.log(LoveTalk,mutate,state) localStorage.setItem(talk,JSON.stringify(talkList.value))) 6.7 storeç»„åˆå¼å†™æ³• ç¤ºä¾‹ import defineStore from piniaimport axios from axiosimport nanoid from nanoidimport reactive from vueexport const useTalkStore = defineStore(talk,()= // talkListå°±æ˜¯state const talkList = reactive( JSON.parse(localStorage.getItem(talkList) as string) || [] ) // getATalkå‡½æ•°ç›¸å½“äºaction async function getATalk() // å‘è¯·æ±‚ï¼Œä¸‹é¢è¿™è¡Œçš„å†™æ³•æ˜¯ï¼šè¿ç»­è§£æ„èµ‹å€¼+é‡å‘½å let data:content:title = await axios.get(https://api.uomg.com/api/rand.qinghua?format=json) // æŠŠè¯·æ±‚å›æ¥çš„å­—ç¬¦ä¸²ï¼ŒåŒ…è£…æˆä¸€ä¸ªå¯¹è±¡ let obj = id:nanoid(),title // æ”¾åˆ°æ•°ç»„ä¸­ talkList.unshift(obj) return talkList,getATalk)","tags":["Vue3","Pina"],"categories":["å‰ç«¯"]},{"title":"typescriptåŸºç¡€","path":"/2023/12/20/2023-12-20-TypeScriptåŸºç¡€/","content":"1. å®‰è£…TSå·¥å…·åŒ… npm i -g typescript typescript åŒ…ï¼šç”¨æ¥ç¼–è¯‘ TS ä»£ç çš„åŒ…ï¼Œæä¾›äº† tsc å‘½ä»¤ï¼Œå®ç°äº† TS - JS çš„è½¬åŒ– åˆ›å»ºåŸºäºTSçš„vueé¡¹ç›® npm create vite vite-ts-demo --template vue-ts 2. TypeScrpitåŸºç¡€2.1 ç±»å‹æ³¨è§£ ä½œç”¨ TypeScript æ˜¯ JS çš„è¶…é›†ï¼ŒTS æä¾›äº† JS çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå¹¶ä¸”é¢å¤–çš„å¢åŠ äº†ï¼šç±»å‹ç³»ç»Ÿ æ‰€æœ‰çš„ JS ä»£ç éƒ½æ˜¯ TS ä»£ç  JS æœ‰ç±»å‹ï¼ˆæ¯”å¦‚ï¼Œnumberstring ç­‰ï¼‰ï¼Œä½†æ˜¯ JS ä¸ä¼šæ£€æŸ¥å˜é‡çš„ç±»å‹æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œè€Œ TS ä¼šæ£€æŸ¥ TypeScript ç±»å‹ç³»ç»Ÿçš„ä¸»è¦ä¼˜åŠ¿ï¼šå¯ä»¥æ˜¾ç¤ºæ ‡è®°å‡ºä»£ç ä¸­çš„æ„å¤–è¡Œä¸ºï¼Œä»è€Œé™ä½äº†å‘ç”Ÿé”™è¯¯çš„å¯èƒ½æ€§ ç¤ºä¾‹ let age = 18let age: number = 18è¯´æ˜ï¼šä»£ç ä¸­çš„ : number å°±æ˜¯ç±»å‹æ³¨è§£ä½œç”¨ï¼šä¸ºå˜é‡æ·»åŠ ç±»å‹çº¦æŸã€‚æ¯”å¦‚ï¼Œä¸Šè¿°ä»£ç ä¸­ï¼Œçº¦å®šå˜é‡ age çš„ç±»å‹ä¸º number ç±»å‹è§£é‡Šï¼šçº¦å®šäº†ä»€ä¹ˆç±»å‹ï¼Œå°±åªèƒ½ç»™å˜é‡èµ‹å€¼è¯¥ç±»å‹çš„å€¼ï¼Œå¦åˆ™ï¼Œå°±ä¼šæŠ¥é”™çº¦å®šäº†ç±»å‹ä¹‹åï¼Œä»£ç çš„æç¤ºå°±ä¼šéå¸¸çš„æ¸…æ™° é”™è¯¯æ¼”ç¤º // é”™è¯¯ä»£ç ï¼š// é”™è¯¯åŸå› ï¼šå°† string ç±»å‹çš„å€¼èµ‹å€¼ç»™äº† number ç±»å‹çš„å˜é‡ï¼Œç±»å‹ä¸ä¸€è‡´let age: number = 18 2.2 TypeScriptç±»å‹æ¦‚è¿° åˆ†ç±» å¯ä»¥å°† TS ä¸­çš„å¸¸ç”¨åŸºç¡€ç±»å‹ç»†åˆ†ä¸ºä¸¤ç±» jså·²æœ‰ç±»å‹ åŸå§‹ç±»å‹ï¼Œç®€å•ç±»å‹ï¼ˆ numberstringbooleannullundefined ï¼‰ å¤æ‚æ•°æ®ç±»å‹ï¼ˆæ•°ç»„ï¼Œå¯¹è±¡ï¼Œå‡½æ•°ç­‰ï¼‰ TSæ–°å¢ç±»å‹ è”åˆç±»å‹ è‡ªå®šä¹‰ç±»å‹ï¼ˆç±»å‹åˆ«åï¼‰ æ¥å£ å…ƒç»„ å­—é¢é‡ç±»å‹ æšä¸¾ void 2.3 åŸºæœ¬æ•°æ®ç±»å‹ ç‰¹ç‚¹ ç®€å•ï¼Œè¿™äº›ç±»å‹ï¼Œå®Œå…¨æŒ‰ç…§ JS ä¸­ç±»å‹çš„åç§°æ¥ä¹¦å†™ ç¤ºä¾‹ // ä¾›æˆ‘ä»¬å­¦ä¹  TS çš„è¿è¡Œç¯å¢ƒ// console.log(123)// ç›¸å½“äºçœç•¥äº† :number, ä¼šè‡ªåŠ¨è¿›è¡Œç±»å‹æ¨è®º, æ ¹æ®åˆå§‹å€¼æ¥æ¨è®º// let age = 18let age: number = 18age = 20age = 30// age = 40console.log(age)// string åŸºæœ¬æ•°æ®ç±»å‹let username: string = åˆ˜ç‹„å¨username.slice// props: // msg: // type: String // åŒ…è£…ç±»// // // ç±»å‹æ³¨è§£æ€»ç»“: // 1. å°†æ¥ä¸èƒ½å°†å…¶ä»–ç±»å‹çš„å€¼èµ‹äºˆè¿™ä¸ªå˜é‡// 2. ä»£ç æœ‰æç¤º, åœ¨å˜é‡åé¢ . å¯ä»¥ç›´æ¥çœ‹åˆ°å½“å‰ç±»å‹æ‰€æ”¯æŒçš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•let bool: boolean = falsebool = truelet gender: undefined = undefined// gender = ç”·let hobby: null = null// hobby = xx 2.4 æ•°ç»„ç±»å‹ ç¤ºä¾‹ // æ•°ç»„ç±»å‹ // å£°æ˜æ•°ç»„çš„æ–¹å¼1 (æ¨èç”¨æ³•) // let arr = [123, abc, true] // let arr1 = [123, 456, 789] let arr: number[] = [1, 2, 3, 4, 5] let arr2: string[] = [abc, def, ghi] // arr2.forEach(item = item.indexOf()) // å£°æ˜æ•°ç»„çš„æ–¹å¼2 let arr3: Arraynumber = [1, 2, 3, 4, 5] 2.5 è”åˆç±»å‹ ä½œç”¨ é€šè¿‡è”åˆç±»å‹å°†å¤šä¸ªç±»å‹ç»„åˆæˆä¸€ä¸ªç±»å‹ éœ€æ±‚ æ•°ç»„ä¸­æ—¢æœ‰ number ç±»å‹ï¼Œåˆæœ‰ string ç±»å‹ï¼Œè¿™ä¸ªæ•°ç»„çš„ç±»å‹åº”è¯¥å¦‚ä½•å†™? è¯­æ³• let arr: (number | string)[] = [1, a, 3, b]è§£é‡Šï¼š | ï¼ˆç«–çº¿ï¼‰åœ¨ TS ä¸­å«åšè”åˆç±»å‹ï¼Œå³ï¼šç”±ä¸¤ä¸ªæˆ–å¤šä¸ªå…¶ä»–ç±»å‹ç»„æˆçš„ç±»å‹ï¼Œè¡¨ç¤ºå¯ä»¥æ˜¯è¿™äº›ç±»å‹ä¸­çš„ä»»æ„ä¸€ç§æ³¨æ„ï¼šè¿™æ˜¯ TS ä¸­è”åˆç±»å‹çš„è¯­æ³•ï¼Œåªæœ‰ä¸€æ ¹ç«–çº¿ï¼Œä¸è¦ä¸ JS ä¸­çš„æˆ–ï¼ˆ|| æˆ–ï¼‰æ··æ·†äº† ç¤ºä¾‹ // éœ€æ±‚: å¸Œæœ›æ•°ç»„é‡Œé¢å¯ä»¥å­˜æ•°å­—æˆ–å­—ç¬¦ä¸² // è”åˆç±»å‹: | let arr: (number | string)[] = [1, 2, 3, abc] // æ³¨æ„äº‹é¡¹: | çš„ä¼˜å…ˆçº§è¾ƒä½, éœ€è¦ç”¨ () åŒ…è£¹æå‡ä¼˜å…ˆçº§ // ä¸€æ—¦ä½¿ç”¨è”åˆç±»å‹, è¯´æ˜ arr ä¸­å­˜å‚¨çš„æ—¢å¯èƒ½æ˜¯ number ä¹Ÿå¯èƒ½æ˜¯ string, æ‰€ä»¥ä¼šä¸¢å¤±ä¸€éƒ¨åˆ†æç¤ºä¿¡æ¯ (åªèƒ½æç¤ºå…±æœ‰çš„æ–¹æ³•å’Œå±æ€§) let timerId: number | null = null timerId = setTimeout(() = , 1000) 2.6 ç±»å‹åˆ«å ä½œç”¨ èƒ½å¤Ÿä½¿ç”¨ç±»å‹åˆ«åç»™ç±»å‹èµ·åˆ«å è¯­æ³• ç±»å‹åˆ«åï¼ˆè‡ªå®šä¹‰ç±»å‹ï¼‰ ï¼šä¸ºä»»æ„ç±»å‹èµ·åˆ«å type åˆ«å = ç±»å‹ ä½¿ç”¨åœºæ™¯ å½“åŒä¸€ç±»å‹ï¼ˆå¤æ‚ï¼‰è¢«å¤šæ¬¡ä½¿ç”¨æ—¶ï¼Œå¯ä»¥é€šè¿‡ç±»å‹åˆ«åï¼Œç®€åŒ–è¯¥ç±»å‹çš„ä½¿ç”¨ ç¤ºä¾‹ // éœ€æ±‚: å¸Œæœ› N ä¸ªæ•°ç»„é‡Œé¢å¯ä»¥å­˜æ•°å­—æˆ–å­—ç¬¦ä¸² // ç±»å‹åˆ«å type ArrType = (number | string)[] let arr1: ArrType = [1, 2, 3, abc] let arr2: ArrType = [1, 2, 3, abc] let arr3: ArrType = [1, 2, 3, abc] let arr4: ArrType = [1, abc, 3, aaa] // çµæ´»åº¦å¾ˆé«˜, å¯ä»¥éšæ„æ­é…ç»„åˆä½¿ç”¨ type ItemType = number | string let arr5: ItemType[] = [1, 2, 3, abc] let str1: ItemType = 123 str1 = 123 // æ€»ç»“: å°†ä¸€ç»„ç±»å‹å­˜å‚¨åˆ°ã€Œå˜é‡ã€é‡Œ, ç”¨ type æ¥å£°æ˜è¿™ä¸ªç‰¹æ®Šçš„ã€Œå˜é‡ã€ 2.7 å‡½æ•°ç±»å‹2.7.1 åŸºæœ¬ä½¿ç”¨ ä½œç”¨ èƒ½å¤Ÿç»™å‡½æ•°æŒ‡å®šç±»å‹ï¼Œå®é™…ä¸ŠæŒ‡çš„æ˜¯ï¼šæŒ‡å®š å‡½æ•°å‚æ•° å’Œ è¿”å›å€¼ çš„ç±»å‹ è¯­æ³• ä¸ºå‡½æ•°æŒ‡å®šç±»å‹çš„ä¸¤ç§æ–¹å¼ å•ç‹¬æŒ‡å®šå‚æ•°ã€è¿”å›å€¼çš„ç±»å‹ åŒæ—¶æŒ‡å®šå‚æ•°ã€è¿”å›å€¼çš„ç±»å‹ å•ç‹¬æŒ‡å®š // æ™®é€šå‡½æ•°function å‡½æ•°å(å‚æ•°1: å‚æ•°1ç±»å‹, å‚æ•°2: å‚æ•°2ç±»å‹): è¿”å›å€¼ç±»å‹ å‡½æ•°ä½“ function add(a: number, b: number): number return a + b// å‡½æ•°è¡¨è¾¾å¼const fn = function(a: number, b: number): number return a + b// ç®­å¤´å‡½æ•°const add = (num1: number, num2: number): number = return num1 + num2 åŒæ—¶æŒ‡å®š type AddFn = (num1: number, num2: number) = numberconst add: AddFn = (num1, num2) = return num1 + num2 å½“å‡½æ•°ä½œä¸ºè¡¨è¾¾å¼æ—¶ï¼Œå¯ä»¥é€šè¿‡ç±»ä¼¼ç®­å¤´å‡½æ•°å½¢å¼çš„è¯­æ³•æ¥ä¸ºå‡½æ•°æ·»åŠ ç±»å‹ è¿™ç§å½¢å¼åªé€‚ç”¨äºå‡½æ•°è¡¨è¾¾å¼ 2.7.2 voidç±»å‹ æ¦‚å¿µ å¦‚æœå‡½æ•°æ²¡æœ‰è¿”å›å€¼ï¼Œé‚£ä¹ˆï¼Œå‡½æ•°è¿”å›å€¼ç±»å‹ä¸ºï¼š void ç¤ºä¾‹ // å¦‚æœä»€ä¹ˆéƒ½ä¸å†™ï¼Œæ­¤æ—¶ï¼Œadd å‡½æ•°çš„è¿”å›å€¼ç±»å‹ä¸ºï¼š voidconst add = () = // è¿™ç§å†™æ³•æ˜¯æ˜ç¡®æŒ‡å®šå‡½æ•°è¿”å›å€¼ç±»å‹ä¸º voidï¼Œä¸ä¸Šé¢ä¸æŒ‡å®šè¿”å›å€¼ç±»å‹ç›¸åŒconst add = (): void = // ä½†ï¼Œå¦‚æœæŒ‡å®š è¿”å›å€¼ç±»å‹ä¸º undefinedï¼Œæ­¤æ—¶ï¼Œå‡½æ•°ä½“ä¸­å¿…é¡»æ˜¾ç¤ºçš„ return undefined æ‰å¯ä»¥const add = (): undefined = // æ­¤å¤„ï¼Œè¿”å›çš„ undefined æ˜¯ JS ä¸­çš„ä¸€ä¸ªå€¼ return undefined // éœ€æ±‚: å®šä¹‰ä¸€ä¸ªæ‰“å°æ–‡æœ¬çš„å‡½æ•°, ä¸éœ€è¦è¿”å›å€¼ // å¦‚æœä¸å†™ return æˆ‘ä»¬çŸ¥é“é»˜è®¤è¿”å›çš„æ˜¯ undefined, ä½†æ˜¯ ts ç»™æˆ‘ä»¬ç±»å‹æ¨æ–­ä¸º void // åœ¨ ts ä¸­å†™ : undefined è®¾ç½®è¿”å›å€¼ç±»å‹çš„æ„æ€æ˜¯: å¿…é¡»è¿”å›ä¸€ä¸ª undefined // ts ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªè¿”å›å€¼ç±»å‹: void æ„æ€å°±æ˜¯æ²¡æœ‰è¿”å›å€¼ const sayHi = (content: string): void = console.log(content) sayHi(ä½ å¥½ä¸–ç•Œ) 2.7.3 å¯é€‰å‚æ•° ä½œç”¨ ä½¿ç”¨å‡½æ•°å®ç°æŸä¸ªåŠŸèƒ½æ—¶ï¼Œå‚æ•°å¯ä»¥ä¼ ä¹Ÿå¯ä»¥ä¸ä¼ ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨ç»™å‡½æ•°å‚æ•°æŒ‡å®šç±»å‹æ—¶ï¼Œå°±ç”¨åˆ°å¯é€‰å‚æ•°äº† æ¯”å¦‚ï¼Œæ•°ç»„çš„ slice æ–¹æ³•ï¼Œå¯ä»¥ slice() ä¹Ÿå¯ä»¥ slice(1) è¿˜å¯ä»¥ slice(1, 3) ç¤ºä¾‹ function mySlice(start?: number, end?: number): void console.log(èµ·å§‹ç´¢å¼•ï¼š, start, ç»“æŸç´¢å¼•ï¼š, end) å¯é€‰å‚æ•°ï¼šåœ¨å¯ä¼ å¯ä¸ä¼ çš„å‚æ•°åç§°åé¢æ·»åŠ  ? ï¼ˆé—®å·ï¼‰ å¯é€‰å‚æ•°åªèƒ½å‡ºç°åœ¨å‚æ•°åˆ—è¡¨çš„æœ€åï¼Œä¹Ÿå°±æ˜¯è¯´å¯é€‰å‚æ•°åé¢ä¸èƒ½å†å‡ºç°å¿…é€‰å‚æ•° 2.8 å¯¹è±¡ç±»å‹2.8.1 åŸºæœ¬ä½¿ç”¨ ä½œç”¨ JS ä¸­çš„å¯¹è±¡æ˜¯ç”±å±æ€§å’Œæ–¹æ³•æ„æˆçš„ï¼Œè€Œ TS å¯¹è±¡çš„ç±»å‹å°±æ˜¯åœ¨æè¿°å¯¹è±¡çš„ç»“æ„ï¼ˆæœ‰ä»€ä¹ˆç±»å‹çš„å±æ€§ å’Œæ–¹æ³•ï¼‰ è¯­æ³• ä½¿ç”¨ {} æ¥æè¿°å¯¹è±¡ç»“æ„ å±æ€§é‡‡ç”¨ å±æ€§å: ç±»å‹ çš„å½¢å¼ æ–¹æ³•é‡‡ç”¨ æ–¹æ³•å(): è¿”å›å€¼ç±»å‹ çš„å½¢å¼ ç¤ºä¾‹ // ç©ºå¯¹è±¡let person: = // æœ‰å±æ€§çš„å¯¹è±¡let person: name: string = name: åŒå­¦// æ—¢æœ‰å±æ€§åˆæœ‰æ–¹æ³•çš„å¯¹è±¡// åœ¨ä¸€è¡Œä»£ç ä¸­æŒ‡å®šå¯¹è±¡çš„å¤šä¸ªå±æ€§ç±»å‹æ—¶ï¼Œä½¿ç”¨ `;`ï¼ˆåˆ†å·ï¼‰æ¥åˆ†éš”let person: name: string; sayHi(): void = name: jack, sayHi() // å¯¹è±¡ä¸­å¦‚æœæœ‰å¤šä¸ªç±»å‹ï¼Œå¯ä»¥æ¢è¡Œå†™ï¼š// é€šè¿‡æ¢è¡Œæ¥åˆ†éš”å¤šä¸ªå±æ€§ç±»å‹ï¼Œå¯ä»¥å»æ‰ `;`let person: name: string sayHi(): void = name: jack, sayHi() 2.8.2 ä½¿ç”¨ç±»å‹åˆ«å é—®é¢˜ ç›´æ¥ä½¿ç”¨ {} å½¢å¼ä¸ºå¯¹è±¡æ·»åŠ ç±»å‹ï¼Œä¼šé™ä½ä»£ç çš„å¯è¯»æ€§ï¼ˆä¸å¥½è¾¨è¯†ç±»å‹å’Œå€¼ï¼‰ æ¨èï¼šä½¿ç”¨ç±»å‹åˆ«åä¸ºå¯¹è±¡æ·»åŠ ç±»å‹ ç¤ºä¾‹ // å¯¹è±¡ç±»å‹ type Person = name: string, age: number, gender: string, hobby: string, girlFriend?: string, // ? è¡¨ç¤ºå¯é€‰å±æ€§ // sayHi: (content: string) = void sayHi(content: string): void // ts å°±åƒåœ¨å†™æ³¨é‡Š, ä»¥å‰å†™çš„æ³¨é‡Šæ˜¯ç»™ç¨‹åºå‘˜çœ‹çš„, ts å†™çš„ç±»å‹æ˜¯ç»™ç¼–è¾‘å™¨çœ‹çš„, ç¨‹åºå‘˜ä¹Ÿå¯ä»¥çœ‹ let obj1: Person = name: åˆ˜ç‹„å¨, age: 38, gender: æœªçŸ¥, hobby: åœ£æ¯å¸ƒå±€, girlFriend: ä¹”ç¢§è, sayHi(content) console.log(å…«å˜: + content) let obj2: Person = name: æŸä¸€å¸†, age: 66, gender: æœªçŸ¥, hobby: é»‘å…å¯¼, sayHi(content) console.log(ä½ çœŸåˆ«å­¦äº†: + content) obj1.sayHi(åº†å‹) obj2.sayHi(æä¼Ÿå…´) // ä¼ ç»Ÿ if (obj1.girlFriend) obj1.girlFriend.concat() // ä¼˜é›… obj1.girlFriend obj1.girlFriend.concat() // æœ€æ–°: å¯é€‰é“¾æ“ä½œç¬¦, å‰é¢æœ‰æ‰ä¼šæ‰§è¡Œåé¢çš„å‡½æ•° obj1.girlFriend?.concat() 2.8.3 ç®­å¤´å‡½æ•°å½¢å¼çš„æ–¹æ³•ç±»å‹ ç¤ºä¾‹ greet(name: string):string, greet: (name: string) = stringtype Person = greet: (name: string) = void greet(name: string): voidlet person: Person = greet(name) console.log(name) 2.8.4 å¯¹è±¡å¯é€‰å±æ€§ ä½œç”¨ å¯¹è±¡çš„å±æ€§æˆ–æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯é€‰çš„ï¼Œæ­¤æ—¶å°±ç”¨åˆ°å¯é€‰å±æ€§äº† æ¯”å¦‚ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ axios({ â€¦ }) æ—¶ï¼Œå¦‚æœå‘é€ GET è¯·æ±‚ï¼Œmethod å±æ€§å°±å¯ä»¥çœç•¥ å¯é€‰å±æ€§çš„è¯­æ³•ä¸å‡½æ•°å¯é€‰å‚æ•°çš„è¯­æ³•ä¸€è‡´ï¼Œéƒ½ä½¿ç”¨ ? æ¥è¡¨ç¤º ç¤ºä¾‹ type Config = url: string method?: stringfunction myAxios(config: Config) console.log(config) 2.9 æ¥å£ç±»å‹2.9.1 åŸºæœ¬ä½¿ç”¨ ä½œç”¨ å½“ä¸€ä¸ªå¯¹è±¡ç±»å‹è¢«å¤šæ¬¡ä½¿ç”¨æ—¶ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨æ¥å£ï¼ˆ interface ï¼‰æ¥æè¿°å¯¹è±¡çš„ç±»å‹ï¼Œè¾¾åˆ°å¤ç”¨çš„ç›®çš„ ä½¿ç”¨ interface å…³é”®å­—æ¥å£°æ˜æ¥å£ æ¥å£åç§°(æ¯”å¦‚ï¼ŒIPerson)ï¼Œå¯ä»¥æ˜¯ä»»æ„åˆæ³•çš„å˜é‡åç§°ï¼Œæ¨èä»¥ I å¼€å¤´ å£°æ˜æ¥å£åï¼Œç›´æ¥ä½¿ç”¨æ¥å£åç§°ä½œä¸ºå˜é‡çš„ç±»å‹ å› ä¸ºæ¯ä¸€è¡Œåªæœ‰ä¸€ä¸ªå±æ€§ç±»å‹ï¼Œå› æ­¤ï¼Œå±æ€§ç±»å‹åæ²¡æœ‰ ;(åˆ†å·) ç¤ºä¾‹ // ä½œç”¨: ç»™å¯¹è±¡çº¦æŸå±æ€§å’Œæ–¹æ³•// åŸºç¡€è¯­æ³•:interface æ¥å£å å±æ€§å: ç±»å‹ interface IPerson username: string age: number gender: string sayHi: () = voidconst p1: IPerson = username: åˆ˜ç‹„å¨, age: 38, gender: æœªçŸ¥, sayHi() console.log(æˆ‘æ˜¯æ¦œä¸€åˆ˜ç‹„å¨, i\\m rich) 2.9.2 interface vs type ç›¸åŒ éƒ½å¯ä»¥ç»™å¯¹è±¡æŒ‡å®šç±»å‹ ä¸åŒ æ¥å£ï¼Œåªèƒ½ä¸ºå¯¹è±¡æŒ‡å®šç±»å‹ ç±»å‹åˆ«åï¼Œä¸ä»…å¯ä»¥ä¸ºå¯¹è±¡æŒ‡å®šç±»å‹ï¼Œå®é™…ä¸Šå¯ä»¥ä¸ºä»»æ„ç±»å‹æŒ‡å®šåˆ«å æ¨èï¼šèƒ½ä½¿ç”¨ type å°±æ˜¯ç”¨ type ç¤ºä¾‹ interface IPerson name: string age: number sayHi(): void // ä¸ºå¯¹è±¡ç±»å‹åˆ›å»ºç±»å‹åˆ«åtype IPerson = name: string age: number sayHi(): void // ä¸ºè”åˆç±»å‹åˆ›å»ºç±»å‹åˆ«åtype NumStr = number | string 2.9.3 æ¥å£ç»§æ‰¿ ä½œç”¨ å¦‚æœä¸¤ä¸ªæ¥å£ä¹‹é—´æœ‰ç›¸åŒçš„å±æ€§æˆ–æ–¹æ³•ï¼Œå¯ä»¥å°†å…¬å…±çš„å±æ€§æˆ–æ–¹æ³•æŠ½ç¦»å‡ºæ¥ï¼Œé€šè¿‡ç»§æ‰¿æ¥å®ç°å¤ç”¨ ç¤ºä¾‹ interface IPerson username: string age: number gender: string sayHi: () = void const p1: IPerson = username: åˆ˜ç‹„å¨, age: 38, gender: æœªçŸ¥, sayHi() console.log(æˆ‘æ˜¯æ¦œä¸€åˆ˜ç‹„å¨, i\\m rich) p1.sayHi() // æ¥å£ç»§æ‰¿: IStudent å…·å¤‡ IPerson çš„æ‰€æœ‰çº¦æŸè§„åˆ™ interface IStudent extends IPerson score: number sleep: () = void const s1: IStudent = username: åˆ˜ç‹„å¨, age: 18, gender: ç”·, sayHi() console.log(æˆ‘æ˜¯æ¦œä¸€åˆ˜ç‹„å¨, i\\m rich) , score: 59, sleep() console.log(åˆ˜ç‹„å¨æ­£åœ¨ç¡è§‰...) , s1.sayHi() s1.sleep() // ä½¿ç”¨ type å®ç°å’Œ interface ç±»ä¼¼ç»§æ‰¿çš„æ•ˆæœ type Person = username: string age: number gender: string sayHi: () = void // ä¸è¿æ¥ç¬¦: æ—¢è¦æ»¡è¶³å‰é¢çš„ä¹Ÿè¦æ»¡è¶³åé¢çš„ // | æˆ–è¿æ¥ç¬¦: æ»¡è¶³å…¶ä¸­ä¸€ä¸ªå³å¯ type Student = score: number sleep: () = void Person const s2: Student = username: åˆ˜ç‹„å¨, age: 28, gender: æœªçŸ¥, sayHi() console.log(å¤§å˜å¥½!) , score: 80, sleep() console.log(æˆ‘åœ¨ç¡è§‰) , // type ItemType = string | number // type ArrType = string[] // interface IStudent // // æ€»ç»“: interface å’Œ type çš„åŒºåˆ«, interface åªèƒ½çº¦æŸå¯¹è±¡, è€Œ type å¯ä»¥æ›´çµæ´»çš„ä½¿ç”¨ // èƒ½ç”¨ type å°±ç”¨ type æ›´çµæ´», æ›´ç®€å• // æ¥å£ç»§æ‰¿: å¯ä»¥å®ç°è®©ä¸€ä¸ªæ¥å£ä½¿ç”¨å¦ä¸€ä¸ªæ¥å£çš„ç±»å‹çº¦æŸ, å®ç°æ¥å£çš„å¤ç”¨ 2.10 å…ƒç»„ç±»å‹ æ¦‚å¿µ å…ƒç»„ç±»å‹æ˜¯å¦ä¸€ç§ç±»å‹çš„æ•°ç»„ï¼Œå®ƒç¡®åˆ‡åœ°çŸ¥é“åŒ…å«å¤šå°‘ä¸ªå…ƒç´ ï¼Œä»¥åŠç‰¹å®šç´¢å¼•å¯¹åº”çš„ç±»å‹ åœºæ™¯ åœ¨åœ°å›¾ä¸­ï¼Œä½¿ç”¨ç»çº¬åº¦åæ ‡æ¥æ ‡è®°ä½ç½®ä¿¡æ¯ è¯´æ˜ å…ƒç»„ç±»å‹å¯ä»¥ç¡®åˆ‡åœ°æ ‡è®°å‡ºæœ‰å¤šå°‘ä¸ªå…ƒç´ ï¼Œä»¥åŠæ¯ä¸ªå…ƒç´ çš„ç±»å‹ è¯¥ç¤ºä¾‹ä¸­ï¼Œå…ƒç´ æœ‰ä¸¤ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ çš„ç±»å‹éƒ½æ˜¯ number let position: [number, number] = [39.5427, 116.2317] 2.11 ç±»å‹æ¨è®º ä½œç”¨ åœ¨ TS ä¸­ï¼ŒæŸäº›æ²¡æœ‰æ˜ç¡®æŒ‡å‡ºç±»å‹çš„åœ°æ–¹ï¼ŒTS çš„ç±»å‹æ¨è®ºæœºåˆ¶ä¼šå¸®åŠ©æä¾›ç±»å‹ å¸¸è§åœºæ™¯ å£°æ˜å˜é‡å¹¶åˆå§‹åŒ–æ—¶ å†³å®šå‡½æ•°è¿”å›å€¼æ—¶ ç¤ºä¾‹ // å˜é‡ age çš„ç±»å‹è¢«è‡ªåŠ¨æ¨æ–­ä¸ºï¼šnumberlet age = 18// å‡½æ•°è¿”å›å€¼çš„ç±»å‹è¢«è‡ªåŠ¨æ¨æ–­ä¸ºï¼šnumberfunction add(num1: number, num2: number) return num1 + num2 2.12 å­—é¢é‡ç±»å‹2.12.1 åŸºæœ¬ä½¿ç”¨ æ€è€ƒ æ€è€ƒä»¥ä¸‹ä»£ç ï¼Œä¸¤ä¸ªå˜é‡çš„ç±»å‹åˆ†åˆ«æ˜¯ä»€ä¹ˆ? let str1 = Hello TSconst str2 = Hello TS é€šè¿‡ TS ç±»å‹æ¨è®ºæœºåˆ¶ï¼Œå¯ä»¥å¾—åˆ°ç­”æ¡ˆ å˜é‡ str1 çš„ç±»å‹ä¸ºï¼šstring å˜é‡ str2 çš„ç±»å‹ä¸ºï¼šâ€™Hello TSâ€™ è§£é‡Š str1 æ˜¯ä¸€ä¸ªå˜é‡(let)ï¼Œå®ƒçš„å€¼å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ç±»å‹ä¸º:string str2 æ˜¯ä¸€ä¸ªå¸¸é‡(const)ï¼Œå®ƒçš„å€¼ä¸èƒ½å˜åŒ–åªèƒ½æ˜¯ â€˜Hello TSâ€™ï¼Œæ‰€ä»¥ï¼Œå®ƒçš„ç±»å‹ä¸º:â€™Hello TSâ€™ å£°æ˜çš„å˜é‡æ˜¯ä¸å¯ä¿®æ”¹çš„, æ„å‘³ç€ä»å§‹è‡³ç»ˆéƒ½å¿…é¡»æ˜¯ â€˜Hello TSâ€™, æ‰€ä»¥ TS å°†å…¶å½“åšä¸€ä¸ªç±»å‹æ¥çœ‹, è¿™ç§ç±»å‹å°±è¢«ç§°ä¸ºã€Œå­—é¢é‡ã€ç±»å‹ æ³¨æ„ æ­¤å¤„çš„ â€˜Hello TSâ€™ï¼Œå°±æ˜¯ä¸€ä¸ªå­—é¢é‡ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´æŸä¸ªç‰¹å®šçš„å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥ä½œä¸º TS ä¸­çš„ç±»å‹ ä»»æ„çš„ JS å­—é¢é‡ï¼ˆæ¯”å¦‚ï¼Œå¯¹è±¡ã€æ•°å­—ç­‰ï¼‰éƒ½å¯ä»¥ä½œä¸ºç±»å‹ä½¿ç”¨ å­—é¢é‡ï¼š name: jack [] 18 20 abc false function() 2.12.2 ä½¿ç”¨æ¨¡å¼å’Œåœºæ™¯ ä½¿ç”¨æ¨¡å¼ å­—é¢é‡ç±»å‹é…åˆè”åˆç±»å‹ä¸€èµ·ä½¿ç”¨ åœºæ™¯ ç”¨æ¥è¡¨ç¤ºä¸€ç»„æ˜ç¡®çš„å¯é€‰å€¼åˆ—è¡¨ ç¤ºä¾‹ æ¯”å¦‚ï¼Œåœ¨è´ªåƒè›‡æ¸¸æˆä¸­ï¼Œæ¸¸æˆçš„æ–¹å‘çš„å¯é€‰å€¼åªèƒ½æ˜¯ä¸Šã€ä¸‹ã€å·¦ã€å³ä¸­çš„ä»»æ„ä¸€ä¸ª // ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹:type Direction = up | down | left | rightfunction changeDirection(direction: Direction) console.log(direction)// è°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼šæœ‰ç±»å‹æç¤ºï¼šchangeDirection(up) å‚æ•° direction çš„å€¼åªèƒ½æ˜¯ updownleftright ä¸­çš„ä»»æ„ä¸€ä¸ª ç›¸æ¯”äº string ç±»å‹ï¼Œä½¿ç”¨å­—é¢é‡ç±»å‹æ›´åŠ ç²¾ç¡®ã€ä¸¥è°¨ 2.13 æšä¸¾ç±»å‹2.13.1 åŸºæœ¬ä½¿ç”¨ ä½œç”¨ æšä¸¾çš„åŠŸèƒ½ç±»ä¼¼äºå­—é¢é‡ç±»å‹+è”åˆç±»å‹ç»„åˆçš„åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºä¸€ç»„æ˜ç¡®çš„å¯é€‰å€¼ å®šä¹‰ä¸€ç»„å‘½åå¸¸é‡ã€‚å®ƒæè¿°ä¸€ä¸ªå€¼ï¼Œè¯¥å€¼å¯ä»¥æ˜¯è¿™äº›å‘½åå¸¸é‡ä¸­çš„ä¸€ä¸ª ç¤ºä¾‹ // åˆ›å»ºæšä¸¾enum Direction Up, Down, Left, Right // ä½¿ç”¨æšä¸¾ç±»å‹function changeDirection(direction: Direction) console.log(direction)// è°ƒç”¨å‡½æ•°æ—¶ï¼Œéœ€è¦åº”è¯¥ä¼ å…¥ï¼šæšä¸¾ Direction æˆå‘˜çš„ä»»æ„ä¸€ä¸ª// ç±»ä¼¼äº JS ä¸­çš„å¯¹è±¡ï¼Œç›´æ¥é€šè¿‡ ç‚¹ï¼ˆ.ï¼‰è¯­æ³• è®¿é—®æšä¸¾çš„æˆå‘˜changeDirection(Direction.Up) ä½¿ç”¨ enum å…³é”®å­—å®šä¹‰æšä¸¾ çº¦å®šæšä¸¾åç§°ä»¥å¤§å†™å­—æ¯å¼€å¤´ æšä¸¾ä¸­çš„å¤šä¸ªå€¼ä¹‹é—´é€šè¿‡ , ï¼ˆé€—å·ï¼‰åˆ†éš” å®šä¹‰å¥½æšä¸¾åï¼Œç›´æ¥ä½¿ç”¨æšä¸¾åç§°ä½œä¸ºç±»å‹æ³¨è§£ 2.13.2 æ•°å­—æšä¸¾ é—®é¢˜ æˆ‘ä»¬æŠŠæšä¸¾æˆå‘˜ä½œä¸ºäº†å‡½æ•°çš„å®å‚ï¼Œå®ƒçš„å€¼æ˜¯ä»€ä¹ˆå‘¢? é€šè¿‡å°†é¼ æ ‡ç§»å…¥ Direction.Upï¼Œå¯ä»¥çœ‹åˆ°æšä¸¾æˆå‘˜ Up çš„å€¼ä¸º 0 æ³¨æ„ æšä¸¾æˆå‘˜æ˜¯æœ‰å€¼çš„ï¼Œé»˜è®¤ä¸ºï¼šä» 0 å¼€å§‹è‡ªå¢çš„æ•°å€¼ æ¦‚å¿µ æˆ‘ä»¬æŠŠï¼Œæšä¸¾æˆå‘˜çš„å€¼ä¸ºæ•°å­—çš„æšä¸¾ï¼Œç§°ä¸ºï¼š æ•°å­—æšä¸¾ ç¤ºä¾‹ ä¹Ÿå¯ä»¥ç»™æšä¸¾ä¸­çš„æˆå‘˜åˆå§‹åŒ–å€¼ // Down - 11ã€Left - 12ã€Right - 13enum Direction Up = 10, Down, Left, Right enum Direction Up = 2, Down = 4, Left = 8, Right = 16 2.13.3 å­—ç¬¦ä¸²æšä¸¾ æ¦‚å¿µ æšä¸¾æˆå‘˜çš„å€¼æ˜¯å­—ç¬¦ä¸²ï¼Œç§°ä¸ºï¼š å­—ç¬¦ä¸²æšä¸¾ æ³¨æ„ å­—ç¬¦ä¸²æšä¸¾æ²¡æœ‰è‡ªå¢é•¿è¡Œä¸ºï¼Œå› æ­¤ï¼Œå­—ç¬¦ä¸²æšä¸¾çš„æ¯ä¸ªæˆå‘˜å¿…é¡»æœ‰åˆå§‹å€¼ ç¤ºä¾‹ enum Direction Up = UP, Down = DOWN, Left = LEFT, Right = RIGHT 2.13.4 æšä¸¾åŸç† è¯´æ˜ æšä¸¾æ˜¯ TS ä¸ºæ•°ä¸å¤šçš„é JavaScript ç±»å‹çº§æ‰©å±•(ä¸ä»…ä»…æ˜¯ç±»å‹)çš„ç‰¹æ€§ä¹‹ä¸€ å› ä¸ºï¼šå…¶ä»–ç±»å‹ä»…ä»…è¢«å½“åšç±»å‹ï¼Œè€Œæšä¸¾ä¸ä»…ç”¨ä½œç±»å‹ï¼Œè¿˜æä¾›å€¼(æšä¸¾æˆå‘˜éƒ½æ˜¯æœ‰å€¼çš„) ä¹Ÿå°±æ˜¯è¯´ï¼Œå…¶ä»–çš„ç±»å‹ä¼šåœ¨ç¼–è¯‘ä¸º JS ä»£ç æ—¶è‡ªåŠ¨ç§»é™¤ã€‚ä½†æ˜¯ï¼Œæšä¸¾ç±»å‹ä¼šè¢«ç¼–è¯‘ä¸º JS ä»£ç  è§£æ enum Direction Up = UP, Down = DOWN, Left = LEFT, Right = RIGHT// ä¼šè¢«ç¼–è¯‘ä¸ºä»¥ä¸‹ JS ä»£ç ï¼švar Direction;(function (Direction) Direction[Up] = UPDirection[Down] = DOWNDirection[Left] = LEFTDirection[Right] = RIGHT)(Direction || Direction = ) æšä¸¾ä¸å‰é¢è®²åˆ°çš„å­—é¢é‡ç±»å‹+è”åˆç±»å‹ç»„åˆçš„åŠŸèƒ½ç±»ä¼¼ï¼Œéƒ½ç”¨æ¥è¡¨ç¤ºä¸€ç»„æ˜ç¡®çš„å¯é€‰å€¼åˆ—è¡¨ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¨èä½¿ç”¨å­—é¢é‡ç±»å‹+è”åˆç±»å‹ç»„åˆçš„æ–¹å¼ï¼Œå› ä¸ºç›¸æ¯”æšä¸¾ï¼Œè¿™ç§æ–¹å¼æ›´åŠ ç›´è§‚ã€ç®€æ´ã€é«˜æ•ˆ 2.14 anyç±»å‹ æ³¨æ„ ä¸æ¨èä½¿ç”¨ any!è¿™ä¼šè®© TypeScript å˜ä¸º â€œAnyScriptâ€(å¤±å» TS ç±»å‹ä¿æŠ¤çš„ä¼˜åŠ¿) å› ä¸ºå½“å€¼çš„ç±»å‹ä¸º any æ—¶ï¼Œå¯ä»¥å¯¹è¯¥å€¼è¿›è¡Œä»»æ„æ“ä½œï¼Œå¹¶ä¸”ä¸ä¼šæœ‰ä»£ç æç¤º ç¤ºä¾‹ let obj: any = x: 0 obj.bar = 100obj()const n: number = obj ä»¥ä¸Šæ“ä½œéƒ½ä¸ä¼šæœ‰ä»»ä½•ç±»å‹é”™è¯¯æç¤ºï¼Œå³ä½¿å¯èƒ½å­˜åœ¨é”™è¯¯ å°½å¯èƒ½çš„é¿å…ä½¿ç”¨ any ç±»å‹ï¼Œé™¤éä¸´æ—¶ä½¿ç”¨ any æ¥â€œé¿å…â€ä¹¦å†™å¾ˆé•¿ã€å¾ˆå¤æ‚çš„ç±»å‹ éšå¼è½¬æ¢ å£°æ˜å˜é‡ä¸æä¾›ç±»å‹ä¹Ÿä¸æä¾›é»˜è®¤å€¼ å‡½æ•°å‚æ•°ä¸åŠ ç±»å‹ 2.15 ç±»å‹æ–­è¨€ ä½œç”¨ æœ‰æ—¶å€™ä½ ä¼šæ¯” TS æ›´åŠ æ˜ç¡®ä¸€ä¸ªå€¼çš„ç±»å‹ï¼Œæ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç±»å‹æ–­è¨€æ¥æŒ‡å®šæ›´å…·ä½“çš„ç±»å‹ã€‚ const aLink = document.getElementById(link) æ³¨æ„ è¯¥æ–¹æ³•è¿”å›å€¼çš„ç±»å‹æ˜¯ HTMLElementï¼Œè¯¥ç±»å‹åªåŒ…å«æ‰€æœ‰æ ‡ç­¾å…¬å…±çš„å±æ€§æˆ–æ–¹æ³•ï¼Œä¸åŒ…å« aæ ‡ç­¾ç‰¹æœ‰çš„ href ç­‰å±æ€§ å› æ­¤ï¼Œè¿™ä¸ª**ç±»å‹å¤ªå®½æ³›(ä¸å…·ä½“)**ï¼Œæ— æ³•æ“ä½œ href ç­‰ a æ ‡ç­¾ç‰¹æœ‰çš„å±æ€§æˆ–æ–¹æ³• è§£å†³æ–¹å¼ è¿™ç§æƒ…å†µä¸‹å°±éœ€è¦ä½¿ç”¨ç±»å‹æ–­è¨€æŒ‡å®šæ›´åŠ å…·ä½“çš„ç±»å‹ ç¤ºä¾‹ // é¡µé¢ä¸Šæœ‰ä¸€ä¸ª id ä¸º link çš„ a æ ‡ç­¾ // æˆ‘ä»¬çŸ¥é“å®ƒæ˜¯ a æ ‡ç­¾ // ä½†æ˜¯ TS ä¸çŸ¥é“ // document.getElementById çš„è¿”å›å€¼æ˜¯ HTMLElement // è€Œ HTMLElement èº«ä¸Šæ²¡æœ‰ href // ç±»å‹æ–­è¨€: å¼ºè¡ŒæŒ‡å®šè·å–åˆ°çš„ç»“æœç±»å‹ const a = document.getElementById(link) as HTMLAnchorElement const box = document.getElementById(box) as HTMLDivElement const pp = document.getElementById(pp) as HTMLParagraphElement const img = document.getElementById(avatar) as HTMLImageElement img.src const result = document.createElement(img) console.log(a.href) if (a) console.log(a.href) a a.href // æ€»ç»“: å½“å‡½æ•°è·å–åˆ°çš„ç»“æœç±»å‹è¾ƒä¸ºå®½æ³›æ—¶, æˆ‘ä»¬åˆçŸ¥é“å…·ä½“ç±»å‹, å°±å¯ä»¥ä½¿ç”¨æ–­è¨€å¼ºè¡ŒæŒ‡å®šç±»å‹ ä½¿ç”¨ as å…³é”®å­—å®ç°ç±»å‹æ–­è¨€ å…³é”®å­— as åé¢çš„ç±»å‹æ˜¯ä¸€ä¸ªæ›´åŠ å…·ä½“çš„ç±»å‹ï¼ˆHTMLAnchorElement æ˜¯ HTMLElement çš„å­ç±»å‹ï¼‰ é€šè¿‡ç±»å‹æ–­è¨€ï¼ŒaLink çš„ç±»å‹å˜å¾—æ›´åŠ å…·ä½“ï¼Œè¿™æ ·å°±å¯ä»¥è®¿é—® a æ ‡ç­¾ç‰¹æœ‰çš„å±æ€§æˆ–æ–¹æ³•äº† 3. TypeScrpitæ³›å‹3.1 åŸºæœ¬ä»‹ç» ä½œç”¨ æ³›å‹æ˜¯å¯ä»¥åœ¨ä¿è¯ç±»å‹å®‰å…¨å‰æä¸‹ï¼Œè®©å‡½æ•°ç­‰ä¸å¤šç§ç±»å‹ä¸€èµ·å·¥ä½œï¼Œä»è€Œå®ç°å¤ç”¨ã€‚å¸¸ç”¨äºï¼šå‡½ æ•°ã€æ¥å£ã€class ä¸­ã€‚ éœ€æ±‚ åˆ›å»ºä¸€ä¸ª id å‡½æ•°ï¼Œä¼ å…¥ä»€ä¹ˆæ•°æ®å°±è¿”å›è¯¥æ•°æ®æœ¬èº«(ä¹Ÿå°±æ˜¯è¯´ï¼Œå‚æ•°å’Œè¿”å›å€¼ç±»å‹ç›¸åŒ) é—®é¢˜ function id(value: number): number return value æ¯”å¦‚ï¼Œid(10) è°ƒç”¨ä»¥ä¸Šå‡½æ•°å°±ä¼šç›´æ¥è¿”å› 10 æœ¬èº«ã€‚ä½†æ˜¯ï¼Œè¯¥å‡½æ•°åªæ¥æ”¶æ•°å€¼ç±»å‹ï¼Œæ— æ³•ç”¨äºå…¶ä»–ç±»å‹ function id(value: any): any return value ä¸ºäº†èƒ½è®©å‡½æ•°èƒ½å¤Ÿæ¥å—ä»»æ„ç±»å‹ï¼Œå¯ä»¥å°†å‚æ•°ç±»å‹ä¿®æ”¹ä¸º anyã€‚ä½†æ˜¯ï¼Œè¿™æ ·å°±å¤±å»äº† TS çš„ç±»å‹ä¿æŠ¤ï¼Œç±»å‹ä¸å®‰å…¨ 3.2 æ³›å‹å‡½æ•° è¯­æ³• function idType(value: Type): Type return value function idT(value: T): T return value åœ¨å‡½æ•°åç§°çš„åé¢æ·»åŠ  (å°–æ‹¬å·)ï¼Œå°–æ‹¬å·ä¸­æ·»åŠ ç±»å‹å˜é‡ï¼Œæ¯”å¦‚æ­¤å¤„çš„ Type ç±»å‹å˜é‡ Typeï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„å˜é‡ï¼Œå®ƒå¤„ç†ç±»å‹è€Œä¸æ˜¯å€¼ è¯¥ç±»å‹å˜é‡ç›¸å½“äºä¸€ä¸ªç±»å‹å®¹å™¨ï¼Œèƒ½å¤Ÿæ•è·ç”¨æˆ·æä¾›çš„ç±»å‹(å…·ä½“æ˜¯ä»€ä¹ˆç±»å‹ç”±ç”¨æˆ·è°ƒç”¨è¯¥å‡½æ•°æ—¶æŒ‡å®š) å› ä¸º Type æ˜¯ç±»å‹ï¼Œå› æ­¤å¯ä»¥å°†å…¶ä½œä¸ºå‡½æ•°å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹ï¼Œè¡¨ç¤ºå‚æ•°å’Œè¿”å›å€¼å…·æœ‰ç›¸åŒçš„ç±»å‹ ç±»å‹å˜é‡ Typeï¼Œå¯ä»¥æ˜¯ä»»æ„åˆæ³•çš„å˜é‡åç§° è°ƒç”¨ const num = idnumber(10)const str = idstring(a) è¯´æ˜ ï¼ˆ1ï¼‰åœ¨å‡½æ•°åç§°çš„åé¢æ·»åŠ  (å°–æ‹¬å·)ï¼Œå°–æ‹¬å·ä¸­æŒ‡å®šå…·ä½“çš„ç±»å‹ï¼Œæ¯”å¦‚ï¼Œæ­¤å¤„çš„number ï¼ˆ2ï¼‰å½“ä¼ å…¥ç±»å‹ number åï¼Œè¿™ä¸ªç±»å‹å°±ä¼šè¢«å‡½æ•°å£°æ˜æ—¶æŒ‡å®šçš„ç±»å‹å˜é‡ Type æ•è·åˆ° ï¼ˆ3ï¼‰æ­¤æ—¶ï¼ŒType çš„ç±»å‹å°±æ˜¯ numberï¼Œæ‰€ä»¥ï¼Œå‡½æ•° id å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹ä¹Ÿéƒ½æ˜¯ number åŒæ ·ï¼Œå¦‚æœä¼ å…¥ç±»å‹ stringï¼Œå‡½æ•° id å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹å°±éƒ½æ˜¯ string è¿™æ ·ï¼Œé€šè¿‡æ³›å‹å°±åšåˆ°äº†è®© id å‡½æ•°ä¸å¤šç§ä¸åŒçš„ç±»å‹ä¸€èµ·å·¥ä½œï¼Œå®ç°äº†å¤ç”¨çš„åŒæ—¶ä¿è¯äº†ç±»å‹å®‰å…¨ 3.3 ç®€åŒ–æ³›å‹å‡½æ•°è°ƒç”¨ ç®€åŒ– // çœç•¥ number è°ƒç”¨å‡½æ•°let num = id(10)let str = id(a) åœ¨è°ƒç”¨æ³›å‹å‡½æ•°æ—¶ï¼Œå¯ä»¥çœç•¥ ç±»å‹ æ¥ç®€åŒ–æ³›å‹å‡½æ•°çš„è°ƒç”¨ æ­¤æ—¶ï¼ŒTS å†…éƒ¨ä¼šé‡‡ç”¨ä¸€ç§å«åšç±»å‹å‚æ•°æ¨æ–­çš„æœºåˆ¶ï¼Œæ¥æ ¹æ®ä¼ å…¥çš„å®å‚è‡ªåŠ¨æ¨æ–­å‡ºç±»å‹å˜é‡Type çš„ç±»å‹ æ¯”å¦‚ï¼Œä¼ å…¥å®å‚ 10ï¼ŒTS ä¼šè‡ªåŠ¨æ¨æ–­å‡ºå˜é‡ num çš„ç±»å‹ numberï¼Œå¹¶ä½œä¸º Type çš„ç±»å‹ æ¨èä½¿ç”¨è¿™ç§ç®€åŒ–çš„æ–¹å¼è°ƒç”¨æ³›å‹å‡½æ•°ï¼Œä½¿ä»£ç æ›´çŸ­ï¼Œæ›´æ˜“äºé˜…è¯» è¯´æ˜ å½“ç¼–è¯‘å™¨æ— æ³•æ¨æ–­ç±»å‹æˆ–è€…æ¨æ–­çš„ç±»å‹ä¸å‡†ç¡®æ—¶ï¼Œå°±éœ€è¦æ˜¾å¼åœ°ä¼ å…¥ç±»å‹å‚æ•° 3.4 æ³›å‹çº¦æŸ ç¤ºä¾‹ // åˆ›å»ºä¸€ä¸ªæ¥å£interface ILength length: number // Type extends ILength æ·»åŠ æ³›å‹çº¦æŸ// è§£é‡Šï¼šè¡¨ç¤ºä¼ å…¥çš„ ç±»å‹ å¿…é¡»æ»¡è¶³ ILength æ¥å£çš„è¦æ±‚æ‰è¡Œï¼Œä¹Ÿå°±æ˜¯å¾—æœ‰ä¸€ä¸ª number ç±»å‹çš„ length å±æ€§function idType extends ILength(value: Type): Type console.log(value.length) return value è¯´æ˜ åˆ›å»ºæè¿°çº¦æŸçš„æ¥å£ ILengthï¼Œè¯¥æ¥å£è¦æ±‚æä¾› length å±æ€§ è¿‡ extends å…³é”®å­—ä½¿ç”¨è¯¥æ¥å£ï¼Œä¸ºæ³›å‹(ç±»å‹å˜é‡)æ·»åŠ çº¦æŸ è¯¥çº¦æŸè¡¨ç¤ºï¼šä¼ å…¥çš„ç±»å‹å¿…é¡»å…·æœ‰ length å±æ€§ æ³¨æ„ ä¼ å…¥çš„å®å‚(æ¯”å¦‚ï¼Œæ•°ç»„)åªè¦æœ‰ length å±æ€§å³å¯ï¼ˆç±»å‹å…¼å®¹æ€§) 3.5 å¤šä¸ªç±»å‹å˜é‡ åœºæ™¯ æ³›å‹çš„ç±»å‹å˜é‡å¯ä»¥æœ‰å¤šä¸ªï¼Œå¹¶ä¸”ç±»å‹å˜é‡ä¹‹é—´è¿˜å¯ä»¥çº¦æŸ(æ¯”å¦‚ï¼Œç¬¬äºŒä¸ªç±»å‹å˜é‡å—ç¬¬ä¸€ä¸ªç±»å‹å˜é‡çº¦æŸ) ç¤ºä¾‹ åˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥è·å–å¯¹è±¡ä¸­å±æ€§çš„å€¼ function getPropType, Key extends keyof Type(obj: Type, key: Key) return obj[key]let person = name: jack, age: 18 getProp(person, name) è¯´æ˜ æ·»åŠ äº†ç¬¬äºŒä¸ªç±»å‹å˜é‡ Keyï¼Œä¸¤ä¸ªç±»å‹å˜é‡ä¹‹é—´ä½¿ç”¨ , é€—å·åˆ†éš”ã€‚ keyof å…³é”®å­—æ¥æ”¶ä¸€ä¸ªå¯¹è±¡ç±»å‹ï¼Œç”Ÿæˆå…¶é”®åç§°(å¯èƒ½æ˜¯å­—ç¬¦ä¸²æˆ–æ•°å­—)çš„è”åˆç±»å‹ã€‚ æœ¬ç¤ºä¾‹ä¸­ keyof Type å®é™…ä¸Šè·å–çš„æ˜¯ person å¯¹è±¡æ‰€æœ‰é”®çš„è”åˆç±»å‹ï¼Œä¹Ÿå°±æ˜¯ï¼šname| age ç±»å‹å˜é‡ Key å— Type çº¦æŸï¼Œå¯ä»¥ç†è§£ä¸ºï¼šKey åªèƒ½æ˜¯ Type æ‰€æœ‰é”®ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œæˆ–è€…è¯´åªèƒ½è®¿é—®å¯¹è±¡ä¸­å­˜åœ¨çš„å±æ€§ ç¤ºä¾‹ // å¤šä¸ªæ³›å‹ // éœ€æ±‚: å®šä¹‰ä¸€ä¸ªå‡½æ•°, ä¼ å…¥ä¸€ä¸ªå¯¹è±¡, å†ä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²å±æ€§å, è¿”å›å±æ€§å€¼ // æ–°è¯­æ³•: keyof O æ„æ€å°±æ˜¯ O çš„æ‰€æœ‰å±æ€§ function getPropO, K extends keyof O(obj: O, key: K) return obj[key] const p1 = name: åˆ˜ç‹„å¨, gender: ç”· const p2 = score: 59, hobby: æŠ½çƒŸå–é…’çƒ«å¤´ const result1 = getProp(p1, name) // æŠ¥é”™ï¼šç±»å‹â€œageâ€çš„å‚æ•°ä¸èƒ½èµ‹ç»™ç±»å‹â€œname | genderâ€çš„å‚æ•° // const result2 = getProp(p1, age) const result3 = getProp(p1, gender) console.log(result1) 3.6 æ³›å‹æ¥å£ ä½œç”¨ æ¥å£ä¹Ÿå¯ä»¥é…åˆæ³›å‹æ¥ä½¿ç”¨ï¼Œä»¥å¢åŠ å…¶çµæ´»æ€§ï¼Œå¢å¼ºå…¶å¤ç”¨ ç¤ºä¾‹ // æ³›å‹æ¥å£ interface StudentT id: number name: T hobby: T[] let s1: Studentstring = id: 123, name: åˆ˜ç‹„å¨, hobby: [æŠ½çƒŸ, å–é…’, å†™åœ£æ¯å¸ƒå±€] const s2: Studentnumber = id: 123, name: 0, hobby: [1, 2, 3, 4] const arr1: number[] = [1, 2, 3] const arr2: Arraynumber = [1, 2, 3] const arr3: Arraystring = [1, a, c] è¯´æ˜ åœ¨æ¥å£åç§°çš„åé¢æ·»åŠ  ç±»å‹å˜é‡ ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªæ¥å£å°±å˜æˆäº†æ³›å‹æ¥å£ã€‚ æ¥å£çš„ç±»å‹å˜é‡ï¼Œå¯¹æ¥å£ä¸­æ‰€æœ‰å…¶ä»–æˆå‘˜å¯è§ï¼Œä¹Ÿå°±æ˜¯æ¥å£ä¸­æ‰€æœ‰æˆå‘˜éƒ½å¯ä»¥ä½¿ç”¨ç±»å‹å˜é‡ã€‚ ä½¿ç”¨æ³›å‹æ¥å£æ—¶ï¼Œéœ€è¦æ˜¾å¼æŒ‡å®šå…·ä½“çš„ç±»å‹(æ¯”å¦‚ï¼Œæ­¤å¤„çš„ Student)ã€‚ æ­¤æ—¶ï¼Œnameå±æ€§çš„å‚æ•°ç±»å‹æ˜¯ number;hobbyæ–¹æ³•çš„å‚æ•°ç±»å‹æ˜¯ number[]ã€‚ 4. TypeScriptä¸Vue4.1 definePropsä¸Typescript definePropsé…åˆvueé»˜è®¤è¯­æ³•è¿›è¡Œç±»å‹æ ¡éªŒï¼ˆè¿è¡Œæ—¶å£°æ˜ï¼‰ definePropsé…åˆtsçš„æ³›å‹å®šä¹‰propsç±»å‹æ ¡éªŒï¼Œè¿™æ ·æ›´ç›´æ¥ propså¯ä»¥é€šè¿‡è§£æ„æ¥æŒ‡å®šé»˜è®¤å€¼ 5. TypeScriptç±»å‹å£°æ˜æ–‡ä»¶5.1 åŸºæœ¬ä»‹ç» ä½œç”¨ ç”¨æ¥ä¸ºå·²å­˜åœ¨çš„JSåº“æä¾›ç±»å‹ä¿¡æ¯ åˆ†ç±» TS ä¸­æœ‰ä¸¤ç§æ–‡ä»¶ç±»å‹ï¼š.ts æ–‡ä»¶ .d.ts æ–‡ä»¶ .ts æ—¢åŒ…å«ç±»å‹ä¿¡æ¯åˆå¯æ‰§è¡Œä»£ç  å¯ä»¥è¢«ç¼–è¯‘ä¸º .js æ–‡ä»¶ï¼Œç„¶åï¼Œæ‰§è¡Œä»£ç  ç”¨é€”ï¼šç¼–å†™ç¨‹åºä»£ç çš„åœ°æ–¹ .d.ts åªåŒ…å«ç±»å‹ä¿¡æ¯ çš„ç±»å‹å£°æ˜æ–‡ä»¶ ä¸ä¼šç”Ÿæˆ .js æ–‡ä»¶ï¼Œä»…ç”¨äºæä¾›ç±»å‹ä¿¡æ¯,åœ¨**.d.ts**æ–‡ä»¶ä¸­ä¸å…è®¸å‡ºç°å¯æ‰§è¡Œçš„ä»£ç ï¼Œåªç”¨äºæä¾›ç±»å‹ ç”¨é€”ï¼šä¸º JS æä¾›ç±»å‹ä¿¡æ¯ 5.2 è‡ªå®šä¹‰ç±»å‹å£°æ˜æ–‡ä»¶ é¡¹ç›®å†…å…±äº«ç±»å‹ å¦‚æœå¤šä¸ª .ts æ–‡ä»¶ä¸­éƒ½ç”¨åˆ°åŒä¸€ä¸ªç±»å‹ï¼Œæ­¤æ—¶å¯ä»¥åˆ›å»º .d.ts æ–‡ä»¶æä¾›è¯¥ç±»å‹ï¼Œå®ç°ç±»å‹å…±äº«ã€‚ æ“ä½œæ­¥éª¤: åˆ›å»º index.d.ts ç±»å‹å£°æ˜æ–‡ä»¶ã€‚ åˆ›å»ºéœ€è¦å…±äº«çš„ç±»å‹ï¼Œå¹¶ä½¿ç”¨ export å¯¼å‡º(TS ä¸­çš„ç±»å‹ä¹Ÿå¯ä»¥ä½¿ç”¨ importexport å®ç°æ¨¡å—åŒ–åŠŸèƒ½)ã€‚ åœ¨éœ€è¦ä½¿ç”¨å…±äº«ç±»å‹çš„ .ts æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ import å¯¼å…¥å³å¯(.d.ts åç¼€å¯¼å…¥æ—¶ï¼Œç›´æ¥çœç•¥)ã€‚ è‡ªå®šä¹‰ç±»å‹å£°æ˜æ–‡ä»¶-ä¸ºjsæä¾›å£°æ˜ ä¸ºå·²æœ‰ JS æ–‡ä»¶æä¾›ç±»å‹å£°æ˜ åœ¨å°† JS é¡¹ç›®è¿ç§»åˆ° TS é¡¹ç›®æ—¶ï¼Œä¸ºäº†è®©å·²æœ‰çš„ .js æ–‡ä»¶æœ‰ç±»å‹å£°æ˜ã€‚ æˆä¸ºåº“ä½œè€…ï¼Œåˆ›å»ºåº“ç»™å…¶ä»–äººä½¿ç”¨ã€‚ æ¼”ç¤º:åŸºäºæœ€æ–°çš„ ESModule(importexport)æ¥ä¸ºå·²æœ‰ .js æ–‡ä»¶ï¼Œåˆ›å»ºç±»å‹å£°æ˜æ–‡ä»¶ã€‚ ç±»å‹å£°æ˜æ–‡ä»¶çš„ä½¿ç”¨è¯´æ˜ TS é¡¹ç›®ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ .js æ–‡ä»¶ã€‚ åœ¨å¯¼å…¥ .js æ–‡ä»¶æ—¶ï¼ŒTS ä¼šè‡ªåŠ¨åŠ è½½ä¸ .js åŒåçš„ .d.ts æ–‡ä»¶ï¼Œä»¥æä¾›ç±»å‹å£°æ˜ã€‚ declare å…³é”®å­—:ç”¨äºç±»å‹å£°æ˜ï¼Œä¸ºå…¶ä»–åœ°æ–¹(æ¯”å¦‚ï¼Œ.js æ–‡ä»¶)å·²å­˜åœ¨çš„å˜é‡å£°æ˜ç±»å‹ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å˜é‡ã€‚ å¯¹äº typeã€interface ç­‰è¿™äº›æ˜ç¡®å°±æ˜¯ TS ç±»å‹çš„(åªèƒ½åœ¨ TS ä¸­ä½¿ç”¨çš„)ï¼Œå¯ä»¥çœç•¥ declare å…³é”®å­—ã€‚ å¯¹äº letã€function ç­‰å…·æœ‰åŒé‡å«ä¹‰(åœ¨ JSã€TS ä¸­éƒ½èƒ½ç”¨)ï¼Œåº”è¯¥ä½¿ç”¨ declare å…³é”®å­—ï¼Œæ˜ç¡®æŒ‡å®šæ­¤å¤„ç”¨äºç±»å‹å£°æ˜ã€‚ ç¤ºä¾‹ let songName = ç—´å¿ƒç»å¯¹let position = x: 0, y: 0function add(x, y) return x + yfunction changeDirection(direction) console.log(direction)const fomartPoint = point = console.log(å½“å‰åæ ‡ï¼š, point)export count, songName, position, add, changeDirection, fomartPoint å®šä¹‰ç±»å‹å£°æ˜æ–‡ä»¶ declare let count:numberdeclare let songName: stringinterface Position x: number, y: numberdeclare let position: Positiondeclare function add (x :number, y: number) : numbertype Direction = left | right | top | bottomdeclare function changeDirection (direction: Direction): voidtype FomartPoint = (point: Position) = voiddeclare const fomartPoint: FomartPointexport count, songName, position, add, changeDirection, FomartPoint, fomartPoint \\1. å¯¹äº typeã€interface ç­‰è¿™äº›æ˜ç¡®å°±æ˜¯ TS ç±»å‹çš„(åªèƒ½åœ¨ TS ä¸­ä½¿ç”¨çš„)ï¼Œå¯ä»¥çœç•¥ declare å…³é”®å­—ã€‚ \\2. å¯¹äº letã€function ç­‰å…·æœ‰åŒé‡å«ä¹‰(åœ¨ JSã€TS ä¸­éƒ½èƒ½ç”¨)ï¼Œåº”è¯¥ä½¿ç”¨ declare å…³é”®å­—ï¼Œæ˜ç¡®æŒ‡ å®šæ­¤å¤„ç”¨äºç±»å‹å£°æ˜ã€‚ import _ from â€˜lodashâ€™ åœ¨ VSCode ä¸­ï¼ŒæŸ¥çœ‹ â€˜lodashâ€™ å‰é¢çš„æç¤º let count 10å®šä¹‰ç±»å‹å£°æ˜æ–‡ä»¶ ç»¼åˆç»ƒä¹ ","tags":["typescript"],"categories":["å‰ç«¯"]},{"title":"vue3åå°ç®¡ç†æ¨¡æ¿","path":"/2023/12/15/2023-12-15-Vueåå°ç®¡ç†é¡¹ç›®æ¨¡æ¿/","content":"1. é¡¹ç›®åˆå§‹åŒ–1.1 ç¯å¢ƒå‡†å¤‡ node v16.19.1 pnpm 8.12.1 npm i -g pnpm 1.2 åˆå§‹åŒ–é¡¹ç›® pnpm create vite é€‰æ‹©vueã€TypeScript è¿›å…¥é¡¹ç›® // å®‰è£…ä¾èµ–pnpm i// å®‰è£…å®Œä¾èµ–è¿è¡Œç¨‹åºpnpm run dev 2. é¡¹ç›®é…ç½®2.1 eslinté…ç½® ä½œç”¨ eslintä¸­æ–‡å®˜ç½‘:http://eslint.cn/ ESLintæœ€åˆæ˜¯ç”±Nicholas C. Zakas äº2013å¹´6æœˆåˆ›å»ºçš„å¼€æºé¡¹ç›®ã€‚å®ƒçš„ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªæ’ä»¶åŒ–çš„javascriptä»£ç æ£€æµ‹å·¥å…· æ­¥éª¤ é¦–å…ˆå®‰è£…eslint pnpm i eslint -D ç”Ÿæˆé…ç½®æ–‡ä»¶:.eslint.cjs npx eslint --init .eslint.cjsé…ç½®æ–‡ä»¶è§£æ module.exports = //è¿è¡Œç¯å¢ƒ env: browser: true,//æµè§ˆå™¨ç«¯ es2021: true,//es2021 , //è§„åˆ™ç»§æ‰¿ extends: [ //å…¨éƒ¨è§„åˆ™é»˜è®¤æ˜¯å…³é—­çš„,è¿™ä¸ªé…ç½®é¡¹å¼€å¯æ¨èè§„åˆ™,æ¨èè§„åˆ™å‚ç…§æ–‡æ¡£ //æ¯”å¦‚:å‡½æ•°ä¸èƒ½é‡åã€å¯¹è±¡ä¸èƒ½å‡ºç°é‡å¤key eslint:recommended, //vue3è¯­æ³•è§„åˆ™ plugin:vue/vue3-essential, //tsè¯­æ³•è§„åˆ™ plugin:@typescript-eslint/recommended ], //è¦ä¸ºç‰¹å®šç±»å‹çš„æ–‡ä»¶æŒ‡å®šå¤„ç†å™¨ overrides: [ ], //æŒ‡å®šè§£æå™¨:è§£æå™¨ //Esprima é»˜è®¤è§£æå™¨ //Babel-ESLint babelè§£æå™¨ //@typescript-eslint/parser tsè§£æå™¨ parser: @typescript-eslint/parser, //æŒ‡å®šè§£æå™¨é€‰é¡¹ parserOptions: ecmaVersion: latest,//æ ¡éªŒECMAæœ€æ–°ç‰ˆæœ¬ sourceType: module//è®¾ç½®ä¸ºscriptï¼ˆé»˜è®¤ï¼‰ï¼Œæˆ–è€…moduleä»£ç åœ¨ECMAScriptæ¨¡å—ä¸­ , //ESLintæ”¯æŒä½¿ç”¨ç¬¬ä¸‰æ–¹æ’ä»¶ã€‚åœ¨ä½¿ç”¨æ’ä»¶ä¹‹å‰ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨npmå®‰è£…å®ƒ //è¯¥eslint-plugin-å‰ç¼€å¯ä»¥ä»æ’ä»¶åç§°è¢«çœç•¥ plugins: [ vue, @typescript-eslint ], //eslintè§„åˆ™ rules: å®‰è£…vue3ç¯å¢ƒä»£ç æ ¡éªŒæ’ä»¶ æ’ä»¶ä½œç”¨ # è®©æ‰€æœ‰ä¸prettierè§„åˆ™å­˜åœ¨å†²çªçš„Eslint ruleså¤±æ•ˆï¼Œå¹¶ä½¿ç”¨prettierè¿›è¡Œä»£ç æ£€æŸ¥eslint-config-prettier,eslint-plugin-import,eslint-plugin-node,# è¿è¡Œæ›´æ¼‚äº®çš„Eslintï¼Œä½¿prettierè§„åˆ™ä¼˜å…ˆçº§æ›´é«˜ï¼ŒEslintä¼˜å…ˆçº§ä½eslint-plugin-prettier,# vue.jsçš„Eslintæ’ä»¶ï¼ˆæŸ¥æ‰¾vueè¯­æ³•é”™è¯¯ï¼Œå‘ç°é”™è¯¯æŒ‡ä»¤ï¼ŒæŸ¥æ‰¾è¿è§„é£æ ¼æŒ‡å—eslint-plugin-vue,# è¯¥è§£æå™¨å…è®¸ä½¿ç”¨Eslintæ ¡éªŒæ‰€æœ‰babel code@babel/eslint-parser, å®‰è£…æŒ‡ä»¤ pnpm install -D eslint-plugin-import eslint-plugin-vue eslint-plugin-node eslint-plugin-prettier eslint-config-prettier eslint-plugin-node @babel/eslint-parser ä¿®æ”¹.eslintrc.cjsé…ç½®æ–‡ä»¶ // @see https://eslint.bootcss.com/docs/rules/module.exports = env: browser: true, es2021: true, node: true, jest: true, , /* æŒ‡å®šå¦‚ä½•è§£æè¯­æ³• */ parser: vue-eslint-parser, /** ä¼˜å…ˆçº§ä½äº parse çš„è¯­æ³•è§£æé…ç½® */ parserOptions: ecmaVersion: latest, sourceType: module, parser: @typescript-eslint/parser, jsxPragma: React, ecmaFeatures: jsx: true, , , /* ç»§æ‰¿å·²æœ‰çš„è§„åˆ™ */ extends: [ eslint:recommended, plugin:vue/vue3-essential, plugin:@typescript-eslint/recommended, plugin:prettier/recommended, ], plugins: [vue, @typescript-eslint], /* * off æˆ– 0 == å…³é—­è§„åˆ™ * warn æˆ– 1 == æ‰“å¼€çš„è§„åˆ™ä½œä¸ºè­¦å‘Šï¼ˆä¸å½±å“ä»£ç æ‰§è¡Œï¼‰ * error æˆ– 2 == è§„åˆ™ä½œä¸ºä¸€ä¸ªé”™è¯¯ï¼ˆä»£ç ä¸èƒ½æ‰§è¡Œï¼Œç•Œé¢æŠ¥é”™ï¼‰ */ rules: // eslintï¼ˆhttps://eslint.bootcss.com/docs/rules/ï¼‰ no-var: error, // è¦æ±‚ä½¿ç”¨ let æˆ– const è€Œä¸æ˜¯ var no-multiple-empty-lines: [warn, max: 1 ], // ä¸å…è®¸å¤šä¸ªç©ºè¡Œ no-console: process.env.NODE_ENV === production ? error : off, no-debugger: process.env.NODE_ENV === production ? error : off, no-unexpected-multiline: error, // ç¦æ­¢ç©ºä½™çš„å¤šè¡Œ no-useless-escape: off, // ç¦æ­¢ä¸å¿…è¦çš„è½¬ä¹‰å­—ç¬¦ // typeScript (https://typescript-eslint.io/rules) @typescript-eslint/no-unused-vars: error, // ç¦æ­¢å®šä¹‰æœªä½¿ç”¨çš„å˜é‡ @typescript-eslint/prefer-ts-expect-error: error, // ç¦æ­¢ä½¿ç”¨ @ts-ignore @typescript-eslint/no-explicit-any: off, // ç¦æ­¢ä½¿ç”¨ any ç±»å‹ @typescript-eslint/no-non-null-assertion: off, @typescript-eslint/no-namespace: off, // ç¦æ­¢ä½¿ç”¨è‡ªå®šä¹‰ TypeScript æ¨¡å—å’Œå‘½åç©ºé—´ã€‚ @typescript-eslint/semi: off, // eslint-plugin-vue (https://eslint.vuejs.org/rules/) vue/multi-word-component-names: off, // è¦æ±‚ç»„ä»¶åç§°å§‹ç»ˆä¸º â€œ-â€ é“¾æ¥çš„å•è¯ vue/script-setup-uses-vars: error, // é˜²æ­¢script setupä½¿ç”¨çš„å˜é‡templateè¢«æ ‡è®°ä¸ºæœªä½¿ç”¨ vue/no-mutating-props: off, // ä¸å…è®¸ç»„ä»¶ propçš„æ”¹å˜ vue/attribute-hyphenation: off, // å¯¹æ¨¡æ¿ä¸­çš„è‡ªå®šä¹‰ç»„ä»¶å¼ºåˆ¶æ‰§è¡Œå±æ€§å‘½åæ ·å¼ , é…ç½®å¿½ç•¥æ–‡ä»¶ æ–°å»º.eslintignoreå¿½ç•¥æ–‡ä»¶æ·»åŠ å¿½ç•¥ distnode_modules ä¿®æ”¹è¿è¡Œè„šæœ¬ scripts: // æ‰§è¡Œ`pnpm run dev`ç›´æ¥æ‰“å¼€æµè§ˆå™¨ dev: vite --open, ... // eslintæ£€æŸ¥srcç›®å½•ä¸‹æºç  lint: eslint src, // eslintä¿®å¤srcç›®å½•ä¸‹æºç  fix: eslint src --fix 2.2 prettieré…ç½® ä½œç”¨ æœ‰äº†eslintï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰prettierï¼Ÿeslinté’ˆå¯¹çš„æ˜¯javascriptï¼Œä»–æ˜¯ä¸€ä¸ªæ£€æµ‹å·¥å…·ï¼ŒåŒ…å«jsè¯­æ³•ä»¥åŠå°‘éƒ¨åˆ†æ ¼å¼é—®é¢˜ï¼Œåœ¨eslintçœ‹æ¥ï¼Œè¯­æ³•å¯¹äº†å°±èƒ½ä¿è¯ä»£ç æ­£å¸¸è¿è¡Œï¼Œæ ¼å¼é—®é¢˜å±äºå…¶æ¬¡ï¼› è€Œprettierå±äºæ ¼å¼åŒ–å·¥å…·ï¼Œå®ƒçœ‹ä¸æƒ¯æ ¼å¼ä¸ç»Ÿä¸€ï¼Œæ‰€ä»¥å®ƒå°±æŠŠeslintæ²¡å¹²å¥½çš„äº‹æ¥ç€å¹²ï¼Œå¦å¤–ï¼Œprettieræ”¯æŒåŒ…å«jsåœ¨å†…çš„å¤šç§è¯­è¨€ã€‚ æ€»ç»“èµ·æ¥ï¼Œeslintå’Œprettierè¿™ä¿©å…„å¼Ÿä¸€ä¸ªä¿è¯jsä»£ç è´¨é‡ï¼Œä¸€ä¸ªä¿è¯ä»£ç ç¾è§‚ã€‚ å®‰è£…ä¾èµ– pnpm install -D eslint-plugin-prettier prettier eslint-config-prettier æ·»åŠ è§„åˆ™ æ–°å»º.prettierrc.jsonæ–‡ä»¶æ·»åŠ è§„åˆ™ singleQuote: true, semi: false, bracketSpacing: true, htmlWhitespaceSensitivity: ignore, endOfLine: auto, trailingComma: all, tabWidth: 2 æ·»åŠ å¿½ç•¥ æ–°å»º.prettierignoreæ–‡ä»¶æ·»åŠ å¿½ç•¥æ–‡ä»¶ /dist/*/html/*.local/node_modules/****/*.svg**/*.sh/public/* ä¿®å¤ä»£ç  é€šè¿‡pnpm run lintå»æ£€æµ‹è¯­æ³•ï¼Œå¦‚æœå‡ºç°ä¸è§„èŒƒæ ¼å¼,é€šè¿‡pnpm run fixä¿®æ”¹ 2.3 stylelinté…ç½® ä½œç”¨ stylelintä¸ºcssçš„lintå·¥å…·ã€‚å¯æ ¼å¼åŒ–cssä»£ç ï¼Œæ£€æŸ¥cssè¯­æ³•é”™è¯¯ä¸ä¸åˆç†çš„å†™æ³•ï¼ŒæŒ‡å®šcssä¹¦å†™é¡ºåºç­‰ã€‚ å®‰è£…ä¾èµ– æœ¬é¡¹ç›®ä¸­ä½¿ç”¨scssä½œä¸ºé¢„å¤„ç†å™¨ï¼Œå®‰è£…ä»¥ä¸‹ä¾èµ– pnpm add sass sass-loader stylelint postcss postcss-scss postcss-html stylelint-config-prettier stylelint-config-recess-order stylelint-config-recommended-scss stylelint-config-standard stylelint-config-standard-vue stylelint-scss stylelint-order stylelint-config-standard-scss -D é…ç½®æ–‡ä»¶ æ–°å»º.stylelintrc.cjsé…ç½®æ–‡ä»¶ å®˜ç½‘:https://stylelint.bootcss.com/ // @see https://stylelint.bootcss.com/module.exports = extends: [ stylelint-config-standard, // é…ç½®stylelintæ‹“å±•æ’ä»¶ stylelint-config-html/vue, // é…ç½® vue ä¸­ template æ ·å¼æ ¼å¼åŒ– stylelint-config-standard-scss, // é…ç½®stylelint scssæ’ä»¶ stylelint-config-recommended-vue/scss, // é…ç½® vue ä¸­ scss æ ·å¼æ ¼å¼åŒ– stylelint-config-recess-order, // é…ç½®stylelint csså±æ€§ä¹¦å†™é¡ºåºæ’ä»¶, stylelint-config-prettier, // é…ç½®stylelintå’Œprettierå…¼å®¹ ], overrides: [ files: [**/*.(scss|css|vue|html)], customSyntax: postcss-scss, , files: [**/*.(html|vue)], customSyntax: postcss-html, , ], ignoreFiles: [ **/*.js, **/*.jsx, **/*.tsx, **/*.ts, **/*.json, **/*.md, **/*.yaml, ], /** * null = å…³é—­è¯¥è§„åˆ™ * always = å¿…é¡» */ rules: value-keyword-case: null, // åœ¨ css ä¸­ä½¿ç”¨ v-bindï¼Œä¸æŠ¥é”™ no-descending-specificity: null, // ç¦æ­¢åœ¨å…·æœ‰è¾ƒé«˜ä¼˜å…ˆçº§çš„é€‰æ‹©å™¨åå‡ºç°è¢«å…¶è¦†ç›–çš„è¾ƒä½ä¼˜å…ˆçº§çš„é€‰æ‹©å™¨ function-url-quotes: always, // è¦æ±‚æˆ–ç¦æ­¢ URL çš„å¼•å· always(å¿…é¡»åŠ ä¸Šå¼•å·)|never(æ²¡æœ‰å¼•å·) no-empty-source: null, // å…³é—­ç¦æ­¢ç©ºæºç  selector-class-pattern: null, // å…³é—­å¼ºåˆ¶é€‰æ‹©å™¨ç±»åçš„æ ¼å¼ property-no-unknown: null, // ç¦æ­¢æœªçŸ¥çš„å±æ€§(true ä¸ºä¸å…è®¸) block-opening-brace-space-before: always, //å¤§æ‹¬å·ä¹‹å‰å¿…é¡»æœ‰ä¸€ä¸ªç©ºæ ¼æˆ–ä¸èƒ½æœ‰ç©ºç™½ç¬¦ value-no-vendor-prefix: null, // å…³é—­ å±æ€§å€¼å‰ç¼€ --webkit-box property-no-vendor-prefix: null, // å…³é—­ å±æ€§å‰ç¼€ -webkit-mask selector-pseudo-class-no-unknown: [ // ä¸å…è®¸æœªçŸ¥çš„é€‰æ‹©å™¨ true, ignorePseudoClasses: [global, v-deep, deep], // å¿½ç•¥å±æ€§ï¼Œä¿®æ”¹elementé»˜è®¤æ ·å¼çš„æ—¶å€™èƒ½ä½¿ç”¨åˆ° , ], , é…ç½®å¿½ç•¥ æ–°å»º.stylelintignoreå¿½ç•¥æ–‡ä»¶ /node_modules/*/dist/*/html/*/public/* æ–°å¢è¿è¡Œè„šæœ¬ scripts: lint:style: stylelint src/**/*.css,scss,vue --cache --fix åŒä¸€é…ç½® æœ€åé…ç½®ç»Ÿä¸€çš„prettieræ¥æ ¼å¼åŒ–æˆ‘ä»¬çš„jså’Œcssï¼Œhtmlä»£ç  scripts: dev: vite --open, build: vue-tsc vite build, preview: vite preview, lint: eslint src, fix: eslint src --fix, format: prettier --write \\./**/*.html,vue,ts,js,json,md\\, lint:eslint: eslint src/**/*.ts,vue --cache --fix, lint:style: stylelint src/**/*.css,scss,vue --cache --fix, å½“æˆ‘ä»¬è¿è¡Œpnpm run formatçš„æ—¶å€™ï¼Œä¼šæŠŠä»£ç ç›´æ¥æ ¼å¼åŒ– 2.4 huskyé…ç½® ä½œç”¨ åœ¨ä¸Šé¢æˆ‘ä»¬å·²ç»é›†æˆå¥½äº†æˆ‘ä»¬ä»£ç æ ¡éªŒå·¥å…·ï¼Œä½†æ˜¯éœ€è¦æ¯æ¬¡æ‰‹åŠ¨çš„å»æ‰§è¡Œå‘½ä»¤æ‰ä¼šæ ¼å¼åŒ–æˆ‘ä»¬çš„ä»£ç ã€‚å¦‚æœæœ‰äººæ²¡æœ‰æ ¼å¼åŒ–å°±æäº¤äº†è¿œç¨‹ä»“åº“ä¸­ï¼Œé‚£è¿™ä¸ªè§„èŒƒå°±æ²¡ä»€ä¹ˆç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼ºåˆ¶è®©å¼€å‘äººå‘˜æŒ‰ç…§ä»£ç è§„èŒƒæ¥æäº¤ã€‚ è¦åšåˆ°è¿™ä»¶äº‹æƒ…ï¼Œå°±éœ€è¦åˆ©ç”¨huskyåœ¨ä»£ç æäº¤ä¹‹å‰è§¦å‘git hook(gitåœ¨å®¢æˆ·ç«¯çš„é’©å­)ï¼Œç„¶åæ‰§è¡Œpnpm run formatæ¥è‡ªåŠ¨çš„æ ¼å¼åŒ–æˆ‘ä»¬çš„ä»£ç ã€‚ å®‰è£… husky pnpm install -D husky åˆå§‹åŒ– npx husky-init ä¼šåœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆä¸ªä¸€ä¸ª.huskyç›®å½•ï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸‹é¢ä¼šæœ‰ä¸€ä¸ªpre-commitæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶é‡Œé¢çš„å‘½ä»¤åœ¨æˆ‘ä»¬æ‰§è¡Œcommitçš„æ—¶å€™å°±ä¼šæ‰§è¡Œ åœ¨.husky/pre-commitæ–‡ä»¶æ·»åŠ å¦‚ä¸‹å‘½ä»¤ #!/usr/bin/env sh. $(dirname -- $0)/_/husky.shpnpm run format å½“æˆ‘ä»¬å¯¹ä»£ç è¿›è¡Œcommitæ“ä½œçš„æ—¶å€™ï¼Œå°±ä¼šæ‰§è¡Œå‘½ä»¤ï¼Œå¯¹ä»£ç è¿›è¡Œæ ¼å¼åŒ–ï¼Œç„¶åå†æäº¤ã€‚ 2.5 commitlinté…ç½® ä½œç”¨ å¯¹äºæˆ‘ä»¬çš„commitä¿¡æ¯ï¼Œä¹Ÿæ˜¯æœ‰ç»Ÿä¸€è§„èŒƒçš„ï¼Œä¸èƒ½éšä¾¿å†™,è¦è®©æ¯ä¸ªäººéƒ½æŒ‰ç…§ç»Ÿä¸€çš„æ ‡å‡†æ¥æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨commitlintæ¥å®ç°ã€‚ å®‰è£…ä¾èµ– pnpm add @commitlint/config-conventional @commitlint/cli -D æ·»åŠ é…ç½® æ–°å»ºcommitlint.config.cjs(æ³¨æ„æ˜¯cjs) module.exports = extends: [@commitlint/config-conventional], // æ ¡éªŒè§„åˆ™ rules: type-enum: [ 2, always, [ feat, fix, docs, style, refactor, perf, test, chore, revert, build, ], ], type-case: [0], type-empty: [0], scope-empty: [0], scope-case: [0], subject-full-stop: [0, never], subject-case: [0, never], header-max-length: [0, always, 72], , åœ¨package.jsonä¸­é…ç½®scriptså‘½ä»¤ # åœ¨scripsä¸­æ·»åŠ ä¸‹é¢çš„ä»£ç scripts: commitlint: commitlint --config commitlint.config.cjs -e -V , é…ç½®ç»“æŸï¼Œç°åœ¨å½“æˆ‘ä»¬å¡«å†™commitä¿¡æ¯çš„æ—¶å€™ï¼Œå‰é¢å°±éœ€è¦å¸¦ç€ä¸‹é¢çš„subject feat,//æ–°ç‰¹æ€§ã€æ–°åŠŸèƒ½fix,//ä¿®æ”¹bugdocs,//æ–‡æ¡£ä¿®æ”¹style,//ä»£ç æ ¼å¼ä¿®æ”¹, æ³¨æ„ä¸æ˜¯ css ä¿®æ”¹refactor,//ä»£ç é‡æ„perf,//ä¼˜åŒ–ç›¸å…³ï¼Œæ¯”å¦‚æå‡æ€§èƒ½ã€ä½“éªŒtest,//æµ‹è¯•ç”¨ä¾‹ä¿®æ”¹chore,//å…¶ä»–ä¿®æ”¹, æ¯”å¦‚æ”¹å˜æ„å»ºæµç¨‹ã€æˆ–è€…å¢åŠ ä¾èµ–åº“ã€å·¥å…·ç­‰revert,//å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬build,//ç¼–è¯‘ç›¸å…³çš„ä¿®æ”¹ï¼Œä¾‹å¦‚å‘å¸ƒç‰ˆæœ¬ã€å¯¹é¡¹ç›®æ„å»ºæˆ–è€…ä¾èµ–çš„æ”¹åŠ¨ é…ç½®husky npx husky add .husky/commit-msg åœ¨ç”Ÿæˆçš„commit-msgæ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢çš„å‘½ä»¤ #!/usr/bin/env sh. $(dirname -- $0)/_/husky.shpnpm commitlint å½“æˆ‘ä»¬ commit æäº¤ä¿¡æ¯æ—¶ï¼Œå°±ä¸èƒ½å†éšæ„å†™äº†ï¼Œå¿…é¡»æ˜¯ git commit -m â€˜fix: xxxâ€™ ç¬¦åˆç±»å‹çš„æ‰å¯ä»¥ éœ€è¦æ³¨æ„çš„æ˜¯ç±»å‹çš„åé¢éœ€è¦ç”¨è‹±æ–‡çš„ :ï¼Œå¹¶ä¸”å†’å·åé¢æ˜¯éœ€è¦ç©ºä¸€æ ¼çš„ï¼Œè¿™ä¸ªæ˜¯ä¸èƒ½çœç•¥çš„ 2.6 å¼ºåˆ¶ä½¿ç”¨pnpmåŒ…ç®¡ç†å™¨å·¥å…· ä½œç”¨ å›¢é˜Ÿå¼€å‘é¡¹ç›®çš„æ—¶å€™ï¼Œéœ€è¦ç»Ÿä¸€åŒ…ç®¡ç†å™¨å·¥å…·,å› ä¸ºä¸åŒåŒ…ç®¡ç†å™¨å·¥å…·ä¸‹è½½åŒä¸€ä¸ªä¾èµ–,å¯èƒ½ç‰ˆæœ¬ä¸ä¸€æ ·,å¯¼è‡´é¡¹ç›®å‡ºç°bugé—®é¢˜,å› æ­¤åŒ…ç®¡ç†å™¨å·¥å…·éœ€è¦ç»Ÿä¸€ç®¡ç†ï¼ï¼ï¼ åˆ›å»ºé…ç½® åœ¨æ ¹ç›®å½•åˆ›å»ºscritps/preinstall.jsæ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢çš„å†…å®¹ if (!/pnpm/.test(process.env.npm_execpath || )) console.warn( `\\u001b[33mThis repository must using pnpm as the package manager ` + ` for scripts to work properly.\\u001b[39m `, ) process.exit(1) é…ç½®å‘½ä»¤ scripts: preinstall: node ./scripts/preinstall.js å½“æˆ‘ä»¬ä½¿ç”¨npmæˆ–è€…yarnæ¥å®‰è£…åŒ…çš„æ—¶å€™ï¼Œå°±ä¼šæŠ¥é”™äº†ã€‚åŸç†å°±æ˜¯åœ¨installçš„æ—¶å€™ä¼šè§¦å‘preinstallï¼ˆnpmæä¾›çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼‰è¿™ä¸ªæ–‡ä»¶é‡Œé¢çš„ä»£ç ã€‚ 3. é¡¹ç›®é›†æˆ3.1 é›†æˆelement-plus å®˜ç½‘ å®˜ç½‘åœ°å€:https://element-plus.gitee.io/zh-CN/ å®‰è£…ä¾èµ– pnpm install element-plus @element-plus/icons-vue é…ç½® å…¥å£æ–‡ä»¶main.tså…¨å±€å®‰è£…element-plus,element-plusé»˜è®¤æ”¯æŒè¯­è¨€è‹±è¯­è®¾ç½®ä¸ºä¸­æ–‡ import createApp from vueimport App from ./App.vueimport ElementPlus from element-plusimport element-plus/dist/index.css//@ts-expect-errorå¿½ç•¥å½“å‰æ–‡ä»¶tsç±»å‹çš„æ£€æµ‹å¦åˆ™æœ‰çº¢è‰²æç¤º(æ‰“åŒ…ä¼šå¤±è´¥)import zhCn from element-plus/dist/locale/zh-cn.mjsconst app = createApp(App)app .use(ElementPlus, locale: zhCn, ) .mount(#app) æŒ‡å®šå…¨å±€ç»„ä»¶ç±»å‹ åœ¨ tsconfig.json ä¸­é€šè¿‡ compilerOptions.type æŒ‡å®šå…¨å±€ç»„ä»¶ç±»å‹ // tsconfig.json compilerOptions: // ... types: [element-plus/global] 3.2 srcåˆ«åçš„é…ç½® é…ç½®vite.config.ts åœ¨å¼€å‘é¡¹ç›®çš„æ—¶å€™æ–‡ä»¶ä¸æ–‡ä»¶å…³ç³»å¯èƒ½å¾ˆå¤æ‚ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç»™srcæ–‡ä»¶å¤¹é…ç½®ä¸€ä¸ªåˆ«åï¼ï¼ï¼ // vite.config.tsimport defineConfig from viteimport vue from @vitejs/plugin-vueimport path from pathexport default defineConfig( plugins: [vue()], resolve: alias: @: path.resolve(./src) // ç›¸å¯¹è·¯å¾„åˆ«åé…ç½®ï¼Œä½¿ç”¨ @ ä»£æ›¿ src ) tsconfig.jsoné…ç½® // tsconfig.json compilerOptions: baseUrl: ./, // è§£æéç›¸å¯¹æ¨¡å—çš„åŸºåœ°å€ï¼Œé»˜è®¤æ˜¯å½“å‰ç›®å½• paths: //è·¯å¾„æ˜ å°„ï¼Œç›¸å¯¹äºbaseUrl @/*: [src/*] 3.3 ç¯å¢ƒå˜é‡é…ç½® ä½œç”¨ é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè‡³å°‘ä¼šç»å†å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒ(å³æ­£å¼ç¯å¢ƒ)ä¸‰ä¸ªé˜¶æ®µã€‚ä¸åŒé˜¶æ®µè¯·æ±‚çš„çŠ¶æ€(å¦‚æ¥å£åœ°å€ç­‰)ä¸å°½ç›¸åŒï¼Œè‹¥æ‰‹åŠ¨åˆ‡æ¢æ¥å£åœ°å€æ˜¯ç›¸å½“ç¹çä¸”æ˜“å‡ºé”™çš„ã€‚äºæ˜¯ç¯å¢ƒå˜é‡é…ç½®çš„éœ€æ±‚å°±åº”è¿è€Œç”Ÿï¼Œæˆ‘ä»¬åªéœ€åšç®€å•çš„é…ç½®ï¼ŒæŠŠç¯å¢ƒçŠ¶æ€åˆ‡æ¢çš„å·¥ä½œäº¤ç»™ä»£ç ã€‚ ç¯å¢ƒ å¼€å‘ç¯å¢ƒï¼ˆdevelopmentï¼‰ é¡¾åæ€ä¹‰ï¼Œå¼€å‘ä½¿ç”¨çš„ç¯å¢ƒï¼Œæ¯ä½å¼€å‘äººå‘˜åœ¨è‡ªå·±çš„devåˆ†æ”¯ä¸Šå¹²æ´»ï¼Œå¼€å‘åˆ°ä¸€å®šç¨‹åº¦ï¼ŒåŒäº‹ä¼šåˆå¹¶ä»£ç ï¼Œè¿›è¡Œè”è°ƒã€‚ æµ‹è¯•ç¯å¢ƒï¼ˆtestingï¼‰ æµ‹è¯•åŒäº‹å¹²æ´»çš„ç¯å¢ƒå•¦ï¼Œä¸€èˆ¬ä¼šç”±æµ‹è¯•åŒäº‹è‡ªå·±æ¥éƒ¨ç½²ï¼Œç„¶ååœ¨æ­¤ç¯å¢ƒè¿›è¡Œæµ‹è¯• ç”Ÿäº§ç¯å¢ƒï¼ˆproductionï¼‰ ç”Ÿäº§ç¯å¢ƒæ˜¯æŒ‡æ­£å¼æä¾›å¯¹å¤–æœåŠ¡çš„ï¼Œä¸€èˆ¬ä¼šå…³æ‰é”™è¯¯æŠ¥å‘Šï¼Œæ‰“å¼€é”™è¯¯æ—¥å¿—ã€‚(æ­£å¼æä¾›ç»™å®¢æˆ·ä½¿ç”¨çš„ç¯å¢ƒ) é…ç½® é¡¹ç›®æ ¹ç›®å½•åˆ†åˆ«æ·»åŠ  å¼€å‘ã€ç”Ÿäº§å’Œæµ‹è¯•ç¯å¢ƒçš„æ–‡ä»¶! .env.development.env.production.env.test æ·»åŠ é…ç½® .env.development # å˜é‡å¿…é¡»ä»¥ VITE_ ä¸ºå‰ç¼€æ‰èƒ½æš´éœ²ç»™å¤–éƒ¨è¯»å–NODE_ENV = developmentVITE_APP_TITLE = åå°å¼€å‘æ¨¡æ¿VITE_APP_BASE_API = /dev-api .env.production NODE_ENV = productionVITE_APP_TITLE = åå°å¼€å‘æ¨¡æ¿VITE_APP_BASE_API = /prod-api .env.test # å˜é‡å¿…é¡»ä»¥ VITE_ ä¸ºå‰ç¼€æ‰èƒ½æš´éœ²ç»™å¤–éƒ¨è¯»å–NODE_ENV = testVITE_APP_TITLE = åå°å¼€å‘æ¨¡æ¿VITE_APP_BASE_API = /test-api é…ç½®è¿è¡Œå‘½ä»¤ï¼špackage.json scripts: build:test: vue-tsc vite build --mode test, build:pro: vue-tsc vite build --mode production , é€šè¿‡import.meta.envè·å–ç¯å¢ƒå˜é‡ template divHello/div/templatescript lang=tsconsole.log(import.meta.env)export default /scriptstyle/style 3.4 SVGå›¾æ ‡é…ç½®3.4.1 å›¾æ ‡é…ç½® ä½œç”¨ åœ¨å¼€å‘é¡¹ç›®çš„æ—¶å€™ç»å¸¸ä¼šç”¨åˆ°svgçŸ¢é‡å›¾,è€Œä¸”æˆ‘ä»¬ä½¿ç”¨SVGä»¥åï¼Œé¡µé¢ä¸ŠåŠ è½½çš„ä¸å†æ˜¯å›¾ç‰‡èµ„æºã€‚ è¿™å¯¹é¡µé¢æ€§èƒ½æ¥è¯´æ˜¯ä¸ªå¾ˆå¤§çš„æå‡ï¼Œè€Œä¸”æˆ‘ä»¬SVGæ–‡ä»¶æ¯”imgè¦å°çš„å¾ˆå¤šï¼Œæ”¾åœ¨é¡¹ç›®ä¸­å‡ ä¹ä¸å ç”¨èµ„æºã€‚ å®‰è£…ä¾èµ– pnpm install vite-plugin-svg-icons -D é…ç½® åœ¨vite.config.tsä¸­é…ç½®æ’ä»¶ import createSvgIconsPlugin from vite-plugin-svg-iconsimport path from pathexport default () = return plugins: [ createSvgIconsPlugin( // Specify the icon folder to be cached iconDirs: [path.resolve(process.cwd(), src/assets/icons)], // Specify symbolId format symbolId: icon-[dir]-[name], ), ], å…¥å£æ–‡ä»¶å¯¼å…¥ // main.tsimport virtual:svg-icons-register 3.4.2 å°è£…ä¸ºå…¨å±€ç»„ä»¶ ä½œç”¨ å› ä¸ºé¡¹ç›®å¾ˆå¤šæ¨¡å—éœ€è¦ä½¿ç”¨å›¾æ ‡,å› æ­¤æŠŠå®ƒå°è£…ä¸ºå…¨å±€ç»„ä»¶ï¼ï¼ï¼ ç¤ºä¾‹ åœ¨srccomponentsç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªSvgIconç»„ä»¶ template div svg :style= width: width, height: height use :xlink:href=prefix + name :fill=color/use /svg /div/templatescript setup lang=tsdefineProps( //xlink:hrefå±æ€§å€¼çš„å‰ç¼€ prefix: type: String, default: #icon-, , //svgçŸ¢é‡å›¾çš„åå­— name: String, //svgå›¾æ ‡çš„é¢œè‰² color: type: String, default: , , //svgå®½åº¦ width: type: String, default: 16px, , //svgé«˜åº¦ height: type: String, default: 16px, ,)/scriptstyle scoped/style æ³¨å†Œå…¨å±€ç»„ä»¶ åœ¨srccomponentsæ–‡ä»¶å¤¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªindex.tsæ–‡ä»¶ï¼šç”¨äºæ³¨å†Œcomponentsæ–‡ä»¶å¤¹å†…éƒ¨å…¨éƒ¨å…¨å±€ç»„ä»¶ï¼ï¼ï¼ // index.tsimport SvgIcon from ./SvgIcon/index.vue;import type App, Component from vue;const components: [name: string]: Component = SvgIcon ;export default install(app: App) Object.keys(components).forEach((key: string) = app.component(key, components[key]); ) å…¥å£æ–‡ä»¶ä½¿ç”¨è‡ªå®šä¹‰æ’ä»¶ import gloablComponent from ./components/index;app.use(gloablComponent); 3.5 é›†æˆsass ä½œç”¨ æˆ‘ä»¬ç›®å‰åœ¨ç»„ä»¶å†…éƒ¨å·²ç»å¯ä»¥ä½¿ç”¨scssæ ·å¼,å› ä¸ºåœ¨é…ç½®styleLintå·¥å…·çš„æ—¶å€™ï¼Œé¡¹ç›®å½“ä¸­å·²ç»å®‰è£…è¿‡sass sass-loader,å› æ­¤æˆ‘ä»¬å†ç»„ä»¶å†…å¯ä»¥ä½¿ç”¨scssè¯­æ³•ï¼ï¼ï¼éœ€è¦åŠ ä¸Šlangâ€scssâ€ style scoped lang=scss/style å…¨å±€æ ·å¼ åœ¨srcstylesç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªindex.scssæ–‡ä»¶ï¼Œå½“ç„¶é¡¹ç›®ä¸­éœ€è¦ç”¨åˆ°æ¸…é™¤é»˜è®¤æ ·å¼ï¼Œå› æ­¤åœ¨index.scsså¼•å…¥reset.scss reset.scss *,*:after,*:before box-sizing: border-box; outline: none;html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video font: inherit; font-size: 100%; margin: 0; padding: 0; vertical-align: baseline; border: 0;article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section display: block;body line-height: 1;ol,ul list-style: none;blockquote,q quotes: none; :before, :after content: ; content: none; sub,sup font-size: 75%; line-height: 0; position: relative; vertical-align: baseline;sup top: -.5em;sub bottom: -.25em;table border-spacing: 0; border-collapse: collapse;input,textarea,button font-family: inhert; font-size: inherit; color: inherit;select text-indent: .01px; text-overflow: ; border: 0; border-radius: 0; -webkit-appearance: none; -moz-appearance: none;select::-ms-expand display: none;code,pre font-family: monospace, monospace; font-size: 1em; index.scss //å¼•å…¥æ¸…é™¤é»˜è®¤æ ·å¼@import ./reset.scss;//æ»šåŠ¨æ¡å¤–è§‚è®¾ç½®::-webkit-scrollbar width: 10px;::-webkit-scrollbar-track background: $base-menu-background;::-webkit-scrollbar-thumb width: 10px; background-color: yellowgreen; border-radius: 10px; å…¥å£æ–‡ä»¶å¼•å…¥ // main.tsimport @/styles ä½†æ˜¯ä½ ä¼šå‘ç°åœ¨srcstylesindex.scsså…¨å±€æ ·å¼æ–‡ä»¶ä¸­æ²¡æœ‰åŠæ³•ä½¿ç”¨$å˜é‡.å› æ­¤éœ€è¦ç»™é¡¹ç›®ä¸­å¼•å…¥å…¨å±€å˜é‡$. åœ¨stylevariable.scssåˆ›å»ºä¸€ä¸ªvariable.scssæ–‡ä»¶ï¼ åœ¨vite.config.tsæ–‡ä»¶é…ç½®å¦‚ä¸‹: export default defineConfig((config) = css: preprocessorOptions: scss: javascriptEnabled: true, additionalData: @import ./src/styles/variable.scss;, , , , @import ./src/styles/variable.less;åé¢çš„;ä¸è¦å¿˜è®°ï¼Œä¸ç„¶ä¼šæŠ¥é”™! é…ç½®å®Œæ¯•ä½ ä¼šå‘ç°scssæä¾›è¿™äº›å…¨å±€å˜é‡å¯ä»¥åœ¨ç»„ä»¶æ ·å¼ä¸­ä½¿ç”¨äº†ï¼ï¼ï¼ 3.6 mockæ•°æ® å®‰è£…ä¾èµ– https://www.npmjs.com/package/vite-plugin-mock pnpm install vite-plugin-mock@2.9.6 -D é…ç½®å¯ç”¨æ’ä»¶ // vite.config.js//mockæ’ä»¶æä¾›æ–¹æ³•import viteMockServe from vite-plugin-mockexport default defineConfig(( command ) = return plugins: [ viteMockServe( localEnabled: command === serve, //ä¿è¯å¼€å‘é˜¶æ®µå¯ä»¥ä½¿ç”¨mockæ¥å£ ), ], ) æµ‹è¯• åœ¨æ ¹ç›®å½•åˆ›å»ºmockæ–‡ä»¶å¤¹:å»åˆ›å»ºæˆ‘ä»¬éœ€è¦mockæ•°æ®ä¸æ¥å£ï¼ï¼ï¼ åœ¨mockæ–‡ä»¶å¤¹å†…éƒ¨åˆ›å»ºä¸€ä¸ªuser.tsæ–‡ä»¶ //createUserList:æ¬¡å‡½æ•°æ‰§è¡Œä¼šè¿”å›ä¸€ä¸ªæ•°ç»„,æ•°ç»„é‡Œé¢åŒ…å«ä¸¤ä¸ªç”¨æˆ·ä¿¡æ¯function createUserList() return [ userId: 1, avatar: https://wpimg.wallstcn.com/f778738c-e4f8-4870-b634-56703b4acafe.gif, username: admin, password: 111111, desc: å¹³å°ç®¡ç†å‘˜, roles: [å¹³å°ç®¡ç†å‘˜], buttons: [cuser.detail], routes: [home], token: Admin Token, , userId: 2, avatar: https://wpimg.wallstcn.com/f778738c-e4f8-4870-b634-56703b4acafe.gif, username: system, password: 111111, desc: ç³»ç»Ÿç®¡ç†å‘˜, roles: [ç³»ç»Ÿç®¡ç†å‘˜], buttons: [cuser.detail, cuser.user], routes: [home], token: System Token, , ]//å¯¹å¤–æš´éœ²ä¸€ä¸ªæ•°ç»„:æ•°ç»„é‡Œé¢åŒ…å«ä¸¤ä¸ªæ¥å£//ç™»å½•å‡çš„æ¥å£//è·å–ç”¨æˆ·ä¿¡æ¯çš„å‡çš„æ¥å£export default [ // ç”¨æˆ·ç™»å½•æ¥å£ url: /api/user/login, //è¯·æ±‚åœ°å€ method: post, //è¯·æ±‚æ–¹å¼ response: ( body ) = //è·å–è¯·æ±‚ä½“æºå¸¦è¿‡æ¥çš„ç”¨æˆ·åä¸å¯†ç  const username, password = body //è°ƒç”¨è·å–ç”¨æˆ·ä¿¡æ¯å‡½æ•°,ç”¨äºåˆ¤æ–­æ˜¯å¦æœ‰æ­¤ç”¨æˆ· const checkUser = createUserList().find( (item) = item.username === username item.password === password, ) //æ²¡æœ‰ç”¨æˆ·è¿”å›å¤±è´¥ä¿¡æ¯ if (!checkUser) return code: 201, data: message: è´¦å·æˆ–è€…å¯†ç ä¸æ­£ç¡® //å¦‚æœæœ‰è¿”å›æˆåŠŸä¿¡æ¯ const token = checkUser return code: 200, data: token , , // è·å–ç”¨æˆ·ä¿¡æ¯ url: /api/user/info, method: get, response: (request) = //è·å–è¯·æ±‚å¤´æºå¸¦token const token = request.headers.token //æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯æ˜¯å¦åŒ…å«æœ‰æ¬¡tokenç”¨æˆ· const checkUser = createUserList().find((item) = item.token === token) //æ²¡æœ‰è¿”å›å¤±è´¥çš„ä¿¡æ¯ if (!checkUser) return code: 201, data: message: è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥ //å¦‚æœæœ‰è¿”å›æˆåŠŸä¿¡æ¯ return code: 200, data: checkUser , ,] å®‰è£…axios pnpm install axios æµ‹è¯• // main.tsimport axios from axiosaxios( url: /api/user/login, method: post, data: username: admin, password: 111111, ,) 3.7 axiosäºŒæ¬¡å°è£… ä½œç”¨ ä½¿ç”¨è¯·æ±‚æ‹¦æˆªå™¨ï¼Œå¯ä»¥åœ¨è¯·æ±‚æ‹¦æˆªå™¨ä¸­å¤„ç†ä¸€äº›ä¸šåŠ¡(å¼€å§‹è¿›åº¦æ¡ã€è¯·æ±‚å¤´æºå¸¦å…¬å…±å‚æ•°) ä½¿ç”¨å“åº”æ‹¦æˆªå™¨ï¼Œå¯ä»¥åœ¨å“åº”æ‹¦æˆªå™¨ä¸­å¤„ç†ä¸€äº›ä¸šåŠ¡(è¿›åº¦æ¡ç»“æŸã€ç®€åŒ–æœåŠ¡å™¨è¿”å›çš„æ•°æ®ã€å¤„ç†httpç½‘ç»œé”™è¯¯) ç¤ºä¾‹ åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºutilsrequest.ts import axios from axiosimport ElMessage from element-plus//åˆ›å»ºaxioså®ä¾‹const request = axios.create( baseURL: import.meta.env.VITE_APP_BASE_API, timeout: 5000,)//è¯·æ±‚æ‹¦æˆªå™¨request.interceptors.request.use((config) = return config)//å“åº”æ‹¦æˆªå™¨request.interceptors.response.use( (response) = return response.data , (error) = //å¤„ç†ç½‘ç»œé”™è¯¯ let msg = const status = error.response.status switch (status) case 401: msg = tokenè¿‡æœŸ break case 403: msg = æ— æƒè®¿é—® break case 404: msg = è¯·æ±‚åœ°å€é”™è¯¯ break case 500: msg = æœåŠ¡å™¨å‡ºç°é—®é¢˜ break default: msg = æ— ç½‘ç»œ ElMessage( type: error, message: msg, ) return Promise.reject(error) ,)export default request 4. è·¯ç”±é…ç½® å®‰è£…ä¾èµ– pnpm i vue-router è·¯ç”±é›å½¢ ä»¥src\\views\\login\\index.vueä¸ºä¾‹ï¼Œåˆ›å»ºè·¯ç”±ç•Œé¢ template divä¸€çº§è·¯ç”±login/div/templatescript setup lang=ts/scriptstyle lang=scss/style åˆ›å»ºè·¯ç”±src\\router\\router.tsæ–‡ä»¶ï¼Œå®šä¹‰è·¯ç”± // å¯¹å¤–æš´éœ²é…ç½®è·¯ç”±(å¸¸é‡è·¯ç”±)export const constantRoute = [ //ç™»å½•è·¯ç”± path: /login, component: () = import(@/views/login/index.vue), name: login, //å‘½åè·¯ç”± , // ç™»å½•æˆåŠŸä»¥åå±•ç¤ºæ•°æ®çš„è·¯ç”± path: /, component: () = import(@/views/home/index.vue), name: layout, , path: /404, component: () = import(@/views/404/index.vue), name: 404, , // é‡å®šå‘ path: /:pathMatch(.*)*, redirect: /404, name: Any, ,] åˆ›å»ºsrc\\router\\index.tsè·¯ç”± // é€šè¿‡vue-routeræ’ä»¶å®ç°æ¨¡æ¿è·¯ç”±é…ç½®import createRouter, createWebHashHistory from vue-routerimport constantRoute from ./router// åˆ›å»ºè·¯ç”±å™¨const router = createRouter( // è·¯ç”±æ¨¡å¼hash history: createWebHashHistory(), routes: constantRoute, // æ»šåŠ¨è¡Œä¸º scrollBehavior() return left: 0, top: 0, ,)export default router åœ¨main.tsä¸­æŒ‚è½½è·¯ç”± // å¯¼å…¥è·¯ç”±ç»„ä»¶import router from ./router// è·å–åº”ç”¨å®ä¾‹å¯¹è±¡const app = createApp(App)// ä½¿ç”¨è·¯ç”±ç»„ä»¶app.use(router) æŒ‡å®šè·¯ç”±å‡ºå£ !-- App.vue --template divrouter-view/router-view/div/templatescript setup lang=ts/scriptstyle/style 5. ç™»å½•æ¨¡å—5.1 ç™»å½•ç•Œé¢ ç¼–å†™ç™»å½•ç•Œé¢ !-- src/views/login/index.vue --template div class=login_container el-row el-col :span=12 :xs=0/el-col el-col :span=12 :xs=24 el-form class=login_form h1Hello/h1 h2æ¬¢è¿æ¥åˆ°XXX/h2 el-form-item el-input :prefix-icon=User v-model=loginForm.username /el-input /el-form-item el-form-item el-input type=password :prefix-icon=Lock v-model=loginForm.password show-password /el-input /el-form-item el-form-item el-button :loading=loadType class=login_btn type=primary size=default @click=login ç™»å½• /el-button /el-form-item /el-form /el-col /el-row /div/templatescript setup lang=tsimport User, Lock from @element-plus/icons-vueimport reactive from vue// ç™»å½•æ•ˆæœlet loadType = ref(false)//æ”¶é›†è´¦å·ä¸å¯†ç æ•°æ®let loginForm = reactive( username: admin, password: 111111 )/scriptstyle lang=scss scoped.login_container width: 100%; height: 100vh; background: url(@/assets/images/background.jpg) no-repeat; background-size: cover; .login_form position: relative; width: 80%; top: 30vh; background: url(@/assets/images/login_form.png) no-repeat; background-size: cover; padding: 40px; h1 color: white; font-size: 40px; h2 color: white; font-size: 20px; margin: 20px 0px; .login_btn width: 100%; /style 5.2 ç¼–å†™è¯·æ±‚ç™»å½•API æ¥å£è¯·æ±‚å‚æ•°åŠè¿”å›ç±»å‹ // ç”¨æˆ·ç™»å½•æ¥å£ url: /dev-api/user/login, //è¯·æ±‚åœ°å€ method: post, //è¯·æ±‚æ–¹å¼ response: ( body ) = //è·å–è¯·æ±‚ä½“æºå¸¦è¿‡æ¥çš„ç”¨æˆ·åä¸å¯†ç  const username, password = body //è°ƒç”¨è·å–ç”¨æˆ·ä¿¡æ¯å‡½æ•°,ç”¨äºåˆ¤æ–­æ˜¯å¦æœ‰æ­¤ç”¨æˆ· const checkUser = createUserList().find( (item) = item.username === username item.password === password, ) //æ²¡æœ‰ç”¨æˆ·è¿”å›å¤±è´¥ä¿¡æ¯ if (!checkUser) return code: 201, data: message: è´¦å·æˆ–è€…å¯†ç ä¸æ­£ç¡® //å¦‚æœæœ‰è¿”å›æˆåŠŸä¿¡æ¯ const token = checkUser return code: 200, data: token ,, // ç™»å½•æ¥å£è¿”å›æ•°æ®ç±»å‹ userId: 1, avatar: https://wpimg.wallstcn.com/f778738c-e4f8-4870-b634-56703b4acafe.gif, username: admin, password: 111111, desc: å¹³å°ç®¡ç†å‘˜, roles: [å¹³å°ç®¡ç†å‘˜], buttons: [cuser.detail], routes: [home], token: Admin Token,, æ ¹æ®ç™»å½•æ¥å£ç¼–å†™æ•°æ®ç±»å‹type // src/api/user/type.ts// ç™»å½•æ¥å£éœ€è¦æºå¸¦å‚æ•°tsç±»å‹export interface loginForm username: string password: string// ? å¯é€‰å‚æ•°export interface dataType token?: string message?: string// ç™»å½•æ¥å£è¿”å›æ•°æ®ç±»å‹export interface loginResponseData code: number data: dataType ç¼–å†™ç™»å½•æ¥å£ // src/api/user/index.ts// åŒä¸€ç®¡ç†ç”¨æˆ·ç›¸å…³çš„æ¥å£import request from @/utils/requestimport loginForm, loginResponseData from ./type// ç»Ÿä¸€ç®¡ç†APIenum API LOGIN_URL = /user/login,// æš´éœ²è¯·æ±‚å‡½æ•°// ç™»å½•æ¥å£export const reqLogin = (data: loginForm) = request.postany, loginResponseData(API.LOGIN_URL, data) 5.3 ç”¨æˆ·æ•°æ®å­˜å‚¨pinia å®‰è£…ä¾èµ– pnpm i pinia@2.0.34 åˆ›å»ºpiniaä»“åº“ // src/store/index.ts//ä»“åº“å¤§ä»“åº“import createPinia from pinia//åˆ›å»ºå¤§ä»“åº“const pinia = createPinia()//å¯¹å¤–æš´éœ²ï¼šå…¥å£æ–‡ä»¶éœ€è¦å®‰è£…ä»“åº“export default pinia æŒ‚è½½pinia // main.ts// å¯¼å…¥piniaimport pinia from ./storeapp.use(pinia) åˆ›å»ºUserStateæ•°æ®ç±»å‹ // src/store/modules/type/type.tsexport interface UserState token: string | null tokenç›¸å…³å·¥å…·æ–¹æ³• // src/utils/token.ts// å°è£…æœ¬åœ°å­˜å‚¨å’Œè¯»å–æ•°æ®çš„æ–¹æ³•export const SET_TOKEN = (token: string) = localStorage.setItem(TOKEN, token)export const GET_TOKEN = (): string | null = return localStorage.getItem(TOKEN) åˆ›å»ºç”¨æˆ·ç›¸å…³ä»“åº“ // src/store/modules/user.ts// åˆ›å»ºç”¨æˆ·ç›¸å…³çš„å°ä»“åº“import defineStore from piniaimport loginForm, loginResponseData from @/api/user/typeimport reqLogin from @/api/userimport GET_TOKEN, SET_TOKEN from @/utils/tokenimport UserState from ./type/type// åˆ›å»ºç”¨æˆ·å°ä»“åº“const useUserStore = defineStore(User, // ç”¨æˆ·ä»“åº“å­˜å‚¨æ•°æ®åœ°æ–¹ state(): UserState return token: GET_TOKEN(), , // å¤„ç†å¼‚æ­¥|é€»è¾‘åœ°æ–¹ actions: async userLogin(data: loginForm) const result: loginResponseData = await reqLogin(data) console.log(result) if (result.code === 200) this.token = result.data.token as string //localStorage.setItem(TOKEN, this.token) SET_TOKEN(this.token) return OK else return Promise.reject(new Error(result.data.message)) , , getters: ,)// å¯¹å¤–æš´éœ²å°ä»“åº“export default useUserStore 5.4 ç™»å½•æŒ‰é’®ç‚¹å‡»äº‹ä»¶ ç™»å½• !-- src/views/login/index.vue --script setup lang=tsimport User, Lock from @element-plus/icons-vueimport reactive, ref from vueimport useUserStore from @/store/modules/userimport useRouter from vue-routerimport ElNotification from element-plus// ç™»å½•æ•ˆæœlet loadType = ref(false)//æ”¶é›†è´¦å·ä¸å¯†ç æ•°æ®let loginForm = reactive( username: admin, password: 111111 )const router = useRouter()let userStore = useUserStore()// ç™»å½•const login = async () = loadType.value = true try await userStore.userLogin(loginForm) router.push(/) ElNotification( type: success, message: ç™»å½•æˆåŠŸ, ) loadType.value = false catch (error) loadType.value = false ElNotification( type: error, message: (error as Error).message, ) /script 5.5 ç™»å½•æç¤º éœ€æ±‚ ä¿®æ”¹ç™»å½•æç¤º æä¾›æ—¶é—´å‡½æ•° // src/utils/time.tsexport const getTime = () = let message = const hours = new Date().getHours() if (hours = 9) message = æ—©ä¸Š else if (hours = 12) message = ä¸Šåˆ else if (hours = 18) message = ä¸‹åˆ else message = æ™šä¸Š return message ä¿®æ”¹æç¤º // ç™»å½•const login = async () = loadType.value = true try await userStore.userLogin(loginForm) router.push(/) ElNotification( type: success, message: æ¬¢è¿å›æ¥, // ä¿®æ”¹æç¤º title: `HI,$getTime()å¥½`, ) loadType.value = false catch (error) loadType.value = false ElNotification( type: error, message: (error as Error).message, ) 5.6 ç™»å½•è¡¨å•æ ¡éªŒ ç»‘å®šè¡¨å• https://element-plus.org/zh-CN/component/form.html#%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8C el-form class=login_form !-- è¡¨å•è§„åˆ™ -- :rules=rules !-- è¡¨å•æ•°æ® -- :model=loginForm !-- é€šè¿‡refè·å–è¡¨å•ç»„ä»¶ -- ref=loginFormRef å®šä¹‰è§„åˆ™ //å®šä¹‰è¡¨å•æ ¡éªŒéœ€è¦çš„é…ç½®å¯¹è±¡const rules = username: [ //è§„åˆ™å¯¹è±¡å±æ€§: required: true, // required,ä»£è¡¨è¿™ä¸ªå­—æ®µåŠ¡å¿…è¦æ ¡éªŒçš„ min: 5, //min:æ–‡æœ¬é•¿åº¦è‡³å°‘å¤šå°‘ä½ max: 10, // max:æ–‡æœ¬é•¿åº¦æœ€å¤šå¤šå°‘ä½ message: é•¿åº¦åº”ä¸º6-10ä½, // message:é”™è¯¯çš„æç¤ºä¿¡æ¯ trigger: change, //trigger:è§¦å‘æ ¡éªŒè¡¨å•çš„æ—¶æœº change-æ–‡æœ¬å‘ç”Ÿå˜åŒ–è§¦å‘æ ¡éªŒ, blur:å¤±å»ç„¦ç‚¹çš„æ—¶å€™è§¦å‘æ ¡éªŒè§„åˆ™ , ], password: [ required: true, min: 6, max: 10, message: é•¿åº¦åº”ä¸º6-15ä½, trigger: change, , ],// è·å–è¡¨å•ç»„ä»¶const loginFormRef = ref() æ‰§è¡Œæ ¡éªŒ // ç™»å½•const login = async () = //ä¿è¯å…¨éƒ¨è¡¨å•é¡¹æ ¡éªŒé€šè¿‡ await loginFormRef.value.validate() ... 5.7 è‡ªå®šä¹‰æ ¡éªŒ è‡ªå®šä¹‰è§„åˆ™ æœ‰æ—¶å€™é»˜è®¤çš„æ ¡éªŒè§„åˆ™ä¸æ»¡è¶³æ ¡éªŒè¦æ±‚ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥è‡ªå®šä¹‰æ ¡éªŒè§„åˆ™å‡½æ•° //è‡ªå®šä¹‰æ ¡éªŒè§„åˆ™å‡½æ•°const validatorUserName = (_rule: any, value: any, callback: any) = //ruleï¼šæ ¡éªŒè§„åˆ™å¯¹è±¡ //value:è¡¨å•å…ƒç´ æ–‡æœ¬å†…å®¹ //callback:ç¬¦åˆæ¡ä»¶ï¼Œcallbackæ”¾è¡Œé€šè¿‡ï¼Œä¸ç¬¦åˆï¼šæ³¨å…¥é”™è¯¯æç¤ºä¿¡æ¯ if (value.length = 5) callback() else callback(new Error(è´¦å·é•¿åº¦è‡³å°‘5ä½)) const validatorPassword = (_rule: any, value: any, callback: any) = if (value.length = 6) callback() else callback(new Error(å¯†ç é•¿åº¦è‡³å°‘6ä½)) æ·»åŠ è§„åˆ™ //å®šä¹‰è¡¨å•æ ¡éªŒéœ€è¦çš„é…ç½®å¯¹è±¡const rules = username: [ validator: validatorUserName, trigger: change , ], password: [ validator: validatorPassword, trigger: change , ], 6. Layoutæ¨¡å—6.1 ä¸»ç•Œé¢ ä¸»ç•Œé¢ !-- src/layout/index.vue --template div class=layout_container !-- å·¦ä¾§èœå• -- div class=layout_slider/div !-- é¡¶éƒ¨å¯¼èˆª -- div class=layout_tabbar/div !-- å†…å®¹å±•ç¤ºåŒºåŸŸ -- div class=layout_main p style=height: 1000000px/p /div /div/templatescript setup lang=ts/scriptstyle lang=scss scoped.layout_container width: 100%; height: 100vh; .layout_slider width: $base-menu-width; height: 100vh; background: $base-menu-background; .layout_tabbar position: fixed; width: calc(100% - $base-menu-width); height: $base-tabbar-height; background: cyan; top: 0; left: $base-menu-width; .layout_main position: absolute; width: calc(100% - $base-menu-width); height: calc(100vh - $base-tabbar-height); background-color: yellowgreen; left: $base-menu-width; top: $base-tabbar-height; padding: 20px; overflow: auto; /style å®šä¹‰å…¨å±€å˜é‡ // scr/styles/variable.scss// é¡¹ç›®æä¾›scsså…¨å±€å˜é‡//å·¦ä¾§çš„èœå•çš„å®½åº¦$base-menu-width:260px;//å·¦ä¾§èœå•çš„èƒŒæ™¯é¢œè‰²$base-menu-background:#001529;$base-menu-min-width:50px;// é¡¶éƒ¨å¯¼èˆªçš„é«˜åº¦$base-tabbar-height:50px; å®šä¹‰æ»šåŠ¨æ¡æ ·å¼ // scr/styles/index.scss//å¼•å…¥æ¸…é™¤é»˜è®¤æ ·å¼@import ./reset.scss;//æ»šåŠ¨æ¡å¤–è§‚è®¾ç½®::-webkit-scrollbar width: 10px;::-webkit-scrollbar-thumb width: 10px; background-color: yellowgreen; border-radius: 10px; 6.2 å°è£…LOGO åˆ›å»ºlogoç»„ä»¶ !-- src/layout/logo/index.vue --template div class=logo img src=../../../../public/logo.png alt= / pxxxåå°ç®¡ç†/p /div/templatescript setup lang=ts/scriptstyle lang=scss scoped.logo width: 100%; height: $base-menu-logo-height; color: white; display: flex; align-items: center; padding: 20px; img width: 40px; height: 40px; p font-size: $base-logo-title-fontSize; margin-left: 10px; /style æ·»åŠ logoå…¨å±€å˜é‡ // scr/styles/variable.scss//å·¦ä¾§èœå•logoé«˜åº¦è®¾ç½®$base-menu-logo-height:50px;//å·¦ä¾§èœå•logoå³ä¾§æ–‡å­—å¤§å°$base-logo-title-fontSize:20px; å¼•å…¥logoç»„ä»¶ template div class=layout_container !-- å·¦ä¾§èœå• -- div class=layout_slider !-- å¼•å…¥logo -- Logo/Logo /div !-- é¡¶éƒ¨å¯¼èˆª -- div class=layout_tabbar/div !-- å†…å®¹å±•ç¤ºåŒºåŸŸ -- div class=layout_main p style=height: 1000000px/p /div /div/templatescript setup lang=tsimport Logo from @/views/layout/logo/index.vue/script æŠ½å–é…ç½® ä¸ºäº†æ–¹ä¾¿ä»¥åå¯¹logoä»¥åŠæ ‡é¢˜çš„ä¿®æ”¹ï¼Œå¯ä»¥å°†logoå†…å®¹æŠ½å–åˆ°é…ç½®æ–‡ä»¶ä¸­ // src/setting.ts//ç”¨äºé¡¹ç›®logo|æ ‡é¢˜é…ç½®export default title: ç¡…è°·ç”„é€‰è¿è¥å¹³å°, //é¡¹ç›®çš„æ ‡é¢˜ logo: /public/logo.png, //é¡¹ç›®logoè®¾ç½® logoHidden: true, //logoç»„ä»¶æ˜¯å¦éšè— ä¿®æ”¹logoç»„ä»¶ template div class=logo v-if=!setting.logoHidden img :src=setting.logo alt= / p setting.title /p /div/templatescript setup lang=tsimport setting from @/setting/script 6.3 å·¦ä¾§é™æ€èœå•ç»„ä»¶ å·¦ä¾§æ»šåŠ¨æ¡ https://element-plus.org/zh-CN/component/scrollbar.html template div class=layout_container !-- å·¦ä¾§èœå• -- div class=layout_slider !-- logo -- Logo/Logo !-- æ»šåŠ¨ç»„ä»¶ -- el-scrollbar class=scrollbar p v-for=item in 2000 :key=item class=scrollbar-demo-item item /p /el-scrollbar /div !-- é¡¶éƒ¨å¯¼èˆª -- div class=layout_tabbar/div !-- å†…å®¹å±•ç¤ºåŒºåŸŸ -- div class=layout_main p style=height: 1000000px/p /div /div/templatestyle lang=scss scoped.layout_container width: 100%; height: 100vh; // è®¾ç½®å­—ä½“é¢œè‰² color: white; .layout_slider width: $base-menu-width; height: 100vh; background: $base-menu-background; // è®¾ç½®æ»šåŠ¨æ¡æ ·å¼ .scrollbar width: 100%; height: calc(100vh - $base-menu-logo-height); // æ¶ˆé™¤æ»šåŠ¨border .el-menu border-right: 0; .layout_tabbar position: fixed; width: calc(100% - $base-menu-width); height: $base-tabbar-height; background: cyan; top: 0; left: $base-menu-width; .layout_main position: absolute; width: calc(100% - $base-menu-width); height: calc(100vh - $base-tabbar-height); background-color: yellowgreen; left: $base-menu-width; top: $base-tabbar-height; padding: 20px; overflow: auto; /style èœå•ç»„ä»¶ https://element-plus.org/zh-CN/component/menu.html template div class=layout_container !-- å·¦ä¾§èœå• -- div class=layout_slider !-- logo -- Logo/Logo !-- æ»šåŠ¨ç»„ä»¶ -- el-scrollbar !-- èœå•ç»„ä»¶ -- el-menu background-color=#001529 text-color=white el-menu-item index=1é¦–é¡µ/el-menu-item el-menu-item index=2æ•°æ®å¤§å±/el-menu-item !-- æŠ˜å èœå• -- el-sub-menu index=3 template #title spanæƒé™ç®¡ç†/span /template el-menu-item index=3-1ç”¨æˆ·ç®¡ç†/el-menu-item el-menu-item index=3-2è§’è‰²ç®¡ç†/el-menu-item el-menu-item index=3-3èœå•ç®¡ç†/el-menu-item /el-sub-menu /el-menu /el-scrollbar /div !-- é¡¶éƒ¨å¯¼èˆª -- div class=layout_tabbar/div !-- å†…å®¹å±•ç¤ºåŒºåŸŸ -- div class=layout_main p style=height: 1000000px/p /div /div/template 6.4 åŠ¨æ€èœå•ç»„ä»¶ å°è£…ç»„ä»¶ src\\layout\\menu\\index.vue template !-- èœå•ç»„ä»¶ -- el-menu background-color=#001529 text-color=white el-menu-item index=1é¦–é¡µ/el-menu-item el-menu-item index=2æ•°æ®å¤§å±/el-menu-item !-- æŠ˜å èœå• -- el-sub-menu index=3 template #title spanæƒé™ç®¡ç†/span /template el-menu-item index=3-1ç”¨æˆ·ç®¡ç†/el-menu-item el-menu-item index=3-2è§’è‰²ç®¡ç†/el-menu-item el-menu-item index=3-3èœå•ç®¡ç†/el-menu-item /el-sub-menu /el-menu/templatescript setup lang=ts/scriptstyle lang=scss scoped/style src\\layout\\index.vue template div class=layout_container !-- å·¦ä¾§èœå• -- div class=layout_slider !-- logo -- Logo/Logo !-- æ»šåŠ¨ç»„ä»¶ -- el-scrollbar class=scrollbar Menu/Menu /el-scrollbar /div !-- é¡¶éƒ¨å¯¼èˆª -- div class=layout_tabbar/div !-- å†…å®¹å±•ç¤ºåŒºåŸŸ -- div class=layout_main p style=height: 1000000px/p /div /div/templatescript setup lang=tsimport Logo from ./logo/index.vueimport Menu from ./menu/index.vue/script è·¯ç”±ä¿¡æ¯å­˜å…¥pinia å®šä¹‰è·¯ç”±ç±»å‹ src\\store\\modules\\type\\type.ts import RouteRecordRaw from vue-routerexport interface UserState token: string | null menuRoutes: RouteRecordRaw[] // è·¯ç”±ç±»å‹ è·¯ç”±ä¿¡æ¯å­˜å…¥state import constantRoute from @/router/router// åˆ›å»ºç”¨æˆ·ä»“åº“const useUserStore = defineStore(User, // ç”¨æˆ·ä»“åº“å­˜å‚¨æ•°æ®åœ°æ–¹ state(): UserState return token: GET_TOKEN(), menuRoutes: constantRoute, , ...) è·¯ç”±æ·»åŠ metaä¿¡æ¯ src\\router\\router.ts // å¯¹å¤–æš´éœ²é…ç½®è·¯ç”±(å¸¸é‡è·¯ç”±)export const constantRoute = [ //ç™»å½• path: /login, component: () = import(@/views/login/index.vue), name: login, meta: title: ç™»å½•, //èœå•æ ‡é¢˜ , , //ç™»å½•æˆåŠŸä»¥åå±•ç¤ºæ•°æ®çš„è·¯ç”± path: /, component: () = import(@/layout/index.vue), name: layout, meta: title: layout, , redirect: /home, children: [ path: /home, component: () = import(@/views/home/index.vue), meta: title: é¦–é¡µ, , , path: /home2, component: () = import(@/views/home/index.vue), meta: title: é¦–é¡µ2, , , ], , //404 path: /404, component: () = import(@/views/404/index.vue), name: 404, meta: title: 404, , ,] çˆ¶ç»„ä»¶è·å–è·¯ç”±ä¿¡æ¯å¹¶ä¼ é€’ç»™å­ç»„ä»¶ src\\layout\\index.vue template div class=layout_container !-- å·¦ä¾§èœå• -- div class=layout_slider !-- logo -- Logo/Logo !-- æ»šåŠ¨ç»„ä»¶ -- el-scrollbar class=scrollbar el-menu background-color=#001529 text-color=white // ä¼ é€’è·¯ç”±æ•°æ® Menu :menuList=userStore.menuRoutes/Menu /el-menu /el-scrollbar /div !-- é¡¶éƒ¨å¯¼èˆª -- div class=layout_tabbar/div !-- å†…å®¹å±•ç¤ºåŒºåŸŸ -- div class=layout_main p style=height: 1000000px/p /div /div/templatescript setup lang=tsimport Logo from ./logo/index.vueimport Menu from ./menu/index.vueimport useUserStore from @/store/modules/user// è·å–ç”¨æˆ·ä»“åº“const userStore = useUserStore()/script å­ç»„ä»¶æ ¹æ®è·¯ç”±æ•°æ®åŠ¨æ€åˆ›å»ºèœå• src\\layout\\menu\\index.vue template template v-for=item in menuList :key=item.path !-- æ²¡æœ‰å­è·¯ç”± -- el-menu-item v-if=!item.children :index=item.path template #title spanæ ‡/span span item.meta.title /span /template /el-menu-item !-- æœ‰å­è·¯ç”±ä½†åªæœ‰ä¸€ä¸ªå­è·¯ç”± -- el-menu-item v-if=item.children item.children.length === 1 :index=item.children[0].path template #title spanæ ‡/span span item.children[0].meta.title /span /template /el-menu-item !-- æœ‰å­è·¯ç”±ä¸”ä¸ªæ•°å¤§äºä¸€ä¸ª -- el-sub-menu :index=item.path v-if=item.children item.children.length = 2 template #title span item.meta.title /span /template !-- é€’å½’åˆ›å»ºèœå• -- Menu :menuList=item.children/Menu /el-sub-menu /template/templatescript setup lang=ts//è·å–çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„å…¨éƒ¨è·¯ç”±æ•°ç»„defineProps([menuList])/scriptscript lang=tsexport default // eslint-disable-next-line vue/no-reserved-component-names name: Menu,/scriptstyle lang=scss scoped/style æ³¨æ„ï¼šå½“å­è·¯ç”±ä¸ªæ•°å¤§äºç­‰äºä¸€ä¸ªæ—¶ï¼Œå¹¶ä¸”æˆ–è®¸å­è·¯ç”±è¿˜æœ‰åä»£è·¯ç”±æ—¶ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†é€’å½’ç»„ä»¶ã€‚é€’å½’ç»„ä»¶éœ€è¦å‘½åï¼ˆå¦å¤–ä½¿ç”¨ä¸€ä¸ªscriptæ ‡ç­¾ï¼Œvue2æ ¼å¼ï¼‰ã€‚ èœå•éšè— æ·»åŠ metaä¿¡æ¯ src\\router\\router.ts // å¯¹å¤–æš´éœ²é…ç½®è·¯ç”±(å¸¸é‡è·¯ç”±)export const constantRoute = [ //ç™»å½• path: /login, component: () = import(@/views/login/index.vue), name: login, meta: title: ç™»å½•, //èœå•æ ‡é¢˜ hidden: true, //ä»£è¡¨è·¯ç”±æ ‡é¢˜åœ¨èœå•ä¸­æ˜¯å¦éšè— true:éšè— false:ä¸éšè— , , //ç™»å½•æˆåŠŸä»¥åå±•ç¤ºæ•°æ®çš„è·¯ç”± path: /, component: () = import(@/layout/index.vue), name: layout, meta: title: layout, hidden: false, , redirect: /home, children: [ path: /home, component: () = import(@/views/home/index.vue), meta: title: é¦–é¡µ, hidden: false, , , path: /home2, component: () = import(@/views/home/index.vue), meta: title: é¦–é¡µ2, hidden: false, icon: HomeFilled, , , ], , //404 path: /404, component: () = import(@/views/404/index.vue), name: 404, meta: title: 404, hidden: true, , ,] ä¸ºæ–¹ä¾¿åˆ¤æ–­ä¿®æ”¹menuç»„ä»¶ src\\layout\\menu\\index.vue template template v-for=item in menuList :key=item.path !-- æ²¡æœ‰å­è·¯ç”± -- template v-if=!item.children el-menu-item v-if=!item.meta.hidden :index=item.path template #title spanæ ‡/span span item.meta.title /span /template /el-menu-item /template !-- æœ‰å­è·¯ç”±ä½†åªæœ‰ä¸€ä¸ªå­è·¯ç”± -- template v-if=item.children item.children.length === 1 el-menu-item v-if=!item.children[0].meta.hidden :index=item.children[0].path template #title spanæ ‡/span span item.children[0].meta.title /span /template /el-menu-item /template !-- æœ‰å­è·¯ç”±ä¸”ä¸ªæ•°å¤§äºä¸€ä¸ª -- el-sub-menu v-if=item.children item.children.length = 2 :index=item.path template #title span item.meta.title /span /template !-- é€’å½’åˆ›å»ºèœå• -- Menu :menuList=item.children/Menu /el-sub-menu /template/templatescript setup lang=ts//è·å–çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„å…¨éƒ¨è·¯ç”±æ•°ç»„defineProps([menuList])/scriptscript lang=tsexport default // eslint-disable-next-line vue/no-reserved-component-names name: Menu,/scriptstyle lang=scss scoped/style æ·»åŠ èœå•å›¾æ ‡ æ³¨å†Œå›¾æ ‡ç»„ä»¶ src\\components\\index.ts import SvgIcon from ./SvgIcon/index.vueimport type App, Component from vue//å¼•å…¥element-plusæä¾›å…¨éƒ¨å›¾æ ‡ç»„ä»¶import * as ElementPlusIconsVue from @element-plus/icons-vueconst components: [name: string]: Component = SvgIcon //å¯¹å¤–æš´éœ²æ’ä»¶å¯¹è±¡export default //åŠ¡å¿…å«åšinstallæ–¹æ³• install(app: App) //æ³¨å†Œé¡¹ç›®å…¨éƒ¨çš„å…¨å±€ç»„ä»¶ Object.keys(components).forEach((key) = //æ³¨å†Œä¸ºå…¨å±€ç»„ä»¶ app.component(key, components[key]) ) //å°†element-plusæä¾›å…¨éƒ¨å›¾æ ‡æ³¨å†Œä¸ºå…¨å±€ç»„ä»¶ for (const [key, component] of Object.entries(ElementPlusIconsVue)) app.component(key, component) , æ·»åŠ metaä¿¡æ¯ https://element-plus.org/zh-CN/component/icon.html src\\router\\router.ts // å¯¹å¤–æš´éœ²é…ç½®è·¯ç”±(å¸¸é‡è·¯ç”±)export const constantRoute = [ //ç™»å½• path: /login, component: () = import(@/views/login/index.vue), name: login, meta: title: ç™»å½•, //èœå•æ ‡é¢˜ hidden: false, //ä»£è¡¨è·¯ç”±æ ‡é¢˜åœ¨èœå•ä¸­æ˜¯å¦éšè— true:éšè— false:ä¸éšè— icon: Promotion, //èœå•æ–‡å­—å·¦ä¾§çš„å›¾æ ‡,æ”¯æŒelement-pluså…¨éƒ¨å›¾æ ‡ , , //ç™»å½•æˆåŠŸä»¥åå±•ç¤ºæ•°æ®çš„è·¯ç”± path: /, component: () = import(@/layout/index.vue), name: layout, meta: title: , hidden: false, icon: , , redirect: /home, children: [ path: /home, component: () = import(@/views/home/index.vue), meta: title: é¦–é¡µ, hidden: false, icon: HomeFilled, , , ], , //404 path: /404, component: () = import(@/views/404/index.vue), name: 404, meta: title: 404, hidden: false, icon: DocumentDelete, , ,] ä¿®æ”¹menuç»„ä»¶ src\\layout\\menu\\index.vue template template v-for=item in menuList :key=item.path !--æ²¡æœ‰å­è·¯ç”±-- template v-if=!item.children el-menu-item :index=item.path v-if=!item.meta.hidden !-- å›¾æ ‡ -- el-icon component :is=item.meta.icon/component /el-icon template #title span item.meta.title /span /template /el-menu-item /template !-- æœ‰å­è·¯ç”±ä½†æ˜¯åªæœ‰ä¸€ä¸ªå­è·¯ç”± -- template v-if=item.children item.children.length == 1 el-menu-item :index=item.children[0].path v-if=!item.children[0].meta.hidden !-- å›¾æ ‡ -- el-icon component :is=item.children[0].meta.icon/component /el-icon template #title span item.children[0].meta.title /span /template /el-menu-item /template !-- æœ‰å­è·¯ç”±ä¸”ä¸ªæ•°å¤§äºä¸€ä¸ª1 -- el-sub-menu :index=item.path v-if=item.children item.children.length 1 template #title !-- å›¾æ ‡ -- el-icon component :is=item.meta.icon/component /el-icon span item.meta.title /span /template Menu :menuList=item.children/Menu /el-sub-menu /template/templatescript setup lang=ts//è·å–çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„å…¨éƒ¨è·¯ç”±æ•°ç»„defineProps([menuList])/scriptscript lang=tsexport default // eslint-disable-next-line vue/no-reserved-component-names name: Menu,/scriptstyle lang=scss scoped/style è·¯ç”±è·³è½¬ ç‚¹å‡»èœå•æ—¶éœ€è¦è·³è½¬è‡³å¯¹åº”è·¯ç”±ç•Œé¢ï¼Œ@click=goRoute(item.path) template template v-for=item in menuList :key=item.path !--æ²¡æœ‰å­è·¯ç”±-- template v-if=!item.children el-menu-item :index=item.path v-if=!item.meta.hidden @click=goRoute(item.path) el-icon !-- å›¾æ ‡ -- component :is=item.meta.icon/component /el-icon template #title span item.meta.title /span /template /el-menu-item /template !-- æœ‰å­è·¯ç”±ä½†æ˜¯åªæœ‰ä¸€ä¸ªå­è·¯ç”± -- template v-if=item.children item.children.length == 1 el-menu-item :index=item.children[0].path v-if=!item.children[0].meta.hidden @click=goRoute(item.children[0].path) el-icon component :is=item.children[0].meta.icon/component /el-icon template #title span item.children[0].meta.title /span /template /el-menu-item /template !-- æœ‰å­è·¯ç”±ä¸”ä¸ªæ•°å¤§äºä¸€ä¸ª1 -- el-sub-menu :index=item.path v-if=item.children item.children.length 1 template #title el-icon component :is=item.meta.icon/component /el-icon span item.meta.title /span /template Menu :menuList=item.children/Menu /el-sub-menu /template/templatescript setup lang=tsimport useRouter from vue-router// è·å–çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„å…¨éƒ¨è·¯ç”±æ•°ç»„defineProps([menuList])const route = useRouter()// æ ¹æ®è·¯ç”±è·¯å¾„è·³è½¬const goRoute = (path: string) = route.push(path)/scriptscript lang=tsexport default // eslint-disable-next-line vue/no-reserved-component-names name: Menu,/scriptstyle lang=scss scoped/style 6.5 å°è£…Mainç»„ä»¶ å°è£…å†…å®¹å±•ç¤ºåŒºåŸŸç»„ä»¶ï¼Œæ·»åŠ è·¯ç”±è·³è½¬åŠ¨ç”» https://router.vuejs.org/zh/guide/advanced/transitions.html src\\layout\\main\\index.vue template !-- è·¯ç”±ç»„ä»¶å‡ºå£çš„ä½ç½® -- router-view v-slot= Component transition name=fade !-- æ¸²æŸ“layoutä¸€çº§è·¯ç”±çš„å­è·¯ç”± -- component :is=Component / /transition /router-view/templatescript setup lang=ts/scriptstyle lang=scss scoped.fade-enter-from opacity: 0;.fade-enter-active transition: all 0.3s;.fade-enter-to opacity: 1;/style ä¿®æ”¹layout src\\layout\\index.vue template div class=layout_container !-- å·¦ä¾§èœå• -- div class=layout_slider !-- logo -- Logo/Logo !-- æ»šåŠ¨ç»„ä»¶ -- el-scrollbar class=scrollbar el-menu background-color=#001529 text-color=white Menu :menuList=userStore.menuRoutes/Menu /el-menu /el-scrollbar /div !-- é¡¶éƒ¨å¯¼èˆª -- div class=layout_tabbar/div !-- å†…å®¹å±•ç¤ºåŒºåŸŸ -- div class=layout_main Main/Main /div /div/template 6.6 é…ç½®å…¨è·¯ç”± é…ç½®è·¯ç”± src\\router\\router.ts // å¯¹å¤–æš´éœ²é…ç½®è·¯ç”±(å¸¸é‡è·¯ç”±)export const constantRoute = [ //ç™»å½• path: /login, component: () = import(@/views/login/index.vue), name: login, meta: title: ç™»å½•, //èœå•æ ‡é¢˜ hidden: true, //ä»£è¡¨è·¯ç”±æ ‡é¢˜åœ¨èœå•ä¸­æ˜¯å¦éšè— true:éšè— false:ä¸éšè— icon: Promotion, //èœå•æ–‡å­—å·¦ä¾§çš„å›¾æ ‡,æ”¯æŒelement-pluså…¨éƒ¨å›¾æ ‡ , , //ç™»å½•æˆåŠŸä»¥åå±•ç¤ºæ•°æ®çš„è·¯ç”± path: /, component: () = import(@/layout/index.vue), name: layout, meta: title: , hidden: false, icon: , , redirect: /home, children: [ path: /home, component: () = import(@/views/home/index.vue), meta: title: é¦–é¡µ, hidden: false, icon: HomeFilled, , , ], , //404 path: /404, component: () = import(@/views/404/index.vue), name: 404, meta: title: 404, hidden: true, icon: DocumentDelete, , , path: /acl, component: () = import(@/layout/index.vue), name: Acl, meta: hidden: false, title: æƒé™ç®¡ç†, icon: Lock, , children: [ path: /acl/user, component: () = import(@/views/acl/user/index.vue), name: User, meta: hidden: false, title: ç”¨æˆ·ç®¡ç†, icon: User, , , path: /acl/role, component: () = import(@/views/acl/role/index.vue), name: Role, meta: hidden: false, title: è§’è‰²ç®¡ç†, icon: UserFilled, , , path: /acl/permission, component: () = import(@/views/acl/permission/index.vue), name: Permission, meta: hidden: false, title: èœå•ç®¡ç†, icon: Monitor, , , ], ,] åˆ›å»ºç›¸åº”ç»„ä»¶ 6.7 èœå•åˆ·æ–°å±•ç¤º é—®é¢˜ å½“é¡µé¢åˆ·æ–°æ—¶ï¼Œèœå•ä¼šè‡ªåŠ¨æ”¶èµ·ã€‚ä½¿ç”¨element-plusçš„default-active å¤„ç† å¤„ç† https://element-plus.org/zh-CN/component/menu.html#menu-attributes template div class=layout_container !-- å·¦ä¾§èœå• -- div class=layout_slider !-- logo -- Logo/Logo !-- æ»šåŠ¨ç»„ä»¶ -- el-scrollbar class=scrollbar el-menu background-color=#001529 text-color=white :default-active=route.path Menu :menuList=userStore.menuRoutes/Menu /el-menu /el-scrollbar /div !-- é¡¶éƒ¨å¯¼èˆª -- div class=layout_tabbar/div !-- å†…å®¹å±•ç¤ºåŒºåŸŸ -- div class=layout_main Main/Main /div /div/templatescript setup lang=tsimport Logo from ./logo/index.vueimport Menu from ./menu/index.vueimport useUserStore from @/store/modules/userimport Main from ./main/index.vueimport useRoute from vue-routerconst userStore = useUserStore()// è·å–è·¯ç”±const route = useRoute()/script 6.8 é¡¶éƒ¨tabbarç»„ä»¶ æ·»åŠ é™æ€ç•Œé¢ https://element-plus.org/zh-CN/component/breadcrumb.html https://element-plus.org/zh-CN/component/dropdown.html src\\layout\\tabbar\\index.vue template div class=tabbar div class=tabbar_left !-- é¡¶éƒ¨å·¦ä¾§çš„å›¾æ ‡ -- el-icon style=margin-right: 10px Expand/Expand /el-icon !-- å·¦ä¾§çš„é¢åŒ…å±‘ -- el-breadcrumb separator-icon=ArrowRight el-breadcrumb-itemæƒé™ç®¡ç†/el-breadcrumb-item el-breadcrumb-itemç”¨æˆ·ç®¡ç†/el-breadcrumb-item /el-breadcrumb /div div class=tabbar_right el-button size=small icon=Refresh circle/el-button el-button size=small icon=FullScreen circle/el-button el-button size=small icon=Setting circle/el-button img src=../../../public/logo.png style=width: 24px; height: 24px; margin: 0px 10px / !-- ä¸‹æ‹‰èœå• -- el-dropdown span class=el-dropdown-link admin el-icon class=el-icon--right arrow-down / /el-icon /span template #dropdown el-dropdown-menu el-dropdown-itemé€€å‡ºç™»é™†/el-dropdown-item /el-dropdown-menu /template /el-dropdown /div /div/templatescript setup lang=ts/scriptstyle lang=scss scoped.tabbar width: 100%; height: 100%; display: flex; justify-content: space-between; background-image: linear-gradient( to right, rgb(236, 229, 229), rgb(151, 136, 136), rgb(240, 234, 234) ); .tabbar_left display: flex; align-items: center; margin-left: 20px; .tabbar_right display: flex; align-items: center; /style æ‹†åˆ†ç»„ä»¶ src\\layout\\tabbar\\breadcrumb\\index.vue template !-- é¡¶éƒ¨å·¦ä¾§çš„å›¾æ ‡ -- el-icon style=margin-right: 10px Expand/Expand /el-icon !-- å·¦ä¾§çš„é¢åŒ…å±‘ -- el-breadcrumb separator-icon=ArrowRight el-breadcrumb-itemæƒé™æŒ‚å†/el-breadcrumb-item el-breadcrumb-itemç”¨æˆ·ç®¡ç†/el-breadcrumb-item /el-breadcrumb/templatescript setup lang=ts/scriptstyle lang=scss scoped/style src\\layout\\tabbar\\setting\\index.vue template el-button size=small icon=Refresh circle/el-button el-button size=small icon=FullScreen circle/el-button el-button size=small icon=Setting circle/el-button img src=../../../../public/logo.png style=width: 24px; height: 24px; margin: 0px 10px / !-- ä¸‹æ‹‰èœå• -- el-dropdown span class=el-dropdown-link admin el-icon class=el-icon--right arrow-down / /el-icon /span template #dropdown el-dropdown-menu el-dropdown-itemé€€å‡ºç™»é™†/el-dropdown-item /el-dropdown-menu /template /el-dropdown/templatescript setup lang=ts/scriptstyle lang=scss scoped/style src\\layout\\tabbar\\index.vue template div class=tabbar div class=tabbar_left Breadcrumb/Breadcrumb /div div class=tabbar_right Setting/Setting /div /div /template script setup lang=ts import Breadcrumb from ./breadcrumb/index.vue import Setting from ./setting/index.vue /script### 6.9 èœå•æŠ˜å 1. ä¿®æ”¹æŠ˜å å›¾æ ‡ æ·»åŠ ç‚¹å‡»äº‹ä»¶æ ¹æ®æŠ˜å çŠ¶æ€åˆ¤æ–­ï¼Œå±•ç¤ºä¸åŒå›¾æ ‡ https://cn.vuejs.org/guide/essentials/component-basics.html#dynamic-components `src\\layout\\tabbar\\breadcrumb\\index.vue` ```html template !-- é¡¶éƒ¨å·¦ä¾§çš„å›¾æ ‡ -- el-icon style=margin-right: 10px @click=changeIcon !-- åŠ¨æ€åˆ‡æ¢å›¾æ ‡ -- component :is=settingStore.fold ? Fold : Expand/component /el-icon !-- å·¦ä¾§çš„é¢åŒ…å±‘ -- el-breadcrumb separator-icon=ArrowRight el-breadcrumb-itemæƒé™ç®¡ç†/el-breadcrumb-item el-breadcrumb-itemç”¨æˆ·ç®¡ç†/el-breadcrumb-item /el-breadcrumb /template script setup lang=ts import useSettingStore from @/store/modules/setting //è·å–layouté…ç½®ç›¸å…³çš„ä»“åº“ let settingStore = useSettingStore() const changeIcon = () = console.log(settingStore.fold) settingStore.fold = !settingStore.fold /script style lang=scss scoped/style å› ä¸ºæ•´ä¸ªå·¦ä¾§æ ã€é¡¶éƒ¨tabbaræ å’Œmainç•Œé¢éƒ½å—åˆ°æŠ˜å æ•ˆæœå½±å“ï¼Œæ‰€ä»¥å°†æŠ˜å çŠ¶æ€å­˜å…¥pinia æ–°å»ºsettingä»“åº“ src\\store\\modules\\setting.ts //å°ä»“åº“ï¼šlayoutç»„ä»¶ç›¸å…³é…ç½®ä»“åº“import defineStore from piniaconst useSettingStore = defineStore(SettingStore, state: () = return fold: false, //ç”¨æˆ·æ§åˆ¶èœå•æŠ˜å è¿˜æ˜¯æ”¶èµ·çš„æ§åˆ¶ ,)export default useSettingStore è”åŠ¨æ›´æ–°å·¦ä¾§èœå•æ  ç‚¹å‡»æŠ˜å æ—¶ï¼ŒåŠ¨æ€ä¿®æ”¹å·¦ä¾§èœå•æ å®½åº¦ã€‚ æ·»åŠ å…¨å±€å±æ€§ src\\styles\\variable.scss //å·¦ä¾§èœå•æœ€å°å®½åº¦$base-menu-min-width:50px; ç»‘å®šåŠ¨æ€å±æ€§ src\\layout\\index.vue template div class=layout_container !-- å·¦ä¾§èœå• -- div class=layout_slider :class= fold: settingStore.fold ? true : false /div /div/templatescript setup lang=tsimport useSettingStore from @/store/modules/settingconst settingStore = useSettingStore()/scriptstyle lang=scss scoped.layout_container width: 100%; height: 100vh; color: white; .layout_slider width: $base-menu-width; height: 100vh; background: $base-menu-background; transition: all 0.1s; // æ·»åŠ å·¦ä¾§èœå•æœ€å°å®½åº¦ .fold width: $base-menu-min-width; .scrollbar width: 100%; height: calc(100vh - $base-menu-logo-height); .el-menu border-right: 0; /style å·¦ä¾§èœå•æ ä¿®æ”¹æŠ˜å çŠ¶æ€ï¼šcollapse https://element-plus.org/zh-CN/component/menu.html#menu-attributes src\\layout\\index.vue template div class=layout_container !-- å·¦ä¾§èœå• -- div class=layout_slider :class= fold: settingStore.fold ? true : false !-- logo -- Logo/Logo !-- æ»šåŠ¨ç»„ä»¶ -- el-scrollbar class=scrollbar el-menu background-color=#001529 text-color=white :default-active=route.path :collapse=settingStore.fold Menu :menuList=userStore.menuRoutes/Menu /el-menu /el-scrollbar /div /div/template è”åŠ¨æ›´æ–°tabbar template div class=layout_container !-- é¡¶éƒ¨å¯¼èˆª -- div class=layout_tabbar :class= fold: settingStore.fold ? true : false Tabbar/Tabbar /div /div/templatescript setup lang=tsimport useSettingStore from @/store/modules/setting const settingStore = useSettingStore()/scriptstyle lang=scss scoped .layout_tabbar position: fixed; width: calc(100% - $base-menu-width); height: $base-tabbar-height; background: cyan; top: 0; left: $base-menu-width; transition: all 0.1s; .fold // å®½åº¦ = ç•Œé¢å®½åº¦ - æŠ˜å åèœå•æ æ‰€å å®½åº¦ width: calc(100vw - $base-menu-min-width); // è·ç¦»æŠ˜å åèœå•æ å®½åº¦ left: $base-menu-min-width; /style è”åŠ¨æ›´æ–°main template div class=layout_container !-- å†…å®¹å±•ç¤ºåŒºåŸŸ -- div class=layout_main :class= fold: settingStore.fold ? true : false Main/Main /div /div/templatescript setup lang=tsimport useSettingStore from @/store/modules/settingconst settingStore = useSettingStore()/scriptstyle lang=scss scoped .layout_main position: absolute; width: calc(100% - $base-menu-width); height: calc(100vh - $base-tabbar-height); background-color: yellowgreen; left: $base-menu-width; top: $base-tabbar-height; padding: 20px; overflow: auto; transition: all 0.1s; .fold width: calc(100vw - $base-menu-min-width); left: $base-menu-min-width; /style 6.10 åŠ¨æ€æ›´æ–°é¢åŒ…å±‘ è·å–è·¯ç”± ä½¿ç”¨route.matchedå‡½æ•°ï¼Œæ­¤å‡½æ•°èƒ½å¾—åˆ°å½“å‰è·¯ç”±çš„ä¿¡æ¯ ä¿®æ”¹ç•Œé¢ src\\layout\\tabbar\\breadcrumb\\index.vue template !-- å·¦ä¾§çš„é¢åŒ…å±‘ -- el-breadcrumb separator-icon=ArrowRight el-breadcrumb-item v-for=(item, index) in route.matched :key=index v-show=item.meta.title :to=item.path item.meta.title /el-breadcrumb-item /el-breadcrumb/templatescript setup lang=tsimport useSettingStore from @/store/modules/settingimport useRoute from vue-router// è·å–layouté…ç½®ç›¸å…³çš„ä»“åº“let settingStore = useSettingStore()// è·¯ç”±const route = useRoute()const changeIcon = () = console.log(settingStore.fold) settingStore.fold = !settingStore.fold/scriptstyle lang=scss scoped/style v-showæ§åˆ¶æ— æ ‡é¢˜æ—¶ä¸æ˜¾ç¤º è®¾ç½®ç‚¹å‡»æƒé™ç®¡ç†æ—¶è‡ªåŠ¨è·³è½¬åˆ°ç”¨æˆ·ç®¡ç† src\\router\\router.ts path: /acl, component: () = import(@/layout/index.vue), name: Acl, meta: hidden: false, title: æƒé™ç®¡ç†, icon: Lock, , redirect: /acl/user, 6.11 åˆ·æ–°åŠŸèƒ½å®ç° åœ¨settingä»“åº“æ·»åŠ refreshå±æ€§ src\\store\\modules\\setting.ts //å°ä»“åº“ï¼šlayoutç»„ä»¶ç›¸å…³é…ç½®ä»“åº“import defineStore from piniaconst useSettingStore = defineStore(SettingStore, state: () = return fold: false, //ç”¨æˆ·æ§åˆ¶èœå•æŠ˜å è¿˜æ˜¯æ”¶èµ·çš„æ§åˆ¶ refresh: false, //ç”¨äºæ§åˆ¶åˆ·æ–°æ•ˆæœ ,)export default useSettingStore åœ¨setting.vueç»„ä»¶ä¸­é…ç½®åˆ·æ–°æŒ‰é’®ç‚¹å‡»äº‹ä»¶ src\\layout\\tabbar\\setting\\index.vue template el-button size=small icon=Refresh circle @click=updateRefresh /el-button/templatescript setup lang=tsimport useSettingStore from @/store/modules/settingconst settingStore = useSettingStore()const updateRefresh = () = settingStore.refresh = !settingStore.refresh/scriptstyle lang=scss scoped/style åœ¨mainç»„ä»¶ä¸­ç›‘å¬æŒ‰é’®çŠ¶æ€å€¼ï¼ŒçŠ¶æ€å€¼å˜åŒ–å°±é‡å»ºè·¯ç”±ç»„ä»¶ src\\layout\\main\\index.vue template !-- è·¯ç”±ç»„ä»¶å‡ºå£çš„ä½ç½® -- router-view v-slot= Component transition name=fade div v-if=flag !-- æ¸²æŸ“layoutä¸€çº§è·¯ç”±çš„å­è·¯ç”± -- component :is=Component / /div /transition /router-view/templatescript setup lang=tsimport ref, watch, nextTick from vueimport useSettingStore from @/store/modules/settingconst settingStore = useSettingStore()//æ§åˆ¶å½“å‰ç»„ä»¶æ˜¯å¦é”€æ¯é‡å»ºlet flag = ref(true)//ç›‘å¬ä»“åº“å†…éƒ¨çš„æ•°æ®æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœå‘ç”Ÿå˜åŒ–ï¼Œè¯´æ˜ç”¨æˆ·ç‚¹å‡»è¿‡åˆ·æ–°æŒ‰é’®watch( () = settingStore.refresh, () = //ç‚¹å‡»åˆ·æ–°æŒ‰é’®ï¼šè·¯ç”±ç»„ä»¶é”€æ¯ flag.value = false // å¼‚æ­¥åˆ·æ–°ï¼Œvueé‡å»ºDOMåä¼šè°ƒç”¨è¯¥æ–¹æ³• // https://lianyutian.github.io/posts/dd58b23f.html 9.5ç« èŠ‚ nextTick(() = flag.value = true ) ,)/script 6.12 å…¨å±åŠŸèƒ½å®ç° ç»‘å®šå…¨å±æŒ‰é’®ç‚¹å‡»äº‹ä»¶ src\\layout\\tabbar\\setting\\index.vue template el-button size=small icon=FullScreen circle @click=fullScreen /el-buttonscript setup lang=ts// å…¨å±åŠŸèƒ½const fullScreen = () = // DOMå¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼šå¯ä»¥ç”¨æ¥åˆ¤æ–­å½“å‰æ˜¯ä¸æ˜¯å…¨å±çš„æ¨¡å¼ã€å…¨å±ï¼štrueï¼Œä¸æ˜¯å…¨å±ï¼šfalseã€‘ let full = document.fullscreenElement // åˆ‡æ¢æˆå…¨å± if (!full) // æ–‡æ¡£æ ¹èŠ‚ç‚¹çš„æ–¹æ³•requestFullscreenå®ç°å…¨å± document.documentElement.requestFullscreen() else // é€€å‡ºå…¨å± document.exitFullscreen() /scriptstyle lang=scss scoped/style 7. ç™»å½•ä¸šåŠ¡å®Œå–„7.1 è·å–ç”¨æˆ·ä¿¡æ¯ æ·»åŠ ç”¨æˆ·stateå­˜å‚¨ç±»å‹å’Œå±æ€§ src\\store\\modules\\type\\type.ts import RouteRecordRaw from vue-routerexport interface UserState token: string | null menuRoutes: RouteRecordRaw[] username: string avatar: string src\\store\\modules\\user.ts // åˆ›å»ºç”¨æˆ·å°ä»“åº“const useUserStore = defineStore(UserStore, // ç”¨æˆ·ä»“åº“å­˜å‚¨æ•°æ®åœ°æ–¹ state(): UserState return token: GET_TOKEN(), menuRoutes: constantRoute, username: , avatar: , // ç”¨æˆ·å¤´åƒ , æ·»åŠ è·å–ä¿¡æ¯æ–¹æ³• userInfoAction src\\store\\modules\\user.ts // src/store/modules/user.ts// åˆ›å»ºç”¨æˆ·ç›¸å…³çš„ä»“åº“import defineStore from piniaimport loginForm, loginResponseData from @/api/user/typeimport reqLogin, reqUserInfo from @/api/userimport GET_TOKEN, SET_TOKEN from @/utils/tokenimport UserState from ./type/typeimport constantRoute from @/router/router// åˆ›å»ºç”¨æˆ·å°ä»“åº“const useUserStore = defineStore(UserStore, // ç”¨æˆ·ä»“åº“å­˜å‚¨æ•°æ®åœ°æ–¹ state(): UserState return token: GET_TOKEN(), menuRoutes: constantRoute, username: , avatar: , , // å¤„ç†å¼‚æ­¥|é€»è¾‘åœ°æ–¹ actions: // è·å–ç”¨æˆ·ä¿¡æ¯ async userInfoAction() const result = await reqUserInfo() if (result.code === 200) this.username = result.data.checkUser.username this.avatar = result.data.checkUser.avatar console.log(result) , , getters: ,)// å¯¹å¤–æš´éœ²å°ä»“åº“export default useUserStore ä¿®æ”¹è¯·æ±‚æºå¸¦tokenä¿¡æ¯ æ­¤å‰è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæœªæºå¸¦tokenä¼šè·å–ä¸åˆ°ç”¨æˆ·ä¿¡æ¯ src\\utils\\request.ts import axios from axiosimport ElMessage from element-plusimport useUserStore from @/store/modules/user//åˆ›å»ºaxioså®ä¾‹const request = axios.create( baseURL: import.meta.env.VITE_APP_BASE_API, timeout: 5000,)//è¯·æ±‚æ‹¦æˆªå™¨request.interceptors.request.use((config) = //è·å–ç”¨æˆ·ç›¸å…³çš„å°ä»“åº“ï¼Œè·å–tokenï¼Œç™»å½•æˆåŠŸä»¥åæºå¸¦ä¸ªiæœåŠ¡å™¨ const userStore = useUserStore() if (userStore.token) config.headers.token = userStore.token //configé…ç½®å¯¹è±¡ï¼Œheadersè¯·æ±‚å¤´ï¼Œç»å¸¸ç»™æœåŠ¡å™¨ç«¯æºå¸¦å…¬å…±å‚æ•° //è¿”å›é…ç½®å¯¹è±¡ return config) homeç»„ä»¶æŒ‚è½½è·å–ç”¨æˆ·ä¿¡æ¯ ç™»å½•ä¹‹åé¡µé¢ï¼ˆhomeï¼‰ä¸Šæ¥å°±è¦è·å–ç”¨æˆ·ä¿¡æ¯ã€‚å¹¶ä¸”å°†å®ƒä½¿ç”¨åˆ°é¡µé¢ä¸­ src\\views\\home\\index.vue template divä¸€çº§è·¯ç”±home/div/templatescript setup lang=tsimport onMounted from vueimport useUserStore from @/store/modules/userconst userStore = useUserStore()onMounted(() = userStore.userInfoAction())/script ä¿®æ”¹è®¾ç½®ç»„ä»¶ä¸­çš„ç”¨æˆ·ä¿¡æ¯ src\\layout\\tabbar\\setting\\index.vue template img :src=userStore.avatar style=width: 24px; height: 24px; margin: 0px 10px / !-- ä¸‹æ‹‰èœå• -- el-dropdown span class=el-dropdown-link userStore.username el-icon class=el-icon--right arrow-down / /el-icon /span template #dropdown el-dropdown-menu el-dropdown-itemé€€å‡ºç™»é™†/el-dropdown-item /el-dropdown-menu /template /el-dropdown/templatescript setup lang=tsimport useSettingStore from @/store/modules/settingimport useUserStore from @/store/modules/userimport useStore from element-plus/es/components/table/src/store/index.mjsconst userStore = useUserStore()/script 7.2 é€€å‡ºç™»å½• ç»‘å®šé€€å‡ºç™»å½•æŒ‰é’®ç‚¹å‡»äº‹ä»¶ src\\layout\\tabbar\\setting\\index.vue template !-- ä¸‹æ‹‰èœå• -- el-dropdown template #dropdown el-dropdown-menu el-dropdown-item @click=logouté€€å‡ºç™»é™†/el-dropdown-item /el-dropdown-menu /template /el-dropdown/templatescript setup lang=tsimport useSettingStore from @/store/modules/settingimport useUserStore from @/store/modules/userimport useRouter, useRoute from vue-routerconst userStore = useUserStore()// é€€å‡ºç™»å½•const router = useRouter()const route = useRoute()const logout = () = //ç¬¬ä¸€ä»¶äº‹ï¼šéœ€è¦é¡¹æœåŠ¡å™¨å‘è¯·æ±‚ã€é€€å‡ºç™»å½•æ¥å£ã€‘ï¼ˆæˆ‘ä»¬è¿™é‡Œæ²¡æœ‰ï¼‰ //ç¬¬äºŒä»¶äº‹ï¼šä»“åº“å½“ä¸­å’Œå…³äºç”¨æˆ·çš„ç›¸å…³çš„æ•°æ®æ¸…ç©º userStore.userLogoutAction() //ç¬¬ä¸‰ä»¶äº‹ï¼šè·³è½¬åˆ°ç™»é™†é¡µé¢ router.push( path: /login, query: redirect: route.path )/script æºå¸¦çš„queryå‚æ•°æ–¹ä¾¿ä¸‹æ¬¡ç™»é™†æ—¶ç›´æ¥è·³è½¬åˆ°å½“æ—¶æ¨å‡ºçš„ç•Œé¢ æ¸…ç©ºç”¨æˆ·ä¿¡æ¯ src\\store\\modules\\user.ts // src/store/modules/user.ts// åˆ›å»ºç”¨æˆ·ç›¸å…³çš„ä»“åº“import defineStore from piniaimport loginForm, loginResponseData from @/api/user/typeimport reqLogin, reqUserInfo from @/api/userimport GET_TOKEN, SET_TOKEN, REMOVE_TOKEN from @/utils/tokenimport UserState from ./type/typeimport constantRoute from @/router/router// åˆ›å»ºç”¨æˆ·å°ä»“åº“const useUserStore = defineStore(UserStore, // ç”¨æˆ·ä»“åº“å­˜å‚¨æ•°æ®åœ°æ–¹ state(): UserState return token: GET_TOKEN(), menuRoutes: constantRoute, username: , avatar: , // ç”¨æˆ·å¤´åƒ , // å¤„ç†å¼‚æ­¥|é€»è¾‘åœ°æ–¹ actions: // é€€å‡ºç™»å½• userLogoutAction() //å½“å‰æ²¡æœ‰mockæ¥å£ï¼ˆä¸åšï¼‰ï¼šæœåŠ¡å™¨æ•°æ®tokenå¤±æ•ˆ //æœ¬åœ°æ•°æ®æ¸…ç©º this.token = this.username = this.avatar = REMOVE_TOKEN() , , getters: ,)// å¯¹å¤–æš´éœ²å°ä»“åº“export default useUserStore æ·»åŠ æ¸…é™¤tokenæ–¹æ³• src\\utils\\token.ts export const REMOVE_TOKEN = () = localStorage.removeItem(TOKEN) ç™»å½•æ—¶åˆ¤æ–­æ˜¯å¦æœ‰queryå‚æ•° src\\views\\login\\index.vue script setup lang=tsconst router = useRouter()const route = useRoute()let userStore = useUserStore()// ç™»å½•const login = async () = //ä¿è¯å…¨éƒ¨è¡¨å•é¡¹æ ¡éªŒé€šè¿‡ await loginFormRef.value.validate() loadType.value = true try await userStore.userLoginAction(loginForm) //ç¼–ç¨‹å¼å¯¼èˆªè·³è½¬åˆ°å±•ç¤ºæ•°æ®é¦–é¡µ //åˆ¤æ–­ç™»å½•çš„æ—¶å€™,è·¯ç”±è·¯å¾„å½“ä¸­æ˜¯å¦æœ‰queryå‚æ•°ï¼Œå¦‚æœæœ‰å°±å¾€queryå‚æ•°æŒ‘æˆ˜ï¼Œæ²¡æœ‰è·³è½¬åˆ°é¦–é¡µ let redirect: any = route.query.redirect router.push( path: redirect || / ) ElNotification( type: success, message: æ¬¢è¿å›æ¥, title: `HI,$getTime()å¥½`, ) loadType.value = false catch (error) loadType.value = false ElNotification( type: error, message: (error as Error).message, ) /script æ­¤æ—¶ä¸åœ¨é¦–é¡µç•Œé¢é€€å‡ºç™»å½•ä¼šæœ‰ç™»å½•åå†ç™»å½•è·å–ä¸åˆ°ç”¨æˆ·ä¿¡æ¯çš„bugï¼Œåé¢ä¿®å¤ 7.4 è·¯ç”±é‰´æƒ å®‰è£…è¿›åº¦æ¡ç»„ä»¶ pnpm i nprogress æ–°å»ºpermisstion.ts src\\permisstion.ts //è·¯ç”±é‰´æƒï¼šé‰´æƒï¼šé¡¹ç›®å½“ä¸­è·¯ç”±èƒ½ä¸èƒ½è¢«è®¿é—®çš„æƒé™import router from @/routerimport setting from ./settingimport nprogress from nprogress//å¼•å…¥è¿›åº¦æ¡æ ·å¼import nprogress/nprogress.css//è¿›åº¦æ¡çš„åŠ è½½åœ†åœˆä¸è¦nprogress.configure( showSpinner: false )//è·å–ç”¨æˆ·ç›¸å…³çš„å°ä»“åº“å†…éƒ¨tokenæ•°æ®ï¼Œå»åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»é™†æˆåŠŸimport useUserStore from @/store/modules/user//ä¸ºä»€ä¹ˆè¦å¼•piniaimport pinia from ./storeconst userStore = useUserStore(pinia)//å…¨å±€å‰ç½®å®ˆå«router.beforeEach(async (to: any, from: any, next: any) = //ç½‘é¡µçš„åå­— document.title = `$setting.title-$to.meta.title` //è®¿é—®æŸä¸€ä¸ªè·¯ç”±ä¹‹å‰çš„å®ˆå« nprogress.start() //è·å–tokenï¼Œå»åˆ¤æ–­ç”¨æˆ·ç™»å½•ã€è¿˜æ˜¯æœªç™»å½• const token = userStore.token //è·å–ç”¨æˆ·åå­— const username = userStore.username //ç”¨æˆ·ç™»å½•åˆ¤æ–­ if (token) //ç™»é™†æˆåŠŸï¼Œè®¿é—®loginã€‚æŒ‡å‘é¦–é¡µ if (to.path == /login) next(/home) else //ç™»é™†æˆåŠŸè®¿é—®å…¶ä½™çš„ï¼Œæ”¾è¡Œ //æœ‰ç”¨æˆ·ä¿¡æ¯ if (username) //æ”¾è¡Œ next() else //å¦‚æœæ²¡æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œåœ¨æ”¶å°¾è¿™é‡Œå‘è¯·æ±‚è·å–åˆ°äº†ç”¨æˆ·ä¿¡æ¯å†æ”¾è¡Œ try //è·å–ç”¨æˆ·ä¿¡æ¯ await userStore.userInfoAction() next() catch (error) //tokenè¿‡æœŸ|ç”¨æˆ·æ‰‹åŠ¨å¤„ç†token //é€€å‡ºç™»é™†-ç”¨æˆ·ç›¸å…³çš„æ•°æ®æ¸…ç©º userStore.userLogoutAction() next( path: /login, query: redirect: to.path ) else //ç”¨æˆ·æœªç™»å½• if (to.path == /login) next() else next( path: /login, query: redirect: to.path ) next())//å…¨å±€åç½®å®ˆå«router.afterEach((to: any, from: any) = // to and from are both route objects. nprogress.done())//ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šä»»æ„è·¯ç”±åˆ‡æ¢å®ç°è¿›åº¦æ¡ä¸šåŠ¡ ----nprogress//ç¬¬äºŒä¸ªé—®é¢˜ï¼šè·¯ç”±é‰´æƒ//å…¨éƒ¨è·¯ç”±ç»„ä»¶ ï¼šç™»å½•|404|ä»»æ„è·¯ç”±|é¦–é¡µ|æƒé™ç®¡ç†ï¼ˆä¸‰ä¸ªå­è·¯ç”±ï¼‰|//ç”¨æˆ·æœªç™»å½• ï¼šå¯ä»¥è®¿é—®login å…¶ä½™éƒ½ä¸è¡Œ//ç™»é™†æˆåŠŸï¼šä¸å¯ä»¥è®¿é—®login å…¶ä½™éƒ½å¯ä»¥ é—®é¢˜ï¼Ÿ ä¸å¼•å…¥piniaæ—¶ å…¨å±€è·¯ç”±å®ˆå«å°†è·å–ç”¨æˆ·ä¿¡æ¯çš„è¯·æ±‚æ”¾åœ¨äº†è·³è½¬ä¹‹å‰ã€‚å®ç°äº†åˆ·æ–°åç”¨æˆ·ä¿¡æ¯ä¸¢å¤±çš„åŠŸèƒ½","tags":["Vue3","Pinia","åå°ç®¡ç†"],"categories":["å‰ç«¯"]},{"title":"vue2åŸºç¡€","path":"/2023/12/14/2023-12-14-vue2-åŸºç¡€/","content":"1. Vueå¿«é€Ÿä¸Šæ‰‹ Vue (è¯»éŸ³ vjuËï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥— **æ„å»ºç”¨æˆ·ç•Œé¢ ** çš„ æ¸è¿›å¼ æ¡†æ¶ Vue2å®˜ç½‘ï¼šhttps://v2.cn.vuejs.org/ 1.1 ä»€ä¹ˆæ˜¯æ„å»ºç”¨æˆ·ç•Œé¢ åŸºäºæ•°æ®æ¸²æŸ“å‡ºç”¨æˆ·å¯ä»¥çœ‹åˆ°çš„ç•Œé¢ 1.2 åˆ›å»ºVueå®ä¾‹ å‡†å¤‡å®¹å™¨ å¼•åŒ…ï¼ˆå®˜ç½‘ï¼‰ â€” å¼€å‘ç‰ˆæœ¬ç”Ÿäº§ç‰ˆæœ¬ åˆ›å»ºVueå®ä¾‹ new Vue() æŒ‡å®šé…ç½®é¡¹ï¼Œæ¸²æŸ“æ•°æ® el:æŒ‡å®šæŒ‚è½½ç‚¹ dataæä¾›æ•°æ® ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody!-- åˆ›å»ºVueå®ä¾‹ï¼Œåˆå§‹åŒ–æ¸²æŸ“ 1. å‡†å¤‡å®¹å™¨ (Vueæ‰€ç®¡ç†çš„èŒƒå›´) 2. å¼•åŒ… (å¼€å‘ç‰ˆæœ¬åŒ… / ç”Ÿäº§ç‰ˆæœ¬åŒ…) å®˜ç½‘ 3. åˆ›å»ºå®ä¾‹ 4. æ·»åŠ é…ç½®é¡¹ = å®Œæˆæ¸²æŸ“--!-- ä¸æ˜¯Vueç®¡ç†çš„èŒƒå›´ --div class=box2 box2 -- count /divdiv class=box box -- msg /div-----------------------------------------------------!-- Vueæ‰€ç®¡ç†çš„èŒƒå›´ --div id=app !-- è¿™é‡Œå°†æ¥ä¼šç¼–å†™ä¸€äº›ç”¨äºæ¸²æŸ“çš„ä»£ç é€»è¾‘ -- h1 msg /h1 a href=# count /a/div!-- å¼•å…¥çš„æ˜¯å¼€å‘ç‰ˆæœ¬åŒ… - åŒ…å«å®Œæ•´çš„æ³¨é‡Šå’Œè­¦å‘Š --script src=https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js/scriptscript // ä¸€æ—¦å¼•å…¥ VueJSæ ¸å¿ƒåŒ…ï¼Œåœ¨å…¨å±€ç¯å¢ƒï¼Œå°±æœ‰äº† Vue æ„é€ å‡½æ•° const app = new Vue( // é€šè¿‡ el é…ç½®é€‰æ‹©å™¨ï¼ŒæŒ‡å®š Vue ç®¡ç†çš„æ˜¯å“ªä¸ªç›’å­ el: #app, // é€šè¿‡ data æä¾›æ•°æ® data: msg: Hello ä¼ æ™ºæ’­å®¢, count: 666 )/script/body/html 1.3 æ’å€¼è¡¨è¾¾å¼ åˆ©ç”¨è¡¨è¾¾å¼è¿›è¡Œæ’å€¼ï¼Œæ¸²æŸ“åˆ°é¡µé¢ä¸­ è¡¨è¾¾å¼ï¼šæ˜¯å¯ä»¥è¢«æ±‚å€¼çš„ä»£ç ï¼ŒJSå¼•æ“ä¼šè®²å…¶è®¡ç®—å‡ºä¸€ä¸ªç»“æœ ä»¥ä¸‹çš„æƒ…å†µéƒ½æ˜¯è¡¨è¾¾å¼ï¼š money + 100money - 100money * 10money / 10 price = 100 ? çœŸè´µ:è¿˜è¡Œobj.namearr[0]fn()obj.fn() è¯­æ³• æ’å€¼è¡¨è¾¾å¼è¯­æ³•ï¼š h3titleh3pnickName.toUpperCase()/ppage = 18 ? æˆå¹´:æœªæˆå¹´/ppobj.name/ppfn()/p é”™è¯¯ç”¨æ³• 1.åœ¨æ’å€¼è¡¨è¾¾å¼ä¸­ä½¿ç”¨çš„æ•°æ® å¿…é¡»åœ¨dataä¸­è¿›è¡Œäº†æä¾›phobby/p //å¦‚æœåœ¨dataä¸­ä¸å­˜åœ¨ åˆ™ä¼šæŠ¥é”™2.æ”¯æŒçš„æ˜¯è¡¨è¾¾å¼ï¼Œè€Œéè¯­å¥ï¼Œæ¯”å¦‚ï¼šif for ...pif/p3.ä¸èƒ½åœ¨æ ‡ç­¾å±æ€§ä¸­ä½¿ç”¨ æ’å€¼ (æ’å€¼è¡¨è¾¾å¼åªèƒ½æ ‡ç­¾ä¸­é—´ä½¿ç”¨)p title=usernameæˆ‘æ˜¯Pæ ‡ç­¾/p 1.4 å“åº”å¼ç‰¹æ€§ ç®€å•ç†è§£å°±æ˜¯æ•°æ®å˜ï¼Œè§†å›¾å¯¹åº”å˜ã€‚ å¦‚ä½•è®¿é—® å’Œ ä¿®æ”¹ dataä¸­çš„æ•°æ®ï¼ˆå“åº”å¼æ¼”ç¤ºï¼‰ dataä¸­çš„æ•°æ®, æœ€ç»ˆä¼šè¢«æ·»åŠ åˆ°å®ä¾‹ä¸Š â‘  è®¿é—®æ•°æ®ï¼š â€œå®ä¾‹.å±æ€§åâ€ â‘¡ ä¿®æ”¹æ•°æ®ï¼š â€œå®ä¾‹.å±æ€§åâ€ â€œå€¼â€ 1.5 å¼€å‘è€…å·¥å…· é€šè¿‡è°·æ­Œåº”ç”¨å•†åº—å®‰è£…ï¼ˆå›½å¤–ç½‘ç«™ï¼‰ æç®€æ’ä»¶ä¸‹è½½ï¼ˆæ¨èï¼‰ https://chrome.zzzmh.cn/index å®‰è£…æ­¥éª¤ å®‰è£…ä¹‹åå¯ä»¥F12åçœ‹åˆ°å¤šä¸€ä¸ªVueçš„è°ƒè¯•é¢æ¿ 2. VueæŒ‡ä»¤ æ¦‚å¿µ æŒ‡ä»¤ï¼ˆDirectivesï¼‰æ˜¯ Vue æä¾›çš„å¸¦æœ‰ v- å‰ç¼€ çš„ ç‰¹æ®Š æ ‡ç­¾å±æ€§ã€‚ åˆ†ç±» vue ä¸­çš„æŒ‡ä»¤æŒ‰ç…§ä¸åŒçš„ç”¨é€”å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹ 6 å¤§ç±»ï¼š å†…å®¹æ¸²æŸ“æŒ‡ä»¤ï¼ˆv-htmlã€v-textï¼‰ æ¡ä»¶æ¸²æŸ“æŒ‡ä»¤ï¼ˆv-showã€v-ifã€v-elseã€v-else-ifï¼‰ äº‹ä»¶ç»‘å®šæŒ‡ä»¤ï¼ˆv-onï¼‰ å±æ€§ç»‘å®šæŒ‡ä»¤ ï¼ˆv-bindï¼‰ åŒå‘ç»‘å®šæŒ‡ä»¤ï¼ˆv-modelï¼‰ åˆ—è¡¨æ¸²æŸ“æŒ‡ä»¤ï¼ˆv-forï¼‰ æŒ‡ä»¤æ˜¯ vue å¼€å‘ä¸­æœ€åŸºç¡€ã€æœ€å¸¸ç”¨ã€æœ€ç®€å•çš„çŸ¥è¯†ç‚¹ã€‚ 2.1 å†…å®¹æ¸²æŸ“æŒ‡ä»¤ v-textï¼ˆç±»ä¼¼innerTextï¼‰ ä½¿ç”¨è¯­æ³•ï¼šp v-text=unamehello/pï¼Œæ„æ€æ˜¯å°† uame å€¼æ¸²æŸ“åˆ° p æ ‡ç­¾ä¸­ ç±»ä¼¼ innerTextï¼Œä½¿ç”¨è¯¥è¯­æ³•ï¼Œä¼šè¦†ç›– p æ ‡ç­¾åŸæœ‰å†…å®¹ v-htmlï¼ˆç±»ä¼¼ innerHTMLï¼‰ ä½¿ç”¨è¯­æ³•ï¼šp v-html=introhello/pï¼Œæ„æ€æ˜¯å°† intro å€¼æ¸²æŸ“åˆ° p æ ‡ç­¾ä¸­ ç±»ä¼¼ innerHTMLï¼Œä½¿ç”¨è¯¥è¯­æ³•ï¼Œä¼šè¦†ç›– p æ ‡ç­¾åŸæœ‰å†…å®¹ï¼Œèƒ½å¤Ÿå°†HTMLæ ‡ç­¾çš„æ ·å¼å‘ˆç°å‡ºæ¥ã€‚ ç¤ºä¾‹ div id=app h2ä¸ªäººä¿¡æ¯/h2 // æ—¢ç„¶æŒ‡ä»¤æ˜¯vueæä¾›çš„ç‰¹æ®Šçš„htmlå±æ€§ï¼Œæ‰€ä»¥å’±ä»¬å†™çš„æ—¶å€™å°±å½“æˆå±æ€§æ¥ç”¨å³å¯ p v-text=unameå§“åï¼š/p p v-html=introç®€ä»‹ï¼š/p/div script const app = new Vue( el:#app, data: uname:å¼ ä¸‰, intro:h2è¿™æ˜¯ä¸€ä¸ªstrongéå¸¸ä¼˜ç§€/strongçš„boyh2 )/script 2.2 æ¡ä»¶æ¸²æŸ“æŒ‡ä»¤ v-show ä½œç”¨ï¼š æ§åˆ¶å…ƒç´ æ˜¾ç¤ºéšè— è¯­æ³•ï¼š v-show â€œè¡¨è¾¾å¼â€ è¡¨è¾¾å¼å€¼ä¸º true æ˜¾ç¤ºï¼Œ false éšè— åŸç†ï¼š åˆ‡æ¢ display:none æ§åˆ¶æ˜¾ç¤ºéšè— åœºæ™¯ï¼šé¢‘ç¹åˆ‡æ¢æ˜¾ç¤ºéšè—çš„åœºæ™¯ v-if ä½œç”¨ï¼š æ§åˆ¶å…ƒç´ æ˜¾ç¤ºéšè—ï¼ˆæ¡ä»¶æ¸²æŸ“ï¼‰ è¯­æ³•ï¼š v-if â€œè¡¨è¾¾å¼â€ è¡¨è¾¾å¼å€¼ trueæ˜¾ç¤ºï¼Œ false éšè— åŸç†ï¼š åŸºäºæ¡ä»¶åˆ¤æ–­ï¼Œæ˜¯å¦åˆ›å»º æˆ– ç§»é™¤å…ƒç´ èŠ‚ç‚¹ åœºæ™¯ï¼š è¦ä¹ˆæ˜¾ç¤ºï¼Œè¦ä¹ˆéšè—ï¼Œä¸é¢‘ç¹åˆ‡æ¢çš„åœºæ™¯ ç¤ºä¾‹ body !-- v-showåº•å±‚åŸç†ï¼šåˆ‡æ¢ css çš„ display: none æ¥æ§åˆ¶æ˜¾ç¤ºéšè— v-if åº•å±‚åŸç†ï¼šæ ¹æ® åˆ¤æ–­æ¡ä»¶ æ§åˆ¶å…ƒç´ çš„ åˆ›å»º å’Œ ç§»é™¤ï¼ˆæ¡ä»¶æ¸²æŸ“ï¼‰ -- div id=app div v-show=flag class=boxæˆ‘æ˜¯v-showæ§åˆ¶çš„ç›’å­/div div v-if=flag class=boxæˆ‘æ˜¯v-ifæ§åˆ¶çš„ç›’å­/div /div script src=https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js/script script const app = new Vue( el: #app, data: flag: false ) /script/body v-else å’Œ v-else-if ä½œç”¨ï¼šè¾…åŠ©v-ifè¿›è¡Œåˆ¤æ–­æ¸²æŸ“ è¯­æ³•ï¼šv-else v-else-ifâ€è¡¨è¾¾å¼â€ éœ€è¦ç´§æ¥ç€v-ifä½¿ç”¨ ç¤ºä¾‹ htmlbody div id=app p v-if=gender === 1æ€§åˆ«ï¼šâ™‚ ç”·/p p v-elseæ€§åˆ«ï¼šâ™€ å¥³/p hr p v-if=score = 90æˆç»©è¯„å®šAï¼šå¥–åŠ±ç”µè„‘ä¸€å°/p p v-else-if=score = 70æˆç»©è¯„å®šBï¼šå¥–åŠ±å‘¨æœ«éƒŠæ¸¸/p p v-else-if=score = 60æˆç»©è¯„å®šCï¼šå¥–åŠ±é›¶é£Ÿç¤¼åŒ…/p p v-elseæˆç»©è¯„å®šDï¼šæƒ©ç½šä¸€å‘¨ä¸èƒ½ç©æ‰‹æœº/p /div script src=https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js/script script const app = new Vue( el: #app, data: gender: 2, score: 95 ) /script/body/html 2.3 äº‹ä»¶ç»‘å®šæŒ‡ä»¤ ä½¿ç”¨Vueæ—¶ï¼Œå¦‚éœ€ä¸ºDOMæ³¨å†Œäº‹ä»¶ï¼ŒåŠå…¶çš„ç®€å•ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š button v-on:äº‹ä»¶åâ€å†…è”è¯­å¥â€æŒ‰é’® button v-on:äº‹ä»¶åâ€å¤„ç†å‡½æ•°â€æŒ‰é’® button v-on:äº‹ä»¶åâ€å¤„ç†å‡½æ•°(å®å‚)â€æŒ‰é’® v-on: ç®€å†™ä¸º @ å†…è”è¯­å¥ div id=app button @click=count---/button span count /span button v-on:click=count+++/button /div script src=https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js/script script const app = new Vue( el: #app, data: count: 100 ) /script äº‹ä»¶å¤„ç†å‡½æ•° äº‹ä»¶å¤„ç†å‡½æ•°åº”è¯¥å†™åˆ°ä¸€ä¸ªè·ŸdataåŒçº§çš„é…ç½®é¡¹ï¼ˆmethodsï¼‰ä¸­ methodsä¸­çš„å‡½æ•°å†…éƒ¨çš„thiséƒ½æŒ‡å‘Vueå®ä¾‹ ç¤ºä¾‹ body div id=app button @click=fnåˆ‡æ¢æ˜¾ç¤ºéšè—/button h1 v-show=isShowé»‘é©¬ç¨‹åºå‘˜/h1 /div script src=https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js/script script const app4 = new Vue( el: #app, data: isShow: true , methods: fn () // è®©æä¾›çš„æ‰€æœ‰methodsä¸­çš„å‡½æ•°ï¼Œthiséƒ½æŒ‡å‘å½“å‰å®ä¾‹ // console.log(æ‰§è¡Œäº†fn, app.isShow) // console.log(app3 === this) this.isShow = !this.isShow ) /script/body ç»™äº‹ä»¶å¤„ç†å‡½æ•°ä¼ å‚ å¦‚æœä¸ä¼ é€’ä»»ä½•å‚æ•°ï¼Œåˆ™æ–¹æ³•æ— éœ€åŠ å°æ‹¬å·ï¼›methodsæ–¹æ³•ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ e å½“åšäº‹ä»¶å¯¹è±¡ å¦‚æœä¼ é€’äº†å‚æ•°ï¼Œåˆ™å®å‚ $event è¡¨ç¤ºäº‹ä»¶å¯¹è±¡ï¼Œå›ºå®šç”¨æ³•ã€‚ ç¤ºä¾‹ body div id=app div class=box h3å°é»‘è‡ªåŠ¨å”®è´§æœº/h3 button @click=buy(5)å¯ä¹5å…ƒ/button button @click=buy(10)å’–å•¡10å…ƒ/button button @click=buy(8)ç‰›å¥¶8å…ƒ/button /div pé“¶è¡Œå¡ä½™é¢ï¼š money å…ƒ/p /div script src=https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js/script script const app = new Vue( el: #app, data: money: 100 , methods: buy (price) this.money -= price ) /script/body 2.4 å±æ€§ç»‘å®šæŒ‡ä»¤ ä½œç”¨ åŠ¨æ€è®¾ç½®htmlçš„æ ‡ç­¾å±æ€§ æ¯”å¦‚ï¼šsrcã€urlã€title è¯­æ³• v-bind:å±æ€§åâ€è¡¨è¾¾å¼â€ v-bindï¼šå¯ä»¥ç®€å†™æˆ : æ¯”å¦‚ï¼Œæœ‰ä¸€ä¸ªå›¾ç‰‡ï¼Œå®ƒçš„ src å±æ€§å€¼ï¼Œæ˜¯ä¸€ä¸ªå›¾ç‰‡åœ°å€ã€‚è¿™ä¸ªåœ°å€åœ¨æ•°æ® data ä¸­å­˜å‚¨ã€‚ åˆ™å¯ä»¥è¿™æ ·è®¾ç½®å±æ€§å€¼ï¼š img v-bind:src=url / img :src=url / ï¼ˆv-bindå¯ä»¥çœç•¥ï¼‰ ç¤ºä¾‹ div id=app img v-bind:src=imgUrl v-bind:title=msg alt= img :src=imgUrl :title=msg alt=/divscript src=https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js/scriptscript const app = new Vue( el: #app, data: imgUrl: ./imgs/10-02.png, msg: hello æ³¢ä»” )/script 2.4.1 v-bindæ“ä½œclass è¯­æ³•ï¼šdiv :class = å¯¹è±¡/æ•°ç»„è¿™æ˜¯ä¸€ä¸ªdiv/div å¯¹è±¡è¯­æ³• å½“classåŠ¨æ€ç»‘å®šçš„æ˜¯å¯¹è±¡æ—¶ï¼Œé”®å°±æ˜¯ç±»åï¼Œå€¼å°±æ˜¯å¸ƒå°”å€¼ï¼Œå¦‚æœå€¼æ˜¯trueï¼Œå°±æœ‰è¿™ä¸ªç±»ï¼Œå¦åˆ™æ²¡æœ‰è¿™ä¸ªç±» div class=box :class= ç±»å1: å¸ƒå°”å€¼, ç±»å2: å¸ƒå°”å€¼ /div é€‚ç”¨åœºæ™¯ï¼šä¸€ä¸ªç±»åï¼Œæ¥å›åˆ‡æ¢ æ•°ç»„è¯­æ³• å½“classåŠ¨æ€ç»‘å®šçš„æ˜¯æ•°ç»„æ—¶ â†’ æ•°ç»„ä¸­æ‰€æœ‰çš„ç±»ï¼Œéƒ½ä¼šæ·»åŠ åˆ°ç›’å­ä¸Šï¼Œæœ¬è´¨å°±æ˜¯ä¸€ä¸ª class åˆ—è¡¨ div class=box :class=[ ç±»å1, ç±»å2, ç±»å3 ]/div é€‚ç”¨åœºæ™¯:æ‰¹é‡æ·»åŠ æˆ–åˆ é™¤ç±» ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style .box width: 200px; height: 200px; border: 3px solid #000; font-size: 30px; margin-top: 10px; .pink background-color: pink; .big width: 300px; height: 300px; /style/headbody div id=app div class=box :class= pink: true, big: true é»‘é©¬ç¨‹åºå‘˜/div div class=box :class=[pink, big]é»‘é©¬ç¨‹åºå‘˜/div /div script src=https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js/script script const app = new Vue( el: #app, data: ) /script/body/html äº¬ä¸œç§’æ€-tabæ åˆ‡æ¢å¯¼èˆªé«˜äº® !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style * margin: 0; padding: 0; ul display: flex; border-bottom: 2px solid #e01222; padding: 0 10px; li width: 100px; height: 50px; line-height: 50px; list-style: none; text-align: center; li a display: block; text-decoration: none; font-weight: bold; color: #333333; li a.active background-color: #e01222; color: #fff; /style/headbody div id=app ul li v-for=(item, index) in list :key=item.id @click=activeIndex = index !-- å¯¹è±¡è¯­æ³• -- a :class= active: index === activeIndex href=# item.name /a /li /ul /div script src=https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js/script script const app = new Vue( el: #app, data: activeIndex: 2, // è®°å½•é«˜äº® list: [ id: 1, name: äº¬ä¸œç§’æ€ , id: 2, name: æ¯æ—¥ç‰¹ä»· , id: 3, name: å“ç±»ç§’æ€ ] ) /script/body/html 2.4.2 v-bindæ“ä½œstyle è¯­æ³• div class=box :style= CSSå±æ€§å1: CSSå±æ€§å€¼, CSSå±æ€§å2: CSSå±æ€§å€¼ /div ç»ƒä¹  head style .box width: 200px; height: 200px; background-color: rgb(187, 150, 156); /style/headbody div id=app div class=box :style= width: 400px, height: 400px, backgroundColor: green /div /div script src=https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js/script script const app = new Vue( el: #app, data: ) /script/body/html ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style .progress height: 25px; width: 400px; border-radius: 15px; background-color: #272425; border: 3px solid #272425; box-sizing: border-box; margin-bottom: 30px; .inner width: 50%; height: 20px; border-radius: 10px; text-align: right; position: relative; background-color: #409eff; background-size: 20px 20px; box-sizing: border-box; transition: all 1s; .inner span position: absolute; right: -20px; bottom: -25px; /style/headbody div id=app !-- å¤–å±‚ç›’å­åº•è‰² ï¼ˆé»‘è‰²ï¼‰ -- div class=progress !-- å†…å±‚ç›’å­ - è¿›åº¦ï¼ˆè“è‰²ï¼‰ -- div class=inner :style= width: percent + % span percent %/span /div /div button @click=percent = 25è®¾ç½®25%/button button @click=percent = 50è®¾ç½®50%/button button @click=percent = 75è®¾ç½®75%/button button @click=percent = 100è®¾ç½®100%/button /div script src=https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js/script script const app = new Vue( el: #app, data: percent: 30 ) /script/body/html 2.5 åˆ—è¡¨æ¸²æŸ“æŒ‡ä»¤ v-for æŒ‡ä»¤éœ€è¦ä½¿ç”¨ (item, index) in arr å½¢å¼çš„ç‰¹æ®Šè¯­æ³•ï¼Œå…¶ä¸­ï¼š item æ˜¯æ•°ç»„ä¸­çš„æ¯ä¸€é¡¹ index æ˜¯æ¯ä¸€é¡¹çš„ç´¢å¼•ï¼Œä¸éœ€è¦å¯ä»¥çœç•¥ arr æ˜¯è¢«éå†çš„æ•°ç»„ æ­¤è¯­æ³•ä¹Ÿå¯ä»¥éå†å¯¹è±¡å’Œæ•°å­— // éå†å¯¹è±¡// div v-for=(value, key, index) in objectvalue/div// value:å¯¹è±¡ä¸­çš„å€¼// key:å¯¹è±¡ä¸­çš„é”®// index:éå†ç´¢å¼•ä»0å¼€å§‹// éå†æ•°å­—// p v-for=item in 10item/p// itemä»1 å¼€å§‹htmlbody div id=app h3å°é»‘æ°´æœåº—/h3 ul li v-for=(item, index) in list item - index /li /ul ul li v-for=item in list item /li /ul /div script src=https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js/script script const app = new Vue( el: #app, data: list: [è¥¿ç“œ, è‹¹æœ, é¸­æ¢¨, æ¦´è²] ) /script/body/html v-forä¸­çš„key è¯­æ³•ï¼š keyâ€å”¯ä¸€å€¼â€ ä½œç”¨ï¼šç»™åˆ—è¡¨é¡¹æ·»åŠ çš„å”¯ä¸€æ ‡è¯†ã€‚ä¾¿äºVueè¿›è¡Œåˆ—è¡¨é¡¹çš„æ­£ç¡®æ’åºå¤ç”¨ã€‚ ä¸ºä»€ä¹ˆåŠ keyï¼šVue çš„é»˜è®¤è¡Œä¸ºä¼šå°è¯•åŸåœ°ä¿®æ”¹å…ƒç´ ï¼ˆå°±åœ°å¤ç”¨ï¼‰ ç¤ºä¾‹ ul li v-for=(item, index) in booksList :key=item.id span item.name /span span item.author /span button @click=del(item.id)åˆ é™¤/button /li/ul æ³¨æ„ï¼š key çš„å€¼åªèƒ½æ˜¯å­—ç¬¦ä¸² æˆ– æ•°å­—ç±»å‹ key çš„å€¼å¿…é¡»å…·æœ‰å”¯ä¸€æ€§ æ¨èä½¿ç”¨ id ä½œä¸º keyï¼ˆå”¯ä¸€ï¼‰ï¼Œä¸æ¨èä½¿ç”¨ index ä½œä¸º keyï¼ˆä¼šå˜åŒ–ï¼Œä¸å¯¹åº”ï¼‰ 2.6 åŒå‘ç»‘å®šæŒ‡ä»¤2.6.1 ä¸€èˆ¬å…ƒç´  æ•°æ®æ”¹å˜åï¼Œå‘ˆç°çš„é¡µé¢ç»“æœä¼šæ›´æ–° é¡µé¢ç»“æœæ›´æ–°åï¼Œæ•°æ®ä¹Ÿä¼šéšä¹‹è€Œå˜ ä½œç”¨ ç»™è¡¨å•å…ƒç´ ï¼ˆinputã€radioã€selectï¼‰ä½¿ç”¨ï¼ŒåŒå‘ç»‘å®šæ•°æ®ï¼Œå¯ä»¥å¿«é€Ÿ è·å– æˆ– è®¾ç½® è¡¨å•å…ƒç´ å†…å®¹ è¯­æ³• v-model=å˜é‡ ç¤ºä¾‹ ç‚¹å‡»ç™»å½•æŒ‰é’®è·å–è¡¨å•ä¸­çš„å†…å®¹ ç‚¹å‡»é‡ç½®æŒ‰é’®æ¸…ç©ºè¡¨å•ä¸­çš„å†…å®¹ htmlbody div id=app !-- v-model å¯ä»¥è®©æ•°æ®å’Œè§†å›¾ï¼Œå½¢æˆåŒå‘æ•°æ®ç»‘å®š (1) æ•°æ®å˜åŒ–ï¼Œè§†å›¾è‡ªåŠ¨æ›´æ–° (2) è§†å›¾å˜åŒ–ï¼Œæ•°æ®è‡ªåŠ¨æ›´æ–° å¯ä»¥å¿«é€Ÿ[è·å–]æˆ–[è®¾ç½®]è¡¨å•å…ƒç´ çš„å†…å®¹ -- è´¦æˆ·ï¼šinput type=text v-model=username brbr å¯†ç ï¼šinput type=password v-model=password brbr button @click=loginç™»å½•/button button @click=reseté‡ç½®/button /div script src=https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js/script script const app = new Vue( el: #app, data: username: , password: , methods: login () console.log(this.username, this.password) , reset () this.username = this.password = ) /script/body/html 2.6.2 v-modelåœ¨å…¶ä»–è¡¨å•å…ƒç´ çš„ä½¿ç”¨ å¸¸è§çš„è¡¨å•å…ƒç´ éƒ½å¯ä»¥ç”¨ v-model ç»‘å®šå…³è” â†’ å¿«é€Ÿ è·å– æˆ– è®¾ç½® è¡¨å•å…ƒç´ çš„å€¼ å®ƒä¼šæ ¹æ® æ§ä»¶ç±»å‹ è‡ªåŠ¨é€‰å– æ­£ç¡®çš„æ–¹æ³• æ¥æ›´æ–°å…ƒç´  è¾“å…¥æ¡† input:text â€”â€” value æ–‡æœ¬åŸŸ textarea â€”â€” value å¤é€‰æ¡† input:checkbox â€”â€” checked å•é€‰æ¡† input:radio â€”â€” checked ä¸‹æ‹‰èœå• select â€”â€” value ç¤ºä¾‹ htmlhead style textarea display: block; width: 240px; height: 100px; margin: 10px 0; /style/headbody div id=app h3å°é»‘å­¦ä¹ ç½‘/h3 å§“åï¼š input type=text v-model=username brbr æ˜¯å¦å•èº«ï¼š input type=checkbox v-model=isSingle brbr !-- å‰ç½®ç†è§£ï¼š 1. name: ç»™å•é€‰æ¡†åŠ ä¸Š name å±æ€§ å¯ä»¥åˆ†ç»„ â†’ åŒä¸€ç»„äº’ç›¸ä¼šäº’æ–¥ 2. value: ç»™å•é€‰æ¡†åŠ ä¸Š value å±æ€§ï¼Œç”¨äºæäº¤ç»™åå°çš„æ•°æ® ç»“åˆ Vue ä½¿ç”¨ â†’ v-model -- æ€§åˆ«: input v-model=gender type=radio name=gender value=1ç”· input v-model=gender type=radio name=gender value=2å¥³ brbr !-- å‰ç½®ç†è§£ï¼š 1. option éœ€è¦è®¾ç½® value å€¼ï¼Œæäº¤ç»™åå° 2. select çš„ value å€¼ï¼Œå…³è”äº†é€‰ä¸­çš„ option çš„ value å€¼ ç»“åˆ Vue ä½¿ç”¨ â†’ v-model -- æ‰€åœ¨åŸå¸‚: select v-model=cityId option value=101åŒ—äº¬/option option value=102ä¸Šæµ·/option option value=103æˆéƒ½/option option value=104å—äº¬/option /select brbr è‡ªæˆ‘æè¿°ï¼š textarea v-model=desc/textarea buttonç«‹å³æ³¨å†Œ/button /div script src=https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js/script script const app = new Vue( el: #app, data: username: , isSingle: false, gender: 2, cityId: 102, desc: ) /script/body/html 2.7 æŒ‡ä»¤ä¿®é¥°ç¬¦ æ‰€è°“æŒ‡ä»¤ä¿®é¥°ç¬¦å°±æ˜¯é€šè¿‡â€œ.â€æŒ‡æ˜ä¸€äº›æŒ‡ä»¤åç¼€ ä¸åŒçš„åç¼€å°è£…äº†ä¸åŒçš„å¤„ç†æ“ä½œ â€” ç®€åŒ–ä»£ç ã€‚ 2.7.1 æŒ‰é”®ä¿®é¥°ç¬¦ @keyup.enter â€”å½“ç‚¹å‡»enteré”®çš„æ—¶å€™æ‰è§¦å‘ body div id=app h3@keyup.enter â†’ ç›‘å¬é”®ç›˜å›è½¦äº‹ä»¶/h3 input @keyup.enter=fn v-model=username type=text /div script src=https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js/script script const app = new Vue( el: #app, data: username: , methods: fn (e) // è‡ªå·±å†™ç›‘å¬å›è½¦è§¦å‘äº‹ä»¶ // if (e.key === Enter) // console.log(é”®ç›˜å›è½¦çš„æ—¶å€™è§¦å‘, this.username) // console.log(é”®ç›˜å›è½¦çš„æ—¶å€™è§¦å‘, this.username) ) /script/body/html 2.7.2 v-modelä¿®é¥°ç¬¦ v-model.trim â€”å»é™¤é¦–ä½ç©ºæ ¼ v-model.number â€”è½¬æ•°å­— htmlbody div id=app h3v-modelä¿®é¥°ç¬¦ .trim .number/h3 å§“åï¼šinput v-model.trim=username type=textbr å¹´çºªï¼šinput v-model.number=age type=textbr /div script src=https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js/script script const app = new Vue( el: #app, data: username: , age: , ) /script/body/html 2.7.3 äº‹ä»¶ä¿®é¥°ç¬¦ @äº‹ä»¶å.stop â€” é˜»æ­¢å†’æ³¡ @äº‹ä»¶å.prevent â€”é˜»æ­¢é»˜è®¤è¡Œä¸º @äº‹ä»¶å.stop.prevent â€”å¯ä»¥è¿ç”¨ å³é˜»æ­¢äº‹ä»¶å†’æ³¡ä¹Ÿé˜»æ­¢é»˜è®¤è¡Œä¸º style .father width: 200px; height: 200px; background-color: pink; margin-top: 20px; .son width: 100px; height: 100px; background-color: skyblue; /style div id=app h3@äº‹ä»¶å.stop â†’ é˜»æ­¢å†’æ³¡/h3 div @click=fatherFn class=father div @click=sonFn class=sonå„¿å­/div /div h3@äº‹ä»¶å.prevent â†’ é˜»æ­¢é»˜è®¤è¡Œä¸º/h3 a @click href=http://www.baidu.comé˜»æ­¢é»˜è®¤è¡Œä¸º/a /div script src=https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js/script script const app = new Vue( el: #app, methods: fatherFn () alert(è€çˆ¶äº²è¢«ç‚¹å‡»äº†) , sonFn (e) // e.stopPropagation() alert(å„¿å­è¢«ç‚¹å‡»äº†) ) /script 2.8 è‡ªå®šä¹‰æŒ‡ä»¤2.8.1 åŸºæœ¬è¯­æ³• æŒ‡ä»¤ä»‹ç» å†…ç½®æŒ‡ä»¤ï¼šv-htmlã€v-ifã€v-bindã€v-onâ€¦ è¿™éƒ½æ˜¯Vueç»™å’±ä»¬å†…ç½®çš„ä¸€äº›æŒ‡ä»¤ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ è‡ªå®šä¹‰æŒ‡ä»¤ï¼šåŒæ—¶Vueä¹Ÿæ”¯æŒè®©å¼€å‘è€…ï¼Œè‡ªå·±æ³¨å†Œä¸€äº›æŒ‡ä»¤ã€‚è¿™äº›æŒ‡ä»¤è¢«ç§°ä¸ºè‡ªå®šä¹‰æŒ‡ä»¤ æ¯ä¸ªæŒ‡ä»¤éƒ½æœ‰è‡ªå·±å„è‡ªç‹¬ç«‹çš„åŠŸèƒ½ æ¦‚å¿µ è‡ªå·±å®šä¹‰çš„æŒ‡ä»¤ï¼Œå¯ä»¥å°è£…ä¸€äº›DOMæ“ä½œï¼Œæ‰©å±•é¢å¤–çš„åŠŸèƒ½ è¯­æ³• å…¨å±€æ³¨å†Œ // åœ¨main.jsä¸­Vue.directive(æŒ‡ä»¤å, inserted (el) // å¯ä»¥å¯¹ el æ ‡ç­¾ï¼Œæ‰©å±•é¢å¤–åŠŸèƒ½ el.focus() ) å±€éƒ¨æ³¨å†Œ // åœ¨Vueç»„ä»¶çš„é…ç½®é¡¹ä¸­directives: æŒ‡ä»¤å: inserted () // å¯ä»¥å¯¹ el æ ‡ç­¾ï¼Œæ‰©å±•é¢å¤–åŠŸèƒ½ el.focus() ä½¿ç”¨æŒ‡ä»¤ æ³¨æ„ï¼šåœ¨ä½¿ç”¨æŒ‡ä»¤çš„æ—¶å€™ï¼Œä¸€å®šè¦å…ˆæ³¨å†Œï¼Œå†ä½¿ç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ä½¿ç”¨æŒ‡ä»¤è¯­æ³•ï¼š v-æŒ‡ä»¤åã€‚å¦‚ï¼šinput type=text v-focus/ æ³¨å†ŒæŒ‡ä»¤æ—¶ä¸ç”¨åŠ v-å‰ç¼€ï¼Œä½†ä½¿ç”¨æ—¶ä¸€å®šè¦åŠ v-å‰ç¼€ é…ç½®é¡¹ä»‹ç» inserted:è¢«ç»‘å®šå…ƒç´ æ’å…¥çˆ¶èŠ‚ç‚¹æ—¶è°ƒç”¨çš„é’©å­å‡½æ•° elï¼šä½¿ç”¨æŒ‡ä»¤çš„é‚£ä¸ªDOMå…ƒç´  ç¤ºä¾‹ éœ€æ±‚ï¼šå½“é¡µé¢åŠ è½½æ—¶ï¼Œè®©å…ƒç´ è·å–ç„¦ç‚¹ï¼ˆautofocusåœ¨safariæµè§ˆå™¨æœ‰å…¼å®¹æ€§ï¼‰ App.vue template div h1è‡ªå®šä¹‰æŒ‡ä»¤/h1 input v-focus ref=inp type=text /div/templatescriptexport default // mounted () // this.$refs.inp.focus() // // å±€éƒ¨æ³¨å†ŒæŒ‡ä»¤ directives: // æŒ‡ä»¤åï¼šæŒ‡ä»¤çš„é…ç½®é¡¹ focus: inserted (el) el.focus() /scriptstyle/style 2.8.2 æŒ‡ä»¤çš„å€¼ éœ€æ±‚ å®ç°ä¸€ä¸ª color æŒ‡ä»¤ - ä¼ å…¥ä¸åŒçš„é¢œè‰², ç»™æ ‡ç­¾è®¾ç½®æ–‡å­—é¢œè‰² è¯­æ³• åœ¨ç»‘å®šæŒ‡ä»¤æ—¶ï¼Œå¯ä»¥é€šè¿‡â€œç­‰å·â€çš„å½¢å¼ä¸ºæŒ‡ä»¤ ç»‘å®š å…·ä½“çš„å‚æ•°å€¼ div v-color=coloræˆ‘æ˜¯å†…å®¹/div é€šè¿‡ binding.value å¯ä»¥æ‹¿åˆ°æŒ‡ä»¤å€¼ï¼ŒæŒ‡ä»¤å€¼ä¿®æ”¹ä¼š è§¦å‘ update å‡½æ•° directives: color: inserted (el, binding) el.style.color = binding.value , update (el, binding) el.style.color = binding.value ç¤ºä¾‹ App.vue template div h1 v-color=color1æŒ‡ä»¤çš„å€¼1æµ‹è¯•/h1 h1 v-color=color2æŒ‡ä»¤çš„å€¼2æµ‹è¯•/h1 button @click=changeColor æ”¹å˜ç¬¬ä¸€ä¸ªh1çš„é¢œè‰² /button /div/templatescriptexport default data () return color1: red, color2: orange , directives: color: // 1. inserted æä¾›çš„æ˜¯å…ƒç´ è¢«æ·»åŠ åˆ°é¡µé¢ä¸­æ—¶çš„é€»è¾‘ inserted (el, binding) // console.log(el, binding.value); // binding.value å°±æ˜¯æŒ‡ä»¤çš„å€¼ el.style.color = binding.value , // 2. update æŒ‡ä»¤çš„å€¼ä¿®æ”¹çš„æ—¶å€™è§¦å‘ï¼Œæä¾›å€¼å˜åŒ–åï¼Œdomæ›´æ–°çš„é€»è¾‘ update (el, binding) console.log(æŒ‡ä»¤çš„å€¼ä¿®æ”¹äº†); el.style.color = binding.value , methods: changeColor() this.color1 = blue; /scriptstyle/style 2.8.3 v-loadingçš„æŒ‡ä»¤å°è£… åœºæ™¯ å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå‘é€è¯·æ±‚éœ€è¦æ—¶é—´ï¼Œåœ¨è¯·æ±‚çš„æ•°æ®æœªå›æ¥æ—¶ï¼Œé¡µé¢ä¼šå¤„äºç©ºç™½çŠ¶æ€ ç”¨æˆ·ä½“éªŒä¸å¥½ éœ€æ±‚ å°è£…ä¸€ä¸ª v-loading æŒ‡ä»¤ï¼Œå®ç°åŠ è½½ä¸­çš„æ•ˆæœ åˆ†æ æœ¬è´¨ loadingæ•ˆæœå°±æ˜¯ä¸€ä¸ªè’™å±‚ï¼Œç›–åœ¨äº†ç›’å­ä¸Š æ•°æ®è¯·æ±‚ä¸­ï¼Œå¼€å¯loadingçŠ¶æ€ï¼Œæ·»åŠ è’™å±‚ æ•°æ®è¯·æ±‚å®Œæ¯•ï¼Œå…³é—­loadingçŠ¶æ€ï¼Œç§»é™¤è’™å±‚ å®ç° å‡†å¤‡ä¸€ä¸ª loadingç±»ï¼Œé€šè¿‡ä¼ªå…ƒç´ å®šä½ï¼Œè®¾ç½®å®½é«˜ï¼Œå®ç°è’™å±‚ å¼€å¯å…³é—­ loadingçŠ¶æ€ï¼ˆæ·»åŠ ç§»é™¤è’™å±‚ï¼‰ï¼Œæœ¬è´¨åªéœ€è¦æ·»åŠ ç§»é™¤ç±»å³å¯ ç»“åˆè‡ªå®šä¹‰æŒ‡ä»¤çš„è¯­æ³•è¿›è¡Œå°è£…å¤ç”¨ .loading:before content: ; position: absolute; left: 0; top: 0; width: 100%; height: 100%; background: #fff url(./loading.gif) no-repeat center; ç¤ºä¾‹ template div class=main div class=box v-loading=isLoading ul li v-for=item in list :key=item.id class=news div class=left div class=title item.title /div div class=info span item.source /span span item.time /span /div /div div class=right img :src=item.img alt= /div /li /ul /div div class=box2 v-loading=isLoading2/div /div/templatescript// å®‰è£…axios = yarn add axiosimport axios from axios// æ¥å£åœ°å€ï¼šhttp://hmajax.itheima.net/api/news// è¯·æ±‚æ–¹å¼ï¼šgetexport default data () return list: [], isLoading: true, isLoading2: true , async created () // 1. å‘é€è¯·æ±‚è·å–æ•°æ® const res = await axios.get(http://hmajax.itheima.net/api/news) setTimeout(() = // 2. æ›´æ–°åˆ° list ä¸­ï¼Œç”¨äºé¡µé¢æ¸²æŸ“ v-for this.list = res.data.data this.isLoading = false , 2000) , directives: loading: inserted (el, binding) binding.value ? el.classList.add(loading) : el.classList.remove(loading) , update (el, binding) binding.value ? el.classList.add(loading) : el.classList.remove(loading) /scriptstyle.loading:before content: ; position: absolute; left: 0; top: 0; width: 100%; height: 100%; background: #fff url(./loading.gif) no-repeat center;.box2 width: 400px; height: 400px; border: 2px solid #000; position: relative;.box width: 800px; min-height: 500px; border: 3px solid orange; border-radius: 5px; position: relative;.news display: flex; height: 120px; width: 600px; margin: 0 auto; padding: 20px 0; cursor: pointer;.news .left flex: 1; display: flex; flex-direction: column; justify-content: space-between; padding-right: 10px;.news .left .title font-size: 20px;.news .left .info color: #999999;.news .left .info span margin-right: 20px;.news .right width: 160px; height: 120px;.news .right img width: 100%; height: 100%; object-fit: cover;/style 3. computedè®¡ç®—å±æ€§3.1 åŸºæœ¬æ“ä½œ æ¦‚å¿µ åŸºäºç°æœ‰çš„æ•°æ®ï¼Œè®¡ç®—å‡ºæ¥çš„æ–°å±æ€§ã€‚ ä¾èµ–çš„æ•°æ®å˜åŒ–ï¼Œè‡ªåŠ¨é‡æ–°è®¡ç®—ã€‚ è¯­æ³• å£°æ˜åœ¨ computed é…ç½®é¡¹ä¸­ï¼Œä¸€ä¸ªè®¡ç®—å±æ€§å¯¹åº”ä¸€ä¸ªå‡½æ•° ä½¿ç”¨èµ·æ¥å’Œæ™®é€šå±æ€§ä¸€æ ·ä½¿ç”¨ æ³¨æ„ computedé…ç½®é¡¹å’Œdataé…ç½®é¡¹æ˜¯åŒçº§çš„ computedä¸­çš„è®¡ç®—å±æ€§è™½ç„¶æ˜¯å‡½æ•°çš„å†™æ³•ï¼Œä½†ä»–ä¾ç„¶æ˜¯ä¸ªå±æ€§ computedä¸­çš„è®¡ç®—å±æ€§ä¸èƒ½å’Œdataä¸­çš„å±æ€§åŒå ä½¿ç”¨computedä¸­çš„è®¡ç®—å±æ€§å’Œä½¿ç”¨dataä¸­çš„å±æ€§æ˜¯ä¸€æ ·çš„ç”¨æ³• computedä¸­è®¡ç®—å±æ€§å†…éƒ¨çš„thisä¾ç„¶æŒ‡å‘çš„æ˜¯Vueå®ä¾‹ æ¡ˆä¾‹ æ¯”å¦‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¡ç®—å±æ€§å®ç°ä¸‹é¢è¿™ä¸ªä¸šåŠ¡åœºæ™¯ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style table border: 1px solid #000; text-align: center; width: 240px; th,td border: 1px solid #000; h3 position: relative; /style/headbody div id=app h3å°é»‘çš„ç¤¼ç‰©æ¸…å•/h3 table tr thåå­—/th thæ•°é‡/th /tr tr v-for=(item, index) in list :key=item.id td item.name /td td item.num ä¸ª/td /tr /table !-- ç›®æ ‡ï¼šç»Ÿè®¡æ±‚å’Œï¼Œæ±‚å¾—ç¤¼ç‰©æ€»æ•° -- pç¤¼ç‰©æ€»æ•°ï¼š totalCount ä¸ª/p /div script src=https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js/script script const app = new Vue( el: #app, data: // ç°æœ‰çš„æ•°æ® list: [ id: 1, name: ç¯®çƒ, num: 1 , id: 2, name: ç©å…·, num: 2 , id: 3, name: é“…ç¬”, num: 5 , ] , computed: totalCount () // åŸºäºç°æœ‰çš„æ•°æ®ï¼Œç¼–å†™æ±‚å€¼é€»è¾‘ // è®¡ç®—å±æ€§å‡½æ•°å†…éƒ¨ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ this è®¿é—®åˆ° app å®ä¾‹ // console.log(this.list) // éœ€æ±‚ï¼šå¯¹ this.list æ•°ç»„é‡Œé¢çš„ num è¿›è¡Œæ±‚å’Œ â†’ reduce let total = this.list.reduce((sum, item) = sum + item.num, 0) return total ) /script/body/html 3.2 computedè®¡ç®—å±æ€§ VS methodsæ–¹æ³•3.2.1 computedè®¡ç®—å±æ€§ ä½œç”¨ å°è£…äº†ä¸€æ®µå¯¹äºæ•°æ®çš„å¤„ç†ï¼Œæ±‚å¾—ä¸€ä¸ªç»“æœ è¯­æ³• å†™åœ¨computedé…ç½®é¡¹ä¸­ ä½œä¸ºå±æ€§ï¼Œç›´æ¥ä½¿ç”¨ jsä¸­ä½¿ç”¨è®¡ç®—å±æ€§ï¼š this.è®¡ç®—å±æ€§ æ¨¡æ¿ä¸­ä½¿ç”¨è®¡ç®—å±æ€§ï¼š 3.2.2 methodsè®¡ç®—å±æ€§ ä½œç”¨ ç»™Vueå®ä¾‹æä¾›ä¸€ä¸ªæ–¹æ³•ï¼Œè°ƒç”¨ä»¥å¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚ è¯­æ³•ï¼š å†™åœ¨methodsé…ç½®é¡¹ä¸­ ä½œä¸ºæ–¹æ³•è°ƒç”¨ jsä¸­è°ƒç”¨ï¼š`this.æ–¹æ³•å()`æ¨¡æ¿ä¸­è°ƒç”¨ æ–¹æ³•å() æˆ–è€… @äº‹ä»¶å=æ–¹æ³•å 3.2.3 è®¡ç®—å±æ€§çš„ä¼˜åŠ¿ ç¼“å­˜ç‰¹æ€§ï¼ˆæå‡æ€§èƒ½ï¼‰ è®¡ç®—å±æ€§ä¼šå¯¹è®¡ç®—å‡ºæ¥çš„ç»“æœç¼“å­˜ï¼Œå†æ¬¡ä½¿ç”¨ç›´æ¥è¯»å–ç¼“å­˜ ä¾èµ–é¡¹å˜åŒ–äº†ï¼Œä¼šè‡ªåŠ¨é‡æ–°è®¡ç®— â†’ å¹¶å†æ¬¡ç¼“å­˜ methodsæ²¡æœ‰ç¼“å­˜ç‰¹æ€§ 3.2.4 æ€»ç»“ computedæœ‰ç¼“å­˜ç‰¹æ€§ï¼Œmethodsæ²¡æœ‰ç¼“å­˜ å½“ä¸€ä¸ªç»“æœä¾èµ–å…¶ä»–å¤šä¸ªå€¼æ—¶ï¼Œæ¨èä½¿ç”¨è®¡ç®—å±æ€§ å½“å¤„ç†ä¸šåŠ¡é€»è¾‘æ—¶ï¼Œæ¨èä½¿ç”¨methodsæ–¹æ³•ï¼Œæ¯”å¦‚äº‹ä»¶çš„å¤„ç†å‡½æ•° 3.3 è®¡ç®—å±æ€§çš„å®Œæ•´å†™æ³• æ—¢ç„¶è®¡ç®—å±æ€§ä¹Ÿæ˜¯å±æ€§ï¼Œèƒ½è®¿é—®ï¼Œåº”è¯¥ä¹Ÿèƒ½ä¿®æ”¹äº†ï¼Ÿ è®¡ç®—å±æ€§é»˜è®¤çš„ç®€å†™ï¼Œåªèƒ½è¯»å–è®¿é—®ï¼Œä¸èƒ½ â€œä¿®æ”¹â€ å¦‚æœè¦ â€œä¿®æ”¹â€ â†’ éœ€è¦å†™è®¡ç®—å±æ€§çš„å®Œæ•´å†™æ³• ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style input width: 30px; /style/headbody div id=app å§“ï¼šinput type=text v-model=firstName + åï¼šinput type=text v-model=lastName = span fullName /spanbrbr button @click=changeNameæ”¹åå¡/button /div script src=https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js/script script const app = new Vue( el: #app, data: firstName: åˆ˜, lastName: å¤‡, , methods: changeName () this.fullName = é»„å¿  , computed: // ç®€å†™ â†’ è·å–ï¼Œæ²¡æœ‰é…ç½®è®¾ç½®çš„é€»è¾‘ // fullName () // return this.firstName + this.lastName // // å®Œæ•´å†™æ³• â†’ è·å– + è®¾ç½® fullName: // (1) å½“fullNameè®¡ç®—å±æ€§ï¼Œè¢«è·å–æ±‚å€¼æ—¶ï¼Œæ‰§è¡Œgetï¼ˆæœ‰ç¼“å­˜ï¼Œä¼˜å…ˆè¯»ç¼“å­˜ï¼‰ // ä¼šå°†è¿”å›å€¼ä½œä¸ºï¼Œæ±‚å€¼çš„ç»“æœ get () return this.firstName + this.lastName , // (2) å½“fullNameè®¡ç®—å±æ€§ï¼Œè¢«ä¿®æ”¹èµ‹å€¼æ—¶ï¼Œæ‰§è¡Œset // ä¿®æ”¹çš„å€¼ï¼Œä¼ é€’ç»™setæ–¹æ³•çš„å½¢å‚ set (value) // console.log(value.slice(0, 1)) // console.log(value.slice(1)) this.firstName = value.slice(0, 1) this.lastName = value.slice(1) ) /script/body/html 4. watchä¾¦å¬å™¨ï¼ˆç›‘è§†å™¨ï¼‰4.1 åŸºç¡€å†™æ³• ä½œç”¨ ç›‘è§†æ•°æ®å˜åŒ–ï¼Œæ‰§è¡Œä¸€äº›ä¸šåŠ¡é€»è¾‘æˆ–å¼‚æ­¥æ“ä½œ è¯­æ³• watchåŒæ ·å£°æ˜åœ¨è·ŸdataåŒçº§çš„é…ç½®é¡¹ä¸­ ç®€å•å†™æ³•ï¼š ç®€å•ç±»å‹æ•°æ®ç›´æ¥ç›‘è§† å®Œæ•´å†™æ³•ï¼šæ·»åŠ é¢å¤–é…ç½®é¡¹ data: words: è‹¹æœ, obj: words: è‹¹æœ ,watch: // è¯¥æ–¹æ³•ä¼šåœ¨æ•°æ®å˜åŒ–æ—¶ï¼Œè§¦å‘æ‰§è¡Œ æ•°æ®å±æ€§å (newValue, oldValue) ä¸€äº›ä¸šåŠ¡é€»è¾‘ æˆ– å¼‚æ­¥æ“ä½œã€‚ , å¯¹è±¡.å±æ€§å (newValue, oldValue) ä¸€äº›ä¸šåŠ¡é€»è¾‘ æˆ– å¼‚æ­¥æ“ä½œã€‚ æ¡ˆä¾‹ !DOCTYPE htmlhtml lang=en head meta charset=UTF-8 / meta http-equiv=X-UA-Compatible content=IE=edge / meta name=viewport content=width=device-width, initial-scale=1.0 / titleDocument/title style * margin: 0; padding: 0; box-sizing: border-box; font-size: 18px; #app padding: 10px 20px; .query margin: 10px 0; .box display: flex; textarea width: 300px; height: 160px; font-size: 18px; border: 1px solid #dedede; outline: none; resize: none; padding: 10px; textarea:hover border: 1px solid #1589f5; .transbox width: 300px; height: 160px; background-color: #f0f0f0; padding: 10px; border: none; .tip-box width: 300px; height: 25px; line-height: 25px; display: flex; .tip-box span flex: 1; text-align: center; .query span font-size: 18px; .input-wrap position: relative; .input-wrap span position: absolute; right: 15px; bottom: 15px; font-size: 12px; .input-wrap i font-size: 20px; font-style: normal; /style /head body div id=app !-- æ¡ä»¶é€‰æ‹©æ¡† -- div class=query spanç¿»è¯‘æˆçš„è¯­è¨€ï¼š/span select option value=italyæ„å¤§åˆ©/option option value=englishè‹±è¯­/option option value=germanå¾·è¯­/option /select /div !-- ç¿»è¯‘æ¡† -- div class=box div class=input-wrap textarea v-model=obj.words/textarea spaniâŒ¨ï¸/iæ–‡æ¡£ç¿»è¯‘/span /div div class=output-wrap div class=transbox result /div /div /div /div script src=https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js/script script src=https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js/script script // æ¥å£åœ°å€ï¼šhttps://applet-base-api-t.itheima.net/api/translate // è¯·æ±‚æ–¹å¼ï¼šget // è¯·æ±‚å‚æ•°ï¼š // ï¼ˆ1ï¼‰wordsï¼šéœ€è¦è¢«ç¿»è¯‘çš„æ–‡æœ¬ï¼ˆå¿…ä¼ ï¼‰ // ï¼ˆ2ï¼‰langï¼š éœ€è¦è¢«ç¿»è¯‘æˆçš„è¯­è¨€ï¼ˆå¯é€‰ï¼‰é»˜è®¤å€¼-æ„å¤§åˆ© // ----------------------------------------------- const app = new Vue( el: #app, data: // words: obj: words: , result: , // ç¿»è¯‘ç»“æœ // timer: null // å»¶æ—¶å™¨id , // å…·ä½“è®²è§£ï¼š(1) watchè¯­æ³• (2) å…·ä½“ä¸šåŠ¡å®ç° watch: // è¯¥æ–¹æ³•ä¼šåœ¨æ•°æ®å˜åŒ–æ—¶è°ƒç”¨æ‰§è¡Œ // newValueæ–°å€¼, oldValueè€å€¼ï¼ˆä¸€èˆ¬ä¸ç”¨ï¼‰ // words (newValue) // console.log(å˜åŒ–äº†, newValue) // obj.words (newValue) // console.log(å˜åŒ–äº†, newValue) // é˜²æŠ–: å»¶è¿Ÿæ‰§è¡Œ â†’ å¹²å•¥äº‹å…ˆç­‰ä¸€ç­‰ï¼Œå»¶è¿Ÿä¸€ä¼šï¼Œä¸€æ®µæ—¶é—´å†…æ²¡æœ‰å†æ¬¡è§¦å‘ï¼Œæ‰æ‰§è¡Œ clearTimeout(this.timer) this.timer = setTimeout(async () = const res = await axios( url: https://applet-base-api-t.itheima.net/api/translate, params: words: newValue ) this.result = res.data.data console.log(res.data.data) , 300) ) /script /body/html 4.2 å®Œæ•´å†™æ³• è¯­æ³• å®Œæ•´å†™æ³• â€”æ·»åŠ é¢å¤–çš„é…ç½®é¡¹ deep:true å¯¹å¤æ‚ç±»å‹è¿›è¡Œæ·±åº¦ç›‘å¬ immdiate:true åˆå§‹åŒ– ç«‹åˆ»æ‰§è¡Œä¸€æ¬¡ data: obj: words: è‹¹æœ, lang: italy ,,watch: // watch å®Œæ•´å†™æ³• å¯¹è±¡: deep: true, // æ·±åº¦ç›‘è§† immdiate:true,//ç«‹å³æ‰§è¡Œhandlerå‡½æ•° handler (newValue) console.log(newValue) æ¡ˆä¾‹ å½“æ–‡æœ¬æ¡†è¾“å…¥çš„æ—¶å€™ å³ä¾§ç¿»è¯‘å†…å®¹è¦æ—¶æ—¶å˜åŒ– å½“ä¸‹æ‹‰æ¡†ä¸­çš„è¯­è¨€å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ å³ä¾§ç¿»è¯‘çš„å†…å®¹ä¾ç„¶è¦æ—¶æ—¶å˜åŒ– å¦‚æœæ–‡æœ¬æ¡†ä¸­æœ‰é»˜è®¤å€¼çš„è¯è¦ç«‹å³ç¿»è¯‘ script const app = new Vue( el: #app, data: obj: words: å°é»‘, lang: italy , result: , // ç¿»è¯‘ç»“æœ , watch: obj: deep: true, // æ·±åº¦ç›‘è§† immediate: true, // ç«‹åˆ»æ‰§è¡Œï¼Œä¸€è¿›å…¥é¡µé¢handlerå°±ç«‹åˆ»æ‰§è¡Œä¸€æ¬¡ handler (newValue) clearTimeout(this.timer) this.timer = setTimeout(async () = const res = await axios( url: https://applet-base-api-t.itheima.net/api/translate, params: newValue ) this.result = res.data.data console.log(res.data.data) , 300) )/script 5. Vueç”Ÿå‘½å‘¨æœŸ5.1 å››ä¸ªé˜¶æ®µ æ€è€ƒ ä»€ä¹ˆæ—¶å€™å¯ä»¥å‘é€åˆå§‹åŒ–æ¸²æŸ“è¯·æ±‚ï¼Ÿï¼ˆè¶Šæ—©è¶Šå¥½ï¼‰ä»€ä¹ˆæ—¶å€™å¯ä»¥å¼€å§‹æ“ä½œdomï¼Ÿï¼ˆè‡³å°‘domå¾—æ¸²æŸ“å‡ºæ¥ï¼‰ Vueç”Ÿå‘½å‘¨æœŸ å°±æ˜¯ä¸€ä¸ªVueå®ä¾‹ä»åˆ›å»º åˆ° é”€æ¯ çš„æ•´ä¸ªè¿‡ç¨‹ã€‚ å››ä¸ªé˜¶æ®µ ç”Ÿå‘½å‘¨æœŸå››ä¸ªé˜¶æ®µï¼šâ‘  åˆ›å»º â‘¡ æŒ‚è½½ â‘¢ æ›´æ–° â‘£ é”€æ¯ 1.åˆ›å»ºé˜¶æ®µï¼šåˆ›å»ºå“åº”å¼æ•°æ® 2.æŒ‚è½½é˜¶æ®µï¼šæ¸²æŸ“æ¨¡æ¿ 3.æ›´æ–°é˜¶æ®µï¼šä¿®æ”¹æ•°æ®ï¼Œæ›´æ–°è§†å›¾ 4.é”€æ¯é˜¶æ®µï¼šé”€æ¯Vueå®ä¾‹ 5.2 Vueç”Ÿå‘½å‘¨æœŸé’©å­ æ¦‚å¿µ Vueç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹ä¸­ï¼Œä¼šè‡ªåŠ¨è¿è¡Œä¸€äº›å‡½æ•°ï¼Œè¢«ç§°ä¸ºã€ç”Ÿå‘½å‘¨æœŸé’©å­ã€‘â†’ è®©å¼€å‘è€…å¯ä»¥åœ¨ã€ç‰¹å®šé˜¶æ®µã€‘è¿è¡Œè‡ªå·±çš„ä»£ç  ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody div id=app h3 title /h3 div button @click=count---/button span count /span button @click=count+++/button /div /div script src=https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js/script script const app = new Vue( el: #app, data: count: 100, title: è®¡æ•°å™¨ , // 1. åˆ›å»ºé˜¶æ®µï¼ˆå‡†å¤‡æ•°æ®ï¼‰ beforeCreate () console.log(beforeCreate å“åº”å¼æ•°æ®å‡†å¤‡å¥½ä¹‹å‰, this.count) , created () console.log(created å“åº”å¼æ•°æ®å‡†å¤‡å¥½ä¹‹å, this.count) // this.æ•°æ®å = è¯·æ±‚å›æ¥çš„æ•°æ® // å¯ä»¥å¼€å§‹å‘é€åˆå§‹åŒ–æ¸²æŸ“çš„è¯·æ±‚äº† , // 2. æŒ‚è½½é˜¶æ®µï¼ˆæ¸²æŸ“æ¨¡æ¿ï¼‰ beforeMount () console.log(beforeMount æ¨¡æ¿æ¸²æŸ“ä¹‹å‰, document.querySelector(h3).innerHTML) , mounted () console.log(mounted æ¨¡æ¿æ¸²æŸ“ä¹‹å, document.querySelector(h3).innerHTML) // å¯ä»¥å¼€å§‹æ“ä½œdomäº† , // 3. æ›´æ–°é˜¶æ®µ(ä¿®æ”¹æ•°æ® â†’ æ›´æ–°è§†å›¾) beforeUpdate () console.log(beforeUpdate æ•°æ®ä¿®æ”¹äº†ï¼Œè§†å›¾è¿˜æ²¡æ›´æ–°, document.querySelector(span).innerHTML) , updated () console.log(updated æ•°æ®ä¿®æ”¹äº†ï¼Œè§†å›¾å·²ç»æ›´æ–°, document.querySelector(span).innerHTML) , // 4. å¸è½½é˜¶æ®µ beforeDestroy () console.log(beforeDestroy, å¸è½½å‰) console.log(æ¸…é™¤æ‰ä¸€äº›Vueä»¥å¤–çš„èµ„æºå ç”¨ï¼Œå®šæ—¶å™¨ï¼Œå»¶æ—¶å™¨...) , destroyed () console.log(destroyedï¼Œå¸è½½å) ) /script/body/html 5.3 æ¡ˆä¾‹ åœ¨createdä¸­å‘é€æ•°æ® htmlbody div id=app ul li v-for=(item, index) in list :key=item.id class=news div class=left div class=title item.title /div div class=info span item.source /span span item.time /span /div /div div class=right img :src=item.img alt= /div /li /ul /div script src=https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js/script script src=https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js/script script // æ¥å£åœ°å€ï¼šhttp://hmajax.itheima.net/api/news // è¯·æ±‚æ–¹å¼ï¼šget const app = new Vue( el: #app, data: list: [] , async created () // 1. å‘é€è¯·æ±‚è·å–æ•°æ® const res = await axios.get(http://hmajax.itheima.net/api/news) // 2. æ›´æ–°åˆ° list ä¸­ï¼Œç”¨äºé¡µé¢æ¸²æŸ“ v-for this.list = res.data.data ) /script/body/html åœ¨mountedä¸­è·å–ç„¦ç‚¹ htmlbodydiv class=container id=app div class=search-container img src=https://www.itheima.com/images/logo.png alt= div class=search-box input type=text v-model=words id=inp buttonæœç´¢ä¸€ä¸‹/button /div /div/divscript src=https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js/scriptscript const app = new Vue( el: #app, data: words: , // æ ¸å¿ƒæ€è·¯ï¼š // 1. ç­‰inputæ¡†æ¸²æŸ“å‡ºæ¥ mounted é’©å­ // 2. è®©inputæ¡†è·å–ç„¦ç‚¹ inp.focus() mounted () document.querySelector(#inp).focus() )/script/body/html 6. å·¥ç¨‹åŒ–å¼€å‘å’Œè„šæ‰‹æ¶6.1 å¼€å‘Vueçš„ä¸¤ç§æ–¹å¼ æ ¸å¿ƒåŒ…ä¼ ç»Ÿå¼€å‘æ¨¡å¼ åŸºäºhtml css js æ–‡ä»¶ï¼Œç›´æ¥å¼•å…¥æ ¸å¿ƒåŒ…ï¼Œå¼€å‘ Vueã€‚ å·¥ç¨‹åŒ–å¼€å‘æ¨¡å¼ åŸºäºæ„å»ºå·¥å…·ï¼ˆä¾‹å¦‚ï¼šwebpackï¼‰çš„ç¯å¢ƒä¸­å¼€å‘Vueã€‚ å·¥ç¨‹åŒ–å¼€å‘æ¨¡å¼ä¼˜ç‚¹ æé«˜ç¼–ç æ•ˆç‡ï¼Œæ¯”å¦‚ä½¿ç”¨JSæ–°è¯­æ³•ã€LessSassã€Typescriptç­‰é€šè¿‡webpackéƒ½å¯ä»¥ç¼–è¯‘æˆæµè§ˆå™¨è¯†åˆ«çš„ES3ES5CSSç­‰ å·¥ç¨‹åŒ–å¼€å‘æ¨¡å¼é—®é¢˜ webpacké…ç½®ä¸ç®€å• é›·åŒçš„åŸºç¡€é…ç½® ç¼ºä¹ç»Ÿä¸€çš„æ ‡å‡† ä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå·¥å…·ï¼Œç”Ÿæˆæ ‡å‡†åŒ–çš„é…ç½® 6.2 è„šæ‰‹æ¶Vue CLI ä½œç”¨ Vue CLI æ˜¯Vueå®˜æ–¹æä¾›çš„ä¸€ä¸ªå…¨å±€å‘½ä»¤å·¥å…· å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿåˆ›å»ºä¸€ä¸ªå¼€å‘Vueé¡¹ç›®çš„æ ‡å‡†åŒ–åŸºç¡€æ¶å­ã€‚ã€é›†æˆäº†webpacké…ç½®ã€‘ å¥½å¤„ å¼€ç®±å³ç”¨ï¼Œé›¶é…ç½® å†…ç½®babelç­‰å·¥å…· æ ‡å‡†åŒ–çš„webpacké…ç½® ä½¿ç”¨æ­¥éª¤ å…¨å±€å®‰è£…ï¼ˆåªéœ€å®‰è£…ä¸€æ¬¡å³å¯ï¼‰ yarn global add @vuecli æˆ–è€… npm i @vuecli -g æŸ¥çœ‹vuecliç‰ˆæœ¬ï¼š vue â€“version åˆ›å»ºé¡¹ç›®æ¶å­ï¼švue create project-name(é¡¹ç›®åä¸èƒ½ä½¿ç”¨ä¸­æ–‡) å¯åŠ¨é¡¹ç›®ï¼šyarn serve æˆ–è€… npm run serve(å‘½ä»¤ä¸å›ºå®šï¼Œæ‰¾package.json) é¡¹ç›®ç›®å½•ä»‹ç» main.js å…¥å£æ–‡ä»¶ App.vue Appæ ¹ç»„ä»¶ index.html æ¨¡æ¿æ–‡ä»¶ è¿è¡Œæµç¨‹ 7. ç»„ä»¶åŒ–å¼€å‘7.1 æ¦‚å¿µ ç»„ä»¶åŒ– ä¸€ä¸ªé¡µé¢å¯ä»¥æ‹†åˆ†æˆä¸€ä¸ªä¸ªç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶æœ‰ç€è‡ªå·±ç‹¬ç«‹çš„ç»“æ„ã€æ ·å¼ã€è¡Œä¸ºã€‚ å¥½å¤„ ä¾¿äºç»´æŠ¤ï¼Œåˆ©äºå¤ç”¨ â†’ æå‡å¼€å‘æ•ˆç‡ã€‚ ç»„ä»¶åˆ†ç±» æ™®é€šç»„ä»¶ã€æ ¹ç»„ä»¶ã€‚ ç¤ºä¾‹ æ¯”å¦‚ï¼šä¸‹é¢è¿™ä¸ªé¡µé¢ï¼Œå¯ä»¥æŠŠæ‰€æœ‰çš„ä»£ç éƒ½å†™åœ¨ä¸€ä¸ªé¡µé¢ä¸­ï¼Œä½†æ˜¯è¿™æ ·æ˜¾å¾—ä»£ç æ¯”è¾ƒæ··ä¹±ï¼Œéš¾æ˜“ç»´æŠ¤ã€‚å’±ä»¬å¯ä»¥æŒ‰æ¨¡å—è¿›è¡Œç»„ä»¶åˆ’åˆ†ã€‚ 7.2 æ ¹ç»„ä»¶ æ¦‚å¿µ æ•´ä¸ªåº”ç”¨æœ€ä¸Šå±‚çš„ç»„ä»¶ï¼ŒåŒ…è£¹æ‰€æœ‰æ™®é€šå°ç»„ä»¶ ç¤ºä¾‹ 7.3 ç»„ä»¶çš„æ„æˆ7.3.1 åŸºæœ¬æ„æˆ è¯­æ³•é«˜äº®æ’ä»¶ ä¸‰éƒ¨åˆ†æ„æˆ templateï¼šç»“æ„ ï¼ˆæœ‰ä¸”åªèƒ½ä¸€ä¸ªæ ¹å…ƒç´ ï¼‰ script: jsé€»è¾‘ styleï¼š æ ·å¼ (å¯æ”¯æŒlessï¼Œéœ€è¦è£…åŒ…) è®©ç»„ä»¶æ”¯æŒless è£…åŒ…: yarn add less less-loader -D æˆ–è€…npm i less less-loader -D styleæ ‡ç­¾ï¼Œlangâ€lessâ€ å¼€å¯lessåŠŸèƒ½ 7.3.2 scopedè§£å†³æ ·å¼å†²çª é»˜è®¤æƒ…å†µ å†™åœ¨ç»„ä»¶ä¸­çš„æ ·å¼ä¼š å…¨å±€ç”Ÿæ•ˆ â†’ å› æ­¤å¾ˆå®¹æ˜“é€ æˆå¤šä¸ªç»„ä»¶ä¹‹é—´çš„æ ·å¼å†²çªé—®é¢˜ã€‚ å…¨å±€æ ·å¼ é»˜è®¤ç»„ä»¶ä¸­çš„æ ·å¼ä¼šä½œç”¨åˆ°å…¨å±€ï¼Œä»»ä½•ä¸€ä¸ªç»„ä»¶ä¸­éƒ½ä¼šå—åˆ°æ­¤æ ·å¼çš„å½±å“ å±€éƒ¨æ ·å¼ å¯ä»¥ç»™ç»„ä»¶åŠ ä¸Šscoped å±æ€§,å¯ä»¥è®©æ ·å¼åªä½œç”¨äºå½“å‰ç»„ä»¶ ç¤ºä¾‹ BaseOne.vue template div class=base-one BaseOne /div/templatescriptexport default /scriptstyle scoped/style BaseTwo.vue template div class=base-one BaseTwo /div/templatescriptexport default /scriptstyle scoped/style App.vue template div id=app BaseOne/BaseOne BaseTwo/BaseTwo /div/templatescriptimport BaseOne from ./components/BaseOneimport BaseTwo from ./components/BaseTwoexport default name: App, components: BaseOne, BaseTwo /script scopedåŸç† å½“å‰ç»„ä»¶å†…æ ‡ç­¾éƒ½è¢«æ·»åŠ data-v-hashå€¼ çš„å±æ€§ cssé€‰æ‹©å™¨éƒ½è¢«æ·»åŠ  [data-v-hashå€¼] çš„å±æ€§é€‰æ‹©å™¨ æœ€ç»ˆæ•ˆæœ: å¿…é¡»æ˜¯å½“å‰ç»„ä»¶çš„å…ƒç´ , æ‰ä¼šæœ‰è¿™ä¸ªè‡ªå®šä¹‰å±æ€§, æ‰ä¼šè¢«è¿™ä¸ªæ ·å¼ä½œç”¨åˆ° 7.3.3 dataå¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•° dataä¸ºä»€ä¹ˆè¦å†™æˆå‡½æ•° ä¸€ä¸ªç»„ä»¶çš„ data é€‰é¡¹å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚ç›®çš„æ˜¯ä¸ºäº†ï¼šä¿è¯æ¯ä¸ªç»„ä»¶å®ä¾‹ï¼Œç»´æŠ¤**ç‹¬ç«‹**çš„ä¸€ä»½**æ•°æ®**å¯¹è±¡ã€‚ æ¯æ¬¡åˆ›å»ºæ–°çš„ç»„ä»¶å®ä¾‹ï¼Œéƒ½ä¼šæ–°æ‰§è¡Œä¸€æ¬¡data å‡½æ•°ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°å¯¹è±¡ã€‚ æ¡ˆä¾‹ BaseCount.vue template div class=base-count button @click=count---/button span count /span button @click=count+++/button /div/templatescriptexport default // è¦å†™æˆä¸€ä¸ªå‡½æ•° data: function () return count: 100, ,/scriptstyle.base-count margin: 20px;/style App.vue template div class=app BaseCount/BaseCount /div/templatescriptimport BaseCount from ./components/BaseCountexport default components: BaseCount, ,/scriptstyle/style 7.4 å±€éƒ¨æ³¨å†Œ ç‰¹ç‚¹ åªèƒ½åœ¨æ³¨å†Œçš„ç»„ä»¶å†…ä½¿ç”¨ æ­¥éª¤ åˆ›å»º.vueæ–‡ä»¶ï¼ˆä¸‰ä¸ªç»„æˆéƒ¨åˆ†ï¼‰ åœ¨ä½¿ç”¨çš„ç»„ä»¶å†…å…ˆå¯¼å…¥å†æ³¨å†Œï¼Œæœ€åä½¿ç”¨ ä½¿ç”¨æ–¹å¼ å½“æˆhtmlæ ‡ç­¾ä½¿ç”¨å³å¯ ç»„ä»¶åç»„ä»¶å æ³¨æ„ ç»„ä»¶åè§„èŒƒ â€” å¤§é©¼å³°å‘½åæ³•ï¼Œ å¦‚ HmHeader è¯­æ³• // å¯¼å…¥éœ€è¦æ³¨å†Œçš„ç»„ä»¶import ç»„ä»¶å¯¹è±¡ from .vueæ–‡ä»¶è·¯å¾„import HmHeader from ./components/HmHeaderexport default // å±€éƒ¨æ³¨å†Œ components: ç»„ä»¶å: ç»„ä»¶å¯¹è±¡, HmHeader:HmHeaer, // ç¼©å†™æ–¹å¼ // HmHeader 7.5 å…¨å±€æ³¨å†Œ ç‰¹ç‚¹ å…¨å±€æ³¨å†Œçš„ç»„ä»¶ï¼Œåœ¨é¡¹ç›®çš„ä»»ä½•ç»„ä»¶ä¸­éƒ½èƒ½ä½¿ç”¨ æ­¥éª¤ åˆ›å»º.vueç»„ä»¶ï¼ˆä¸‰ä¸ªç»„æˆéƒ¨åˆ†ï¼‰ main.jsä¸­è¿›è¡Œå…¨å±€æ³¨å†Œ ä½¿ç”¨æ–¹å¼ å½“æˆHTMLæ ‡ç­¾ç›´æ¥ä½¿ç”¨ ç»„ä»¶åç»„ä»¶å æ³¨æ„ ç»„ä»¶åè§„èŒƒ â€” å¤§é©¼å³°å‘½åæ³•ï¼Œ å¦‚ HmHeader è¯­æ³• Vue.component(â€˜ç»„ä»¶åâ€™, ç»„ä»¶å¯¹è±¡) // å¯¼å…¥éœ€è¦å…¨å±€æ³¨å†Œçš„ç»„ä»¶import HmButton from ./components/HmButtonVue.component(HmButton, HmButton) 8. ç»„ä»¶é€šä¿¡8.1 æ¦‚å¿µ ä»€ä¹ˆæ˜¯ç»„ä»¶é€šä¿¡ ç»„ä»¶é€šä¿¡ï¼Œå°±æ˜¯æŒ‡ç»„ä»¶ä¸ç»„ä»¶ä¹‹é—´çš„æ•°æ®ä¼ é€’ ç»„ä»¶çš„æ•°æ®æ˜¯ç‹¬ç«‹çš„ï¼Œæ— æ³•ç›´æ¥è®¿é—®å…¶ä»–ç»„ä»¶çš„æ•°æ®ã€‚ æƒ³ä½¿ç”¨å…¶ä»–ç»„ä»¶çš„æ•°æ®ï¼Œå°±éœ€è¦ç»„ä»¶é€šä¿¡ ç»„ä»¶ä¹‹é—´å¦‚ä½•é€šä¿¡ ç»„ä»¶å…³ç³»åˆ†ç±» çˆ¶å­å…³ç³» éçˆ¶å­å…³ç³» é€šä¿¡è§£å†³æ–¹æ¡ˆ 8.2 çˆ¶ä¼ å­ çˆ¶ç»„ä»¶é€šè¿‡ props å°†æ•°æ®ä¼ é€’ç»™å­ç»„ä»¶ å­ç»„ä»¶åˆ©ç”¨ $emit é€šçŸ¥çˆ¶ç»„ä»¶ä¿®æ”¹æ›´æ–° æ¡ˆä¾‹ çˆ¶ç»„ä»¶é€šè¿‡propså°† myTitle ä¼ é€’ç»™å­ç»„ä»¶ çˆ¶ç»„ä»¶App.vue template div class=app style=border: 3px solid #000; margin: 10px æˆ‘æ˜¯APPç»„ä»¶ !-- 1.ç»™ç»„ä»¶æ ‡ç­¾ï¼Œæ·»åŠ å±æ€§æ–¹å¼ èµ‹å€¼ -- Son :title=myTitle/Son /div/templatescriptimport Son from ./components/Son.vueexport default name: App, data() return myTitle: å­¦å‰ç«¯ï¼Œå°±æ¥é»‘é©¬ç¨‹åºå‘˜, , components: Son, ,/scriptstyle/style å­ç»„ä»¶Son.vue template div class=son style=border:3px solid #000;margin:10px !-- 3.ç›´æ¥ä½¿ç”¨propsçš„å€¼ -- æˆ‘æ˜¯Sonç»„ä»¶ title /div/templatescriptexport default name: Son-Child, // 2.é€šè¿‡propsæ¥æ¥å— props:[title]/scriptstyle/style çˆ¶å‘å­ä¼ å€¼æ­¥éª¤ ï¼ˆ1ï¼‰ç»™å­ç»„ä»¶ä»¥æ·»åŠ å±æ€§çš„æ–¹å¼ä¼ å€¼ ï¼ˆ2ï¼‰å­ç»„ä»¶å†…éƒ¨é€šè¿‡propsæ¥æ”¶ ï¼ˆ3ï¼‰æ¨¡æ¿ä¸­ç›´æ¥ä½¿ç”¨ propsæ¥æ”¶çš„å€¼ 8.3 å­ä¼ çˆ¶ å­ç»„ä»¶åˆ©ç”¨ $emit é€šçŸ¥çˆ¶ç»„ä»¶ï¼Œè¿›è¡Œä¿®æ”¹æ›´æ–° å­å‘çˆ¶ä¼ å€¼æ­¥éª¤ $emitè§¦å‘äº‹ä»¶ï¼Œç»™çˆ¶ç»„ä»¶å‘é€æ¶ˆæ¯é€šçŸ¥ çˆ¶ç»„ä»¶ç›‘å¬$emitè§¦å‘çš„äº‹ä»¶ æä¾›å¤„ç†å‡½æ•°ï¼Œåœ¨å‡½æ•°çš„æ€§å‚ä¸­è·å–ä¼ è¿‡æ¥çš„å‚æ•° 8.4 props å®šä¹‰ ç»„ä»¶ä¸Š æ³¨å†Œçš„ä¸€äº› è‡ªå®šä¹‰å±æ€§ ä½œç”¨ å‘å­ç»„ä»¶ä¼ é€’æ•°æ® ç‰¹ç‚¹ å¯ä»¥ ä¼ é€’ ä»»æ„æ•°é‡ çš„prop å¯ä»¥ ä¼ é€’ ä»»æ„ç±»å‹ çš„prop æ¡ˆä¾‹ çˆ¶ç»„ä»¶App.vue template div class=app UserInfo :username=username :age=age :isSingle=isSingle :car=car :hobby=hobby /UserInfo /div/templatescriptimport UserInfo from ./components/UserInfo.vueexport default data() return username: å°å¸…, age: 28, isSingle: true, car: brand: å®é©¬, , hobby: [ç¯®çƒ, è¶³çƒ, ç¾½æ¯›çƒ], , components: UserInfo, ,/scriptstyle/style å­ç»„ä»¶UserInfo.vue template div class=userinfo h3æˆ‘æ˜¯ä¸ªäººä¿¡æ¯ç»„ä»¶/h3 divå§“åï¼šusername/div divå¹´é¾„ï¼šage/div divæ˜¯å¦å•èº«ï¼šisSingle/div divåº§é©¾ï¼šcar.brand/div divå…´è¶£çˆ±å¥½ï¼šhobby.join(ã€)/div /div/templatescriptexport default props:[username,age,isSingle,car,hobby]/scriptstyle.userinfo width: 300px; border: 3px solid #000; padding: 20px;.userinfo div margin: 20px 10px;/style 8.5 propsæ ¡éªŒ æ€è€ƒ ç»„ä»¶çš„propså¯ä»¥ä¹±ä¼ å—ï¼Ÿ ä½œç”¨ ä¸ºç»„ä»¶çš„ prop æŒ‡å®šéªŒè¯è¦æ±‚ï¼Œä¸ç¬¦åˆè¦æ±‚ï¼Œæ§åˆ¶å°å°±ä¼šæœ‰é”™è¯¯æç¤º â†’ å¸®åŠ©å¼€å‘è€…ï¼Œå¿«é€Ÿå‘ç°é”™è¯¯ è¯­æ³• ç±»å‹æ ¡éªŒ éç©ºæ ¡éªŒ é»˜è®¤å€¼ è‡ªå®šä¹‰æ ¡éªŒ propsæ ¡éªŒå®Œæ•´å†™æ³• è¯­æ³• props: æ ¡éªŒçš„å±æ€§å: type: ç±»å‹, // Number String Boolean ... required: true, // æ˜¯å¦å¿…å¡« default: é»˜è®¤å€¼, // é»˜è®¤å€¼ validator (value) // è‡ªå®šä¹‰æ ¡éªŒé€»è¾‘ return æ˜¯å¦é€šè¿‡æ ¡éªŒ , ç¤ºä¾‹ scriptexport default // å®Œæ•´å†™æ³•ï¼ˆç±»å‹ã€é»˜è®¤å€¼ã€éç©ºã€è‡ªå®šä¹‰æ ¡éªŒï¼‰ props: w: type: Number, // required: true, default: 0, validator(val) // console.log(val) if (val = 100 || val = 0) console.error(ä¼ å…¥çš„èŒƒå›´å¿…é¡»æ˜¯0-100ä¹‹é—´) return false else return true , , /script æ³¨æ„ defaultå’Œrequiredä¸€èˆ¬ä¸åŒæ—¶å†™ï¼ˆå› ä¸ºå½“æ—¶å¿…å¡«é¡¹æ—¶ï¼Œè‚¯å®šæ˜¯æœ‰å€¼çš„ï¼‰ defaultåé¢å¦‚æœæ˜¯ç®€å•ç±»å‹çš„å€¼ï¼Œå¯ä»¥ç›´æ¥å†™é»˜è®¤ã€‚å¦‚æœæ˜¯å¤æ‚ç±»å‹çš„å€¼ï¼Œåˆ™éœ€è¦ä»¥å‡½æ•°çš„å½¢å¼returnä¸€ä¸ªé»˜è®¤å€¼ 8.6 propsdataã€å•å‘æ•°æ®æµ å…±åŒç‚¹ éƒ½å¯ä»¥ç»™ç»„ä»¶æä¾›æ•°æ® åŒºåˆ« data çš„æ•°æ®æ˜¯è‡ªå·±çš„ â†’ éšä¾¿æ”¹ prop çš„æ•°æ®æ˜¯å¤–éƒ¨çš„ â†’ ä¸èƒ½ç›´æ¥æ”¹ï¼Œè¦éµå¾ª å•å‘æ•°æ®æµ å•å‘æ•°æ®æµ çˆ¶çº§props çš„æ•°æ®æ›´æ–°ï¼Œä¼šå‘ä¸‹æµåŠ¨ï¼Œå½±å“å­ç»„ä»¶ã€‚è¿™ä¸ªæ•°æ®æµåŠ¨æ˜¯å•å‘çš„ ç¤ºä¾‹ App.vue template div class=app BaseCount/BaseCount /div/templatescriptimport BaseCount from ./components/BaseCount.vueexport default components: BaseCount , data() ,/scriptstyle/style BaseCount.vue template div class=base-count button @click=count---/button span count /span button @click=count+++/button /div/templatescriptexport default // 1.è‡ªå·±çš„æ•°æ®éšä¾¿ä¿®æ”¹ ï¼ˆè°çš„æ•°æ® è°è´Ÿè´£ï¼‰ data () return count: 100, , // 2.å¤–éƒ¨ä¼ è¿‡æ¥çš„æ•°æ® ä¸èƒ½éšä¾¿ä¿®æ”¹ //props: // count: // type: Number, // , ///scriptstyle.base-count margin: 20px;/style 8.7 éçˆ¶å­é€šä¿¡ï¼ˆevent busï¼‰ ä½œç”¨ éçˆ¶å­ç»„ä»¶ä¹‹é—´ï¼Œè¿›è¡Œç®€æ˜“æ¶ˆæ¯ä¼ é€’ã€‚(å¤æ‚åœºæ™¯â†’ Vuex) æ­¥éª¤ åˆ›å»ºä¸€ä¸ªéƒ½èƒ½è®¿é—®çš„äº‹ä»¶æ€»çº¿ ï¼ˆç©ºVueå®ä¾‹ï¼‰ import Vue from vueconst Bus = new Vue()export default Bus Aç»„ä»¶ï¼ˆæ¥å—æ–¹ï¼‰ï¼Œç›‘å¬Busçš„ $onäº‹ä»¶ created () Bus.$on(sendMsg, (msg) = this.msg = msg ) Bç»„ä»¶ï¼ˆå‘é€æ–¹ï¼‰ï¼Œè§¦å‘Busçš„$emitäº‹ä»¶ Bus.$emit(sendMsg, è¿™æ˜¯ä¸€ä¸ªæ¶ˆæ¯) ç¤ºä¾‹ EventBus.js import Vue from vueconst Bus = new Vue()export default Bus BaseA.vue(æ¥å—æ–¹) template div class=base-a æˆ‘æ˜¯Aç»„ä»¶ï¼ˆæ¥å—æ–¹ï¼‰ pmsg/p /div/templatescriptimport Bus from ../utils/EventBus;export default data() return msg: ; , created() Bus.$on(sendMsg, msg = this.msg = msg; ); ;/scriptstyle scoped.base-a width: 200px; height: 200px; border: 3px solid #000; border-radius: 3px; margin: 10px;/style BaseB.vue(å‘é€æ–¹) template div class=base-b divæˆ‘æ˜¯Bç»„ä»¶ï¼ˆå‘å¸ƒæ–¹ï¼‰/div button @click=sendMsgFnå‘é€æ¶ˆæ¯/button /div/templatescriptimport Bus from ../utils/EventBus;export default methods: sendMsgFn() Bus.$emit(sendMsg, è¿™æ˜¯ä¸€ä¸ªæ¶ˆæ¯); ;/scriptstyle scoped.base-b width: 200px; height: 200px; border: 3px solid #000; border-radius: 3px; margin: 10px;/style App.vue template div class=app BaseA/BaseA BaseB/BaseB /div/templatescriptimport BaseA from ./components/BaseA.vueimport BaseB from ./components/BaseB.vue export default components: BaseA, BaseB /scriptstyle/style 8.8 éçˆ¶å­é€šä¿¡-provideinject ä½œç”¨ è·¨å±‚çº§å…±äº«æ•°æ® åœºæ™¯ çˆ·çˆ·ä¸å­™å­é€šä¿¡ è¯­æ³• çˆ¶ç»„ä»¶ provideæä¾›æ•°æ® export default provide () return // æ™®é€šç±»å‹ã€éå“åº”å¼ã€‘ color: this.color, // å¤æ‚ç±»å‹ã€å“åº”å¼ã€‘ userInfo: this.userInfo, å­å­™ç»„ä»¶ injectè·å–æ•°æ® export default inject: [color,userInfo], created () console.log(this.color, this.userInfo) 9. è¿›é˜¶è¯­æ³•9.1 v-modelåŸç† åŸç† v-modelæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ã€‚ä¾‹å¦‚åº”ç”¨åœ¨è¾“å…¥æ¡†ä¸Šï¼Œå°±æ˜¯valueå±æ€§ å’Œ inputäº‹ä»¶ çš„åˆå†™ template div id=app input v-model=msg type=text input :value=msg @input=msg = $event.target.value type=text /div/template ä½œç”¨ æä¾›æ•°æ®çš„åŒå‘ç»‘å®š æ•°æ®å˜ï¼Œè§†å›¾è·Ÿç€å˜ :value è§†å›¾å˜ï¼Œæ•°æ®è·Ÿç€å˜ @input æ³¨æ„ $event ç”¨äºåœ¨æ¨¡æ¿ä¸­ï¼Œè·å–äº‹ä»¶çš„å½¢å‚ ç¤ºä¾‹ template div class=app input type=text v-model=msg1 / br / !-- v-modelçš„åº•å±‚å…¶å®å°±æ˜¯ï¼švalueå’Œ @inputçš„ç®€å†™ -- input type=text :value=msg2 @input=msg2 = $event.target.value / /div/templatescriptexport default data() return msg1: , msg2: , ,/scriptstyle/style v-modelä½¿ç”¨åœ¨å…¶ä»–è¡¨å•å…ƒç´ ä¸Šçš„åŸç† ä¸åŒçš„è¡¨å•å…ƒç´ ï¼Œ v-modelåœ¨åº•å±‚çš„å¤„ç†æœºåˆ¶æ˜¯ä¸ä¸€æ ·çš„ã€‚æ¯”å¦‚ç»™checkboxä½¿ç”¨v-model åº•å±‚å¤„ç†çš„æ˜¯ checkedå±æ€§å’Œchangeäº‹ä»¶ã€‚ ä¸è¿‡å’±ä»¬åªéœ€è¦æŒæ¡åº”ç”¨åœ¨æ–‡æœ¬æ¡†ä¸Šçš„åŸç†å³å¯ 9.2 è¡¨å•ç±»ç»„ä»¶å°è£… éœ€æ±‚ç›®æ ‡ å®ç°å­ç»„ä»¶å’Œçˆ¶ç»„ä»¶æ•°æ®çš„åŒå‘ç»‘å®š ï¼ˆå®ç°App.vueä¸­çš„selectIdå’Œå­ç»„ä»¶é€‰ä¸­çš„æ•°æ®è¿›è¡ŒåŒå‘ç»‘å®šï¼‰ ä»£ç æ¼”ç¤º App.vue template div class=app BaseSelect :selectId=selectId @changeCity=selectId = $event /BaseSelect /div/templatescriptimport BaseSelect from ./components/BaseSelect.vueexport default data() return selectId: 102, , components: BaseSelect, ,/scriptstyle/style BaseSelect.vue template div select :value=selectId @change=selectCity option value=101åŒ—äº¬/option option value=102ä¸Šæµ·/option option value=103æ­¦æ±‰/option option value=104å¹¿å·/option option value=105æ·±åœ³/option /select /div/templatescriptexport default props: selectId: String, , methods: selectCity(e) this.$emit(changeCity, e.target.value) , ,/scriptstyle/style v-modelç®€åŒ–ä»£ç  ç›®æ ‡ï¼š çˆ¶ç»„ä»¶é€šè¿‡v-model ç®€åŒ–ä»£ç ï¼Œå®ç°å­ç»„ä»¶å’Œçˆ¶ç»„ä»¶æ•°æ® åŒå‘ç»‘å®š å¦‚ä½•ç®€åŒ–ï¼š v-modelå…¶å®å°±æ˜¯ :valueå’Œ@changeäº‹ä»¶çš„ç®€å†™ å­ç»„ä»¶ï¼špropsé€šè¿‡valueæ¥æ”¶æ•°æ®ï¼Œäº‹ä»¶è§¦å‘ change çˆ¶ç»„ä»¶ï¼šv-modelç›´æ¥ç»‘å®šæ•°æ® ç¤ºä¾‹ï¼š å­ç»„ä»¶ select :value=value @change=handleChange.../selectprops: value: String,methods: handleChange (e) this.$emit(input, e.target.value) çˆ¶ç»„ä»¶ BaseSelect v-model=selectId/BaseSelect 9.3 .syncä¿®é¥°ç¬¦ ä½œç”¨ å¯ä»¥å®ç° å­ç»„ä»¶ ä¸ çˆ¶ç»„ä»¶æ•°æ® çš„ åŒå‘ç»‘å®šï¼Œç®€åŒ–ä»£ç  ç®€å•ç†è§£ï¼šå­ç»„ä»¶å¯ä»¥ä¿®æ”¹çˆ¶ç»„ä»¶ä¼ è¿‡æ¥çš„propså€¼ åœºæ™¯ å°è£…å¼¹æ¡†ç±»çš„åŸºç¡€ç»„ä»¶ï¼Œ visibleå±æ€§ trueæ˜¾ç¤º falseéšè— æœ¬è´¨ .syncä¿®é¥°ç¬¦ å°±æ˜¯ :å±æ€§å å’Œ @update:å±æ€§å åˆå†™ è¯­æ³• çˆ¶ç»„ä»¶ //.syncå†™æ³•BaseDialog :visible.sync=isShow /--------------------------------------//å®Œæ•´å†™æ³•BaseDialog :visible=isShow @update:visible=isShow = $event / å­ç»„ä»¶ props: visible: Boolean,this.$emit(update:visible, false) ç¤ºä¾‹ App.vue template div class=app button @click=openDialogé€€å‡ºæŒ‰é’®/button !-- isShow.sync = :isShow=isShow @update:isShow=isShow=$event -- BaseDialog :isShow.sync=isShow/BaseDialog /div/templatescriptimport BaseDialog from ./components/BaseDialog.vueexport default data() return isShow: false, , methods: openDialog() this.isShow = true // console.log(document.querySelectorAll(.box)); , , components: BaseDialog, ,/scriptstyle/style BaseDialog.vue template div class=base-dialog-wrap v-show=isShow div class=base-dialog div class=title h3æ¸©é¦¨æç¤ºï¼š/h3 button class=close @click=closeDialogx/button /div div class=content pä½ ç¡®è®¤è¦é€€å‡ºæœ¬ç³»ç»Ÿä¹ˆï¼Ÿ/p /div div class=footer buttonç¡®è®¤/button buttonå–æ¶ˆ/button /div /div /div/templatescriptexport default props: isShow: Boolean, , methods: closeDialog() this.$emit(update:isShow,false) /scriptstyle scoped.base-dialog-wrap width: 300px; height: 200px; box-shadow: 2px 2px 2px 2px #ccc; position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%); padding: 0 10px;.base-dialog .title display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #000;.base-dialog .content margin-top: 38px;.base-dialog .title .close width: 20px; height: 20px; cursor: pointer; line-height: 10px;.footer display: flex; justify-content: flex-end; margin-top: 26px;.footer button width: 80px; height: 40px;.footer button:nth-child(1) margin-right: 10px; cursor: pointer;/style 9.4 refå’Œ$refs ä½œç”¨ åˆ©ç”¨ref å’Œ $refs å¯ä»¥ç”¨äº è·å– dom å…ƒç´  æˆ– ç»„ä»¶å®ä¾‹ ç‰¹ç‚¹ æŸ¥æ‰¾èŒƒå›´ â†’ å½“å‰ç»„ä»¶å†…(æ›´ç²¾ç¡®ç¨³å®š) è¯­æ³• ç»™è¦è·å–çš„ç›’å­æ·»åŠ refå±æ€§ div class=box ref=chartRefæˆ‘æ˜¯æ¸²æŸ“å›¾è¡¨çš„å®¹å™¨/div è·å–æ—¶é€šè¿‡ $refsè·å– this.$refs.chartRef è·å– mounted () // document.querySelect(.box) console.log(this.$refs.chartRef) æ°å½“æ—¶æœº, é€šè¿‡ this.$refs.xxx, è·å–ç›®æ ‡ç»„ä»¶ï¼Œå°±å¯ä»¥è°ƒç”¨ç»„ä»¶å¯¹è±¡é‡Œé¢çš„æ–¹æ³• BaseForm ref=baseForm/BaseFormthis.$refs.baseForm.ç»„ä»¶æ–¹æ³•() æ³¨æ„ ä¹‹å‰åªç”¨document.querySelect(.box) è·å–çš„æ˜¯æ•´ä¸ªé¡µé¢ä¸­çš„ç›’å­ ç¤ºä¾‹ App.vue template div class=app BaseChart/BaseChart /div/templatescriptimport BaseChart from ./components/BaseChart.vueexport default components: BaseChart /scriptstyle/style BaseChart.vue template div class=base-chart-box ref=baseChartBoxå­ç»„ä»¶/div/templatescriptimport * as echarts from echartsexport default mounted() // åŸºäºå‡†å¤‡å¥½çš„domï¼Œåˆå§‹åŒ–echartså®ä¾‹ // document.querySelector ä¼šæŸ¥æ‰¾é¡¹ç›®ä¸­æ‰€æœ‰çš„å…ƒç´  // $refsåªä¼šåœ¨å½“å‰ç»„ä»¶æŸ¥æ‰¾ç›’å­ // var myChart = echarts.init(document.querySelector(.base-chart-box)) var myChart = echarts.init(this.$refs.baseChartBox) // ç»˜åˆ¶å›¾è¡¨ myChart.setOption( title: text: ECharts å…¥é—¨ç¤ºä¾‹, , tooltip: , xAxis: data: [è¡¬è¡«, ç¾Šæ¯›è¡«, é›ªçººè¡«, è£¤å­, é«˜è·Ÿé‹, è¢œå­], , yAxis: , series: [ name: é”€é‡, type: bar, data: [5, 20, 36, 10, 10, 20], , ], ) ,/scriptstyle scoped.base-chart-box width: 400px; height: 300px; border: 3px solid #000; border-radius: 6px;/style 9.5 å¼‚æ­¥æ›´æ–° $nextTick éœ€æ±‚ ç¼–è¾‘æ ‡é¢˜, ç¼–è¾‘æ¡†è‡ªåŠ¨èšç„¦ ç‚¹å‡»ç¼–è¾‘ï¼Œæ˜¾ç¤ºç¼–è¾‘æ¡† è®©ç¼–è¾‘æ¡†ï¼Œç«‹åˆ»è·å–ç„¦ç‚¹ å®ç° template div class=app div v-if=isShowEdit input type=text v-model=editValue ref=inp / buttonç¡®è®¤/button /div div v-else span title /span button @click=editFnç¼–è¾‘/button /div /div/templatescriptexport default data() return title: å¤§æ ‡é¢˜, isShowEdit: false, editValue: , , methods: editFn() // æ˜¾ç¤ºè¾“å…¥æ¡† this.isShowEdit = true // è·å–ç„¦ç‚¹ this.$refs.inp.focus() ,/script é—®é¢˜ â€œæ˜¾ç¤ºä¹‹åâ€ï¼Œç«‹åˆ»è·å–ç„¦ç‚¹æ˜¯ä¸èƒ½æˆåŠŸçš„ï¼ åŸå› ï¼šVue æ˜¯å¼‚æ­¥æ›´æ–°DOM (æå‡æ€§èƒ½) è§£å†³æ–¹æ¡ˆ $nextTickï¼šç­‰ DOMæ›´æ–°å,æ‰ä¼šè§¦å‘æ‰§è¡Œæ­¤æ–¹æ³•é‡Œçš„å‡½æ•°ä½“ è¯­æ³•: this.$nextTick(å‡½æ•°ä½“) this.$nextTick(() = this.$refs.inp.focus()) æ³¨æ„ï¼š$nextTick å†…çš„å‡½æ•°ä½“ ä¸€å®šæ˜¯ç®­å¤´å‡½æ•°ï¼Œè¿™æ ·æ‰èƒ½è®©å‡½æ•°å†…éƒ¨çš„thisæŒ‡å‘Vueå®ä¾‹ 10. æ’æ§½10.1 é»˜è®¤æ’æ§½ ä½œç”¨ è®©ç»„ä»¶å†…éƒ¨çš„ä¸€äº› ç»“æ„ æ”¯æŒ è‡ªå®šä¹‰ éœ€æ±‚ å°†éœ€è¦å¤šæ¬¡æ˜¾ç¤ºçš„å¯¹è¯æ¡†,å°è£…æˆä¸€ä¸ªç»„ä»¶ é—®é¢˜ ç»„ä»¶çš„å†…å®¹éƒ¨åˆ†ï¼Œä¸å¸Œæœ›å†™æ­»ï¼Œå¸Œæœ›èƒ½ä½¿ç”¨çš„æ—¶å€™è‡ªå®šä¹‰ã€‚æ€ä¹ˆåŠï¼Ÿ æ’æ§½çš„åŸºæœ¬è¯­æ³• ç»„ä»¶å†…éœ€è¦å®šåˆ¶çš„ç»“æ„éƒ¨åˆ†ï¼Œæ”¹ç”¨****å ä½ ä½¿ç”¨ç»„ä»¶æ—¶, ****æ ‡ç­¾å†…éƒ¨, ä¼ å…¥ç»“æ„æ›¿æ¢slot ç»™æ’æ§½ä¼ å…¥å†…å®¹æ—¶ï¼Œå¯ä»¥ä¼ å…¥çº¯æ–‡æœ¬ã€htmlæ ‡ç­¾ã€ç»„ä»¶ ä»£ç ç¤ºä¾‹ MyDialog.vue template div class=dialog div class=dialog-header h3å‹æƒ…æç¤º/h3 span class=closeâœ–ï¸/span /div div class=dialog-content !-- 1. åœ¨éœ€è¦å®šåˆ¶çš„ä½ç½®ï¼Œä½¿ç”¨slotå ä½ -- slot/slot /div div class=dialog-footer buttonå–æ¶ˆ/button buttonç¡®è®¤/button /div /div/templatescriptexport default data () return /scriptstyle scoped* margin: 0; padding: 0;.dialog width: 470px; height: 230px; padding: 0 25px; background-color: #ffffff; margin: 40px auto; border-radius: 5px;.dialog-header height: 70px; line-height: 70px; font-size: 20px; border-bottom: 1px solid #ccc; position: relative;.dialog-header .close position: absolute; right: 0px; top: 0px; cursor: pointer;.dialog-content height: 80px; font-size: 18px; padding: 15px 0;.dialog-footer display: flex; justify-content: flex-end;.dialog-footer button width: 65px; height: 35px; background-color: #ffffff; border: 1px solid #e1e3e9; cursor: pointer; outline: none; margin-left: 10px; border-radius: 3px;.dialog-footer button:last-child background-color: #007acc; color: #fff;/style App.vue template div !-- 2. åœ¨ä½¿ç”¨ç»„ä»¶æ—¶ï¼Œç»„ä»¶æ ‡ç­¾å†…å¡«å…¥å†…å®¹ -- MyDialog divä½ ç¡®è®¤è¦åˆ é™¤ä¹ˆ/div /MyDialog MyDialog pä½ ç¡®è®¤è¦é€€å‡ºä¹ˆ/p /MyDialog /div/templatescriptimport MyDialog from ./components/MyDialog.vueexport default data () return , components: MyDialog /scriptstylebody background-color: #b3b3b3;/style 10.2 æ’æ§½é»˜è®¤å€¼ é—®é¢˜ é€šè¿‡æ’æ§½å®Œæˆäº†å†…å®¹çš„å®šåˆ¶ï¼Œä¼ ä»€ä¹ˆæ˜¾ç¤ºä»€ä¹ˆ, ä½†æ˜¯å¦‚æœä¸ä¼ ï¼Œåˆ™æ˜¯ç©ºç™½ èƒ½å¦ç»™æ’æ§½è®¾ç½® é»˜è®¤æ˜¾ç¤ºå†…å®¹ å‘¢ï¼Ÿ æ’æ§½çš„åå¤‡å†…å®¹ å°è£…ç»„ä»¶æ—¶ï¼Œå¯ä»¥ä¸ºé¢„ç•™çš„ slot æ’æ§½æä¾›åå¤‡å†…å®¹ï¼ˆé»˜è®¤å†…å®¹ï¼‰ è¯­æ³• åœ¨ æ ‡ç­¾å†…ï¼Œæ”¾ç½®å†…å®¹, ä½œä¸ºé»˜è®¤æ˜¾ç¤ºå†…å®¹ æ•ˆæœ å¤–éƒ¨ä½¿ç”¨ç»„ä»¶æ—¶ï¼Œä¸ä¼ ä¸œè¥¿ï¼Œåˆ™slotä¼šæ˜¾ç¤ºåå¤‡å†…å®¹ å¤–éƒ¨ä½¿ç”¨ç»„ä»¶æ—¶ï¼Œä¼ ä¸œè¥¿äº†ï¼Œåˆ™slotæ•´ä½“ä¼šè¢«æ¢æ‰ ç¤ºä¾‹ App.vue template div MyDialog/MyDialog MyDialog ä½ ç¡®è®¤è¦é€€å‡ºä¹ˆ /MyDialog /div/templatescriptimport MyDialog from ./components/MyDialog.vueexport default data () return , components: MyDialog /scriptstylebody background-color: #b3b3b3;/style 10.3 å…·åæ’æ§½ éœ€æ±‚ ä¸€ä¸ªç»„ä»¶å†…æœ‰å¤šå¤„ç»“æ„ï¼Œéœ€è¦å¤–éƒ¨ä¼ å…¥æ ‡ç­¾ï¼Œè¿›è¡Œå®šåˆ¶ ä¸Šé¢çš„å¼¹æ¡†ä¸­æœ‰ä¸‰å¤„ä¸åŒï¼Œä½†æ˜¯é»˜è®¤æ’æ§½åªèƒ½å®šåˆ¶ä¸€ä¸ªä½ç½®ï¼Œè¿™æ—¶å€™æ€ä¹ˆåŠå‘¢? è¯­æ³• å¤šä¸ªslotä½¿ç”¨nameå±æ€§åŒºåˆ†åå­— templateé…åˆv-slot:åå­—æ¥åˆ†å‘å¯¹åº”æ ‡ç­¾ ç®€å†™ v-slotå†™èµ·æ¥å¤ªé•¿ï¼Œvueç»™æˆ‘ä»¬æä¾›ä¸€ä¸ªç®€å•å†™æ³• # ç¤ºä¾‹ App.vue template div MyDialog !-- éœ€è¦é€šè¿‡templateæ ‡ç­¾åŒ…è£¹éœ€è¦åˆ†å‘çš„ç»“æ„ï¼ŒåŒ…æˆä¸€ä¸ªæ•´ä½“ -- template v-slot:head divæˆ‘æ˜¯å¤§æ ‡é¢˜/div /template template v-slot:content divæˆ‘æ˜¯å†…å®¹/div /template template #footer buttonå–æ¶ˆ/button buttonç¡®è®¤/button /template /MyDialog /div/templatescriptimport MyDialog from ./components/MyDialog.vueexport default data () return , components: MyDialog /scriptstylebody background-color: #b3b3b3;/style MyDialog.vue template div class=dialog div class=dialog-header !-- ä¸€æ—¦æ’æ§½èµ·äº†åå­—ï¼Œå°±æ˜¯å…·åæ’æ§½ï¼Œåªæ”¯æŒå®šå‘åˆ†å‘ -- slot name=head/slot /div div class=dialog-content slot name=content/slot /div div class=dialog-footer slot name=footer/slot /div /div/templatescriptexport default data () return /scriptstyle scoped* margin: 0; padding: 0;.dialog width: 470px; height: 230px; padding: 0 25px; background-color: #ffffff; margin: 40px auto; border-radius: 5px;.dialog-header height: 70px; line-height: 70px; font-size: 20px; border-bottom: 1px solid #ccc; position: relative;.dialog-header .close position: absolute; right: 0px; top: 0px; cursor: pointer;.dialog-content height: 80px; font-size: 18px; padding: 15px 0;.dialog-footer display: flex; justify-content: flex-end;.dialog-footer button width: 65px; height: 35px; background-color: #ffffff; border: 1px solid #e1e3e9; cursor: pointer; outline: none; margin-left: 10px; border-radius: 3px;.dialog-footer button:last-child background-color: #007acc; color: #fff;/style 10.4 ä½œç”¨åŸŸæ’æ§½ æ’æ§½åˆ†ç±» é»˜è®¤æ’æ§½ å…·åæ’æ§½ æ’æ§½åªæœ‰ä¸¤ç§ï¼Œä½œç”¨åŸŸæ’æ§½ä¸å±äºæ’æ§½çš„ä¸€ç§åˆ†ç±» ä½œç”¨ å®šä¹‰slot æ’æ§½çš„åŒæ—¶, æ˜¯å¯ä»¥ä¼ å€¼çš„ã€‚ç»™ æ’æ§½ ä¸Šå¯ä»¥ ç»‘å®šæ•°æ®ï¼Œå°†æ¥ ä½¿ç”¨ç»„ä»¶æ—¶å¯ä»¥ç”¨ åœºæ™¯ å°è£…è¡¨æ ¼ç»„ä»¶ ä½¿ç”¨æ­¥éª¤ ç»™ slot æ ‡ç­¾, ä»¥ æ·»åŠ å±æ€§çš„æ–¹å¼ä¼ å€¼ !-- 1. ç»™slotæ ‡ç­¾ï¼Œæ·»åŠ å±æ€§çš„æ–¹å¼ä¼ å€¼ --slot :row=item msg=æµ‹è¯•æ–‡æœ¬/slot!-- 2. å°†æ‰€æœ‰çš„å±æ€§ï¼Œæ·»åŠ åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ --!-- row: id: 2, name: å­™å¤§æ˜, age: 19 , msg: æµ‹è¯•æ–‡æœ¬\t-- æ‰€æœ‰æ·»åŠ çš„å±æ€§, éƒ½ä¼šè¢«æ”¶é›†åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ id: 3, msg: æµ‹è¯•æ–‡æœ¬ åœ¨templateä¸­, é€šè¿‡ #æ’æ§½å= obj æ¥æ”¶ï¼Œé»˜è®¤æ’æ§½åä¸º default MyTable :list=list !-- 3. é€šè¿‡template #æ’æ§½å=å˜é‡å æ¥æ”¶ -- template #default=obj button @click=del(obj.row.id) åˆ é™¤ /button /template/MyTable ç¤ºä¾‹ MyTable.vue template table class=my-table thead tr thåºå·/th thå§“å/th thå¹´çºª/th thæ“ä½œ/th /tr /thead tbody tr v-for=(item, index) in data :key=item.id td index + 1 /td td item.name /td td item.age /td td !-- 1. ç»™slotæ ‡ç­¾ï¼Œæ·»åŠ å±æ€§çš„æ–¹å¼ä¼ å€¼ -- slot :row=item msg=æµ‹è¯•æ–‡æœ¬/slot !-- 2. å°†æ‰€æœ‰çš„å±æ€§ï¼Œæ·»åŠ åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ -- !-- row: id: 2, name: å­™å¤§æ˜, age: 19 , msg: æµ‹è¯•æ–‡æœ¬ -- /td /tr /tbody /table/templatescriptexport default props: data: Array /scriptstyle scoped.my-table width: 450px; text-align: center; border: 1px solid #ccc; font-size: 24px; margin: 30px auto;.my-table thead background-color: #1f74ff; color: #fff;.my-table thead th font-weight: normal;.my-table thead tr line-height: 40px;.my-table th,.my-table td border-bottom: 1px solid #ccc; border-right: 1px solid #ccc;.my-table td:last-child border-right: none;.my-table tr:last-child td border-bottom: none;.my-table button width: 65px; height: 35px; font-size: 18px; border: 1px solid #ccc; outline: none; border-radius: 3px; cursor: pointer; background-color: #ffffff; margin-left: 5px;/style App.vue template div MyTable :data=list !-- 3. é€šè¿‡template #æ’æ§½å=å˜é‡å æ¥æ”¶ -- template #default=obj button @click=del(obj.row.id) åˆ é™¤ /button /template /MyTable MyTable :data=list2 template #default= row button @click=show(row)æŸ¥çœ‹/button /template /MyTable /div/templatescriptimport MyTable from ./components/MyTable.vueexport default data () return list: [ id: 1, name: å¼ å°èŠ±, age: 18 , id: 2, name: å­™å¤§æ˜, age: 19 , id: 3, name: åˆ˜å¾·å¿ , age: 17 , ], list2: [ id: 1, name: èµµå°äº‘, age: 18 , id: 2, name: åˆ˜è““è““, age: 19 , id: 3, name: å§œè‚–æ³°, age: 17 , ] , methods: del (id) this.list = this.list.filter(item = item.id !== id) , show (row) // console.log(row); alert(`å§“åï¼š$row.name; å¹´çºªï¼š$row.age`) , components: MyTable /script 11. è·¯ç”±å…¥é—¨11.1 å•é¡µåº”ç”¨ç¨‹åº æ¦‚å¿µ å•é¡µåº”ç”¨ç¨‹åºï¼šSPAã€Single Page Applicationã€‘æ˜¯æŒ‡æ‰€æœ‰çš„åŠŸèƒ½éƒ½åœ¨ä¸€ä¸ªhtmlé¡µé¢ä¸Šå®ç° ç¤ºä¾‹ å•é¡µåº”ç”¨ç½‘ç«™ï¼š ç½‘æ˜“äº‘éŸ³ä¹ https://music.163.com/ å¤šé¡µåº”ç”¨ç½‘ç«™ï¼šäº¬ä¸œ https://jd.com/ å•é¡µVSå¤šé¡µ å•é¡µåº”ç”¨ç±»ç½‘ç«™ï¼šç³»ç»Ÿç±»ç½‘ç«™ å†…éƒ¨ç½‘ç«™ æ–‡æ¡£ç±»ç½‘ç«™ ç§»åŠ¨ç«¯ç«™ç‚¹ å¤šé¡µåº”ç”¨ç±»ç½‘ç«™ï¼šå…¬å¸å®˜ç½‘ ç”µå•†ç±»ç½‘ç«™ 11.2 è·¯ç”± æ€è€ƒ å•é¡µé¢åº”ç”¨ç¨‹åºï¼Œä¹‹æ‰€ä»¥å¼€å‘æ•ˆç‡é«˜ï¼Œæ€§èƒ½å¥½ï¼Œç”¨æˆ·ä½“éªŒå¥½ æœ€å¤§çš„åŸå› å°±æ˜¯ï¼šé¡µé¢æŒ‰éœ€æ›´æ–° æ¯”å¦‚å½“ç‚¹å‡»ã€å‘ç°éŸ³ä¹ã€‘å’Œã€å…³æ³¨ã€‘æ—¶ï¼Œåªæ˜¯æ›´æ–°ä¸‹é¢éƒ¨åˆ†å†…å®¹ï¼Œå¯¹äºå¤´éƒ¨æ˜¯ä¸æ›´æ–°çš„ è¦æŒ‰éœ€æ›´æ–°ï¼Œé¦–å…ˆå°±éœ€è¦æ˜ç¡®ï¼šè®¿é—®è·¯å¾„å’Œ ç»„ä»¶çš„å¯¹åº”å…³ç³»ï¼ è®¿é—®è·¯å¾„ å’Œ ç»„ä»¶çš„å¯¹åº”å…³ç³»å¦‚ä½•ç¡®å®šå‘¢ï¼Ÿ è·¯ç”± ä»‹ç» ç”Ÿæ´»ä¸­çš„è·¯ç”±ï¼šè®¾å¤‡å’Œipçš„æ˜ å°„å…³ç³» Vueä¸­çš„è·¯ç”±ï¼šè·¯å¾„å’Œç»„ä»¶çš„æ˜ å°„å…³ç³» 11.3 VueRouterçš„åŸºæœ¬ä½¿ç”¨ ä½œç”¨ ä¿®æ”¹åœ°å€æ è·¯å¾„æ—¶ï¼Œåˆ‡æ¢æ˜¾ç¤ºåŒ¹é…çš„ç»„ä»¶ è¯´æ˜ Vue å®˜æ–¹çš„ä¸€ä¸ªè·¯ç”±æ’ä»¶ï¼Œæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹åŒ… å®˜ç½‘ https://v3.router.vuejs.org/zh/ ä½¿ç”¨ ä¸‹è½½ VueRouter æ¨¡å—åˆ°å½“å‰å·¥ç¨‹ï¼Œç‰ˆæœ¬3.6.5 npm i vue-router@3.6.5 main.jsä¸­å¼•å…¥VueRouter import VueRouter from vue-router å®‰è£…æ³¨å†Œ Vue.use(VueRouter) åˆ›å»ºè·¯ç”±å¯¹è±¡ const router = new VueRouter() æ³¨å…¥ï¼Œå°†è·¯ç”±å¯¹è±¡æ³¨å…¥åˆ°new Vueå®ä¾‹ä¸­ï¼Œå»ºç«‹å…³è” new Vue( render: h = h(App), router:router).$mount(#app) å½“æˆ‘ä»¬é…ç½®å®Œä»¥ä¸Š5æ­¥ä¹‹å å°±å¯ä»¥çœ‹åˆ°æµè§ˆå™¨åœ°å€æ ä¸­çš„è·¯ç”± å˜æˆäº† #çš„å½¢å¼ã€‚è¡¨ç¤ºé¡¹ç›®çš„è·¯ç”±å·²ç»è¢«Vue-Routerç®¡ç†äº† åˆ›å»ºéœ€è¦çš„ç»„ä»¶ (viewsç›®å½•)ï¼Œé…ç½®è·¯ç”±è§„åˆ™ é…ç½®å¯¼èˆªï¼Œé…ç½®è·¯ç”±å‡ºå£(è·¯å¾„åŒ¹é…çš„ç»„ä»¶æ˜¾ç¤ºçš„ä½ç½®) App.vue div class=footer_wrap a href=#/findå‘ç°éŸ³ä¹/a a href=#/myæˆ‘çš„éŸ³ä¹/a a href=#/friendæœ‹å‹/a/divdiv class=top !-- é…ç½®å¯¼èˆªï¼Œé…ç½®è·¯ç”±å‡ºå£(è·¯å¾„åŒ¹é…çš„ç»„ä»¶æ˜¾ç¤ºçš„ä½ç½®) -- router-view/router-view/div ç¤ºä¾‹ Find.vue template divæŸ¥æ‰¾éŸ³ä¹/div/templatescriptexport default name: FindMysuic;/scriptstyle/style Friend.vue template divæœ‹å‹/div/templatescriptexport default name: MyFriend;/scriptstyle/style Music.vue template divæˆ‘çš„éŸ³ä¹/div/templatescriptexport default name: MyMusic;/scriptstyle/style main.js import Vue from vueimport App from ./App.vueimport VueRouter from vue-routerVue.config.productionTip = falseVue.use(VueRouter)import Find from ./views/Find.vue;import Music from ./views/Music.vue;import Friend from ./views/Friend.vue;const router = new VueRouter( routes: [ path: /find, component: Find , path: /music, component: Music , path: /friend, component: Friend ] )new Vue( render: h = h(App), router: router).$mount(#app) App.vue template div div class=footer_wrap a href=#/findå‘ç°éŸ³ä¹/a a href=#/musicæˆ‘çš„éŸ³ä¹/a a href=#/friendæœ‹å‹/a /div div class=top !-- è·¯ç”±å‡ºå£ï¼ŒåŒ¹é…ç»„ä»¶å±•ç¤ºä½ç½® -- router-view/router-view /div /div/templatescriptexport default ;/scriptstylebody margin: 0; padding: 0;.footer_wrap position: relative; left: 0; top: 0; display: flex; width: 100%; text-align: center; background-color: #333; color: #ccc;.footer_wrap a flex: 1; text-decoration: none; padding: 20px 0; line-height: 20px; background-color: #333; color: #ccc; border: 1px solid black;.footer_wrap a:hover background-color: #555;/style 11.4 ç»„ä»¶å­˜æ”¾ç›®å½•é—®é¢˜ ç»„ä»¶åˆ†ç±» .vueæ–‡ä»¶åˆ†ä¸º2ç±»ï¼Œéƒ½æ˜¯ .vueæ–‡ä»¶ï¼ˆæœ¬è´¨æ— åŒºåˆ«ï¼‰ é¡µé¢ç»„ä»¶ ï¼ˆé…ç½®è·¯ç”±è§„åˆ™æ—¶ä½¿ç”¨çš„ç»„ä»¶ï¼‰ å¤ç”¨ç»„ä»¶ï¼ˆå¤šä¸ªç»„ä»¶ä¸­éƒ½ä½¿ç”¨åˆ°çš„ç»„ä»¶ï¼‰ å­˜æ”¾ç›®å½• åˆ†ç±»å¼€æ¥çš„ç›®çš„å°±æ˜¯ä¸ºäº† æ›´æ˜“ç»´æŠ¤ srcviewsæ–‡ä»¶å¤¹ é¡µé¢ç»„ä»¶ - é¡µé¢å±•ç¤º - é…åˆè·¯ç”±ç”¨ srccomponentsæ–‡ä»¶å¤¹ å¤ç”¨ç»„ä»¶ - å±•ç¤ºæ•°æ® - å¸¸ç”¨äºå¤ç”¨ 11.5 è·¯ç”±çš„å°è£…æŠ½ç¦» é—®é¢˜ æ‰€æœ‰çš„è·¯ç”±é…ç½®éƒ½åœ¨main.jsä¸­åˆé€‚å—ï¼Ÿ ç›®æ ‡ å°†è·¯ç”±æ¨¡å—æŠ½ç¦»å‡ºæ¥ã€‚ å¥½å¤„ï¼šæ‹†åˆ†æ¨¡å—ï¼Œåˆ©äºç»´æŠ¤ ç¤ºä¾‹ index.js import Vue from vueimport VueRouter from vue-router// è·¯å¾„ç®€å†™ï¼š// **è„šæ‰‹æ¶ç¯å¢ƒä¸‹** @æŒ‡ä»£srcç›®å½•ï¼Œå¯ä»¥ç”¨äºå¿«é€Ÿå¼•å…¥ç»„ä»¶import Find from @/views/Find.vue;import Music from @/views/Music.vue;import Friend from @/views/Friend.vue;Vue.use(VueRouter)const router = new VueRouter( routes: [ path: /find, component: Find , path: /music, component: Music , path: /friend, component: Friend ] )export default router main.js import Vue from vueimport App from ./App.vueimport router from ./router/index.jsVue.config.productionTip = falseVue.directive(focus, inserted(el) el.focus() )new Vue( render: h = h(App), router: router).$mount(#app) 12. è·¯ç”±è¿›é˜¶12.1 å£°æ˜å¼å¯¼èˆª12.1.1 å¯¼èˆªé«˜äº® éœ€æ±‚ å®ç°å¯¼èˆªé«˜äº®æ•ˆæœ å¦‚æœä½¿ç”¨aæ ‡ç­¾è¿›è¡Œè·³è½¬çš„è¯ï¼Œéœ€è¦ç»™å½“å‰è·³è½¬çš„å¯¼èˆªåŠ æ ·å¼ï¼ŒåŒæ—¶è¦ç§»é™¤ä¸Šä¸€ä¸ªaæ ‡ç­¾çš„æ ·å¼ï¼Œå¤ªéº»çƒ¦ï¼ï¼ï¼ è§£å†³æ–¹æ¡ˆ vue-router æä¾›äº†ä¸€ä¸ªå…¨å±€ç»„ä»¶ router-link (å–ä»£ a æ ‡ç­¾) èƒ½è·³è½¬ï¼Œé…ç½® to å±æ€§æŒ‡å®šè·¯å¾„(å¿…é¡») ã€‚æœ¬è´¨è¿˜æ˜¯ a æ ‡ç­¾ ï¼Œto æ— éœ€ # èƒ½é«˜äº®ï¼Œé»˜è®¤å°±ä¼šæä¾›é«˜äº®ç±»åï¼Œå¯ä»¥ç›´æ¥è®¾ç½®é«˜äº®æ ·å¼ è¯­æ³•ï¼š router-link to=pathçš„å€¼å‘ç°éŸ³ä¹/router-link div div class=footer_wrap router-link to=/findå‘ç°éŸ³ä¹/router-link router-link to=/myæˆ‘çš„éŸ³ä¹/router-link router-link to=/friendæœ‹å‹/router-link /div div class=top !-- è·¯ç”±å‡ºå£ â†’ åŒ¹é…çš„ç»„ä»¶æ‰€å±•ç¤ºçš„ä½ç½® -- router-view/router-view /div /divstyle.footer_wrap a.router-link-active background-color: purple;/style åŸç†ï¼š é€šè¿‡router-linkè‡ªå¸¦çš„ä¸¤ä¸ªæ ·å¼è¿›è¡Œé«˜äº® ä½¿ç”¨router-linkè·³è½¬åï¼Œæˆ‘ä»¬å‘ç°ã€‚å½“å‰ç‚¹å‡»çš„é“¾æ¥é»˜è®¤åŠ äº†ä¸¤ä¸ªclassçš„å€¼ router-link-exact-activeå’Œrouter-link-active æˆ‘ä»¬å¯ä»¥ç»™ä»»æ„ä¸€ä¸ªclasså±æ€§æ·»åŠ é«˜äº®æ ·å¼å³å¯å®ç°åŠŸèƒ½ åŒºåˆ«ï¼š router-link-active æ¨¡ç³ŠåŒ¹é…ï¼ˆç”¨çš„å¤šï¼‰ toâ€myâ€ å¯ä»¥åŒ¹é… my mya myb â€¦. åªè¦æ˜¯ä»¥myå¼€å¤´çš„è·¯å¾„ éƒ½å¯ä»¥å’Œ toâ€myâ€åŒ¹é…åˆ° router-link-exact-active ç²¾ç¡®åŒ¹é… toâ€myâ€ ä»…å¯ä»¥åŒ¹é… my è‡ªå®šä¹‰ç±»åï¼š é—®é¢˜ï¼š router-linkçš„ä¸¤ä¸ªé«˜äº®ç±»å å¤ªé•¿äº†ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å®šåˆ¶æ€ä¹ˆåŠ è§£å†³æ–¹æ¡ˆï¼š æˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºè·¯ç”±å¯¹è±¡æ—¶ï¼Œé¢å¤–é…ç½®ä¸¤ä¸ªé…ç½®é¡¹å³å¯ã€‚ linkActiveClasså’ŒlinkExactActiveClass const router = new VueRouter( routes: [...], linkActiveClass: ç±»å1, linkExactActiveClass: ç±»å2) 12.1.2 æŸ¥è¯¢å‚æ•°ä¼ å‚ ç›®æ ‡ åœ¨è·³è½¬è·¯ç”±æ—¶ï¼Œè¿›è¡Œä¼ å‚ æ¯”å¦‚ï¼šç°åœ¨æˆ‘ä»¬åœ¨æœç´¢é¡µç‚¹å‡»äº†çƒ­é—¨æœç´¢é“¾æ¥ï¼Œè·³è½¬åˆ°è¯¦æƒ…é¡µï¼Œéœ€è¦æŠŠç‚¹å‡»çš„å†…å®¹å¸¦åˆ°è¯¦æƒ…é¡µï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ è·³è½¬ä¼ å‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼ï¼Œåœ¨è·³è½¬çš„æ—¶å€™æŠŠæ‰€éœ€è¦çš„å‚æ•°ä¼ åˆ°å…¶ä»–é¡µé¢ä¸­ æŸ¥è¯¢å‚æ•°ä¼ å‚ åŠ¨æ€è·¯ç”±ä¼ å‚ æŸ¥è¯¢å‚æ•°ä¼ å‚ å¦‚ä½•ä¼ å‚ï¼Ÿ router-link to=/path?å‚æ•°å=å€¼/router-link å¦‚ä½•æ¥å—å‚æ•° å›ºå®šç”¨æ³•ï¼š$router.query.å‚æ•°å ç¤ºä¾‹ App.vue template div id=app div class=link router-link to=/homeé¦–é¡µ/router-link router-link to=/searchæœç´¢é¡µ/router-link /div router-view/router-view /div/templatescriptexport default ;/scriptstyle scoped.link height: 50px; line-height: 50px; background-color: #495150; display: flex; margin: -8px -8px 0 -8px; margin-bottom: 50px;.link a display: block; text-decoration: none; background-color: #ad2a26; width: 100px; text-align: center; margin-right: 5px; color: #fff; border-radius: 5px;/style Home.vue template div class=home div class=logo-box/div div class=search-box input type=text buttonæœç´¢ä¸€ä¸‹/button /div div class=hot-link çƒ­é—¨æœç´¢ï¼š !-- ç»‘å®šå‚æ•° -- router-link to=/search?key=é»‘é©¬ç¨‹åºå‘˜é»‘é©¬ç¨‹åºå‘˜/router-link router-link to=/search?key=å‰ç«¯åŸ¹è®­å‰ç«¯åŸ¹è®­/router-link router-link to=/search?key=å¦‚ä½•æˆä¸ºå‰ç«¯å¤§ç‰›å¦‚ä½•æˆä¸ºå‰ç«¯å¤§ç‰›/router-link /div /div/templatescriptexport default name: FindMusic/scriptstyle.logo-box height: 150px; background: url(@/assets/logo.jpeg) no-repeat center;.search-box display: flex; justify-content: center;.search-box input width: 400px; height: 30px; line-height: 30px; border: 2px solid #c4c7ce; border-radius: 4px 0 0 4px; outline: none;.search-box input:focus border: 2px solid #ad2a26;.search-box button width: 100px; height: 36px; border: none; background-color: #ad2a26; color: #fff; position: relative; left: -2px; border-radius: 0 4px 4px 0;.hot-link width: 508px; height: 60px; line-height: 60px; margin: 0 auto;.hot-link a margin: 0 5px;/style Search.vue template div class=search !-- æ¥æ”¶å‚æ•° -- pæœç´¢å…³é”®å­—: $route.query.key /p pæœç´¢ç»“æœ: /p ul li............./li li............./li li............./li li............./li /ul /div/templatescriptexport default name: MyFriend, created () // åœ¨createdä¸­ï¼Œè·å–è·¯ç”±å‚æ•° // this.$route.query.å‚æ•°å è·å– console.log(this.$route.query.key); /scriptstyle.search width: 400px; height: 240px; padding: 0 20px; margin: 0 auto; border: 2px solid #c4c7ce; border-radius: 5px;/style routerindex.js import Home from @/views/Homeimport Search from @/views/Searchimport Vue from vueimport VueRouter from vue-routerVue.use(VueRouter) // VueRouteræ’ä»¶åˆå§‹åŒ–// åˆ›å»ºäº†ä¸€ä¸ªè·¯ç”±å¯¹è±¡const router = new VueRouter( routes: [ path: /home, component: Home , path: /search, component: Search ])export default router main.js import Vue from vueimport App from ./App.vueimport router from ./router/indexVue.config.productionTip = falsenew Vue( render: h = h(App), router).$mount(#app) 12.1.3 åŠ¨æ€è·¯ç”±ä¼ å‚ ä¼ å‚æ–¹å¼ é…ç½®åŠ¨æ€è·¯ç”± åŠ¨æ€è·¯ç”±åé¢çš„å‚æ•°å¯ä»¥éšä¾¿èµ·åï¼Œä½†è¦æœ‰è¯­ä¹‰ const router = new VueRouter( routes: [ ..., path: /search/:words, component: Search ]) é…ç½®å¯¼èˆªé“¾æ¥ to=/path/å‚æ•°å€¼ å¯¹åº”é¡µé¢ç»„ä»¶æ¥å—å‚æ•° $route.params.å‚æ•°å paramsåé¢çš„å‚æ•°åè¦å’ŒåŠ¨æ€è·¯ç”±é…ç½®çš„å‚æ•°ä¿æŒä¸€è‡´ ç¤ºä¾‹ Home.vue template div class=home div class=logo-box/div div class=search-box input type=text buttonæœç´¢ä¸€ä¸‹/button /div div class=hot-link çƒ­é—¨æœç´¢ï¼š router-link to=/search/é»‘é©¬ç¨‹åºå‘˜é»‘é©¬ç¨‹åºå‘˜/router-link router-link to=/search/å‰ç«¯åŸ¹è®­å‰ç«¯åŸ¹è®­/router-link router-link to=/search/å¦‚ä½•æˆä¸ºå‰ç«¯å¤§ç‰›å¦‚ä½•æˆä¸ºå‰ç«¯å¤§ç‰›/router-link /div /div/templatescriptexport default name: FindMusic/scriptstyle/style Search.vue template div class=search pæœç´¢å…³é”®å­—: $route.params.words /p pæœç´¢ç»“æœ: /p ul li............./li li............./li li............./li li............./li /ul /div/templatescriptexport default name: MyFriend, created () // åœ¨createdä¸­ï¼Œè·å–è·¯ç”±å‚æ•° // this.$route.query.å‚æ•°å è·å–æŸ¥è¯¢å‚æ•° // this.$route.params.å‚æ•°å è·å–åŠ¨æ€è·¯ç”±å‚æ•° console.log(this.$route.params.words); /scriptstyle/style routerindex.js import Home from @/views/Homeimport Search from @/views/Searchimport Vue from vueimport VueRouter from vue-routerVue.use(VueRouter) // VueRouteræ’ä»¶åˆå§‹åŒ–// åˆ›å»ºäº†ä¸€ä¸ªè·¯ç”±å¯¹è±¡const router = new VueRouter( routes: [ path: /home, component: Home , path: /search/:words, component: Search ])export default router åŠ¨æ€è·¯ç”±å‚æ•°çš„å¯é€‰ç¬¦(äº†è§£)ï¼š é—®é¢˜ï¼š é…äº†è·¯ç”± path:â€search:wordsâ€ ä¸ºä»€ä¹ˆæŒ‰ä¸‹é¢æ­¥éª¤æ“ä½œï¼Œä¼šæœªåŒ¹é…åˆ°ç»„ä»¶ï¼Œæ˜¾ç¤ºç©ºç™½ï¼Ÿ åŸå›  search:words è¡¨ç¤ºï¼Œå¿…é¡»è¦ä¼ å‚æ•°ã€‚å¦‚æœä¸ä¼ å‚æ•°ï¼Œä¹Ÿå¸Œæœ›åŒ¹é…ï¼Œå¯ä»¥åŠ ä¸ªå¯é€‰ç¬¦â€ï¼Ÿâ€ const router = new VueRouter( routes: [ ... path: /search/:words?, component: Search ]) æŸ¥è¯¢å‚æ•°ä¼ å‚ VS åŠ¨æ€è·¯ç”±ä¼ å‚ï¼š æŸ¥è¯¢å‚æ•°ä¼ å‚ (æ¯”è¾ƒé€‚åˆä¼ å¤šä¸ªå‚æ•°) è·³è½¬ï¼štoâ€path?å‚æ•°åå€¼å‚æ•°å2å€¼â€ è·å–ï¼š$route.query.å‚æ•°å åŠ¨æ€è·¯ç”±ä¼ å‚ (ä¼˜é›…ç®€æ´ï¼Œä¼ å•ä¸ªå‚æ•°æ¯”è¾ƒæ–¹ä¾¿) é…ç½®åŠ¨æ€è·¯ç”±ï¼špath: â€œpath:å‚æ•°åâ€ è·³è½¬ï¼štoâ€pathå‚æ•°å€¼â€ è·å–ï¼š$route.params.å‚æ•°å æ³¨æ„ï¼šåŠ¨æ€è·¯ç”±ä¹Ÿå¯ä»¥ä¼ å¤šä¸ªå‚æ•°ï¼Œä½†ä¸€èˆ¬åªä¼ ä¸€ä¸ª æ€»ç»“ï¼š å£°æ˜å¼å¯¼èˆªè·³è½¬æ—¶, æœ‰å‡ ç§æ–¹å¼ä¼ å€¼ç»™è·¯ç”±é¡µé¢ï¼Ÿ æŸ¥è¯¢å‚æ•°ä¼ å‚ï¼ˆå¤šä¸ªå‚æ•°ï¼‰ åŠ¨æ€è·¯ç”±ä¼ å‚ï¼ˆä¸€ä¸ªå‚æ•°ï¼Œä¼˜é›…ç®€æ´ï¼‰ 12.2 Vueè·¯ç”±12.2.1 é‡å®šå‘ é—®é¢˜ ç½‘é¡µæ‰“å¼€æ—¶ï¼Œ url é»˜è®¤æ˜¯ è·¯å¾„ï¼ŒæœªåŒ¹é…åˆ°ç»„ä»¶æ—¶ï¼Œä¼šå‡ºç°ç©ºç™½ è§£å†³æ–¹æ¡ˆ é‡å®šå‘ â†’ åŒ¹é… å, å¼ºåˆ¶è·³è½¬ home è·¯å¾„ è¯­æ³• path: åŒ¹é…è·¯å¾„, redirect: é‡å®šå‘åˆ°çš„è·¯å¾„ ,æ¯”å¦‚ï¼š path:/ ,redirect:/home ç¤ºä¾‹ routerindex.js import Home from @/views/Homeimport Search from @/views/Searchimport Vue from vueimport VueRouter from vue-routerVue.use(VueRouter) // VueRouteræ’ä»¶åˆå§‹åŒ–// åˆ›å»ºäº†ä¸€ä¸ªè·¯ç”±å¯¹è±¡const router = new VueRouter( routes: [ // åŒ¹é… / é‡å®šå‘ /home path: /, redirect: /home , path: /home, component: Home , path: /search/:words?, component: Search ])export default router 12.2.2 404 ä½œç”¨ å½“è·¯å¾„æ‰¾ä¸åˆ°åŒ¹é…æ—¶ï¼Œç»™ä¸ªæç¤ºé¡µé¢ ä½ç½® 404çš„è·¯ç”±ï¼Œè™½ç„¶é…ç½®åœ¨ä»»ä½•ä¸€ä¸ªä½ç½®éƒ½å¯ä»¥ï¼Œä½†ä¸€èˆ¬éƒ½é…ç½®åœ¨å…¶ä»–è·¯ç”±è§„åˆ™çš„æœ€åé¢ è¯­æ³• path: â€œ*â€ (ä»»æ„è·¯å¾„) â€“ å‰é¢ä¸åŒ¹é…å°±å‘½ä¸­æœ€åè¿™ä¸ª import NotFind from @/views/NotFindconst router = new VueRouter( routes: [ ... path: *, component: NotFind //æœ€åä¸€ä¸ª ]) ç¤ºä¾‹ NotFound.vue template div h1404 Not Found/h1 /div/templatescriptexport default /scriptstyle/style routerindex.js ...import NotFound from @/views/NotFound...// åˆ›å»ºäº†ä¸€ä¸ªè·¯ç”±å¯¹è±¡const router = new VueRouter( routes: [ ... path: *, component: NotFound ])export default router 12.2.3 æ¨¡å¼è®¾ç½® é—®é¢˜ è·¯ç”±çš„è·¯å¾„çœ‹èµ·æ¥ä¸è‡ªç„¶, æœ‰#ï¼Œèƒ½å¦åˆ‡æˆçœŸæ­£è·¯å¾„å½¢å¼? hashè·¯ç”±(é»˜è®¤) ä¾‹å¦‚: http://localhost:8080/#/home historyè·¯ç”±(å¸¸ç”¨) ä¾‹å¦‚: http://localhost:8080/home (ä»¥åä¸Šçº¿éœ€è¦æœåŠ¡å™¨ç«¯æ”¯æŒï¼Œå¼€å‘ç¯å¢ƒwebpackç»™è§„é¿æ‰äº†historyæ¨¡å¼çš„é—®é¢˜) è¯­æ³• const router = new VueRouter( mode:histroy, //é»˜è®¤æ˜¯hash routes:[]) 12.3 ç¼–ç¨‹å¼å¯¼èˆª12.3.1 ä¸¤ç§è·¯ç”±è·³è½¬æ–¹å¼ é—®é¢˜ ç‚¹å‡»æŒ‰é’®è·³è½¬å¦‚ä½•å®ç°ï¼Ÿ è§£å†³æ–¹æ¡ˆ ç¼–ç¨‹å¼å¯¼èˆªï¼šç”¨JSä»£ç æ¥è¿›è¡Œè·³è½¬ è¯­æ³• path è·¯å¾„è·³è½¬ ï¼ˆç®€æ˜“æ–¹ä¾¿ï¼‰ name å‘½åè·¯ç”±è·³è½¬ (é€‚åˆ path è·¯å¾„é•¿çš„åœºæ™¯) ç¤ºä¾‹ pathè·¯å¾„è·³è½¬è¯­æ³• è¯­æ³• ç‰¹ç‚¹ï¼šç®€æ˜“æ–¹ä¾¿ //ç®€å•å†™æ³•this.$router.push(è·¯ç”±è·¯å¾„)//å®Œæ•´å†™æ³•this.$router.push( path: è·¯ç”±è·¯å¾„) ç¤ºä¾‹ Home.vue template div class=home div class=logo-box/div div class=search-box input type=text button @click=goSearchæœç´¢ä¸€ä¸‹/button /div div class=hot-link çƒ­é—¨æœç´¢ï¼š router-link to=/search/é»‘é©¬ç¨‹åºå‘˜é»‘é©¬ç¨‹åºå‘˜/router-link router-link to=/search/å‰ç«¯åŸ¹è®­å‰ç«¯åŸ¹è®­/router-link router-link to=/search/å¦‚ä½•æˆä¸ºå‰ç«¯å¤§ç‰›å¦‚ä½•æˆä¸ºå‰ç«¯å¤§ç‰›/router-link /div /div/templatescriptexport default name: FindMusic, methods: goSearch () // 1. é€šè¿‡è·¯å¾„çš„æ–¹å¼è·³è½¬ // (1) this.$router.push(è·¯ç”±è·¯å¾„) [ç®€å†™] // this.$router.push(/search) // (2) this.$router.push( [å®Œæ•´å†™æ³•] // path: è·¯ç”±è·¯å¾„ // ) this.$router.push( path: /search ) /scriptstyle/style nameå‘½åè·¯ç”±è·³è½¬ è¯­æ³• ç‰¹ç‚¹ï¼šé€‚åˆ path è·¯å¾„é•¿çš„åœºæ™¯ è·¯ç”±è§„åˆ™ï¼Œå¿…é¡»é…ç½®nameé…ç½®é¡¹ name: è·¯ç”±å, path: /path/xxx, component: XXX , é€šè¿‡nameæ¥è¿›è¡Œè·³è½¬ this.$router.push( name: è·¯ç”±å) ç¤ºä¾‹ routerindex.js import Home from @/views/Homeimport Search from @/views/Searchimport NotFound from @/views/NotFoundimport Vue from vueimport VueRouter from vue-routerVue.use(VueRouter) // VueRouteræ’ä»¶åˆå§‹åŒ–// åˆ›å»ºäº†ä¸€ä¸ªè·¯ç”±å¯¹è±¡const router = new VueRouter( // æ³¨æ„ï¼šä¸€æ—¦é‡‡ç”¨äº† history æ¨¡å¼ï¼Œåœ°å€æ å°±æ²¡æœ‰ #ï¼Œéœ€è¦åå°é…ç½®è®¿é—®è§„åˆ™ mode: history, routes: [ path: /, redirect: /home , path: /home, component: Home , // é…ç½®name name: search, path: /search/:words?, component: Search , path: *, component: NotFound ])export default router Home.vue template div class=home div class=logo-box/div div class=search-box input type=text button @click=goSearchæœç´¢ä¸€ä¸‹/button /div div class=hot-link çƒ­é—¨æœç´¢ï¼š router-link to=/search/é»‘é©¬ç¨‹åºå‘˜é»‘é©¬ç¨‹åºå‘˜/router-link router-link to=/search/å‰ç«¯åŸ¹è®­å‰ç«¯åŸ¹è®­/router-link router-link to=/search/å¦‚ä½•æˆä¸ºå‰ç«¯å¤§ç‰›å¦‚ä½•æˆä¸ºå‰ç«¯å¤§ç‰›/router-link /div /div/templatescriptexport default name: FindMusic, methods: goSearch () // 2. é€šè¿‡å‘½åè·¯ç”±çš„æ–¹å¼è·³è½¬ (éœ€è¦ç»™è·¯ç”±èµ·åå­—) é€‚åˆé•¿è·¯å¾„ // this.$router.push( // name: è·¯ç”±å // ) this.$router.push( name: search ) /scriptstyle/style 12.3.2 pathè·¯å¾„è·³è½¬ä¼ å‚ é—®é¢˜ ç‚¹å‡»æœç´¢æŒ‰é’®ï¼Œè·³è½¬éœ€è¦æŠŠæ–‡æœ¬æ¡†ä¸­è¾“å…¥çš„å†…å®¹ä¼ åˆ°ä¸‹ä¸€ä¸ªé¡µé¢å¦‚ä½•å®ç°ï¼Ÿ ä¸¤ç§ä¼ å‚æ–¹å¼ æŸ¥è¯¢å‚æ•° åŠ¨æ€è·¯ç”±ä¼ å‚ ä¼ å‚ ä¸¤ç§è·³è½¬æ–¹å¼ï¼Œå¯¹äºä¸¤ç§ä¼ å‚æ–¹å¼éƒ½æ”¯æŒï¼š path è·¯å¾„è·³è½¬ä¼ å‚ name å‘½åè·¯ç”±è·³è½¬ä¼ å‚ pathè·¯å¾„è·³è½¬ä¼ å‚ï¼ˆqueryä¼ å‚ï¼‰ è¯­æ³• //ç®€å•å†™æ³•this.$router.push(/è·¯å¾„?å‚æ•°å1=å‚æ•°å€¼1å‚æ•°2=å‚æ•°å€¼2)//å®Œæ•´å†™æ³•this.$router.push( path: /è·¯å¾„, query: å‚æ•°å1: å‚æ•°å€¼1, å‚æ•°å2: å‚æ•°å€¼2 ) æ¥å—å‚æ•°çš„æ–¹å¼ä¾ç„¶æ˜¯ï¼š$route.query.å‚æ•°å ç¤ºä¾‹ Home.vue template div class=home div class=logo-box/div div class=search-box input v-model=inpValue type=text button @click=goSearchæœç´¢ä¸€ä¸‹/button /div div class=hot-link çƒ­é—¨æœç´¢ï¼š router-link to=/search/é»‘é©¬ç¨‹åºå‘˜é»‘é©¬ç¨‹åºå‘˜/router-link router-link to=/search/å‰ç«¯åŸ¹è®­å‰ç«¯åŸ¹è®­/router-link router-link to=/search/å¦‚ä½•æˆä¸ºå‰ç«¯å¤§ç‰›å¦‚ä½•æˆä¸ºå‰ç«¯å¤§ç‰›/router-link /div /div/templatescriptexport default name: FindMusic, data () return inpValue: , methods: goSearch () // this.$router.push(è·¯ç”±è·¯å¾„?å‚æ•°å=å‚æ•°å€¼) // this.$router.push(`/search?key=$this.inpValue`) // (2) this.$router.push( [å®Œæ•´å†™æ³•] æ›´é€‚åˆä¼ å‚ // path: è·¯ç”±è·¯å¾„ // query: // å‚æ•°å: å‚æ•°å€¼, // å‚æ•°å: å‚æ•°å€¼ // // ) // this.$router.push( // path: /search, // query: // key: this.inpValue // // ) /scriptstyle/style pathè·¯å¾„è·³è½¬ä¼ å‚ï¼ˆåŠ¨æ€è·¯ç”±ä¼ å‚ï¼‰ è¯­æ³•ï¼š ç»‘å®šåŠ¨æ€è·¯ç”±å‚æ•° name: search, path: /search/:å‚æ•°å?, component: Search , ä¼ å‚ //ç®€å•å†™æ³•this.$router.push(/è·¯å¾„/å‚æ•°å€¼)//å®Œæ•´å†™æ³•this.$router.push( path: /è·¯å¾„/å‚æ•°å€¼) æ¥æ”¶ pæœç´¢å…³é”®å­—: $route.params.words /p æ¥å—å‚æ•°çš„æ–¹å¼ä¾ç„¶æ˜¯ï¼š$route.params.å‚æ•°å ç¤ºä¾‹ï¼š Home.vue template div class=home div class=logo-box/div div class=search-box input v-model=inpValue type=text button @click=goSearchæœç´¢ä¸€ä¸‹/button /div div class=hot-link çƒ­é—¨æœç´¢ï¼š router-link to=/search/é»‘é©¬ç¨‹åºå‘˜é»‘é©¬ç¨‹åºå‘˜/router-link router-link to=/search/å‰ç«¯åŸ¹è®­å‰ç«¯åŸ¹è®­/router-link router-link to=/search/å¦‚ä½•æˆä¸ºå‰ç«¯å¤§ç‰›å¦‚ä½•æˆä¸ºå‰ç«¯å¤§ç‰›/router-link /div /div/templatescriptexport default name: FindMusic, data () return inpValue: , methods: goSearch () // this.$router.push(`/search/$this.inpValue`) this.$router.push( path: `/search/$this.inpValue` ) /scriptstyle/style 12.3.3 nameå‘½åè·¯ç”±ä¼ å‚ name å‘½åè·¯ç”±è·³è½¬ä¼ å‚ (queryä¼ å‚) è¯­æ³• this.$router.push( name: è·¯ç”±åå­—, query: å‚æ•°å1: å‚æ•°å€¼1, å‚æ•°å2: å‚æ•°å€¼2 ) ç¤ºä¾‹ template div class=home div class=logo-box/div div class=search-box input v-model=inpValue type=text button @click=goSearchæœç´¢ä¸€ä¸‹/button /div div class=hot-link çƒ­é—¨æœç´¢ï¼š router-link to=/search/é»‘é©¬ç¨‹åºå‘˜é»‘é©¬ç¨‹åºå‘˜/router-link router-link to=/search/å‰ç«¯åŸ¹è®­å‰ç«¯åŸ¹è®­/router-link router-link to=/search/å¦‚ä½•æˆä¸ºå‰ç«¯å¤§ç‰›å¦‚ä½•æˆä¸ºå‰ç«¯å¤§ç‰›/router-link /div /div/templatescriptexport default name: FindMusic, data () return inpValue: , methods: goSearch () // 2. é€šè¿‡å‘½åè·¯ç”±çš„æ–¹å¼è·³è½¬ (éœ€è¦ç»™è·¯ç”±èµ·åå­—) é€‚åˆé•¿è·¯å¾„ // this.$router.push( // name: è·¯ç”±å // query: å‚æ•°å: å‚æ•°å€¼ // ) this.$router.push( name: search, query: key: this.inpValue ) /scriptstyle/style name å‘½åè·¯ç”±è·³è½¬ä¼ å‚ (åŠ¨æ€è·¯ç”±ä¼ å‚) è¯­æ³• this.$router.push( name: è·¯ç”±åå­—, params: å‚æ•°å: å‚æ•°å€¼, ) ç¤ºä¾‹ template div class=home div class=logo-box/div div class=search-box input v-model=inpValue type=text button @click=goSearchæœç´¢ä¸€ä¸‹/button /div div class=hot-link çƒ­é—¨æœç´¢ï¼š router-link to=/search/é»‘é©¬ç¨‹åºå‘˜é»‘é©¬ç¨‹åºå‘˜/router-link router-link to=/search/å‰ç«¯åŸ¹è®­å‰ç«¯åŸ¹è®­/router-link router-link to=/search/å¦‚ä½•æˆä¸ºå‰ç«¯å¤§ç‰›å¦‚ä½•æˆä¸ºå‰ç«¯å¤§ç‰›/router-link /div /div/templatescriptexport default name: FindMusic, data () return inpValue: , methods: goSearch () // 2. é€šè¿‡å‘½åè·¯ç”±çš„æ–¹å¼è·³è½¬ (éœ€è¦ç»™è·¯ç”±èµ·åå­—) é€‚åˆé•¿è·¯å¾„ // this.$router.push( // name: è·¯ç”±å // params: å‚æ•°å: å‚æ•°å€¼ // ) this.$router.push( name: search, params: // ä¸åŠ¨æ€è·¯ç”±ç»‘å®šçš„å‚æ•°åä¸€è‡´ words: this.inpValue ) /scriptstyle/style 12.3.4 ä¼ å‚æ€»ç»“ ç¼–ç¨‹å¼å¯¼èˆªï¼Œå¦‚ä½•è·³è½¬ä¼ å‚ï¼Ÿ pathè·¯å¾„è·³è½¬ queryä¼ å‚ this.$router.push(/è·¯å¾„?å‚æ•°å1=å‚æ•°å€¼1å‚æ•°2=å‚æ•°å€¼2)this.$router.push( path: /è·¯å¾„, query: å‚æ•°å1: å‚æ•°å€¼1, å‚æ•°å2: å‚æ•°å€¼2 ) åŠ¨æ€è·¯ç”±ä¼ å‚ this.$router.push(/è·¯å¾„/å‚æ•°å€¼)this.$router.push( path: /è·¯å¾„/å‚æ•°å€¼) nameå‘½åè·¯ç”±è·³è½¬ queryä¼ å‚ this.$router.push( name: è·¯ç”±åå­—, query: å‚æ•°å1: å‚æ•°å€¼1, å‚æ•°å2: å‚æ•°å€¼2 ) åŠ¨æ€è·¯ç”±ä¼ å‚ (éœ€è¦é…åŠ¨æ€è·¯ç”±) this.$router.push( name: è·¯ç”±åå­—, params: å‚æ•°å: å‚æ•°å€¼, ) 12.4 äºŒçº§è·¯ç”±é…ç½® äºŒçº§è·¯ç”±ä¹Ÿå«åµŒå¥—è·¯ç”±ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åµŒå¥—ä¸‰çº§ã€å››çº§â€¦ ä½¿ç”¨åœºæ™¯ å½“åœ¨é¡µé¢ä¸­ç‚¹å‡»é“¾æ¥è·³è½¬ï¼Œåªæ˜¯éƒ¨åˆ†å†…å®¹åˆ‡æ¢æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åµŒå¥—è·¯ç”± è¯­æ³• åœ¨ä¸€çº§è·¯ç”±ä¸‹ï¼Œé…ç½®childrenå±æ€§å³å¯ é…ç½®äºŒçº§è·¯ç”±çš„å‡ºå£ åœ¨ä¸€çº§è·¯ç”±ä¸‹ï¼Œé…ç½®childrenå±æ€§ æ³¨æ„:ä¸€çº§çš„è·¯ç”±path éœ€è¦åŠ  / äºŒçº§è·¯ç”±çš„pathä¸éœ€è¦åŠ  / const router = new VueRouter( routes: [ path: /, component: Layout, children:[ //childrenä¸­çš„é…ç½®é¡¹ è·Ÿä¸€çº§è·¯ç”±ä¸­çš„é…ç½®é¡¹ä¸€æ¨¡ä¸€æ · path:xxxx,component:xxxx.vue, path:xxxx,component:xxxx.vue, ] ]) æŠ€å·§ï¼šäºŒçº§è·¯ç”±åº”è¯¥é…ç½®åˆ°å“ªä¸ªä¸€çº§è·¯ç”±ä¸‹å‘¢ï¼Ÿ è¿™äº›äºŒçº§è·¯ç”±å¯¹åº”çš„ç»„ä»¶æ¸²æŸ“åˆ°å“ªä¸ªä¸€çº§è·¯ç”±ä¸‹ï¼Œchildrenå°±é…ç½®åˆ°å“ªä¸ªè·¯ç”±ä¸‹è¾¹ é…ç½®äºŒçº§è·¯ç”±çš„å‡ºå£ æ³¨æ„ï¼š é…ç½®äº†åµŒå¥—è·¯ç”±ï¼Œä¸€å®šé…ç½®å¯¹åº”çš„è·¯ç”±å‡ºå£ï¼Œå¦åˆ™ä¸ä¼šæ¸²æŸ“å‡ºå¯¹åº”çš„ç»„ä»¶ Layout.vue template div class=h5-wrapper div class=content router-view/router-view /div .... /div/template ç¤ºä¾‹ routerindex.js ...import Article from @/views/Article.vueimport Collect from @/views/Collect.vueimport Like from @/views/Like.vueimport User from @/views/User.vue...const router = new VueRouter( routes: [ path: /, component: Layout, redirect: /article, children:[ path:/article, component:Article , path:/collect, component:Collect , path:/like, component:Like , path:/user, component:User ] , .... ]) Layout.vue template div class=h5-wrapper div class=content !-- å†…å®¹éƒ¨åˆ† -- router-view/router-view /div nav class=tabbar a href=#/articleé¢ç»/a a href=#/collectæ”¶è—/a a href=#/likeå–œæ¬¢/a a href=#/useræˆ‘çš„/a /nav /div/template 12.5 ç‚¹å‡»å›é€€è·³è½¬ è¯­æ³• $route.back() ç¤ºä¾‹ template div class=article-detail-page nav class=navspan class=back @click=$router.back()lt;/span é¢ç»è¯¦æƒ…/nav .... /div/template 13. ç¼“å­˜ç»„ä»¶ é—®é¢˜ ä»é¢ç»åˆ—è¡¨ ç‚¹åˆ° è¯¦æƒ…é¡µï¼Œåˆç‚¹è¿”å›ï¼Œæ•°æ®é‡æ–°åŠ è½½äº† â†’ å¸Œæœ›å›åˆ°åŸæ¥çš„ä½ç½® åŸå›  å½“è·¯ç”±è¢«è·³è½¬åï¼ŒåŸæ¥æ‰€çœ‹åˆ°çš„ç»„ä»¶å°±è¢«é”€æ¯äº†ï¼ˆä¼šæ‰§è¡Œç»„ä»¶å†…çš„beforeDestroyå’Œdestroyedç”Ÿå‘½å‘¨æœŸé’©å­ï¼‰ï¼Œé‡æ–°è¿”å›åç»„ä»¶åˆè¢«é‡æ–°åˆ›å»ºäº†ï¼ˆä¼šæ‰§è¡Œç»„ä»¶å†…çš„beforeCreate,created,beforeMount,Mountedç”Ÿå‘½å‘¨æœŸé’©å­ï¼‰ï¼Œæ‰€ä»¥æ•°æ®è¢«åŠ è½½äº† è§£å†³æ–¹æ¡ˆ åˆ©ç”¨keep-aliveæŠŠåŸæ¥çš„ç»„ä»¶ç»™ç¼“å­˜ä¸‹æ¥ ä»€ä¹ˆæ˜¯keep-alive? keep-alive æ˜¯ Vue çš„å†…ç½®ç»„ä»¶ï¼Œå½“å®ƒåŒ…è£¹åŠ¨æ€ç»„ä»¶æ—¶ï¼Œä¼šç¼“å­˜ä¸æ´»åŠ¨çš„ç»„ä»¶å®ä¾‹ï¼Œè€Œä¸æ˜¯é”€æ¯å®ƒä»¬ã€‚ keep-alive æ˜¯ä¸€ä¸ªæŠ½è±¡ç»„ä»¶ï¼šå®ƒè‡ªèº«ä¸ä¼šæ¸²æŸ“æˆä¸€ä¸ª DOM å…ƒç´ ï¼Œä¹Ÿä¸ä¼šå‡ºç°åœ¨çˆ¶ç»„ä»¶ä¸­ã€‚ ä¼˜ç‚¹ï¼š åœ¨ç»„ä»¶åˆ‡æ¢è¿‡ç¨‹ä¸­æŠŠåˆ‡æ¢å‡ºå»çš„ç»„ä»¶ä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œé˜²æ­¢é‡å¤æ¸²æŸ“DOMï¼Œ å‡å°‘åŠ è½½æ—¶é—´åŠæ€§èƒ½æ¶ˆè€—ï¼Œæé«˜ç”¨æˆ·ä½“éªŒæ€§ã€‚ App.vue template div class=h5-wrapper keep-alive router-view/router-view /keep-alive /div/template é—®é¢˜ï¼š ç¼“å­˜äº†æ‰€æœ‰è¢«åˆ‡æ¢çš„ç»„ä»¶ï¼Œå¯¼è‡´ç‚¹å‡»è¿›å…¥è¯¦ç»†é¡µé¢ä¸ä¼šåˆ·æ–° keep-aliveçš„ä¸‰ä¸ªå±æ€§ï¼š â‘  include ï¼š ç»„ä»¶åæ•°ç»„ï¼Œåªæœ‰åŒ¹é…çš„ç»„ä»¶ä¼šè¢«ç¼“å­˜ â‘¡ exclude ï¼š ç»„ä»¶åæ•°ç»„ï¼Œä»»ä½•åŒ¹é…çš„ç»„ä»¶éƒ½ä¸ä¼šè¢«ç¼“å­˜ â‘¢ max ï¼š æœ€å¤šå¯ä»¥ç¼“å­˜å¤šå°‘ç»„ä»¶å®ä¾‹ App.vue template div class=h5-wrapper keep-alive :include=[LayoutPage] router-view/router-view /keep-alive /div/template---------------------------------------------template div class=h5-wrapper keep-alive :include=keepArr router-view/router-view /keep-alive /div/templatescriptexport default name: h5-wrapper, data() return keepArr: [LayoutPage] ; ;/script é¢å¤–çš„ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­ï¼š keep-aliveçš„ä½¿ç”¨ä¼šè§¦å‘ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•° activated å½“ç»„ä»¶è¢«æ¿€æ´»ï¼ˆä½¿ç”¨ï¼‰çš„æ—¶å€™è§¦å‘ â†’ è¿›å…¥è¿™ä¸ªé¡µé¢çš„æ—¶å€™è§¦å‘ deactivated å½“ç»„ä»¶ä¸è¢«ä½¿ç”¨çš„æ—¶å€™è§¦å‘ â†’ ç¦»å¼€è¿™ä¸ªé¡µé¢çš„æ—¶å€™è§¦å‘ ç»„ä»¶ç¼“å­˜åå°±ä¸ä¼šæ‰§è¡Œç»„ä»¶çš„created, mounted, destroyed ç­‰é’©å­äº†ï¼Œæ‰€ä»¥å…¶æä¾›äº†actived å’Œdeactivedé’©å­ï¼Œå¸®æˆ‘ä»¬å®ç°ä¸šåŠ¡éœ€æ±‚ã€‚ 14. Vuex14.1 æ¦‚è¿° æ˜¯ä»€ä¹ˆ Vuex æ˜¯ä¸€ä¸ª Vue çš„ çŠ¶æ€ç®¡ç†å·¥å…·ï¼ŒçŠ¶æ€å°±æ˜¯æ•°æ®ã€‚å¤§ç™½è¯ï¼šVuex æ˜¯ä¸€ä¸ªæ’ä»¶ï¼Œå¯ä»¥å¸®æˆ‘ä»¬ç®¡ç† Vue é€šç”¨çš„æ•°æ® (å¤šç»„ä»¶å…±äº«çš„æ•°æ®)ã€‚ä¾‹å¦‚ï¼šè´­ç‰©è½¦æ•°æ® ä¸ªäººä¿¡æ¯æ•° ä½¿ç”¨åœºæ™¯ æŸä¸ªçŠ¶æ€ åœ¨ å¾ˆå¤šä¸ªç»„ä»¶ æ¥ä½¿ç”¨ (ä¸ªäººä¿¡æ¯) å¤šä¸ªç»„ä»¶ å…±åŒç»´æŠ¤ ä¸€ä»½æ•°æ® (è´­ç‰©è½¦) ä¼˜åŠ¿ å…±åŒç»´æŠ¤ä¸€ä»½æ•°æ®ï¼Œæ•°æ®é›†ä¸­åŒ–ç®¡ç† å“åº”å¼å˜åŒ– æ“ä½œç®€æ´ (vuexæä¾›äº†ä¸€äº›è¾…åŠ©å‡½æ•°) æ³¨æ„ ä¸æ˜¯æ‰€æœ‰çš„åœºæ™¯éƒ½é€‚ç”¨äºvuexï¼Œåªæœ‰åœ¨å¿…è¦çš„æ—¶å€™æ‰ä½¿ç”¨vuex ä½¿ç”¨äº†vuexä¹‹åï¼Œä¼šé™„åŠ æ›´å¤šçš„æ¡†æ¶ä¸­çš„æ¦‚å¿µè¿›æ¥ï¼Œå¢åŠ äº†é¡¹ç›®çš„å¤æ‚åº¦ ï¼ˆæ•°æ®çš„æ“ä½œæ›´ä¾¿æ·ï¼Œæ•°æ®çš„æµåŠ¨æ›´æ¸…æ™°ï¼‰ 14.2 ä½¿ç”¨ éœ€æ±‚ æ•ˆæœæ˜¯ä¸‰ä¸ªç»„ä»¶å…±äº«ä¸€ä»½æ•°æ®: ä»»æ„ä¸€ä¸ªç»„ä»¶éƒ½å¯ä»¥ä¿®æ”¹æ•°æ® ä¸‰ä¸ªç»„ä»¶çš„æ•°æ®æ˜¯åŒæ­¥çš„ åˆ›å»ºé¡¹ç›® vue create vuex-demo åˆ›å»ºä¸‰ä¸ªç»„ä»¶ |-components|--Son1.vue|--Son2.vue|-App.vue ç¤ºä¾‹ App.vue template div id=app h1æ ¹ç»„ä»¶/h1 input type=text Son1/Son1 hr Son2/Son2 /div/templatescriptimport Son1 from ./components/Son1.vueimport Son2 from ./components/Son2.vueexport default name: app, data: function () return , components: Son1, Son2 /scriptstyle#app width: 600px; margin: 20px auto; border: 3px solid #ccc; border-radius: 3px; padding: 10px;/style main.js import Vue from vueimport App from ./App.vueVue.config.productionTip = falsenew Vue( render: h = h(App)).$mount(#app) Son1.vue template div class=box h2Son1 å­ç»„ä»¶/h2 ä»vuexä¸­è·å–çš„å€¼: label/label br buttonå€¼ + 1/button /div/templatescriptexport default name: Son1Com/scriptstyle lang=css scoped.box border: 3px solid #ccc; width: 400px; padding: 10px; margin: 20px;h2 margin-top: 10px;/style Son2.vue template div class=box h2Son2 å­ç»„ä»¶/h2 ä»vuexä¸­è·å–çš„å€¼:label/label br / buttonå€¼ - 1/button /div/templatescriptexport default name: Son2Com/scriptstyle lang=css scoped.box border: 3px solid #ccc; width: 400px; padding: 10px; margin: 20px;h2 margin-top: 10px;/style å¼•å…¥vuex å®‰è£…vuex å®‰è£…vuexä¸vue-routerç±»ä¼¼ï¼Œvuexæ˜¯ä¸€ä¸ªç‹¬ç«‹å­˜åœ¨çš„æ’ä»¶ï¼Œå¦‚æœè„šæ‰‹æ¶åˆå§‹åŒ–æ²¡æœ‰é€‰ vuexï¼Œå°±éœ€è¦é¢å¤–å®‰è£…ã€‚ yarn add vuex@3 æˆ–è€… npm i vuex@3 æ–°å»º store/index.js ä¸“é—¨å­˜æ”¾ vuex ä¸ºäº†ç»´æŠ¤é¡¹ç›®ç›®å½•çš„æ•´æ´ï¼Œåœ¨srcç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªstoreç›®å½•å…¶ä¸‹æ”¾ç½®ä¸€ä¸ªindex.jsæ–‡ä»¶ã€‚ (å’Œ router/index.js ç±»ä¼¼) åˆ›å»ºä»“åº“ store/index.js // å¯¼å…¥ vueimport Vue from vue// å¯¼å…¥ vueximport Vuex from vuex// vuexä¹Ÿæ˜¯vueçš„æ’ä»¶, éœ€è¦useä¸€ä¸‹, è¿›è¡Œæ’ä»¶çš„å®‰è£…åˆå§‹åŒ–Vue.use(Vuex)// åˆ›å»ºä»“åº“ storeconst store = new Vuex.Store()// å¯¼å‡ºä»“åº“export default store åœ¨ main.js ä¸­å¯¼å…¥æŒ‚è½½åˆ° Vue å®ä¾‹ä¸Š import Vue from vueimport App from ./App.vueimport store from @/store/indexVue.config.productionTip = falsenew Vue( render: h = h(App), store).$mount(#app) 14.3 æ ¸å¿ƒæ¦‚å¿µ-state æ¦‚å¿µ Stateæä¾›å”¯ä¸€çš„å…¬å…±æ•°æ®æºï¼Œæ‰€æœ‰å…±äº«çš„æ•°æ®éƒ½è¦ç»Ÿä¸€æ”¾åˆ°Storeä¸­çš„Stateä¸­å­˜å‚¨ã€‚ æ‰“å¼€é¡¹ç›®ä¸­çš„store.jsæ–‡ä»¶ï¼Œåœ¨stateå¯¹è±¡ä¸­å¯ä»¥æ·»åŠ æˆ‘ä»¬è¦å…±äº«çš„æ•°æ®ã€‚ // åˆ›å»ºä»“åº“ storeconst store = new Vuex.Store( // state çŠ¶æ€, å³æ•°æ®, ç±»ä¼¼äºvueç»„ä»¶ä¸­çš„data, // åŒºåˆ«ï¼š // 1.data æ˜¯ç»„ä»¶è‡ªå·±çš„æ•°æ®, // 2.state ä¸­çš„æ•°æ®æ•´ä¸ªvueé¡¹ç›®çš„ç»„ä»¶éƒ½èƒ½è®¿é—®åˆ° state: count: 101 ) è®¿é—® é—®é¢˜: å¦‚ä½•è·å–count? æ¨¡æ¿ä¸­ $store.state.xxx ç»„ä»¶ä¸­ this.$store.state.xxx JSæ¨¡å—ä¸­ store.state.xxx ç¤ºä¾‹ æ¨¡æ¿ä¸­ä½¿ç”¨ æ¨¡æ¿ä¸­å¯ä»¥ä½¿ç”¨ $store è·å–åˆ°vuexä¸­çš„storeå¯¹è±¡å®ä¾‹ï¼Œå¯é€šè¿‡stateå±æ€§å±æ€§è·å–countï¼Œ å¦‚ä¸‹ template\th1stateçš„æ•°æ® - $store.state.count /h1/template ç»„ä»¶é€»è¾‘ä¸­ä½¿ç”¨ å°†stateå±æ€§å®šä¹‰åœ¨è®¡ç®—å±æ€§ä¸­ https://vuex.vuejs.org/zh/guide/state.html h1stateçš„æ•°æ® - count /h1scriptexport default name: Son1Com, // æŠŠstateä¸­æ•°æ®ï¼Œå®šä¹‰åœ¨ç»„ä»¶å†…çš„è®¡ç®—å±æ€§ä¸­ computed: count() return this.$store.state.count /script jsæ–‡ä»¶ä¸­ä½¿ç”¨ //main.jsimport store from @/storeconsole.log(store.state.count) è¾…åŠ©å‡½æ•°ï¼š mapStateæ˜¯è¾…åŠ©å‡½æ•°ï¼Œå¸®åŠ©æˆ‘ä»¬æŠŠstoreä¸­çš„æ•°æ®æ˜ å°„åˆ° ç»„ä»¶çš„è®¡ç®—å±æ€§ä¸­, å®ƒå±äºä¸€ç§æ–¹ä¾¿çš„ç”¨æ³• å¯¼å…¥mapState scriptimport mapState from vuex;/script é‡‡ç”¨æ•°ç»„å½¢å¼å¼•å…¥stateå±æ€§ export default name: Son2Com, computed: ...mapState([count]) ä¸Šé¢ä»£ç çš„æœ€ç»ˆå¾—åˆ°çš„æ˜¯ ç±»ä¼¼äºexport default name: Son1Com, computed: count() return this.$store.state.count åˆ©ç”¨å±•å¼€è¿ç®—ç¬¦å°†å¯¼å‡ºçš„çŠ¶æ€æ˜ å°„ç»™è®¡ç®—å±æ€§ computed: ...mapState([count]) ç¤ºä¾‹ï¼š template div class=box h2Son2 å­ç»„ä»¶/h2 ä»vuexä¸­è·å–çš„å€¼:label count /label br / buttonå€¼ - 1/button /div/templatescriptimport mapState from vuex;export default name: Son2Com, computed: ...mapState([count]) /scriptstyle lang=css scoped.box border: 3px solid #ccc; width: 400px; padding: 10px; margin: 20px;h2 margin-top: 10px;/style 14.4 ä¸¥æ ¼æ¨¡å¼ ç›®æ ‡ æ˜ç¡® vuex åŒæ ·éµå¾ªå•å‘æ•°æ®æµï¼Œç»„ä»¶ä¸­ä¸èƒ½ç›´æ¥ä¿®æ”¹ä»“åº“çš„æ•°æ® ç›´æ¥åœ¨ç»„ä»¶ä¸­ä¿®æ”¹Vuexä¸­stateçš„å€¼ button @click=handleAddå€¼ + 1/buttonmethods: handleAdd (n) // é”™è¯¯ä»£ç (vueé»˜è®¤ä¸ä¼šç›‘æµ‹ï¼Œç›‘æµ‹éœ€è¦æˆæœ¬) this.$store.state.count++ // console.log(this.$store.state.count) , å¼€å¯ä¸¥æ ¼æ¨¡å¼ é€šè¿‡ strict: true å¯ä»¥å¼€å¯ä¸¥æ ¼æ¨¡å¼,å¼€å¯ä¸¥æ ¼æ¨¡å¼åï¼Œç›´æ¥ä¿®æ”¹stateä¸­çš„å€¼ä¼šæŠ¥é”™ stateæ•°æ®çš„ä¿®æ”¹åªèƒ½é€šè¿‡mutationsï¼Œå¹¶ä¸”mutationså¿…é¡»æ˜¯åŒæ­¥çš„ 14.5 æ ¸å¿ƒæ¦‚å¿µ-mutations mutationsæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­å­˜æ”¾ä¿®æ”¹stateçš„æ–¹æ³• 14.5.1 æ— å‚mutations å®šä¹‰ const store = new Vuex.Store( state: count: 0 , // å®šä¹‰mutations mutations: ) æ ¼å¼è¯´æ˜ mutationsæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­å­˜æ”¾ä¿®æ”¹stateçš„æ–¹æ³• mutations: // æ–¹æ³•é‡Œå‚æ•° ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å½“å‰storeçš„stateå±æ€§ // payload è½½è· è¿è¾“å‚æ•° è°ƒç”¨mutaiionsçš„æ—¶å€™ å¯ä»¥ä¼ é€’å‚æ•° ä¼ é€’è½½è· addCount (state) state.count += 1 , ç»„ä»¶æäº¤mutations this.$store.commit(addCount) ç¤ºä¾‹ index.js import Vue from vueimport Vuex from vuexVue.use(Vuex)const store = new Vuex.Store( state: count: 101 , // æ‰€æœ‰mutationå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ï¼Œéƒ½æ˜¯ state mutations: addCount(state) state.count += 1 )export default store Son1.vue template div class=box h2Son1 å­ç»„ä»¶/h2 ä»vuexä¸­è·å–çš„å€¼: label $store.state.count /label hr ä»vuexä¸­è·å–çš„å€¼: label count /label br button @click=addå€¼ + 1/button /div/templatescriptexport default name: Son1Com, computed: count() return this.$store.state.count , methods: add() this.$store.commit(addCount) /scriptstyle lang=css scoped.box border: 3px solid #ccc; width: 400px; padding: 10px; margin: 20px;h2 margin-top: 10px;/style æ€»ç»“ é€šè¿‡mutationsä¿®æ”¹stateçš„æ­¥éª¤ å®šä¹‰ mutations å¯¹è±¡ï¼Œå¯¹è±¡ä¸­å­˜æ”¾ä¿®æ”¹ state çš„æ–¹æ³• ç»„ä»¶ä¸­æäº¤è°ƒç”¨ mutations(é€šè¿‡this.$store.commit(mutationsçš„æ–¹æ³•å)) 14.5.2 å¸¦å‚mutations è¯­æ³• çœ‹ä¸‹é¢è¿™ä¸ªæ¡ˆä¾‹ï¼Œæ¯æ¬¡ç‚¹å‡»ä¸åŒçš„æŒ‰é’®ï¼ŒåŠ çš„å€¼éƒ½ä¸åŒï¼Œæ¯æ¬¡éƒ½è¦å®šä¹‰ä¸åŒçš„mutationså¤„ç†å—ï¼Ÿ æäº¤ mutation æ˜¯å¯ä»¥ä¼ é€’å‚æ•°çš„ this.$store.commit(xxx, å‚æ•°) ç¤ºä¾‹ index.js import Vue from vueimport Vuex from vuexVue.use(Vuex)const store = new Vuex.Store( state: count: 101, title: , // æ‰€æœ‰mutationå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ï¼Œéƒ½æ˜¯ state mutations: addCount(state) state.count += 1 , addCountN(state, n) state.count += n , // æ³¨æ„ç‚¹ï¼šmutationå¦ä¸€ä¸ªå‚æ•°æœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ªï¼Œå¦‚æœéœ€è¦å¤šä¸ªå‚æ•°ï¼ŒåŒ…è£…æˆä¸€ä¸ªå¯¹è±¡ addCountObj(state, obj) state.count += obj.count )export default store Son1.vue template div class=box h2Son1 å­ç»„ä»¶ /h2 ä»vuexä¸­è·å–çš„å€¼: label $store.state.count /label hr ä»vuexä¸­è·å–çš„å€¼: label count /label br button @click=addå€¼ + 1/button button @click=addNå€¼ + n/button button @click=addObjå€¼ + obj/button /div/templatescriptexport default name: Son1Com, computed: count() return this.$store.state.count , methods: add() this.$store.commit(addCount) , addN() this.$store.commit(addCountN, 10) , addObj() this.$store.commit(addCountObj, count: 12) /scriptstyle lang=css scoped.box border: 3px solid #ccc; width: 400px; padding: 10px; margin: 20px;h2 margin-top: 10px;/style æ³¨æ„ æäº¤çš„å‚æ•°åªèƒ½æ˜¯ä¸€ä¸ª, å¦‚æœæœ‰å¤šä¸ªå‚æ•°è¦ä¼ , å¯ä»¥ä¼ é€’ä¸€ä¸ªå¯¹è±¡ 14.5.3 è¾…åŠ©å‡½æ•°- mapMutations è¯­æ³• mapMutationså’ŒmapStateå¾ˆåƒï¼Œå®ƒæŠŠä½äºmutationsä¸­çš„æ–¹æ³•æå–äº†å‡ºæ¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒå¯¼å…¥ import mapMutations from vuexmethods: ...mapMutations([addCount]) ä¸Šé¢ä»£ç çš„å«ä¹‰æ˜¯å°†mutationsçš„æ–¹æ³•å¯¼å…¥äº†methodsä¸­ï¼Œç­‰ä»·äº methods: // commit(æ–¹æ³•å, è½½è·å‚æ•°) addCount () this.$store.commit(addCount) æ­¤æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥é€šè¿‡this.addCountè°ƒç”¨äº† button @click=addCountå€¼+1/button ä½†æ˜¯è¯·æ³¨æ„ï¼š Vuexä¸­mutationsä¸­è¦æ±‚ä¸èƒ½å†™å¼‚æ­¥ä»£ç ï¼Œå¦‚æœæœ‰å¼‚æ­¥çš„ajaxè¯·æ±‚ï¼Œåº”è¯¥æ”¾ç½®åœ¨actionsä¸­ ç¤ºä¾‹ index.js import Vue from vueimport Vuex from vuexVue.use(Vuex)const store = new Vuex.Store( state: count: 101, title: , // æ‰€æœ‰mutationå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ï¼Œéƒ½æ˜¯ state mutations: addCount(state) state.count += 1 , addCountN(state, n) state.count += n , // æ³¨æ„ç‚¹ï¼šmutationå¦ä¸€ä¸ªå‚æ•°æœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ªï¼Œå¦‚æœéœ€è¦å¤šä¸ªå‚æ•°ï¼ŒåŒ…è£…æˆä¸€ä¸ªå¯¹è±¡ addCountObj(state, obj) state.count += obj.count )export default store Son2.vue template div class=box h2Son2 å­ç»„ä»¶/h2 ä»vuexä¸­è·å–çš„å€¼:label count /label br / button @click=addCountå€¼ + 1/button button @click=addCountN(12)å€¼ + n/button button @click=addCountObj(count: 10)å€¼ + obj/button /div/templatescriptimport mapState, mapMutations from vuex;export default name: Son2Com, computed: ...mapState([count]) , methods: ...mapMutations([addCount, addCountN, addCountObj]) /scriptstyle lang=css scoped.box border: 3px solid #ccc; width: 400px; padding: 10px; margin: 20px;h2 margin-top: 10px;/style 14.6 æ ¸å¿ƒæ¦‚å¿µ-actions14.6.1 åŸºç¡€ä½¿ç”¨ æ¦‚å¿µ stateæ˜¯å­˜æ”¾æ•°æ®çš„ï¼Œmutationsæ˜¯åŒæ­¥æ›´æ–°æ•°æ® (ä¾¿äºç›‘æµ‹æ•°æ®çš„å˜åŒ–, æ›´æ–°è§†å›¾ç­‰, æ–¹ä¾¿äºè°ƒè¯•å·¥å…·æŸ¥çœ‹å˜åŒ–)ï¼Œ actionsåˆ™è´Ÿè´£è¿›è¡Œå¼‚æ­¥æ“ä½œ è¯´æ˜ mutationså¿…é¡»æ˜¯åŒæ­¥çš„ éœ€æ±‚ ä¸€ç§’é’Ÿä¹‹å, è¦ç»™ä¸€ä¸ªæ•° å»ä¿®æ”¹state è¯­æ³• å®šä¹‰actions actions: setAsyncCount (context, num) // ä¸€ç§’å, ç»™ä¸€ä¸ªæ•°, å»ä¿®æ”¹ num setTimeout(() = context.commit(changeCount, num) , 1000) , ç»„ä»¶ä¸­é€šè¿‡dispatchè°ƒç”¨ setAsyncCount () this.$store.dispatch(setAsyncCount, 666) ç¤ºä¾‹ index.js import Vue from vueimport Vuex from vuexVue.use(Vuex)const store = new Vuex.Store( state: count: 101, title: , // æ‰€æœ‰mutationå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ï¼Œéƒ½æ˜¯ state mutations: addCountN(state, n) state.count += n , actions: setAsyncCount(context, num) setTimeout(() = context.commit(addCountN, num) , 1000) )export default store Son1.vue template div class=box h2Son1 å­ç»„ä»¶ /h2 ä»vuexä¸­è·å–çš„å€¼: label $store.state.count /label hr ä»vuexä¸­è·å–çš„å€¼: label count /label br button @click=setAsyncCountä¸€ç§’åå€¼ + 666/button /div/templatescriptexport default name: Son1Com, computed: count() return this.$store.state.count , methods: setAsyncCount() // è°ƒç”¨action // this.$store.dispatch(actionåå­—, é¢å¤–å‚æ•°) this.$store.dispatch(setAsyncCount, 666) /scriptstyle lang=css scoped.box border: 3px solid #ccc; width: 400px; padding: 10px; margin: 20px;h2 margin-top: 10px;/style 14.6.2 è¾…åŠ©å‡½æ•°-mapActions æ¦‚å¿µ mapActions æ˜¯æŠŠä½äº actionsä¸­çš„æ–¹æ³•æå–äº†å‡ºæ¥ï¼Œæ˜ å°„åˆ°ç»„ä»¶methodsä¸­ ç¤ºä¾‹ Son2.vue template div class=box h2Son2 å­ç»„ä»¶/h2 ä»vuexä¸­è·å–çš„å€¼:label count /label br / button @click=setAsyncCount(666)ä¸€ç§’åå€¼ + 666/button /div/templatescriptimport mapState, mapMutations, mapActions from vuex;export default name: Son2Com, computed: ...mapState([count]) , methods: ...mapActions([setAsyncCount]) /scriptstyle lang=css scoped.box border: 3px solid #ccc; width: 400px; padding: 10px; margin: 20px;h2 margin-top: 10px;/style index.js import Vue from vueimport Vuex from vuexVue.use(Vuex)const store = new Vuex.Store( state: count: 101, title: , // æ‰€æœ‰mutationå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ï¼Œéƒ½æ˜¯ state mutations: addCountN(state, n) state.count += n , actions: setAsyncCount(context, num) setTimeout(() = context.commit(addCountN, num) , 1000) )export default store 14.7 æ ¸å¿ƒæ¦‚å¿µ-getters14.7.1 åŸºç¡€ä½¿ç”¨ ä½œç”¨ é™¤äº†stateä¹‹å¤–ï¼Œæœ‰æ—¶æˆ‘ä»¬è¿˜éœ€è¦ä»stateä¸­ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„ä¸€äº›æ•°æ®ï¼Œè¿™äº›æ•°æ®æ˜¯ä¾èµ–stateçš„ï¼Œæ­¤æ—¶ä¼šç”¨åˆ°getters ä¾‹å¦‚ï¼Œstateä¸­å®šä¹‰äº†listï¼Œä¸º1-10çš„æ•°ç»„ï¼Œ state: list: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10] ç»„ä»¶ä¸­ï¼Œéœ€è¦æ˜¾ç¤ºæ‰€æœ‰å¤§äº5çš„æ•°æ®ï¼Œæ­£å¸¸çš„æ–¹å¼ï¼Œæ˜¯éœ€è¦liståœ¨ç»„ä»¶ä¸­è¿›è¡Œå†ä¸€æ­¥çš„å¤„ç†ï¼Œä½†æ˜¯getterså¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°å®ƒ å®šä¹‰ getters: // getterså‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ state // å¿…é¡»è¦æœ‰è¿”å›å€¼ filterList(state) return state.list.filter(item = item 5) ä½¿ç”¨ template div class=box ä»gettersè·å–list: $store.getters.filterList hr ä»gettersè·å–list: filterList /div/templatescriptexport default name: Son1Com, computed: filterList() return this.$store.getters.filterList /scriptstyle lang=css scoped.box border: 3px solid #ccc; width: 400px; padding: 10px; margin: 20px;h2 margin-top: 10px;/style 14.7.2 è¾…åŠ©å‡½æ•°-mapGetters ç¤ºä¾‹ template div class=box ä»gettersè·å–list: filterList /div/templatescriptimport mapState, mapMutations, mapActions, mapGetters from vuex;export default name: Son2Com, computed: ...mapGetters([filterList]) /scriptstyle lang=css scoped.box border: 3px solid #ccc; width: 400px; padding: 10px; margin: 20px;h2 margin-top: 10px;/style 14.8 ä½¿ç”¨å°ç»“ å›¾ä¾‹ 14.9 æ ¸å¿ƒæ¦‚å¿µ-module14.9.1 moduleæ¦‚å¿µ é—®é¢˜ ç”±äºä½¿ç”¨å•ä¸€çŠ¶æ€æ ‘ï¼Œåº”ç”¨çš„æ‰€æœ‰çŠ¶æ€ä¼šé›†ä¸­åˆ°ä¸€ä¸ªæ¯”è¾ƒå¤§çš„å¯¹è±¡ã€‚å½“åº”ç”¨å˜å¾—éå¸¸å¤æ‚æ—¶ï¼Œstore å¯¹è±¡å°±æœ‰å¯èƒ½å˜å¾—ç›¸å½“è‡ƒè‚¿ã€‚ è¿™å¥è¯çš„æ„æ€æ˜¯ï¼Œå¦‚æœæŠŠæ‰€æœ‰çš„çŠ¶æ€éƒ½æ”¾åœ¨stateä¸­ï¼Œå½“é¡¹ç›®å˜å¾—è¶Šæ¥è¶Šå¤§çš„æ—¶å€™ï¼ŒVuexä¼šå˜å¾—è¶Šæ¥è¶Šéš¾ä»¥ç»´æŠ¤ã€‚ç”±æ­¤ï¼Œåˆæœ‰äº†Vuexçš„æ¨¡å—åŒ–ã€‚ ç¤ºä¾‹ å®šä¹‰ä¸¤ä¸ªæ¨¡å— user å’Œ setting userä¸­ç®¡ç†ç”¨æˆ·çš„ä¿¡æ¯çŠ¶æ€ userInfo modules/user.js const state = userInfo: name: zs, age: 18 const mutations = const actions = const getters = export default state, mutations, actions, getters settingä¸­ç®¡ç†é¡¹ç›®åº”ç”¨çš„ ä¸»é¢˜è‰² themeï¼Œæè¿° descï¼Œ modules/setting.js const state = theme: dark desc: æè¿°çœŸå‘€çœŸä¸é”™const mutations = const actions = const getters = export default state, mutations, actions, getters åœ¨store/index.jsæ–‡ä»¶ä¸­çš„modulesé…ç½®é¡¹ä¸­ï¼Œæ³¨å†Œè¿™ä¸¤ä¸ªæ¨¡å— import user from ./modules/userimport setting from ./modules/settingconst store = new Vuex.Store( modules: user, setting ) 14.9.2 æ¨¡å—å†…çš„state å°½ç®¡å·²ç»åˆ†æ¨¡å—äº†ï¼Œä½†å…¶å®å­æ¨¡å—çš„çŠ¶æ€ï¼Œè¿˜æ˜¯ä¼šæŒ‚åˆ°æ ¹çº§åˆ«çš„ state ä¸­ï¼Œå±æ€§åå°±æ˜¯æ¨¡å—å ç›´æ¥è®¿é—® ç›´æ¥é€šè¿‡æ¨¡å—åè®¿é—® $store.state.æ¨¡å—å.xxx user.js // useræ¨¡å—const state = userInfo: name: zs, age: 18 , score: 80const mutations = const actions = const getters = export default namespaced:true, state, mutations, actions, getters Son1.vue $store.state.user.userInfo.name è¾…åŠ©å‡½æ•° é€šè¿‡ mapState æ˜ å°„ï¼š é»˜è®¤æ ¹çº§åˆ«çš„æ˜ å°„ mapState([ â€˜xxxâ€™ ]) å­æ¨¡å—çš„æ˜ å°„ ï¼šmapState(â€˜æ¨¡å—åâ€™, [â€˜xxxâ€™]) - éœ€è¦å¼€å¯å‘½åç©ºé—´ namespaced:true ...mapState(user, [userInfo]),...mapState(setting, [theme, desc]), 14.9.3 æ¨¡å—å†…çš„getters ç¤ºä¾‹ modules/user.js const getters = // åˆ†æ¨¡å—åï¼ŒstateæŒ‡ä»£å­æ¨¡å—çš„state UpperCaseName (state) return state.userInfo.name.toUpperCase() Son1.vue ç›´æ¥è®¿é—®getters !-- æµ‹è¯•è®¿é—®æ¨¡å—ä¸­çš„getters - åŸç”Ÿ --div $store.getters[user/UpperCaseName] /div Son2.vue é€šè¿‡å‘½åç©ºé—´è®¿é—® computed: ...mapGetters(user, [UpperCaseName]) 14.9.4 æ¨¡å—å†…çš„mutations æ³¨æ„ é»˜è®¤æ¨¡å—ä¸­çš„ mutation å’Œ actions ä¼šè¢«æŒ‚è½½åˆ°å…¨å±€ï¼Œ**éœ€è¦å¼€å¯å‘½åç©ºé—´**ï¼Œæ‰ä¼šæŒ‚è½½åˆ°å­æ¨¡å—ã€‚ ç¤ºä¾‹ modules/user.js const mutations = setUser (state, newUserInfo) state.userInfo = newUserInfo modules/setting.js const mutations = setTheme (state, newTheme) state.theme = newTheme Son1.vue button @click=updateUseræ›´æ–°ä¸ªäººä¿¡æ¯/button button @click=updateThemeæ›´æ–°ä¸»é¢˜è‰²/buttonexport default methods: updateUser () // $store.commit(æ¨¡å—å/mutationå, é¢å¤–ä¼ å‚) this.$store.commit(user/setUser, name: xiaowang, age: 25 ) , updateTheme () this.$store.commit(setting/setTheme, pink) Son2.vue button @click=setUser( name: xiaoli, age: 80 )æ›´æ–°ä¸ªäººä¿¡æ¯/buttonbutton @click=setTheme(skyblue)æ›´æ–°ä¸»é¢˜/buttonmethods:// åˆ†æ¨¡å—çš„æ˜ å°„...mapMutations(setting, [setTheme]),...mapMutations(user, [setUser]), 14.9.5 æ¨¡å—å†…çš„actions æ³¨æ„ é»˜è®¤æ¨¡å—ä¸­çš„ mutation å’Œ actions ä¼šè¢«æŒ‚è½½åˆ°å…¨å±€ï¼Œ**éœ€è¦å¼€å¯å‘½åç©ºé—´**ï¼Œæ‰ä¼šæŒ‚è½½åˆ°å­æ¨¡å—ã€‚ ç¤ºä¾‹ modules/user.js const actions = setUserSecond (context, newUserInfo) // å°†å¼‚æ­¥åœ¨actionä¸­è¿›è¡Œå°è£… setTimeout(() = // è°ƒç”¨mutation contextä¸Šä¸‹æ–‡ï¼Œé»˜è®¤æäº¤çš„å°±æ˜¯è‡ªå·±æ¨¡å—çš„actionå’Œmutation context.commit(setUser, newUserInfo) , 1000) Son1.vue ç›´æ¥é€šè¿‡storeè°ƒç”¨ button @click=updateUser2ä¸€ç§’åæ›´æ–°ä¿¡æ¯/buttonmethods: updateUser2 () // è°ƒç”¨action dispatch this.$store.dispatch(user/setUserSecond, name: xiaohong, age: 28 ) , Son2.vue mapActionsæ˜ å°„ button @click=setUserSecond( name: xiaoli, age: 80 )ä¸€ç§’åæ›´æ–°ä¿¡æ¯/buttonmethods: ...mapActions(user, [setUserSecond]) 14.9.6 ä½¿ç”¨æ€»ç»“ ç›´æ¥ä½¿ç”¨ state â€“ $store.state.æ¨¡å—å.æ•°æ®é¡¹å getters â€“ $store.getters[â€˜æ¨¡å—åå±æ€§åâ€™] mutations â€“ $store.commit(â€˜æ¨¡å—åæ–¹æ³•åâ€™, å…¶ä»–å‚æ•°) actions â€“ $store.dispatch(â€˜æ¨¡å—åæ–¹æ³•åâ€™, å…¶ä»–å‚æ•°) å€ŸåŠ©è¾…åŠ©å‡½æ•° import { mapXxxx, mapXxx } from â€˜vuexâ€™ computedã€methods: { â€‹ â€¦mapStateã€â€¦mapGettersæ”¾computedä¸­ï¼› â€‹ â€¦mapMutationsã€â€¦mapActionsæ”¾methodsä¸­ï¼› â€‹ â€¦mapXxxx(â€˜æ¨¡å—åâ€™, [â€˜æ•°æ®é¡¹|æ–¹æ³•â€™]), â€‹ â€¦mapXxxx(â€˜æ¨¡å—åâ€™, { æ–°çš„åå­—: åŸæ¥çš„åå­— }), } ç»„ä»¶ä¸­ç›´æ¥ä½¿ç”¨ å±æ€§ age æˆ– æ–¹æ³• @click=updateAge(2)","tags":["Vue2","vuex"],"categories":["å‰ç«¯"]},{"title":"AJAXåŸºç¡€","path":"/2023/12/13/2023-12-13-AJAXåŸºç¡€/","content":"1. AJAXå…¥é—¨1.1 AJAXæ¦‚å¿µå’Œaxiosä½¿ç”¨ å®šä¹‰ AJAX å¼‚æ­¥ JavaScript å’Œ XMLã€‚ AJAX æ˜¯ä¸€ç§ç”¨äºåˆ›å»ºå¿«é€ŸåŠ¨æ€ç½‘é¡µçš„æŠ€æœ¯ã€‚ é€šè¿‡åœ¨åå°ä¸æœåŠ¡å™¨è¿›è¡Œå°‘é‡æ•°æ®äº¤æ¢ï¼ŒAJAX å¯ä»¥ä½¿ç½‘é¡µå®ç°å¼‚æ­¥æ›´æ–°ã€‚è¿™æ„å‘³ç€å¯ä»¥åœ¨ä¸é‡æ–°åŠ è½½æ•´ä¸ªç½‘é¡µçš„æƒ…å†µä¸‹ï¼Œå¯¹ç½‘é¡µçš„æŸéƒ¨åˆ†è¿›è¡Œæ›´æ–°ã€‚ ä¼ ç»Ÿçš„ç½‘é¡µï¼ˆä¸ä½¿ç”¨ AJAXï¼‰å¦‚æœéœ€è¦æ›´æ–°å†…å®¹ï¼Œå¿…éœ€é‡è½½æ•´ä¸ªç½‘é¡µé¢ã€‚ æ¦‚å¿µ AJAX æ˜¯æµè§ˆå™¨ä¸æœåŠ¡å™¨è¿›è¡Œæ•°æ®é€šä¿¡çš„æŠ€æœ¯ æ€ä¹ˆç”¨AJAX å…ˆä½¿ç”¨ axios åº“ï¼Œä¸æœåŠ¡å™¨è¿›è¡Œæ•°æ®é€šä¿¡ åŸºäº XMLHttpRequest å°è£…ã€ä»£ç ç®€å•ã€æœˆä¸‹è½½é‡åœ¨ 14 äº¿æ¬¡ Vueã€React é¡¹ç›®ä¸­éƒ½ä¼šç”¨åˆ° axios å†å­¦ä¹  XMLHttpRequest å¯¹è±¡çš„ä½¿ç”¨ï¼Œäº†è§£ AJAX åº•å±‚åŸç† axiosä½¿ç”¨ å¼•å…¥ axios.jsï¼šhttps://cdn.jsdelivr.net/npm/axios/dist/axios.min.js ä½¿ç”¨ axios å‡½æ•° âœ“ ä¼ å…¥é…ç½®å¯¹è±¡ âœ“ å†ç”¨ .then å›è°ƒå‡½æ•°æ¥æ”¶ç»“æœï¼Œå¹¶åšåç»­å¤„ç† !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody p/p script src=https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js/script script axios( //url: http://hmajax.itheima.net/api/province // ç›´æ¥æ‹¼æ¥æŸ¥è¯¢å‚æ•° url: `https://mock.boxuegu.com/mock/3083/articles/$id` ).then(result = console.log(result); ) /script/body/html 1.2 è®¤è¯†URL å®šä¹‰ URL ä»£è¡¨ç€æ˜¯ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼ˆUniform Resource Locatorï¼‰ã€‚URL æ— éå°±æ˜¯ä¸€ä¸ªç»™å®šçš„ç‹¬ç‰¹èµ„æºåœ¨ Web ä¸Šçš„åœ°å€ã€‚ç†è®ºä¸Šè¯´ï¼Œæ¯ä¸ªæœ‰æ•ˆçš„ URL éƒ½æŒ‡å‘ä¸€ä¸ªå”¯ä¸€çš„èµ„æºã€‚è¿™ä¸ªèµ„æºå¯ä»¥æ˜¯ä¸€ä¸ª HTML é¡µé¢ï¼Œä¸€ä¸ª CSS æ–‡æ¡£ï¼Œä¸€å¹…å›¾åƒï¼Œç­‰ç­‰ã€‚è€Œåœ¨å®é™…ä¸­ï¼Œä¹Ÿæœ‰ä¸€äº›ä¾‹å¤–ï¼Œæœ€å¸¸è§çš„æƒ…å†µå°±æ˜¯ä¸€ä¸ª URL æŒ‡å‘äº†ä¸å­˜åœ¨çš„æˆ–æ˜¯è¢«ç§»åŠ¨è¿‡çš„èµ„æºã€‚ç”±äºé€šè¿‡ URL å‘ˆç°çš„èµ„æºå’Œ URL æœ¬èº«ç”± Web æœåŠ¡å™¨å¤„ç†ï¼Œå› æ­¤ web æœåŠ¡å™¨çš„æ‹¥æœ‰è€…éœ€è¦è®¤çœŸåœ°ç»´æŠ¤èµ„æºä»¥åŠä¸å®ƒå…³è”çš„ URLã€‚ æ¦‚å¿µ URL å°±æ˜¯ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼Œç®€ç§°ç½‘å€ï¼Œç”¨äºè®¿é—®ç½‘ç»œä¸Šçš„èµ„æºã€‚ URLçš„ç»„æˆ åè®® åŸŸåï¼šæ ‡è®°æœåŠ¡å™¨åœ¨äº’è”ç½‘ä¸­æ–¹ä½ èµ„æºè·¯å¾„ï¼šæ ‡è®°èµ„æºåœ¨æœåŠ¡å™¨ä¸‹çš„å…·ä½“ä½ç½® 1.3 URLæŸ¥è¯¢å‚æ•° å®šä¹‰ æµè§ˆå™¨æä¾›ç»™æœåŠ¡å™¨çš„é¢å¤–ä¿¡æ¯ï¼Œè®©æœåŠ¡å™¨è¿”å›æµè§ˆå™¨æƒ³è¦çš„æ•°æ® è¯­æ³• http://xxxx.com/xxx/xxx?å‚æ•°å1=å€¼1å‚æ•°å2=å€¼2 axios-æŸ¥è¯¢å‚æ•° ä½¿ç”¨ axios æä¾›çš„ params é€‰é¡¹ ä½¿ç”¨ axios æä¾›çš„ params é€‰é¡¹ æ³¨æ„ï¼šaxios åœ¨è¿è¡Œæ—¶æŠŠå‚æ•°åå’Œå€¼ï¼Œä¼šæ‹¼æ¥åˆ° url?å‚æ•°åå€¼ åŸå¸‚åˆ—è¡¨ï¼šhttp://hmajax.itheima.net/api/city?pname=æ²³åŒ—çœ axios( url: ç›®æ ‡èµ„æºåœ°å€, params: å‚æ•°å: å€¼ ).then(result = // å¯¹æœåŠ¡å™¨è¿”å›çš„æ•°æ®åšåç»­å¤„ç†)axios( url: http://hmajax.itheima.net/api/city, params: pname: æ²³åŒ—çœ ).then(result = console.log(result);) ç›´æ¥æ‹¼æ¥æŸ¥è¯¢å‚æ•° axios.get(`https://mock.boxuegu.com/mock/3083/articles/$id`); 1.4 å¸¸ç”¨è¯·æ±‚æ–¹æ³•å’Œæ•°æ®æäº¤ è¯·æ±‚æ–¹æ³• å¯¹æœåŠ¡å™¨èµ„æºï¼Œè¦æ‰§è¡Œçš„æ“ä½œ è¯·æ±‚æ–¹æ³• æ“ä½œ GET è·å–æ•°æ® POST æ•°æ®æäº¤ PUT ä¿®æ”¹æ•°æ®ï¼ˆå…¨éƒ¨ï¼‰ DELETE åˆ é™¤æ•°æ® PATCH ä¿®æ”¹æ•°æ®ï¼ˆéƒ¨åˆ†ï¼‰ axiosè¯·æ±‚é…ç½® urlï¼šè¯·æ±‚çš„ URL ç½‘å€ methodï¼šè¯·æ±‚çš„æ–¹æ³•ï¼ŒGETå¯ä»¥çœç•¥ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ dataï¼šæäº¤æ•°æ® axios( url: ç›®æ ‡èµ„æºåœ°å€, method: è¯·æ±‚æ–¹æ³•, data: å‚æ•°å: å€¼ ).then((result) = // å¯¹æœåŠ¡å™¨è¿”å›çš„æ•°æ®åšåç»­å¤„ç† ) ç¤ºä¾‹ï¼šæ•°æ®æäº¤-æ³¨å†Œè´¦å· axios( url: http://hmajax.itheima.net/api/register, method: POST, data: username: liming, password: 123456 ).then((result) = // å¯¹æœåŠ¡å™¨è¿”å›çš„æ•°æ®åšåç»­å¤„ç† ) axiosæ ¸å¿ƒé…ç½® urlï¼šè¯·æ±‚ URL ç½‘å€ methodï¼šè¯·æ±‚æ–¹æ³•ï¼ŒGET å¯ä»¥çœç•¥ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ paramsï¼šæŸ¥è¯¢å‚æ•° dataï¼šæäº¤æ•°æ® axiosé”™è¯¯å¤„ç† åœºæ™¯ï¼šå†æ¬¡æ³¨å†Œç›¸åŒçš„è´¦å·ï¼Œä¼šé‡åˆ°æŠ¥é”™ä¿¡æ¯ å¤„ç†ï¼šç”¨æ›´ç›´è§‚çš„æ–¹å¼ï¼Œç»™æ™®é€šç”¨æˆ·å±•ç¤ºé”™è¯¯ä¿¡æ¯ è¯­æ³•ï¼šåœ¨ then æ–¹æ³•çš„åé¢ï¼Œé€šè¿‡ç‚¹è¯­æ³•è°ƒç”¨ catch æ–¹æ³•ï¼Œä¼ å…¥å›è°ƒå‡½æ•°å¹¶å®šä¹‰å½¢å‚ body button class=btnæ³¨å†Œç”¨æˆ·/button script src=https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js/script script /* æ³¨å†Œç”¨æˆ·: http://hmajax.itheima.net/api/register è¯·æ±‚æ–¹æ³•: POST å‚æ•°å: username: ç”¨æˆ·å (ä¸­è‹±æ–‡å’Œæ•°å­—ç»„æˆ, æœ€å°‘8ä½) password: å¯†ç  (æœ€å°‘6ä½) ç›®æ ‡: ç‚¹å‡»æŒ‰é’®, é€šè¿‡axiosæäº¤ç”¨æˆ·å’Œå¯†ç , å®Œæˆæ³¨å†Œ éœ€æ±‚: ä½¿ç”¨axiosé”™è¯¯å¤„ç†è¯­æ³•, æ‹¿åˆ°æŠ¥é”™ä¿¡æ¯, å¼¹æ¡†åé¦ˆç»™ç”¨æˆ· */ document.querySelector(.btn).addEventListener(click, () = axios( url: http://hmajax.itheima.net/api/register, method: post, data: username: itheima007, password: 7654321 ).then(result = // æˆåŠŸ console.log(result) ).catch(error = // å¤±è´¥ // å¤„ç†é”™è¯¯ä¿¡æ¯ console.log(error) console.log(error.response.data.message) alert(error.response.data.message) ) ) /script/body 1.5 HTTPåè®®-æŠ¥æ–‡ æ¦‚å¿µ è§„å®šäº†æµè§ˆå™¨å‘é€åŠæœåŠ¡å™¨è¿”å›å†…å®¹çš„æ ¼å¼ è¯·æ±‚æŠ¥æ–‡ è¯·æ±‚æŠ¥æ–‡ï¼šæµè§ˆå™¨æŒ‰ç…§ HTTP åè®®è¦æ±‚çš„æ ¼å¼ï¼Œå‘é€ç»™æœåŠ¡å™¨çš„å†…å®¹ è¯·æ±‚è¡Œï¼šè¯·æ±‚æ–¹æ³•ï¼ŒURLï¼Œåè®® è¯·æ±‚å¤´ï¼šä»¥é”®å€¼å¯¹çš„æ ¼å¼æºå¸¦çš„é™„åŠ ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼šContent-Type ç©ºè¡Œï¼šåˆ†éš”è¯·æ±‚å¤´ï¼Œç©ºè¡Œä¹‹åçš„æ˜¯å‘é€ç»™æœåŠ¡å™¨çš„èµ„æº è¯·æ±‚ä½“ï¼šå‘é€çš„èµ„æº å“åº”æŠ¥æ–‡ å“åº”æŠ¥æ–‡ï¼šæœåŠ¡å™¨æŒ‰ç…§ HTTP åè®®è¦æ±‚çš„æ ¼å¼ï¼Œè¿”å›ç»™æµè§ˆå™¨çš„å†…å®¹ å“åº”è¡Œï¼ˆçŠ¶æ€è¡Œï¼‰ï¼šåè®®ã€HTTP å“åº”çŠ¶æ€ç ã€çŠ¶æ€ä¿¡æ¯ å“åº”å¤´ï¼šä»¥é”®å€¼å¯¹çš„æ ¼å¼æºå¸¦çš„é™„åŠ ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼šContent-Type ç©ºè¡Œï¼šåˆ†éš”å“åº”å¤´ï¼Œç©ºè¡Œä¹‹åçš„æ˜¯æœåŠ¡å™¨è¿”å›çš„èµ„æº å“åº”ä½“ï¼šè¿”å›çš„èµ„æº çŠ¶æ€ç  HTTP å“åº”çŠ¶æ€ç ï¼šç”¨æ¥è¡¨æ˜è¯·æ±‚æ˜¯å¦æˆåŠŸå®Œæˆ çŠ¶æ€ç  è¯´æ˜ 1xx ä¿¡æ¯ 2xx æˆåŠŸ 3xx é‡å®šå‘æ¶ˆæ¯ 4xx å®¢æˆ·ç«¯é”™è¯¯ 5xx æœåŠ¡ç«¯é”™è¯¯ 1.6 æ¡ˆä¾‹-ç”¨æˆ·ç™»å½• ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleæ¡ˆä¾‹_ç™»å½•_æç¤ºæ¶ˆæ¯/title !-- å¼•å…¥bootstrap.css -- link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css !-- å…¬å…± -- style html, body background-color: #EDF0F5; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; .container width: 520px; height: 540px; background-color: #fff; padding: 60px; box-sizing: border-box; .container h3 font-weight: 900; /style !-- è¡¨å•å®¹å™¨å’Œå†…å®¹ -- style .form_wrap color: #8B929D !important; .form-text color: #8B929D !important; /style !-- æç¤ºæ¡†æ ·å¼ -- style .alert transition: .5s; opacity: 0; .alert.show opacity: 1; /style/headbody div class=container h3æ¬¢è¿-ç™»å½•/h3 !-- ç™»å½•ç»“æœ-æç¤ºæ¡† -- div class=alert alert-success role=alert æç¤ºæ¶ˆæ¯ /div !-- è¡¨å• -- div class=form_wrap form div class=mb-3 label for=username class=form-labelè´¦å·å/label input type=text class=form-control username /div div class=mb-3 label for=password class=form-labelå¯†ç /label input type=password class=form-control password /div button type=button class=btn btn-primary btn-login ç™» å½• /button /form /div /div script src=https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js/script script // ç›®æ ‡1ï¼šç‚¹å‡»ç™»å½•æ—¶ï¼Œç”¨æˆ·åå’Œå¯†ç é•¿åº¦åˆ¤æ–­ï¼Œå¹¶æäº¤æ•°æ®å’ŒæœåŠ¡å™¨é€šä¿¡ // ç›®æ ‡2ï¼šä½¿ç”¨æç¤ºæ¡†ï¼Œåé¦ˆæç¤ºæ¶ˆæ¯ // 2.1 è·å–æç¤ºæ¡† const myAlert = document.querySelector(.alert) /** * 2.2 å°è£…æç¤ºæ¡†å‡½æ•°ï¼Œé‡å¤è°ƒç”¨ï¼Œæ»¡è¶³æç¤ºéœ€æ±‚ * åŠŸèƒ½ï¼š * 1. æ˜¾ç¤ºæç¤ºæ¡† * 2. ä¸åŒæç¤ºæ–‡å­—msgï¼Œå’ŒæˆåŠŸç»¿è‰²å¤±è´¥çº¢è‰²isSuccessï¼ˆtrueæˆåŠŸï¼Œfalseå¤±è´¥ï¼‰ * 3. è¿‡2ç§’åï¼Œè®©æç¤ºæ¡†è‡ªåŠ¨æ¶ˆå¤± */ function alertFn(msg, isSuccess) // 1 æ˜¾ç¤ºæç¤ºæ¡† myAlert.classList.add(show) // 2 å®ç°ç»†èŠ‚ myAlert.innerText = msg const bgStyle = isSuccess ? alert-success : alert-danger myAlert.classList.add(bgStyle) // 3 è¿‡2ç§’éšè— setTimeout(() = myAlert.classList.remove(show) // æç¤ºï¼šé¿å…ç±»åå†²çªï¼Œé‡ç½®èƒŒæ™¯è‰² myAlert.classList.remove(bgStyle) , 2000) // 1.1 ç™»å½•-ç‚¹å‡»äº‹ä»¶ document.querySelector(.btn-login).addEventListener(click, () = // 1.2 è·å–ç”¨æˆ·åå’Œå¯†ç  const username = document.querySelector(.username).value const password = document.querySelector(.password).value // console.log(username, password) // 1.3 åˆ¤æ–­é•¿åº¦ if (username.length 8) alertFn(ç”¨æˆ·åå¿…é¡»å¤§äºç­‰äº8ä½, false) console.log(ç”¨æˆ·åå¿…é¡»å¤§äºç­‰äº8ä½) return // é˜»æ­¢ä»£ç ç»§ç»­æ‰§è¡Œ if (password.length 6) alertFn(å¯†ç å¿…é¡»å¤§äºç­‰äº6ä½, false) console.log(å¯†ç å¿…é¡»å¤§äºç­‰äº6ä½) return // é˜»æ­¢ä»£ç ç»§ç»­æ‰§è¡Œ // 1.4 åŸºäºaxiosæäº¤ç”¨æˆ·åå’Œå¯†ç  // console.log(æäº¤æ•°æ®åˆ°æœåŠ¡å™¨) axios( url: http://hmajax.itheima.net/api/login, method: POST, data: username, password ).then(result = alertFn(result.data.message, true) console.log(result) console.log(result.data.message) ).catch(error = alertFn(error.response.data.message, false) console.log(error) console.log(error.response.data.message) ) ) /script/body/html 1.7 form-serializeæ’ä»¶ ä½œç”¨ å¿«é€Ÿæ”¶é›†è¡¨å•å…ƒç´ çš„å€¼ ç¤ºä¾‹ ç™»å½•æ¡ˆä¾‹ä½¿ç”¨æ’ä»¶ script src=https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js/script !-- 3.1 å¼•å…¥æ’ä»¶ -- script src=./lib/form-serialize.js/script script // ç›®æ ‡1ï¼šç‚¹å‡»ç™»å½•æ—¶ï¼Œç”¨æˆ·åå’Œå¯†ç é•¿åº¦åˆ¤æ–­ï¼Œå¹¶æäº¤æ•°æ®å’ŒæœåŠ¡å™¨é€šä¿¡ // ç›®æ ‡2ï¼šä½¿ç”¨æç¤ºæ¡†ï¼Œåé¦ˆæç¤ºæ¶ˆæ¯ // ç›®æ ‡3ï¼šä½¿ç”¨form-serializeæ’ä»¶ï¼Œæ”¶é›†ç”¨æˆ·åå’Œå¯†ç  // 2.1 è·å–æç¤ºæ¡† const myAlert = document.querySelector(.alert) /**2.2 å°è£…æç¤ºæ¡†å‡½æ•°ï¼Œé‡å¤è°ƒç”¨ï¼Œæ»¡è¶³æç¤ºéœ€æ±‚ * åŠŸèƒ½ï¼š * 1. æ˜¾ç¤ºæç¤ºæ¡† * 2. ä¸åŒæç¤ºæ–‡å­—msgï¼Œå’ŒæˆåŠŸç»¿è‰²å¤±è´¥çº¢è‰²isSuccessï¼ˆtrueæˆåŠŸï¼Œfalseå¤±è´¥ï¼‰ * 3. è¿‡2ç§’åï¼Œè®©æç¤ºæ¡†è‡ªåŠ¨æ¶ˆå¤± */ function alertFn(msg, isSuccess) // 1 æ˜¾ç¤ºæç¤ºæ¡† myAlert.classList.add(show) // 2 å®ç°ç»†èŠ‚ myAlert.innerText = msg const bgStyle = isSuccess ? alert-success : alert-danger myAlert.classList.add(bgStyle) // 3 è¿‡2ç§’éšè— setTimeout(() = myAlert.classList.remove(show) // æç¤ºï¼šé¿å…ç±»åå†²çªï¼Œé‡ç½®èƒŒæ™¯è‰² myAlert.classList.remove(bgStyle) , 2000) // 1.1 ç™»å½•-ç‚¹å‡»äº‹ä»¶ document.querySelector(.btn-login).addEventListener(click, () = // 3.2 ä½¿ç”¨serializeå‡½æ•°ï¼Œæ”¶é›†ç™»å½•è¡¨å•é‡Œç”¨æˆ·åå’Œå¯†ç  const form = document.querySelector(.login-form) const data = serialize(form, hash: true, empty: true ) console.log(data) // username: itheima007, password: 7654321 const username, password = data // 1.2 è·å–ç”¨æˆ·åå’Œå¯†ç  // const username = document.querySelector(.username).value // const password = document.querySelector(.password).value console.log(username, password) // 1.3 åˆ¤æ–­é•¿åº¦ if (username.length 8) alertFn(ç”¨æˆ·åå¿…é¡»å¤§äºç­‰äº8ä½, false) console.log(ç”¨æˆ·åå¿…é¡»å¤§äºç­‰äº8ä½) return // é˜»æ­¢ä»£ç ç»§ç»­æ‰§è¡Œ if (password.length 6) alertFn(å¯†ç å¿…é¡»å¤§äºç­‰äº6ä½, false) console.log(å¯†ç å¿…é¡»å¤§äºç­‰äº6ä½) return // é˜»æ­¢ä»£ç ç»§ç»­æ‰§è¡Œ // 1.4 åŸºäºaxiosæäº¤ç”¨æˆ·åå’Œå¯†ç  // console.log(æäº¤æ•°æ®åˆ°æœåŠ¡å™¨) axios( url: http://hmajax.itheima.net/api/login, method: POST, data: username, password ).then(result = alertFn(result.data.message, true) console.log(result) console.log(result.data.message) ).catch(error = alertFn(error.response.data.message, false) console.log(error) console.log(error.response.data.message) ) )/script 2. AJAXåŸç†2.1 XMLHttpRequest æ¦‚å¿µ XMLHttpRequestï¼ˆXHRï¼‰å¯¹è±¡ç”¨äºä¸æœåŠ¡å™¨äº¤äº’ã€‚é€šè¿‡ XMLHttpRequest å¯ä»¥åœ¨ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹è¯·æ±‚ç‰¹å®š URLï¼Œè·å–æ•°æ®ã€‚è¿™å…è®¸ç½‘é¡µåœ¨ä¸å½±å“ç”¨æˆ·æ“ä½œçš„æƒ…å†µä¸‹ï¼Œæ›´æ–°é¡µé¢çš„å±€éƒ¨å†…å®¹ã€‚XMLHttpRequest åœ¨ AJAX ç¼–ç¨‹ä¸­è¢«å¤§é‡ä½¿ç”¨ã€‚ å…³ç³» axios å†…éƒ¨é‡‡ç”¨ XMLHttpRequest ä¸æœåŠ¡å™¨äº¤äº’ã€‚ XMLHttpRequestä½¿ç”¨ åˆ›å»º XMLHttpRequest å¯¹è±¡ é…ç½®è¯·æ±‚æ–¹æ³•å’Œè¯·æ±‚ url åœ°å€ ç›‘å¬ loadend äº‹ä»¶ï¼Œæ¥æ”¶å“åº”ç»“æœ å‘èµ·è¯·æ±‚ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleXMLHttpRequest_åŸºç¡€ä½¿ç”¨/title/headbody p class=my-p/p script /** * ç›®æ ‡ï¼šä½¿ç”¨XMLHttpRequestå¯¹è±¡ä¸æœåŠ¡å™¨é€šä¿¡ * 1. åˆ›å»º XMLHttpRequest å¯¹è±¡ * 2. é…ç½®è¯·æ±‚æ–¹æ³•å’Œè¯·æ±‚ url åœ°å€ * 3. ç›‘å¬ loadend äº‹ä»¶ï¼Œæ¥æ”¶å“åº”ç»“æœ * 4. å‘èµ·è¯·æ±‚ */ // 1. åˆ›å»º XMLHttpRequest å¯¹è±¡ const xhr = new XMLHttpRequest() // 2. é…ç½®è¯·æ±‚æ–¹æ³•å’Œè¯·æ±‚ url åœ°å€ xhr.open(GET, http://hmajax.itheima.net/api/province) // 3. ç›‘å¬ loadend äº‹ä»¶ï¼Œæ¥æ”¶å“åº”ç»“æœ xhr.addEventListener(loadend, () = console.log(xhr.response) const data = JSON.parse(xhr.response) console.log(data.list.join(br)) document.querySelector(.my-p).innerHTML = data.list.join(br) ) // 4. å‘èµ·è¯·æ±‚ xhr.send() /script/body/html XMLHttpRequest-æŸ¥è¯¢å‚æ•° å®šä¹‰ï¼šæµè§ˆå™¨æä¾›ç»™æœåŠ¡å™¨çš„é¢å¤–ä¿¡æ¯ï¼Œè®©æœåŠ¡å™¨è¿”å›æµè§ˆå™¨æƒ³è¦çš„æ•°æ® è¯­æ³•ï¼šhttp://xxxx.com/xxx/xxx?å‚æ•°å1=å€¼1å‚æ•°å2=å€¼2 åŸç”Ÿ XHR éœ€è¦è‡ªå·±åœ¨ url åé¢æºå¸¦æŸ¥è¯¢å‚æ•°å­—ç¬¦ä¸²ï¼Œæ²¡æœ‰ axios å¸®åŠ©æˆ‘ä»¬æŠŠ params å‚æ•°æ‹¼æ¥åˆ° url å­—ç¬¦ä¸²åé¢äº† å¤šä¸ªæŸ¥è¯¢å‚æ•°ï¼Œå¦‚æœè‡ªå·±æ‹¼æ¥å¾ˆéº»çƒ¦ï¼Œè¿™é‡Œç”¨ URLSearchParams æŠŠå‚æ•°å¯¹è±¡è½¬æˆâ€œå‚æ•°åå€¼å‚æ•°åå€¼â€œæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œè¯­æ³•å¦‚ä¸‹ // 1. åˆ›å»º URLSearchParams å¯¹è±¡const paramsObj = new URLSearchParams( å‚æ•°å1: å€¼1, å‚æ•°å2: å€¼2)// 2. ç”ŸæˆæŒ‡å®šæ ¼å¼æŸ¥è¯¢å‚æ•°å­—ç¬¦ä¸²const queryString = paramsObj.toString()// ç»“æœï¼šå‚æ•°å1=å€¼1å‚æ•°å2=å€¼2 ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleæ¡ˆä¾‹_åœ°åŒºæŸ¥è¯¢/title link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css style :root font-size: 15px; body padding-top: 15px; /style/headbody div class=container form id=editForm class=row !-- è¾“å…¥çœä»½åå­— -- div class=mb-3 col label class=form-labelçœä»½åå­—/label input type=text value=åŒ—äº¬ name=province class=form-control province placeholder=è¯·è¾“å…¥çœä»½åç§° / /div !-- è¾“å…¥åŸå¸‚åå­— -- div class=mb-3 col label class=form-labelåŸå¸‚åå­—/label input type=text value=åŒ—äº¬å¸‚ name=city class=form-control city placeholder=è¯·è¾“å…¥åŸå¸‚åç§° / /div /form button type=button class=btn btn-primary sel-btnæŸ¥è¯¢/button brbr påœ°åŒºåˆ—è¡¨: /p ul class=list-group !-- ç¤ºä¾‹åœ°åŒº -- li class=list-group-itemä¸œåŸåŒº/li /ul /div script src=https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js/script script /** * ç›®æ ‡: æ ¹æ®çœä»½å’ŒåŸå¸‚åå­—, æŸ¥è¯¢å¯¹åº”çš„åœ°åŒºåˆ—è¡¨ */ // 1. æŸ¥è¯¢æŒ‰é’®-ç‚¹å‡»äº‹ä»¶ document.querySelector(.sel-btn).addEventListener(click, () = // 2. æ”¶é›†çœä»½å’ŒåŸå¸‚åå­— const pname = document.querySelector(.province).value const cname = document.querySelector(.city).value // 3. ç»„ç»‡æŸ¥è¯¢å‚æ•°å­—ç¬¦ä¸² const qObj = pname, cname // æŸ¥è¯¢å‚æ•°å¯¹è±¡ - æŸ¥è¯¢å‚æ•°å­—ç¬¦ä¸² const paramsObj = new URLSearchParams(qObj) const queryString = paramsObj.toString() console.log(queryString) // 4. ä½¿ç”¨XHRå¯¹è±¡ï¼ŒæŸ¥è¯¢åœ°åŒºåˆ—è¡¨ const xhr = new XMLHttpRequest() xhr.open(GET, `http://hmajax.itheima.net/api/area?$queryString`) xhr.addEventListener(loadend, () = console.log(xhr.response) const data = JSON.parse(xhr.response) console.log(data) const htmlStr = data.list.map(areaName = return `li class=list-group-item$areaName/li` ).join() console.log(htmlStr) document.querySelector(.list-group).innerHTML = htmlStr ) xhr.send() ) /script/body/html XMLHttpRequest-æ•°æ®æäº¤ éœ€æ±‚ï¼šé€šè¿‡ XHR å®Œæˆæ³¨å†Œç”¨æˆ·åŠŸèƒ½ æ­¥éª¤å’Œè¯­æ³• æ³¨æ„1ï¼šä½†æ˜¯è¿™æ¬¡æ²¡æœ‰ axios å¸®æˆ‘ä»¬äº†ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±è®¾ç½®è¯·æ±‚å¤´ Content-Typeï¼šapplicationjsonï¼Œæ¥å‘Šè¯‰æœåŠ¡å™¨ç«¯ï¼Œæˆ‘ä»¬å‘è¿‡å»çš„å†…å®¹ç±»å‹æ˜¯ JSON å­—ç¬¦ä¸²ï¼Œè®©ä»–è½¬æˆå¯¹åº”æ•°æ®ç»“æ„å–å€¼ä½¿ç”¨ æ³¨æ„2ï¼šæ²¡æœ‰ axios äº†ï¼Œæˆ‘ä»¬å‰ç«¯è¦ä¼ é€’çš„è¯·æ±‚ä½“æ•°æ®ï¼Œä¹Ÿæ²¡äººå¸®æˆ‘æŠŠ JS å¯¹è±¡è½¬æˆ JSON å­—ç¬¦ä¸²äº†ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±è½¬æ¢ æ³¨æ„3ï¼šåŸç”Ÿ XHR éœ€è¦åœ¨ send æ–¹æ³•è°ƒç”¨æ—¶ï¼Œä¼ å…¥è¯·æ±‚ä½“æºå¸¦ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleXMLHttpRequest_æ•°æ®æäº¤/title/headbody button class=reg-btnæ³¨å†Œç”¨æˆ·/button script /** * ç›®æ ‡ï¼šä½¿ç”¨xhrè¿›è¡Œæ•°æ®æäº¤-å®Œæˆæ³¨å†ŒåŠŸèƒ½ */ document.querySelector(.reg-btn).addEventListener(click, () = const xhr = new XMLHttpRequest() xhr.open(POST, http://hmajax.itheima.net/api/register) xhr.addEventListener(loadend, () = console.log(xhr.response) ) // è®¾ç½®è¯·æ±‚å¤´-å‘Šè¯‰æœåŠ¡å™¨å†…å®¹ç±»å‹ï¼ˆJSONå­—ç¬¦ä¸²ï¼‰ xhr.setRequestHeader(Content-Type, application/json) // å‡†å¤‡æäº¤çš„æ•°æ® const userObj = username: itheima007, password: 7654321 const userStr = JSON.stringify(userObj) // è®¾ç½®è¯·æ±‚ä½“ï¼Œå‘èµ·è¯·æ±‚ xhr.send(userStr) ) /script/body/html 2.2 Promise2.2.1 æ¦‚å¿µ ä»€ä¹ˆæ˜¯ Promise ï¼Ÿ Promise å¯¹è±¡ç”¨äºè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„æœ€ç»ˆå®Œæˆï¼ˆæˆ–å¤±è´¥ï¼‰åŠå…¶ç»“æ„å€¼ Promise çš„å¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿ é€»è¾‘æ›´æ¸…æ™°ï¼ˆæˆåŠŸæˆ–å¤±è´¥ä¼šå…³è”åç»­çš„å¤„ç†å‡½æ•°ï¼‰ äº†è§£ axios å‡½æ•°å†…éƒ¨è¿ä½œçš„æœºåˆ¶ èƒ½è§£å†³å›è°ƒå‡½æ•°åœ°ç‹±é—®é¢˜ï¼ˆåé¢ä¼šè®²åˆ°ï¼‰ï¼Œä»Šå¤©å…ˆæ¥çœ‹ä¸‹å®ƒçš„åŸºç¡€ä½¿ç”¨ Promise ç®¡ç†å¼‚æ­¥ä»»åŠ¡ï¼Œè¯­æ³•æ€ä¹ˆç”¨ï¼Ÿ // 1. åˆ›å»º Promise å¯¹è±¡const p = new Promise((resolve, reject) = // 2. æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡-å¹¶ä¼ é€’ç»“æœ // æˆåŠŸè°ƒç”¨: resolve(å€¼) è§¦å‘ then() æ‰§è¡Œ // å¤±è´¥è°ƒç”¨: reject(å€¼) è§¦å‘ catch() æ‰§è¡Œ)// 3. æ¥æ”¶ç»“æœp.then(result = // æˆåŠŸ).catch(error = // å¤±è´¥) ç¤ºä¾‹ä»£ç ï¼š /** * ç›®æ ‡ï¼šä½¿ç”¨Promiseç®¡ç†å¼‚æ­¥ä»»åŠ¡*/// 1. åˆ›å»ºPromiseå¯¹è±¡const p = new Promise((resolve, reject) = // 2. æ‰§è¡Œå¼‚æ­¥ä»£ç  setTimeout(() = // resolve(æ¨¡æ‹ŸAJAXè¯·æ±‚-æˆåŠŸç»“æœ) reject(new Error(æ¨¡æ‹ŸAJAXè¯·æ±‚-å¤±è´¥ç»“æœ)) , 2000))// 3. è·å–ç»“æœp.then(result = console.log(result)).catch(error = console.log(error)) 2.2.2 PromiseçŠ¶æ€ ä¸ºä»€ä¹ˆè¦äº†è§£ Promise çš„ä¸‰ç§çŠ¶æ€ ï¼Ÿ çŸ¥é“ Promise å¯¹è±¡å¦‚ä½•å…³è”çš„å¤„ç†å‡½æ•°ï¼Œä»¥åŠä»£ç çš„æ‰§è¡Œé¡ºåº Promise æœ‰å“ªä¸‰ç§çŠ¶æ€ï¼Ÿ æ¯ä¸ª Promise å¯¹è±¡å¿…å®šå¤„äºä»¥ä¸‹ä¸‰ç§çŠ¶æ€ä¹‹ä¸€ å¾…å®šï¼ˆpendingï¼‰ï¼šåˆå§‹çŠ¶æ€ï¼Œæ—¢æ²¡æœ‰è¢«å…‘ç°ï¼Œä¹Ÿæ²¡æœ‰è¢«æ‹’ç» å·²å…‘ç°ï¼ˆfulfilledï¼‰ï¼šæ“ä½œæˆåŠŸå®Œæˆ å·²æ‹’ç»ï¼ˆrejectedï¼‰ï¼šæ“ä½œå¤±è´¥ çŠ¶æ€çš„è‹±æ–‡å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç†è§£ä¸º Promise å¯¹è±¡å†…çš„å­—ç¬¦ä¸²æ ‡è¯†ç¬¦ï¼Œç”¨äºåˆ¤æ–­ä»€ä¹ˆæ—¶å€™è°ƒç”¨å“ªä¸€ä¸ªå¤„ç†å‡½æ•° Promise çš„çŠ¶æ€æ”¹å˜æœ‰ä»€ä¹ˆç”¨ï¼šè°ƒç”¨å¯¹åº”å‡½æ•°ï¼Œæ”¹å˜ Promise å¯¹è±¡çŠ¶æ€åï¼Œå†…éƒ¨è§¦å‘å¯¹åº”å›è°ƒå‡½æ•°ä¼ å‚å¹¶æ‰§è¡Œ æ³¨æ„ï¼šæ¯ä¸ª Promise å¯¹è±¡ä¸€æ—¦è¢«å…‘ç°æ‹’ç»ï¼Œé‚£å°±æ˜¯å·²æ•²å®šäº†ï¼ŒçŠ¶æ€æ— æ³•å†è¢«æ”¹å˜ 2.2.3 ä½¿ç”¨Promise Promise å’Œ XHR éƒ½å·²ç»å­¦è¿‡åŸºç¡€è¯­æ³•äº†ï¼Œæˆ‘ä»¬å¯ä»¥æ¥ç»“åˆä½¿ç”¨ä¸€ä¸‹äº† éœ€æ±‚ï¼šä½¿ç”¨ Promise å’Œ XHR è¯·æ±‚çœä»½åˆ—è¡¨æ•°æ®å¹¶å±•ç¤ºåˆ°é¡µé¢ä¸Š æ­¥éª¤ åˆ›å»º Promise å¯¹è±¡ æ‰§è¡Œ XHR å¼‚æ­¥ä»£ç ï¼Œè·å–çœä»½åˆ—è¡¨æ•°æ® å…³è”æˆåŠŸæˆ–å¤±è´¥å›è°ƒå‡½æ•°ï¼Œåšåç»­çš„å¤„ç† é”™è¯¯æƒ…å†µï¼šç”¨åœ°å€é”™äº†404æ¼”ç¤º ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleæ¡ˆä¾‹_ä½¿ç”¨Promise+XHR_è·å–çœä»½åˆ—è¡¨/title/headbody p class=my-p/p script /** * ç›®æ ‡ï¼šä½¿ç”¨Promiseç®¡ç†XHRè¯·æ±‚çœä»½åˆ—è¡¨ * 1. åˆ›å»ºPromiseå¯¹è±¡ * 2. æ‰§è¡ŒXHRå¼‚æ­¥ä»£ç ï¼Œè·å–çœä»½åˆ—è¡¨ * 3. å…³è”æˆåŠŸæˆ–å¤±è´¥å‡½æ•°ï¼Œåšåç»­å¤„ç† */ // 1. åˆ›å»ºPromiseå¯¹è±¡ const p = new Promise((resolve, reject) = // 2. æ‰§è¡ŒXHRå¼‚æ­¥ä»£ç ï¼Œè·å–çœä»½åˆ—è¡¨ const xhr = new XMLHttpRequest() xhr.open(GET, http://hmajax.itheima.net/api/province) xhr.addEventListener(loadend, () = // xhrå¦‚ä½•åˆ¤æ–­å“åº”æˆåŠŸè¿˜æ˜¯å¤±è´¥çš„ï¼Ÿ // 2xxå¼€å¤´çš„éƒ½æ˜¯æˆåŠŸå“åº”çŠ¶æ€ç  if (xhr.status = 200 xhr.status 300) resolve(JSON.parse(xhr.response)) else reject(new Error(xhr.response)) ) xhr.send() ) // 3. å…³è”æˆåŠŸæˆ–å¤±è´¥å‡½æ•°ï¼Œåšåç»­å¤„ç† p.then(result = console.log(result) document.querySelector(.my-p).innerHTML = result.list.join(br) ).catch(error = // é”™è¯¯å¯¹è±¡è¦ç”¨console.dirè¯¦ç»†æ‰“å° console.dir(error) // æœåŠ¡å™¨è¿”å›é”™è¯¯æç¤ºæ¶ˆæ¯ï¼Œæ’å…¥åˆ°pæ ‡ç­¾æ˜¾ç¤º document.querySelector(.my-p).innerHTML = error.message ) /script/body/html 2.3 å°è£…ç®€æ˜“ç‰ˆaxios2.3.1 è·å–åœ°åŒºåˆ—è¡¨ éœ€æ±‚ åŸºäº Promise å’Œ XHR å°è£… myAxios å‡½æ•°ï¼Œè·å–çœä»½åˆ—è¡¨å±•ç¤ºåˆ°é¡µé¢ æ ¸å¿ƒè¯­æ³• function myAxios(config) return new Promise((resolve, reject) = // XHR è¯·æ±‚ // è°ƒç”¨æˆåŠŸ/å¤±è´¥çš„å¤„ç†ç¨‹åº )myAxios( url: ç›®æ ‡èµ„æºåœ°å€).then(result = ).catch(error = ) æ­¥éª¤ï¼š å®šä¹‰ myAxios å‡½æ•°ï¼Œæ¥æ”¶é…ç½®å¯¹è±¡ï¼Œè¿”å› Promise å¯¹è±¡ å‘èµ· XHR è¯·æ±‚ï¼Œé»˜è®¤è¯·æ±‚æ–¹æ³•ä¸º GET è°ƒç”¨æˆåŠŸå¤±è´¥çš„å¤„ç†ç¨‹åº ä½¿ç”¨ myAxios å‡½æ•°ï¼Œè·å–çœä»½åˆ—è¡¨å±•ç¤º æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š /** * ç›®æ ‡ï¼šå°è£…_ç®€æ˜“axioså‡½æ•°_è·å–çœä»½åˆ—è¡¨ * 1. å®šä¹‰myAxioså‡½æ•°ï¼Œæ¥æ”¶é…ç½®å¯¹è±¡ï¼Œè¿”å›Promiseå¯¹è±¡ * 2. å‘èµ·XHRè¯·æ±‚ï¼Œé»˜è®¤è¯·æ±‚æ–¹æ³•ä¸ºGET * 3. è°ƒç”¨æˆåŠŸ/å¤±è´¥çš„å¤„ç†ç¨‹åº * 4. ä½¿ç”¨myAxioså‡½æ•°ï¼Œè·å–çœä»½åˆ—è¡¨å±•ç¤º*/// 1. å®šä¹‰myAxioså‡½æ•°ï¼Œæ¥æ”¶é…ç½®å¯¹è±¡ï¼Œè¿”å›Promiseå¯¹è±¡function myAxios(config) return new Promise((resolve, reject) = // 2. å‘èµ·XHRè¯·æ±‚ï¼Œé»˜è®¤è¯·æ±‚æ–¹æ³•ä¸ºGET const xhr = new XMLHttpRequest() xhr.open(config.method || GET, config.url) xhr.addEventListener(loadend, () = // 3. è°ƒç”¨æˆåŠŸ/å¤±è´¥çš„å¤„ç†ç¨‹åº if (xhr.status = 200 xhr.status 300) resolve(JSON.parse(xhr.response)) else reject(new Error(xhr.response)) ) xhr.send() )// 4. ä½¿ç”¨myAxioså‡½æ•°ï¼Œè·å–çœä»½åˆ—è¡¨å±•ç¤ºmyAxios( url: http://hmajax.itheima.net/api/province).then(result = console.log(result) document.querySelector(.my-p).innerHTML = result.list.join(br)).catch(error = console.log(error) document.querySelector(.my-p).innerHTML = error.message) 2.3.2 æ³¨å†Œç”¨æˆ· éœ€æ±‚ ä¿®æ”¹ myAxios å‡½æ•°æ”¯æŒä¼ é€’è¯·æ±‚ä½“æ•°æ®ï¼Œå®Œæˆæ³¨å†Œç”¨æˆ·åŠŸèƒ½ ä¿®æ”¹æ­¥éª¤ myAxios å‡½æ•°è°ƒç”¨åï¼Œåˆ¤æ–­ data é€‰é¡¹ è½¬æ¢æ•°æ®ç±»å‹ï¼Œåœ¨ send æ–¹æ³•ä¸­å‘é€ ä½¿ç”¨è‡ªå·±å°è£…çš„ myAxios å‡½æ•°å®Œæˆæ³¨å†Œç”¨æˆ·åŠŸèƒ½ æ ¸å¿ƒä»£ç  function myAxios(config) return new Promise((resolve, reject) = const xhr = new XMLHttpRequest() if (config.params) const paramsObj = new URLSearchParams(config.params) const queryString = paramsObj.toString() config.url += `?$queryString` xhr.open(config.method || GET, config.url) xhr.addEventListener(loadend, () = if (xhr.status = 200 xhr.status 300) resolve(JSON.parse(xhr.response)) else reject(new Error(xhr.response)) ) // 1. åˆ¤æ–­æœ‰dataé€‰é¡¹ï¼Œæºå¸¦è¯·æ±‚ä½“ if (config.data) // 2. è½¬æ¢æ•°æ®ç±»å‹ï¼Œåœ¨sendä¸­å‘é€ const jsonStr = JSON.stringify(config.data) xhr.setRequestHeader(Content-Type, application/json) xhr.send(jsonStr) else // å¦‚æœæ²¡æœ‰è¯·æ±‚ä½“æ•°æ®ï¼Œæ­£å¸¸çš„å‘èµ·è¯·æ±‚ xhr.send() )document.querySelector(.reg-btn).addEventListener(click, () = // 3. ä½¿ç”¨myAxioså‡½æ•°ï¼Œå®Œæˆæ³¨å†Œç”¨æˆ· myAxios( url: http://hmajax.itheima.net/api/register, method: POST, data: username: itheima999, password: 666666 ).then(result = console.log(result) ).catch(error = console.dir(error) )) 3. AJAXè¿›é˜¶3.1 åŒæ­¥ä»£ç å’Œå¼‚æ­¥ä»£ç  åŒæ­¥ä»£ç ï¼šé€è¡Œæ‰§è¡Œï¼Œéœ€åŸåœ°ç­‰å¾…ç»“æœåï¼Œæ‰ç»§ç»­å‘ä¸‹æ‰§è¡Œ å¼‚æ­¥ä»£ç ï¼šè°ƒç”¨åè€—æ—¶ï¼Œä¸é˜»å¡ä»£ç ç»§ç»­æ‰§è¡Œï¼ˆä¸å¿…åŸåœ°ç­‰å¾…ï¼‰ï¼Œåœ¨å°†æ¥å®Œæˆåè§¦å‘å›è°ƒå‡½æ•°ä¼ é€’ç»“æœ å›ç­”ä»£ç æ‰“å°é¡ºåºï¼šå‘ç°å¼‚æ­¥ä»£ç æ¥æ”¶ç»“æœï¼Œä½¿ç”¨çš„éƒ½æ˜¯å›è°ƒå‡½æ•° const result = 0 + 1console.log(result)setTimeout(() = console.log(2), 2000)document.querySelector(.btn).addEventListener(click, () = console.log(3))document.body.style.backgroundColor = pinkconsole.log(4) ç»“æœï¼š1ï¼Œ 4ï¼Œ 2 æŒ‰é’®ç‚¹å‡»ä¸€æ¬¡æ‰“å°ä¸€æ¬¡ 3 3.2 å›è°ƒå‡½æ•°åœ°ç‹± éœ€æ±‚ï¼šå±•ç¤ºé»˜è®¤ç¬¬ä¸€ä¸ªçœï¼Œç¬¬ä¸€ä¸ªåŸå¸‚ï¼Œç¬¬ä¸€ä¸ªåœ°åŒºåœ¨ä¸‹æ‹‰èœå•ä¸­ æ¦‚å¿µï¼šåœ¨å›è°ƒå‡½æ•°ä¸­åµŒå¥—å›è°ƒå‡½æ•°ï¼Œä¸€ç›´åµŒå¥—ä¸‹å»å°±å½¢æˆäº†å›è°ƒå‡½æ•°åœ°ç‹± ç¼ºç‚¹ï¼šå¯è¯»æ€§å·®ï¼Œå¼‚å¸¸æ— æ³•æ•è·ï¼Œè€¦åˆæ€§ä¸¥é‡ï¼Œç‰µä¸€å‘åŠ¨å…¨èº« axios( url: http://hmajax.itheima.net/api/province ).then(result = const pname = result.data.list[0] document.querySelector(.province).innerHTML = pname // è·å–ç¬¬ä¸€ä¸ªçœä»½é»˜è®¤ä¸‹å±çš„ç¬¬ä¸€ä¸ªåŸå¸‚åå­— axios( url: http://hmajax.itheima.net/api/city, params: pname ).then(result = const cname = result.data.list[0] document.querySelector(.city).innerHTML = cname // è·å–ç¬¬ä¸€ä¸ªåŸå¸‚é»˜è®¤ä¸‹å±ç¬¬ä¸€ä¸ªåœ°åŒºåå­— axios( url: http://hmajax.itheima.net/api/area, params: pname, cname ).then(result = document.querySelector(.area).innerHTML = result.data.list[0] ) )) 3.3 Promiseé“¾å¼è°ƒç”¨ æ¦‚å¿µï¼šä¾é  then() æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæ–°ç”Ÿæˆçš„ Promise å¯¹è±¡ç‰¹æ€§ï¼Œç»§ç»­ä¸²è”ä¸‹ä¸€ç¯ä»»åŠ¡ï¼Œç›´åˆ°ç»“æŸ ç»†èŠ‚ï¼šthen() å›è°ƒå‡½æ•°ä¸­çš„è¿”å›å€¼ï¼Œä¼šå½±å“æ–°ç”Ÿæˆçš„ Promise å¯¹è±¡æœ€ç»ˆçŠ¶æ€å’Œç»“æœ å¥½å¤„ï¼šé€šè¿‡é“¾å¼è°ƒç”¨ï¼Œè§£å†³å›è°ƒå‡½æ•°åµŒå¥—é—®é¢˜ æŒ‰ç…§å›¾è§£ï¼Œç¼–å†™æ ¸å¿ƒä»£ç ï¼š /** * ç›®æ ‡ï¼šæŒæ¡Promiseçš„é“¾å¼è°ƒç”¨ * éœ€æ±‚ï¼šæŠŠçœå¸‚çš„åµŒå¥—ç»“æ„ï¼Œæ”¹æˆé“¾å¼è°ƒç”¨çš„çº¿æ€§ç»“æ„*/// 1. åˆ›å»ºPromiseå¯¹è±¡-æ¨¡æ‹Ÿè¯·æ±‚çœä»½åå­—const p = new Promise((resolve, reject) = setTimeout(() = resolve(åŒ—äº¬å¸‚) , 2000))// 2. è·å–çœä»½åå­—const p2 = p.then(result = console.log(result) // 3. åˆ›å»ºPromiseå¯¹è±¡-æ¨¡æ‹Ÿè¯·æ±‚åŸå¸‚åå­— // return Promiseå¯¹è±¡æœ€ç»ˆçŠ¶æ€å’Œç»“æœï¼Œå½±å“åˆ°æ–°çš„Promiseå¯¹è±¡ return new Promise((resolve, reject) = setTimeout(() = resolve(result + --- åŒ—äº¬) , 2000) ))// 4. è·å–åŸå¸‚åå­—p2.then(result = console.log(result))// then()åŸåœ°çš„ç»“æœæ˜¯ä¸€ä¸ªæ–°çš„Promiseå¯¹è±¡console.log(p2 === p) 3.4 Promise-é“¾å¼è°ƒç”¨_è§£å†³å›è°ƒåœ°ç‹± ç›®æ ‡ï¼šä½¿ç”¨ Promise é“¾å¼è°ƒç”¨ï¼Œè§£å†³å›è°ƒå‡½æ•°åœ°ç‹±é—®é¢˜ åšæ³•ï¼šæ¯ä¸ª Promise å¯¹è±¡ä¸­ç®¡ç†ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œç”¨ then è¿”å› Promise å¯¹è±¡ï¼Œä¸²è”èµ·æ¥ æŒ‰ç…§å›¾è§£æ€è·¯ï¼Œç¼–å†™æ ¸å¿ƒä»£ç ï¼š /** * ç›®æ ‡ï¼šæŠŠå›è°ƒå‡½æ•°åµŒå¥—ä»£ç ï¼Œæ”¹æˆPromiseé“¾å¼è°ƒç”¨ç»“æ„ * éœ€æ±‚ï¼šè·å–é»˜è®¤ç¬¬ä¸€ä¸ªçœï¼Œç¬¬ä¸€ä¸ªå¸‚ï¼Œç¬¬ä¸€ä¸ªåœ°åŒºå¹¶å±•ç¤ºåœ¨ä¸‹æ‹‰èœå•ä¸­*/let pname = // 1. å¾—åˆ°-è·å–çœä»½Promiseå¯¹è±¡axios(url: http://hmajax.itheima.net/api/province).then(result = pname = result.data.list[0] document.querySelector(.province).innerHTML = pname // 2. å¾—åˆ°-è·å–åŸå¸‚Promiseå¯¹è±¡ return axios(url: http://hmajax.itheima.net/api/city, params: pname )).then(result = const cname = result.data.list[0] document.querySelector(.city).innerHTML = cname // 3. å¾—åˆ°-è·å–åœ°åŒºPromiseå¯¹è±¡ return axios(url: http://hmajax.itheima.net/api/area, params: pname, cname )).then(result = console.log(result) const areaName = result.data.list[0] document.querySelector(.area).innerHTML = areaName) 3.5 asynå’Œawaitä½¿ç”¨ æ¦‚å¿µï¼šåœ¨ async å‡½æ•°å†…ï¼Œä½¿ç”¨ await å…³é”®å­—å–ä»£ then å‡½æ•°ï¼Œç­‰å¾…è·å– Promise å¯¹è±¡æˆåŠŸçŠ¶æ€çš„ç»“æœå€¼ åšæ³•ï¼šä½¿ç”¨ async å’Œ await è§£å†³å›è°ƒåœ°ç‹±é—®é¢˜ æ ¸å¿ƒä»£ç ï¼š /** * ç›®æ ‡ï¼šæŒæ¡asyncå’Œawaitè¯­æ³•ï¼Œè§£å†³å›è°ƒå‡½æ•°åœ°ç‹± * æ¦‚å¿µï¼šåœ¨asyncå‡½æ•°å†…ï¼Œä½¿ç”¨awaitå…³é”®å­—ï¼Œè·å–Promiseå¯¹è±¡æˆåŠŸçŠ¶æ€ç»“æœå€¼ * æ³¨æ„ï¼šawaitå¿…é¡»ç”¨åœ¨asyncä¿®é¥°çš„å‡½æ•°å†…ï¼ˆawaitä¼šé˜»æ­¢å¼‚æ­¥å‡½æ•°å†…ä»£ç ç»§ç»­æ‰§è¡Œï¼ŒåŸåœ°ç­‰å¾…ç»“æœï¼‰*/// 1. å®šä¹‰asyncä¿®é¥°å‡½æ•°async function getData() // 2. awaitç­‰å¾…Promiseå¯¹è±¡æˆåŠŸçš„ç»“æœ const pObj = await axios(url: http://hmajax.itheima.net/api/province) const pname = pObj.data.list[0] const cObj = await axios(url: http://hmajax.itheima.net/api/city, params: pname ) const cname = cObj.data.list[0] const aObj = await axios(url: http://hmajax.itheima.net/api/area, params: pname, cname ) const areaName = aObj.data.list[0] document.querySelector(.province).innerHTML = pname document.querySelector(.city).innerHTML = cname document.querySelector(.area).innerHTML = areaNamegetData() ä½¿ç”¨ await æ›¿ä»£ then çš„æ–¹æ³• 3.6 async å‡½æ•°å’Œ await æ•è·é”™è¯¯ try å’Œ catch çš„ä½œç”¨ï¼šè¯­å¥æ ‡è®°è¦å°è¯•çš„è¯­å¥å—ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªå‡ºç°å¼‚å¸¸æ—¶æŠ›å‡ºçš„å“åº” try // è¦æ‰§è¡Œçš„ä»£ç  catch (error) // error æ¥æ”¶çš„æ˜¯ï¼Œé”™è¯¯æ¶ˆæ¯ // try é‡Œä»£ç ï¼Œå¦‚æœæœ‰é”™è¯¯ï¼Œç›´æ¥è¿›å…¥è¿™é‡Œæ‰§è¡Œ try é‡Œæœ‰æŠ¥é”™çš„ä»£ç ï¼Œä¼šç«‹åˆ»è·³è½¬åˆ° catch ä¸­ å°è¯•æŠŠä»£ç ä¸­ url åœ°å€å†™é”™ï¼Œè¿è¡Œè§‚å¯Ÿ try catch çš„æ•è·é”™è¯¯ä¿¡æ¯èƒ½åŠ› /** * ç›®æ ‡ï¼šasyncå’Œawait_é”™è¯¯æ•è·*/async function getData() // 1. tryåŒ…è£¹å¯èƒ½äº§ç”Ÿé”™è¯¯çš„ä»£ç  try const pObj = await axios( url: http://hmajax.itheima.net/api/province ) const pname = pObj.data.list[0] const cObj = await axios( url: http://hmajax.itheima.net/api/city, params: pname ) const cname = cObj.data.list[0] const aObj = await axios( url: http://hmajax.itheima.net/api/area, params: pname, cname ) const areaName = aObj.data.list[0] document.querySelector(.province).innerHTML = pname document.querySelector(.city).innerHTML = cname document.querySelector(.area).innerHTML = areaName catch (error) // 2. æ¥ç€è°ƒç”¨catchå—ï¼Œæ¥æ”¶é”™è¯¯ä¿¡æ¯ // å¦‚æœtryé‡ŒæŸè¡Œä»£ç æŠ¥é”™åï¼Œtryä¸­å‰©ä½™çš„ä»£ç ä¸ä¼šæ‰§è¡Œäº† console.dir(error) getData() 3.7 äº‹ä»¶å¾ªç¯-EventLoop äº‹ä»¶å¾ªç¯ï¼ˆEventLoopï¼‰ï¼šæŒæ¡åçŸ¥é“ JS æ˜¯å¦‚ä½•å®‰æ’å’Œè¿è¡Œä»£ç çš„ è¯·å›ç­”ä¸‹é¢ 2 æ®µä»£ç æ‰“å°çš„ç»“æœï¼Œå¹¶è¯´æ˜åŸå›  console.log(1)setTimeout(() = console.log(2), 2000) console.log(1)setTimeout(() = console.log(2), 0)console.log(3) ä½œç”¨ï¼šäº‹ä»¶å¾ªç¯è´Ÿè´£æ‰§è¡Œä»£ç ï¼Œæ”¶é›†å’Œå¤„ç†äº‹ä»¶ä»¥åŠæ‰§è¡Œé˜Ÿåˆ—ä¸­çš„å­ä»»åŠ¡ åŸå› ï¼šJavaScript å•çº¿ç¨‹ï¼ˆæŸä¸€åˆ»åªèƒ½æ‰§è¡Œä¸€è¡Œä»£ç ï¼‰ï¼Œä¸ºäº†è®©è€—æ—¶ä»£ç ä¸é˜»å¡å…¶ä»–ä»£ç è¿è¡Œï¼Œè®¾è®¡äº†äº‹ä»¶å¾ªç¯æ¨¡å‹ æ¦‚å¿µï¼šæ‰§è¡Œä»£ç å’Œæ”¶é›†å¼‚æ­¥ä»»åŠ¡çš„æ¨¡å‹ï¼Œåœ¨è°ƒç”¨æ ˆç©ºé—²ï¼Œåå¤è°ƒç”¨ä»»åŠ¡é˜Ÿåˆ—é‡Œå›è°ƒå‡½æ•°çš„æ‰§è¡Œæœºåˆ¶ï¼Œå°±å«äº‹ä»¶å¾ªç¯ /** * ç›®æ ‡ï¼šé˜…è¯»å¹¶å›ç­”æ‰§è¡Œçš„é¡ºåºç»“æœ*/console.log(1)setTimeout(() = console.log(2), 0)console.log(3)setTimeout(() = console.log(4), 2000)console.log(5) å…·ä½“è¿è¡Œè¿‡ç¨‹ï¼Œè¯·å‚è€ƒ PPT åŠ¨ç”»å’Œè§†é¢‘è®²è§£ 3.8 å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡ ES6 ä¹‹åå¼•å…¥äº† Promise å¯¹è±¡ï¼Œ è®© JS å¼•æ“ä¹Ÿå¯ä»¥å‘èµ·å¼‚æ­¥ä»»åŠ¡ å¼‚æ­¥ä»»åŠ¡åˆ’åˆ†ä¸ºäº† å®ä»»åŠ¡ï¼šç”±æµè§ˆå™¨ç¯å¢ƒæ‰§è¡Œçš„å¼‚æ­¥ä»£ç  å¾®ä»»åŠ¡ï¼šç”± JS å¼•æ“ç¯å¢ƒæ‰§è¡Œçš„å¼‚æ­¥ä»£ç  å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡å…·ä½“åˆ’åˆ†ï¼š äº‹ä»¶å¾ªç¯æ¨¡å‹ å…·ä½“è¿è¡Œæ•ˆæœï¼Œå‚è€ƒ PPT åŠ¨ç”»æˆ–è€…è§†é¢‘ /** * ç›®æ ‡ï¼šé˜…è¯»å¹¶å›ç­”æ‰“å°çš„æ‰§è¡Œé¡ºåº*/console.log(1)setTimeout(() = console.log(2), 0)const p = new Promise((resolve, reject) = resolve(3))p.then(res = console.log(res))console.log(4) æ³¨æ„ï¼šå®ä»»åŠ¡æ¯æ¬¡åœ¨æ‰§è¡ŒåŒæ­¥ä»£ç æ—¶ï¼Œäº§ç”Ÿå¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ—ä»»åŠ¡åï¼Œå¾®ä»»åŠ¡é˜Ÿåˆ—ç©ºé—´é‡Šæ”¾ï¼ ä¸‹ä¸€æ¬¡å®ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œé‡åˆ°å¾®ä»»åŠ¡ä»£ç ï¼Œæ‰ä¼šå†æ¬¡ç”³è¯·å¾®ä»»åŠ¡é˜Ÿåˆ—ç©ºé—´æ”¾å…¥å›è°ƒå‡½æ•°æ¶ˆæ¯æ’é˜Ÿ æ€»ç»“ï¼šä¸€ä¸ªå®ä»»åŠ¡åŒ…å«å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œä»–ä»¬ä¹‹é—´æ˜¯åŒ…å«å…³ç³»ï¼Œä¸æ˜¯å¹¶åˆ—å…³ç³» 3.9 Promise.allé™æ€æ–¹æ³• æ¦‚å¿µï¼šåˆå¹¶å¤šä¸ª Promise å¯¹è±¡ï¼Œç­‰å¾…æ‰€æœ‰åŒæ—¶æˆåŠŸå®Œæˆï¼ˆæˆ–æŸä¸€ä¸ªå¤±è´¥ï¼‰ï¼Œåšåç»­é€»è¾‘ è¯­æ³•ï¼š const p = Promise.all([Promiseå¯¹è±¡, Promiseå¯¹è±¡, ...])p.then(result = // result ç»“æœ: [Promiseå¯¹è±¡æˆåŠŸç»“æœ, Promiseå¯¹è±¡æˆåŠŸç»“æœ, ...]).catch(error = // ç¬¬ä¸€ä¸ªå¤±è´¥çš„ Promise å¯¹è±¡ï¼ŒæŠ›å‡ºçš„å¼‚å¸¸å¯¹è±¡) éœ€æ±‚ï¼šåŒæ—¶è¯·æ±‚â€œåŒ—äº¬â€ï¼Œâ€œä¸Šæµ·â€ï¼Œâ€œå¹¿å·â€ï¼Œâ€œæ·±åœ³â€çš„å¤©æ°”å¹¶åœ¨ç½‘é¡µå°½å¯èƒ½åŒæ—¶æ˜¾ç¤º æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titlePromiseçš„allæ–¹æ³•/title/headbody ul class=my-ul/ul script src=https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js/script script /** * ç›®æ ‡ï¼šæŒæ¡Promiseçš„allæ–¹æ³•ä½œç”¨ï¼Œå’Œä½¿ç”¨åœºæ™¯ * ä¸šåŠ¡ï¼šå½“æˆ‘éœ€è¦åŒä¸€æ—¶é—´æ˜¾ç¤ºå¤šä¸ªè¯·æ±‚çš„ç»“æœæ—¶ï¼Œå°±è¦æŠŠå¤šè¯·æ±‚åˆå¹¶ * ä¾‹å¦‚ï¼šé»˜è®¤æ˜¾ç¤ºåŒ—äº¬, ä¸Šæµ·, å¹¿å·, æ·±åœ³çš„å¤©æ°”åœ¨é¦–é¡µæŸ¥çœ‹ * codeï¼š * åŒ—äº¬-110100 * ä¸Šæµ·-310100 * å¹¿å·-440100 * æ·±åœ³-440300 */ // 1. è¯·æ±‚åŸå¸‚å¤©æ°”ï¼Œå¾—åˆ°Promiseå¯¹è±¡ const bjPromise = axios( url: http://hmajax.itheima.net/api/weather, params: city: 110100 ) const shPromise = axios( url: http://hmajax.itheima.net/api/weather, params: city: 310100 ) const gzPromise = axios( url: http://hmajax.itheima.net/api/weather, params: city: 440100 ) const szPromise = axios( url: http://hmajax.itheima.net/api/weather, params: city: 440300 ) // 2. ä½¿ç”¨Promise.allï¼Œåˆå¹¶å¤šä¸ªPromiseå¯¹è±¡ const p = Promise.all([bjPromise, shPromise, gzPromise, szPromise]) p.then(result = // æ³¨æ„ï¼šç»“æœæ•°ç»„é¡ºåºå’Œåˆå¹¶æ—¶é¡ºåºæ˜¯ä¸€è‡´ console.log(result) const htmlStr = result.map(item = return `li$item.data.data.area --- $item.data.data.weather/li` ).join() document.querySelector(.my-ul).innerHTML = htmlStr ).catch(error = console.dir(error) ) /script/body/html åˆå¹¶å¤šä¸ª Promise å¯¹è±¡å¹¶ç­‰å¾…æ‰€æœ‰åŒæ—¶æˆåŠŸçš„ç»“æœï¼Œå¦‚æœæœ‰ä¸€ä¸ªæŠ¥é”™å°±ä¼šæœ€ç»ˆä¸ºå¤±è´¥çŠ¶æ€ï¼Œå½“éœ€è¦åŒæ—¶æ¸²æŸ“å¤šä¸ªæ¥å£æ•°æ®åŒæ—¶åˆ°ç½‘é¡µä¸Šæ—¶ä½¿ç”¨ 3.10 æ¡ˆä¾‹-å•†å“åˆ†ç±» éœ€æ±‚ï¼šå°½å¯èƒ½åŒæ—¶å±•ç¤ºæ‰€æœ‰å•†å“åˆ†ç±»åˆ°é¡µé¢ä¸Š æ­¥éª¤ è·å–æ‰€æœ‰çš„ä¸€çº§åˆ†ç±»æ•°æ® éå†idï¼Œåˆ›å»ºè·å–äºŒçº§åˆ†ç±»è¯·æ±‚ åˆå¹¶æ‰€æœ‰äºŒçº§åˆ†ç±»Promiseå¯¹è±¡ ç­‰å¾…åŒæ—¶æˆåŠŸï¼Œå¼€å§‹æ¸²æŸ“é¡µé¢ æ ¸å¿ƒä»£ç  /** * ç›®æ ‡ï¼šæŠŠæ‰€æœ‰å•†å“åˆ†ç±»â€œåŒæ—¶â€æ¸²æŸ“åˆ°é¡µé¢ä¸Š * 1. è·å–æ‰€æœ‰ä¸€çº§åˆ†ç±»æ•°æ® * 2. éå†idï¼Œåˆ›å»ºè·å–äºŒçº§åˆ†ç±»è¯·æ±‚ * 3. åˆå¹¶æ‰€æœ‰äºŒçº§åˆ†ç±»Promiseå¯¹è±¡ * 4. ç­‰å¾…åŒæ—¶æˆåŠŸåï¼Œæ¸²æŸ“é¡µé¢*/// 1. è·å–æ‰€æœ‰ä¸€çº§åˆ†ç±»æ•°æ®axios( url: http://hmajax.itheima.net/api/category/top).then(result = console.log(result) // 2. éå†idï¼Œåˆ›å»ºè·å–äºŒçº§åˆ†ç±»è¯·æ±‚ const secPromiseList = result.data.data.map(item = return axios( url: http://hmajax.itheima.net/api/category/sub, params: id: item.id // ä¸€çº§åˆ†ç±»id ) ) console.log(secPromiseList) // [äºŒçº§åˆ†ç±»è¯·æ±‚Promiseå¯¹è±¡ï¼ŒäºŒçº§åˆ†ç±»è¯·æ±‚Promiseå¯¹è±¡ï¼Œ...] // 3. åˆå¹¶æ‰€æœ‰äºŒçº§åˆ†ç±»Promiseå¯¹è±¡ const p = Promise.all(secPromiseList) p.then(result = console.log(result) // 4. ç­‰å¾…åŒæ—¶æˆåŠŸåï¼Œæ¸²æŸ“é¡µé¢ const htmlStr = result.map(item = const dataObj = item.data.data // å–å‡ºå…³é”®æ•°æ®å¯¹è±¡ return `div class=item h3$dataObj.name/h3 ul $dataObj.children.map(item = return `li a href=javascript:; img src=$item.picture p$item.name/p /a /li` ).join() /ul /div` ).join() console.log(htmlStr) document.querySelector(.sub-list).innerHTML = htmlStr ))","tags":["AJAX","AXIOS","XMLHTTPRequest","Promise","async","await"],"categories":["å‰ç«¯"]},{"title":"JavaScriptè¿›é˜¶","path":"/2023/12/08/2023-12-08-JavaScrpitè¿›é˜¶/","content":"1. ä½œç”¨åŸŸ1.1 ä½œç”¨åŸŸ ä½œç”¨ è§„å®šäº†å˜é‡èƒ½å¤Ÿè¢«è®¿é—®çš„èŒƒå›´ï¼Œç¦»å¼€äº†è¿™ä¸ªèŒƒå›´å˜é‡ä¾¿ä¸èƒ½è¢«è®¿é—® åˆ†ç±» å±€éƒ¨ä½œç”¨åŸŸ å…¨å±€ä½œç”¨åŸŸ å±€éƒ¨ä½œç”¨åŸŸ å±€éƒ¨ä½œç”¨åŸŸåˆ†ä¸ºå‡½æ•°ä½œç”¨åŸŸå’Œå—ä½œç”¨åŸŸ å‡½æ•°ä½œç”¨åŸŸ åœ¨å‡½æ•°å†…éƒ¨å£°æ˜çš„å˜é‡åªèƒ½åœ¨å‡½æ•°å†…éƒ¨è¢«è®¿é—®ï¼Œå¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—® script function getSum() // å‡½æ•°å†…éƒ¨æ˜¯å‡½æ•°ä½œç”¨åŸŸ å±äºå±€éƒ¨å˜é‡ const num = 10 console.log(num); // æ­¤å¤„æŠ¥é”™ å‡½æ•°å¤–éƒ¨ä¸èƒ½ä½¿ç”¨å±€éƒ¨ä½œç”¨åŸŸå˜é‡/script æ€»ç»“ï¼š å‡½æ•°å†…éƒ¨å£°æ˜çš„å˜é‡ï¼Œåœ¨å‡½æ•°å¤–éƒ¨æ— æ³•è¢«è®¿é—® å‡½æ•°çš„å‚æ•°ä¹Ÿæ˜¯å‡½æ•°å†…éƒ¨çš„å±€éƒ¨å˜é‡ åŒå‡½æ•°å†…éƒ¨å£°æ˜çš„å˜é‡æ— æ³•äº’ç›¸è®¿é—® å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œå‡½æ•°å†…éƒ¨çš„å˜é‡å®é™…è¢«æ¸…ç©ºäº† å—ä½œç”¨åŸŸ åœ¨ JavaScript ä¸­ä½¿ç”¨ { } åŒ…è£¹çš„ä»£ç ç§°ä¸ºä»£ç å—ï¼Œä»£ç å—å†…éƒ¨å£°æ˜çš„å˜é‡å¤–éƒ¨å°†ã€æœ‰å¯èƒ½ã€‘æ— æ³•è¢«è®¿é—®ã€‚ script for (let i = 1; i = 6; i++) console.log(i); // è®¿é—®æ­£å¸¸ console.log(i); // æŠ¥é”™ï¼Œè¶…å‡ºiçš„ä½œç”¨åŸŸ/script æ€»ç»“ï¼š let å£°æ˜çš„å˜é‡ä¼šäº§ç”Ÿå—ä½œç”¨åŸŸï¼Œvar ä¸ä¼šäº§ç”Ÿå—ä½œç”¨åŸŸ const å£°æ˜çš„å¸¸é‡ä¹Ÿä¼šäº§ç”Ÿå—ä½œç”¨åŸŸ ä¸åŒä»£ç å—ä¹‹é—´çš„å˜é‡æ— æ³•äº’ç›¸è®¿é—® æ¨èä½¿ç”¨ let æˆ– const å…¨å±€ä½œç”¨åŸŸ å…¨å±€ä½œç”¨åŸŸä¸­å£°æ˜çš„å˜é‡ï¼Œä»»ä½•å…¶å®ƒä½œç”¨åŸŸéƒ½å¯ä»¥è¢«è®¿é—® script // å…¨å±€ä½œç”¨åŸŸ // å…¨å±€ä½œç”¨åŸŸä¸‹å£°æ˜äº† num å˜é‡ const num = 10 function fn() // å‡½æ•°å†…éƒ¨å¯ä»¥ä½¿ç”¨å…¨å±€ä½œç”¨åŸŸçš„å˜é‡ console.log(num); // å…¨å±€ä½œç”¨åŸŸ/script æ³¨æ„ï¼š ä¸º window å¯¹è±¡åŠ¨æ€æ·»åŠ çš„å±æ€§é»˜è®¤ä¹Ÿæ˜¯å…¨å±€çš„ï¼Œä¸æ¨èï¼ å‡½æ•°ä¸­æœªä½¿ç”¨ä»»ä½•å…³é”®å­—å£°æ˜çš„å˜é‡ä¸ºå…¨å±€å˜é‡ï¼Œä¸æ¨èï¼ï¼ï¼ å°½å¯èƒ½å°‘çš„å£°æ˜å…¨å±€å˜é‡ï¼Œé˜²æ­¢å…¨å±€å˜é‡è¢«æ±¡æŸ“ 1.2 ä½œç”¨åŸŸé“¾ ä½œç”¨ ä½œç”¨åŸŸé“¾æœ¬è´¨ä¸Šæ˜¯åº•å±‚çš„å˜é‡æŸ¥æ‰¾æœºåˆ¶ åœ¨å‡½æ•°è¢«æ‰§è¡Œæ—¶ï¼Œä¼šä¼˜å…ˆæŸ¥æ‰¾å½“å‰å‡½æ•°ä½œç”¨åŸŸä¸­æŸ¥æ‰¾å˜é‡ å¦‚æœå½“å‰ä½œç”¨åŸŸæŸ¥æ‰¾ä¸åˆ°åˆ™ä¼šä¾æ¬¡é€çº§æŸ¥æ‰¾çˆ¶çº§ä½œç”¨åŸŸç›´åˆ°å…¨å±€ä½œç”¨åŸŸ æ€»ç»“ åµŒå¥—å…³ç³»çš„ä½œç”¨åŸŸä¸²è”èµ·æ¥å½¢æˆäº†ä½œç”¨åŸŸé“¾ ç›¸åŒä½œç”¨åŸŸé“¾ä¸­æŒ‰ç€ä»å°åˆ°å¤§çš„è§„åˆ™æŸ¥æ‰¾å˜é‡ å­ä½œç”¨åŸŸèƒ½å¤Ÿè®¿é—®çˆ¶ä½œç”¨åŸŸï¼Œçˆ¶çº§ä½œç”¨åŸŸæ— æ³•è®¿é—®å­çº§ä½œç”¨åŸŸ 1.3 JSåƒåœ¾å›æ”¶æœºåˆ¶ æ¦‚å¿µ åƒåœ¾å›æ”¶æœºåˆ¶(Garbage Collection) ç®€ç§° GC JSä¸­å†…å­˜çš„åˆ†é…å’Œå›æ”¶éƒ½æ˜¯è‡ªåŠ¨å®Œæˆçš„ï¼Œå†…å­˜åœ¨ä¸ä½¿ç”¨çš„æ—¶å€™ä¼šè¢«åƒåœ¾å›æ”¶å™¨è‡ªåŠ¨å›æ”¶ã€‚æ­£å› ä¸ºåƒåœ¾å›æ”¶å™¨çš„å­˜åœ¨ï¼Œè®¸å¤šäººè®¤ä¸ºJSä¸ç”¨å¤ªå…³å¿ƒå†…å­˜ç®¡ç†çš„é—®é¢˜ ä½†å¦‚æœä¸äº†è§£JSçš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œæˆ‘ä»¬åŒæ ·éå¸¸å®¹æ˜“æˆå†…å­˜æ³„æ¼ï¼ˆå†…å­˜æ— æ³•è¢«å›æ”¶ï¼‰çš„æƒ…å†µ ä¸å†ç”¨åˆ°çš„å†…å­˜ï¼Œæ²¡æœ‰åŠæ—¶é‡Šæ”¾ï¼Œå°±å«åšå†…å­˜æ³„æ¼ å†…å­˜ç”Ÿå‘½å‘¨æœŸ JSç¯å¢ƒä¸­åˆ†é…çš„å†…å­˜, ä¸€èˆ¬æœ‰å¦‚ä¸‹ç”Ÿå‘½å‘¨æœŸ å†…å­˜åˆ†é…ï¼šå½“æˆ‘ä»¬å£°æ˜å˜é‡ã€å‡½æ•°ã€å¯¹è±¡çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºä»–ä»¬åˆ†é…å†…å­˜ å†…å­˜ä½¿ç”¨ï¼šå³è¯»å†™å†…å­˜ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨å˜é‡ã€å‡½æ•°ç­‰ å†…å­˜å›æ”¶ï¼šä½¿ç”¨å®Œæ¯•ï¼Œç”±åƒåœ¾å›æ”¶è‡ªåŠ¨å›æ”¶ä¸å†ä½¿ç”¨çš„å†…å­˜ è¯´æ˜ å…¨å±€å˜é‡ä¸€èˆ¬ä¸ä¼šå›æ”¶(å…³é—­é¡µé¢å›æ”¶)ï¼› ä¸€èˆ¬æƒ…å†µä¸‹å±€éƒ¨å˜é‡çš„å€¼, ä¸ç”¨äº†, ä¼šè¢«è‡ªåŠ¨å›æ”¶æ‰ 1.4 é—­åŒ… æ¦‚å¿µ ä¸€ä¸ªå‡½æ•°å¯¹å‘¨å›´çŠ¶æ€çš„å¼•ç”¨æ†ç»‘åœ¨ä¸€èµ·ï¼Œå†…å±‚å‡½æ•°ä¸­è®¿é—®åˆ°å…¶å¤–å±‚å‡½æ•°çš„ä½œç”¨åŸŸ ç®€å•ç†è§£ï¼šé—­åŒ… å†…å±‚å‡½æ•° + å¤–å±‚å‡½æ•°çš„å˜é‡ ä½œç”¨ é—­åŒ…ä½œç”¨ï¼šå°é—­æ•°æ®ï¼Œæä¾›æ“ä½œï¼Œå¤–éƒ¨ä¹Ÿå¯ä»¥è®¿é—®å‡½æ•°å†…éƒ¨çš„å˜é‡ é—­åŒ…çš„åŸºæœ¬æ ¼å¼ï¼š ä¸ºä»€ä¹ˆè¦é—­åŒ… é—­åŒ…åº”ç”¨ï¼šå®ç°æ•°æ®çš„ç§æœ‰ æ¯”å¦‚ï¼Œæˆ‘ä»¬è¦åšä¸ªç»Ÿè®¡å‡½æ•°è°ƒç”¨æ¬¡æ•°ï¼Œå‡½æ•°è°ƒç”¨ä¸€æ¬¡ï¼Œå°±++ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script // ç®€å•çš„å†™æ³• function outer() let a = 10 function fn() console.log(a) fn() outer() // å¸¸è§çš„é—­åŒ…çš„å½¢å¼ å¤–éƒ¨å¯ä»¥è®¿é—®ä½¿ç”¨ å‡½æ•°å†…éƒ¨çš„å˜é‡ function outer() let a = 100 function fn() console.log(a) return fn // outer() === fn === function fn() // const fun = function fn() // // å¸¸è§çš„å†™æ³•2 function outer2() let a = 100 return function () console.log(a) const fun2 = outer2() fun2() // è°ƒç”¨å‡½æ•° // å¤–é¢è¦ä½¿ç”¨è¿™ä¸ª 10 // é—­åŒ…çš„åº”ç”¨ // æ™®é€šå½¢å¼ ç»Ÿè®¡å‡½æ•°è°ƒç”¨çš„æ¬¡æ•° // let i = 0 // function fn() // i++ // console.log(`å‡½æ•°è¢«è°ƒç”¨äº†$iæ¬¡`) // // å› ä¸º i æ˜¯å…¨å±€å˜é‡ï¼Œå®¹æ˜“è¢«ä¿®æ”¹ // é—­åŒ…å½¢å¼ ç»Ÿè®¡å‡½æ•°è°ƒç”¨çš„æ¬¡æ•° function count() let i = 0 function fn() i++ console.log(`å‡½æ•°è¢«è°ƒç”¨äº†$iæ¬¡`) return fn const fun3 = count() /script/body/html 1.5 å˜é‡æå‡ æ¦‚å¿µ å˜é‡æå‡æ˜¯ JavaScript ä¸­æ¯”è¾ƒå¥‡æ€ªçš„ç°è±¡ï¼Œå®ƒå…è®¸åœ¨å˜é‡å£°æ˜ä¹‹å‰å³è¢«è®¿é—®ï¼ˆä»…å­˜åœ¨äºvarå£°æ˜å˜é‡ï¼‰ æ³¨æ„ å˜é‡åœ¨æœªå£°æ˜å³è¢«è®¿é—®æ—¶ä¼šæŠ¥è¯­æ³•é”™è¯¯ å˜é‡åœ¨varå£°æ˜ä¹‹å‰å³è¢«è®¿é—®ï¼Œå˜é‡çš„å€¼ä¸º undefined letconst å£°æ˜çš„å˜é‡ä¸å­˜åœ¨å˜é‡æå‡ å˜é‡æå‡å‡ºç°åœ¨ç›¸åŒä½œç”¨åŸŸå½“ä¸­ å®é™…å¼€å‘ä¸­æ¨èå…ˆå£°æ˜å†è®¿é—®å˜é‡ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script // 1. æŠŠæ‰€æœ‰varå£°æ˜çš„å˜é‡æå‡åˆ° å½“å‰ä½œç”¨åŸŸçš„æœ€å‰é¢ // 2. åªæå‡å£°æ˜ï¼Œ ä¸æå‡èµ‹å€¼ // var num // console.log(num + ä»¶) // num = 10 // console.log(num) function fn() console.log(num) var num = 10 fn() /script/body/html 2. å‡½æ•°è¿›é˜¶2.1 å‡½æ•°æå‡ æ¦‚å¿µ å‡½æ•°æå‡ä¸å˜é‡æå‡æ¯”è¾ƒç±»ä¼¼ï¼Œæ˜¯æŒ‡å‡½æ•°åœ¨å£°æ˜ä¹‹å‰å³å¯è¢«è°ƒç”¨ æ€»ç»“ å‡½æ•°æå‡èƒ½å¤Ÿä½¿å‡½æ•°çš„å£°æ˜è°ƒç”¨æ›´çµæ´» å‡½æ•°è¡¨è¾¾å¼ä¸å­˜åœ¨æå‡çš„ç°è±¡ å‡½æ•°æå‡å‡ºç°åœ¨ç›¸åŒä½œç”¨åŸŸå½“ä¸­ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script var fun // 1. ä¼šæŠŠæ‰€æœ‰å‡½æ•°å£°æ˜æå‡åˆ°å½“å‰ä½œç”¨åŸŸçš„æœ€å‰é¢ // 2. åªæå‡å‡½æ•°å£°æ˜ï¼Œä¸æå‡å‡½æ•°è°ƒç”¨ // fn() // function fn() // console.log(å‡½æ•°æå‡) // // fun() // var fun = function () // console.log(å‡½æ•°è¡¨è¾¾å¼) // // å‡½æ•°è¡¨è¾¾å¼ å¿…é¡»å…ˆå£°æ˜å’Œèµ‹å€¼ï¼Œ åè°ƒç”¨ å¦åˆ™ æŠ¥é”™ /script/body/html 2.2 å‡½æ•°å‚æ•° ä½œç”¨ æå‡å‡½æ•°åº”ç”¨çš„çµæ´»åº¦ åŠ¨æ€å‚æ•° arguments æ˜¯å‡½æ•°å†…éƒ¨å†…ç½®çš„ä¼ªæ•°ç»„å˜é‡ï¼Œå®ƒåŒ…å«äº†è°ƒç”¨å‡½æ•°æ—¶ä¼ å…¥çš„æ‰€æœ‰å®å‚ã€‚ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script function getSum() // arguments åŠ¨æ€å‚æ•° åªå­˜åœ¨äº å‡½æ•°é‡Œé¢ // æ˜¯ä¼ªæ•°ç»„ é‡Œé¢å­˜å‚¨çš„æ˜¯ä¼ é€’è¿‡æ¥çš„å®å‚ // console.log(arguments) [2,3,4] let sum = 0 for (let i = 0; i arguments.length; i++) sum += arguments[i] console.log(sum) getSum(2, 3, 4) getSum(1, 2, 3, 4, 2, 2, 3, 4) /script/body/html æ€»ç»“ï¼š arguments æ˜¯ä¸€ä¸ªä¼ªæ•°ç»„ï¼Œåªå­˜åœ¨äºå‡½æ•°ä¸­ arguments çš„ä½œç”¨æ˜¯åŠ¨æ€è·å–å‡½æ•°çš„å®å‚ å¯ä»¥é€šè¿‡forå¾ªç¯ä¾æ¬¡å¾—åˆ°ä¼ é€’è¿‡æ¥çš„å®å‚ å‰©ä½™å‚æ•° å‰©ä½™å‚æ•°å…è®¸æˆ‘ä»¬å°†ä¸€ä¸ªä¸å®šæ•°é‡çš„å‚æ•°è¡¨ç¤ºä¸ºä¸€ä¸ªæ•°ç»„ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script function getSum(a, b, ...arr) console.log(arr) // ä½¿ç”¨çš„æ—¶å€™ä¸éœ€è¦å†™ ... getSum(2, 3) getSum(1, 2, 3, 4, 5) /script/body/html åŒºåˆ« ... æ˜¯è¯­æ³•ç¬¦å·ï¼Œç½®äºæœ€æœ«å‡½æ•°å½¢å‚ä¹‹å‰ï¼Œç”¨äºè·å–å¤šä½™çš„å®å‚ å€ŸåŠ© ... è·å–çš„å‰©ä½™å®å‚ï¼Œæ˜¯ä¸ªçœŸæ•°ç»„ å¼€å‘ä¸­ï¼Œè¿˜æ˜¯æå€¡å¤šä½¿ç”¨ å‰©ä½™å‚æ•° 2.3 å±•å¼€è¿ç®—ç¬¦ ä½œç”¨ å±•å¼€è¿ç®—ç¬¦ â€¦ ,å°†ä¸€ä¸ªæ•°ç»„è¿›è¡Œå±•å¼€ã€‚ä¸”ä¸ä¼šä¿®æ”¹åŸæ•°ç»„ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script const arr1 = [1, 2, 3] // å±•å¼€è¿ç®—ç¬¦ å¯ä»¥å±•å¼€æ•°ç»„ // console.log(...arr) // console.log(Math.max(1, 2, 3)) // ...arr1 === 1,2,3 // 1 æ±‚æ•°ç»„æœ€å¤§å€¼ console.log(Math.max(...arr1)) // 3 console.log(Math.min(...arr1)) // 1 // 2. åˆå¹¶æ•°ç»„ const arr2 = [3, 4, 5] const arr = [...arr1, ...arr2] console.log(arr) /script/body/html 2.4 ç®­å¤´å‡½æ•°(é‡è¦) ä½œç”¨ æ›´ç®€çŸ­çš„å‡½æ•°å†™æ³•å¹¶ä¸”ä¸ç»‘å®šthisï¼Œç®­å¤´å‡½æ•°çš„è¯­æ³•æ¯”å‡½æ•°è¡¨è¾¾å¼æ›´ç®€æ´ ä½¿ç”¨åœºæ™¯ ç®­å¤´å‡½æ•°æ›´é€‚ç”¨äºé‚£äº›æœ¬æ¥éœ€è¦åŒ¿åå‡½æ•°çš„åœ°æ–¹ è¯­æ³• è¯­æ³•1ï¼šåŸºæœ¬å†™æ³• const fn = function() console.log(æ™®é€šå‡½æ•°)fn()const fn = () = console.log(ç®­å¤´å‡½æ•°)fn() è¯­æ³•2ï¼šåªæœ‰ä¸€ä¸ªå‚æ•°å¯ä»¥çœç•¥å°æ‹¬å· const fn = function(x) return x + xconsole.log(fn(1)) // 2const fn = x = return x + xconsole.log(fn(1)) // 2 è¯­æ³•3ï¼šå¦‚æœå‡½æ•°ä½“åªæœ‰ä¸€è¡Œä»£ç ï¼Œå¯ä»¥å†™åˆ°ä¸€è¡Œä¸Šï¼Œå¹¶ä¸”æ— éœ€å†™ return ç›´æ¥è¿”å›å€¼ const fn = function(x, y) return x + yconsole.log(fn(1, 2)) // 3const fn = (x, y) = x + yconsole.log(fn(1, 2)) // 3 è¯­æ³•4ï¼šåŠ æ‹¬å·çš„å‡½æ•°ä½“è¿”å›å¯¹è±¡å­—é¢é‡è¡¨è¾¾å¼ const fn = uname = ( uname: uname )console.log(fn(pinkè€å¸ˆ)) // uname: pinkè€å¸ˆ ç®­å¤´å‡½æ•°å‚æ•° æ™®é€šå‡½æ•°æœ‰arguments åŠ¨æ€å‚æ•° ç®­å¤´å‡½æ•°æ²¡æœ‰ arguments åŠ¨æ€å‚æ•°ï¼Œä½†æ˜¯æœ‰ å‰©ä½™å‚æ•° ...args script const getSum = (...args) = let sum = 0 for (let i = 0; i args.length; i++) sum += args[i] return sum console.log(getSum(1, 2, 3));/script ç®­å¤´å‡½æ•°this åœ¨ç®­å¤´å‡½æ•°å‡ºç°ä¹‹å‰ï¼Œæ¯ä¸€ä¸ªæ–°å‡½æ•°æ ¹æ®å®ƒæ˜¯è¢«å¦‚ä½•è°ƒç”¨çš„æ¥å®šä¹‰è¿™ä¸ªå‡½æ•°çš„thiså€¼ï¼Œ éå¸¸ä»¤äººè®¨åŒ ç®­å¤´å‡½æ•°ä¸ä¼šåˆ›å»ºè‡ªå·±çš„this,ï¼Œåªä¼šä»è‡ªå·±çš„ä½œç”¨åŸŸé“¾çš„ä¸Šä¸€å±‚æ²¿ç”¨this !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script // ä»¥å‰thisçš„æŒ‡å‘ï¼š è°è°ƒç”¨çš„è¿™ä¸ªå‡½æ•°ï¼Œthis å°±æŒ‡å‘è° console.log(this) // window // æ™®é€šå‡½æ•° function fn() console.log(this) // window window.fn() // å¯¹è±¡æ–¹æ³•é‡Œé¢çš„this const obj1 = name: andy, sayHi: function () console.log(this) // obj obj1.sayHi() // 2. ç®­å¤´å‡½æ•°çš„this æ˜¯ä¸Šä¸€å±‚ä½œç”¨åŸŸçš„this æŒ‡å‘ const fn2 = () = console.log(this) // window fn2() // å¯¹è±¡æ–¹æ³•ç®­å¤´å‡½æ•° this const obj2 = uname: pinkè€å¸ˆ, sayHi: () = console.log(this) // this æŒ‡å‘è°ï¼Ÿ window obj2.sayHi() const obj3 = uname: pinkè€å¸ˆ, sayHi: function () console.log(this) // obj let i = 10 const count = () = console.log(this) // obj count() obj3.sayHi() /script/body/html åœ¨å¼€å‘ä¸­ã€ä½¿ç”¨ç®­å¤´å‡½æ•°å‰éœ€è¦è€ƒè™‘å‡½æ•°ä¸­ this çš„å€¼ã€‘ï¼Œäº‹ä»¶å›è°ƒå‡½æ•°ä½¿ç”¨ç®­å¤´å‡½æ•°æ—¶ï¼Œthis ä¸ºå…¨å±€çš„ windowï¼Œå› æ­¤DOMäº‹ä»¶å›è°ƒå‡½æ•°ä¸ºäº†ç®€ä¾¿ï¼Œè¿˜æ˜¯ä¸å¤ªæ¨èä½¿ç”¨ç®­å¤´å‡½æ•° 2.5 è§£æ„èµ‹å€¼ æ¦‚å¿µ è§£æ„èµ‹å€¼æ˜¯ä¸€ç§å¿«é€Ÿä¸ºå˜é‡èµ‹å€¼çš„ç®€æ´è¯­æ³•ï¼Œæœ¬è´¨ä¸Šä»ç„¶æ˜¯ä¸ºå˜é‡èµ‹å€¼ æ•°ç»„ç»“æ„ æ•°ç»„è§£æ„æ˜¯å°†æ•°ç»„çš„å•å…ƒå€¼å¿«é€Ÿæ‰¹é‡èµ‹å€¼ç»™ä¸€ç³»åˆ—å˜é‡çš„ç®€æ´è¯­æ³• èµ‹å€¼è¿ç®—ç¬¦ å·¦ä¾§çš„ [] ç”¨äºæ‰¹é‡å£°æ˜å˜é‡ï¼Œå³ä¾§æ•°ç»„çš„å•å…ƒå€¼å°†è¢«èµ‹å€¼ç»™å·¦ä¾§çš„å˜é‡ã€‚ å˜é‡çš„é¡ºåºå¯¹åº”æ•°ç»„å•å…ƒå€¼çš„ä½ç½®ä¾æ¬¡è¿›è¡Œèµ‹å€¼æ“ä½œ ã€‚ å…¸å‹åº”ç”¨äº¤äº’2ä¸ªå˜é‡ let a = 1let b = 3; ;[b, a] = [a, b] // æ³¨æ„ï¼šè¿™é‡Œå¿…é¡»è¦æœ‰åˆ†å· éœ€æ±‚ï¼šæœ‰ä¸ªæ•°ç»„ï¼š const pc [â€˜æµ·å°”â€™, â€˜è”æƒ³â€™, â€˜å°ç±³â€™, â€˜æ–¹æ­£â€™]ï¼Œè§£æ„ä¸ºå˜é‡: hr lx mi fz script // const arr = [100, 60, 80] // æ•°ç»„è§£æ„ èµ‹å€¼ // // const [max, min, avg] = arr const [max, min, avg] = [100, 60, 80] // // const max = arr[0] // // const min = arr[1] // // const avg = arr[2] console.log(max) // 100 console.log(avg) // 80 // äº¤æ¢2ä¸ªå˜é‡çš„å€¼ let a = 1 let b = 2; [b, a] = [a, b] console.log(a, b)/scriptéœ€æ±‚2ï¼šè¯·å°†æœ€å¤§å€¼å’Œæœ€å°å€¼å‡½æ•°è¿”å›å€¼è§£æ„ max å’Œmin ä¸¤ä¸ªå˜é‡ å˜é‡å¤š å•å…ƒå€¼å°‘çš„æƒ…å†µï¼š const [a, b, c, d] = [1, 2, 3]console.log(a) // 1console.log(b) // 2console.log(c) // 3console.log(d) // undefined å˜é‡çš„æ•°é‡å¤§äºå•å…ƒå€¼æ•°é‡æ—¶ï¼Œå¤šä½™çš„å˜é‡å°†è¢«èµ‹å€¼ä¸º undefined å˜é‡å°‘ å•å…ƒå€¼å¤šçš„æƒ…å†µï¼š const [a, b] = [1, 2, 3]console.log(a) // 1console.log(b) // 2 åˆ©ç”¨å‰©ä½™å‚æ•°è§£å†³å˜é‡å°‘ å•å…ƒå€¼å¤šçš„æƒ…å†µï¼š const [a, b, ...c] = [1, 2, 3, 4]console.log(a) // 1console.log(b) // 2console.log(c) // [3, 4] çœŸæ•°ç»„ å‰©ä½™å‚æ•°è¿”å›çš„è¿˜æ˜¯ä¸€ä¸ªæ•°ç»„ é˜²æ­¢æœ‰undefinedä¼ é€’å•å…ƒå€¼çš„æƒ…å†µï¼Œå¯ä»¥è®¾ç½®é»˜è®¤å€¼ï¼š const [a = 0, b = 0] = [1, 2] // a=1, b=2const [a = 0, b = 0] = [] // a=0, b=0 å…è®¸åˆå§‹åŒ–å˜é‡çš„é»˜è®¤å€¼ï¼Œä¸”åªæœ‰å•å…ƒå€¼ä¸º undefined æ—¶é»˜è®¤å€¼æ‰ä¼šç”Ÿæ•ˆ æŒ‰éœ€å¯¼å…¥ï¼Œå¿½ç•¥æŸäº›è¿”å›å€¼ï¼š const [a, b, , d] = [1, 2, 3, 4]console.log(a) // 1console.log(b) // 2console.log(d) // 4 æ”¯æŒå¤šç»´æ•°ç»„çš„ç»“æ„ï¼š const arr = [1, 2, [3, 4]]console.log(arr[0]) // 1console.log(arr[1]) // 2console.log(arr[2]) // [3,4]console.log(arr[2][0]) // 3// å¤šç»´æ•°ç»„è§£æ„const arr = [1, 2, [3, 4]]const [a, b, c] = [1, 2, [3, 4]]console.log(a) // 1console.log(b) // 2console.log(c) // [3,4]// å¤šç»´æ•°ç»„è§£æ„const [a, b, [c, d]] = [1, 2, [3, 4]]console.log(a) // 1console.log(b) // 2console.log(c) // 3console.log(d) // 4 å¯¹è±¡ç»“æ„ å¯¹è±¡è§£æ„æ˜¯å°†å¯¹è±¡å±æ€§å’Œæ–¹æ³•å¿«é€Ÿæ‰¹é‡èµ‹å€¼ç»™ä¸€ç³»åˆ—å˜é‡çš„ç®€æ´è¯­æ³• èµ‹å€¼è¿ç®—ç¬¦ å·¦ä¾§çš„ {} ç”¨äºæ‰¹é‡å£°æ˜å˜é‡ï¼Œå³ä¾§å¯¹è±¡çš„å±æ€§å€¼å°†è¢«èµ‹å€¼ç»™å·¦ä¾§çš„å˜é‡ å¯¹è±¡å±æ€§çš„å€¼å°†è¢«èµ‹å€¼ç»™ä¸å±æ€§åç›¸åŒçš„å˜é‡ æ³¨æ„è§£æ„çš„å˜é‡åä¸è¦å’Œå¤–é¢çš„å˜é‡åå†²çªå¦åˆ™æŠ¥é”™ å¯¹è±¡ä¸­æ‰¾ä¸åˆ°ä¸å˜é‡åä¸€è‡´çš„å±æ€§æ—¶å˜é‡å€¼ä¸º undefined const user = name: å°æ˜, age: 18const name, age = userconsole.log(name) // å°æ˜console.log(age) // 18 ç»™æ–°çš„å˜é‡åèµ‹å€¼ï¼š å¯ä»¥ä»ä¸€ä¸ªå¯¹è±¡ä¸­æå–å˜é‡å¹¶åŒæ—¶ä¿®æ”¹æ–°çš„å˜é‡å const user = name: å°æ˜, age: 18// æŠŠåŸæ¥çš„ name å˜é‡é‡å‘½åä¸º unameconst name: uname, age = userconsole.log(uname) // å°æ˜console.log(age) // 18 å†’å·è¡¨ç¤ºâ€œä»€ä¹ˆå€¼ï¼šèµ‹å€¼ç»™è°â€ æ•°ç»„å¯¹è±¡è§£æ„ const user = [ name: å°æ˜, age: 18 ]// æŠŠåŸæ¥çš„ name å˜é‡é‡å‘½åä¸º unameconst [ name, age ] = userconsole.log(name) // å°æ˜console.log(age) // 18 å¤šçº§å¯¹è±¡è§£æ„ï¼š const person = [ name: ä½©å¥‡, family: mother: çŒªå¦ˆå¦ˆ, father: çŒªçˆ¸çˆ¸, sister: ä¹”æ²» , age: 6 ]const [ name, family: mother, father, sister ] = personconsole.log(name)console.log(mother)console.log(father)console.log(sister) script // 1. è¿™æ˜¯åå°ä¼ é€’è¿‡æ¥çš„æ•°æ® const msg = code: 200, msg: è·å–æ–°é—»åˆ—è¡¨æˆåŠŸ, data: [ id: 1, title: 5Gå•†ç”¨è‡ªå·±ï¼Œä¸‰å¤§è¿ç”¨å•†æ”¶å…¥ä¸‹é™, count: 58 , id: 2, title: å›½é™…åª’ä½“å¤´æ¡é€Ÿè§ˆ, count: 56 , id: 3, title: ä¹Œå…‹å…°å’Œä¿„ç½—æ–¯æŒç»­å†²çª, count: 1669 , ] // éœ€æ±‚1ï¼š è¯·å°†ä»¥ä¸Šmsgå¯¹è±¡ é‡‡ç”¨å¯¹è±¡è§£æ„çš„æ–¹å¼ åªé€‰å‡º data æ–¹é¢åé¢ä½¿ç”¨æ¸²æŸ“é¡µé¢ // const data = msg // console.log(data) // éœ€æ±‚2ï¼š ä¸Šé¢msgæ˜¯åå°ä¼ é€’è¿‡æ¥çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦æŠŠdataé€‰å‡ºå½“åšå‚æ•°ä¼ é€’ç»™ å‡½æ•° // const data = msg // msg è™½ç„¶å¾ˆå¤šå±æ€§ï¼Œä½†æ˜¯æˆ‘ä»¬åˆ©ç”¨è§£æ„åªè¦ dataå€¼ function render( data ) // const data = arr // æˆ‘ä»¬åªè¦ data æ•°æ® // å†…éƒ¨å¤„ç† console.log(data) render(msg) // éœ€æ±‚3ï¼Œ ä¸ºäº†é˜²æ­¢msgé‡Œé¢çš„dataåå­—æ··æ·†ï¼Œè¦æ±‚æ¸²æŸ“å‡½æ•°é‡Œé¢çš„æ•°æ®åæ”¹ä¸º myData function render( data: myData ) // è¦æ±‚å°† è·å–è¿‡æ¥çš„ dataæ•°æ® æ›´åä¸º myData // å†…éƒ¨å¤„ç† console.log(myData) render(msg) /script 2.6 æ„é€ å‡½æ•°2.6.1 åˆ›å»ºå¯¹è±¡çš„ä¸‰ç§æ–¹å¼ åˆ©ç”¨å¯¹è±¡å­—é¢é‡åˆ›å»ºå¯¹è±¡ const o = name: ä½©å¥‡ åˆ©ç”¨ new Object åˆ›å»ºå¯¹è±¡ const o = new Object(name:ä½©å¥‡)console.log(o) åˆ©ç”¨æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡ æ„é€ å‡½æ•° ï¼šæ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ï¼Œä¸»è¦ç”¨æ¥åˆå§‹åŒ–å¯¹è±¡ ä½¿ç”¨åœºæ™¯ å¸¸è§„çš„ {â€¦} è¯­æ³•å…è®¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚æ¯”å¦‚æˆ‘ä»¬åˆ›å»ºäº†ä½©å¥‡çš„å¯¹è±¡ï¼Œç»§ç»­åˆ›å»ºä¹”æ²»çš„å¯¹è±¡è¿˜éœ€è¦é‡æ–°å†™ä¸€éï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°æ¥å¿«é€Ÿåˆ›å»ºå¤šä¸ªç±»ä¼¼çš„å¯¹è±¡ const Pepa = name: ä½©å¥‡, age: 6, gender: å¥³const George name: ä¹”æ²», age: 3, gender: ç”·const Mum = name: çŒªå¦ˆå¦ˆ, age: 30, gender: å¥³const Dab = name: çŒªçˆ¸çˆ¸, age: 32, gender: ç”·//----------------------------------function Pig(name, age, gender) this.name = name this.age = age this.gender = genderconst Peppa = new Pig(ä½©å¥‡, 6, å¥³)const George = new Pig(ä¹”æ²», 3, ç”·)const Mum = new Pig(çŒªå¦ˆå¦ˆ, 30, å¥³)const Dad = new Pig(çŒªçˆ¸çˆ¸, 32, ç”·) æ„é€ å‡½æ•°åœ¨æŠ€æœ¯ä¸Šæ˜¯å¸¸è§„å‡½æ•°ã€‚ä¸è¿‡æœ‰ä¸¤ä¸ªçº¦å®šï¼š å®ƒä»¬çš„å‘½åä»¥å¤§å†™å­—æ¯å¼€å¤´ã€‚ å®ƒä»¬åªèƒ½ç”± â€œnewâ€ æ“ä½œç¬¦æ¥æ‰§è¡Œã€‚ 2.6.2 æ„é€ å‡½æ•° è¯­æ³• å¤§å†™å­—æ¯å¼€å¤´çš„å‡½æ•° // 1.åˆ›å»ºæ„é€ å‡½æ•°function Pig(name) this.name = name// 2.new å…³é”®å­—è°ƒç”¨å‡½æ•°new Pig(ä½©å¥‡)// 3.æ¥æ”¶åˆ›å»ºçš„å¯¹è±¡const peppa = new Pig(ä½©å¥‡)console.log(peppa) // name: ä½©å¥‡ è¯´æ˜ ä½¿ç”¨ new å…³é”®å­—è°ƒç”¨å‡½æ•°çš„è¡Œä¸ºè¢«ç§°ä¸ºå®ä¾‹åŒ– å®ä¾‹åŒ–æ„é€ å‡½æ•°æ—¶æ²¡æœ‰å‚æ•°æ—¶å¯ä»¥çœç•¥ () æ„é€ å‡½æ•°å†…éƒ¨æ— éœ€å†™returnï¼Œè¿”å›å€¼å³ä¸ºæ–°åˆ›å»ºçš„å¯¹è±¡ æ„é€ å‡½æ•°å†…éƒ¨çš„ return è¿”å›çš„å€¼æ— æ•ˆï¼Œæ‰€ä»¥ä¸è¦å†™return new Objectï¼ˆï¼‰ new Dateï¼ˆï¼‰ ä¹Ÿæ˜¯å®ä¾‹åŒ–æ„é€ å‡½æ•° ç¤ºä¾‹ éœ€æ±‚ï¼šâ‘ ï¼šå†™ä¸€ä¸ªGoodsæ„é€ å‡½æ•°â‘¡ï¼šé‡Œé¢åŒ…å«å±æ€§ name å•†å“åç§° price ä»·æ ¼ count åº“å­˜æ•°é‡â‘¢ï¼šå®ä¾‹åŒ–å¤šä¸ªå•†å“å¯¹è±¡ï¼Œå¹¶æ‰“å°åˆ°æ§åˆ¶å°ï¼Œä¾‹å¦‚å°ç±³ 1999 20 åä¸º 3999 59 vivo 1888 100htmlbody script function Goods(name, price, count) this.name = name this.price = price this.count = count this.sayhi = function () const mi = new Goods(å°ç±³, 1999, 20) console.log(mi) const hw = new Goods(åä¸º, 3999, 59) console.log(hw) console.log(mi === hw) mi.name = vivo console.log(mi) console.log(hw) // const date = new Date(2022-4-8) // console.log(date) // é™æ€æˆå‘˜ Goods.num = 10 console.log(Goods.num) Goods.sayhi = function () /script/body/html å®ä¾‹åŒ–æ‰§è¡Œè¿‡ç¨‹ åˆ›å»ºæ–°å¯¹è±¡ æ„é€ å‡½æ•°thisæŒ‡å‘æ–°å¯¹è±¡ æ‰§è¡Œæ„é€ å‡½æ•°ä»£ç ï¼Œä¿®æ”¹thisï¼Œæ·»åŠ æ–°çš„å±æ€§ è¿”å›æ–°å¯¹è±¡ 2.6.3 å®ä¾‹æˆå‘˜ æ¦‚å¿µ é€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºçš„å¯¹è±¡ç§°ä¸ºå®ä¾‹å¯¹è±¡ï¼Œå®ä¾‹å¯¹è±¡ä¸­çš„å±æ€§å’Œæ–¹æ³•ç§°ä¸ºå®ä¾‹æˆå‘˜ è¯´æ˜ å®ä¾‹å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•å³ä¸ºå®ä¾‹æˆå‘˜ ä¸ºæ„é€ å‡½æ•°ä¼ å…¥å‚æ•°ï¼ŒåŠ¨æ€åˆ›å»ºç»“æ„ç›¸åŒä½†å€¼ä¸åŒçš„å¯¹è±¡ æ„é€ å‡½æ•°åˆ›å»ºçš„å®ä¾‹å¯¹è±¡å½¼æ­¤ç‹¬ç«‹äº’ä¸å½±å“ ç¤ºä¾‹ function Person() // æ„é€ å‡½æ•°å†…éƒ¨çš„ this å°±æ˜¯å®ä¾‹å¯¹è±¡ // å®ä¾‹å¯¹è±¡ä¸­åŠ¨æ€æ·»åŠ å±æ€§ this.name = å°æ˜ // å®ä¾‹å¯¹è±¡ä¸­åŠ¨æ€æ·»åŠ æ–¹æ³• this.sayHi = function() console.log(å¤§å®¶å¥½~) // å®ä¾‹åŒ–ï¼Œ p1æ˜¯å®ä¾‹å¯¹è±¡const p1 = new Person()console.log(p1)console.log(p1.name) // è®¿é—®å®ä¾‹å±æ€§p1.sayHi() // è°ƒç”¨å®ä¾‹æ–¹æ³• 2.6.4 é™æ€æˆå‘˜ æ¦‚å¿µ æ„é€ å‡½æ•°çš„å±æ€§å’Œæ–¹æ³•è¢«ç§°ä¸ºé™æ€æˆå‘˜ è¯´æ˜ æ„é€ å‡½æ•°çš„å±æ€§å’Œæ–¹æ³•è¢«ç§°ä¸ºé™æ€æˆå‘˜ ä¸€èˆ¬å…¬å…±ç‰¹å¾çš„å±æ€§æˆ–æ–¹æ³•é™æ€æˆå‘˜è®¾ç½®ä¸ºé™æ€æˆå‘˜ é™æ€æˆå‘˜æ–¹æ³•ä¸­çš„ this æŒ‡å‘æ„é€ å‡½æ•°æœ¬èº« ç¤ºä¾‹ function Person(name, age) // çœç•¥å®ä¾‹æˆå‘˜// é™æ€å±æ€§Person.eyes = 2Person.arms = 2// é™æ€æ–¹æ³•Person.walk = function() console.log(äººäººéƒ½ä¼šèµ°è·¯) // this æŒ‡å‘ Person console.log(this.eyes) 2.6.5 å†…ç½®æ„é€ å‡½æ•° åœ¨ JavaScript ä¸­æœ€ä¸»è¦çš„æ•°æ®ç±»å‹æœ‰ 6 ç§ åŸºæœ¬æ•°æ®ç±»å‹ï¼š å­—ç¬¦ä¸²ã€æ•°å€¼ã€å¸ƒå°”ã€undefinedã€null å¼•ç”¨ç±»å‹: å¯¹è±¡ ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¼šå‘ç°æœ‰äº›ç‰¹æ®Šæƒ…å†µ // æ™®é€šå­—ç¬¦ä¸²const str = andyconsole.log(str.length) å…¶å®å­—ç¬¦ä¸²ã€æ•°å€¼ã€å¸ƒå°”ã€ç­‰åŸºæœ¬ç±»å‹ä¹Ÿéƒ½æœ‰ä¸“é—¨çš„æ„é€ å‡½æ•°ï¼Œè¿™äº›æˆ‘ä»¬ç§°ä¸ºåŒ…è£…ç±»å‹ JSä¸­å‡ ä¹æ‰€æœ‰çš„æ•°æ®éƒ½å¯ä»¥åŸºäºæ„é€ å‡½æ•°åˆ›å»º å¼•ç”¨ç±»å‹ï¼šObjectï¼ŒArrayï¼ŒRegExpï¼ŒDate ç­‰ åŒ…è£…ç±»å‹ï¼šStringï¼ŒNumberï¼ŒBoolean ç­‰ Object Object æ˜¯å†…ç½®çš„æ„é€ å‡½æ•°ï¼Œç”¨äºåˆ›å»ºæ™®é€šå¯¹è±¡ã€‚ // é€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºæ™®é€šå¯¹è±¡const user = new Object(name: å°æ˜, age: 15)// å­—é¢é‡æ–¹å¼åˆ›å»ºæ™®é€šå¯¹è±¡const user = name: å°æ˜, age: 15 æ¨èä½¿ç”¨å­—é¢é‡æ–¹å¼å£°æ˜å¯¹è±¡ï¼Œè€Œä¸æ˜¯ Object æ„é€ å‡½æ•° å­¦ä¹ ä¸‰ä¸ªå¸¸ç”¨é™æ€æ–¹æ³•ï¼ˆé™æ€æ–¹æ³•å°±æ˜¯åªæœ‰æ„é€ å‡½æ•°Objectå¯ä»¥è°ƒç”¨çš„ï¼‰ã€‚ // æƒ³è¦è·å¾—å¯¹è±¡é‡Œé¢çš„å±æ€§å’Œå€¼æ€ä¹ˆåšï¼Ÿconst o = name: å°æ˜, age: 15for (let k in o) console.log(k) // å±æ€§ name age console.log(o[k]) // å€¼ å°æ˜ 15 Object.keys ä½œç”¨ï¼šObject.keys é™æ€æ–¹æ³•è·å–å¯¹è±¡ä¸­æ‰€æœ‰å±æ€§ï¼ˆé”®ï¼‰ è¯­æ³•ï¼š const o = name: å°æ˜, age: 15// è·å–å¯¹è±¡çš„æ‰€æœ‰é”®ï¼Œå¹¶ä¸”è¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„const arr = Object.keys(o)console.log(arr) // [name, age] æ³¨æ„ï¼šè¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ Object.values ä½œç”¨ï¼šObject.values é™æ€æ–¹æ³•è·å–å¯¹è±¡ä¸­æ‰€æœ‰å±æ€§å€¼ è¯­æ³•ï¼š const o = name: å°æ˜, age: 15// è·å–å¯¹è±¡çš„æ‰€æœ‰é”®ï¼Œå¹¶ä¸”è¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„const arr = Object.values(o)console.log(arr) // [å°æ˜, 15] æ³¨æ„ï¼š è¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ Object. assign ä½œç”¨ï¼šObject. assign é™æ€æ–¹æ³•å¸¸ç”¨äºå¯¹è±¡æ‹·è´ï¼Œç»å¸¸ä½¿ç”¨çš„åœºæ™¯ç»™å¯¹è±¡æ·»åŠ å±æ€§ è¯­æ³•ï¼š // æ‹·è´å¯¹è±¡ æŠŠ 0 æ‹·è´ç»™ objconst o = name: ä½©å¥‡, age: 6const obj = Object.assign(obj, o)console.log(obj) // name: ä½©å¥‡, age: 6Object.assign(o, gender: å¥³)console.log(o) // name: ä½©å¥‡, age: 6, gender: å¥³ Array æ•°ç»„å¸¸è§å®ä¾‹æ–¹æ³•-æ ¸å¿ƒæ–¹æ³• æ–¹æ³• ä½œç”¨ è¯´æ˜ forEach éå†æ•°ç»„ ä¸è¿”å›ï¼Œç”¨äºä¸æ”¹å˜å€¼ï¼Œç»å¸¸ç”¨äºæŸ¥æ‰¾æ‰“å°è¾“å‡ºå€¼ filter è¿‡æ»¤æ•°ç»„ ç­›é€‰æ•°ç»„å…ƒç´ ï¼Œå¹¶ç”Ÿæˆæ–°æ•°ç»„ map è¿­ä»£æ•°ç»„ è¿”å›æ–°æ•°ç»„ï¼Œæ–°æ•°ç»„é‡Œé¢çš„å…ƒç´ å¤„ç†ä¹‹åçš„å€¼ï¼Œç»å¸¸ç”¨äºå¤„ç†æ•°æ® reduce ç´¯è®¡å™¨ è¿”å›å‡½æ•°ç´¯è®¡å¤„ç†çš„ç»“æœï¼Œç»å¸¸ç”¨äºæ±‚å’Œç­‰ reduce ä½œç”¨ï¼šreduce è¿”å›å‡½æ•°ç´¯è®¡å¤„ç†çš„ç»“æœï¼Œç»å¸¸ç”¨äºæ±‚å’Œç­‰ åŸºæœ¬è¯­æ³•ï¼š arr.reduce(function(), èµ·å§‹å€¼) å‚æ•°ï¼š èµ·å§‹å€¼å¯ä»¥çœç•¥ï¼Œå¦‚æœå†™å°±ä½œä¸ºç¬¬ä¸€æ¬¡ç´¯è®¡çš„èµ·å§‹å€¼ è¯­æ³•ï¼š arr.reduce(function(ç´¯è®¡å€¼, å½“å‰å…ƒç´  [,ç´¢å¼•å·][,æºæ•°ç»„]), èµ·å§‹å€¼) ç´¯è®¡å€¼å‚æ•°ï¼š å¦‚æœæœ‰èµ·å§‹å€¼ï¼Œåˆ™ä»¥èµ·å§‹å€¼ä¸ºå‡†å¼€å§‹ç´¯è®¡ï¼Œ ç´¯è®¡å€¼ èµ·å§‹å€¼ å¦‚æœæ²¡æœ‰èµ·å§‹å€¼ï¼Œ åˆ™ç´¯è®¡å€¼ä»¥æ•°ç»„çš„ç¬¬ä¸€ä¸ªæ•°ç»„å…ƒç´ ä½œä¸ºèµ·å§‹å€¼å¼€å§‹ç´¯è®¡ åé¢æ¯æ¬¡éå†å°±ä¼šç”¨åé¢çš„æ•°ç»„å…ƒç´  ç´¯è®¡åˆ° ç´¯è®¡å€¼ é‡Œé¢ ï¼ˆç±»ä¼¼æ±‚å’Œé‡Œé¢çš„ sum ï¼‰ ä½¿ç”¨åœºæ™¯ï¼šæ±‚å’Œè¿ç®— const arr = [1, 5, 9]const count = arr.reduce((prev, item) = prev + item)console.log(count) ç»ƒä¹  éœ€æ±‚ï¼šâ‘ ï¼šç»™å‘˜å·¥æ¯äººæ¶¨è–ª 30%â‘¡ï¼šç„¶åè®¡ç®—éœ€è¦æ”¯å‡ºçš„è´¹ç”¨æ•°æ®ï¼šconst arr = [ name: å¼ ä¸‰, salary: 10000, name: æå››, salary: 10000, name: ç‹äº”, salary: 10000,]const total = arr.reduce((prev, item) = prev += item.salary * 0.3, 0) æ•°ç»„å¸¸è§æ–¹æ³•- ä¼ªæ•°ç»„è½¬æ¢ä¸ºçœŸæ•°ç»„ é™æ€æ–¹æ³• Array.from() å…¶å®ƒæ–¹æ³• String åœ¨ JavaScript ä¸­çš„å­—ç¬¦ä¸²ã€æ•°å€¼ã€å¸ƒå°”å…·æœ‰å¯¹è±¡çš„ä½¿ç”¨ç‰¹å¾ï¼Œå¦‚å…·æœ‰å±æ€§å’Œæ–¹æ³• ä¹‹æ‰€ä»¥å…·æœ‰å¯¹è±¡ç‰¹å¾çš„åŸå› æ˜¯å­—ç¬¦ä¸²ã€æ•°å€¼ã€å¸ƒå°”ç±»å‹æ•°æ®æ˜¯ JavaScript åº•å±‚ä½¿ç”¨ Object æ„é€ å‡½æ•°â€œåŒ…è£…â€æ¥çš„ï¼Œè¢«ç§°ä¸ºåŒ…è£…ç±»å‹ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script //1. split æŠŠå­—ç¬¦ä¸² è½¬æ¢ä¸º æ•°ç»„ å’Œ join() ç›¸å // const str = pink,red // const arr = str.split(,) // console.log(arr) // const str1 = 2022-4-8 // const arr1 = str1.split(-) // console.log(arr1) // 2. å­—ç¬¦ä¸²çš„æˆªå– substring(å¼€å§‹çš„ç´¢å¼•å·[ï¼Œ ç»“æŸçš„ç´¢å¼•å·]) // 2.1 å¦‚æœçœç•¥ ç»“æŸçš„ç´¢å¼•å·ï¼Œé»˜è®¤å–åˆ°æœ€å // 2.2 ç»“æŸçš„ç´¢å¼•å·ä¸åŒ…å«æƒ³è¦æˆªå–çš„éƒ¨åˆ† // const str = ä»Šå¤©åˆè¦åšæ ¸é…¸äº† // console.log(str.substring(5, 7)) // 3. startsWith åˆ¤æ–­æ˜¯ä¸æ˜¯ä»¥æŸä¸ªå­—ç¬¦å¼€å¤´ // const str = pinkè€å¸ˆä¸Šè¯¾ä¸­ // console.log(str.startsWith(pink)) // 4. includes åˆ¤æ–­æŸä¸ªå­—ç¬¦æ˜¯ä¸æ˜¯åŒ…å«åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²é‡Œé¢ const str = æˆ‘æ˜¯pinkè€å¸ˆ console.log(str.includes(pink)) // true /script/body/html å¸¸è§å®ä¾‹æ–¹æ³•å’Œå±æ€§ å®ä¾‹å±æ€§lengthç”¨æ¥è·å–å­—ç¬¦ä¸²çš„é•¿åº¦ï¼ˆé‡ç‚¹ï¼‰ å®ä¾‹æ–¹æ³•split(åˆ†éš”ç¬¦)ç”¨æ¥å°†å­—ç¬¦ä¸²æ‹†åˆ†æˆæ•°ç»„ï¼ˆé‡ç‚¹ï¼‰ å®ä¾‹æ–¹æ³•substring(éœ€è¦æˆªå–çš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ç´¢å¼•[,ç»“æŸçš„ç´¢å¼•å·])ç”¨äºå­—ç¬¦ä¸²æˆªå–ï¼ˆé‡ç‚¹ï¼‰ å®ä¾‹æ–¹æ³•startWith(æ£€æµ‹å­—ç¬¦ä¸²[,æ£€æµ‹ä½ç½®ç´¢å¼•å·])æ£€æµ‹æ˜¯å¦ä»¥æŸå­—ç¬¦å¼€å¤´ï¼ˆé‡ç‚¹ï¼‰ å®ä¾‹æ–¹æ³•includes(æœç´¢çš„å­—ç¬¦ä¸²[,æ£€æµ‹ä½ç½®ç´¢å¼•å·])åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åŒ…å«åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œæ ¹æ®æƒ…å†µè¿”å›trueæˆ–è€…falseï¼ˆé‡ç‚¹ï¼‰ å®ä¾‹æ–¹æ³•toUpperCaseç”¨äºå­—æ¯è½¬æ¢æˆå¤§å†™ å®ä¾‹æ–¹æ³•toLowerCaseç”¨äºå­—æ¯è½¬æ¢æˆå°å†™ å®ä¾‹æ–¹æ³•indexOfæ£€æµ‹æ˜¯å¦åŒ…å«æŸå­—ç¬¦ å®ä¾‹æ–¹æ³•endsWithæ£€æµ‹æ˜¯å¦ä»¥æŸå­—ç¬¦ç»“å°¾ å®ä¾‹æ–¹æ³•replaceç”¨äºæ›¿æ¢å­—ç¬¦ä¸²ï¼Œæ”¯æŒæ­£åˆ™åŒ¹é… å®ä¾‹æ–¹æ³•mathç”¨äºæŸ¥æ‰¾å­—ç¬¦ä¸²ï¼Œæ”¯æŒæ­£åˆ™åŒ¹é… Number Number æ˜¯å†…ç½®çš„æ„é€ å‡½æ•°ï¼Œç”¨äºåˆ›å»ºæ•°å€¼ å¸¸ç”¨æ–¹æ³•ï¼štoFixed() è®¾ç½®ä¿ç•™å°æ•°ä½çš„é•¿åº¦ const price = 12.345// å››èˆäº”å…¥console.log(price.toFixed(2)) // 12.35 3. æ·±å…¥å¯¹è±¡3.1 ç¼–ç¨‹æ€æƒ³ é¢å‘è¿‡ç¨‹ é¢å‘è¿‡ç¨‹å°±æ˜¯åˆ†æå‡ºè§£å†³é—®é¢˜æ‰€éœ€è¦çš„æ­¥éª¤ï¼Œç„¶åç”¨å‡½æ•°æŠŠè¿™äº›æ­¥éª¤ä¸€æ­¥ä¸€æ­¥å®ç°ï¼Œä½¿ç”¨çš„æ—¶å€™å†ä¸€ä¸ªä¸€ä¸ªçš„ä¾æ¬¡è°ƒç”¨å°±å¯ä»¥äº† ä¸¾ä¸ªæ —å­ï¼šè›‹ç‚’é¥­ é¢å‘è¿‡ç¨‹ï¼Œå°±æ˜¯æŒ‰ç…§æˆ‘ä»¬åˆ†æå¥½äº†çš„æ­¥éª¤ï¼ŒæŒ‰ç…§æ­¥éª¤è§£å†³é—®é¢˜ é¢å‘å¯¹è±¡ é¢å‘å¯¹è±¡æ˜¯æŠŠäº‹åŠ¡åˆ†è§£æˆä¸ºä¸€ä¸ªä¸ªå¯¹è±¡ï¼Œç„¶åç”±å¯¹è±¡ä¹‹é—´åˆ†å·¥ä¸åˆä½œ ä¸¾ä¸ªæ —å­ï¼šç›–æµ‡é¥­ é¢å‘å¯¹è±¡æ˜¯ä»¥å¯¹è±¡åŠŸèƒ½æ¥åˆ’åˆ†é—®é¢˜ï¼Œè€Œä¸æ˜¯æ­¥éª¤ åœ¨é¢å‘å¯¹è±¡ç¨‹åºå¼€å‘æ€æƒ³ä¸­ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡éƒ½æ˜¯åŠŸèƒ½ä¸­å¿ƒï¼Œå…·æœ‰æ˜ç¡®åˆ†å·¥ã€‚ é¢å‘å¯¹è±¡ç¼–ç¨‹å…·æœ‰çµæ´»ã€ä»£ç å¯å¤ç”¨ã€å®¹æ˜“ç»´æŠ¤å’Œå¼€å‘çš„ä¼˜ç‚¹ï¼Œæ›´é€‚åˆå¤šäººåˆä½œçš„å¤§å‹è½¯ä»¶é¡¹ç›® é¢å‘å¯¹è±¡çš„ç‰¹æ€§ï¼š å°è£…æ€§ ç»§æ‰¿æ€§ å¤šæ€æ€§ å¯¹æ¯” é¢å‘è¿‡ç¨‹ç¼–ç¨‹ ä¼˜ç‚¹ï¼šæ€§èƒ½æ¯”é¢å‘å¯¹è±¡é«˜ï¼Œé€‚åˆè·Ÿç¡¬ä»¶è”ç³»å¾ˆç´§å¯†çš„ä¸œè¥¿ï¼Œä¾‹å¦‚å•ç‰‡æœºå°±é‡‡ç”¨çš„é¢å‘è¿‡ç¨‹ç¨‹ã€‚ ç¼ºç‚¹ï¼šæ²¡æœ‰é¢å‘å¯¹è±¡æ˜“ç»´æŠ¤ã€æ˜“å¤ç”¨ã€æ˜“æ‰©å±• é¢å‘å¯¹è±¡ç¼–ç¨‹ ä¼˜ç‚¹ï¼šæ˜“ç»´æŠ¤ã€æ˜“å¤ç”¨ã€æ˜“æ‰©å±•ï¼Œç”±äºé¢å‘å¯¹è±¡æœ‰å°è£…ã€ç»§æ‰¿ã€å¤šæ€æ€§çš„ç‰¹æ€§ï¼Œå¯ä»¥è®¾è®¡å‡ºä½è€¦åˆçš„ç³»ç»Ÿï¼Œä½¿ç³»ç»Ÿ æ›´åŠ çµæ´»ã€æ›´åŠ æ˜“äºç»´æŠ¤ ç¼ºç‚¹ï¼šæ€§èƒ½æ¯”é¢å‘è¿‡ç¨‹ä½ 3.2 æ„é€ å‡½æ•° å°è£…æ˜¯é¢å‘å¯¹è±¡æ€æƒ³ä¸­æ¯”è¾ƒé‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œjsé¢å‘å¯¹è±¡å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°å®ç°çš„å°è£… åŒæ ·çš„å°†å˜é‡å’Œå‡½æ•°ç»„åˆåˆ°äº†ä¸€èµ·å¹¶èƒ½é€šè¿‡ this å®ç°æ•°æ®çš„å…±äº«ï¼Œæ‰€ä¸åŒçš„æ˜¯å€ŸåŠ©æ„é€ å‡½æ•°åˆ›å»ºå‡ºæ¥çš„å®ä¾‹å¯¹è±¡ä¹‹é—´æ˜¯å½¼æ­¤ä¸å½±å“çš„ æ€»ç»“ æ„é€ å‡½æ•°ä½“ç°äº†é¢å‘å¯¹è±¡çš„å°è£…ç‰¹æ€§ æ„é€ å‡½æ•°å®ä¾‹åˆ›å»ºçš„å¯¹è±¡å½¼æ­¤ç‹¬ç«‹ã€äº’ä¸å½±å“ å°è£…æ˜¯é¢å‘å¯¹è±¡æ€æƒ³ä¸­æ¯”è¾ƒé‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œjsé¢å‘å¯¹è±¡å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°å®ç°çš„å°è£… å‰é¢æˆ‘ä»¬å­¦è¿‡çš„æ„é€ å‡½æ•°æ–¹æ³•å¾ˆå¥½ç”¨ï¼Œä½†æ˜¯ å­˜åœ¨æµªè´¹å†…å­˜çš„é—®é¢˜ function Star(uname, age) this.uname = uname this.age = age this.sing = function() console.log(æˆ‘ä¼šå”±æ­Œ) const ldh = new Star(åˆ˜å¾·å, 18)const zxy = new Star(å¼ å­¦å‹, 19)console.log(ldh.sing === zxy.sing) // false, è¯´æ˜ä¿©å‡½æ•°ä¸ä¸€æ · æˆ‘ä»¬å¸Œæœ›æ‰€æœ‰çš„å¯¹è±¡ä½¿ç”¨åŒä¸€ä¸ªå‡½æ•°ï¼Œè¿™æ ·å°±æ¯”è¾ƒèŠ‚çœå†…å­˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦æ€æ ·åšå‘¢ï¼Ÿ 3.3 åŸå‹ ä½œç”¨ æ„é€ å‡½æ•°é€šè¿‡åŸå‹åˆ†é…çš„å‡½æ•°æ˜¯æ‰€æœ‰å¯¹è±¡æ‰€ å…±äº«çš„ JavaScript è§„å®šï¼Œæ¯ä¸€ä¸ªæ„é€ å‡½æ•°éƒ½æœ‰ä¸€ä¸ª prototype å±æ€§ï¼ŒæŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿç§°ä¸ºåŸå‹å¯¹è±¡ è¿™ä¸ªå¯¹è±¡å¯ä»¥æŒ‚è½½å‡½æ•°ï¼Œå¯¹è±¡å®ä¾‹åŒ–ä¸ä¼šå¤šæ¬¡åˆ›å»ºåŸå‹ä¸Šå‡½æ•°ï¼ŒèŠ‚çº¦å†…å­˜ æˆ‘ä»¬å¯ä»¥æŠŠé‚£äº›ä¸å˜çš„æ–¹æ³•ï¼Œç›´æ¥å®šä¹‰åœ¨ prototype å¯¹è±¡ä¸Šï¼Œè¿™æ ·æ‰€æœ‰å¯¹è±¡çš„å®ä¾‹å°±å¯ä»¥å…±äº«è¿™äº›æ–¹æ³• æ„é€ å‡½æ•°å’ŒåŸå‹å¯¹è±¡ä¸­çš„this éƒ½æŒ‡å‘ å®ä¾‹åŒ–çš„å¯¹è±¡ ç¤ºä¾‹ function Star(uname, age) this.uname = uname this.age = age console.log(Start.prototype) // è¿”å›ä¸€ä¸ªå¯¹è±¡çš„åŸå‹å¯¹è±¡Start.prototype.sing = function() console.log(æˆ‘ä¼šå”±æ­Œ)const ldh = new Star(åˆ˜å¾·å, 18)const zxy = new Star(å¼ å­¦å‹, 19)console.log(ldh.sing === zxy.sing) // true, è¯´æ˜ä¿©å‡½æ•°ä¸€æ · 3.4 constructor å±æ€§ æ¦‚å¿µ åœ¨å“ªé‡Œï¼Ÿ æ¯ä¸ªåŸå‹å¯¹è±¡é‡Œé¢éƒ½æœ‰ä¸ªconstructor å±æ€§ï¼ˆconstructor æ„é€ å‡½æ•°ï¼‰ ä½œç”¨ è¯¥å±æ€§æŒ‡å‘è¯¥åŸå‹å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼Œ ç®€å•ç†è§£ï¼Œå°±æ˜¯æŒ‡å‘æˆ‘çš„çˆ¸çˆ¸ ä½¿ç”¨åœºæ™¯ å¦‚æœæœ‰å¤šä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç»™åŸå‹å¯¹è±¡é‡‡å–å¯¹è±¡å½¢å¼èµ‹å€¼ã€‚ ä½†æ˜¯è¿™æ ·å°±ä¼šè¦†ç›–æ„é€ å‡½æ•°åŸå‹å¯¹è±¡åŸæ¥çš„å†…å®¹ï¼Œè¿™æ ·ä¿®æ”¹åçš„åŸå‹å¯¹è±¡ constructor å°±ä¸å†æŒ‡å‘å½“å‰æ„é€ å‡½æ•°äº†ã€‚ æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¿®æ”¹åçš„åŸå‹å¯¹è±¡ä¸­ï¼Œæ·»åŠ ä¸€ä¸ª constructor æŒ‡å‘åŸæ¥çš„æ„é€ å‡½æ•°ã€‚ ç¤ºä¾‹ function Star(name) this.name = nameStart.prototype = sing: function() console.log(å”±æ­Œ) dance: function() console.log(è·³èˆ)console.log(Start.prototype.constructor) // æŒ‡å‘ Object======================================== function Start(name) this.name = nameStart.prototype = // æ‰‹åŠ¨åˆ©ç”¨ constructor æŒ‡å› Startæ„é€ å‡½æ•° constructor: Start, sing: function() console.log(å”±æ­Œ) dance: function() console.log(è·³èˆ)console.log(Start.prototype.constructor) // æŒ‡å‘ Start 3.5 å¯¹è±¡åŸå‹ æ¦‚å¿µ å¯¹è±¡éƒ½ä¼šæœ‰ä¸€ä¸ªå±æ€§ __proto__ æŒ‡å‘æ„é€ å‡½æ•°çš„ prototype åŸå‹å¯¹è±¡ï¼Œä¹‹æ‰€ä»¥æˆ‘ä»¬å¯¹è±¡å¯ä»¥ä½¿ç”¨æ„é€ å‡½æ•° prototype åŸå‹å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ï¼Œå°±æ˜¯å› ä¸ºå¯¹è±¡æœ‰ __proto__ åŸå‹çš„å­˜åœ¨ æ³¨æ„ __proto__ æ˜¯JSéæ ‡å‡†å±æ€§ [[prototype]]å’Œ__proto__æ„ä¹‰ç›¸åŒ ç”¨æ¥è¡¨æ˜å½“å‰å®ä¾‹å¯¹è±¡æŒ‡å‘å“ªä¸ªåŸå‹å¯¹è±¡prototype __proto__å¯¹è±¡åŸå‹é‡Œé¢ä¹Ÿæœ‰ä¸€ä¸ª constructorå±æ€§ï¼ŒæŒ‡å‘åˆ›å»ºè¯¥å®ä¾‹å¯¹è±¡çš„æ„é€ å‡½æ•° ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script function Star() const ldh = new Star() // å¯¹è±¡åŸå‹__proto__ æŒ‡å‘ æ”¹æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ console.log(ldh.__proto__) // console.log(ldh.__proto__ === Star.prototype) // å¯¹è±¡åŸå‹é‡Œé¢æœ‰constructor æŒ‡å‘ æ„é€ å‡½æ•° Star console.log(ldh.__proto__.constructor === Star) /script/body/html 3.6 åŸå‹ç»§æ‰¿ ä½œç”¨ ç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„å¦ä¸€ä¸ªç‰¹å¾ï¼Œé€šè¿‡ç»§æ‰¿è¿›ä¸€æ­¥æå‡ä»£ç å°è£…çš„ç¨‹åº¦ï¼ŒJavaScript ä¸­å¤§å¤šæ˜¯å€ŸåŠ©åŸå‹å¯¹è±¡å®ç°ç»§æ‰¿çš„ç‰¹æ€§ ç¤ºä¾‹ åŸå§‹ä»£ç  function Man() this.head = 1 this.eyes = 2 this.legs = 2 this.say = function() this.eat = function() const pink = new Man()function Woman() this.head = 1 this.eyes = 2 this.legs = 2 this.say = function() this.eat = function() this.baby = function() const red = new Woman() å°è£…-æŠ½å–å…¬å…±éƒ¨åˆ† // æŠŠç”·äººå’Œå¥³äººå…¬å…±çš„éƒ¨åˆ†æŠ½å–å‡ºæ¥æ”¾åˆ°äººç±»é‡Œé¢// äººç±»const People = head: 1, eyes: 2, legs: 2, say: function(), eat: function()// ç”·äººfunction Man()// å¥³äººfunction Woman() this.baby = function() ç»§æ‰¿-è®©ç”·äººå’Œå¥³äººéƒ½èƒ½ç»§æ‰¿äººç±»çš„ä¸€äº›å±æ€§å’Œæ–¹æ³• æŠŠç”·äººå¥³äººå…¬å…±çš„å±æ€§å’Œæ–¹æ³•æŠ½å–å‡ºæ¥ People ç„¶åèµ‹å€¼ç»™Mançš„åŸå‹å¯¹è±¡ï¼Œå¯ä»¥å…±äº«è¿™äº›å±æ€§å’Œæ–¹æ³• æ³¨æ„è®©constructoræŒ‡å›Manè¿™ä¸ªæ„é€ å‡½æ•° // äººç±»const People = head: 1, eyes: 2, legs: 2, say: function(), eat: function()// ç”·äººfunction Man()// æŠŠå…¬å…±çš„å±æ€§å’Œæ–¹æ³•ç»™åŸå‹ï¼Œè¿™æ ·å°±å¯ä»¥å…±äº«äº†Man.prototype = People// æ³¨æ„è®©åŸå‹é‡Œé¢çš„constructoré‡æ–°æŒ‡å›Manæ‰¾è‡ªå·±çš„çˆ¸çˆ¸Man.prototype.constructor = Manconst pink = new Man()console.log(pink) é—®é¢˜ å¦‚æœæˆ‘ä»¬ç»™ç”·äººæ·»åŠ äº†ä¸€ä¸ªå¸çƒŸçš„æ–¹æ³•ï¼Œå‘ç°å¥³äººè‡ªåŠ¨ä¹Ÿæ·»åŠ è¿™ä¸ªæ–¹æ³• Man.prototype = People// æ³¨æ„è®©åŸå‹é‡Œé¢çš„constructoré‡æ–°æŒ‡å›Manæ‰¾è‡ªå·±çš„çˆ¸çˆ¸Man.prototype.constructor = Manconst pink = new Man()Man.prototype.smoking = function() console.log(pink)// å¥³äººfunction Woman() this.baby = function()// æŠŠå…¬å…±çš„å±æ€§å’Œæ–¹æ³•ç»™åŸå‹ï¼Œè¿™æ ·å°±å¯ä»¥å…±äº«äº†Woman.prototype = People// æ³¨æ„è®©åŸå‹é‡Œé¢çš„constructoré‡æ–°æŒ‡å›Womanæ‰¾è‡ªå·±çš„çˆ¸çˆ¸Woman.prototype.constructor = Womanconst red = new Woman()console.log(red) é—®é¢˜â€“åŸå›  ç”·äººå’Œå¥³äººéƒ½åŒæ—¶ä½¿ç”¨äº†åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ ¹æ®å¼•ç”¨ç±»å‹çš„ç‰¹ç‚¹ï¼Œä»–ä»¬æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¿®æ”¹ä¸€ä¸ªå°±ä¼šéƒ½å½±å“ è§£å†³ éœ€æ±‚ï¼šç”·äººå’Œå¥³äººä¸è¦ä½¿ç”¨åŒä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯ä¸åŒå¯¹è±¡é‡Œé¢åŒ…å«ç›¸åŒçš„å±æ€§å’Œæ–¹æ³• ç­”æ¡ˆï¼šæ„é€ å‡½æ•° new æ¯æ¬¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ function Star(uname, age) this.uname = uname this.age = age this.sing = function() console.log(æˆ‘ä¼šå”±æ­Œ) const ldh = new Star(åˆ˜å¾·å, 18)const zxy = new Star(å¼ å­¦å‹, 19)console.log(ldh.sing === zxy.sing) // false, è¯´æ˜ä¿©å‡½æ•°ä¸ä¸€æ · ç»§æ‰¿å†™æ³•å®Œå–„ // äººç±»function Person = head: 1, eyes: 2, legs: 2, say: function(), eat: function()// ç”·äººfunction Man()// æŠŠå…¬å…±çš„å±æ€§å’Œæ–¹æ³•ç»™åŸå‹ï¼Œè¿™æ ·å°±å¯ä»¥å…±äº«äº†Man.prototype = new Person()// æ³¨æ„è®©åŸå‹é‡Œé¢çš„constructoré‡æ–°æŒ‡å›Manæ‰¾è‡ªå·±çš„çˆ¸çˆ¸Man.prototype.constructor = Manconst pink = new Man()Man.prototype.smoking = function() console.log(pink)// å¥³äººfunction Woman() this.baby = function()// æŠŠå…¬å…±çš„å±æ€§å’Œæ–¹æ³•ç»™åŸå‹ï¼Œè¿™æ ·å°±å¯ä»¥å…±äº«äº†Woman.prototype = new Person()// æ³¨æ„è®©åŸå‹é‡Œé¢çš„constructoré‡æ–°æŒ‡å›Womanæ‰¾è‡ªå·±çš„çˆ¸çˆ¸Woman.prototype.constructor = Womanconst red = new Woman()console.log(red) æ€è·¯ çœŸæ­£åšè¿™ä¸ªæ¡ˆä¾‹ï¼Œæˆ‘ä»¬çš„æ€è·¯åº”è¯¥æ˜¯å…ˆè€ƒè™‘å¤§çš„ï¼Œåè€ƒè™‘å°çš„ äººç±»å…±æœ‰çš„å±æ€§å’Œæ–¹æ³•æœ‰å“ªäº›ï¼Œç„¶ååšä¸ªæ„é€ å‡½æ•°ï¼Œè¿›è¡Œå°è£…ï¼Œä¸€èˆ¬å…¬å…±å±æ€§å†™åˆ°æ„é€ å‡½æ•°å†…éƒ¨ï¼Œå…¬å…±æ–¹æ³•ï¼ŒæŒ‚è½½åˆ°æ„é€ å‡½æ•°åŸå‹èº«ä¸Š ç”·äººç»§æ‰¿äººç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œä¹‹ååˆ›å»ºè‡ªå·±ç‹¬æœ‰çš„å±æ€§å’Œæ–¹æ³• å¥³äººåŒç† 3.7 åŸå‹é“¾ æ¦‚å¿µ åŸºäºåŸå‹å¯¹è±¡çš„ç»§æ‰¿ä½¿å¾—ä¸åŒæ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡å…³è”åœ¨ä¸€èµ·ï¼Œå¹¶ä¸”è¿™ç§å…³è”çš„å…³ç³»æ˜¯ä¸€ç§é“¾çŠ¶çš„ç»“æ„ï¼Œæˆ‘ä»¬å°†åŸå‹å¯¹è±¡çš„é“¾çŠ¶ç»“æ„å…³ç³»ç§°ä¸ºåŸå‹é“¾ æŸ¥æ‰¾è§„åˆ™ å½“è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å±æ€§ï¼ˆåŒ…æ‹¬æ–¹æ³•ï¼‰æ—¶ï¼Œé¦–å…ˆæŸ¥æ‰¾è¿™ä¸ªå¯¹è±¡è‡ªèº«æœ‰æ²¡æœ‰è¯¥å±æ€§ã€‚ å¦‚æœæ²¡æœ‰å°±æŸ¥æ‰¾å®ƒçš„åŸå‹ï¼ˆä¹Ÿå°±æ˜¯ __proto__æŒ‡å‘çš„ prototype åŸå‹å¯¹è±¡ï¼‰ å¦‚æœè¿˜æ²¡æœ‰å°±æŸ¥æ‰¾åŸå‹å¯¹è±¡çš„åŸå‹ï¼ˆObjectçš„åŸå‹å¯¹è±¡ï¼‰ ä¾æ­¤ç±»æ¨ä¸€ç›´æ‰¾åˆ° Object ä¸ºæ­¢ï¼ˆnullï¼‰ __proto__å¯¹è±¡åŸå‹çš„æ„ä¹‰å°±åœ¨äºä¸ºå¯¹è±¡æˆå‘˜æŸ¥æ‰¾æœºåˆ¶æä¾›ä¸€ä¸ªæ–¹å‘ï¼Œæˆ–è€…è¯´ä¸€æ¡è·¯çº¿ å¯ä»¥ä½¿ç”¨ instanceof è¿ç®—ç¬¦ç”¨äºæ£€æµ‹æ„é€ å‡½æ•°çš„ prototype å±æ€§æ˜¯å¦å‡ºç°åœ¨æŸä¸ªå®ä¾‹å¯¹è±¡çš„åŸå‹é“¾ä¸Š ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script // function Objetc() console.log(Object.prototype) console.log(Object.prototype.__proto__) function Person() const ldh = new Person() // console.log(ldh.__proto__ === Person.prototype) // console.log(Person.prototype.__proto__ === Object.prototype) console.log(ldh instanceof Person) console.log(ldh instanceof Object) console.log(ldh instanceof Array) console.log([1, 2, 3] instanceof Array) console.log(Array instanceof Object) /script/body/html 4. é«˜çº§æŠ€å·§4.1 æ·±æµ…æ‹·è´ é—®é¢˜ å¼€å‘ä¸­æˆ‘ä»¬ç»å¸¸éœ€è¦å¤åˆ¶ä¸€ä¸ªå¯¹è±¡ã€‚å¦‚æœç›´æ¥ç”¨èµ‹å€¼ä¼šæœ‰ä¸‹é¢é—®é¢˜ const pink = name: pinkè€å¸ˆ, age: 18const red = pinkconsole.log(red) // name: pinkè€å¸ˆ, age: 18red.name = redconsole.log(red) // name: red, age: 18// pinkå¯¹è±¡é‡Œçš„nameå€¼ä¹Ÿå‘ç”Ÿäº†å˜åŒ–console.log(pink) // name: red, age: 18 æµ…æ‹·è´ é¦–å…ˆæµ…æ‹·è´å’Œæ·±æ‹·è´åªé’ˆå¯¹å¼•ç”¨ç±»å‹ æµ…æ‹·è´ï¼šæ‹·è´çš„æ˜¯åœ°å€ å¸¸è§æ–¹æ³•ï¼š æ‹·è´å¯¹è±¡ï¼šObject.assgin() å±•å¼€è¿ç®—ç¬¦ {â€¦obj} æ‹·è´å¯¹è±¡ æ‹·è´æ•°ç»„ï¼šArray.prototype.concat() æˆ–è€… [â€¦arr] const obj = uname: pinkconst o = ...obj console.log(o) // uname: pinko.uname = redconsole.log(o) // uname: redconsole.log(obj) // uname: pinkconst pink = name: pinkè€å¸ˆ, age: 18const red = Object.assign(red, pink)console.log(red) // name: pinkè€å¸ˆ, age: 18red.name = redconsole.log(red) // name: red, age: 18// ä¸ä¼šå½±å“pinkconsole.log(pink) // name: pinkè€å¸ˆ, age: 18// å¦‚æœæ˜¯ç®€å•æ•°æ®ç±»å‹æ‹·è´å€¼ï¼Œå¼•ç”¨æ•°æ®ç±»å‹æ‹·è´çš„æ˜¯åœ°å€ (ç®€å•ç†è§£ï¼š å¦‚æœæ˜¯å•å±‚å¯¹è±¡ï¼Œæ²¡é—®é¢˜ï¼Œå¦‚æœæœ‰å¤šå±‚å°±æœ‰é—®é¢˜)const pink = name: pinkè€å¸ˆ, age: 18, family: mother: pinkå¦ˆå¦ˆ const red = Object.assign(red, pink)console.log(red) // name: pinkè€å¸ˆ, age: 18, family: mother: pinkå¦ˆå¦ˆred.name = redred.family.mother = redå¦ˆå¦ˆconsole.log(red) // name: pinkè€å¸ˆ, age: 18, family: mother: redå¦ˆå¦ˆconsole.log(pink) // name: pinkè€å¸ˆ, age: 18, family: mother: redå¦ˆå¦ˆ ç›´æ¥èµ‹å€¼å’Œæµ…æ‹·è´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç›´æ¥èµ‹å€¼çš„æ–¹æ³•ï¼Œåªè¦æ˜¯å¯¹è±¡ï¼Œéƒ½ä¼šç›¸äº’å½±å“ï¼Œå› ä¸ºæ˜¯ç›´æ¥æ‹·è´å¯¹è±¡æ ˆé‡Œé¢çš„åœ°å€ æµ…æ‹·è´å¦‚æœæ˜¯ä¸€å±‚å¯¹è±¡ï¼Œä¸ç›¸äº’å½±å“ï¼Œå¦‚æœå‡ºç°å¤šå±‚å¯¹è±¡æ‹·è´è¿˜ä¼šç›¸äº’å½±å“ æµ…æ‹·è´æ€ä¹ˆç†è§£ï¼Ÿ æ‹·è´å¯¹è±¡ä¹‹åï¼Œé‡Œé¢çš„å±æ€§å€¼æ˜¯ç®€å•æ•°æ®ç±»å‹ç›´æ¥æ‹·è´å€¼ å¦‚æœå±æ€§å€¼æ˜¯å¼•ç”¨æ•°æ®ç±»å‹åˆ™æ‹·è´çš„æ˜¯åœ°å€ æ·±æ‹·è´ å¸¸è§æ–¹æ³•ï¼š é€šè¿‡é€’å½’å®ç°æ·±æ‹·è´ lodashcloneDeep é€šè¿‡JSON.stringify()å®ç° å‡½æ•°é€’å½’ï¼š å¦‚æœä¸€ä¸ªå‡½æ•°åœ¨å†…éƒ¨å¯ä»¥è°ƒç”¨å…¶æœ¬èº«ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±æ˜¯é€’å½’å‡½æ•° ç®€å•ç†è§£:å‡½æ•°å†…éƒ¨è‡ªå·±è°ƒç”¨è‡ªå·±, è¿™ä¸ªå‡½æ•°å°±æ˜¯é€’å½’å‡½æ•° é€’å½’å‡½æ•°çš„ä½œç”¨å’Œå¾ªç¯æ•ˆæœç±»ä¼¼ ç”±äºé€’å½’å¾ˆå®¹æ˜“å‘ç”Ÿâ€œæ ˆæº¢å‡ºâ€é”™è¯¯ï¼ˆstack overflowï¼‰ï¼Œæ‰€ä»¥å¿…é¡»è¦åŠ é€€å‡ºæ¡ä»¶ return const o = function deepCopy(newObj, oldObj) for (let k in oldObj) if (oldObj[k] instanceof Array) newObj[k] = [] deepCopy(newObj[k], oldObj[k]) else if (oldObj[k] instanceof Object) newObj[k] = deepCopy(newObj[k], oldObj[k]) else newObj[k] = oldObj[k] jsåº“lodashé‡Œé¢cloneDeepå†…éƒ¨å®ç°äº†æ·±æ‹·è´ const obj = uname: pink, age: 18, hobby: [ç¯®çƒ, è¶³çƒ], family: baby: å°pink // è¯­æ³•ï¼š_.cloneDeep(è¦è¢«å…‹éš†çš„å¯¹è±¡)const o = _.cloneDeep(obj)console.log(o) é€šè¿‡JSON.stringify()å®ç° const obj = uname: pink, age: 18, hobby: [ç¯®çƒ, è¶³çƒ], family: baby: å°pink // è¯­æ³•ï¼š_.cloneDeep(è¦è¢«å…‹éš†çš„å¯¹è±¡)const o = JSON.parse(JSON.stringify(obj))console.log(o) 4.2 å¼‚å¸¸å¤„ç†4.2.1 throw æ¦‚å¿µ å¼‚å¸¸å¤„ç†æ˜¯æŒ‡é¢„ä¼°ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½å‘ç”Ÿçš„é”™è¯¯ï¼Œç„¶åæœ€å¤§ç¨‹åº¦çš„é¿å…é”™è¯¯çš„å‘ç”Ÿå¯¼è‡´æ•´ä¸ªç¨‹åºæ— æ³•ç»§ç»­è¿è¡Œ è¯­æ³• function counter(x, y) if (!x || !y) throw new Error(å‚æ•°ä¸èƒ½ä¸ºç©º) return x + ycounter() æ€»ç»“ throw æŠ›å‡ºå¼‚å¸¸ä¿¡æ¯ï¼Œç¨‹åºä¹Ÿä¼šç»ˆæ­¢æ‰§è¡Œ throw åé¢è·Ÿçš„æ˜¯é”™è¯¯æç¤ºä¿¡æ¯ Error å¯¹è±¡é…åˆ throw ä½¿ç”¨ï¼Œèƒ½å¤Ÿè®¾ç½®æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ 4.2.2 trycatch æ•è·å¼‚å¸¸ ä½œç”¨ æˆ‘ä»¬å¯ä»¥é€šè¿‡try catch æ•è·é”™è¯¯ä¿¡æ¯ï¼ˆæµè§ˆå™¨æä¾›çš„é”™è¯¯ä¿¡æ¯ï¼‰ try è¯•è¯• catch æ‹¦ä½ finally ç¤ºä¾‹ function foo() try // æŸ¥æ‰¾domèŠ‚ç‚¹ const p = document.querySelector(.p) p.style.color = red catch (error) // try ä»£ç æ®µä¸­æ‰§è¡Œæœ‰é”™è¯¯æ—¶ï¼Œä¼šæ‰§è¡Œ catch ä»£ç æ®µ // æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ console.log(error.message) return finally alert(è¿è¡Œ) console.log(å¦‚æœå‡ºç°é”™è¯¯ï¼Œè¿™å¥ä¸ä¼šæ‰§è¡Œ)foo() æ€»ç»“ tryâ€¦catch ç”¨äºæ•è·é”™è¯¯ä¿¡æ¯ å°†é¢„ä¼°å¯èƒ½å‘ç”Ÿé”™è¯¯çš„ä»£ç å†™åœ¨ try ä»£ç æ®µä¸­ å¦‚æœ try ä»£ç æ®µä¸­å‡ºç°é”™è¯¯åï¼Œä¼šæ‰§è¡Œ catch ä»£ç æ®µï¼Œå¹¶æˆªè·åˆ°é”™è¯¯ä¿¡æ¯ finally ä¸ç®¡æ˜¯å¦æœ‰é”™è¯¯ï¼Œéƒ½ä¼šæ‰§è¡Œ 4.2.3 debugger å¯ä»¥é€šè¿‡try catch æ•è·é”™è¯¯ä¿¡æ¯ï¼ˆæµè§ˆå™¨æä¾›çš„é”™è¯¯ä¿¡æ¯ï¼‰","tags":["JavaScript","JSå¼‚å¸¸å¤„ç†","JSä½œç”¨åŸŸ","JSå¯¹è±¡åŸå‹"],"categories":["å‰ç«¯"]},{"title":"MyBatisï¼ˆäºŒï¼‰æŸ¥è¯¢è§£æ","path":"/2023/12/06/2023-12-06-MyBatisï¼ˆäºŒï¼‰æŸ¥è¯¢è§£æ/","content":"åœ¨MyBatisï¼ˆä¸€ï¼‰é…ç½®è§£æä¸­æˆ‘ä»¬äº†è§£åˆ°äº†MyBatiså¦‚ä½•è§£æé…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨é…ç½®æ–‡ä»¶æ„å»ºäº†Configurationå¯¹è±¡ã€‚å¹¶æ ¹æ®Configurationå¯¹è±¡æ„å»ºå‡ºä¸€ä¸ªSqlSessionFactoryå¯¹è±¡ã€‚æœ¬ç¯‡å°†ä»‹ç»å¦‚ä½•æ ¹æ®æ„å»ºçš„SqlSessionFactoryå¯¹è±¡ç”Ÿæˆä¸€ä¸ªSqlSessionå¯¹è±¡ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„æŸ¥è¯¢æ“ä½œã€‚ 1. JDKåŠ¨æ€ä»£ç† åœ¨åˆ†æmapperæ¥å£æŸ¥è¯¢å‰æµç¨‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ä¸‹åŠ¨æ€ä»£ç†åŠŸèƒ½ åŠ¨æ€ä»£ç†æ˜¯Javaä¸­ä¸€ç§å¼ºå¤§çš„æœºåˆ¶ï¼Œå…è®¸åœ¨è¿è¡Œæ—¶ç”Ÿæˆä»£ç†ç±»ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶é¢„å…ˆåˆ›å»ºä»£ç†ç±»ã€‚Javaä¸­çš„åŠ¨æ€ä»£ç†é€šå¸¸é€šè¿‡java.lang.reflectåŒ…ä¸­çš„Proxyç±»å’ŒInvocationHandleræ¥å£æ¥å®ç° åˆ›å»ºæ¥å£ é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œè¯¥æ¥å£å°†ç”±åŠ¨æ€ä»£ç†ç±»å®ç°ã€‚è¿™ä¸ªæ¥å£æ˜¯ä½ è¦ä»£ç†çš„ç›®æ ‡æ¥å£ public interface MyInterface void doSomething(); å®ç°InvocationHandleræ¥å£ åˆ›å»ºä¸€ä¸ªç±»å®ç°InvocationHandleræ¥å£ï¼Œè¯¥æ¥å£ä¸­æœ‰ä¸€ä¸ªæ–¹æ³•invokeï¼Œå®ƒåœ¨ä»£ç†å¯¹è±¡ä¸Šæ‰§è¡Œæ–¹æ³•è°ƒç”¨ import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;public class MyInvocationHandler implements InvocationHandler private Object realObject; public MyInvocationHandler(Object realObject) this.realObject = realObject; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable // åœ¨è¿™é‡Œæ‰§è¡Œé¢å¤–çš„é€»è¾‘ System.out.println(Before method invocation); // è°ƒç”¨å®é™…å¯¹è±¡çš„æ–¹æ³• Object result = method.invoke(realObject, args); // åœ¨è¿™é‡Œæ‰§è¡Œé¢å¤–çš„é€»è¾‘ System.out.println(After method invocation); return result; åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡ ä½¿ç”¨Proxy.newProxyInstanceæ–¹æ³•åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡ import java.lang.reflect.Proxy;public class Main public static void main(String[] args) MyInterface realObject = new MyInterfaceImpl(); // å®é™…å¯¹è±¡ MyInvocationHandler handler = new MyInvocationHandler(realObject); // åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡ MyInterface proxyObject = (MyInterface) Proxy.newProxyInstance( MyInterface.class.getClassLoader(), new Class[]MyInterface.class, handler ); // ä½¿ç”¨ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³• proxyObject.doSomething(); åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼ŒMyInterfaceImplæ˜¯MyInterfaceæ¥å£çš„å®é™…å®ç°ç±»ã€‚é€šè¿‡åŠ¨æ€ä»£ç†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ–¹æ³•è°ƒç”¨å‰åæ‰§è¡Œé¢å¤–çš„é€»è¾‘ã€‚ è¯·æ³¨æ„ï¼ŒåŠ¨æ€ä»£ç†åªèƒ½ä»£ç†æ¥å£ï¼Œè€Œä¸æ˜¯å…·ä½“çš„ç±»ã€‚å¦‚æœéœ€è¦ä»£ç†å…·ä½“çš„ç±»ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œå¦‚CGLIB ç¤ºä¾‹ import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;// æ¥å£interface Calculator int add(int a, int b);// æ¥å£çš„å®ç°ç±»class CalculatorImpl implements Calculator @Override public int add(int a, int b) return a + b; // InvocationHandler å®ç°ç±»class LoggingHandler implements InvocationHandler private Object target; public LoggingHandler(Object target) this.target = target; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable System.out.println(Before invoking method: + method.getName()); // è°ƒç”¨å®é™…å¯¹è±¡çš„æ–¹æ³• Object result = method.invoke(target, args); System.out.println(After invoking method: + method.getName()); return result; public class DynamicProxyExample public static void main(String[] args) // åˆ›å»ºå®é™…å¯¹è±¡ Calculator calculator = new CalculatorImpl(); // åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡ Calculator proxyCalculator = (Calculator) Proxy.newProxyInstance( Calculator.class.getClassLoader(), new Class[]Calculator.class, new LoggingHandler(calculator) ); // ä½¿ç”¨ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³• int result = proxyCalculator.add(3, 5); System.out.println(Result: + result); 2. æ„å»ºSqlSession è·å–SqlSession public class MyBatisDemoTest @Test public void test() throws IOException // ç¬¬ä¸€é˜¶æ®µï¼šMyBatisåˆå§‹åŒ–é˜¶æ®µ // è¯»å– MyBatis é…ç½®æ–‡ä»¶ InputStream inputStream = Resources.getResourceAsStream(mybatis-config.xml); SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); // ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®å¤„ç†é˜¶æ®µ // æ‰“å¼€ä¸€ä¸ª SqlSession try (SqlSession sqlSession = sqlSessionFactory.openSession()) // è·å– Mapper UserMapper userMapper = sqlSession.getMapper(UserMapper.class); User user = new User(); user.setSchoolName(æ¸…åå¤§å­¦); // è°ƒç”¨ Mapper ä¸­çš„æ–¹æ³• ListUser users = userMapper.queryUserBySchoolName(user.getSchoolName()); // å¤„ç†æŸ¥è¯¢ç»“æœ for (User user1 : users) System.out.println(user1.getName() + : + user1.getSchoolName()); åœ¨MyBatisï¼ˆä¸€ï¼‰é…ç½®è§£æä¸­ä»‹ç»äº†new SqlSessionFactoryBuilder().build(inputStream)è¿”å›äº†DefaultSqlSessionFactory æ‰§è¡ŒopenSession()å¾—åˆ°è¿”å›çš„DefaultSqlSession DefaultSqlSessionä¸­å°è£…äº†æ‰§è¡Œsqlçš„Executoræ˜ å°„å™¨ï¼ˆé»˜è®¤æ˜¯CachingExecutor) SqlSession sqlSession = sqlSessionFactory.openSession()private SqlSession openSessionFromDataSource(ExecutorType execType, TransactionIsolationLevel level, boolean autoCommit) Transaction tx = null; try final Environment environment = configuration.getEnvironment(); // è·å–äº‹åŠ¡å·¥å‚ final TransactionFactory transactionFactory = getTransactionFactoryFromEnvironment(environment); // è·å–äº‹åŠ¡å¯¹è±¡ tx = transactionFactory.newTransaction(environment.getDataSource(), level, autoCommit); final Executor executor = configuration.newExecutor(tx, execType); // è¿”å›DefaultSqlSession return new DefaultSqlSession(configuration, executor, autoCommit); catch (Exception e) closeTransaction(tx); // may have fetched a connection so lets call close() throw ExceptionFactory.wrapException(Error opening session. Cause: + e, e); finally ErrorContext.instance().reset(); åœ¨ä¸Šè¿°ä»£ç ä¸­è¿”å›äº†DefaultSqlSessionï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨å®ƒç»§æ‰¿çš„æ¥å£SqlSessionä¸­æä¾›äº†æŸ¥è¯¢ã€å¢åŠ ã€æ›´æ–°ã€åˆ é™¤ã€æäº¤ã€å›æ»šç­‰å¤§é‡çš„æ–¹æ³• /* * Copyright 2009-2011 the original author or authors. * * Licensed under the Apache License, Version 2.0 (the License); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * * http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an AS IS BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */package org.apache.ibatis.session;import java.io.Closeable;import java.sql.Connection;import java.util.List;import java.util.Map;import org.apache.ibatis.executor.BatchResult;/** * The primary Java interface for working with MyBatis. * Through this interface you can execute commands, get mappers and manage transactions. * * @author Clinton Begin *//** * è¿™æ˜¯MyBatisä¸»è¦çš„ä¸€ä¸ªç±»ï¼Œç”¨æ¥æ‰§è¡ŒSQLï¼Œè·å–æ˜ å°„å™¨ï¼Œç®¡ç†äº‹åŠ¡ * * é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨çš„Mybatisçš„APIå°±æ˜¯è¿™ä¸ªæ¥å£å®šä¹‰çš„æ–¹æ³•ã€‚ * */public interface SqlSession extends Closeable /** * Retrieve a single row mapped from the statement key * æ ¹æ®æŒ‡å®šçš„SqlIDè·å–ä¸€æ¡è®°å½•çš„å°è£…å¯¹è±¡ * @param T the returned object type å°è£…ä¹‹åçš„å¯¹è±¡ç±»å‹ * @param statement sqlID * @return Mapped object å°è£…ä¹‹åçš„å¯¹è±¡ */ T T selectOne(String statement); /** * Retrieve a single row mapped from the statement key and parameter. * æ ¹æ®æŒ‡å®šçš„SqlIDè·å–ä¸€æ¡è®°å½•çš„å°è£…å¯¹è±¡ï¼Œåªä¸è¿‡è¿™ä¸ªæ–¹æ³•å®¹è®¸æˆ‘ä»¬å¯ä»¥ç»™sqlä¼ é€’ä¸€äº›å‚æ•° * ä¸€èˆ¬åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¿™ä¸ªå‚æ•°ä¼ é€’çš„æ˜¯pojoï¼Œæˆ–è€…Mapæˆ–è€…ImmutableMap * @param T the returned object type * @param statement Unique identifier matching the statement to use. * @param parameter A parameter object to pass to the statement. * @return Mapped object */ T T selectOne(String statement, Object parameter); /** * Retrieve a list of mapped objects from the statement key and parameter. * æ ¹æ®æŒ‡å®šçš„sqlIdè·å–å¤šæ¡è®°å½• * @param E the returned list element type * @param statement Unique identifier matching the statement to use. * @return List of mapped object */ E ListE selectList(String statement); /** * Retrieve a list of mapped objects from the statement key and parameter. * è·å–å¤šæ¡è®°å½•ï¼Œè¿™ä¸ªæ–¹æ³•å®¹è®¸æˆ‘ä»¬å¯ä»¥ä¼ é€’ä¸€äº›å‚æ•° * @param E the returned list element type * @param statement Unique identifier matching the statement to use. * @param parameter A parameter object to pass to the statement. * @return List of mapped object */ E ListE selectList(String statement, Object parameter); /** * Retrieve a list of mapped objects from the statement key and parameter, * within the specified row bounds. * è·å–å¤šæ¡è®°å½•ï¼Œè¿™ä¸ªæ–¹æ³•å®¹è®¸æˆ‘ä»¬å¯ä»¥ä¼ é€’ä¸€äº›å‚æ•°ï¼Œä¸è¿‡è¿™ä¸ªæ–¹æ³•å®¹è®¸æˆ‘ä»¬è¿›è¡Œ * åˆ†é¡µæŸ¥è¯¢ã€‚ * * éœ€è¦æ³¨æ„çš„æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼ŒMybatisä¸ºäº†æ‰©å±•æ€§ï¼Œä»…ä»…æ”¯æŒå†…å­˜åˆ†é¡µã€‚ä¹Ÿå°±æ˜¯ä¼šå…ˆæŠŠ * æ‰€æœ‰çš„æ•°æ®æŸ¥è¯¢å‡ºæ¥ä»¥åï¼Œç„¶ååœ¨å†…å­˜ä¸­è¿›è¡Œåˆ†é¡µã€‚å› æ­¤åœ¨å®é™…çš„æƒ…å†µä¸­ï¼Œéœ€è¦æ³¨æ„ * è¿™ä¸€ç‚¹ã€‚ * * ä¸€èˆ¬æƒ…å†µä¸‹å…¬å¸éƒ½ä¼šç¼–å†™è‡ªå·±çš„Mybatis ç‰©ç†åˆ†é¡µæ’ä»¶ * @param E the returned list element type * @param statement Unique identifier matching the statement to use. * @param parameter A parameter object to pass to the statement. * @param rowBounds Bounds to limit object retrieval * @return List of mapped object */ E ListE selectList(String statement, Object parameter, RowBounds rowBounds); /** * The selectMap is a special case in that it is designed to convert a list * of results into a Map based on one of the properties in the resulting * objects. * Eg. Return a of Map[Integer,Author] for selectMap(selectAuthors,id) * å°†æŸ¥è¯¢åˆ°çš„ç»“æœåˆ—è¡¨è½¬æ¢ä¸ºMapç±»å‹ã€‚ * @param K the returned Map keys type * @param V the returned Map values type * @param statement Unique identifier matching the statement to use. * @param mapKey The property to use as key for each value in the list. è¿™ä¸ªå‚æ•°ä¼šä½œä¸ºç»“æœmapçš„key * @return Map containing key pair data. */ K, V MapK, V selectMap(String statement, String mapKey); /** * The selectMap is a special case in that it is designed to convert a list * of results into a Map based on one of the properties in the resulting * objects. * å°†æŸ¥è¯¢åˆ°çš„ç»“æœåˆ—è¡¨è½¬æ¢ä¸ºMapç±»å‹ã€‚è¿™ä¸ªæ–¹æ³•å®¹è®¸æˆ‘ä»¬ä¼ å…¥éœ€è¦çš„å‚æ•° * @param K the returned Map keys type * @param V the returned Map values type * @param statement Unique identifier matching the statement to use. * @param parameter A parameter object to pass to the statement. * @param mapKey The property to use as key for each value in the list. * @return Map containing key pair data. */ K, V MapK, V selectMap(String statement, Object parameter, String mapKey); /** * The selectMap is a special case in that it is designed to convert a list * of results into a Map based on one of the properties in the resulting * objects. * è·å–å¤šæ¡è®°å½•,åŠ ä¸Šåˆ†é¡µ,å¹¶å­˜å…¥Map * @param K the returned Map keys type * @param V the returned Map values type * @param statement Unique identifier matching the statement to use. * @param parameter A parameter object to pass to the statement. * @param mapKey The property to use as key for each value in the list. * @param rowBounds Bounds to limit object retrieval * @return Map containing key pair data. */ K, V MapK, V selectMap(String statement, Object parameter, String mapKey, RowBounds rowBounds); /** * Retrieve a single row mapped from the statement key and parameter * using a @code ResultHandler. * * @param statement Unique identifier matching the statement to use. * @param parameter A parameter object to pass to the statement. * @param handler ResultHandler that will handle each retrieved row * @return Mapped object */ void select(String statement, Object parameter, ResultHandler handler); /** * Retrieve a single row mapped from the statement * using a @code ResultHandler. * è·å–ä¸€æ¡è®°å½•,å¹¶è½¬äº¤ç»™ResultHandlerå¤„ç†ã€‚è¿™ä¸ªæ–¹æ³•å®¹è®¸æˆ‘ä»¬è‡ªå·±å®šä¹‰å¯¹ * æŸ¥è¯¢åˆ°çš„è¡Œçš„å¤„ç†æ–¹å¼ã€‚ä¸è¿‡ä¸€èˆ¬ç”¨çš„å¹¶ä¸æ˜¯å¾ˆå¤š * @param statement Unique identifier matching the statement to use. * @param handler ResultHandler that will handle each retrieved row * @return Mapped object */ void select(String statement, ResultHandler handler); /** * Retrieve a single row mapped from the statement key and parameter * using a @code ResultHandler and @code RowBounds * è·å–ä¸€æ¡è®°å½•,åŠ ä¸Šåˆ†é¡µ,å¹¶è½¬äº¤ç»™ResultHandlerå¤„ç† * @param statement Unique identifier matching the statement to use. * @param rowBounds RowBound instance to limit the query results * @param handler ResultHandler that will handle each retrieved row * @return Mapped object */ void select(String statement, Object parameter, RowBounds rowBounds, ResultHandler handler); /** * Execute an insert statement. * æ’å…¥è®°å½•ã€‚ä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªè¯­å¥åœ¨å®é™…é¡¹ç›®ä¸­ç”¨çš„å¹¶ä¸æ˜¯å¤ªå¤šï¼Œè€Œä¸”æ›´å¤šä½¿ç”¨å¸¦å‚æ•°çš„insertå‡½æ•° * @param statement Unique identifier matching the statement to execute. * @return int The number of rows affected by the insert. */ int insert(String statement); /** * Execute an insert statement with the given parameter object. Any generated * autoincrement values or selectKey entries will modify the given parameter * object properties. Only the number of rows affected will be returned. * æ’å…¥è®°å½•ï¼Œå®¹è®¸ä¼ å…¥å‚æ•°ã€‚ * @param statement Unique identifier matching the statement to execute. * @param parameter A parameter object to pass to the statement. * @return int The number of rows affected by the insert. æ³¨æ„è¿”å›çš„æ˜¯å—å½±å“çš„è¡Œæ•° */ int insert(String statement, Object parameter); /** * Execute an update statement. The number of rows affected will be returned. * æ›´æ–°è®°å½•ã€‚è¿”å›çš„æ˜¯å—å½±å“çš„è¡Œæ•° * @param statement Unique identifier matching the statement to execute. * @return int The number of rows affected by the update. */ int update(String statement); /** * Execute an update statement. The number of rows affected will be returned. * æ›´æ–°è®°å½• * @param statement Unique identifier matching the statement to execute. * @param parameter A parameter object to pass to the statement. * @return int The number of rows affected by the update. è¿”å›çš„æ˜¯å—å½±å“çš„è¡Œæ•° */ int update(String statement, Object parameter); /** * Execute a delete statement. The number of rows affected will be returned. * åˆ é™¤è®°å½• * @param statement Unique identifier matching the statement to execute. * @return int The number of rows affected by the delete. è¿”å›çš„æ˜¯å—å½±å“çš„è¡Œæ•° */ int delete(String statement); /** * Execute a delete statement. The number of rows affected will be returned. * åˆ é™¤è®°å½• * @param statement Unique identifier matching the statement to execute. * @param parameter A parameter object to pass to the statement. * @return int The number of rows affected by the delete. è¿”å›çš„æ˜¯å—å½±å“çš„è¡Œæ•° */ int delete(String statement, Object parameter); //ä»¥ä¸‹æ˜¯äº‹åŠ¡æ§åˆ¶æ–¹æ³•,commit,rollback /** * Flushes batch statements and commits database connection. * Note that database connection will not be committed if no updates/deletes/inserts were called. * To force the commit call @link SqlSession#commit(boolean) */ void commit(); /** * Flushes batch statements and commits database connection. * @param force forces connection commit */ void commit(boolean force); /** * Discards pending batch statements and rolls database connection back. * Note that database connection will not be rolled back if no updates/deletes/inserts were called. * To force the rollback call @link SqlSession#rollback(boolean) */ void rollback(); /** * Discards pending batch statements and rolls database connection back. * Note that database connection will not be rolled back if no updates/deletes/inserts were called. * @param force forces connection rollback */ void rollback(boolean force); /** * Flushes batch statements. * åˆ·æ–°æ‰¹å¤„ç†è¯­å¥,è¿”å›æ‰¹å¤„ç†ç»“æœ * @return BatchResult list of updated records * @since 3.0.6 */ ListBatchResult flushStatements(); /** * Closes the session * å…³é—­Session */ @Override void close(); /** * Clears local session cache * æ¸…ç†Sessionç¼“å­˜ */ void clearCache(); /** * Retrieves current configuration * å¾—åˆ°é…ç½® * @return Configuration */ Configuration getConfiguration(); /** * Retrieves a mapper. * å¾—åˆ°æ˜ å°„å™¨ * è¿™ä¸ªå·§å¦™çš„ä½¿ç”¨äº†æ³›å‹ï¼Œä½¿å¾—ç±»å‹å®‰å…¨ * åˆ°äº†MyBatis 3ï¼Œè¿˜å¯ä»¥ç”¨æ³¨è§£,è¿™æ ·xmléƒ½ä¸ç”¨å†™äº† * @param T the mapper type * @param type Mapper interface class * @return a mapper bound to this SqlSession */ T T getMapper(ClassT type); /** * Retrieves inner database connection * å¾—åˆ°æ•°æ®åº“è¿æ¥ * @return Connection */ Connection getConnection(); 3. ä½¿ç”¨mapperæ¥å£æŸ¥è¯¢3.1 æ„å»ºmapperä»£ç†å¯¹è±¡ è·å–mapper public class MyBatisDemoTest @Test public void test() throws IOException // ç¬¬ä¸€é˜¶æ®µï¼šMyBatisåˆå§‹åŒ–é˜¶æ®µ // è¯»å– MyBatis é…ç½®æ–‡ä»¶ InputStream inputStream = Resources.getResourceAsStream(mybatis-config.xml); SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); // ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®å¤„ç†é˜¶æ®µ // æ‰“å¼€ä¸€ä¸ª SqlSession try (SqlSession sqlSession = sqlSessionFactory.openSession()) // è·å– Mapper UserMapper userMapper = sqlSession.getMapper(UserMapper.class); User user = new User(); user.setSchoolName(æ¸…åå¤§å­¦); // è°ƒç”¨ Mapper ä¸­çš„æ–¹æ³• ListUser users = userMapper.queryUserBySchoolName(user.getSchoolName()); // å¤„ç†æŸ¥è¯¢ç»“æœ for (User user1 : users) System.out.println(user1.getName() + : + user1.getSchoolName()); å›åˆ°ä¸»ä»£ç å¯ä»¥çœ‹åˆ°æ ¹æ®sqlSession.getMapperå¯ä»¥å¾—åˆ°ä¸€ä¸ªmapperæ˜ å°„å™¨ã€‚é€šè¿‡è°ƒç”¨mapperä¸­çš„æŸ¥è¯¢æ–¹æ³•å°±èƒ½å¤Ÿç›´æ¥æ‰§è¡ŒsqlæŸ¥è¯¢å¾—åˆ°æ•°æ®ï¼Œè¿™ä¸ªæ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Ÿ ä½¿ç”¨åŠ¨æ€ä»£ç†æŠ€æœ¯ æ„å»ºmapperä»£ç†å¯¹è±¡ public T void addMapper(ClassT type) if (type.isInterface()) ... try knownMappers.put(type, new MapperProxyFactory(type)); ... finally ... public T T getMapper(ClassT type, SqlSession sqlSession) // åˆå§‹åŒ–æ—¶å·²ç»å°†mapperå¯¹åº”çš„ç±»å‹é€šè¿‡addMapper(ClassT type)æ–¹æ³•åŠ å…¥åˆ°äº†knownMappersä¸­ final MapperProxyFactoryT mapperProxyFactory = (MapperProxyFactoryT) knownMappers.get(type); if (mapperProxyFactory == null) throw new BindingException(Type + type + is not known to the MapperRegistry.); try return mapperProxyFactory.newInstance(sqlSession); catch (Exception e) throw new BindingException(Error getting mapper instance. Cause: + e, e); æ ¹æ®ä¸‹é¢ä»£ç å¯ä»¥çœ‹å‡ºå½“æ‰§è¡ŒmapperProxyFactory.newInstance(sqlSession)æ—¶ï¼Œä¼šæ ¹æ®JDKåŠ¨æ€ä»£ç†ç”ŸæˆMapperProxyçš„ä»£ç†å¯¹è±¡ã€‚ä»£ç†å¯¹è±¡ä¸­å°è£…äº†sqlSession public class MapperProxyFactoryT ... @SuppressWarnings(unchecked) protected T newInstance(MapperProxyT mapperProxy) //ç”¨JDKåŠ¨æ€ä»£ç†ç”Ÿæˆæ˜ å°„å™¨ä»£ç†å¯¹è±¡ return (T) Proxy.newProxyInstance(mapperInterface.getClassLoader(), new Class[] mapperInterface , mapperProxy); public T newInstance(SqlSession sqlSession) final MapperProxyT mapperProxy = new MapperProxy(sqlSession, mapperInterface, methodCache); return newInstance(mapperProxy); 3.2 ä»£ç†å¯¹è±¡æŸ¥è¯¢ å½“æˆ‘ä»¬æ‰§è¡ŒuserMapper.queryUserBySchoolName(user.getSchoolName())ä¼šè§¦å‘MapperProxyçš„invokeæ–¹æ³• /** * æ˜ å°„å™¨ä»£ç†ï¼Œä»£ç†æ¨¡å¼ */public class MapperProxyT implements InvocationHandler, Serializable private static final long serialVersionUID = -6424540398559729838L; private final SqlSession sqlSession; private final ClassT mapperInterface; private final MapMethod, MapperMethod methodCache; public MapperProxy(SqlSession sqlSession, ClassT mapperInterface, MapMethod, MapperMethod methodCache) this.sqlSession = sqlSession; this.mapperInterface = mapperInterface; this.methodCache = methodCache; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable //ä»£ç†ä»¥åï¼Œæ‰€æœ‰Mapperçš„æ–¹æ³•è°ƒç”¨æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨è¿™ä¸ªinvokeæ–¹æ³• //å¹¶ä¸æ˜¯ä»»ä½•ä¸€ä¸ªæ–¹æ³•éƒ½éœ€è¦æ‰§è¡Œè°ƒç”¨ä»£ç†å¯¹è±¡è¿›è¡Œæ‰§è¡Œï¼Œå¦‚æœè¿™ä¸ªæ–¹æ³•æ˜¯Objectä¸­é€šç”¨çš„æ–¹æ³•ï¼ˆtoStringã€hashCodeç­‰ï¼‰æ— éœ€æ‰§è¡Œ if (Object.class.equals(method.getDeclaringClass())) try return method.invoke(this, args); catch (Throwable t) throw ExceptionUtil.unwrapThrowable(t); //è¿™é‡Œä¼˜åŒ–äº†ï¼Œå»ç¼“å­˜ä¸­æ‰¾MapperMethod final MapperMethod mapperMethod = cachedMapperMethod(method); //æ‰§è¡Œ return mapperMethod.execute(sqlSession, args); //å»ç¼“å­˜ä¸­æ‰¾MapperMethod private MapperMethod cachedMapperMethod(Method method) MapperMethod mapperMethod = methodCache.get(method); if (mapperMethod == null) //æ‰¾ä¸åˆ°æ‰å»new mapperMethod = new MapperMethod(mapperInterface, method, sqlSession.getConfiguration()); methodCache.put(method, mapperMethod); return mapperMethod; åœ¨invokeæ–¹æ³•ä¸­æœ€ç»ˆæ‰§è¡ŒmapperMethod.execute(sqlSession, args) å¯ä»¥çœ‹åˆ°æ‰§è¡Œæ—¶å°±æ˜¯4ç§æƒ…å†µï¼Œinsert|update|delete|selectï¼Œåˆ†åˆ«è°ƒç”¨SqlSessionçš„4å¤§ç±»æ–¹æ³• /** * æ˜ å°„å™¨æ–¹æ³• */public class MapperMethod private final SqlCommand command; private final MethodSignature method; public MapperMethod(Class? mapperInterface, Method method, Configuration config) this.command = new SqlCommand(config, mapperInterface, method); this.method = new MethodSignature(config, method); //æ‰§è¡Œ public Object execute(SqlSession sqlSession, Object[] args) Object result; //å¯ä»¥çœ‹åˆ°æ‰§è¡Œæ—¶å°±æ˜¯4ç§æƒ…å†µï¼Œinsert|update|delete|selectï¼Œåˆ†åˆ«è°ƒç”¨SqlSessionçš„4å¤§ç±»æ–¹æ³• if (SqlCommandType.INSERT == command.getType()) Object param = method.convertArgsToSqlCommandParam(args); result = rowCountResult(sqlSession.insert(command.getName(), param)); else if (SqlCommandType.UPDATE == command.getType()) Object param = method.convertArgsToSqlCommandParam(args); result = rowCountResult(sqlSession.update(command.getName(), param)); else if (SqlCommandType.DELETE == command.getType()) Object param = method.convertArgsToSqlCommandParam(args); result = rowCountResult(sqlSession.delete(command.getName(), param)); else if (SqlCommandType.SELECT == command.getType()) if (method.returnsVoid() method.hasResultHandler()) //å¦‚æœæœ‰ç»“æœå¤„ç†å™¨ executeWithResultHandler(sqlSession, args); result = null; else if (method.returnsMany()) //å¦‚æœç»“æœæœ‰å¤šæ¡è®°å½• result = executeForMany(sqlSession, args); else if (method.returnsMap()) //å¦‚æœç»“æœæ˜¯map result = executeForMap(sqlSession, args); else //å¦åˆ™å°±æ˜¯ä¸€æ¡è®°å½• Object param = method.convertArgsToSqlCommandParam(args); result = sqlSession.selectOne(command.getName(), param); else throw new BindingException(Unknown execution method for: + command.getName()); if (result == null method.getReturnType().isPrimitive() !method.returnsVoid()) throw new BindingException(Mapper method + command.getName() + attempted to return null from a method with a primitive return type ( + method.getReturnType() + ).); return result; ... sqlSessionæ‰§è¡ŒæŸ¥è¯¢æ–¹æ³• åˆ›å»ºMapperMethodå¯¹è±¡æ—¶ä¼šæ ¹æ®methodåˆ›å»ºMethodSignatureå¯¹è±¡ï¼Œæ ¹æ®returnTypeç¡®è®¤è¿”å›ç±»å‹ public MapperMethod(Class? mapperInterface, Method method, Configuration config) this.command = new SqlCommand(config, mapperInterface, method); this.method = new MethodSignature(config, method);public MethodSignature(Configuration configuration, Method method) this.returnType = method.getReturnType(); // åˆ¤æ–­è¿”å›ç±»å‹ this.returnsVoid = void.class.equals(this.returnType); this.returnsMany = (configuration.getObjectFactory().isCollection(this.returnType) || this.returnType.isArray()); this.mapKey = getMapKey(method); this.returnsMap = (this.mapKey != null); this.hasNamedParameters = hasNamedParams(method); //ä»¥ä¸‹é‡å¤å¾ªç¯2éè°ƒç”¨getUniqueParamIndexï¼Œæ˜¯ä¸æ˜¯é™ä½æ•ˆç‡äº† //è®°ä¸‹RowBoundsæ˜¯ç¬¬å‡ ä¸ªå‚æ•° this.rowBoundsIndex = getUniqueParamIndex(method, RowBounds.class); //è®°ä¸‹ResultHandleræ˜¯ç¬¬å‡ ä¸ªå‚æ•° this.resultHandlerIndex = getUniqueParamIndex(method, ResultHandler.class); this.params = Collections.unmodifiableSortedMap(getParams(method, this.hasNamedParameters)); å› ä¸ºè¿”å›å‚æ•°æ˜¯ä¸€ä¸ªListï¼Œä¼šæ‰§è¡ŒexecuteForMany(sqlSession, args)æ–¹æ³• private E Object executeForMany(SqlSession sqlSession, Object[] args) ListE result; Object param = method.convertArgsToSqlCommandParam(args); //ä»£å…¥RowBounds if (method.hasRowBounds()) RowBounds rowBounds = method.extractRowBounds(args); result = sqlSession.EselectList(command.getName(), param, rowBounds); else result = sqlSession.EselectList(command.getName(), param); // issue #510 Collections arrays support if (!method.getReturnType().isAssignableFrom(result.getClass())) if (method.getReturnType().isArray()) return convertToArray(result); else return convertToDeclaredCollection(sqlSession.getConfiguration(), result); return result; PreparedStatementæ‰§è¡ŒæŸ¥è¯¢ è·å–MappedStatementå¯¹è±¡ è§£æmapper.xmlä¸­å°è£…çš„sqlå°è£…åˆ°BoundSqlè§£æåçš„sqlè¯­å¥å­˜å…¥BoundSqlä¸­çš„sqlå­—æ®µ åˆ›å»ºç¼“å­˜key åˆ¤è¯»æ˜¯å¦å¼€å¯ç¼“å­˜ï¼Œå¦‚æœå¼€å¯ç¼“å­˜å…ˆæŸ¥ç¼“å­˜ ä½¿ç”¨PreparedStatementçš„executeæ–¹æ³•æ‰§è¡ŒæŸ¥è¯¢æ“ä½œ private E ListE selectList(String statement, Object parameter, RowBounds rowBounds, ResultHandler handler) try // è·å–MappedStatement // æ¯ä¸ªMappedStatementå¯¹è±¡å¯¹åº”äº†æˆ‘ä»¬è®¾ç½®çš„ä¸€ä¸ªæ•°æ®åº“æ“ä½œèŠ‚ç‚¹ï¼Œå®ƒä¸»è¦å®šä¹‰äº†æ•°æ®åº“æ“ä½œè¯­å¥ã€è¾“å…¥/è¾“å‡ºå‚æ•°ç­‰ä¿¡æ¯ MappedStatement ms = configuration.getMappedStatement(statement); dirty |= ms.isDirtySelect(); return executor.query(ms, wrapCollection(parameter), rowBounds, handler); catch (Exception e) throw ExceptionFactory.wrapException(Error querying database. Cause: + e, e); finally ErrorContext.instance().reset(); @Overridepublic E ListE query(MappedStatement ms, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler) throws SQLException // è·å–sql BoundSql boundSql = ms.getBoundSql(parameterObject); // åˆ›å»ºç¼“å­˜key CacheKey key = createCacheKey(ms, parameterObject, rowBounds, boundSql); return query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);@Overridepublic E ListE query(MappedStatement ms, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql) throws SQLException Cache cache = ms.getCache(); //é»˜è®¤æƒ…å†µä¸‹æ˜¯æ²¡æœ‰å¼€å¯ç¼“å­˜çš„(äºŒçº§ç¼“å­˜).è¦å¼€å¯äºŒçº§ç¼“å­˜,ä½ éœ€è¦åœ¨ä½ çš„ SQL æ˜ å°„æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œ: cache/ //ç®€å•çš„è¯´ï¼Œå°±æ˜¯å…ˆæŸ¥CacheKeyï¼ŒæŸ¥ä¸åˆ°å†å§”æ‰˜ç»™å®é™…çš„æ‰§è¡Œå™¨å»æŸ¥ if (cache != null) flushCacheIfRequired(ms); if (ms.isUseCache() resultHandler == null) ensureNoOutParams(ms, boundSql); @SuppressWarnings(unchecked) ListE list = (ListE) tcm.getObject(cache, key); if (list == null) list = delegate.query(ms, parameterObject, rowBounds, resultHandler, key, boundSql); tcm.putObject(cache, key, list); // issue #578 and #116 return list; return delegate.query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);@Overridepublic E ListE query(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql) throws SQLException ... list = queryFromDatabase(ms, parameter, rowBounds, resultHandler, key, boundSql); ...private E ListE queryFromDatabase(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql) throws SQLException ListE list; //å…ˆå‘ç¼“å­˜ä¸­æ”¾å…¥å ä½ç¬¦ï¼Ÿï¼Ÿï¼Ÿ localCache.putObject(key, EXECUTION_PLACEHOLDER); try list = doQuery(ms, parameter, rowBounds, resultHandler, boundSql); finally //æœ€ååˆ é™¤å ä½ç¬¦ localCache.removeObject(key); //åŠ å…¥ç¼“å­˜ localCache.putObject(key, list); //å¦‚æœæ˜¯å­˜å‚¨è¿‡ç¨‹ï¼ŒOUTå‚æ•°ä¹ŸåŠ å…¥ç¼“å­˜ if (ms.getStatementType() == StatementType.CALLABLE) localOutputParameterCache.putObject(key, parameter); return list;@Overridepublic E ListE doQuery(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, BoundSql boundSql) throws SQLException Statement stmt = null; try Configuration configuration = ms.getConfiguration(); //æ–°å»ºä¸€ä¸ªStatementHandler //è¿™é‡Œçœ‹åˆ°ResultHandlerä¼ å…¥äº† StatementHandler handler = configuration.newStatementHandler(wrapper, ms, parameter, rowBounds, resultHandler, boundSql); //å‡†å¤‡è¯­å¥ stmt = prepareStatement(handler, ms.getStatementLog()); return handler.query(stmt, resultHandler); finally closeStatement(stmt); @Overridepublic E ListE query(Statement statement, ResultHandler resultHandler) throws SQLException PreparedStatement ps = (PreparedStatement) statement; // ps.executeï¼ˆï¼‰çœŸæ­£æ‰§è¡Œäº†SQLè¯­å¥ï¼Œç„¶åæŠŠæ‰§è¡Œç»“æœäº¤ç»™ResultHandlerå¯¹è±¡å¤„ç†ã€‚ // è€ŒPreparedStatementç±»å¹¶ä¸æ˜¯MyBatisä¸­çš„ç±»ï¼Œå› è€Œps.executeï¼ˆï¼‰çš„æ‰§è¡Œä¸å†ç”±MyBatisè´Ÿè´£ï¼Œè€Œæ˜¯ç”±com.mysql.cj.jdbcåŒ…ä¸­çš„ç±»è´Ÿè´£ ps.execute(); return resultSetHandler.handleResultSets(ps); 4. å¤„ç†ç»“æœé›† ä¸»è¦å…³æ³¨è¯¥æ–¹æ³•DefaultResultSetHandler.getRowValue private Object getRowValue(ResultSetWrapper rsw, ResultMap resultMap, String columnPrefix) throws SQLException final ResultLoaderMap lazyLoader = new ResultLoaderMap(); Object rowValue = createResultObject(rsw, resultMap, lazyLoader, columnPrefix); if (rowValue != null !hasTypeHandlerForResultObject(rsw, resultMap.getType())) final MetaObject metaObject = configuration.newMetaObject(rowValue); boolean foundValues = this.useConstructorMappings; if (shouldApplyAutomaticMappings(resultMap, false)) foundValues = applyAutomaticMappings(rsw, resultMap, metaObject, columnPrefix) || foundValues; foundValues = applyPropertyMappings(rsw, resultMap, metaObject, lazyLoader, columnPrefix) || foundValues; foundValues = lazyLoader.size() 0 || foundValues; rowValue = foundValues || configuration.isReturnInstanceForEmptyRow() ? rowValue : null; return rowValue; åˆ›å»ºMapperæ¥å£ä¸­çš„è¿”å›å¯¹è±¡ï¼Œå¾—åˆ°ä¸€ä¸ªç©ºå¯¹è±¡ // åˆ›å»ºç»“æœé›†å¯¹è±¡private Object createResultObject(ResultSetWrapper rsw, ResultMap resultMap, ListClass? constructorArgTypes, ListObject constructorArgs, String columnPrefix) throws SQLException //å¾—åˆ°result type final Class? resultType = resultMap.getType(); final MetaClass metaType = MetaClass.forClass(resultType); final ListResultMapping constructorMappings = resultMap.getConstructorResultMappings(); if (typeHandlerRegistry.hasTypeHandler(resultType)) //åŸºæœ¬å‹ return createPrimitiveResultObject(rsw, resultMap, columnPrefix); else if (!constructorMappings.isEmpty()) //æœ‰å‚æ•°çš„æ„é€ å‡½æ•° return createParameterizedResultObject(rsw, resultType, constructorMappings, constructorArgTypes, constructorArgs, columnPrefix); else if (resultType.isInterface() || metaType.hasDefaultConstructor()) //æ™®é€šbeanç±»å‹ return objectFactory.create(resultType); else if (shouldApplyAutomaticMappings(resultMap, false)) //è‡ªåŠ¨æ˜ å°„ return createByConstructorSignature(rsw, resultType, constructorArgTypes, constructorArgs, columnPrefix); throw new ExecutorException(Do not know how to create an instance of + resultType); applyAutomaticMappingsæ–¹æ³• åœ¨è‡ªåŠ¨å±æ€§æ˜ å°„åŠŸèƒ½å¼€å¯çš„æƒ…å†µä¸‹ï¼Œè¯¥æ–¹æ³•å°†æ•°æ®è®°å½•çš„å€¼èµ‹ç»™è¾“å‡ºç»“æœå¯¹è±¡ å¾ªç¯éå†æ¯ä¸ªå±æ€§ï¼Œç„¶åè°ƒç”¨metaObject.setValueï¼ˆmapping.propertyï¼Œvalueï¼‰è¯­å¥ä¸ºå±æ€§èµ‹å€¼ private boolean applyAutomaticMappings(ResultSetWrapper rsw, ResultMap resultMap, MetaObject metaObject, String columnPrefix) throws SQLException ListUnMappedColumnAutoMapping autoMapping = createAutomaticMappings(rsw, resultMap, metaObject, columnPrefix); boolean foundValues = false; if (!autoMapping.isEmpty()) for (UnMappedColumnAutoMapping mapping : autoMapping) final Object value = mapping.typeHandler.getResult(rsw.getResultSet(), mapping.column); if (value != null) foundValues = true; if (value != null || configuration.isCallSettersOnNulls() !mapping.primitive) // gcode issue #377, call setter on nulls (value is not found) // è®¾ç½®å¯¹è±¡ä¸­æ¯ä¸ªçš„å±æ€§å€¼ metaObject.setValue(mapping.property, value); return foundValues; applyPropertyMappingsæ–¹æ³• è¯¥æ–¹æ³•æŒ‰ç…§ç”¨æˆ·çš„æ˜ å°„è®¾ç½®ï¼Œç»™è¾“å‡ºç»“æœå¯¹è±¡çš„å±æ€§èµ‹å€¼ private boolean applyPropertyMappings(ResultSetWrapper rsw, ResultMap resultMap, MetaObject metaObject, ResultLoaderMap lazyLoader, String columnPrefix) throws SQLException final ListString mappedColumnNames = rsw.getMappedColumnNames(resultMap, columnPrefix); boolean foundValues = false; final ListResultMapping propertyMappings = resultMap.getPropertyResultMappings(); for (ResultMapping propertyMapping : propertyMappings) String column = prependPrefix(propertyMapping.getColumn(), columnPrefix); if (propertyMapping.getNestedResultMapId() != null) // the user added a column attribute to a nested result map, ignore it column = null; if (propertyMapping.isCompositeResult() || column != null mappedColumnNames.contains(column.toUpperCase(Locale.ENGLISH)) || propertyMapping.getResultSet() != null) Object value = getPropertyMappingValue(rsw.getResultSet(), metaObject, propertyMapping, lazyLoader, columnPrefix); // issue #541 make property optional final String property = propertyMapping.getProperty(); if (property == null) continue; if (value == DEFERRED) foundValues = true; continue; if (value != null) foundValues = true; if (value != null || configuration.isCallSettersOnNulls() !metaObject.getSetterType(property).isPrimitive()) // gcode issue #377, call setter on nulls (value is not found) metaObject.setValue(property, value); return foundValues; 5. æ€»ç»“ åœ¨æ•´ä¸ªæ•°æ®åº“æ“ä½œé˜¶æ®µï¼ŒMyBatiså®Œæˆçš„å·¥ä½œå¯ä»¥æ¦‚è¿°ä¸ºä»¥ä¸‹å‡ æ¡ å»ºç«‹è¿æ¥æ•°æ®åº“çš„SqlSession æ ¹æ®mapperæ¥å£ç”Ÿæˆä»£ç†å¯¹è±¡ æ‰§è¡Œmapperæ¥å£ä¸­æ–¹æ³•æ—¶è§¦å‘ä»£ç†å¯¹è±¡invokeæ–¹æ³•æ‰§è¡ŒsqlSessionä¸­æ•°æ®åº“çš„æ“ä½œæ–¹æ³• è§£æmapper.xmlå„ç§sqlæ ‡ç­¾ä¸­çš„è¯­å¥å¾—åˆ°æ ‡å‡†sql å°è¯•ä»ç¼“å­˜ä¸­æŸ¥è¯¢ç»“æœï¼Œæ‰¾åˆ°åˆ™è¿”å›ï¼›æ‰¾ä¸åˆ°ç»§ç»­æŸ¥è¯¢æ•°æ®åº“ æŸ¥è¯¢æ•°æ®æ•°æ®åº“å¾—åˆ°ç»“æœ å¤„ç†æ•°æ®åº“è¿”å›ç»“æœï¼Œå°†è¿”å›ç»“æœæ˜ å°„åˆ°mapperæ¥å£æ–¹æ³•è¿”å›æ•°æ®ç±»å‹","tags":["MyBatis","Java","ORM"],"categories":["Java"]},{"title":"JavaScript Web APIåŸºç¡€","path":"/2023/12/05/2023-12-05-JavaScript-Web-ApisåŸºç¡€/","content":"1. Web APIåŸºæœ¬è®¤çŸ¥1.1 ä½œç”¨å’Œåˆ†ç±» ä½œç”¨ å°±æ˜¯ä½¿ç”¨ JS å»æ“ä½œ html å’Œæµè§ˆå™¨ åˆ†ç±» DOM (æ–‡æ¡£å¯¹è±¡æ¨¡å‹)ã€BOMï¼ˆæµè§ˆå™¨å¯¹è±¡æ¨¡å‹ï¼‰ 1.2 DOM æ¦‚å¿µ DOMï¼ˆDocument Object Modelâ€”â€”æ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰æ˜¯ç”¨æ¥å‘ˆç°ä»¥åŠä¸ä»»æ„ HTML æˆ– XMLæ–‡æ¡£äº¤äº’çš„API ç™½è¯æ–‡ï¼šDOMæ˜¯æµè§ˆå™¨æä¾›çš„ä¸€å¥—ä¸“é—¨ç”¨æ¥ æ“ä½œç½‘é¡µå†…å®¹ çš„åŠŸèƒ½ ä½œç”¨ å¼€å‘ç½‘é¡µå†…å®¹ç‰¹æ•ˆå’Œå®ç°ç”¨æˆ·äº¤äº’ 1.3 DOMæ ‘ æ¦‚å¿µ å°† HTML æ–‡æ¡£ä»¥æ ‘çŠ¶ç»“æ„ç›´è§‚çš„è¡¨ç°å‡ºæ¥ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ–‡æ¡£æ ‘æˆ– DOM æ ‘ æè¿°ç½‘é¡µå†…å®¹å…³ç³»çš„åè¯ ä½œç”¨ æ–‡æ¡£æ ‘ç›´è§‚çš„ä½“ç°äº†æ ‡ç­¾ä¸æ ‡ç­¾ä¹‹é—´çš„å…³ç³» 1.4 DOMå¯¹è±¡ï¼ˆé‡è¦ï¼‰ DOMå¯¹è±¡ æµè§ˆå™¨æ ¹æ®htmlæ ‡ç­¾ç”Ÿæˆçš„ JSå¯¹è±¡ æ‰€æœ‰çš„æ ‡ç­¾å±æ€§éƒ½å¯ä»¥åœ¨è¿™ä¸ªå¯¹è±¡ä¸Šé¢æ‰¾åˆ° ä¿®æ”¹è¿™ä¸ªå¯¹è±¡çš„å±æ€§ä¼šè‡ªåŠ¨æ˜ å°„åˆ°æ ‡ç­¾èº«ä¸Š DOMçš„æ ¸å¿ƒæ€æƒ³ æŠŠç½‘é¡µå†…å®¹å½“åšå¯¹è±¡æ¥å¤„ç† document å¯¹è±¡ æ˜¯ DOM é‡Œæä¾›çš„ä¸€ä¸ªå¯¹è±¡ æ‰€ä»¥å®ƒæä¾›çš„å±æ€§å’Œæ–¹æ³•éƒ½æ˜¯ç”¨æ¥è®¿é—®å’Œæ“ä½œç½‘é¡µå†…å®¹çš„ ç½‘é¡µæ‰€æœ‰å†…å®¹éƒ½åœ¨documenté‡Œé¢ 1.5 è·å–DOMå¯¹è±¡1.5.1 é€‰æ‹©åŒ¹é…çš„ç¬¬ä¸€ä¸ªå…ƒç´  è¯­æ³• document.querySelector(cssé€‰æ‹©å™¨) å‚æ•° åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæœ‰æ•ˆçš„CSSé€‰æ‹©å™¨ å­—ç¬¦ä¸² è¿”å›å€¼ CSSé€‰æ‹©å™¨åŒ¹é…çš„ç¬¬ä¸€ä¸ªå…ƒç´ ,ä¸€ä¸ª HTMLElementå¯¹è±¡ã€‚ å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°ï¼Œåˆ™è¿”å›nullã€‚ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody divæˆ‘æ˜¯ä¸€ä¸ªç›’å­/div divæˆ‘æ˜¯erä¸ªç›’å­/div div class=threeæˆ‘æ˜¯ä¸‰ä¸ªç›’å­/div ul li1/li li2/li li3/li /ul spanå°±1ä¸ª/span script // 1. js è·å– ç¬¬ä¸€ä¸ªå…ƒç´  let div = document.querySelector(div) let div2 = document.querySelector(.three) console.log(div) let li = document.querySelector(ul li:last-child) console.log(li) /script/body/html 1.5.2 é€‰æ‹©åŒ¹é…çš„å¤šä¸ªå…ƒç´  è¯­æ³• document.querySelectorAll(cssé€‰æ‹©å™¨)document.querySelectorAll(ul li) å‚æ•° åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæœ‰æ•ˆçš„CSSé€‰æ‹©å™¨ å­—ç¬¦ä¸² è¿”å›å€¼ CSSé€‰æ‹©å™¨åŒ¹é…çš„NodeListå¯¹è±¡é›†åˆã€‚å¾—åˆ°çš„æ˜¯ä¸€ä¸ªä¼ªæ•°ç»„ï¼š æœ‰é•¿åº¦æœ‰ç´¢å¼•å·çš„æ•°ç»„ ä½†æ˜¯æ²¡æœ‰ pop() push() ç­‰æ•°ç»„æ–¹æ³• æƒ³è¦å¾—åˆ°é‡Œé¢çš„æ¯ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™éœ€è¦éå†ï¼ˆforï¼‰çš„æ–¹å¼è·å¾—ã€‚ æ³¨æ„ å“ªæ€•åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œé€šè¿‡querySelectAll() è·å–è¿‡æ¥çš„ä¹Ÿæ˜¯ä¸€ä¸ªä¼ªæ•°ç»„ï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ªå…ƒç´ è€Œå·² ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody divæˆ‘æ˜¯ä¸€ä¸ªç›’å­/div divæˆ‘æ˜¯erä¸ªç›’å­/div div class=threeæˆ‘æ˜¯ä¸‰ä¸ªç›’å­/div ul li1/li li2/li li3/li /ul spanå°±1ä¸ª/span script // 2. è·å–å¤šä¸ªå…ƒç´  ä¼ªæ•°ç»„ let lis = document.querySelectorAll(ul li) // console.log(lis) [div, div, div] // é€šè¿‡éå†çš„æ–¹å¼ï¼Œè·å¾—é‡Œé¢çš„æ¯ä¸€ä¸ªdomå¯¹è±¡ï¼ˆå…ƒç´ ï¼‰ for (let i = 0; i lis.length; i++) console.log(lis[i]) let span = document.querySelectorAll(span) console.log(span) /script/body/html 1.6 æ“ä½œå…ƒç´ å†…å®¹ DOMå¯¹è±¡éƒ½æ˜¯æ ¹æ®æ ‡ç­¾ç”Ÿæˆçš„,æ‰€ä»¥æ“ä½œæ ‡ç­¾,æœ¬è´¨ä¸Šå°±æ˜¯æ“ä½œDOMå¯¹è±¡ã€‚ å°±æ˜¯æ“ä½œå¯¹è±¡ä½¿ç”¨çš„ç‚¹è¯­æ³•ã€‚ å¦‚æœæƒ³è¦ä¿®æ”¹æ ‡ç­¾å…ƒç´ çš„é‡Œé¢çš„å†…å®¹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‡ ç§æ–¹å¼ å¯¹è±¡.innerText å±æ€§ å¯¹è±¡.innerHTML å±æ€§ å…ƒç´  innerText å±æ€§ ä½œç”¨ å°†æ–‡æœ¬å†…å®¹æ·»åŠ æ›´æ–°åˆ°ä»»æ„æ ‡ç­¾ä½ç½® æ˜¾ç¤ºçº¯æ–‡æœ¬ï¼Œä¸è§£ææ ‡ç­¾ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style div width: 200px; height: 200px; background-color: pink; /style/headbody div ç²‰çº¢è‰²çš„å›å¿† /div script // 1. è·å–æ ‡ç­¾(å…ƒç´ ) let box = document.querySelector(div) // 2. ä¿®æ”¹æ ‡ç­¾ï¼ˆå…ƒç´ ï¼‰å†…å®¹ boxæ˜¯å¯¹è±¡ innerText å±æ€§ // å¯¹è±¡.å±æ€§ = å€¼ ä¸è¯†åˆ«æ ‡ç­¾ box.innerText = æœ‰ç‚¹æ„æ€~ box.innerText = strongæœ‰ç‚¹æ„æ€~/strong /script/body/html å…ƒç´  innerHTML å±æ€§ ä½œç”¨ å°†æ–‡æœ¬å†…å®¹æ·»åŠ æ›´æ–°åˆ°ä»»æ„æ ‡ç­¾ä½ç½® ä¼šè§£ææ ‡ç­¾ï¼Œå¤šæ ‡ç­¾å»ºè®®ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style div width: 200px; height: 200px; background-color: pink; /style/headbody div ç²‰çº¢è‰²çš„å›å¿† /div script // 1. è·å–æ ‡ç­¾(å…ƒç´ ) let box = document.querySelector(div) // 2. innerHTMLè§£ææ ‡ç­¾ box.innerHTML = strongæœ‰ç‚¹æ„æ€~/strong /script/body/html 1.7 æ“ä½œå…ƒç´ å±æ€§1.7.1 æ“ä½œå…ƒç´ å¸¸ç”¨å±æ€§ ä½œç”¨ å¯ä»¥é€šè¿‡ JS è®¾ç½®ä¿®æ”¹æ ‡ç­¾å…ƒç´ å±æ€§ï¼Œæ¯”å¦‚é€šè¿‡ srcæ›´æ¢ å›¾ç‰‡ è¯­æ³• å¯¹è±¡.å±æ€§ = å€¼ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody img src=./images/1.webp alt= script // 1. è·å–å…ƒç´  å›¾ç‰‡ let pic = document.querySelector(img) // 2. ä¿®æ”¹å…ƒç´ å±æ€§ src å¯¹è±¡.å±æ€§ = å€¼ pic.src = ./images/3.webp pic.title = æˆ‘æ˜¯pinkè€å¸ˆ /script/body/html 1.7.2 æ“ä½œå…ƒå…ƒç´ æ ·å¼å±æ€§ ä½œç”¨ å¯ä»¥é€šè¿‡ JS è®¾ç½®ä¿®æ”¹æ ‡ç­¾å…ƒç´ çš„æ ·å¼å±æ€§ æ¯”å¦‚é€šè¿‡ è½®æ’­å›¾å°åœ†ç‚¹è‡ªåŠ¨æ›´æ¢é¢œè‰²æ ·å¼ ç‚¹å‡»æŒ‰é’®å¯ä»¥æ»šåŠ¨å›¾ç‰‡ï¼Œè¿™æ˜¯ç§»åŠ¨çš„å›¾ç‰‡çš„ä½ç½® left ç­‰ç­‰ é€šè¿‡ style å±æ€§æ“ä½œCSS è¯­æ³• å¯¹è±¡.style.æ ·å¼å±æ€§ = å€¼ æ³¨æ„ ä¿®æ”¹æ ·å¼é€šè¿‡styleå±æ€§å¼•å‡º å¦‚æœå±æ€§æœ‰-è¿æ¥ç¬¦ï¼Œéœ€è¦è½¬æ¢ä¸ºå°é©¼å³°å‘½åæ³• èµ‹å€¼çš„æ—¶å€™ï¼Œéœ€è¦çš„æ—¶å€™ä¸è¦å¿˜è®°åŠ csså•ä½ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style div width: 300px; height: 300px; background-color: pink; /style/headbody div /div script // 1. è·å–å…ƒç´  let box = document.querySelector(div) // 2. æ”¹å˜èƒŒæ™¯é¢œè‰² æ ·å¼ style box.style.backgroundColor = hotpink box.style.width = 400px box.style.marginTop = 100px /script/body/html æ“ä½œç±»å(className) æ“ä½œCSS å¦‚æœä¿®æ”¹çš„æ ·å¼æ¯”è¾ƒå¤šï¼Œç›´æ¥é€šè¿‡styleå±æ€§ä¿®æ”¹æ¯”è¾ƒç¹çï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å€ŸåŠ©äºcssç±»åçš„å½¢å¼ã€‚ è¯­æ³• // active æ˜¯ä¸€ä¸ªcssç±»åå…ƒç´ .className = active æ³¨æ„ ç”±äºclassæ˜¯å…³é”®å­—, æ‰€ä»¥ä½¿ç”¨classNameå»ä»£æ›¿ classNameæ˜¯ä½¿ç”¨æ–°å€¼æ¢æ—§å€¼, å¦‚æœéœ€è¦æ·»åŠ ä¸€ä¸ªç±»,éœ€è¦ä¿ç•™ä¹‹å‰çš„ç±»å ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style div width: 200px; height: 200px; background-color: pink; .active width: 300px; height: 300px; background-color: hotpink; margin-left: 100px; /style/headbody div class=one/div script // 1.è·å–å…ƒç´  // let box = document.querySelector(cssé€‰æ‹©å™¨) let box = document.querySelector(div) // 2 è®¾ç½®æ ·å¼div // box.style.width = 300px // box.style.height = 300px // box.style.backgroundColor = hotpink // box.style.marginLeft = 100px box.className = one active /script/body/html é€šè¿‡ classList æ“ä½œç±»æ§åˆ¶CSS ä¸ºäº†è§£å†³ className å®¹æ˜“è¦†ç›–ä»¥å‰çš„ç±»åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡classListæ–¹å¼è¿½åŠ å’Œåˆ é™¤ç±»åã€‚ è¯­æ³• // è¿½åŠ ä¸€ä¸ªç±»å…ƒç´ .classList.add(ç±»å)// åˆ é™¤ä¸€ä¸ªç±»å…ƒç´ .classList.remove(ç±»å)// åˆ‡æ¢ä¸€ä¸ªç±»å…ƒç´ .classList.toggle(ç±»å) ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style div width: 200px; height: 200px; background-color: pink; .active width: 300px; height: 300px; background-color: hotpink; margin-left: 100px; /style/headbody div class=one/div script // 1.è·å–å…ƒç´  // let box = document.querySelector(cssé€‰æ‹©å™¨) let box = document.querySelector(div) // addæ˜¯ä¸ªæ–¹æ³• æ·»åŠ  è¿½åŠ  // box.classList.add(active) // remove() ç§»é™¤ ç±» // box.classList.remove(one) // åˆ‡æ¢ç±» box.classList.toggle(one) /script/body/html 1.7.3 æ“ä½œè¡¨å•å…ƒç´ å±æ€§ ä½œç”¨ è¡¨å•å¾ˆå¤šæƒ…å†µï¼Œä¹Ÿéœ€è¦ä¿®æ”¹å±æ€§ï¼Œæ¯”å¦‚ç‚¹å‡»çœ¼ç›ï¼Œå¯ä»¥çœ‹åˆ°å¯†ç ï¼Œæœ¬è´¨æ˜¯æŠŠè¡¨å•ç±»å‹è½¬æ¢ä¸ºæ–‡æœ¬æ¡† æ­£å¸¸çš„æœ‰å±æ€§æœ‰å–å€¼çš„è·Ÿå…¶ä»–çš„æ ‡ç­¾å±æ€§æ²¡æœ‰ä»»ä½•åŒºåˆ« è·å–: DOMå¯¹è±¡.å±æ€§å è®¾ç½®: DOMå¯¹è±¡.å±æ€§å æ–°å€¼ è¡¨å•å±æ€§ä¸­æ·»åŠ å°±æœ‰æ•ˆæœï¼Œç§»é™¤å°±æ²¡æœ‰æ•ˆæœï¼Œä¸€å¾‹ä½¿ç”¨å¸ƒå°”å€¼è¡¨ç¤º å¦‚æœä¸º true ä»£è¡¨æ·»åŠ äº†è¯¥å±æ€§ å¦‚æœæ˜¯ false ä»£è¡¨ç§»é™¤äº†è¯¥å±æ€§ æ¯”å¦‚ï¼š disabledã€checkedã€selected ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody input type=text value=è¯·è¾“å…¥ button disabledæŒ‰é’®/button input type=checkbox name= id= class=agree script // 1. è·å–å…ƒç´  let input = document.querySelector(input) // 2. å–å€¼æˆ–è€…è®¾ç½®å€¼ å¾—åˆ°inputé‡Œé¢çš„å€¼å¯ä»¥ç”¨ value // console.log(input.value) input.value = å°ç±³æ‰‹æœº input.type = password // 2. å¯ç”¨æŒ‰é’® let btn = document.querySelector(button) // disabled ä¸å¯ç”¨ = false è¿™æ ·å¯ä»¥è®©æŒ‰é’®å¯ç”¨ btn.disabled = false // 3. å‹¾é€‰å¤é€‰æ¡† let checkbox = document.querySelector(.agree) checkbox.checked = false /script/body/html 1.7.4 è‡ªå®šä¹‰å±æ€§ æ ‡å‡†å±æ€§ æ ‡ç­¾å¤©ç”Ÿè‡ªå¸¦çš„å±æ€§ æ¯”å¦‚class id titleç­‰ã€‚å¯ä»¥ç›´æ¥ä½¿ç”¨ç‚¹è¯­æ³•æ“ä½œæ¯”å¦‚ï¼š disabledã€checkedã€selected è‡ªå®šä¹‰å±æ€§ åœ¨html5ä¸­æ¨å‡ºæ¥äº†ä¸“é—¨çš„ data- è‡ªå®šä¹‰å±æ€§ åœ¨æ ‡ç­¾ä¸Šä¸€å¾‹ä»¥ data-å¼€å¤´ åœ¨DOMå¯¹è±¡ä¸Šä¸€å¾‹ä»¥ dataset å¯¹è±¡æ–¹å¼è·å– ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody div data-id=1 data-spm=ä¸çŸ¥é“1/div div data-id=22/div div data-id=33/div div data-id=44/div div data-id=55/div script const one = document.querySelector(div) console.log(one.dataset.id) // 1 console.log(one.dataset.spm) // ä¸çŸ¥é“ /script/body/html 1.8 å®šæ—¶å™¨ ç½‘é¡µä¸­ç»å¸¸ä¼šéœ€è¦ä¸€ç§åŠŸèƒ½ï¼šæ¯éš”ä¸€æ®µæ—¶é—´éœ€è¦è‡ªåŠ¨æ‰§è¡Œä¸€æ®µä»£ç ï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»è§¦å‘ ä¾‹å¦‚ï¼šç½‘é¡µä¸­çš„å€’è®¡æ—¶ï¼Œè¦å®ç°è¿™ç§éœ€æ±‚ï¼Œéœ€è¦å®šæ—¶å™¨å‡½æ•° 1.8.1 é—´æ­‡å‡½æ•° ä½œç”¨ å®šæ—¶å™¨å‡½æ•°å¯ä»¥å¼€å¯å’Œå…³é—­å®šæ—¶å™¨ å¼€å¯å®šæ—¶å™¨ è¯­æ³• setInterval(å‡½æ•°, é—´æ­‡æ—¶é—´)- ä½œç”¨ï¼šæ¯éš”ä¸€æ®µæ—¶é—´è°ƒç”¨è¿™ä¸ªå‡½æ•°- é—´éš”æ—¶é—´å•ä½æ˜¯æ¯«ç§’ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script // 1 setInterval(function () console.log(é«˜è–ªå°±ä¸š) , 1000) // 2 function show() console.log(æœˆè–ªè¿‡2ä¸‡) setInterval(show, 1000) /script/body/html å…³é—­å®šæ—¶å™¨ è¯­æ³• let å˜é‡å = setInterval(å‡½æ•°, é—´æ­‡æ—¶é—´)clearInterval(å˜é‡å) æ³¨æ„ å‡½æ•°åå­—ä¸éœ€è¦åŠ æ‹¬å· å®šæ—¶å™¨è¿”å›çš„æ˜¯ä¸€ä¸ªidæ•°å­— ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script function show() console.log(æœˆè–ªè¿‡2ä¸‡) let timer = setInterval(show, 1000) // æ¸…é™¤å®šæ—¶å™¨ clearInterval(timer) /script/body/html 2. DOMäº‹ä»¶åŸºç¡€2.1 äº‹ä»¶ç›‘å¬ï¼ˆç»‘å®šï¼‰ ä»€ä¹ˆæ˜¯äº‹ä»¶ï¼Ÿ äº‹ä»¶æ˜¯åœ¨ç¼–ç¨‹æ—¶ç³»ç»Ÿå†…å‘ç”Ÿçš„åŠ¨ä½œæˆ–è€…å‘ç”Ÿçš„äº‹æƒ… æ¯”å¦‚ç”¨æˆ·åœ¨ç½‘é¡µä¸Šå•å‡»ä¸€ä¸ªæŒ‰é’® ä»€ä¹ˆæ˜¯äº‹ä»¶ç›‘å¬ï¼Ÿ å°±æ˜¯è®©ç¨‹åºæ£€æµ‹æ˜¯å¦æœ‰äº‹ä»¶äº§ç”Ÿï¼Œä¸€æ—¦æœ‰äº‹ä»¶è§¦å‘ï¼Œå°±ç«‹å³è°ƒç”¨ä¸€ä¸ªå‡½æ•°åšå‡ºå“åº”ï¼Œä¹Ÿç§°ä¸º ç»‘å®šäº‹ä»¶æˆ–è€…æ³¨å†Œäº‹ä»¶ æ¯”å¦‚é¼ æ ‡ç»è¿‡æ˜¾ç¤ºä¸‹æ‹‰èœå•ï¼Œæ¯”å¦‚ç‚¹å‡»å¯ä»¥æ’­æ”¾è½®æ’­å›¾ç­‰ç­‰ è¯­æ³• å…ƒç´ å¯¹è±¡.addEventListener(äº‹ä»¶ç±»å‹, è¦æ‰§è¡Œçš„å‡½æ•°) äº‹ä»¶ç›‘å¬ä¸‰è¦ç´  äº‹ä»¶æºï¼š é‚£ä¸ªdomå…ƒç´ è¢«äº‹ä»¶è§¦å‘äº†ï¼Œè¦è·å–domå…ƒç´  äº‹ä»¶ç±»å‹ï¼š ç”¨ä»€ä¹ˆæ–¹å¼è§¦å‘ï¼Œæ¯”å¦‚é¼ æ ‡å•å‡» clickã€é¼ æ ‡ç»è¿‡ mouseover ç­‰ äº‹ä»¶è°ƒç”¨çš„å‡½æ•°ï¼š è¦åšä»€ä¹ˆäº‹ æ³¨æ„ äº‹ä»¶ç±»å‹è¦åŠ å¼•å· å‡½æ•°æ˜¯ç‚¹å‡»ä¹‹åå†å»æ‰§è¡Œï¼Œæ¯æ¬¡ç‚¹å‡»éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody buttonç‚¹å‡»/button script // éœ€æ±‚ï¼š ç‚¹å‡»äº†æŒ‰é’®ï¼Œå¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡† // 1. äº‹ä»¶æº æŒ‰é’® // 2.äº‹ä»¶ç±»å‹ ç‚¹å‡»é¼ æ ‡ click å­—ç¬¦ä¸² // 3. äº‹ä»¶å¤„ç†ç¨‹åº å¼¹å‡ºå¯¹è¯æ¡† const btn = document.querySelector(button) btn.addEventListener(click, function () alert(ä½ æ—©å‘€~) ) /script/body/html 2.2 äº‹ä»¶ç±»å‹ äº‹ä»¶çš„ç±»å‹ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style div width: 200px; height: 200px; background-color: pink; /style/headbody div/div script const div = document.querySelector(div) // é¼ æ ‡ç»è¿‡ div.addEventListener(mouseenter, function () console.log(`è½»è½»çš„æˆ‘æ¥äº†`) ) // é¼ æ ‡ç¦»å¼€ div.addEventListener(mouseleave, function () console.log(`è½»è½»çš„æˆ‘èµ°äº†`) ) /script/body/html 2.3 äº‹ä»¶å¯¹è±¡ äº‹ä»¶å¯¹è±¡æ˜¯ä»€ä¹ˆ ä¹Ÿæ˜¯ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡é‡Œæœ‰äº‹ä»¶è§¦å‘æ—¶çš„ç›¸å…³ä¿¡æ¯ ä¾‹å¦‚ï¼šé¼ æ ‡ç‚¹å‡»äº‹ä»¶ä¸­ï¼Œäº‹ä»¶å¯¹è±¡å°±å­˜äº†é¼ æ ‡ç‚¹åœ¨å“ªä¸ªä½ç½®ç­‰ä¿¡æ¯ ä½¿ç”¨åœºæ™¯ å¯ä»¥åˆ¤æ–­ç”¨æˆ·æŒ‰ä¸‹å“ªä¸ªé”®ï¼Œæ¯”å¦‚æŒ‰ä¸‹å›è½¦é”®å¯ä»¥å‘å¸ƒæ–°é—» å¯ä»¥åˆ¤æ–­é¼ æ ‡ç‚¹å‡»äº†å“ªä¸ªå…ƒç´ ï¼Œä»è€Œåšç›¸åº”çš„æ“ä½œ è·å–äº‹ä»¶å¯¹è±¡ åœ¨äº‹ä»¶ç»‘å®šçš„å›è°ƒå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯äº‹ä»¶å¯¹è±¡ ä¸€èˆ¬å‘½åä¸ºeventã€evã€e // eä¸ºäº‹ä»¶å¯¹è±¡å…ƒç´ å¯¹è±¡.addEventListener(äº‹ä»¶ç±»å‹, function(e) ) ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody !-- buttonç‚¹å‡»/button -- input type=text script // const btn = document.querySelector(button) // btn.addEventListener(click, function (e) // console.log(e) // ) const input = document.querySelector(input) input.addEventListener(keyup, function (e) // console.log(11) // console.log(e.key) if (e.key === Enter) console.log(æˆ‘æŒ‰ä¸‹äº†å›è½¦é”®) ) /script/body/html äº‹ä»¶å¯¹è±¡å¸¸ç”¨å±æ€§ type è·å–å½“å‰çš„äº‹ä»¶ç±»å‹ clientXclientY è·å–å…‰æ ‡ç›¸å¯¹äºæµè§ˆå™¨å¯è§çª—å£å·¦ä¸Šè§’çš„ä½ç½® offsetXoffsetY è·å–å…‰æ ‡ç›¸å¯¹äºå½“å‰DOMå…ƒç´ å·¦ä¸Šè§’çš„ä½ç½® key ç”¨æˆ·æŒ‰ä¸‹çš„é”®ç›˜é”®çš„å€¼ ç°åœ¨ä¸æå€¡ä½¿ç”¨keyCode 2.4 ç¯å¢ƒå¯¹è±¡ æ¦‚å¿µ æŒ‡çš„æ˜¯å‡½æ•°å†…éƒ¨ç‰¹æ®Šçš„å˜é‡ this ï¼Œå®ƒä»£è¡¨ç€å½“å‰å‡½æ•°è¿è¡Œæ—¶æ‰€å¤„çš„ç¯å¢ƒ ä½œç”¨ å‡½æ•°çš„è°ƒç”¨æ–¹å¼ä¸åŒï¼Œthis æŒ‡ä»£çš„å¯¹è±¡ä¹Ÿä¸åŒ ã€è°è°ƒç”¨ï¼Œ this å°±æ˜¯è°ã€‘ æ˜¯åˆ¤æ–­ this æŒ‡å‘çš„ç²—ç•¥è§„åˆ™ ç›´æ¥è°ƒç”¨å‡½æ•°ï¼Œå…¶å®ç›¸å½“äºæ˜¯ window.å‡½æ•°ï¼Œæ‰€ä»¥ this æŒ‡ä»£ window ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody buttonç‚¹å‡»/button script // æ¯ä¸ªå‡½æ•°é‡Œé¢éƒ½æœ‰this ç¯å¢ƒå¯¹è±¡ æ™®é€šå‡½æ•°é‡Œé¢thisæŒ‡å‘çš„æ˜¯window // function fn() // console.log(this) // // window.fn() const btn = document.querySelector(button) btn.addEventListener(click, function () // console.log(this) // btn å¯¹è±¡ // btn.style.color = red this.style.color = red ) /script/body/html 2.5 å›è°ƒå‡½æ•° æ¦‚å¿µ å¦‚æœå°†å‡½æ•° A åšä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•° B æ—¶ï¼Œæˆ‘ä»¬ç§°å‡½æ•° A ä¸ºå›è°ƒå‡½æ•° ç®€å•ç†è§£ï¼š å½“ä¸€ä¸ªå‡½æ•°å½“åšå‚æ•°æ¥ä¼ é€’ç»™å¦å¤–ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯å›è°ƒå‡½æ•° ç¤ºä¾‹ script function fn() console.log(æˆ‘æ˜¯å›è°ƒå‡½æ•°); setInterval(fn, 1000) btn.addEventListener(click, function () alert(æˆ‘ä¹Ÿæ˜¯å›è°ƒå‡½æ•°~) )/script 3. DOMäº‹ä»¶è¿›é˜¶3.1 äº‹ä»¶æµ æ¦‚å¿µ äº‹ä»¶æµæŒ‡çš„æ˜¯äº‹ä»¶å®Œæ•´æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æµåŠ¨è·¯å¾„ å‡è®¾é¡µé¢é‡Œæœ‰ä¸ªdivï¼Œå½“è§¦å‘äº‹ä»¶æ—¶ï¼Œä¼šç»å†ä¸¤ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯æ•è·é˜¶æ®µã€å†’æ³¡é˜¶æ®µ ç®€å•æ¥è¯´ï¼šæ•è·é˜¶æ®µæ˜¯ ä»çˆ¶åˆ°å­ å†’æ³¡é˜¶æ®µæ˜¯ ä»å­åˆ°çˆ¶ æ³¨æ„ å®é™…å·¥ä½œéƒ½æ˜¯ä½¿ç”¨äº‹ä»¶å†’æ³¡ä¸ºä¸» 3.2 äº‹ä»¶æ•è· æ¦‚å¿µ ä»DOMçš„æ ¹å…ƒç´ å¼€å§‹å»æ‰§è¡Œå¯¹åº”çš„äº‹ä»¶ (ä»å¤–åˆ°é‡Œ) è¯­æ³• DOM.addEventListener(äº‹ä»¶ç±»å‹, äº‹ä»¶å¤„ç†å‡½æ•°, æ˜¯å¦ä½¿ç”¨æ•è·æœºåˆ¶) è¯´æ˜ addEventListenerç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥ true ä»£è¡¨æ˜¯æ•è·é˜¶æ®µè§¦å‘ï¼ˆå¾ˆå°‘ä½¿ç”¨ï¼‰ è‹¥ä¼ å…¥falseä»£è¡¨å†’æ³¡é˜¶æ®µè§¦å‘ï¼Œé»˜è®¤å°±æ˜¯false è‹¥æ˜¯ç”¨ L0 äº‹ä»¶ç›‘å¬ï¼Œåˆ™åªæœ‰å†’æ³¡é˜¶æ®µï¼Œæ²¡æœ‰æ•è· ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style .father width: 500px; height: 500px; background-color: pink; .son width: 200px; height: 200px; background-color: purple; /style/headbody div class=father div class=son/div /div script const fa = document.querySelector(.father) const son = document.querySelector(.son) // å±±ä¸œ æµå— è“ç¿” ç›®æ ‡ï¼ˆpinkè€å¸ˆï¼‰ æ•è·é˜¶æ®µ // è“ç¿” æµå— å±±ä¸œ å†’æ³¡é˜¶æ®µ document.addEventListener(click, function () alert(æˆ‘æ˜¯çˆ·çˆ·) , true) fa.addEventListener(click, function () alert(æˆ‘æ˜¯çˆ¸çˆ¸) , true) son.addEventListener(click, function () alert(æˆ‘æ˜¯å„¿å­) , true) /script/body/html æ•ˆæœ https://font-demo.pages.dev/js/web_api_3/03-%E4%BA%8B%E4%BB%B6%E6%B5%81 3.3 äº‹ä»¶å†’æ³¡ æ¦‚å¿µ å½“ä¸€ä¸ªå…ƒç´ çš„äº‹ä»¶è¢«è§¦å‘æ—¶ï¼ŒåŒæ ·çš„äº‹ä»¶å°†ä¼šåœ¨è¯¥å…ƒç´ çš„æ‰€æœ‰ç¥–å…ˆå…ƒç´ ä¸­ä¾æ¬¡è¢«è§¦å‘ã€‚è¿™ä¸€è¿‡ç¨‹è¢«ç§°ä¸ºäº‹ä»¶å†’æ³¡ ç®€å•ç†è§£ï¼šå½“ä¸€ä¸ªå…ƒç´ è§¦å‘äº‹ä»¶åï¼Œä¼šä¾æ¬¡å‘ä¸Šè°ƒç”¨æ‰€æœ‰çˆ¶çº§å…ƒç´ çš„ åŒåäº‹ä»¶ è¯´æ˜ äº‹ä»¶å†’æ³¡æ˜¯é»˜è®¤å­˜åœ¨çš„ L2äº‹ä»¶ç›‘å¬ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ falseï¼Œæˆ–è€…é»˜è®¤éƒ½æ˜¯å†’æ³¡ 3.4 é˜»æ­¢å†’æ³¡ é—®é¢˜ å› ä¸ºé»˜è®¤å°±æœ‰å†’æ³¡æ¨¡å¼çš„å­˜åœ¨ï¼Œæ‰€ä»¥å®¹æ˜“å¯¼è‡´å­å…ƒç´ äº‹ä»¶å½±å“åˆ°çˆ¶çº§å…ƒç´  éœ€æ±‚ è‹¥æƒ³æŠŠäº‹ä»¶å°±é™åˆ¶åœ¨å½“å‰å…ƒç´ å†…ï¼Œå°±éœ€è¦é˜»æ­¢äº‹ä»¶å†’æ³¡ å‰æ é˜»æ­¢äº‹ä»¶å†’æ³¡éœ€è¦æ‹¿åˆ°äº‹ä»¶å¯¹è±¡ è¯­æ³• äº‹ä»¶å¯¹è±¡.stopPropagation() æ³¨æ„ æ­¤æ–¹æ³•å¯ä»¥é˜»æ–­äº‹ä»¶æµåŠ¨ä¼ æ’­ï¼Œä¸å…‰åœ¨å†’æ³¡é˜¶æ®µæœ‰æ•ˆï¼Œæ•è·é˜¶æ®µä¹Ÿæœ‰æ•ˆ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style .father width: 500px; height: 500px; background-color: pink; .son width: 200px; height: 200px; background-color: purple; /style/headbody div class=father div class=son/div /div script const fa = document.querySelector(.father) const son = document.querySelector(.son) // å±±ä¸œ æµå— è“ç¿” ç›®æ ‡ï¼ˆpinkè€å¸ˆï¼‰ æ•è·é˜¶æ®µ // è“ç¿” æµå— å±±ä¸œ å†’æ³¡é˜¶æ®µ document.addEventListener(click, function () alert(æˆ‘æ˜¯çˆ·çˆ·) ) fa.addEventListener(click, function () alert(æˆ‘æ˜¯çˆ¸çˆ¸) ) son.addEventListener(click, function (e) alert(æˆ‘æ˜¯å„¿å­) // ç»„ç»‡æµåŠ¨ä¼ æ’­ äº‹ä»¶å¯¹è±¡.stopPropagation() e.stopPropagation() ) /script/body/html æ•ˆæœ https://font-demo.pages.dev/js/web_api_3/04-%E4%BA%8B%E4%BB%B6%E5%86%92%E6%B3%A1 3.5 é˜»æ­¢é»˜è®¤è¡Œä¸º ä½œç”¨ æˆ‘ä»¬æŸäº›æƒ…å†µä¸‹éœ€è¦ é˜»æ­¢é»˜è®¤è¡Œä¸ºçš„å‘ç”Ÿï¼Œæ¯”å¦‚ é˜»æ­¢ é“¾æ¥çš„è·³è½¬ï¼Œè¡¨å•åŸŸè·³è½¬ è¯­æ³• e.preventDefault() ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody form action=http://www.itcast.cn input type=submit value=å…è´¹æ³¨å†Œ /form a href=http://www.baidu.comç™¾åº¦ä¸€ä¸‹/a script const form = document.querySelector(form) form.addEventListener(submit, function (e) // é˜»æ­¢é»˜è®¤è¡Œä¸º æäº¤ e.preventDefault() ) const a = document.querySelector(a) a.addEventListener(click, function (e) e.preventDefault() ) /script/body/html 3.6 è§£ç»‘äº‹ä»¶ ä½œç”¨ è§£é™¤å…ƒç´ ç»‘å®šçš„äº‹ä»¶ è¯­æ³• - onæ–¹å¼ç›´æ¥ä½¿ç”¨nullè¦†ç›–å¶å°±å¯ä»¥å®ç°äº‹ä»¶çš„è§£ç»‘btn.onclick = function () alert(ç‚¹å‡»äº†)// L0 äº‹ä»¶ç§»é™¤è§£ç»‘btn.onclick = null- addEventListeneræ–¹å¼removeEventListener(äº‹ä»¶ç±»å‹, äº‹ä»¶å¤„ç†å‡½æ•°, [è·å–æ•è·æˆ–è€…å†’æ³¡é˜¶æ®µ]) æ³¨æ„ åŒ¿åå‡½æ•°æ— æ³•è¢«è§£ç»‘ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody buttonç‚¹å‡»/button script const btn = document.querySelector(button) // btn.onclick = function () // alert(ç‚¹å‡»äº†) // // L0 äº‹ä»¶ç§»é™¤è§£ç»‘ // btn.onclick = null // function fn() alert(ç‚¹å‡»äº†) btn.addEventListener(click, fn) // L2 äº‹ä»¶ç§»é™¤è§£ç»‘ btn.removeEventListener(click, fn) /script/body/html 3.7 é¼ æ ‡ç»è¿‡äº‹ä»¶çš„åŒºåˆ« é¼ æ ‡ç»è¿‡äº‹ä»¶ mouseover å’Œ mouseout ä¼šæœ‰å†’æ³¡æ•ˆæœ mouseenter å’Œ mouseleave æ²¡æœ‰å†’æ³¡æ•ˆæœ (æ¨è) ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style .dad width: 400px; height: 400px; background-color: pink; .baby width: 200px; height: 200px; background-color: purple; /style/headbody div class=dad div class=baby/div /div script const dad = document.querySelector(.dad) const baby = document.querySelector(.baby) dad.addEventListener(mouseenter, function () console.log(é¼ æ ‡ç»è¿‡) ) dad.addEventListener(mouseleave, function () console.log(é¼ æ ‡ç¦»å¼€) ) /script/body/html 3.8 ä¸¤ç§æ³¨å†Œäº‹ä»¶çš„åŒºåˆ« ä¼ ç»Ÿonæ³¨å†Œï¼ˆL0ï¼‰ åŒä¸€ä¸ªå¯¹è±¡,åé¢æ³¨å†Œçš„äº‹ä»¶ä¼šè¦†ç›–å‰é¢æ³¨å†Œ(åŒä¸€ä¸ªäº‹ä»¶) ç›´æ¥ä½¿ç”¨nullè¦†ç›–å°±å¯ä»¥å®ç°äº‹ä»¶çš„è§£ç»‘ éƒ½æ˜¯å†’æ³¡é˜¶æ®µæ‰§è¡Œçš„ äº‹ä»¶ç›‘å¬æ³¨å†Œï¼ˆL2ï¼‰ åé¢æ³¨å†Œçš„äº‹ä»¶ä¸ä¼šè¦†ç›–å‰é¢æ³¨å†Œçš„äº‹ä»¶(åŒä¸€ä¸ªäº‹ä»¶) å¯ä»¥é€šè¿‡ç¬¬ä¸‰ä¸ªå‚æ•°å»ç¡®å®šæ˜¯åœ¨å†’æ³¡æˆ–è€…æ•è·é˜¶æ®µæ‰§è¡Œ å¿…é¡»ä½¿ç”¨removeEventListener(äº‹ä»¶ç±»å‹, äº‹ä»¶å¤„ç†å‡½æ•°, è·å–æ•è·æˆ–è€…å†’æ³¡é˜¶æ®µ) åŒ¿åå‡½æ•°æ— æ³•è¢«è§£ç»‘ 3.9 äº‹ä»¶å§”æ‰˜ å¦‚æœåŒæ—¶ç»™å¤šä¸ªå…ƒç´ æ³¨å†Œäº‹ä»¶ï¼Œæˆ‘ä»¬æ€ä¹ˆåšçš„ï¼Ÿ forå¾ªç¯æ³¨å†Œäº‹ä»¶ é—®é¢˜ æœ‰æ²¡æœ‰ä¸€ç§æŠ€å·§ æ³¨å†Œä¸€æ¬¡äº‹ä»¶å°±èƒ½å®Œæˆä»¥ä¸Šæ•ˆæœå‘¢ï¼Ÿ ä½œç”¨ äº‹ä»¶å§”æ‰˜æ˜¯åˆ©ç”¨äº‹ä»¶æµçš„ç‰¹å¾è§£å†³ä¸€äº›å¼€å‘éœ€æ±‚çš„çŸ¥è¯†æŠ€å·§ ä¼˜ç‚¹ å‡å°‘æ³¨å†Œæ¬¡æ•°ï¼Œå¯ä»¥æé«˜ç¨‹åºæ€§èƒ½ åŸç† äº‹ä»¶å§”æ‰˜å…¶å®æ˜¯åˆ©ç”¨äº‹ä»¶å†’æ³¡çš„ç‰¹ç‚¹ ç»™çˆ¶å…ƒç´ æ³¨å†Œäº‹ä»¶ï¼Œå½“æˆ‘ä»¬è§¦å‘å­å…ƒç´ çš„æ—¶å€™ï¼Œä¼šå†’æ³¡åˆ°çˆ¶å…ƒç´ èº«ä¸Šï¼Œä»è€Œè§¦å‘çˆ¶å…ƒç´ çš„äº‹ä»¶ æ ¸å¿ƒé€»è¾‘ // å¯ä»¥è·å¾—çœŸæ­£è§¦å‘äº‹ä»¶çš„å…ƒç´ äº‹ä»¶å¯¹è±¡.target.tagName ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody ul liç¬¬1ä¸ªå­©å­/li liç¬¬2ä¸ªå­©å­/li liç¬¬3ä¸ªå­©å­/li liç¬¬4ä¸ªå­©å­/li liç¬¬5ä¸ªå­©å­/li pæˆ‘ä¸éœ€è¦å˜è‰²/p /ul script // ç‚¹å‡»æ¯ä¸ªå°li å½“å‰li æ–‡å­—å˜ä¸ºçº¢è‰² // æŒ‰ç…§äº‹ä»¶å§”æ‰˜çš„æ–¹å¼ å§”æ‰˜ç»™çˆ¶çº§ï¼Œäº‹ä»¶å†™åˆ°çˆ¶çº§èº«ä¸Š // 1. è·å¾—çˆ¶å…ƒç´  const ul = document.querySelector(ul) ul.addEventListener(click, function (e) // alert(11) // this.style.color = red // console.dir(e.target) // å°±æ˜¯æˆ‘ä»¬ç‚¹å‡»çš„é‚£ä¸ªå¯¹è±¡ // e.target.style.color = red // æˆ‘çš„éœ€æ±‚ï¼Œæˆ‘ä»¬åªè¦ç‚¹å‡»liæ‰ä¼šæœ‰æ•ˆæœ if (e.target.tagName === LI) e.target.style.color = red ) /script/body/html 3.10 å…¶ä»–äº‹ä»¶3.10.1 é¡µé¢åŠ è½½äº‹ä»¶ ä½œç”¨ åŠ è½½å¤–éƒ¨èµ„æºï¼ˆå¦‚å›¾ç‰‡ã€å¤–è”CSSå’ŒJavaScriptç­‰ï¼‰åŠ è½½å®Œæ¯•æ—¶è§¦å‘çš„äº‹ä»¶ ä¸ºä»€ä¹ˆè¦å­¦ï¼Ÿ æœ‰äº›æ—¶å€™éœ€è¦ç­‰é¡µé¢èµ„æºå…¨éƒ¨å¤„ç†å®Œäº†åšä¸€äº›äº‹æƒ… è€ä»£ç å–œæ¬¢æŠŠ script å†™åœ¨ head ä¸­ï¼Œè¿™æ—¶å€™ç›´æ¥æ‰¾ dom å…ƒç´ æ‰¾ä¸åˆ° äº‹ä»¶åï¼šload ä½œç”¨ ç›‘å¬é¡µé¢æ‰€æœ‰èµ„æºåŠ è½½å®Œæ¯• æ³¨æ„ ä¸å…‰å¯ä»¥ç›‘å¬æ•´ä¸ªé¡µé¢èµ„æºåŠ è½½å®Œæ¯•ï¼Œä¹Ÿå¯ä»¥é’ˆå¯¹æŸä¸ªèµ„æºç»‘å®šloadäº‹ä»¶ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script // ç­‰å¾…é¡µé¢æ‰€æœ‰èµ„æºåŠ è½½å®Œæ¯•ï¼Œå°±å›å»æ‰§è¡Œå›è°ƒå‡½æ•° window.addEventListener(load, function () const btn = document.querySelector(button) btn.addEventListener(click, function () alert(11) ) ) img.addEventListener(load, function () // ç­‰å¾…å›¾ç‰‡åŠ è½½å®Œæ¯•ï¼Œå†å»æ‰§è¡Œé‡Œé¢çš„ä»£ç  ) /script/headbody buttonç‚¹å‡»/button/body/html äº‹ä»¶åï¼šDOMContentLoaded ä½œç”¨ å½“åˆå§‹çš„ HTML æ–‡æ¡£è¢«å®Œå…¨åŠ è½½å’Œè§£æå®Œæˆä¹‹åï¼ŒDOMContentLoaded äº‹ä»¶è¢«è§¦å‘ï¼Œè€Œæ— éœ€ç­‰å¾…æ ·å¼è¡¨ã€å›¾åƒç­‰å®Œå…¨åŠ è½½ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script document.addEventListener(DOMContentLoaded, function () const btn = document.querySelector(button) btn.addEventListener(click, function () alert(11) ) ) /script/headbody buttonç‚¹å‡»/button/body/html 3.10.2 é¡µé¢æ»šåŠ¨äº‹ä»¶ ä½œç”¨ æ»šåŠ¨æ¡åœ¨æ»šåŠ¨çš„æ—¶å€™æŒç»­è§¦å‘çš„äº‹ä»¶ ä¸ºä»€ä¹ˆè¦å­¦ï¼Ÿ å¾ˆå¤šç½‘é¡µéœ€è¦æ£€æµ‹ç”¨æˆ·æŠŠé¡µé¢æ»šåŠ¨åˆ°æŸä¸ªåŒºåŸŸååšä¸€äº›å¤„ç†ï¼Œ æ¯”å¦‚å›ºå®šå¯¼èˆªæ ï¼Œæ¯”å¦‚è¿”å›é¡¶éƒ¨ äº‹ä»¶åï¼šscroll è¯­æ³• ç›‘å¬æ•´ä¸ªé¡µé¢æ»šåŠ¨ window.addEventListener(scroll, function () // æ‰§è¡Œç›¸å…³æ“ä½œ) åœºæ™¯ æˆ‘ä»¬æƒ³è¦é¡µé¢æ»šåŠ¨ä¸€æ®µè·ç¦»ï¼Œæ¯”å¦‚100pxï¼Œå°±è®©æŸäº›å…ƒç´ æ˜¾ç¤ºéšè—ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆçŸ¥é“ï¼Œé¡µé¢æ»šåŠ¨äº†100åƒç´ å‘¢ï¼Ÿ å°±å¯ä»¥ä½¿ç”¨scroll æ¥æ£€æµ‹æ»šåŠ¨çš„è·ç¦»~~~ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style body padding-top: 100px; height: 3000px; div display: none; margin: 100px; overflow: scroll; width: 200px; height: 200px; border: 1px solid #000; /style/headbody div æˆ‘é‡Œé¢æœ‰å¾ˆå¤šå¾ˆå¤šçš„æ–‡å­— æˆ‘é‡Œé¢æœ‰å¾ˆå¤šå¾ˆå¤šçš„æ–‡å­— æˆ‘é‡Œé¢æœ‰å¾ˆå¤šå¾ˆå¤šçš„æ–‡å­— æˆ‘é‡Œé¢æœ‰å¾ˆå¤šå¾ˆå¤šçš„æ–‡å­— æˆ‘é‡Œé¢æœ‰å¾ˆå¤šå¾ˆå¤šçš„æ–‡å­— æˆ‘é‡Œé¢æœ‰å¾ˆå¤šå¾ˆå¤šçš„æ–‡å­— æˆ‘é‡Œé¢æœ‰å¾ˆå¤šå¾ˆå¤šçš„æ–‡å­— æˆ‘é‡Œé¢æœ‰å¾ˆå¤šå¾ˆå¤šçš„æ–‡å­— æˆ‘é‡Œé¢æœ‰å¾ˆå¤šå¾ˆå¤šçš„æ–‡å­— æˆ‘é‡Œé¢æœ‰å¾ˆå¤šå¾ˆå¤šçš„æ–‡å­— æˆ‘é‡Œé¢æœ‰å¾ˆå¤šå¾ˆå¤šçš„æ–‡å­— æˆ‘é‡Œé¢æœ‰å¾ˆå¤šå¾ˆå¤šçš„æ–‡å­— æˆ‘é‡Œé¢æœ‰å¾ˆå¤šå¾ˆå¤šçš„æ–‡å­— æˆ‘é‡Œé¢æœ‰å¾ˆå¤šå¾ˆå¤šçš„æ–‡å­— /div script const div = document.querySelector(div) // é¡µé¢æ»šåŠ¨äº‹ä»¶ window.addEventListener(scroll, function () // console.log(æˆ‘æ»šäº†) // æˆ‘æƒ³çŸ¥é“é¡µé¢åˆ°åº•æ»šåŠ¨äº†å¤šå°‘åƒç´ ï¼Œ è¢«å·å»äº†å¤šå°‘ scrollTop // è·å–htmlå…ƒç´ å†™æ³• // document.documentElement // console.log(document.documentElement.scrollTop) const n = document.documentElement.scrollTop if (n = 100) div.style.display = block else div.style.display = none ) // const div = document.querySelector(div) // div.addEventListener(scroll, function () // // console.log(111) // // scrollTop è¢«å·å»çš„å¤´éƒ¨ // console.log(div.scrollTop) // ) /script/body/html 3.10.3 è·å–æ»šåŠ¨ä½ç½® å±æ€§ scrollLeftå’ŒscrollTop ï¼ˆå±æ€§ï¼‰ è·å–è¢«å·å»çš„å¤§å° è·å–å…ƒç´ å†…å®¹å¾€å·¦ã€å¾€ä¸Šæ»šå‡ºå»çœ‹ä¸åˆ°çš„è·ç¦» è¿™ä¸¤ä¸ªå€¼æ˜¯å¯è¯»å†™çš„ æ³¨æ„ éœ€è¦åœ¨scrolläº‹ä»¶é‡Œé¢è·å–è¢«å·å»çš„è·ç¦» div.addEventListener(scroll, function () console.log(this.scrollTop)) ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style body height: 3000px; /style/headbody script document.documentElement.scrollTop = 800 window.addEventListener(scroll, function () // å¿…é¡»å†™åˆ°é‡Œé¢ const n = document.documentElement.scrollTop // å¾—åˆ°æ˜¯ä»€ä¹ˆæ•°æ® æ•°å­—å‹ ä¸å¸¦å•ä½ // console.log(n) ) /script/body/html 3.10.4 æ»šåŠ¨åˆ°æŒ‡å®šçš„åæ ‡ ä½œç”¨ scrollTo() æ–¹æ³•å¯æŠŠå†…å®¹æ»šåŠ¨åˆ°æŒ‡å®šçš„åæ ‡ è¯­æ³• å…ƒç´ .scrollTo(x, y) ç¤ºä¾‹ // è®©é¡µé¢æ»šåŠ¨åˆ° y è½´ 1000åƒç´ çš„ä½ç½®window.scrollTo(0, 1000) 3.10.5 é¡µé¢å°ºå¯¸äº‹ä»¶ ä½œç”¨ ä¼šåœ¨çª—å£å°ºå¯¸æ”¹å˜çš„æ—¶å€™è§¦å‘äº‹ä»¶ è¯­æ³• resize window.addEventListener(resize, function () // æ‰§è¡Œä»£ç ) ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style div display: inline-block; /* width: 200px; */ height: 200px; background-color: pink; padding: 10px; border: 20px solid red; /style/headbody div123123123123123123123123123123123123123/div script const div = document.querySelector(div) console.log(div.clientWidth) // resize æµè§ˆå™¨çª—å£å¤§å°å‘ç”Ÿå˜åŒ–çš„æ—¶å€™è§¦å‘çš„äº‹ä»¶ window.addEventListener(resize, function () console.log(1) ) /script/body/html 3.10.6 è·å–å…ƒç´ é«˜åº¦è·å–å®½é«˜ ä½œç”¨ è·å–å…ƒç´ çš„å¯è§éƒ¨åˆ†å®½é«˜ï¼ˆä¸åŒ…å«è¾¹æ¡†ï¼Œmarginï¼Œæ»šåŠ¨æ¡ç­‰ï¼‰ clientWidthå’ŒclientHeight 3.10.7 å…ƒç´ å°ºå¯¸ä¸ä½ç½® ä½¿ç”¨åœºæ™¯ å‰é¢æ¡ˆä¾‹æ»šåŠ¨å¤šå°‘è·ç¦»ï¼Œéƒ½æ˜¯æˆ‘ä»¬è‡ªå·±ç®—çš„ï¼Œæœ€å¥½æ˜¯é¡µé¢æ»šåŠ¨åˆ°æŸä¸ªå…ƒç´ ï¼Œå°±å¯ä»¥åšæŸäº›äº‹ ç®€å•è¯´ï¼Œå°±æ˜¯é€šè¿‡jsçš„æ–¹å¼ï¼Œå¾—åˆ°å…ƒç´ åœ¨é¡µé¢ä¸­çš„ä½ç½® è¿™æ ·æˆ‘ä»¬å¯ä»¥åšï¼Œé¡µé¢æ»šåŠ¨åˆ°è¿™ä¸ªä½ç½®ï¼Œå°±å¯ä»¥åšæŸäº›æ“ä½œï¼Œçœå»è®¡ç®—äº† è·å–å®½é«˜ è·å–å…ƒç´ çš„è‡ªèº«å®½é«˜ã€åŒ…å«å…ƒç´ è‡ªèº«è®¾ç½®çš„å®½é«˜ã€paddingã€border offsetWidthå’ŒoffsetHeight è·å–å‡ºæ¥çš„æ˜¯æ•°å€¼,æ–¹ä¾¿è®¡ç®— æ³¨æ„: è·å–çš„æ˜¯å¯è§†å®½é«˜, å¦‚æœç›’å­æ˜¯éšè—çš„,è·å–çš„ç»“æœæ˜¯0 è·å–ä½ç½® è·å–å…ƒç´ è·ç¦»è‡ªå·±å®šä½çˆ¶çº§å…ƒç´ çš„å·¦ã€ä¸Šè·ç¦»ï¼Œå¦‚æœéƒ½æ²¡æœ‰åˆ™ä»¥ æ–‡æ¡£å·¦ä¸Šè§’ ä¸ºå‡† offsetLeftå’ŒoffsetTopæ³¨æ„æ˜¯åªè¯»å±æ€§ æ€»ç»“ å±æ€§ ä½œç”¨ è¯´æ˜ scrollLeftå’ŒscrollTop è¢«å·å»çš„å¤´éƒ¨å’Œå·¦ä¾§ é…åˆé¡µé¢æ»šåŠ¨æ¥ç”¨ï¼Œå¯è¯»å†™ clientWidth å’Œ clientHeight è·å¾—å…ƒç´ å®½åº¦å’Œé«˜åº¦ ä¸åŒ…å«border,marginï¼Œæ»šåŠ¨æ¡ ç”¨äºjsè·å–å…ƒç´ å¤§å°ï¼Œåªè¯»å±æ€§ offsetWidthå’ŒoffsetHeight è·å¾—å…ƒç´ å®½åº¦å’Œé«˜åº¦ åŒ…å«borderã€paddingï¼Œæ»šåŠ¨æ¡ç­‰ï¼Œåªè¯» offsetLeftå’ŒoffsetTop è·å–å…ƒç´ è·ç¦»è‡ªå·±å®šä½çˆ¶ è·å–å…ƒç´ ä½ç½®çš„æ—¶å€™ä½¿ç”¨ï¼Œåªè¯»å±æ€§ 4. DOMèŠ‚ç‚¹ç§»åŠ¨ç«¯æ»‘åŠ¨4.1 æ—¥æœŸå¯¹è±¡4.1.1 å®ä¾‹åŒ– æ¦‚å¿µ åœ¨ä»£ç ä¸­å‘ç°äº† new å…³é”®å­—æ—¶ï¼Œä¸€èˆ¬å°†è¿™ä¸ªæ“ä½œç§°ä¸ºå®ä¾‹åŒ– ç¤ºä¾‹ åˆ›å»ºä¸€ä¸ªæ—¶é—´å¯¹è±¡å¹¶è·å–æ—¶é—´ è·å–å½“å‰æ—¶é—´ const date = new Date()console.log(date); // Thu Sep 14 2023 14:15:58 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) è·å–æŒ‡å®šæ—¶é—´ const date2 = new Date(2023-9-14)console.log(date2); // Thu Sep 14 2023 00:00:00 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) 4.1.2 æ—¥æœŸå¯¹è±¡æ–¹æ³• åœºæ™¯ å› ä¸ºæ—¥æœŸå¯¹è±¡è¿”å›çš„æ•°æ®æˆ‘ä»¬ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œæ‰€ä»¥éœ€è¦è½¬æ¢ä¸ºå®é™…å¼€å‘ä¸­å¸¸ç”¨çš„æ ¼å¼ æ–¹æ³• ä½œç”¨ è¯´æ˜ getFullYear() è·å¾—å¹´ä»½ è·å–å››ä½å¹´ä»½ getMonth() è·å¾—æœˆä»½ å–å€¼ä¸º 0 ~ 11 getDate() è·å–æœˆä»½ä¸­çš„æ¯ä¸€å¤© ä¸åŒæœˆä»½å–å€¼ä¹Ÿä¸ç›¸åŒ getDay() è·å–æ˜ŸæœŸ å–å€¼ä¸º 0 ~ 6 getHours() è·å–å°æ—¶ å–å€¼ä¸º 0 ~ 23 getMinutes() è·å–åˆ†é’Ÿ å–å€¼ä¸º 0 ~ 59 getSeconds() è·å–ç§’ å–å€¼ä¸º 0 ~ 59 ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script // è·å¾—æ—¥æœŸå¯¹è±¡ const date = new Date() // ä½¿ç”¨é‡Œé¢çš„æ–¹æ³• console.log(date.getFullYear()) console.log(date.getMonth() + 1) // æœˆä»½è¦ + 1 console.log(date.getDate()) console.log(date.getDay()) // æ˜ŸæœŸå‡  /script/body/html 4.1.3 æ—¶é—´æˆ³ åœºæ™¯ å¦‚æœè®¡ç®—å€’è®¡æ—¶æ•ˆæœï¼Œå‰é¢æ–¹æ³•æ— æ³•ç›´æ¥è®¡ç®—ï¼Œéœ€è¦å€ŸåŠ©äºæ—¶é—´æˆ³å®Œæˆ æ—¶é—´æˆ³ æ˜¯æŒ‡1970å¹´01æœˆ01æ—¥00æ—¶00åˆ†00ç§’èµ·è‡³ç°åœ¨çš„æ¯«ç§’æ•°ï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„è®¡é‡æ—¶é—´çš„æ–¹å¼ ç®—æ³• å°†æ¥çš„æ—¶é—´æˆ³ - ç°åœ¨çš„æ—¶é—´æˆ³ å‰©ä½™æ—¶é—´æ¯«ç§’æ•° å‰©ä½™æ—¶é—´æ¯«ç§’æ•° è½¬æ¢ä¸º å‰©ä½™æ—¶é—´çš„ å¹´æœˆæ—¥æ—¶åˆ†ç§’ å°±æ˜¯ å€’è®¡æ—¶æ—¶é—´ æ¯”å¦‚ å°†æ¥æ—¶é—´æˆ³ 2000ms - ç°åœ¨æ—¶é—´æˆ³ 1000ms 1000ms 1000ms è½¬æ¢ä¸ºå°±æ˜¯ 0å°æ—¶0åˆ†1ç§’ ä¸‰ç§è·å–æ—¶é—´æˆ³çš„æ–¹å¼ ä½¿ç”¨ getTime() æ–¹æ³• const date = new Date()console.log(date.getTime()); // 1694672721925 ç®€å†™ +new Date() console.log(+new Date()); // 1694672721925 ä½¿ç”¨ Date.now() æ— éœ€å®ä¾‹åŒ– ä½†æ˜¯åªèƒ½å¾—åˆ°å½“å‰çš„æ—¶é—´æˆ³ï¼Œ è€Œå‰é¢ä¸¤ç§å¯ä»¥è¿”å›æŒ‡å®šæ—¶é—´çš„æ—¶é—´æˆ³ console.log(Date.now()) // 1694672721925 ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script // 1. getTime() const date = new Date() console.log(date.getTime()) // 2. +new Date() console.log(+new Date()) // 3. Date.now() console.log(Date.now()); // 2. +new Date() console.log(+new Date()) console.log(-----------------); console.log(+new Date(2022-4-1 18:30:00)) // æˆ‘è¦æ ¹æ®æ—¥æœŸ Day() 0 ~ 6 è¿”å›çš„æ˜¯ æ˜ŸæœŸä¸€ const arr = [æ˜ŸæœŸå¤©, æ˜ŸæœŸä¸€, æ˜ŸæœŸäºŒ, æ˜ŸæœŸä¸‰, æ˜ŸæœŸå››, æ˜ŸæœŸäº”, æ˜ŸæœŸå…­] // const date = new Date() console.log(arr[new Date().getDay()]) /script/body/html 4.2 èŠ‚ç‚¹æ“ä½œ4.2.1 DOMèŠ‚ç‚¹ æ¦‚å¿µ DOMæ ‘é‡Œæ¯ä¸€ä¸ªå†…å®¹éƒ½ç§°ä¹‹ä¸ºèŠ‚ç‚¹ ç±»å‹ å…ƒç´ èŠ‚ç‚¹ æ‰€æœ‰çš„æ ‡ç­¾ æ¯”å¦‚ bodyã€ div html æ˜¯æ ¹èŠ‚ç‚¹ å±æ€§èŠ‚ç‚¹ æ‰€æœ‰çš„å±æ€§ æ¯”å¦‚ href æ–‡æœ¬èŠ‚ç‚¹ æ‰€æœ‰æ–‡æœ¬ å…¶ä»– 4.2.2 æŸ¥æ‰¾èŠ‚ç‚¹DOMèŠ‚ç‚¹ ä½œç”¨ æ ¹æ®èŠ‚ç‚¹å…³ç³»æŸ¥æ‰¾ç›®æ ‡èŠ‚ç‚¹ èŠ‚ç‚¹å…³ç³» çˆ¶èŠ‚ç‚¹ å­èŠ‚ç‚¹ å…„å¼ŸèŠ‚ç‚¹ çˆ¶èŠ‚ç‚¹æŸ¥æ‰¾ parentNode å±æ€§ è¿”å›æœ€è¿‘ä¸€çº§çš„çˆ¶èŠ‚ç‚¹æ‰¾ä¸åˆ°è¿”å›ä¸ºnull å­å…ƒç´ .parentNode ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody div class=yeye div class=dad div class=babyx/div /div /div script const baby = document.querySelector(.baby) console.log(baby) // è¿”å›domå¯¹è±¡ console.log(baby.parentNode) // è¿”å›domå¯¹è±¡ console.log(baby.parentNode.parentNode) // è¿”å›domå¯¹è±¡ /script/body/html å­èŠ‚ç‚¹æŸ¥æ‰¾ childNodes è·å¾—æ‰€æœ‰å­èŠ‚ç‚¹ã€åŒ…æ‹¬æ–‡æœ¬èŠ‚ç‚¹ï¼ˆç©ºæ ¼ã€æ¢è¡Œï¼‰ã€æ³¨é‡ŠèŠ‚ç‚¹ç­‰ children å±æ€§ ï¼ˆé‡ç‚¹ï¼‰ ä»…è·å¾—æ‰€æœ‰å…ƒç´ èŠ‚ç‚¹ è¿”å›çš„è¿˜æ˜¯ä¸€ä¸ªä¼ªæ•°ç»„ çˆ¶å…ƒç´ .children ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody ul li1/li li2/li li3/li li4/li li5/li /ul script // const ul = document.querySelector(ul) // ul console.log(ul.children) // å¾—åˆ°ä¼ªæ•°ç»„ é€‰æ‹©çš„æ˜¯ äº²å„¿å­ /script/body/html å…„å¼Ÿå…³ç³»æŸ¥æ‰¾ ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹ nextElementSiblingå±æ€§ ä¸Šä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹ previousElementSiblingå±æ€§ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody ul li1/li li2/li li3/li li4/li li5/li /ul script const li2 = document.querySelector(ul li:nth-child(2)) console.log(li2.previousElementSibling) // ä¸Šä¸€ä¸ªå…„å¼Ÿ console.log(li2.nextElementSibling) // ä¸‹ä¸€ä¸ªå…„å¼Ÿ /script/body/html 4.2.3 å¢åŠ èŠ‚ç‚¹ åœºæ™¯ å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡µé¢ä¸­å¢åŠ å…ƒç´  æ¯”å¦‚ï¼Œç‚¹å‡»å‘å¸ƒæŒ‰é’®ï¼Œå¯ä»¥æ–°å¢ä¸€æ¡ä¿¡æ¯ åˆ›å»ºèŠ‚ç‚¹ å³åˆ›é€ å‡ºä¸€ä¸ªæ–°çš„ç½‘é¡µå…ƒç´ ï¼Œå†æ·»åŠ åˆ°ç½‘é¡µå†…ï¼Œä¸€èˆ¬å…ˆåˆ›å»ºèŠ‚ç‚¹ï¼Œç„¶åæ’å…¥èŠ‚ç‚¹ åˆ›å»ºå…ƒç´ èŠ‚ç‚¹æ–¹æ³• // åˆ›å»ºä¸€ä¸ªæ–°çš„å…ƒç´ èŠ‚ç‚¹document.createElement(æ ‡ç­¾å) ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody ul liæˆ‘æ˜¯è€å¤§/li /ul script // // 1. åˆ›å»ºèŠ‚ç‚¹ // const div = document.createElement(div) // // console.log(div) // 2. è¿½åŠ èŠ‚ç‚¹ ä½œä¸ºæœ€åä¸€ä¸ªå­å…ƒç´  // document.body.appendChild(div) const ul = document.querySelector(ul) const li = document.createElement(li) li.innerHTML = æˆ‘æ˜¯li // ul.appendChild(li) // ul.children // 3. è¿½åŠ èŠ‚ç‚¹ // insertBefore(æ’å…¥çš„å…ƒç´ , æ”¾åˆ°å“ªä¸ªå…ƒç´ çš„å‰é¢) ul.insertBefore(li, ul.children[0]) /script/body/html è¿½åŠ èŠ‚ç‚¹ æ’å…¥åˆ°çˆ¶å…ƒç´ çš„æœ€åä¸€ä¸ªå­å…ƒç´  // æ’å…¥åˆ°è¿™ä¸ªçˆ¶å…ƒç´ çš„æœ€åçˆ¶å…ƒç´ .appendChild(è¦æ’å…¥çš„å…ƒç´ ) æ’å…¥åˆ°çˆ¶å…ƒç´ ä¸­æŸä¸ªå­å…ƒç´ çš„å‰é¢ // æ’å…¥åˆ°æŸä¸ªå­å…ƒç´ çš„å‰é¢çˆ¶å…ƒç´ .insertBefore(è¦æ’å…¥çš„å…ƒç´ ï¼Œåœ¨å“ªä¸ªå…ƒç´ å‰é¢) å…‹éš†èŠ‚ç‚¹ æ–¹æ³• // å…‹éš†ä¸€ä¸ªå·²æœ‰çš„å…ƒç´ èŠ‚ç‚¹å…ƒç´ .cloneNode(å¸ƒå°”å€¼)cloneNodeä¼šå…‹éš†å‡ºä¸€ä¸ªè·ŸåŸæ ‡ç­¾ä¸€æ ·çš„å…ƒç´ ï¼Œæ‹¬å·å†…ä¼ å…¥å¸ƒå°”å€¼- è‹¥ä¸ºtrueï¼Œåˆ™ä»£è¡¨å…‹éš†æ—¶ä¼šåŒ…å«åä»£èŠ‚ç‚¹ä¸€èµ·å…‹éš†- è‹¥ä¸ºfalseï¼Œåˆ™ä»£è¡¨å…‹éš†æ—¶ä¸åŒ…å«åä»£èŠ‚ç‚¹- é»˜è®¤ä¸ºfalse ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody ul li1/li li2/li li3/li /ul script const ul = document.querySelector(ul) // 1 å…‹éš†èŠ‚ç‚¹ å…ƒç´ .cloneNode(true) // const li1 = ul.children[0].cloneNode(true) // console.log(li1) // 2. è¿½åŠ  ul.appendChild(ul.children[0].cloneNode(true)) /script/body/html 4.2.4 åˆ é™¤èŠ‚ç‚¹ ä½œç”¨ è‹¥ä¸€ä¸ªèŠ‚ç‚¹åœ¨é¡µé¢ä¸­å·²ä¸éœ€è¦æ—¶ï¼Œå¯ä»¥åˆ é™¤å®ƒ è¯­æ³• çˆ¶å…ƒç´ .removeChild(è¦åˆ é™¤çš„å…ƒç´ ) æ³¨æ„ åœ¨ JavaScript åŸç”ŸDOMæ“ä½œä¸­ï¼Œè¦åˆ é™¤å…ƒç´ å¿…é¡»é€šè¿‡çˆ¶å…ƒç´ åˆ é™¤ å¦‚ä¸å­˜åœ¨çˆ¶å­å…³ç³»åˆ™åˆ é™¤ä¸æˆåŠŸ åˆ é™¤èŠ‚ç‚¹å’Œéšè—èŠ‚ç‚¹ï¼ˆdisplay:noneï¼‰ æœ‰åŒºåˆ«çš„ï¼š éšè—èŠ‚ç‚¹è¿˜æ˜¯å­˜åœ¨çš„ï¼Œä½†æ˜¯åˆ é™¤ï¼Œåˆ™ä»htmlä¸­åˆ é™¤èŠ‚ç‚¹ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style .box display: none; /style/headbody div class=box123/div ul liæ²¡ç”¨äº†/li /ul script const ul = document.querySelector(ul) // åˆ é™¤èŠ‚ç‚¹ çˆ¶å…ƒç´ .removeChlid(å­å…ƒç´ ) ul.removeChild(ul.children[0]) /script/body/html 5. BOMæ“ä½œ5.1 Windowå¯¹è±¡5.1.1 BOM æ¦‚å¿µ BOM(Browser Object Model ) æ˜¯æµè§ˆå™¨å¯¹è±¡æ¨¡å‹ windowå¯¹è±¡æ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯JavaScriptä¸­çš„é¡¶çº§å¯¹è±¡ åƒdocumentã€alert()ã€console.log()è¿™äº›éƒ½æ˜¯windowçš„å±æ€§ï¼ŒåŸºæœ¬BOMçš„å±æ€§å’Œæ–¹æ³•éƒ½æ˜¯windowçš„ã€‚ æ‰€æœ‰é€šè¿‡varå®šä¹‰åœ¨å…¨å±€ä½œç”¨åŸŸä¸­çš„å˜é‡ã€å‡½æ•°éƒ½ä¼šå˜æˆwindowå¯¹è±¡çš„å±æ€§å’Œæ–¹æ³• windowå¯¹è±¡ä¸‹çš„å±æ€§å’Œæ–¹æ³•è°ƒç”¨çš„æ—¶å€™å¯ä»¥çœç•¥window ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script // document.querySelector() // window.document.querySelector() console.log(document === window.document) function fn() console.log(11) window.fn() var num = 10 console.log(window.num) /script/body/html 5.1.2 å®šæ—¶å™¨-å»¶æ—¶å‡½æ•° ä½œç”¨ JavaScript å†…ç½®çš„ä¸€ä¸ªç”¨æ¥è®©ä»£ç å»¶è¿Ÿæ‰§è¡Œçš„å‡½æ•°ï¼Œå« setTimeout è¯­æ³• setTimeout(å›è°ƒå‡½æ•°, ç­‰å¾…çš„æ¯«ç§’æ•°) setTimeout ä»…ä»…åªæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥å¯ä»¥ç†è§£ä¸ºå°±æ˜¯æŠŠä¸€æ®µä»£ç å»¶è¿Ÿæ‰§è¡Œ, å¹³æ—¶çœç•¥window æ¸…é™¤å»¶æ—¶å‡½æ•° let timer = setTimeout(å›è°ƒå‡½æ•°, ç­‰å¾…çš„æ¯«ç§’æ•°)clearTimeout(timer) æ³¨æ„ å»¶æ—¶å™¨éœ€è¦ç­‰å¾…,æ‰€ä»¥åé¢çš„ä»£ç å…ˆæ‰§è¡Œ æ¯ä¸€æ¬¡è°ƒç”¨å»¶æ—¶å™¨éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å»¶æ—¶å™¨ å¯¹æ¯” å»¶æ—¶å‡½æ•°ï¼šæ‰§è¡Œä¸€æ¬¡ é—´æ­‡å‡½æ•°ï¼šæ²¡éš”ä¸€æ®µæ—¶é—´å°±æ‰§è¡Œä¸€æ¬¡ï¼Œé™¤éæ‰‹åŠ¨æ¸…é™¤ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style img position: fixed; left: 0; bottom: 0; /style/headbody img src=./images/ad.png alt= script // 1.è·å–å…ƒç´  const img = document.querySelector(img) setTimeout(function () img.style.display = none , 3000) /script/body/html 5.1.3 JSæ‰§è¡Œæœºåˆ¶ æ€è€ƒï¼Ÿ è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ console.log(111);setTimeout(function () console.log(222);, 0)console.log(333); JSæ‰§è¡Œæœºåˆ¶ JavaScript è¯­è¨€çš„ä¸€å¤§ç‰¹ç‚¹å°±æ˜¯å•çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒä¸€ä¸ªæ—¶é—´åªèƒ½åšä¸€ä»¶äº‹ è¿™æ˜¯å› ä¸º Javascript è¿™é—¨è„šæœ¬è¯­è¨€è¯ç”Ÿçš„ä½¿å‘½æ‰€è‡´â€”â€”JavaScript æ˜¯ä¸ºå¤„ç†é¡µé¢ä¸­ç”¨æˆ·çš„äº¤äº’ï¼Œä»¥åŠæ“ä½œDOM è€Œè¯ç”Ÿçš„ã€‚æ¯”å¦‚æˆ‘ä»¬å¯¹æŸä¸ª DOM å…ƒç´ è¿›è¡Œæ·»åŠ å’Œåˆ é™¤æ“ä½œï¼Œä¸èƒ½åŒæ—¶è¿›è¡Œã€‚ åº”è¯¥å…ˆè¿›è¡Œæ·»åŠ ï¼Œä¹‹åå†åˆ é™¤ å•çº¿ç¨‹å°±æ„å‘³ç€ï¼Œæ‰€æœ‰ä»»åŠ¡éœ€è¦æ’é˜Ÿï¼Œå‰ä¸€ä¸ªä»»åŠ¡ç»“æŸï¼Œæ‰ä¼šæ‰§è¡Œåä¸€ä¸ªä»»åŠ¡ã€‚è¿™æ ·æ‰€å¯¼è‡´çš„é—®é¢˜æ˜¯ï¼š å¦‚æœ JS æ‰§è¡Œçš„æ—¶é—´è¿‡é•¿ï¼Œè¿™æ ·å°±ä¼šé€ æˆé¡µé¢çš„æ¸²æŸ“ä¸è¿è´¯ï¼Œå¯¼è‡´é¡µé¢æ¸²æŸ“åŠ è½½é˜»å¡çš„æ„Ÿè§‰ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåˆ©ç”¨å¤šæ ¸ CPU çš„è®¡ç®—èƒ½åŠ›ï¼ŒHTML5 æå‡º Web Worker æ ‡å‡†ï¼Œå…è®¸ JavaScript è„šæœ¬åˆ›å»ºå¤šä¸ªçº¿ç¨‹ã€‚äºæ˜¯ï¼ŒJS ä¸­å‡ºç°äº†åŒæ­¥å’Œå¼‚æ­¥ åŒæ­¥ å‰ä¸€ä¸ªä»»åŠ¡ç»“æŸåå†æ‰§è¡Œåä¸€ä¸ªä»»åŠ¡ï¼Œç¨‹åºçš„æ‰§è¡Œé¡ºåºä¸ä»»åŠ¡çš„æ’åˆ—é¡ºåºæ˜¯ä¸€è‡´çš„ã€åŒæ­¥çš„ã€‚æ¯”å¦‚åšé¥­çš„åŒæ­¥åšæ³•ï¼šæˆ‘ä»¬è¦çƒ§æ°´ç…®é¥­ï¼Œç­‰æ°´å¼€äº†ï¼ˆ10åˆ†é’Ÿä¹‹åï¼‰ï¼Œå†å»åˆ‡èœï¼Œç‚’èœ å¼‚æ­¥ ä½ åœ¨åšä¸€ä»¶äº‹æƒ…æ—¶ï¼Œå› ä¸ºè¿™ä»¶äº‹æƒ…ä¼šèŠ±è´¹å¾ˆé•¿æ—¶é—´ï¼Œåœ¨åšè¿™ä»¶äº‹çš„åŒæ—¶ï¼Œä½ è¿˜å¯ä»¥å»å¤„ç†å…¶ä»–äº‹æƒ…ã€‚æ¯”å¦‚åšé¥­çš„å¼‚æ­¥åšæ³•ï¼Œæˆ‘ä»¬åœ¨çƒ§æ°´çš„åŒæ—¶ï¼Œåˆ©ç”¨è¿™10åˆ†é’Ÿï¼Œå»åˆ‡èœï¼Œç‚’èœ ä»–ä»¬çš„æœ¬è´¨åŒºåˆ«ï¼š è¿™æ¡æµæ°´çº¿ä¸Šå„ä¸ªæµç¨‹çš„æ‰§è¡Œé¡ºåºä¸åŒ åŒæ­¥ä»»åŠ¡ åŒæ­¥ä»»åŠ¡éƒ½åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œå½¢æˆä¸€ä¸ªæ‰§è¡Œæ ˆ å¼‚æ­¥ä»»åŠ¡ JS çš„å¼‚æ­¥æ˜¯é€šè¿‡å›è°ƒå‡½æ•°å®ç°çš„ ä¸€èˆ¬è€Œè¨€ï¼Œå¼‚æ­¥ä»»åŠ¡æœ‰ä»¥ä¸‹ä¸‰ç§ç±»å‹: æ™®é€šäº‹ä»¶ï¼Œå¦‚ clickã€resize ç­‰ èµ„æºåŠ è½½ï¼Œå¦‚ loadã€error ç­‰ å®šæ—¶å™¨ï¼ŒåŒ…æ‹¬ setIntervalã€setTimeout ç­‰ å¼‚æ­¥ä»»åŠ¡ç›¸å…³æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼ˆä»»åŠ¡é˜Ÿåˆ—ä¹Ÿç§°ä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ æ‰§è¡Œé¡ºåº å…ˆæ‰§è¡Œæ‰§è¡Œæ ˆä¸­çš„åŒæ­¥ä»»åŠ¡ å¼‚æ­¥ä»»åŠ¡æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ ä¸€æ—¦æ‰§è¡Œæ ˆä¸­çš„æ‰€æœ‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œç³»ç»Ÿå°±ä¼šæŒ‰æ¬¡åºè¯»å–ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„å¼‚æ­¥ä»»åŠ¡ï¼Œäºæ˜¯è¢«è¯»å–çš„å¼‚æ­¥ä»»åŠ¡ç»“æŸç­‰å¾…çŠ¶æ€ï¼Œè¿›å…¥æ‰§è¡Œæ ˆï¼Œå¼€å§‹æ‰§è¡Œ ç”±äºä¸»çº¿ç¨‹ä¸æ–­çš„é‡å¤è·å¾—ä»»åŠ¡ã€æ‰§è¡Œä»»åŠ¡ã€å†è·å–ä»»åŠ¡ã€å†æ‰§è¡Œï¼Œæ‰€ä»¥è¿™ç§æœºåˆ¶è¢«ç§°ä¸ºäº‹ä»¶å¾ªç¯ï¼ˆ event loopï¼‰ 5.1.4 locationå¯¹è±¡ ä½œç”¨ location çš„æ•°æ®ç±»å‹æ˜¯å¯¹è±¡ï¼Œå®ƒæ‹†åˆ†å¹¶ä¿å­˜äº† URL åœ°å€çš„å„ä¸ªç»„æˆéƒ¨åˆ† å¸¸ç”¨å±æ€§å’Œæ–¹æ³• href å±æ€§è·å–å®Œæ•´çš„ URL åœ°å€ï¼Œå¯¹å…¶èµ‹å€¼æ—¶ç”¨äºåœ°å€çš„è·³è½¬ searchå±æ€§è·å–åœ°å€ä¸­æºå¸¦çš„å‚æ•°ï¼Œç¬¦å· ï¼Ÿåé¢éƒ¨åˆ† hash å±æ€§è·å–åœ°å€ä¸­çš„å•¥å¸Œå€¼ï¼Œç¬¦å· # åé¢éƒ¨åˆ† reloadæ–¹æ³•ç”¨æ¥åˆ·æ–°å½“å‰é¡µé¢ï¼Œä¼ å…¥å‚æ•° true æ—¶è¡¨ç¤ºå¼ºåˆ¶åˆ·æ–° ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody form action= input type=text name=username input type=password name=pwd buttonæäº¤/button /form a href=#/myæˆ‘çš„/a a href=#/friendå…³æ³¨/a a href=#/downloadä¸‹è½½/a button class=reloadåˆ·æ–°/button script // console.log(window.location) // console.log(location) // console.log(location.href) // 1. href ç»å¸¸ç”¨href åˆ©ç”¨jsçš„æ–¹æ³•å»è·³è½¬é¡µé¢ // location.href = http://www.baidu.com const reload = document.querySelector(.reload) reload.addEventListener(click, function () // f5 åˆ·æ–°é¡µé¢ // location.reload() // å¼ºåˆ¶åˆ·æ–° ctrl+f5 location.reload(true) ) /script/body/html 5.1.5 navigatorå¯¹è±¡ ä½œç”¨ navigatorçš„æ•°æ®ç±»å‹æ˜¯å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸‹è®°å½•äº†æµè§ˆå™¨è‡ªèº«çš„ç›¸å…³ä¿¡æ¯ å¸¸ç”¨å±æ€§å’Œæ–¹æ³• é€šè¿‡ userAgent æ£€æµ‹æµè§ˆå™¨çš„ç‰ˆæœ¬åŠå¹³å° // æ£€æµ‹ userAgentï¼ˆæµè§ˆå™¨ä¿¡æ¯ï¼‰!(function () const userAgent = navigator.userAgent// éªŒè¯æ˜¯å¦ä¸ºAndroidæˆ–iPhoneconst android = userAgent.match(/(Android);?[\\s\\/]+([\\d.]+)?/)const iphone = userAgent.match(/(iPhone\\sOS)\\s([\\d_]+)/)// å¦‚æœæ˜¯Androidæˆ–iPhoneï¼Œåˆ™è·³è½¬è‡³ç§»åŠ¨ç«™ç‚¹if (android || iphone) location.href = http://m.itcast.cn )() 5.1.6 histroyå¯¹è±¡ ä½œç”¨ history çš„æ•°æ®ç±»å‹æ˜¯å¯¹è±¡ï¼Œä¸»è¦ç®¡ç†å†å²è®°å½•ï¼Œ è¯¥å¯¹è±¡ä¸æµè§ˆå™¨åœ°å€æ çš„æ“ä½œç›¸å¯¹åº”ï¼Œå¦‚å‰è¿›ã€åé€€ã€å†å²è®°å½•ç­‰ å¸¸ç”¨å±æ€§å’Œæ–¹æ³• æ–¹æ³• ä½œç”¨ back() åé€€åŠŸèƒ½ forward() å‰è¿›åŠŸèƒ½ go(å‚æ•°) å‰è¿›åé€€åŠŸèƒ½ å‚æ•°å¦‚æœæ˜¯ 1 å‰è¿›1ä¸ªé¡µé¢ å¦‚æœæ˜¯-1 åé€€1ä¸ªé¡µé¢ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody buttonåé€€/button buttonå‰è¿›/button script const back = document.querySelector(button:first-child) const forward = back.nextElementSibling back.addEventListener(click, function () // åé€€ä¸€æ­¥ // history.back() history.go(-1) ) forward.addEventListener(click, function () // å‰è¿›ä¸€æ­¥ // history.forward() history.go(1) ) /script/body/html 5.2 æœ¬åœ°å­˜å‚¨5.2.1 æœ¬åœ°å­˜å‚¨ä»‹ç» ä»¥å‰æˆ‘ä»¬é¡µé¢å†™çš„æ•°æ®ä¸€åˆ·æ–°é¡µé¢å°±æ²¡æœ‰äº†ï¼Œæ˜¯ä¸æ˜¯ï¼Ÿ éšç€äº’è”ç½‘çš„å¿«é€Ÿå‘å±•ï¼ŒåŸºäºç½‘é¡µçš„åº”ç”¨è¶Šæ¥è¶Šæ™®éï¼ŒåŒæ—¶ä¹Ÿå˜çš„è¶Šæ¥è¶Šå¤æ‚ï¼Œä¸ºäº†æ»¡è¶³å„ç§å„æ ·çš„éœ€æ±‚ï¼Œä¼šç»å¸¸æ€§åœ¨æœ¬åœ°å­˜å‚¨å¤§é‡çš„æ•°æ®ï¼ŒHTML5è§„èŒƒæå‡ºäº†ç›¸å…³è§£å†³æ–¹æ¡ˆ æ•°æ®å­˜å‚¨åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­ è®¾ç½®ã€è¯»å–æ–¹ä¾¿ã€ç”šè‡³é¡µé¢åˆ·æ–°ä¸ä¸¢å¤±æ•°æ® å®¹é‡è¾ƒå¤§ï¼ŒsessionStorageå’ŒlocalStorageçº¦ 5M å·¦å³ å¸¸è§çš„ä½¿ç”¨åœºæ™¯ï¼š https://todomvc.com/examples/vanilla-es6/ é¡µé¢åˆ·æ–°æ•°æ®ä¸ä¸¢å¤± 5.2.2 æœ¬åœ°å­˜å‚¨åˆ†ç±» localStorage èƒ½å¤Ÿä½¿ç”¨localStorage æŠŠæ•°æ®å­˜å‚¨çš„æµè§ˆå™¨ä¸­ ä½œç”¨ å¯ä»¥å°†æ•°æ®æ°¸ä¹…å­˜å‚¨åœ¨æœ¬åœ°(ç”¨æˆ·çš„ç”µè„‘), é™¤éæ‰‹åŠ¨åˆ é™¤ï¼Œå¦åˆ™å…³é—­é¡µé¢ä¹Ÿä¼šå­˜åœ¨ ç‰¹æ€§ å¯ä»¥å¤šçª—å£ï¼ˆé¡µé¢ï¼‰å…±äº«ï¼ˆåŒä¸€æµè§ˆå™¨å¯ä»¥å…±äº«ï¼‰ ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨ä½¿ç”¨ è¯­æ³• // å­˜å‚¨æ•°æ®localStorage.setItem(key, value)// è·å–æ•°æ®localStorage.getItem(key)// åˆ é™¤æ•°æ®localStorage.removeItem(key) æµè§ˆå™¨æŸ¥çœ‹æœ¬åœ°æ•°æ® sessionStorage ç‰¹æ€§ ç”Ÿå‘½å‘¨æœŸä¸ºå…³é—­æµè§ˆå™¨çª—å£ åœ¨åŒä¸€ä¸ªçª—å£(é¡µé¢)ä¸‹æ•°æ®å¯ä»¥å…±äº« ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨ä½¿ç”¨ ç”¨æ³•è·ŸlocalStorage åŸºæœ¬ç›¸åŒ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script // 1. è¦å­˜å‚¨ä¸€ä¸ªåå­— unameï¼Œ pinkè€å¸ˆ // localStorage.setItem(é”®ï¼Œå€¼) localStorage.setItem(uname, pinkè€å¸ˆ) // 2. è·å–æ–¹å¼ éƒ½åŠ å¼•å· console.log(localStorage.getItem(uname)) // 3. åˆ é™¤æœ¬åœ°å­˜å‚¨ åªåˆ é™¤åå­— // localStorage.removeItem(uname) // 4. æ”¹ å¦‚æœåŸæ¥æœ‰è¿™ä¸ªé”®ï¼Œåˆ™æ˜¯æ”¹ï¼Œå¦‚æœä¹ˆæœ‰è¿™ä¸ªé”®æ˜¯å¢ localStorage.setItem(uname, redè€å¸ˆ) // æˆ‘è¦å­˜ä¸€ä¸ªå¹´é¾„ // 2. æœ¬åœ°å­˜å‚¨åªèƒ½å­˜å‚¨å­—ç¬¦ä¸²æ•°æ®ç±»å‹ localStorage.setItem(age, 18) console.log(localStorage.getItem(age)) /script/body/html 5.2.3 å­˜å‚¨å¤æ‚æ•°æ®ç±»å‹ é—®é¢˜1 æœ¬åœ°åªèƒ½å­˜å‚¨å­—ç¬¦ä¸²,æ— æ³•å­˜å‚¨å¤æ‚æ•°æ®ç±»å‹ è§£å†³ éœ€è¦å°†å¤æ‚æ•°æ®ç±»å‹è½¬æ¢æˆJSONå­—ç¬¦ä¸²,åœ¨å­˜å‚¨åˆ°æœ¬åœ° è¯­æ³• JSON.stringify(å¤æ‚æ•°æ®ç±»å‹) é—®é¢˜2 å› ä¸ºæœ¬åœ°å­˜å‚¨é‡Œé¢å–å‡ºæ¥çš„æ˜¯å­—ç¬¦ä¸²ï¼Œä¸æ˜¯å¯¹è±¡ï¼Œæ— æ³•ç›´æ¥ä½¿ç”¨ è§£å†³ æŠŠå–å‡ºæ¥çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯¹è±¡ è¯­æ³• JSON.parse(JSONå­—ç¬¦ä¸²) å°†JSONå­—ç¬¦ä¸²è½¬æ¢æˆå¯¹è±¡ å–å‡º æ—¶å€™ä½¿ç”¨ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script const obj = uname: pinkè€å¸ˆ, age: 18, gender: å¥³ // // å­˜å‚¨ å¤æ‚æ•°æ®ç±»å‹ æ— æ³•ç›´æ¥ä½¿ç”¨ // localStorage.setItem(obj, obj) [object object] // // å– // console.log(localStorage.getItem(obj)) // 1.å¤æ‚æ•°æ®ç±»å‹å­˜å‚¨å¿…é¡»è½¬æ¢ä¸º JSONå­—ç¬¦ä¸²å­˜å‚¨ localStorage.setItem(obj, JSON.stringify(obj)) // JSON å¯¹è±¡ å±æ€§å’Œå€¼æœ‰å¼•å·ï¼Œè€Œæ˜¯å¼•å·ç»Ÿä¸€æ˜¯åŒå¼•å· // uname:pinkè€å¸ˆ,age:18,gender:å¥³ // å– // console.log(typeof localStorage.getItem(obj)) // 2. æŠŠJSONå­—ç¬¦ä¸²è½¬æ¢ä¸º å¯¹è±¡ const str = localStorage.getItem(obj) // uname:pinkè€å¸ˆ,age:18,gender:å¥³ console.log(JSON.parse(str)) /script/body/html 6. æ­£åˆ™è¡¨è¾¾å¼6.1 ä»‹ç» æ­£åˆ™è¡¨è¾¾å¼ï¼ˆRegular Expressionï¼‰æ˜¯ç”¨äºåŒ¹é…å­—ç¬¦ä¸²ä¸­å­—ç¬¦ç»„åˆçš„æ¨¡å¼ã€‚åœ¨ JavaScriptä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä¹Ÿæ˜¯å¯¹è±¡ é€šå¸¸ç”¨æ¥æŸ¥æ‰¾ã€æ›¿æ¢é‚£äº›ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„æ–‡æœ¬ è¯·åœ¨ä¸‹å›¾ä¸­æ‰¾å‡ºã€æˆ´å¸½å­å’Œçœ¼é•œçš„ç”·äººã€‘ æˆ´å¸½å­ã€æˆ´çœ¼é•œã€ç”·äººéƒ½æ˜¯æè¿°ä¿¡æ¯ï¼Œé€šè¿‡è¿™äº›ä¿¡æ¯èƒ½å¤Ÿåœ¨äººç¾¤ä¸­æŸ¥æ‰¾åˆ°ç¡®å®šçš„æŸä¸ªäººï¼Œé‚£ä¹ˆè¿™äº›ç”¨äºæŸ¥æ‰¾çš„æè¿°ä¿¡æ¯ç¼–å†™ä¸€ä¸ªæ¨¡å¼ï¼Œå¯¹åº”åˆ°è®¡ç®—æœºä¸­å°±æ˜¯æ‰€è°“çš„æ­£åˆ™è¡¨è¾¾å¼ æ­£åˆ™è¡¨è¾¾å¼åœ¨ JavaScriptä¸­çš„ä½¿ç”¨åœºæ™¯ ä¾‹å¦‚éªŒè¯è¡¨å•ï¼šç”¨æˆ·åè¡¨å•åªèƒ½è¾“å…¥è‹±æ–‡å­—æ¯ã€æ•°å­—æˆ–è€…ä¸‹åˆ’çº¿ï¼Œ æ˜µç§°è¾“å…¥æ¡†ä¸­å¯ä»¥è¾“å…¥ä¸­æ–‡(åŒ¹é…) æ¯”å¦‚ç”¨æˆ·å: ^[a-z0-9_-]{3,16}$ è¿‡æ»¤æ‰é¡µé¢å†…å®¹ä¸­çš„ä¸€äº›æ•æ„Ÿè¯(æ›¿æ¢)ï¼Œæˆ–ä»å­—ç¬¦ä¸²ä¸­è·å–æˆ‘ä»¬æƒ³è¦çš„ç‰¹å®šéƒ¨åˆ†(æå–)ç­‰ 6.2 è¯­æ³• æˆ‘ä»¬æƒ³è¦æŸ¥æ‰¾æ˜¯å¦æœ‰æˆ´çœ¼é•œçš„äºº, æ€ä¹ˆåšå‘¢ï¼Ÿ å®šä¹‰è§„åˆ™ï¼š æˆ´çœ¼é•œçš„ æ ¹æ®è§„åˆ™å»æŸ¥æ‰¾ï¼šæ‰¾åˆ°åˆ™è¿”å› æ­£åˆ™åŒæ ·é“ç†ï¼Œæˆ‘ä»¬åˆ†ä¸ºä¸¤æ­¥ å®šä¹‰è§„åˆ™ æŸ¥æ‰¾ è¯­æ³• å®šä¹‰æ­£åˆ™è¡¨è¾¾å¼è¯­æ³• const å˜é‡å = /è¡¨è¾¾å¼/å…¶ä¸­ / / æ˜¯æ­£åˆ™è¡¨è¾¾å¼å­—é¢é‡æ¯”å¦‚ï¼šconst reg = /å‰ç«¯/ åˆ¤æ–­æ˜¯å¦æœ‰ç¬¦åˆè§„åˆ™çš„å­—ç¬¦ä¸² test()æ–¹æ³• ç”¨æ¥æŸ¥çœ‹æ­£åˆ™è¡¨è¾¾å¼ä¸æŒ‡å®šçš„å­—ç¬¦ä¸²æ˜¯å¦åŒ¹é… regObj.test(è¢«æ£€æµ‹çš„å­—ç¬¦ä¸²)// è¦æ£€æµ‹çš„å­—ç¬¦ä¸²const str = ITåŸ¹è®­,å‰ç«¯é‚£å¼€å‘åŸ¹è®­,webå‰ç«¯,è½¯ä»¶æµ‹è¯•// å®šä¹‰æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ£€æµ‹è§„åˆ™const reg = /å‰ç«¯/reg.test(str) //true æ£€ç´¢ï¼ˆæŸ¥æ‰¾ï¼‰ç¬¦åˆè§„åˆ™çš„å­—ç¬¦ä¸² exec() æ–¹æ³• åœ¨ä¸€ä¸ªæŒ‡å®šå­—ç¬¦ä¸²ä¸­æ‰§è¡Œä¸€ä¸ªæœç´¢åŒ¹é… regObj.exec(è¢«æ£€æµ‹çš„å­—ç¬¦ä¸²)// è¦æ£€æµ‹çš„å­—ç¬¦ä¸²const str = ITåŸ¹è®­,å‰ç«¯é‚£å¼€å‘åŸ¹è®­,webå‰ç«¯,è½¯ä»¶æµ‹è¯•// å®šä¹‰æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ£€æµ‹è§„åˆ™const reg = /å‰ç«¯/reg.exec(str) //è¿”å›æ•°ç»„ å¦‚æœåŒ¹é…æˆåŠŸï¼Œexec() æ–¹æ³•è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå¦åˆ™è¿”å›null æ›¿æ¢å­—ç¬¦ä¸² replace ()æ–¹æ³• å­—ç¬¦ä¸².replace(/æ­£åˆ™è¡¨è¾¾å¼/, æ›¿æ¢æ–‡æœ¬) ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script const str = æˆ‘ä»¬åœ¨å­¦ä¹ å‰ç«¯ï¼Œå¸Œæœ›å­¦ä¹ å‰ç«¯èƒ½é«˜è–ªæ¯•ä¸š // æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨ï¼š // 1. å®šä¹‰è§„åˆ™ const reg = /å‰ç«¯/ // 2. æ˜¯å¦åŒ¹é… // console.log(reg.test(str)) // true // 3. exec() console.log(reg.exec(str)) // è¿”å›æ•°ç»„ /script/body/html 6.3 å…ƒå­—ç¬¦ æ™®é€šå­—ç¬¦ å¤§å¤šæ•°çš„å­—ç¬¦ä»…èƒ½å¤Ÿæè¿°å®ƒä»¬æœ¬èº«ï¼Œè¿™äº›å­—ç¬¦ç§°ä½œæ™®é€šå­—ç¬¦ï¼Œä¾‹å¦‚æ‰€æœ‰çš„å­—æ¯å’Œæ•°å­— ä¹Ÿå°±æ˜¯è¯´æ™®é€šå­—ç¬¦åªèƒ½å¤ŸåŒ¹é…å­—ç¬¦ä¸²ä¸­ä¸å®ƒä»¬ç›¸åŒçš„å­—ç¬¦ å…ƒå­—ç¬¦(ç‰¹æ®Šå­—ç¬¦ï¼‰ æ˜¯ä¸€äº›å…·æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦ï¼Œå¯ä»¥æå¤§æé«˜äº†çµæ´»æ€§å’Œå¼ºå¤§çš„åŒ¹é…åŠŸèƒ½ã€‚ æ¯”å¦‚ï¼Œè§„å®šç”¨æˆ·åªèƒ½è¾“å…¥è‹±æ–‡26ä¸ªè‹±æ–‡å­—æ¯ï¼Œæ™®é€šå­—ç¬¦çš„è¯ abcdefghijklmâ€¦.. ä½†æ˜¯æ¢æˆå…ƒå­—ç¬¦å†™æ³•ï¼š [a-z] ä¸ºäº†æ–¹ä¾¿è®°å¿†å’Œå­¦ä¹ ï¼Œæˆ‘ä»¬å¯¹ä¼—å¤šçš„å…ƒå­—ç¬¦è¿›è¡Œäº†åˆ†ç±» è¾¹ç•Œç¬¦ï¼ˆè¡¨ç¤ºä½ç½®ï¼Œå¼€å¤´å’Œç»“å°¾ï¼Œå¿…é¡»ç”¨ä»€ä¹ˆå¼€å¤´ï¼Œç”¨ä»€ä¹ˆç»“å°¾ï¼‰ é‡è¯ ï¼ˆè¡¨ç¤ºé‡å¤æ¬¡æ•°ï¼‰ å­—ç¬¦ç±» ï¼ˆæ¯”å¦‚ \\d è¡¨ç¤º 0~9ï¼‰ è¾¹ç•Œç¬¦ æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„è¾¹ç•Œç¬¦ï¼ˆä½ç½®ç¬¦ï¼‰ç”¨æ¥æç¤ºå­—ç¬¦æ‰€å¤„çš„ä½ç½®ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªå­—ç¬¦ è¾¹ç•Œç¬¦ è¯´æ˜ ^ è¡¨ç¤ºåŒ¹é…è¡Œé¦–çš„æ–‡æœ¬ï¼ˆä»¥è°å¼€å§‹ï¼‰ $ è¡¨ç¤ºåŒ¹é…è¡Œå°¾çš„æ–‡æœ¬ï¼ˆä»¥è°ç»“æŸï¼‰ å¦‚æœ ^ å’Œ $ åœ¨ä¸€èµ·ï¼Œè¡¨ç¤ºå¿…é¡»æ˜¯ç²¾ç¡®åŒ¹é… ç¤ºä¾‹ // 1. è¾¹ç•Œç¬¦console.log(/^å“ˆ/.test(å“ˆ)) // trueconsole.log(/^å“ˆ/.test(å“ˆå“ˆ)) // trueconsole.log(/^å“ˆ/.test(äºŒå“ˆ)) // flaseconsole.log(/^å“ˆ$/.test(å“ˆ)) // true åªæœ‰è¿™ç§æƒ…å†µä¸ºtrue å¦åˆ™å…¨æ˜¯falseconsole.log(/^å“ˆ$/.test(å“ˆå“ˆ)) // falseconsole.log(/^å“ˆ$/.test(äºŒå“ˆ)) // false é‡è¯ ï¼ˆè¡¨ç¤ºé‡å¤æ¬¡æ•°ï¼‰ é‡è¯ç”¨æ¥ è®¾å®šæŸä¸ªæ¨¡å¼å‡ºç°çš„æ¬¡æ•° é‡è¯ è¯´æ˜ * é‡å¤é›¶æ¬¡æˆ–æ›´å¤šæ¬¡ + é‡å¤ä¸€æ¬¡æˆ–æ›´å¤šæ¬¡ ? é‡å¤é›¶æ¬¡æˆ–ä¸€æ¬¡ {n} é‡å¤næ¬¡ {n,} é‡å¤næ¬¡æˆ–æ›´å¤šæ¬¡ {n,m} é‡å¤nåˆ°mæ¬¡ æ³¨æ„ï¼š é€—å·å·¦å³ä¸¤ä¾§åƒä¸‡ä¸è¦å‡ºç°ç©ºæ ¼ ç¤ºä¾‹ // é‡è¯ * ç±»ä¼¼ =0 æ¬¡console.log(/^å“ˆ$/.test(å“ˆ)) // trueconsole.log(/^å“ˆ*$/.test()) // trueconsole.log(/^å“ˆ*$/.test(å“ˆ)) // trueconsole.log(/^å“ˆ*$/.test(å“ˆå“ˆ)) // trueconsole.log(/^å“ˆ*$/.test(äºŒå“ˆå¾ˆå‚»)) // falseconsole.log(/^å“ˆ*$/.test(å“ˆå¾ˆå‚»)) // falseconsole.log(/^å“ˆ*$/.test(å“ˆå¾ˆå“ˆ)) // falseconsole.log(------------------)// é‡è¯ + ç±»ä¼¼ =1 æ¬¡console.log(/^å“ˆ$/.test(å“ˆ)) // trueconsole.log(/^å“ˆ+$/.test()) // falseconsole.log(/^å“ˆ+$/.test(å“ˆ)) // trueconsole.log(/^å“ˆ+$/.test(å“ˆå“ˆ)) // trueconsole.log(/^å“ˆ+$/.test(äºŒå“ˆå¾ˆå‚»)) // falseconsole.log(/^å“ˆ+$/.test(å“ˆå¾ˆå‚»)) // falseconsole.log(/^å“ˆ+$/.test(å“ˆå¾ˆå“ˆ)) // falseconsole.log(------------------)// é‡è¯ ? ç±»ä¼¼ 0 || 1console.log(/^å“ˆ?$/.test()) // trueconsole.log(/^å“ˆ?$/.test(å“ˆ)) // trueconsole.log(/^å“ˆ?$/.test(å“ˆå“ˆ)) // trueconsole.log(/^å“ˆ?$/.test(äºŒå“ˆå¾ˆå‚»)) // falseconsole.log(/^å“ˆ?$/.test(å“ˆå¾ˆå‚»)) // falseconsole.log(/^å“ˆ?$/.test(å“ˆå¾ˆå“ˆ)) // falseconsole.log(------------------)// é‡è¯ n å†™å‡ ï¼Œå°±å¿…é¡»å‡ºç°å‡ æ¬¡console.log(/^å“ˆ4$/.test(å“ˆ))console.log(/^å“ˆ4$/.test(å“ˆå“ˆ))console.log(/^å“ˆ4$/.test(å“ˆå“ˆå“ˆ))console.log(/^å“ˆ4$/.test(å“ˆå“ˆå“ˆå“ˆ))console.log(/^å“ˆ4$/.test(å“ˆå“ˆå“ˆå“ˆå“ˆ))console.log(/^å“ˆ4$/.test(å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ))console.log(------------------)// é‡è¯ n, =nconsole.log(/^å“ˆ4,$/.test(å“ˆ))console.log(/^å“ˆ4,$/.test(å“ˆå“ˆ))console.log(/^å“ˆ4,$/.test(å“ˆå“ˆå“ˆ))console.log(/^å“ˆ4,$/.test(å“ˆå“ˆå“ˆå“ˆ))console.log(/^å“ˆ4,$/.test(å“ˆå“ˆå“ˆå“ˆå“ˆ))console.log(/^å“ˆ4,$/.test(å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ))console.log(------------------)// é‡è¯ n,m é€—å·å·¦å³ä¸¤ä¾§åƒä¸‡ä¸èƒ½æœ‰ç©ºæ ¼ =n = mconsole.log(/^å“ˆ4,6$/.test(å“ˆ))console.log(/^å“ˆ4,6$/.test(å“ˆå“ˆ))console.log(/^å“ˆ4,6$/.test(å“ˆå“ˆå“ˆ))console.log(/^å“ˆ4,6$/.test(å“ˆå“ˆå“ˆå“ˆ))console.log(/^å“ˆ4,6$/.test(å“ˆå“ˆå“ˆå“ˆå“ˆ))console.log(/^å“ˆ4,6$/.test(å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ))console.log(/^å“ˆ4,6$/.test(å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ)) å­—ç¬¦ç±» ï¼ˆæ¯”å¦‚ \\d è¡¨ç¤º 0~9ï¼‰ [ ] åŒ¹é…å­—ç¬¦é›†åˆ åé¢çš„å­—ç¬¦ä¸²åªè¦åŒ…å« abc ä¸­ä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œéƒ½è¿”å› true ã€‚ [ ] é‡Œé¢åŠ ä¸Š - è¿å­—ç¬¦ ä½¿ç”¨è¿å­—ç¬¦ - è¡¨ç¤ºä¸€ä¸ªèŒƒå›´ [a-z] è¡¨ç¤º a åˆ° z 26ä¸ªè‹±æ–‡å­—æ¯éƒ½å¯ä»¥ [a-zA-Z] è¡¨ç¤ºå¤§å°å†™éƒ½å¯ä»¥ [0-9] è¡¨ç¤º 0~9 çš„æ•°å­—éƒ½å¯ä»¥ [ ] é‡Œé¢åŠ ä¸Š ^ å–åç¬¦å· [^a-z] åŒ¹é…é™¤äº†å°å†™å­—æ¯ä»¥å¤–çš„å­—ç¬¦ æ³¨æ„è¦å†™åˆ°ä¸­æ‹¬å·é‡Œé¢ . åŒ¹é…é™¤æ¢è¡Œç¬¦ä¹‹å¤–çš„ä»»ä½•å•ä¸ªå­—ç¬¦ é¢„å®šä¹‰ æŒ‡çš„æ˜¯ æŸäº›å¸¸è§æ¨¡å¼çš„ç®€å†™æ–¹å¼ é¢„å®šç±» è¯´æ˜ \\d åŒ¹é…0-9é—´çš„ä»»ä¸€æ•°å­—ï¼Œç›¸å½“äº[0-9] \\D åŒ¹é…æ‰€æœ‰0-9ä»¥å¤–çš„å­—ç¬¦ï¼Œç›¸å½“äº[ ^0-9] \\w åŒ¹é…ä»»æ„çš„å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ç›¸å½“äº[A-Za-z0-9_] \\W é™¤æ‰€æœ‰å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ä»¥å¤–çš„å­—ç¬¦ï¼Œç›¸å½“äº[ ^A-Za-z0-9_] \\s åŒ¹é…ç©ºæ ¼ï¼ˆåŒ…æ‹¬æ¢è¡Œç¬¦ã€åˆ¶è¡¨ç¬¦ã€ç©ºæ ¼ç¬¦ç­‰ï¼‰ï¼Œç›¸å½“äº[\\t\\r \\v\\f] \\S åŒ¹é…éç©ºæ ¼çš„å­—ç¬¦ï¼Œç›¸å½“äº[ ^\\t\\r \\v\\f] ç¤ºä¾‹ // å­—ç¬¦ç±» [abc] åªé€‰1ä¸ªconsole.log(/^[abc]$/.test(a)) // trueconsole.log(/^[abc]$/.test(b)) // trueconsole.log(/^[abc]$/.test(c)) // trueconsole.log(/^[abc]$/.test(ab)) // falseconsole.log(/^[abc]2$/.test(ab)) // trueconsole.log(------------------)// å­—ç¬¦ç±» [a-z] åªé€‰1ä¸ªconsole.log(/^[A-Z]$/.test(p)) // falseconsole.log(/^[A-Z]$/.test(P)) // trueconsole.log(/^[0-9]$/.test(2)) // trueconsole.log(/^[a-zA-Z0-9]$/.test(2)) // trueconsole.log(/^[a-zA-Z0-9]$/.test(p)) // trueconsole.log(/^[a-zA-Z0-9]$/.test(P)) // true 6.4 ä¿®é¥°ç¬¦ ä½œç”¨ ä¿®é¥°ç¬¦çº¦æŸæ­£åˆ™æ‰§è¡Œçš„æŸäº›ç»†èŠ‚è¡Œä¸ºï¼Œå¦‚æ˜¯å¦åŒºåˆ†å¤§å°å†™ã€æ˜¯å¦æ”¯æŒå¤šè¡ŒåŒ¹é…ç­‰ è¯­æ³• /è¡¨è¾¾å¼/ä¿®é¥°ç¬¦ i æ˜¯å•è¯ ignore çš„ç¼©å†™ï¼Œæ­£åˆ™åŒ¹é…æ—¶å­—æ¯ä¸åŒºåˆ†å¤§å°å†™ g æ˜¯å•è¯ global çš„ç¼©å†™ï¼ŒåŒ¹é…æ‰€æœ‰æ»¡è¶³æ­£åˆ™è¡¨è¾¾å¼çš„ç»“æœ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script console.log(/^java$/.test(java)) console.log(/^java$/i.test(JAVA)) console.log(/^java$/i.test(Java)) const str = javaæ˜¯ä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼Œ å­¦å®ŒJAVAå·¥èµ„å¾ˆé«˜ // const re = str.replace(/java|JAVA/g, å‰ç«¯) const re = str.replace(/java/ig, å‰ç«¯) console.log(re) // å‰ç«¯æ˜¯ä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼Œ å­¦å®Œå‰ç«¯å·¥èµ„å¾ˆé«˜ /script/body/html","tags":["DOM","BOM","DOMäº‹ä»¶","æ­£åˆ™è¡¨è¾¾å¼"],"categories":["å‰ç«¯"]},{"title":"JavaScriptåŸºç¡€","path":"/2023/12/04/2023-12-04-JavaScrpitåŸºç¡€/","content":"JavaScript ç®€ä»‹JavaScript æ˜¯ä»€ä¹ˆ JavaScript ï¼ˆæ˜¯ä»€ä¹ˆï¼Ÿï¼‰ æ˜¯ä¸€ç§è¿è¡Œåœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰çš„ç¼–ç¨‹è¯­è¨€ï¼Œå®ç°äººæœºäº¤äº’æ•ˆæœ ä½œç”¨ï¼ˆåšä»€ä¹ˆï¼Ÿï¼‰ ç½‘é¡µç‰¹æ•ˆ (ç›‘å¬ç”¨æˆ·çš„ä¸€äº›è¡Œä¸ºè®©ç½‘é¡µä½œå‡ºå¯¹åº”çš„åé¦ˆ) è¡¨å•éªŒè¯ (é’ˆå¯¹è¡¨å•æ•°æ®çš„åˆæ³•æ€§è¿›è¡Œåˆ¤æ–­) æ•°æ®äº¤äº’ (è·å–åå°çš„æ•°æ®, æ¸²æŸ“åˆ°å‰ç«¯) æœåŠ¡ç«¯ç¼–ç¨‹ (node.js) JavaScript çš„ç»„æˆ æƒå¨ç½‘ç«™ï¼šMDN Web Docs (mozilla.org) ECMAScriptï¼šè§„å®šäº† js åŸºç¡€è¯­æ³•æ ¸å¿ƒçŸ¥è¯†ã€‚æ¯”å¦‚ï¼šå˜é‡ã€åˆ†æ”¯è¯­å¥ã€å¾ªç¯è¯­å¥ã€å¯¹è±¡ç­‰ç­‰ Web APIs DOMï¼šæ“ä½œæ–‡æ¡£ï¼Œæ¯”å¦‚å¯¹é¡µé¢å…ƒç´ è¿›è¡Œç§»åŠ¨ã€å¤§å°ã€æ·»åŠ åˆ é™¤ç­‰æ“ä½œ BOMï¼šæ“ä½œæµè§ˆå™¨ï¼Œæ¯”å¦‚é¡µé¢å¼¹çª—ï¼Œæ£€æµ‹çª—å£å®½åº¦ã€å­˜å‚¨æ•°æ®åˆ°æµè§ˆå™¨ç­‰ç­‰ JavaScript ä¹¦å†™ä½ç½® å†…éƒ¨ JavaScript ä½ç½® ç›´æ¥å†™åœ¨ HTML æ–‡ä»¶é‡Œï¼Œç”¨ script æ ‡ç­¾åŒ…ä½ è§„èŒƒ script æ ‡ç­¾å†™åœ¨ /body ä¸Šé¢ æ³¨æ„ æˆ‘ä»¬å°† script æ”¾åœ¨ HTML æ–‡ä»¶çš„åº•éƒ¨ é™„è¿‘çš„åŸå› æ˜¯æµè§ˆå™¨ä¼šæŒ‰ç…§ä»£ç åœ¨æ–‡ä»¶ä¸­çš„ é¡ºåºåŠ è½½ HTMLã€‚å¦‚æœå…ˆåŠ è½½çš„ JavaScript æœŸæœ›ä¿®æ”¹å…¶ä¸‹æ–¹çš„ HTMLï¼Œé‚£ä¹ˆå®ƒå¯èƒ½ç”±äº HTML å°šæœªè¢«åŠ è½½è€Œå¤±æ•ˆã€‚å› æ­¤ï¼Œå°† JavaScript ä»£ç æ”¾åœ¨ HTML é¡µé¢çš„åº•éƒ¨é™„è¿‘é€šå¸¸æ˜¯æœ€å¥½çš„ç­–ç•¥ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script alert(ä½ å¥½ï¼) /script/body/html å¤–éƒ¨ JavaScript ä½ç½® ä»£ç å†™åœ¨ä»¥.js ç»“å°¾çš„æ–‡ä»¶é‡Œ è§„èŒƒ é€šè¿‡ script æ ‡ç­¾ï¼Œå¼•å…¥åˆ° HTML é¡µé¢ä¸­ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script src=my.js/script/body/html å†…è” JavaScript ä½ç½® ä»£ç å†™åœ¨æ ‡ç­¾å†…éƒ¨ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody button onclick=alert(ä½ å¥½)â€œç‚¹å‡»/button/body/html æ³¨é‡Š å•è¡Œæ³¨é‡Š ç¬¦å·ï¼š ä½œç”¨ï¼šå³è¾¹è¿™ä¸€è¡Œçš„ä»£ç ä¼šè¢«å¿½ç•¥ å¿«æ·é”®ï¼šctrl + / å—æ³¨é‡Š ç¬¦å·ï¼š** ä½œç”¨ï¼šåœ¨å’Œ ä¹‹é—´çš„æ‰€æœ‰å†…å®¹éƒ½ä¼šè¢«å¿½ç•¥ å¿«æ·é”®ï¼šshift + alt + A è¾“å…¥è¾“å‡ºè¯­æ³• è¾“å‡ºè¯­æ³• è¾“å‡ºè¯­æ³• 1 è¯­æ³•ï¼šdocument.write() ä½œç”¨ï¼šå‘ body å†…è¾“å‡ºå†…å®¹ è¾“å‡ºè¯­æ³• 2 è¯­æ³•ï¼šalert() ä½œç”¨ï¼šé¡µé¢å¼¹å‡ºè­¦å‘Šå¯¹è¯æ¡† è¾“å‡ºè¯­æ³• 3 è¯­æ³•ï¼šconsole.log() ä½œç”¨ï¼šæ§åˆ¶å°è¾“å‡ºè¯­æ³•ï¼Œç¨‹åºå‘˜è°ƒè¯•ä½¿ç”¨ è¾“å…¥è¯­æ³• è¯­æ³•ï¼šprompt() ä½œç”¨ï¼šæ˜¾ç¤ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œå¯¹è¯æ¡†ä¸­åŒ…å«ä¸€æ¡æ–‡å­—ä¿¡æ¯ï¼Œç”¨æ¥æç¤ºç”¨æˆ·è¾“å…¥æ–‡å­— å­—é¢é‡åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œå­—é¢é‡ï¼ˆliteralï¼‰æ˜¯åœ¨è®¡ç®—æœºä¸­æè¿° äº‹ç‰© æˆ‘ä»¬å·¥èµ„æ˜¯ï¼š 1000 æ­¤æ—¶ 1000 å°±æ˜¯ æ•°å­—å­—é¢é‡ ç¨‹åºå‘˜ å­—ç¬¦ä¸²å­—é¢é‡ è¿˜æœ‰æ¥ä¸‹æ¥æˆ‘ä»¬å­¦çš„ [] æ•°ç»„å­—é¢é‡ {} å¯¹è±¡å­—é¢é‡ ç­‰ç­‰ å˜é‡å˜é‡å‘½åè§„åˆ™ä¸è§„èŒƒ è§„åˆ™ ä¸èƒ½ç”¨å…³é”®å­— å…³é”®å­—ï¼šæœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦ï¼ŒJavaScript å†…ç½®çš„ä¸€äº›è‹±è¯­è¯æ±‡ã€‚ä¾‹å¦‚ï¼šletã€varã€ifã€for ç­‰ åªèƒ½ç”¨ä¸‹åˆ’çº¿ã€å­—æ¯ã€æ•°å­—ã€$ç»„æˆï¼Œä¸”æ•°å­—ä¸èƒ½å¼€å¤´ å­—æ¯ä¸¥æ ¼åŒºåˆ†å¤§å°å†™ï¼Œå¦‚ Age å’Œ age æ˜¯ä¸åŒçš„å˜é‡ è§„èŒƒ èµ·åè¦æœ‰æ„ä¹‰ éµå®ˆå°é©¼å³°å‘½åæ³• ç¬¬ä¸€ä¸ªå•è¯é¦–å­—æ¯å°å†™ï¼Œåé¢æ¯ä¸ªå•è¯é¦–å­—æ¯å¤§å†™ã€‚ä¾‹ï¼šuserName ç¤ºä¾‹ # å˜é‡å£°æ˜let å˜é‡åç¤ºä¾‹ï¼šlet age# å˜é‡èµ‹å€¼let name = å¼ ä¸‰# å˜é‡æ›´æ–°name = æå›› let ä¸ var çš„åŒºåˆ« åŒºåˆ« åœ¨è¾ƒæ—§çš„ JavaScriptï¼Œä½¿ç”¨å…³é”®å­— var æ¥å£°æ˜å˜é‡ ï¼Œè€Œä¸æ˜¯ let var ç°åœ¨å¼€å‘ä¸­ä¸€èˆ¬ä¸å†ä½¿ç”¨å®ƒï¼Œåªæ˜¯æˆ‘ä»¬å¯èƒ½å†è€ç‰ˆç¨‹åºä¸­çœ‹åˆ°å®ƒ let ä¸ºäº†è§£å†³ var çš„ä¸€äº›é—®é¢˜ã€‚ var å£°æ˜ å¯ä»¥å…ˆä½¿ç”¨ åœ¨å£°æ˜ (ä¸åˆç†) var å£°æ˜è¿‡çš„å˜é‡å¯ä»¥é‡å¤å£°æ˜(ä¸åˆç†) æ¯”å¦‚å˜é‡æå‡ã€å…¨å±€å˜é‡ã€æ²¡æœ‰å—çº§ä½œç”¨åŸŸç­‰ç­‰ å¸¸é‡ æ¦‚å¿µ ä½¿ç”¨ const å£°æ˜çš„å˜é‡ç§°ä¸ºâ€œå¸¸é‡â€ ä½¿ç”¨åœºæ™¯ å½“æŸä¸ªå˜é‡æ°¸è¿œ ä¸ä¼šæ”¹å˜ çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨ const æ¥å£°æ˜ï¼Œè€Œä¸æ˜¯ let å‘½åè§„èŒƒï¼šå’Œå˜é‡ä¸€è‡´ å¸¸é‡ä½¿ç”¨ const G = 9.8console.log(G) æ³¨æ„ å¸¸é‡ä¸å…è®¸é‡æ–°èµ‹å€¼, å£°æ˜çš„æ—¶å€™å¿…é¡»èµ‹å€¼ï¼ˆåˆå§‹åŒ–ï¼‰ æ•°æ®ç±»å‹ åŸºæœ¬æ•°æ®ç±»å‹ number æ•°å­—å‹string å­—ç¬¦ä¸²å‹boolean å¸ƒå°”å‹undefined æœªå®šä¹‰å‹null ç©ºç±»å‹ å¼•ç”¨æ•°æ®ç±»å‹ object å¯¹è±¡ æ•°å­—ç±»å‹ï¼ˆNumberï¼‰ æ¦‚å¿µ å³æˆ‘ä»¬æ•°å­¦ä¸­å­¦ä¹ åˆ°çš„æ•°å­—ï¼Œå¯ä»¥æ˜¯æ•´æ•°ã€å°æ•°ã€æ­£æ•°ã€è´Ÿæ•°ã€‚ JavaScript ä¸­çš„æ­£æ•°ã€è´Ÿæ•°ã€å°æ•°ç­‰ ç»Ÿä¸€ç§°ä¸º æ•°å­—ç±»å‹ã€‚ ç¤ºä¾‹ let age = 18let price = 88.99 æ³¨æ„ JS æ˜¯å¼±æ•°æ®ç±»å‹ï¼Œå˜é‡åˆ°åº•å±äºé‚£ç§ç±»å‹ï¼Œåªæœ‰èµ‹å€¼ä¹‹åï¼Œæˆ‘ä»¬æ‰èƒ½ç¡®è®¤ã€‚ NaN NaN ä»£è¡¨ä¸€ä¸ªè®¡ç®—é”™è¯¯ã€‚å®ƒæ˜¯ä¸€ä¸ªä¸æ­£ç¡®çš„æˆ–è€…ä¸€ä¸ªæœªå®šä¹‰çš„æ•°å­¦æ“ä½œæ‰€å¾—åˆ°çš„ç»“æœã€‚ console.log(è€å¸ˆ - 2) // NaN NaN æ˜¯ç²˜æ€§çš„ï¼Œä»»ä½•å¯¹ NaN çš„æ“ä½œéƒ½ä¼šè¿”å› NaN console.log(NaN + 2) // NaN å­—ç¬¦ä¸²ç±»å‹ï¼ˆstringï¼‰ æ¦‚å¿µ é€šè¿‡å•å¼•å·ï¼ˆâ€™â€™ï¼‰ ã€åŒå¼•å·ï¼ˆâ€â€ï¼‰æˆ–åå¼•å·() åŒ…è£¹çš„æ•°æ®éƒ½å«å­—ç¬¦ä¸²ï¼Œå•å¼•å·å’ŒåŒå¼•å·æ²¡æœ‰æœ¬è´¨ä¸Šçš„åŒºåˆ«ï¼Œæ¨èä½¿ç”¨å•å¼•å·ã€‚ æ¨¡æ¿å­—ç¬¦ä¸² ä½¿ç”¨åœºæ™¯ï¼šæ‹¼æ¥å­—ç¬¦ä¸²å’Œå˜é‡ è¯­æ³•ï¼š (åå¼•å·) å†…å®¹æ‹¼æ¥å˜é‡æ—¶ï¼Œç”¨ ${ } åŒ…ä½å˜é‡ document.write(`å¤§å«å¥½ï¼Œæˆ‘å«$name`) å¸ƒå°”ç±»å‹ï¼ˆbooleanï¼‰ æ¦‚å¿µ è¡¨ç¤ºè‚¯å®šæˆ–å¦å®šæ—¶åœ¨è®¡ç®—æœºä¸­å¯¹åº”çš„æ˜¯å¸ƒå°”ç±»å‹æ•°æ® å®ƒæœ‰ä¸¤ä¸ªå›ºå®šçš„å€¼ true å’Œ falseï¼Œè¡¨ç¤ºè‚¯å®šçš„æ•°æ®ç”¨ trueï¼ˆçœŸï¼‰ï¼Œè¡¨ç¤ºå¦å®šçš„æ•°æ®ç”¨ falseï¼ˆå‡ï¼‰ ç¤ºä¾‹ script // 1. å¸ƒå°”å‹ true false console.log(true) console.log(false)/script æœªå®šä¹‰ç±»å‹ï¼ˆundefinedï¼‰ æ¦‚å¿µ æœªå®šä¹‰æ˜¯æ¯”è¾ƒç‰¹æ®Šçš„ç±»å‹ï¼Œåªæœ‰ä¸€ä¸ªå€¼ undefinedã€‚ ä»€ä¹ˆæƒ…å†µå‡ºç°æœªå®šä¹‰ç±»å‹ï¼Ÿ åªå£°æ˜ å˜é‡ï¼Œä¸èµ‹å€¼ çš„æƒ…å†µä¸‹ï¼Œå˜é‡çš„é»˜è®¤å€¼ä¸º undefinedï¼Œä¸€èˆ¬å¾ˆå°‘ã€ç›´æ¥ã€‘ä¸ºæŸä¸ªå˜é‡èµ‹å€¼ä¸º undefinedã€‚ ä½¿ç”¨åœºæ™¯ æˆ‘ä»¬å¼€å‘ä¸­ç»å¸¸å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œç­‰å¾…ä¼ é€è¿‡æ¥çš„æ•°æ®ã€‚ å¦‚æœæˆ‘ä»¬ä¸çŸ¥é“è¿™ä¸ªæ•°æ®æ˜¯å¦ä¼ é€’è¿‡æ¥ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡æ£€æµ‹è¿™ä¸ªå˜é‡æ˜¯ä¸æ˜¯ undefinedï¼Œå°±åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æ•°æ®ä¼ é€’è¿‡æ¥ ç¤ºä¾‹ // undefined åªå£°æ˜ä¸èµ‹å€¼let ageconsole.log(age) nullï¼ˆç©ºç±»å‹ï¼‰ æ¦‚å¿µ JavaScript ä¸­çš„ null ä»…ä»…æ˜¯ä¸€ä¸ªä»£è¡¨ â€œæ— â€ã€â€œç©ºâ€ æˆ– â€œå€¼æœªçŸ¥â€ çš„ç‰¹æ®Šå€¼ã€‚ null å’Œ undefined åŒºåˆ« undefined è¡¨ç¤ºæ²¡æœ‰èµ‹å€¼ null è¡¨ç¤ºèµ‹å€¼äº†ï¼Œä½†æ˜¯å†…å®¹ä¸ºç©º ä½¿ç”¨åœºæ™¯ å®˜æ–¹è§£é‡Šï¼šæŠŠ null ä½œä¸ºå°šæœªåˆ›å»ºçš„å¯¹è±¡ å¤§ç™½è¯ï¼š å°†æ¥æœ‰ä¸ªå˜é‡é‡Œé¢å­˜æ”¾çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯å¯¹è±¡è¿˜æ²¡åˆ›å»ºå¥½ï¼Œå¯ä»¥å…ˆç»™ä¸ª null ç¤ºä¾‹ // null ç©ºlet obj = nullconsole.log(obj) æ£€æµ‹æ•°æ®ç±»å‹ ä½œç”¨ typeof è¿ç®—ç¬¦å¯ä»¥è¿”å›è¢«æ£€æµ‹çš„æ•°æ®ç±»å‹ã€‚ è¯­æ³• ä½œä¸ºè¿ç®—ç¬¦ï¼š typeof x ï¼ˆå¸¸ç”¨çš„å†™æ³•ï¼‰ å‡½æ•°å½¢å¼ï¼š typeof(x) æ¢è¨€ä¹‹ï¼Œæœ‰æ‹¬å·å’Œæ²¡æœ‰æ‹¬å·ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä½¿ç”¨è¿ç®—ç¬¦çš„å†™æ³•ã€‚ ç¤ºä¾‹ script // è¿”å›çš„ä»€ä¹ˆç±»å‹ console.log(typeof 123) //number console.log(typeof 123) //string console.log(typeof true) //boolean console.log(typeof undefined) //undefined console.log(typeof null) //object let num = 10 console.log(typeof num + 11) //number11/script ç±»å‹è½¬æ¢ ä¸ºä»€ä¹ˆéœ€è¦ç±»å‹è½¬æ¢ï¼Ÿ JavaScript æ˜¯å¼±æ•°æ®ç±»å‹ï¼š JavaScript ä¹Ÿä¸çŸ¥é“å˜é‡åˆ°åº•å±äºé‚£ç§æ•°æ®ç±»å‹ï¼Œåªæœ‰èµ‹å€¼äº†æ‰æ¸…æ¥šã€‚ å‘ï¼š ä½¿ç”¨è¡¨å•ã€prompt è·å–è¿‡æ¥çš„æ•°æ®é»˜è®¤æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„ï¼Œæ­¤æ—¶å°±ä¸èƒ½ç›´æ¥ç®€å•çš„è¿›è¡ŒåŠ æ³•è¿ç®—ã€‚ éšå¼è½¬æ¢ æŸäº›è¿ç®—ç¬¦è¢«æ‰§è¡Œæ—¶ï¼Œç³»ç»Ÿå†…éƒ¨è‡ªåŠ¨å°†æ•°æ®ç±»å‹è¿›è¡Œè½¬æ¢ï¼Œè¿™ç§è½¬æ¢ç§°ä¸ºéšå¼è½¬æ¢ã€‚ è§„åˆ™ +å·ä¸¤è¾¹åªè¦æœ‰ä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²ï¼Œéƒ½ä¼šæŠŠå¦å¤–ä¸€ä¸ªè½¬æˆå­—ç¬¦ä¸² é™¤äº†+ä»¥å¤– çš„ç®—æœ¯è¿ç®—ç¬¦ æ¯”å¦‚ - * ç­‰éƒ½ä¼šæŠŠæ•°æ®è½¬æˆ æ•°å­—ç±»å‹ å°æŠ€å·§ + å·ä½œä¸ºæ­£å·è§£æå¯ä»¥è½¬æ¢æˆæ•°å­—å‹ ä»»ä½•æ•°æ®å’Œå­—ç¬¦ä¸²ç›¸åŠ ç»“æœéƒ½æ˜¯å­—ç¬¦ä¸² ç¤ºä¾‹ script // let num = prompt(è¯·è¾“å…¥ä¸€ä¸ªæ•°å­—) // console.log(num, typeof num) // å†…éƒ¨æ‚„æ‚„çš„æŠŠ 18 è½¬æ¢ä¸ºäº†å­—ç¬¦ä¸²çš„ 18 console.log(pinkè€å¸ˆ + 18) console.log(10 + 10) // 1010 // - * / æŠŠ å­—ç¬¦ä¸²çš„ 10 è½¬æ¢ä¸º æ•°å­—å‹ 10 console.log(10 - 10) // 0 // å°æŠ€å·§ let num = 10 console.log(num) console.log(+num) // console.log(-num) console.log(10 + +10)/script æ˜¾å¼è½¬æ¢ ç¼–å†™ç¨‹åºæ—¶è¿‡åº¦ä¾é ç³»ç»Ÿå†…éƒ¨çš„éšå¼è½¬æ¢æ˜¯ä¸ä¸¥ç¦çš„ï¼Œå› ä¸ºéšå¼è½¬æ¢è§„å¾‹å¹¶ä¸æ¸…æ™°ï¼Œå¤§å¤šæ˜¯é ç»éªŒæ€»ç»“çš„è§„å¾‹ã€‚ä¸ºäº†é¿å…å› éšå¼è½¬æ¢å¸¦æ¥çš„é—®é¢˜ï¼Œé€šå¸¸æ ¹é€»è¾‘éœ€è¦å¯¹æ•°æ®è¿›è¡Œæ˜¾ç¤ºè½¬æ¢ã€‚ æ¦‚å¿µ è‡ªå·±å†™ä»£ç å‘Šè¯‰ç³»ç»Ÿè¯¥è½¬æˆä»€ä¹ˆç±»å‹ è½¬æˆæ•°å­—ç±»å‹ Number(æ•°æ®) å¦‚æœå­—ç¬¦ä¸²å†…å®¹é‡Œæœ‰éæ•°å­—ï¼Œè½¬æ¢å¤±è´¥æ—¶ç»“æœä¸º NaNï¼ˆNot a Numberï¼‰å³ä¸æ˜¯ä¸€ä¸ªæ•°å­— NaN ä¹Ÿæ˜¯ number ç±»å‹çš„æ•°æ®ï¼Œä»£è¡¨éæ•°å­— parseInt(æ•°æ®) åªä¿ç•™æ•´æ•° parseFloat(æ•°æ®) å¯ä»¥ä¿ç•™å°æ•° ç¤ºä¾‹ script // let num = 10 // Number(æ•°æ®) console.log(Number(10.01)) //10.01 // è½¬æ¢ä¸ºæ•°å­—å‹ï¼Œåªä¿ç•™æ•´æ•°ï¼Œæ²¡æœ‰å››èˆäº”å…¥ console.log(parseInt(10)) //10 console.log(parseInt(10.111)) //10 console.log(parseInt(10.999px)) //10 // è½¬æ¢ä¸ºæ•°å­—å‹ï¼Œä¼šä¿ç•™å°æ•° console.log(parseFloat(10.999)) //10.999 // åŒºåˆ«ï¼š // 1.Number() åªèƒ½æ”¾æ•°å­—ç±»å‹çš„å­—ç¬¦ï¼Œä¸èƒ½æ”¾abcè¿™æ ·çš„ // å¦åˆ™è¿”å›çš„æ˜¯ NaN not A number console.log(Number(10.01abc)) //NaN // parseFloat ç»å¸¸ç”¨äºè¿‡æ»¤pxå•ä½ console.log(parseFloat(10.01abc)) //10.01 console.log(parseFloat(100px)) // 100 console.log(parseFloat(px100px)) //NaN/script è½¬æ¢ä¸ºå­—ç¬¦å‹ String(æ•°æ®) console.log(String(10)) å˜é‡.toString(è¿›åˆ¶) let age = 10console.log(age.toString())// æ‹¬å·é‡Œé¢å¦‚æœæ˜¯2 è½¬æ¢ä¸º äºŒè¿›åˆ¶console.log(age.toString(2)) //1010 è¿ç®—ç¬¦èµ‹å€¼è¿ç®—ç¬¦ ä½œç”¨ å¯¹å˜é‡è¿›è¡Œèµ‹å€¼çš„è¿ç®—ç¬¦ ç±»å‹ å°†ç­‰å·å³è¾¹çš„å€¼èµ‹äºˆç»™å·¦è¾¹, è¦æ±‚å·¦è¾¹å¿…é¡»æ˜¯ä¸€ä¸ªå®¹å™¨ + - * % ç¤ºä¾‹ script let num = 18 num = num + 1 num = num + 3 num += 3 console.log(num) // ä¸¤ä¸ªå˜é‡çš„ æŠŠiåŠ åˆ° sum é‡Œé¢å» let i = 1 let sum = 0 sum = sum + i sum += i /script ä¸€å…ƒè¿ç®—ç¬¦ è‡ªå¢ ç¬¦å·ï¼š++ ä½œç”¨ï¼šè®©å˜é‡çš„å€¼ +1 è‡ªå‡ ç¬¦å·ï¼šâ€“ ä½œç”¨ï¼šè®©å˜é‡çš„å€¼ -1 åœºæ™¯ ç»å¸¸ç”¨äºè®¡æ•°æ¥ä½¿ç”¨ã€‚ æ¯”å¦‚è¿›è¡Œ 10 æ¬¡æ“ä½œï¼Œç”¨å®ƒæ¥è®¡ç®—è¿›è¡Œäº†å¤šå°‘æ¬¡äº† ç¤ºä¾‹ script let num = 10 // ä¸€å…ƒè¿ç®—ç¬¦ // ++num ç­‰ä»·äº num += 1 num++ console.log(num) // å‰ç½®è‡ªå¢ let i = 1 // å…ˆè‡ªåŠ  å†ä½¿ç”¨ console.log(++i + 2) // 4 // åç½®è‡ªå¢ let i = 1 // å…ˆä½¿ç”¨ åè‡ªåŠ  console.log(i++ + 2) // console.log(i) /script æ¯”è¾ƒè¿ç®—ç¬¦ æ¯”è¾ƒè¿ç®—ç¬¦ ï¼š å·¦è¾¹æ˜¯å¦å¤§äºå³è¾¹ï¼š å·¦è¾¹æ˜¯å¦å°äºå³è¾¹=ï¼š å·¦è¾¹æ˜¯å¦å¤§äºæˆ–ç­‰äºå³è¾¹=ï¼š å·¦è¾¹æ˜¯å¦å°äºæˆ–ç­‰äºå³è¾¹==ï¼š å·¦å³ä¸¤è¾¹å€¼æ˜¯å¦ç›¸ç­‰===ï¼š å·¦å³ä¸¤è¾¹æ˜¯å¦ç±»å‹å’Œå€¼éƒ½ç›¸ç­‰!==ï¼š å·¦å³ä¸¤è¾¹æ˜¯å¦ä¸å…¨ç­‰// æ¯”è¾ƒç»“æœä¸ºbooleanç±»å‹ï¼Œå³åªä¼šå¾—åˆ° true æˆ– false å¯¹æ¯” = å•ç­‰æ˜¯èµ‹å€¼== æ˜¯åˆ¤æ–­=== æ˜¯å…¨ç­‰// å¼€å‘ä¸­åˆ¤æ–­æ˜¯å¦ç›¸ç­‰ï¼Œå¼ºçƒˆæ¨èä½¿ç”¨ === å­—ç¬¦ä¸²æ¯”è¾ƒï¼Œæ˜¯æ¯”è¾ƒçš„å­—ç¬¦å¯¹åº”çš„ ASCII ç  ä»å·¦å¾€å³ä¾æ¬¡æ¯”è¾ƒ å¦‚æœç¬¬ä¸€ä½ä¸€æ ·å†æ¯”è¾ƒç¬¬äºŒä½ï¼Œä»¥æ­¤ç±»æ¨ æ¯”è¾ƒçš„å°‘ï¼Œäº†è§£å³å¯ NaN ä¸ç­‰äºä»»ä½•å€¼ï¼ŒåŒ…æ‹¬å®ƒæœ¬èº« æ¶‰åŠåˆ° â€œNaNâ€ éƒ½æ˜¯ false å°½é‡ä¸è¦æ¯”è¾ƒå°æ•°ï¼Œå› ä¸ºå°æ•°æœ‰ç²¾åº¦é—®é¢˜ ä¸åŒç±»å‹ä¹‹é—´æ¯”è¾ƒä¼šå‘ç”Ÿéšå¼è½¬æ¢ æœ€ç»ˆæŠŠæ•°æ®éšå¼è½¬æ¢è½¬æˆ number ç±»å‹å†æ¯”è¾ƒ ç¤ºä¾‹ å¼€å‘ä¸­ï¼Œå¦‚æœè¿›è¡Œå‡†ç¡®çš„æ¯”è¾ƒæˆ‘ä»¬æ›´å–œæ¬¢ === æˆ–è€… !== script console.log(3 5) // false console.log(5 = 5) // true // console.log(5 = 5) console.log(5 == 5) // true // == åªè¦å€¼ä¸€æ ·å°±æ˜¯true ä¸ç®¡æ•°æ®ç±»å‹ console.log(5 == 5) // true console.log(5 == pink) // false // === ä»¥ååˆ¤æ–­è¦ç”¨ === å¼€å‘å¸¸ç”¨ è¦æ±‚å€¼å’Œæ•°æ®ç±»å‹éƒ½ä¸€æ · console.log(5 === 5) // true console.log(5 === 5) // false // ç‰¹æ®Šæƒ…å†µ console.log(pink red) // false console.log(pink pin) // true console.log(1 === NaN) // false console.log(NaN === NaN) // false console.log(0.1 + 0.2 === 0.3) // false console.log(0.1 + 0.2) // 0.30000000000000004 console.log(3 2) // ture/script é€»è¾‘è¿ç®—ç¬¦ ä½œç”¨ ç¬¦å· åç§° æ—¥å¸¸è¯»æ³• ç‰¹ç‚¹ å£è¯€ é€»è¾‘ä¸ å¹¶ä¸” ç¬¦å·ä¸¤è¾¹éƒ½ä¸º true ç»“æœæ‰ä¸º true ä¸€å‡åˆ™å‡ || é€»è¾‘æˆ– æˆ–è€… ç¬¦å·ä¸¤è¾¹æœ‰ä¸€ä¸ª true å°±ä¸º true ä¸€çœŸåˆ™çœŸ ! é€»è¾‘é å–å true å˜ false çœŸå˜å‡ï¼Œå‡å˜çœŸ\\ ç¤ºä¾‹ script // é€»è¾‘ä¸ ä¸€å‡åˆ™å‡ console.log(true true) console.log(false true) // é€»è¾‘æˆ– ä¸€çœŸåˆ™çœŸ console.log(false || true) console.log(false || false) // é€»è¾‘é å–å console.log(!true) console.log(!false) // æœ‰5ä¸ªå€¼æ˜¯å½“ false æ¥çœ‹çš„ å…¶ä½™æ˜¯çœŸçš„ // false æ•°å­—0 undefined null /script è¯­å¥è¡¨è¾¾å¼å’Œè¯­å¥ æ¦‚å¿µ è¡¨è¾¾å¼ï¼šè¡¨è¾¾å¼æ˜¯å¯ä»¥è¢«æ±‚å€¼çš„ä»£ç ï¼ŒJavaScript å¼•æ“ä¼šå°†å…¶è®¡ç®—å‡ºä¸€ä¸ªç»“æœ è¯­å¥ï¼šè¯­å¥æ˜¯ä¸€æ®µå¯ä»¥æ‰§è¡Œçš„ä»£ç  æ¯”å¦‚ï¼š prompt() å¯ä»¥å¼¹å‡ºä¸€ä¸ªè¾“å…¥æ¡†ï¼Œè¿˜æœ‰ if è¯­å¥ for å¾ªç¯è¯­å¥ç­‰ç­‰ åŒºåˆ« è¡¨è¾¾å¼ï¼šå› ä¸ºè¡¨è¾¾å¼å¯è¢«æ±‚å€¼ï¼Œæ‰€ä»¥å®ƒå¯ä»¥å†™åœ¨èµ‹å€¼è¯­å¥çš„å³ä¾§ è¡¨è¾¾å¼ num = 3 + 4 è¯­å¥ï¼šè€Œè¯­å¥ä¸ä¸€å®šæœ‰å€¼ï¼Œæ‰€ä»¥æ¯”å¦‚ alert()ã€for å’Œ break ç­‰è¯­å¥å°±ä¸èƒ½è¢«ç”¨äºèµ‹å€¼ è¯­å¥ alert() å¼¹å‡ºå¯¹è¯æ¡† console.log() æ§åˆ¶å°æ‰“å°è¾“å‡º åˆ†æ”¯è¯­å¥if åˆ†æ”¯è¯­å¥ if è¯­å¥æœ‰ä¸‰ç§ä½¿ç”¨ï¼šå•åˆ†æ”¯ã€åŒåˆ†æ”¯ã€å¤šåˆ†æ”¯ å•åˆ†æ”¯ if (false) alert(11) åŒåˆ†æ”¯ // è®¡ç®—å·¥èµ„// 1. ç”¨æˆ·è¾“å…¥å·¥é¾„let age = +prompt(è¯·è¾“å…¥å·¥é¾„)let money = 10000// 2. æ‰§è¡Œåˆ†æ”¯è¯­å¥if (age = 1) alert(`æ‚¨å®å‘å·¥èµ„:$money + 2000`) else alert(`æ‚¨å®å‘å·¥èµ„:$money`) å¤šåˆ†æ”¯ // 1. ç”¨æˆ·è¾“å…¥æ—¶é—´ ç­‰æˆ‘ä»¬å­¦api è‡ªåŠ¨è·å–æ—¶é—´let time = prompt(è¯·è¾“å…¥å°æ—¶ï¼š)// 2. å¤šåˆ†æ”¯åˆ¤æ–­if (time 12) document.write(`ä¸Šåˆå¥½ï¼Œå¥½å¥½å·¥ä½œ`) else if (time 18) document.write(`ä¸‹åˆå¥½ï¼Œå¥½å¥½å·¥ä½œ`) else if (time 20) document.write(`æ™šä¸Šå¥½ï¼Œå¥½å¥½åŠ ç­`) else document.write(`å¤œæ·±äº†ï¼Œå¤´å‘è¿˜æœ‰å—ï¼Ÿ`) ä¸‰å…ƒè¿ç®—ç¬¦ ç¬¦å·ï¼š? ä¸ : é…åˆä½¿ç”¨ è¯­æ³• æ¡ä»¶ ? æ»¡è¶³æ¡ä»¶æ‰§è¡Œä»£ç  : ä¸æ»¡è¶³æ¡ä»¶æ‰§è¡Œçš„ä»£ç  ç¤ºä¾‹ // 3 5 ? alert(ç¬¬ä¸€ä¸ª) : alert(ç¬¬äºŒä¸ª)let num1 = 40let num2 = 30num1 num2 ? console.log(num1) : console.log(num2)// let re = num1 num2 ? num1 : num2let re = num1 num2 ? num1 : num2console.log(re) switch switch è¯­å¥ switch(æ•°æ®) case å€¼1: ä»£ç 1 break case å€¼2: ä»£ç 2 break default: ä»£ç n break æ³¨æ„ switch case è¯­å¥ä¸€èˆ¬ç”¨äºç­‰å€¼åˆ¤æ–­ï¼Œä¸é€‚åˆäºåŒºé—´åˆ¤æ–­ switch case ä¸€èˆ¬éœ€è¦é…åˆ break å…³é”®å­—ä½¿ç”¨ï¼Œæ²¡æœ‰ break ä¼šé€ æˆ caseç©¿é€ ç¤ºä¾‹ switch (2) case 1: alert(1) break case 2: alert(2) break case 3: alert(3) break default: alert(æ²¡æœ‰æ•°æ®) å¾ªç¯è¯­å¥while è¯­æ³• while(å¾ªç¯æ¡ä»¶) è¦é‡å¤æ‰§è¡Œçš„ä»£ç (å¾ªç¯ä½“) ä½œç”¨ å¾ªç¯çš„æœ¬è´¨å°±æ˜¯ä»¥æŸä¸ªå˜é‡ä¸ºèµ·å§‹å€¼ï¼Œç„¶åä¸æ–­äº§ç”Ÿå˜åŒ–é‡ï¼Œæ…¢æ…¢é è¿‘ç»ˆæ­¢æ¡ä»¶çš„è¿‡ç¨‹ã€‚ æ‰€ä»¥ï¼Œwhile å¾ªç¯éœ€è¦å…·å¤‡ä¸‰è¦ç´ ï¼š å˜é‡èµ·å§‹å€¼ ç»ˆæ­¢æ¡ä»¶ï¼ˆæ²¡æœ‰ç»ˆæ­¢æ¡ä»¶ï¼Œå¾ªç¯ä¼šä¸€ç›´æ‰§è¡Œï¼Œé€ æˆæ­»å¾ªç¯ï¼‰ å˜é‡å˜åŒ–é‡ï¼ˆç”¨è‡ªå¢æˆ–è€…è‡ªå‡ï¼‰ é€€å‡ºå¾ªç¯ continue ç»“æŸæœ¬æ¬¡å¾ªç¯ ç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯ continue ç»“æŸæœ¬æ¬¡å¾ªç¯ ç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯ break å¯ä»¥ç›´æ¥é€€å‡ºå¾ªç¯ ç¤ºä¾‹ // æ±‚ 1~100 ä¹‹é—´çš„å¶æ•°ç´¯åŠ å’Œlet i = 1let sum = 0while (i = 100) if (i % 2 === 0) // æ­¤æ—¶ i ä¸€å®šæ˜¯å¶æ•° sum = sum + i // ä¸ç®¡ä½ æ˜¯å¶æ•°è¿˜æ˜¯å¥‡æ•°æˆ‘éƒ½è¦++ i++console.log(sum)// é€€å‡ºå¾ªç¯-æˆ‘ä»¬è¦æ‰“å°åƒåŒ…å­let i = 1while (i = 6) if (i === 3) i++ // continue ç»“æŸæœ¬æ¬¡å¾ªç¯ ç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯ // continue // é€€å‡ºå¾ªç¯ break document.write(`æˆ‘è¦åƒç¬¬$iä¸ªåŒ…å­ br`) i++ for ä½œç”¨ é‡å¤æ‰§è¡Œä»£ç  å¥½å¤„ æŠŠå£°æ˜èµ·å§‹å€¼ã€å¾ªç¯æ¡ä»¶ã€å˜åŒ–å€¼å†™åˆ°ä¸€èµ·ï¼Œè®©äººä¸€ç›®äº†ç„¶ï¼Œå®ƒæ˜¯æœ€å¸¸ä½¿ç”¨çš„å¾ªç¯å½¢å¼ for(å˜é‡èµ·å§‹å€¼; ç»ˆæ­¢æ¡ä»¶; å˜é‡å˜åŒ–é‡) // å¾ªç¯ä½“ é€€å‡ºå¾ªç¯ continue é€€å‡ºæœ¬æ¬¡å¾ªç¯ï¼Œä¸€èˆ¬ç”¨äºæ’é™¤æˆ–è€…è·³è¿‡æŸä¸€ä¸ªé€‰é¡¹çš„æ—¶å€™, å¯ä»¥ä½¿ç”¨ continue break é€€å‡ºæ•´ä¸ª for å¾ªç¯ï¼Œä¸€èˆ¬ç”¨äºç»“æœå·²ç»å¾—åˆ°, åç»­çš„å¾ªç¯ä¸éœ€è¦çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ ç¤ºä¾‹ for (let i = 1; i 6; i++) if (i === 2) // continue // 1345 ç»§ç»­ é€€å‡ºæœ¬æ¬¡å¾ªç¯ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯ break // ç»“æŸå¾ªç¯ é€€å‡ºæ•´ä¸ªå¾ªç¯ document.write(i)// å¾ªç¯åµŒå¥—for (let i = 1; i 6; i++) for (let j = 1; j 6; j++) document.write(æ˜Ÿ) // å¤–é¢å¾ªç¯æ‰§è¡Œä¸€æ¬¡ï¼Œé‡Œé¢å¾ªç¯æ‰§è¡Œå…¨éƒ¨ï¼ˆ5æ¬¡ï¼‰ æ•°ç»„æ•°ç»„åŸºæœ¬ä½¿ç”¨ æ¦‚å¿µ ä¸€ç§å°†ä¸€ç»„æ•°æ®å­˜å‚¨åœ¨å•ä¸ªå˜é‡åä¸‹çš„ä¼˜é›…æ–¹å¼ ç¤ºä¾‹ let æ•°ç»„å = [æ•°æ®1,æ•°æ®2,...,æ•°æ®n]// ç¤ºä¾‹let names = [å°æ˜,å°ç™½,å°å¾€,å°å®]// å–å€¼æ•°ç»„å[ä¸‹æ ‡]// ç¤ºä¾‹names[0] // å°æ˜names[1] // å°ç™½// æ•°ç»„é•¿åº¦names.length éå†æ•°ç»„ for å¾ªç¯éå†æ•°ç»„ let nums = [10,20,30,40,50]for (let i = 0; i nums.length; i++) document.write(nums[i]) map è¿­ä»£æ•°ç»„ const arr = [pink, red, black]arr.map(function (item, index) console.log(item); // item å¾—åˆ°æ•°ç»„å…ƒç´  console.log(index); // index å¾—åˆ°ç´¢å¼•å·) forEach(é‡ç‚¹) è¯­æ³•ï¼šè¢«éå†çš„æ•°ç»„.forEach(function(å½“å‰æ•°ç»„å…ƒç´ ï¼Œå½“å‰å…ƒç´ ç´¢å¼•å·) // å‡½æ•°ä½“)// forEach å°±æ˜¯éå† åŠ å¼ºç‰ˆçš„forå¾ªç¯ é€‚åˆäºéå†æ•°ç»„å¯¹è±¡const arr = [red, green, pink]const result = arr.forEach(function (item, index) console.log(item) // æ•°ç»„å…ƒç´  red green pink console.log(index) // ç´¢å¼•å·)// console.log(result) æ³¨æ„ forEach ä¸»è¦æ˜¯éå†æ•°ç»„ å‚æ•°å½“å‰æ•°ç»„å…ƒç´ æ˜¯å¿…é¡»è¦å†™çš„ï¼Œ ç´¢å¼•å·å¯é€‰ æ“ä½œæ•°ç»„æ“ä½œæ€»è§ˆ æŸ¥è¯¢ è¯­æ³• æ•°ç»„[ä¸‹æ ‡] ç¤ºä¾‹ let arr = [pink, hotpink, deeppink]// è®¿é—® / æŸ¥è¯¢console.log(arr[0]) æ·»åŠ  push ä½œç”¨ æ•°ç»„.push() æ–¹æ³•å°†ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ æ·»åŠ åˆ°æ•°ç»„çš„ æœ«å°¾ï¼Œå¹¶è¿”å›è¯¥ æ•°ç»„çš„æ–°é•¿åº¦ (é‡ç‚¹) ç¤ºä¾‹ // è¯­æ³•arr.push(å…ƒç´ 1,...,å…ƒç´ n)// ç¤ºä¾‹let arr = [red, green]arr.push(pink, hot)console.log(arr) // [red, green, pink, hot] unshift ä½œç”¨ arr.unshift(æ–°å¢çš„å†…å®¹) æ–¹æ³•å°†ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ æ·»åŠ åˆ°æ•°ç»„çš„ å¼€å¤´ï¼Œå¹¶è¿”å›è¯¥ æ•°ç»„çš„æ–°é•¿åº¦ ç¤ºä¾‹ // è¯­æ³•arr.unshift(å…ƒç´ 1,...,å…ƒç´ n)// ç¤ºä¾‹let arr = [red, green]arr.unshift(pink, hot)console.log(arr) // [pink, hot,red, green] åˆ é™¤ pop ä½œç”¨ æ•°ç»„. pop() æ–¹æ³•ä»æ•°ç»„ä¸­åˆ é™¤ æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å› è¯¥å…ƒç´ çš„å€¼ ç¤ºä¾‹ // è¯­æ³•arr.pop()// ç¤ºä¾‹let arr = [red, green]arr.pop() // greenconsole.log(arr) // [red] shift ä½œç”¨ æ•°ç»„. shift() æ–¹æ³•ä»æ•°ç»„ä¸­åˆ é™¤ ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å› è¯¥å…ƒç´ çš„å€¼ ç¤ºä¾‹ // è¯­æ³•arr.shift()// ç¤ºä¾‹let arr = [red, green]arr.shift() // redconsole.log(arr) // [green] splice ä½œç”¨ æ•°ç»„. splice() æ–¹æ³• åˆ é™¤ æŒ‡å®šå…ƒç´  ç¤ºä¾‹ // è¯­æ³•arr.splice(start, deleteCount)arr.splice(èµ·å§‹ä½ç½®, åˆ é™¤å‡ ä¸ªå…ƒç´ )start èµ·å§‹ä½ç½®ï¼šæŒ‡å®šä¿®æ”¹çš„å¼€å§‹ä½ç½®ï¼ˆä»0è®¡æ•°ï¼‰deleteCountï¼š - è¡¨ç¤ºè¦ç§»é™¤çš„æ•°ç»„å…ƒç´ çš„ä¸ªæ•° - å¯é€‰çš„ã€‚ å¦‚æœçœç•¥åˆ™é»˜è®¤ä»æŒ‡å®šçš„èµ·å§‹ä½ç½®åˆ é™¤åˆ°æœ€å æ•°ç»„å¸¸ç”¨æ–¹æ³•map ä½œç”¨ map() å¯ä»¥å¤„ç†æ•°æ®ï¼Œå¹¶ä¸” è¿”å›æ–°çš„æ•°ç»„ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script const arr = [red, blue, green] // map æ–¹æ³•ä¹Ÿæ˜¯éå† å¤„ç†æ•°æ® å¯ä»¥è¿”å›ä¸€ä¸ªæ•°ç»„ const newArr = arr.map(function (item, i) // console.log(item) // æ•°ç»„å…ƒç´  red // console.log(i) // ä¸‹æ ‡ return item + è€å¸ˆ ) console.log(newArr) [redè€å¸ˆ, blueè€å¸ˆ, greenè€å¸ˆ] const arr1 = [10, 20, 30] const newArr1 = arr1.map(function (item) return item + 10 ) console.log(newArr1) /script/body/html join ä½œç”¨ join() æ–¹æ³•ç”¨äºæŠŠæ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ è½¬æ¢ä¸€ä¸ªå­—ç¬¦ä¸² å‚æ•° æ•°ç»„å…ƒç´ æ˜¯é€šè¿‡å‚æ•°é‡Œé¢æŒ‡å®šçš„åˆ†éš”ç¬¦è¿›è¡Œåˆ†éš”çš„ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody script const arr = [red, blue, green] // æŠŠæ•°ç»„å…ƒç´ è½¬æ¢ä¸ºå­—ç¬¦ä¸² console.log(arr.join(*)) /script/body/html filter ä½œç”¨ filter() æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œæ–°æ•°ç»„ä¸­çš„å…ƒç´ æ˜¯é€šè¿‡æ£€æŸ¥æŒ‡å®šæ•°ç»„ä¸­ ç¬¦åˆæ¡ä»¶ çš„æ‰€æœ‰å…ƒç´  ä½¿ç”¨åœºæ™¯ ç­›é€‰æ•°ç»„ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼Œå¹¶è¿”å›ç­›é€‰ä¹‹åå…ƒç´ çš„æ–°æ•°ç»„ è¯­æ³• è¢«éå†çš„æ•°ç»„.filter(function(currentValue, index)) return ç­›é€‰æ¡ä»¶ è¿”å›å€¼ è¿”å›æ•°ç»„ï¼ŒåŒ…å«äº†ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰å…ƒç´ ã€‚å¦‚æœæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„å…ƒç´ åˆ™è¿”å›ç©ºæ•°ç»„ å› ä¸ºè¿”å›æ–°æ•°ç»„ï¼Œæ‰€ä»¥ä¸ä¼šå½±å“åŸæ•°ç»„ å‚æ•° currentValue å¿…é¡»å†™ index å¯é€‰ ç¤ºä¾‹ è¢«éå†çš„æ•°ç»„.filter(function(currentValue, index)) return ç­›é€‰æ¡ä»¶const arr = [10, 20, 30]// const newArr = arr.filter(function (item, index) // // console.log(item)// // console.log(index)// return item = 20// )// è¿”å›çš„ç¬¦åˆæ¡ä»¶çš„æ–°æ•°ç»„const newArr = arr.filter(item = item = 20)console.log(newArr) å‡½æ•° functionï¼Œæ˜¯è¢«è®¾è®¡ä¸ºæ‰§è¡Œç‰¹å®šä»»åŠ¡çš„ä»£ç å— å‡½æ•°å¯ä»¥æŠŠå…·æœ‰ç›¸åŒæˆ–ç›¸ä¼¼é€»è¾‘çš„ä»£ç  â€œåŒ…è£¹â€ èµ·æ¥ï¼Œé€šè¿‡å‡½æ•°è°ƒç”¨æ‰§è¡Œè¿™äº›è¢« â€œåŒ…è£¹â€ çš„ä»£ç é€»è¾‘ï¼Œè¿™ä¹ˆåšçš„ä¼˜åŠ¿æ˜¯æœ‰åˆ©äº ç²¾ç®€ä»£ç æ–¹ä¾¿å¤ç”¨ æ¯”å¦‚æˆ‘ä»¬å‰é¢ä½¿ç”¨çš„ alert() ã€ prompt() å’Œ console.log() éƒ½æ˜¯ä¸€äº› js å‡½æ•°ï¼Œåªä¸è¿‡å·²ç»å°è£…å¥½äº†ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨çš„ å‡½æ•°ä½¿ç”¨ å£°æ˜ 1.å‡½æ•°å£°æ˜function å‡½æ•°å() å‡½æ•°ä½“ç¤ºä¾‹ï¼šfunction sayHi() document.write(hi) è°ƒç”¨ 2.å‡½æ•°çš„è°ƒç”¨å‡½æ•°å()ç¤ºä¾‹ï¼š// å‡½æ•°ä¸€æ¬¡å£°æ˜å¯ä»¥å¤šæ¬¡è°ƒç”¨ï¼Œæ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨å‡½æ•°ä½“é‡Œé¢çš„ä»£ç éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡sayHi()sayHi() å‡½æ•°ä½“å‡½æ•°ä½“æ˜¯å‡½æ•°çš„æ„æˆéƒ¨åˆ†ï¼Œå®ƒè´Ÿè´£å°†ç›¸åŒæˆ–ç›¸ä¼¼ä»£ç  â€œåŒ…è£¹â€ èµ·æ¥ï¼Œç›´åˆ°å‡½æ•°è°ƒç”¨æ—¶å‡½æ•°ä½“å†…çš„ä»£ç æ‰ä¼šè¢«æ‰§è¡Œã€‚å‡½æ•°çš„åŠŸèƒ½ä»£ç éƒ½è¦å†™åœ¨å‡½æ•°ä½“å½“ä¸­ å‡½æ•°ä¼ å‚ å£°æ˜ 1.å£°æ˜è¯­æ³•function å‡½æ•°å(å‚æ•°åˆ—è¡¨) å‡½æ•°ä½“ç¤ºä¾‹ï¼š- å•ä¸ªå‚æ•°function getSquare(num1) document.write(num1 * num1)- å¤šä¸ªå‚æ•°function getSquare(num1, num2) document.write(num1 * num2) è°ƒç”¨ 2.è°ƒç”¨è¯­æ³•å‡½æ•°å(ä¼ é€’çš„å‚æ•°åˆ—è¡¨)ç¤ºä¾‹ï¼šgetSquare(8)getSquare(10,20) å½¢å‚ï¼šå£°æ˜å‡½æ•° æ—¶å†™åœ¨å‡½æ•°åå³è¾¹å°æ‹¬å·é‡Œçš„å«å½¢å‚ï¼ˆå½¢å¼ä¸Šçš„å‚æ•°ï¼‰ å®å‚ï¼šè°ƒç”¨å‡½æ•° æ—¶å†™åœ¨å‡½æ•°åå³è¾¹å°æ‹¬å·é‡Œçš„å«å®å‚ï¼ˆå®é™…ä¸Šçš„å‚æ•°ï¼‰ å½¢å‚å¯ä»¥ç†è§£ä¸ºæ˜¯ åœ¨è¿™ä¸ªå‡½æ•°å†…å£°æ˜çš„ å˜é‡ï¼ˆæ¯”å¦‚ num1 10ï¼‰å®å‚å¯ä»¥ç†è§£ä¸ºæ˜¯ç»™è¿™ä¸ªå˜é‡èµ‹å€¼ å¼€å‘ä¸­å°½é‡ä¿æŒå½¢å‚å’Œå®å‚ä¸ªæ•°ä¸€è‡´ æˆ‘ä»¬æ›¾ç»ä½¿ç”¨è¿‡çš„ alert(â€˜æ‰“å°â€™), parseInt(â€˜11â€™), Number(â€˜11â€™) æœ¬è´¨ä¸Šéƒ½æ˜¯å‡½æ•°è°ƒç”¨çš„ä¼ å‚ å‚æ•°é»˜è®¤å€¼ 3.å‚æ•°é»˜è®¤å€¼å½¢å‚ï¼š å¯ä»¥çœ‹åšå˜é‡ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªå˜é‡ä¸ç»™å€¼ï¼Œé»˜è®¤æ˜¯ä»€ä¹ˆï¼Ÿ- undefinedä½†æ˜¯å¦‚æœåšç”¨æˆ·ä¸è¾“å…¥å®å‚ï¼Œåˆšæ‰çš„æ¡ˆä¾‹ï¼Œåˆ™å‡ºç° undefined + undefined ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ- NaNæˆ‘ä»¬å¯ä»¥æ”¹è¿›ä¸‹ï¼Œç”¨æˆ·ä¸è¾“å…¥å®å‚ï¼Œå¯ä»¥ç»™ å½¢å‚é»˜è®¤å€¼ï¼Œå¯ä»¥é»˜è®¤ä¸º 0, è¿™æ ·ç¨‹åºæ›´ä¸¥è°¨ï¼Œå¯ä»¥å¦‚ä¸‹æ“ä½œï¼šfunction getSum(x=0, y=0) document.write(x + y)getSum() // 0getSum(1, 2) // 3è¯´æ˜ï¼šè¿™ä¸ªé»˜è®¤å€¼åªä¼šåœ¨ç¼ºå°‘å®å‚å‚æ•°ä¼ é€’æ—¶ æ‰ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥æœ‰å‚æ•°ä¼šä¼˜å…ˆæ‰§è¡Œä¼ é€’è¿‡æ¥çš„å®å‚, å¦åˆ™é»˜è®¤ä¸ºundefined å‡½æ•°è¿”å›å€¼å½“å‡½æ•°éœ€è¦è¿”å›æ•°æ®å‡ºå»æ—¶ï¼Œç”¨ return å…³é”®å­—ã€‚ 1.è¯­æ³•return æ•°æ®ç¤ºä¾‹ï¼šfunction getSum(x=0, y=0) return x + ylet num = getSum(10, 30) åœ¨å‡½æ•°ä½“ä¸­ä½¿ç”¨ return å…³é”®å­—èƒ½å°†å†…éƒ¨çš„æ‰§è¡Œç»“æœäº¤ç»™å‡½æ•°å¤–éƒ¨ä½¿ç”¨ return åé¢ä»£ç ä¸ä¼šå†è¢«æ‰§è¡Œï¼Œä¼šç«‹å³ç»“æŸ å½“å‰å‡½æ•°ï¼Œæ‰€ä»¥ return åé¢çš„æ•°æ®ä¸è¦æ¢è¡Œå†™ returnå‡½æ•° å¯ä»¥æ²¡æœ‰ returnï¼Œè¿™ç§æƒ…å†µå‡½æ•°é»˜è®¤è¿”å›å€¼ä¸º undefined å‡½æ•°ç»†èŠ‚è¡¥å…… ä¸¤ä¸ªç›¸åŒçš„å‡½æ•°åé¢çš„ä¼šè¦†ç›–å‰é¢çš„å‡½æ•° åœ¨ JavaScript ä¸­ å®å‚çš„ä¸ªæ•°å’Œå½¢å‚çš„ä¸ªæ•°å¯ä»¥ä¸ä¸€è‡´ å¦‚æœå½¢å‚è¿‡å¤š ä¼šè‡ªåŠ¨å¡«ä¸Š undefined (äº†è§£å³å¯) å¦‚æœå®å‚è¿‡å¤š é‚£ä¹ˆå¤šä½™çš„å®å‚ä¼šè¢«å¿½ç•¥ (å‡½æ•°å†…éƒ¨æœ‰ä¸€ä¸ª arguments, é‡Œé¢è£…ç€æ‰€æœ‰çš„å®å‚) å‡½æ•°ä¸€æ—¦ç¢°åˆ° return å°±ä¸ä¼šåœ¨å¾€ä¸‹æ‰§è¡Œäº† å‡½æ•°çš„ç»“æŸç”¨ return ä½œç”¨åŸŸ æ¦‚è¿° é€šå¸¸æ¥è¯´ï¼Œä¸€æ®µç¨‹åºä»£ç ä¸­æ‰€ç”¨åˆ°çš„åå­—å¹¶ä¸æ€»æ˜¯æœ‰æ•ˆå’Œå¯ç”¨çš„ï¼Œè€Œé™å®šè¿™ä¸ªåå­—çš„ å¯ç”¨æ€§çš„ä»£ç èŒƒå›´ å°±æ˜¯è¿™ä¸ªåå­—çš„ ä½œç”¨åŸŸ å˜é‡çš„ä½œç”¨åŸŸ åˆ†ç±» å…¨å±€å˜é‡ å…¨å±€å˜é‡åœ¨ä»»ä½•åŒºåŸŸéƒ½å¯ä»¥è®¿é—®å’Œä¿®æ”¹ å±€éƒ¨å˜é‡ å±€éƒ¨å˜é‡åªèƒ½åœ¨å½“å‰å‡½æ•°å†…éƒ¨è®¿é—®å’Œä¿®æ”¹ å˜é‡æœ‰ä¸€ä¸ªå‘ï¼Œ ç‰¹æ®Šæƒ…å†µ å¦‚æœå‡½æ•°å†…éƒ¨ï¼Œå˜é‡æ²¡æœ‰å£°æ˜ï¼Œç›´æ¥èµ‹å€¼ï¼Œä¹Ÿå½“å…¨å±€å˜é‡çœ‹ï¼Œä½†æ˜¯å¼ºçƒˆä¸æ¨è ä½†æ˜¯æœ‰ä¸€ç§æƒ…å†µï¼Œå‡½æ•°å†…éƒ¨çš„å½¢å‚å¯ä»¥çœ‹åšæ˜¯å±€éƒ¨å˜é‡ ç¤ºä¾‹ script // 1. å…¨å±€å˜é‡ å…¨å±€èƒ½ç”¨ // let num = 10 // console.log(num) // function fn() // console.log(num) // // fn() // if (true) // console.log(num) // // 2. åœ¨å±€éƒ¨ä½œç”¨åŸŸä¸‹ï¼Œå˜é‡æ˜¯ å±€éƒ¨å˜é‡ // å‡½æ•°å†…çš„å˜é‡ï¼Œåªèƒ½ç»™å†…éƒ¨ä½¿ç”¨ï¼Œå‡½æ•°å¤–é¢ä¸èƒ½ä½¿ç”¨ // function fn() // let num = 10 // console.log(num) // function fn1() // console.log(num) // let num2 = 20 // // fn1() // // console.log(num2) num2 is not defined // // fn() // console.log(num) num is not defined // 3. å—çº§å˜é‡ // if (true) // let num = 10 // // // console.log(num) // for (let i = 0; i 5; i++) // console.log(i) // // console.log(i) // function fn() // // let num = 10 // num = 10 // // fn() // if (true) // num = 10 // // console.log(num) // function fn(x, y) // // x å’Œ y å¯ä»¥çœ‹åšæ˜¯ å±€éƒ¨å˜é‡ // document.write(x + y) // // fn(1, 2) // console.log(x) é”™è¯¯äº† let num = 10 function fn() let i = 0 console.log(i); fn() if (true) let j = 0 /script å˜é‡è®¿é—®åŸåˆ™-ä½œç”¨åŸŸé“¾ åªè¦æ˜¯ä»£ç ï¼Œå°±è‡³å°‘æœ‰ä¸€ä¸ªä½œç”¨åŸŸå†™åœ¨å‡½æ•°å†…éƒ¨çš„å±€éƒ¨ä½œç”¨åŸŸã€‚å¦‚æœå‡½æ•°ä¸­è¿˜æœ‰å‡½æ•°ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªä½œç”¨åŸŸä¸­å°±åˆå¯ä»¥è¯ç”Ÿä¸€ä¸ªä½œç”¨åŸŸã€‚ æ ¹æ®åœ¨å†…éƒ¨å‡½æ•°å¯ä»¥è®¿é—®å¤–éƒ¨å‡½æ•°å˜é‡çš„è¿™ç§æœºåˆ¶ï¼Œç”¨é“¾å¼æŸ¥æ‰¾å†³å®šå“ªäº›æ•°æ®èƒ½è¢«å†…éƒ¨å‡½æ•°è®¿é—®ï¼Œå°±ç§°ä½œ ä½œç”¨åŸŸé“¾ é‡‡å– å°±è¿‘åŸåˆ™ çš„æ–¹å¼æ¥æŸ¥æ‰¾å˜é‡æœ€ç»ˆçš„å€¼ ç¤ºä¾‹ script let a = 1 function fn1() let a = 2 let b = 22 fn2() function fn2() let a = 3 fn3() function fn3() let a = 4 console.log(a) // 4 console.log(b) // 22 let b = 33 fn1()/script åŒ¿åå‡½æ•°æ¦‚å¿µï¼šæ²¡æœ‰åå­—çš„å‡½æ•°, æ— æ³•ç›´æ¥ä½¿ç”¨ å‡½æ•°è¡¨è¾¾å¼ æ¦‚å¿µ å°†åŒ¿åå‡½æ•°èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œå¹¶ä¸”é€šè¿‡å˜é‡åç§°è¿›è¡Œè°ƒç”¨ æˆ‘ä»¬å°†è¿™ä¸ªç§°ä¸ºå‡½æ•°è¡¨è¾¾å¼ è¯­æ³• // è¯­æ³•let fn = function() å‡½æ•°ä½“ ç¤ºä¾‹ script let num = 10 // å‡½æ•°è¡¨è¾¾å¼ let fn = function () console.log(111) fn() // let fn = function (x, y) // console.log(x + y) // // fn(1, 2) let btn = document.querySelector(button) // btn.onclick = function () // alert(æœˆè–ªè¿‡ä¸‡) // btn.addEventListener(click, function () alert(æœˆè–ªè¿‡10ä¸‡) )/script ç«‹å³æ‰§è¡Œå‡½æ•° ä½œç”¨ é¿å…å…¨å±€å˜é‡ä¹‹é—´çš„æ±¡æŸ“ è¯­æ³• // æ–¹å¼1(function () console.log(11) )();// æ–¹å¼2(function () console.log(11) ()); ä¸éœ€è¦è°ƒç”¨ï¼Œç«‹å³æ‰§è¡Œ å¤šä¸ªç«‹å³æ‰§è¡Œå‡½æ•°è¦ç”¨ ; éš”å¼€ï¼Œè¦ä¸ç„¶ä¼šæŠ¥é”™ ç¤ºä¾‹ script // ç«‹å³æ‰§è¡Œå‡½æ•° ç«‹å³æ‰§è¡Œï¼Œ æ— éœ€è°ƒç”¨ // let fn = function() // fn() // 1 ç¬¬ä¸€ä¸ªå°æ‹¬å·æ”¾çš„ å½¢å‚ ç¬¬äºŒä¸ªå°æ‹¬å·æ”¾çš„æ˜¯å®å‚ // (function () // console.log(111) // )() // (function (x, y) // console.log(x + y) // )(1, 2) // let num = 10 // (function () // // é˜²æ­¢å˜é‡æ±¡æŸ“ // let num = 20 // )() // (function () // console.log(111) // ()) // (function fn() // console.log(111) // ()) // let num = 10 // let num = 20 (function () console.log(111) )(); let num = 10 ; (function () console.log(222) )()/script å¯¹è±¡å¯¹è±¡æ˜¯ä»€ä¹ˆ å¯¹è±¡ï¼ˆobjectï¼‰ï¼šJavaScript é‡Œçš„ä¸€ç§æ•°æ®ç±»å‹ å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ç§æ— åºçš„æ•°æ®é›†åˆï¼Œ æ³¨æ„æ•°ç»„æ˜¯æœ‰åºçš„æ•°æ®é›†åˆ ç”¨æ¥æè¿°æŸä¸ªäº‹ç‰©ï¼Œä¾‹å¦‚æè¿°ä¸€ä¸ªäºº äººæœ‰å§“åã€å¹´é¾„ã€æ€§åˆ«ç­‰ä¿¡æ¯ã€è¿˜æœ‰åƒé¥­ç¡è§‰æ‰“ä»£ç ç­‰åŠŸèƒ½ å¦‚æœç”¨å¤šä¸ªå˜é‡ä¿å­˜åˆ™æ¯”è¾ƒæ•£ï¼Œç”¨å¯¹è±¡æ¯”è¾ƒç»Ÿä¸€ æ¯”å¦‚æè¿° ç­ä¸»ä»» ä¿¡æ¯ é™æ€ç‰¹å¾ (å§“å, å¹´é¾„, èº«é«˜, æ€§åˆ«, çˆ±å¥½) å¯ä»¥ä½¿ç”¨æ•°å­—, å­—ç¬¦ä¸², æ•°ç»„, å¸ƒå°”ç±»å‹ç­‰è¡¨ç¤º åŠ¨æ€è¡Œä¸º (ç‚¹å, å”±, è·³, rap) ä½¿ç”¨å‡½æ•°è¡¨ç¤º å¯¹è±¡ä½¿ç”¨å£°æ˜è¯­æ³• è¯­æ³• let å¯¹è±¡å = // å®šä¹‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼ˆç±»ï¼‰function Person(name, age) this.name = name; this.age = age; æ³¨æ„äº‹é¡¹ï¼šå¦‚æœæ„é€ å‡½æ•°æ²¡æœ‰é€šè¿‡ return è¯­å¥æ˜¾å¼è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆ new æ“ä½œç¬¦ä¼šéšå¼è¿”å› this å¯¹è±¡ã€‚å¦‚æœæ„é€ å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ç±»å‹ï¼Œé‚£ä¹ˆ new å°†è¿”å›è¿™ä¸ªå¯¹è±¡ï¼Œè€Œä¸æ˜¯ thisã€‚ function TestObject() {this.name â€œDefaultâ€;return { name: â€œOverrideâ€ }; è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡} let test1 new TestObject();console.log(test1.name); è¾“å‡º: Overrideï¼Œä¸æ˜¯ Default ç®­å¤´å‡½æ•°ä¸èƒ½ä½œä¸ºæ„é€ å‡½æ•°ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰è‡ªå·±çš„ thisï¼Œå› æ­¤ä¸èƒ½ä¸ new ä¸€èµ·ä½¿ç”¨const ArrowFunc () {this.name â€œArrowâ€;};let arrowObj new ArrowFunc(); è¿™ä¼šæŠ›å‡º TypeError: ArrowFunc is not a constructor ç¤ºä¾‹ // å£°æ˜äººå¯¹è±¡let person = uname: åˆ˜å¾·å, age: 18, sex: ç”·, // æ–¹æ³•åï¼šfunction() sayHi: function () console.log(hi~~~) , mtv: function (s) console.log(s) // ä½¿ç”¨ new åˆ›å»º Person çš„å®ä¾‹let person1 = new Person(Alice, 30);console.log(person1.name); // è¾“å‡º: Aliceconsole.log(person1.age); // è¾“å‡º: 30 å¯¹è±¡ç»„æˆ å±æ€§ ä¿¡æ¯æˆ–å«ç‰¹å¾ï¼ˆåè¯ï¼‰ã€‚ æ¯”å¦‚ æ‰‹æœºå°ºå¯¸ã€é¢œè‰²ã€é‡é‡ç­‰â€¦ æ–¹æ³• åŠŸèƒ½æˆ–å«è¡Œä¸ºï¼ˆåŠ¨è¯ï¼‰ã€‚ æ¯”å¦‚ æ‰‹æœºæ‰“ç”µè¯ã€å‘çŸ­ä¿¡ã€ç©æ¸¸æˆâ€¦ ç¤ºä¾‹ let å¯¹è±¡å = å±æ€§åï¼šå±æ€§å€¼, æ–¹æ³•åï¼šå‡½æ•°// å¯¹è±¡æ˜¯æœ‰å±æ€§å’Œæ–¹æ³•ç»„æˆçš„ï¼Œé‚£ä¹ˆå±æ€§å’Œæ–¹æ³•éƒ½è¦å†™åœ¨å¯¹è±¡é‡Œé¢let ldh = // å±æ€§ uname: åˆ˜å¾·å, // æ–¹æ³• æ–¹æ³•å: function() sing: function () console.log(å”±æ­Œ) , dance: function (s) console.log(s) å±æ€§ æ¦‚å¿µ æ•°æ®æè¿°æ€§çš„ä¿¡æ¯ç§°ä¸ºå±æ€§ï¼Œå¦‚äººçš„å§“åã€èº«é«˜ã€å¹´é¾„ã€æ€§åˆ«ç­‰ï¼Œä¸€èˆ¬æ˜¯åè¯æ€§çš„ã€‚ ç¤ºä¾‹ let obj = user-name: pink, age: 18, gender: ç”· å±æ€§éƒ½æ˜¯æˆå¯¹å‡ºç°çš„ï¼ŒåŒ…æ‹¬å±æ€§åå’Œå€¼ï¼Œå®ƒä»¬ä¹‹é—´ä½¿ç”¨è‹±æ–‡ : åˆ†éš” å¤šä¸ªå±æ€§ä¹‹é—´ä½¿ç”¨è‹±æ–‡ , åˆ†éš” å±æ€§å°±æ˜¯ä¾é™„åœ¨å¯¹è±¡ä¸Šçš„å˜é‡ï¼ˆå¤–é¢æ˜¯å˜é‡ï¼Œå¯¹è±¡å†…æ˜¯å±æ€§ï¼‰ å±æ€§åå¯ä»¥ä½¿ç”¨ æˆ– ï¼Œä¸€èˆ¬æƒ…å†µä¸‹çœç•¥ï¼Œé™¤éåç§°é‡åˆ°ç‰¹æ®Šç¬¦å·å¦‚ç©ºæ ¼ã€ä¸­æ¨ªçº¿ç­‰ å±æ€§æ“ä½œ å¯¹è±¡æœ¬è´¨æ˜¯æ— åºçš„æ•°æ®é›†åˆ, æ“ä½œæ•°æ®æ— éå°±æ˜¯ å¢ åˆ  æ”¹ æŸ¥ è¯­æ³• æŸ¥ å£°æ˜å¯¹è±¡ï¼Œå¹¶æ·»åŠ äº†è‹¥å¹²å±æ€§åï¼Œå¯ä»¥ä½¿ç”¨ . è·å¾—å¯¹è±¡ä¸­å±æ€§å¯¹åº”çš„å€¼ï¼Œç§°ä¹‹ä¸ºå±æ€§è®¿é—®ã€‚ è¯­æ³•ï¼šå¯¹è±¡å.å±æ€§ let obj = uname: pink, age: 18, gender: ç”·console.log(person.uname)console.log(person.age)console.log(person.gender)let obj = user-name: pink, age: 18, gender: ç”·console.log(person.user-name) // NaNå¯¹äºå¤šè¯å±æ€§æˆ–è€… - ç­‰å±æ€§ï¼Œç‚¹æ“ä½œå°±ä¸èƒ½ç”¨äº†ã€‚console.log(person[user-name]) // pink æ²¡æœ‰å¿…è¦çš„æ—¶å€™ç›´æ¥ä½¿ç”¨ç‚¹è¯­æ³•, åœ¨éœ€è¦è§£æå˜é‡çš„æ—¶å€™ä½¿ç”¨ [] è¯­æ³• æ”¹ è¯­æ³•ï¼šå¯¹è±¡å.å±æ€§ = æ–°å€¼ let obj = uname: pink, age: 18, gender: ç”·person.gender = å¥³console.log(person.uname)console.log(person.age)console.log(person.gender) // å¥³ å¢ è¯­æ³•ï¼šå¯¹è±¡å.æ–°å±æ€§ = æ–°å€¼ let obj = uname: pink, age: 18, gender: ç”·person.address = æ·±åœ³console.log(person.uname)console.log(person.age)console.log(person.address) // æ·±åœ³ åˆ  è¯­æ³•ï¼šdelete å¯¹è±¡å.å±æ€§ let obj = uname: pink, age: 18, gender: ç”·delete person.genderconsole.log(person.uname)console.log(person.age) å¯¹è±¡ä¸­çš„æ–¹æ³• æ¦‚å¿µ æ•°æ®è¡Œä¸ºæ€§çš„ä¿¡æ¯ç§°ä¸ºæ–¹æ³•ã€‚å¦‚è·‘æ­¥ã€å”±æ­Œç­‰ï¼Œä¸€èˆ¬æ˜¯åŠ¨è¯æ€§çš„ï¼Œå…¶æœ¬è´¨æ˜¯å‡½æ•° ç¤ºä¾‹ let person = name: andy, sayHi: function() alert(hi) // è°ƒç”¨person.sayHi()// åŠ¨æ€æ–°å¢æ–¹æ³•person.move = function() alert(ç§»åŠ¨) æ–¹æ³•æ˜¯ç”±æ–¹æ³•åå’Œå‡½æ•°ä¸¤éƒ¨åˆ†æ„æˆï¼Œå®ƒä»¬ä¹‹é—´ä½¿ç”¨ : åˆ†éš” å¤šä¸ªå±æ€§ä¹‹é—´ä½¿ç”¨è‹±æ–‡ , åˆ†éš” æ–¹æ³•æ˜¯ä¾é™„åœ¨å¯¹è±¡ä¸­çš„å‡½æ•° éå†å¯¹è±¡ for éå†å¯¹è±¡çš„é—®é¢˜ å¯¹è±¡æ²¡æœ‰åƒæ•°ç»„ä¸€æ ·çš„ length å±æ€§, æ‰€ä»¥æ— æ³•ç¡®å®šé•¿åº¦ å¯¹è±¡é‡Œé¢æ˜¯æ— åºçš„é”®å€¼å¯¹, æ²¡æœ‰è§„å¾‹. ä¸åƒæ•°ç»„é‡Œé¢æœ‰è§„å¾‹çš„ä¸‹æ ‡ éå†å¯¹è±¡ let obj = uname: andy, age: 18, sex: ç”·for(let k in obj) console.log(k) // å±æ€§å console.log(obj[k]) // æ‰“å°å±æ€§å€¼ ä¸€èˆ¬ä¸ç”¨è¿™ç§æ–¹å¼éå†æ•°ç»„ã€ä¸»è¦æ˜¯ç”¨æ¥éå†å¯¹è±¡ for in è¯­æ³•ä¸­çš„ k æ˜¯ä¸€ä¸ªå˜é‡, åœ¨å¾ªç¯çš„è¿‡ç¨‹ä¸­ä¾æ¬¡ä»£è¡¨å¯¹è±¡çš„å±æ€§å ç”±äº k æ˜¯å˜é‡, æ‰€ä»¥å¿…é¡»ä½¿ç”¨ [ ] è¯­æ³•è§£æ ä¸€å®šè®°ä½ï¼š k æ˜¯è·å¾—å¯¹è±¡çš„ å±æ€§åï¼Œ å¯¹è±¡å[k] æ˜¯è·å¾— å±æ€§å€¼ éå†æ•°ç»„å¯¹è±¡ script let students = [ name: å°æ˜, age: 18, gender: ç”·, hometown: æ²³åŒ—çœ , name: å°çº¢, age: 19, gender: å¥³, hometown: æ²³å—çœ , name: å°åˆš, age: 17, gender: ç”·, hometown: å±±è¥¿çœ , name: å°ä¸½, age: 18, gender: å¥³, hometown: å±±ä¸œçœ ] for (let i = 0; i students.length; i++) // console.log(i) // ä¸‹æ ‡ç´¢å¼•å· // console.log(students[i]) // æ¯ä¸ªå¯¹è±¡ console.log(students[i].name) console.log(students[i].hometown) /script å†…ç½®å¯¹è±¡JavaScript å†…éƒ¨æä¾›çš„å¯¹è±¡ï¼ŒåŒ…å«å„ç§å±æ€§å’Œæ–¹æ³•ç»™å¼€å‘è€…è°ƒç”¨ å†…ç½®å¯¹è±¡ Math æ¦‚å¿µ Math å¯¹è±¡æ˜¯ JavaScript æä¾›çš„ä¸€ä¸ª æ•°å­¦ å¯¹è±¡ ä½œç”¨ æä¾›äº†ä¸€ç³»åˆ—åšæ•°å­¦è¿ç®—çš„æ–¹æ³• åŒ…å«æ–¹æ³• randomï¼šç”Ÿæˆ0-1ä¹‹é—´çš„éšæœºæ•°ï¼ˆåŒ…å«0ä¸åŒ…æ‹¬1ï¼‰ceilï¼šå‘ä¸Šå–æ•´floorï¼šå‘ä¸‹å–æ•´maxï¼šæ‰¾æœ€å¤§æ•°minï¼šæ‰¾æœ€å°æ•°powï¼šå¹‚è¿ç®—absï¼šç»å¯¹å€¼ ç¤ºä¾‹ script // å±æ€§ console.log(Math.PI) // æ–¹æ³• // ceil å¤©èŠ±æ¿ å‘ä¸Šå–æ•´ console.log(Math.ceil(1.1)) // 2 console.log(Math.ceil(1.5)) // 2 console.log(Math.ceil(1.9)) // 2 // floor åœ°æ¿ å‘ä¸‹å–æ•´ console.log(Math.floor(1.1)) // 1 console.log(Math.floor(1.5)) // 1 console.log(Math.floor(1.9)) // 1 console.log(Math.floor(12px)) // 1 console.log(----------------) // å››èˆäº”å…¥ round console.log(Math.round(1.1)) // 1 console.log(Math.round(1.49)) // 1 console.log(Math.round(1.5)) // 2 console.log(Math.round(1.9)) // 2 console.log(Math.round(-1.1)) // -1 console.log(Math.round(-1.5)) // -1 console.log(Math.round(-1.51)) // -2 // å–æ•´å‡½æ•° parseInt(1.2) // 1 // å–æ•´å‡½æ•° parseInt(12px) // 12 console.log(Math.max(1, 2, 3, 4, 5)) console.log(Math.min(1, 2, 3, 4, 5)) console.log(Math.abs(-1)); // null ç±»ä¼¼ let obj = let obj = null /script","tags":["JavaScript"],"categories":["å‰ç«¯"]},{"title":"MyBatisï¼ˆä¸€ï¼‰é…ç½®è§£æ","path":"/2023/11/30/2023-11-30-MyBatisï¼ˆä¸€ï¼‰é…ç½®è§£æ/","content":"ä¼ ç»Ÿæ•°æ®åº“è¯»å–æ–¹å¼ è¿æ¥ MySQL æ•°æ®åº“çš„ä¼ ç»Ÿæ–¹å¼é€šå¸¸æ¶‰åŠä½¿ç”¨ JDBCï¼ˆJava Database Connectivityï¼‰ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„æ­¥éª¤ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Java å’Œ JDBC è¿æ¥åˆ° MySQL æ•°æ®åº“ åŠ è½½ JDBC é©±åŠ¨ç¨‹åº åœ¨è¿æ¥åˆ°æ•°æ®åº“ä¹‹å‰ï¼Œä½ éœ€è¦åŠ è½½ç›¸åº”çš„ JDBC é©±åŠ¨ç¨‹åºã€‚å¯¹äº MySQLï¼Œé€šå¸¸ä½¿ç”¨ com.mysql.cj.jdbc.Driver é©±åŠ¨ç¨‹åºã€‚ Class.forName(com.mysql.cj.jdbc.Driver); åˆ›å»ºæ•°æ®åº“è¿æ¥ä½¿ç”¨ DriverManager.getConnection æ–¹æ³•åˆ›å»ºä¸ MySQL æ•°æ®åº“çš„è¿æ¥ã€‚éœ€è¦æä¾›æ•°æ®åº“çš„ URLã€ç”¨æˆ·åå’Œå¯†ç  String url = jdbc:mysql://localhost:3306/your_database;String username = your_username;String password = your_password;Connection connection = DriverManager.getConnection(url, username, password); åˆ›å»º Statement å¯¹è±¡ ä½¿ç”¨ connection.createStatement() æ–¹æ³•åˆ›å»ºä¸€ä¸ª Statement å¯¹è±¡ï¼Œç”¨äºæ‰§è¡Œ SQL æŸ¥è¯¢å’Œæ›´æ–° Statement statement = connection.createStatement(); æ‰§è¡Œ SQL æŸ¥è¯¢ä½¿ç”¨ Statement å¯¹è±¡æ‰§è¡Œ SQL æŸ¥è¯¢ï¼Œå¹¶è·å–ç»“æœé›† String sqlQuery = SELECT * FROM your_table;ResultSet resultSet = statement.executeQuery(sqlQuery); å¤„ç†ç»“æœé›†éå†ç»“æœé›†å¹¶å¤„ç†æ£€ç´¢åˆ°çš„æ•°æ® åœ¨è¿™é‡Œï¼Œcolumn1 æ˜¯è¡¨ä¸­çš„åˆ—å while (resultSet.next()) // å¤„ç†æ¯ä¸€è¡Œçš„æ•°æ® String column1Value = resultSet.getString(column1); // å…¶ä»–åˆ—çš„å¤„ç†... å…³é—­è¿æ¥æœ€åï¼Œä¸è¦å¿˜è®°å…³é—­è¿æ¥ï¼Œä»¥é‡Šæ”¾èµ„æº resultSet.close();statement.close();connection.close(); å®Œæ•´çš„ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤º package com.github.lianyutian.mybatisdemo;import com.github.lianyutian.mybatisdemo.model.User;import org.junit.jupiter.api.Test;import java.sql.*;import java.util.ArrayList;import java.util.List;public class DemoTest @Test public void testQuery() throws Exception String url = jdbc:mysql://127.0.0.1:3306/mybatis?serverTimezone=UTC; String userName = root; String password = 123456; User userParam = new User(); userParam.setId(1); // ç¬¬ä¸€æ­¥ï¼šåŠ è½½é©±åŠ¨ç¨‹åº Class.forName(com.mysql.cj.jdbc.Driver); // ç¬¬äºŒæ­¥ï¼šè·å¾—æ•°æ®åº“çš„è¿æ¥ Connection conn = DriverManager.getConnection(url, userName, password); // ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºè¯­å¥å¹¶æ‰§è¡Œ Statement stmt = conn.createStatement(); ResultSet resultSet = stmt.executeQuery(SELECT * FROM `user` WHERE id = \\ + userParam.getId() + \\;); // ç¬¬å››æ­¥ï¼šå¤„ç†æ•°æ®åº“æ“ä½œç»“æœ ListUser userList = new ArrayList(); while (resultSet.next()) User user = new User(); user.setId(resultSet.getInt(id)); user.setName(resultSet.getString(name)); user.setEmail(resultSet.getString(email)); user.setAge(resultSet.getInt(age)); user.setSex(resultSet.getInt(sex)); user.setSchoolName(resultSet.getString(schoolName)); userList.add(user); // ç¬¬äº”æ­¥ï¼šå…³é—­è¿æ¥ stmt.close(); for (User user : userList) System.out.println(name : + user.getName() + ; email : + user.getEmail()); @Test public void testInsert() String url = jdbc:mysql://127.0.0.1:3306/mybatis?serverTimezone=UTC; String userName = root; String password = 123456; // SQL æ’å…¥è¯­å¥ String insertSql = INSERT INTO mybatis.user (name, email, age, sex, schoolName) VALUES (?, ?, ?, ?, ?); // è®¾ç½®æ˜¯å¦è‡ªåŠ¨æäº¤äº‹åŠ¡ä¸º false try (Connection connection = DriverManager.getConnection(url, userName, password)) connection.setAutoCommit(false); try (PreparedStatement preparedStatement = connection.prepareStatement(insertSql)) // è®¾ç½®å‚æ•° preparedStatement.setString(1, æå››); preparedStatement.setString(2, 321@qq.com); preparedStatement.setInt(3, 18); preparedStatement.setInt(4, 1); preparedStatement.setString(5, åŒ—äº¬å¤§å­¦); // æ‰§è¡Œæ’å…¥æ“ä½œ int rowsAffected = preparedStatement.executeUpdate(); if (rowsAffected 0) System.out.println(Data inserted successfully!); else System.out.println(Insert failed.); // æäº¤äº‹åŠ¡ connection.commit(); catch (SQLException e) // å›æ»šäº‹åŠ¡ connection.rollback(); e.printStackTrace(); catch (SQLException e) e.printStackTrace(); MyBatisä»‹ç»MyBatisç®€ä»‹MyBatis æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æŒä¹…å±‚æ¡†æ¶ï¼Œå®ƒæ”¯æŒè‡ªå®šä¹‰ SQLã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„ã€‚MyBatis å…é™¤äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç ä»¥åŠè®¾ç½®å‚æ•°å’Œè·å–ç»“æœé›†çš„å·¥ä½œã€‚MyBatis å¯ä»¥é€šè¿‡ç®€å•çš„ XML æˆ–æ³¨è§£æ¥é…ç½®å’Œæ˜ å°„åŸå§‹ç±»å‹ã€æ¥å£å’Œ Java POJOï¼ˆPlain Old Java Objectsï¼Œæ™®é€šè€å¼ Java å¯¹è±¡ï¼‰ä¸ºæ•°æ®åº“ä¸­çš„è®°å½•ã€‚ MyBatisåŸºç¡€ä½¿ç”¨ å¼•å…¥ MyBatis ä¾èµ–é¦–å…ˆåœ¨é¡¹ç›®ä¸­å¼•å…¥ MyBatis çš„ä¾èµ– dependency groupIdorg.mybatis/groupId artifactIdmybatis/artifactId version3.5.13/version/dependency é…ç½® MyBatis æ•°æ®æº(xmlæ–¹å¼ï¼‰ !-- mybatis-config.xml --!DOCTYPE configuration PUBLIC -//mybatis.org//DTD Config 3.0//EN http://mybatis.org/dtd/mybatis-3-config.dtdconfiguration environments default=development environment id=development transactionManager type=JDBC/ dataSource type=POOLED property name=driver value=com.mysql.cj.jdbc.Driver/ property name=url value=jdbc:mysql://localhost:3306/mybatis/ property name=username value=root/ property name=password value=123456/ /dataSource /environment /environments !-- é…ç½®Mapperæ‰«æ -- mappers mapper resource=com/github/lianyutian/mybatisdemo/UserMapper.xml/ /mappers/configuration åˆ›å»ºæ•°æ®æ¨¡å‹ï¼ˆPOJOï¼‰ä¸ XML é…ç½®æ–¹å¼ç›¸åŒï¼Œåˆ›å»ºç”¨äºæ˜ å°„æ•°æ®åº“è¡¨çš„ Java ç±» package com.github.lianyutian.mybatisdemo;import lombok.Getter;import lombok.Setter;@Getter@Setterpublic class User private Integer id; private String name; private String email; private Integer age; private Integer sex; private String schoolName; åˆ›å»º MyBatis æ¥å£åˆ›å»ºä¸€ä¸ª Mapper æ¥å£ï¼Œç”¨äºå®šä¹‰ SQL æŸ¥è¯¢ã€æ’å…¥ã€æ›´æ–°ç­‰æ“ä½œ package com.github.lianyutian.mybatisdemo;import java.util.List;public interface UserMapper ListUser queryUserBySchoolName(String schoolName); åˆ›å»º MyBatis æ˜ å°„æ–‡ä»¶ ä¸ºæ¯ä¸ªæ•°æ®æ¨¡å‹åˆ›å»ºä¸€ä¸ª MyBatis æ˜ å°„æ–‡ä»¶ï¼Œå…¶ä¸­å®šä¹‰äº† SQL æŸ¥è¯¢ã€æ’å…¥ã€æ›´æ–°ç­‰æ“ä½œ ?xml version=1.0 encoding=UTF-8 ?!DOCTYPE mapper PUBLIC -//mybatis.org//DTD Mapper 3.0//EN http://mybatis.org/dtd/mybatis-3-mapper.dtdmapper namespace=com.github.lianyutian.mybatisdemo.UserMapper select id=queryUserBySchoolName parameterType=java.lang.String resultType=com.github.lianyutian.mybatisdemo.User SELECT * FROM `user` if test=schoolName != null WHERE schoolName = #schoolName /if /select/mapper åœ¨è¿™é‡Œï¼Œcom.github.lianyutian.mybatisdemo.UserMapper æ˜¯å¯¹åº”çš„ Java æ¥å£ ä½¿ç”¨ MyBatis æ“ä½œæ•°æ®åº“åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ MyBatis è¿›è¡Œæ•°æ®åº“æ“ä½œ package com.github.lianyutian.mybatisdemo;import org.apache.ibatis.io.Resources;import org.apache.ibatis.session.SqlSession;import org.apache.ibatis.session.SqlSessionFactory;import org.apache.ibatis.session.SqlSessionFactoryBuilder;import org.junit.jupiter.api.Test;import java.io.IOException;import java.io.InputStream;import java.util.List;/** * @author : [lm] * @version : [v1.0] * @createTime : [2023/11/30 20:54] */public class MyBatisDemoTest @Test public void test() throws IOException // è¯»å– MyBatis é…ç½®æ–‡ä»¶ InputStream inputStream = Resources.getResourceAsStream(mybatis-config.xml); SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); // æ‰“å¼€ä¸€ä¸ª SqlSession try (SqlSession sqlSession = sqlSessionFactory.openSession()) // è·å– Mapper UserMapper userMapper = sqlSession.getMapper(UserMapper.class); User user = new User(); user.setSchoolName(æ¸…åå¤§å­¦); // è°ƒç”¨ Mapper ä¸­çš„æ–¹æ³• ListUser users = userMapper.queryUserBySchoolName(user.getSchoolName()); // å¤„ç†æŸ¥è¯¢ç»“æœ for (User user1 : users) System.out.println(user1.getName() + : + user1.getSchoolName()); è§£æmybatis-config.xml MyBatisæ€ä¹ˆè·å–åˆ°æ•°æ®æºçš„ï¼Ÿ Mapper.javaå¦‚ä½•å’ŒMapper.xmlå…³è”ï¼Ÿ è¯»å–mybatis-config.xmlè¯»å–mybatis-config.xmlæ–‡ä»¶ï¼Œå½¢æˆInputStream // ç¬¬ä¸€é˜¶æ®µï¼šMyBatisåˆå§‹åŒ–é˜¶æ®µ// è¯»å– MyBatis é…ç½®æ–‡ä»¶InputStream inputStream = Resources.getResourceAsStream(mybatis-config.xml);SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); è§£æmybatis-config.xmlè§£æinputStreamä½¿ç”¨ XMLConfigBuilder è§£æ inputStream public SqlSessionFactory build(InputStream inputStream) try // ä½¿ç”¨ XMLConfigBuilder è§£æ inputStream XMLConfigBuilder parser = new XMLConfigBuilder(inputStream); return build(parser.parse()); catch (Exception e) throw ExceptionFactory.wrapException(Error building SqlSession., e); finally ... è§£æ configuration èŠ‚ç‚¹ æ‰§è¡Œ parse() æ–¹æ³•ä» configurationèŠ‚ç‚¹ å¼€å§‹è§£æ xml public Configuration parse() if (parsed) throw new BuilderException(Each XMLConfigBuilder can only be used once.); parsed = true; // ä» configuration å¼€å§‹è§£æ xml parseConfiguration(parser.evalNode(/configuration)); return configuration; configuration environments default=development environment id=development transactionManager type=JDBC/ dataSource type=POOLED property name=driver value=com.mysql.cj.jdbc.Driver/ property name=url value=jdbc:mysql://localhost:3306/mybatis/ property name=username value=root/ property name=password value=123456/ /dataSource /environment /environments !-- é…ç½®Mapperæ‰«æ -- mappers mapper resource=com/github/lianyutian/mybatisdemo/UserMapper.xml/ /mappers/configuration è®¾ç½® configuration å¯¹è±¡è¿™é‡Œè§£æ mybatis-config.xml ä¸­ä» configuration èŠ‚ç‚¹å¼€å§‹çš„å„ä¸ªèŠ‚ç‚¹çš„é…ç½® ä»è¿›å…¥å„ä¸ªå­æ–¹æ³•å¯ä»¥å‘ç°ä» mybatis-config.xmlè§£æçš„æ•°æ®éƒ½å­˜å…¥åˆ°äº† Configurationå¯¹è±¡ä¸­ï¼Œè¿™ä¸ªå¯¹è±¡éå¸¸é‡è¦ï¼ private void parseConfiguration(XNode root) try // issue #117 read properties first propertiesElement(root.evalNode(properties)); Properties settings = settingsAsProperties(root.evalNode(settings)); loadCustomVfs(settings); loadCustomLogImpl(settings); typeAliasesElement(root.evalNode(typeAliases)); pluginElement(root.evalNode(plugins)); objectFactoryElement(root.evalNode(objectFactory)); objectWrapperFactoryElement(root.evalNode(objectWrapperFactory)); reflectorFactoryElement(root.evalNode(reflectorFactory)); settingsElement(settings); // read it after objectFactory and objectWrapperFactory issue #631 // è§£ææ•°æ®æº environmentsElement(root.evalNode(environments)); databaseIdProviderElement(root.evalNode(databaseIdProvider)); typeHandlerElement(root.evalNode(typeHandlers)); // è§£æmapper mapperElement(root.evalNode(mappers)); catch (Exception e) throw new BuilderException(Error parsing SQL Mapper Configuration. Cause: + e, e); è§£ææ•°æ®æºè§£ææ•°æ®æº private void environmentsElement(XNode context) throws Exception if (context != null) if (environment == null) environment = context.getStringAttribute(default); for (XNode child : context.getChildren()) String id = child.getStringAttribute(id); if (isSpecifiedEnvironment(id)) TransactionFactory txFactory = transactionManagerElement(child.evalNode(transactionManager)); DataSourceFactory dsFactory = dataSourceElement(child.evalNode(dataSource)); DataSource dataSource = dsFactory.getDataSource(); Environment.Builder environmentBuilder = new Environment.Builder(id).transactionFactory(txFactory) .dataSource(dataSource); configuration.setEnvironment(environmentBuilder.build()); break; è§£æmapper è§£æ mybatis-config.xml ä¸­ mappers èŠ‚ç‚¹ private void mapperElement(XNode parent) throws Exception if (parent != null) for (XNode child : parent.getChildren()) if (package.equals(child.getName())) String mapperPackage = child.getStringAttribute(name); configuration.addMappers(mapperPackage); else // com/github/lianyutian/mybatisdemo/UserMapper.xml String resource = child.getStringAttribute(resource); String url = child.getStringAttribute(url); String mapperClass = child.getStringAttribute(class); if (resource != null url == null mapperClass == null) ErrorContext.instance().resource(resource); // è¯»å–UserMapper.xmlæ–‡ä»¶ try (InputStream inputStream = Resources.getResourceAsStream(resource)) XMLMapperBuilder mapperParser = new XMLMapperBuilder(inputStream, configuration, resource, configuration.getSqlFragments()); // è§£æMapperæ–‡ä»¶ mapperParser.parse(); else if (resource == null url != null mapperClass == null) ... else if (resource == null url == null mapperClass != null) ... else throw new BuilderException( A mapper element may only specify a url, resource or class, but not more than one.); ä½¿ç”¨ XMLMapperBuilder è§£æ mapper.xml public void parse() if (!configuration.isResourceLoaded(resource)) configurationElement(parser.evalNode(/mapper)); configuration.addLoadedResource(resource); // ç»‘å®šMapperæ¥å£å’ŒMapper.xmlæ–‡ä»¶çš„å…³ç³» bindMapperForNamespace(); parsePendingResultMaps(); parsePendingCacheRefs(); parsePendingStatements();private void configurationElement(XNode context) try String namespace = context.getStringAttribute(namespace); if (namespace == null || namespace.isEmpty()) throw new BuilderException(Mappers namespace cannot be empty); builderAssistant.setCurrentNamespace(namespace); cacheRefElement(context.evalNode(cache-ref)); cacheElement(context.evalNode(cache)); // è§£æå…¥å‚ parameterMapElement(context.evalNodes(/mapper/parameterMap)); // è§£æè¿”å›ç»“æœç±»å‹ resultMapElements(context.evalNodes(/mapper/resultMap)); sqlElement(context.evalNodes(/mapper/sql)); // è§£æsqlè¯­å¥ buildStatementFromContext(context.evalNodes(select|insert|update|delete)); catch (Exception e) throw new BuilderException(Error parsing Mapper XML. The XML location is + resource + . Cause: + e, e); è§£æSQLè¯­å¥ public void parseStatementNode() ... // è·å–å…¥å‚ç±»ç±»å‹ String parameterType = context.getStringAttribute(parameterType); Class? parameterTypeClass = resolveClass(parameterType); ... // è·å–è¿”å›ç±»ç±»å‹ String resultType = context.getStringAttribute(resultType); Class? resultTypeClass = resolveClass(resultType); String resultMap = context.getStringAttribute(resultMap); if (resultTypeClass == null resultMap == null) resultTypeClass = MapperAnnotationBuilder.getMethodReturnType(builderAssistant.getCurrentNamespace(), id); String resultSetType = context.getStringAttribute(resultSetType); ResultSetType resultSetTypeEnum = resolveResultSetType(resultSetType); if (resultSetTypeEnum == null) resultSetTypeEnum = configuration.getDefaultResultSetType(); String keyProperty = context.getStringAttribute(keyProperty); String keyColumn = context.getStringAttribute(keyColumn); String resultSets = context.getStringAttribute(resultSets); boolean dirtySelect = context.getBooleanAttribute(affectData, Boolean.FALSE); builderAssistant.addMappedStatement(id, sqlSource, statementType, sqlCommandType, fetchSize, timeout, parameterMap, parameterTypeClass, resultMap, resultTypeClass, resultSetTypeEnum, flushCache, useCache, resultOrdered, keyGenerator, keyProperty, keyColumn, databaseId, langDriver, resultSets, dirtySelect); æ„å»º MappedStatement å¹¶åŠ å…¥ configuration ä¸­ public MappedStatement addMappedStatement(String id, SqlSource sqlSource, StatementType statementType, ... MappedStatement statement = statementBuilder.build(); configuration.addMappedStatement(statement); return statement; ç»‘å®š mapper æ¥å£å’Œ mapper.xml å…³ç³» private void bindMapperForNamespace() // com.github.lianyutian.mybatisdemo.UserMapper String namespace = builderAssistant.getCurrentNamespace(); if (namespace != null) Class? boundType = null; try boundType = Resources.classForName(namespace); catch (ClassNotFoundException e) // ignore, bound type is not required if (boundType != null !configuration.hasMapper(boundType)) // Spring may not know the real resource name so we set a flag // to prevent loading again this resource from the mapper interface // look at MapperAnnotationBuilder#loadXmlResource configuration.addLoadedResource(namespace: + namespace); configuration.addMapper(boundType); æ€»ç»“æ ¹æ®æºç è¿½è¸ªï¼ŒMyBatis åˆå§‹åŒ–é˜¶æ®µä¸»è¦è¿›è¡Œäº†ä¸‹åˆ—å‡ é¡¹å·¥ä½œ æ ¹æ® mybatis-config.xml è·å–è¾“å…¥æµ InputStream ä» mybatis-config.xml æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œé€å±‚è§£æé…ç½®ï¼ŒåŒ…æ‹¬å¯¹åº”çš„ mapper.xmlã€‚å¹¶å°†è§£æåçš„æ•°æ®å­˜å…¥ Configuration å¯¹è±¡ä¸­ ä»¥é…ç½®å¥½çš„ Configuration æ„å»ºä¸€ä¸ª SqlSessionFactory å¯¹è±¡","tags":["MyBatis","Java","ORM"],"categories":["Java"]},{"title":"å‰ç«¯å¸¸è§å°æ¡ˆä¾‹","path":"/2023/11/28/2023-11-28-å‰ç«¯å¸¸è§å°æ¡ˆä¾‹/","content":"æ¡ˆä¾‹ä»£ç åº“ https://github.com/lianyutian/font_demo/blob/main 1. CSSå¸¸è§æ¡ˆä¾‹1.1 è¡Œé«˜-å‚ç›´å±…ä¸­ å‚ç›´å±…ä¸­æŠ€å·§ è¡Œé«˜å±æ€§å€¼ç­‰äºç›’å­é«˜åº¦å±æ€§å€¼ æ³¨æ„ è¯¥æŠ€å·§é€‚ç”¨äºå•è¡Œæ–‡å­—å‚ç›´å±…ä¸­æ•ˆæœ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleå‚ç›´å±…ä¸­/title style div height: 100px; background-color: skyblue; /* æ³¨æ„ï¼šåªèƒ½æ˜¯å•è¡Œæ–‡å­—å‚ç›´å±…ä¸­ */ line-height: 100px; /style/headbody divæ–‡å­—/div/body/html 1.2 æ¸…é™¤é»˜è®¤å†…å¤–è¾¹è· åœºæ™¯ æµè§ˆå™¨ä¼šé»˜è®¤ç»™éƒ¨åˆ†æ ‡ç­¾è®¾ç½®é»˜è®¤çš„marginå’Œpaddingï¼Œä½†ä¸€èˆ¬åœ¨é¡¹ç›®å¼€å§‹å‰éœ€è¦å…ˆæ¸…é™¤è¿™äº›æ ‡ç­¾é»˜è®¤çš„marginå’Œpaddingï¼Œåç»­è‡ªå·±è®¾ç½® æ¯”å¦‚ï¼šbodyæ ‡ç­¾é»˜è®¤æœ‰marginï¼š8px æ¯”å¦‚ï¼špæ ‡ç­¾é»˜è®¤æœ‰ä¸Šä¸‹çš„margin æ¯”å¦‚ï¼šulæ ‡ç­¾é»˜è®¤ç”±ä¸Šä¸‹çš„marginå’Œpadding-left è§£å†³æ–¹æ³• * margin: 0; padding: 0; 1.3 ç›’å­æ¨¡å‹-åœ†è§’ å¸¸è§åº”ç”¨ - æ­£åœ†å½¢çŠ¶ ç»™æ­£æ–¹å½¢ç›’å­è®¾ç½®åœ†è§’å±æ€§å€¼ä¸º å®½é«˜çš„ä¸€åŠ 50% æ•ˆæœï¼šfont-demo.pages.dev !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleåœ†è§’-åŸºæœ¬ä½¿ç”¨/title style div margin: 50px auto; width: 200px; height: 200px; background-color: orange; /* border-radius: 20px; */ /* è®°å¿†ï¼šä»å·¦ä¸Šè§’é¡ºæ—¶é’ˆèµ‹å€¼ï¼Œæ²¡æœ‰å–å€¼çš„è§’ä¸å¯¹è§’å–å€¼ç›¸åŒ */ /* å››å€¼ï¼šå·¦ä¸Š å³ä¸Š å³ä¸‹ å·¦ä¸‹ */ /* border-radius: 10px 20px 40px 80px; */ /* ä¸‰å€¼ï¼šå·¦ä¸Š å³ä¸Š+å·¦ä¸‹ å³ä¸‹ */ /* border-radius: 10px 40px 80px; */ /* ä¸¤å€¼ï¼šå·¦ä¸Š+å³ä¸‹ å³ä¸Š+å·¦ä¸‹ */ border-radius: 10px 80px; /style/headbody div/div/body/html å¸¸è§åº”ç”¨ â€“ èƒ¶å›Šå½¢çŠ¶ ç»™é•¿æ–¹å½¢ç›’å­è®¾ç½®åœ†è§’å±æ€§å€¼ä¸º ç›’å­é«˜åº¦çš„ä¸€åŠ æ•ˆæœï¼šfont-demo.pages.dev !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleåœ†è§’-ç‰¹æ®Šåœºæ™¯/title style img width: 200px; height: 200px; /* border-radius: 100px; */ /* æœ€å¤§å€¼æ˜¯50%ã€‚è¶…è¿‡50%æ²¡æœ‰æ•ˆæœ */ border-radius: 50%; div width: 200px; height: 80px; background-color: orange; border-radius: 40px; /style/headbody !-- æ­£åœ†å½¢ -- å¤´åƒ -- img src=./images/1.jpg alt= !-- èƒ¶å›ŠçŠ¶ -- div/div/body/html 1.4 ç›’å­æ¨¡å‹ - é˜´å½± ä½œç”¨ ç»™å…ƒç´ è®¾ç½®é˜´å½±æ•ˆæœ å±æ€§å box-shadow å±æ€§å€¼ X è½´åç§»é‡ Y è½´åç§»é‡ æ¨¡ç³ŠåŠå¾„ æ‰©æ•£åŠå¾„ é¢œè‰² å†…å¤–é˜´å½± æ³¨æ„ X è½´åç§»é‡ å’Œ Y è½´åç§»é‡ å¿…é¡»ä¹¦å†™ é»˜è®¤æ˜¯å¤–é˜´å½±ï¼Œå†…é˜´å½±éœ€è¦æ·»åŠ  inset ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleç›’å­é˜´å½±/title style div margin: 50px auto; width: 200px; height: 80px; background-color: orange; box-shadow: 2px 5px 10px 1px rgba(0,0,0,0.5) inset; /style/headbody div/div/body/html 1.5 è½®æ’­å›¾-æ— åŠ¨æ€æ•ˆæœ æ•ˆæœ font-demo.pages.dev ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleè½®æ’­å›¾/title link rel=stylesheet href=./iconfont/iconfont.css style * margin: 0; padding: 0; box-sizing: border-box; li list-style: none; .banner position: relative; margin: 100px auto; width: 564px; height: 315px; /* background-color: pink; */ overflow: hidden; /* å›¾ç‰‡ */ .banner img width: 564px; border-radius: 12px; vertical-align: middle; .banner ul display: flex; /* ç®­å¤´ */ .banner .prev, .banner .next /* éšè— */ display: none; position: absolute; top: 50%; transform: translateY(-50%); width: 20px; height: 30px; background-color: rgba(0,0,0, 0.3); text-decoration: none; color: #fff; line-height: 30px; /* é¼ æ ‡æ»‘åˆ°banneråŒºåŸŸï¼Œç®­å¤´è¦æ˜¾ç¤º display:block */ .banner:hover .prev, .banner:hover .next display: block; .banner .prev left: 0; border-radius: 0 15px 15px 0; .banner .next right: 0; border-radius: 15px 0 0 15px; text-align: center; /* åœ†ç‚¹ */ .banner ol position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); height: 13px; background-color: rgba(255,255,255,0.3); display: flex; border-radius: 10px; .banner ol li margin: 3px; width: 8px; height: 8px; background-color: #fff; border-radius: 50%; cursor: pointer; /* æ©™è‰²çš„li */ .banner ol .active background-color: #ff5000; /style/headbody div class=banner !-- å›¾: ul li -- ul lia href=#img src=./images/banner1.jpg alt=/a/li lia href=#img src=./images/banner2.jpg alt=/a/li lia href=#img src=./images/banner3.jpg alt=/a/li /ul !-- ç®­å¤´ -- !-- ä¸Šä¸€å¼  prev -- a href=# class=prev i class=iconfont icon-zuoce/i /a !-- ä¸‹ä¸€å¼  next -- a href=# class=next i class=iconfont icon-youce/i /a !-- åœ†ç‚¹ -- ol li/li li class=active/li li/li /ol /div/body/html 2. JSå¸¸è§æ¡ˆä¾‹2.1 è½®æ’­å›¾ æ•ˆæœ https://font-demo.pages.dev/js/web_api_2/08-%E8%BD%AE%E6%92%AD%E5%9B%BE%E5%AE%8C%E6%95%B4%E7%89%88 éœ€æ±‚ å½“ç‚¹å‡»å·¦å³çš„æŒ‰é’®ï¼Œå¯ä»¥åˆ‡æ¢è½®æ’­å›¾ åˆ†æ â‘ ï¼šå³ä¾§æŒ‰é’®ç‚¹å‡»ï¼Œå˜é‡++ï¼Œå¦‚æœå¤§äºç­‰äº8ï¼Œåˆ™å¤åŸ0 â‘¡ï¼šå·¦ä¾§æŒ‰é’®ç‚¹å‡»ï¼Œå˜é‡â€“ï¼Œå¦‚æœå°äº0ï¼Œåˆ™å¤åŸæœ€åä¸€å¼  â‘¢ï¼šé¼ æ ‡ç»è¿‡æš‚åœå®šæ—¶å™¨ â‘£ï¼šé¼ æ ‡ç¦»å¼€å¼€å¯å®šæ—¶å™¨ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 / meta http-equiv=X-UA-Compatible content=IE=edge / meta name=viewport content=width=device-width, initial-scale=1.0 / titleè½®æ’­å›¾ç‚¹å‡»åˆ‡æ¢/title style * box-sizing: border-box; .slider width: 560px; height: 400px; overflow: hidden; .slider-wrapper width: 100%; height: 320px; .slider-wrapper img width: 100%; height: 100%; display: block; .slider-footer height: 80px; background-color: rgb(100, 67, 68); padding: 12px 12px 0 12px; position: relative; .slider-footer .toggle position: absolute; right: 0; top: 12px; display: flex; .slider-footer .toggle button margin-right: 12px; width: 28px; height: 28px; appearance: none; border: none; background: rgba(255, 255, 255, 0.1); color: #fff; border-radius: 4px; cursor: pointer; .slider-footer .toggle button:hover background: rgba(255, 255, 255, 0.2); .slider-footer p margin: 0; color: #fff; font-size: 18px; margin-bottom: 10px; .slider-indicator margin: 0; padding: 0; list-style: none; display: flex; align-items: center; .slider-indicator li width: 8px; height: 8px; margin: 4px; border-radius: 50%; background: #fff; opacity: 0.4; cursor: pointer; .slider-indicator li.active width: 12px; height: 12px; opacity: 1; /style/headbody div class=slider div class=slider-wrapper img src=./images/slider01.jpg alt= / /div div class=slider-footer på¯¹äººç±»æ¥è¯´ä¼šä¸ä¼šå¤ªè¶…å‰äº†ï¼Ÿ/p ul class=slider-indicator li class=active/li li/li li/li li/li li/li li/li li/li li/li /ul div class=toggle button class=prevlt;/button button class=nextgt;/button /div /div /div script // 1. åˆå§‹æ•°æ® const data = [ url: ./images/slider01.jpg, title: å¯¹äººç±»æ¥è¯´ä¼šä¸ä¼šå¤ªè¶…å‰äº†ï¼Ÿ, color: rgb(100, 67, 68) , url: ./images/slider02.jpg, title: å¼€å¯å‰‘ä¸é›ªçš„é»‘æš—ä¼ è¯´ï¼, color: rgb(43, 35, 26) , url: ./images/slider03.jpg, title: çœŸæ­£çš„joå¨å‡ºç°äº†ï¼, color: rgb(36, 31, 33) , url: ./images/slider04.jpg, title: æç‰åˆšï¼šè®©ä¸–ç•Œé€šè¿‡Bç«™çœ‹åˆ°ä¸œæ–¹å¤§å›½æ–‡åŒ–, color: rgb(139, 98, 66) , url: ./images/slider05.jpg, title: å¿«æ¥åˆ†äº«ä½ çš„å¯’å‡æ—¥å¸¸å§~, color: rgb(67, 90, 92) , url: ./images/slider06.jpg, title: å“”å“©å“”å“©å°å¹´YEAH, color: rgb(166, 131, 143) , url: ./images/slider07.jpg, title: ä¸€ç«™å¼è§£å†³ä½ çš„ç”µè„‘é…ç½®é—®é¢˜ï¼ï¼ï¼, color: rgb(53, 29, 25) , url: ./images/slider08.jpg, title: è°ä¸æƒ³å’Œå°çŒ«å’ªè´´è´´å‘¢ï¼, color: rgb(99, 72, 114) , ] // è·å–å…ƒç´  const img = document.querySelector(.slider-wrapper img) const p = document.querySelector(.slider-footer p) const footer = document.querySelector(.slider-footer) // 1. å³æŒ‰é’®ä¸šåŠ¡ // 1.1 è·å–å³ä¾§æŒ‰é’® const next = document.querySelector(.next) let i = 0 // ä¿¡å·é‡ æ§åˆ¶æ’­æ”¾å›¾ç‰‡å¼ æ•° // 1.2 æ³¨å†Œç‚¹å‡»äº‹ä»¶ next.addEventListener(click, function () // console.log(11) i++ // 1.6åˆ¤æ–­æ¡ä»¶ å¦‚æœå¤§äº8 å°±å¤åŸä¸º 0 // if (i = 8) // i = 0 // i = i = data.length ? 0 : i // 1.3 å¾—åˆ°å¯¹åº”çš„å¯¹è±¡ // console.log(data[i]) // è°ƒç”¨å‡½æ•° toggle() ) // 2. å·¦ä¾§æŒ‰é’®ä¸šåŠ¡ // 2.1 è·å–å·¦ä¾§æŒ‰é’® const prev = document.querySelector(.prev) // 1.2 æ³¨å†Œç‚¹å‡»äº‹ä»¶ prev.addEventListener(click, function () i-- // åˆ¤æ–­æ¡ä»¶ å¦‚æœå°äº0 åˆ™çˆ¬åˆ°æœ€åä¸€å¼ å›¾ç‰‡ç´¢å¼•å·æ˜¯ 7 // if (i 0) // i = 7 // i = i 0 ? data.length - 1 : i // 1.3 å¾—åˆ°å¯¹åº”çš„å¯¹è±¡ // console.log(data[i]) // è°ƒç”¨å‡½æ•° toggle() ) // å£°æ˜ä¸€ä¸ªæ¸²æŸ“çš„å‡½æ•°ä½œä¸ºå¤ç”¨ function toggle() // 1.4 æ¸²æŸ“å¯¹åº”çš„æ•°æ® img.src = data[i].url p.innerHTML = data[i].title footer.style.backgroundColor = data[i].color // 1.5 æ›´æ¢å°åœ†ç‚¹ å…ˆç§»é™¤åŸæ¥çš„ç±»åï¼Œ å½“å‰liå†æ·»åŠ  è¿™ä¸ª ç±»å document.querySelector(.slider-indicator .active).classList.remove(active) document.querySelector(`.slider-indicator li:nth-child($i + 1)`).classList.add(active) // 3. è‡ªåŠ¨æ’­æ”¾æ¨¡å— let timerId = setInterval(function () // åˆ©ç”¨jsè‡ªåŠ¨è°ƒç”¨ç‚¹å‡»äº‹ä»¶ click() ä¸€å®šåŠ å°æ‹¬å·è°ƒç”¨å‡½æ•° next.click() , 1000) // 4. é¼ æ ‡ç»è¿‡å¤§ç›’å­ï¼Œåœæ­¢å®šæ—¶å™¨ const slider = document.querySelector(.slider) // æ³¨å†Œäº‹ä»¶ slider.addEventListener(mouseenter, function () // åœæ­¢å®šæ—¶å™¨ clearInterval(timerId) ) // 5. é¼ æ ‡ç¦»å¼€å¤§ç›’å­ï¼Œå¼€å¯å®šæ—¶å™¨ // æ³¨å†Œäº‹ä»¶ slider.addEventListener(mouseleave, function () // åœæ­¢å®šæ—¶å™¨ if (timerId) clearInterval(timerId) // å¼€å¯å®šæ—¶å™¨ timerId = setInterval(function () // åˆ©ç”¨jsè‡ªåŠ¨è°ƒç”¨ç‚¹å‡»äº‹ä»¶ click() ä¸€å®šåŠ å°æ‹¬å·è°ƒç”¨å‡½æ•° next.click() , 1000) ) /script/body/html 2.2 Tabæ åˆ‡æ¢ æ•ˆæœ https://font-demo.pages.dev/js/web_api_2/18-tab%E6%A0%8F%E5%88%87%E6%8D%A2 éœ€æ±‚ é¼ æ ‡ç»è¿‡ä¸åŒçš„é€‰é¡¹å¡ï¼Œåº•éƒ¨å¯ä»¥æ˜¾ç¤ºä¸åŒçš„å†…å®¹ åˆ†æ â‘ ï¼šç»™açš„çˆ¶çº§ æ³¨å†Œç‚¹å‡»äº‹ä»¶ï¼Œé‡‡å–äº‹ä»¶å§”æ‰˜æ–¹å¼ â‘¡ï¼š å¦‚æœç‚¹å‡»çš„æ˜¯A , åˆ™è¿›è¡Œæ’ä»–æ€æƒ³ï¼Œåˆ é™¤æ·»åŠ ç±» â‘¢ï¼š æ³¨æ„åˆ¤æ–­çš„æ–¹å¼ åˆ©ç”¨ e.target.tagName â‘£ï¼š å› ä¸ºæ²¡æœ‰ç´¢å¼•å·äº†ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰å±æ€§ï¼Œç»™5ä¸ªé“¾æ¥æ·»åŠ åºå· â‘¤ï¼š ä¸‹é¢å¤§ç›’å­è·å–ç´¢å¼•å·çš„æ–¹å¼ e.target.dataset.id å·ï¼Œ ç„¶åè¿›è¡Œæ’ä»–æ€æƒ³ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 / meta http-equiv=X-UA-Compatible content=IE=edge / meta name=viewport content=width=device-width, initial-scale=1.0 / titletabæ åˆ‡æ¢/title style * margin: 0; padding: 0; .tab width: 590px; height: 340px; margin: 20px; border: 1px solid #e4e4e4; .tab-nav width: 100%; height: 60px; line-height: 60px; display: flex; justify-content: space-between; .tab-nav h3 font-size: 24px; font-weight: normal; margin-left: 20px; .tab-nav ul list-style: none; display: flex; justify-content: flex-end; .tab-nav ul li margin: 0 20px; font-size: 14px; .tab-nav ul li a text-decoration: none; border-bottom: 2px solid transparent; color: #333; .tab-nav ul li a.active border-color: #e1251b; color: #e1251b; .tab-content padding: 0 16px; .tab-content .item display: none; .tab-content .item.active display: block; /style/headbody div class=tab div class=tab-nav h3æ¯æ—¥ç‰¹ä»·/h3 ul lia class=active href=javascript:; data-id=0ç²¾é€‰/a/li lia href=javascript:; data-id=1ç¾é£Ÿ/a/li lia href=javascript:; data-id=2ç™¾è´§/a/li lia href=javascript:; data-id=3ä¸ªæŠ¤/a/li lia href=javascript:; data-id=4é¢„å‘Š/a/li /ul /div div class=tab-content div class=item activeimg src=./images/tab00.png alt= //div div class=itemimg src=./images/tab01.png alt= //div div class=itemimg src=./images/tab02.png alt= //div div class=itemimg src=./images/tab03.png alt= //div div class=itemimg src=./images/tab04.png alt= //div /div /div script // é‡‡å–äº‹ä»¶å§”æ‰˜çš„å½¢å¼ tabæ åˆ‡æ¢ // 1. è·å– ul çˆ¶å…ƒç´  å› ä¸º ulåªæœ‰ä¸€ä¸ª const ul = document.querySelector(.tab-nav ul) // è·å– 5ä¸ª item const items = document.querySelectorAll(.tab-content .item) // 2. æ·»åŠ äº‹ä»¶ ul.addEventListener(click, function (e) // console.log(e.target) // e.targetæ˜¯æˆ‘ä»¬ç‚¹å‡»çš„å¯¹è±¡ // æˆ‘ä»¬åªæœ‰ç‚¹å‡»äº† a æ‰ä¼š è¿›è¡Œ æ·»åŠ ç±»å’Œåˆ é™¤ç±»æ“ä½œ // console.log(e.target.tagName) // e.target.tagName ç‚¹å‡»é‚£ä¸ªå¯¹è±¡çš„ æ ‡ç­¾å if (e.target.tagName === A) // console.log(æˆ‘é€‰çš„æ˜¯a) // æ’ä»–æ€æƒ³ ï¼Œå…ˆç§»é™¤åŸæ¥çš„active document.querySelector(.tab-nav .active).classList.remove(active) //å½“å‰å…ƒç´ æ·»åŠ  active æ˜¯ e.target // this æŒ‡å‘ul ä¸èƒ½ç”¨this e.target.classList.add(active) // ä¸‹é¢å¤§ç›’å­æ¨¡å— // console.log(e.target.dataset.id) const i = +e.target.dataset.id // æ’ä»–æ€æƒ³ ï¼Œå…ˆç§»é™¤åŸæ¥çš„active document.querySelector(.tab-content .active).classList.remove(active) // å¯¹åº”çš„å¤§ç›’å­ æ·»åŠ  active // document.querySelector(`.tab-content .item:nth-child($i + 1)`).classList.add(active) items[i].classList.add(active) ) /script/body/html 2.3 ä»¿äº¬ä¸œå›ºå®šå¯¼èˆªæ æ¡ˆä¾‹ æ•ˆæœ https://font-demo.pages.dev/js/web_api_3/16-%E4%BB%BF%E6%96%B0%E6%B5%AA%E5%9B%BA%E5%AE%9A%E5%A4%B4%E9%83%A8 éœ€æ±‚ å½“é¡µé¢æ»šåŠ¨åˆ°ç§’æ€æ¨¡å—ï¼Œå¯¼èˆªæ è‡ªåŠ¨æ»‘å…¥ï¼Œå¦åˆ™æ»‘å‡º åˆ†æ â‘ ï¼šç”¨åˆ°é¡µé¢æ»šåŠ¨äº‹ä»¶ â‘¡ï¼šæ£€æµ‹é¡µé¢æ»šåŠ¨å¤§äºç­‰äº ç§’æ€æ¨¡å—çš„ä½ç½® åˆ™æ»‘å…¥ï¼Œå¦åˆ™æ»‘å‡º â‘¢ï¼šä¸»è¦ç§»åŠ¨çš„æ˜¯ç§’æ€æ¨¡å—çš„é¡¶éƒ¨ä½ç½® ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style * margin: 0; padding: 0; box-sizing: border-box; .content overflow: hidden; width: 1000px; height: 3000px; background-color: pink; margin: 0 auto; .backtop display: none; width: 50px; left: 50%; margin: 0 0 0 505px; position: fixed; bottom: 60px; z-index: 100; .backtop a height: 50px; width: 50px; background: url(./images/bg2.png) 0 -600px no-repeat; opacity: 0.35; overflow: hidden; display: block; text-indent: -999em; cursor: pointer; .header position: fixed; top: -80px; left: 0; width: 100%; height: 80px; background-color: purple; text-align: center; color: #fff; line-height: 80px; font-size: 30px; transition: all .3s; .sk width: 300px; height: 300px; background-color: skyblue; margin-top: 500px; /style/headbody div class=headeræˆ‘æ˜¯é¡¶éƒ¨å¯¼èˆªæ /div div class=content div class=skç§’æ€æ¨¡å—/div /div div class=backtop img src=./images/close2.png alt= a href=javascript:;/a /div script const sk = document.querySelector(.sk) const header = document.querySelector(.header) // 1. é¡µé¢æ»šåŠ¨äº‹ä»¶ window.addEventListener(scroll, function () // å½“é¡µé¢æ»šåŠ¨åˆ° ç§’æ€æ¨¡å—çš„æ—¶å€™ï¼Œå°±æ”¹å˜ å¤´éƒ¨çš„ topå€¼ // é¡µé¢è¢«å·å»çš„å¤´éƒ¨ = ç§’æ€æ¨¡å—çš„ä½ç½® offsetTop const n = document.documentElement.scrollTop // if (n = sk.offsetTop) // header.style.top = 0 // else // header.style.top = -80px // header.style.top = n = sk.offsetTop ? 0 : -80px ) /script/body/html 2.4 bilibili ç‚¹å‡»å°æ»‘å—ç§»åŠ¨æ•ˆæœ æ•ˆæœ https://font-demo.pages.dev/js/web_api_3/m-bilibili/ éœ€æ±‚ å½“ç‚¹å‡»é“¾æ¥ï¼Œä¸‹é¢çº¢è‰²æ»‘å—è·Ÿç€ç§»åŠ¨ åˆ†æ â‘ ï¼šç”¨åˆ°äº‹ä»¶å§”æ‰˜ â‘¡ï¼šç‚¹å‡»é“¾æ¥å¾—åˆ°å½“å‰å…ƒç´ çš„ offsetLeftå€¼ â‘¢ï¼šä¿®æ”¹line é¢œè‰²å—çš„ left å€¼ ç‚¹å‡»é“¾æ¥çš„offsetLeft â‘£ï¼š æ·»åŠ è¿‡æ¸¡æ•ˆæœ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titlebilibili-å¹²æ¯~~~/title !-- å¼•å…¥faviconå›¾æ ‡ -- link rel=shortcut icon href=favicon.ico type=image/x-icon !-- å¼•å…¥cssæ–‡ä»¶ -- link rel=stylesheet href=./css/index.css !-- å¼•å…¥å­—ä½“å›¾æ ‡æ–‡ä»¶ -- link rel=stylesheet href=./fonts/iconfont.css/headbody !-- å¤´éƒ¨æ¨¡å— -- header class=suspension div class=m-navbar !-- logo -- a href=# class=logo i class=iconfont Navbar_logo/i /a !-- å³ä¾§ -- div class=right a href=# class=search i class=iconfont ic_search_tab/i /a a href=# class=face img src=./images/login.png alt= /a div class=app-btn img src=./images/download.png alt= /div /div /div div class=channel-menu div class=tabs !-- å¾ˆå®½çš„ç›’å­ -- div class=tabs-list a href=#é¦–é¡µ/a a href=#åŠ¨ç”»/a a href=#ç•ªå‰§/a a href=#æœè”¬/a a href=#éŸ³ä¹/a a href=#èˆè¹ˆ/a a href=#é¬¼ç•œ/a a href=#å¹é¬¼/a !-- çº¢è‰²çº¿ -- div class=line/div /div /div div class=after i class=iconfont general_pulldown_s/i /div /div /header !-- ä¸»ä½“éƒ¨åˆ† -- div class=m-home div class=video-list a href=# class=video-item div class=card img src=./images/dog.jpg@480w_270h_1c alt= !-- æ’­æ”¾é‡ -- div class=count span i class=iconfont icon_shipin_bofangshu/i æ’­æ”¾é‡ /span span i class=iconfont icon_shipin_danmushu/i è¯„è®ºæ•° /span /div /div p class=title ellipsis-2 315æ™šä¼šèƒ½ä¸èƒ½æ›å…‰ä¸‹æ™ºèƒ½ç”µè§†ï¼ŸNé‡å¹¿å‘Šã€å¥—å¨ƒä¼šå‘˜ã€æ“ä½œåäººç±»ï¼Œå½“ä»£å¹´è½»äººæ˜¯æ€ä¹ˆè¢«æ™ºèƒ½ç”µè§†é€¼ç–¯çš„ï¼Ÿã€å•†ä¸šBé¢ç‰›é¡¿ã€‘ /p /a a href=# class=video-item div class=card img src=./images/dog.jpg@480w_270h_1c alt= !-- æ’­æ”¾é‡ -- div class=count span i class=iconfont icon_shipin_bofangshu/i æ’­æ”¾é‡ /span span i class=iconfont icon_shipin_danmushu/i è¯„è®ºæ•° /span /div /div p class=title ellipsis-2 315æ™šä¼šèƒ½ä¸èƒ½æ›å…‰ä¸‹æ™ºèƒ½ç”µè§†ï¼ŸNé‡å¹¿å‘Šã€å¥—å¨ƒä¼šå‘˜ã€æ“ä½œåäººç±»ï¼Œå½“ä»£å¹´è½»äººæ˜¯æ€ä¹ˆè¢«æ™ºèƒ½ç”µè§†é€¼ç–¯çš„ï¼Ÿã€å•†ä¸šBé¢ç‰›é¡¿ã€‘ /p /a a href=# class=video-item div class=card img src=./images/dog.jpg@480w_270h_1c alt= !-- æ’­æ”¾é‡ -- div class=count span i class=iconfont icon_shipin_bofangshu/i æ’­æ”¾é‡ /span span i class=iconfont icon_shipin_danmushu/i è¯„è®ºæ•° /span /div /div p class=title ellipsis-2 315æ™šä¼šèƒ½ä¸èƒ½æ›å…‰ä¸‹æ™ºèƒ½ç”µè§†ï¼ŸNé‡å¹¿å‘Šã€å¥—å¨ƒä¼šå‘˜ã€æ“ä½œåäººç±»ï¼Œå½“ä»£å¹´è½»äººæ˜¯æ€ä¹ˆè¢«æ™ºèƒ½ç”µè§†é€¼ç–¯çš„ï¼Ÿã€å•†ä¸šBé¢ç‰›é¡¿ã€‘ /p /a a href=# class=video-item div class=card img src=./images/dog.jpg@480w_270h_1c alt= !-- æ’­æ”¾é‡ -- div class=count span i class=iconfont icon_shipin_bofangshu/i æ’­æ”¾é‡ /span span i class=iconfont icon_shipin_danmushu/i è¯„è®ºæ•° /span /div /div p class=title ellipsis-2 315æ™šä¼šèƒ½ä¸èƒ½æ›å…‰ä¸‹ç”µè§†ï¼Ÿ /p /a a href=# class=video-item div class=card img src=./images/dog.jpg@480w_270h_1c alt= !-- æ’­æ”¾é‡ -- div class=count span i class=iconfont icon_shipin_bofangshu/i æ’­æ”¾é‡ /span span i class=iconfont icon_shipin_danmushu/i è¯„è®ºæ•° /span /div /div p class=title ellipsis-2 315æ™šä¼šèƒ½ä¸èƒ½æ›å…‰ä¸‹æ™ºèƒ½ç”µè§†ï¼ŸNé‡å¹¿å‘Šã€å¥—å¨ƒä¼šå‘˜ã€æ“ä½œåäººç±»ï¼Œå½“ä»£å¹´è½»äººæ˜¯æ€ä¹ˆè¢«æ™ºèƒ½ç”µè§†é€¼ç–¯çš„ï¼Ÿã€å•†ä¸šBé¢ç‰›é¡¿ã€‘ /p /a a href=# class=video-item div class=card img src=./images/dog.jpg@480w_270h_1c alt= !-- æ’­æ”¾é‡ -- div class=count span i class=iconfont icon_shipin_bofangshu/i æ’­æ”¾é‡ /span span i class=iconfont icon_shipin_danmushu/i è¯„è®ºæ•° /span /div /div p class=title ellipsis-2 315æ™šä¼šèƒ½ä¸èƒ½æ›å…‰ä¸‹æ™ºèƒ½ç”µè§†ï¼ŸNé‡å¹¿å‘Šã€å¥—å¨ƒä¼šå‘˜ã€æ“ä½œåäººç±»ï¼Œå½“ä»£å¹´è½»äººæ˜¯æ€ä¹ˆè¢«æ™ºèƒ½ç”µè§†é€¼ç–¯çš„ï¼Ÿã€å•†ä¸šBé¢ç‰›é¡¿ã€‘ /p /a a href=# class=video-item div class=card img src=./images/dog.jpg@480w_270h_1c alt= !-- æ’­æ”¾é‡ -- div class=count span i class=iconfont icon_shipin_bofangshu/i æ’­æ”¾é‡ /span span i class=iconfont icon_shipin_danmushu/i è¯„è®ºæ•° /span /div /div p class=title ellipsis-2 315æ™šä¼šèƒ½ä¸èƒ½æ›å…‰ä¸‹æ™ºèƒ½ç”µè§†ï¼ŸNé‡å¹¿å‘Šã€å¥—å¨ƒä¼šå‘˜ã€æ“ä½œåäººç±»ï¼Œå½“ä»£å¹´è½»äººæ˜¯æ€ä¹ˆè¢«æ™ºèƒ½ç”µè§†é€¼ç–¯çš„ï¼Ÿã€å•†ä¸šBé¢ç‰›é¡¿ã€‘ /p /a a href=# class=video-item div class=card img src=./images/dog.jpg@480w_270h_1c alt= !-- æ’­æ”¾é‡ -- div class=count span i class=iconfont icon_shipin_bofangshu/i æ’­æ”¾é‡ /span span i class=iconfont icon_shipin_danmushu/i è¯„è®ºæ•° /span /div /div p class=title ellipsis-2 315æ™šä¼šèƒ½ä¸èƒ½æ›å…‰ä¸‹æ™ºèƒ½ç”µè§†ï¼ŸNé‡å¹¿å‘Šã€å¥—å¨ƒä¼šå‘˜ã€æ“ä½œåäººç±»ï¼Œå½“ä»£å¹´è½»äººæ˜¯æ€ä¹ˆè¢«æ™ºèƒ½ç”µè§†é€¼ç–¯çš„ï¼Ÿã€å•†ä¸šBé¢ç‰›é¡¿ã€‘ /p /a a href=# class=video-item div class=card img src=./images/dog.jpg@480w_270h_1c alt= !-- æ’­æ”¾é‡ -- div class=count span i class=iconfont icon_shipin_bofangshu/i æ’­æ”¾é‡ /span span i class=iconfont icon_shipin_danmushu/i è¯„è®ºæ•° /span /div /div p class=title ellipsis-2 315æ™šä¼šèƒ½ä¸èƒ½æ›å…‰ä¸‹æ™ºèƒ½ç”µè§†ï¼ŸNé‡å¹¿å‘Šã€å¥—å¨ƒä¼šå‘˜ã€æ“ä½œåäººç±»ï¼Œå½“ä»£å¹´è½»äººæ˜¯æ€ä¹ˆè¢«æ™ºèƒ½ç”µè§†é€¼ç–¯çš„ï¼Ÿã€å•†ä¸šBé¢ç‰›é¡¿ã€‘ /p /a a href=# class=video-item div class=card img src=./images/dog.jpg@480w_270h_1c alt= !-- æ’­æ”¾é‡ -- div class=count span i class=iconfont icon_shipin_bofangshu/i æ’­æ”¾é‡ /span span i class=iconfont icon_shipin_danmushu/i è¯„è®ºæ•° /span /div /div p class=title ellipsis-2 315æ™šä¼šèƒ½ä¸èƒ½æ›å…‰ä¸‹æ™ºèƒ½ç”µè§†ï¼ŸNé‡å¹¿å‘Šã€å¥—å¨ƒä¼šå‘˜ã€æ“ä½œåäººç±»ï¼Œå½“ä»£å¹´è½»äººæ˜¯æ€ä¹ˆè¢«æ™ºèƒ½ç”µè§†é€¼ç–¯çš„ï¼Ÿã€å•†ä¸šBé¢ç‰›é¡¿ã€‘ /p /a a href=# class=video-item div class=card img src=./images/dog.jpg@480w_270h_1c alt= !-- æ’­æ”¾é‡ -- div class=count span i class=iconfont icon_shipin_bofangshu/i æ’­æ”¾é‡ /span span i class=iconfont icon_shipin_danmushu/i è¯„è®ºæ•° /span /div /div p class=title ellipsis-2 315æ™šä¼šèƒ½ä¸èƒ½æ›å…‰ä¸‹æ™ºèƒ½ç”µè§†ï¼ŸNé‡å¹¿å‘Šã€å¥—å¨ƒä¼šå‘˜ã€æ“ä½œåäººç±»ï¼Œå½“ä»£å¹´è½»äººæ˜¯æ€ä¹ˆè¢«æ™ºèƒ½ç”µè§†é€¼ç–¯çš„ï¼Ÿã€å•†ä¸šBé¢ç‰›é¡¿ã€‘ /p /a /div /div !-- åº•éƒ¨æ¨¡å— -- footer class=app div class=btn-app i class=iconfont Navbar_logo/i æ‰“å¼€Appï¼Œçœ‹ä½ æ„Ÿå…´è¶£çš„è§†é¢‘ /div /footer script // 1. äº‹ä»¶å§”æ‰˜çš„æ–¹æ³• è·å–çˆ¶å…ƒç´  tabs-list const list = document.querySelector(.tabs-list) const line = document.querySelector(.line) // 2. æ³¨å†Œç‚¹å‡»äº‹ä»¶ list.addEventListener(click, function (e) // åªæœ‰ç‚¹å‡»äº†A æ‰æœ‰è§¦å‘æ•ˆæœ if (e.target.tagName === A) // console.log(11) // å½“å‰å…ƒç´ æ˜¯è° ï¼Ÿ e.target // å¾—åˆ°å½“å‰ç‚¹å‡»å…ƒç´ çš„ä½ç½® // console.log(e.target.offsetLeft) // line.style.transform = translateX(100px) // æŠŠæˆ‘ä»¬ç‚¹å‡»çš„aé“¾æ¥ç›’å­çš„ä½ç½® ç„¶åç§»åŠ¨ line.style.transform = `translateX($e.target.offsetLeftpx)` ) /script/body/html 2.5 ç”µæ¢¯å¯¼èˆª æ•ˆæœ https://font-demo.pages.dev/js/web_api_3/%E7%94%B5%E6%A2%AF%E5%AF%BC%E8%88%AA%E7%B4%A0%E6%9D%90/%E7%94%B5%E6%A2%AF%E5%AF%BC%E8%88%AA éœ€æ±‚ å½“ç‚¹å‡»ä¸åŒçš„æ¨¡å—ï¼Œé¡µé¢å¯ä»¥è‡ªåŠ¨è·³è½¬ä¸åŒçš„ä½ç½® åˆ†æ â‘ ï¼šé¡µé¢æ»šåŠ¨åˆ°å¯¹åº”ä½ç½®ï¼Œå¯¼èˆªæ˜¾ç¤ºï¼Œå¦åˆ™éšè—æ¨¡å— â‘¡ï¼šç‚¹å‡»å¯¼èˆªå¯¹åº”å°æ¨¡å—ï¼Œé¡µé¢ ä¼šè·³åˆ°å¯¹åº”å¤§æ¨¡å—ä½ç½® â‘¢ï¼šé¡µé¢æ»šåŠ¨åˆ°å¯¹åº”ä½ç½®ï¼Œç”µæ¢¯å¯¼èˆªå¯¹åº”æ¨¡å—è‡ªåŠ¨å‘ç”Ÿå˜åŒ– ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 titleå°å…”é²œå„¿ - æ–°é²œ æƒ æ°‘ å¿«æ·!/title meta http-equiv=X-UA-Compatible content=IE=edge meta name=renderer content=webkit link rel=stylesheet href=./css/common.css link rel=stylesheet href=./css/index.css/headbody ... !-- ç”µæ¢¯ -- div class=xtx-elevator ul class=xtx-elevator-list lia href=javascript:; data-name=newæ–°é²œå¥½ç‰©/a/li lia href=javascript:; data-name=popularäººæ°”æ¨è/a/li lia href=javascript:; data-name=brandçƒ­é—¨å“ç‰Œ/a/li lia href=javascript:; data-name=topicæœ€æ–°ä¸“é¢˜/a/li lia href=javascript:; id=backTopi class=sprites/ié¡¶éƒ¨/a/li /ul /div script // ç¬¬ä¸€å¤§æ¨¡å—ï¼Œé¡µé¢æ»‘åŠ¨å¯ä»¥æ˜¾ç¤ºå’Œéšè— (function () // è·å–å…ƒç´  const entry = document.querySelector(.xtx_entry) const elevator = document.querySelector(.xtx-elevator) // 1. å½“é¡µé¢æ»šåŠ¨å¤§äº 300åƒç´ ï¼Œå°±æ˜¾ç¤º ç”µæ¢¯å¯¼èˆª // 2. ç»™é¡µé¢æ·»åŠ æ»šåŠ¨äº‹ä»¶ window.addEventListener(scroll, function () // è¢«å·å»çš„å¤´éƒ¨å¤§äº 300 const n = document.documentElement.scrollTop // if (n = 300) // elevator.style.opacity = 1 // else // elevator.style.opacity = 0 // // ç®€å†™ elevator.style.opacity = n = entry.offsetTop ? 1 : 0 ) // ç‚¹å‡»è¿”å›é¡µé¢é¡¶éƒ¨ const backTop = document.querySelector(#backTop) backTop.addEventListener(click, function () // å¯è¯»å†™ // document.documentElement.scrollTop = 0 // window.scrollTo(x, y) window.scrollTo(0, 0) ) )(); // ç¬¬äºŒç¬¬ä¸‰éƒ½æ”¾åˆ°å¦å¤–ä¸€ä¸ªæ‰§è¡Œå‡½æ•°é‡Œé¢ (function () // 2. ç‚¹å‡»é¡µé¢å¯ä»¥æ»‘åŠ¨ const list = document.querySelector(.xtx-elevator-list) list.addEventListener(click, function (e) // console.log(11) if (e.target.tagName === A e.target.dataset.name) // æ’ä»–æ€æƒ³ // å…ˆç§»é™¤åŸæ¥çš„ç±»active // å…ˆè·å–è¿™ä¸ªactiveçš„å¯¹è±¡ const old = document.querySelector(.xtx-elevator-list .active) // console.log(old) // åˆ¤æ–­ å¦‚æœåŸæ¥æœ‰activeç±»çš„å¯¹è±¡ï¼Œå°±ç§»é™¤ç±»ï¼Œå¦‚æœå¼€å§‹å°±æ²¡æœ‰å¯¹è±¡ï¼Œå°±ä¸åˆ é™¤ï¼Œæ‰€ä»¥ä¸æŠ¥é”™ if (old) old.classList.remove(active) // å½“å‰å…ƒç´ æ·»åŠ  active e.target.classList.add(active) // è·å¾—è‡ªå®šä¹‰å±æ€§ new topic // console.log(e.target.dataset.name) // æ ¹æ®å°ç›’å­çš„è‡ªå®šä¹‰å±æ€§å€¼ å»é€‰æ‹© å¯¹åº”çš„å¤§ç›’å­ // console.log(document.querySelector(`.xtx_goods_$e.target.dataset.name`).offsetTop) // è·å¾—å¯¹åº”å¤§ç›’å­çš„ offsetTop const top = document.querySelector(`.xtx_goods_$e.target.dataset.name`).offsetTop // è®©é¡µé¢æ»šåŠ¨åˆ°å¯¹åº”çš„ä½ç½® document.documentElement.scrollTop = top ) // 3. é¡µé¢æ»šåŠ¨ï¼Œå¯ä»¥æ ¹æ®å¤§ç›’å­é€‰ å°ç›’å­ æ·»åŠ  active ç±» window.addEventListener(scroll, function () // 3.1 å…ˆç§»é™¤ç±» // å…ˆè·å–è¿™ä¸ªactiveçš„å¯¹è±¡ const old = document.querySelector(.xtx-elevator-list .active) // console.log(old) // åˆ¤æ–­ å¦‚æœåŸæ¥æœ‰activeç±»çš„å¯¹è±¡ï¼Œå°±ç§»é™¤ç±»ï¼Œå¦‚æœå¼€å§‹å°±æ²¡æœ‰å¯¹è±¡ï¼Œå°±ä¸åˆ é™¤ï¼Œæ‰€ä»¥ä¸æŠ¥é”™ if (old) old.classList.remove(active) // 3.2 åˆ¤æ–­é¡µé¢å½“å‰æ»‘åŠ¨çš„ä½ç½®ï¼Œé€‰æ‹©å°ç›’å­ // è·å–4ä¸ªå¤§ç›’å­ const news = document.querySelector(.xtx_goods_new) const popular = document.querySelector(.xtx_goods_popular) const brand = document.querySelector(.xtx_goods_brand) const topic = document.querySelector(.xtx_goods_topic) const n = document.documentElement.scrollTop if (n = news.offsetTop n popular.offsetTop) // é€‰æ‹©ç¬¬ä¸€ä¸ªå°ç›’å­ document.querySelector([data-name=new]).classList.add(active) else if (n = popular.offsetTop n brand.offsetTop) document.querySelector([data-name=popular]).classList.add(active) else if (n = brand.offsetTop n topic.offsetTop) document.querySelector([data-name=brand]).classList.add(active) else if (n = topic.offsetTop) document.querySelector([data-name=topic]).classList.add(active) ) )(); // let n = 10 // n = 20 /script/body/html","tags":["CSS","å®æˆ˜æ¡ˆä¾‹"],"categories":["å‰ç«¯"]},{"title":"CSSåŸºç¡€","path":"/2023/11/27/2023-11-27-CSSåŸºç¡€/","content":"CSS çš„ä»‹ç» CSS æ˜¯ä»€ä¹ˆ å±‚å æ ·å¼è¡¨ï¼ˆCascading Style Sheetsï¼Œç¼©å†™ä¸º CSSï¼‰æ˜¯ä¸€ç§ æ ·å¼è¡¨ è¯­è¨€ï¼Œç”¨æ¥æè¿° HTML æˆ– XMLï¼ˆåŒ…æ‹¬å¦‚ SVGã€MathML æˆ– XHTML ä¹‹ç±»çš„ XML åˆ†æ”¯è¯­è¨€ï¼‰æ–‡æ¡£çš„å‘ˆç°æ–¹å¼ã€‚CSS æè¿°äº†åœ¨å±å¹•ã€çº¸è´¨ã€éŸ³é¢‘ç­‰å…¶ä»–åª’ä½“ä¸Šçš„å…ƒç´ åº”è¯¥å¦‚ä½•è¢«æ¸²æŸ“çš„é—®é¢˜ã€‚ CSS çš„ä½œç”¨ ç»™é¡µé¢ä¸­çš„ HTML æ ‡ç­¾è®¾ç½®æ ·å¼ CSS çš„å¼•å…¥æ–¹å¼ å†…åµŒå¼ï¼šCSS å†™åœ¨ style æ ‡ç­¾ä¸­ â€¢ æç¤ºï¼šstyle æ ‡ç­¾è™½ç„¶å¯ä»¥å†™åœ¨é¡µé¢ä»»æ„ä½ç½®ï¼Œä½†æ˜¯é€šå¸¸çº¦å®šå†™åœ¨ head æ ‡ç­¾ å¤–è”å¼ï¼šCSS å†™åœ¨ä¸€ä¸ªå•ç‹¬çš„.CSS æ–‡ä»¶ä¸­ â€¢ æç¤ºï¼šéœ€è¦é€šè¿‡ link æ ‡ç­¾åœ¨ç½‘é¡µä¸­å¼•å…¥ è¡Œå†…å¼ï¼šCSS å†™åœ¨æ ‡ç­¾çš„ style å±æ€§ä¸­ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title !-- å…³ç³»: æ ·å¼è¡¨ -- link rel=stylesheet href=./my.css/headbody !-- cssåˆ°åº•èƒ½å†™åœ¨å“ªé‡Œ -- pè¿™æ˜¯pæ ‡ç­¾/p div style=color: green; font-size: 30px;è¿™æ˜¯divæ ‡ç­¾/div divè¿™ä¸ªdivæ˜¯ä»€ä¹ˆé¢œè‰²/div/body/html é€‰æ‹©å™¨é€‰æ‹©å™¨çš„ä½œç”¨ï¼šé€‰æ‹©é¡µé¢ä¸­å¯¹åº”çš„æ ‡ç­¾ï¼ˆæ‰¾ï¼‰ï¼Œæ–¹ä¾¿åç»­è®¾ç½®æ ·å¼ï¼ˆæ”¹ï¼‰ æ ‡ç­¾é€‰æ‹©å™¨ ç»“æ„ æ ‡ç­¾å { CSS å±æ€§å: å±æ€§å€¼; } ä½œç”¨ é€šè¿‡ æ ‡ç­¾åï¼Œæ‰¾åˆ°é¡µé¢ä¸­ æ‰€æœ‰è¿™ç±» æ ‡ç­¾ï¼Œè®¾ç½®æ ·å¼ æ³¨æ„ æ ‡ç­¾é€‰æ‹©å™¨é€‰æ‹©çš„æ˜¯ä¸€ç±»æ ‡ç­¾ï¼Œè€Œä¸æ˜¯å•ç‹¬æŸä¸€ä¸ª æ ‡ç­¾é€‰æ‹©å™¨æ— è®ºåµŒå¥—å…³ç³»æœ‰å¤šæ·±ï¼Œéƒ½èƒ½æ‰¾åˆ°å¯¹åº”çš„æ ‡ç­¾ æ ‡ç­¾é€‰æ‹©å™¨ æ— æ³•å·®å¼‚åŒ– åŒåæ ‡ç­¾çš„æ˜¾ç¤ºæ•ˆæœ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style /* é€‰æ‹©å™¨ */ /* æ ‡ç­¾é€‰æ‹©å™¨ å°±æ˜¯ ä»¥æ ‡ç­¾åå‘½åçš„é€‰æ‹©å™¨ */ p color: red; /* æ ‡ç­¾é€‰æ‹©å™¨ é€‰ä¸­æ‰€æœ‰çš„è¿™ä¸ªæ ‡ç­¾éƒ½ç”Ÿæ•ˆcss */ /style/headbody ppppppppp/p pè¿™ä¸ªpæ˜¯ä»€ä¹ˆé¢œè‰²å‘¢/p p2222/p/body/html ç±»é€‰æ‹©å™¨ ç»“æ„ .ç±»å { CSS å±æ€§å: å±æ€§å€¼; } ä½œç”¨ é€šè¿‡ç±»åï¼Œæ‰¾åˆ°é¡µé¢ä¸­ æ‰€æœ‰ å¸¦æœ‰è¿™ä¸ªç±»åçš„æ ‡ç­¾ï¼Œè®¾ç½®æ ·å¼ æ³¨æ„ æ‰€æœ‰æ ‡ç­¾ä¸Šéƒ½æœ‰ class å±æ€§ï¼Œclass å±æ€§çš„å±æ€§å€¼ç§°ä¸ºç±»åï¼ˆç±»ä¼¼äºåå­—ï¼‰ ç±»åå¯ä»¥ç”±æ•°å­—ã€å­—æ¯ã€ä¸‹åˆ’çº¿ã€ä¸­åˆ’çº¿ç»„æˆï¼Œä½†ä¸èƒ½ä»¥æ•°å­—æˆ–è€…ä¸­åˆ’çº¿å¼€å¤´ ä¸€ä¸ªæ ‡ç­¾å¯ä»¥åŒæ—¶æœ‰ å¤šä¸ªç±»åï¼Œç±»åä¹‹é—´ä»¥ ç©ºæ ¼ éš”å¼€ ç±»åå¯ä»¥é‡å¤ï¼Œä¸€ä¸ªç±»é€‰æ‹©å™¨å¯ä»¥åŒæ—¶é€‰ä¸­å¤šä¸ªæ ‡ç­¾ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style .red color: red; .size font-size: 66px; /style/headbody !-- ç±»: å®šä¹‰ å’Œ ä½¿ç”¨æ‰èƒ½ç”Ÿæ•ˆ -- p111/p !-- ä¸€ä¸ªæ ‡ç­¾å¯ä»¥ä½¿ç”¨å¤šä¸ªç±»å , éœ€è¦ç©ºæ ¼éš”å¼€å³å¯ -- p class=red size222/p div class=redè¿™ä¸ªæ ‡ç­¾æ–‡å­—ä¹Ÿè¦å˜çº¢/div/body/html id é€‰æ‹©å™¨ ç»“æ„ #id å±æ€§å€¼ { CSS å±æ€§å: å±æ€§å€¼; } ä½œç”¨ é€šè¿‡ id å±æ€§å€¼ï¼Œæ‰¾åˆ°é¡µé¢ä¸­å¸¦æœ‰è¿™ä¸ª id å±æ€§å€¼çš„æ ‡ç­¾ï¼Œè®¾ç½®æ ·å¼ æ³¨æ„ æ‰€æœ‰æ ‡ç­¾ä¸Šéƒ½æœ‰ id å±æ€§ id å±æ€§å€¼ç±»ä¼¼äºèº«ä»½è¯å·ç ï¼Œåœ¨ä¸€ä¸ªé¡µé¢ä¸­æ˜¯å”¯ä¸€çš„ï¼Œä¸å¯é‡å¤çš„ï¼ ä¸€ä¸ªæ ‡ç­¾ä¸Šåªèƒ½æœ‰ä¸€ä¸ª id å±æ€§å€¼ ä¸€ä¸ª id é€‰æ‹©å™¨åªèƒ½é€‰ä¸­ä¸€ä¸ªæ ‡ç­¾ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style /* å®šä¹‰idé€‰æ‹©å™¨ */ #blue color: skyblue; /style/headbody div id=blueè¿™ä¸ªdivæ–‡å­—æ˜¯è“è‰²çš„/div p id=blue111/p/body/html ç±»ä¸ id çš„åŒºåˆ« class ç±»åä¸ id å±æ€§å€¼çš„åŒºåˆ« class ç±»åç›¸å½“äºå§“åï¼Œå¯ä»¥é‡å¤ï¼Œä¸€ä¸ªæ ‡ç­¾å¯ä»¥åŒæ—¶æœ‰å¤šä¸ª class ç±»å id å±æ€§å€¼ç›¸å½“äºèº«ä»½è¯å·ç ï¼Œä¸å¯é‡å¤ï¼Œä¸€ä¸ªæ ‡ç­¾åªèƒ½æœ‰ä¸€ä¸ª id å±æ€§å€¼ ç±»é€‰æ‹©å™¨ä¸ id é€‰æ‹©å™¨çš„åŒºåˆ« ç±»é€‰æ‹©å™¨ä»¥ . å¼€å¤´ id é€‰æ‹©å™¨ä»¥ # å¼€å¤´ å®é™…å¼€å‘çš„æƒ…å†µ ç±»é€‰æ‹©å™¨ç”¨çš„æœ€å¤š id ä¸€èˆ¬é…åˆ js ä½¿ç”¨ï¼Œé™¤éç‰¹æ®Šæƒ…å†µï¼Œå¦åˆ™ä¸è¦ä½¿ç”¨ id è®¾ç½®æ ·å¼ å®é™…å¼€å‘ä¸­ä¼šé‡åˆ° å†—ä½™ä»£ç çš„æŠ½å– ï¼ˆå¯ä»¥å°†ä¸€äº›å…¬å…±çš„ä»£ç æŠ½å–åˆ°ä¸€ä¸ªå…¬å…±çš„ç±»ä¸­å»ï¼‰ é€šé…ç¬¦é€‰æ‹©å™¨ ç»“æ„ * { å±æ€§å: å±æ€§å€¼; } ä½œç”¨ æ‰¾åˆ°é¡µé¢ä¸­ æ‰€æœ‰çš„æ ‡ç­¾ï¼Œè®¾ç½®æ ·å¼ æ³¨æ„ å¼€å‘ä¸­ä½¿ç”¨æå°‘ï¼Œåªä¼šåœ¨æç‰¹æ®Šæƒ…å†µä¸‹æ‰ä¼šç”¨åˆ° å¯èƒ½ä¼šç”¨äºå»é™¤æ ‡ç­¾é»˜è®¤çš„ margin å’Œ paddingï¼ˆåç»­è®²è§£ï¼‰ * margin: 0; padding: 0; ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style * color: red; /style/headbody divdiv/div ppppp/p h1h1/h1 spanspan/span ppppp/p h2h2/h2/body/html å¤åˆé€‰æ‹©å™¨åä»£é€‰æ‹©å™¨ï¼šç©ºæ ¼ ç»“æ„ é€‰æ‹©å™¨ 1 é€‰æ‹©å™¨ 2 { } ä½œç”¨ æ ¹æ® HTML æ ‡ç­¾çš„åµŒå¥—å…³ç³»ï¼Œé€‰æ‹©çˆ¶å…ƒç´  åä»£ä¸­ æ»¡è¶³æ¡ä»¶çš„å…ƒç´  æ³¨æ„ åä»£åŒ…æ‹¬ï¼šå„¿å­ã€å­™å­ã€é‡å­™å­â€¦â€¦ åä»£é€‰æ‹©å™¨ä¸­ï¼Œé€‰æ‹©å™¨ä¸é€‰æ‹©å™¨ä¹‹å‰é€šè¿‡ ç©ºæ ¼ éš”å¼€ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style /* æ‰¾åˆ°divçš„å„¿å­pè®¾ç½®æ–‡å­—é¢œè‰²æ˜¯çº¢è‰² */ /* çˆ¶é€‰æ‹©å™¨ åä»£é€‰æ‹©å™¨ */ div p color: red; /style/headbody !-- åä»£: å„¿å­, å­™å­, é‡å­™å­..... -- pè¿™æ˜¯ä¸€ä¸ªpæ ‡ç­¾/p div p è¿™æ˜¯divçš„å„¿å­p pè¿™æ˜¯å­™å­/p /p /div/body/html å­ä»£é€‰æ‹©å™¨ï¼š ç»“æ„ é€‰æ‹©å™¨ 1 é€‰æ‹©å™¨ 2 { } ä½œç”¨ æ ¹æ® HTML æ ‡ç­¾çš„åµŒå¥—å…³ç³»ï¼Œé€‰æ‹©çˆ¶å…ƒç´  å­ä»£ä¸­ æ»¡è¶³æ¡ä»¶çš„å…ƒç´  æ³¨æ„ å­ä»£åªåŒ…æ‹¬ï¼šå„¿å­ å­ä»£é€‰æ‹©å™¨ä¸­ï¼Œé€‰æ‹©å™¨ä¸é€‰æ‹©å™¨ä¹‹å‰é€šè¿‡ éš”å¼€ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style /* ç©ºæ ¼éš”å¼€çš„æ˜¯åä»£, å„¿å­,å­™å­,é‡å­™å­ */ /* div a color: red; */ /* åªæƒ³é€‰ä¸­å„¿å­a */ /* divçš„å„¿å­aæ–‡å­—é¢œè‰²æ˜¯çº¢è‰² */ diva color: red; /style/headbody div çˆ¶çº§ a href=#è¿™æ˜¯divé‡Œé¢çš„a/a p a href=#è¿™æ˜¯divé‡Œé¢çš„pé‡Œé¢çš„a/a /p /div/body/html å¹¶é›†é€‰æ‹©å™¨ ç»“æ„ é€‰æ‹©å™¨ 1 , é€‰æ‹©å™¨ 2 { } ä½œç”¨ åŒæ—¶é€‰æ‹©å¤šç»„æ ‡ç­¾ï¼Œè®¾ç½®ç›¸åŒçš„æ ·å¼ æ³¨æ„ å¹¶é›†é€‰æ‹©å™¨ä¸­çš„æ¯ç»„é€‰æ‹©å™¨ä¹‹é—´é€šè¿‡ , åˆ†éš” å¹¶é›†é€‰æ‹©å™¨ä¸­çš„æ¯ç»„é€‰æ‹©å™¨å¯ä»¥æ˜¯åŸºç¡€é€‰æ‹©å™¨æˆ–è€…å¤åˆé€‰æ‹©å™¨ å¹¶é›†é€‰æ‹©å™¨ä¸­çš„æ¯ç»„é€‰æ‹©å™¨é€šå¸¸ä¸€è¡Œå†™ä¸€ä¸ªï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style /* p div span h1 æ–‡å­—é¢œè‰²æ˜¯çº¢è‰² */ /* é€‰æ‹©å™¨1, é€‰æ‹©å™¨2 */ p, div, span, h1 color: red; /style/headbody pppp/p divdiv/div spanspan/span h1h1/h1 h2h2/h2/body/html äº¤é›†é€‰æ‹©å™¨ï¼šç´§æŒ¨ç€ ç»“æ„ é€‰æ‹©å™¨ 1 é€‰æ‹©å™¨ 2 { } ä½œç”¨ é€‰ä¸­é¡µé¢ä¸­ åŒæ—¶æ»¡è¶³ å¤šä¸ªé€‰æ‹©å™¨çš„æ ‡ç­¾ã€‚ï¼ˆæ—¢åˆåŸåˆ™ï¼‰æ‰¾åˆ°é¡µé¢ä¸­ æ—¢ èƒ½è¢«é€‰æ‹©å™¨ 1 é€‰ä¸­ï¼Œåˆ èƒ½è¢«é€‰æ‹©å™¨ 2 é€‰ä¸­çš„æ ‡ç­¾ï¼Œè®¾ç½®æ ·å¼ æ³¨æ„ äº¤é›†é€‰æ‹©å™¨ä¸­çš„é€‰æ‹©å™¨ä¹‹é—´æ˜¯ç´§æŒ¨ç€çš„ï¼Œæ²¡æœ‰ä¸œè¥¿åˆ†éš” äº¤é›†é€‰æ‹©å™¨ä¸­å¦‚æœæœ‰æ ‡ç­¾é€‰æ‹©å™¨ï¼Œæ ‡ç­¾é€‰æ‹©å™¨å¿…é¡»å†™åœ¨æœ€å‰é¢ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style /* p color: red; */ /* .box color: red; */ /* å¿…é¡»æ˜¯pæ ‡ç­¾,è€Œä¸”æ·»åŠ äº†boxç±» */ p.box color: red; /* #dilireba color: red; */ .box1 color: green; /style/headbody !-- æ‰¾åˆ°ç¬¬ä¸€ä¸ªp,å¸¦boxç±»çš„, è®¾ç½®æ–‡å­—é¢œè‰²æ˜¯çº¢è‰² -- p class=box box1 id=dilirebaè¿™æ˜¯pæ ‡ç­¾:box/p p class=boxè¿™æ˜¯pæ ‡ç­¾:box/p ppppppp/p div class=boxè¿™æ˜¯divæ ‡ç­¾:box/div/body/html åµŒå¥—é€‰æ‹©å™¨ ç»“æ„ parentRule /* çˆ¶è§„åˆ™æ ·å¼å±æ€§ */ childRule /* å­è§„åˆ™æ ·å¼å±æ€§ */ ä½œç”¨ å®ƒæä¾›å°†ä¸€ä¸ªæ ·å¼è§„åˆ™åµŒå¥—è‡³å¦ä¸€ä¸ªè§„åˆ™å†…çš„èƒ½åŠ›ã€‚ ç¤ºä¾‹ html p class=example è¿™æ®µæ–‡å­—a href=#åŒ…å«ä¸€ä¸ªé“¾æ¥/aï¼Œå°è¯•æ‚¬åœæˆ–èšç„¦å®ƒã€‚ /p style /* .example font-family: system-ui; font-size: 1.2rem; .example a color: tomato; .example a:hover, .example a:focus color: ivory; background-color: tomato; */ .example font-family: system-ui; font-size: 1.2rem; a color: tomato; :hover, :focus color: ivory; background-color: tomato; /style/html html !-- å¦‚æœä¸åœ¨ä¸€ä¸ªåµŒå¥—è§„åˆ™é‡Œä½¿ç”¨ï¼Œåˆ™ åµŒå¥—é€‰æ‹©å™¨å°†ä»£è¡¨å…¶æ ¹ä½œç”¨åŸŸã€‚ -- påœ¨ç»“æœæ¡†ä¸Šæ–¹æ‚¬åœä»¥æ›´æ”¹æ–‡æ¡£çš„èƒŒæ™¯é¢œè‰²ã€‚/p style color: blue; font-weight: bold; :hover background-color: wheat; /style/html hover ä¼ªç±»é€‰æ‹©å™¨ ä¼ªç±»ï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/CSS/Pseudo-classes ç»“æ„ é€‰æ‹©å™¨: hover { } ä½œç”¨ é€‰ä¸­é¼ æ ‡ æ‚¬åœ åœ¨å…ƒç´ ä¸Šçš„ çŠ¶æ€ï¼Œè®¾ç½®æ ·å¼ æ³¨æ„ ä¼ªç±»é€‰æ‹©å™¨é€‰ä¸­çš„å…ƒç´ çš„ æŸç§çŠ¶æ€ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style /* æ‚¬åœçš„æ—¶å€™æ–‡å­—é¢œè‰²æ˜¯çº¢è‰² */ a:hover color: red; background-color: green; /* ç”¨æˆ·é¼ æ ‡æ‚¬åœåˆ°divçš„æ—¶å€™, æ–‡å­—æ˜¯ç»¿è‰² */ div:hover color: green; /style/headbody a href=#è¿™æ˜¯è¶…é“¾æ¥/a !-- ä»»ä½•æ ‡ç­¾éƒ½å¯ä»¥æ·»åŠ ä¼ªç±», ä»»ä½•ä¸€ä¸ªæ ‡ç­¾éƒ½å¯ä»¥é¼ æ ‡æ‚¬åœ -- divdiv/div/body/html ä¼ªç±»-è¶…é“¾æ¥ è¶…é“¾æ¥ä¸€å…±æœ‰å››ä¸ªçŠ¶æ€ é€‰æ‹©å™¨ ä½œç”¨ : link è®¿é—®å‰ : visted è®¿é—®å : hover é¼ æ ‡æ‚¬åœ : active ç‚¹å‡»æ—¶ï¼ˆæ¿€æ´»ï¼‰ æç¤ºï¼šå¦‚æœè¦ç»™è¶…é“¾æ¥è®¾ç½®ä»¥ä¸Šå››ä¸ªçŠ¶æ€ï¼Œéœ€è¦æŒ‰ç…§ LVHA çš„é¡ºåºä¹¦å†™ã€‚ ç»“æ„ä¼ªç±»é€‰æ‹©å™¨ ç»“æ„ é€‰æ‹©å™¨ è¯´æ˜ E: first-child{} åŒ¹é…çˆ¶å…ƒç´ ä¸­ç¬¬ä¸€ä¸ªå­å…ƒç´ ï¼Œå¹¶ä¸”æ˜¯ E å…ƒç´  E: last-child{} åŒ¹é…çˆ¶å…ƒç´ ä¸­æœ€åä¸ªå­å…ƒç´ ï¼Œå¹¶ä¸”æ˜¯ E å…ƒç´  E: nth-child(n){} åŒ¹é…çˆ¶å…ƒç´ ä¸­ç¬¬ n ä¸ªå­å…ƒç´ ï¼Œå¹¶ä¸”æ˜¯ E å…ƒç´  E: nth-last-child(n){} åŒ¹é…çˆ¶å…ƒç´ ä¸­å€’æ•°ç¬¬ n ä¸ªå­å…ƒç´ ï¼Œå¹¶ä¸”æ˜¯ E å…ƒç´  ä½œç”¨ æ ¹æ®å…ƒç´ åœ¨ HTML ä¸­çš„ ç»“æ„å…³ç³» æŸ¥æ‰¾å…ƒç´  åœºæ™¯ å¸¸ç”¨äºæŸ¥æ‰¾æŸçˆ¶çº§é€‰æ‹©å™¨ä¸­çš„å­å…ƒç´  æ³¨æ„ n ä¸ºï¼š0ã€1ã€2ã€3ã€4ã€â€¦â€¦ é€šè¿‡ n å¯ä»¥ç»„æˆå¸¸è§å…¬å¼ åŠŸèƒ½ å…¬å¼ å¶æ•° 2nã€even å¥‡ä¹¦ 2n+1ã€2n-1ã€odd æ‰¾åˆ°å‰ 5 ä¸ª -n+5 æ‰¾åˆ°ä»ç¬¬ 5 ä¸ªå¾€å n+5 ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title !-- style /* ç¬¬ä¸€ä¸ªlié‡Œé¢çš„a */ li:first-child a /* background-color: green; */ color: red; /style -- style /* æ‰¾åˆ°ç¬¬ä¸€ä¸ªli é‡Œé¢çš„ ç¬¬ä¸‰ä¸ªa è®¾ç½®æ–‡å­—é¢œè‰²æ˜¯çº¢è‰² */ li:first-child a:nth-child(3) color: red; /style/headbody ul li a href=#è¿™æ˜¯ç¬¬1ä¸ªlié‡Œé¢çš„a1/a a href=#è¿™æ˜¯ç¬¬1ä¸ªlié‡Œé¢çš„a2/a !-- é€‰ä¸­ç¬¬ä¸‰ä¸ªa -- a href=#è¿™æ˜¯ç¬¬1ä¸ªlié‡Œé¢çš„a3/a a href=#è¿™æ˜¯ç¬¬1ä¸ªlié‡Œé¢çš„a4/a a href=#è¿™æ˜¯ç¬¬1ä¸ªlié‡Œé¢çš„a5/a /li lia href=#è¿™æ˜¯ç¬¬2ä¸ªlié‡Œé¢çš„a/a/li lia href=#è¿™æ˜¯ç¬¬3ä¸ªlié‡Œé¢çš„a/a/li lia href=#è¿™æ˜¯ç¬¬4ä¸ªlié‡Œé¢çš„a/a/li lia href=#è¿™æ˜¯ç¬¬5ä¸ªlié‡Œé¢çš„a/a/li lia href=#è¿™æ˜¯ç¬¬6ä¸ªlié‡Œé¢çš„a/a/li lia href=#è¿™æ˜¯ç¬¬7ä¸ªlié‡Œé¢çš„a/a/li lia href=#è¿™æ˜¯ç¬¬8ä¸ªlié‡Œé¢çš„a/a/li /ul/body/html ä¼ªå…ƒç´ é€‰æ‹©å™¨ ç»“æ„ é€‰æ‹©å™¨ è¯´æ˜ E:: before åœ¨ E å…ƒç´  é‡Œé¢ æœ€ å‰ é¢æ·»åŠ ä¸€ä¸ªä¼ªå…ƒç´  E:: after åœ¨ E å…ƒç´  é‡Œé¢ æœ€ å é¢æ·»åŠ ä¸€ä¸ªä¼ªå…ƒç´  ä½œç”¨ åˆ›å»º è™šæ‹Ÿ å…ƒç´ ï¼ˆä¼ªå…ƒç´ ï¼‰ï¼Œç”¨æ¥æ‘†æ”¾ è£…é¥°æ€§ çš„å†…å®¹ æ³¨æ„ å¿…é¡» è®¾ç½® content: â€ â€ å±æ€§ï¼Œç”¨æ¥ è®¾ç½® ä¼ªå…ƒç´ çš„å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰å†…å®¹ï¼Œåˆ™å¼•å· ç•™ç©º å³å¯ã€‚ ä¼ªå…ƒç´ é»˜è®¤æ˜¯ è¡Œå†… æ˜¾ç¤ºæ¨¡å¼ æƒé‡ å’Œ æ ‡ç­¾é€‰æ‹©å™¨ ç›¸åŒ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleä¼ªå…ƒç´ é€‰æ‹©å™¨/title style div::after display: block; content: afterä¼ªå…ƒç´ ; width: 300px; height: 300px; background-color: pink; /style/headbody !-- æ ‡ç­¾å†…å®¹ï¼šè€é¼ çˆ±å¤§ç±³ -- divçˆ±/div/body/html é“¾æ¥ä¼ªç±»é€‰æ‹©å™¨ ç»“æ„ é€‰æ‹©å™¨è¯­æ³• åŠŸèƒ½ a: link { } é€‰ä¸­ a é“¾æ¥ æœªè®¿é—®è¿‡ çš„çŠ¶æ€ a: visited { } é€‰ä¸­ a é“¾æ¥ è®¿é—®è¿‡å çš„çŠ¶æ€ a: hover { } é€‰ä¸­ é¼ æ ‡æ‚¬åœ çš„çŠ¶æ€ a: active { } é€‰ä¸­ é¼ æ ‡æŒ‰ä¸‹ çš„çŠ¶æ€ åœºæ™¯ å¸¸ç”¨äºé€‰ä¸­è¶…é“¾æ¥çš„ä¸åŒçŠ¶æ€ æ³¨æ„ å¦‚æœéœ€è¦åŒæ—¶å®ç°ä»¥ä¸Šå››ç§ä¼ªç±»çŠ¶æ€æ•ˆæœï¼Œéœ€è¦æŒ‰ç…§ LVHA é¡ºåºä¹¦å†™ å…¶ä¸­ : hover ä¼ªç±»é€‰æ‹©å™¨ ä½¿ç”¨æ›´ä¸ºé¢‘ç¹ï¼Œå¸¸ç”¨äºé€‰æ‹©å„ç±»å…ƒç´ çš„æ‚¬åœçŠ¶æ€ ç„¦ç‚¹ä¼ªç±»é€‰æ‹©å™¨ ç»“æ„ input: focus {} åœºæ™¯ ç”¨äºé€‰ä¸­å…ƒç´ è·å–ç„¦ç‚¹æ—¶çŠ¶æ€ï¼Œå¸¸ç”¨äºè¡¨å•æ§ä»¶ ç¤ºä¾‹ input:focus background-color: pink; å­—ä½“å’Œæ–‡æœ¬æ ·å¼å­—ä½“æ ·å¼å­—ä½“å¤§å° å±æ€§å font-size å–å€¼ æ–‡å­—å°ºå¯¸ï¼ŒPC ç«¯ç½‘é¡µæœ€å¸¸ç”¨çš„å•ä½ px æ³¨æ„ç‚¹ è°·æ­Œæµè§ˆå™¨é»˜è®¤æ–‡å­—å¤§å°æ˜¯ 16px å•ä½éœ€è¦è®¾ç½®ï¼Œå¦åˆ™æ— æ•ˆ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleå­—ä½“å¤§å°/title style /* ç»éªŒï¼šè°·æ­Œæµè§ˆå™¨æ–‡å­—æœ‰é»˜è®¤å¤§å° 16px */ p /* font-size å±æ€§å¿…é¡»æœ‰å•ä½ï¼Œå¦åˆ™å±æ€§ä¸ç”Ÿæ•ˆ */ font-size: 30px; /style/headbody pæµ‹è¯•å­—ä½“å¤§å°/p divæµ‹è¯•é»˜è®¤å­—ä½“å¤§å°/div/body/html å­—ä½“ç²—ç»† å±æ€§å font-weight å–å€¼ æ•°å­—ï¼ˆå¼€å‘ä½¿ç”¨ï¼‰ æ­£å¸¸ 400 åŠ ç²— 700 å…³é”®å­— æ­£å¸¸ normal åŠ ç²— bold ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleå­—ä½“ç²—ç»†/title style h3 font-weight: 700; div font-weight: bold; /style/headbody h3h3 æ ‡é¢˜/h3 divdiv æ ‡ç­¾/div/body/html å­—ä½“æ ·å¼ï¼ˆæ˜¯å¦å€¾æ–œï¼‰ å±æ€§å font-style å–å€¼ æ­£å¸¸ï¼šnormal å€¾æ–œï¼šitalic ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleå­—ä½“å€¾æ–œ/title style em font-style: normal; div font-style: italic; /style/headbody emem æ ‡ç­¾/em divdiv æ ‡ç­¾/div/body/html è¡Œé«˜ ä½œç”¨ æ§åˆ¶ä¸€è¡Œçš„ä¸Šä¸‹è¡Œé—´è· å±æ€§å line-height å–å€¼ï¼š æ•°å­—+px å€æ•°ï¼ˆå½“å‰æ ‡ç­¾ font-size çš„å€æ•°ï¼‰ åº”ç”¨ï¼š è®©å•è¡Œæ–‡æœ¬å‚ç›´å±…ä¸­å¯ä»¥è®¾ç½® line-height : æ–‡å­—çˆ¶å…ƒç´ é«˜åº¦ ç½‘é¡µç²¾å‡†å¸ƒå±€æ—¶ï¼Œä¼šè®¾ç½® line-height : 1 å¯ä»¥å–æ¶ˆä¸Šä¸‹é—´è· è¡Œé«˜ä¸ font è¿å†™çš„æ³¨æ„ç‚¹ï¼š å¦‚æœåŒæ—¶è®¾ç½®äº†è¡Œé«˜å’Œ font è¿å†™ï¼Œæ³¨æ„è¦†ç›–é—®é¢˜ font : style weight size line-height family ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleè¡Œé«˜/title style p font-size: 20px; /* line-height: 30px; */ /* è¡Œé«˜å€¼æ˜¯æ•°å­—ï¼Œè¡¨ç¤ºæ˜¯å½“å‰æ ‡ç­¾å­—ä½“å¤§å°çš„å€æ•° */ line-height: 2; /style/headbody pä»Šå¹´å—æˆæœ¬é©±åŠ¨ã€éœ€æ±‚æ‹‰åŠ¨ä»¥åŠå…¨çƒç²®ä»·ä¸Šæ¶¨ç­‰å„ç§å› ç´ å åŠ å½±å“ï¼Œæˆ‘å›½ç²®é£Ÿä»·æ ¼æ•´ä½“ä¸Šæ‰¬ï¼Œå°éº¦ã€ç‰ç±³ã€å¤§è±†ä»·æ ¼é«˜ä½æ³¢åŠ¨ï¼Œæ°´ç¨»ä»·æ ¼è¿è¡Œå¹³ç¨³ï¼Œä¼˜è´¨ä¼˜ä»·ç‰¹å¾æ˜æ˜¾ï¼Œå†œæ°‘æ‹©æœºæ‹©æ—¶å”®ç²®ï¼Œå®ç°ç§ç²®æ”¶ç›Šæœ€å¤§åŒ–ã€‚ä½†ç§ç²®æˆæœ¬æŒç»­æ”€å‡æˆä¸ºå½±å“å†œæ°‘å¢æ”¶çš„â€œæ‹¦è·¯è™â€ã€‚è¿™æ˜¯å› ä¸ºï¼Œåœ¨å»å¹´é«˜ç²®ä»·çš„åˆºæ¿€ä¸‹ï¼Œä»Šå¹´åœŸåœ°ç§Ÿé‡‘ä»¥åŠåŒ–è‚¥ã€å†œè¯ã€æŸ´æ²¹ç­‰å†œèµ„ä»·æ ¼å¤§å¹…ä¸Šæ¶¨ï¼Œç§ç²®æˆæœ¬éšä¹‹å¢åŠ ã€‚åŠ ä¹‹ä»Šå¹´ç²®é£Ÿç”Ÿäº§é­é‡å»å¹´åŒ—æ–¹ç½•è§ç§‹é›¨ç§‹æ±›ã€ä»Šå¹´â€œå—æ—±åŒ—æ¶â€ç­‰æç«¯å¤©æ°”ï¼Œè™½ç„¶æ²¡æœ‰å¸¦æ¥ç¾å®³æ€§åæœï¼Œä½†ä¸€äº›å†œæˆ·ä¸ºæŠ—ç¾ä»˜å‡ºæ›´å¤šç”Ÿäº§æˆæœ¬ï¼Œç§ç²®å†œæˆ·æ”¶ç›Šç©ºé—´è¿›ä¸€æ­¥æ”¶çª„ã€‚/p/body/html è¡Œé«˜çš„æµ‹é‡æ–¹æ³•ï¼š ä»ä¸€è¡Œæ–‡å­—çš„æœ€é¡¶ç«¯ï¼ˆæœ€åº•ç«¯ï¼‰é‡åˆ°ä¸‹ä¸€è¡Œæ–‡å­—çš„æœ€é¡¶ç«¯ï¼ˆæœ€åº•ç«¯ï¼‰ã€‚ è¡Œé«˜-å‚ç›´å±…ä¸­ å‚ç›´å±…ä¸­æŠ€å·§ è¡Œé«˜å±æ€§å€¼ç­‰äºç›’å­é«˜åº¦å±æ€§å€¼ æ³¨æ„ è¯¥æŠ€å·§é€‚ç”¨äºå•è¡Œæ–‡å­—å‚ç›´å±…ä¸­æ•ˆæœ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleå‚ç›´å±…ä¸­/title style div height: 100px; background-color: skyblue; /* æ³¨æ„ï¼šåªèƒ½æ˜¯å•è¡Œæ–‡å­—å‚ç›´å±…ä¸­ */ line-height: 100px; /style/headbody divæ–‡å­—/div/body/html å­—ä½“æ— å±æ€§å font-family å–å€¼ å­—ä½“å 1, å­—ä½“å 2â€¦., å­—ä½“æ—åï¼ˆå¯ä»¥åªå†™ä¸€ä¸ªå­—ä½“åï¼‰ æ³¨æ„ ä»å·¦å‘å³ä¾æ¬¡æŸ¥æ‰¾ å»ºè®® font-family å±æ€§æœ€åè®¾ç½®ä¸€ä¸ªå­—ä½“æ—å ç½‘é¡µå¼€å‘å»ºè®®ä½¿ç”¨æ— è¡¬çº¿å­—ä½“ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleå­—ä½“æ—/title style div font-family: æ¥·ä½“; /style/headbody divæµ‹è¯•æ–‡å­—/div/body/html æ ·å¼å±‚å é—®é¢˜ é—®é¢˜ ç»™åŒä¸€ä¸ªæ ‡ç­¾è®¾ç½®äº†ç›¸åŒçš„æ ·å¼ï¼Œæ­¤æ—¶æµè§ˆå™¨ä¼šå¦‚ä½•æ¸²æŸ“å‘¢ï¼Ÿ ç»“æœ å¦‚æœç»™åŒä¸€ä¸ªæ ‡ç­¾è®¾ç½®äº†ç›¸åŒçš„å±æ€§ï¼Œæ­¤æ—¶æ ·å¼ä¼šå±‚å ï¼ˆè¦†ç›–ï¼‰ï¼Œå†™åœ¨æœ€ä¸‹é¢çš„ä¼šç”Ÿæ•ˆ TIPS CSS ï¼ˆCascading style sheetsï¼‰ å±‚å æ ·å¼è¡¨ æ‰€è°“çš„å±‚å å³å åŠ çš„æ„æ€ï¼Œè¡¨ç¤ºæ ·å¼å¯ä»¥ä¸€å±‚ä¸€å±‚çš„å±‚å è¦†ç›– å­—ä½“ font ç›¸å…³å±æ€§è¿å†™ å±æ€§å font (å¤åˆå±æ€§) å–å€¼ font : style weight size family; çœç•¥è¦æ±‚ åªèƒ½çœç•¥å‰ä¸¤ä¸ªï¼Œå¦‚æœçœç•¥äº†ç›¸å½“äºè®¾ç½®äº†é»˜è®¤å€¼ æ³¨æ„ç‚¹ï¼šå¦‚æœéœ€è¦åŒæ—¶è®¾ç½®å•ç‹¬å’Œè¿å†™å½¢å¼ è¦ä¹ˆæŠŠå•ç‹¬çš„æ ·å¼å†™åœ¨è¿å†™çš„ä¸‹é¢ è¦ä¹ˆæŠŠå•ç‹¬çš„æ ·å¼å†™åœ¨è¿å†™çš„é‡Œé¢ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style p /* font-size: ; font-style: ; font-weight: ; font-family: ; */ /* font: style weight size å­—ä½“; */ /* font: italic 700 66px å®‹ä½“; font-style: normal; */ font: 100px å¾®è½¯é›…é»‘; /* ä¸€ä¸ªå±æ€§å†’å·åé¢ä¹¦å†™å¤šä¸ªå€¼çš„å†™æ³• -- å¤åˆå±æ€§ */ /style/headbody pè¿™æ˜¯pæ ‡ç­¾/p/body/html æ–‡æœ¬æ ·å¼æ–‡æœ¬ç¼©è¿› å±æ€§å text-indent å–å€¼ æ•°å­—+px æ•°å­—+emï¼ˆæ¨èï¼š1em å½“å‰æ ‡ç­¾çš„ font-size çš„å¤§å°ï¼‰ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style p /* text-indent: 50px; */ /* é¦–è¡Œç¼©è¿›2ä¸ªå­—çš„å¤§å° */ /* é»˜è®¤å­—å·: 16px ; 32 */ /* text-indent: 40px; font-size: 20px; */ /* em: ä¸€ä¸ªå­—çš„å¤§å° */ text-indent: 2em; font-size: 40px; /style/headbody p2019å¹´ï¼Œäº‹ä»¶è§†ç•Œæœ›è¿œé•œå›¢é˜Ÿè®©ä¸–ç•Œé¦–æ¬¡çœ‹åˆ°äº†é»‘æ´çš„æ ·å­ã€‚ä¸è¿‡ï¼Œç ”ç©¶äººå‘˜å…¬å¸ƒçš„è¿™å¼ å‘å…‰ç¯å½¢ç‰©ä½“çš„å›¾åƒå¹¶ä¸æ˜¯ä¼ ç»Ÿçš„å›¾ç‰‡ï¼Œè€Œæ˜¯ç»è¿‡è®¡ç®—è·å¾—çš„ã€‚åˆ©ç”¨ä½äºç¾å›½ã€å¢¨è¥¿å“¥ã€æ™ºåˆ©ã€è¥¿ç­ç‰™å’Œå—æåœ°åŒºçš„å°„ç”µæœ›è¿œé•œæ‰€å¾—åˆ°çš„æ•°æ®ï¼Œç ”ç©¶äººå‘˜è¿›è¡Œäº†æ•°å­¦è½¬æ¢ï¼Œæœ€ç»ˆåˆæˆäº†è¿™å¼ æ ‡å¿—æ€§çš„å›¾ç‰‡ã€‚ç ”ç©¶å›¢é˜Ÿè¿˜å‘å¸ƒäº†å®ç°è¿™ä¸€å£®ä¸¾æ‰€ç”¨çš„ç¼–ç¨‹ä»£ç ï¼Œå¹¶æ’°æ–‡è®°å½•è¿™ä¸€å‘ç°ï¼Œå…¶ä»–ç ”ç©¶è€…ä¹Ÿå¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šè¿›ä¸€æ­¥åŠ ä»¥åˆ†æã€‚/p/body/html æ–‡æœ¬æ°´å¹³çº¿å¯¹é½æ–¹å¼ å±æ€§å text-align å–å€¼ å±æ€§å€¼ æ•ˆæœ left å·¦å¯¹é½ center å±…ä¸­å¯¹é½ right å³å¯¹é½ æ³¨æ„ å¦‚æœéœ€è¦è®©æ–‡æœ¬æ°´å¹³å±…ä¸­ï¼Œtext-align å±æ€§ç»™æ–‡æœ¬æ‰€åœ¨æ ‡ç­¾ï¼ˆæ–‡æœ¬çš„çˆ¶å…ƒç´ ï¼‰è®¾ç½® ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style h1 /* text-align: left; */ /* text-align: right; */ text-align: center; div text-align: center; /style/headbody h1æ–°é—»æ ‡é¢˜/h1 div img src=./images/1.jpg alt= /div/body/html æ–‡æœ¬ä¿®é¥°çº¿ å±æ€§å text-decoration å–å€¼ å±æ€§å€¼ æ•ˆæœ underline ä¸‹åˆ’çº¿ï¼ˆå¸¸ç”¨ï¼‰ line-through åˆ é™¤çº¿ï¼ˆä¸å¸¸ç”¨ï¼‰ overline ä¸Šåˆ’çº¿ï¼ˆå‡ ä¹ä¸ç”¨ï¼‰ none æ— è£…é¥°çº¿ï¼ˆå¸¸ç”¨ï¼‰ æ³¨æ„ å¼€å‘ä¸­ä¼šä½¿ç”¨ text-decoration : none ; æ¸…é™¤ a æ ‡ç­¾é»˜è®¤çš„ä¸‹åˆ’çº¿ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style div text-decoration: underline; p text-decoration: line-through; h2 text-decoration: overline; a text-decoration: none; /style/headbody divdiv/div pppp/p h2h2/h2 a href=#æˆ‘æ˜¯è¶…é“¾æ¥, ç‚¹å‘€/a/body/html æ–‡æœ¬é¢œè‰² å±æ€§å color å–å€¼ é¢œè‰²è¡¨ç¤ºæ–¹å¼ å±æ€§å€¼ è¯´æ˜ ä½¿ç”¨åœºæ™¯ é¢œè‰²å…³é”®å­— é¢œè‰²è‹±æ–‡å•è¯ redã€blue å­¦ä¹ æµ‹è¯• rgb è¡¨ç¤º rgb(r, g, b) r, g, b è¡¨ç¤ºçº¢ç»¿è“ä¸‰åŸè‰²ï¼Œå–å€¼ï¼š0-1 äº†è§£ rgba è¡¨ç¤º rgb(r, g, bï¼Œa) a è¡¨ç¤ºé€æ˜åº¦ï¼Œå–å€¼ï¼š0-1 å¼€å‘ä½¿ç”¨ï¼Œå®ç° é€æ˜è‰² åå…­è¿›åˆ¶è¡¨ç¤º #RRGGBB #000000ï¼Œ#ffcc00ï¼Œç®€å†™ï¼š#000ï¼Œ#fc0 å¼€å‘ä½¿ç”¨ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleæ–‡å­—é¢œè‰²/title style h1 background-color: aqua; /* color: red; */ /* color: rgb(0,255,0); */ /* color: rgba(0,0,0,0.8); */ /* color: #0000ff; */ color: #00f; /style/headbody h1h1 æ ‡ç­¾/h1/body/html èƒŒæ™¯ç›¸å…³å±æ€§èƒŒæ™¯è‰² å±æ€§å background-colorï¼ˆbgcï¼‰ å±æ€§å€¼ï¼š é¢œè‰²å–å€¼ï¼šå…³é”®å­—ã€rgb è¡¨ç¤ºæ³•ã€rgba è¡¨ç¤ºæ³•ã€åå…­è¿›åˆ¶â€¦â€¦ æ³¨æ„ç‚¹ï¼š èƒŒæ™¯é¢œè‰²é»˜è®¤å€¼æ˜¯ é€æ˜ï¼š rgba(0,0,0,0) ã€transparent èƒŒæ™¯é¢œè‰²ä¸ä¼šå½±å“ç›’å­å¤§å°ï¼Œå¹¶ä¸”è¿˜èƒ½çœ‹æ¸…ç›’å­çš„å¤§å°å’Œä½ç½®ï¼Œä¸€èˆ¬åœ¨å¸ƒå±€ä¸­ä¼šä¹ æƒ¯å…ˆç»™ç›’å­è®¾ç½®èƒŒæ™¯é¢œè‰² ç¤ºä¾‹ï¼š !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style div width: 400px; height: 400px; /* background-color: pink; */ /* background-color: #ccc; */ /* çº¢ç»¿è“ä¸‰åŸè‰², aæ˜¯é€æ˜åº¦0-1 */ /* background-color: rgba(0, 0, 0, 0.5); */ background-color: rgba(0, 0, 0, .5); /style/headbody divdiv/div/body/html èƒŒæ™¯å›¾èƒŒæ™¯å›¾ç‰‡ å±æ€§å background-imageï¼ˆbgiï¼‰ å±æ€§å€¼ï¼š background-image: url(â€˜å›¾ç‰‡è·¯å¾„â€™); æ³¨æ„ç‚¹ï¼š èƒŒæ™¯å›¾ç‰‡ä¸­ url ä¸­å¯ä»¥çœç•¥å¼•å· èƒŒæ™¯å›¾ç‰‡é»˜è®¤æ˜¯åœ¨æ°´å¹³å’Œå‚ç›´æ–¹å‘å¹³é“ºçš„ èƒŒæ™¯å›¾ç‰‡ä»…ä»…æ˜¯æŒ‡ç»™ç›’å­èµ·åˆ°è£…é¥°æ•ˆæœï¼Œç±»ä¼¼äºèƒŒæ™¯é¢œè‰²ï¼Œæ˜¯ ä¸èƒ½æ’‘å¼€ç›’å­çš„ ç¤ºä¾‹ï¼š !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style div width: 400px; height: 400px; background-color: pink; background-image: url(./images/1.jpg); /style/headbody divæ–‡å­—/div/body/html èƒŒæ™¯å›¾å¹³é“º å±æ€§å background-repeatï¼ˆbgrï¼‰ å±æ€§å€¼ï¼š å–å€¼ æ•ˆæœ repeat ï¼ˆé»˜è®¤å€¼ï¼‰æ°´å¹³å’Œå‚ç›´æ–¹å‘éƒ½å¹³é“º no-repeat ä¸å¹³é“º repeat-x æ²¿ç€æ°´å¹³æ–¹å‘ï¼ˆx è½´ï¼‰å¹³é“º repeat-y æ²¿ç€å‚ç›´æ–¹å‘ï¼ˆy å‘¨ï¼‰å¹³é“º ç¤ºä¾‹ï¼š !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleèƒŒæ™¯å›¾å¹³é“ºæ–¹å¼/title style div width: 400px; height: 400px; background-color: pink; background-image: url(./images/1.png); /* ä¸å¹³é“ºï¼šç›’å­çš„å·¦ä¸Šè§’æ˜¾ç¤ºä¸€å¼ èƒŒæ™¯å›¾ */ background-repeat: no-repeat; /* background-repeat: repeat; */ /* background-repeat: repeat-x; */ /* background-repeat: repeat-y; */ /style/headbody divdiv æ ‡ç­¾/div/body /html èƒŒæ™¯å›¾ä½ç½® å±æ€§å background-positionï¼ˆbgpï¼‰ å±æ€§å€¼ background-positionï¼šæ°´å¹³æ–¹å‘ å‚ç›´æ–¹å‘; å…³é”®å­— ä½ç½® left å·¦ä¾§ right å³ä¾§ center å±…ä¸­ top é¡¶éƒ¨ bottom åº•éƒ¨ åæ ‡ æ°´å¹³ï¼šæ­£æ•°å‘å³ï¼›è´Ÿæ•°å‘å·¦ å‚ç›´ï¼šæ­£æ•°å‘ä¸‹ï¼›è´Ÿæ•°å‘ä¸Š æ³¨æ„ç‚¹ æ–¹ä½åè¯å–å€¼å’Œåæ ‡å–å€¼å¯ä»¥æ··ä½¿ç”¨ï¼Œç¬¬ä¸€ä¸ªå–å€¼è¡¨ç¤ºæ°´å¹³ï¼Œç¬¬äºŒä¸ªå–å€¼è¡¨ç¤ºå‚ç›´ ç¤ºä¾‹ï¼š !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleèƒŒæ™¯å›¾ä½ç½®/title style div width: 400px; height: 400px; background-color: pink; background-image: url(./images/1.png); background-repeat: no-repeat; /* å·¦ä¸Šè§’ */ /* background-position: 0 0; */ /* background-position: left top; */ /* background-position: right bottom; */ /* æ°´å¹³ï¼šæ­£æ•°å‘å³ï¼Œè´Ÿæ•°å‘å·¦ */ /* background-position: 50px 0; */ /* background-position: -50px 0; */ /* å‚ç›´ï¼šæ­£æ•°å‘ä¸‹ï¼Œè´Ÿæ•°å‘ä¸Š */ /* background-position: 0 100px; */ /* background-position: 0 -100px; */ /* background-position: 50px center; */ /* ç‰¹æ®Šå†™æ³• */ /* background-position: bottom left; */ /* å…³é”®å­—å¯ä»¥åªå†™ä¸€ä¸ªï¼Œå¦ä¸€ä¸ªæ–¹å‘å±…ä¸­ */ /* background-position: bottom; */ /* åªå†™ä¸€ä¸ªæ•°å­—è¡¨ç¤ºæ°´å¹³æ–¹å‘ï¼Œå‚ç›´æ–¹å‘å±…ä¸­ */ background-position: 50px; /style/headbody divdiv æ ‡ç­¾/div/body/html èƒŒæ™¯å›¾ç¼©æ”¾ å±æ€§å background-sizeï¼ˆbgzï¼‰ å±æ€§å€¼ å…³é”®å­— coverï¼šç­‰æ¯”ä¾‹ç¼©æ”¾èƒŒæ™¯å›¾ç‰‡ä»¥å®Œå…¨è¦†ç›–èƒŒæ™¯åŒºï¼Œå¯èƒ½èƒŒæ™¯å›¾ç‰‡éƒ¨åˆ†çœ‹ä¸è§ containï¼šç­‰æ¯”ä¾‹ç¼©æ”¾èƒŒæ™¯å›¾ç‰‡ä»¥å®Œå…¨è£…å…¥èƒŒæ™¯åŒºï¼Œå¯èƒ½èƒŒæ™¯åŒºéƒ¨åˆ†ç©ºç™½ ç™¾åˆ†æ¯” æ ¹æ®ç›’å­å°ºå¯¸è®¡ç®—å›¾ç‰‡å¤§å° æ•°å­—+å•ä½ï¼ˆpxï¼‰ æ³¨æ„ç‚¹ å·¥ä½œä¸­ï¼Œå›¾ç‰‡æ¯”ä¾‹ä¸ç›’å­æ¯”ä¾‹ç›¸åŒï¼Œä½¿ç”¨ cover æˆ– contain ç¼©æ”¾èƒŒæ™¯å›¾æ•ˆæœç›¸åŒã€‚ ç¤ºä¾‹ï¼š !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleèƒŒæ™¯å›¾ç¼©æ”¾/title style div width: 500px; height: 300px; background-color: pink; background-image: url(./images/1.png); background-repeat: no-repeat; /* containï¼šå¦‚æœå›¾çš„å®½é«˜è·Ÿç›’å­å°ºå¯¸ç›¸ç­‰åœæ­¢ç¼©æ”¾ï¼Œå¯èƒ½å¯¼è‡´ç›’å­æœ‰éœ²ç™½ */ /* background-size: contain; */ /* coverï¼šå›¾ç‰‡å®Œå…¨è¦†ç›–ç›’å­ï¼Œå¯èƒ½å¯¼è‡´å›¾ç‰‡æ˜¾ç¤ºä¸å…¨ */ /* background-size: cover; */ /* 100% å›¾ç‰‡çš„å®½åº¦è·Ÿç›’å­å®½åº¦ä¸€æ ·ï¼Œå›¾ç‰‡çš„é«˜åº¦æŒ‰ç…§å›¾ç‰‡æ¯”ä¾‹ç­‰æ¯”ç¼©æ”¾ */ background-size: 100%; /style/headbody divdiv æ ‡ç­¾/div/body/html èƒŒæ™¯å›¾å›ºå®š å±æ€§å background-attachmentï¼ˆbgaï¼‰ ä½œç”¨ èƒŒæ™¯ä¸ä¼šéšç€å…ƒç´ çš„å†…å®¹æ»šåŠ¨ å±æ€§å€¼ fixed ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleèƒŒæ™¯å›¾å›ºå®š/title style body background-image: url(./images/bg.jpg); background-repeat: no-repeat; background-position: center top; background-attachment: fixed; /style/headbody pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p pæµ‹è¯•æ–‡å­—ï¼Œæ’‘å¼€bodyï¼Œè®©æµè§ˆå™¨æœ‰æ»šåŠ¨æ¡/p/body/html èƒŒæ™¯å¤åˆå±æ€§ å±æ€§å backgroundï¼ˆbgï¼‰ å±æ€§å€¼ å•ä¸ªå±æ€§å€¼çš„åˆå†™ï¼Œå–å€¼ä¹‹é—´ä»¥ç©ºæ ¼éš”å¼€ ä¹¦å†™é¡ºåº æ¨èï¼šbackgroundï¼šcolor image repeat position çœç•¥é—®é¢˜ å¯ä»¥æŒ‰ç…§éœ€æ±‚çœç•¥ ç‰¹æ®Šæƒ…å†µ åœ¨ pc ç«¯ï¼Œå¦‚æœç›’å­å¤§å°å’ŒèƒŒæ™¯å›¾ç‰‡å¤§å°ä¸€æ ·ï¼Œæ­¤æ—¶å¯ä»¥ç›´æ¥å†™ backgroundï¼šurl() æ³¨æ„ç‚¹ å¦‚æœéœ€è¦è®¾ç½®å•ç‹¬çš„æ ·å¼å’Œè¿å†™ è¦ä¹ˆæŠŠå•ç‹¬çš„æ ·å¼å†™åœ¨è¿å†™çš„ä¸‹é¢ è¦ä¹ˆæŠŠå•ç‹¬çš„æ ·å¼å†™åœ¨è¿å†™çš„é‡Œé¢ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style div width: 400px; height: 400px; /* ä¸åˆ†å…ˆåé¡ºåº èƒŒæ™¯è‰² èƒŒæ™¯å›¾ èƒŒæ™¯å›¾å¹³é“º èƒŒæ™¯å›¾ä½ç½® */ /* background: pink url(./images/1.jpg) no-repeat center bottom; */ /* èƒŒæ™¯å›¾ä½ç½®å¦‚æœæ˜¯è‹±æ–‡å•è¯å¯ä»¥é¢ å€’é¡ºåº */ background: pink url(./images/1.jpg) no-repeat bottom center ; /* æµ‹è¯•èƒŒæ™¯å›¾ä½ç½®å¦‚æœæ˜¯æ•°å€¼ ä¸è¦é¢ å€’é¡ºåº */ /* æ°´å¹³50px, å‚ç›´100px */ /* background: pink url(./images/1.jpg) no-repeat 50px 100px; */ background: pink url(./images/1.jpg) no-repeat 100px 50px; /style/headbody div/div/body/html å…ƒç´ æ˜¾ç¤ºæ¨¡å¼æ˜¾ç¤ºæ¨¡å¼ å—çº§å…ƒç´  æ˜¾ç¤ºç‰¹ç‚¹ï¼š ç‹¬å ä¸€è¡Œï¼ˆä¸€è¡Œåªèƒ½æ˜¾ç¤ºä¸€ä¸ªï¼‰ å®½åº¦é»˜è®¤æ˜¯çˆ¶å…ƒç´ çš„å®½åº¦ï¼Œé«˜åº¦é»˜è®¤ç”±å†…å®¹æ’‘å¼€ å¯ä»¥è®¾ç½®å®½é«˜ å—å…ƒç´ æ˜¯ä¸€ä¸ªå®¹å™¨åŠç›’å­ï¼Œå…¶ä¸­å¯ä»¥å†æ”¾ è¡Œå†…æˆ–è€…å—çº§å…ƒç´  ä»£è¡¨æ ‡ç­¾ï¼š h1~h6ã€pã€divã€ulã€olã€li è¡Œå†…å…ƒç´  æ˜¾ç¤ºç‰¹ç‚¹ï¼š ä¸€è¡Œå¯æ”¾å¤šä¸ªè¡Œå†…å…ƒç´ ï¼Œå³ç›¸é‚»è¡Œå†…å…ƒç´ åœ¨ä¸€è¡Œ å¯¹è¡Œå†…å…ƒç´ çš„ é«˜ã€å®½ç›´æ¥è®¾ç½®æ˜¯æ— æ•ˆ çš„ è¡Œå†…å…ƒç´ çš„ é»˜è®¤å®½åº¦ä¸ºå…¶æ‰€å«å†…å®¹çš„å®½åº¦ è¡Œå†…å…ƒç´ ä¸­åªèƒ½å®¹çº³ æ–‡æœ¬ æˆ–è€… è¡Œå†…å…ƒç´  ä»£è¡¨æ ‡ç­¾ï¼š aã€strongã€bã€emã€Iã€delã€sã€insã€uã€span è¡Œå†…å—å…ƒç´  æ˜¾ç¤ºç‰¹ç‚¹ï¼š å’Œç›¸é‚»è¡Œå†…å…ƒç´ åœ¨ä¸€è¡Œä¸Šï¼Œä½†æ˜¯å…ƒç´ ä¹‹é—´ä¼šæœ‰ç©ºéš™ é»˜è®¤å®½åº¦ä¸ºè¯¥å…ƒç´ æœ¬èº«å†…å®¹çš„å®½åº¦ é«˜åº¦ã€å®½åº¦ã€å¤–è¾¹è·ä»¥åŠå†…è¾¹è·éƒ½å¯ä»¥æ§åˆ¶ ä»£è¡¨æ ‡ç­¾ï¼š img/ã€input/ã€td ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleæ˜¾ç¤ºæ¨¡å¼/title style /* å—çº§ï¼šç‹¬å ä¸€è¡Œï¼›å®½åº¦é»˜è®¤æ˜¯çˆ¶çº§çš„100%ï¼›åŠ å®½é«˜ç”Ÿæ•ˆ */ div width: 100px; height: 100px; .div1 background-color: brown; .div2 background-color: orange; /* è¡Œå†…ï¼šä¸€è¡Œå…±å­˜å¤šä¸ªï¼›å°ºå¯¸ç”±å†…å®¹æ’‘å¼€ï¼›åŠ å®½é«˜ ä¸ ç”Ÿæ•ˆ */ span width: 200px; height: 200px; .span1 background-color: brown; .span2 background-color: orange; /* è¡Œå†…å—ï¼šä¸€è¡Œå…±å­˜å¤šä¸ªï¼›é»˜è®¤å°ºå¯¸ç”±å†…å®¹æ’‘å¼€ï¼›åŠ å®½é«˜ç”Ÿæ•ˆ */ img width: 100px; height: 100px; /style/headbody !-- å—å…ƒç´  -- div class=div1div æ ‡ç­¾1/div div class=div2div æ ‡ç­¾2/div !-- è¡Œå†…å…ƒç´  -- span class=span1span11111111/span span class=span2span1/span !-- è¡Œå†…å—å…ƒç´  -- img src=./images/1.png alt= img src=./images/1.png alt= /body/html å…ƒç´ ç¤ºæ¨¡å¼è½¬æ¢ ç›®çš„ æ”¹å˜å…ƒç´ é»˜è®¤çš„æ˜¾ç¤ºç‰¹ç‚¹ï¼Œè®©å…ƒç´ ç¬¦åˆå¸ƒå±€è¦æ±‚ è¯­æ³• å±æ€§ æ•ˆæœ ä½¿ç”¨é¢‘ç‡ display: block è½¬æ¢æˆå—çº§å…ƒç´  è¾ƒå¤š display: inline-block è½¬æ¢æˆè¡Œå†…å—å…ƒç´  è¾ƒå¤š display: inline è½¬æ¢æˆè¡Œå†…å…ƒç´  è¾ƒå°‘ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleæ˜¾ç¤ºæ¨¡å¼è½¬æ¢/title style /* å—çº§ï¼šç‹¬å ä¸€è¡Œï¼›å®½åº¦é»˜è®¤æ˜¯çˆ¶çº§çš„100%ï¼›åŠ å®½é«˜ç”Ÿæ•ˆ */ div width: 100px; height: 100px; /* display: inline-block; */ display: inline; .div1 background-color: brown; .div2 background-color: orange; /* è¡Œå†…ï¼šä¸€è¡Œå…±å­˜å¤šä¸ªï¼›å°ºå¯¸ç”±å†…å®¹æ’‘å¼€ï¼›åŠ å®½é«˜ ä¸ ç”Ÿæ•ˆ */ span width: 200px; height: 200px; /* display: block; */ display: inline-block; .span1 background-color: brown; .span2 background-color: orange; /* è¡Œå†…å—ï¼šä¸€è¡Œå…±å­˜å¤šä¸ªï¼›é»˜è®¤å°ºå¯¸ç”±å†…å®¹æ’‘å¼€ï¼›åŠ å®½é«˜ç”Ÿæ•ˆ */ img width: 100px; height: 100px; display: block; /style/headbody !-- å—å…ƒç´  -- div class=div1div æ ‡ç­¾1/div div class=div2div æ ‡ç­¾2/div !-- è¡Œå†…å…ƒç´  -- span class=span1span11111111/span span class=span2span1/span !-- è¡Œå†…å—å…ƒç´  -- img src=./images/1.png alt= img src=./images/1.png alt= /body/html CSS ç‰¹æ€§ç»§æ‰¿æ€§ ç‰¹æ€§ å­å…ƒç´ æœ‰é»˜è®¤ç»§æ‰¿çˆ¶å…ƒç´ æ ·å¼çš„ç‰¹ç‚¹ï¼ˆå­æ‰¿çˆ¶ä¸šï¼‰ å¯ä»¥ç»§æ‰¿çš„å¸¸è§å±æ€§(æ–‡å­—æ§åˆ¶å±æ€§éƒ½å¯ä»¥ç»§æ‰¿) color font-styleã€font-weightã€font-sizeã€font-family text-indentã€text-align line-height æ³¨æ„ç‚¹ å¯ä»¥é€šè¿‡è°ƒè¯•å·¥å…·åˆ¤æ–­æ ·å¼æ˜¯å¦å¯ä»¥ç»§æ‰¿ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleCSSç‰¹æ€§-ç»§æ‰¿æ€§/title style body font-size: 30px; color: red; font-weight: 700; /style/headbody divdiv æ ‡ç­¾/div pp æ ‡ç­¾/p spanspan æ ‡ç­¾/span !-- å¦‚æœæ ‡ç­¾è‡ªå·±æœ‰æ ·å¼åˆ™ç”Ÿæ•ˆè‡ªå·±çš„æ ·å¼ï¼Œä¸ç»§æ‰¿ -- a href=#a æ ‡ç­¾/a h1h1 æ ‡ç­¾/h1/body/html å±‚å æ€§ ç‰¹æ€§ ç»™åŒä¸€ä¸ªæ ‡ç­¾è®¾ç½®ä¸åŒçš„æ ·å¼ â†’ æ­¤æ—¶æ ·å¼ä¼šå±‚å å åŠ  â†’ ä¼šå…±åŒä½œç”¨åœ¨æ ‡ç­¾ä¸Š ç»™åŒä¸€ä¸ªæ ‡ç­¾è®¾ç½®ç›¸åŒçš„æ ·å¼ â†’ æ­¤æ—¶æ ·å¼ä¼šå±‚å è¦†ç›– â†’ æœ€ç»ˆå†™åœ¨æœ€åçš„æ ·å¼ä¼šç”Ÿæ•ˆ æ³¨æ„ç‚¹ å½“æ ·å¼å†²çªæ—¶ï¼Œåªæœ‰å½“é€‰æ‹©å™¨ä¼˜å…ˆçº§ç›¸åŒæ—¶ï¼Œæ‰èƒ½é€šè¿‡å±‚å æ€§åˆ¤æ–­ç»“æœ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleCSSç‰¹æ€§-å±‚å æ€§/title style /* è¦†ç›–ï¼›å åŠ  */ div color: green; font-size: 30px; div color: red; font-weight: 700; /style/headbody divdiv æ ‡ç­¾/div/body/html ä¼˜å…ˆçº§ ç‰¹æ€§ ä¸åŒé€‰æ‹©å™¨å…·æœ‰ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§é«˜çš„é€‰æ‹©å™¨æ ·å¼ä¼šè¦†ç›–ä¼˜å…ˆçº§ä½é€‰æ‹©å™¨æ ·å¼ ä¼˜å…ˆçº§å…¬å¼ ç»§æ‰¿ é€šé…ç¬¦é€‰æ‹©å™¨ æ ‡ç­¾é€‰æ‹©å™¨ ç±»é€‰æ‹©å™¨ id é€‰æ‹©å™¨ è¡Œå†…æ ·å¼ ! important æ³¨æ„ç‚¹ ! important å†™åœ¨å±æ€§å€¼çš„åé¢ï¼Œåˆ†å·çš„å‰é¢ï¼ ! important ä¸èƒ½æå‡ç»§æ‰¿çš„ä¼˜å…ˆçº§ï¼Œåªè¦æ˜¯ ç»§æ‰¿ ä¼˜å…ˆçº§æœ€ä½ï¼ å®é™…å¼€å‘ä¸­ä¸å»ºè®®ä½¿ç”¨ ! important æƒé‡å åŠ è®¡ç®— åœºæ™¯ å¦‚æœæ˜¯å¤åˆé€‰æ‹©å™¨ï¼Œæ­¤æ—¶éœ€è¦é€šè¿‡æƒé‡å åŠ è®¡ç®—æ–¹æ³•ï¼Œåˆ¤æ–­æœ€ç»ˆå“ªä¸ªé€‰æ‹©å™¨ä¼˜å…ˆçº§æœ€é«˜ä¼šç”Ÿæ•ˆ æƒé‡å åŠ è®¡ç®—å…¬å¼ï¼šï¼ˆæ¯ä¸€çº§ä¹‹é—´ä¸å­˜åœ¨è¿›ä½ï¼‰ ï¼ˆè¡Œå†… æ ·å¼, id é€‰æ‹©å™¨ä¸ªæ•°, ç±» é€‰æ‹©å™¨ä¸ªæ•°, æ ‡ç­¾ é€‰æ‹©å™¨ä¸ªæ•°ï¼‰ æ¯”è¾ƒè§„åˆ™ â€¢ å…ˆæ¯”è¾ƒç¬¬ä¸€çº§æ•°å­—ï¼Œå¦‚æœæ¯”è¾ƒå‡ºæ¥äº†ï¼Œä¹‹åçš„ç»Ÿç»Ÿä¸çœ‹ â€¢ å¦‚æœç¬¬ä¸€çº§æ•°å­—ç›¸åŒï¼Œæ­¤æ—¶å†å»æ¯”è¾ƒç¬¬äºŒçº§æ•°å­—ï¼Œå¦‚æœæ¯”è¾ƒå‡ºæ¥äº†ï¼Œä¹‹åçš„ç»Ÿç»Ÿä¸çœ‹ â€¢ å¦‚æœæœ€ç»ˆæ‰€æœ‰æ•°å­—éƒ½ç›¸åŒï¼Œè¡¨ç¤ºä¼˜å…ˆçº§ç›¸åŒï¼Œåˆ™æ¯”è¾ƒå±‚å æ€§ï¼ˆè°å†™åœ¨ä¸‹é¢ï¼Œè°è¯´äº†ç®—!ï¼‰ æ³¨æ„ç‚¹ ! important å¦‚æœä¸æ˜¯ç»§æ‰¿ï¼Œåˆ™æƒé‡æœ€é«˜ï¼Œå¤©ä¸‹ç¬¬ä¸€ï¼ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleCSS ç‰¹æ€§-ä¼˜å…ˆçº§/title style /* æŠ€å·§ï¼šé€‰æ‹©å™¨é€‰ä¸­æ ‡ç­¾çš„èŒƒå›´è¶Šå¤§ï¼Œä¼˜å…ˆçº§/æƒé‡ è¶Šä½ */ div color: green; /* !important ææƒåŠŸèƒ½ï¼Œæé«˜æƒé‡/ä¼˜å…ˆçº§åˆ° æœ€é«˜ï¼Œæ…ç”¨ */ * color: red !important; .box color: blue; #test color: orange; /style/headbody div class=box id=test style=color: purple;div æ ‡ç­¾/div/body/html ç›’å­æ¨¡å‹ç›’å­æ¨¡å‹ä»‹ç» ç›’å­çš„æ¦‚å¿µ é¡µé¢ä¸­çš„æ¯ä¸€ä¸ªæ ‡ç­¾ï¼Œéƒ½å¯çœ‹åšæ˜¯ä¸€ä¸ª ç›’å­ï¼Œé€šè¿‡ç›’å­çš„è§†è§’æ›´æ–¹ä¾¿çš„è¿›è¡Œå¸ƒå±€ æµè§ˆå™¨åœ¨æ¸²æŸ“ï¼ˆæ˜¾ç¤ºï¼‰ç½‘é¡µæ—¶ï¼Œä¼šå°†ç½‘é¡µä¸­çš„å…ƒç´ çœ‹åšæ˜¯ä¸€ä¸ªä¸ªçš„çŸ©å½¢åŒºåŸŸï¼Œæˆ‘ä»¬ä¹Ÿå½¢è±¡çš„ç§°ä¹‹ä¸º ç›’å­ ç›’å­æ¨¡å‹ CSS ä¸­è§„å®šæ¯ä¸ªç›’å­åˆ†åˆ«ç”±ï¼šå†…å®¹åŒºåŸŸï¼ˆcontentï¼‰ã€å†…è¾¹è·åŒºåŸŸï¼ˆpaddingï¼‰ã€è¾¹æ¡†åŒºåŸŸï¼ˆborderï¼‰ã€å¤–è¾¹è·åŒºåŸŸï¼ˆmarginï¼‰æ„æˆï¼Œè¿™å°±æ˜¯ ç›’å­æ¨¡å‹ ç›’å­æ¨¡å‹ â€“ ç»„æˆ ç›’å­æ¨¡å‹é‡è¦ç»„æˆéƒ¨åˆ† å†…å®¹åŒºåŸŸ â€“ width height å†…è¾¹è· â€“ paddingï¼ˆå‡ºç°åœ¨å†…å®¹ä¸ç›’å­è¾¹ç¼˜ä¹‹é—´ï¼‰ è¾¹æ¡†çº¿ â€“ border å¤–è¾¹è· â€“ marginï¼ˆå‡ºç°åœ¨ç›’å­å¤–é¢ï¼‰ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleç›’å­æ¨¡å‹-ç»„æˆ/title style #div1 background: blue; #div2 width: 200px; height: 200px; background-color: pink; /* å†…å®¹ä¸ç›’å­è¾¹ç¼˜ä¹‹é—´ */ padding: 20px; border: 10px solid #000; /* å‡ºç°åœ¨ç›’å­å¤–é¢ï¼Œæ‹‰å¼€ä¸¤ä¸ªç›’å­ä¹‹é—´çš„è·ç¦» */ margin: 50px; /style/headbody div id=div1 æ ‡ç­¾1 div id=div2div æ ‡ç­¾/div æ ‡ç­¾1 /div/body/html ç›’å­æ¨¡å‹ â€“ è¾¹æ¡†çº¿ ä½œç”¨ ç»™è®¾ç½®è¾¹æ¡†ç²—ç»†ã€è¾¹æ¡†æ ·å¼ã€è¾¹æ¡†é¢œè‰²æ•ˆæœ å±æ€§ ä½œç”¨ å±æ€§å å±æ€§å€¼ è¾¹æ¡†ç²—ç»† border-width æ•°å­—+px è¾¹æ¡†æ ·å¼ border-style å®çº¿ solidã€è™šçº¿ dashedã€ç‚¹çº¿ dotted è¾¹æ¡†é¢œè‰² border-color é¢œè‰²å–å€¼ è¿å†™ å±æ€§åï¼šborder å±æ€§å€¼ï¼šå•ä¸ªå–å€¼çš„è¿å†™ï¼Œå–å€¼ä¹‹é—´ä»¥ç©ºæ ¼éš”å¼€ border : 10px solid red; ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style div width: 200px; height: 200px; background-color: pink; /* border: ç²—ç»† çº¿æ¡æ ·å¼ é¢œè‰² -- ä¸åˆ†å…ˆåé¡ºåº */ /* solid : å®çº¿ */ /* border: 1px solid #000; */ /* dashed: è™šçº¿ */ /* border: 5px dashed #000; */ /* dotted : ç‚¹çº¿ */ /* border: 5px dotted #000; */ /* è®¾ç½®å•æ–¹å‘ */ border-left: 5px dotted #000; border-right: 5px dotted #000; border-top: 1px solid red; border-bottom: 1px solid red; /style/headbody divå†…å®¹/div/body/html ç›’å­æ¨¡å‹ â€“ å†…è¾¹è· å†…è¾¹è·ï¼ˆpaddingï¼‰- å–å€¼ ä½œç”¨ï¼šè®¾ç½®è¾¹æ¡†ä¸å†…å®¹åŒºåŸŸä¹‹é—´çš„è·ç¦» å±æ€§åï¼špadding å¸¸è§å–å€¼ï¼š å–å€¼ ç¤ºä¾‹ å«ä¹‰ ä¸€ä¸ªå€¼ padding: 10px; ä¸Šä¸‹å·¦å³ éƒ½è®¾ç½®ä¸º 10px ä¸¤ä¸ªå€¼ padding: 10px 20px; ä¸Šä¸‹è®¾ç½®ä¸º 10pxï¼Œå·¦å³è®¾ç½®ä¸º 20px ä¸‰ä¸ªå€¼ padding: 10px 20px 30px; ä¸Šè®¾ç½®ä¸º 10pxã€å·¦å³è®¾ç½®ä¸º 20pxã€ä¸‹è®¾ç½®ä¸º 30px å››ä¸ªå€¼ padding: 10px 20px 30px 40px; ä¸Šè®¾ç½®ä¸º 10pxã€å³è®¾ç½®ä¸º 20pxã€ä¸‹è®¾ç½®ä¸º 30pxï¼Œå·¦è®¾ç½®ä¸º 40px è®°å¿†è§„åˆ™ï¼šä»ä¸Šå¼€å§‹èµ‹å€¼ï¼Œç„¶åé¡ºæ—¶é’ˆèµ‹å€¼ï¼Œå¦‚æœè®¾ç½®èµ‹å€¼çš„ï¼Œçœ‹å¯¹é¢çš„ï¼ï¼ å†…è¾¹è·ï¼ˆpaddingï¼‰- å•æ–¹å‘è®¾ç½® åœºæ™¯ï¼šåªç»™ç›’å­çš„æŸä¸ªæ–¹å‘å•ç‹¬è®¾ç½®å†…è¾¹è· å±æ€§åï¼špadding - æ–¹ä½åè¯ å±æ€§å€¼ï¼šæ•°å­— + px ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleç›’å­æ¨¡å‹-å†…è¾¹è·/title style div width: 200px; height: 200px; background-color: pink; /* padding: 20px; */ padding-top: 10px; padding-right: 20px; padding-bottom: 40px; padding-left: 80px; /style/headbody divdiv æ ‡ç­¾/div/body/html ç›’å­æ¨¡å‹ â€“ å¤–è¾¹è· å¤–è¾¹è·ï¼ˆmarginï¼‰- å–å€¼ ä½œç”¨ï¼šè®¾ç½®è¾¹æ¡†ä»¥å¤–ï¼Œç›’å­ä¸ç›’å­ä¹‹é—´ çš„è·ç¦» å±æ€§åï¼šmargin å¸¸è§å–å€¼ï¼š å–å€¼ ç¤ºä¾‹ å«ä¹‰ ä¸€ä¸ªå€¼ margin: 10px; ä¸Šä¸‹å·¦å³ éƒ½è®¾ç½®ä¸º 10px ä¸¤ä¸ªå€¼ margin: 10px 20px; ä¸Šä¸‹è®¾ç½®ä¸º 10pxï¼Œå·¦å³è®¾ç½®ä¸º 20px ä¸‰ä¸ªå€¼ margin: 10px 20px 30px; ä¸Šè®¾ç½®ä¸º 10pxã€å·¦å³è®¾ç½®ä¸º 20pxã€ä¸‹è®¾ç½®ä¸º 30px å››ä¸ªå€¼ margin: 10px 20px 30px 40px; ä¸Šè®¾ç½®ä¸º 10pxã€å³è®¾ç½®ä¸º 20pxã€ä¸‹è®¾ç½®ä¸º 30pxï¼Œå·¦è®¾ç½®ä¸º 40px å¤–è¾¹è·ï¼ˆ margin ï¼‰- å•æ–¹å‘è®¾ç½® åœºæ™¯ï¼šåªç»™ç›’å­çš„æŸä¸ªæ–¹å‘å•ç‹¬è®¾ç½®å¤–è¾¹è· å±æ€§åï¼šmargin- æ–¹ä½åè¯ å±æ€§å€¼ï¼šæ•°å­— + px ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleç‰ˆå¿ƒå±…ä¸­/title style div /* ç‰ˆå¿ƒå±…ä¸­è¦æ±‚ï¼šç›’å­è¦æœ‰å®½åº¦ */ width: 1000px; height: 200px; background-color: pink; /* å¤–è¾¹è· ä¸ä¼š æ’‘å¤§ç›’å­ */ /* margin: 50px; */ /* margin-left: 100px; */ /* margin: 50px 100px; */ margin: 0 auto; /style/headbody divç‰ˆå¿ƒå†…å®¹/div/body/html ç›’å­æ¨¡å‹ â€“ å°ºå¯¸è®¡ç®— é»˜è®¤æƒ…å†µ ç›’å­å°ºå¯¸ å†…å®¹å°ºå¯¸ + border å°ºå¯¸ + å†…è¾¹è·å°ºå¯¸ ç»“è®º ç»™ç›’å­åŠ  border padding ä¼šæ’‘å¤§ç›’å­ è§£å†³ æ‰‹åŠ¨åšå‡æ³•ï¼Œå‡æ‰ border padding çš„å°ºå¯¸ å…§å‡æ¨¡å¼ï¼šbox-sizing: border-box ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleç›’å­æ¨¡å‹-å°ºå¯¸è®¡ç®—/title style div width: 200px; height: 200px; /* æ‰‹åŠ¨å‡æ³• */ /* width: 160px; height: 160px; */ background-color: pink; padding: 20px; /* å…§å‡æ¨¡å¼ï¼šä¸éœ€è¦æ‰‹åŠ¨å‡æ³•ï¼ŒåŠ paddingå’Œborderä¸ä¼šæ’‘å¤§ç›’å­ */ box-sizing: border-box; /style/headbody divdiv æ ‡ç­¾/div/body/html ç›’å­æ¨¡å‹-å…ƒç´ æº¢å‡º ä½œç”¨ æ§åˆ¶æº¢å‡ºå…ƒç´ çš„å†…å®¹çš„æ˜¾ç¤ºæ–¹å¼ã€‚ å±æ€§å overflow å±æ€§å€¼ å±æ€§å€¼ æ•ˆæœ hidden æº¢å‡ºéšè— scroll æº¢å‡ºæ»šåŠ¨ï¼ˆæ— è®ºæ˜¯å¦æº¢å‡ºï¼Œéƒ½æ˜¾ç¤ºæ»šåŠ¨æ¡çš„ä½ç½®ï¼‰ auto æº¢å‡ºæ»šåŠ¨ï¼ˆæº¢å‡ºæ‰æ˜¾ç¤ºæ»šåŠ¨æ¡çš„ä½ç½®ï¼‰ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleå…ƒç´ æº¢å‡º/title style div width: 200px; height: 200px; background-color: pink; overflow: hidden; /* overflow: scroll; */ /* overflow: auto; */ /style/headbody div æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• æ–‡å­—å†…å®¹æµ‹è¯• /div/body/html å¤–è¾¹è·é—®é¢˜ â€“ åˆå¹¶ç°è±¡ åœºæ™¯ å‚ç›´å¸ƒå±€ çš„ å—çº§å…ƒç´ ï¼Œä¸Šä¸‹çš„ margin ä¼šåˆå¹¶ ç»“æœ æœ€ç»ˆä¸¤è€…è·ç¦»ä¸º margin çš„æœ€å¤§å€¼ è§£å†³æ–¹æ³• åªç»™å…¶ä¸­ä¸€ä¸ªç›’å­è®¾ç½® margin å³å¯ ç°è±¡ä»£ç  !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style div width: 100px; height: 100px; background-color: pink; .one /* margin-bottom: 50px; */ margin-bottom: 60px; .two margin-top: 50px; /style/headbody div class=one11/div div class=two22/div/body/html å¤–è¾¹è·é—®é¢˜ â€“ å¡Œé™·é—®é¢˜ åœºæ™¯ äº’ç›¸åµŒå¥— çš„ å—çº§å…ƒç´ ï¼Œå­å…ƒç´ çš„ margin-top ä¼šä½œç”¨åœ¨çˆ¶å…ƒç´ ä¸Š ç»“æœ å¯¼è‡´çˆ¶å…ƒç´ ä¸€èµ·å¾€ä¸‹ç§»åŠ¨ è§£å†³æ–¹æ³•ï¼š ç»™çˆ¶å…ƒç´ è®¾ç½® border-top æˆ–è€… padding-topï¼ˆåˆ†éš”çˆ¶å­å…ƒç´ çš„ margin-topï¼‰ ç»™çˆ¶å…ƒç´ è®¾ç½® overflowï¼šhidden è½¬æ¢æˆè¡Œå†…å—å…ƒç´  è®¾ç½®æµ®åŠ¨ ç°è±¡ä»£ç  !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title style .father width: 300px; height: 300px; background-color: pink; /* è§£å†³æ–¹å¼ï¼š */ /* padding-top: 50px; */ /* å¦‚æœè®¾è®¡ç¨¿æ²¡æœ‰border, ä¸èƒ½ä½¿ç”¨è¿™ä¸ªè§£å†³åŠæ³• */ /* border: 1px solid #000; */ /* overflow: hidden; */ .son width: 100px; height: 100px; background-color: skyblue; margin-top: 50px; /* è§£å†³æ–¹å¼ */ /* display: inline-block; */ /style/headbody div class=father div class=sonson/div /div/body/html è¡Œå†…å…ƒç´  - å†…å¤–è¾¹è·é—®é¢˜ åœºæ™¯ è¡Œå†… å…ƒç´ æ·»åŠ  margin å’Œ paddingï¼Œæ— æ³•æ”¹å˜å…ƒç´  å‚ç›´ ä½ç½® è§£å†³åŠæ³• ç»™è¡Œå†…å…ƒç´ æ·»åŠ  line-height å¯ä»¥æ”¹å˜å‚ç›´ä½ç½® è§£å†³ä»£ç  !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleè¡Œå†…å…ƒç´ çš„å‚ç›´å†…å¤–è¾¹è·/title style span margin: 50px; padding: 20px; /* line-height: 100px; */ background-color: aqua; /style/headbody spanspanæ ‡ç­¾/span spanspanæ ‡ç­¾/span/body/html CSS å¸ƒå±€æ ‡å‡†æµ æ ‡å‡†æµ åˆç§° æ–‡æ¡£æµï¼Œæ˜¯æµè§ˆå™¨åœ¨æ¸²æŸ“æ˜¾ç¤ºç½‘é¡µå†…å®¹æ—¶é»˜è®¤é‡‡ç”¨çš„ä¸€å¥—æ’ç‰ˆè§„åˆ™ï¼Œè§„å®šäº†åº”è¯¥ä»¥ä½•ç§æ–¹å¼æ’åˆ—å…ƒç´  å¸¸è§æ ‡å‡†æµæ’ç‰ˆè§„åˆ™ å—çº§å…ƒç´ ï¼šä»ä¸Šå¾€ä¸‹ï¼Œå‚ç›´å¸ƒå±€ï¼Œç‹¬å ä¸€è¡Œ è¡Œå†…å…ƒç´ æˆ–è¡Œå†…å—å…ƒç´ ï¼šä»å·¦å¾€å³ï¼Œæ°´å¹³å¸ƒå±€ï¼Œç©ºé—´ä¸å¤Ÿè‡ªåŠ¨æŠ˜è¡Œ Flex å¸ƒå±€ç®€ä»‹Flex å¸ƒå±€ä¹Ÿå«å¼¹æ€§å¸ƒå±€ï¼Œæ˜¯æµè§ˆå™¨æå€¡çš„å¸ƒå±€æ¨¡å‹ï¼Œéå¸¸é€‚åˆç»“æ„åŒ–å¸ƒå±€ï¼Œæä¾›äº†å¼ºå¤§çš„ç©ºé—´åˆ†å¸ƒå’Œå¯¹é½èƒ½åŠ›ã€‚Flex æ¨¡å‹ä¸ä¼šäº§ç”Ÿæµ®åŠ¨å¸ƒå±€ä¸­è„±æ ‡ç°è±¡ï¼Œå¸ƒå±€ç½‘é¡µæ›´ç®€å•ã€æ›´çµæ´»ã€‚ ç»„æˆ è®¾ç½®æ–¹å¼ ç»™ çˆ¶ å…ƒç´ è®¾ç½® display: flexï¼Œå­ å…ƒç´ å¯ä»¥ è‡ªåŠ¨æŒ¤å‹æˆ–æ‹‰ä¼¸ ç»„æˆéƒ¨åˆ† å¼¹æ€§å®¹å™¨ å¼¹æ€§ç›’å­ ä¸»è½´ï¼šé»˜è®¤åœ¨ æ°´å¹³ æ–¹å‘ ä¾§è½´ äº¤å‰è½´ï¼šé»˜è®¤åœ¨ å‚ç›´ æ–¹å‘ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleflexå¸ƒå±€-ç»„æˆ/title style /* å¼¹æ€§å®¹å™¨ */ .box /* å¸ƒå±€æ–¹å¼ä¸º flex */ display: flex; height: 300px; border: 1px solid #000; /* å¼¹æ€§ç›’å­ï¼šæ²¿ç€ä¸»è½´æ–¹å‘æ’åˆ— */ .box div width: 200px; height: 100px; background-color: pink; /style/headbody div class=box div1/div div2/div div3/div /div/body/html å¯¹é½æ–¹å¼ ä¸»è½´å¯¹é½ å±æ€§åï¼šjustify-content å±æ€§å€¼ å±æ€§å€¼ æ•ˆæœ flex-start é»˜è®¤å€¼ï¼Œå¼¹æ€§ç›’å­ä»èµ·ç‚¹å¼€å§‹ä¾æ¬¡æ’åˆ— flex-end å¼¹æ€§ç›’å­ä»ç»ˆç‚¹å¼€å§‹ä¾æ¬¡æ’åˆ— center å¼¹æ€§ç›’å­æ²¿ä¸»è½´å±…ä¸­æ’åˆ— space-between å¼¹æ€§ç›’å­æ²¿ä¸»è½´å‡åŒ€æ’åˆ—ï¼Œçˆ¶çº§å‰©ä½™çš„å°ºå¯¸åˆ†é…æˆé—´è·ï¼Œç©ºç™½é—´è·å‡åˆ†åœ¨å¼¹æ€§ç›’å­ä¹‹é—´ space-around å¼¹æ€§ç›’å­æ²¿ä¸»è½´å‡åŒ€æ’åˆ—ï¼Œç©ºç™½é—´è·å‡åˆ†åœ¨å¼¹æ€§ç›’å­ä¸¤ä¾§ï¼Œå¼¹æ€§ç›’å­ä¹‹é—´çš„é—´è·æ˜¯ä¸¤ç«¯é—´è·çš„2å€ space-evenly å¼¹æ€§ç›’å­æ²¿ä¸»è½´å‡åŒ€æ’åˆ—ï¼Œå¼¹æ€§ç›’å­ä¸å®¹å™¨ä¹‹é—´é—´è·ç›¸ç­‰ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleflexå¸ƒå±€-ä¸»è½´å¯¹é½æ–¹å¼/title style .box display: flex; /* justify-content: flex-start; */ /* justify-content: flex-end; */ /* å±…ä¸­ */ /* justify-content: center; */ /* çˆ¶çº§å‰©ä½™çš„å°ºå¯¸åˆ†é…æˆé—´è· */ /* å¼¹æ€§ç›’å­ä¹‹é—´çš„é—´è·ç›¸ç­‰ */ /* justify-content: space-between; */ /* é—´è·å‡ºç°åœ¨å¼¹æ€§ç›’å­ä¸¤ä¾§ */ /* è§†è§‰æ•ˆæœï¼šå¼¹æ€§ç›’å­ä¹‹é—´çš„é—´è·æ˜¯ä¸¤ç«¯é—´è·çš„2å€ */ /* justify-content: space-around; */ /* å„ä¸ªé—´è·éƒ½ç›¸ç­‰ */ justify-content: space-evenly; height: 300px; border: 1px solid #000; .box div width: 200px; height: 100px; background-color: pink; /style/headbody div class=box div1/div div2/div div3/div /div/body/html flex-start flex-end center space-between space-around space-evenly ä¾§è½´å¯¹é½ å±æ€§å align-itemsï¼šå½“å‰å¼¹æ€§å®¹å™¨å†… æ‰€æœ‰ å¼¹æ€§ç›’å­çš„ä¾§è½´å¯¹é½æ–¹å¼ï¼ˆç»™å¼¹æ€§å®¹å™¨è®¾ç½®ï¼‰ align-selfï¼šå•ç‹¬æ§åˆ¶ æŸä¸ª å¼¹æ€§ç›’å­çš„ä¾§è½´å¯¹é½æ–¹å¼ï¼ˆç»™å¼¹æ€§ç›’å­è®¾ç½®ï¼‰ å±æ€§å€¼ å±æ€§å€¼ æ•ˆæœ stretch å¼¹æ€§ç›’å­æ²¿ç€æ»è½´çº¿è¢«æ‹‰ä¼¸è‡³é“ºæ»¡å®¹å™¨ï¼ˆå¼¹æ€§ç›’å­æ²¡æœ‰è®¾ç½®æ»è½´æ–¹å‘å°ºå¯¸åˆ™é»˜è®¤æ‹‰ä¼¸ï¼‰ center å¼¹æ€§ç›’å­æ²¿æ»è½´å±…ä¸­æ’åˆ— flex-start å¼¹æ€§ç›’å­ä»èµ·ç‚¹å¼€å§‹ä¾æ¬¡æ’åˆ— flex-end å¼¹æ€§ç›’å­ä»ç»ˆç‚¹å¼€å§‹ä¾æ¬¡æ’åˆ— ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleflexå¸ƒå±€-ä¾§è½´å¯¹é½æ–¹å¼/title style .box display: flex; /* å¼¹æ€§ç›’å­åœ¨ä¾§è½´æ–¹å‘æ²¡æœ‰å°ºå¯¸æ‰èƒ½æ‹‰ä¼¸ */ /* align-items: stretch; */ /* align-items: center; */ /* align-items: flex-start; */ align-items: flex-end; height: 300px; border: 1px solid #000; /* ç¬¬äºŒä¸ªdivï¼Œä¾§è½´å±…ä¸­å¯¹é½ */ .box div:nth-child(2) align-self: center; .box div width: 200px; height: 100px; background-color: pink; /style/headbody div class=box div1/div div2/div div3/div /div/body/html stretch !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleflexå¸ƒå±€-ä¾§è½´å¯¹é½æ–¹å¼/title style .box display: flex; /* å¼¹æ€§ç›’å­åœ¨ä¾§è½´æ–¹å‘æ²¡æœ‰å°ºå¯¸æ‰èƒ½æ‹‰ä¼¸ */ align-items: stretch; height: 300px; border: 1px solid #000; .box div width: 200px; /* å¦‚æœè®¾ç½®äº†å°ºå¯¸å°±ä¸ä¼šæ‹‰ä¼¸ */ /* height: 100px; */ background-color: pink; /style/headbody div class=box div1/div div2/div div3/div /div/body/html center !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleflexå¸ƒå±€-ä¾§è½´å¯¹é½æ–¹å¼/title style .box display: flex; /* å¼¹æ€§ç›’å­åœ¨ä¾§è½´æ–¹å‘æ²¡æœ‰å°ºå¯¸æ‰èƒ½æ‹‰ä¼¸ */ align-items: center; height: 300px; border: 1px solid #000; .box div width: 200px; /* å¦‚æœè®¾ç½®äº†å°ºå¯¸å°±ä¸ä¼šæ‹‰ä¼¸ */ height: 100px; background-color: pink; /style/headbody div class=box div1/div div2/div div3/div /div/body/html flex-start flex-end align-self !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleflexå¸ƒå±€-ä¾§è½´å¯¹é½æ–¹å¼/title style .box display: flex; height: 400px; border: 1px solid #000; /* ç¬¬äºŒä¸ªdivï¼Œä¾§è½´å±…ä¸­å¯¹é½ */ .box div:nth-child(2) align-self: center; .box div width: 200px; height: 100px; background-color: pink; /style/headbody div class=box div1/div div2/div div3/div /div/body/html ä¿®æ”¹ä¸»è½´æ–¹å‘ ä½œç”¨ ä¸»è½´ é»˜è®¤åœ¨æ°´å¹³æ–¹å‘ï¼Œä¾§è½´é»˜è®¤åœ¨å‚ç›´æ–¹å‘ å±æ€§å flex-direction å±æ€§å€¼ å±æ€§å€¼ æ•ˆæœ row æ°´å¹³æ–¹å‘ï¼Œä»å·¦å‘å³ï¼ˆé»˜è®¤ï¼‰ column å‚ç›´æ–¹å‘ï¼Œä»ä¸Šå‘ä¸‹ row-reverse æ°´å¹³æ–¹å‘ï¼Œä»å³å‘å·¦ column-reverse å‚ç›´æ–¹å‘ï¼Œä»ä¸‹å‘ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleflexå¸ƒå±€-ä¿®æ”¹ä¸»è½´æ–¹å‘/title style .box display: flex; /* ä¿®æ”¹ä¸»è½´æ–¹å‘ å‚ç›´æ–¹å‘ï¼›ä¾§è½´è‡ªåŠ¨å˜æ¢åˆ°æ°´å¹³æ–¹å‘ */ flex-direction: column; /* ä¸»è½´åœ¨å‚ç›´ï¼Œè§†è§‰æ•ˆæœï¼šå‚ç›´å±…ä¸­ */ justify-content: center; /* ä¾§è½´åœ¨æ°´å¹³ï¼Œè§†è§‰æ•ˆæœï¼šæ°´å¹³å±…ä¸­ */ align-items: center; width: 150px; height: 120px; background-color: pink; img width: 32px; height: 32px; /style/headbody div class=box img src=./images/1.png alt= spanåª’ä½“/span /div/body/html å¼¹æ€§ä¼¸ç¼©æ¯” ä½œç”¨ æ§åˆ¶å¼¹æ€§ç›’å­çš„ ä¸»è½´ æ–¹å‘çš„å°ºå¯¸ã€‚ å±æ€§å flex å±æ€§å€¼ æ•´æ•°æ•°å­—ï¼Œè¡¨ç¤ºå ç”¨çˆ¶çº§ å‰©ä½™ å°ºå¯¸çš„ ä»½æ•°ã€‚ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleflexå¸ƒå±€-å¼¹æ€§ä¼¸ç¼©æ¯”/title style /* é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸»è½´æ–¹å‘å°ºå¯¸æ˜¯é å†…å®¹æ’‘å¼€ï¼›ä¾§è½´é»˜è®¤æ‹‰ä¼¸ */ .box display: flex; height: 300px; border: 1px solid #000; .box div /* height: 100px; */ background-color: pink; border: solid 2px; .box div:nth-child(1) width: 200px; .box div:nth-child(2) flex: 1; .box div:nth-child(3) flex: 2; /style/headbody div class=box div1/div div2/div div3/div /div/body/html å¼¹æ€§ç›’å­æ¢è¡Œ ä½œç”¨ å¼¹æ€§ç›’å­å¯ä»¥è‡ªåŠ¨æŒ¤å‹æˆ–æ‹‰ä¼¸ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å¼¹æ€§ç›’å­éƒ½åœ¨ä¸€è¡Œæ˜¾ç¤ºã€‚ å±æ€§å flex-wrap å±æ€§å€¼ wrapï¼šæ¢è¡Œ nowrapï¼šä¸æ¢è¡Œï¼ˆé»˜è®¤ï¼‰ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleflexå¸ƒå±€-å¼¹æ€§æ¢è¡Œ/title style .box display: flex; flex-wrap: wrap; /* ä¸æ¢è¡Œ */ /* flex-wrap: nowrap; */ justify-content: space-between; height: 300px; border: 1px solid #000; .box div width: 200px; height: 100px; background-color: pink; /style/headbody div class=box div1/div div2/div div3/div div4/div div5/div div6/div div7/div div8/div div9/div div10/div div11/div div12/div /div/body/html nowrap wrap è¡Œå¯¹é½æ–¹å¼ å±æ€§å align-content å±æ€§å€¼ å±æ€§å€¼ æ•ˆæœ flex-start é»˜è®¤å€¼ï¼Œå¼¹æ€§ç›’å­ä»èµ·ç‚¹å¼€å§‹ä¾æ¬¡æ’åˆ— flex-end å¼¹æ€§ç›’å­ä»ç»ˆç‚¹å¼€å§‹ä¾æ¬¡æ’åˆ— center å¼¹æ€§ç›’å­æ²¿ä¸»è½´å±…ä¸­æ’åˆ— space-between å¼¹æ€§ç›’å­æ²¿ä¸»è½´å‡åŒ€æ’åˆ—ï¼Œç©ºç™½é—´è·å‡åˆ†åœ¨å¼¹æ€§ç›’å­ä¹‹é—´ space-around å¼¹æ€§ç›’å­æ²¿ä¸»è½´å‡åŒ€æ’åˆ—ï¼Œç©ºç™½é—´è·å‡åˆ†åœ¨å¼¹æ€§ç›’å­ä¸¤ä¾§ space-evenly å¼¹æ€§ç›’å­æ²¿ä¸»è½´å‡åŒ€æ’åˆ—ï¼Œå¼¹æ€§ç›’å­ä¸å®¹å™¨ä¹‹é—´é—´è·ç›¸ç­‰ æ³¨æ„ è¯¥å±æ€§å¯¹ å•è¡Œ å¼¹æ€§ç›’å­æ¨¡å‹ æ— æ•ˆã€‚ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleflexå¸ƒå±€-è¡Œå¯¹é½æ–¹å¼/title style .box display: flex; flex-wrap: wrap; justify-content: space-between; /* è°ƒæ•´ è¡Œå¯¹é½æ–¹å¼ï¼šå¯¹å•è¡Œå¼¹æ€§ç›’å­ä¸ç”Ÿæ•ˆ */ /* align-content: flex-start; */ /* align-content: flex-end; */ /* align-content: center; */ /* align-content: space-between; */ /* align-content: space-around; */ /* æ²¡æœ‰ä»£ç æç¤º */ align-content: space-evenly; height: 400px; border: 1px solid #000; .box div width: 200px; height: 100px; background-color: pink; /style/headbody div class=box div1/div div2/div div3/div div4/div div5/div div6/div div7/div div8/div /div/body/html å®šä½ç½‘é¡µå¸¸è§å¸ƒå±€æ–¹å¼ æ ‡å‡†æµ å—çº§å…ƒç´ ç‹¬å ä¸€è¡Œ â†’ å‚ç›´å¸ƒå±€ è¡Œå†…å…ƒç´ è¡Œå†…å—å…ƒç´ ä¸€è¡Œæ˜¾ç¤ºå¤šä¸ª â†’ æ°´å¹³å¸ƒå±€ æµ®åŠ¨ å¯ä»¥è®©åŸæœ¬å‚ç›´å¸ƒå±€çš„ å—çº§å…ƒç´ å˜æˆæ°´å¹³å¸ƒå±€ flex å¼¹æ€§å¸ƒå±€ï¼ŒFlex æ¨¡å‹ä¸ä¼šäº§ç”Ÿæµ®åŠ¨å¸ƒå±€ä¸­è„±æ ‡ç°è±¡ï¼Œå¸ƒå±€ç½‘é¡µæ›´ç®€å•ã€æ›´çµæ´»ã€‚ å®šä½ å¯ä»¥è®©å…ƒç´ è‡ªç”±çš„æ‘†æ”¾åœ¨ç½‘é¡µçš„ä»»æ„ä½ç½® ä¸€èˆ¬ç”¨äº ç›’å­ä¹‹é—´çš„å±‚å æƒ…å†µ å®šä½å¸¸è§åº”ç”¨åœºæ™¯ å¯ä»¥è§£å†³ç›’å­ä¸ç›’å­ä¹‹é—´çš„å±‚å é—®é¢˜ å®šä½ä¹‹åçš„å…ƒç´  å±‚çº§æœ€é«˜ï¼Œå¯ä»¥å±‚å åœ¨å…¶ä»–ç›’å­ä¸Šé¢ å¯ä»¥è®©ç›’å­å§‹ç»ˆå›ºå®šåœ¨å±å¹•ä¸­çš„æŸä¸ªä½ç½® å®šä½ä½¿ç”¨æ­¥éª¤ è®¾ç½®å®šä½æ–¹å¼ å±æ€§å position å¸¸è§å±æ€§å€¼ å®šä½æ–¹å¼ å±æ€§å€¼ é™æ€å®šä½ static ç›¸å¯¹å®šä½ relative ç»å¯¹å®šä½ absolute å›ºå®šå®šä½ fixed è®¾ç½®åç§»å€¼ åç§»å€¼è®¾ç½®åˆ†ä¸ºä¸¤ä¸ªæ–¹å‘ï¼Œæ°´å¹³å’Œå‚ç›´æ–¹å‘å„é€‰ä¸€ä¸ªä½¿ç”¨å³å¯ é€‰å–çš„åŸåˆ™ä¸€èˆ¬æ˜¯å°±è¿‘åŸåˆ™ ï¼ˆç¦»å“ªè¾¹è¿‘ç”¨å“ªä¸ªï¼‰ æ–¹å‘ å±æ€§å å±æ€§å€¼ å«ä¹‰ æ°´å¹³ left æ•°å­—+px è·ç¦»å·¦è¾¹çš„è·ç¦» æ°´å¹³ right æ•°å­—+px è·ç¦»å³è¾¹çš„è·ç¦» å‚ç›´ top æ•°å­—+px è·ç¦»ä¸Šè¾¹çš„è·ç¦» å‚ç›´ bottom æ•°å­—+px è·ç¦»ä¸‹è¾¹çš„è·ç¦» é™æ€å®šä½ ä»‹ç» é™æ€å®šä½æ˜¯é»˜è®¤å€¼ï¼Œå°±æ˜¯ä¹‹å‰è®¤è¯†çš„æ ‡å‡†æµ å±æ€§å€¼ position:static; æ³¨æ„ç‚¹ é™æ€å®šä½å°±æ˜¯ä¹‹å‰æ ‡å‡†æµï¼Œä¸èƒ½é€šè¿‡æ–¹ä½å±æ€§è¿›è¡Œç§»åŠ¨ ä¹‹åè¯´çš„å®šä½ä¸åŒ…æ‹¬é™æ€å®šä½ï¼Œä¸€èˆ¬ç‰¹æŒ‡åå‡ ç§ï¼šç›¸å¯¹ã€ç»å¯¹ã€å›ºå®š ç›¸å¯¹å®šä½ ä»‹ç» è‡ªæ‹å‹å®šä½ï¼Œç›¸å¯¹äºè‡ªå·±ä¹‹å‰çš„ä½ç½®è¿›è¡Œç§»åŠ¨ å±æ€§å€¼ position:relative; æ³¨æ„ç‚¹ éœ€è¦é…åˆæ–¹ä½å±æ€§å®ç°ç§»åŠ¨ ç›¸å¯¹äºè‡ªå·±åŸæ¥ä½ç½®è¿›è¡Œç§»åŠ¨ åœ¨é¡µé¢ä¸­å ä½ç½® â†’ æ²¡æœ‰è„±æ ‡ åº”ç”¨åœºæ™¯ é…åˆç»å¯¹å®šä½ç»„ CPï¼ˆå­ç»çˆ¶ç›¸ï¼‰ ç”¨äºå°èŒƒå›´çš„ç§»åŠ¨ ç¤ºä¾‹ !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleç›¸å¯¹å®šä½/title style * margin: 0; padding: 0; /* 1. æ”¹å˜ä½ç½®çš„å‚ç…§ç‰©æ˜¯ è‡ªå·±åŸæ¥çš„ä½ç½® 2. ä¸è„±æ ‡ï¼Œå ä½ 3. æ ‡ç­¾æ˜¾ç¤ºæ¨¡å¼ç‰¹ç‚¹ ä¸å˜ */ div position: relative; top: 100px; left: 200px; /style/headbody pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p divimg src=./images/1.webp alt=/div pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p/body/html ç»å¯¹å®šä½ ä»‹ç» æ‹¼çˆ¹å‹å®šä½ï¼Œç›¸å¯¹äºéé™æ€å®šä½çš„çˆ¶å…ƒç´ è¿›è¡Œå®šä½ç§»åŠ¨ å±æ€§å€¼ position:absolute; æ³¨æ„ç‚¹ éœ€è¦é…åˆæ–¹ä½å±æ€§å®ç°ç§»åŠ¨ é»˜è®¤ç›¸å¯¹äºæµè§ˆå™¨å¯è§†åŒºåŸŸè¿›è¡Œç§»åŠ¨ åœ¨é¡µé¢ä¸­ä¸å ä½ç½® â†’ å·²ç»è„±æ ‡ åº”ç”¨åœºæ™¯ é…åˆç»å¯¹å®šä½ç»„ CPï¼ˆå­ç»çˆ¶ç›¸ï¼‰ ç¤ºä¾‹ æ•ˆæœï¼šfont-demo.pages.dev !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleç»å¯¹å®šä½/title style * margin: 0; padding: 0; img width: 400px; .news position: relative; margin: 100px auto; width: 400px; height: 350px; background-color: #f8f8f8; /* 1. è„±æ ‡ï¼Œä¸å ä½ 2. å‚ç…§ç‰©ï¼šå…ˆæ‰¾æœ€è¿‘çš„å·²ç»å®šä½çš„ç¥–å…ˆå…ƒç´ ï¼›å¦‚æœæ‰€æœ‰ç¥–å…ˆå…ƒç´ éƒ½æ²¡æœ‰å®šä½ï¼Œå‚ç…§æµè§ˆå™¨å¯è§†åŒºæ”¹ä½ç½® 3. æ˜¾ç¤ºæ¨¡å¼ç‰¹ç‚¹æ”¹å˜ï¼šå®½é«˜ç”Ÿæ•ˆï¼ˆå…·å¤‡äº†è¡Œå†…å—çš„ç‰¹ç‚¹ï¼‰ */ .news span position: absolute; top: 0; right: 0; /* display: block; */ width: 92px; height: 32px; background-color: rgba(0,0,0,0.6); text-align: center; line-height: 32px; color: #fff; /style/headbody div class=news img src=./images/news.jpg alt= spanå±•ä¼šæ´»åŠ¨/span h42222ä¸–ç•Œç§»åŠ¨å¤§ä¼š/h4 /div/body/html æ•ˆæœï¼šfont-demo.pages.dev !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleç»å¯¹å®šä½-å±…ä¸­/title style img position: absolute; left: 50%; top: 50%; /* margin-left: -265px; margin-top: -127px; */ /* æ–¹ä¾¿ï¼š 50% å°±æ˜¯è‡ªå·±å®½é«˜çš„ä¸€åŠ */ transform: translate(-50%, -50%); /style/headbody img src=./images/login.webp alt=/body/html å›ºå®šå®šä½ ä»‹ç» æ­»å¿ƒçœ¼å‹å®šä½ï¼Œç›¸å¯¹äºæµè§ˆå™¨è¿›è¡Œå®šä½ç§»åŠ¨ å±æ€§å€¼ position:fixed; æ³¨æ„ç‚¹ éœ€è¦é…åˆæ–¹ä½å±æ€§å®ç°ç§»åŠ¨ ç›¸å¯¹äºæµè§ˆå™¨å¯è§†åŒºåŸŸè¿›è¡Œç§»åŠ¨ åœ¨é¡µé¢ä¸­ä¸å ä½ç½® â†’ å·²ç»è„±æ ‡ åº”ç”¨åœºæ™¯ è®©ç›’å­å›ºå®šåœ¨å±å¹•ä¸­çš„æŸä¸ªä½ç½® ç¤ºä¾‹ æ•ˆæœï¼šfont-demo.pages.dev !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleå›ºå®šå®šä½/title style * margin: 0; padding: 0; /* 1. è„±æ ‡ï¼Œä¸å ä½ 2. å‚ç…§ç‰©ï¼šæµè§ˆå™¨çª—å£ 3. æ˜¾ç¤ºæ¨¡å¼ç‰¹ç‚¹ å…·å¤‡è¡Œå†…å—ç‰¹ç‚¹ */ div position: fixed; top: 0; right: 0; width: 500px; /style/headbody pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p divimg src=./images/1.webp alt=/div pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p pVue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚/p/body/html å…ƒç´ å±‚çº§ ä¸åŒå¸ƒå±€æ–¹å¼å…ƒç´ çš„å±‚çº§å…³ç³» æ ‡å‡†æµ æµ®åŠ¨ å®šä½ ä¸åŒå®šä½ä¹‹é—´çš„å±‚çº§å…³ç³» ç›¸å¯¹ã€ç»å¯¹ã€å›ºå®šé»˜è®¤å±‚çº§ç›¸åŒ æ­¤æ—¶ HTML ä¸­å†™åœ¨ä¸‹é¢çš„å…ƒç´ å±‚çº§æ›´é«˜ï¼Œä¼šè¦†ç›–ä¸Šé¢çš„å…ƒç´  ä¿®æ”¹å®šä½å…ƒç´ å±‚çº§ åœºæ™¯ï¼šæ”¹å˜å®šä½å…ƒç´ çš„å±‚çº§ å±æ€§åï¼šz-index å±æ€§å€¼ï¼šæ•°å­— æ•°å­—è¶Šå¤§ï¼Œå±‚çº§è¶Šé«˜ ç¤ºä¾‹ æ•ˆæœï¼šfont-demo.pages.dev !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleå †å é¡ºåº-z-index/title style div position: absolute; width: 200px; height: 200px; .box1 background-color: pink; /* å–å€¼æ˜¯æ•´æ•°ï¼Œé»˜è®¤æ˜¯0ï¼Œå–å€¼è¶Šå¤§æ˜¾ç¤ºé¡ºåºè¶Šé ä¸Š */ z-index: 1; .box2 background-color: skyblue; left: 100px; top: 100px; z-index: 2; /style/headbody div class=box1box1/div div class=box2box2/div/body/html","tags":["CSS","é€‰æ‹©å™¨","ç›’å­æ¨¡å‹","flexå¸ƒå±€","å®šä½","è£…é¥°"],"categories":["å‰ç«¯"]},{"title":"HTMLç®€ä»‹","path":"/2023/11/20/2023-11-20 HTMLç®€ä»‹/","content":"æ¦‚å¿µ HTMLï¼ˆHyper Text Markup Languageï¼‰ä¸­æ–‡è¯‘ä¸ºï¼šè¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ã€‚ä¸“é—¨ç”¨äºç½‘é¡µå¼€å‘çš„è¯­è¨€ï¼Œä¸»è¦é€šè¿‡ HTML æ ‡ç­¾ å¯¹ç½‘é¡µä¸­çš„æ–‡æœ¬ã€å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰å†…å®¹è¿›è¡Œæè¿°ã€‚ HTML æ ‡ç­¾æ ‡ç­¾çš„ç»“æ„ æ ‡ç­¾ç»“æ„ !-- å¼€å§‹æ ‡ç­¾ --strong æ–‡å­—è¦å˜ç²— !-- åŒ…è£¹å†…å®¹ --/strong!-- ç»“æŸæ ‡ç­¾ -- ç»“æ„è¯´æ˜ æ ‡ç­¾ç”± ã€ã€ã€è‹±æ–‡å•è¯æˆ–å­—æ¯ç»„æˆã€‚å¹¶ä¸”æŠŠæ ‡ç­¾ä¸­ åŒ…æ‹¬èµ·æ¥çš„è‹±æ–‡å•è¯æˆ–å­—æ¯ç§°ä¸º æ ‡ç­¾å å¸¸è§æ ‡ç­¾ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºï¼šåŒæ ‡ç­¾ã€‚å‰éƒ¨åˆ†å« å¼€å§‹æ ‡ç­¾ï¼Œåéƒ¨åˆ†å« ç»“æŸæ ‡ç­¾ï¼Œä¸¤éƒ¨åˆ†ä¹‹é—´åŒ…è£¹å†…å®¹ å°‘æ•°æ ‡ç­¾ç”±ä¸€éƒ¨åˆ†ç»„æˆï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºï¼šå•æ ‡ç­¾ã€‚è‡ªæˆä¸€ä½“ï¼Œæ— æ³•åŒ…è£¹å†…å®¹ æ ‡ç­¾çš„å…³ç³»HTML æ ‡ç­¾ä¸æ ‡ç­¾ä¹‹é—´çš„å…³ç³»å¯åˆ†ä¸ºï¼š çˆ¶å­å…³ç³»ï¼ˆåµŒå¥—å…³ç³»ï¼‰ head title/title/head å…„å¼Ÿå…³ç³»ï¼ˆå¹¶åˆ—å…³ç³»ï¼‰ head/headbody/body å¸¸ç”¨æ ‡ç­¾æ’ç‰ˆæ ‡ç­¾æ ‡é¢˜æ ‡ç­¾ åœºæ™¯ï¼šåœ¨æ–°é—»å’Œæ–‡ç« çš„é¡µé¢ä¸­ï¼Œéƒ½ç¦»ä¸å¼€ æ ‡é¢˜ï¼Œç”¨æ¥çªå‡ºæ˜¾ç¤ºæ–‡ç« ä¸»é¢˜ ä»£ç ï¼šh ç³»åˆ—æ ‡ç­¾ h1ä¸€çº§æ ‡é¢˜/h1h2äºŒçº§æ ‡é¢˜/h2h3ä¸‰çº§æ ‡é¢˜/h3h4å››çº§æ ‡é¢˜/h4h5äº”çº§æ ‡é¢˜/h5h6å…­çº§æ ‡é¢˜/h6 è¯­ä¹‰ï¼š1~6 çº§æ ‡é¢˜ï¼Œé‡è¦ç¨‹åº¦ä¾æ¬¡é€’å‡ ç‰¹ç‚¹ï¼š æ–‡å­—éƒ½æœ‰åŠ ç²— æ–‡å­—éƒ½æœ‰å˜å¤§ï¼Œå¹¶ä¸”ä» h1 â†’ h6 æ–‡å­—é€æ¸å‡å° ç‹¬å ä¸€è¡Œ æ³¨æ„ç‚¹ï¼š h1 æ ‡ç­¾å¯¹äºç½‘é¡µå°¤ä¸ºé‡è¦ï¼Œä¸€ä¸ªç½‘é¡µä¸­åªèƒ½ç”¨ä¸€æ¬¡ï¼Œå¼€å‘ä¸­æœ‰ç‰¹å®šçš„ä½¿ç”¨åœºæ™¯ï¼Œå¦‚ï¼šæ–°é—»çš„æ ‡é¢˜ã€ç½‘é¡µçš„ logo éƒ¨åˆ† æ®µè½æ ‡ç­¾ åœºæ™¯ï¼šåœ¨æ–°é—»å’Œæ–‡ç« çš„é¡µé¢ä¸­ï¼Œç”¨äºåˆ†æ®µæ˜¾ç¤º ä»£ç ï¼š pæˆ‘æ˜¯ä¸€æ®µèšŠå­/p è¯­ä¹‰ï¼šæ®µè½ ç‰¹ç‚¹ï¼š æ®µè½ä¹‹é—´å­˜åœ¨é—´éš™ ç‹¬å ä¸€è¡Œ æ¢è¡Œæ ‡ç­¾ åœºæ™¯ï¼šè®©æ–‡å­—å¼ºåˆ¶æ¢è¡Œæ˜¾ç¤º ä»£ç ï¼š br è¯­ä¹‰ï¼šæ¢è¡Œ ç‰¹ç‚¹ï¼š å•æ ‡ç­¾ è®©æ–‡å­—å¼ºåˆ¶æ¢è¡Œ æ°´å¹³çº¿æ ‡ç­¾ åœºæ™¯ï¼šåˆ†å‰²ä¸åŒä¸»é¢˜å†…å®¹çš„æ°´å¹³çº¿ ä»£ç ï¼š hr è¯­ä¹‰ï¼šä¸»é¢˜çš„åˆ†å‰²è½¬æ¢ ç‰¹ç‚¹ï¼š å•æ ‡ç­¾ åœ¨é¡µé¢ä¸­æ˜¾ç¤ºä¸€æ¡æ°´å¹³çº¿ æ–‡æœ¬æ ¼å¼åŒ–æ ‡ç­¾ åœºæ™¯ï¼šéœ€è¦è®©æ–‡å­— åŠ ç²—ã€ä¸‹åˆ’çº¿ã€å€¾æ–œã€åˆ é™¤çº¿ ç­‰æ•ˆæœ ä»£ç ï¼š æ ‡ç­¾ è¯´æ˜ b åŠ ç²— u ä¸‹åˆ’çº¿ i å€¾æ–œ s åˆ é™¤çº¿ æ ‡ç­¾ è¯´æ˜ strong åŠ ç²— ins ä¸‹åˆ’çº¿ em å€¾æ–œ del åˆ é™¤çº¿ è¯­ä¹‰ï¼šçªå‡ºé‡è¦æ€§çš„å¼ºè°ƒè¯­å¢ƒ åª’ä½“æ ‡ç­¾å›¾ç‰‡æ ‡ç­¾ åœºæ™¯ï¼šåœ¨ç½‘é¡µä¸­æ˜¾ç¤ºå›¾ç‰‡ ä»£ç ï¼š img src= alt= ç‰¹ç‚¹ï¼š å•æ ‡ç­¾ img æ ‡ç­¾éœ€è¦å±•ç¤ºå¯¹åº”çš„æ•ˆæœï¼Œéœ€è¦å€ŸåŠ©æ ‡ç­¾çš„å±æ€§è¿›è¡Œè®¾ç½®ï¼ å›¾ç‰‡æ ‡ç­¾å±æ€§ src å±æ€§å€¼ï¼šç›®æ ‡å›¾ç‰‡çš„è·¯å¾„ æ³¨æ„ç‚¹ï¼š å½“å‰ç½‘é¡µå’Œç›®æ ‡å›¾ç‰‡åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œè·¯å¾„ç›´æ¥å†™ç›®æ ‡å›¾ç‰‡çš„åå­—å³å¯ï¼ˆåŒ…æ‹¬åç¼€åï¼‰ alt å±æ€§å€¼ï¼šæ›¿æ¢æ–‡æœ¬ å½“å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶ï¼Œæ‰æ˜¾ç¤º alt çš„æ–‡æœ¬ å½“å›¾ç‰‡åŠ è½½æˆåŠŸæ—¶ï¼Œä¸ä¼šæ˜¾ç¤º alt çš„æ–‡æœ¬ titile å±æ€§å€¼ï¼šæç¤ºæ–‡æœ¬ å½“é¼ æ ‡æ‚¬åœæ—¶ï¼Œæ‰æ˜¾ç¤ºçš„æ–‡æœ¬ æ³¨æ„ç‚¹ï¼štitle å±æ€§ä¸ä»…ä»…å¯ä»¥ç”¨äºå›¾ç‰‡æ ‡ç­¾ï¼Œè¿˜å¯ä»¥ç”¨äºå…¶ä»–æ ‡ç­¾ width å’Œ height å±æ€§å€¼ï¼šå®½åº¦å’Œé«˜åº¦ æ³¨æ„ç‚¹ï¼š å¦‚æœåªè®¾ç½® width æˆ– height ä¸­çš„ä¸€ä¸ªï¼Œå¦ä¸€ä¸ªæ²¡è®¾ç½®çš„ä¼šè‡ªåŠ¨ç­‰æ¯”ä¾‹ç¼©æ”¾ï¼ˆæ­¤æ—¶å›¾ç‰‡ä¸ä¼šå˜å½¢ï¼‰ å¦‚æœåŒæ—¶è®¾ç½®äº† width å’Œ height ä¸¤ä¸ªï¼Œè‹¥è®¾ç½®ä¸å½“æ­¤æ—¶å›¾ç‰‡å¯èƒ½ä¼šå˜å½¢ è·¯å¾„ åœºæ™¯ï¼šé¡µé¢éœ€è¦åŠ è½½å›¾ç‰‡ï¼Œéœ€è¦å…ˆæ‰¾åˆ°å¯¹åº”çš„å›¾ç‰‡ ç±»ä¼¼äºï¼šç”Ÿæ´»ä¸­ä¸¤ä¸ªäººï¼Œæˆ‘è¦å»æ‰¾ä½ ï¼Œéœ€è¦é€šè¿‡ä¸€å®šçš„è·¯å¾„æ‰èƒ½æ‰¾åˆ°ï¼ åŒç†ï¼šé¡µé¢éœ€è¦æ‰¾åˆ°å›¾ç‰‡ï¼Œä¹Ÿæ˜¯éœ€è¦é€šè¿‡è·¯å¾„æ‰èƒ½æ‰¾åˆ° è·¯å¾„å¯åˆ†ä¸ºï¼š ç»å¯¹è·¯å¾„ï¼ˆäº†è§£ï¼‰ æŒ‡ç›®å½•ä¸‹çš„ç»å¯¹ä½ç½®ï¼Œå¯ç›´æ¥åˆ°è¾¾ç›®æ ‡ä½ç½®ï¼Œé€šå¸¸ ä»ç›˜ç¬¦å¼€å§‹ çš„è·¯å¾„ã€‚ ä¾‹å¦‚ï¼š ç›˜ç¬¦å¼€å¤´ï¼šD:\\day01\\images\\1.jpg å®Œæ•´çš„ç½‘ç»œåœ°å€ï¼šhttps://www.itcast.cn/2018czgw/images/logo.gif ç›¸å¯¹è·¯å¾„ï¼ˆå¸¸ç”¨ï¼‰ éŸ³é¢‘æ ‡ç­¾ åœºæ™¯ï¼šåœ¨é¡µé¢ä¸­æ’å…¥éŸ³é¢‘ ä»£ç ï¼š audio src=./music.mp3 controls/audio å¸¸è§å±æ€§ï¼š å±æ€§å åŠŸèƒ½ src éŸ³é¢‘çš„è·¯å¾„ controls æ˜¾ç¤ºæ’­æ”¾çš„æ§ä»¶ autoplay è‡ªåŠ¨æ’­æ”¾ï¼ˆéƒ¨åˆ†æµè§ˆå™¨ä¸æ”¯æŒï¼‰ loop å¾ªç¯æ’­æ”¾ è§†é¢‘æ ‡ç­¾ åœºæ™¯ï¼šåœ¨é¡µé¢ä¸­æ’å…¥è§†é¢‘ ä»£ç ï¼š video src=./video.mp4 controls/video å¸¸è§å±æ€§ï¼š å±æ€§å åŠŸèƒ½ src è§†é¢‘çš„è·¯å¾„ controls æ˜¾ç¤ºæ’­æ”¾çš„æ§ä»¶ autoplay è‡ªåŠ¨æ’­æ”¾ï¼ˆè°·æ­Œæµè§ˆå™¨ä¸­éœ€é…åˆ muted å®ç°é™éŸ³æ’­æ”¾ï¼‰ loop å¾ªç¯æ’­æ”¾ æ³¨æ„ç‚¹ï¼š è§†é¢‘æ ‡ç­¾ç›®å‰ä»…æ”¯æŒä¸‰ç§æ ¼å¼ï¼šMP4ã€WebMã€Ogg é“¾æ¥æ ‡ç­¾ åœºæ™¯ï¼šç‚¹å‡»ä¹‹åï¼Œä»ä¸€ä¸ªé¡µé¢è·³è½¬åˆ°å¦ä¸€ä¸ªé¡µé¢ ä»£ç ï¼š a href=./ç›®æ ‡ç½‘é¡µ.htmlè¶…é“¾æ¥/a ç‰¹ç‚¹ï¼š åŒæ ‡ç­¾ï¼Œå†…éƒ¨å¯ä»¥åŒ…è£¹å†…å®¹ å¦‚æœéœ€è¦ a æ ‡ç­¾ç‚¹å‡»ä¹‹åå»æŒ‡å®šé¡µé¢ï¼Œéœ€è¦è®¾ç½® a æ ‡ç­¾çš„ href å±æ€§ å±æ€§ href å±æ€§å€¼ï¼šç‚¹å‡»ä¹‹åè·³è½¬å»å“ªä¸€ä¸ªç½‘é¡µï¼ˆç›®æ ‡ç½‘é¡µçš„è·¯å¾„ï¼‰ å¤–éƒ¨é“¾æ¥ï¼ša href=https://www.baidu.com/ç™¾åº¦ä¸€ä¸‹/a å†…éƒ¨é“¾æ¥ï¼ša href=./ç›®æ ‡ç½‘é¡µ.htmlè¶…é“¾æ¥/a target å±æ€§å€¼ï¼šç›®æ ‡ç½‘é¡µæ‰“å¼€çš„å½¢å¼ å–å€¼ æ•ˆæœ _self é»˜è®¤å€¼ï¼Œåœ¨å½“å‰çª—å£ä¸­è·³è½¬ï¼ˆè¦†ç›–åŸç½‘é¡µï¼‰ _blank åœ¨æ–°çª—å£ä¸­è·³è½¬ï¼ˆä¿ç•™åŸç½‘é¡µï¼‰ a href=https://www.baidu.com/ target=_blankç™¾åº¦ä¸€ä¸‹/a ç©ºé“¾æ¥ a href=#ç©ºé“¾æ¥/a ç‚¹å‡»ä¹‹åå›åˆ°ç½‘é¡µé¡¶éƒ¨ å¼€å‘ä¸­ä¸ç¡®å®šè¯¥é“¾æ¥æœ€ç»ˆè·³è½¬ä½ç½®ï¼Œç”¨ç©ºé“¾æ¥å ä¸ªä½ç½® åˆ—è¡¨æ ‡ç­¾åˆ—è¡¨çš„åº”ç”¨åœºæ™¯ åœºæ™¯ï¼šåœ¨ç½‘é¡µä¸­æŒ‰ç…§è¡Œå±•ç¤ºå…³è”æ€§çš„å†…å®¹ï¼Œå¦‚ï¼šæ–°é—»åˆ—è¡¨ã€æ’è¡Œæ¦œã€è´¦å•ç­‰ ç‰¹ç‚¹ï¼šæŒ‰ç…§è¡Œçš„æ–¹å¼ï¼Œæ•´é½æ˜¾ç¤ºå†…å®¹ ç§ç±»ï¼šæ— åºåˆ—è¡¨ã€æœ‰åºåˆ—è¡¨ã€è‡ªå®šä¹‰åˆ—è¡¨ æ— åºåˆ—è¡¨ åœºæ™¯ï¼šåœ¨ç½‘é¡µä¸­è¡¨ç¤ºä¸€ç»„æ— é¡ºåºä¹‹åˆ†çš„åˆ—è¡¨ï¼Œå¦‚ï¼šæ–°é—»åˆ—è¡¨ æ ‡ç­¾ç»„æˆï¼š æ ‡ç­¾å è¯´æ˜ ul è¡¨ç¤ºæ— åºåˆ—è¡¨çš„æ•´ä½“ï¼Œç”¨äºåŒ…è£¹ li æ ‡ç­¾ li è¡¨ç¤ºæ— åºåˆ—è¡¨çš„æ¯ä¸€é¡¹ï¼Œç”¨äºåŒ…å«æ¯ä¸€è¡Œçš„å†…å®¹ æ˜¾ç¤ºç‰¹ç‚¹ï¼š åˆ—è¡¨çš„æ²¡ä¸€é¡¹é»˜è®¤æ˜¾ç¤ºåŸç‚¹æ ‡è¯† æ³¨æ„ç‚¹ï¼š ul æ ‡ç­¾ä¸­åªå…è®¸åŒ…å« li æ ‡ç­¾ li æ ‡ç­¾å¯ä»¥åŒ…å«ä»»æ„å†…å®¹ ä»£ç ï¼š body ul liæ¦´è²/li lié¦™è•‰/li liè‹¹æœ/li /ul/body æœ‰åºåˆ—è¡¨ åœºæ™¯ï¼šåœ¨ç½‘é¡µä¸­è¡¨ç¤ºä¸€ç»„æœ‰é¡ºåºä¹‹åˆ†çš„åˆ—è¡¨ï¼Œå¦‚ï¼šæ’è¡Œæ¦œ æ ‡ç­¾ç»„æˆï¼š æ ‡ç­¾å è¯´æ˜ ol è¡¨ç¤ºæœ‰åºåˆ—è¡¨çš„æ•´ä½“ï¼Œç”¨äºåŒ…è£¹ li æ ‡ç­¾ li è¡¨ç¤ºæœ‰åºåˆ—è¡¨çš„æ¯ä¸€é¡¹ï¼Œç”¨äºåŒ…å«æ¯ä¸€è¡Œçš„å†…å®¹ æ˜¾ç¤ºç‰¹ç‚¹ï¼š åˆ—è¡¨çš„æ²¡ä¸€é¡¹å‰é»˜è®¤æ˜¾ç¤ºåºå·æ ‡è¯† æ³¨æ„ç‚¹ï¼š ol æ ‡ç­¾ä¸­åªå…è®¸åŒ…å« li æ ‡ç­¾ li æ ‡ç­¾å¯ä»¥åŒ…å«ä»»æ„å†…å®¹ ä»£ç ï¼š body ol liå¼ ä¸‰:100/li liæå››: 80/li /ol/body è‡ªå®šä¹‰åˆ—è¡¨ åœºæ™¯ï¼šåœ¨ç½‘é¡µçš„åº•éƒ¨å¯¼èˆªä¸­é€šå¸¸ä¼šä½¿ç”¨è‡ªå®šä¹‰åˆ—è¡¨å®ç° æ ‡ç­¾ç»„æˆï¼š æ ‡ç­¾å è¯´æ˜ dl è¡¨ç¤ºè‡ªå®šä¹‰åˆ—è¡¨çš„æ•´ä½“ï¼Œç”¨äºåŒ…è£¹ dtdd æ ‡ç­¾ dt è¡¨ç¤ºè‡ªå®šä¹‰åˆ—è¡¨çš„ä¸»é¢˜ dd è¡¨ç¤ºè‡ªå®šä¹‰åˆ—è¡¨çš„é’ˆå¯¹ä¸»é¢˜çš„æ¯ä¸€é¡¹å†…å®¹ æ˜¾ç¤ºç‰¹ç‚¹ï¼š dd ä¼šé»˜è®¤æ˜¾ç¤ºç¼©è¿›æ•ˆæœ æ³¨æ„ç‚¹ï¼š dl æ ‡ç­¾ä¸­åªå…è®¸åŒ…å« dtdd æ ‡ç­¾ dtdd æ ‡ç­¾å¯ä»¥åŒ…å«ä»»æ„å†…å®¹ ä»£ç ï¼š body dl dtå¸®åŠ©ä¸­å¿ƒ/dt ddè´¦æˆ·ç®¡ç†/dd ddè´­ç‰©æŒ‡å—/dd /dl/body è¡¨æ ¼æ ‡ç­¾è¡¨æ ¼åŸºæœ¬æ ‡ç­¾ åœºæ™¯ï¼šåœ¨ç½‘é¡µä¸­ä»¥è¡Œ+åˆ—çš„å•å…ƒæ ¼çš„æ–¹å¼æ•´é½å±•ç¤ºå’Œæ•°æ®ï¼Œå¦‚ï¼šå­¦ç”Ÿæˆç»©è¡¨ åŸºæœ¬æ ‡ç­¾ï¼š æ ‡ç­¾å è¯´æ˜ table è¡¨æ ¼æ•´ä½“ï¼Œå¯ç”¨äºåŒ…è£¹å¤šä¸ª tr tr è¡¨æ ¼æ¯è¡Œï¼Œå¯ç”¨äºåŒ…è£¹ td th è¡¨å¤´å•å…ƒæ ¼ td è¡¨æ ¼å•å…ƒæ ¼ï¼Œå¯ç”¨äºåŒ…è£¹å†…å®¹ æ³¨æ„ç‚¹ï¼š æ ‡ç­¾çš„åµŒå¥—å…³ç³»ï¼štable tr th td è¡¨æ ¼ç›¸å…³å±æ€§ åœºæ™¯ï¼šè®¾ç½®è¡¨æ ¼åŸºæœ¬å±•ç¤ºæ•ˆæœ å¸¸è§ç›¸å…³å±æ€§ï¼š å±æ€§å å±æ€§å€¼ æ•ˆæœ border æ•°å­— è¾¹æ¡†å®½åº¦ width æ•°å­— è¡¨æ ¼å®½åº¦ height æ•°å­— è¡¨æ ¼é«˜åº¦ æ³¨æ„ç‚¹ï¼š å®é™…å¼€å‘æ—¶é’ˆå¯¹äºæ ·å¼æ•ˆæœ æ¨èç”¨ CSS è®¾ç½® è¡¨æ ¼æ ‡é¢˜å’Œè¡¨æ ¼å•å…ƒå¤´æ ‡ç­¾ åœºæ™¯ï¼šåœ¨è¡¨æ ¼ä¸­è¡¨ç¤ºæ•´ä½“å¤§æ ‡é¢˜å’Œä¸€åˆ—å°æ ‡é¢˜ å…¶ä»–æ ‡ç­¾ï¼š æ ‡ç­¾å åç§° è¯´æ˜ caption è¡¨æ ¼å¤§æ ‡é¢˜ è¡¨ç¤ºè¡¨æ ¼æ•´ä½“å¤§æ ‡é¢˜ï¼Œé»˜è®¤åœ¨è¡¨æ ¼æ•´ä½“é¡¶éƒ¨å±…ä¸­ä½ç½®æ˜¾ç¤º th è¡¨æ ¼å•å…ƒæ ¼ è¡¨ç¤ºä¸€ç³»åˆ—å°æ ‡é¢˜ï¼Œé€šå¸¸ç”¨äºè¡¨æ ¼ç¬¬ä¸€è¡Œï¼Œé»˜è®¤å†…éƒ¨æ–‡å­—åŠ ç²—å¹¶å±…ä¸­æ˜¾ç¤º æ³¨æ„ç‚¹ï¼š caption æ ‡ç­¾ä¹¦å†™åœ¨ table æ ‡ç­¾å†…éƒ¨ th æ ‡ç­¾ä¹¦å†™åœ¨ tr æ ‡ç­¾å†…éƒ¨ï¼ˆç”¨äºæ›¿æ¢ td æ ‡ç­¾ï¼‰ è¡¨æ ¼ç»“æ„æ ‡ç­¾ åœºæ™¯ï¼šè®©è¡¨æ ¼çš„å†…å®¹ç»“æ„åˆ†ç»„ï¼Œçªå‡ºè¡¨æ ¼çš„ä¸åŒéƒ¨åˆ†ï¼ˆå¤´éƒ¨ã€ä¸»ä½“ã€åº•éƒ¨ï¼‰ï¼Œä½¿è¯­ä¹‰æ›´åŠ æ¸…æ™° ç»“æ„æ ‡ç­¾ï¼š æ ‡ç­¾å åç§° thead è¡¨æ ¼å¤´éƒ¨ tbody è¡¨æ ¼ä¸»ä½“ tfoot è¡¨æ ¼åº•éƒ¨ æ³¨æ„ç‚¹ï¼š è¡¨æ ¼ç»“æ„æ ‡ç­¾å†…éƒ¨ç”¨äºåŒ…è£¹ tr æ ‡ç­¾ è¡¨æ ¼çš„ç»“æ„æ ‡ç­¾å¯ä»¥çœç•¥ ä»£ç : table border=1 width=300 height=300 captionstrongå­¦ç”Ÿæˆç»©å•/strong/caption thead tr thå§“å/th thæˆç»©/th thè¯„ä»·/th /tr /thead tbody tr tdå¼ ä¸‰/td tdä¼˜ç§€/td /tr tr tdæå››/td tdä¼˜ç§€/td /tr tr tdç‹äºŒéº»å­/td tdè‰¯å¥½/td /tr /tbody tfoot tr tdæ€»ç»“/td tdå“ˆå“ˆ/td /tr /tfoot/table åˆå¹¶å•å…ƒæ ¼ åœºæ™¯ï¼šå°† æ°´å¹³æˆ–å‚ç›´ å¤šä¸ªå•å…ƒæ ¼ åˆå¹¶æˆä¸€ä¸ªå•å…ƒæ ¼ åˆå¹¶å•å…ƒæ ¼æ­¥éª¤ï¼š æ˜ç¡®åˆå¹¶å“ªå‡ ä¸ªå•å…ƒæ ¼ é€šè¿‡å·¦ä¸ŠåŸåˆ™ï¼Œç¡®å®šä¿ç•™è°åˆ é™¤è° ä¸Šä¸‹åˆå¹¶ â†’ åªä¿ç•™æœ€ä¸Šçš„ï¼Œåˆ é™¤å…¶ä»– å·¦å³åˆå¹¶ â†’ åªä¿ç•™æœ€å·¦çš„ï¼Œåˆ é™¤å…¶ä»– ç»™ä¿ç•™çš„å•å…ƒæ ¼è®¾ç½®ï¼šè·¨è¡Œåˆå¹¶ï¼ˆrowspanï¼‰æˆ–è€…è·¨åˆ—åˆå¹¶ï¼ˆcolspanï¼‰ å±æ€§å å±æ€§å€¼ è¯´æ˜ rowspan åˆå¹¶å•å…ƒæ ¼çš„ä¸ªæ•° è·¨è¡Œåˆå¹¶ï¼Œå°†å¤šè¡Œçš„å•å…ƒæ ¼å‚ç›´åˆå¹¶ colspan åˆå¹¶å•å…ƒæ ¼çš„ä¸ªæ•° è·¨åˆ—åˆå¹¶ï¼Œå°†å¤šåˆ—çš„å•å…ƒæ ¼æ°´å¹³åˆå¹¶ æ³¨æ„ç‚¹ï¼šåªæœ‰åŒä¸€ä¸ªç»“æ„æ ‡ç­¾ä¸­çš„å•å…ƒæ ¼æ‰èƒ½åˆå¹¶ï¼Œä¸èƒ½è·¨ç»“æ„æ ‡ç­¾åˆå¹¶ï¼ˆä¸èƒ½è·¨ï¼štheadã€tbodyã€tfootï¼‰ ä»£ç ï¼š body table border=1 width=300 height=300 captionå­¦ç”Ÿæˆç»©å•/caption tr thå§“å/th thæˆç»©/th thè¯„è¯­/th /tr tr tdç‹äº”/td td rowspan=2100/td tdä¼˜ç§€/td /tr tr tdèµµå››/td tdç‰›æ‰¹/td /tr tr tdæ€»ç»“/td td colspan=2å¼å¼å¼/td /tr /table/body è¡¨å•æ ‡ç­¾input ç³»åˆ—input ç³»åˆ—æ ‡ç­¾çš„åŸºæœ¬ä»‹ç» åœºæ™¯ï¼šåœ¨ç½‘é¡µä¸­æ˜¾ç¤ºæ”¶é›†ç”¨æˆ·ä¿¡æ¯çš„è¡¨å•æ•ˆæœï¼Œå¦‚ï¼šç™»å½•é¡µã€æ³¨å†Œé¡µ æ ‡ç­¾åï¼šinput input æ ‡ç­¾å¯ä»¥é€šè¿‡ type å±æ€§å€¼ çš„ä¸åŒï¼Œå±•ç¤ºä¸åŒæ•ˆæœ type å±æ€§å€¼ï¼š æ ‡ç­¾å type å±æ€§å€¼ è¯´æ˜ input text æ–‡æœ¬æ¡†ï¼Œç”¨äºè¾“å…¥å•è¡Œæ–‡æœ¬ input password å¯†ç æ¡†ï¼Œç”¨äºè¾“å…¥å¯†ç  input radio å•é€‰æ¡†ï¼Œç”¨äºå¤šé€‰ä¸€ input checkbox å¤šé€‰æ¡†ï¼Œç”¨äºå¤šé€‰å¤š input file æ–‡ä»¶é€‰æ‹©ï¼Œç”¨äºä¹‹åä¸Šä¼ æ–‡ä»¶ input submit æäº¤æŒ‰é’®ï¼Œç”¨äºæäº¤ input reset é‡ç½®æŒ‰é’®ï¼Œç”¨äºé‡ç½® input button æ™®é€šæŒ‰é’®ï¼Œé»˜è®¤æ— åŠŸèƒ½ï¼Œä¹‹åé…åˆ js æ·»åŠ åŠŸèƒ½ value å±æ€§å’Œ name å±æ€§ value å±æ€§ï¼šç”¨æˆ·è¾“å…¥çš„å†…å®¹ï¼Œæäº¤ä¹‹åä¼šå‘é€ç»™åç«¯æœåŠ¡å™¨ name å±æ€§ï¼šå½“å‰æ§ä»¶çš„å«ä¹‰ï¼Œæäº¤ä¹‹åå¯ä»¥å‘Šè¯‰åç«¯å‘é€è¿‡å»çš„æ•°æ®æ˜¯ä»€ä¹ˆå«ä¹‰ åç«¯æ¥æ”¶åˆ°æ•°æ®çš„æ ¼å¼æ˜¯ï¼šname çš„å±æ€§å€¼ value çš„å±æ€§å€¼ input ç³»åˆ—æ ‡ç­¾-æ–‡æœ¬æ¡† åœºæ™¯ï¼šåœ¨ç½‘é¡µä¸­æ˜¾ç¤º è¾“å…¥å•è¡Œæ–‡æœ¬ çš„è¡¨å•æ§ä»¶ type å±æ€§å€¼ï¼štext å¸¸ç”¨å±æ€§ï¼š å±æ€§å è¯´æ˜ placeholder å ä½ç¬¦ï¼Œæç¤ºç”¨æˆ·è¾“å…¥å†…å®¹çš„æ–‡æœ¬ ä»£ç ï¼š body input type=text placeholder=è¯·è¾“å…¥ç”¨æˆ·å/body input ç³»åˆ—æ ‡ç­¾-å¯†ç æ¡† åœºæ™¯ï¼šåœ¨ç½‘é¡µä¸­æ˜¾ç¤º è¾“å…¥å¯†ç  çš„è¡¨å•æ§ä»¶ type å±æ€§å€¼ï¼špassword å¸¸ç”¨å±æ€§ï¼š å±æ€§å è¯´æ˜ placeholder å ä½ç¬¦ï¼Œæç¤ºç”¨æˆ·è¾“å…¥å†…å®¹çš„æ–‡æœ¬ æ³¨æ„ç‚¹ï¼š â€¢ type å±æ€§å€¼ä¸è¦æ‹¼é”™æˆ–è€…å¤šåŠ ç©ºæ ¼ï¼Œå¦åˆ™ç›¸å½“äºè®¾ç½®äº†é»˜è®¤å€¼çŠ¶æ€ï¼štextâ†’ æ–‡æœ¬æ¡† ä»£ç ï¼š body input type=password placeholder=è¯·è¾“å…¥å¯†ç /body input ç³»åˆ—æ ‡ç­¾-å•é€‰æ¡† åœºæ™¯ï¼šåœ¨ç½‘é¡µä¸­æ˜¾ç¤º å¤šé€‰ä¸€çš„å•é€‰ è¡¨å•æ§ä»¶ type å±æ€§å€¼ï¼šradio å¸¸ç”¨å±æ€§ï¼š å±æ€§å è¯´æ˜ name åˆ†ç»„ï¼Œæœ‰ç›¸åŒ name å±æ€§å€¼çš„å•é€‰æ¡†ä¸ºä¸€ç»„ï¼Œä¸€ç»„ä¸­åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªè¢«é€‰ä¸­çš„ checked é»˜è®¤é€‰ä¸­ æ³¨æ„ç‚¹ï¼š name å±æ€§å¯¹äºå•é€‰æ¡†æœ‰åˆ†ç»„åŠŸèƒ½ æœ‰ç›¸åŒ name å±æ€§å€¼çš„å•é€‰æ¡†ä¸ºä¸€ç»„ï¼Œä¸€ç»„ä¸­åªèƒ½åŒæ—¶æœ‰ä¸€ä¸ªè¢«é€‰ä¸­ ä»£ç ï¼š body æ€§åˆ«: input type=radio name=sexç”· input type=radio name=sex checkedå¥³/body input ç³»åˆ—æ ‡ç­¾-å¤é€‰æ¡† åœºæ™¯ï¼šåœ¨ç½‘é¡µä¸­æ˜¾ç¤º å¤šé€‰å¤šçš„å¤šé€‰ è¡¨å•æ§ä»¶ type å±æ€§å€¼ï¼šcheckbox å¸¸ç”¨å±æ€§ï¼š å±æ€§å è¯´æ˜ checked é»˜è®¤é€‰ä¸­ ä»£ç ï¼š body input type=checkbox checked/body input ç³»åˆ—æ ‡ç­¾-æ–‡ä»¶é€‰æ‹© åœºæ™¯ï¼šåœ¨ç½‘é¡µä¸­æ˜¾ç¤º æ–‡ä»¶é€‰æ‹©çš„ è¡¨å•æ§ä»¶ type å±æ€§å€¼ï¼šfile å¸¸ç”¨å±æ€§ï¼š å±æ€§å è¯´æ˜ multiple å¤šæ–‡ä»¶é€‰æ‹© ä»£ç ï¼š body input type=file multiple/body input ç³»åˆ—æ ‡ç­¾-æŒ‰é’® åœºæ™¯ï¼šåœ¨ç½‘é¡µä¸­æ˜¾ç¤º ä¸åŒåŠŸèƒ½çš„æŒ‰é’® è¡¨å•æ§ä»¶ type å±æ€§å€¼ï¼š æ ‡ç­¾å type å±æ€§å€¼ è¯´æ˜ input submit æäº¤æŒ‰é’®ã€‚ç‚¹å‡»ä¹‹åæäº¤æ•°æ®ç»™åç«¯æœåŠ¡å™¨ input reset é‡ç½®æŒ‰é’®ã€‚ç‚¹å‡»ä¹‹åå›å¤è¡¨å•é»˜è®¤å€¼ input button æ™®é€šæŒ‰é’®ã€‚é»˜è®¤æ— åŠŸèƒ½ï¼Œä¹‹åé…åˆ js æ·»åŠ åŠŸèƒ½ æ³¨æ„ç‚¹ï¼š å¦‚æœéœ€è¦å®ç°ä»¥ä¸ŠæŒ‰é’®åŠŸèƒ½ï¼Œéœ€è¦é…åˆ form æ ‡ç­¾ä½¿ç”¨ form ä½¿ç”¨æ–¹æ³•ï¼šç”¨ form æ ‡ç­¾æŠŠè¡¨å•æ ‡ç­¾ä¸€èµ·åŒ…è£¹èµ·æ¥å³å¯ ä»£ç ï¼š body form action= ç”¨æˆ·å: input type=text br br å¯†ç : input type=password br br !-- æŒ‰é’® -- input type=submit value=å…è´¹æ³¨å†Œ input type=reset input type=button value=æ™®é€šæŒ‰é’® !-- å±æ€§ xx=xxx -- /form/body button æŒ‰é’®æ ‡ç­¾ åœºæ™¯ï¼šåœ¨ç½‘é¡µä¸­æ˜¾ç¤ºç”¨æˆ·ç‚¹å‡»çš„æŒ‰é’® æ ‡ç­¾åï¼šbutton type å±æ€§å€¼ï¼ˆåŒ input çš„æŒ‰é’®ç³»åˆ—ï¼‰ï¼š æ ‡ç­¾å type å±æ€§å€¼ è¯´æ˜ button submit æäº¤æŒ‰é’®ã€‚ç‚¹å‡»ä¹‹åæäº¤æ•°æ®ç»™åç«¯æœåŠ¡å™¨ button reset é‡ç½®æŒ‰é’®ã€‚ç‚¹å‡»ä¹‹åå›å¤è¡¨å•é»˜è®¤å€¼ button button æ™®é€šæŒ‰é’®ã€‚é»˜è®¤æ— åŠŸèƒ½ï¼Œä¹‹åé…åˆ js æ·»åŠ åŠŸèƒ½ æ³¨æ„ç‚¹ï¼š è°·æ­Œæµè§ˆå™¨ä¸­ button é»˜è®¤æ˜¯æäº¤æŒ‰é’® button æ ‡ç­¾æ˜¯åŒæ ‡ç­¾ï¼Œæ›´ä¾¿äºåŒ…è£¹å…¶ä»–å†…å®¹ï¼šæ–‡å­—ã€å›¾ç‰‡ç­‰ ä»£ç ï¼š body buttonæˆ‘æ˜¯æŒ‰é’®/button button type=submitæäº¤æŒ‰é’®/button button type=reseté‡ç½®æŒ‰é’®/button button type=buttonæ™®é€šæŒ‰é’®, æ²¡æœ‰ä»»ä½•åŠŸèƒ½/button/body select ä¸‹æ‹‰èœå•æ ‡ç­¾ åœºæ™¯ï¼šåœ¨ç½‘é¡µä¸­æä¾›å¤šä¸ªé€‰æ‹©é¡¹çš„ä¸‹æ‹‰èœå•è¡¨å•æ§ä»¶ æ ‡ç­¾ç»„æˆï¼š select æ ‡ç­¾ï¼šä¸‹æ‹‰èœå•çš„æ•´ä½“ option æ ‡ç­¾ï¼šä¸‹æ‹‰èœå•çš„æ¯ä¸€é¡¹ å¸¸è§å±æ€§ï¼š selectedï¼šä¸‹æ‹‰èœå•çš„é»˜è®¤é€‰ä¸­ ä»£ç ï¼š body select optionåŒ—äº¬/option optionä¸Šæµ·/option optionå¹¿å·/option option selectedæ·±åœ³/option /select/body textarea æ–‡æœ¬åŸŸæ ‡ç­¾ åœºæ™¯ï¼šåœ¨ç½‘é¡µä¸­æä¾›å¯è¾“å…¥å¤šè¡Œæ–‡æœ¬çš„è¡¨å•æ§ä»¶ æ ‡ç­¾åï¼štextarea å¸¸è§å±æ€§ï¼š colsï¼šè§„å®šäº†æ–‡æœ¬åŸŸå†…å¯è§å®½åº¦ rowsï¼šè§„å®šäº†æ–‡æœ¬åŸŸå†…å¯è§è¡Œæ•° æ³¨æ„ç‚¹ï¼š å³ä¸‹è§’å¯ä»¥æ‹–æ‹½æ”¹å˜å¤§å° å®é™…å¼€å‘æ—¶é’ˆå¯¹äºæ ·å¼æ•ˆæœ æ¨èç”¨ CSS è®¾ç½® ä»£ç ï¼š body textarea cols=60 rows=30/textarea/body label æ ‡ç­¾ åœºæ™¯ï¼šå¸¸ç”¨äºç»‘å®šå†…å®¹ä¸è¡¨å•æ ‡ç­¾çš„å…³ç³»ï¼ˆé€šè¿‡ç‚¹å‡»æ–‡å­—å¯ä»¥ç›´æ¥é€‰ä¸­å•é€‰æ¡†ï¼‰ æ ‡ç­¾åï¼šlabel ä½¿ç”¨æ–¹æ³• â‘ ï¼š ä½¿ç”¨ label æ ‡ç­¾æŠŠå†…å®¹ï¼ˆå¦‚ï¼šæ–‡æœ¬ï¼‰åŒ…è£¹èµ·æ¥ åœ¨è¡¨å•æ ‡ç­¾ä¸Šæ·»åŠ  id å±æ€§ åœ¨ label æ ‡ç­¾çš„ for å±æ€§ä¸­è®¾ç½®å¯¹åº”çš„ id å±æ€§å€¼ ä½¿ç”¨æ–¹æ³• â‘¡ï¼š ç›´æ¥ä½¿ç”¨ label æ ‡ç­¾æŠŠå†…å®¹ï¼ˆå¦‚ï¼šæ–‡æœ¬ï¼‰å’Œè¡¨å•æ ‡ç­¾ä¸€èµ·åŒ…è£¹èµ·æ¥ éœ€è¦æŠŠ label æ ‡ç­¾çš„ for å±æ€§åˆ é™¤å³å¯ ä»£ç ï¼š body æ€§åˆ«: input type=radio name=sex id=nan label for=nanç”·/label labelinput type=radio name=sex å¥³/label/body è¯­ä¹‰åŒ–æ ‡ç­¾æ²¡æœ‰è¯­ä¹‰çš„å¸ƒå±€æ ‡ç­¾-div å’Œ span åœºæ™¯ï¼šå®é™…å¼€å‘ç½‘é¡µæ—¶ä¼šå¤§é‡é¢‘ç¹çš„ä½¿ç”¨åˆ° div å’Œ span è¿™ä¸¤ä¸ªæ²¡è¯­ä¹‰çš„å¸ƒå±€æ ‡ç­¾ div æ ‡ç­¾ï¼šä¸€è¡Œåªæ˜¾ç¤ºä¸€ä¸ªï¼ˆç‹¬å ä¸€è¡Œï¼‰ span æ ‡ç­¾ï¼šä¸€è¡Œå¯ä»¥æ˜¾ç¤ºå¤šä¸ª æœ‰è¯­ä¹‰çš„å¸ƒå±€æ ‡ç­¾ï¼ˆäº†è§£ï¼‰ åœºæ™¯ï¼šåœ¨ HTML5 æ–°ç‰ˆæœ¬ä¸­ï¼Œæ¨å‡ºäº†ä¸€äº›æœ‰è¯­ä¹‰çš„å¸ƒå±€æ ‡ç­¾ä¾›å¼€å‘è€…ä½¿ç”¨ æ ‡ç­¾ï¼š æ ‡ç­¾å è¯­ä¹‰ header ç½‘é¡µå¤´éƒ¨ nav ç½‘é¡µå¯¼èˆª footer ç½‘é¡µåº•éƒ¨ aside ç½‘é¡µä¾§è¾¹æ  section ç½‘é¡µåŒºå— article ç½‘é¡µæ–‡ç«  ç»¼åˆæ¡ˆä¾‹ å­¦ç”Ÿä¿¡æ¯è¡¨ body table border=1 width=500 height=300 captionh3ä¼˜ç§€å­¦ç”Ÿä¿¡æ¯è¡¨æ ¼/h3/caption tr thå¹´çº§/th thå§“å/th thå­¦å·/th thç­çº§/th /tr tr td rowspan=2é«˜ä¸‰/td tdè¿ªä¸½çƒ­å·´/td td110/td tdä¸‰å¹´äºŒç­/td /tr tr tdå¤åŠ›å¨œæ‰/td td120/td tdä¸‰å¹´ä¸‰ç­/td /tr tr tdè¯„è¯­/td td colspan=3ä½ ä»¬å¾ˆä¼˜ç§€/td /tr /table/body æ³¨å†Œè¡¨å• body h1é’æ˜¥ä¸å¸¸åœ¨ï¼ŒæŠ“ç´§è°ˆæ‹çˆ±/h1 hr form action= æ˜µç§°: input type=text placeholder=è¯·è¾“å…¥æ˜µç§° br br æ€§åˆ«: labelinput type=radio name=sex checked ç”·/label labelinput type=radio name=sex å¥³/label brbr æ‰€åœ¨åŸå¸‚: select optionåŒ—äº¬/option option selectedä¸Šæµ·/option optionå¹¿å·/option /select br br å–œæ¬¢çš„ç±»å‹: labelinput type=checkbox checked å¯çˆ±/label labelinput type=checkbox checked æ€§æ„Ÿ/label labelinput type=checkbox å¾¡å§/label br br ä¸ªäººä»‹ç»: br textarea name= id= cols=60 rows=10/textarea h3æˆ‘æ‰¿è¯º/h3 ul liå¹´æ»¡18å²ã€å•èº«/li liå¹´æ»¡18å²ã€å•èº«/li liå¹´æ»¡18å²ã€å•èº«/li /ul !-- æŒ‰é’®: input button -- input type=submit value=å…è´¹æ³¨å†Œ button type=reseté‡ç½®/button /form/body","tags":["HTML","HTMLæ ‡ç­¾"],"categories":["HTML"]},{"path":"/wiki/DeepLearning/æ•°å­¦åŸºç¡€.html","content":"è¯¯å·®åå‘ä¼ æ’­ä»€ä¹ˆæ˜¯è¯¯å·®åå‘ä¼ æ’­è¯¯å·®åå‘ä¼ æ’­æ˜¯æœºå™¨å­¦ä¹ ä¸­è®­ç»ƒç¥ç»ç½‘ç»œçš„ä¸€ç§æ–¹æ³•ã€‚æƒ³è±¡ä½ åœ¨æ•™ä¸€ä¸ªæœºå™¨äººçŒœä¸œè¥¿ï¼ˆæ¯”å¦‚çŒœæˆ¿ä»·ï¼‰ï¼Œä½†å®ƒä¸€å¼€å§‹çŒœå¾—å¾ˆä¸å‡†ã€‚åå‘ä¼ æ’­å°±åƒä¸€ä¸ªâ€œæ•™ç»ƒâ€ï¼Œé€šè¿‡æ¯”è¾ƒâ€œçŒœæµ‹ç»“æœâ€å’Œâ€œæ­£ç¡®ç­”æ¡ˆâ€çš„å·®è·ï¼ˆè¯¯å·®ï¼‰ï¼Œå‘Šè¯‰æœºå™¨äººå“ªé‡Œé”™äº†ã€å¦‚ä½•æ”¹è¿›ï¼Œè®©å®ƒä¸‹æ¬¡çŒœå¾—æ›´å‡†ã€‚ è¿™ä¸ªè¿‡ç¨‹çš„æ ¸å¿ƒæ˜¯ï¼š è®¡ç®—è¯¯å·®ï¼šç”¨å¹³æ–¹å·®æ¥è¡¡é‡çŒœæµ‹å’ŒçœŸå®å€¼å·®å¤šå°‘ã€‚ åå‘è°ƒæ•´ï¼šä»æœ€åçš„ç»“æœï¼ˆè¾“å‡ºï¼‰å¼€å§‹ï¼Œé€æ­¥â€œå€’æ¨â€å›å»ï¼Œè°ƒæ•´æœºå™¨äººçš„â€œæ€è€ƒæ–¹å¼â€ï¼ˆå‚æ•°ï¼‰ï¼Œè®©è¯¯å·®å˜å°ã€‚ ç”¨ä¸€ä¸ªç”Ÿæ´»åŒ–çš„ä¾‹å­è§£é‡Šå‡è®¾ä½ åœ¨ç©ä¸€ä¸ªçŒœæ•°å­—æ¸¸æˆï¼š ç›®æ ‡ï¼šçŒœæœ‹å‹æƒ³çš„æ•°å­—ï¼ˆæ¯”å¦‚çœŸå®å€¼æ˜¯10ï¼‰ã€‚ ä½ çš„çŒœæµ‹ï¼šç¬¬ä¸€æ¬¡çŒœäº†12ï¼ˆé¢„æµ‹å€¼ï¼‰ã€‚ è¯¯å·®ï¼šç”¨å¹³æ–¹å·®è®¡ç®—ï¼Œè¯¯å·®æ˜¯ $(12 - 10)^2 4$ã€‚ ç°åœ¨ï¼Œä½ æƒ³çŒœå¾—æ›´å‡†ã€‚åå‘ä¼ æ’­å°±åƒä½ é—®è‡ªå·±ï¼š â€œæˆ‘çŒœ12æ˜¯å› ä¸ºæˆ‘æ€ä¹ˆæƒ³çš„ï¼Ÿâ€ï¼ˆæ¯”å¦‚ä½ å¿ƒé‡ŒåŠ äº†å‡ ä¸ªæ•°å­—ï¼š5 + 7 12ï¼‰ â€œæ—¢ç„¶é”™äº†2ï¼Œæˆ‘è¯¥æ€ä¹ˆè°ƒæ•´5å’Œ7ï¼Œè®©ç»“æœæ›´æ¥è¿‘10ï¼Ÿâ€ åå‘ä¼ æ’­ä¼šï¼š è®¡ç®—è¯¯å·®ï¼ˆ2çš„å¹³æ–¹4ï¼‰ã€‚ â€œå€’æ¨â€å›å»ï¼Œè°ƒæ•´5å’Œ7ï¼ˆæ¯”å¦‚æŠŠ5æ”¹æˆ4.8ï¼ŒæŠŠ7æ”¹æˆ6.8ï¼‰ã€‚ ä¸‹æ¬¡å†çŒœï¼š4.8 + 6.8 11.6ï¼Œè¯¯å·®å˜å°äº†ï¼ˆ11.6 - 10 1.6ï¼Œå¹³æ–¹å·®æ˜¯2.56ï¼‰ã€‚ æœºå™¨å­¦ä¹ ä¸­çš„ç¥ç»ç½‘ç»œä¹Ÿæ˜¯è¿™æ ·ï¼Œé€šè¿‡ä¸æ–­è°ƒæ•´â€œæ€è€ƒæ–¹å¼â€ï¼ˆæƒé‡å’Œåç½®ï¼‰ï¼Œè®©çŒœæµ‹è¶Šæ¥è¶Šå‡†ã€‚ è¯¯å·®åå‘ä¼ æ’­çš„æ­¥éª¤ï¼ˆç®€å•ç‰ˆï¼‰ç¥ç»ç½‘ç»œå°±åƒä¸€ä¸ªæœ‰å¾ˆå¤šæ—‹é’®ï¼ˆæƒé‡ï¼‰çš„æœºå™¨ï¼Œæ¯ä¸ªæ—‹é’®å½±å“æœ€ç»ˆçš„çŒœæµ‹ç»“æœã€‚åå‘ä¼ æ’­çš„æ­¥éª¤å°±åƒåœ¨è°ƒè¿™äº›æ—‹é’®ï¼š å‰å‘ä¼ æ’­ï¼ˆå…ˆçŒœä¸€æ¬¡ï¼‰ ç»™æœºå™¨äººè¾“å…¥æ•°æ®ï¼ˆæ¯”å¦‚æˆ¿å­çš„å¤§å°ã€ä½ç½®ï¼‰ã€‚ æœºå™¨äººé€šè¿‡â€œæ—‹é’®â€ï¼ˆæƒé‡ï¼‰è®¡ç®—å‡ºä¸€ä¸ªçŒœæµ‹ï¼ˆæ¯”å¦‚æˆ¿ä»·100ä¸‡ï¼‰ã€‚ ç”¨å¹³æ–¹å·®ç®—è¯¯å·®ï¼ˆæ¯”å¦‚çœŸå®æˆ¿ä»·æ˜¯110ä¸‡ï¼Œè¯¯å·®æ˜¯(100 - 110)Â² 100ï¼‰ã€‚ è®¡ç®—è¯¯å·®å¯¹æ—‹é’®çš„å½±å“ é—®ï¼šâ€œè¿™ä¸ªè¯¯å·®ï¼ˆ100ï¼‰æ˜¯å› ä¸ºå“ªä¸ªæ—‹é’®è°ƒå¾—ä¸å¥½ï¼Ÿâ€ ä»æœ€åçš„ç»“æœï¼ˆè¾“å‡ºï¼‰å¼€å§‹ï¼Œæ£€æŸ¥æ¯ä¸ªæ—‹é’®å¯¹è¯¯å·®çš„è´¡çŒ®ã€‚ åå‘è°ƒæ•´æ—‹é’® æ ¹æ®è¯¯å·®ï¼Œç¨å¾®è°ƒæ•´æ¯ä¸ªæ—‹é’®ï¼ˆæƒé‡ï¼‰ï¼Œè®©ä¸‹æ¬¡çŒœå¾—æ›´å‡†ã€‚ æ¯”å¦‚ï¼Œå¦‚æœä¸€ä¸ªæ—‹é’®è®©çŒœæµ‹åé«˜äº†ï¼Œå°±æŠŠå®ƒè°ƒå°ä¸€ç‚¹ã€‚ é‡å¤ å†çŒœä¸€æ¬¡ï¼Œç®—æ–°çš„è¯¯å·®ï¼Œè°ƒæ•´æ—‹é’®ï¼Œç›´åˆ°è¯¯å·®å¾ˆå°ã€‚ ä¸ºä»€ä¹ˆå«â€œåå‘â€ä¼ æ’­ï¼Ÿ æ­£å‘æ˜¯è¾“å…¥æ•°æ®åˆ°è¾“å‡ºçš„è¿‡ç¨‹ï¼ˆä»æˆ¿å­å¤§å°åˆ°é¢„æµ‹æˆ¿ä»·ï¼‰ã€‚ åå‘æ˜¯ä»è¾“å‡ºçš„è¯¯å·®å¼€å§‹ï¼Œå¾€å›æ¨ï¼Œè°ƒæ•´æ¯ä¸€å±‚çš„æ—‹é’®ï¼ˆæƒé‡ï¼‰ã€‚ å°±åƒä½ çŒœé”™äº†æ•°å­—ï¼Œå›å¤´æ£€æŸ¥è‡ªå·±æ¯ä¸€æ­¥çš„è®¡ç®—ï¼Œæ‰¾å‡ºå“ªä¸€æ­¥åŠ é”™äº†ã€‚ å¹³æ–¹å·®åœ¨åå‘ä¼ æ’­ä¸­çš„ä½œç”¨å¹³æ–¹å·®ï¼ˆMSEï¼‰æ˜¯ç”¨æ¥è¡¡é‡â€œçŒœå¾—æœ‰å¤šé”™â€çš„æ ‡å‡†ã€‚æ¯”å¦‚ï¼š é¢„æµ‹æˆ¿ä»·100ä¸‡ï¼ŒçœŸå®110ä¸‡ï¼Œå¹³æ–¹å·®æ˜¯100ã€‚ åå‘ä¼ æ’­ç”¨è¿™ä¸ªå¹³æ–¹å·®æ¥å†³å®šâ€œæ—‹é’®â€è°ƒå¤šå°‘ï¼ˆç”¨æ•°å­¦æ–¹æ³•è®¡ç®—æ¯ä¸ªæ—‹é’®å¯¹è¯¯å·®çš„å½±å“ï¼‰ã€‚ å¹³æ–¹å·®çš„å¥½å¤„æ˜¯å®ƒç®€å•ï¼Œè€Œä¸”èƒ½æ”¾å¤§å¤§çš„è¯¯å·®ï¼ˆæ¯”å¦‚å·®10ä¸‡ï¼Œå¹³æ–¹åæ˜¯10000ï¼Œæé†’æœºå™¨äººè¦é‡ç‚¹æ”¹è¿›ï¼‰ã€‚ åå‘ä¼ æ’­åœ¨æœºå™¨å­¦ä¹ ä¸­çš„é‡è¦æ€§ç¥ç»ç½‘ç»œå°±åƒä¸€ä¸ªè¶…çº§å¤æ‚çš„â€œçŒœæ•°å­—æœºå™¨â€ï¼Œæœ‰æˆåƒä¸Šä¸‡ä¸ªæ—‹é’®ï¼ˆæƒé‡ï¼‰ã€‚åå‘ä¼ æ’­çš„å‰å®³ä¹‹å¤„åœ¨äºï¼š è‡ªåŠ¨åŒ–ï¼šå®ƒèƒ½è‡ªåŠ¨ç®—å‡ºæ¯ä¸ªæ—‹é’®è¯¥æ€ä¹ˆè°ƒã€‚ é«˜æ•ˆï¼šå³ä½¿ç½‘ç»œæœ‰å‡ åå±‚ã€å‡ ç™¾ä¸‡ä¸ªæ—‹é’®ï¼Œä¹Ÿèƒ½å¿«é€Ÿè°ƒæ•´ã€‚ é€šç”¨ï¼šå¯ä»¥ç”¨æ¥è®­ç»ƒå„ç§ä»»åŠ¡ï¼Œæ¯”å¦‚ï¼š é¢„æµ‹æˆ¿ä»·ï¼ˆå›å½’ï¼‰ã€‚ è¯†åˆ«å›¾ç‰‡ä¸­çš„çŒ«ç‹—ï¼ˆåˆ†ç±»ï¼‰ã€‚ ç¿»è¯‘è¯­è¨€ï¼ˆåºåˆ—å»ºæ¨¡ï¼‰ã€‚ ä¸€ä¸ªæ›´å…·ä½“çš„ä¾‹å­å‡è®¾ä½ åœ¨è®­ç»ƒä¸€ä¸ªæœºå™¨äººé¢„æµ‹è€ƒè¯•æˆç»©ï¼š è¾“å…¥ï¼šå­¦ç”Ÿçš„å­¦ä¹ æ—¶é—´ï¼ˆæ¯”å¦‚5å°æ—¶ï¼‰ã€‚ çœŸå®æˆç»©ï¼š80åˆ†ã€‚ æœºå™¨äººçŒœæµ‹ï¼š75åˆ†ï¼ˆç”¨äº†ä¸€äº›æ—‹é’®è®¡ç®—çš„ï¼‰ã€‚ å¹³æ–¹å·®ï¼š(75 - 80)Â² 25ã€‚ åå‘ä¼ æ’­ä¼šï¼š ç”¨å¹³æ–¹å·®25åˆ¤æ–­çŒœå¾—ä¸å¥½ã€‚ å€’æ¨å›å»ï¼Œæ£€æŸ¥â€œå­¦ä¹ æ—¶é—´åˆ°æˆç»©â€çš„è®¡ç®—è¿‡ç¨‹ã€‚ è°ƒæ•´æ—‹é’®ï¼ˆæ¯”å¦‚åŸæ¥æŠŠå­¦ä¹ æ—¶é—´çš„å½±å“ç®—å°äº†ï¼Œå°±æŠŠç›¸å…³æ—‹é’®è°ƒå¤§ï¼‰ã€‚ ä¸‹æ¬¡çŒœï¼šæ¯”å¦‚78åˆ†ï¼Œå¹³æ–¹å·®å˜æˆ(78 - 80)Â² 4ï¼Œæ›´å‡†äº†ï¼ ä¼˜ç‚¹å’Œç¼ºç‚¹ä¼˜ç‚¹ï¼š èƒ½è®©ç¥ç»ç½‘ç»œå­¦ä¼šå¤æ‚ä»»åŠ¡ï¼ˆæ¯”å¦‚è¯†åˆ«å›¾ç‰‡ã€ç¿»è¯‘è¯­è¨€ï¼‰ã€‚ è‡ªåŠ¨è°ƒæ•´ï¼Œä¸éœ€è¦äººæ‰‹åŠ¨è°ƒå‚æ•°ã€‚ é…åˆå¹³æ–¹å·®ï¼Œè®¡ç®—ç®€å•ï¼Œæ•ˆæœå¥½ã€‚ ç¼ºç‚¹ï¼š å¦‚æœç½‘ç»œå¤ªå¤æ‚ï¼ˆæ—‹é’®å¤ªå¤šï¼‰ï¼Œå¯èƒ½å­¦å¾—å¾ˆæ…¢ã€‚ å¯¹å¤§è¯¯å·®å¤ªæ•æ„Ÿï¼ˆå› ä¸ºå¹³æ–¹å·®ä¼šæ”¾å¤§è¯¯å·®ï¼‰ã€‚ æœ‰æ—¶ä¼šâ€œå¡ä½â€ï¼ˆæ¯”å¦‚è°ƒæ•´æ—‹é’®åè¯¯å·®æ²¡å˜å°ï¼‰ï¼Œéœ€è¦æ”¹è¿›æ–¹æ³•ï¼ˆåƒç”¨æ›´å¥½çš„ä¼˜åŒ–å™¨ï¼‰ã€‚ æ€»ç»“è¯¯å·®åå‘ä¼ æ’­å°±åƒä¸€ä¸ªâ€œçº é”™æ•™ç»ƒâ€ï¼š ç”¨å¹³æ–¹å·®çœ‹æœºå™¨äººçŒœå¾—æœ‰å¤šé”™ã€‚ ä»ç»“æœå€’æ¨å›å»ï¼Œè°ƒæ•´æœºå™¨äººçš„â€œæ€è€ƒæ–¹å¼â€ï¼ˆæ—‹é’®æƒé‡ï¼‰ã€‚ åå¤ç»ƒä¹ ï¼Œç›´åˆ°çŒœå¾—å¾ˆå‡†ã€‚ å®ƒè®©ç¥ç»ç½‘ç»œå¯ä»¥ä»é”™è¯¯ä¸­å­¦ä¹ ï¼Œå˜å¾—è¶Šæ¥è¶Šèªæ˜ã€‚å°±åƒä½ åœ¨çŒœæ•°å­—æ¸¸æˆä¸­ä¸æ–­æ”¹è¿›çŒœæµ‹ä¸€æ ·ï¼Œæœºå™¨äººé€šè¿‡åå‘ä¼ æ’­å­¦ä¼šé¢„æµ‹æˆ¿ä»·ã€æˆç»©æˆ–è¯†åˆ«å›¾ç‰‡ã€‚ å¹³æ–¹å·®ä»€ä¹ˆæ˜¯å¹³æ–¹å·®å¹³æ–¹å·®æ˜¯ç”¨æ¥è¡¡é‡â€œé¢„æµ‹å€¼â€å’Œâ€œçœŸå®å€¼â€ä¹‹é—´å·®è·çš„ä¸€ç§æ–¹æ³•ã€‚æƒ³è±¡ä½ åœ¨ç©é£é•–æ¸¸æˆï¼Œç›®æ ‡æ˜¯å°½é‡æ‰”åˆ°é¶å¿ƒï¼ˆçœŸå®å€¼ï¼‰ï¼Œä½†ä½ æ‰”çš„é£é•–å¯èƒ½åç¦»é¶å¿ƒï¼ˆé¢„æµ‹å€¼ï¼‰ã€‚å¹³æ–¹å·®å°±åƒæ˜¯è®¡ç®—ä½ æ¯æ¬¡æ‰”é£é•–åç¦»é¶å¿ƒçš„â€œå¹³å‡è¯¯å·®â€ï¼Œè€Œä¸”å®ƒæ›´åœ¨æ„å¤§çš„åå·®ã€‚ ç”¨ä¸€ä¸ªç”Ÿæ´»åŒ–çš„ä¾‹å­è§£é‡Šå‡è®¾ä½ åœ¨çŒœæœ‹å‹çš„ä½“é‡ï¼š ä½ çŒœäº†3ä¸ªäººçš„ä½“é‡ï¼ˆé¢„æµ‹å€¼ï¼‰ï¼š60å…¬æ–¤ã€70å…¬æ–¤ã€80å…¬æ–¤ã€‚ ä»–ä»¬çš„çœŸå®ä½“é‡æ˜¯ï¼š62å…¬æ–¤ã€68å…¬æ–¤ã€82å…¬æ–¤ã€‚ ä½ æƒ³çŸ¥é“ä½ çš„çŒœæµ‹æœ‰å¤šå‡†ã€‚å¹³æ–¹å·®çš„è®¡ç®—æ­¥éª¤æ˜¯ï¼š ç®—æ¯æ¬¡çŒœæµ‹çš„è¯¯å·® ç¬¬ä¸€ä¸ªäººçš„è¯¯å·®ï¼š60 - 62 -2å…¬æ–¤ ç¬¬äºŒä¸ªäººçš„è¯¯å·®ï¼š70 - 68 2å…¬æ–¤ ç¬¬ä¸‰ä¸ªäººçš„è¯¯å·®ï¼š80 - 82 -2å…¬æ–¤ æŠŠè¯¯å·®å¹³æ–¹ï¼ˆè®©æ‰€æœ‰è¯¯å·®å˜æˆæ­£æ•°ï¼Œå¹¶ä¸”æ”¾å¤§å¤§çš„è¯¯å·®ï¼‰ ç¬¬ä¸€ä¸ªäººçš„è¯¯å·®å¹³æ–¹ï¼š(-2)Â² 4 ç¬¬äºŒä¸ªäººçš„è¯¯å·®å¹³æ–¹ï¼š2Â² 4 ç¬¬ä¸‰ä¸ªäººçš„è¯¯å·®å¹³æ–¹ï¼š(-2)Â² 4 æŠŠæ‰€æœ‰è¯¯å·®å¹³æ–¹åŠ èµ·æ¥ æ€»å’Œ 4 + 4 + 4 12 ç®—å¹³å‡å€¼ï¼ˆé™¤ä»¥äººæ•°ï¼‰ å¹³æ–¹å·® 12 Ã· 3 4 æ‰€ä»¥ï¼Œå¹³æ–¹å·®æ˜¯4ï¼Œæ„æ€æ˜¯ä½ çš„çŒœæµ‹å¹³å‡åç¦»çœŸå®å€¼â€œ4ä¸ªå¹³æ–¹å•ä½â€ã€‚è¿™ä¸ªæ•°å­—è¶Šå°ï¼Œè¯´æ˜ä½ çš„çŒœæµ‹è¶Šå‡†ï¼ ä¸ºä»€ä¹ˆè¦æŠŠè¯¯å·®â€œå¹³æ–¹â€ å»æ‰è´Ÿå·ï¼šè¯¯å·®å¯èƒ½æ˜¯æ­£çš„ï¼ˆçŒœé«˜äº†ï¼‰æˆ–è´Ÿçš„ï¼ˆçŒœä½äº†ï¼‰ï¼Œå¹³æ–¹åéƒ½å˜æˆæ­£æ•°ï¼Œæ–¹ä¾¿åŠ èµ·æ¥ã€‚ æ”¾å¤§-å¤§çš„è¯¯å·®ï¼šå¦‚æœè¯¯å·®å¾ˆå¤§ï¼ˆæ¯”å¦‚çŒœé”™äº†10å…¬æ–¤ï¼‰ï¼Œå¹³æ–¹åæ˜¯100ï¼Œæ¯”å°è¯¯å·®ï¼ˆæ¯”å¦‚1å…¬æ–¤ï¼Œå¹³æ–¹åæ˜¯1ï¼‰å½±å“æ›´å¤§ã€‚è¿™è®©å¹³æ–¹å·®å¯¹â€œä¸¥é‡é”™è¯¯â€æ›´æ•æ„Ÿã€‚ å¹³æ–¹å·®åœ¨æœºå™¨å­¦ä¹ ä¸­çš„ä½œç”¨åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œè®¡ç®—æœºï¼ˆæ¯”å¦‚ç¥ç»ç½‘ç»œï¼‰ä¹Ÿä¼šâ€œçŒœç­”æ¡ˆâ€ï¼ˆé¢„æµ‹å€¼ï¼‰ï¼Œæ¯”å¦‚é¢„æµ‹æˆ¿ä»·ã€ä½“é‡æˆ–è€ƒè¯•æˆç»©ã€‚å¹³æ–¹å·®å‘Šè¯‰è®¡ç®—æœºå®ƒçš„çŒœæµ‹æœ‰å¤šä¸å‡†ï¼š ç›®æ ‡ï¼šè®©å¹³æ–¹å·®è¶Šå°è¶Šå¥½ï¼Œæ„å‘³ç€é¢„æµ‹è¶Šæ¥è¿‘çœŸå®å€¼ã€‚ è®­ç»ƒè¿‡ç¨‹ï¼šè®¡ç®—æœºé€šè¿‡â€œè¯¯å·®åå‘ä¼ æ’­â€ï¼ˆä¹‹å‰æåˆ°çš„ç®—æ³•ï¼‰è°ƒæ•´å†…éƒ¨å‚æ•°ï¼Œè¯•å›¾è®©å¹³æ–¹å·®å˜å°ï¼Œç›¸å½“äºâ€œç»ƒä¹ æ‰”é£é•–â€ï¼Œè®©ä¸‹æ¬¡çŒœå¾—æ›´å‡†ã€‚ ä¸¾ä¸ªæœºå™¨å­¦ä¹ çš„ä¾‹å­å‡å¦‚ä½ åœ¨ç”¨æœºå™¨å­¦ä¹ é¢„æµ‹æˆ¿ä»·ï¼š çœŸå®æˆ¿ä»·ï¼š100ä¸‡ã€150ä¸‡ã€200ä¸‡ è®¡ç®—æœºé¢„æµ‹ï¼š105ä¸‡ã€145ä¸‡ã€210ä¸‡ å¹³æ–¹å·®ä¼šè®¡ç®—æ¯æ¬¡é¢„æµ‹çš„è¯¯å·®ï¼ˆ5ä¸‡ã€-5ä¸‡ã€10ä¸‡ï¼‰ï¼Œå¹³æ–¹ååŠ èµ·æ¥å–å¹³å‡ï¼Œå¾—åˆ°ä¸€ä¸ªæ•°å­—ã€‚è¿™ä¸ªæ•°å­—å¸®åŠ©è®¡ç®—æœºçŸ¥é“è‡ªå·±çš„é¢„æµ‹æœ‰å¤šå·®ï¼Œç„¶åè°ƒæ•´æ¨¡å‹ï¼ˆæ¯”å¦‚æ”¹å˜æƒé‡ï¼‰ï¼Œè®©ä¸‹æ¬¡é¢„æµ‹æ›´æ¥è¿‘çœŸå®æˆ¿ä»·ã€‚ å¹³æ–¹å·®çš„ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ï¼š ç®€å•ï¼Œå®¹æ˜“è®¡ç®—ã€‚ èƒ½å‘Šè¯‰æˆ‘ä»¬é¢„æµ‹æ•´ä½“æœ‰å¤šä¸å‡†ã€‚ å¯¹å¤§çš„é”™è¯¯æ›´æ•æ„Ÿï¼Œé€‚åˆéœ€è¦ç²¾ç¡®é¢„æµ‹çš„åœºæ™¯ï¼ˆæ¯”å¦‚æˆ¿ä»·ï¼‰ã€‚ ç¼ºç‚¹ï¼š å¯¹ç‰¹åˆ«å¤§çš„è¯¯å·®ï¼ˆå¼‚å¸¸å€¼ï¼‰å¤ªæ•æ„Ÿäº†ã€‚æ¯”å¦‚çŒœé”™100å…¬æ–¤ï¼Œå¹³æ–¹åæ˜¯10000ï¼Œä¼šè®©ç»“æœçœ‹èµ·æ¥å¾ˆå¤¸å¼ ã€‚ ä¸é€‚åˆæ‰€æœ‰é—®é¢˜ï¼Œæ¯”å¦‚åˆ†ç±»é—®é¢˜ï¼ˆåˆ¤æ–­æ˜¯çŒ«è¿˜æ˜¯ç‹—ï¼‰ç”¨å…¶ä»–æ–¹æ³•æ›´å¥½ã€‚ æ€»ç»“å¹³æ–¹å·®å°±åƒä¸€ä¸ªâ€œè¯„åˆ†å‘˜â€ï¼Œå‘Šè¯‰ä½ é¢„æµ‹å’ŒçœŸå®å€¼å·®äº†å¤šå°‘ï¼Œå·®å¾—è¶Šå¤§ï¼Œåˆ†æ•°è¶Šé«˜ï¼ˆè¶Šä¸å¥½ï¼‰ã€‚åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œå®ƒå¸®åŠ©è®¡ç®—æœºä¸æ–­æ”¹è¿›é¢„æµ‹ï¼Œå°±åƒä½ é€šè¿‡ç»ƒä¹ æ‰”é£é•–æ¥æé«˜å‘½ä¸­ç‡ä¸€æ ·ã€‚ æ­£æ€åˆ†å¸ƒä»€ä¹ˆæ˜¯æ­£æ€åˆ†å¸ƒï¼Ÿæ­£æ€åˆ†å¸ƒæ˜¯ä¸€ç§æè¿°æ•°æ®åˆ†å¸ƒçš„æ•°å­¦æ¨¡å‹ï¼Œå½¢çŠ¶åƒä¸€ä¸ªâ€œé’Ÿå½¢æ›²çº¿â€ï¼ˆbell curveï¼‰ã€‚å®ƒå‘Šè¯‰æˆ‘ä»¬ï¼Œåœ¨è‡ªç„¶ç•Œæˆ–ç”Ÿæ´»ä¸­ï¼Œå¾ˆå¤šäº‹æƒ…çš„æ•°å€¼å€¾å‘äºèšé›†åœ¨æŸä¸ªå¹³å‡å€¼é™„è¿‘ï¼Œç¦»å¹³å‡å€¼è¶Šè¿œçš„æ•°æ®è¶Šå°‘ã€‚ ç”Ÿæ´»ä¾‹å­ï¼š æƒ³è±¡ä½ åœ¨å­¦æ ¡æµ‹100ä¸ªå­¦ç”Ÿçš„èº«é«˜ã€‚å¤§å¤šæ•°äººçš„èº«é«˜å¯èƒ½é›†ä¸­åœ¨1.65ç±³å·¦å³ï¼ˆå¹³å‡å€¼ï¼‰ï¼Œå°‘æ•°äººç‰¹åˆ«é«˜ï¼ˆæ¯”å¦‚1.9ç±³ï¼‰æˆ–ç‰¹åˆ«çŸ®ï¼ˆæ¯”å¦‚1.4ç±³ï¼‰ã€‚å¦‚æœç”»ä¸€å¼ å›¾ï¼Œæ¨ªè½´æ˜¯èº«é«˜ï¼Œçºµè½´æ˜¯äººæ•°ï¼Œå›¾å½¢ä¼šåƒä¸€ä¸ªå¯¹ç§°çš„â€œé’Ÿå½¢â€ï¼š ä¸­é—´é«˜ï¼ˆå¾ˆå¤šäººæ¥è¿‘å¹³å‡èº«é«˜ï¼‰ã€‚ ä¸¤è¾¹ä½ï¼ˆæé«˜æˆ–æçŸ®çš„äººå¾ˆå°‘ï¼‰ã€‚ è¿™å°±æ˜¯æ­£æ€åˆ†å¸ƒçš„å½¢çŠ¶ï¼ æ­£æ€åˆ†å¸ƒçš„ç‰¹ç‚¹ é’Ÿå½¢æ›²çº¿ æ›²çº¿æ˜¯å¯¹ç§°çš„ï¼Œå¹³å‡å€¼ï¼ˆä¸­é—´ç‚¹ï¼‰å·¦å³ä¸¤è¾¹ä¸€æ ·ã€‚ æ¯”å¦‚ï¼Œå¹³å‡èº«é«˜1.65ç±³ï¼Œ1.6ç±³å’Œ1.7ç±³çš„äººæ•°å·®ä¸å¤šã€‚ å¹³å‡å€¼ï¼ˆMeanï¼‰ æ›²çº¿çš„æœ€é«˜ç‚¹ï¼Œè¡¨ç¤ºæ•°æ®çš„ä¸­å¿ƒã€‚æ¯”å¦‚èº«é«˜çš„å¹³å‡å€¼æ˜¯1.65ç±³ã€‚ æ ‡å‡†å·®ï¼ˆStandard Deviationï¼‰ æè¿°æ•°æ®åˆ†æ•£ç¨‹åº¦ã€‚å¦‚æœæ ‡å‡†å·®å°ï¼Œæ•°æ®å¾ˆé›†ä¸­ï¼ˆæ›²çº¿çª„ï¼‰ï¼›æ ‡å‡†å·®å¤§ï¼Œæ•°æ®åˆ†æ•£ï¼ˆæ›²çº¿å®½ï¼‰ã€‚ æ¯”å¦‚ï¼Œå­¦ç”Ÿèº«é«˜æ ‡å‡†å·®æ˜¯0.1ç±³ï¼Œè¯´æ˜å¤§å¤šæ•°äººèº«é«˜åœ¨1.55ç±³åˆ°1.75ç±³ä¹‹é—´ã€‚ 68-95-99.7æ³•åˆ™ï¼ˆç®€å•è®°å¿†ï¼‰ çº¦68%çš„æ•°æ®åœ¨å¹³å‡å€¼Â±1ä¸ªæ ‡å‡†å·®èŒƒå›´å†…ã€‚ çº¦95%çš„æ•°æ®åœ¨å¹³å‡å€¼Â±2ä¸ªæ ‡å‡†å·®èŒƒå›´å†…ã€‚ çº¦99.7%çš„æ•°æ®åœ¨å¹³å‡å€¼Â±3ä¸ªæ ‡å‡†å·®èŒƒå›´å†…ã€‚ æ¯”å¦‚ï¼Œèº«é«˜å¹³å‡1.65ç±³ï¼Œæ ‡å‡†å·®0.1ç±³ï¼Œé‚£ä¹ˆ68%çš„äººèº«é«˜åœ¨1.55ç±³åˆ°1.75ç±³ä¹‹é—´ã€‚ ç”Ÿæ´»ä¸­çš„æ­£æ€åˆ†å¸ƒæ­£æ€åˆ†å¸ƒåœ¨ç”Ÿæ´»ä¸­å¾ˆå¸¸è§ï¼Œå› ä¸ºå¾ˆå¤šç°è±¡éƒ½ç¬¦åˆâ€œä¸­é—´å¤šã€ä¸¤è¾¹å°‘â€çš„è§„å¾‹ï¼š è€ƒè¯•æˆç»©ï¼šå¤§éƒ¨åˆ†å­¦ç”Ÿæˆç»©æ¥è¿‘å¹³å‡åˆ†ï¼ˆæ¯”å¦‚80åˆ†ï¼‰ï¼Œæé«˜ï¼ˆ100åˆ†ï¼‰æˆ–æä½ï¼ˆ20åˆ†ï¼‰çš„äººå°‘ã€‚ ä½“é‡ï¼šå¤§å¤šæ•°äººä½“é‡æ¥è¿‘å¹³å‡å€¼ï¼Œæèƒ–æˆ–æç˜¦çš„äººå°‘ã€‚ æµ‹é‡è¯¯å·®ï¼šæ¯”å¦‚ä½ ç”¨å°ºå­é‡æ¡Œå­é•¿åº¦ï¼Œå¤šæ¬¡æµ‹é‡å€¼ä¼šå›´ç»•çœŸå®é•¿åº¦ï¼Œè¯¯å·®å‘ˆæ­£æ€åˆ†å¸ƒã€‚ ä»€ä¹ˆæ˜¯æ­£æ€åˆ†å¸ƒéšæœºæ•°æ­£æ€åˆ†å¸ƒéšæœºæ•°æ˜¯æ ¹æ®æ­£æ€åˆ†å¸ƒï¼ˆé’Ÿå½¢æ›²çº¿ï¼‰è§„å¾‹ç”Ÿæˆçš„éšæœºæ•°ã€‚è¿™äº›æ•°å­—çš„åˆ†å¸ƒç‰¹ç‚¹æ˜¯ï¼š å¤§å¤šæ•°æ•°å­—é è¿‘å¹³å‡å€¼ï¼ˆæ¯”å¦‚0ï¼‰ã€‚ ç¦»å¹³å‡å€¼è¶Šè¿œï¼Œæ•°å­—å‡ºç°çš„æ¦‚ç‡è¶Šä½ã€‚ æ•´ä½“å½¢çŠ¶æ˜¯å¯¹ç§°çš„ï¼Œåƒä¸€ä¸ªâ€œé’Ÿå½¢â€ã€‚ ç”Ÿæ´»ä¾‹å­ï¼š æƒ³è±¡ä½ åœ¨ç©ä¸€ä¸ªâ€œéšæœºæŠ½å¥–â€æ¸¸æˆï¼Œå¥–å“æ˜¯â€œèº«é«˜è°ƒæ•´åˆ¸â€ï¼ˆå¯ä»¥éšæœºæ”¹å˜ä½ çš„èº«é«˜ï¼‰ã€‚å¦‚æœæŠ½å¥–ç»“æœç¬¦åˆæ­£æ€åˆ†å¸ƒï¼š å¤§å¤šæ•°äººæŠ½åˆ°çš„ç»“æœæ˜¯èº«é«˜å˜åŒ–å¾ˆå°ï¼ˆæ¯”å¦‚Â±5å˜ç±³ï¼Œé è¿‘å¹³å‡å€¼0ï¼‰ã€‚ æå°‘æ•°äººæŠ½åˆ°å¾ˆå¤§å˜åŒ–ï¼ˆæ¯”å¦‚+50å˜ç±³æˆ–-50å˜ç±³ï¼‰ã€‚ è¿™å°±å«æ­£æ€åˆ†å¸ƒéšæœºæ•°ï¼Œå› ä¸ºæ•°å­—çš„åˆ†å¸ƒç¬¦åˆæ­£æ€åˆ†å¸ƒçš„è§„å¾‹ã€‚ æ­£æ€åˆ†å¸ƒéšæœºæ•°åœ¨ç¥ç»ç½‘ç»œä¸­çš„ä½œç”¨åœ¨ç¥ç»ç½‘ç»œä¸­ï¼ˆæ¯”å¦‚ç”¨æ¥é¢„æµ‹æˆ¿ä»·æˆ–è¯†åˆ«å›¾ç‰‡çš„æ¨¡å‹ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ç»™ç½‘ç»œçš„â€œæ—‹é’®â€ï¼ˆæƒé‡å’Œåç½®ï¼‰è®¾ç½®åˆå§‹å€¼ã€‚è¿™äº›åˆå§‹å€¼å°±åƒæœºå™¨çš„â€œèµ·ç‚¹çŒœæµ‹â€ï¼Œä¼šå½±å“å®ƒå­¦ä¹ çš„æ•ˆæœã€‚ ä¸ºä»€ä¹ˆç”¨æ­£æ€åˆ†å¸ƒéšæœºæ•°ä½œä¸ºåˆå§‹å€¼ï¼Ÿ æ¨¡ä»¿è‡ªç„¶è§„å¾‹ æ­£æ€åˆ†å¸ƒéšæœºæ•°é›†ä¸­åœ¨å¹³å‡å€¼é™„è¿‘ï¼ˆé€šå¸¸è®¾ä¸º0ï¼‰ï¼Œè¿™å°±åƒè‡ªç„¶ç•Œä¸­å¤§å¤šæ•°ç°è±¡ï¼ˆèº«é«˜ã€æˆç»©ï¼‰éƒ½å›´ç»•å¹³å‡å€¼ã€‚ ç»™æƒé‡è®¾å°çš„éšæœºå€¼ï¼ˆæ¯”å¦‚0é™„è¿‘ï¼‰ï¼Œé¿å…ç½‘ç»œä¸€å¼€å§‹å°±â€œçŒœå¾—å¤ªç¦»è°±â€ã€‚ é¿å…å¯¹ç§°æ€§ å¦‚æœæ‰€æœ‰æƒé‡éƒ½è®¾æˆä¸€æ ·çš„æ•°å­—ï¼ˆæ¯”å¦‚éƒ½è®¾ä¸º1ï¼‰ï¼Œç¥ç»ç½‘ç»œå¯èƒ½ä¼šå­¦åˆ°ç›¸åŒçš„ä¸œè¥¿ï¼Œæ— æ³•å‘ç°å¤æ‚è§„å¾‹ã€‚ ç”¨æ­£æ€åˆ†å¸ƒéšæœºæ•°ï¼Œæ¯ä¸ªæƒé‡ç¨å¾®ä¸åŒï¼ˆæœ‰çš„0.1ï¼Œæœ‰çš„-0.05ï¼‰ï¼Œè®©ç½‘ç»œæœ‰â€œå¤šæ ·æ€§â€ï¼Œæ›´å®¹æ˜“å­¦åˆ°æœ‰ç”¨ä¿¡æ¯ã€‚ æ§åˆ¶å¤§å° æ­£æ€åˆ†å¸ƒéšæœºæ•°çš„æ ‡å‡†å·®ï¼ˆåˆ†æ•£ç¨‹åº¦ï¼‰å¯ä»¥æ§åˆ¶æƒé‡çš„å¤§å°ã€‚ æ¯”å¦‚ï¼Œæ ‡å‡†å·®è®¾ä¸º0.01ï¼Œæƒé‡ä¼šå¾ˆå°ï¼ˆå¤§å¤šåœ¨-0.03åˆ°0.03ä¹‹é—´ï¼‰ï¼Œè®©ç½‘ç»œä»â€œä¿å®ˆçŒœæµ‹â€å¼€å§‹ï¼Œé€æ­¥é€šè¿‡è¯¯å·®åå‘ä¼ æ’­è°ƒæ•´ã€‚ ä¸¾ä¸ªç”Ÿæ´»åŒ–çš„ä¾‹å­å‡è®¾ä½ åœ¨æ•™ä¸€ä¸ªæœºå™¨äººçŒœæˆ¿ä»·ï¼š ç¥ç»ç½‘ç»œæœ‰å¾ˆå¤šâ€œæ—‹é’®â€ï¼ˆæƒé‡ï¼‰ï¼Œå†³å®šå®ƒå¦‚ä½•æŠŠè¾“å…¥ï¼ˆæˆ¿å­å¤§å°ï¼‰å˜æˆè¾“å‡ºï¼ˆæˆ¿ä»·ï¼‰ã€‚ ä¸€å¼€å§‹ï¼Œä½ ä¸çŸ¥é“æ¯ä¸ªæ—‹é’®è¯¥è®¾å¤šå¤§ï¼ˆæ¯”å¦‚æˆ¿å­å¤§å°å¯¹æˆ¿ä»·çš„å½±å“æ˜¯0.5è¿˜æ˜¯1ï¼Ÿï¼‰ã€‚ ä½ ç”¨æ­£æ€åˆ†å¸ƒéšæœºæ•°ç»™æ¯ä¸ªæ—‹é’®è®¾ä¸€ä¸ªåˆå§‹å€¼ï¼ˆæ¯”å¦‚å¹³å‡å€¼0ï¼Œæ ‡å‡†å·®0.01ï¼Œå¤§å¤šæ˜¯-0.03åˆ°0.03çš„å°æ•°ï¼‰ã€‚ ä¸ºä»€ä¹ˆè¿™æ ·è®¾ï¼Ÿ å°éšæœºå€¼è®©æœºå™¨äººä¸€å¼€å§‹ä¸ä¼šâ€œä¹±çŒœâ€ï¼ˆæ¯”å¦‚é¢„æµ‹100äº¿çš„æˆ¿ä»·ï¼‰ã€‚ éšæœºæ€§è®©æ¯ä¸ªæ—‹é’®ç•¥æœ‰ä¸åŒï¼Œæœºå™¨äººå¯ä»¥å°è¯•ä¸åŒç»„åˆï¼Œæ‰¾åˆ°æœ€ä½³ç­”æ¡ˆã€‚ ç„¶åï¼Œé€šè¿‡è¯¯å·®åå‘ä¼ æ’­ï¼š æœºå™¨äººé¢„æµ‹æˆ¿ä»·ï¼ˆæ¯”å¦‚100ä¸‡ï¼Œå®é™…110ä¸‡ï¼‰ã€‚ ç”¨å¹³æ–¹å·®ç®—è¯¯å·®ï¼š(100 - 110)Â² 100ã€‚ åå‘ä¼ æ’­æ ¹æ®è¯¯å·®è°ƒæ•´è¿™äº›â€œæ—‹é’®â€ï¼ˆæƒé‡ï¼‰ï¼Œè®©ä¸‹æ¬¡é¢„æµ‹æ›´å‡†ï¼ˆæ¯”å¦‚105ä¸‡ï¼‰ã€‚ æ­£æ€åˆ†å¸ƒéšæœºæ•°å°±åƒç»™æœºå™¨äººä¸€ä¸ªâ€œåˆç†çš„èµ·ç‚¹â€ï¼Œè®©å®ƒä»â€œå·®ä¸å¤šâ€çš„çŒœæµ‹å¼€å§‹å­¦ä¹ ï¼Œè€Œä¸æ˜¯ä»å®Œå…¨é”™è¯¯çš„çŒœæµ‹å‡ºå‘ã€‚ ä¸ºä»€ä¹ˆä¸ç”¨å…¶ä»–éšæœºæ•°ï¼Ÿ å‡åŒ€åˆ†å¸ƒéšæœºæ•°ï¼ˆæ¯”å¦‚0åˆ°1ä¹‹é—´å‡åŒ€åˆ†å¸ƒï¼‰ï¼šå¯èƒ½è®©æƒé‡å˜åŒ–å¤ªå¤§ï¼Œç½‘ç»œä¸€å¼€å§‹å°±â€œå¤±æ§â€ï¼Œå­¦ä¹ å›°éš¾ã€‚ å›ºå®šå€¼ï¼ˆæ¯”å¦‚å…¨è®¾ä¸º0æˆ–1ï¼‰ï¼šæ‰€æœ‰ç¥ç»å…ƒå­¦åˆ°ç›¸åŒçš„ä¸œè¥¿ï¼Œç½‘ç»œæ— æ³•å­¦å¤æ‚æ¨¡å¼ã€‚ æ­£æ€åˆ†å¸ƒéšæœºæ•°çš„å¥½å¤„æ˜¯ï¼š å¤§å¤šå€¼æ¥è¿‘0ï¼ˆé¿å…å¤ªå¤§æˆ–å¤ªå°ï¼‰ã€‚ éšæœºä½†æœ‰è§„å¾‹ï¼ˆç¬¦åˆè‡ªç„¶ç•Œçš„æ­£æ€åˆ†å¸ƒç‰¹æ€§ï¼‰ã€‚ æ­£æ€åˆ†å¸ƒéšæœºæ•°çš„ç”Ÿæˆåœ¨å®é™…ç¼–ç¨‹ä¸­ï¼ˆæ¯”å¦‚ç”¨Pythonï¼‰ï¼Œå¯ä»¥ç”¨å·¥å…·ç”Ÿæˆæ­£æ€åˆ†å¸ƒéšæœºæ•°ï¼š å¹³å‡å€¼ï¼ˆMeanï¼‰ï¼šé€šå¸¸è®¾ä¸º0ï¼Œè®©æƒé‡ä¸åå‘æ­£æˆ–è´Ÿã€‚ æ ‡å‡†å·®ï¼ˆStandard Deviationï¼‰ï¼šæ§åˆ¶éšæœºæ•°çš„èŒƒå›´ï¼Œæ¯”å¦‚0.01ï¼ˆå°èŒƒå›´ï¼‰æˆ–0.1ï¼ˆç¨å¤§èŒƒå›´ï¼‰ã€‚ æ¯”å¦‚åœ¨Pythonä¸­ï¼Œnumpy.random.normal(mean0, std0.01) å¯ä»¥ç”Ÿæˆç¬¦åˆæ­£æ€åˆ†å¸ƒçš„éšæœºæ•°ã€‚ ä¾‹å­ï¼š ç”Ÿæˆ10ä¸ªæ­£æ€åˆ†å¸ƒéšæœºæ•°ï¼ˆå¹³å‡å€¼0ï¼Œæ ‡å‡†å·®0.01ï¼‰ï¼š å¯èƒ½å¾—åˆ°ï¼š[0.012, -0.008, 0.005, -0.015, 0.002, â€¦] å¤§å¤šæ•°æ•°å­—å¾ˆå°ï¼Œæ¥è¿‘0ï¼Œç¬¦åˆæ­£æ€åˆ†å¸ƒçš„â€œé’Ÿå½¢â€è§„å¾‹ã€‚ è¿™äº›æ•°å­—è¢«ç”¨æ¥åˆå§‹åŒ–ç¥ç»ç½‘ç»œçš„æƒé‡ã€‚ ä¸ºä»€ä¹ˆæ­£æ€åˆ†å¸ƒé‡è¦ï¼Ÿ è‡ªç„¶ç•Œçš„è§„å¾‹ï¼šå¾ˆå¤šæ•°æ®ï¼ˆèº«é«˜ã€æˆç»©ã€æ¸©åº¦ï¼‰éƒ½æ¥è¿‘æ­£æ€åˆ†å¸ƒï¼Œæœºå™¨å­¦ä¹ æ¨¡å‹ç”¨å®ƒæ¥æ¨¡æ‹Ÿç°å®ã€‚ ç®€åŒ–è®¡ç®—ï¼šæ­£æ€åˆ†å¸ƒçš„æ•°å­¦æ€§è´¨ç®€å•ï¼Œé€‚åˆç”¨åœ¨å¹³æ–¹å·®å’Œåå‘ä¼ æ’­ä¸­ã€‚ æ¦‚ç‡è§£é‡Šï¼šæ­£æ€åˆ†å¸ƒå¯ä»¥å‘Šè¯‰æˆ‘ä»¬æŸä¸ªå€¼å‡ºç°çš„å¯èƒ½æ€§ï¼ˆæ¯”å¦‚æŸäººèº«é«˜1.9ç±³çš„æ¦‚ç‡å¾ˆä½ï¼‰ã€‚ å±€é™æ€§ ä¸ä¸€å®šé€‚ç”¨ï¼šæœ‰äº›æ•°æ®ä¸éµå¾ªæ­£æ€åˆ†å¸ƒï¼ˆæ¯”å¦‚æ”¶å…¥åˆ†å¸ƒï¼Œå¯èƒ½åå‘ä¸€è¾¹ï¼‰ã€‚è¿™æ—¶å€™ç”¨å¹³æ–¹å·®å¯èƒ½ä¸åˆé€‚ã€‚ å¼‚å¸¸å€¼é—®é¢˜ï¼šæ­£æ€åˆ†å¸ƒå‡è®¾æå¤§æ•°æ®å¾ˆå°‘ï¼Œä½†ç°å®ä¸­å¯èƒ½æœ‰å¼‚å¸¸å€¼ï¼ˆæ¯”å¦‚æœ‰äººèº«é«˜2.5ç±³ï¼‰ï¼Œä¼šå½±å“æ¨¡å‹ã€‚ æ€»ç»“æ­£æ€åˆ†å¸ƒå°±åƒä¸€å¼ â€œé’Ÿå½¢å›¾â€ï¼Œæè¿°äº†å¾ˆå¤šç”Ÿæ´»ä¸­æ•°æ®çš„è§„å¾‹ï¼šå¤§éƒ¨åˆ†å€¼æ¥è¿‘å¹³å‡å€¼ï¼Œæç«¯çš„å°‘ã€‚å®ƒå’Œå¹³æ–¹å·®ã€è¯¯å·®åå‘ä¼ æ’­çš„å…³ç³»æ˜¯ï¼š å¹³æ–¹å·®ï¼šç”¨æ­£æ€åˆ†å¸ƒçš„ç‰¹æ€§æ¥è¡¡é‡é¢„æµ‹è¯¯å·®ã€‚ åå‘ä¼ æ’­ï¼šç”¨å¹³æ–¹å·®çš„è¯¯å·®è°ƒæ•´æœºå™¨çš„â€œæ—‹é’®â€ï¼Œè®©é¢„æµ‹æ›´å‡†ã€‚ å°±åƒä½ åœ¨çŒœæœ‹å‹çš„èº«é«˜ï¼Œå¤§å¤šæ•°äººèº«é«˜æ¥è¿‘1.65ç±³ï¼ˆæ­£æ€åˆ†å¸ƒï¼‰ï¼Œä½ çŒœé”™äº†ï¼ˆè¯¯å·®ï¼‰ï¼Œå°±ç”¨å¹³æ–¹å·®ç®—å·®è·ï¼Œå†é€šè¿‡åå‘ä¼ æ’­è°ƒæ•´çŒœæµ‹æ–¹æ³•ï¼Œè¶Šæ¥è¶Šå‡†ï¼"},{"title":"GoåŸºç¡€","path":"/wiki/Go/GoåŸºç¡€å­¦ä¹ .html","content":"å®‰è£…https://go.dev/dl/ ä¸‹è½½å®‰è£…ç‰ˆçš„ï¼Œç›´æ¥å®‰è£… å®‰è£…å®Œæˆåå¯ä»¥è¾“å…¥ go version æŸ¥çœ‹å®‰è£…ç‰ˆæœ¬ï¼Œè¾“å‡ºå¯¹åº”ç‰ˆæœ¬è¡¨ç¤ºå®‰è£…æˆåŠŸã€‚ è®¾ç½®ä»£ç† export GOPROXY=https://goproxy.cn Go Moduleæ¦‚å¿µGo module æ˜¯ Go ç¼–ç¨‹è¯­è¨€ä¸­çš„ä¸€ç§ä¾èµ–ç®¡ç†æœºåˆ¶ï¼Œå¼•å…¥äº Go 1.11ï¼Œå¹¶åœ¨ Go 1.13 ä¹‹åæˆä¸ºé»˜è®¤çš„ä¾èµ–ç®¡ç†æ–¹å¼ã€‚Go module æ—¨åœ¨è§£å†³ç®¡ç†é¡¹ç›®ä¾èµ–ç‰ˆæœ¬ã€æ¨¡å—åŒ–å¼€å‘ä»¥åŠæ„å»ºæ›´å¤§è§„æ¨¡ Go é¡¹ç›®æ—¶çš„ç—›ç‚¹ã€‚ é‡‡ç”¨ Go Modulesï¼Œä¸‹è½½ä¸‹æ¥çš„ç¬¬ä¸‰æ–¹ä¾èµ–å°±ä½äº GOPATH/pkg/mod ç›®å½•ä¸‹ã€‚ å¸¸ç”¨å‘½ä»¤åˆå§‹åŒ–: go mod init [module åç§°] æ£€æµ‹å’Œæ¸…ç†ä¾èµ–: go mod tidy å®‰è£…æŒ‡å®šåŒ…: go get -v github.com/go-ego/gse@v0.60.0-rc4.2 æ›´æ–°ä¾èµ– go get -u æ›´æ–°æŒ‡å®šåŒ…ä¾èµ–: go get -u github.com/go-ego/gse æŒ‡å®šç‰ˆæœ¬: go get -u github/com/go-ego/gse@v0.60.0-rc4.2 Replace: go mod edit -replace github.com/go-ego/gse=/path/to/local/gsego mod edit -replace github.com/go-ego/gse=github.com/vcaesar/gse ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹æ¨¡å—æ–‡ä»¶: replace github.com/go-ego/gse = github.com/vcaesar/gse go mod init # åˆå§‹åŒ– go.modgo mod tidy # æ›´æ–°ä¾èµ–æ–‡ä»¶go mod download # ä¸‹è½½ä¾èµ–æ–‡ä»¶go mod vendor # å°†ä¾èµ–è½¬ç§»è‡³æœ¬åœ°çš„ vendor æ–‡ä»¶go mod edit # æ‰‹åŠ¨ä¿®æ”¹ä¾èµ–æ–‡ä»¶go mod graph # æ‰“å°ä¾èµ–å›¾go mod verify # æ ¡éªŒä¾èµ– åŸºç¡€è¯­æ³•åŒ…æ¯ä¸ª Go ç¨‹åºéƒ½ç”±åŒ…æ„æˆã€‚ç¨‹åºä» main åŒ…å¼€å§‹è¿è¡Œã€‚æœ¬ç¨‹åºé€šè¿‡å¯¼å…¥è·¯å¾„ fmt å’Œ math/rand æ¥ä½¿ç”¨è¿™ä¸¤ä¸ªåŒ…ã€‚æŒ‰ç…§çº¦å®šï¼ŒåŒ…åä¸å¯¼å…¥è·¯å¾„çš„æœ€åä¸€ä¸ªå…ƒç´ ä¸€è‡´ã€‚ä¾‹å¦‚ï¼Œmath/rand åŒ…ä¸­çš„æºç å‡ä»¥ package rand è¯­å¥å¼€å§‹ã€‚ package mainimport ( fmt math/rand)func main() fmt.Println(Hello World!) åŒ…è¿˜å¯ä»¥è®©æˆ‘ä»¬é€šè¿‡æ§åˆ¶å“ªäº›åå­—æ˜¯å¤–éƒ¨å¯è§çš„æ¥éšè—å†…éƒ¨å®ç°ä¿¡æ¯ã€‚åœ¨ Go è¯­è¨€ä¸­ï¼Œä¸€ä¸ªç®€å•çš„è§„åˆ™æ˜¯ï¼šå¦‚æœä¸€ä¸ªåå­—æ˜¯å¤§å†™å­—æ¯å¼€å¤´çš„ï¼Œé‚£ä¹ˆè¯¥åå­—æ˜¯å¯¼å‡ºçš„ã€‚ å¯¼å…¥ä»£ç ç”¨åœ†æ‹¬å·å°†å¯¼å…¥çš„åŒ…åˆ†æˆä¸€ç»„ï¼Œè¿™æ˜¯â€œåˆ†ç»„â€å½¢å¼çš„å¯¼å…¥è¯­å¥ã€‚ å½“ç„¶ä¹Ÿå¯ä»¥ç¼–å†™å¤šä¸ªå¯¼å…¥è¯­å¥ï¼Œä¾‹å¦‚ï¼š import fmtimport math ä¸è¿‡ä½¿ç”¨åˆ†ç»„å¯¼å…¥è¯­å¥è¦æ›´å¥½ã€‚ import ( fmt math) æ³¨æ„ï¼šå¯¼å…¥åŒ…æœªä½¿ç”¨æ—¶ä¼šç¼–è¯‘ä¸é€šè¿‡ package mainimport ( fmt math)func main() fmt.Println(1) å¯¼å‡ºååœ¨ Go ä¸­ï¼Œå¦‚æœä¸€ä¸ªåå­—ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯å·²å¯¼å‡ºçš„ã€‚ä¾‹å¦‚ï¼Œmath åŒ…ä¸­ Piã€‚ pi å¹¶æœªä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œæ‰€ä»¥æ˜¯æœªå¯¼å‡ºçš„ã€‚ åœ¨å¯¼å…¥ä¸€ä¸ªåŒ…æ—¶ï¼Œåªèƒ½å¼•ç”¨å…¶ä¸­å·²å¯¼å‡ºçš„åå­—ã€‚ ä»»ä½•ã€Œæœªå¯¼å‡ºã€çš„åå­—åœ¨è¯¥åŒ…å¤–å‡æ— æ³•è®¿é—®ã€‚ package mainimport ( fmt math)func main() fmt.Println(math.Pi) å‡½æ•°å‡½æ•°å¯æ¥å—é›¶ä¸ªæˆ–å¤šä¸ªå‚æ•°ã€‚ åœ¨æœ¬ä¾‹ä¸­ï¼Œadd æ¥å—ä¸¤ä¸ª int ç±»å‹çš„å‚æ•°ã€‚ æ³¨æ„ç±»å‹åœ¨å˜é‡åçš„ åé¢ã€‚ï¼ˆå‚è€ƒè¿™ç¯‡å…³äº Go å£°æ˜è¯­æ³• çš„æ–‡ç« ï¼Œäº†è§£ä¸ºä½•ä½¿ç”¨è¿™ç§ç±»å‹å£°æ˜çš„å½¢å¼ã€‚ï¼‰ package mainimport fmtfunc add(x int, y int) int return x + yfunc main() fmt.Println(add(1, 2)) å½“ä¸¤ä¸ªæˆ–å¤šä¸ªå‚æ•°ç±»å‹é‡å¤æ—¶å¯ä»¥åœ¨æœ€åç”³æ˜ç±»å‹ func add(x, y int) int return x + y å‡½æ•°å¯ä»¥è¿”å›ä»»æ„æ•°é‡çš„è¿”å›å€¼ã€‚ package mainimport fmtfunc swap(x, y string) (string, string) return y, xfunc main() a, b := swap(hello, world)\tfmt.Println(a, b) å‡½æ•°ä¸­çš„è¿”å›å€¼å¯ä»¥è¢«å‘½åï¼Œå¯ä»¥è¢«è§†ä¸ºå®šä¹‰åœ¨å‡½æ•°é¡¶éƒ¨çš„å˜é‡ã€‚ è¿™äº›å˜é‡åç§°åº”è¯¥æ ‡è¯†è¿”å›å€¼çš„å«ä¹‰ã€‚ ä¸å¸¦å‚æ•°çš„ return è¯­å¥è¿”å›æŒ‡å®šçš„è¿”å›å€¼ã€‚è¿™å°±æ˜¯æ‰€è°“çš„â€œè£¸â€è¿”å›ã€‚ è£¸è¿”å›åªå»ºè®®åœ¨è¾ƒçŸ­çš„å‡½æ•°ä¸­ä½¿ç”¨ã€‚ package mainimport fmtfunc split(sum int) (x, y int) x = sum * 4 / 9\ty = sum - x\treturnfunc main() fmt.Println(split(17)) 3.5 varvar è¯­å¥å£°æ˜ä¸€ä¸ªå˜é‡åˆ—è¡¨; ä¸å‡½æ•°å‚æ•°åˆ—è¡¨ä¸€æ ·ï¼Œç±»å‹æ”¾åé¢ã€‚ package mainimport fmtvar c, python, java boolfunc main() var i int\tfmt.Println(i, c, python, java) var å¯ä»¥æ”¾åœ¨åŒ…çº§åˆ«æˆ–è€…å‡½æ•°çº§åˆ«ã€‚ var ç±»å‹å®šä¹‰å˜é‡å¯ä»¥è®¾å®šåˆå§‹å€¼ï¼Œå¦‚æœè®¾å®šäº†åˆå§‹å€¼å¯ä»¥çœç•¥å˜é‡ç±»å‹ã€‚å˜é‡å°†é‡‡ç”¨åˆå§‹å€¼è®¾å®šçš„ç±»å‹ã€‚ package mainimport fmtvar i, j int = 1, 2func main() var c, python, java = true, false, no\tfmt.Println(i, j, c, python, java) åœ¨å‡½æ•°å†…éƒ¨ï¼Œå¯ä»¥ä½¿ç”¨ : = short èµ‹å€¼è¯­å¥ä»£æ›¿éšå¼ç±»å‹çš„ var å£°æ˜ã€‚ åœ¨å‡½æ•°ä¹‹å¤–ï¼Œæ¯ä¸ªè¯­å¥éƒ½ä»¥å…³é”®å­—(varã€ func ç­‰)å¼€å¤´ï¼Œå› æ­¤: ç»“æ„ä¸å¯ç”¨ã€‚ package mainimport fmtfunc main() var i, j int = 1, 2\tk := 3\tc, python, java := true, false, no!\tfmt.Println(i, j, k, c, python, java) 3.6 åŸºæœ¬å˜é‡Go è¯­è¨€æŒ‰ç±»åˆ«æœ‰ä»¥ä¸‹å‡ ç§æ•°æ®ç±»å‹ï¼š åºå· ç±»å‹å’Œæè¿° 1 å¸ƒå°”å‹ å¸ƒå°”å‹çš„å€¼åªå¯ä»¥æ˜¯å¸¸é‡ true æˆ–è€… falseã€‚ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼švar b bool trueã€‚ 2 æ•°å­—ç±»å‹ æ•´å‹ int å’Œæµ®ç‚¹å‹ float32ã€float64ï¼ŒGo è¯­è¨€æ”¯æŒæ•´å‹å’Œæµ®ç‚¹å‹æ•°å­—ï¼Œå¹¶ä¸”æ”¯æŒå¤æ•°ï¼Œå…¶ä¸­ä½çš„è¿ç®—é‡‡ç”¨è¡¥ç ã€‚ 3 å­—ç¬¦ä¸²ç±»å‹: å­—ç¬¦ä¸²å°±æ˜¯ä¸€ä¸²å›ºå®šé•¿åº¦çš„å­—ç¬¦è¿æ¥èµ·æ¥çš„å­—ç¬¦åºåˆ—ã€‚Go çš„å­—ç¬¦ä¸²æ˜¯ç”±å•ä¸ªå­—èŠ‚è¿æ¥èµ·æ¥çš„ã€‚Go è¯­è¨€çš„å­—ç¬¦ä¸²çš„å­—èŠ‚ä½¿ç”¨ UTF-8 ç¼–ç æ ‡è¯† Unicode æ–‡æœ¬ã€‚ 4 æ´¾ç”Ÿç±»å‹: åŒ…æ‹¬ï¼š(a) æŒ‡é’ˆç±»å‹ï¼ˆPointerï¼‰(b) æ•°ç»„ç±»å‹(c) ç»“æ„åŒ–ç±»å‹(struct)(d) Channel ç±»å‹(e) å‡½æ•°ç±»å‹(f) åˆ‡ç‰‡ç±»å‹(g) æ¥å£ç±»å‹ï¼ˆinterfaceï¼‰(h) Map ç±»å‹ å­—ç¬¦ä¸²ç±»å‹æœ‰ä¸¤ç§å†™æ³•ï¼š ä½¿ç”¨åŒå¼•å· â€œã€‚å¦‚æœåœ¨å­—ç¬¦ä¸²é‡Œ â€ å°±éœ€è¦ä½¿ç”¨ \\ è½¬ä¹‰ println(hello \\ world) ä½¿ç”¨åå¼•å·ã€‚è¿™ç§å†™æ³•å¯ä»¥æ¢è¡Œï¼Œä½†æ˜¯å†…éƒ¨ä¸ç”¨æœ‰åå¼•å·æˆ–è½¬ä¹‰ã€‚ println(`hello world`) å­—ç¬¦ä¸²æ“ä½œï¼šstrings åŒ…å«å­—ç¬¦ä¸²å¸¸ç”¨æ“ä½œæ–¹æ³• æ•°å­—ç±»å‹Go ä¹Ÿæœ‰åŸºäºæ¶æ„çš„ç±»å‹ï¼Œä¾‹å¦‚ï¼šintã€uint å’Œ uintptrã€‚ åºå· ç±»å‹å’Œæè¿° 1 uint8 æ— ç¬¦å· 8 ä½æ•´å‹ (0 åˆ° 255) 2 uint16 æ— ç¬¦å· 16 ä½æ•´å‹ (0 åˆ° 65535) 3 uint32 æ— ç¬¦å· 32 ä½æ•´å‹ (0 åˆ° 4294967295) 4 uint64 æ— ç¬¦å· 64 ä½æ•´å‹ (0 åˆ° 18446744073709551615) 5 int8 æœ‰ç¬¦å· 8 ä½æ•´å‹ (-128 åˆ° 127) 6 int16 æœ‰ç¬¦å· 16 ä½æ•´å‹ (-32768 åˆ° 32767) 7 int32 æœ‰ç¬¦å· 32 ä½æ•´å‹ (-2147483648 åˆ° 2147483647) 8 int64 æœ‰ç¬¦å· 64 ä½æ•´å‹ (-9223372036854775808 åˆ° 9223372036854775807) æå€¼åœ¨ math åŒ…ä¸­ æµ®ç‚¹å‹ åºå· ç±»å‹å’Œæè¿° 1 float32 IEEE-754 32 ä½æµ®ç‚¹å‹æ•° 2 float64 IEEE-754 64 ä½æµ®ç‚¹å‹æ•° 3 complex64 32 ä½å®æ•°å’Œè™šæ•° 4 complex128 64 ä½å®æ•°å’Œè™šæ•° å…¶ä»–æ•°å­—ç±»å‹ä»¥ä¸‹åˆ—å‡ºäº†å…¶ä»–æ›´å¤šçš„æ•°å­—ç±»å‹ï¼š åºå· ç±»å‹å’Œæè¿° 1 byte æœ¬è´¨ uint8 2 rune ç±»ä¼¼ int32 3 uint 32 æˆ– 64 ä½ 4 int ä¸ uint ä¸€æ ·å¤§å° 5 uintptr æ— ç¬¦å·æ•´å‹ï¼Œç”¨äºå­˜æ”¾ä¸€ä¸ªæŒ‡é’ˆ é›¶å€¼æ²¡æœ‰æ˜¾å¼åˆå§‹å€¼çš„å˜é‡å£°æ˜ç»™å‡ºäº†å®ƒä»¬çš„é›¶å€¼ã€‚ é›¶å€¼æ˜¯: 0 è¡¨ç¤ºæ•°å­—ç±»å‹, å¸ƒå°”ç±»å‹ä¸º falseï¼Œå¹¶ä¸” â€œâ€(ç©ºå­—ç¬¦ä¸²)è¡¨ç¤ºå­—ç¬¦ä¸²ã€‚ package mainimport fmtfunc main() var i int\tvar f float64\tvar b bool\tvar s string // 0 0 false fmt.Printf(%v %v %v %q , i, f, b, s) 3.7 ç±»å‹è½¬æ¢è¡¨è¾¾å¼ T(v) å°†å€¼ v è½¬æ¢ä¸ºç±»å‹ Tã€‚ ä¸€äº›æ•°å€¼ç±»å‹çš„è½¬æ¢ï¼š var i int = 42var f float64 = float64(i)var u uint = uint(f) æˆ–è€…ï¼Œæ›´åŠ ç®€çŸ­çš„å½¢å¼ï¼š i := 42f := float64(i)u := uint(f) ä¸ C ä¸åŒçš„æ˜¯ï¼ŒGo åœ¨ä¸åŒç±»å‹çš„é¡¹ä¹‹é—´èµ‹å€¼æ—¶éœ€è¦æ˜¾å¼è½¬æ¢ï¼ŒGo ä¸­æ²¡æœ‰éšå¼è½¬æ¢ã€‚ i := 42var f float64f = icannot use i (variable of type int) as float64 value in assignment 3.8 ç±»å‹æ¨æ–­ï¼ˆçŸ­å˜é‡ï¼‰åœ¨å£°æ˜ä¸€ä¸ªå˜é‡è€Œä¸æŒ‡å®šå…¶ç±»å‹æ—¶ï¼ˆå³ä½¿ç”¨ä¸å¸¦ç±»å‹çš„ := è¯­æ³• æˆ– var = è¡¨è¾¾å¼è¯­æ³•ï¼‰ï¼Œå˜é‡çš„ç±»å‹ä¼šé€šè¿‡å³å€¼æ¨æ–­å‡ºæ¥ã€‚ å½“å£°æ˜çš„å³å€¼ç¡®å®šäº†ç±»å‹æ—¶ï¼Œæ–°å˜é‡çš„ç±»å‹ä¸å…¶ç›¸åŒï¼š var i intj := i // j ä¹Ÿæ˜¯ä¸€ä¸ª int ä¸è¿‡å½“å³è¾¹åŒ…å«æœªæŒ‡æ˜ç±»å‹çš„æ•°å€¼å¸¸é‡æ—¶ï¼Œæ–°å˜é‡çš„ç±»å‹å°±å¯èƒ½æ˜¯ intã€float64 æˆ– complex128 äº†ï¼Œè¿™å–å†³äºå¸¸é‡çš„ç²¾åº¦ï¼š i := 42 // intf := 3.142 // float64g := 0.867 + 0.5i // complex128 package mainimport fmtfunc main() v := 42 // v is of type int\tfmt.Printf(v is of type %T , v) åŒ…çº§åˆ«çš„å˜é‡ä¼šåœ¨ main æ–¹æ³•æ‰§è¡Œå‰åˆå§‹åŒ–ï¼Œå±€éƒ¨å˜é‡åœ¨å‡½æ•°è¢«è°ƒç”¨æ—¶æ‰åˆå§‹åŒ–ã€‚ çŸ­å˜é‡ä¸­æœ‰ç›¸åŒå˜é‡åçš„å‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯èµ‹å€¼ in, err := os.Open(infile)// æ­¤æ—¶errä¸ºèµ‹å€¼out, err := os.Create(outfile) ä½†æ˜¯ç¬¬äºŒæ¬¡ä½¿ç”¨çŸ­å˜é‡èµ‹å€¼æ—¶æœ€å°‘éœ€è¦ä¸€ä¸ªæ–°çš„å˜é‡åï¼Œå¦‚æœè¿˜æ˜¯ç›¸åŒé‚£ä¹ˆç¼–è¯‘æŠ¥é”™ f, err := os.Open(infile)// ...f, err := os.Create(outfile) // compile error: no new variables 3.9 å¸¸é‡å¸¸é‡çš„å£°æ˜ä¸å˜é‡ç±»ä¼¼ï¼Œåªä¸è¿‡ä½¿ç”¨ const å…³é”®å­—ã€‚ å¸¸é‡å¯ä»¥æ˜¯å­—ç¬¦ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼æˆ–æ•°å€¼ã€‚ å¸¸é‡ä¸èƒ½ç”¨ := è¯­æ³•å£°æ˜ã€‚ package mainimport fmtconst Pi = 3.14func main() const World = ä¸–ç•Œ\tfmt.Println(Hello, World)\tfmt.Println(Happy, Pi, Day)\tconst Truth = true\tfmt.Println(Go rules?, Truth) iota å¸¸é‡ç”Ÿæˆå™¨ å¸¸é‡å£°æ˜å¯ä»¥ä½¿ç”¨ iota å¸¸é‡ç”Ÿæˆå™¨åˆå§‹åŒ–ï¼Œå®ƒç”¨äºç”Ÿæˆä¸€ç»„ä»¥ç›¸ä¼¼è§„åˆ™åˆå§‹åŒ–çš„å¸¸é‡ï¼Œä½†æ˜¯ä¸ç”¨æ¯è¡Œéƒ½å†™ä¸€éåˆå§‹åŒ–è¡¨è¾¾å¼ã€‚åœ¨ä¸€ä¸ª const å£°æ˜è¯­å¥ä¸­ï¼Œåœ¨ç¬¬ä¸€ä¸ªå£°æ˜çš„å¸¸é‡æ‰€åœ¨çš„è¡Œï¼Œiota å°†ä¼šè¢«ç½®ä¸º 0ï¼Œç„¶ååœ¨æ¯ä¸€ä¸ªæœ‰å¸¸é‡å£°æ˜çš„è¡ŒåŠ ä¸€ã€‚ å®šä¹‰äº†ä¸€ä¸ª Weekday å‘½åç±»å‹ï¼Œç„¶åä¸ºä¸€å‘¨çš„æ¯å¤©å®šä¹‰äº†ä¸€ä¸ªå¸¸é‡ï¼Œä»å‘¨æ—¥ 0 å¼€å§‹ã€‚ type Weekday intconst ( Sunday Weekday = iota //0 Monday //1 Tuesday //2 Wednesday //3 Thursday //4 Friday //5 Saturday //6) 3.10 new å‡½æ•°new(T)å¯ä»¥åˆ›å»ºä¸€ä¸ª T ç±»å‹çš„åŒ¿åå˜é‡ï¼Œåˆå§‹åŒ–ä¸º T ç±»å‹çš„é›¶å€¼ï¼Œç„¶åè¿”å›å˜é‡åœ°å€ï¼Œè¿”å›çš„æŒ‡é’ˆç±»å‹ä¸º*Tã€‚ p := new(int) // p, *int ç±»å‹, æŒ‡å‘åŒ¿åçš„ int å˜é‡fmt.Println(*p) // 0*p = 2 // è®¾ç½® int åŒ¿åå˜é‡çš„å€¼ä¸º 2fmt.Println(*p) ä½¿ç”¨ new åˆ›å»ºçš„å˜é‡å’Œæ™®é€šå˜é‡å£°æ˜è¯­å¥æ–¹å¼åˆ›å»ºå˜é‡æ— åŒºåˆ«ã€‚ 3.11 å…ƒç»„èµ‹å€¼å…ƒç»„èµ‹å€¼æ˜¯å¦ä¸€ç§å½¢å¼çš„èµ‹å€¼è¯­å¥ï¼Œå®ƒå…è®¸åŒæ—¶æ›´æ–°å¤šä¸ªå˜é‡çš„å€¼ã€‚åœ¨èµ‹å€¼ä¹‹å‰ï¼Œèµ‹å€¼è¯­å¥å³è¾¹çš„æ‰€æœ‰è¡¨è¾¾å¼å°†ä¼šå…ˆè¿›è¡Œæ±‚å€¼ï¼Œç„¶åå†ç»Ÿä¸€æ›´æ–°å·¦è¾¹å¯¹åº”å˜é‡çš„å€¼ã€‚ x, y = y, xa[i], a[j] = a[j], a[i] å’Œå˜é‡å£°æ˜ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹åˆ’çº¿ç©ºç™½æ ‡è¯†ç¬¦_æ¥ä¸¢å¼ƒä¸éœ€è¦çš„å€¼ã€‚ _, err = io.Copy(dst, src) // ä¸¢å¼ƒå­—èŠ‚æ•°_, ok = x.(T) // åªæ£€æµ‹ç±»å‹ï¼Œå¿½ç•¥å…·ä½“å€¼ 3.12 éšå¼èµ‹å€¼èµ‹å€¼è¯­å¥æ˜¯æ˜¾å¼çš„èµ‹å€¼å½¢å¼ï¼Œä½†æ˜¯ç¨‹åºä¸­è¿˜æœ‰å¾ˆå¤šåœ°æ–¹ä¼šå‘ç”Ÿéšå¼çš„èµ‹å€¼è¡Œä¸ºï¼šå‡½æ•°è°ƒç”¨ä¼šéšå¼åœ°å°†è°ƒç”¨å‚æ•°çš„å€¼ èµ‹å€¼ç»™å‡½æ•°çš„å‚æ•°å˜é‡ï¼Œä¸€ä¸ªè¿”å›è¯­å¥ä¼šéšå¼åœ°å°†è¿”å›æ“ä½œçš„å€¼èµ‹å€¼ç»™ç»“æœå˜é‡ï¼Œä¸€ä¸ªå¤åˆç±»å‹çš„å­—é¢é‡ä¹Ÿä¼šäº§ç”Ÿ èµ‹å€¼è¡Œä¸ºã€‚ medals := []stringgold, silver, bronze éšå¼åœ°å¯¹ slice çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œèµ‹å€¼æ“ä½œï¼Œç±»ä¼¼è¿™æ ·å†™çš„è¡Œä¸ºï¼š medals[0] = goldmedals[1] = silvermedals[2] = bronze ä¸ç®¡æ˜¯éšå¼è¿˜æ˜¯æ˜¾å¼åœ°èµ‹å€¼ï¼Œåœ¨èµ‹å€¼è¯­å¥å·¦è¾¹çš„å˜é‡å’Œå³è¾¹æœ€ç»ˆçš„æ±‚åˆ°çš„å€¼å¿…é¡»æœ‰ç›¸åŒçš„æ•°æ®ç±»å‹ã€‚ æ›´ç›´ç™½åœ°è¯´ï¼Œåªæœ‰å³è¾¹çš„å€¼å¯¹äºå·¦è¾¹çš„å˜é‡æ˜¯å¯èµ‹å€¼çš„ï¼Œèµ‹å€¼è¯­å¥æ‰æ˜¯å…è®¸çš„ã€‚ 4. æµç¨‹æ§åˆ¶è¯­å¥4.1 for å¾ªç¯Go åªæœ‰ä¸€ç§å¾ªç¯ç»“æ„ï¼šfor å¾ªç¯ã€‚ åŸºæœ¬çš„ for å¾ªç¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå®ƒä»¬ç”¨åˆ†å·éš”å¼€ï¼š åˆå§‹åŒ–è¯­å¥ï¼šåœ¨ç¬¬ä¸€æ¬¡è¿­ä»£å‰æ‰§è¡Œ æ¡ä»¶è¡¨è¾¾å¼ï¼šåœ¨æ¯æ¬¡è¿­ä»£å‰æ±‚å€¼ åç½®è¯­å¥ï¼šåœ¨æ¯æ¬¡è¿­ä»£çš„ç»“å°¾æ‰§è¡Œ åˆå§‹åŒ–è¯­å¥é€šå¸¸ä¸ºä¸€å¥çŸ­å˜é‡å£°æ˜ï¼Œè¯¥å˜é‡å£°æ˜ä»…åœ¨ for è¯­å¥çš„ä½œç”¨åŸŸä¸­å¯è§ã€‚ ä¸€æ—¦æ¡ä»¶è¡¨è¾¾å¼æ±‚å€¼ä¸º falseï¼Œå¾ªç¯è¿­ä»£å°±ä¼šç»ˆæ­¢ã€‚ æ³¨æ„ï¼šå’Œ Cã€Javaã€JavaScript ä¹‹ç±»çš„è¯­è¨€ä¸åŒï¼ŒGo çš„ for è¯­å¥åé¢çš„ä¸‰ä¸ªæ„æˆéƒ¨åˆ†å¤–æ²¡æœ‰å°æ‹¬å·ï¼Œ å¤§æ‹¬å· åˆ™æ˜¯å¿…é¡»çš„ã€‚ package mainimport fmtfunc main() sum := 0\tfor i := 0; i 10; i++ sum += i fmt.Println(sum) sum2 := 1\tfor sum2 100 sum2 += sum2 fmt.Println(sum2) åˆå§‹åŒ–è¯­å¥å’Œåç½®è¯­å¥éƒ½æ˜¯å¯é€‰çš„ï¼Œå¦‚æœå»æ‰ ; for è¿˜å¯ä»¥åš while çš„è¯­ä¹‰ã€‚ package mainimport fmtfunc main() sum2 := 1\tfor sum2 100 sum2 += sum2 fmt.Println(sum2) æ— é™å¾ªç¯ package mainimport fmtfunc main() for è­¦å‘Šï¼šæ•è·è¿­ä»£å˜é‡ è€ƒè™‘è¿™ä¸ªæ ·ä¸€ä¸ªé—®é¢˜ï¼šé¦–å…ˆåˆ›å»ºä¸€äº›ç›®å½•ï¼Œå†å°†ç›®å½•åˆ é™¤ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­æˆ‘ä»¬ç”¨å‡½æ•°å€¼æ¥å®Œæˆåˆ é™¤æ“ä½œã€‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç éœ€è¦å¼•å…¥ os åŒ…ã€‚ä¸ºäº†ä½¿ä»£ç ç®€å•ï¼Œæˆ‘ä»¬å¿½ç•¥äº†æ‰€æœ‰çš„å¼‚å¸¸å¤„ç†ã€‚ var rmdirs []func()for _, d := range tempDirs() dir := d // NOTE: necessary!\tos.MkdirAll(dir, 0755) // creates parent directories too\trmdirs = append(rmdirs, func() os.RemoveAll(dir)\t)// ...do some workâ€¦for _, rmdir := range rmdirs rmdir() // clean up è¿™é‡Œä¸ºä»€ä¹ˆè¦åœ¨å¾ªç¯ä½“ä¸­ç”¨å¾ªç¯å˜é‡ d èµ‹å€¼ä¸€ä¸ªæ–°çš„å±€éƒ¨å˜é‡ï¼Œè€Œä¸æ˜¯åƒä¸‹é¢çš„ä»£ç ä¸€æ ·ç›´æ¥ä½¿ç”¨å¾ªç¯å˜é‡ dirã€‚éœ€è¦æ³¨æ„ï¼Œä¸‹é¢çš„ä»£ç æ˜¯é”™è¯¯çš„ã€‚ var rmdirs []func()for _, dir := range tempDirs() os.MkdirAll(dir, 0755)\trmdirs = append(rmdirs, func() os.RemoveAll(dir) // NOTE: incorrect!\t) é—®é¢˜çš„åŸå› åœ¨äºå¾ªç¯å˜é‡çš„ä½œç”¨åŸŸã€‚åœ¨ä¸Šé¢çš„ç¨‹åºä¸­ï¼Œfor å¾ªç¯è¯­å¥å¼•å…¥äº†æ–°çš„è¯æ³•å—ï¼Œå¾ªç¯å˜é‡ dir åœ¨è¿™ä¸ªè¯æ³•å—ä¸­è¢«å£°æ˜ã€‚åœ¨è¯¥å¾ªç¯ä¸­ç”Ÿæˆçš„æ‰€æœ‰å‡½æ•°å€¼éƒ½å…±äº«ç›¸åŒçš„å¾ªç¯å˜é‡ã€‚éœ€è¦æ³¨æ„ï¼Œå‡½æ•°å€¼ä¸­è®°å½•çš„æ˜¯å¾ªç¯å˜é‡çš„å†…å­˜åœ°å€ï¼Œè€Œä¸æ˜¯å¾ªç¯å˜é‡æŸä¸€æ—¶åˆ»çš„å€¼ã€‚ä»¥ dir ä¸ºä¾‹ï¼Œåç»­çš„è¿­ä»£ä¼šä¸æ–­æ›´æ–° dir çš„å€¼ï¼Œå½“åˆ é™¤æ“ä½œæ‰§è¡Œæ—¶ï¼Œfor å¾ªç¯å·²å®Œæˆï¼Œdir ä¸­å­˜å‚¨çš„å€¼ç­‰äºæœ€åä¸€æ¬¡è¿­ä»£çš„å€¼ã€‚è¿™æ„å‘³ç€ï¼Œæ¯æ¬¡å¯¹ os.RemoveAll çš„è°ƒç”¨åˆ é™¤çš„éƒ½æ˜¯ç›¸åŒçš„ç›®å½•ã€‚ é€šå¸¸ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¼šå¼•å…¥ä¸€ä¸ªä¸å¾ªç¯å˜é‡åŒåçš„å±€éƒ¨å˜é‡ï¼Œä½œä¸ºå¾ªç¯å˜é‡çš„å‰¯æœ¬ã€‚ 4.2 ifGo çš„ if è¯­å¥ä¸ for å¾ªç¯ç±»ä¼¼ï¼Œè¡¨è¾¾å¼å¤–æ— éœ€å°æ‹¬å· ( )ï¼Œè€Œå¤§æ‹¬å· åˆ™æ˜¯å¿…é¡»çš„ã€‚ package mainimport (\tfmt\tmath)func sqrt(x float64) string if x 0 return sqrt(-x) + i return fmt.Sprint(math.Sqrt(x))func main() fmt.Println(sqrt(2), sqrt(-4)) å’Œ for ä¸€æ ·ï¼Œif è¯­å¥å¯ä»¥åœ¨æ¡ä»¶è¡¨è¾¾å¼å‰æ‰§è¡Œä¸€ä¸ªç®€çŸ­è¯­å¥ã€‚ è¯¥è¯­å¥å£°æ˜çš„å˜é‡ä½œç”¨åŸŸä»…åœ¨ if ä¹‹å†…ã€‚ package mainimport (\tfmt\tmath)func pow(x, n, lim float64) float64 if v := math.Pow(x, n); v lim return v return limfunc main() fmt.Println( pow(3, 2, 10), pow(3, 3, 20),\t) åœ¨ if çš„ç®€çŸ­è¯­å¥ä¸­å£°æ˜çš„å˜é‡åŒæ ·å¯ä»¥åœ¨å¯¹åº”çš„ä»»ä½• else å—ä¸­ä½¿ç”¨ã€‚ package mainimport (\tfmt\tmath)func pow(x, n, lim float64) float64 if v := math.Pow(x, n); v lim return v else fmt.Printf(%g = %g , v, lim) // cant use v here, though\treturn limfunc main() fmt.Println( pow(3, 2, 10), pow(3, 3, 20),\t) 4.3 switch åˆ†æ”¯switch è¯­å¥æ˜¯ç¼–å†™ä¸€è¿ä¸² if - else è¯­å¥çš„ç®€ä¾¿æ–¹æ³•ã€‚å®ƒè¿è¡Œç¬¬ä¸€ä¸ª case å€¼ å€¼ç­‰äºæ¡ä»¶è¡¨è¾¾å¼çš„å­å¥ã€‚ Go çš„ switch è¯­å¥ç±»ä¼¼äº Cã€C++ã€Javaã€JavaScript å’Œ PHP ä¸­çš„ï¼Œä¸è¿‡ Go åªä¼šè¿è¡Œé€‰å®šçš„ caseï¼Œè€Œéä¹‹åæ‰€æœ‰çš„ caseã€‚ åœ¨æ•ˆæœä¸Šï¼ŒGo çš„åšæ³•ç›¸å½“äºè¿™äº›è¯­è¨€ä¸­ä¸ºæ¯ä¸ª case åé¢è‡ªåŠ¨æ·»åŠ äº†æ‰€éœ€çš„ break è¯­å¥ã€‚åœ¨ Go ä¸­ï¼Œé™¤éä»¥ fallthrough è¯­å¥ç»“æŸï¼Œå¦åˆ™åˆ†æ”¯ä¼šè‡ªåŠ¨ç»ˆæ­¢ã€‚ Go çš„å¦ä¸€ç‚¹é‡è¦çš„ä¸åŒåœ¨äº switch çš„ case æ— éœ€ä¸ºå¸¸é‡ï¼Œä¸”å–å€¼ä¸é™äºæ•´æ•°ã€‚ package mainimport (\tfmt\truntime)func main() fmt.Print(Go è¿è¡Œçš„ç³»ç»Ÿç¯å¢ƒ)\tswitch os := runtime.GOOS; os case darwin: fmt.Println(mac.Os)\tcase linux: fmt.Println(Linux)\tdefault: fmt.Printf(%s , os) switch çš„ case è¯­å¥ä»ä¸Šåˆ°ä¸‹é¡ºæ¬¡æ‰§è¡Œï¼Œç›´åˆ°åŒ¹é…æˆåŠŸæ—¶åœæ­¢ã€‚ ä¾‹å¦‚ï¼Œ switch i case 0:case f(): åœ¨ i==0 æ—¶ï¼Œf ä¸ä¼šè¢«è°ƒç”¨ã€‚ æ— æ¡ä»¶çš„ switch åŒ switch true ä¸€æ ·ã€‚ è¿™ç§å½¢å¼èƒ½å°†ä¸€é•¿ä¸² if-then-else å†™å¾—æ›´åŠ æ¸…æ™°ã€‚ package mainimport (\tfmt\ttime)func main() t := time.Now()\tswitch case t.Hour() 12: fmt.Println(æ—©ä¸Šå¥½ï¼)\tcase t.Hour() 17: fmt.Println(ä¸‹åˆå¥½ï¼)\tdefault: fmt.Println(æ™šä¸Šå¥½ï¼) 4.4 defer æ¨è¿Ÿdefer è¯­å¥ä¼šå°†å‡½æ•°æ¨è¿Ÿåˆ°å¤–å±‚å‡½æ•°è¿”å›ä¹‹åæ‰§è¡Œã€‚ æ¨è¿Ÿè°ƒç”¨çš„å‡½æ•°å…¶å‚æ•° ä¼šç«‹å³æ±‚å€¼ï¼Œä½†ç›´åˆ°å¤–å±‚å‡½æ•°è¿”å›å‰è¯¥å‡½æ•°éƒ½ä¸ä¼šè¢«è°ƒç”¨ã€‚ package mainimport fmtfunc main() defer fmt.Println(world)\tfmt.Println(hello) 4.5 defer æ ˆæ¨è¿Ÿè°ƒç”¨çš„å‡½æ•°è°ƒç”¨ä¼šè¢«å‹å…¥ä¸€ä¸ªæ ˆä¸­ã€‚ å½“å¤–å±‚å‡½æ•°è¿”å›æ—¶ï¼Œè¢«æ¨è¿Ÿçš„è°ƒç”¨ä¼šæŒ‰ç…§åè¿›å…ˆå‡ºçš„é¡ºåºè°ƒç”¨ã€‚ package mainimport fmtfunc main() fmt.Println(counting)\tfor i := 0; i 10; i++ defer fmt.Println(i) fmt.Println(done)countingdone9876543210 5. ç»“æ„ä½“5.1 æŒ‡é’ˆGo æ‹¥æœ‰æŒ‡é’ˆã€‚æŒ‡é’ˆä¿å­˜äº†å€¼çš„å†…å­˜åœ°å€ã€‚ æŒ‡é’ˆé›¶å€¼ä¸º nilã€‚ // ç±»å‹ *T æ˜¯æŒ‡å‘ T ç±»å‹å€¼çš„æŒ‡é’ˆï¼Œå…¶é›¶å€¼ä¸º nilã€‚// å˜é‡pæ˜¯æŒ‡å‘intç±»å‹çš„æŒ‡é’ˆvar p *inti := 42// æ“ä½œç¬¦ä¼šç”Ÿæˆä¸€ä¸ªæŒ‡å‘å…¶æ“ä½œæ•°çš„æŒ‡é’ˆã€‚// i ç”Ÿæˆä¸€ä¸ªæŒ‡é’ˆå¹¶èµ‹å€¼ç»™pp = i// åªæœ‰æŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªå˜é‡æˆ–è€…éƒ½ä¸ºnilæ—¶ï¼ŒæŒ‡é’ˆæ‰ç›¸ç­‰var x, y intfmt.Println(x == x, x == y, x == nil) // true false false * æ“ä½œç¬¦è¡¨ç¤ºæŒ‡é’ˆæŒ‡å‘çš„åº•å±‚å€¼ã€‚ fmt.Println(*p) // é€šè¿‡æŒ‡é’ˆ p è¯»å– i*p = 21 // é€šè¿‡æŒ‡é’ˆ p è®¾ç½® i è¿™ä¹Ÿå°±æ˜¯é€šå¸¸æ‰€è¯´çš„ã€Œè§£å¼•ç”¨ã€æˆ–ã€Œé—´æ¥å¼•ç”¨ã€ã€‚ ä¸ C ä¸åŒï¼ŒGo æ²¡æœ‰æŒ‡é’ˆè¿ç®—ã€‚ package mainimport fmtfunc main() i, j := 42, 2701 // ç”ŸæˆæŒ‡å‘içš„æŒ‡é’ˆèµ‹å€¼ç»™p\tp := i\tfmt.Println(*p) //42\t*p = 21\tfmt.Println(i) //21\tp = j\t*p = *p / 37\tfmt.Println(j) //73 5.2 ç»“æ„ä½“ä¸€ä¸ª ç»“æ„ä½“ï¼ˆstructï¼‰å°±æ˜¯ä¸€ç»„ å­—æ®µï¼ˆfieldï¼‰ã€‚ package mainimport fmttype Vertex struct X int\tY inttype V float64func main() fmt.Println(Vertex1, 2) fmt.Println(V(1)) ç»“æ„ä½“ä¸­çš„å­—æ®µå¯é€šè¿‡ç‚¹å· . æ¥è®¿é—®ã€‚ package mainimport fmttype Vertex struct X int\tY intfunc main() v := Vertex1, 2\tv.X = 4\tfmt.Println(v.X) 5.3 ç»“æ„ä½“æŒ‡é’ˆç»“æ„ä½“å­—æ®µå¯é€šè¿‡ç»“æ„ä½“æŒ‡é’ˆæ¥è®¿é—®ã€‚ å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆ p é‚£ä¹ˆå¯ä»¥é€šè¿‡ (*p).X æ¥è®¿é—®å…¶å­—æ®µ Xã€‚ ä¸è¿‡è¿™ä¹ˆå†™å¤ªå•°å—¦äº†ï¼Œæ‰€ä»¥è¯­è¨€ä¹Ÿå…è®¸æˆ‘ä»¬ä½¿ç”¨éšå¼è§£å¼•ç”¨ï¼Œç›´æ¥å†™ p.X å°±å¯ä»¥ã€‚ package mainimport fmttype Vertex struct X int\tY intfunc main() v := Vertex1, 2\tp := v\tp.X = 1e9\tfmt.Println(v) 5.4 ç»“æ„ä½“å­—é¢é‡ä½¿ç”¨ Name: è¯­æ³•å¯ä»¥ä»…åˆ—å‡ºéƒ¨åˆ†å­—æ®µï¼ˆå­—æ®µåçš„é¡ºåºæ— å…³ï¼‰ã€‚ ç‰¹æ®Šçš„å‰ç¼€ è¿”å›ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆã€‚ package mainimport fmttype Vertex struct X, Y intvar (\tv1 = Vertex1, 2 // åˆ›å»ºä¸€ä¸ª Vertex ç±»å‹çš„ç»“æ„ä½“\tv2 = VertexX: 1 // Y:0 è¢«éšå¼åœ°èµ‹äºˆé›¶å€¼ // v = Vertex1 // è¿™ç§ä¼šæŠ¥é”™ v3 = Vertex // X:0 Y:0\tp = Vertex1, 2 // åˆ›å»ºä¸€ä¸ª *Vertex ç±»å‹çš„ç»“æ„ä½“ï¼ˆæŒ‡é’ˆï¼‰)func main() fmt.Println(v1, p, v2, v3) 5.5 ç»“æ„ä½“æ¯”è¾ƒå¦‚æœç»“æ„ä½“çš„å…¨éƒ¨æˆå‘˜éƒ½æ˜¯å¯ä»¥æ¯”è¾ƒçš„ï¼Œé‚£ä¹ˆç»“æ„ä½“ä¹Ÿæ˜¯å¯ä»¥æ¯”è¾ƒçš„ï¼Œé‚£æ ·çš„è¯ä¸¤ä¸ªç»“æ„ä½“å°†å¯ä»¥ä½¿ç”¨ æˆ–! è¿ç®—ç¬¦è¿›è¡Œæ¯”è¾ƒã€‚ç›¸ç­‰æ¯”è¾ƒè¿ç®—ç¬¦ å°†æ¯”è¾ƒä¸¤ä¸ªç»“æ„ä½“çš„æ¯ä¸ªæˆå‘˜ï¼Œå› æ­¤ä¸‹é¢ä¸¤ä¸ªæ¯”è¾ƒçš„è¡¨è¾¾å¼æ˜¯ç­‰ä»·çš„ï¼š type Point struct X, Y int p := Point1, 2q := Point2, 1fmt.Println(p.X == q.X p.Y == q.Y) // falsefmt.Println(p == q) // false 5.6 ç»“æ„ä½“åµŒå…¥å’ŒåŒ¿åæˆå‘˜è€ƒè™‘ä¸€ä¸ªäºŒç»´çš„ç»˜å›¾ç¨‹åºï¼Œæä¾›äº†ä¸€ä¸ªå„ç§å›¾å½¢çš„åº“ï¼Œä¾‹å¦‚çŸ©å½¢ã€æ¤­åœ†å½¢ã€æ˜Ÿå½¢å’Œè½®å½¢ç­‰å‡ ä½•å½¢çŠ¶ã€‚è¿™é‡Œæ˜¯å…¶ä¸­ä¸¤ä¸ªçš„å®šä¹‰ï¼š type Circle struct X, Y, Radius inttype Wheel struct X, Y, Radius, Spokes int ä¸€ä¸ª Circle ä»£è¡¨çš„åœ†å½¢ç±»å‹åŒ…å«äº†æ ‡å‡†åœ†å¿ƒçš„ X å’Œ Y åæ ‡ä¿¡æ¯ï¼Œå’Œä¸€ä¸ª Radius è¡¨ç¤ºçš„åŠå¾„ä¿¡æ¯ã€‚ä¸€ä¸ª Wheel è½®å½¢é™¤äº†åŒ…å« Circle ç±»å‹æ‰€æœ‰çš„å…¨éƒ¨æˆå‘˜å¤–ï¼Œè¿˜å¢åŠ äº† Spokes è¡¨ç¤ºå¾„å‘è¾æ¡çš„æ•°é‡ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·åˆ›å»ºä¸€ä¸ª wheel å˜é‡ï¼š var w Wheelw.X = 8w.Y = 8w.Radius = 5w.Spokes = 20 éšç€åº“ä¸­å‡ ä½•å½¢çŠ¶æ•°é‡çš„å¢å¤šï¼Œæˆ‘ä»¬ä¸€å®šä¼šæ³¨æ„åˆ°å®ƒä»¬ä¹‹é—´çš„ç›¸ä¼¼å’Œé‡å¤ä¹‹å¤„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯èƒ½ä¸ºäº†ä¾¿äºç»´æŠ¤è€Œå°†ç›¸åŒçš„å±æ€§ç‹¬ç«‹å‡ºæ¥ï¼š type Point struct X, Y inttype Circle struct Center Point\tRadius inttype Wheel struct Circle Circle\tSpokes int è¿™æ ·æ”¹åŠ¨ä¹‹åç»“æ„ä½“ç±»å‹å˜çš„æ¸…æ™°äº†ï¼Œä½†æ˜¯è¿™ç§ä¿®æ”¹åŒæ—¶ä¹Ÿå¯¼è‡´äº†è®¿é—®æ¯ä¸ªæˆå‘˜å˜å¾—ç¹çï¼š var w Wheelw.Circle.Center.X = 8w.Circle.Center.Y = 8w.Circle.Radius = 5w.Spokes = 20 Go è¯­è¨€æœ‰ä¸€ä¸ªç‰¹æ€§è®©æˆ‘ä»¬åªå£°æ˜ä¸€ä¸ªæˆå‘˜å¯¹åº”çš„æ•°æ®ç±»å‹è€Œä¸æŒ‡åæˆå‘˜çš„åå­—ï¼›è¿™ç±»æˆå‘˜å°±å«åŒ¿åæˆå‘˜ã€‚åŒ¿åæˆå‘˜çš„æ•°æ®ç±»å‹å¿…é¡»æ˜¯å‘½åçš„ç±»å‹æˆ–æŒ‡å‘ä¸€ä¸ªå‘½åçš„ç±»å‹çš„æŒ‡é’ˆã€‚ä¸‹é¢çš„ä»£ç ä¸­ï¼ŒCircle å’Œ Wheel å„è‡ªéƒ½æœ‰ä¸€ä¸ªåŒ¿åæˆå‘˜ã€‚æˆ‘ä»¬å¯ä»¥è¯´ Point ç±»å‹è¢«åµŒå…¥åˆ°äº† Circle ç»“æ„ä½“ï¼ŒåŒæ—¶ Circle ç±»å‹è¢«åµŒå…¥åˆ°äº† Wheel ç»“æ„ä½“ã€‚ type Circle struct Point\tRadius inttype Wheel struct Circle //ç›´æ¥ç»™å®šç±»å‹\tSpokes int å¾—æ„äºåŒ¿ååµŒå…¥çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è®¿é—®å¶å­å±æ€§è€Œä¸éœ€è¦ç»™å‡ºå®Œæ•´çš„è·¯å¾„ï¼š var w Wheelw.X = 8 // equivalent to w.Circle.Point.X = 8w.Y = 8 // equivalent to w.Circle.Point.Y = 8w.Radius = 5 // equivalent to w.Circle.Radius = 5w.Spokes = 20 ä½†æ˜¯è¿™æ ·å®šä¹‰åï¼Œç»“æ„ä½“å­—é¢é‡ä¸èƒ½ç”¨ä»¥ä¸‹æ–¹å¼åˆå§‹åŒ–: w = Wheel8, 8, 5, 20 // compile error: unknown fieldsw = WheelX: 8, Y: 8, Radius: 5, Spokes: 20 // compile error: unknown fields ç»“æ„ä½“å­—é¢å€¼å¿…é¡»éµå¾ªå½¢çŠ¶ç±»å‹å£°æ˜æ—¶çš„ç»“æ„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½ç”¨ä¸‹é¢çš„ä¸¤ç§è¯­æ³•ï¼Œå®ƒä»¬å½¼æ­¤æ˜¯ç­‰ä»·çš„ï¼š w = WheelCirclePoint8, 8, 5, 20w = Wheel\tCircle: Circle Point: PointX: 8, Y: 8, Radius: 5,\t,\tSpokes: 20, // NOTE: trailing comma necessary here (and at Radius) 6. æ•°ç»„ç±»å‹ [n]T è¡¨ç¤ºä¸€ä¸ªæ•°ç»„ï¼Œå®ƒæ‹¥æœ‰ n ä¸ªç±»å‹ä¸º T çš„å€¼ã€‚ è¡¨è¾¾å¼ï¼švar a [10]int ä¼šå°†å˜é‡ a å£°æ˜ä¸ºæ‹¥æœ‰ 10 ä¸ªæ•´æ•°çš„æ•°ç»„ã€‚ æ•°ç»„çš„é•¿åº¦æ˜¯å…¶ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤æ•°ç»„ä¸èƒ½æ”¹å˜å¤§å°ã€‚ è¿™çœ‹èµ·æ¥æ˜¯ä¸ªé™åˆ¶ï¼Œä¸è¿‡æ²¡å…³ç³»ï¼ŒGo æ‹¥æœ‰æ›´åŠ æ–¹ä¾¿çš„ä½¿ç”¨æ•°ç»„çš„æ–¹å¼ã€‚ package mainimport fmtfunc main() var a [2]string\ta[0] = hello\ta[1] = world\tfmt.Println(a[0], a[1])\tfmt.Println(a)\tprimes := [6]int2, 3, 4, 5, 6, 7\tfmt.Println(primes) 6.1 åˆ‡ç‰‡æ¯ä¸ªæ•°ç»„çš„å¤§å°éƒ½æ˜¯å›ºå®šçš„ã€‚è€Œåˆ‡ç‰‡åˆ™ä¸ºæ•°ç»„å…ƒç´ æä¾›äº†åŠ¨æ€å¤§å°çš„ã€çµæ´»çš„è§†è§’ã€‚ åœ¨å®è·µä¸­ï¼Œåˆ‡ç‰‡æ¯”æ•°ç»„æ›´å¸¸ç”¨ã€‚ ç±»å‹ []T è¡¨ç¤ºä¸€ä¸ªå…ƒç´ ç±»å‹ä¸º T çš„åˆ‡ç‰‡ã€‚ åˆ‡ç‰‡é€šè¿‡ä¸¤ä¸ªä¸‹æ ‡æ¥ç•Œå®šï¼Œä¸€ä¸ªä¸‹ç•Œå’Œä¸€ä¸ªä¸Šç•Œï¼ŒäºŒè€…ä»¥å†’å·åˆ†éš”ï¼š a[low : high] å®ƒä¼šé€‰å‡ºä¸€ä¸ªåŠé—­åŠå¼€åŒºé—´ï¼ŒåŒ…æ‹¬ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä½†æ’é™¤æœ€åä¸€ä¸ªå…ƒç´ ã€‚ ä»¥ä¸‹è¡¨è¾¾å¼åˆ›å»ºäº†ä¸€ä¸ªåˆ‡ç‰‡ï¼Œå®ƒåŒ…å« a ä¸­ä¸‹æ ‡ä» 1 åˆ° 3 çš„å…ƒç´ ï¼š a[1:4] package mainimport fmtfunc main() // åˆ›å»ºä¸€ä¸ªæ•°ç»„\tprimes := [6]int2, 3, 4, 5, 6, 7\t// åˆ›å»ºä¸€ä¸ªåˆ‡ç‰‡\tvar s []int = primes[1:4]\tfmt.Println(s) åˆ‡ç‰‡å°±åƒæ•°ç»„çš„å¼•ç”¨ åˆ‡ç‰‡å¹¶ä¸å­˜å‚¨ä»»ä½•æ•°æ®ï¼Œå®ƒåªæ˜¯æè¿°äº†åº•å±‚æ•°ç»„ä¸­çš„ä¸€æ®µã€‚æ›´æ”¹åˆ‡ç‰‡çš„å…ƒç´ ä¼šä¿®æ”¹å…¶åº•å±‚æ•°ç»„ä¸­å¯¹åº”çš„å…ƒç´ ï¼ˆåŸå§‹æ•°ç»„ä¸­çš„æ•°æ®ä¸ä¼šæ”¹å˜ï¼Œæ”¹çš„åªæ˜¯åˆ‡ç‰‡ï¼‰ï¼Œå’Œå®ƒå…±äº«åº•å±‚æ•°ç»„çš„åˆ‡ç‰‡éƒ½ä¼šè§‚æµ‹åˆ°è¿™äº›ä¿®æ”¹ã€‚ package mainimport fmtfunc main() names := [4]string lala, dd, dx, po, fmt.Println(names)\ta := names[0:2]\tb := names[1:3]\tfmt.Println(a, b)\t// ä¿®æ”¹åˆ‡ç‰‡æ•°æ®ï¼Œå…±äº«åº•å±‚æ•°ç»„çš„åˆ‡ç‰‡ä¸­æ•°æ®ä¼šä¿®æ”¹ï¼Œä½†åº•å±‚æ•°ç»„æ•°æ®ä¸å˜\tb[0] = XX\tfmt.Println(a, b) //[lala XX] [XX dx]\tfmt.Println(names) //[lala XX dx po] 6.2 åˆ‡ç‰‡å­—é¢é‡åˆ‡ç‰‡å­—é¢é‡ç±»ä¼¼äºæ²¡æœ‰é•¿åº¦çš„æ•°ç»„å­—é¢é‡ã€‚ è¿™æ˜¯ä¸€ä¸ªæ•°ç»„å­—é¢é‡ï¼š [3]booltrue, true, false ä¸‹é¢è¿™æ ·åˆ™ä¼š å…ˆåˆ›å»ºä¸€ä¸ªå’Œä¸Šé¢ç›¸åŒçš„æ•°ç»„ï¼Œç„¶åå†æ„å»ºä¸€ä¸ªå¼•ç”¨äº†å®ƒçš„åˆ‡ç‰‡ï¼š []booltrue, true, false package mainimport fmtfunc main() q := []int2, 3, 4, 5, 6\tfmt.Println(q)\tr := []booltrue, false, true\tfmt.Println(r)\ts := []struct i int b bool 2, true, 3, false, 4, true, fmt.Println(s) 6.3 åˆ‡ç‰‡é»˜è®¤è¡Œä¸ºåœ¨è¿›è¡Œåˆ‡ç‰‡æ—¶ï¼Œå¯ä»¥åˆ©ç”¨å®ƒçš„é»˜è®¤è¡Œä¸ºæ¥å¿½ç•¥ä¸Šä¸‹ç•Œã€‚ åˆ‡ç‰‡ä¸‹ç•Œçš„é»˜è®¤å€¼ä¸º 0ï¼Œä¸Šç•Œåˆ™æ˜¯è¯¥åˆ‡ç‰‡çš„é•¿åº¦ã€‚ å¯¹äºæ•°ç»„ var a [10]int æ¥è¯´ï¼Œä»¥ä¸‹åˆ‡ç‰‡è¡¨è¾¾å¼å’Œå®ƒæ˜¯ç­‰ä»·çš„ï¼š a[0:10]a[:10]a[0:]a[:] package mainimport fmtfunc main() s := []int2, 3, 4, 5, 6\ts = s[0:4]\tfmt.Println(s)\ts = s[:4]\tfmt.Println(s)\ts = s[0:]\tfmt.Println(s) 6.4 åˆ‡ç‰‡çš„é•¿åº¦ä¸å®¹é‡åˆ‡ç‰‡æ‹¥æœ‰ é•¿åº¦ å’Œ å®¹é‡ã€‚ åˆ‡ç‰‡çš„é•¿åº¦å°±æ˜¯å®ƒæ‰€åŒ…å«çš„å…ƒç´ ä¸ªæ•°ã€‚ åˆ‡ç‰‡çš„å®¹é‡æ˜¯ä»å®ƒçš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹æ•°ï¼Œåˆ°å…¶åº•å±‚æ•°ç»„å…ƒç´ æœ«å°¾çš„ä¸ªæ•°ã€‚ åˆ‡ç‰‡ s çš„é•¿åº¦å’Œå®¹é‡å¯é€šè¿‡è¡¨è¾¾å¼ len(s) å’Œ cap(s) æ¥è·å–ã€‚ å¯ä»¥é€šè¿‡é‡æ–°åˆ‡ç‰‡æ¥æ‰©å±•ä¸€ä¸ªåˆ‡ç‰‡ï¼Œç»™å®ƒæä¾›è¶³å¤Ÿçš„å®¹é‡ã€‚ package mainimport fmtfunc main() s := []int2, 3, 5, 7, 11, 13\tprintSlice(s)\t// æˆªå–åˆ‡ç‰‡ä½¿å…¶é•¿åº¦ä¸º 0\ts = s[:0]\tprintSlice(s)\t// æ‰©å±•å…¶é•¿åº¦\ts = s[:4]\tprintSlice(s)\t// èˆå¼ƒå‰ä¸¤ä¸ªå€¼\ts = s[2:]\tprintSlice(s)func printSlice(s []int) fmt.Printf(len=%d cap=%d %v , len(s), cap(s), s)len=6 cap=6 [2 3 5 7 11 13]len=0 cap=6 []len=4 cap=6 [2 3 5 7]len=2 cap=4 [5 7] s s [2:] çš„å®¹é‡ä¸ºä»€ä¹ˆæ˜¯ 4ï¼Ÿ å¯ä»¥ç†è§£ä¸ºåˆ‡ç‰‡æ˜¯ä¸€ç§å¼•ç”¨ç±»å‹ï¼Œåœ¨è¿™æŒ‡å‘æ•°ç»„ s çš„æŒ‡é’ˆã€‚s [2:] å°†æŒ‡é’ˆç§»åŠ¨åˆ°äº†å…ƒç´  5 çš„ä½ç½®ï¼Œæ­¤æ—¶è®¡ç®—å®¹é‡å°±æ˜¯ 4 äº†ã€‚ 6.5 nil åˆ‡ç‰‡åˆ‡ç‰‡çš„é›¶å€¼æ˜¯ nilã€‚ nil åˆ‡ç‰‡çš„é•¿åº¦å’Œå®¹é‡ä¸º 0 ä¸”æ²¡æœ‰åº•å±‚æ•°ç»„ã€‚ package mainimport fmtfunc main() var s []int\tfmt.Println(s, len(s), cap(s))\tif s == nil fmt.Println(nil!) 6.6 ä½¿ç”¨ make åˆ›å»ºåˆ‡ç‰‡åˆ‡ç‰‡å¯ä»¥ç”¨å†…ç½®å‡½æ•° make æ¥åˆ›å»ºï¼Œè¿™ä¹Ÿæ˜¯åˆ›å»ºåŠ¨æ€æ•°ç»„çš„æ–¹å¼ã€‚ make å‡½æ•°ä¼šåˆ†é…ä¸€ä¸ªå…ƒç´ ä¸ºé›¶å€¼çš„æ•°ç»„å¹¶è¿”å›ä¸€ä¸ªå¼•ç”¨äº†å®ƒçš„åˆ‡ç‰‡ï¼š a := make([]int, 5) // len(a)=5 è¦æŒ‡å®šå®ƒçš„å®¹é‡ï¼Œéœ€å‘ make ä¼ å…¥ç¬¬ä¸‰ä¸ªå‚æ•°ï¼š b := make([]int, 0, 5) // len(b)=0, cap(b)=5b = b[:cap(b)] // len(b)=5, cap(b)=5b = b[1:] // len(b)=4, cap(b)=4 package mainimport fmtfunc main() a := make([]int, 5)\tprintSlice(a, a)\tb := make([]int, 0, 5)\tprintSlice(b, b)\tc := b[:2]\tprintSlice(c, c)\td := c[2:5]\tprintSlice(d, d)func printSlice(s string, x []int) fmt.Printf(%s len=%d cap=%d %v , s, len(x), cap(x), x)a len=5 cap=5 [0 0 0 0 0]b len=0 cap=5 []c len=2 cap=5 [0 0]d len=3 cap=3 [0 0 0] 6.7 åˆ‡ç‰‡çš„åˆ‡ç‰‡åˆ‡ç‰‡å¯ä»¥åŒ…å«ä»»ä½•ç±»å‹ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬å…¶ä»–åˆ‡ç‰‡ã€‚ package mainimport (\tfmt\tstrings)func main() // åˆ›å»ºä¸€ä¸ªäº•å­—æ£‹ï¼ˆç»å…¸æ¸¸æˆï¼‰\tboard := [][]string []string_, _, _, []string_, _, _, []string_, _, _, // ä¸¤ä¸ªç©å®¶è½®æµæ‰“ä¸Š X å’Œ O\tboard[0][0] = X\tboard[2][2] = O\tboard[1][2] = X\tboard[1][0] = O\tboard[0][2] = X\tfor i := 0; i len(board); i++ fmt.Printf(%s , strings.Join(board[i], )) 6.8 å‘åˆ‡ç‰‡æ·»åŠ å…ƒç´ ä¸ºåˆ‡ç‰‡è¿½åŠ æ–°çš„å…ƒç´ æ˜¯ç§å¸¸è§çš„æ“ä½œï¼Œä¸ºæ­¤ Go æä¾›äº†å†…ç½®çš„ append å‡½æ•°ã€‚å†…ç½®å‡½æ•°çš„ æ–‡æ¡£ å¯¹è¯¥å‡½æ•°æœ‰è¯¦ç»†çš„ä»‹ç»ã€‚ func append(s []T, vs ...T) []T append çš„ç¬¬ä¸€ä¸ªå‚æ•° s æ˜¯ä¸€ä¸ªå…ƒç´ ç±»å‹ä¸º T çš„åˆ‡ç‰‡ï¼Œå…¶ä½™ç±»å‹ä¸º T çš„å€¼å°†ä¼šè¿½åŠ åˆ°è¯¥åˆ‡ç‰‡çš„æœ«å°¾ã€‚ append çš„ç»“æœæ˜¯ä¸€ä¸ªåŒ…å«åŸåˆ‡ç‰‡æ‰€æœ‰å…ƒç´ åŠ ä¸Šæ–°æ·»åŠ å…ƒç´ çš„åˆ‡ç‰‡ã€‚ å½“ s çš„åº•å±‚æ•°ç»„å¤ªå°ï¼Œä¸è¶³ä»¥å®¹çº³æ‰€æœ‰ç»™å®šçš„å€¼æ—¶ï¼Œå®ƒå°±ä¼šåˆ†é…ä¸€ä¸ªæ›´å¤§çš„æ•°ç»„ã€‚ è¿”å›çš„åˆ‡ç‰‡ä¼šæŒ‡å‘è¿™ä¸ªæ–°åˆ†é…çš„æ•°ç»„ã€‚ ï¼ˆè¦äº†è§£å…³äºåˆ‡ç‰‡çš„æ›´å¤šå†…å®¹ï¼Œè¯·é˜…è¯»æ–‡ç«  Go åˆ‡ç‰‡ï¼šç”¨æ³•å’Œæœ¬è´¨ã€‚ï¼‰ package mainimport fmtfunc main() var s []int\tprintSlice(s)\ts = append(s, 0)\tprintSlice(s)\ts = append(s, 1)\tprintSlice(s)\ts = append(s, 3, 4, 5)\tprintSlice(s)func printSlice(s []int) fmt.Printf(len=%d cap=%d %v , len(s), cap(s), s)len=0 cap=0 []len=1 cap=1 [0]len=2 cap=2 [0 1]len=5 cap=6 [0 1 3 4 5] 7. range éå†for å¾ªç¯çš„ range å½¢å¼å¯éå†åˆ‡ç‰‡æˆ–æ˜ å°„ã€‚ å½“ä½¿ç”¨ for å¾ªç¯éå†åˆ‡ç‰‡æ—¶ï¼Œæ¯æ¬¡è¿­ä»£éƒ½ä¼šè¿”å›ä¸¤ä¸ªå€¼ã€‚ ç¬¬ä¸€ä¸ªå€¼ä¸ºå½“å‰å…ƒç´ çš„ä¸‹æ ‡ï¼Œç¬¬äºŒä¸ªå€¼ä¸ºè¯¥ä¸‹æ ‡æ‰€å¯¹åº”å…ƒç´ çš„ä¸€ä»½å‰¯æœ¬ã€‚ package mainimport fmtvar pow = []int1, 2, 3, 4, 5, 6, 7, 8func main() for i, v := range pow fmt.Printf(i=%d v=%d , i, v)\ti=0 v=1i=1 v=2i=2 v=3i=3 v=4i=4 v=5i=5 v=6i=6 v=7i=7 v=8 å¯ä»¥å°†ä¸‹æ ‡æˆ–å€¼èµ‹äºˆ _ æ¥å¿½ç•¥å®ƒã€‚ for i, _ := range powfor _, value := range pow è‹¥åªéœ€è¦ç´¢å¼•ï¼Œå¿½ç•¥ç¬¬äºŒä¸ªå˜é‡å³å¯ã€‚ for i := range pow package mainimport fmtfunc main() pow := make([]int, 5)\tfor i := range pow pow[i] = 1 uint(i) // 2^i for _, v := range pow fmt.Printf(%d , v)\t124816 8. map8.1 åˆ›å»ºæ˜ å°„map æ˜ å°„å°†é”®æ˜ å°„åˆ°å€¼ã€‚ æ˜ å°„çš„é›¶å€¼ä¸º nil ã€‚nil æ˜ å°„æ—¢æ²¡æœ‰é”®ï¼Œä¹Ÿä¸èƒ½æ·»åŠ é”®ã€‚(ä½¿ç”¨ var å®šä¹‰) make å‡½æ•°ä¼šè¿”å›ç»™å®šç±»å‹çš„æ˜ å°„ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–å¤‡ç”¨ã€‚ package mainimport fmttype Vertex struct Lat, Long float64var m map[string]Vertexfunc main() m = make(map[string]Vertex)\tm[gege] = Vertex 3.14, 15926.1, fmt.Println(m[gege]) 8.2 æ˜ å°„å­—é¢é‡æ˜ å°„çš„å­—é¢é‡å’Œç»“æ„ä½“ç±»ä¼¼ï¼Œåªä¸è¿‡å¿…é¡»æœ‰é”®åã€‚ package mainimport fmttype Vertex struct Lat, Long float64var m = map[string]Vertex\tBell Labs: Vertex 40.68433, -74.39967,\t,\tGoogle: Vertex 37.42202, -122.08408,\t,func main() fmt.Println(m è‹¥é¡¶å±‚ç±»å‹åªæœ‰ä¸€ä¸ªç±»å‹åï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨å­—é¢é‡çš„å…ƒç´ ä¸­çœç•¥å®ƒã€‚ package mainimport fmttype Vertex struct Lat, Long float64var m = map[string]Vertex\tBell Labs: 40.68433, -74.39967,\t,\tGoogle: 37.42202, -122.08408,\t,func main() fmt.Println(m 8.3 ä¿®æ”¹æ˜ å°„åœ¨æ˜ å°„ m ä¸­æ’å…¥æˆ–ä¿®æ”¹å…ƒç´ ï¼š m[key] = elem è·å–å…ƒç´ ï¼š elem = m[key] åˆ é™¤å…ƒç´ ï¼š delete(m, key) é€šè¿‡åŒèµ‹å€¼æ£€æµ‹æŸä¸ªé”®æ˜¯å¦å­˜åœ¨ï¼š elem, ok = m[key] è‹¥ key åœ¨ m ä¸­ï¼Œok ä¸º true ï¼›å¦åˆ™ï¼Œok ä¸º falseã€‚ è‹¥ key ä¸åœ¨æ˜ å°„ä¸­ï¼Œåˆ™ elem æ˜¯è¯¥æ˜ å°„å…ƒç´ ç±»å‹çš„é›¶å€¼ã€‚ æ³¨ï¼šè‹¥ elem æˆ– ok è¿˜æœªå£°æ˜ï¼Œä½ å¯ä»¥ä½¿ç”¨çŸ­å˜é‡å£°æ˜ï¼š elem, ok := m[key] package mainimport fmtfunc main() m := make(map[string]int)\tm[ç­”æ¡ˆ] = 42\tfmt.Println(å€¼ï¼š, m[ç­”æ¡ˆ])\tm[ç­”æ¡ˆ] = 48\tfmt.Println(å€¼ï¼š, m[ç­”æ¡ˆ])\tdelete(m, ç­”æ¡ˆ)\tfmt.Println(å€¼ï¼š, m[ç­”æ¡ˆ])\tv, ok := m[ç­”æ¡ˆ]\tfmt.Println(å€¼ï¼š, v, æ˜¯å¦å­˜åœ¨ï¼Ÿ, ok)å€¼ï¼š 42å€¼ï¼š 48å€¼ï¼š 0å€¼ï¼š 0 æ˜¯å¦å­˜åœ¨ï¼Ÿ false 9. JSONGo ä¸­æä¾›å¯¹ JSON æ ¼å¼æ•°æ®å¤„ç†çš„ API type Movie struct Title string Year int `json:released` // `json:released`:ç»“æ„ä½“æˆå‘˜Tag\tColor bool `json:color,omitempty`\tActors []stringvar movies = []Movie\tTitle: Casablanca, Year: 1942, Color: false, Actors: []stringHumphrey Bogart, Ingrid Bergman,\tTitle: Cool Hand Luke, Year: 1967, Color: true, Actors: []stringPaul Newman,\tTitle: Bullitt, Year: 1968, Color: true, Actors: []stringSteve McQueen, Jacqueline Bisset,\t// ...func main() // è¿”å›ä¸€ä¸ªç¼–ç åçš„å­—èŠ‚sliceï¼ŒåŒ…å«å¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”æ²¡æœ‰ç©ºç™½ç¼©è¿›\tdata, _ := json.Marshal(movies)\tfmt.Printf(%s , data) // å¤šäº†æ ¼å¼åŒ–\tdata, _ = json.MarshalIndent(movies, , )\tfmt.Printf(%s , data)========================================================================================PS D:\\work\\sty_project\\sty_go\\basic go run .\\54.json.go[Title:Casablanca,released:1942,Actors:[Humphrey Bogart,Ingrid Bergman],Title:Cool Hand Luke,released:1967,color:true,Actors:[Paul Newman],Title:Bullitt,released:1968,color:true,Actors:[Steve McQueen,Jacqueline Bisset]][ Title: Casablanca, released: 1942, Actors: [ Humphrey Bogart, Ingrid Bergman ] , Title: Cool Hand Luke, released: 1967, color: true, Actors: [ Paul Newman ] , Title: Bullitt, released: 1968, color: true, Actors: [ Steve McQueen, Jacqueline Bisset ] ] åœ¨ç¼–ç æ—¶ï¼Œé»˜è®¤ä½¿ç”¨ Go è¯­è¨€ç»“æ„ä½“çš„æˆå‘˜åå­—ä½œä¸º JSON çš„å¯¹è±¡ï¼ˆé€šè¿‡ reflect åå°„æŠ€æœ¯ï¼‰ã€‚åªæœ‰å¯¼å‡ºçš„ç»“æ„ä½“æˆå‘˜æ‰ä¼šè¢«ç¼–ç ï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆé€‰æ‹©ç”¨å¤§å†™å­—æ¯å¼€å¤´çš„æˆå‘˜åç§°ã€‚ å…¶ä¸­ Year åå­—çš„æˆå‘˜åœ¨ç¼–ç åå˜æˆäº† releasedï¼Œè¿˜æœ‰ Color æˆå‘˜ç¼–ç åå˜æˆäº†å°å†™å­—æ¯å¼€å¤´çš„ colorã€‚è¿™æ˜¯å› ä¸ºæ„ä½“æˆå‘˜ Tag æ‰€å¯¼è‡´çš„ã€‚ä¸€ä¸ªæ„ä½“æˆå‘˜ Tag æ˜¯å’Œåœ¨ç¼–è¯‘é˜¶æ®µå…³è”åˆ°è¯¥æˆå‘˜çš„å…ƒä¿¡æ¯å­—ç¬¦ä¸²ï¼š Year int `json:released`Color bool `json:color,omitempty` ç»“æ„ä½“çš„æˆå‘˜ Tag å¯ä»¥æ˜¯ä»»æ„çš„å­—ç¬¦ä¸²é¢å€¼ï¼Œä½†æ˜¯é€šå¸¸æ˜¯ä¸€ç³»åˆ—ç”¨ç©ºæ ¼åˆ†éš”çš„ key: â€œvalueâ€ é”®å€¼å¯¹åºåˆ—ï¼›å› ä¸ºå€¼ä¸­å«ä¹‰åŒå¼•å·å­—ç¬¦ï¼Œå› æ­¤æˆå‘˜ Tag ä¸€èˆ¬ç”¨åŸç”Ÿå­—ç¬¦ä¸²é¢å€¼çš„å½¢å¼ä¹¦å†™ã€‚json å¼€å¤´é”®åå¯¹åº”çš„å€¼ç”¨äºæ§åˆ¶ encodingjson åŒ…çš„ç¼–ç å’Œè§£ç çš„è¡Œä¸ºï¼Œå¹¶ä¸” encodingâ€¦ä¸‹é¢å…¶å®ƒçš„åŒ…ä¹Ÿéµå¾ªè¿™ä¸ªçº¦å®šã€‚æˆå‘˜ Tag ä¸­ json å¯¹åº”å€¼çš„ç¬¬ä¸€éƒ¨åˆ†ç”¨äºæŒ‡å®š JSON å¯¹è±¡çš„åå­—ï¼Œæ¯”å¦‚å°† Go è¯­è¨€ä¸­çš„ Year æˆå‘˜å¯¹åº”åˆ° JSON ä¸­çš„ released å¯¹è±¡ã€‚Color æˆå‘˜çš„ Tag è¿˜å¸¦äº†ä¸€ä¸ªé¢å¤–çš„ omitempty é€‰é¡¹ï¼Œè¡¨ç¤ºå½“ Go è¯­è¨€ç»“æ„ä½“æˆå‘˜ä¸ºç©ºæˆ–é›¶å€¼æ—¶ä¸ç”Ÿæˆ JSON å¯¹è±¡ï¼ˆè¿™é‡Œ false ä¸ºé›¶å€¼ï¼‰ã€‚ var titles []struct Title string if err := json.Unmarshal(data, titles); err != nil log.Fatalf(JSON unmarshaling failed: %s, err)fmt.Println(titles) // [Casablanca Cool Hand Luke Bullitt] ç¼–ç çš„é€†æ“ä½œæ˜¯è§£ç ï¼Œå¯¹åº”å°† JSON æ•°æ®è§£ç ä¸º Go è¯­è¨€çš„æ•°æ®ç»“æ„ï¼ŒGo è¯­è¨€ä¸­ä¸€èˆ¬å« unmarshalingï¼Œé€šè¿‡ json.Unmarshal å‡½æ•°å®Œæˆã€‚ä¸‹é¢çš„ä»£ç å°† JSON æ ¼å¼çš„ç”µå½±æ•°æ®è§£ç ä¸ºä¸€ä¸ªç»“æ„ä½“ sliceï¼Œç»“æ„ä½“ä¸­åªæœ‰ Title æˆå‘˜ã€‚é€šè¿‡å®šä¹‰åˆé€‚çš„ Go è¯­è¨€æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æ€§åœ°è§£ç  JSON ä¸­æ„Ÿå…´è¶£çš„æˆå‘˜ã€‚å½“ Unmarshal å‡½æ•°è°ƒç”¨è¿”å›ï¼Œslice å°†è¢«åªå«æœ‰ Title ä¿¡æ¯å€¼å¡«å……ï¼Œå…¶å®ƒ JSON æˆå‘˜å°†è¢«å¿½ç•¥ã€‚ 9. å‡½æ•°9.1 å‡½æ•°å€¼å‡½æ•°ä¹Ÿæ˜¯å€¼ã€‚å®ƒä»¬å¯ä»¥åƒå…¶ä»–å€¼ä¸€æ ·ä¼ é€’ã€‚ å‡½æ•°å€¼å¯ä»¥ç”¨ä½œå‡½æ•°çš„å‚æ•°æˆ–è¿”å›å€¼ã€‚ package mainimport (\tfmt\tmath)// å…¥å‚ä¸ºå‡½æ•°fn(float64, float64) float64func compute(fn func(float64, float64) float64) float64 return fn(3, 4)func main() hypot := func(x, y float64) float64 return math.Sqrt(x*x + y*y) fmt.Println(hypot(5, 12)) // hypot(3,4)ï¼ŒæŠŠå‡½æ•°ä¼ å…¥computeï¼Œæ‰§è¡Œhypot(3,4)\tfmt.Println(compute((hypot))) // math.pow(3,4)\tfmt.Println(compute(math.Pow)) 9.2 å‡½æ•°é—­åŒ…Go å‡½æ•°å¯ä»¥æ˜¯ä¸€ä¸ªé—­åŒ…ã€‚é—­åŒ…æ˜¯ä¸€ä¸ªå‡½æ•°å€¼ï¼Œå®ƒå¼•ç”¨äº†å…¶å‡½æ•°ä½“ä¹‹å¤–çš„å˜é‡ã€‚ è¯¥å‡½æ•°å¯ä»¥è®¿é—®å¹¶èµ‹äºˆå…¶å¼•ç”¨çš„å˜é‡å€¼ï¼Œæ¢å¥è¯è¯´ï¼Œè¯¥å‡½æ•°è¢«â€œç»‘å®šâ€åˆ°äº†è¿™äº›å˜é‡ã€‚ ä»¥ä¸‹å®ä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†å‡½æ•° getSequence() ï¼Œè¿”å›å¦å¤–ä¸€ä¸ªå‡½æ•°ã€‚è¯¥å‡½æ•°çš„ç›®çš„æ˜¯åœ¨é—­åŒ…ä¸­é€’å¢ i å˜é‡ï¼Œä»£ç å¦‚ä¸‹ï¼š package mainimport fmtfunc getSequence() func() int i:=0 return func() int i+=1 return i func main() /* nextNumber ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•° i ä¸º 0 */ nextNumber := getSequence() /* è°ƒç”¨ nextNumber å‡½æ•°ï¼Œi å˜é‡è‡ªå¢ 1 å¹¶è¿”å› */ fmt.Println(nextNumber()) fmt.Println(nextNumber()) fmt.Println(nextNumber()) /* åˆ›å»ºæ–°çš„å‡½æ•° nextNumber1ï¼Œå¹¶æŸ¥çœ‹ç»“æœ */ nextNumber1 := getSequence() fmt.Println(nextNumber1()) fmt.Println(nextNumber1())12312 getSequence()çš„ä¾‹å­è¯æ˜ï¼Œå‡½æ•°å€¼ä¸ä»…ä»…æ˜¯ä¸€ä¸²ä»£ç ï¼Œè¿˜è®°å½•äº†çŠ¶æ€ã€‚åœ¨ getSequence()ä¸­å®šä¹‰çš„åŒ¿åå†…éƒ¨å‡½æ•°å¯ä»¥è®¿é—®å’Œæ›´æ–° getSequence()æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡ï¼Œè¿™æ„å‘³ç€åŒ¿åå‡½æ•°å’Œ getSequence()ä¸­ï¼Œå­˜åœ¨å˜é‡å¼•ç”¨ã€‚è¿™å°±æ˜¯å‡½æ•°å€¼å±äºå¼•ç”¨ç±»å‹å’Œå‡½æ•°å€¼ä¸å¯æ¯”è¾ƒçš„åŸå› ã€‚Go ä½¿ç”¨é—­åŒ…ï¼ˆclosuresï¼‰æŠ€æœ¯å®ç°å‡½æ•°å€¼ï¼ŒGo ç¨‹åºå‘˜ä¹ŸæŠŠå‡½æ•°å€¼å«åšé—­åŒ…ã€‚ é€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬çœ‹åˆ°å˜é‡çš„ç”Ÿå‘½å‘¨æœŸä¸ç”±å®ƒçš„ä½œç”¨åŸŸå†³å®šï¼šgetSequence()è¿”å›åï¼Œå˜é‡ i ä»ç„¶éšå¼çš„å­˜åœ¨äº nextNumber ä¸­ã€‚ 10. æ–¹æ³•10.1 å®šä¹‰Go æ²¡æœ‰ç±»ã€‚ ä¸è¿‡ä½ å¯ä»¥ä¸ºç±»å‹å®šä¹‰æ–¹æ³•ã€‚ æ–¹æ³•å°±æ˜¯ä¸€ç±»å¸¦ç‰¹æ®Šçš„ å…¥å‚ çš„å‡½æ•°ã€‚ æ–¹æ³•å…¥å‚åœ¨å®ƒè‡ªå·±çš„å‚æ•°åˆ—è¡¨å†…ï¼Œä½äº func å…³é”®å­—å’Œæ–¹æ³•åä¹‹é—´ã€‚ æ–¹æ³•ä¸€èˆ¬æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹(OOP)çš„ä¸€ä¸ªç‰¹æ€§ï¼Œåœ¨ C++ è¯­è¨€ä¸­æ–¹æ³•å¯¹åº”ä¸€ä¸ªç±»å¯¹è±¡çš„æˆå‘˜å‡½æ•°ï¼Œæ˜¯å…³è”åˆ°å…·ä½“å¯¹è±¡ä¸Šçš„è™šè¡¨ä¸­çš„ã€‚ä½†æ˜¯ Go è¯­è¨€çš„æ–¹æ³•å´æ˜¯å…³è”åˆ°ç±»å‹çš„ï¼Œè¿™æ ·å¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µå®Œæˆæ–¹æ³•çš„é™æ€ç»‘å®šã€‚ä¸€ä¸ªé¢å‘å¯¹è±¡çš„ç¨‹åºä¼šç”¨æ–¹æ³•æ¥è¡¨è¾¾å…¶å±æ€§å¯¹åº”çš„æ“ä½œï¼Œè¿™æ ·ä½¿ç”¨è¿™ä¸ªå¯¹è±¡çš„ç”¨æˆ·å°±ä¸éœ€è¦ç›´æ¥å»æ“ä½œå¯¹è±¡ï¼Œè€Œæ˜¯å€ŸåŠ©æ–¹æ³•æ¥åšè¿™äº›äº‹æƒ…ã€‚é¢å‘å¯¹è±¡ç¼–ç¨‹è¿›å…¥ä¸»æµå¼€å‘é¢†åŸŸä¸€èˆ¬è®¤ä¸ºæ˜¯ä» C++ å¼€å§‹çš„ï¼ŒC++ å°±æ˜¯åœ¨å…¼å®¹ C è¯­è¨€çš„åŸºç¡€ä¹‹ä¸Šæ”¯æŒäº† class ç­‰é¢å‘å¯¹è±¡çš„ç‰¹æ€§ã€‚ç„¶å Java ç¼–ç¨‹åˆ™å·ç§°æ˜¯çº¯ç²¹çš„é¢å‘å¯¹è±¡è¯­è¨€ï¼Œå› ä¸º Java ä¸­å‡½æ•°æ˜¯ä¸èƒ½ç‹¬ç«‹å­˜åœ¨çš„ï¼Œæ¯ä¸ªå‡½æ•°éƒ½å¿…ç„¶æ˜¯å±äºæŸä¸ªç±»çš„ã€‚ é¢å‘å¯¹è±¡ç¼–ç¨‹æ›´å¤šçš„åªæ˜¯ä¸€ç§æ€æƒ³ï¼Œå¾ˆå¤šå·ç§°æ”¯æŒé¢å‘å¯¹è±¡ç¼–ç¨‹çš„è¯­è¨€åªæ˜¯å°†ç»å¸¸ç”¨åˆ°çš„ç‰¹æ€§å†…ç½®åˆ°è¯­è¨€ä¸­äº†è€Œå·²ã€‚Go è¯­è¨€çš„ç¥–å…ˆ C è¯­è¨€è™½ç„¶ä¸æ˜¯ä¸€ä¸ªæ”¯æŒé¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œä½†æ˜¯ C è¯­è¨€çš„æ ‡å‡†åº“ä¸­çš„ File ç›¸å…³çš„å‡½æ•°ä¹Ÿç”¨åˆ°äº†çš„é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ€æƒ³ã€‚ä¸‹é¢æˆ‘ä»¬å®ç°ä¸€ç»„ C è¯­è¨€é£æ ¼çš„ File å‡½æ•°ï¼š // æ–‡ä»¶å¯¹è±¡type File struct fd int// æ‰“å¼€æ–‡ä»¶func OpenFile(name string) (f *File, err error) // ...// å…³é—­æ–‡ä»¶func CloseFile(f *File) error // ...// è¯»æ–‡ä»¶æ•°æ®func ReadFile(f *File, offset int64, data []byte) int // ... å…¶ä¸­ OpenFile ç±»ä¼¼æ„é€ å‡½æ•°ç”¨äºæ‰“å¼€æ–‡ä»¶å¯¹è±¡ï¼ŒCloseFile ç±»ä¼¼ææ„å‡½æ•°ç”¨äºå…³é—­æ–‡ä»¶å¯¹è±¡ï¼ŒReadFile åˆ™ç±»ä¼¼æ™®é€šçš„æˆå‘˜å‡½æ•°ï¼Œè¿™ä¸‰ä¸ªå‡½æ•°éƒ½æ˜¯æ™®é€šçš„å‡½æ•°ã€‚CloseFile å’Œ ReadFile ä½œä¸ºæ™®é€šå‡½æ•°ï¼Œéœ€è¦å ç”¨åŒ…çº§ç©ºé—´ä¸­çš„åå­—èµ„æºã€‚ä¸è¿‡ CloseFile å’Œ ReadFile å‡½æ•°åªæ˜¯é’ˆå¯¹ File ç±»å‹å¯¹è±¡çš„æ“ä½œï¼Œè¿™æ—¶å€™æˆ‘ä»¬æ›´å¸Œæœ› è¿™ç±»å‡½æ•°å’Œæ“ä½œå¯¹è±¡çš„ç±»å‹ç´§å¯†ç»‘å®šåœ¨ä¸€èµ·ã€‚ Go è¯­è¨€ä¸­çš„åšæ³•æ˜¯ï¼Œå°† CloseFile å’Œ ReadFile å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ç§»åŠ¨åˆ°å‡½æ•°åçš„å¼€å¤´ï¼š // å…³é—­æ–‡ä»¶func (f *File) CloseFile() error // ...// è¯»æ–‡ä»¶æ•°æ®func (f *File) ReadFile(offset int64, data []byte) int // ... è¿™æ ·çš„è¯ï¼ŒCloseFile å’Œ ReadFile å‡½æ•°å°±æˆäº† File ç±»å‹ç‹¬æœ‰çš„æ–¹æ³•äº†ï¼ˆè€Œä¸æ˜¯ File å¯¹è±¡æ–¹æ³•ï¼‰ã€‚å®ƒä»¬ä¹Ÿä¸å†å ç”¨åŒ…çº§ç©ºé—´ä¸­çš„åå­—èµ„æºï¼ŒåŒæ—¶ File ç±»å‹å·²ç»æ˜ç¡®äº†å®ƒä»¬æ“ä½œå¯¹è±¡ï¼Œå› æ­¤æ–¹æ³•åå­—ä¸€èˆ¬ç®€åŒ–ä¸º Close å’Œ Readï¼š // å…³é—­æ–‡ä»¶func (f *File) Close() error // ...// è¯»æ–‡ä»¶æ•°æ®func (f *File) Read(offset int64, data []byte) int // ... å°†ç¬¬ä¸€ä¸ªå‡½æ•°å‚æ•°ç§»åŠ¨åˆ°å‡½æ•°å‰é¢ï¼Œä»ä»£ç è§’åº¦çœ‹è™½ç„¶åªæ˜¯ä¸€ä¸ªå°çš„æ”¹åŠ¨ï¼Œä½†æ˜¯ä»ç¼–ç¨‹å“²å­¦è§’åº¦æ¥çœ‹ï¼ŒGo è¯­è¨€å·²ç»æ˜¯è¿›å…¥é¢å‘å¯¹è±¡è¯­è¨€çš„è¡Œåˆ—äº†ã€‚æˆ‘ä»¬å¯ä»¥ç»™ä»»ä½•è‡ªå®šä¹‰ç±»å‹æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæ–¹æ³•ã€‚æ¯ç§ç±»å‹å¯¹åº”çš„æ–¹æ³•å¿…é¡»å’Œç±»å‹çš„å®šä¹‰åœ¨åŒä¸€ä¸ªåŒ…ä¸­ï¼Œå› æ­¤æ˜¯æ— æ³•ç»™ int è¿™ç±»å†…ç½®ç±»å‹æ·»åŠ æ–¹æ³•çš„ï¼ˆå› ä¸ºæ–¹æ³•çš„å®šä¹‰å’Œç±»å‹çš„å®šä¹‰ä¸åœ¨ä¸€ä¸ªåŒ…ä¸­ï¼‰ã€‚å¯¹äºç»™å®šçš„ç±»å‹ï¼Œæ¯ä¸ªæ–¹æ³•çš„åå­—å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼ŒåŒæ—¶æ–¹æ³•å’Œå‡½æ•°ä¸€æ ·ä¹Ÿä¸æ”¯æŒé‡è½½ã€‚ æ–¹æ³•å³å‡½æ•° package mainimport (\tfmt\tmath)type Vertex struct X, Y float64// Abs æ–¹æ³•æ‹¥æœ‰ä¸€ä¸ªåå­—ä¸º vï¼Œç±»å‹ä¸º Vertex çš„å…¥å‚ã€‚func (v Vertex) Abs() float64 return math.Sqrt(v.X*v.X + v.Y*v.Y)// ç°åœ¨è¿™ä¸ª Abs çš„å†™æ³•å°±æ˜¯ä¸ªæ­£å¸¸çš„å‡½æ•°ï¼ŒåŠŸèƒ½å¹¶æ²¡æœ‰ä»€ä¹ˆå˜åŒ–ã€‚func Abs2(v Vertex) float64 return math.Sqrt(v.X*v.X + v.Y*v.Y)func main() v := Vertex3, 4 // å‡½æ•°ä¸æ“ä½œå¯¹è±¡ç±»å‹ç»‘å®š\tfmt.Println(v.Abs()) fmt.Println(Abs2(v)) ä½ ä¹Ÿå¯ä»¥ä¸ºéç»“æ„ä½“ç±»å‹å£°æ˜æ–¹æ³•ã€‚ åœ¨æ­¤ä¾‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªå¸¦ Abs æ–¹æ³•çš„æ•°å€¼ç±»å‹ MyFloatã€‚ ä½ åªèƒ½ä¸ºåœ¨åŒä¸€ä¸ªåŒ…ä¸­å®šä¹‰çš„å…¥å‚ç±»å‹å£°æ˜æ–¹æ³•ï¼Œè€Œä¸èƒ½ä¸ºå…¶å®ƒåˆ«çš„åŒ…ä¸­å®šä¹‰çš„ç±»å‹ ï¼ˆåŒ…æ‹¬ int ä¹‹ç±»çš„å†…ç½®ç±»å‹ï¼‰å£°æ˜æ–¹æ³•ã€‚ï¼ˆå°±æ˜¯å…¥å‚çš„ç±»å‹å®šä¹‰å’Œæ–¹æ³•å£°æ˜å¿…é¡»åœ¨åŒä¸€åŒ…å†…ï¼‰ package mainimport (\tfmt\tmath)type MyFloat float64func (f MyFloat) Abs() float64 if f 0 return float64(-f) return float64(f)func main() f := MyFloat(-math.Sqrt2)\tfmt.Println(f.Abs()) 10.2 æŒ‡é’ˆç±»å‹å…¥å‚ä½ å¯ä»¥ä¸ºæŒ‡é’ˆç±»å‹çš„å…¥å‚å£°æ˜æ–¹æ³•ã€‚ è¿™æ„å‘³ç€å¯¹äºæŸç±»å‹ Tï¼Œå…¥å‚çš„ç±»å‹å¯ä»¥ç”¨ *T çš„æ–‡æ³•ã€‚ ï¼ˆæ­¤å¤–ï¼ŒT æœ¬èº«ä¸èƒ½æ˜¯æŒ‡é’ˆï¼Œæ¯”å¦‚ä¸èƒ½æ˜¯ *intã€‚ï¼‰ ä¾‹å¦‚ï¼Œè¿™é‡Œä¸º *Vertex å®šä¹‰äº† Scale æ–¹æ³•ã€‚ æŒ‡é’ˆç±»å‹å…¥å‚çš„æ–¹æ³•å¯ä»¥ä¿®æ”¹å…¥å‚æŒ‡é’ˆæŒ‡å‘çš„å€¼ï¼ˆå¦‚è¿™é‡Œçš„ Scale æ‰€ç¤ºï¼‰ã€‚ ç”±äºæ–¹æ³•ç»å¸¸éœ€è¦ä¿®æ”¹å®ƒçš„å…¥å‚å¯¹è±¡ï¼ŒæŒ‡é’ˆå…¥å‚æ¯”å€¼å…¥å‚æ›´å¸¸ç”¨ã€‚ è¯•ç€ç§»é™¤ Scale å‡½æ•°å£°æ˜ä¸­çš„ *ï¼Œè§‚å¯Ÿæ­¤ç¨‹åºçš„è¡Œä¸ºå¦‚ä½•å˜åŒ–ã€‚ è‹¥ä½¿ç”¨å€¼å…¥å‚ï¼Œé‚£ä¹ˆ Scale2 æ–¹æ³•ä¼šå¯¹åŸå§‹ Vertex å€¼çš„å‰¯æœ¬è¿›è¡Œæ“ä½œã€‚ï¼ˆå¯¹äºå‡½æ•°çš„å…¶å®ƒå‚æ•°ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ï¼‰ package mainimport (\tfmt\tmath)type Vertex struct X, Y float64func (v Vertex) Abs() float64 // 25\treturn math.Sqrt(v.X*v.X + v.Y*v.Y)func (v *Vertex) Scale(f float64) v.X = v.X * f\tv.Y = v.Y * ffunc (v Vertex) Scale2(f float64) v.X = v.X * f\tv.Y = v.Y * ffunc main() v := Vertex3, 4\t// ä½¿ç”¨æŒ‡é’ˆç›´æ¥ä¿®æ”¹åŸå§‹å€¼\tv.Scale(10)\tfmt.Println(v.Abs())\tv2 := Vertex3, 4\t// ä½¿ç”¨å€¼æ¥æ”¶ï¼Œä¿®æ”¹åŸå§‹å€¼çš„å‰¯æœ¬\tv2.Scale2(10)\tfmt.Println(v2.Abs()) æŒ‡é’ˆä¸å‡½æ•° ç°åœ¨æˆ‘ä»¬è¦æŠŠ Abs å’Œ Scale æ–¹æ³•é‡å†™ä¸ºå‡½æ•°ã€‚ åŒæ ·ï¼Œå…ˆè¯•ç€ç§»é™¤æ‰ Scaleå‡½æ•°çš„*ï¼Œä½ èƒ½çœ‹å‡ºç¨‹åºè¡Œä¸ºæ”¹å˜çš„åŸå› å—ï¼Ÿ è¦æ€æ ·åšæ‰èƒ½è®©è¯¥ç¤ºä¾‹é¡ºåˆ©é€šè¿‡ç¼–è¯‘ï¼Ÿ package mainimport (\tfmt\tmath)type Vertex struct X, Y float64func Abs(v Vertex) float64 return math.Sqrt(v.X*v.X + v.Y*v.Y)func Scale(v *Vertex, f float64) v.X = v.X * f\tv.Y = v.Y * ffunc main() v := Vertex3, 4\tScale(v, 10)\tfmt.Println(Abs(v)) package mainimport fmttype Vertex struct X, Y float64func (v *Vertex) Scale(f float64) v.X = v.X * f\tv.Y = v.Y * ffunc ScaleFunc(v *Vertex, f float64) v.X = v.X * f\tv.Y = v.Y * ffunc main() v := Vertex3, 4\tv.Scale(2)\tScaleFunc(v, 10)\tp := Vertex4, 3\tp.Scale(3)\tScaleFunc(p, 8)\tfmt.Println(v, p) æ¯”è¾ƒå‰ä¸¤ä¸ªç¨‹åºï¼Œä½ å¤§æ¦‚ä¼šæ³¨æ„åˆ°å¸¦æŒ‡é’ˆå‚æ•°çš„å‡½æ•°å¿…é¡»æ¥å—ä¸€ä¸ªæŒ‡é’ˆï¼š var v VertexScaleFunc(v, 5) // ç¼–è¯‘é”™è¯¯ï¼ScaleFunc(v, 5) // OK è€Œå…¥å‚ä¸ºæŒ‡é’ˆçš„çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå…¥å‚æ—¢èƒ½æ˜¯å€¼åˆèƒ½æ˜¯æŒ‡é’ˆï¼š var v Vertexv.Scale(5) // OKp := vp.Scale(10) // OK å¯¹äºè¯­å¥ v.Scale(5) æ¥è¯´ï¼Œå³ä¾¿ v æ˜¯ä¸€ä¸ªå€¼è€ŒéæŒ‡é’ˆï¼Œå¸¦æŒ‡é’ˆå…¥å‚çš„æ–¹æ³•ä¹Ÿèƒ½è¢«ç›´æ¥è°ƒç”¨ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œç”±äº Scale æ–¹æ³•æœ‰ä¸€ä¸ªæŒ‡é’ˆå…¥å‚ï¼Œä¸ºæ–¹ä¾¿èµ·è§ï¼ŒGo ä¼šå°†è¯­å¥ v.Scale(5) è§£é‡Šä¸º (v).Scale(5)ã€‚ åä¹‹ä¹Ÿä¸€æ ·ï¼š æ¥å—ä¸€ä¸ªå€¼ä½œä¸ºå‚æ•°çš„å‡½æ•°å¿…é¡»æ¥å—ä¸€ä¸ªæŒ‡å®šç±»å‹çš„å€¼ï¼š var v Vertexfmt.Println(AbsFunc(v)) // OKfmt.Println(AbsFunc(v)) // ç¼–è¯‘é”™è¯¯ï¼ è€Œä»¥å€¼ä¸ºå…¥å‚çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå…¥å‚æ—¢èƒ½ä¸ºå€¼åˆèƒ½ä¸ºæŒ‡é’ˆï¼š var v Vertexfmt.Println(v.Abs()) // OKp := vfmt.Println(p.Abs()) // OK è¿™ç§æƒ…å†µä¸‹ï¼Œæ–¹æ³•è°ƒç”¨ p.Abs() ä¼šè¢«è§£é‡Šä¸º (*p).Abs()ã€‚ package mainimport (\tfmt\tmath)type Vertex struct X, Y float64func (v Vertex) Abs() float64 return math.Sqrt(v.X*v.X + v.Y*v.Y)func AbsFunc(v Vertex) float64 return math.Sqrt(v.X*v.X + v.Y*v.Y)func main() v := Vertex3, 4\tfmt.Println(v.Abs()) fmt.Println((v).Abs())\tfmt.Println(AbsFunc(v)) // fmt.Println(AbsFunc(v)) ç¼–è¯‘æŠ¥é”™\tp := Vertex4, 3\tfmt.Println(p.Abs()) fmt.Println((*p).Abs())\tfmt.Println(AbsFunc(*p)) // fmt.Println(AbsFunc(p)) ç¼–è¯‘æŠ¥é”™ é€‰æ‹©å€¼æˆ–æŒ‡é’ˆä½œä¸ºå…¥å‚ ä½¿ç”¨æŒ‡é’ˆå…¥å‚çš„åŸå› æœ‰äºŒï¼š é¦–å…ˆï¼Œæ–¹æ³•èƒ½å¤Ÿä¿®æ”¹å…¶å…¥å‚æŒ‡é’ˆæŒ‡å‘çš„å€¼ã€‚ å…¶æ¬¡ï¼Œè¿™æ ·å¯ä»¥é¿å…åœ¨æ¯æ¬¡è°ƒç”¨æ–¹æ³•æ—¶å¤åˆ¶è¯¥å€¼ã€‚è‹¥å€¼çš„ç±»å‹ä¸ºå¤§å‹ç»“æ„ä½“æ—¶ï¼Œè¿™æ ·ä¼šæ›´åŠ é«˜æ•ˆã€‚ åœ¨æœ¬ä¾‹ä¸­ï¼ŒScale å’Œ Abs å…¥å‚çš„ç±»å‹ä¸º *Vertexï¼Œå³ä¾¿ Abs å¹¶ä¸éœ€è¦ä¿®æ”¹å…¶å…¥å‚ã€‚ é€šå¸¸æ¥è¯´ï¼Œæ‰€æœ‰ç»™å®šç±»å‹çš„æ–¹æ³•éƒ½åº”è¯¥æœ‰å€¼æˆ–æŒ‡é’ˆå…¥å‚ï¼Œä½†å¹¶ä¸åº”è¯¥äºŒè€…æ··ç”¨ã€‚ package mainimport (\tfmt\tmath)type Vertex struct X, Y float64func (v *Vertex) Scale(f float64) v.X = v.X * f\tv.Y = v.Y * ffunc (v *Vertex) Abs() float64 return math.Sqrt(v.X*v.X + v.Y*v.Y)func main() v := Vertex3, 4\tfmt.Printf(ç¼©æ”¾å‰ï¼š%+vï¼Œç»å¯¹å€¼ï¼š%v , v, v.Abs())\tv.Scale(5)\tfmt.Printf(ç¼©æ”¾åï¼š%+vï¼Œç»å¯¹å€¼ï¼š%v , v, v.Abs())ç¼©æ”¾å‰ï¼šX:3 Y:4ï¼Œç»å¯¹å€¼ï¼š5ç¼©æ”¾åï¼šX:15 Y:20ï¼Œç»å¯¹å€¼ï¼š25 11. æ¥å£11.1 å®šä¹‰æ¥å£ç±»å‹ çš„å®šä¹‰ä¸ºä¸€ç»„æ–¹æ³•ç­¾åã€‚ æ¥å£å¯ä»¥è®©æˆ‘ä»¬å°†ä¸åŒçš„ç±»å‹ç»‘å®šåˆ°ä¸€ç»„å…¬å…±çš„æ–¹æ³•ä¸Šï¼Œä»è€Œå®ç°å¤šæ€å’Œçµæ´»çš„è®¾è®¡ã€‚ æ¥å£ç±»å‹çš„å˜é‡å¯ä»¥æŒæœ‰ä»»ä½•å®ç°äº†è¿™äº›æ–¹æ³•çš„å€¼ã€‚ æ³¨æ„: ç¤ºä¾‹ä»£ç  a = v å­˜åœ¨ä¸€ä¸ªé”™è¯¯ã€‚ç”±äº Abs æ–¹æ³•åªä¸º *Vertex ï¼ˆæŒ‡é’ˆç±»å‹ï¼‰å®šä¹‰ï¼Œå› æ­¤ Vertexï¼ˆå€¼ç±»å‹ï¼‰å¹¶æœªå®ç° Abserã€‚ package mainimport (\tfmt\tmath)type Abser interface Abs() float64func main() var a Abser\tf := MyFloat(-math.Sqrt2)\tv := Vertex3, 4\ta = f // MyFloatå®ç°äº† Abser\ta = v // *Vertexå®ç°äº† Abser\t// ä¸‹é¢ä¸€è¡Œï¼Œv æ˜¯ä¸€ä¸ª Vertexï¼ˆè€Œä¸æ˜¯ *Vertexï¼‰\t// æ‰€ä»¥æ²¡æœ‰å®ç° Abserã€‚\ta = v\tfmt.Println(a.Abs())type MyFloat float64func (f MyFloat) Abs() float64 if f 0 return float64(-f) return float64(f)type Vertex struct X, Y float64func (v *Vertex) Abs() float64 return math.Sqrt(v.X*v.X + v.Y*v.Y) 11.2 æ¥å£ä¸éšå¼å®ç°Go è¯­è¨€ä¸­çš„æ¥å£æ˜¯éšå¼å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªç±»å‹å®ç°äº†ä¸€ä¸ªæ¥å£å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒå°±è‡ªåŠ¨åœ°å®ç°äº†è¯¥æ¥å£ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†æ¥å£ä½œä¸ºå‚æ•°æ¥å®ç°å¯¹ä¸åŒç±»å‹çš„è°ƒç”¨ï¼Œä»è€Œå®ç°å¤šæ€ã€‚ ç±»å‹é€šè¿‡å®ç°ä¸€ä¸ªæ¥å£çš„æ‰€æœ‰æ–¹æ³•æ¥å®ç°è¯¥æ¥å£ã€‚æ—¢ç„¶æ— éœ€ä¸“é—¨æ˜¾å¼å£°æ˜ï¼Œä¹Ÿå°±æ²¡æœ‰â€œimplementsâ€å…³é”®å­—ã€‚ éšå¼æ¥å£ä»æ¥å£çš„å®ç°ä¸­è§£è€¦äº†å®šä¹‰ï¼Œè¿™æ ·æ¥å£çš„å®ç°å¯ä»¥å‡ºç°åœ¨ä»»ä½•åŒ…ä¸­ï¼Œæ— éœ€æå‰å‡†å¤‡ã€‚ å› æ­¤ï¼Œä¹Ÿå°±æ— éœ€åœ¨æ¯ä¸€ä¸ªå®ç°ä¸Šå¢åŠ æ–°çš„æ¥å£åç§°ï¼Œè¿™æ ·åŒæ—¶ä¹Ÿé¼“åŠ±äº†æ˜ç¡®çš„æ¥å£å®šä¹‰ã€‚ package mainimport ( fmt)type Phone interface call()type NokiaPhone struct func (nokiaPhone NokiaPhone) call() fmt.Println(I am Nokia, I can call you!)type IPhone struct func (iPhone IPhone) call() fmt.Println(I am iPhone, I can call you!)func main() var phone Phone phone = new(NokiaPhone) phone.call() phone = new(IPhone) phone.call() 11.3 æ¥å£å€¼æ¥å£ä¹Ÿæ˜¯å€¼ã€‚å®ƒä»¬å¯ä»¥åƒå…¶å®ƒå€¼ä¸€æ ·ä¼ é€’ã€‚ æ¥å£å€¼å¯ä»¥ç”¨ä½œå‡½æ•°çš„å‚æ•°æˆ–è¿”å›å€¼ã€‚ åœ¨å†…éƒ¨ï¼Œæ¥å£å€¼å¯ä»¥çœ‹åšåŒ…å«å€¼å’Œå…·ä½“ç±»å‹çš„å…ƒç»„ï¼š (value, type) æ¥å£å€¼ä¿å­˜äº†ä¸€ä¸ªå…·ä½“åº•å±‚ç±»å‹çš„å…·ä½“å€¼ã€‚ æ¥å£å€¼è°ƒç”¨æ–¹æ³•æ—¶ä¼šæ‰§è¡Œå…¶åº•å±‚ç±»å‹çš„åŒåæ–¹æ³•ã€‚ package mainimport (\tfmt\tmath)type I interface M()type T struct S stringfunc (t *T) M() fmt.Println(t.S)type F float64func (f F) M() fmt.Println(f)func main() var i I\ti = Thello\tdescribe(i)\ti.M()\ti = F(math.Pi)\tdescribe(i)\ti.M()func describe(i I) fmt.Printf((%v, %T) , i, i)(hello, *main.T)hello(3.141592653589793, main.F)3.141592653589793 åº•å±‚å€¼ä¸º nil çš„æ¥å£å€¼ å³ä¾¿æ¥å£å†…çš„å…·ä½“å€¼ä¸º nilï¼Œæ–¹æ³•ä»ç„¶ä¼šè¢« nil æ¥æ”¶è€…è°ƒç”¨ã€‚ åœ¨ä¸€äº›è¯­è¨€ä¸­ï¼Œè¿™ä¼šè§¦å‘ä¸€ä¸ªç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œä½†åœ¨ Go ä¸­é€šå¸¸ä¼šå†™ä¸€äº›æ–¹æ³•æ¥ä¼˜é›…åœ°å¤„ç†å®ƒï¼ˆå¦‚æœ¬ä¾‹ä¸­çš„ M æ–¹æ³•ï¼‰ã€‚ æ³¨æ„: ä¿å­˜äº† nil å…·ä½“å€¼çš„æ¥å£å…¶è‡ªèº«å¹¶ä¸ä¸º nilã€‚ package mainimport fmttype I interface M()type T struct S stringfunc (t *T) M() if t == nil fmt.Println(nil) return fmt.Println(t.S)func main() var i I\tvar t *T\ti = t\tdescribe(i) // è¿™é‡Œä¸ä¼šè§¦å‘ä¸€ä¸ªç©ºæŒ‡é’ˆå¼‚å¸¸\ti.M()\ti = Thello\tdescribe(i)\ti.M()func describe(i I) fmt.Printf((%v, %T) , i, i)(nil, *main.T)nil(hello, *main.T)hello nil æ¥å£å€¼ nil æ¥å£å€¼æ—¢ä¸ä¿å­˜å€¼ä¹Ÿä¸ä¿å­˜å…·ä½“ç±»å‹ã€‚ ä¸º nil æ¥å£è°ƒç”¨æ–¹æ³•ä¼šäº§ç”Ÿè¿è¡Œæ—¶é”™è¯¯ï¼Œå› ä¸ºæ¥å£çš„å…ƒç»„å†…å¹¶æœªåŒ…å«èƒ½å¤ŸæŒ‡æ˜è¯¥è°ƒç”¨å“ªä¸ª å…·ä½“ æ–¹æ³•çš„ç±»å‹ã€‚ package mainimport fmttype I interface M()func main() var i I\tdescribe(i) // æ²¡æœ‰æŒ‡å®šå…·ä½“ç±»å‹çš„æ–¹æ³• // (nil, nil)\t// panic: runtime error: invalid memory address or nil pointer dereference\ti.M()func describe(i I) fmt.Printf((%v, %T) , i, i) 11.4 ç©ºæ¥å£æŒ‡å®šäº†é›¶ä¸ªæ–¹æ³•çš„æ¥å£å€¼è¢«ç§°ä¸º ç©ºæ¥å£ï¼š interface ç©ºæ¥å£å¯ä¿å­˜ä»»ä½•ç±»å‹çš„å€¼ã€‚ï¼ˆå› ä¸ºæ¯ä¸ªç±»å‹éƒ½è‡³å°‘å®ç°äº†é›¶ä¸ªæ–¹æ³•ã€‚ï¼‰ ç©ºæ¥å£è¢«ç”¨æ¥å¤„ç†æœªçŸ¥ç±»å‹çš„å€¼ã€‚ä¾‹å¦‚ï¼Œfmt.Print å¯æ¥å—ç±»å‹ä¸º interface çš„ä»»æ„æ•°é‡çš„å‚æ•°ã€‚ package mainimport fmttype I interfacefunc main() var i I\tdescribe(i)\ti = 42\tdescribe(i)\ti = hello\tdescribe(i)func describe(i I) fmt.Printf((%v, %T) , i, i) 11.5 ç±»å‹æ–­è¨€ç±»å‹æ–­è¨€ æä¾›äº†è®¿é—®æ¥å£å€¼åº•å±‚å…·ä½“å€¼çš„æ–¹å¼ã€‚ t := i.(T) è¯¥è¯­å¥æ–­è¨€æ¥å£å€¼ i ä¿å­˜äº†å…·ä½“ç±»å‹ Tï¼Œå¹¶å°†å…¶åº•å±‚ç±»å‹ä¸º T çš„å€¼èµ‹äºˆå˜é‡ tã€‚ è‹¥ i å¹¶æœªä¿å­˜ T ç±»å‹çš„å€¼ï¼Œè¯¥è¯­å¥å°±ä¼šè§¦å‘ä¸€ä¸ª panicã€‚ ä¸ºäº† åˆ¤æ–­ ä¸€ä¸ªæ¥å£å€¼æ˜¯å¦ä¿å­˜äº†ä¸€ä¸ªç‰¹å®šçš„ç±»å‹ï¼Œç±»å‹æ–­è¨€å¯è¿”å›ä¸¤ä¸ªå€¼ï¼šå…¶åº•å±‚å€¼ä»¥åŠä¸€ä¸ªæŠ¥å‘Šæ–­è¨€æ˜¯å¦æˆåŠŸçš„å¸ƒå°”å€¼ã€‚ t, ok := i.(T) è‹¥ i ä¿å­˜äº†ä¸€ä¸ª Tï¼Œé‚£ä¹ˆ t å°†ä¼šæ˜¯å…¶åº•å±‚å€¼ï¼Œè€Œ ok ä¸º trueã€‚ å¦åˆ™ï¼Œok å°†ä¸º false è€Œ t å°†ä¸º T ç±»å‹çš„é›¶å€¼ï¼Œç¨‹åºå¹¶ä¸ä¼šäº§ç”Ÿ panicã€‚ è¯·æ³¨æ„è¿™ç§è¯­æ³•å’Œè¯»å–ä¸€ä¸ªæ˜ å°„æ—¶çš„ç›¸åŒä¹‹å¤„ã€‚ package mainimport fmtfunc main() var i interface = hello\ts := i.(string)\tfmt.Println(s)\ts, ok := i.(string)\tfmt.Println(ok)\tf, ok := i.(float64)\tfmt.Println(f, ok)\t// panic: interface conversion: interface is string, not float64\tf = i.(float64) // panic\tfmt.Println(f) 11.6 ç±»å‹é€‰æ‹©ç±»å‹é€‰æ‹© æ˜¯ä¸€ç§æŒ‰é¡ºåºä»å‡ ä¸ªç±»å‹æ–­è¨€ä¸­é€‰æ‹©åˆ†æ”¯çš„ç»“æ„ã€‚ ç±»å‹é€‰æ‹©ä¸ä¸€èˆ¬çš„ switch è¯­å¥ç›¸ä¼¼ï¼Œä¸è¿‡ç±»å‹é€‰æ‹©ä¸­çš„ case ä¸ºç±»å‹ï¼ˆè€Œéå€¼ï¼‰ï¼Œ å®ƒä»¬é’ˆå¯¹ç»™å®šæ¥å£å€¼æ‰€å­˜å‚¨çš„å€¼çš„ç±»å‹è¿›è¡Œæ¯”è¾ƒã€‚ switch v := i.(type) case T: // v çš„ç±»å‹ä¸º Tcase S: // v çš„ç±»å‹ä¸º Sdefault: // æ²¡æœ‰åŒ¹é…ï¼Œv ä¸ i çš„ç±»å‹ç›¸åŒ ç±»å‹é€‰æ‹©ä¸­çš„å£°æ˜ä¸ç±»å‹æ–­è¨€ i.(T) çš„è¯­æ³•ç›¸åŒï¼Œåªæ˜¯å…·ä½“ç±»å‹ T è¢«æ›¿æ¢æˆäº†å…³é”®å­— typeã€‚ æ­¤é€‰æ‹©è¯­å¥åˆ¤æ–­æ¥å£å€¼ i ä¿å­˜çš„å€¼ç±»å‹æ˜¯ T è¿˜æ˜¯ Sã€‚åœ¨ T æˆ– S çš„æƒ…å†µä¸‹ï¼Œå˜é‡ v ä¼šåˆ†åˆ«æŒ‰ T æˆ– S ç±»å‹ä¿å­˜ i æ‹¥æœ‰çš„å€¼ã€‚åœ¨é»˜è®¤ï¼ˆå³æ²¡æœ‰åŒ¹é…ï¼‰çš„æƒ…å†µä¸‹ï¼Œå˜é‡ v ä¸ i çš„æ¥å£ç±»å‹å’Œå€¼ç›¸åŒã€‚ package mainimport fmtfunc do(i interface) switch v := i.(type) case int: fmt.Printf(äºŒå€çš„ %v æ˜¯ %v , v, v*2)\tcase string: fmt.Printf(%q é•¿åº¦ä¸º %v å­—èŠ‚ , v, len(v))\tdefault: fmt.Printf(æˆ‘ä¸çŸ¥é“ç±»å‹ %T! , v)\tfunc main() do(21)\tdo(hello)\tdo(true) 11.7 è¡ç”Ÿç±»å‹åŸºæœ¬è¯­æ³•ï¼štype TypeA TypeB ä½¿ç”¨åœºæ™¯ï¼šä¾‹å¦‚ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“æ—¶ï¼Œæ²¡æœ‰åŠæ³•ä¿®æ”¹æºç ï¼Œåˆæƒ³æ‰©å±•è¿™ä¸ªåº“çš„æ–¹æ³•å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªã€‚ è¡ç”Ÿç±»å‹æ˜¯ä¸€ä¸ªå…¨æ–°çš„ç±»å‹ è¡ç”Ÿç±»å‹å¯ä»¥äº’ç›¸è½¬æ¢ () æ³¨æ„ï¼šTypeB å®ç°äº†æŸä¸ªæ¥å£ä¸ç­‰äº TypeA ä¹Ÿå®ç°äº†è¿™ä¸ªæ¥å£ type Dog struct Name stringfunc (d Dog) run() string return d.Nametype FlyDog Dogfunc main() dog := Dog\tdog.run()\tflyDog := FlyDog\t// flyDog ä¸èƒ½è°ƒç”¨ Dog ä¸Šçš„æ–¹æ³•ï¼Œå› ä¸º flyDog æ˜¯ä¸€ä¸ªå…¨æ–°çš„ç±»å‹\t//flyDog.run()\tflyDog2 := Dog(flyDog)\tflyDog2.run() 11.8 ç±»å‹åˆ«ååŸºç¡€è¯­æ³•ï¼štype TypeA = TypeB åˆ¥åï¼Œé™¤äº†æ¢äº†ä¸€ä¸ªåå­—ï¼Œæ²¡æœ‰ä»»ä½•åŒºåˆ« ä»–å’Œè¡ç”Ÿç±»å‹çš„åŒºåˆ«å°±æ˜¯ç”¨äº† = ç±»å‹åˆ«åä¸€èˆ¬ç”¨åœ¨å¯¼å‡ºç±»å‹ã€å…¼å®¹æ€§ä¿®æ”¹é‡Œ 11.9 ç»„åˆç»„åˆæ˜¯ Go ä¸­ç‹¬æœ‰çš„è¯­æ³•æ¦‚å¿µã€‚åŸºæœ¬è¯­æ³•å½¢æ€æ˜¯ï¼š type A struct B ç»„åˆå¯ä»¥æ˜¯ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š æ¥å£ç»„åˆæ¥å£ ç»“æ„ä½“ç»„åˆç»“æ„ä½“ ç»“æ„ä½“ç»„åˆç»“æ„ä½“æŒ‡é’ˆ ç»“æ„ä½“ç»„åˆæ¥å£ éƒ½å¯ä»¥ç»„åˆå¤šä¸ªã€‚ ç‰¹æ€§ å½“ A ç»„åˆ B ä¹‹å å¯ä»¥ç›´æ¥åœ¨ A ä¸Šè°ƒç”¨ B çš„æ–¹æ³•ã€‚ B å®ç°çš„æ‰€æœ‰æ¥å£ï¼Œéƒ½è®¤ä¸º A å·²ç»å®ç°äº†ã€‚ A ç»„åˆ B ä¹‹åï¼Œåœ¨åˆå§‹åŒ– A çš„æ—¶å€™å°† B çœ‹ä½œæ™®é€šå­—æ®µæ¥åˆå§‹åŒ– ç»„åˆä¸æ˜¯ç»§æ‰¿ï¼Œæ²¡æœ‰å¤šæ€ 12. é”™è¯¯Go ç¨‹åºä½¿ç”¨ error å€¼æ¥è¡¨ç¤ºé”™è¯¯çŠ¶æ€ã€‚ error ç±»å‹æ˜¯ä¸€ä¸ªå†…ç½®çš„æ¥å£ï¼š type error interface Error() string ï¼ˆä¸ fmt.Stringer ç±»ä¼¼ï¼Œfmt åŒ…ä¹Ÿä¼šæ ¹æ®å¯¹ error çš„å®ç°æ¥æ‰“å°å€¼ã€‚ï¼‰ é€šå¸¸å‡½æ•°ä¼šè¿”å›ä¸€ä¸ª error å€¼ï¼Œè°ƒç”¨å®ƒçš„ä»£ç åº”å½“åˆ¤æ–­è¿™ä¸ªé”™è¯¯æ˜¯å¦ç­‰äº nil æ¥è¿›è¡Œé”™è¯¯å¤„ç†ã€‚ i, err := strconv.Atoi(42)if err != nil fmt.Printf(couldnt convert number: %v , err) returnfmt.Println(Converted integer:, i) error ä¸º nil æ—¶è¡¨ç¤ºæˆåŠŸï¼›é nil çš„ error è¡¨ç¤ºå¤±è´¥ã€‚ package mainimport (\tfmt\tmath\ttime)type MyError struct When time.Time\tWhat string// å®ç°erroræ¥å£çš„Error()æ–¹æ³•func (e MyError) Error() string return fmt.Sprintf(at %v, %s, e.When, e.What)func Sqrt(f float64) (float64, error) if f 0 return 0, MyError time.Now(), square root of negative number, return math.Abs(f), nilfunc main() fmt.Println(Sqrt(1))\t_, err := Sqrt(-1)\tif err != nil fmt.Println(err)\t1 nilat 2024-08-07 15:35:34.2402027 +0800 CST m=+0.001527601, square root of negative number 12. Panic å¼‚å¸¸Go çš„ç±»å‹ç³»ç»Ÿä¼šåœ¨ç¼–è¯‘æ—¶æ•è·å¾ˆå¤šé”™è¯¯ï¼Œä½†æœ‰äº›é”™è¯¯åªèƒ½åœ¨è¿è¡Œæ—¶æ£€æŸ¥ï¼Œå¦‚æ•°ç»„è®¿é—®è¶Šç•Œã€ç©ºæŒ‡é’ˆå¼•ç”¨ç­‰ã€‚è¿™äº›è¿è¡Œæ—¶é”™è¯¯ä¼šå¼•èµ· painc å¼‚å¸¸ã€‚ ä¸€èˆ¬è€Œè¨€ï¼Œå½“ panic å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œç¨‹åºä¼šä¸­æ–­è¿è¡Œï¼Œå¹¶ç«‹å³æ‰§è¡Œåœ¨è¯¥ goroutine ä¸­è¢«å»¶è¿Ÿçš„å‡½æ•°ï¼ˆdefer æœºåˆ¶ï¼‰ã€‚éšåï¼Œç¨‹åºå´©æºƒå¹¶è¾“å‡ºæ—¥å¿—ä¿¡æ¯ã€‚æ—¥å¿—ä¿¡æ¯åŒ…æ‹¬ panic value å’Œå‡½æ•°è°ƒç”¨çš„å †æ ˆè·Ÿè¸ªä¿¡æ¯ã€‚panic value é€šå¸¸æ˜¯æŸç§é”™è¯¯ä¿¡æ¯ã€‚å¯¹äºæ¯ä¸ª goroutineï¼Œæ—¥å¿—ä¿¡æ¯ä¸­éƒ½ä¼šæœ‰ä¸ä¹‹ç›¸å¯¹çš„ï¼Œå‘ç”Ÿ panic æ—¶çš„å‡½æ•°è°ƒç”¨å †æ ˆè·Ÿè¸ªä¿¡æ¯ã€‚ switch s := suit(drawCard()); s case Spades: // ... case Hearts: // ... case Diamonds: // ... case Clubs: // ... default: panic(fmt.Sprintf(invalid suit %q, s)) // Joker? 12. Recover r æ•è·å¼‚å¸¸é€šå¸¸æ¥è¯´ï¼Œä¸åº”è¯¥å¯¹ panic å¼‚å¸¸åšä»»ä½•å¤„ç†ï¼Œä½†æœ‰æ—¶ï¼Œä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥ä»å¼‚å¸¸ä¸­æ¢å¤ï¼Œè‡³å°‘æˆ‘ä»¬å¯ä»¥åœ¨ç¨‹åºå´©æºƒå‰ï¼Œåšä¸€äº›æ“ä½œã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå½“ web æœåŠ¡å™¨é‡åˆ°ä¸å¯é¢„æ–™çš„ä¸¥é‡é—®é¢˜æ—¶ï¼Œåœ¨å´©æºƒå‰åº”è¯¥å°†æ‰€æœ‰çš„è¿æ¥å…³é—­ï¼›å¦‚æœä¸åšä»»ä½•å¤„ç†ï¼Œä¼šä½¿å¾—å®¢æˆ·ç«¯ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ã€‚å¦‚æœ web æœåŠ¡å™¨è¿˜åœ¨å¼€å‘é˜¶æ®µï¼ŒæœåŠ¡å™¨ç”šè‡³å¯ä»¥å°†å¼‚å¸¸ä¿¡æ¯åé¦ˆåˆ°å®¢æˆ·ç«¯ï¼Œå¸®åŠ©è°ƒè¯•ã€‚ å¦‚æœåœ¨ deferred å‡½æ•°ä¸­è°ƒç”¨äº†å†…ç½®å‡½æ•° recoverï¼Œå¹¶ä¸”å®šä¹‰è¯¥ defer è¯­å¥çš„å‡½æ•°å‘ç”Ÿäº† panic å¼‚å¸¸ï¼Œrecover ä¼šä½¿ç¨‹åºä» panic ä¸­æ¢å¤ï¼Œå¹¶è¿”å› panic valueã€‚å¯¼è‡´ panic å¼‚å¸¸çš„å‡½æ•°ä¸ä¼šç»§ç»­è¿è¡Œï¼Œä½†èƒ½æ­£å¸¸è¿”å›ã€‚åœ¨æœªå‘ç”Ÿ panic æ—¶è°ƒç”¨ recoverï¼Œrecover ä¼šè¿”å› nilã€‚ è®©æˆ‘ä»¬ä»¥è¯­è¨€è§£æå™¨ä¸ºä¾‹ï¼Œè¯´æ˜ recover çš„ä½¿ç”¨åœºæ™¯ã€‚è€ƒè™‘åˆ°è¯­è¨€è§£æå™¨çš„å¤æ‚æ€§ï¼Œå³ä½¿æŸä¸ªè¯­è¨€è§£æå™¨ç›®å‰å·¥ä½œæ­£å¸¸ï¼Œä¹Ÿæ— æ³•è‚¯å®šå®ƒæ²¡æœ‰æ¼æ´ã€‚å› æ­¤ï¼Œå½“æŸä¸ªå¼‚å¸¸å‡ºç°æ—¶ï¼Œæˆ‘ä»¬ä¸ä¼šé€‰æ‹©è®©è§£æå™¨å´©æºƒï¼Œè€Œæ˜¯ä¼šå°† panic å¼‚å¸¸å½“ä½œæ™®é€šçš„è§£æé”™è¯¯ï¼Œå¹¶é™„åŠ é¢å¤–ä¿¡æ¯æé†’ç”¨æˆ·æŠ¥å‘Šæ­¤é”™è¯¯ã€‚ func Parse(input string) (s *Syntax, err error) defer func() if p := recover(); p != nil err = fmt.Errorf(internal error: %v, p) () // ...parser... ä¸åŠ åŒºåˆ†çš„æ¢å¤æ‰€æœ‰çš„ panic å¼‚å¸¸ï¼Œä¸æ˜¯å¯å–çš„åšæ³•ï¼›å®‰å…¨çš„åšæ³•æ˜¯æœ‰é€‰æ‹©æ€§çš„ recoverã€‚æ¢å¥è¯è¯´ï¼Œåªæ¢å¤åº”è¯¥è¢«æ¢å¤çš„ panic å¼‚å¸¸ï¼Œæ­¤å¤–ï¼Œè¿™äº›å¼‚å¸¸æ‰€å çš„æ¯”ä¾‹åº”è¯¥å°½å¯èƒ½çš„ä½ã€‚ä¸ºäº†æ ‡è¯†æŸä¸ª panic æ˜¯å¦åº”è¯¥è¢«æ¢å¤ï¼Œæˆ‘ä»¬å¯ä»¥å°† panic value è®¾ç½®æˆç‰¹æ®Šç±»å‹ã€‚åœ¨ recover æ—¶å¯¹ panic value è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœå‘ç° panic value æ˜¯ç‰¹æ®Šç±»å‹ï¼Œå°±å°†è¿™ä¸ª panic ä½œä¸º errror å¤„ç†ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™æŒ‰ç…§æ­£å¸¸çš„ panic è¿›è¡Œå¤„ç†ã€‚ 13. æ³›å‹13.1 ç±»å‹å‚æ•°å¯ä»¥ä½¿ç”¨ç±»å‹å‚æ•°ç¼–å†™ Go å‡½æ•°æ¥å¤„ç†å¤šç§ç±»å‹ã€‚ æ³›å‹æ¥å£ type List[T any] interface æ³›å‹ç»“æ„ä½“ type ArrayList[T any] struct æ³›å‹å‡½æ•° func Index[T comparable](s []T, x T) int æ­¤å£°æ˜æ„å‘³ç€ s æ˜¯æ»¡è¶³å†…ç½®çº¦æŸ comparable çš„ä»»ä½•ç±»å‹ T çš„åˆ‡ç‰‡ã€‚ x ä¹Ÿæ˜¯ç›¸åŒç±»å‹çš„å€¼ã€‚ comparable æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„çº¦æŸï¼Œå®ƒèƒ½è®©æˆ‘ä»¬å¯¹ä»»æ„æ»¡è¶³è¯¥ç±»å‹çš„å€¼ä½¿ç”¨ == å’Œ != è¿ç®—ç¬¦ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒå°†å€¼ä¸æ‰€æœ‰åˆ‡ç‰‡å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œç›´åˆ°æ‰¾åˆ°åŒ¹é…é¡¹ã€‚ è¯¥ Index å‡½æ•°é€‚ç”¨äºä»»ä½•æ”¯æŒæ¯”è¾ƒçš„ç±»å‹ã€‚ package mainimport fmt// Index è¿”å› x åœ¨ s ä¸­çš„ä¸‹æ ‡ï¼Œæœªæ‰¾åˆ°åˆ™è¿”å› -1ã€‚func Index[T comparable](s []T, x T) int for i, v := range s // v å’Œ x çš„ç±»å‹ä¸º Tï¼Œå®ƒæ‹¥æœ‰ comparable å¯æ¯”è¾ƒçš„çº¦æŸï¼Œ // å› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ==ã€‚ if v == x return i return -1func Index2[T int](s []T, x T) int for i, v := range s // v å’Œ x çš„ç±»å‹ä¸º Tï¼Œå®ƒæ‹¥æœ‰ comparable å¯æ¯”è¾ƒçš„çº¦æŸï¼Œ // å› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ==ã€‚ if v == x return i return -1func main() // Index å¯ä»¥åœ¨æ•´æ•°åˆ‡ç‰‡ä¸Šä½¿ç”¨\tsi := []int10, 20, 15, -10\tfmt.Println(Index(si, 15)) si2 := []int10, 20, 15, -10 // Index2çš„å‚æ•°çº¦æŸä¸ºintï¼Œæ­¤æ—¶å¦‚æœä¼ å…¥stringç±»å‹ç¼–è¯‘ä¼šæŠ¥é”™ fmt.Println(Index2(si2, 15))\t// Index ä¹Ÿå¯ä»¥åœ¨å­—ç¬¦ä¸²åˆ‡ç‰‡ä¸Šä½¿ç”¨\tss := []stringfoo, bar, baz\tfmt.Println(Index(ss, hello)) 13.2 æ³›å‹çº¦æŸfunc Sum[T any](vals ...T) T var res T\tfor _, val := range vals // anyç±»å‹ä¸æ”¯æŒ + è¿ç®—ï¼Œéœ€è¦é™å®šæ³›å‹ç±»å‹ res += val return res func Sum[T Number](vals ...T) T var res T\tfor _, val := range vals res += val return restype Number interface // æ³¢æµªçº¿æ˜¯æ”¯æŒè¡ç”Ÿç±»å‹\t~int | float64type Integer intfunc main() println(Sum[int](1, 2, 3))\tprintln(Sum[float64](1.1, 2, 3))\tprintln(Sum[Integer](1, 2, 3)) 14. å¹¶å‘14.1 Go åç¨‹Go ç¨‹ï¼ˆgoroutineï¼‰æ˜¯ç”± Go è¿è¡Œæ—¶ç®¡ç†çš„è½»é‡çº§çº¿ç¨‹ã€‚ go f(x, y, z) ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„ Go åç¨‹å¹¶æ‰§è¡Œ f å‡½æ•° f(x, y, z) f, x, y å’Œ z çš„æ±‚å€¼å‘ç”Ÿåœ¨å½“å‰çš„ Go åç¨‹ä¸­ï¼Œè€Œ f çš„æ‰§è¡Œå‘ç”Ÿåœ¨æ–°çš„ Go åç¨‹ä¸­ã€‚ Go ç¨‹åœ¨ç›¸åŒçš„åœ°å€ç©ºé—´ä¸­è¿è¡Œï¼Œå› æ­¤åœ¨è®¿é—®å…±äº«çš„å†…å­˜æ—¶å¿…é¡»è¿›è¡ŒåŒæ­¥ã€‚sync åŒ…æä¾›äº†è¿™ç§èƒ½åŠ›ï¼Œä¸è¿‡åœ¨ Go ä¸­å¹¶ä¸ç»å¸¸ç”¨åˆ°ï¼Œå› ä¸ºè¿˜æœ‰å…¶å®ƒçš„åŠæ³•ã€‚ package mainimport (\tfmt\ttime)func say(s string) for i := 0; i 5; i++ time.Sleep(100 * time.Millisecond) fmt.Println(s)\tfunc main() go say(world)\tsay(hello) 14.2 ä¿¡é“ä¿¡é“æ˜¯å¸¦æœ‰ç±»å‹çš„ç®¡é“ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒç”¨ä¿¡é“æ“ä½œç¬¦ - æ¥å‘é€æˆ–è€…æ¥æ”¶å€¼ã€‚ ch - v // å°† v å‘é€è‡³ä¿¡é“ chã€‚v := -ch // ä» ch æ¥æ”¶å€¼å¹¶èµ‹äºˆ vã€‚ ï¼ˆâ€œç®­å¤´â€å°±æ˜¯æ•°æ®æµçš„æ–¹å‘ã€‚ï¼‰ å’Œæ˜ å°„ä¸åˆ‡ç‰‡ä¸€æ ·ï¼Œä¿¡é“åœ¨ä½¿ç”¨å‰å¿…é¡»åˆ›å»ºï¼š ch := make(chan int) é»˜è®¤æƒ…å†µä¸‹ï¼Œå‘é€å’Œæ¥æ”¶æ“ä½œåœ¨å¦ä¸€ç«¯å‡†å¤‡å¥½ä¹‹å‰éƒ½ä¼šé˜»å¡ã€‚è¿™ä½¿å¾— Go ç¨‹å¯ä»¥åœ¨æ²¡æœ‰æ˜¾å¼çš„é”æˆ–ç«æ€å˜é‡çš„æƒ…å†µä¸‹è¿›è¡ŒåŒæ­¥ã€‚ ä»¥ä¸‹ç¤ºä¾‹å¯¹åˆ‡ç‰‡ä¸­çš„æ•°è¿›è¡Œæ±‚å’Œï¼Œå°†ä»»åŠ¡åˆ†é…ç»™ä¸¤ä¸ª Go ç¨‹ã€‚ä¸€æ—¦ä¸¤ä¸ª Go ç¨‹å®Œæˆäº†å®ƒä»¬çš„è®¡ç®—ï¼Œå®ƒå°±èƒ½ç®—å‡ºæœ€ç»ˆçš„ç»“æœã€‚ package mainimport fmtfunc sum(s []int, c chan int) sum := 0\tfor _, v := range s sum += v c - sum // å‘é€ sum åˆ° cfunc main() s := []int7, 2, 8, -9, 4, 0\tc := make(chan int)\tgo sum(s[:len(s)/2], c)\tgo sum(s[len(s)/2:], c)\tx, y := -c, -c // ä» c æ¥æ”¶\tfmt.Println(x, y, x+y) å¸¦ç¼“å†²çš„ä¿¡é“ ä¿¡é“å¯ä»¥æ˜¯ å¸¦ç¼“å†²çš„ã€‚å°†ç¼“å†²é•¿åº¦ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°æä¾›ç»™ make æ¥åˆå§‹åŒ–ä¸€ä¸ªå¸¦ç¼“å†²çš„ä¿¡é“ï¼š ch := make(chan int, 100) ä»…å½“ä¿¡é“çš„ç¼“å†²åŒºå¡«æ»¡åï¼Œå‘å…¶å‘é€æ•°æ®æ—¶æ‰ä¼šé˜»å¡ã€‚å½“ç¼“å†²åŒºä¸ºç©ºæ—¶ï¼Œæ¥å—æ–¹ä¼šé˜»å¡ã€‚ package mainimport fmtfunc main() ch := make(chan int, 2)\tch - 1\tch - 2 // ç¼“å†²åŒºæ»¡åå†å†™ä¼šæŠ¥ä¸‹åˆ—é”™è¯¯ // fatal error: all goroutines are asleep - deadlock! // ch - 3\tfmt.Println(-ch)\tfmt.Println(-ch) ä¿¡é“å…³é—­ å‘é€è€…å¯é€šè¿‡ close å…³é—­ä¸€ä¸ªä¿¡é“æ¥è¡¨ç¤ºæ²¡æœ‰éœ€è¦å‘é€çš„å€¼äº†ã€‚æ¥æ”¶è€…å¯ä»¥é€šè¿‡ä¸ºæ¥æ”¶è¡¨è¾¾å¼åˆ†é…ç¬¬äºŒä¸ªå‚æ•°æ¥æµ‹è¯•ä¿¡é“æ˜¯å¦è¢«å…³é—­ï¼šè‹¥æ²¡æœ‰å€¼å¯ä»¥æ¥æ”¶ä¸”ä¿¡é“å·²è¢«å…³é—­ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œå®Œ v, ok := -ch æ­¤æ—¶ ok ä¼šè¢«è®¾ç½®ä¸º falseã€‚ å¾ªç¯ for i := range c ä¼šä¸æ–­ä»ä¿¡é“æ¥æ”¶å€¼ï¼Œç›´åˆ°å®ƒè¢«å…³é—­ã€‚ æ³¨æ„ï¼š åªåº”ç”±å‘é€è€…å…³é—­ä¿¡é“ï¼Œè€Œä¸åº”æ²¹æ¥æ”¶è€…å…³é—­ã€‚å‘ä¸€ä¸ªå·²ç»å…³é—­çš„ä¿¡é“å‘é€æ•°æ®ä¼šå¼•å‘ç¨‹åº panicã€‚ è¿˜è¦æ³¨æ„ï¼š ä¿¡é“ä¸æ–‡ä»¶ä¸åŒï¼Œé€šå¸¸æƒ…å†µä¸‹æ— éœ€å…³é—­å®ƒä»¬ã€‚åªæœ‰åœ¨å¿…é¡»å‘Šè¯‰æ¥æ”¶è€…ä¸å†æœ‰éœ€è¦å‘é€çš„å€¼æ—¶æ‰æœ‰å¿…è¦å…³é—­ï¼Œä¾‹å¦‚ç»ˆæ­¢ä¸€ä¸ª range å¾ªç¯ã€‚ package mainimport (\tfmt)func fibonacci(n int, c chan int) x, y := 0, 1\tfor i := 0; i n; i++ c - x x, y = y, x+y close(c)func main() c := make(chan int, 10)\tgo fibonacci(cap(c), c)\tfor i := range c fmt.Println(i) 14.3 select è¯­å¥select è¯­å¥ä½¿ä¸€ä¸ª Go ç¨‹å¯ä»¥ç­‰å¾…å¤šä¸ªé€šä¿¡æ“ä½œã€‚ select ä¼šé˜»å¡åˆ°æŸä¸ªåˆ†æ”¯å¯ä»¥ç»§ç»­æ‰§è¡Œä¸ºæ­¢ï¼Œè¿™æ—¶å°±ä¼šæ‰§è¡Œè¯¥åˆ†æ”¯ã€‚å½“å¤šä¸ªåˆ†æ”¯éƒ½å‡†å¤‡å¥½æ—¶ä¼šéšæœºé€‰æ‹©ä¸€ä¸ªæ‰§è¡Œã€‚ package mainimport fmtfunc fibonacci(c, quit chan int) x, y := 0, 1\tfor select // å°†å½“å‰çš„xå€¼å‘é€åˆ°é€šé“cï¼Œç„¶åè®¡ç®—ä¸‹ä¸€ä¸ªFibonacciæ•°åˆ—çš„å€¼ï¼ˆx, y = y, x+yï¼‰ case c - x: x, y = y, x+y // ä»é€šé“quitæ¥æ”¶å€¼ï¼Œå½“æ¥æ”¶åˆ°å€¼æ—¶ï¼Œæ‰“å°quitå¹¶è¿”å›ï¼Œç»“æŸå‡½æ•°æ‰§è¡Œ case -quit: fmt.Println(quit) return func main() c := make(chan int)\tquit := make(chan int) // å¯åŠ¨ä¸€ä¸ªæ–°çš„goroutineï¼Œåœ¨è¿™ä¸ªgoroutineä¸­ï¼Œä»é€šé“cæ¥æ”¶å¹¶æ‰“å°10ä¸ªFibonacciæ•°åˆ—çš„å€¼ï¼Œç„¶åå‘quité€šé“å‘é€ä¸€ä¸ªå€¼ã€‚\tgo func() for i := 0; i 10; i++ fmt.Println(-c) quit - 0\t()\tfibonacci(c, quit) default åˆ†æ”¯ å½“ select ä¸­çš„å…¶å®ƒåˆ†æ”¯éƒ½æ²¡æœ‰å‡†å¤‡å¥½æ—¶ï¼Œdefault åˆ†æ”¯å°±ä¼šæ‰§è¡Œã€‚ ä¸ºäº†åœ¨å°è¯•å‘é€æˆ–è€…æ¥æ”¶æ—¶ä¸å‘ç”Ÿé˜»å¡ï¼Œå¯ä½¿ç”¨ default åˆ†æ”¯ï¼š select case i := -c: // ä½¿ç”¨ idefault: // ä» c ä¸­æ¥æ”¶ä¼šé˜»å¡æ—¶æ‰§è¡Œ package mainimport (\tfmt\ttime)func main() tick := time.Tick(2000 * time.Millisecond)\tboom := time.After(5000 * time.Millisecond)\tfor select case -tick: fmt.Println(tick.) case -boom: fmt.Println(boom) return default: fmt.Println( .) time.Sleep(1000 * time.Millisecond) . .tick. . .tick. .boom","tags":[null],"categories":[null]},{"title":"Go","path":"/wiki/Go/ç”¨Goæ­å»ºWebæœåŠ¡å™¨.html","content":"1. å®‰è£…https://go.dev/dl/ ä¸‹è½½å®‰è£…ç‰ˆçš„ï¼Œç›´æ¥å®‰è£… å®‰è£…å®Œæˆåå¯ä»¥è¾“å…¥go versionæŸ¥çœ‹å®‰è£…ç‰ˆæœ¬ï¼Œè¾“å‡ºå¯¹åº”ç‰ˆæœ¬è¡¨ç¤ºå®‰è£…æˆåŠŸã€‚ 3. åŸºç¡€è¯­æ³•3.1 åŒ…æ¯ä¸ª Go ç¨‹åºéƒ½ç”±åŒ…æ„æˆã€‚ç¨‹åºä» main åŒ…å¼€å§‹è¿è¡Œã€‚æœ¬ç¨‹åºé€šè¿‡å¯¼å…¥è·¯å¾„ fmt å’Œ math/rand æ¥ä½¿ç”¨è¿™ä¸¤ä¸ªåŒ…ã€‚æŒ‰ç…§çº¦å®šï¼ŒåŒ…åä¸å¯¼å…¥è·¯å¾„çš„æœ€åä¸€ä¸ªå…ƒç´ ä¸€è‡´ã€‚ä¾‹å¦‚ï¼Œmath/rand åŒ…ä¸­çš„æºç å‡ä»¥ package rand è¯­å¥å¼€å§‹ã€‚ package mainimport (\tfmt\tmath/rand)func main() fmt.Println(Hello World!) go run . 3.2 å¯¼å…¥ä»£ç ç”¨åœ†æ‹¬å·å°†å¯¼å…¥çš„åŒ…åˆ†æˆä¸€ç»„ï¼Œè¿™æ˜¯â€œåˆ†ç»„â€å½¢å¼çš„å¯¼å…¥è¯­å¥ã€‚ å½“ç„¶ä¹Ÿå¯ä»¥ç¼–å†™å¤šä¸ªå¯¼å…¥è¯­å¥ï¼Œä¾‹å¦‚ï¼š import fmtimport math ä¸è¿‡ä½¿ç”¨åˆ†ç»„å¯¼å…¥è¯­å¥è¦æ›´å¥½ã€‚ import (\tfmt\tmath) 3.3 å¯¼å‡ºååœ¨ Go ä¸­ï¼Œå¦‚æœä¸€ä¸ªåå­—ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯å·²å¯¼å‡ºçš„ã€‚ä¾‹å¦‚ï¼ŒmathåŒ…ä¸­Piã€‚ pi å¹¶æœªä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œæ‰€ä»¥æ˜¯æœªå¯¼å‡ºçš„ã€‚ åœ¨å¯¼å…¥ä¸€ä¸ªåŒ…æ—¶ï¼Œåªèƒ½å¼•ç”¨å…¶ä¸­å·²å¯¼å‡ºçš„åå­—ã€‚ ä»»ä½•ã€Œæœªå¯¼å‡ºã€çš„åå­—åœ¨è¯¥åŒ…å¤–å‡æ— æ³•è®¿é—®ã€‚ package mainimport (\tfmt\tmath)func main() fmt.Println(math.Pi) 3.4 å‡½æ•°å‡½æ•°å¯æ¥å—é›¶ä¸ªæˆ–å¤šä¸ªå‚æ•°ã€‚ åœ¨æœ¬ä¾‹ä¸­ï¼Œadd æ¥å—ä¸¤ä¸ª int ç±»å‹çš„å‚æ•°ã€‚ æ³¨æ„ç±»å‹åœ¨å˜é‡åçš„ åé¢ã€‚ï¼ˆå‚è€ƒè¿™ç¯‡å…³äº Go å£°æ˜è¯­æ³• çš„æ–‡ç« ï¼Œäº†è§£ä¸ºä½•ä½¿ç”¨è¿™ç§ç±»å‹å£°æ˜çš„å½¢å¼ã€‚ï¼‰ package mainimport fmtfunc add(x int, y int) int return x + yfunc main() fmt.Println(add(1, 2)) å½“ä¸¤ä¸ªæˆ–å¤šä¸ªå‚æ•°ç±»å‹é‡å¤æ—¶å¯ä»¥åœ¨æœ€åç”³æ˜ç±»å‹ func add(x, y int) int return x + y å‡½æ•°å¯ä»¥è¿”å›ä»»æ„æ•°é‡çš„è¿”å›å€¼ã€‚ package mainimport fmtfunc swap(x, y string) (string, string) return y, xfunc main() a, b := swap(hello, world)\tfmt.Println(a, b) å‡½æ•°ä¸­çš„è¿”å›å€¼å¯ä»¥è¢«å‘½åï¼Œå¯ä»¥è¢«è§†ä¸ºå®šä¹‰åœ¨å‡½æ•°é¡¶éƒ¨çš„å˜é‡ã€‚ è¿™äº›å˜é‡åç§°åº”è¯¥æ ‡è¯†è¿”å›å€¼çš„å«ä¹‰ã€‚ ä¸å¸¦å‚æ•°çš„ return è¯­å¥è¿”å›æŒ‡å®šçš„è¿”å›å€¼ã€‚è¿™å°±æ˜¯æ‰€è°“çš„â€œè£¸â€è¿”å›ã€‚ è£¸è¿”å›åªå»ºè®®åœ¨è¾ƒçŸ­çš„å‡½æ•°ä¸­ä½¿ç”¨ã€‚ package mainimport fmtfunc split(sum int) (x, y int) x = sum * 4 / 9\ty = sum - x\treturnfunc main() fmt.Println(split(17)) 3.5 varvar è¯­å¥å£°æ˜ä¸€ä¸ªå˜é‡åˆ—è¡¨; ä¸å‡½æ•°å‚æ•°åˆ—è¡¨ä¸€æ ·ï¼Œç±»å‹æ”¾åé¢ã€‚ package mainimport fmtvar c, python, java boolfunc main() var i int\tfmt.Println(i, c, python, java) varå¯ä»¥æ”¾åœ¨åŒ…çº§åˆ«æˆ–è€…å‡½æ•°çº§åˆ«ã€‚ varç±»å‹å®šä¹‰å˜é‡å¯ä»¥è®¾å®šåˆå§‹å€¼ï¼Œå¦‚æœè®¾å®šäº†åˆå§‹å€¼å¯ä»¥çœç•¥å˜é‡ç±»å‹ã€‚å˜é‡å°†é‡‡ç”¨åˆå§‹å€¼è®¾å®šçš„ç±»å‹ã€‚ package mainimport fmtvar i, j int = 1, 2func main() var c, python, java = true, false, no\tfmt.Println(i, j, c, python, java) åœ¨å‡½æ•°å†…éƒ¨ï¼Œå¯ä»¥ä½¿ç”¨: = short èµ‹å€¼è¯­å¥ä»£æ›¿éšå¼ç±»å‹çš„ var å£°æ˜ã€‚ åœ¨å‡½æ•°ä¹‹å¤–ï¼Œæ¯ä¸ªè¯­å¥éƒ½ä»¥å…³é”®å­—(varã€ func ç­‰)å¼€å¤´ï¼Œå› æ­¤: ç»“æ„ä¸å¯ç”¨ã€‚ package mainimport fmtfunc main() var i, j int = 1, 2\tk := 3\tc, python, java := true, false, no!\tfmt.Println(i, j, k, c, python, java) 3.6 åŸºæœ¬å˜é‡Go è¯­è¨€æŒ‰ç±»åˆ«æœ‰ä»¥ä¸‹å‡ ç§æ•°æ®ç±»å‹ï¼š åºå· ç±»å‹å’Œæè¿° 1 å¸ƒå°”å‹ å¸ƒå°”å‹çš„å€¼åªå¯ä»¥æ˜¯å¸¸é‡ true æˆ–è€… falseã€‚ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼švar b bool trueã€‚ 2 æ•°å­—ç±»å‹ æ•´å‹ int å’Œæµ®ç‚¹å‹ float32ã€float64ï¼ŒGo è¯­è¨€æ”¯æŒæ•´å‹å’Œæµ®ç‚¹å‹æ•°å­—ï¼Œå¹¶ä¸”æ”¯æŒå¤æ•°ï¼Œå…¶ä¸­ä½çš„è¿ç®—é‡‡ç”¨è¡¥ç ã€‚ 3 å­—ç¬¦ä¸²ç±»å‹: å­—ç¬¦ä¸²å°±æ˜¯ä¸€ä¸²å›ºå®šé•¿åº¦çš„å­—ç¬¦è¿æ¥èµ·æ¥çš„å­—ç¬¦åºåˆ—ã€‚Go çš„å­—ç¬¦ä¸²æ˜¯ç”±å•ä¸ªå­—èŠ‚è¿æ¥èµ·æ¥çš„ã€‚Go è¯­è¨€çš„å­—ç¬¦ä¸²çš„å­—èŠ‚ä½¿ç”¨ UTF-8 ç¼–ç æ ‡è¯† Unicode æ–‡æœ¬ã€‚ 4 æ´¾ç”Ÿç±»å‹: åŒ…æ‹¬ï¼š(a) æŒ‡é’ˆç±»å‹ï¼ˆPointerï¼‰(b) æ•°ç»„ç±»å‹(c) ç»“æ„åŒ–ç±»å‹(struct)(d) Channel ç±»å‹(e) å‡½æ•°ç±»å‹(f) åˆ‡ç‰‡ç±»å‹(g) æ¥å£ç±»å‹ï¼ˆinterfaceï¼‰(h) Map ç±»å‹ æ•°å­—ç±»å‹Go ä¹Ÿæœ‰åŸºäºæ¶æ„çš„ç±»å‹ï¼Œä¾‹å¦‚ï¼šintã€uint å’Œ uintptrã€‚ åºå· ç±»å‹å’Œæè¿° 1 uint8 æ— ç¬¦å· 8 ä½æ•´å‹ (0 åˆ° 255) 2 uint16 æ— ç¬¦å· 16 ä½æ•´å‹ (0 åˆ° 65535) 3 uint32 æ— ç¬¦å· 32 ä½æ•´å‹ (0 åˆ° 4294967295) 4 uint64 æ— ç¬¦å· 64 ä½æ•´å‹ (0 åˆ° 18446744073709551615) 5 int8 æœ‰ç¬¦å· 8 ä½æ•´å‹ (-128 åˆ° 127) 6 int16 æœ‰ç¬¦å· 16 ä½æ•´å‹ (-32768 åˆ° 32767) 7 int32 æœ‰ç¬¦å· 32 ä½æ•´å‹ (-2147483648 åˆ° 2147483647) 8 int64 æœ‰ç¬¦å· 64 ä½æ•´å‹ (-9223372036854775808 åˆ° 9223372036854775807) æµ®ç‚¹å‹ åºå· ç±»å‹å’Œæè¿° 1 float32 IEEE-754 32ä½æµ®ç‚¹å‹æ•° 2 float64 IEEE-754 64ä½æµ®ç‚¹å‹æ•° 3 complex64 32 ä½å®æ•°å’Œè™šæ•° 4 complex128 64 ä½å®æ•°å’Œè™šæ•° å…¶ä»–æ•°å­—ç±»å‹ä»¥ä¸‹åˆ—å‡ºäº†å…¶ä»–æ›´å¤šçš„æ•°å­—ç±»å‹ï¼š åºå· ç±»å‹å’Œæè¿° 1 byte ç±»ä¼¼ uint8 2 rune ç±»ä¼¼ int32 3 uint 32 æˆ– 64 ä½ 4 int ä¸ uint ä¸€æ ·å¤§å° 5 uintptr æ— ç¬¦å·æ•´å‹ï¼Œç”¨äºå­˜æ”¾ä¸€ä¸ªæŒ‡é’ˆ é›¶å€¼æ²¡æœ‰æ˜¾å¼åˆå§‹å€¼çš„å˜é‡å£°æ˜ç»™å‡ºäº†å®ƒä»¬çš„é›¶å€¼ã€‚ é›¶å€¼æ˜¯: â€‹\t0è¡¨ç¤ºæ•°å­—ç±»å‹, â€‹\tå¸ƒå°”ç±»å‹ä¸º falseï¼Œå¹¶ä¸” â€‹\tâ€œâ€(ç©ºå­—ç¬¦ä¸²)è¡¨ç¤ºå­—ç¬¦ä¸²ã€‚ package mainimport fmtfunc main() var i int\tvar f float64\tvar b bool\tvar s string // 0 0 false fmt.Printf(%v %v %v %q , i, f, b, s) 3.7 ç±»å‹è½¬æ¢è¡¨è¾¾å¼ T(v) å°†å€¼ v è½¬æ¢ä¸ºç±»å‹ Tã€‚ ä¸€äº›æ•°å€¼ç±»å‹çš„è½¬æ¢ï¼š var i int = 42var f float64 = float64(i)var u uint = uint(f) æˆ–è€…ï¼Œæ›´åŠ ç®€çŸ­çš„å½¢å¼ï¼š i := 42f := float64(i)u := uint(f) ä¸ C ä¸åŒçš„æ˜¯ï¼ŒGo åœ¨ä¸åŒç±»å‹çš„é¡¹ä¹‹é—´èµ‹å€¼æ—¶éœ€è¦æ˜¾å¼è½¬æ¢ã€‚ i := 42var f float64f = icannot use i (variable of type int) as float64 value in assignment 3.8 ç±»å‹æ¨æ–­åœ¨å£°æ˜ä¸€ä¸ªå˜é‡è€Œä¸æŒ‡å®šå…¶ç±»å‹æ—¶ï¼ˆå³ä½¿ç”¨ä¸å¸¦ç±»å‹çš„ := è¯­æ³• æˆ– var = è¡¨è¾¾å¼è¯­æ³•ï¼‰ï¼Œå˜é‡çš„ç±»å‹ä¼šé€šè¿‡å³å€¼æ¨æ–­å‡ºæ¥ã€‚ å½“å£°æ˜çš„å³å€¼ç¡®å®šäº†ç±»å‹æ—¶ï¼Œæ–°å˜é‡çš„ç±»å‹ä¸å…¶ç›¸åŒï¼š var i intj := i // j ä¹Ÿæ˜¯ä¸€ä¸ª int ä¸è¿‡å½“å³è¾¹åŒ…å«æœªæŒ‡æ˜ç±»å‹çš„æ•°å€¼å¸¸é‡æ—¶ï¼Œæ–°å˜é‡çš„ç±»å‹å°±å¯èƒ½æ˜¯ intã€float64 æˆ– complex128 äº†ï¼Œè¿™å–å†³äºå¸¸é‡çš„ç²¾åº¦ï¼š i := 42 // intf := 3.142 // float64g := 0.867 + 0.5i // complex128 package mainimport fmtfunc main() v := 42 // v is of type int\tfmt.Printf(v is of type %T , v) 3.9 å¸¸é‡å¸¸é‡çš„å£°æ˜ä¸å˜é‡ç±»ä¼¼ï¼Œåªä¸è¿‡ä½¿ç”¨ const å…³é”®å­—ã€‚ å¸¸é‡å¯ä»¥æ˜¯å­—ç¬¦ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼æˆ–æ•°å€¼ã€‚ å¸¸é‡ä¸èƒ½ç”¨ := è¯­æ³•å£°æ˜ã€‚ package mainimport fmtconst Pi = 3.14func main() const World = ä¸–ç•Œ\tfmt.Println(Hello, World)\tfmt.Println(Happy, Pi, Day)\tconst Truth = true\tfmt.Println(Go rules?, Truth) 4. æµç¨‹æ§åˆ¶è¯­å¥4.1 forå¾ªç¯Go åªæœ‰ä¸€ç§å¾ªç¯ç»“æ„ï¼šfor å¾ªç¯ã€‚ åŸºæœ¬çš„ for å¾ªç¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå®ƒä»¬ç”¨åˆ†å·éš”å¼€ï¼š åˆå§‹åŒ–è¯­å¥ï¼šåœ¨ç¬¬ä¸€æ¬¡è¿­ä»£å‰æ‰§è¡Œ æ¡ä»¶è¡¨è¾¾å¼ï¼šåœ¨æ¯æ¬¡è¿­ä»£å‰æ±‚å€¼ åç½®è¯­å¥ï¼šåœ¨æ¯æ¬¡è¿­ä»£çš„ç»“å°¾æ‰§è¡Œ åˆå§‹åŒ–è¯­å¥é€šå¸¸ä¸ºä¸€å¥çŸ­å˜é‡å£°æ˜ï¼Œè¯¥å˜é‡å£°æ˜ä»…åœ¨ for è¯­å¥çš„ä½œç”¨åŸŸä¸­å¯è§ã€‚ ä¸€æ—¦æ¡ä»¶è¡¨è¾¾å¼æ±‚å€¼ä¸º falseï¼Œå¾ªç¯è¿­ä»£å°±ä¼šç»ˆæ­¢ã€‚ æ³¨æ„ï¼šå’Œ Cã€Javaã€JavaScript ä¹‹ç±»çš„è¯­è¨€ä¸åŒï¼ŒGo çš„ for è¯­å¥åé¢çš„ä¸‰ä¸ªæ„æˆéƒ¨åˆ†å¤–æ²¡æœ‰å°æ‹¬å·ï¼Œ å¤§æ‹¬å· åˆ™æ˜¯å¿…é¡»çš„ã€‚ package mainimport fmtfunc main() sum := 0\tfor i := 0; i 10; i++ sum += i fmt.Println(sum) sum2 := 1\tfor sum2 100 sum2 += sum2 fmt.Println(sum2) åˆå§‹åŒ–è¯­å¥å’Œåç½®è¯­å¥éƒ½æ˜¯å¯é€‰çš„ï¼Œå¦‚æœå»æ‰;forè¿˜å¯ä»¥åšwhileçš„è¯­ä¹‰ã€‚ package mainimport fmtfunc main() sum2 := 1\tfor sum2 100 sum2 += sum2 fmt.Println(sum2) æ— é™å¾ªç¯ package mainimport fmtfunc main() for 4.2 ifGo çš„ if è¯­å¥ä¸ for å¾ªç¯ç±»ä¼¼ï¼Œè¡¨è¾¾å¼å¤–æ— éœ€å°æ‹¬å· ( )ï¼Œè€Œå¤§æ‹¬å· åˆ™æ˜¯å¿…é¡»çš„ã€‚ package mainimport (\tfmt\tmath)func sqrt(x float64) string if x 0 return sqrt(-x) + i return fmt.Sprint(math.Sqrt(x))func main() fmt.Println(sqrt(2), sqrt(-4)) å’Œ for ä¸€æ ·ï¼Œif è¯­å¥å¯ä»¥åœ¨æ¡ä»¶è¡¨è¾¾å¼å‰æ‰§è¡Œä¸€ä¸ªç®€çŸ­è¯­å¥ã€‚ è¯¥è¯­å¥å£°æ˜çš„å˜é‡ä½œç”¨åŸŸä»…åœ¨ if ä¹‹å†…ã€‚ package mainimport (\tfmt\tmath)func pow(x, n, lim float64) float64 if v := math.Pow(x, n); v lim return v return limfunc main() fmt.Println( pow(3, 2, 10), pow(3, 3, 20),\t) åœ¨ if çš„ç®€çŸ­è¯­å¥ä¸­å£°æ˜çš„å˜é‡åŒæ ·å¯ä»¥åœ¨å¯¹åº”çš„ä»»ä½• else å—ä¸­ä½¿ç”¨ã€‚ package mainimport (\tfmt\tmath)func pow(x, n, lim float64) float64 if v := math.Pow(x, n); v lim return v else fmt.Printf(%g = %g , v, lim) // cant use v here, though\treturn limfunc main() fmt.Println( pow(3, 2, 10), pow(3, 3, 20),\t) 4.3 switchåˆ†æ”¯switch è¯­å¥æ˜¯ç¼–å†™ä¸€è¿ä¸² if - else è¯­å¥çš„ç®€ä¾¿æ–¹æ³•ã€‚å®ƒè¿è¡Œç¬¬ä¸€ä¸ª case å€¼ å€¼ç­‰äºæ¡ä»¶è¡¨è¾¾å¼çš„å­å¥ã€‚ Go çš„ switch è¯­å¥ç±»ä¼¼äº Cã€C++ã€Javaã€JavaScript å’Œ PHP ä¸­çš„ï¼Œä¸è¿‡ Go åªä¼šè¿è¡Œé€‰å®šçš„ caseï¼Œè€Œéä¹‹åæ‰€æœ‰çš„ caseã€‚ åœ¨æ•ˆæœä¸Šï¼ŒGo çš„åšæ³•ç›¸å½“äºè¿™äº›è¯­è¨€ä¸­ä¸ºæ¯ä¸ª case åé¢è‡ªåŠ¨æ·»åŠ äº†æ‰€éœ€çš„ break è¯­å¥ã€‚åœ¨ Go ä¸­ï¼Œé™¤éä»¥ fallthrough è¯­å¥ç»“æŸï¼Œå¦åˆ™åˆ†æ”¯ä¼šè‡ªåŠ¨ç»ˆæ­¢ã€‚ Go çš„å¦ä¸€ç‚¹é‡è¦çš„ä¸åŒåœ¨äº switch çš„ case æ— éœ€ä¸ºå¸¸é‡ï¼Œä¸”å–å€¼ä¸é™äºæ•´æ•°ã€‚ package mainimport (\tfmt\truntime)func main() fmt.Print(Go è¿è¡Œçš„ç³»ç»Ÿç¯å¢ƒ)\tswitch os := runtime.GOOS; os case darwin: fmt.Println(mac.Os)\tcase linux: fmt.Println(Linux)\tdefault: fmt.Printf(%s , os) switch çš„ case è¯­å¥ä»ä¸Šåˆ°ä¸‹é¡ºæ¬¡æ‰§è¡Œï¼Œç›´åˆ°åŒ¹é…æˆåŠŸæ—¶åœæ­¢ã€‚ ä¾‹å¦‚ï¼Œ switch i case 0:case f(): åœ¨ i==0 æ—¶ï¼Œf ä¸ä¼šè¢«è°ƒç”¨ã€‚ æ— æ¡ä»¶çš„ switch åŒ switch true ä¸€æ ·ã€‚ è¿™ç§å½¢å¼èƒ½å°†ä¸€é•¿ä¸² if-then-else å†™å¾—æ›´åŠ æ¸…æ™°ã€‚ package mainimport (\tfmt\ttime)func main() t := time.Now()\tswitch case t.Hour() 12: fmt.Println(æ—©ä¸Šå¥½ï¼)\tcase t.Hour() 17: fmt.Println(ä¸‹åˆå¥½ï¼)\tdefault: fmt.Println(æ™šä¸Šå¥½ï¼) 4.4 deferæ¨è¿Ÿdefer è¯­å¥ä¼šå°†å‡½æ•°æ¨è¿Ÿåˆ°å¤–å±‚å‡½æ•°è¿”å›ä¹‹åæ‰§è¡Œã€‚ æ¨è¿Ÿè°ƒç”¨çš„å‡½æ•°å…¶å‚æ•°ä¼šç«‹å³æ±‚å€¼ï¼Œä½†ç›´åˆ°å¤–å±‚å‡½æ•°è¿”å›å‰è¯¥å‡½æ•°éƒ½ä¸ä¼šè¢«è°ƒç”¨ã€‚ package mainimport fmtfunc main() defer fmt.Println(world)\tfmt.Println(hello) 4.5 deferæ ˆæ¨è¿Ÿè°ƒç”¨çš„å‡½æ•°è°ƒç”¨ä¼šè¢«å‹å…¥ä¸€ä¸ªæ ˆä¸­ã€‚ å½“å¤–å±‚å‡½æ•°è¿”å›æ—¶ï¼Œè¢«æ¨è¿Ÿçš„è°ƒç”¨ä¼šæŒ‰ç…§åè¿›å…ˆå‡ºçš„é¡ºåºè°ƒç”¨ã€‚ package mainimport fmtfunc main() fmt.Println(counting)\tfor i := 0; i 10; i++ defer fmt.Println(i) fmt.Println(done)countingdone9876543210 5. ç»“æ„ä½“5.1 æŒ‡é’ˆGo æ‹¥æœ‰æŒ‡é’ˆã€‚æŒ‡é’ˆä¿å­˜äº†å€¼çš„å†…å­˜åœ°å€ã€‚ // ç±»å‹ *T æ˜¯æŒ‡å‘ T ç±»å‹å€¼çš„æŒ‡é’ˆï¼Œå…¶é›¶å€¼ä¸º nilã€‚// å˜é‡pæ˜¯æŒ‡å‘intç±»å‹çš„æŒ‡é’ˆvar p *inti := 42// æ“ä½œç¬¦ä¼šç”Ÿæˆä¸€ä¸ªæŒ‡å‘å…¶æ“ä½œæ•°çš„æŒ‡é’ˆã€‚// i ç”Ÿæˆä¸€ä¸ªæŒ‡é’ˆå¹¶èµ‹å€¼ç»™pp = i * æ“ä½œç¬¦è¡¨ç¤ºæŒ‡é’ˆæŒ‡å‘çš„åº•å±‚å€¼ã€‚ fmt.Println(*p) // é€šè¿‡æŒ‡é’ˆ p è¯»å– i*p = 21 // é€šè¿‡æŒ‡é’ˆ p è®¾ç½® i è¿™ä¹Ÿå°±æ˜¯é€šå¸¸æ‰€è¯´çš„ã€Œè§£å¼•ç”¨ã€æˆ–ã€Œé—´æ¥å¼•ç”¨ã€ã€‚ ä¸ C ä¸åŒï¼ŒGo æ²¡æœ‰æŒ‡é’ˆè¿ç®—ã€‚ package mainimport fmtfunc main() i, j := 42, 2701 // ç”ŸæˆæŒ‡å‘içš„æŒ‡é’ˆèµ‹å€¼ç»™p\tp := i\tfmt.Println(*p) //42\t*p = 21\tfmt.Println(i) //21\tp = j\t*p = *p / 37\tfmt.Println(j) //73 5.2 ç»“æ„ä½“ä¸€ä¸ª ç»“æ„ä½“ï¼ˆstructï¼‰å°±æ˜¯ä¸€ç»„ å­—æ®µï¼ˆfieldï¼‰ã€‚ package mainimport fmttype Vertex struct X int\tY inttype V float64func main() fmt.Println(Vertex1, 2) fmt.Println(V(1)) ç»“æ„ä½“ä¸­çš„å­—æ®µå¯é€šè¿‡ç‚¹å· . æ¥è®¿é—®ã€‚ package mainimport fmttype Vertex struct X int\tY intfunc main() v := Vertex1, 2\tv.X = 4\tfmt.Println(v.X) 5.3 ç»“æ„ä½“æŒ‡é’ˆç»“æ„ä½“å­—æ®µå¯é€šè¿‡ç»“æ„ä½“æŒ‡é’ˆæ¥è®¿é—®ã€‚ å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆ p é‚£ä¹ˆå¯ä»¥é€šè¿‡ (*p).X æ¥è®¿é—®å…¶å­—æ®µ Xã€‚ ä¸è¿‡è¿™ä¹ˆå†™å¤ªå•°å—¦äº†ï¼Œæ‰€ä»¥è¯­è¨€ä¹Ÿå…è®¸æˆ‘ä»¬ä½¿ç”¨éšå¼è§£å¼•ç”¨ï¼Œç›´æ¥å†™ p.X å°±å¯ä»¥ã€‚ package mainimport fmttype Vertex struct X int\tY intfunc main() v := Vertex1, 2\tp := v\tp.X = 1e9\tfmt.Println(v) 5.4 ç»“æ„ä½“å­—é¢é‡ä½¿ç”¨ Name: è¯­æ³•å¯ä»¥ä»…åˆ—å‡ºéƒ¨åˆ†å­—æ®µï¼ˆå­—æ®µåçš„é¡ºåºæ— å…³ï¼‰ã€‚ ç‰¹æ®Šçš„å‰ç¼€ è¿”å›ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆã€‚ package mainimport fmttype Vertex struct X, Y intvar (\tv1 = Vertex1, 2 // åˆ›å»ºä¸€ä¸ª Vertex ç±»å‹çš„ç»“æ„ä½“\tv2 = VertexX: 1 // Y:0 è¢«éšå¼åœ°èµ‹äºˆé›¶å€¼ // v = Vertex1 // è¿™ç§ä¼šæŠ¥é”™ v3 = Vertex // X:0 Y:0\tp = Vertex1, 2 // åˆ›å»ºä¸€ä¸ª *Vertex ç±»å‹çš„ç»“æ„ä½“ï¼ˆæŒ‡é’ˆï¼‰)func main() fmt.Println(v1, p, v2, v3) 6. æ•°ç»„ç±»å‹ [n]T è¡¨ç¤ºä¸€ä¸ªæ•°ç»„ï¼Œå®ƒæ‹¥æœ‰ n ä¸ªç±»å‹ä¸º T çš„å€¼ã€‚ è¡¨è¾¾å¼ï¼švar a [10]int ä¼šå°†å˜é‡ a å£°æ˜ä¸ºæ‹¥æœ‰ 10 ä¸ªæ•´æ•°çš„æ•°ç»„ã€‚ æ•°ç»„çš„é•¿åº¦æ˜¯å…¶ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤æ•°ç»„ä¸èƒ½æ”¹å˜å¤§å°ã€‚ è¿™çœ‹èµ·æ¥æ˜¯ä¸ªé™åˆ¶ï¼Œä¸è¿‡æ²¡å…³ç³»ï¼ŒGo æ‹¥æœ‰æ›´åŠ æ–¹ä¾¿çš„ä½¿ç”¨æ•°ç»„çš„æ–¹å¼ã€‚ package mainimport fmtfunc main() var a [2]string\ta[0] = hello\ta[1] = world\tfmt.Println(a[0], a[1])\tfmt.Println(a)\tprimes := [6]int2, 3, 4, 5, 6, 7\tfmt.Println(primes) 6.1 åˆ‡ç‰‡æ¯ä¸ªæ•°ç»„çš„å¤§å°éƒ½æ˜¯å›ºå®šçš„ã€‚è€Œåˆ‡ç‰‡åˆ™ä¸ºæ•°ç»„å…ƒç´ æä¾›äº†åŠ¨æ€å¤§å°çš„ã€çµæ´»çš„è§†è§’ã€‚ åœ¨å®è·µä¸­ï¼Œåˆ‡ç‰‡æ¯”æ•°ç»„æ›´å¸¸ç”¨ã€‚ ç±»å‹ []T è¡¨ç¤ºä¸€ä¸ªå…ƒç´ ç±»å‹ä¸º T çš„åˆ‡ç‰‡ã€‚ åˆ‡ç‰‡é€šè¿‡ä¸¤ä¸ªä¸‹æ ‡æ¥ç•Œå®šï¼Œä¸€ä¸ªä¸‹ç•Œå’Œä¸€ä¸ªä¸Šç•Œï¼ŒäºŒè€…ä»¥å†’å·åˆ†éš”ï¼š a[low : high] å®ƒä¼šé€‰å‡ºä¸€ä¸ªåŠé—­åŠå¼€åŒºé—´ï¼ŒåŒ…æ‹¬ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä½†æ’é™¤æœ€åä¸€ä¸ªå…ƒç´ ã€‚ ä»¥ä¸‹è¡¨è¾¾å¼åˆ›å»ºäº†ä¸€ä¸ªåˆ‡ç‰‡ï¼Œå®ƒåŒ…å« a ä¸­ä¸‹æ ‡ä» 1 åˆ° 3 çš„å…ƒç´ ï¼š a[1:4] package mainimport fmtfunc main() // åˆ›å»ºä¸€ä¸ªæ•°ç»„\tprimes := [6]int2, 3, 4, 5, 6, 7\t// åˆ›å»ºä¸€ä¸ªåˆ‡ç‰‡\tvar s []int = primes[1:4]\tfmt.Println(s) åˆ‡ç‰‡å°±åƒæ•°ç»„çš„å¼•ç”¨ åˆ‡ç‰‡å¹¶ä¸å­˜å‚¨ä»»ä½•æ•°æ®ï¼Œå®ƒåªæ˜¯æè¿°äº†åº•å±‚æ•°ç»„ä¸­çš„ä¸€æ®µã€‚æ›´æ”¹åˆ‡ç‰‡çš„å…ƒç´ ä¼šä¿®æ”¹å…¶åº•å±‚æ•°ç»„ä¸­å¯¹åº”çš„å…ƒç´ ï¼ˆåŸå§‹æ•°ç»„ä¸­çš„æ•°æ®ä¸ä¼šæ”¹å˜ï¼Œæ”¹çš„åªæ˜¯åˆ‡ç‰‡ï¼‰ï¼Œå’Œå®ƒå…±äº«åº•å±‚æ•°ç»„çš„åˆ‡ç‰‡éƒ½ä¼šè§‚æµ‹åˆ°è¿™äº›ä¿®æ”¹ã€‚ package mainimport fmtfunc main() names := [4]string lala, dd, dx, po, fmt.Println(names)\ta := names[0:2]\tb := names[1:3]\tfmt.Println(a, b)\t// ä¿®æ”¹åˆ‡ç‰‡æ•°æ®ï¼Œå…±äº«åº•å±‚æ•°ç»„çš„åˆ‡ç‰‡ä¸­æ•°æ®ä¼šä¿®æ”¹ï¼Œä½†åº•å±‚æ•°ç»„æ•°æ®ä¸å˜\tb[0] = XX\tfmt.Println(a, b) //[lala XX] [XX dx]\tfmt.Println(names) //[lala XX dx po] 6.2 åˆ‡ç‰‡å­—é¢é‡åˆ‡ç‰‡å­—é¢é‡ç±»ä¼¼äºæ²¡æœ‰é•¿åº¦çš„æ•°ç»„å­—é¢é‡ã€‚ è¿™æ˜¯ä¸€ä¸ªæ•°ç»„å­—é¢é‡ï¼š [3]booltrue, true, false ä¸‹é¢è¿™æ ·åˆ™ä¼šå…ˆåˆ›å»ºä¸€ä¸ªå’Œä¸Šé¢ç›¸åŒçš„æ•°ç»„ï¼Œç„¶åå†æ„å»ºä¸€ä¸ªå¼•ç”¨äº†å®ƒçš„åˆ‡ç‰‡ï¼š []booltrue, true, false package mainimport fmtfunc main() q := []int2, 3, 4, 5, 6\tfmt.Println(q)\tr := []booltrue, false, true\tfmt.Println(r)\ts := []struct i int b bool 2, true, 3, false, 4, true, fmt.Println(s) 6.3 åˆ‡ç‰‡é»˜è®¤è¡Œä¸ºåœ¨è¿›è¡Œåˆ‡ç‰‡æ—¶ï¼Œå¯ä»¥åˆ©ç”¨å®ƒçš„é»˜è®¤è¡Œä¸ºæ¥å¿½ç•¥ä¸Šä¸‹ç•Œã€‚ åˆ‡ç‰‡ä¸‹ç•Œçš„é»˜è®¤å€¼ä¸º 0ï¼Œä¸Šç•Œåˆ™æ˜¯è¯¥åˆ‡ç‰‡çš„é•¿åº¦ã€‚ å¯¹äºæ•°ç»„ var a [10]int æ¥è¯´ï¼Œä»¥ä¸‹åˆ‡ç‰‡è¡¨è¾¾å¼å’Œå®ƒæ˜¯ç­‰ä»·çš„ï¼š a[0:10]a[:10]a[0:]a[:] package mainimport fmtfunc main() s := []int2, 3, 4, 5, 6\ts = s[0:4]\tfmt.Println(s)\ts = s[:4]\tfmt.Println(s)\ts = s[0:]\tfmt.Println(s) 6.4 åˆ‡ç‰‡çš„é•¿åº¦ä¸å®¹é‡åˆ‡ç‰‡æ‹¥æœ‰ é•¿åº¦ å’Œ å®¹é‡ã€‚ åˆ‡ç‰‡çš„é•¿åº¦å°±æ˜¯å®ƒæ‰€åŒ…å«çš„å…ƒç´ ä¸ªæ•°ã€‚ åˆ‡ç‰‡çš„å®¹é‡æ˜¯ä»å®ƒçš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹æ•°ï¼Œåˆ°å…¶åº•å±‚æ•°ç»„å…ƒç´ æœ«å°¾çš„ä¸ªæ•°ã€‚ åˆ‡ç‰‡ s çš„é•¿åº¦å’Œå®¹é‡å¯é€šè¿‡è¡¨è¾¾å¼ len(s) å’Œ cap(s) æ¥è·å–ã€‚ å¯ä»¥é€šè¿‡é‡æ–°åˆ‡ç‰‡æ¥æ‰©å±•ä¸€ä¸ªåˆ‡ç‰‡ï¼Œç»™å®ƒæä¾›è¶³å¤Ÿçš„å®¹é‡ã€‚ package mainimport fmtfunc main() s := []int2, 3, 5, 7, 11, 13\tprintSlice(s)\t// æˆªå–åˆ‡ç‰‡ä½¿å…¶é•¿åº¦ä¸º 0\ts = s[:0]\tprintSlice(s)\t// æ‰©å±•å…¶é•¿åº¦\ts = s[:4]\tprintSlice(s)\t// èˆå¼ƒå‰ä¸¤ä¸ªå€¼\ts = s[2:]\tprintSlice(s)func printSlice(s []int) fmt.Printf(len=%d cap=%d %v , len(s), cap(s), s)len=6 cap=6 [2 3 5 7 11 13]len=0 cap=6 []len=4 cap=6 [2 3 5 7]len=2 cap=4 [5 7] s s[2:]çš„å®¹é‡ä¸ºä»€ä¹ˆæ˜¯4ï¼Ÿ å¯ä»¥ç†è§£ä¸ºåˆ‡ç‰‡æ˜¯ä¸€ç§å¼•ç”¨ç±»å‹ï¼Œåœ¨è¿™æŒ‡å‘æ•°ç»„sçš„æŒ‡é’ˆã€‚s[2:]å°†æŒ‡é’ˆç§»åŠ¨åˆ°äº†å…ƒç´ 5çš„ä½ç½®ï¼Œæ­¤æ—¶è®¡ç®—å®¹é‡å°±æ˜¯4äº†ã€‚ 6.5 nilåˆ‡ç‰‡åˆ‡ç‰‡çš„é›¶å€¼æ˜¯ nilã€‚ nil åˆ‡ç‰‡çš„é•¿åº¦å’Œå®¹é‡ä¸º 0 ä¸”æ²¡æœ‰åº•å±‚æ•°ç»„ã€‚ package mainimport fmtfunc main() var s []int\tfmt.Println(s, len(s), cap(s))\tif s == nil fmt.Println(nil!) 6.6 ä½¿ç”¨makeåˆ›å»ºåˆ‡ç‰‡åˆ‡ç‰‡å¯ä»¥ç”¨å†…ç½®å‡½æ•° make æ¥åˆ›å»ºï¼Œè¿™ä¹Ÿæ˜¯åˆ›å»ºåŠ¨æ€æ•°ç»„çš„æ–¹å¼ã€‚ make å‡½æ•°ä¼šåˆ†é…ä¸€ä¸ªå…ƒç´ ä¸ºé›¶å€¼çš„æ•°ç»„å¹¶è¿”å›ä¸€ä¸ªå¼•ç”¨äº†å®ƒçš„åˆ‡ç‰‡ï¼š a := make([]int, 5) // len(a)=5 è¦æŒ‡å®šå®ƒçš„å®¹é‡ï¼Œéœ€å‘ make ä¼ å…¥ç¬¬ä¸‰ä¸ªå‚æ•°ï¼š b := make([]int, 0, 5) // len(b)=0, cap(b)=5b = b[:cap(b)] // len(b)=5, cap(b)=5b = b[1:] // len(b)=4, cap(b)=4 package mainimport fmtfunc main() a := make([]int, 5)\tprintSlice(a, a)\tb := make([]int, 0, 5)\tprintSlice(b, b)\tc := b[:2]\tprintSlice(c, c)\td := c[2:5]\tprintSlice(d, d)func printSlice(s string, x []int) fmt.Printf(%s len=%d cap=%d %v , s, len(x), cap(x), x)a len=5 cap=5 [0 0 0 0 0]b len=0 cap=5 []c len=2 cap=5 [0 0]d len=3 cap=3 [0 0 0] 6.7 åˆ‡ç‰‡çš„åˆ‡ç‰‡åˆ‡ç‰‡å¯ä»¥åŒ…å«ä»»ä½•ç±»å‹ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬å…¶ä»–åˆ‡ç‰‡ã€‚ package mainimport (\tfmt\tstrings)func main() // åˆ›å»ºä¸€ä¸ªäº•å­—æ£‹ï¼ˆç»å…¸æ¸¸æˆï¼‰\tboard := [][]string []string_, _, _, []string_, _, _, []string_, _, _, // ä¸¤ä¸ªç©å®¶è½®æµæ‰“ä¸Š X å’Œ O\tboard[0][0] = X\tboard[2][2] = O\tboard[1][2] = X\tboard[1][0] = O\tboard[0][2] = X\tfor i := 0; i len(board); i++ fmt.Printf(%s , strings.Join(board[i], )) 6.8 å‘åˆ‡ç‰‡æ·»åŠ å…ƒç´ ä¸ºåˆ‡ç‰‡è¿½åŠ æ–°çš„å…ƒç´ æ˜¯ç§å¸¸è§çš„æ“ä½œï¼Œä¸ºæ­¤ Go æä¾›äº†å†…ç½®çš„ append å‡½æ•°ã€‚å†…ç½®å‡½æ•°çš„æ–‡æ¡£å¯¹è¯¥å‡½æ•°æœ‰è¯¦ç»†çš„ä»‹ç»ã€‚ func append(s []T, vs ...T) []T append çš„ç¬¬ä¸€ä¸ªå‚æ•° s æ˜¯ä¸€ä¸ªå…ƒç´ ç±»å‹ä¸º T çš„åˆ‡ç‰‡ï¼Œå…¶ä½™ç±»å‹ä¸º T çš„å€¼å°†ä¼šè¿½åŠ åˆ°è¯¥åˆ‡ç‰‡çš„æœ«å°¾ã€‚ append çš„ç»“æœæ˜¯ä¸€ä¸ªåŒ…å«åŸåˆ‡ç‰‡æ‰€æœ‰å…ƒç´ åŠ ä¸Šæ–°æ·»åŠ å…ƒç´ çš„åˆ‡ç‰‡ã€‚ å½“ s çš„åº•å±‚æ•°ç»„å¤ªå°ï¼Œä¸è¶³ä»¥å®¹çº³æ‰€æœ‰ç»™å®šçš„å€¼æ—¶ï¼Œå®ƒå°±ä¼šåˆ†é…ä¸€ä¸ªæ›´å¤§çš„æ•°ç»„ã€‚ è¿”å›çš„åˆ‡ç‰‡ä¼šæŒ‡å‘è¿™ä¸ªæ–°åˆ†é…çš„æ•°ç»„ã€‚ ï¼ˆè¦äº†è§£å…³äºåˆ‡ç‰‡çš„æ›´å¤šå†…å®¹ï¼Œè¯·é˜…è¯»æ–‡ç«  Go åˆ‡ç‰‡ï¼šç”¨æ³•å’Œæœ¬è´¨ã€‚ï¼‰ package mainimport fmtfunc main() var s []int\tprintSlice(s)\ts = append(s, 0)\tprintSlice(s)\ts = append(s, 1)\tprintSlice(s)\ts = append(s, 3, 4, 5)\tprintSlice(s)func printSlice(s []int) fmt.Printf(len=%d cap=%d %v , len(s), cap(s), s)len=0 cap=0 []len=1 cap=1 [0]len=2 cap=2 [0 1]len=5 cap=6 [0 1 3 4 5] 7. rangeéå†for å¾ªç¯çš„ range å½¢å¼å¯éå†åˆ‡ç‰‡æˆ–æ˜ å°„ã€‚ å½“ä½¿ç”¨ for å¾ªç¯éå†åˆ‡ç‰‡æ—¶ï¼Œæ¯æ¬¡è¿­ä»£éƒ½ä¼šè¿”å›ä¸¤ä¸ªå€¼ã€‚ ç¬¬ä¸€ä¸ªå€¼ä¸ºå½“å‰å…ƒç´ çš„ä¸‹æ ‡ï¼Œç¬¬äºŒä¸ªå€¼ä¸ºè¯¥ä¸‹æ ‡æ‰€å¯¹åº”å…ƒç´ çš„ä¸€ä»½å‰¯æœ¬ã€‚ package mainimport fmtvar pow = []int1, 2, 3, 4, 5, 6, 7, 8func main() for i, v := range pow fmt.Printf(i=%d v=%d , i, v)\ti=0 v=1i=1 v=2i=2 v=3i=3 v=4i=4 v=5i=5 v=6i=6 v=7i=7 v=8 å¯ä»¥å°†ä¸‹æ ‡æˆ–å€¼èµ‹äºˆ _ æ¥å¿½ç•¥å®ƒã€‚ for i, _ := range powfor _, value := range pow è‹¥åªéœ€è¦ç´¢å¼•ï¼Œå¿½ç•¥ç¬¬äºŒä¸ªå˜é‡å³å¯ã€‚ for i := range pow package mainimport fmtfunc main() pow := make([]int, 5)\tfor i := range pow pow[i] = 1 uint(i) // 2^i for _, v := range pow fmt.Printf(%d , v)\t124816 8. map8.1 åˆ›å»ºæ˜ å°„map æ˜ å°„å°†é”®æ˜ å°„åˆ°å€¼ã€‚ æ˜ å°„çš„é›¶å€¼ä¸º nil ã€‚nil æ˜ å°„æ—¢æ²¡æœ‰é”®ï¼Œä¹Ÿä¸èƒ½æ·»åŠ é”®ã€‚(ä½¿ç”¨varå®šä¹‰) make å‡½æ•°ä¼šè¿”å›ç»™å®šç±»å‹çš„æ˜ å°„ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–å¤‡ç”¨ã€‚ package mainimport fmttype Vertex struct Lat, Long float64var m map[string]Vertexfunc main() m = make(map[string]Vertex)\tm[gege] = Vertex 3.14, 15926.1, fmt.Println(m[gege]) 8.2 æ˜ å°„å­—é¢é‡æ˜ å°„çš„å­—é¢é‡å’Œç»“æ„ä½“ç±»ä¼¼ï¼Œåªä¸è¿‡å¿…é¡»æœ‰é”®åã€‚ package mainimport fmttype Vertex struct Lat, Long float64var m = map[string]Vertex\tBell Labs: Vertex 40.68433, -74.39967,\t,\tGoogle: Vertex 37.42202, -122.08408,\t,func main() fmt.Println(m è‹¥é¡¶å±‚ç±»å‹åªæœ‰ä¸€ä¸ªç±»å‹åï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨å­—é¢é‡çš„å…ƒç´ ä¸­çœç•¥å®ƒã€‚ package mainimport fmttype Vertex struct Lat, Long float64var m = map[string]Vertex\tBell Labs: 40.68433, -74.39967,\t,\tGoogle: 37.42202, -122.08408,\t,func main() fmt.Println(m 8.3 ä¿®æ”¹æ˜ å°„åœ¨æ˜ å°„ m ä¸­æ’å…¥æˆ–ä¿®æ”¹å…ƒç´ ï¼š m[key] = elem è·å–å…ƒç´ ï¼š elem = m[key] åˆ é™¤å…ƒç´ ï¼š delete(m, key) é€šè¿‡åŒèµ‹å€¼æ£€æµ‹æŸä¸ªé”®æ˜¯å¦å­˜åœ¨ï¼š elem, ok = m[key] è‹¥ key åœ¨ m ä¸­ï¼Œok ä¸º true ï¼›å¦åˆ™ï¼Œok ä¸º falseã€‚ è‹¥ key ä¸åœ¨æ˜ å°„ä¸­ï¼Œåˆ™ elem æ˜¯è¯¥æ˜ å°„å…ƒç´ ç±»å‹çš„é›¶å€¼ã€‚ æ³¨ï¼šè‹¥ elem æˆ– ok è¿˜æœªå£°æ˜ï¼Œä½ å¯ä»¥ä½¿ç”¨çŸ­å˜é‡å£°æ˜ï¼š elem, ok := m[key] package mainimport fmtfunc main() m := make(map[string]int)\tm[ç­”æ¡ˆ] = 42\tfmt.Println(å€¼ï¼š, m[ç­”æ¡ˆ])\tm[ç­”æ¡ˆ] = 48\tfmt.Println(å€¼ï¼š, m[ç­”æ¡ˆ])\tdelete(m, ç­”æ¡ˆ)\tfmt.Println(å€¼ï¼š, m[ç­”æ¡ˆ])\tv, ok := m[ç­”æ¡ˆ]\tfmt.Println(å€¼ï¼š, v, æ˜¯å¦å­˜åœ¨ï¼Ÿ, ok)å€¼ï¼š 42å€¼ï¼š 48å€¼ï¼š 0å€¼ï¼š 0 æ˜¯å¦å­˜åœ¨ï¼Ÿ false 9. å‡½æ•°9.1 å‡½æ•°å€¼å‡½æ•°ä¹Ÿæ˜¯å€¼ã€‚å®ƒä»¬å¯ä»¥åƒå…¶ä»–å€¼ä¸€æ ·ä¼ é€’ã€‚ å‡½æ•°å€¼å¯ä»¥ç”¨ä½œå‡½æ•°çš„å‚æ•°æˆ–è¿”å›å€¼ã€‚ package mainimport (\tfmt\tmath)// å…¥å‚ä¸ºå‡½æ•°fn(float64, float64) float64func compute(fn func(float64, float64) float64) float64 return fn(3, 4)func main() hypot := func(x, y float64) float64 return math.Sqrt(x*x + y*y) fmt.Println(hypot(5, 12)) // hypot(3,4)ï¼ŒæŠŠå‡½æ•°ä¼ å…¥computeï¼Œæ‰§è¡Œhypot(3,4)\tfmt.Println(compute((hypot))) // math.pow(3,4)\tfmt.Println(compute(math.Pow)) 9.2 å‡½æ•°é—­åŒ…Go å‡½æ•°å¯ä»¥æ˜¯ä¸€ä¸ªé—­åŒ…ã€‚é—­åŒ…æ˜¯ä¸€ä¸ªå‡½æ•°å€¼ï¼Œå®ƒå¼•ç”¨äº†å…¶å‡½æ•°ä½“ä¹‹å¤–çš„å˜é‡ã€‚ è¯¥å‡½æ•°å¯ä»¥è®¿é—®å¹¶èµ‹äºˆå…¶å¼•ç”¨çš„å˜é‡å€¼ï¼Œæ¢å¥è¯è¯´ï¼Œè¯¥å‡½æ•°è¢«â€œç»‘å®šâ€åˆ°äº†è¿™äº›å˜é‡ã€‚ ä»¥ä¸‹å®ä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†å‡½æ•° getSequence() ï¼Œè¿”å›å¦å¤–ä¸€ä¸ªå‡½æ•°ã€‚è¯¥å‡½æ•°çš„ç›®çš„æ˜¯åœ¨é—­åŒ…ä¸­é€’å¢ i å˜é‡ï¼Œä»£ç å¦‚ä¸‹ï¼š package mainimport fmtfunc getSequence() func() int i:=0 return func() int i+=1 return i func main() /* nextNumber ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•° i ä¸º 0 */ nextNumber := getSequence() /* è°ƒç”¨ nextNumber å‡½æ•°ï¼Œi å˜é‡è‡ªå¢ 1 å¹¶è¿”å› */ fmt.Println(nextNumber()) fmt.Println(nextNumber()) fmt.Println(nextNumber()) /* åˆ›å»ºæ–°çš„å‡½æ•° nextNumber1ï¼Œå¹¶æŸ¥çœ‹ç»“æœ */ nextNumber1 := getSequence() fmt.Println(nextNumber1()) fmt.Println(nextNumber1())12312 10. æ–¹æ³•10.1 å®šä¹‰Go æ²¡æœ‰ç±»ã€‚ä¸è¿‡ä½ å¯ä»¥ä¸ºç±»å‹å®šä¹‰æ–¹æ³•ã€‚ æ–¹æ³•å°±æ˜¯ä¸€ç±»å¸¦ç‰¹æ®Šçš„ **å…¥å‚ **çš„å‡½æ•°ã€‚ æ–¹æ³•å…¥å‚åœ¨å®ƒè‡ªå·±çš„å‚æ•°åˆ—è¡¨å†…ï¼Œä½äº func å…³é”®å­—å’Œæ–¹æ³•åä¹‹é—´ã€‚ æ–¹æ³•ä¸€èˆ¬æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹(OOP)çš„ä¸€ä¸ªç‰¹æ€§ï¼Œåœ¨ C++ è¯­è¨€ä¸­æ–¹æ³•å¯¹åº”ä¸€ä¸ªç±»å¯¹è±¡çš„æˆå‘˜å‡½æ•°ï¼Œæ˜¯å…³è”åˆ°å…·ä½“å¯¹è±¡ä¸Šçš„è™šè¡¨ä¸­çš„ã€‚ä½†æ˜¯ Go è¯­è¨€çš„æ–¹æ³•å´æ˜¯å…³è”åˆ°ç±»å‹çš„ï¼Œè¿™æ ·å¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µå®Œæˆæ–¹æ³•çš„é™æ€ç»‘å®šã€‚ä¸€ä¸ªé¢å‘å¯¹è±¡çš„ç¨‹åºä¼šç”¨æ–¹æ³•æ¥è¡¨è¾¾å…¶å±æ€§å¯¹åº”çš„æ“ä½œï¼Œè¿™æ ·ä½¿ç”¨è¿™ä¸ªå¯¹è±¡çš„ç”¨æˆ·å°±ä¸éœ€è¦ç›´æ¥å»æ“ä½œå¯¹è±¡ï¼Œè€Œæ˜¯å€ŸåŠ©æ–¹æ³•æ¥åšè¿™äº›äº‹æƒ…ã€‚é¢å‘å¯¹è±¡ç¼–ç¨‹è¿›å…¥ä¸»æµå¼€å‘é¢†åŸŸä¸€èˆ¬è®¤ä¸ºæ˜¯ä» C++ å¼€å§‹çš„ï¼ŒC++ å°±æ˜¯åœ¨å…¼å®¹ C è¯­è¨€çš„åŸºç¡€ä¹‹ä¸Šæ”¯æŒäº† class ç­‰é¢å‘å¯¹è±¡çš„ç‰¹æ€§ã€‚ç„¶å Java ç¼–ç¨‹åˆ™å·ç§°æ˜¯çº¯ç²¹çš„é¢å‘å¯¹è±¡è¯­è¨€ï¼Œå› ä¸º Java ä¸­å‡½æ•°æ˜¯ä¸èƒ½ç‹¬ç«‹å­˜åœ¨çš„ï¼Œæ¯ä¸ªå‡½æ•°éƒ½å¿…ç„¶æ˜¯å±äºæŸä¸ªç±»çš„ã€‚ é¢å‘å¯¹è±¡ç¼–ç¨‹æ›´å¤šçš„åªæ˜¯ä¸€ç§æ€æƒ³ï¼Œå¾ˆå¤šå·ç§°æ”¯æŒé¢å‘å¯¹è±¡ç¼–ç¨‹çš„è¯­è¨€åªæ˜¯å°†ç»å¸¸ç”¨åˆ°çš„ç‰¹æ€§å†…ç½®åˆ°è¯­è¨€ä¸­äº†è€Œå·²ã€‚Go è¯­è¨€çš„ç¥–å…ˆ C è¯­è¨€è™½ç„¶ä¸æ˜¯ä¸€ä¸ªæ”¯æŒé¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œä½†æ˜¯ C è¯­è¨€çš„æ ‡å‡†åº“ä¸­çš„ File ç›¸å…³çš„å‡½æ•°ä¹Ÿç”¨åˆ°äº†çš„é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ€æƒ³ã€‚ä¸‹é¢æˆ‘ä»¬å®ç°ä¸€ç»„ C è¯­è¨€é£æ ¼çš„ File å‡½æ•°ï¼š // æ–‡ä»¶å¯¹è±¡type File struct fd int// æ‰“å¼€æ–‡ä»¶func OpenFile(name string) (f *File, err error) // ...// å…³é—­æ–‡ä»¶func CloseFile(f *File) error // ...// è¯»æ–‡ä»¶æ•°æ®func ReadFile(f *File, offset int64, data []byte) int // ... å…¶ä¸­ OpenFile ç±»ä¼¼æ„é€ å‡½æ•°ç”¨äºæ‰“å¼€æ–‡ä»¶å¯¹è±¡ï¼ŒCloseFile ç±»ä¼¼ææ„å‡½æ•°ç”¨äºå…³é—­æ–‡ä»¶å¯¹è±¡ï¼ŒReadFile åˆ™ç±»ä¼¼æ™®é€šçš„æˆå‘˜å‡½æ•°ï¼Œè¿™ä¸‰ä¸ªå‡½æ•°éƒ½æ˜¯æ™®é€šçš„å‡½æ•°ã€‚CloseFile å’Œ ReadFile ä½œä¸ºæ™®é€šå‡½æ•°ï¼Œéœ€è¦å ç”¨åŒ…çº§ç©ºé—´ä¸­çš„åå­—èµ„æºã€‚ä¸è¿‡ CloseFile å’Œ ReadFile å‡½æ•°åªæ˜¯é’ˆå¯¹ File ç±»å‹å¯¹è±¡çš„æ“ä½œï¼Œè¿™æ—¶å€™æˆ‘ä»¬æ›´å¸Œæœ›è¿™ç±»å‡½æ•°å’Œæ“ä½œå¯¹è±¡çš„ç±»å‹ç´§å¯†ç»‘å®šåœ¨ä¸€èµ·ã€‚ Go è¯­è¨€ä¸­çš„åšæ³•æ˜¯ï¼Œå°† CloseFile å’Œ ReadFile å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ç§»åŠ¨åˆ°å‡½æ•°åçš„å¼€å¤´ï¼š // å…³é—­æ–‡ä»¶func (f *File) CloseFile() error // ...// è¯»æ–‡ä»¶æ•°æ®func (f *File) ReadFile(offset int64, data []byte) int // ... è¿™æ ·çš„è¯ï¼ŒCloseFile å’Œ ReadFile å‡½æ•°å°±æˆäº† File ç±»å‹ç‹¬æœ‰çš„æ–¹æ³•äº†ï¼ˆè€Œä¸æ˜¯ File å¯¹è±¡æ–¹æ³•ï¼‰ã€‚å®ƒä»¬ä¹Ÿä¸å†å ç”¨åŒ…çº§ç©ºé—´ä¸­çš„åå­—èµ„æºï¼ŒåŒæ—¶ File ç±»å‹å·²ç»æ˜ç¡®äº†å®ƒä»¬æ“ä½œå¯¹è±¡ï¼Œå› æ­¤æ–¹æ³•åå­—ä¸€èˆ¬ç®€åŒ–ä¸º Close å’Œ Readï¼š // å…³é—­æ–‡ä»¶func (f *File) Close() error // ...// è¯»æ–‡ä»¶æ•°æ®func (f *File) Read(offset int64, data []byte) int // ... å°†ç¬¬ä¸€ä¸ªå‡½æ•°å‚æ•°ç§»åŠ¨åˆ°å‡½æ•°å‰é¢ï¼Œä»ä»£ç è§’åº¦çœ‹è™½ç„¶åªæ˜¯ä¸€ä¸ªå°çš„æ”¹åŠ¨ï¼Œä½†æ˜¯ä»ç¼–ç¨‹å“²å­¦è§’åº¦æ¥çœ‹ï¼ŒGo è¯­è¨€å·²ç»æ˜¯è¿›å…¥é¢å‘å¯¹è±¡è¯­è¨€çš„è¡Œåˆ—äº†ã€‚æˆ‘ä»¬å¯ä»¥ç»™ä»»ä½•è‡ªå®šä¹‰ç±»å‹æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæ–¹æ³•ã€‚æ¯ç§ç±»å‹å¯¹åº”çš„æ–¹æ³•å¿…é¡»å’Œç±»å‹çš„å®šä¹‰åœ¨åŒä¸€ä¸ªåŒ…ä¸­ï¼Œå› æ­¤æ˜¯æ— æ³•ç»™ int è¿™ç±»å†…ç½®ç±»å‹æ·»åŠ æ–¹æ³•çš„ï¼ˆå› ä¸ºæ–¹æ³•çš„å®šä¹‰å’Œç±»å‹çš„å®šä¹‰ä¸åœ¨ä¸€ä¸ªåŒ…ä¸­ï¼‰ã€‚å¯¹äºç»™å®šçš„ç±»å‹ï¼Œæ¯ä¸ªæ–¹æ³•çš„åå­—å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼ŒåŒæ—¶æ–¹æ³•å’Œå‡½æ•°ä¸€æ ·ä¹Ÿä¸æ”¯æŒé‡è½½ã€‚ æ–¹æ³•å³å‡½æ•° package mainimport (\tfmt\tmath)type Vertex struct X, Y float64// Abs æ–¹æ³•æ‹¥æœ‰ä¸€ä¸ªåå­—ä¸º vï¼Œç±»å‹ä¸º Vertex çš„å…¥å‚ã€‚func (v Vertex) Abs() float64 return math.Sqrt(v.X*v.X + v.Y*v.Y)// ç°åœ¨è¿™ä¸ª Abs çš„å†™æ³•å°±æ˜¯ä¸ªæ­£å¸¸çš„å‡½æ•°ï¼ŒåŠŸèƒ½å¹¶æ²¡æœ‰ä»€ä¹ˆå˜åŒ–ã€‚func Abs2(v Vertex) float64 return math.Sqrt(v.X*v.X + v.Y*v.Y)func main() v := Vertex3, 4 // å‡½æ•°ä¸æ“ä½œå¯¹è±¡ç±»å‹ç»‘å®š\tfmt.Println(v.Abs()) fmt.Println(Abs2(v)) ä½ ä¹Ÿå¯ä»¥ä¸ºéç»“æ„ä½“ç±»å‹å£°æ˜æ–¹æ³•ã€‚ åœ¨æ­¤ä¾‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªå¸¦ Abs æ–¹æ³•çš„æ•°å€¼ç±»å‹ MyFloatã€‚ ä½ åªèƒ½ä¸ºåœ¨åŒä¸€ä¸ªåŒ…ä¸­å®šä¹‰çš„å…¥å‚ç±»å‹å£°æ˜æ–¹æ³•ï¼Œè€Œä¸èƒ½ä¸ºå…¶å®ƒåˆ«çš„åŒ…ä¸­å®šä¹‰çš„ç±»å‹ ï¼ˆåŒ…æ‹¬ int ä¹‹ç±»çš„å†…ç½®ç±»å‹ï¼‰å£°æ˜æ–¹æ³•ã€‚ï¼ˆå°±æ˜¯å…¥å‚çš„ç±»å‹å®šä¹‰å’Œæ–¹æ³•å£°æ˜å¿…é¡»åœ¨åŒä¸€åŒ…å†…ï¼‰ package mainimport (\tfmt\tmath)type MyFloat float64func (f MyFloat) Abs() float64 if f 0 return float64(-f) return float64(f)func main() f := MyFloat(-math.Sqrt2)\tfmt.Println(f.Abs()) 10.2 æŒ‡é’ˆç±»å‹å…¥å‚ä½ å¯ä»¥ä¸ºæŒ‡é’ˆç±»å‹çš„å…¥å‚å£°æ˜æ–¹æ³•ã€‚ è¿™æ„å‘³ç€å¯¹äºæŸç±»å‹ Tï¼Œå…¥å‚çš„ç±»å‹å¯ä»¥ç”¨ *T çš„æ–‡æ³•ã€‚ ï¼ˆæ­¤å¤–ï¼ŒT æœ¬èº«ä¸èƒ½æ˜¯æŒ‡é’ˆï¼Œæ¯”å¦‚ä¸èƒ½æ˜¯ *intã€‚ï¼‰ ä¾‹å¦‚ï¼Œè¿™é‡Œä¸º *Vertex å®šä¹‰äº† Scale æ–¹æ³•ã€‚ æŒ‡é’ˆç±»å‹å…¥å‚çš„æ–¹æ³•å¯ä»¥ä¿®æ”¹å…¥å‚æŒ‡é’ˆæŒ‡å‘çš„å€¼ï¼ˆå¦‚è¿™é‡Œçš„ Scale æ‰€ç¤ºï¼‰ã€‚ ç”±äºæ–¹æ³•ç»å¸¸éœ€è¦ä¿®æ”¹å®ƒçš„å…¥å‚å¯¹è±¡ï¼ŒæŒ‡é’ˆå…¥å‚æ¯”å€¼å…¥å‚æ›´å¸¸ç”¨ã€‚ è¯•ç€ç§»é™¤ Scale å‡½æ•°å£°æ˜ä¸­çš„ *ï¼Œè§‚å¯Ÿæ­¤ç¨‹åºçš„è¡Œä¸ºå¦‚ä½•å˜åŒ–ã€‚ è‹¥ä½¿ç”¨å€¼å…¥å‚ï¼Œé‚£ä¹ˆ Scale2 æ–¹æ³•ä¼šå¯¹åŸå§‹ Vertex å€¼çš„å‰¯æœ¬è¿›è¡Œæ“ä½œã€‚ï¼ˆå¯¹äºå‡½æ•°çš„å…¶å®ƒå‚æ•°ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ï¼‰ package mainimport (\tfmt\tmath)type Vertex struct X, Y float64func (v Vertex) Abs() float64 // 25\treturn math.Sqrt(v.X*v.X + v.Y*v.Y)func (v *Vertex) Scale(f float64) v.X = v.X * f\tv.Y = v.Y * ffunc (v Vertex) Scale2(f float64) v.X = v.X * f\tv.Y = v.Y * ffunc main() v := Vertex3, 4\t// ä½¿ç”¨æŒ‡é’ˆç›´æ¥ä¿®æ”¹åŸå§‹å€¼\tv.Scale(10)\tfmt.Println(v.Abs())\tv2 := Vertex3, 4\t// ä½¿ç”¨å€¼æ¥æ”¶ï¼Œä¿®æ”¹åŸå§‹å€¼çš„å‰¯æœ¬\tv2.Scale2(10)\tfmt.Println(v2.Abs()) æŒ‡é’ˆä¸å‡½æ•° ç°åœ¨æˆ‘ä»¬è¦æŠŠ Abs å’Œ Scale æ–¹æ³•é‡å†™ä¸ºå‡½æ•°ã€‚ åŒæ ·ï¼Œå…ˆè¯•ç€ç§»é™¤æ‰ Scaleå‡½æ•°çš„*ï¼Œä½ èƒ½çœ‹å‡ºç¨‹åºè¡Œä¸ºæ”¹å˜çš„åŸå› å—ï¼Ÿ è¦æ€æ ·åšæ‰èƒ½è®©è¯¥ç¤ºä¾‹é¡ºåˆ©é€šè¿‡ç¼–è¯‘ï¼Ÿ package mainimport (\tfmt\tmath)type Vertex struct X, Y float64func Abs(v Vertex) float64 return math.Sqrt(v.X*v.X + v.Y*v.Y)func Scale(v *Vertex, f float64) v.X = v.X * f\tv.Y = v.Y * ffunc main() v := Vertex3, 4\tScale(v, 10)\tfmt.Println(Abs(v)) package mainimport fmttype Vertex struct X, Y float64func (v *Vertex) Scale(f float64) v.X = v.X * f\tv.Y = v.Y * ffunc ScaleFunc(v *Vertex, f float64) v.X = v.X * f\tv.Y = v.Y * ffunc main() v := Vertex3, 4\tv.Scale(2)\tScaleFunc(v, 10)\tp := Vertex4, 3\tp.Scale(3)\tScaleFunc(p, 8)\tfmt.Println(v, p) æ¯”è¾ƒå‰ä¸¤ä¸ªç¨‹åºï¼Œä½ å¤§æ¦‚ä¼šæ³¨æ„åˆ°å¸¦æŒ‡é’ˆå‚æ•°çš„å‡½æ•°å¿…é¡»æ¥å—ä¸€ä¸ªæŒ‡é’ˆï¼š var v VertexScaleFunc(v, 5) // ç¼–è¯‘é”™è¯¯ï¼ScaleFunc(v, 5) // OK è€Œå…¥å‚ä¸ºæŒ‡é’ˆçš„çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå…¥å‚æ—¢èƒ½æ˜¯å€¼åˆèƒ½æ˜¯æŒ‡é’ˆï¼š var v Vertexv.Scale(5) // OKp := vp.Scale(10) // OK å¯¹äºè¯­å¥ v.Scale(5) æ¥è¯´ï¼Œå³ä¾¿ v æ˜¯ä¸€ä¸ªå€¼è€ŒéæŒ‡é’ˆï¼Œå¸¦æŒ‡é’ˆå…¥å‚çš„æ–¹æ³•ä¹Ÿèƒ½è¢«ç›´æ¥è°ƒç”¨ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œç”±äº Scale æ–¹æ³•æœ‰ä¸€ä¸ªæŒ‡é’ˆå…¥å‚ï¼Œä¸ºæ–¹ä¾¿èµ·è§ï¼ŒGo ä¼šå°†è¯­å¥ v.Scale(5) è§£é‡Šä¸º (v).Scale(5)ã€‚ åä¹‹ä¹Ÿä¸€æ ·ï¼š æ¥å—ä¸€ä¸ªå€¼ä½œä¸ºå‚æ•°çš„å‡½æ•°å¿…é¡»æ¥å—ä¸€ä¸ªæŒ‡å®šç±»å‹çš„å€¼ï¼š var v Vertexfmt.Println(AbsFunc(v)) // OKfmt.Println(AbsFunc(v)) // ç¼–è¯‘é”™è¯¯ï¼ è€Œä»¥å€¼ä¸ºå…¥å‚çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå…¥å‚æ—¢èƒ½ä¸ºå€¼åˆèƒ½ä¸ºæŒ‡é’ˆï¼š var v Vertexfmt.Println(v.Abs()) // OKp := vfmt.Println(p.Abs()) // OK è¿™ç§æƒ…å†µä¸‹ï¼Œæ–¹æ³•è°ƒç”¨ p.Abs() ä¼šè¢«è§£é‡Šä¸º (*p).Abs()ã€‚ package mainimport (\tfmt\tmath)type Vertex struct X, Y float64func (v Vertex) Abs() float64 return math.Sqrt(v.X*v.X + v.Y*v.Y)func AbsFunc(v Vertex) float64 return math.Sqrt(v.X*v.X + v.Y*v.Y)func main() v := Vertex3, 4\tfmt.Println(v.Abs()) fmt.Println((v).Abs())\tfmt.Println(AbsFunc(v)) // fmt.Println(AbsFunc(v)) ç¼–è¯‘æŠ¥é”™\tp := Vertex4, 3\tfmt.Println(p.Abs()) fmt.Println((*p).Abs())\tfmt.Println(AbsFunc(*p)) // fmt.Println(AbsFunc(p)) ç¼–è¯‘æŠ¥é”™ é€‰æ‹©å€¼æˆ–æŒ‡é’ˆä½œä¸ºå…¥å‚ ä½¿ç”¨æŒ‡é’ˆå…¥å‚çš„åŸå› æœ‰äºŒï¼š é¦–å…ˆï¼Œæ–¹æ³•èƒ½å¤Ÿä¿®æ”¹å…¶å…¥å‚æŒ‡é’ˆæŒ‡å‘çš„å€¼ã€‚ å…¶æ¬¡ï¼Œè¿™æ ·å¯ä»¥é¿å…åœ¨æ¯æ¬¡è°ƒç”¨æ–¹æ³•æ—¶å¤åˆ¶è¯¥å€¼ã€‚è‹¥å€¼çš„ç±»å‹ä¸ºå¤§å‹ç»“æ„ä½“æ—¶ï¼Œè¿™æ ·ä¼šæ›´åŠ é«˜æ•ˆã€‚ åœ¨æœ¬ä¾‹ä¸­ï¼ŒScale å’Œ Abs å…¥å‚çš„ç±»å‹ä¸º *Vertexï¼Œå³ä¾¿ Abs å¹¶ä¸éœ€è¦ä¿®æ”¹å…¶å…¥å‚ã€‚ é€šå¸¸æ¥è¯´ï¼Œæ‰€æœ‰ç»™å®šç±»å‹çš„æ–¹æ³•éƒ½åº”è¯¥æœ‰å€¼æˆ–æŒ‡é’ˆå…¥å‚ï¼Œä½†å¹¶ä¸åº”è¯¥äºŒè€…æ··ç”¨ã€‚ package mainimport (\tfmt\tmath)type Vertex struct X, Y float64func (v *Vertex) Scale(f float64) v.X = v.X * f\tv.Y = v.Y * ffunc (v *Vertex) Abs() float64 return math.Sqrt(v.X*v.X + v.Y*v.Y)func main() v := Vertex3, 4\tfmt.Printf(ç¼©æ”¾å‰ï¼š%+vï¼Œç»å¯¹å€¼ï¼š%v , v, v.Abs())\tv.Scale(5)\tfmt.Printf(ç¼©æ”¾åï¼š%+vï¼Œç»å¯¹å€¼ï¼š%v , v, v.Abs())ç¼©æ”¾å‰ï¼šX:3 Y:4ï¼Œç»å¯¹å€¼ï¼š5ç¼©æ”¾åï¼šX:15 Y:20ï¼Œç»å¯¹å€¼ï¼š25 11. æ¥å£11.1 å®šä¹‰æ¥å£ç±»å‹ çš„å®šä¹‰ä¸ºä¸€ç»„æ–¹æ³•ç­¾åã€‚ æ¥å£å¯ä»¥è®©æˆ‘ä»¬å°†ä¸åŒçš„ç±»å‹ç»‘å®šåˆ°ä¸€ç»„å…¬å…±çš„æ–¹æ³•ä¸Šï¼Œä»è€Œå®ç°å¤šæ€å’Œçµæ´»çš„è®¾è®¡ã€‚ æ¥å£ç±»å‹çš„å˜é‡å¯ä»¥æŒæœ‰ä»»ä½•å®ç°äº†è¿™äº›æ–¹æ³•çš„å€¼ã€‚ æ³¨æ„: ç¤ºä¾‹ä»£ç  a = v å­˜åœ¨ä¸€ä¸ªé”™è¯¯ã€‚ç”±äº Abs æ–¹æ³•åªä¸º *Vertex ï¼ˆæŒ‡é’ˆç±»å‹ï¼‰å®šä¹‰ï¼Œå› æ­¤ Vertexï¼ˆå€¼ç±»å‹ï¼‰å¹¶æœªå®ç° Abserã€‚ package mainimport (\tfmt\tmath)type Abser interface Abs() float64func main() var a Abser\tf := MyFloat(-math.Sqrt2)\tv := Vertex3, 4\ta = f // MyFloatå®ç°äº† Abser\ta = v // *Vertexå®ç°äº† Abser\t// ä¸‹é¢ä¸€è¡Œï¼Œv æ˜¯ä¸€ä¸ª Vertexï¼ˆè€Œä¸æ˜¯ *Vertexï¼‰\t// æ‰€ä»¥æ²¡æœ‰å®ç° Abserã€‚\ta = v\tfmt.Println(a.Abs())type MyFloat float64func (f MyFloat) Abs() float64 if f 0 return float64(-f) return float64(f)type Vertex struct X, Y float64func (v *Vertex) Abs() float64 return math.Sqrt(v.X*v.X + v.Y*v.Y) 11.2 æ¥å£ä¸éšå¼å®ç°Go è¯­è¨€ä¸­çš„æ¥å£æ˜¯éšå¼å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªç±»å‹å®ç°äº†ä¸€ä¸ªæ¥å£å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒå°±è‡ªåŠ¨åœ°å®ç°äº†è¯¥æ¥å£ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†æ¥å£ä½œä¸ºå‚æ•°æ¥å®ç°å¯¹ä¸åŒç±»å‹çš„è°ƒç”¨ï¼Œä»è€Œå®ç°å¤šæ€ã€‚ ç±»å‹é€šè¿‡å®ç°ä¸€ä¸ªæ¥å£çš„æ‰€æœ‰æ–¹æ³•æ¥å®ç°è¯¥æ¥å£ã€‚æ—¢ç„¶æ— éœ€ä¸“é—¨æ˜¾å¼å£°æ˜ï¼Œä¹Ÿå°±æ²¡æœ‰â€œimplementsâ€å…³é”®å­—ã€‚ éšå¼æ¥å£ä»æ¥å£çš„å®ç°ä¸­è§£è€¦äº†å®šä¹‰ï¼Œè¿™æ ·æ¥å£çš„å®ç°å¯ä»¥å‡ºç°åœ¨ä»»ä½•åŒ…ä¸­ï¼Œæ— éœ€æå‰å‡†å¤‡ã€‚ å› æ­¤ï¼Œä¹Ÿå°±æ— éœ€åœ¨æ¯ä¸€ä¸ªå®ç°ä¸Šå¢åŠ æ–°çš„æ¥å£åç§°ï¼Œè¿™æ ·åŒæ—¶ä¹Ÿé¼“åŠ±äº†æ˜ç¡®çš„æ¥å£å®šä¹‰ã€‚ package mainimport ( fmt)type Phone interface call()type NokiaPhone struct func (nokiaPhone NokiaPhone) call() fmt.Println(I am Nokia, I can call you!)type IPhone struct func (iPhone IPhone) call() fmt.Println(I am iPhone, I can call you!)func main() var phone Phone phone = new(NokiaPhone) phone.call() phone = new(IPhone) phone.call() 11.3 æ¥å£å€¼æ¥å£ä¹Ÿæ˜¯å€¼ã€‚å®ƒä»¬å¯ä»¥åƒå…¶å®ƒå€¼ä¸€æ ·ä¼ é€’ã€‚ æ¥å£å€¼å¯ä»¥ç”¨ä½œå‡½æ•°çš„å‚æ•°æˆ–è¿”å›å€¼ã€‚ åœ¨å†…éƒ¨ï¼Œæ¥å£å€¼å¯ä»¥çœ‹åšåŒ…å«å€¼å’Œå…·ä½“ç±»å‹çš„å…ƒç»„ï¼š (value, type) æ¥å£å€¼ä¿å­˜äº†ä¸€ä¸ªå…·ä½“åº•å±‚ç±»å‹çš„å…·ä½“å€¼ã€‚ æ¥å£å€¼è°ƒç”¨æ–¹æ³•æ—¶ä¼šæ‰§è¡Œå…¶åº•å±‚ç±»å‹çš„åŒåæ–¹æ³•ã€‚ package mainimport (\tfmt\tmath)type I interface M()type T struct S stringfunc (t *T) M() fmt.Println(t.S)type F float64func (f F) M() fmt.Println(f)func main() var i I\ti = Thello\tdescribe(i)\ti.M()\ti = F(math.Pi)\tdescribe(i)\ti.M()func describe(i I) fmt.Printf((%v, %T) , i, i)(hello, *main.T)hello(3.141592653589793, main.F)3.141592653589793 åº•å±‚å€¼ä¸º nil çš„æ¥å£å€¼ å³ä¾¿æ¥å£å†…çš„å…·ä½“å€¼ä¸º nilï¼Œæ–¹æ³•ä»ç„¶ä¼šè¢« nil æ¥æ”¶è€…è°ƒç”¨ã€‚ åœ¨ä¸€äº›è¯­è¨€ä¸­ï¼Œè¿™ä¼šè§¦å‘ä¸€ä¸ªç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œä½†åœ¨ Go ä¸­é€šå¸¸ä¼šå†™ä¸€äº›æ–¹æ³•æ¥ä¼˜é›…åœ°å¤„ç†å®ƒï¼ˆå¦‚æœ¬ä¾‹ä¸­çš„ M æ–¹æ³•ï¼‰ã€‚ æ³¨æ„: ä¿å­˜äº† nil å…·ä½“å€¼çš„æ¥å£å…¶è‡ªèº«å¹¶ä¸ä¸º nilã€‚ package mainimport fmttype I interface M()type T struct S stringfunc (t *T) M() if t == nil fmt.Println(nil) return fmt.Println(t.S)func main() var i I\tvar t *T\ti = t\tdescribe(i) // è¿™é‡Œä¸ä¼šè§¦å‘ä¸€ä¸ªç©ºæŒ‡é’ˆå¼‚å¸¸\ti.M()\ti = Thello\tdescribe(i)\ti.M()func describe(i I) fmt.Printf((%v, %T) , i, i)(nil, *main.T)nil(hello, *main.T)hello nilæ¥å£å€¼ nil æ¥å£å€¼æ—¢ä¸ä¿å­˜å€¼ä¹Ÿä¸ä¿å­˜å…·ä½“ç±»å‹ã€‚ ä¸º nil æ¥å£è°ƒç”¨æ–¹æ³•ä¼šäº§ç”Ÿè¿è¡Œæ—¶é”™è¯¯ï¼Œå› ä¸ºæ¥å£çš„å…ƒç»„å†…å¹¶æœªåŒ…å«èƒ½å¤ŸæŒ‡æ˜è¯¥è°ƒç”¨å“ªä¸ª å…·ä½“ æ–¹æ³•çš„ç±»å‹ã€‚ package mainimport fmttype I interface M()func main() var i I\tdescribe(i) // æ²¡æœ‰æŒ‡å®šå…·ä½“ç±»å‹çš„æ–¹æ³• // (nil, nil)\t// panic: runtime error: invalid memory address or nil pointer dereference\ti.M()func describe(i I) fmt.Printf((%v, %T) , i, i) 11.4 ç©ºæ¥å£æŒ‡å®šäº†é›¶ä¸ªæ–¹æ³•çš„æ¥å£å€¼è¢«ç§°ä¸º ç©ºæ¥å£ï¼š interface ç©ºæ¥å£å¯ä¿å­˜ä»»ä½•ç±»å‹çš„å€¼ã€‚ï¼ˆå› ä¸ºæ¯ä¸ªç±»å‹éƒ½è‡³å°‘å®ç°äº†é›¶ä¸ªæ–¹æ³•ã€‚ï¼‰ ç©ºæ¥å£è¢«ç”¨æ¥å¤„ç†æœªçŸ¥ç±»å‹çš„å€¼ã€‚ä¾‹å¦‚ï¼Œfmt.Print å¯æ¥å—ç±»å‹ä¸º interface çš„ä»»æ„æ•°é‡çš„å‚æ•°ã€‚ package mainimport fmttype I interfacefunc main() var i I\tdescribe(i)\ti = 42\tdescribe(i)\ti = hello\tdescribe(i)func describe(i I) fmt.Printf((%v, %T) , i, i) 11.5 ç±»å‹æ–­è¨€ç±»å‹æ–­è¨€ æä¾›äº†è®¿é—®æ¥å£å€¼åº•å±‚å…·ä½“å€¼çš„æ–¹å¼ã€‚ t := i.(T) è¯¥è¯­å¥æ–­è¨€æ¥å£å€¼ i ä¿å­˜äº†å…·ä½“ç±»å‹ Tï¼Œå¹¶å°†å…¶åº•å±‚ç±»å‹ä¸º T çš„å€¼èµ‹äºˆå˜é‡ tã€‚ è‹¥ i å¹¶æœªä¿å­˜ T ç±»å‹çš„å€¼ï¼Œè¯¥è¯­å¥å°±ä¼šè§¦å‘ä¸€ä¸ª panicã€‚ ä¸ºäº† åˆ¤æ–­ ä¸€ä¸ªæ¥å£å€¼æ˜¯å¦ä¿å­˜äº†ä¸€ä¸ªç‰¹å®šçš„ç±»å‹ï¼Œç±»å‹æ–­è¨€å¯è¿”å›ä¸¤ä¸ªå€¼ï¼šå…¶åº•å±‚å€¼ä»¥åŠä¸€ä¸ªæŠ¥å‘Šæ–­è¨€æ˜¯å¦æˆåŠŸçš„å¸ƒå°”å€¼ã€‚ t, ok := i.(T) è‹¥ i ä¿å­˜äº†ä¸€ä¸ª Tï¼Œé‚£ä¹ˆ t å°†ä¼šæ˜¯å…¶åº•å±‚å€¼ï¼Œè€Œ ok ä¸º trueã€‚ å¦åˆ™ï¼Œok å°†ä¸º false è€Œ t å°†ä¸º T ç±»å‹çš„é›¶å€¼ï¼Œç¨‹åºå¹¶ä¸ä¼šäº§ç”Ÿ panicã€‚ è¯·æ³¨æ„è¿™ç§è¯­æ³•å’Œè¯»å–ä¸€ä¸ªæ˜ å°„æ—¶çš„ç›¸åŒä¹‹å¤„ã€‚ package mainimport fmtfunc main() var i interface = hello\ts := i.(string)\tfmt.Println(s)\ts, ok := i.(string)\tfmt.Println(ok)\tf, ok := i.(float64)\tfmt.Println(f, ok)\t// panic: interface conversion: interface is string, not float64\tf = i.(float64) // panic\tfmt.Println(f) 11.6 ç±»å‹é€‰æ‹©ç±»å‹é€‰æ‹© æ˜¯ä¸€ç§æŒ‰é¡ºåºä»å‡ ä¸ªç±»å‹æ–­è¨€ä¸­é€‰æ‹©åˆ†æ”¯çš„ç»“æ„ã€‚ ç±»å‹é€‰æ‹©ä¸ä¸€èˆ¬çš„ switch è¯­å¥ç›¸ä¼¼ï¼Œä¸è¿‡ç±»å‹é€‰æ‹©ä¸­çš„ case ä¸ºç±»å‹ï¼ˆè€Œéå€¼ï¼‰ï¼Œ å®ƒä»¬é’ˆå¯¹ç»™å®šæ¥å£å€¼æ‰€å­˜å‚¨çš„å€¼çš„ç±»å‹è¿›è¡Œæ¯”è¾ƒã€‚ switch v := i.(type) case T: // v çš„ç±»å‹ä¸º Tcase S: // v çš„ç±»å‹ä¸º Sdefault: // æ²¡æœ‰åŒ¹é…ï¼Œv ä¸ i çš„ç±»å‹ç›¸åŒ ç±»å‹é€‰æ‹©ä¸­çš„å£°æ˜ä¸ç±»å‹æ–­è¨€ i.(T) çš„è¯­æ³•ç›¸åŒï¼Œåªæ˜¯å…·ä½“ç±»å‹ T è¢«æ›¿æ¢æˆäº†å…³é”®å­— typeã€‚ æ­¤é€‰æ‹©è¯­å¥åˆ¤æ–­æ¥å£å€¼ i ä¿å­˜çš„å€¼ç±»å‹æ˜¯ T è¿˜æ˜¯ Sã€‚åœ¨ T æˆ– S çš„æƒ…å†µä¸‹ï¼Œå˜é‡ v ä¼šåˆ†åˆ«æŒ‰ T æˆ– S ç±»å‹ä¿å­˜ i æ‹¥æœ‰çš„å€¼ã€‚åœ¨é»˜è®¤ï¼ˆå³æ²¡æœ‰åŒ¹é…ï¼‰çš„æƒ…å†µä¸‹ï¼Œå˜é‡ v ä¸ i çš„æ¥å£ç±»å‹å’Œå€¼ç›¸åŒã€‚ package mainimport fmtfunc do(i interface) switch v := i.(type) case int: fmt.Printf(äºŒå€çš„ %v æ˜¯ %v , v, v*2)\tcase string: fmt.Printf(%q é•¿åº¦ä¸º %v å­—èŠ‚ , v, len(v))\tdefault: fmt.Printf(æˆ‘ä¸çŸ¥é“ç±»å‹ %T! , v)\tfunc main() do(21)\tdo(hello)\tdo(true) 12. é”™è¯¯Go ç¨‹åºä½¿ç”¨ error å€¼æ¥è¡¨ç¤ºé”™è¯¯çŠ¶æ€ã€‚ error ç±»å‹æ˜¯ä¸€ä¸ªå†…ç½®çš„æ¥å£ï¼š type error interface Error() string ï¼ˆä¸ fmt.Stringer ç±»ä¼¼ï¼Œfmt åŒ…ä¹Ÿä¼šæ ¹æ®å¯¹ error çš„å®ç°æ¥æ‰“å°å€¼ã€‚ï¼‰ é€šå¸¸å‡½æ•°ä¼šè¿”å›ä¸€ä¸ª error å€¼ï¼Œè°ƒç”¨å®ƒçš„ä»£ç åº”å½“åˆ¤æ–­è¿™ä¸ªé”™è¯¯æ˜¯å¦ç­‰äº nil æ¥è¿›è¡Œé”™è¯¯å¤„ç†ã€‚ i, err := strconv.Atoi(42)if err != nil fmt.Printf(couldnt convert number: %v , err) returnfmt.Println(Converted integer:, i) error ä¸º nil æ—¶è¡¨ç¤ºæˆåŠŸï¼›é nil çš„ error è¡¨ç¤ºå¤±è´¥ã€‚ package mainimport (\tfmt\tmath\ttime)type MyError struct When time.Time\tWhat string// å®ç°erroræ¥å£çš„Error()æ–¹æ³•func (e MyError) Error() string return fmt.Sprintf(at %v, %s, e.When, e.What)func Sqrt(f float64) (float64, error) if f 0 return 0, MyError time.Now(), square root of negative number, return math.Abs(f), nilfunc main() fmt.Println(Sqrt(1))\t_, err := Sqrt(-1)\tif err != nil fmt.Println(err)\t1 nilat 2024-08-07 15:35:34.2402027 +0800 CST m=+0.001527601, square root of negative number 13. æ³›å‹13.1 ç±»å‹å‚æ•°å¯ä»¥ä½¿ç”¨ç±»å‹å‚æ•°ç¼–å†™ Go å‡½æ•°æ¥å¤„ç†å¤šç§ç±»å‹ã€‚ å‡½æ•°çš„ç±»å‹å‚æ•°å‡ºç°åœ¨å‡½æ•°å‚æ•°ä¹‹å‰çš„æ–¹æ‹¬å·ä¹‹é—´ã€‚ func Index[T comparable](s []T, x T) int æ­¤å£°æ˜æ„å‘³ç€ s æ˜¯æ»¡è¶³å†…ç½®çº¦æŸ comparable çš„ä»»ä½•ç±»å‹ T çš„åˆ‡ç‰‡ã€‚ x ä¹Ÿæ˜¯ç›¸åŒç±»å‹çš„å€¼ã€‚ comparable æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„çº¦æŸï¼Œå®ƒèƒ½è®©æˆ‘ä»¬å¯¹ä»»æ„æ»¡è¶³è¯¥ç±»å‹çš„å€¼ä½¿ç”¨ == å’Œ != è¿ç®—ç¬¦ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒå°†å€¼ä¸æ‰€æœ‰åˆ‡ç‰‡å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œç›´åˆ°æ‰¾åˆ°åŒ¹é…é¡¹ã€‚ è¯¥ Index å‡½æ•°é€‚ç”¨äºä»»ä½•æ”¯æŒæ¯”è¾ƒçš„ç±»å‹ã€‚ package mainimport fmt// Index è¿”å› x åœ¨ s ä¸­çš„ä¸‹æ ‡ï¼Œæœªæ‰¾åˆ°åˆ™è¿”å› -1ã€‚func Index[T comparable](s []T, x T) int for i, v := range s // v å’Œ x çš„ç±»å‹ä¸º Tï¼Œå®ƒæ‹¥æœ‰ comparable å¯æ¯”è¾ƒçš„çº¦æŸï¼Œ // å› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ==ã€‚ if v == x return i return -1func Index2[T int](s []T, x T) int for i, v := range s // v å’Œ x çš„ç±»å‹ä¸º Tï¼Œå®ƒæ‹¥æœ‰ comparable å¯æ¯”è¾ƒçš„çº¦æŸï¼Œ // å› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ==ã€‚ if v == x return i return -1func main() // Index å¯ä»¥åœ¨æ•´æ•°åˆ‡ç‰‡ä¸Šä½¿ç”¨\tsi := []int10, 20, 15, -10\tfmt.Println(Index(si, 15)) si2 := []int10, 20, 15, -10 // Index2çš„å‚æ•°çº¦æŸä¸ºintï¼Œæ­¤æ—¶å¦‚æœä¼ å…¥stringç±»å‹ç¼–è¯‘ä¼šæŠ¥é”™ fmt.Println(Index2(si2, 15))\t// Index ä¹Ÿå¯ä»¥åœ¨å­—ç¬¦ä¸²åˆ‡ç‰‡ä¸Šä½¿ç”¨\tss := []stringfoo, bar, baz\tfmt.Println(Index(ss, hello)) 14. å¹¶å‘14.1 Goåç¨‹Go ç¨‹ï¼ˆgoroutineï¼‰æ˜¯ç”± Go è¿è¡Œæ—¶ç®¡ç†çš„è½»é‡çº§çº¿ç¨‹ã€‚ go f(x, y, z) ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„ Go åç¨‹å¹¶æ‰§è¡Œfå‡½æ•° f(x, y, z) f, x, y å’Œ z çš„æ±‚å€¼å‘ç”Ÿåœ¨å½“å‰çš„ Go åç¨‹ä¸­ï¼Œè€Œ f çš„æ‰§è¡Œå‘ç”Ÿåœ¨æ–°çš„ Go åç¨‹ä¸­ã€‚ Go ç¨‹åœ¨ç›¸åŒçš„åœ°å€ç©ºé—´ä¸­è¿è¡Œï¼Œå› æ­¤åœ¨è®¿é—®å…±äº«çš„å†…å­˜æ—¶å¿…é¡»è¿›è¡ŒåŒæ­¥ã€‚sync åŒ…æä¾›äº†è¿™ç§èƒ½åŠ›ï¼Œä¸è¿‡åœ¨ Go ä¸­å¹¶ä¸ç»å¸¸ç”¨åˆ°ï¼Œå› ä¸ºè¿˜æœ‰å…¶å®ƒçš„åŠæ³•ã€‚ package mainimport (\tfmt\ttime)func say(s string) for i := 0; i 5; i++ time.Sleep(100 * time.Millisecond) fmt.Println(s)\tfunc main() go say(world)\tsay(hello) 14.2 ä¿¡é“ä¿¡é“æ˜¯å¸¦æœ‰ç±»å‹çš„ç®¡é“ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒç”¨ä¿¡é“æ“ä½œç¬¦ - æ¥å‘é€æˆ–è€…æ¥æ”¶å€¼ã€‚ ch - v // å°† v å‘é€è‡³ä¿¡é“ chã€‚v := -ch // ä» ch æ¥æ”¶å€¼å¹¶èµ‹äºˆ vã€‚ ï¼ˆâ€œç®­å¤´â€å°±æ˜¯æ•°æ®æµçš„æ–¹å‘ã€‚ï¼‰ å’Œæ˜ å°„ä¸åˆ‡ç‰‡ä¸€æ ·ï¼Œä¿¡é“åœ¨ä½¿ç”¨å‰å¿…é¡»åˆ›å»ºï¼š ch := make(chan int) é»˜è®¤æƒ…å†µä¸‹ï¼Œå‘é€å’Œæ¥æ”¶æ“ä½œåœ¨å¦ä¸€ç«¯å‡†å¤‡å¥½ä¹‹å‰éƒ½ä¼šé˜»å¡ã€‚è¿™ä½¿å¾— Go ç¨‹å¯ä»¥åœ¨æ²¡æœ‰æ˜¾å¼çš„é”æˆ–ç«æ€å˜é‡çš„æƒ…å†µä¸‹è¿›è¡ŒåŒæ­¥ã€‚ ä»¥ä¸‹ç¤ºä¾‹å¯¹åˆ‡ç‰‡ä¸­çš„æ•°è¿›è¡Œæ±‚å’Œï¼Œå°†ä»»åŠ¡åˆ†é…ç»™ä¸¤ä¸ª Go ç¨‹ã€‚ä¸€æ—¦ä¸¤ä¸ª Go ç¨‹å®Œæˆäº†å®ƒä»¬çš„è®¡ç®—ï¼Œå®ƒå°±èƒ½ç®—å‡ºæœ€ç»ˆçš„ç»“æœã€‚ package mainimport fmtfunc sum(s []int, c chan int) sum := 0\tfor _, v := range s sum += v c - sum // å‘é€ sum åˆ° cfunc main() s := []int7, 2, 8, -9, 4, 0\tc := make(chan int)\tgo sum(s[:len(s)/2], c)\tgo sum(s[len(s)/2:], c)\tx, y := -c, -c // ä» c æ¥æ”¶\tfmt.Println(x, y, x+y) å¸¦ç¼“å†²çš„ä¿¡é“ ä¿¡é“å¯ä»¥æ˜¯ å¸¦ç¼“å†²çš„ã€‚å°†ç¼“å†²é•¿åº¦ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°æä¾›ç»™ make æ¥åˆå§‹åŒ–ä¸€ä¸ªå¸¦ç¼“å†²çš„ä¿¡é“ï¼š ch := make(chan int, 100) ä»…å½“ä¿¡é“çš„ç¼“å†²åŒºå¡«æ»¡åï¼Œå‘å…¶å‘é€æ•°æ®æ—¶æ‰ä¼šé˜»å¡ã€‚å½“ç¼“å†²åŒºä¸ºç©ºæ—¶ï¼Œæ¥å—æ–¹ä¼šé˜»å¡ã€‚ package mainimport fmtfunc main() ch := make(chan int, 2)\tch - 1\tch - 2 // ç¼“å†²åŒºæ»¡åå†å†™ä¼šæŠ¥ä¸‹åˆ—é”™è¯¯ // fatal error: all goroutines are asleep - deadlock! // ch - 3\tfmt.Println(-ch)\tfmt.Println(-ch) ä¿¡é“å…³é—­ å‘é€è€…å¯é€šè¿‡ close å…³é—­ä¸€ä¸ªä¿¡é“æ¥è¡¨ç¤ºæ²¡æœ‰éœ€è¦å‘é€çš„å€¼äº†ã€‚æ¥æ”¶è€…å¯ä»¥é€šè¿‡ä¸ºæ¥æ”¶è¡¨è¾¾å¼åˆ†é…ç¬¬äºŒä¸ªå‚æ•°æ¥æµ‹è¯•ä¿¡é“æ˜¯å¦è¢«å…³é—­ï¼šè‹¥æ²¡æœ‰å€¼å¯ä»¥æ¥æ”¶ä¸”ä¿¡é“å·²è¢«å…³é—­ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œå®Œ v, ok := -ch æ­¤æ—¶ ok ä¼šè¢«è®¾ç½®ä¸º falseã€‚ å¾ªç¯ for i := range c ä¼šä¸æ–­ä»ä¿¡é“æ¥æ”¶å€¼ï¼Œç›´åˆ°å®ƒè¢«å…³é—­ã€‚ æ³¨æ„ï¼š åªåº”ç”±å‘é€è€…å…³é—­ä¿¡é“ï¼Œè€Œä¸åº”æ²¹æ¥æ”¶è€…å…³é—­ã€‚å‘ä¸€ä¸ªå·²ç»å…³é—­çš„ä¿¡é“å‘é€æ•°æ®ä¼šå¼•å‘ç¨‹åº panicã€‚ è¿˜è¦æ³¨æ„ï¼š ä¿¡é“ä¸æ–‡ä»¶ä¸åŒï¼Œé€šå¸¸æƒ…å†µä¸‹æ— éœ€å…³é—­å®ƒä»¬ã€‚åªæœ‰åœ¨å¿…é¡»å‘Šè¯‰æ¥æ”¶è€…ä¸å†æœ‰éœ€è¦å‘é€çš„å€¼æ—¶æ‰æœ‰å¿…è¦å…³é—­ï¼Œä¾‹å¦‚ç»ˆæ­¢ä¸€ä¸ª range å¾ªç¯ã€‚ package mainimport (\tfmt)func fibonacci(n int, c chan int) x, y := 0, 1\tfor i := 0; i n; i++ c - x x, y = y, x+y close(c)func main() c := make(chan int, 10)\tgo fibonacci(cap(c), c)\tfor i := range c fmt.Println(i) 14.3 selectè¯­å¥select è¯­å¥ä½¿ä¸€ä¸ª Go ç¨‹å¯ä»¥ç­‰å¾…å¤šä¸ªé€šä¿¡æ“ä½œã€‚ select ä¼šé˜»å¡åˆ°æŸä¸ªåˆ†æ”¯å¯ä»¥ç»§ç»­æ‰§è¡Œä¸ºæ­¢ï¼Œè¿™æ—¶å°±ä¼šæ‰§è¡Œè¯¥åˆ†æ”¯ã€‚å½“å¤šä¸ªåˆ†æ”¯éƒ½å‡†å¤‡å¥½æ—¶ä¼šéšæœºé€‰æ‹©ä¸€ä¸ªæ‰§è¡Œã€‚ package mainimport fmtfunc fibonacci(c, quit chan int) x, y := 0, 1\tfor select // å°†å½“å‰çš„xå€¼å‘é€åˆ°é€šé“cï¼Œç„¶åè®¡ç®—ä¸‹ä¸€ä¸ªFibonacciæ•°åˆ—çš„å€¼ï¼ˆx, y = y, x+yï¼‰ case c - x: x, y = y, x+y // ä»é€šé“quitæ¥æ”¶å€¼ï¼Œå½“æ¥æ”¶åˆ°å€¼æ—¶ï¼Œæ‰“å°quitå¹¶è¿”å›ï¼Œç»“æŸå‡½æ•°æ‰§è¡Œ case -quit: fmt.Println(quit) return func main() c := make(chan int)\tquit := make(chan int) // å¯åŠ¨ä¸€ä¸ªæ–°çš„goroutineï¼Œåœ¨è¿™ä¸ªgoroutineä¸­ï¼Œä»é€šé“cæ¥æ”¶å¹¶æ‰“å°10ä¸ªFibonacciæ•°åˆ—çš„å€¼ï¼Œç„¶åå‘quité€šé“å‘é€ä¸€ä¸ªå€¼ã€‚\tgo func() for i := 0; i 10; i++ fmt.Println(-c) quit - 0\t()\tfibonacci(c, quit) defaultåˆ†æ”¯ å½“ select ä¸­çš„å…¶å®ƒåˆ†æ”¯éƒ½æ²¡æœ‰å‡†å¤‡å¥½æ—¶ï¼Œdefault åˆ†æ”¯å°±ä¼šæ‰§è¡Œã€‚ ä¸ºäº†åœ¨å°è¯•å‘é€æˆ–è€…æ¥æ”¶æ—¶ä¸å‘ç”Ÿé˜»å¡ï¼Œå¯ä½¿ç”¨ default åˆ†æ”¯ï¼š select case i := -c: // ä½¿ç”¨ idefault: // ä» c ä¸­æ¥æ”¶ä¼šé˜»å¡æ—¶æ‰§è¡Œ package mainimport (\tfmt\ttime)func main() tick := time.Tick(2000 * time.Millisecond)\tboom := time.After(5000 * time.Millisecond)\tfor select case -tick: fmt.Println(tick.) case -boom: fmt.Println(boom) return default: fmt.Println( .) time.Sleep(1000 * time.Millisecond) . .tick. . .tick. .boom","tags":[null],"categories":[null]},{"title":"Gitlabå®‰è£…","path":"/wiki/Kubernetes/Gitlabå®‰è£….html","content":"æ¦‚å¿µâ€ŒGitLabâ€Œ æ˜¯ä¸€ä¸ª â€ŒDevOps å¹³å°â€Œï¼Œé›†æˆäº† â€Œä»£ç æ‰˜ç®¡ï¼ˆGitï¼‰ã€CICDï¼ˆæŒç»­é›†æˆæŒç»­äº¤ä»˜ï¼‰ã€é¡¹ç›®ç®¡ç†ã€å®‰å…¨æ‰«æã€å®¹å™¨æ³¨å†Œè¡¨â€Œ ç­‰åŠŸèƒ½ï¼Œé€‚ç”¨äº â€Œè½¯ä»¶å¼€å‘çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸâ€Œï¼ˆä»ä»£ç ç¼–å†™åˆ°éƒ¨ç½²å’Œç»´æŠ¤ï¼‰ã€‚ GitLab çš„æ ¸å¿ƒåŠŸèƒ½1.â€Œä»£ç æ‰˜ç®¡ï¼ˆç±»ä¼¼ GitHubï¼‰ æ”¯æŒ â€ŒGit ç‰ˆæœ¬æ§åˆ¶â€Œï¼Œå…è®¸å¼€å‘å›¢é˜Ÿåä½œå¼€å‘ä»£ç ã€‚ æä¾› â€Œåˆ†æ”¯ç®¡ç†ã€ä»£ç å®¡æŸ¥ï¼ˆMerge Requestsï¼‰ã€æƒé™æ§åˆ¶â€Œ ç­‰åŠŸèƒ½ã€‚ 2.CICDï¼ˆæŒç»­é›†æˆæŒç»­äº¤ä»˜ï¼‰ å†…ç½® â€ŒGitLab CICDâ€Œï¼Œå¯ä»¥è‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²ä»£ç ã€‚ æ”¯æŒ â€ŒDockerã€Kubernetesâ€Œ é›†æˆï¼Œæ–¹ä¾¿äº‘åŸç”Ÿå¼€å‘ã€‚ 3.é¡¹ç›®ç®¡ç† æ•æ·å¼€å‘ æä¾› â€Œçœ‹æ¿ï¼ˆKanbanï¼‰ã€é—®é¢˜è·Ÿè¸ªï¼ˆIssuesï¼‰ã€é‡Œç¨‹ç¢‘ï¼ˆMilestonesï¼‰ç­‰åŠŸèƒ½ã€‚ æ”¯æŒ â€Œæ•æ·å¼€å‘ï¼ˆScrumï¼‰ã€DevOps æµç¨‹â€Œã€‚ 4.å®‰å…¨ åˆè§„æ€§ â€Œé™æ€ä»£ç åˆ†æï¼ˆSASTï¼‰ï¼ˆæ£€æŸ¥ä»£ç æ¼æ´ï¼‰ â€Œä¾èµ–æ‰«æï¼ˆSCAï¼‰ï¼ˆæ£€æŸ¥ç¬¬ä¸‰æ–¹åº“æ¼æ´ï¼‰ â€Œå®¹å™¨æ‰«æâ€Œï¼ˆæ£€æŸ¥ DockerK8s é•œåƒå®‰å…¨ï¼‰ â€Œåˆè§„æ€§æ£€æŸ¥â€Œï¼ˆç¡®ä¿ä»£ç ç¬¦åˆå®‰å…¨æ ‡å‡†ï¼‰ 5.å®¹å™¨æ³¨å†Œè¡¨ Artifact å­˜å‚¨ å†…ç½® â€ŒDocker é•œåƒä»“åº“â€Œï¼ˆç±»ä¼¼ Docker Hubï¼‰ æ”¯æŒ â€ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆArtifactsï¼‰å­˜å‚¨â€Œï¼ˆå¦‚ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ å®‰è£…helmæ·»åŠ chartshelm repo add gitlab-jh https://charts.gitlab.cn helm pull gitlab-jh/gitlab åˆ›å»ºå‘½åç©ºé—´kubectl create ns gitlab chartæ”¹é€ # å…¨å±€ä¸»æœºé…ç½®global: hosts: domain: dev.com # åŸŸååç¼€ï¼ŒGitLab URL å°†ä¸º gitlab.dev.com https: true # å¯ç”¨ HTTPS ingress: enabled: true # å¯ç”¨ Ingress configureCertmanager: false # ç¦ç”¨è‡ªåŠ¨ cert-managerï¼ˆä½¿ç”¨ç°æœ‰ TLS Secretï¼‰ tls: enabled: true # å¯ç”¨ TLS secretName: ingress-nginx-tls # ä½¿ç”¨ç°æœ‰ TLS Secret class: nginx # å‡è®¾ä½¿ç”¨ NGINX Ingress Classï¼ˆæ ¹æ®æ‚¨çš„é›†ç¾¤è°ƒæ•´ï¼‰ edition: ce # å®‰è£… Enterprise Editionï¼ˆå¦‚æœéœ€è¦ Community Editionï¼Œæ”¹ä¸º ceï¼‰gitlab: gitaly: persistence: storageClass: nfs-client-retain size: 2Gipostgresql: auth: secretKeys: userPasswordKey: postgresql-postgres-password primary: persistence: storageClass: nfs-client-retain size: 2Gi readReplicas: persistence: storageClass: nfs-client-retain size: 2Giredis: auth: usePasswordFiles: false master: persistence: storageClass: nfs-client size: 2Giminio: persistence: storageClass: nfs-client size: 2Gi # å¯é€‰ï¼šç¦ç”¨ä¸å¿…è¦çš„ç»„ä»¶ä»¥èŠ‚çœèµ„æºï¼ˆä¾‹å¦‚ Prometheusï¼‰prometheus: install: false # å¦‚æœä¸éœ€è¦ç›‘æ§ï¼Œç¦ç”¨ installCertmanager: falsenginx-ingress: enabled: false helm upgrade --install gitlab gitlab-jh/gitlab -n gitlab --version 9.2.1 -f values.yaml # rootåˆå§‹å¯†ç kubectl get secret --namespace gitlab gitlab-gitlab-initial-root-password -o jsonpath=.data.password | base64 --decode ; echo é…ç½® glagent-TNvvTkH-AdiyiMstQRaqKJnfHF8GsgGuF61o57RsNj4CWiLxYg helm repo add gitlab https://charts.gitlab.iohelm repo updatehelm upgrade â€“install gtilab-agent gitlabgitlab-agent â€“namespace gitlab-agent-gtilab-agent â€“create-namespace â€“set image.tagv18.2.0 â€“set config.tokenglagent-TNvvTkH-AdiyiMstQRaqKJnfHF8GsgGuF61o57RsNj4CWiLxYg â€“set config.kasAddresswss:kas.dev.com","tags":[null],"categories":[null]},{"title":"Haborå®‰è£…","path":"/wiki/Kubernetes/Haborå®‰è£….html","content":"Haboræ¦‚å¿µHarbor çš„ç›®æ ‡æ˜¯å¸®åŠ©ç”¨æˆ·è¿…é€Ÿæ­å»ºä¸€ä¸ªä¼ä¸šçº§çš„ Docker registry æœåŠ¡ã€‚å®ƒä»¥ Docker å…¬å¸å¼€æºçš„ registry ä¸ºåŸºç¡€ï¼Œé¢å¤–æä¾›äº†å¦‚ä¸‹åŠŸèƒ½: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶(Role Based Access Control) åŸºäºç­–ç•¥çš„é•œåƒå¤åˆ¶(Policy based image replication) é•œåƒçš„æ¼æ´æ‰«æ(Vulnerability Scanning) ADLDAP é›†æˆ(LDAPAD support) é•œåƒçš„åˆ é™¤å’Œç©ºé—´æ¸…ç†(Image deletion garbage collection) å‹å¥½çš„ç®¡ç† UI(Graphical user portal) å®¡è®¡æ—¥å¿—(Audit logging) RESTful API éƒ¨ç½²ç®€å•(Easy deployment) NFS å®‰è£…nfs-client-provisioneræ˜¯Kubernetesä¸­çš„ä¸€ä¸ªä¾›åº”å•†ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯â€ŒåŠ¨æ€æä¾›ç”±NFSï¼ˆNetwork File Systemï¼‰å…±äº«æ”¯æŒçš„æŒä¹…å·â€Œã€‚åœ¨Kubernetesé›†ç¾¤ä¸­ï¼ŒæŒä¹…å·æ˜¯ç‹¬ç«‹äºPodå­˜åœ¨çš„å­˜å‚¨èµ„æºï¼Œç”¨äºæŒä¹…åœ°å­˜å‚¨æ•°æ®ã€‚nfs-client-provisioneré€šè¿‡ä»¥ä¸‹æ–¹å¼å‘æŒ¥ä½œç”¨ï¼š â€Œè‡ªåŠ¨åŒ–åˆ›å»ºæŒä¹…å·â€Œï¼šå®ƒæ ¹æ®éœ€è¦è‡ªåŠ¨åŒ–åˆ›å»ºæŒä¹…å·ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œã€‚ â€Œä¸NFSæœåŠ¡å™¨äº¤äº’â€Œï¼šé€šè¿‡ä¸NFSæœåŠ¡å™¨è¿›è¡Œäº¤äº’ï¼Œå®ç°å­˜å‚¨çš„åŠ¨æ€åˆ†é…ã€‚ â€Œç®€åŒ–ç®¡ç†â€Œï¼šä½¿å¾—åœ¨Kubernetesé›†ç¾¤ä¸­ä¸ºåº”ç”¨ç¨‹åºåŠ¨æ€åˆ†é…å­˜å‚¨å˜å¾—æ›´åŠ ç®€å•ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†NFSå…±äº«å’ŒæŒä¹…å·çš„åˆ›å»ºè¿‡ç¨‹ã€‚ 1.æ·»åŠ å…±äº«ç›®å½• # æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œyum install -y nfs-utils rpcbind# ä»¥node1èŠ‚ç‚¹ä¸ºnfsæœåŠ¡ï¼Œåœ¨node1èŠ‚ç‚¹æ‰§è¡Œä¸‹åˆ—å‘½ä»¤mkdir /nfsdatachmod 666 /nfsdatachown nobody /nfsdatacd /nfsdata/echo /nfsdata *(rw,no_root_squash,no_all_squash,sync) /etc/exportssystemctl start rpcbindsystemctl start nfs-serversystemctl restart rpcbind# æŸ¥çœ‹æŒ‚è½½ç›®å½•showmount -e 10.37.129.10echo /nfsdata/share *(rw,no_root_squash,no_all_squash,sync) /etc/exportsmkdir -p /nfsdata/sharechown -R nobody /nfsdata/sharesystemctl enable nfs-server systemctl restart nfs-server systemctl restart rpcbindshowmount -e 10.37.129.10 2.åˆ›å»ºå‘½åç©ºé—´ kubectl create ns nfs-storageclass 3.éƒ¨ç½² nfs-client-provisioner apiVersion: apps/v1kind: Deploymentmetadata: name: nfs-client-provisioner namespace: nfs-storageclassspec: replicas: 1 selector: matchLabels: app: nfs-client-provisioner strategy: type: Recreate template: metadata: labels: app: nfs-client-provisioner spec: serviceAccountName: nfs-client-provisioner containers: - name: nfs-client-provisioner image: k8s.dockerproxy.com/sig-storage/nfs-subdir-external-provisioner:v4.0.2 volumeMounts: - name: nfs-client-root mountPath: /persistentvolumes env: - name: PROVISIONER_NAME value: k8s-sigs.io/nfs-subdir-external-provisioner - name: NFS_SERVER # value: YOUR NFS SERVER HOSTNAME value: 10.37.129.10 - name: NFS_PATH value: /nfsdata/share volumes: - name: nfs-client-root nfs: # value: YOUR NFS SERVER HOSTNAME server: 10.37.129.10 path: /nfsdata/share---apiVersion: v1kind: ServiceAccountmetadata: name: nfs-client-provisioner # replace with namespace where provisioner is deployed namespace: nfs-storageclass---kind: ClusterRoleapiVersion: rbac.authorization.k8s.io/v1metadata: name: nfs-client-provisioner-runnerrules:- apiGroups: [] resources: [nodes] verbs: [get, list, watch]- apiGroups: [] resources: [persistentvolumes] verbs: [get, list, watch, create, delete]- apiGroups: [] resources: [persistentvolumeclaims] verbs: [get, list, watch, update]- apiGroups: [storage.k8s.io] resources: [storageclasses] verbs: [get, list, watch]- apiGroups: [] resources: [events] verbs: [create, update, patch]---kind: ClusterRoleBindingapiVersion: rbac.authorization.k8s.io/v1metadata: name: run-nfs-client-provisionersubjects:- kind: ServiceAccount name: nfs-client-provisioner # replace with namespace where provisioner is deployed namespace: nfs-storageclassroleRef: kind: ClusterRole name: nfs-client-provisioner-runner apiGroup: rbac.authorization.k8s.io---kind: RoleapiVersion: rbac.authorization.k8s.io/v1metadata: name: leader-locking-nfs-client-provisioner # replace with namespace where provisioner is deployed namespace: nfs-storageclassrules:- apiGroups: [] resources: [endpoints] verbs: [get, list, watch, create, update, patch]---kind: RoleBindingapiVersion: rbac.authorization.k8s.io/v1metadata: name: leader-locking-nfs-client-provisioner namespace: nfs-storageclasssubjects:- kind: ServiceAccount name: nfs-client-provisioner # replace with namespace where provisioner is deployed namespace: nfs-storageclassroleRef: kind: Role name: leader-locking-nfs-client-provisioner apiGroup: rbac.authorization.k8s.io 4.åˆ›å»ºStorageClass apiVersion: storage.k8s.io/v1kind: StorageClassmetadata: name: nfs-client namespace: nfs-storageclassprovisioner: k8s-sigs.io/nfs-subdir-external-provisionerparameters: pathPattern: $.PVC.namespace/$.PVC.name onDelete: delete Ingress-Nginx å®‰è£…# æ·»åŠ  ingress-controllerhelm repo add ingress-nginx https://kubernetes.github.io/ingress-nginxhelm pull ingress-nginx/ingress-nginxtar -zxvf ingress-nginx-*tgzcd ingress-nginx# ä¿®æ”¹ values.yaml æ–‡ä»¶ä¿®æ”¹ hostNetwork çš„å€¼ä¸º truereplicaCountçš„å€¼ä¿®æ”¹ä¸ºï¼š2dnsPolicyçš„å€¼æ”¹ä¸º: ClusterFirstWithHostNetkindç±»å‹æ›´æ”¹ä¸ºï¼šDaemonSetå…³é—­æ‰€æœ‰é•œåƒçš„ digestä¿®æ”¹admissionWebhooks:port:8444ingressClassResource.default=truekubectl create ns ingresshelm install ingress-nginx -n ingress . -f values.yaml # tlsé…ç½®cd ~openssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj /CN=nginxsvc/O=nginxsvckubectl create secret tls ingress-nginx-tls --key tls.key --cert tls.crt Habor å®‰è£…1.åˆ›å»ºåç©ºé—´ cat namespace-harbor.yamlapiVersion: v1kind: Namespacemetadata: name: harborkubectl apply -f namespace-harbor.yaml 2.æ·»åŠ  helm repo cd /home/chahelm repo add harbor https://helm.goharbor.iohelm search repohelm pull harbor/harbortar zxf harbor-*.tgz # ä¿®æ”¹ skipUpdate: trueï¼Œæ·»åŠ å­˜å‚¨ç±» storageClass: nfs-client(æ‰€æœ‰éƒ½è¦ä¿®æ”¹)ï¼Œæ·»åŠ  tsl: tls.secret:secretName:ingress-nginx-tlshelm install harbor . -f values.yaml -n harbor# æ·»åŠ åŸŸååˆ°hostæ–‡ä»¶(ingress è¿è¡Œçš„nodeçš„IP)10.37.129.11 core.harbor.domain# é»˜è®¤è´¦å·/å¯†ç adminHarbor12345","tags":[null],"categories":[null]},{"title":"Helm","path":"/wiki/Kubernetes/Helm.html","content":"HELMHELM ä½œç”¨ â€Œç®€åŒ–éƒ¨ç½²æµç¨‹â€Œï¼šåœ¨ä½¿ç”¨Helmä¹‹å‰ï¼Œéƒ¨ç½²Kubernetesåº”ç”¨éœ€è¦æ‰‹åŠ¨åˆ›å»ºdeploymentã€svcç­‰èµ„æºï¼Œæ­¥éª¤ç¹çã€‚Helmé€šè¿‡æ‰“åŒ…æ–¹å¼ï¼Œç®€åŒ–äº†è¿™ä¸€è¿‡ç¨‹ã€‚ â€Œç‰ˆæœ¬ç®¡ç†â€Œï¼šHelmæ”¯æŒåº”ç”¨çš„ç‰ˆæœ¬ç®¡ç†ï¼Œæ–¹ä¾¿è¿½è¸ªå’Œæ§åˆ¶ä¸åŒç‰ˆæœ¬çš„å‘å¸ƒã€‚ â€ŒåŠ¨æ€ç”Ÿæˆèµ„æºæ¸…å•â€Œï¼šHelmèƒ½åŠ¨æ€ç”ŸæˆKubernetesèµ„æºæ¸…å•æ–‡ä»¶ï¼Œå¦‚â€Œdeployment.yamlâ€Œå’Œâ€Œservice.yamlâ€Œï¼Œå¹¶è‡ªåŠ¨æ‰§è¡Œéƒ¨ç½²ï¼Œæå‡äº†ç®¡ç†æ•ˆç‡ã€‚ â€Œå¯é…ç½®æ€§â€Œï¼šHelmè®©Kubernetesçš„åº”ç”¨ç®¡ç†å˜å¾—å¯é…ç½®ï¼Œé€‚åº”ä¸åŒç¯å¢ƒå’Œéœ€æ±‚ã€‚ HELMé‡è¦æ¦‚å¿µ â€ŒChartâ€Œï¼šæ˜¯åº”ç”¨éƒ¨ç½²çš„è‡ªåŒ…å«å•å…ƒï¼ŒåŒ…å«äº†åº”ç”¨çš„é…ç½®æ¨¡æ¿ã€å‚æ•°å®šä¹‰ã€ä¾èµ–å…³ç³»å’Œæ–‡æ¡£è¯´æ˜ç­‰ï¼Œå¯ä»¥å°†å…¶æƒ³è±¡æˆaptæˆ–yumä¸­çš„è½¯ä»¶åŒ…ã€‚ â€ŒReleaseâ€Œï¼šæ˜¯Chartçš„è¿è¡Œå®ä¾‹ï¼Œä»£è¡¨äº†ä¸€ä¸ªæ­£åœ¨Kubernetesé›†ç¾¤ä¸­è¿è¡Œçš„åº”ç”¨ã€‚åŒä¸€ä¸ªChartå¯ä»¥å¤šæ¬¡å®‰è£…åˆ°é›†ç¾¤ä¸­ï¼Œæ¯æ¬¡å®‰è£…éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„Releaseã€‚ â€ŒHelm CLIâ€Œï¼šæ˜¯Helmçš„å®¢æˆ·ç«¯ç»„ä»¶ï¼Œè´Ÿè´£ä¸Kubernetes APIè¿›è¡Œé€šä¿¡ï¼Œç”¨äºç®¡ç†Chartå’ŒReleaseã€‚ â€ŒRepositoryâ€Œï¼šç”¨äºå‘å¸ƒå’Œå­˜å‚¨Chartçš„ä»“åº“ï¼Œæ–¹ä¾¿ç”¨æˆ·æŸ¥æ‰¾å’Œä¸‹è½½æ‰€éœ€çš„Chartã€‚ HELMå¸¸ç”¨å‘½ä»¤HELM å®‰è£…curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3chmod 700 get_helm.sh./get_helm.sh åˆå§‹åŒ–# æŸ¥çœ‹ä»“åº“helm repo ls# æ·»åŠ ä»“åº“helm repo add bitnami https://charts.bitnami.com/bitnami# æŸ¥çœ‹ä»“åº“ä¸­æœ‰å“ªäº› charthelm search repo bitnami# æ›´æ–°ä»“åº“helm repo update# ç§»é™¤ä»“åº“ helm repo remove chartå®‰è£…# æ›´æ–°Helmä»“åº“ç´¢å¼•ï¼Œç¡®å®šæˆ‘ä»¬å¯ä»¥æ‹¿åˆ°æœ€æ–°çš„ charts åˆ—è¡¨helm repo update# æ˜¾ç¤ºbitnami/apache chartçš„é»˜è®¤é…ç½®å€¼helm show values bitnami/apache# å®‰è£…bitnami/apache chartå¹¶è‡ªåŠ¨ç”Ÿæˆå‘å¸ƒåç§°helm install bitnami/apache --generate-name# åˆ—å‡ºåœ¨ Kubernetes é›†ç¾¤ä¸­ default å‘½åç©ºé—´ä¸‹å®‰è£…çš„æ‰€æœ‰ Helm releaseï¼ˆå‘å¸ƒç‰ˆæœ¬ï¼‰ã€‚helm list -n default# æ˜¾ç¤ºbitnami/apache Chartçš„åŸºæœ¬ä¿¡æ¯å’Œå…ƒæ•°æ®helm show chart bitnami/apache# æ˜¾ç¤ºè¯¥Chartçš„æ‰€æœ‰è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬Chartå®šä¹‰ã€valuesé…ç½®ã€READMEæ–‡æ¡£ç­‰å®Œæ•´å†…å®¹helm show all bitnami/apache å¯ä»¥çœ‹åˆ°åœ¨k8sé›†ç¾¤ä¸­æˆåŠŸéƒ¨ç½²äº†ä¸€ä¸ª podã€‚ æ›´å¤šå®‰è£…æ–¹æ³•ï¼š helm install å‘½ä»¤å¯ä»¥ä»å¤šä¸ªæ¥æºè¿›è¡Œå®‰è£…ã€‚ chart çš„ä»“åº“ï¼ˆå¦‚ä¸Šæ‰€è¿°ï¼‰ æœ¬åœ° chart å‹ç¼©åŒ…ï¼ˆ helm install foo foo-0.1.1.tgzï¼‰ è§£å‹åçš„ chart ç›®å½•ï¼ˆ helm install foo pathtofooï¼‰ å®Œæ•´çš„ URLï¼ˆ helm install foo https://example.com/charts/foo-1.2.3.tgzï¼‰ releaseåˆ é™¤# è¯¥å‘½ä»¤ä¼šä»Kuberneteså¸è½½ apache-1753340573 å®ƒå°†åˆ é™¤å’Œè¯¥ç‰ˆæœ¬ç›¸å…³çš„æ‰€æœ‰ç›¸å…³èµ„æºï¼ˆserviceã€deploymentã€ podç­‰ç­‰ï¼‰ç”šè‡³ç‰ˆæœ¬å†å²helm uninstall apache-1753340573 --keep-history # é€‰é¡¹ï¼Œ Helm å°†ä¼šä¿å­˜ç‰ˆæœ¬å†å²# æŸ¥çœ‹è¯¥ç‰ˆæœ¬çš„å½“å‰çŠ¶æ€ä¿¡æ¯helm status apache-1753340573 helm v2 ç‰ˆæœ¬ä¸­ï¼Œå½“ä¸€ä¸ª release è¢«åˆ é™¤ï¼Œä¼šä¿ç•™ä¸€æ¡åˆ é™¤è®°å½•ã€‚è€Œåœ¨ Helm 3 ä¸­ï¼Œåˆ é™¤ä¹Ÿä¼šç§»é™¤ release çš„è®°å½•ã€‚ å¦‚æœæƒ³ä¿ç•™åˆ é™¤è®°å½•ï¼Œä½¿ç”¨ helm uninstall --keep-historyã€‚ä½¿ç”¨ helm list --uninstalled åªä¼šå±•ç¤ºä½¿ç”¨äº† --keep-history åˆ é™¤çš„ releaseã€‚ helm list --all ä¼šå±•ç¤º Helm ä¿ç•™çš„æ‰€æœ‰ release è®°å½•ï¼ŒåŒ…æ‹¬å¤±è´¥æˆ–åˆ é™¤çš„æ¡ç›®ï¼ˆæŒ‡å®šäº† â€“keep-historyï¼‰ã€‚ è‡ªå®šä¹‰chartå®‰è£…# æ˜¾ç¤ºbitnami/apache chartçš„é»˜è®¤é…ç½®å€¼helm show values bitnami/apachevi values.yamlhelm install -f values.yaml bitnami/apache --generate-name å®‰è£…è¿‡ç¨‹ä¸­æœ‰ä¸¤ç§æ–¹å¼ä¼ é€’é…ç½®æ•°æ®ï¼š --values (æˆ– -f)ï¼šä½¿ç”¨ YAML æ–‡ä»¶è¦†ç›–é…ç½®ã€‚å¯ä»¥æŒ‡å®šå¤šæ¬¡ï¼Œä¼˜å…ˆä½¿ç”¨æœ€å³è¾¹çš„æ–‡ä»¶ã€‚ --setï¼šé€šè¿‡å‘½ä»¤è¡Œçš„æ–¹å¼å¯¹æŒ‡å®šé¡¹è¿›è¡Œè¦†ç›–ã€‚ å¦‚æœåŒæ—¶ä½¿ç”¨ä¸¤ç§æ–¹å¼ï¼Œåˆ™ --set ä¸­çš„å€¼ä¼šè¢«åˆå¹¶åˆ° --values ä¸­ï¼Œä½†æ˜¯ --set ä¸­çš„å€¼ä¼˜å…ˆçº§æ›´é«˜ã€‚ åœ¨ --set ä¸­è¦†ç›–çš„å†…å®¹ä¼šè¢«è¢«ä¿å­˜åœ¨ ConfigMap ä¸­ã€‚å¯ä»¥é€šè¿‡ helm get values release-name æ¥æŸ¥çœ‹æŒ‡å®š release ä¸­ --set è®¾ç½®çš„å€¼ã€‚ä¹Ÿå¯ä»¥é€šè¿‡è¿è¡Œ helm upgrade å¹¶æŒ‡å®š --reset-values å­—æ®µæ¥æ¸…é™¤ --set ä¸­è®¾ç½®çš„å€¼ã€‚ --set çš„æ ¼å¼å’Œé™åˆ¶ï¼š --set é€‰é¡¹ä½¿ç”¨ 0 æˆ–å¤šä¸ª name/value å¯¹ã€‚æœ€ç®€å•çš„ç”¨æ³•ç±»ä¼¼äºï¼š--set name=valueï¼Œç­‰ä»·äºå¦‚ä¸‹YAML æ ¼å¼ï¼š name: value å¤šä¸ªå€¼ä½¿ç”¨é€—å·åˆ†å‰²ï¼Œå› æ­¤ --set a=b,c=d çš„ YAML è¡¨ç¤ºæ˜¯ï¼š a: bc: d æ”¯æŒæ›´å¤æ‚çš„è¡¨è¾¾å¼ã€‚ ä¾‹å¦‚ï¼Œ--set outer.inner=value è¢«è½¬æ¢æˆäº†ï¼š outer: inner: value åˆ—è¡¨ä½¿ç”¨èŠ±æ‹¬å· æ¥è¡¨ç¤ºã€‚ ä¾‹å¦‚ï¼Œ--set name=a, b, c è¢«è½¬æ¢æˆäº†ï¼š name: - a - b - c æŸäº› name/key å¯ä»¥è®¾ç½®ä¸º null æˆ–è€…ç©ºæ•°ç»„ã€‚ ä¾‹å¦‚ --set name=[],a=null name: []a: null ä» 2.5.0 ç‰ˆæœ¬å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨æ•°ç»„ä¸‹æ ‡çš„è¯­æ³•æ¥è®¿é—®åˆ—è¡¨ä¸­çš„å…ƒç´ ã€‚ ä¾‹å¦‚ --set servers[0].port=80 servers: - port: 80 å¤šä¸ªå€¼ä¹Ÿå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥è®¾ç½®ã€‚ --set servers[0].port=80,servers[0].host=example servers: - port: 80 host: example å¦‚æœéœ€è¦åœ¨ --set ä¸­ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ï¼Œä½ å¯ä»¥ä½¿ç”¨åæ–œçº¿æ¥è¿›è¡Œè½¬ä¹‰ï¼› --set name=value1\\,value2 name: value1,value2 --set nodeSelector.kubernetes.io/role=master nodeSelector: kubernetes.io/role: master release å‡çº§helm upgrade [RELEASE] [CHART] [flags]åŠŸèƒ½è¯´æ˜ï¼š- helm upgrade ç”¨äºå‡çº§å·²å®‰è£…çš„ Helm releaseï¼ˆå‘å¸ƒç‰ˆæœ¬ï¼‰- å°†ç°æœ‰çš„ chartï¼ˆå›¾è¡¨ï¼‰å‡çº§åˆ°æ–°ç‰ˆæœ¬- å¯ä»¥æ›´æ–°é…ç½®å€¼ã€å‡çº§åˆ°æ–°çš„ chart ç‰ˆæœ¬- é€šå¸¸éœ€è¦æŒ‡å®š release åç§°å’Œ chart è·¯å¾„æˆ–åç§° helm upgrade -f 2-values.yaml apache-1753344736 bitnami/apache# ç”¨äºæ£€ç´¢æŒ‡å®š Release çš„ values å€¼helm get values apache-1753344736 release å›æ»šhelm rollback [RELEASE] [REVISION]åŠŸèƒ½è§£é‡Šï¼šhelm rollback ç”¨äºå°†å·²éƒ¨ç½²çš„Helm releaseå›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬ã€‚å½“å‰éƒ¨ç½²çš„åº”ç”¨å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å‘½ä»¤å¿«é€Ÿæ¢å¤åˆ°å†å²ç‰ˆæœ¬ã€‚éœ€è¦æŒ‡å®šreleaseåç§°å’Œç›®æ ‡ç‰ˆæœ¬å·æ¥æ‰§è¡Œå›æ»šæ“ä½œã€‚ # æŸ¥çœ‹å†å²ç‰ˆæœ¬helm history apache-1753344736# å›æ»šç‰ˆæœ¬helm rollback apache-1753344736 1 ä¸Šé¢è¿™æ¡å‘½ä»¤å°†æˆ‘ä»¬çš„ apache-1753344736 å›æ»šåˆ°äº†å®ƒæœ€åˆçš„ç‰ˆæœ¬ã€‚release ç‰ˆæœ¬å…¶å®æ˜¯ä¸€ä¸ªå¢é‡ä¿®è®¢ï¼ˆrevisionï¼‰ã€‚ æ¯å½“å‘ç”Ÿäº†ä¸€æ¬¡å®‰è£…ã€å‡çº§æˆ–å›æ»šæ“ä½œï¼Œrevision çš„å€¼å°±ä¼šåŠ 1ã€‚ç¬¬ä¸€æ¬¡ revision çš„å€¼æ°¸è¿œæ˜¯1ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ helm history [RELEASE] å‘½ä»¤æ¥æŸ¥çœ‹ä¸€ä¸ªç‰¹å®š release çš„ä¿®è®¢ç‰ˆæœ¬å·ã€‚ å‡çº§å›æ»šé¢å¤–é€‰é¡¹--timeoutï¼šä¸€ä¸ª Go duration ç±»å‹çš„å€¼ï¼Œ ç”¨æ¥è¡¨ç¤ºç­‰å¾… Kubernetes å‘½ä»¤å®Œæˆçš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼ä¸º 5m0sã€‚such as â€œ300msâ€, â€œ-1.5hâ€ or â€œ2h45mâ€. Validtime units are â€œnsâ€, â€œusâ€ (or â€œÂµsâ€),â€msâ€, â€œsâ€, â€œmâ€, â€œhâ€ã€‚ --waitï¼šè¡¨ç¤ºå¿…é¡»è¦ç­‰åˆ°æ‰€æœ‰çš„ Pods éƒ½å¤„äº ready çŠ¶æ€ï¼ŒPVC éƒ½è¢«ç»‘å®šï¼ŒDeployments éƒ½è‡³å°‘æ‹¥æœ‰æœ€å° ready çŠ¶æ€ Pods ä¸ªæ•°ï¼ˆDesiredå‡å» maxUnavailableï¼‰ï¼Œå¹¶ä¸” Services éƒ½å…·æœ‰ IP åœ°å€ï¼ˆå¦‚æœæ˜¯LoadBalancerï¼Œ åˆ™ä¸º Ingressï¼‰ï¼Œæ‰ä¼šæ ‡è®°è¯¥ release ä¸ºæˆåŠŸã€‚æœ€é•¿ç­‰å¾…æ—¶é—´ç”± â€“timeout å€¼æŒ‡å®šã€‚å¦‚æœè¾¾åˆ°è¶…æ—¶æ—¶é—´ï¼Œrelease å°†è¢«æ ‡è®°ä¸º FAILEDã€‚æ³¨æ„ï¼šå½“ Deployment çš„replicas è¢«è®¾ç½®ä¸º1ï¼Œä½†å…¶æ»šåŠ¨å‡çº§ç­–ç•¥ä¸­çš„ maxUnavailable æ²¡æœ‰è¢«è®¾ç½®ä¸º0æ—¶ï¼Œâ€“wait å°†è¿”å›å°±ç»ªï¼Œå› ä¸ºå·²ç»æ»¡è¶³äº†æœ€å° ready Pod æ•°ã€‚ --no-hooksï¼šä¸è¿è¡Œå½“å‰å‘½ä»¤çš„é’©å­ï¼Œå³ä¸ºå®‰è£…æ­¤ chart æ—¶çš„å·²å®šä¹‰çš„å®‰è£…å‰æˆ–è€…å®‰è£…åçš„åŠ¨ä½œã€‚ åˆ›å»ºcharthttps://helm.sh/zh/docs/chart_template_guide/getting_started/ helm create myapp â€ŒChart.yamlâ€Œï¼šå®šä¹‰äº†Helm Chartçš„å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬Chartçš„åç§°ã€ç‰ˆæœ¬ã€æè¿°ç­‰åŸºæœ¬ä¿¡æ¯ã€‚ â€Œvalues.yamlâ€Œï¼šåŒ…å«äº†Chartçš„é»˜è®¤é…ç½®å€¼å’Œç”¨æˆ·å¯è‡ªå®šä¹‰çš„å‚æ•°ï¼Œç”¨äºé…ç½®éƒ¨ç½²æ—¶çš„å„ç§é€‰é¡¹ã€‚ charts: åŒ…å«äº†è¯¥ chart ä¾èµ–çš„ chartã€‚ â€Œtemplatesç›®å½•â€Œï¼š NOTEX.txtï¼šchart è¯´æ˜æ–‡ä»¶ã€‚ â€Œdeployment.yamlâ€Œï¼šå®šä¹‰äº†Kubernetesçš„éƒ¨ç½²èµ„æºï¼Œç”¨äºæŒ‡å®šPodçš„æ¨¡æ¿ã€å‰¯æœ¬æ•°ç­‰ã€‚ â€Œservice.yamlâ€Œï¼šå®šä¹‰äº†æœåŠ¡èµ„æºï¼Œç”¨äºæš´éœ²Podçš„è®¿é—®æ–¹å¼ã€‚ â€Œingress.yamlâ€Œï¼šå®šä¹‰äº†Ingressèµ„æºï¼Œç”¨äºç®¡ç†å¤–éƒ¨è®¿é—®æœåŠ¡çš„è§„åˆ™ã€‚ â€Œhpa.yamlâ€Œï¼šå®šä¹‰äº†æ°´å¹³Podè‡ªåŠ¨æ‰©å±•ï¼ˆHPAï¼‰è§„åˆ™ï¼Œæ ¹æ®èµ„æºåˆ©ç”¨ç‡è‡ªåŠ¨è°ƒæ•´Podæ•°é‡ã€‚ â€Œserviceaccount.yamlâ€Œï¼šå®šä¹‰äº†æœåŠ¡è´¦æˆ·ï¼Œç”¨äºPodçš„èº«ä»½éªŒè¯å’Œæˆæƒã€‚ â€Œtestsç›®å½•â€Œï¼šåŒ…å«æµ‹è¯•æ–‡ä»¶ï¼Œå¦‚â€Œtest-connection.yamlâ€Œï¼Œç”¨äºéªŒè¯éƒ¨ç½²åçš„æœåŠ¡è¿æ¥æ˜¯å¦æ­£å¸¸ã€‚ rm -rf values.yamlrm -rf templates/* cd templatesvi NOTES.txtvi deployment.yamlvi service.yamlcd ..vi values.yamlhelm install myapp-chart myapp/ NOTES.txt 1ã€è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•çš„ myapp chart2ã€myapp release åå­—ï¼šmyapp-test- now | date 20060102030405 -deploy3ã€service åå­—ï¼šmyapp-test- now | date 20060102030405 -svc deployment.yaml apiVersion: apps/v1kind: Deploymentmetadata: labels: app: myapp-test name: myapp-test- now | date 20060102030405 -deployspec: replicas: .Values.replicaCount selector: matchLabels: app: myapp-test template: metadata: labels: app: myapp-test spec: containers: - image: .Values.image.repository : .Values.image.tag name: myapp service.yaml apiVersion: v1kind: Servicemetadata: labels: app: myapp-test name: myapp-test- now | date 20060102030405 -svcspec: ports: - name: 80-80 port: 80 protocol: TCP targetPort: 80 - if eq .Values.service.type NodePort nodePort: .Values.service.nodeport - end selector: app: myapp-test type: .Values.service.type | quote values.yaml # Default values for myapp.# This is a YAML-formatted file.# Declare variables to be passed into your templates.replicaCount: 5image: repository: wangyanglinux/myapp tag: v1.0service: type: NodePort nodeport: 32321","tags":[null],"categories":[null]},{"title":"Ingress","path":"/wiki/Kubernetes/Ingress.html","content":"IngressIngress çš„å®šä¹‰Ingress æ˜¯ Kubernetes ä¸­çš„ä¸€ç§ â€ŒAPI èµ„æºå¯¹è±¡â€Œï¼Œç”¨äºç®¡ç†é›†ç¾¤å¤–éƒ¨å¯¹å†…éƒ¨æœåŠ¡çš„ HTTPHTTPS è®¿é—®ã€‚å®ƒé€šè¿‡å®šä¹‰è·¯ç”±è§„åˆ™ï¼Œå°†å¤–éƒ¨è¯·æ±‚å®šå‘åˆ°é›†ç¾¤å†…ä¸åŒçš„ Serviceï¼Œå……å½“é›†ç¾¤çš„â€œæ™ºèƒ½å…¥å£ç½‘å…³â€â€Œã€‚ â€Œè¯æºâ€Œï¼šæºè‡ªæ‹‰ä¸è¯­â€œingressusâ€ï¼Œæ„ä¸ºâ€œè¿›å…¥æƒâ€æˆ–â€œå‡†å…¥æœºåˆ¶â€â€Œã€‚ â€Œå®šä½â€Œï¼šå±äº OSI ä¸ƒå±‚ï¼ˆåº”ç”¨å±‚ï¼‰ä»£ç†ï¼Œä¸“æ³¨äº HTTPHTTPS æµé‡çš„è·¯ç”±ä¸æ§åˆ¶â€Œã€‚ Ingress æ ¸å¿ƒåŠŸèƒ½ â€Œè·¯ç”±è§„åˆ™â€Œ åŸºäº â€ŒåŸŸåâ€Œï¼ˆå¦‚ example.comï¼‰æˆ– â€Œè·¯å¾„â€Œï¼ˆå¦‚ /apiï¼‰å°†è¯·æ±‚åˆ†å‘åˆ°ä¸åŒåç«¯æœåŠ¡â€Œã€‚ æ”¯æŒå¤šè·¯å¾„æ˜ å°„åˆ°åŒä¸€ Service çš„ä¸åŒç«¯å£â€Œã€‚ â€Œè´Ÿè½½å‡è¡¡â€Œ è‡ªåŠ¨å°†æµé‡å‡è¡¡åˆ†é…åˆ°åç«¯ Podï¼Œæ”¯æŒè½®è¯¢ã€æœ€å°è¿æ¥æ•°ç­‰ç­–ç•¥â€Œã€‚ â€ŒSSLTLS ç»ˆæ­¢â€Œ åœ¨ä»£ç†å±‚è§£å¯† HTTPS æµé‡ï¼Œå‡è½»åç«¯æœåŠ¡å‹åŠ›â€Œã€‚ â€Œç»Ÿä¸€å…¥å£ç®¡ç†â€Œ æ›¿ä»£å¤šä¸ª NodePortLoadBalancerï¼Œé™ä½äº‘æœåŠ¡æˆæœ¬â€Œã€‚ Ingress æ¶æ„ä¸å·¥ä½œåŸç† â€Œç»„æˆç»„ä»¶â€Œ â€ŒIngress èµ„æºâ€Œï¼šYAML å®šä¹‰çš„è§„åˆ™ï¼ˆå¦‚è·¯ç”±ã€TLS é…ç½®ï¼‰â€Œã€‚ â€ŒIngress Controllerâ€Œï¼šå®é™…æ‰§è¡Œè§„åˆ™çš„ç»„ä»¶ï¼ˆå¦‚ Nginxã€Envoyï¼‰ï¼Œç›‘å¬è§„åˆ™å˜åŒ–å¹¶åŠ¨æ€æ›´æ–°ä»£ç†é…ç½®â€Œã€‚ â€Œå·¥ä½œæµç¨‹â€Œ ç”¨æˆ·åˆ›å»º Ingress èµ„æºåï¼ŒController ç›‘å¬ API Server çš„å˜æ›´ã€‚ Controller æ ¹æ®è§„åˆ™ç”Ÿæˆä»£ç†é…ç½®ï¼ˆå¦‚ Nginx çš„ nginx.confï¼‰å¹¶åº”ç”¨â€Œã€‚ æµé‡ç» Controller è½¬å‘è‡³åç«¯ Service å¯¹åº”çš„ Podâ€Œã€‚ Ingress å…¸å‹åº”ç”¨åœºæ™¯ â€Œå¤šæœåŠ¡ç»Ÿä¸€å…¥å£â€Œ é€šè¿‡ä¸åŒåŸŸåæˆ–è·¯å¾„æš´éœ²å¤šä¸ªå¾®æœåŠ¡ï¼ˆå¦‚ api.example.com å’Œ admin.example.comï¼‰ã€‚ â€ŒHTTPS å®‰å…¨æ¥å…¥â€Œ é›†ä¸­ç®¡ç† TLS è¯ä¹¦ï¼Œå®ç°å…¨ç«™ HTTPSâ€Œã€‚ â€Œç°åº¦å‘å¸ƒâ€Œ åŸºäº Header æˆ– Cookie å°†éƒ¨åˆ†æµé‡å¯¼æµåˆ°æ–°ç‰ˆæœ¬æœåŠ¡â€Œã€‚ ä¸ Service ç»„ä»¶çš„å¯¹æ¯” â€Œç‰¹æ€§â€Œ â€ŒIngress â€ŒService (NodePortLB) â€Œåè®®æ”¯æŒâ€Œ HTTPHTTPSï¼ˆä¸ƒå±‚ï¼‰â€Œ TCPUDPï¼ˆå››å±‚ï¼‰â€Œ â€Œè·¯ç”±èƒ½åŠ›â€Œ æ”¯æŒåŸŸåã€è·¯å¾„ç­‰é«˜çº§è·¯ç”±â€Œ ä»…æ”¯æŒç«¯å£æ˜ å°„â€Œ â€Œé€‚ç”¨åœºæ™¯â€Œ Web åº”ç”¨ã€API ç½‘å…³â€Œ æ•°æ®åº“ã€é HTTP æœåŠ¡â€Œ Ingress æ³¨æ„äº‹é¡¹ â€ŒIngress Controller éå†…ç½®â€Œï¼šéœ€é¢å¤–éƒ¨ç½²ï¼ˆå¦‚ Nginx Ingress Controllerï¼‰â€Œã€‚ â€Œæ€§èƒ½ç“¶é¢ˆâ€Œï¼šé«˜å¹¶å‘åœºæ™¯éœ€ä¼˜åŒ– Controller èµ„æºé…ç½®ï¼ˆå¦‚ CPUå†…å­˜ï¼‰â€Œã€‚ â€Œæœªæ¥æ¼”è¿›â€Œï¼šKubernetes æ­£é€æ­¥å°†åŠŸèƒ½è¿ç§»è‡³ â€ŒGateway APIâ€Œâ€Œã€‚ å®ç°ä¸ƒå±‚è´Ÿè½½æ‰‹åŠ¨å®ç° åŸºäº ingress Ingress-Nginxæ¶æ„åŸç†å›¾ å®‰è£…helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginxhelm pull ingress-nginx/ingress-nginx# ä¿®æ”¹ values.yaml æ–‡ä»¶ä¿®æ”¹ hostNetwork çš„å€¼ä¸º truereplicaCountçš„å€¼ä¿®æ”¹ä¸ºï¼š2dnsPolicyçš„å€¼æ”¹ä¸º: ClusterFirstWithHostNetkindç±»å‹æ›´æ”¹ä¸ºï¼šDaemonSetå…³é—­æ‰€æœ‰é•œåƒçš„ digestingressClassResource.default=truekubectl create ns ingresshelm install ingress-nginx -n ingress . -f values.yaml # æ·»åŠ åŸŸååˆ°hostæ–‡ä»¶(ingress è¿è¡Œçš„nodeçš„IP)10.37.129.11 www1.k8s.com HTTP ä»£ç†apiVersion: apps/v1kind: Deploymentmetadata: name: ingress-httpproxy-www1spec: replicas: 2 selector: matchLabels: hostname: www1 template: metadata: labels: hostname: www1 spec: containers: - name: nginx image: wangyanglinux/myapp:v1.0 imagePullPolicy: IfNotPresent ports: - containerPort: 80---apiVersion: v1kind: Servicemetadata: name: ingress-httpproxy-www1spec: ports: - port: 80 targetPort: 80 protocol: TCP selector: hostname: www1---apiVersion: networking.k8s.io/v1kind: Ingressmetadata: name: ingress-httpproxy-www1spec: ingressClassName: nginx rules: - host: www1.k8s.com http: paths: - path: / pathType: Prefix backend: service: name: ingress-httpproxy-www1 port: number: 80 â€Œä¾èµ–å‰æâ€Œï¼š é›†ç¾¤å·²éƒ¨ç½² Nginx Ingress ControlleråŸŸåå·²æ­£ç¡®è§£æåˆ° Ingress Controller çš„ IP åœ°å€é•œåƒä»“åº“å¯è®¿é—®ï¼ˆæˆ–æœ¬åœ°å·²æœ‰è¯¥é•œåƒï¼‰ â€ŒDeployment é…ç½®â€Œï¼š éƒ¨ç½²åä¸º ingress-httpproxy-www1 çš„åº”ç”¨è¿è¡Œ 2 ä¸ªå‰¯æœ¬çš„ Nginx å®¹å™¨ï¼ˆé•œåƒ wangyanglinuxmyapp:v1.0ï¼‰æ¯ä¸ªå®¹å™¨æš´éœ² 80 ç«¯å£ï¼Œä½¿ç”¨æ ‡ç­¾ hostname: www1 è¿›è¡Œç®¡ç† â€ŒService é…ç½®â€Œï¼š åˆ›å»ºåŒå Service ä½œä¸ºé›†ç¾¤å†…è®¿é—®å…¥å£å°†å¤–éƒ¨ 80 ç«¯å£æµé‡è½¬å‘åˆ°å®¹å™¨ 80 ç«¯å£é€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨å…³è”åˆ° Deployment ç®¡ç†çš„ Pod â€ŒIngress é…ç½®â€Œï¼š ä½¿ç”¨ Nginx Ingress Controller å¤„ç†å¤–éƒ¨æµé‡å®šä¹‰åŸŸå www1.k8s.com çš„è·¯ç”±è§„åˆ™å°†æ‰€æœ‰è·¯å¾„ï¼ˆï¼‰çš„ HTTP è¯·æ±‚è½¬å‘åˆ°å¯¹åº”çš„ Service â€Œå®Œæ•´å·¥ä½œæµç¨‹â€Œï¼š å¤–éƒ¨ç”¨æˆ·è®¿é—® www1.k8s.com â†’ è¯·æ±‚åˆ°è¾¾ Ingress Controller â†’ æ ¹æ®è§„åˆ™è½¬å‘åˆ° Service â†’ æœ€ç»ˆç”± Deployment ç®¡ç†çš„ Pod å¤„ç† HTTPS ä»£ç†openssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj /CN=nginxsvc/O=nginxsvckubectl create secret tls ingress-nginx-tls --key tls.key --cert tls.crt apiVersion: apps/v1kind: Deploymentmetadata: name: ingress-httpproxy-sslspec: replicas: 2 selector: matchLabels: hostname: ssl template: metadata: labels: hostname: ssl spec: containers: - name: nginx image: wangyanglinux/myapp:v3.0 imagePullPolicy: IfNotPresent ports: - containerPort: 80---apiVersion: v1kind: Servicemetadata: name: ingress-httpproxy-sslspec: ports: - port: 80 targetPort: 80 protocol: TCP selector: hostname: ssl---apiVersion: networking.k8s.io/v1kind: Ingressmetadata: name: ingress-httpproxy-ssl namespace: default annotations: nginx.ingress.kubernetes.io/ssl-redirect: truespec: ingressClassName: nginx rules: - host: ssl.k8s.com http: paths: - path: / pathType: Prefix backend: service: name: ingress-httpproxy-ssl port: number: 80 tls: - hosts: - ssl.k8s.com secretName: ingress-nginx-tls è¯¥é…ç½®åŒ…å«ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š â€ŒDeploymentâ€Œï¼šéƒ¨ç½² 2 ä¸ªå‰¯æœ¬çš„ Nginx å®¹å™¨ï¼ˆv3.0 ç‰ˆæœ¬ï¼‰ï¼Œé€šè¿‡æ ‡ç­¾ hostname: ssl ç®¡ç†â€Œã€‚ â€ŒServiceâ€Œï¼šæä¾›ç¨³å®šçš„é›†ç¾¤å†…è®¿é—®å…¥å£ï¼Œå°† 80 ç«¯å£æµé‡è½¬å‘åˆ° Podâ€Œã€‚ â€ŒIngressï¼š å¼ºåˆ¶ HTTPS é‡å®šå‘ï¼ˆé€šè¿‡ ssl-redirect: true æ³¨è§£ï¼‰ã€‚ ä½¿ç”¨é¢„åˆ›å»ºçš„ TLS è¯ä¹¦ Secretï¼ˆingress-nginx-tlsï¼‰ä¸ºåŸŸå ssl.xinxianghf.com æä¾› HTTPS æ”¯æŒâ€Œã€‚ é€šè¿‡ Nginx Ingress Controller å¤„ç†ä¸ƒå±‚è·¯ç”±â€Œã€‚ â€Œéƒ¨ç½²å‰æâ€Œï¼š éœ€æå‰åˆ›å»ºåŒ…å«æœ‰æ•ˆè¯ä¹¦çš„ Secretï¼škubectl create secret tls ingress-nginx-tls --cert=tls.crt --key=tls.keyã€‚ ç¡®ä¿åŸŸåè§£ææŒ‡å‘ Ingress Controller çš„å¤–éƒ¨ IPâ€Œã€‚ é›†ç¾¤å·²å®‰è£… Nginx Ingress Controllerã€‚","tags":[null],"categories":[null]},{"title":"Jenkinså®‰è£…","path":"/wiki/Kubernetes/Jenkinså®‰è£….html","content":"Jenkins æ˜¯ä¸€æ¬¾å¼€æºçš„ â€ŒæŒç»­é›†æˆä¸æŒç»­äº¤ä»˜ï¼ˆCICDï¼‰ å·¥å…·ï¼Œç”¨äºè‡ªåŠ¨åŒ–è½¯ä»¶å¼€å‘æµç¨‹ä¸­çš„æ„å»ºã€æµ‹è¯•ã€éƒ¨ç½²ç­‰ä»»åŠ¡ã€‚ ç®€ä»‹æ ¸å¿ƒåŠŸèƒ½ä¸å®šä½ â€Œè‡ªåŠ¨åŒ–æµæ°´çº¿â€Œï¼šé€šè¿‡ç›‘å¬ä»£ç ä»“åº“ï¼ˆå¦‚ Gitï¼‰çš„å˜æ›´ï¼Œè‡ªåŠ¨è§¦å‘æ„å»ºã€æµ‹è¯•ã€æ‰“åŒ…å’Œéƒ¨ç½²æµç¨‹ï¼Œå®ç°ä»£ç æäº¤åçš„å…¨è‡ªåŠ¨åŒ–å¤„ç†â€Œã€‚ â€Œå¤šç¯å¢ƒæ”¯æŒâ€Œï¼šæ”¯æŒé€šè¿‡ç³»ç»ŸåŒ…ã€Docker æˆ– Java ç‹¬ç«‹ç¨‹åºè¿è¡Œï¼Œé€‚é…ä¸åŒæ“ä½œç³»ç»Ÿå’Œå¼€å‘ç¯å¢ƒâ€Œã€‚ â€Œæ’ä»¶ç”Ÿæ€â€Œï¼šæ‹¥æœ‰è¶…è¿‡ 1500 ä¸ªæ’ä»¶ï¼Œæ‰©å±•æ€§å¼ºï¼Œå¯é›†æˆ SonarQubeã€Dockerã€Kubernetes ç­‰å·¥å…·é“¾â€Œã€‚ æ¶æ„ä¸è®¾è®¡ç‰¹ç‚¹ â€Œä¸»ä»æ¶æ„â€Œï¼šæ”¯æŒåˆ†å¸ƒå¼æ„å»ºï¼Œä¸»èŠ‚ç‚¹ï¼ˆMasterï¼‰è°ƒåº¦ä»»åŠ¡ï¼Œä»èŠ‚ç‚¹ï¼ˆSlaveï¼‰æ‰§è¡Œå®é™…æ„å»ºï¼Œæå‡å¹¶è¡Œå¤„ç†èƒ½åŠ›â€Œã€‚ â€Œæ•°æ®å­˜å‚¨â€Œï¼šæ‰€æœ‰é…ç½®å’Œæ•°æ®ä»¥ XML æ ¼å¼å­˜å‚¨åœ¨ JENKINS_HOME ç›®å½•ï¼ˆé»˜è®¤ /var/lib/jenkinsï¼‰ï¼Œéœ€æ³¨æ„å¤‡ä»½ config.xml æ–‡ä»¶â€Œã€‚ å…¸å‹åº”ç”¨åœºæ™¯ â€ŒCICD æµç¨‹â€Œï¼š â€Œæ„å»ºé˜¶æ®µâ€Œï¼šç¼–è¯‘ä»£ç ã€ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚ â€Œæµ‹è¯•é˜¶æ®µâ€Œï¼šè‡ªåŠ¨åŒ–å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€‚ â€Œéƒ¨ç½²é˜¶æ®µâ€Œï¼šé€šè¿‡è„šæœ¬æˆ–å·¥å…·ï¼ˆå¦‚ Ansibleï¼‰å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒâ€Œã€‚ â€Œè¿ç»´æ‰©å±•â€Œï¼šæ”¯æŒå®šæ—¶ä»»åŠ¡ã€æ—¥å¿—æ”¶é›†ã€æœåŠ¡ç›‘æ§ç­‰éå¼€å‘åœºæ™¯â€Œã€‚ å®‰è£…helm repo add jenkinsci https://charts.jenkins.iohelm repo updatecd chartshelm pull jenkinsci/jenkins controller: # -- Used for label app.kubernetes.io/component componentName: jenkins-controller image: pullPolicy: IfNotPresent serviceType: NodePortinstallPlugins: []persistence: storageClass: nfs-client size: 8Gi kubectl create ns cicdhelm upgrade --install jenkins jenkinsci/jenkins \\ --namespace cicd \\ -f my-values.yaml 1. Get your admin user password by running: kubectl exec --namespace cicd -it svc/jenkins -c jenkins -- /bin/cat /run/secrets/additional/chart-admin-password echo2. Get the Jenkins URL to visit by running these commands in the same shell: export NODE_PORT=$(kubectl get --namespace cicd -o jsonpath=.spec.ports[0].nodePort services jenkins) export NODE_IP=$(kubectl get nodes --namespace cicd -o jsonpath=.items[0].status.addresses[0].address) echo http://$NODE_IP:$NODE_PORT","tags":[null],"categories":[null]},{"title":"Kuberneteså®‰è£…","path":"/wiki/Kubernetes/Kuberneteså®‰è£….html","content":"Kubernetes å®‰è£…Minikube å®‰è£… Kuberneteså®‰è£… Minikube ä¸‹è½½ windows ç‰ˆæœ¬ https://minikube.sigs.k8s.io/docs/start/?arch=%2Fwindows%2Fx86-64%2Fstable%2F.exe+download å®‰è£… Minikube æ‰“å¼€å®‰è£…ç›®å½•ï¼Œä½¿ç”¨ç®¡ç†å‘˜æ‰“å¼€ PowerShell ç•Œé¢è¿è¡Œ Minikube å®‰è£…å¤±è´¥ å¯ç”¨ hyper-v https://blog.csdn.net/Destinyzhoujunyu/article/details/131610508 set HTTP_PROXY=http://127.0.0.1:17890set HTTPS_PROXY=https://127.0.0.1:17890set NO_PROXY=localhost,127.0.0.1,10.96.0.0/12,192.168.59.0/24,192.168.49.0/24,192.168.39.0/24 è™šæ‹Ÿæœºå®‰è£…ikuaiå®‰è£… ä¸‹è½½ ikuai isoé•œåƒ https://www.ikuai8.com/component/download å®‰è£…é•œåƒ é€‰æ‹©é•œåƒ é€‰æ‹©æ“ä½œç³»ç»Ÿ è®¾ç½®ç”¨æˆ·åå¯†ç  é€‰æ‹©å®‰è£…ä½ç½®åˆ›å»ºè™šæ‹Ÿæœº å®‰è£…ç³»ç»Ÿ æ·»åŠ ç½‘å¡2 é…ç½® lan å£æŸ¥çœ‹ pd åå¥½è®¾ç½®ä¸­è™šæ‹Ÿç½‘æ®µè¿›å…¥ ikuai é…ç½®ä¸ºè™šæ‹Ÿæœºæ‰€åœ¨ç½‘æ®µ è®¾ç½®å¤–ç½‘ k8s node å®‰è£…ç³»ç»Ÿå®‰è£… ç³»ç»Ÿé…ç½® ä¿®æ”¹ç½‘ç»œé…ç½® cd /etc/NetworkManager/system-connections [ipv4]# ä¿®æ”¹ä¸ºæ‰‹åŠ¨method=manual# ç½‘å…³ä¸ºikuaiç½‘å…³address1=10.37.129.10/24,10.37.129.200dns=114.114.114.114;8.8.8.8 systemctl restart NetworkManager æ›¿æ¢ yum æº sed -e s|^mirrorlist=|#mirrorlist=|g \\ -e s|^#baseurl=http://dl.rockylinux.org/$contentdir|baseurl=https://mirrors.aliyun.com/rockylinux|g \\ -i.bak \\ /etc/yum.repos.d/[Rr]ocky-*.repodnf makecache ä¿®æ”¹é˜²ç«å¢™ # é˜²ç«å¢™ä¿®æ”¹ firewalld ä¸º iptablessystemctl stop firewalldsystemctl disable firewalldyum -y install iptables-servicessystemctl start iptablesiptables -Fsystemctl enable iptables ç¦ç”¨ Selinux setenforce 0sed -i s/SELINUX=enforcing/SELINUX=disabled/g /etc/selinux/configgrubby --update-kernel ALL --args selinux=0# æŸ¥çœ‹æ˜¯å¦ç¦ç”¨ï¼Œgrubby --info DEFAULT# å›æ»šå†…æ ¸å±‚ç¦ç”¨æ“ä½œï¼Œgrubby --update-kernel ALL --remove-args selinux åŒæ­¥ç³»ç»Ÿæ—¶é—´ timedatectl set-timezone Asia/Shanghai# å®‰è£…å¹¶å¯åŠ¨æœåŠ¡yum install chrony # CentOS/RHELapt install chrony # Debian/Ubuntusystemctl enable --now chronyd# é…ç½®æœåŠ¡å™¨ï¼ˆç¼–è¾‘ /etc/chrony.confï¼‰echo server ntp.aliyun.com iburst /etc/chrony.conf# é‡å¯æœåŠ¡å¹¶éªŒè¯systemctl restart chronydchronyc tracking # æŸ¥çœ‹åŒæ­¥çŠ¶æ€ å…³é—­ swap åˆ†åŒº swapoff -ased -i s:/dev/mapper/rl-swap:#/dev/mapper/rl-swap:g /etc/fstab ä¿®æ”¹ä¸»æœºå hostnamectl set-hostname k8s-node01 å®‰è£… ipvs yum install -y ipvsadm# å¼€å¯è·¯ç”±è½¬å‘echo net.ipv4.ip_forward=1 /etc/sysctl.confsysctl -p# åŠ è½½ bridgeyum install -y epel-releaseyum install -y bridge-utilsmodprobe br_netfilterecho br_netfilter /etc/modules-load.d/bridge.confecho net.bridge.bridge-nf-call-iptables=1 /etc/sysctl.confecho net.bridge.bridge-nf-call-ip6tables=1 /etc/sysctl.confsysctl -p ä¿®æ”¹ host vi /etc/hosts 10.37.129.10 k8s-node01 n110.37.129.11 k8s-node02 n210.37.129.12 k8s-node03 n310.37.129.13 harbor docker å®‰è£… æ·»åŠ  docker-ce yum æº # å®˜æ–¹æºsudo dnf config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repocd /etc/yum.repos.d# ä¿ç•™å®˜æ–¹æºmv docker-ce.repo docker-ce.repo.backcp docker-ce.repo.back docker-ce.repo# æ¸…åå¤§å­¦æºsed -i s+https://download.docker.com+https://mirrors.tuna.tsinghua.edu.cn/docker-ce+ /etc/yum.repos.d/docker-ce.repo å®‰è£… docker-ce yum -y install docker-ce# é…ç½® daemon.cat /etc/docker/daemon.json EOF data-root: /data/docker, exec-opts: [native.cgroupdriver=systemd], log-driver: json-file, log-opts: max-size: 100m, max-file: 100 , insecure-registries: [harbor.xinxainghf.com], registry-mirrors: [https://kfp63jaj.mirror.aliyuncs.com]EOFmkdir -p /etc/systemd/system/docker.service.d# é‡å¯dockeræœåŠ¡systemctl daemon-reload systemctl restart docker systemctl enable dockerreboot å®‰è£… cri-docker # å®‰è£…yum -y install wgetwget https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.9/cri-dockerd-0.3.9.amd64.tgztar -xf cri-dockerd-0.3.9.amd64.tgzcp cri-dockerd/cri-dockerd /usr/bin/chmod +x /usr/bin/cri-dockerd# é…ç½®cat EOF /usr/lib/systemd/system/cri-docker.service[Unit]Description=CRI Interface for Docker Application Container Engine Documentation=https://docs.mirantis.comAfter=network-online.target firewalld.service docker.serviceWants=network-online.targetRequires=cri-docker.socket[Service]Type=notifyExecStart=/usr/bin/cri-dockerd --network-plugin=cni --pod-infra-container-image=registry.aliyuncs.com/google_containers/pause:3.8ExecReload=/bin/kill -s HUP $MAINPIDTimeoutSec=0RestartSec=2Restart=alwaysStartLimitBurst=3StartLimitInterval=60sLimitNOFILE=infinityLimitNPROC=infinityLimitCORE=infinityTasksMax=infinityDelegate=yesKillMode=process[Install]WantedBy=multi-user.targetEOF# æ·»åŠ å¥—æ¥å­—cat EOF /usr/lib/systemd/system/cri-docker.socket[Unit]Description=CRI Docker Socket for the APIPartOf=cri-docker.service[Socket]ListenStream=%t/cri-dockerd.sockSocketMode=0660SocketUser=rootSocketGroup=docker[Install]WantedBy=sockets.targetEOF# å¯åŠ¨systemctl daemon-reload systemctl enable cri-dockersystemctl start cri-dockersystemctl is-active cri-docker k8så®‰è£… æ·»åŠ  kubeadm yum æº cat EOF /etc/yum.repos.d/kubernetes.repo[kubernetes]name=Kubernetesbaseurl=https://pkgs.k8s.io/core:/stable:/v1.29/rpm/enabled=1gpgcheck=1gpgkey=https://pkgs.k8s.io/core:/stable:/v1.29/rpm/repodata/repomd.xml.keyexclude=kubelet kubeadm kubectl cri-tools kubernetes-cniEOF å®‰è£… kubeadm 1.29 ç‰ˆæœ¬ yum install -y kubelet-1.29.0 kubectl-1.29.0 kubeadm-1.29.0# å¼€æœºè‡ªå¯systemctl enable kubelet.service# å¯åŠ¨kubectlsystemctl start kubelet # é€šè¿‡å®‰è£…åŒ…å®‰è£…tar -zxvf kubernetes-1.29.2-150500.1.1.tar.gz cd kubernetes-1.29.2-150500.1.1yum -y install *# å¼€æœºè‡ªå¯systemctl enable kubelet.service åˆå§‹åŒ–ä¸»èŠ‚ç‚¹ kubeadm init --token-ttl 0 --apiserver-advertise-address=10.37.129.10 --image-repository registry.aliyuncs.com/google_containers --kubernetes-version 1.29.2 --service-cidr=10.10.0.0/12 --pod-network-cidr=10.244.0.0/16 --ignore-preflight-errors=all --cri-socket unix:///var/run/cri-dockerd.sock åˆå§‹åŒ–å¤±è´¥å°è¯•é‡å¯swapoff -asystemctl restart kubelet #work token è¿‡æœŸåï¼Œé‡æ–°ç”³è¯·kubeadm token create â€“print-join-command # ä¸»èŠ‚ç‚¹æ‰§è¡Œmkdir -p $HOME/.kubesudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/configsudo chown $(id -u):$(id -g) $HOME/.kube/config# ä»èŠ‚ç‚¹æ‰§è¡Œkubeadm join 10.37.129.10:6443 --token ej812q.x2a3orlgqotbrixn --discovery-token-ca-cert-hash sha256:36edaf40ae66ab2c1a87f47ee212209c239377f8f879a9e24522750eb0a05083 --cri-socket unix:///var/run/cri-dockerd.sock æ·»åŠ å‚æ•° -v2 å¯ä»¥æŸ¥çœ‹æ‰§è¡Œæƒ…å†µæŠ¥å¦‚ä¸‹é”™è¯¯æ£€æŸ¥é˜²ç«å¢™ å®‰è£…ç½‘ç»œæ’ä»¶ # ä¸‰ä¸ªèŠ‚ç‚¹éƒ½è¦æ‰§è¡Œyum install -y unzipunzip calico.zip cd calicotar -zxvf calico-images.tar.gz cd calico-imagesdocker load -i calico-cni-v3.26.3.tardocker load -i calico-kube-controllers-v3.26.3.tar docker load -i calico-node-v3.26.3.tar docker load -i calico-typha-v3.26.3.tar # ä¸»èŠ‚ç‚¹æ‰§è¡Œkubectl apply -f calico-typha.yaml","tags":[null],"categories":[null]},{"title":"Kubernetesç®€ä»‹","path":"/wiki/Kubernetes/Kubernetesç®€ä»‹.html","content":"åŸºç¡€è®¾æ–½çš„å˜é©å•æœºåœºæ™¯ä¼ ç»Ÿæ–¹å¼éƒ¨ç½²æ—©æœŸï¼Œå„ä¸ªç»„ç»‡æ˜¯åœ¨ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºã€‚ ç”±äºæ— æ³•é™åˆ¶åœ¨ç‰©ç†æœåŠ¡å™¨ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºèµ„æºä½¿ç”¨ï¼Œå› æ­¤ä¼šå¯¼è‡´èµ„æºåˆ†é…é—®é¢˜ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœåœ¨åŒä¸€å°ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œå¤šä¸ªåº”ç”¨ç¨‹åºï¼Œ åˆ™å¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªåº”ç”¨ç¨‹åºå ç”¨å¤§éƒ¨åˆ†èµ„æºçš„æƒ…å†µï¼Œè€Œå¯¼è‡´å…¶ä»–åº”ç”¨ç¨‹åºçš„æ€§èƒ½ä¸‹é™ã€‚ ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯å°†æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½è¿è¡Œåœ¨ä¸åŒçš„ç‰©ç†æœåŠ¡å™¨ä¸Šï¼Œ ä½†æ˜¯å½“æŸä¸ªåº”ç”¨ç¨‹åºèµ„æºåˆ©ç”¨ç‡ä¸é«˜æ—¶ï¼Œå‰©ä½™èµ„æºæ— æ³•è¢«åˆ†é…ç»™å…¶ä»–åº”ç”¨ç¨‹åºï¼Œ è€Œä¸”ç»´æŠ¤è®¸å¤šç‰©ç†æœåŠ¡å™¨çš„æˆæœ¬å¾ˆé«˜ã€‚ æœºå™¨ç¡¬ä»¶- æ“ä½œç³»ç»Ÿ- åº”ç”¨æœåŠ¡ï¼ˆnï¼‰ è™šæ‹Ÿéƒ¨ç½²å› æ­¤ï¼Œè™šæ‹ŸåŒ–æŠ€æœ¯è¢«å¼•å…¥äº†ã€‚è™šæ‹ŸåŒ–æŠ€æœ¯å…è®¸ä½ åœ¨å•ä¸ªç‰©ç†æœåŠ¡å™¨çš„ CPU ä¸Šè¿è¡Œå¤šå°è™šæ‹Ÿæœºï¼ˆVMï¼‰ã€‚ è™šæ‹ŸåŒ–èƒ½ä½¿åº”ç”¨ç¨‹åºåœ¨ä¸åŒ VM ä¹‹é—´è¢«å½¼æ­¤éš”ç¦»ï¼Œä¸”èƒ½æä¾›ä¸€å®šç¨‹åº¦çš„å®‰å…¨æ€§ï¼Œ å› ä¸ºä¸€ä¸ªåº”ç”¨ç¨‹åºçš„ä¿¡æ¯ä¸èƒ½è¢«å¦ä¸€åº”ç”¨ç¨‹åºéšæ„è®¿é—®ã€‚è™šæ‹ŸåŒ–æŠ€æœ¯èƒ½å¤Ÿæ›´å¥½åœ°åˆ©ç”¨ç‰©ç†æœåŠ¡å™¨çš„èµ„æºï¼Œå¹¶ä¸”å› ä¸ºå¯è½»æ¾åœ°æ·»åŠ æˆ–æ›´æ–°åº”ç”¨ç¨‹åºï¼Œ è€Œå› æ­¤å¯ä»¥å…·æœ‰æ›´é«˜çš„å¯æ‰©ç¼©æ€§ï¼Œä»¥åŠé™ä½ç¡¬ä»¶æˆæœ¬ç­‰ç­‰çš„å¥½å¤„ã€‚ é€šè¿‡è™šæ‹ŸåŒ–ï¼Œä½ å¯ä»¥å°†ä¸€ç»„ç‰©ç†èµ„æºå‘ˆç°ä¸ºå¯ä¸¢å¼ƒçš„è™šæ‹Ÿæœºé›†ç¾¤ã€‚æ¯ä¸ª VM æ˜¯ä¸€å°å®Œæ•´çš„è®¡ç®—æœºï¼Œåœ¨è™šæ‹ŸåŒ–ç¡¬ä»¶ä¹‹ä¸Šè¿è¡Œæ‰€æœ‰ç»„ä»¶ï¼ŒåŒ…æ‹¬å…¶è‡ªå·±çš„æ“ä½œç³»ç»Ÿã€‚ æœºå™¨ç¡¬ä»¶- æ“ä½œç³»ç»Ÿ- è™šæ‹Ÿæœºï¼ˆnï¼‰- åº”ç”¨æœåŠ¡ï¼ˆnï¼‰ å®¹å™¨éƒ¨ç½²å®¹å™¨ç±»ä¼¼äº VMï¼Œä½†æ˜¯æ›´å®½æ¾çš„éš”ç¦»ç‰¹æ€§ï¼Œä½¿å®¹å™¨ä¹‹é—´å¯ä»¥å…±äº«æ“ä½œç³»ç»Ÿï¼ˆOSï¼‰ã€‚ å› æ­¤ï¼Œå®¹å™¨æ¯”èµ· VM è¢«è®¤ä¸ºæ˜¯æ›´è½»é‡çº§çš„ã€‚ä¸”ä¸ VM ç±»ä¼¼ï¼Œæ¯ä¸ªå®¹å™¨éƒ½å…·æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€CPUã€å†…å­˜ã€è¿›ç¨‹ç©ºé—´ç­‰ã€‚ ç”±äºå®ƒä»¬ä¸åŸºç¡€æ¶æ„åˆ†ç¦»ï¼Œå› æ­¤å¯ä»¥è·¨äº‘å’Œ OS å‘è¡Œç‰ˆæœ¬è¿›è¡Œç§»æ¤ã€‚ å®¹å™¨å› å…·æœ‰è®¸å¤šä¼˜åŠ¿è€Œå˜å¾—æµè¡Œèµ·æ¥ï¼Œä¾‹å¦‚ï¼š æ•æ·åº”ç”¨ç¨‹åºçš„åˆ›å»ºå’Œéƒ¨ç½²ï¼šä¸ä½¿ç”¨ VM é•œåƒç›¸æ¯”ï¼Œæé«˜äº†å®¹å™¨é•œåƒåˆ›å»ºçš„ç®€ä¾¿æ€§å’Œæ•ˆç‡ã€‚ æŒç»­å¼€å‘ã€é›†æˆå’Œéƒ¨ç½²ï¼šé€šè¿‡å¿«é€Ÿç®€å•çš„å›æ»šï¼ˆç”±äºé•œåƒä¸å¯å˜æ€§ï¼‰ï¼Œ æä¾›å¯é ä¸”é¢‘ç¹çš„å®¹å™¨é•œåƒæ„å»ºå’Œéƒ¨ç½²ã€‚ å…³æ³¨å¼€å‘ä¸è¿ç»´çš„åˆ†ç¦»ï¼šåœ¨æ„å»ºã€å‘å¸ƒæ—¶åˆ›å»ºåº”ç”¨ç¨‹åºå®¹å™¨é•œåƒï¼Œè€Œä¸æ˜¯åœ¨éƒ¨ç½²æ—¶ï¼Œ ä»è€Œå°†åº”ç”¨ç¨‹åºä¸åŸºç¡€æ¶æ„åˆ†ç¦»ã€‚ å¯è§‚å¯Ÿæ€§ï¼šä¸ä»…å¯ä»¥æ˜¾ç¤º OS çº§åˆ«çš„ä¿¡æ¯å’ŒæŒ‡æ ‡ï¼Œè¿˜å¯ä»¥æ˜¾ç¤ºåº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶å†µå’Œå…¶ä»–æŒ‡æ ‡ä¿¡å·ã€‚ è·¨å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§çš„ç¯å¢ƒä¸€è‡´æ€§ï¼šåœ¨ç¬”è®°æœ¬è®¡ç®—æœºä¸Šä¹Ÿå¯ä»¥å’Œåœ¨äº‘ä¸­è¿è¡Œä¸€æ ·çš„åº”ç”¨ç¨‹åºã€‚ è·¨äº‘å’Œæ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆæœ¬çš„å¯ç§»æ¤æ€§ï¼šå¯åœ¨ Ubuntuã€RHELã€CoreOSã€æœ¬åœ°ã€ Google Kubernetes Engine å’Œå…¶ä»–ä»»ä½•åœ°æ–¹è¿è¡Œã€‚ ä»¥åº”ç”¨ç¨‹åºä¸ºä¸­å¿ƒçš„ç®¡ç†ï¼šæé«˜æŠ½è±¡çº§åˆ«ï¼Œä»åœ¨è™šæ‹Ÿç¡¬ä»¶ä¸Šè¿è¡Œ OS åˆ°ä½¿ç”¨é€»è¾‘èµ„æºåœ¨ OS ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºã€‚ æ¾æ•£è€¦åˆã€åˆ†å¸ƒå¼ã€å¼¹æ€§ã€è§£æ”¾çš„å¾®æœåŠ¡ï¼šåº”ç”¨ç¨‹åºè¢«åˆ†è§£æˆè¾ƒå°çš„ç‹¬ç«‹éƒ¨åˆ†ï¼Œ å¹¶ä¸”å¯ä»¥åŠ¨æ€éƒ¨ç½²å’Œç®¡ç† - è€Œä¸æ˜¯åœ¨ä¸€å°å¤§å‹å•æœºä¸Šæ•´ä½“è¿è¡Œã€‚ èµ„æºéš”ç¦»ï¼šå¯é¢„æµ‹çš„åº”ç”¨ç¨‹åºæ€§èƒ½ã€‚ èµ„æºåˆ©ç”¨ï¼šé«˜æ•ˆç‡å’Œé«˜å¯†åº¦ã€‚ æœºå™¨ç¡¬ä»¶- æ“ä½œç³»ç»Ÿ- å®¹å™¨- åº”ç”¨æœåŠ¡ï¼ˆnï¼‰ ä¼˜åŠ¿ï¼š èµ„æºæ•ˆç‡ï¼š è½»é‡çº§ï¼šå®¹å™¨å…±äº«å®¿ä¸»æ“ä½œç³»ç»Ÿçš„å†…æ ¸ï¼Œä¸éœ€è¦å®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œæ¯ä¸ªå®¹å™¨ä»…åŒ…å«åº”ç”¨å’Œå…¶ä¾èµ–ã€‚è¿™ä½¿å¾—å®¹å™¨æ¯”è™šæ‹Ÿæœºæ›´è½»é‡ï¼Œå¯åŠ¨é€Ÿåº¦æ›´å¿«ï¼Œèµ„æºå ç”¨æ›´å°‘ã€‚ èµ„æºåˆ©ç”¨ç‡ï¼šç”±äºå®¹å™¨æ›´è½»é‡ï¼Œé€šå¸¸å¯ä»¥åœ¨åŒä¸€å°ç‰©ç†æœºå™¨ä¸Šè¿è¡Œæ›´å¤šçš„å®¹å™¨å®ä¾‹ï¼Œè€Œè™šæ‹Ÿæœºåˆ™éœ€è¦æ›´å¤šçš„è®¡ç®—èµ„æºå’Œå†…å­˜ã€‚ å¯åŠ¨æ—¶é—´ï¼š å¿«é€Ÿå¯åŠ¨ï¼šå®¹å™¨çš„å¯åŠ¨é€Ÿåº¦é€šå¸¸æ¯”è™šæ‹Ÿæœºå¿«å¾—å¤šã€‚è¿™æ˜¯å› ä¸ºå®¹å™¨åªéœ€å¯åŠ¨åº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–ï¼Œè€Œè™šæ‹Ÿæœºéœ€è¦å¯åŠ¨ä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿã€‚ éƒ¨ç½²ä¸€è‡´æ€§ï¼š ç¯å¢ƒä¸€è‡´æ€§ï¼šå®¹å™¨å°è£…äº†åº”ç”¨åŠå…¶æ‰€æœ‰ä¾èµ–ï¼Œç¡®ä¿åœ¨ä¸åŒç¯å¢ƒä¸­ï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰å…·æœ‰ä¸€è‡´çš„è¡Œä¸ºã€‚è¿™å‡å°‘äº†å› ç¯å¢ƒå·®å¼‚å¯¼è‡´çš„é—®é¢˜ã€‚ ç®¡ç†å’Œè¿ç»´ï¼š ç®€åŒ–ç®¡ç†ï¼šå®¹å™¨å¯ä»¥é€šè¿‡å®¹å™¨ç¼–æ’å·¥å…·ï¼ˆå¦‚ Kubernetesï¼‰æ¥ç®¡ç†å’Œéƒ¨ç½²ï¼Œæ”¯æŒè‡ªåŠ¨æ‰©å±•ã€è´Ÿè½½å‡è¡¡å’Œæ•…éšœæ¢å¤ã€‚è™šæ‹Ÿæœºçš„ç®¡ç†åˆ™ç›¸å¯¹å¤æ‚ä¸€äº›ã€‚ æ›´å¥½çš„å¼€å‘ä½“éªŒï¼šå®¹å™¨æ”¯æŒæŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜ï¼ˆCICDï¼‰ï¼Œæœ‰åŠ©äºæé«˜å¼€å‘æ•ˆç‡å’Œå‡å°‘å‘å¸ƒå‘¨æœŸã€‚ å¯ç§»æ¤æ€§ï¼š è·¨å¹³å°ï¼šå®¹å™¨å¯ä»¥åœ¨ä»»ä½•æ”¯æŒå®¹å™¨å¼•æ“çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œå¦‚ä¸åŒçš„æ“ä½œç³»ç»Ÿæˆ–äº‘å¹³å°ã€‚è¿™ä½¿å¾—åº”ç”¨ç¨‹åºåœ¨ä¸åŒç¯å¢ƒä¹‹é—´çš„è¿ç§»å˜å¾—æ›´åŠ å®¹æ˜“ã€‚ ç‰ˆæœ¬æ§åˆ¶ï¼š é•œåƒç‰ˆæœ¬ç®¡ç†ï¼šå®¹å™¨é•œåƒå¯ä»¥è¢«ç‰ˆæœ¬æ§åˆ¶å’Œå­˜å‚¨åœ¨é•œåƒä»“åº“ä¸­ï¼Œè¿™ä½¿å¾—å›æ»šåˆ°æŸä¸ªç‰¹å®šç‰ˆæœ¬æˆ–ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„é•œåƒå˜å¾—ç®€å•ã€‚ ç¼ºç‚¹ï¼š å®‰å…¨æ€§ï¼š å†…æ ¸å…±äº«ï¼šå®¹å™¨å…±äº«å®¿ä¸»æ“ä½œç³»ç»Ÿçš„å†…æ ¸ï¼Œè¿™æ„å‘³ç€å¦‚æœå®¹å™¨åŒ–åº”ç”¨ä¸­å­˜åœ¨æ¼æ´ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåˆ©ç”¨è¿™äº›æ¼æ´è·å–å®¿ä¸»æ“ä½œç³»ç»Ÿçš„æ§åˆ¶æƒã€‚è¿™ç§å…±äº«å†…æ ¸çš„æœºåˆ¶ä½¿å¾—å®¹å™¨çš„éš”ç¦»æ€§ç›¸å¯¹è¾ƒå¼±ã€‚ æ”»å‡»é¢å¢å¤§ï¼šå®¹å™¨æŠ€æœ¯çš„æµè¡Œå¢åŠ äº†æ”»å‡»è€…å¯¹å®¹å™¨ç¯å¢ƒçš„å…´è¶£ã€‚å®¹å™¨æ¼æ´æˆ–é…ç½®é”™è¯¯å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é—®é¢˜ï¼Œå¦‚å®¹å™¨é€ƒé€¸ï¼ˆcontainer escapeï¼‰ç­‰ã€‚ éš”ç¦»æ€§ï¼š èµ„æºéš”ç¦»ï¼šè™½ç„¶å®¹å™¨åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æä¾›äº†è¶³å¤Ÿçš„èµ„æºéš”ç¦»ï¼Œä½†ä¸è™šæ‹Ÿæœºç›¸æ¯”ï¼Œå®¹å™¨åœ¨èµ„æºéš”ç¦»æ–¹é¢ä»ç„¶æœ‰é™ã€‚è™šæ‹Ÿæœºé€šè¿‡å®Œå…¨è™šæ‹ŸåŒ–æä¾›äº†æ›´å¼ºçš„éš”ç¦»æ€§å’Œå®‰å…¨æ€§ã€‚ ç½‘ç»œå’Œå­˜å‚¨éš”ç¦»ï¼šå®¹å™¨åœ¨ç½‘ç»œå’Œå­˜å‚¨æ–¹é¢çš„éš”ç¦»å¯èƒ½ä¸å¦‚è™šæ‹Ÿæœºé‚£æ ·å¼ºï¼Œå°¤å…¶æ˜¯åœ¨å¤æ‚çš„ç½‘ç»œè®¾ç½®æˆ–å¤šç§Ÿæˆ·ç¯å¢ƒä¸­ã€‚ å¤æ‚æ€§ï¼š ç®¡ç†å’Œç¼–æ’ï¼šè™½ç„¶å®¹å™¨ç¼–æ’å·¥å…·ï¼ˆå¦‚ Kubernetesï¼‰å¯ä»¥æä¾›å¼ºå¤§çš„ç®¡ç†åŠŸèƒ½ï¼Œä½†å®ƒä»¬ä¹Ÿå¼•å…¥äº†é¢å¤–çš„å¤æ‚æ€§ã€‚å­¦ä¹ å’Œé…ç½®è¿™äº›å·¥å…·éœ€è¦é¢å¤–çš„æ—¶é—´å’Œèµ„æºã€‚ æŒä¹…åŒ–å­˜å‚¨ï¼šå®¹å™¨æœ¬èº«æ˜¯çŸ­æš‚çš„ï¼Œè™½ç„¶å¯ä»¥é€šè¿‡å·ï¼ˆvolumesï¼‰æ¥ç®¡ç†æ•°æ®æŒä¹…æ€§ï¼Œä½†å®¹å™¨çš„ä¸´æ—¶æ€§å’ŒåŠ¨æ€æ€§ä½¿å¾—æŒä¹…åŒ–å­˜å‚¨å’Œæ•°æ®ç®¡ç†æ›´ä¸ºå¤æ‚ã€‚ å…¼å®¹æ€§ï¼š æ“ä½œç³»ç»Ÿå’Œå†…æ ¸ç‰ˆæœ¬ï¼šå®¹å™¨ä¾èµ–å®¿ä¸»æ“ä½œç³»ç»Ÿå’Œå†…æ ¸çš„ç‰¹æ€§ï¼ŒæŸäº›æ“ä½œç³»ç»Ÿæˆ–å†…æ ¸ç‰ˆæœ¬å¯èƒ½ä¸å®Œå…¨æ”¯æŒå®¹å™¨çš„ç‰¹å®šåŠŸèƒ½ã€‚è¿™å¯èƒ½ä¼šé™åˆ¶æŸäº›åº”ç”¨ç¨‹åºçš„å®¹å™¨åŒ–èƒ½åŠ›ã€‚ åº”ç”¨å…¼å®¹æ€§ï¼šæŸäº›åº”ç”¨ç¨‹åºå¯èƒ½ä¸é€‚åˆåœ¨å®¹å™¨ä¸­è¿è¡Œï¼Œç‰¹åˆ«æ˜¯é‚£äº›éœ€è¦å¯¹æ“ä½œç³»ç»Ÿæœ‰ç‰¹æ®Šè¦æ±‚çš„åº”ç”¨ç¨‹åºã€‚ è°ƒè¯•å’Œç›‘æ§ï¼š è°ƒè¯•éš¾åº¦ï¼šå®¹å™¨çš„åŠ¨æ€ç‰¹æ€§ï¼ˆå¦‚å¿«é€Ÿå¯åŠ¨å’Œé”€æ¯ï¼‰å¯èƒ½ä½¿å¾—è°ƒè¯•å’Œæ’é”™æ›´åŠ å¤æ‚ã€‚å®¹å™¨åŒ–ç¯å¢ƒä¸­çš„æ•…éšœæ’é™¤å¯èƒ½éœ€è¦é¢å¤–çš„å·¥å…·å’ŒæŠ€å·§ã€‚ ç›‘æ§æŒ‘æˆ˜ï¼šè™½ç„¶ç°ä»£å·¥å…·å¯ä»¥ç›‘æ§å®¹å™¨ï¼Œä½†å®¹å™¨ç¯å¢ƒçš„åŠ¨æ€æ€§å’Œåˆ†å¸ƒå¼ç‰¹æ€§å¯èƒ½ä½¿å¾—ç›‘æ§å’Œæ—¥å¿—ç®¡ç†æ›´åŠ å¤æ‚ã€‚ é›†ç¾¤åœºæ™¯-IAASIAASï¼ˆInfrastructure as a Serviceï¼ŒåŸºç¡€è®¾æ–½å³æœåŠ¡ï¼‰æ˜¯ä¸€ç§äº‘è®¡ç®—æœåŠ¡æ¨¡å‹ï¼Œå®ƒæä¾›äº†å¯¹è®¡ç®—èµ„æºã€å­˜å‚¨ã€ç½‘ç»œå’Œå…¶ä»–åŸºç¡€è®¾æ–½ç»„ä»¶çš„è™šæ‹ŸåŒ–è®¿é—®ã€‚è¿™äº›èµ„æºå¯ä»¥é€šè¿‡äº’è”ç½‘æŒ‰éœ€è¿›è¡Œè®¿é—®å’Œç®¡ç†ï¼Œè€Œæ— éœ€ç”¨æˆ·è´­ä¹°å’Œç»´æŠ¤ç‰©ç†ç¡¬ä»¶ã€‚ä¾‹å¦‚å„ç§äº‘æœåŠ¡æä¾›å‚å•†ï¼šé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€åä¸ºäº‘ã€‚ é›†ç¾¤åœºæ™¯-PAASPAASï¼ˆPlatform as a Serviceï¼Œå¹³å°å³æœåŠ¡ï¼‰æ˜¯ä¸€ç§äº‘è®¡ç®—æœåŠ¡æ¨¡å‹ï¼Œæä¾›äº†ä¸€ä¸ªå®Œæ•´çš„å¹³å°ï¼Œå…è®¸å¼€å‘è€…åœ¨å…¶ä¸Šæ„å»ºã€æµ‹è¯•ã€éƒ¨ç½²å’Œç»´æŠ¤åº”ç”¨ç¨‹åºï¼Œè€Œæ— éœ€ç®¡ç†åº•å±‚çš„åŸºç¡€è®¾æ–½ï¼ˆå¦‚æœåŠ¡å™¨ã€å­˜å‚¨ã€ç½‘ç»œå’Œæ“ä½œç³»ç»Ÿï¼‰ã€‚PAAS ç®€åŒ–äº†åº”ç”¨ç¨‹åºå¼€å‘å’Œç®¡ç†çš„è¿‡ç¨‹ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿä¸“æ³¨äºåº”ç”¨é€»è¾‘å’ŒåŠŸèƒ½ï¼Œè€Œä¸æ˜¯åŸºç¡€è®¾æ–½çš„ç®¡ç†ã€‚ä¾‹å¦‚ï¼šSwarmã€MESOSã€Kubernetes Kubernetes ç®€ä»‹Kubernetes æ˜¯ä¸€ä¸ªå¯ç§»æ¤ã€å¯æ‰©å±•çš„å¼€æºå¹³å°ï¼Œç”¨äº ç®¡ç†å®¹å™¨åŒ–çš„å·¥ä½œè´Ÿè½½å’ŒæœåŠ¡ï¼Œæ–¹ä¾¿è¿›è¡Œå£°æ˜å¼é…ç½®å’Œè‡ªåŠ¨åŒ–ã€‚ ä¸ºä»€ä¹ˆéœ€è¦ Kubernetesï¼Ÿå®¹å™¨æ˜¯æ‰“åŒ…å’Œè¿è¡Œåº”ç”¨ç¨‹åºçš„å¥½æ–¹å¼ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œ éœ€è¦ç®¡ç†è¿è¡Œç€åº”ç”¨ç¨‹åºçš„å®¹å™¨ï¼Œå¹¶ç¡®ä¿æœåŠ¡ä¸ä¼šä¸‹çº¿ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªå®¹å™¨å‘ç”Ÿæ•…éšœï¼Œåˆ™éœ€è¦å¯åŠ¨å¦ä¸€ä¸ªå®¹å™¨ã€‚ å¦‚æœæ­¤è¡Œä¸ºäº¤ç”±ç»™ç³»ç»Ÿå¤„ç†ï¼Œæ˜¯ä¸æ˜¯ä¼šæ›´å®¹æ˜“ä¸€äº›ï¼Ÿ è¿™å°±æ˜¯ Kubernetes è¦æ¥åšçš„äº‹æƒ…ï¼ Kubernetes æä¾›äº†ä¸€ä¸ªå¯å¼¹æ€§è¿è¡Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¡†æ¶ã€‚ Kubernetes ä¼šæ»¡è¶³ä½ çš„æ‰©å±•è¦æ±‚ã€æ•…éšœè½¬ç§»ä½ çš„åº”ç”¨ã€æä¾›éƒ¨ç½²æ¨¡å¼ç­‰ã€‚ Kubernetes åŠŸèƒ½ æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ Kubernetes å¯ä»¥ä½¿ç”¨ DNS åç§°æˆ–è‡ªå·±çš„ IP åœ°å€æ¥æš´éœ²å®¹å™¨ã€‚ å¦‚æœè¿›å…¥å®¹å™¨çš„æµé‡å¾ˆå¤§ï¼Œ Kubernetes å¯ä»¥è´Ÿè½½å‡è¡¡å¹¶åˆ†é…ç½‘ç»œæµé‡ï¼Œä»è€Œä½¿éƒ¨ç½²ç¨³å®šã€‚ å­˜å‚¨ç¼–æ’ Kubernetes å…è®¸ä½ è‡ªåŠ¨æŒ‚è½½ä½ é€‰æ‹©çš„å­˜å‚¨ç³»ç»Ÿï¼Œä¾‹å¦‚æœ¬åœ°å­˜å‚¨ã€å…¬å…±äº‘æä¾›å•†ç­‰ã€‚ è‡ªåŠ¨éƒ¨ç½²å’Œå›æ»š ä½ å¯ä»¥ä½¿ç”¨ Kubernetes æè¿°å·²éƒ¨ç½²å®¹å™¨çš„æ‰€éœ€çŠ¶æ€ï¼Œ å®ƒå¯ä»¥ä»¥å—æ§çš„é€Ÿç‡å°†å®é™…çŠ¶æ€æ›´æ”¹ä¸ºæœŸæœ›çŠ¶æ€ã€‚ ä¾‹å¦‚ï¼Œä½ å¯ä»¥è‡ªåŠ¨åŒ– Kubernetes æ¥ä¸ºä½ çš„éƒ¨ç½²åˆ›å»ºæ–°å®¹å™¨ï¼Œ åˆ é™¤ç°æœ‰å®¹å™¨å¹¶å°†å®ƒä»¬çš„æ‰€æœ‰èµ„æºç”¨äºæ–°å®¹å™¨ã€‚ è‡ªåŠ¨åˆ†é… CPUå†…å­˜èµ„æº - å¼¹æ€§ä¼¸ç¼© ä½ ä¸º Kubernetes æä¾›è®¸å¤šèŠ‚ç‚¹ç»„æˆçš„é›†ç¾¤ï¼Œåœ¨è¿™ä¸ªé›†ç¾¤ä¸Šè¿è¡Œå®¹å™¨åŒ–çš„ä»»åŠ¡ã€‚ ä½ å‘Šè¯‰ Kubernetes æ¯ä¸ªå®¹å™¨éœ€è¦å¤šå°‘ CPU å’Œå†…å­˜ (RAM)ã€‚ Kubernetes å¯ä»¥å°†è¿™äº›å®¹å™¨æŒ‰å®é™…æƒ…å†µè°ƒåº¦åˆ°ä½ çš„èŠ‚ç‚¹ä¸Šï¼Œä»¥æœ€ä½³æ–¹å¼åˆ©ç”¨ä½ çš„èµ„æºã€‚ è‡ªæˆ‘ä¿®å¤ Kubernetes å°†é‡æ–°å¯åŠ¨å¤±è´¥çš„å®¹å™¨ã€æ›¿æ¢å®¹å™¨ã€æ€æ­»ä¸å“åº”ç”¨æˆ·å®šä¹‰çš„è¿è¡ŒçŠ¶å†µæ£€æŸ¥çš„å®¹å™¨ï¼Œ å¹¶ä¸”åœ¨å‡†å¤‡å¥½æœåŠ¡ä¹‹å‰ä¸å°†å…¶é€šå‘Šç»™å®¢æˆ·ç«¯ã€‚ å¯†é’¥ä¸é…ç½®ç®¡ç† Kubernetes å…è®¸ä½ å­˜å‚¨å’Œç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€OAuth ä»¤ç‰Œå’Œ SSH å¯†é’¥ã€‚ ä½ å¯ä»¥åœ¨ä¸é‡å»ºå®¹å™¨é•œåƒçš„æƒ…å†µä¸‹éƒ¨ç½²å’Œæ›´æ–°å¯†é’¥å’Œåº”ç”¨ç¨‹åºé…ç½®ï¼Œä¹Ÿæ— éœ€åœ¨å †æ ˆé…ç½®ä¸­æš´éœ²å¯†é’¥ã€‚ æ‰¹å¤„ç†æ‰§è¡Œ é™¤äº†æœåŠ¡å¤–ï¼ŒKubernetes è¿˜å¯ä»¥ç®¡ç†ä½ çš„æ‰¹å¤„ç†å’Œ CIï¼ˆæŒç»­é›†æˆï¼‰å·¥ä½œè´Ÿè½½ï¼Œå¦‚æœ‰éœ€è¦ï¼Œå¯ä»¥æ›¿æ¢å¤±è´¥çš„å®¹å™¨ã€‚ æ°´å¹³æ‰©ç¼© ä½¿ç”¨ç®€å•çš„å‘½ä»¤ã€ç”¨æˆ·ç•Œé¢æˆ–æ ¹æ® CPU ä½¿ç”¨ç‡è‡ªåŠ¨å¯¹ä½ çš„åº”ç”¨è¿›è¡Œæ‰©ç¼©ã€‚ IPv4IPv6 åŒæ ˆ ä¸º Podï¼ˆå®¹å™¨ç»„ï¼‰å’Œ Serviceï¼ˆæœåŠ¡ï¼‰åˆ†é… IPv4 å’Œ IPv6 åœ°å€ã€‚ ä¸ºå¯æ‰©å±•æ€§è®¾è®¡ åœ¨ä¸æ”¹å˜ä¸Šæ¸¸æºä»£ç çš„æƒ…å†µä¸‹ä¸ºä½ çš„ Kubernetes é›†ç¾¤æ·»åŠ åŠŸèƒ½ã€‚ Kubernetes ç»„ä»¶Kubernetes é›†ç¾¤ç”± æ§åˆ¶å¹³é¢ å’Œä¸€ä¸ªæˆ–å¤šä¸ª å·¥ä½œèŠ‚ç‚¹ ç»„æˆã€‚ Control Plane Componentsï¼ˆæ§åˆ¶å¹³é¢ï¼‰ç®¡ç†é›†ç¾¤çš„æ•´ä½“çŠ¶æ€ API Serverï¼šå…¬å¼€ Kubernetes HTTP API çš„æ ¸å¿ƒç»„ä»¶æœåŠ¡å™¨ã€‚ Controller Managerï¼šè´Ÿè´£å¤„ç†é›†ç¾¤çš„å¸¸è§„ä»»åŠ¡å’Œæ§åˆ¶é€»è¾‘ï¼Œå¦‚å‰¯æœ¬æ§åˆ¶ã€èŠ‚ç‚¹æ§åˆ¶ã€ç«¯ç‚¹æ§åˆ¶ç­‰ã€‚ Schedulerï¼šè´Ÿè´£å°† Pod åˆ†é…åˆ°åˆé€‚çš„èŠ‚ç‚¹ä¸Šï¼ŒåŸºäºèµ„æºéœ€æ±‚ã€ç­–ç•¥å’Œå…¶ä»–çº¦æŸæ¡ä»¶ã€‚ etcdï¼šä¸€ä¸ªåˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ï¼Œç”¨äºä¿å­˜å’Œå¤åˆ¶é›†ç¾¤çŠ¶æ€æ•°æ®ã€‚ **cloud-controller-manager (å¯é€‰)**ï¼šä¸åº•å±‚äº‘é©±åŠ¨é›†æˆ Nodeï¼ˆå·¥ä½œèŠ‚ç‚¹ï¼‰åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œç»´æŠ¤è¿è¡Œçš„ Pod å¹¶æä¾› Kubernetes è¿è¡Œæ—¶ç¯å¢ƒ kubeletï¼šä¸€ä¸ªåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ä»£ç†ï¼Œè´Ÿè´£ç®¡ç† Pod çš„ç”Ÿå‘½å‘¨æœŸå’ŒèŠ‚ç‚¹çš„å¥åº·çŠ¶æ€ã€‚ Container Runtimeï¼šè´Ÿè´£è¿è¡Œå®¹å™¨çš„ç»„ä»¶ï¼ˆå¦‚ Dockerã€containerd æˆ– CRI-Oï¼‰ã€‚ kube-proxyï¼ˆå¯é€‰ï¼‰ï¼šå®ç°æœåŠ¡ä»£ç†å’Œè´Ÿè½½å‡è¡¡ï¼Œä¸º Pod æä¾›ç½‘ç»œæœåŠ¡ã€‚ æ’ä»¶ï¼ˆAddonsï¼‰æ’ä»¶æ‰©å±•äº† Kubernetes çš„åŠŸèƒ½ã€‚ä¸€äº›é‡è¦çš„ä¾‹å­åŒ…æ‹¬ï¼š DNS é›†ç¾¤èŒƒå›´å†…çš„ DNS è§£æ Web ç•Œé¢ï¼ˆDashboardï¼‰ é€šè¿‡ Web ç•Œé¢è¿›è¡Œé›†ç¾¤ç®¡ç† å®¹å™¨èµ„æºç›‘æ§ ç”¨äºæ”¶é›†å’Œå­˜å‚¨å®¹å™¨æŒ‡æ ‡ é›†ç¾¤å±‚é¢æ—¥å¿— ç”¨äºå°†å®¹å™¨æ—¥å¿—ä¿å­˜åˆ°ä¸­å¤®æ—¥å¿—å­˜å‚¨ å®¹å™¨å’ŒPodæ¦‚å¿µå®¹å™¨æ‰“åŒ…åº”ç”¨åŠå…¶è¿è¡Œä¾èµ–ç¯å¢ƒçš„æŠ€æœ¯ã€‚å®¹å™¨å°†åº”ç”¨ç¨‹åºä»åº•å±‚çš„ä¸»æœºè®¾æ–½ä¸­è§£è€¦ã€‚ è¿™ä½¿å¾—åœ¨ä¸åŒçš„äº‘æˆ– OS ç¯å¢ƒä¸­éƒ¨ç½²æ›´åŠ å®¹æ˜“ã€‚ Kubernetes é›†ç¾¤ä¸­çš„æ¯ä¸ª èŠ‚ç‚¹ éƒ½ä¼šè¿è¡Œå®¹å™¨ï¼Œ è¿™äº›å®¹å™¨æ„æˆåˆ†é…ç»™è¯¥èŠ‚ç‚¹çš„ Podã€‚ å•ä¸ª Pod ä¸­çš„å®¹å™¨ä¼šåœ¨å…±åŒè°ƒåº¦ä¸‹ï¼ŒäºåŒä¸€ä½ç½®è¿è¡Œåœ¨ç›¸åŒçš„èŠ‚ç‚¹ä¸Šã€‚ Pause å®¹å™¨â€ŒPauseæ¦‚å¿µ â€ŒPause å®¹å™¨â€Œï¼ˆåˆç§° Infra å®¹å™¨ï¼‰æ˜¯æ¯ä¸ª Pod æœ€å…ˆå¯åŠ¨çš„éšè—å®¹å™¨ï¼Œè´Ÿè´£åˆ›å»ºå¹¶ç»´æŒ Pod çº§åˆ«çš„ Linux å‘½åç©ºé—´ï¼ˆå¦‚ç½‘ç»œã€IPC ç­‰ï¼‰ã€‚ å®ƒä¸è¿è¡Œä¸šåŠ¡é€»è¾‘ï¼Œä»…æ‰§è¡Œ /pause å‘½ä»¤ä¿æŒé˜»å¡çŠ¶æ€ï¼Œå ç”¨èµ„æºæä½ï¼ˆçº¦ 300KB é•œåƒï¼‰â€Œã€‚ æ ¸å¿ƒåŠŸèƒ½ â€Œå…±äº«ç½‘ç»œIPC å‘½åç©ºé—´â€Œï¼šç¡®ä¿åŒ Pod å†…å®¹å™¨å…±äº«ç›¸åŒ IPã€ç«¯å£èŒƒå›´ï¼Œå¯é€šè¿‡ localhost ç›´æ¥é€šä¿¡â€Œï¼ˆå¦‚ Nginx å®¹å™¨ä¸æ—¥å¿—æ”¶é›†å™¨é€šè¿‡æœ¬åœ°ç«¯å£ç›´æ¥äº¤äº’ï¼‰ã€‚ â€Œåƒµå°¸è¿›ç¨‹å›æ”¶â€Œï¼šä½œä¸º PID 1 è¿›ç¨‹ï¼Œè´Ÿè´£å›æ”¶å­è¿›ç¨‹é¿å…åƒµå°¸è¿›ç¨‹å †ç§¯â€Œã€‚ â€Œç¨³å®šæ€§ä¿éšœâ€Œï¼šå³ä½¿ä¸šåŠ¡å®¹å™¨å´©æºƒï¼ŒPause å®¹å™¨ä»ä¿æŒè¿è¡Œï¼Œç»´æŒ Pod ç½‘ç»œèº«ä»½ä¸å˜â€Œã€‚ å…¸å‹è¡Œä¸ºç‰¹å¾ ç‰¹æ€§ è¯´æ˜ é•œåƒä½“ç§¯ ä»…çº¦ 300KBï¼Œä»…è¿è¡Œé˜»å¡å¼ /pause å‘½ä»¤â€Œ èµ„æºå ç”¨ å†…å­˜å ç”¨çº¦ 700KBï¼ŒCPU å‡ ä¹æ— æ¶ˆè€—â€Œ ç”Ÿå‘½å‘¨æœŸ ä¸ Pod å®Œå…¨ç»‘å®šï¼ŒPod åˆ é™¤åè‡ªåŠ¨ç»ˆæ­¢ PodPod æ˜¯å¯ä»¥åœ¨ Kubernetes ä¸­åˆ›å»ºå’Œç®¡ç†çš„ã€æœ€å°çš„å¯éƒ¨ç½²çš„è®¡ç®—å•å…ƒã€‚ Podï¼ˆå°±åƒåœ¨é²¸é±¼èšæˆ–è€…è±Œè±†èšä¸­ï¼‰æ˜¯ä¸€ç»„ï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªï¼‰ å®¹å™¨ï¼› è¿™äº›å®¹å™¨å…±äº«å­˜å‚¨ã€ç½‘ç»œã€ä»¥åŠæ€æ ·è¿è¡Œè¿™äº›å®¹å™¨çš„è§„çº¦ã€‚ Pod ä¸­çš„å†…å®¹æ€»æ˜¯å¹¶ç½®çš„å¹¶ä¸”ä¸€åŒè°ƒåº¦ï¼Œåœ¨å…±äº«çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚ Pod æ‰€å»ºæ¨¡çš„æ˜¯ç‰¹å®šäºåº”ç”¨çš„ â€œé€»è¾‘ä¸»æœºâ€ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªåº”ç”¨å®¹å™¨ï¼Œ è¿™äº›å®¹å™¨ç›¸å¯¹ç´§å¯†åœ°è€¦åˆåœ¨ä¸€èµ·ã€‚ ç”¨å¤§ç™½è¯ç»™ä½ è§£é‡Š Kubernetesï¼ˆk8sï¼‰é‡Œçš„å®¹å™¨å’Œ Podï¼š â€Œå®¹å™¨â€Œ â€”â€” å°±åƒä¸€ä¸ªä¸ª â€œå°ç½å¤´â€ æ¯ä¸ªç½å¤´é‡Œæ‰“åŒ…äº†ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨ï¼ˆæ¯”å¦‚ä¸€ä¸ªç½‘ç«™åå°ï¼‰ è‡ªå¸¦æ‰€æœ‰éœ€è¦çš„é…æ–™ï¼ˆä»£ç ã€ç¯å¢ƒã€ä¾èµ–åº“ï¼‰ å’Œå†°ç®±å…¶ä»–ç½å¤´ç›¸äº’éš”ç¦»ï¼ˆä¸ä¼šäº’ç›¸å¹²æ‰°ï¼‰ è½»å·§ä¾¿æºï¼Œå¯ä»¥å¿«é€Ÿå¤åˆ¶å¾ˆå¤šä»½ â€ŒPodâ€Œ â€”â€” ç›¸å½“äº â€œç½å¤´ç¤¼ç›’â€ æœ€å°çš„å¯éƒ¨ç½²å•å…ƒï¼ˆk8s ä¸ç›´æ¥ç®¡å•ä¸ªç½å¤´ï¼Œåªç®¡ç¤¼ç›’ï¼‰ ä¸€ä¸ªç¤¼ç›’é‡Œå¯ä»¥æ”¾ï¼š å•ä¸ªä¸»ç½å¤´ï¼ˆæœ€å¸¸è§ï¼‰ å¤šä¸ªéœ€è¦ç´§å¯†é…åˆçš„ç½å¤´ï¼ˆæ¯”å¦‚ä¸»ç¨‹åº+æ—¥å¿—æ”¶é›†å™¨ï¼‰ ç¤¼ç›’é‡Œçš„ç½å¤´ä»¬ï¼š å…±ç”¨åŒä¸€ä¸ªæ”¶ä»¶åœ°å€ï¼ˆIP åœ°å€ï¼‰ å¯ä»¥äº’ç›¸è®¿é—® localhost å…±äº«åŒä¸€å—ä¸´æ—¶å­˜å‚¨ç©ºé—´ ä¸¾ä¸ªæ —å­ ğŸŒ°ï¼š ä½ æƒ³éƒ¨ç½²ä¸€ä¸ªç½‘ç«™ï¼Œéœ€è¦ï¼š ä¸»ç¨‹åºå®¹å™¨ï¼ˆæ¯”å¦‚ Nginxï¼‰ æ—¥å¿—æ”¶é›†å®¹å™¨ï¼ˆæ¯”å¦‚ Filebeatï¼‰ è¿™ä¿©å®¹å™¨å°±ä¼šè¢«æ‰“åŒ…åœ¨åŒä¸€ä¸ª Pod é‡Œ å®ƒä»¬å¯ä»¥å…±ç”¨æ—¥å¿—æ–‡ä»¶ï¼Œé€šè¿‡æœ¬åœ°ç½‘ç»œé€šä¿¡ å…³é”®åŒºåˆ«ï¼š å®¹å™¨æ˜¯æŠ€æœ¯å•å…ƒï¼ˆå®é™…è¿è¡Œçš„ä¸œè¥¿ï¼‰ Pod æ˜¯ç®¡ç†å•å…ƒï¼ˆk8s è°ƒåº¦çš„æœ€å°å•ä½ï¼‰ å°±åƒä½ ä¸ä¼šå•ç‹¬é‚®å¯„ä¸€ä¸ªç½å¤´ï¼Œæ€»æ˜¯æ•´ç›’å¯„é€ Pod çš„è®¾è®¡è®©ç´§å¯†åä½œçš„å¤šä¸ªå®¹å™¨èƒ½åƒ â€œä¸€ä¸ªåº”ç”¨â€ ä¸€æ ·è¢«ç®¡ç†ã€‚","tags":[null],"categories":[null]},{"path":"/wiki/Kubernetes/MySql.html","content":"namespaceOverride: devarchitecture: replicationauth: createDatabase: true database: dev_db rootPassword: 123456primary: service: type: NodePort persistence: storageClass: nfs-client size: 5Gi accessModes: - ReadWriteMany extraEnvVars: - name: TZ value: Asia/Shanghaisecondary: name: slave extraEnvVars: - name: TZ value: Asia/Shanghai service: type: NodePort replicaCount: 1 persistence: storageClass: nfs-client size: 5Gi accessModes: - ReadWriteMany helm repo add bitnami https://charts.bitnami.com/bitnami helm upgrade â€“install mysql bitnamimysql â€“namespace dev -f my-values.yaml docker run â€“name nacos-standalone -e MODEstandalone -p 8080:8080 -p 8848:8848 -p 9848:9848 -d nacosnacos-server:v2.3.2"},{"title":"Kubernetes Pod","path":"/wiki/Kubernetes/Podçš„ç”Ÿå‘½å‘¨æœŸ.html","content":"Podçš„ç”Ÿå‘½å‘¨æœŸ initå®¹å™¨initå®¹å™¨æ¦‚å¿µInit å®¹å™¨æ˜¯ä¸€ç§ç‰¹æ®Šå®¹å™¨ï¼Œåœ¨ Pod å†…çš„åº”ç”¨å®¹å™¨å¯åŠ¨ä¹‹å‰è¿è¡Œã€‚Init å®¹å™¨å¯ä»¥åŒ…æ‹¬ä¸€äº›åº”ç”¨é•œåƒä¸­ä¸å­˜åœ¨çš„å®ç”¨å·¥å…·å’Œå®‰è£…è„šæœ¬ã€‚ æ¯ä¸ª Pod ä¸­å¯ä»¥åŒ…å«å¤šä¸ªå®¹å™¨ï¼Œ åº”ç”¨è¿è¡Œåœ¨è¿™äº›å®¹å™¨é‡Œé¢ï¼ŒåŒæ—¶ Pod ä¹Ÿå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå…ˆäºåº”ç”¨å®¹å™¨å¯åŠ¨çš„ Init å®¹å™¨ã€‚ Init å®¹å™¨ä¸æ™®é€šçš„å®¹å™¨éå¸¸åƒï¼Œé™¤äº†å¦‚ä¸‹ä¸¤ç‚¹ï¼š Init å®¹å™¨æ€»æ˜¯è¿è¡Œåˆ°å®Œæˆä¸ºæ­¢(è¿”å›ç ä¸º0)ã€‚ æ¯ä¸ª Init å®¹å™¨éƒ½å¿…é¡»åœ¨ä¸‹ä¸€ä¸ª Init å¯åŠ¨ä¹‹å‰æˆåŠŸå®Œæˆï¼ˆå¦‚æœæœ‰10ä¸ª Init å®¹å™¨ï¼Œç¬¬10ä¸ªåˆå§‹åŒ–å¤±è´¥åˆ™å¿…é¡»å†ä»ç¬¬ä¸€ä¸ªé‡æ–°å¼€å§‹åˆå§‹åŒ–ï¼‰ã€‚ å¦‚æœ Pod çš„ Init å®¹å™¨å¤±è´¥ï¼Œkubelet ä¼šä¸æ–­åœ°é‡å¯è¯¥ Init å®¹å™¨ç›´åˆ°è¯¥å®¹å™¨æˆåŠŸä¸ºæ­¢ã€‚ç„¶è€Œï¼Œå¦‚æœ Pod å¯¹åº”çš„ restartPolicy å€¼ä¸º â€œNeverâ€ï¼Œå¹¶ä¸” Pod çš„ Init å®¹å™¨å¤±è´¥ï¼Œ åˆ™ Kubernetes ä¼šå°†æ•´ä¸ª Pod çŠ¶æ€è®¾ç½®ä¸ºå¤±è´¥ã€‚ ä¸æ™®é€šå®¹å™¨åŒºåˆ« å¸¸è§„çš„ Init å®¹å™¨ï¼ˆå³ä¸åŒ…æ‹¬è¾¹è½¦å®¹å™¨ï¼‰ä¸æ”¯æŒ lifecycleã€livenessProbeã€readinessProbe æˆ– startupProbe å­—æ®µã€‚ Init å®¹å™¨å¿…é¡»åœ¨ Pod å‡†å¤‡å°±ç»ªä¹‹å‰å®Œæˆè¿è¡Œï¼›è€Œè¾¹è½¦å®¹å™¨åœ¨ Pod çš„ç”Ÿå‘½å‘¨æœŸå†…ç»§ç»­è¿è¡Œï¼Œ å®ƒæ”¯æŒä¸€äº›æ¢é’ˆã€‚ å¦‚æœä¸ºä¸€ä¸ª Pod æŒ‡å®šäº†å¤šä¸ª Init å®¹å™¨ï¼Œè¿™äº›å®¹å™¨ä¼šæŒ‰é¡ºåºé€ä¸ªè¿è¡Œã€‚ æ¯ä¸ª Init å®¹å™¨å¿…é¡»è¿è¡ŒæˆåŠŸï¼Œä¸‹ä¸€ä¸ªæ‰èƒ½å¤Ÿè¿è¡Œã€‚å½“æ‰€æœ‰çš„ Init å®¹å™¨è¿è¡Œå®Œæˆæ—¶ï¼Œ Kubernetes æ‰ä¼šä¸º Pod åˆå§‹åŒ–åº”ç”¨å®¹å™¨å¹¶åƒå¹³å¸¸ä¸€æ ·è¿è¡Œã€‚ Init å®¹å™¨ä¸åº”ç”¨å®¹å™¨å…·å¤‡ä¸åŒçš„é•œåƒï¼Œå¯ä»¥æŠŠä¸€äº›å±é™©å·¥å…·æ”¾åœ¨ Init å®¹å™¨ä¸­ã€‚ Init å®¹å™¨å¤šä¸ªä¹‹é—´æ˜¯çº¿æ€§å¯åŠ¨çš„ï¼Œå¯ä»¥æ‰§è¡Œä¸€äº›å»¶è¿Ÿæ€§çš„æ“ä½œã€‚ initå®¹å™¨é˜»å¡ç¤ºä¾‹apiVersion: v1kind: Podmetadata: name: initc-1 labels: app.kubernetes.io/name: initcspec: containers: - name: myapp-container image: busybox:1.28 command: [sh, -c, echo The app is running! sleep 3600] initContainers: - name: init-myservice image: busybox:1.28 command: [sh, -c, until nslookup myservice.$(cat /var/run/secrets/kubernetes.io/serviceaccount/namespace).svc.cluster.local; do echo waiting for myservice; sleep 2; done] - name: init-mydb image: busybox:1.28 command: [sh, -c, until nslookup mydb.$(cat /var/run/secrets/kubernetes.io/serviceaccount/namespace).svc.cluster.local; do echo waiting for mydb; sleep 2; done] é€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤å¯åŠ¨ Podï¼š vi inti-1-pod.yamlkubectl apply -f inti-1-pod.yaml ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ£€æŸ¥å…¶çŠ¶æ€ï¼š kubectl get pod å¯ä»¥çœ‹åˆ° myapp-pod å®¹å™¨è¿˜æœªå°±ç»ªã€‚ æŸ¥çœ‹ myapp-pod çŠ¶æ€ã€‚ kubectl describe pod myapp-pod å¯ä»¥çœ‹åˆ°å¯åŠ¨äº‹ä»¶å¡åœ¨å¯åŠ¨ Init å®¹å™¨ï¼Œinit-myservice ä¸Šã€‚ æŸ¥çœ‹ init-myservice å®¹å™¨æ—¥å¿—ã€‚ kubectl logs myapp-pod -c init-myservice å¯ä»¥çœ‹åˆ° init-myservice å®¹å™¨ä¸€ç›´åœ¨ç­‰å¾… myserviceã€‚ # åˆ›å»º servicekubectl create svc clusterip myservice --tcp=80:80# æŸ¥çœ‹ svckubectl get svc å¯ä»¥çœ‹åˆ° init-myservie å®¹å™¨åˆ›å»ºæˆåŠŸï¼Œç°åœ¨åœ¨ç­‰å¾… init-mydb å®¹å™¨åˆ›å»ºã€‚ kubectl create svc clusterip mydb --tcp=80:80 åˆå§‹åŒ–å®¹å™¨éƒ½åˆ›å»ºæˆåŠŸåï¼Œåº”ç”¨å®¹å™¨æ‰å¼€å§‹åˆ›å»ºã€‚ init å®¹å™¨è¿”å›ç¤ºä¾‹apiVersion: v1kind: Podmetadata: name: myapp-pod labels: app.kubernetes.io/name: MyAppspec: containers: - name: myapp image: wangyanglinux/myapp:v1.0 initContainers: - name: randexit image: wangyanglinux/tools:randexitv1 args: [--exitcode=1] Init å®¹å™¨è¿”å›ç ä¸ä¸º 0 æ—¶ï¼Œä¼šé‡æ–°åˆ›å»º Init å®¹å™¨ã€‚ ä¿®æ”¹å®¹å™¨éƒ¨ç½²æ–‡ä»¶ã€‚ apiVersion: v1kind: Podmetadata: name: myapp-pod labels: app.kubernetes.io/name: MyAppspec: containers: - name: myapp image: wangyanglinux/myapp:v1.0 initContainers: - name: randexit image: wangyanglinux/tools:randexitv1 args: [--exitcode=0] é‡æ–°éƒ¨ç½²podã€‚ kubectl delete pod myapp-podkubectl apply -f inti-2-pod.yaml æ¢é’ˆè¯Šæ–­æ¢é’ˆæ˜¯ç”± kubelet å¯¹å®¹å™¨è¿›è¡Œçš„å‘¨æœŸæ€§æ£€æŸ¥ã€‚è¦æ‰§è¡Œè¯Šæ–­ï¼Œkubelet æ—¢å¯ä»¥åœ¨å®¹å™¨å†…æ‰§è¡Œä»£ç ï¼Œä¹Ÿå¯ä»¥å‘å‡ºä¸€ä¸ªç½‘ç»œè¯·æ±‚ã€‚ execåœ¨å®¹å™¨å†…æ‰§è¡ŒæŒ‡å®šå‘½ä»¤ã€‚å¦‚æœå‘½ä»¤é€€å‡ºæ—¶è¿”å›ç ä¸º 0 åˆ™è®¤ä¸ºè¯Šæ–­æˆåŠŸã€‚ grpcä½¿ç”¨ gRPC æ‰§è¡Œä¸€ä¸ªè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€‚ç›®æ ‡åº”è¯¥å®ç° gRPC å¥åº·æ£€æŸ¥ã€‚å¦‚æœå“åº”çš„çŠ¶æ€æ˜¯ â€œSERVINGâ€ï¼Œåˆ™è®¤ä¸ºè¯Šæ–­æˆåŠŸã€‚ httpGetå¯¹å®¹å™¨çš„ IP åœ°å€ä¸ŠæŒ‡å®šç«¯å£å’Œè·¯å¾„æ‰§è¡Œ HTTP GET è¯·æ±‚ã€‚å¦‚æœå“åº”çš„çŠ¶æ€ç å¤§äºç­‰äº 200 ä¸”å°äº 400ï¼Œåˆ™è¯Šæ–­è¢«è®¤ä¸ºæ˜¯æˆåŠŸçš„ã€‚ tcpSocketå¯¹å®¹å™¨çš„ IP åœ°å€ä¸Šçš„æŒ‡å®šç«¯å£æ‰§è¡Œ TCP æ£€æŸ¥ã€‚å¦‚æœç«¯å£æ‰“å¼€ï¼Œåˆ™è¯Šæ–­è¢«è®¤ä¸ºæ˜¯æˆåŠŸçš„ã€‚å¦‚æœè¿œç¨‹ç³»ç»Ÿï¼ˆå®¹å™¨ï¼‰åœ¨æ‰“å¼€è¿æ¥åç«‹å³å°†å…¶å…³é—­ï¼Œè¿™ç®—ä½œæ˜¯å¥åº·çš„ã€‚ æ³¨æ„ï¼šå’Œå…¶ä»–æœºåˆ¶ä¸åŒï¼Œexec æ¢é’ˆçš„å®ç°æ¶‰åŠæ¯æ¬¡æ‰§è¡Œæ—¶åˆ›å»ºå¤åˆ¶å¤šä¸ªè¿›ç¨‹ã€‚å› æ­¤ï¼Œåœ¨é›†ç¾¤ä¸­å…·æœ‰è¾ƒé«˜ pod å¯†åº¦ã€è¾ƒä½çš„ initialDelaySeconds å’Œ periodSeconds æ—¶é•¿çš„æ—¶å€™ï¼Œé…ç½®ä»»ä½•ä½¿ç”¨ exec æœºåˆ¶çš„æ¢é’ˆå¯èƒ½ä¼šå¢åŠ èŠ‚ç‚¹çš„ CPU è´Ÿè½½ã€‚è¿™ç§åœºæ™¯ä¸‹ï¼Œè¯·è€ƒè™‘ä½¿ç”¨å…¶ä»–æ¢é’ˆæœºåˆ¶ä»¥é¿å…é¢å¤–çš„å¼€é”€ã€‚ æ¯æ¬¡æ¢æµ‹ç»“æœä¼šæ˜¯ä»¥ä¸‹ä¸‰ç§ä¹‹ä¸€ï¼š æˆåŠŸï¼šè¡¨ç¤ºå®¹å™¨é€šè¿‡äº†æ£€æŸ¥ã€‚ å¤±è´¥ï¼šè¡¨ç¤ºå®¹å™¨æœªé€šè¿‡æ£€æŸ¥ã€‚ æœªçŸ¥ï¼šæ£€æŸ¥å¤±è´¥ï¼Œå› æ­¤ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œã€‚ æ¢é’ˆç±»å‹é’ˆå¯¹è¿è¡Œä¸­çš„å®¹å™¨ï¼Œkubelet å¯ä»¥é€‰æ‹©æ˜¯å¦æ‰§è¡Œä»¥ä¸‹ä¸‰ç§æ¢é’ˆï¼Œä»¥åŠå¦‚ä½•é’ˆå¯¹æ¢æµ‹ç»“æœä½œå‡ºååº”ï¼š livenessProbeæŒ‡ç¤ºå®¹å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œã€‚å¦‚æœå­˜æ´»æ€æ¢æµ‹å¤±è´¥ï¼Œåˆ™ kubelet ä¼šæ€æ­»å®¹å™¨ï¼Œå¹¶ä¸”å®¹å™¨å°†æ ¹æ®å…¶é‡å¯ç­–ç•¥å†³å®šæœªæ¥ã€‚å¦‚æœå®¹å™¨ä¸æä¾›å­˜æ´»æ¢é’ˆï¼Œåˆ™é»˜è®¤çŠ¶æ€ä¸º Success æˆåŠŸï¼šé™é»˜ å¤±è´¥ï¼šæ ¹æ®é‡å¯çš„ç­–ç•¥è¿›è¡Œé‡å¯çš„åŠ¨ä½œ æœªçŸ¥ï¼šé™é»˜ readinessProbeæŒ‡ç¤ºå®¹å™¨æ˜¯å¦å‡†å¤‡å¥½ä¸ºè¯·æ±‚æä¾›æœåŠ¡ã€‚å¦‚æœå°±ç»ªæ€æ¢æµ‹å¤±è´¥ï¼Œ EndpointSlice æ§åˆ¶å™¨å°†ä»ä¸è¯¥ Pod åŒ¹é…çš„æ‰€æœ‰ Service çš„ EndpointSlice ä¸­åˆ é™¤è¯¥ Pod çš„ IP åœ°å€ã€‚åˆå§‹å»¶è¿Ÿä¹‹å‰çš„å°±ç»ªæ€çš„çŠ¶æ€å€¼é»˜è®¤ä¸º Failureã€‚å¦‚æœå®¹å™¨ä¸æä¾›å°±ç»ªæ€æ¢é’ˆï¼Œåˆ™é»˜è®¤çŠ¶æ€ä¸º Successã€‚ï¼ˆå¦‚æœ pod å†…éƒ¨çš„å®¹å™¨ä¸æ·»åŠ å°±ç»ªæ¢æµ‹ï¼Œåˆ™çŠ¶æ€é»˜è®¤å°±ç»ªã€‚å¦‚æœæ·»åŠ äº†å°±ç»ªæ¢æµ‹ï¼Œåªæœ‰å°±ç»ªé€šè¿‡åï¼Œæ‰æ ‡è®°ä¿®æ”¹ä¸ºå°±ç»ªçŠ¶æ€ã€‚å½“å‰ pod å†…æ‰€æœ‰çš„å®¹å™¨éƒ½å°±ç»ªï¼Œæ‰æ ‡è®°å½“å‰çš„ pod å°±ç»ªï¼‰ æˆåŠŸï¼šå°†å½“å‰å®¹å™¨æ ‡è®°ä¸ºå°±ç»ª å¤±è´¥ï¼šé™é»˜ æœªçŸ¥ï¼šé™é»˜ startupProbeæŒ‡ç¤ºå®¹å™¨ä¸­çš„åº”ç”¨æ˜¯å¦å·²ç»å¯åŠ¨ã€‚å¦‚æœæä¾›äº†å¯åŠ¨æ¢é’ˆï¼Œåˆ™æ‰€æœ‰å…¶ä»–æ¢é’ˆéƒ½ä¼šè¢«ç¦ç”¨ï¼Œç›´åˆ°æ­¤æ¢é’ˆæˆåŠŸä¸ºæ­¢ã€‚å¦‚æœå¯åŠ¨æ¢æµ‹å¤±è´¥ï¼Œkubelet å°†æ€æ­»å®¹å™¨ï¼Œè€Œå®¹å™¨ä¾å…¶é‡å¯ç­–ç•¥è¿›è¡Œé‡å¯ã€‚ å¦‚æœå®¹å™¨æ²¡æœ‰æä¾›å¯åŠ¨æ¢æµ‹ï¼Œåˆ™é»˜è®¤çŠ¶æ€ä¸º Successã€‚ æˆåŠŸï¼šå°±ç»ªæ¢æµ‹å¼€å§‹æ‰§è¡Œ å¤±è´¥ï¼šè¶…å‡ºæ¢æµ‹æ—¶é—´ä¼šè¿›è¡Œé‡å¯ã€‚ æœªçŸ¥ï¼šé™é»˜ æ¢é’ˆé€‰é¡¹é€‰é¡¹è¯´æ˜ï¼š initialDelaySecondsï¼šå®¹å™¨å¯åŠ¨åè¦ç­‰å¾…å¤šå°‘ç§’åæ¢é’ˆå°±å¼€å§‹å·¥ä½œï¼Œå•ä½â€™ç§’â€™ï¼Œé»˜è®¤æ˜¯ 0 ç§’ï¼Œ æœ€å°å€¼ä¹Ÿæ˜¯ 0ã€‚ periodSecondsï¼šæ‰§è¡Œæ¢æµ‹çš„æ—¶é—´é—´éš”ï¼ˆå•ä½æ˜¯ç§’ï¼‰ï¼Œé»˜è®¤ä¸º 10 ç§’ï¼Œæœ€å°å€¼æ˜¯ 1ã€‚ timeoutSecondsï¼šæ¢é’ˆæ‰§è¡Œæ£€æµ‹è¯·æ±‚åï¼Œç­‰å¾…å“åº”çš„è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ç§’ï¼‰ï¼Œé»˜è®¤ä¸º 1 ç§’ï¼Œæœ€å°å€¼æ˜¯ 1 ç§’ã€‚ successThresholdï¼šæ¢é’ˆæ£€æµ‹åè®¤ä¸ºæˆåŠŸçš„æœ€å°è¿æ¥æˆåŠŸæ¬¡æ•°ï¼Œé»˜è®¤å€¼ä¸º 1ã€‚å¿…é¡»ä¸º 1 æ‰èƒ½æ¿€æ´»å’Œå¯åŠ¨ã€‚æœ€å°å€¼ä¸º 1ã€‚ failureThresholdï¼šæ¢æµ‹å¤±è´¥çš„é‡è¯•æ¬¡æ•°ï¼Œé‡è¯•ä¸€å®šæ¬¡æ•°åå°†è®¤ä¸ºå¤±è´¥ï¼Œé»˜è®¤å€¼ä¸º 3ï¼Œæœ€å°å€¼ä¸º 1ã€‚ å°±ç»ªæ¢é’ˆæµ‹è¯•# åˆ›å»ºä¸¤ä¸ª pod # 1-pod-demo.yamlapiVersion: v1kind: Podmetadata: name: pod-1 namespace: default labels: app: myappspec: containers: - name: myapp-1 image: wangyanglinux/myapp:v1.0# 2-pod-demo.yamlapiVersion: v1kind: Podmetadata: name: pod-2 namespace: default labels: app: myappspec: containers: - name: myapp-1 image: wangyanglinux/myapp:v1.0 # åˆ›å»º podkubectl apply -f 1-pod-demo.yaml kubectl apply -f 2-pod-demo.yaml # åˆ›å»º svc (serviceåç§°ä¸º myapp æ—¶é»˜è®¤ç»‘å®šåˆ°ä¸­ labels ä¸º myapp çš„ pod)kubectl create svc clusterip myapp --tcp=80:80kubectl get svc å¯ä»¥çœ‹åˆ°è¯·æ±‚è¢«è´Ÿè½½å‡è¡¡åˆ°äº† pod1 å’Œ pod2, æ­¤æ—¶åˆ›å»º pod3ã€‚ apiVersion: v1kind: Podmetadata: name: readiness-httpget-pod namespace: default labels: app: myapp env: testspec: containers: - name: readiness-httpget-container image: wangyanglinux/myapp:v1.0 imagePullPolicy: IfNotPresent # è¿™é‡Œå›å»è®¿é—® index1.html æˆåŠŸæ‰ä¼šæ ‡è®°ä¸ºå°±ç»ªçŠ¶æ€ readinessProbe: httpGet: port: 80 path: /index1.html initialDelaySeconds: 1 periodSeconds: 3 kubectl apply -f readiness-httpget-pod.yaml kubectl describe pod readiness-httpget-podcd /usr/local/nginx/htmlecho dao ci yi you index1.html å¯ä»¥çœ‹åˆ° pod ä¸€ç›´å¤„äºä¸ºå°±ç»ªçŠ¶æ€ï¼Œè¯·æ±‚ä¹Ÿä¸ä¼šèµ°åˆ° pod3ã€‚ kubectl exec -it readiness-httpget-pod -c readiness-httpget-container -- /bin/bashcd /usr/local/nginx/htmlecho dao ci yi you index1.html åˆ›å»º index1.html å pod å°±ç»ªçŠ¶æ€æ”¹ä¸ºæˆåŠŸçŠ¶æ€ï¼Œè¯·æ±‚ä¹Ÿèƒ½å¤Ÿèµ°åˆ° pod3ã€‚å°±ç»ªæ¢æµ‹ä¿è¯äº†æä¾›ç»™ç”¨æˆ·çš„æœåŠ¡æ—¶å¯ç”¨çš„ã€‚ å…¶ä»–æ£€æŸ¥æ–¹å¼ï¼š åŸºäº exec æ–¹å¼ apiVersion: v1kind: Podmetadata: name: readiness-exec-pod namespace: defaultspec: containers: - name: readiness-exec-container image: wangyanglinux/tools:busybox imagePullPolicy: IfNotPresent command: [/bin/sh,-c,touch /tmp/live ; sleep 60; rm -rf /tmp/live;sleep 3600] readinessProbe: exec: command: [test,-e,/tmp/live] initialDelaySeconds: 1 periodSeconds: 3 åŸºäº Tcp check æ–¹å¼ apiVersion: v1kind: Podmetadata: name: readiness-tcp-podspec: containers: - name: readiness-exec-container image: wangyanglinux/myapp:v1.0 readinessProbe: initialDelaySeconds: 5 timeoutSeconds: 1 tcpSocket: port: 80 å­˜æ´»æ¢é’ˆæµ‹è¯•apiVersion: v1kind: Podmetadata: name: liveness-exec-pod namespace: defaultspec: containers: - name: liveness-exec-container image: wangyanglinux/tools:busybox imagePullPolicy: IfNotPresent # å¯åŠ¨æ—¶åˆ›å»º /tmp/live ç›®å½•ï¼Œç¡çœ  60s åˆ é™¤ /tmp/live å†ç¡çœ  3600 command: [/bin/sh,-c,touch /tmp/live ; sleep 60; rm -rf /tmp/live;sleep 3600] livenessProbe: exec: # æŸ¥çœ‹ /tmp/live ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨å­˜æ´»æ¢æµ‹å¤±è´¥ command: [test,-e,/tmp/live] initialDelaySeconds: 1 periodSeconds: 3 å¯ä»¥çœ‹åˆ° pod é‡å»ºäº†ä¸¤æ¬¡ï¼Œå½“å­˜æ´»æ¢é’ˆæ¢æµ‹ pod å­˜æ´»çŠ¶æ€å¤±è´¥æ—¶ï¼Œä¼šå°† pod åˆ é™¤é‡å»ºå·²è¾¾åˆ°è‡ªæ„ˆçš„ç›®çš„ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¾ç¤ºé‡å¯æ¬¡æ•°å¢åŠ ã€‚ å…¶ä»–æ£€æŸ¥æ–¹å¼ï¼š åŸºäº HTTP Get æ–¹å¼ apiVersion: v1kind: Podmetadata: name: liveness-httpget-pod namespace: defaultspec: containers: - name: liveness-httpget-container image: wangyanglinux/myapp:v1.0 imagePullPolicy: IfNotPresent ports: - name: http containerPort: 80 livenessProbe: httpGet: port: 80 path: /index.html initialDelaySeconds: 1 periodSeconds: 3 timeoutSeconds: 3 åŸºäº TCP Check æ–¹å¼ apiVersion: v1kind: Podmetadata: name: liveness-tcp-podspec: containers: - name: liveness-tcp-container image: wangyanglinux/myapp:v1.0 livenessProbe: initialDelaySeconds: 5 timeoutSeconds: 1 tcpSocket: port: 80 å¯åŠ¨æ¢é’ˆæµ‹è¯•apiVersion: v1kind: Podmetadata: name: startupprobe-1 namespace: defaultspec: containers: - name: myapp-container image: wangyanglinux/myapp:v1.0 imagePullPolicy: IfNotPresent ports: - name: http containerPort: 80 readinessProbe: httpGet: port: 80 path: /index2.html initialDelaySeconds: 1 periodSeconds: 3 startupProbe: httpGet: path: /index1.html port: 80 failureThreshold: 30 periodSeconds: 10 åº”ç”¨ç¨‹åºå°†ä¼šæœ‰æœ€å¤š 5 åˆ†é’Ÿ failureThreshold periodSecondsï¼ˆ30 10 300sï¼‰çš„æ—¶é—´æ¥å®Œæˆå…¶å¯åŠ¨è¿‡ç¨‹ã€‚å¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…è¿˜æœªæ¢æµ‹æˆåŠŸï¼Œé‚£ä¹ˆ k8s ä¼šé‡å»ºè¯¥ podã€‚ å¯ä»¥çœ‹åˆ°å½“å‰å¯åŠ¨æ¢æµ‹å¤±è´¥ã€‚ # åˆ›å»º /index1.html æ–‡ä»¶kubectl exec -it startupprobe-1 /bin/bashcd /usr/local/nginx/html/echo hahaha index1.html æ­¤æ—¶è¿˜å¤„äºæœªå°±ç»ªçŠ¶æ€ï¼Œå› ä¸º index2.html æ–‡ä»¶æœªåˆ›å»ºã€‚ kubectl exec -it startupprobe-1 /bin/bashcd /usr/local/nginx/html/echo gagaga index2.html å½“ index2.html æ–‡ä»¶åˆ›å»ºæˆåŠŸåï¼Œå°±ç»ªæ¢æµ‹ä¹ŸæˆåŠŸäº†ã€‚ é’©å­Pod hook(é’©å­) æ˜¯ç”± Kubernetes ç®¡ç†çš„ kubelet å‘èµ·çš„ï¼Œå½“å®¹å™¨ä¸­çš„è¿›ç¨‹å¯åŠ¨åæˆ–å®¹å™¨ä¸­çš„è¿›ç¨‹ç»ˆæ­¢ä¹‹å‰è¿è¡Œï¼Œè¿™æ˜¯åŒ…å«åœ¨å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸä¹‹ä¸­ã€‚å¯ä»¥åŒæ—¶ä¸º Pod ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½é…ç½® hookã€‚ Hook çš„ç±»å‹åŒ…æ‹¬ä¸¤ç§ï¼š execï¼šæ‰§è¡Œä¸€æ®µå‘½ä»¤ HTTP: å‘é€ HTTP è¯·æ±‚ apiVersion: v1kind: Podmetadata: name: lifecycle-httpget-pod labels: name: lifecycle-httpget-podspec: containers: - name: lifecycle-httpget-container image: wangyanglinux/myapp:v1.0 ports: - containerPort: 80 lifecycle: postStart: httpGet: # æ›¿æ¢è‡ªèº«IP host: 10.37.129.10 path: index.html port: 1234 preStop: httpGet: host: 10.37.129.10 path: hostname.html port: 1234 # å¼€å¯ä¸€ä¸ªæµ‹è¯• webServerdocker run -it --rm -p 1234:80 wangyanglinux/myapp:v1.0kubectl apply -f lifecycle-httpget-pod.yaml å¯ä»¥çœ‹åˆ°å¯åŠ¨åé’©å­è¢«æ‰§è¡Œï¼š kubectl delete pod lifecycle-httpget-pod å¯ä»¥çœ‹åˆ°åœæ­¢å‰é’©å­è¢«æ‰§è¡Œï¼š exec Hook ç¤ºä¾‹ï¼š apiVersion: v1kind: Podmetadata: name: lifecycle-exec-podspec: containers: - name: lifecycle-exec-container image: wangyanglinux/myapp:v1 lifecycle: postStart: exec: command: [/bin/sh, -c, echo postStart /usr/share/message] preStop: exec: command: [/bin/sh, -c, echo preStop /usr/share/message] æ•´ä¸ªç”Ÿå‘½å‘¨æœŸç¤ºä¾‹ç›®æ ‡ï¼šå®Œæˆ pod å¯åŠ¨æˆåŠŸ apiVersion: v1kind: Podmetadata: name: lifecycle-pod labels: app: lifecycle-podspec: containers: - name: busybox-container image: wangyanglinux/tools:busybox command: [/bin/sh,-c,touch /tmp/live ; sleep 600; rm -rf / tmp/live; sleep 3600] # å­˜æ´»æ¢é’ˆ livenessProbe: exec: command: [test, -e, /tmp/live] initialDelaySeconds: 1 periodSeconds: 3 # é’©å­ lifecycle: postStart: httpGet: # æ›¿æ¢è‡ªèº«IP host: 10.37.129.10 path: index.html port: 1234 preStop: httpGet: host: 10.37.129.10 path: hostname.html port: 1234 - name: myapp-container image: wangyanglinux/myapp:v1.0 livenessProbe: httpGet: port: 80 path: /index.html initialDelaySeconds: 1 periodSeconds: 3 timeoutSeconds: 3 # å°±ç»ªæ¢é’ˆ readinessProbe: httpGet: port: 80 path: /index1.html initialDelaySeconds: 1 periodSeconds: 3 # åˆå§‹åŒ–å®¹å™¨ initContainers: - name: init-myservice image: wangyanglinux/tools:busybox command: [sh, -c, until nslookup myservice; do echo waiting for myservice; sleep 2; done;] - name: init-mydb image: wangyanglinux/tools:busybox command: [sh, -c, until nslookup mydb; do echo waiting for mydb; sleep 2; done;] kubectl apply -f lifecycle-httpget-pod.yaml kubectl create svc clusterip myservice --tcp=80:80kubectl create svc clusterip mydb --tcp=80:80docker run -it --rm -p 1234:80 wangyanglinux/myapp:v1.0kubectl exec -it lifecycle-pod -c myapp-container /bin/bashecho hahah index1.htmlexit Pod è°ƒåº¦æµç¨‹","tags":[null],"categories":[null]},{"title":"Rancherå®‰è£…","path":"/wiki/Kubernetes/Rancherå®‰è£….html","content":"Ingress-Nginx å®‰è£…# æ·»åŠ  ingress-controllerhelm repo add ingress-nginx https://kubernetes.github.io/ingress-nginxhelm pull ingress-nginx/ingress-nginxtar -zxvf ingress-nginx-*tgzcd ingress-nginx# ä¿®æ”¹ values.yaml æ–‡ä»¶ä¿®æ”¹ hostNetwork çš„å€¼ä¸º truereplicaCountçš„å€¼ä¿®æ”¹ä¸ºï¼š2dnsPolicyçš„å€¼æ”¹ä¸º: ClusterFirstWithHostNetkindç±»å‹æ›´æ”¹ä¸ºï¼šDaemonSetå…³é—­æ‰€æœ‰é•œåƒçš„ digestä¿®æ”¹admissionWebhooks:port:8444ingressClassResource.default=truekubectl create ns ingresshelm install ingress-nginx -n ingress . -f values.yaml # tlsé…ç½®cd ~openssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj /CN=nginxsvc/O=nginxsvckubectl create secret tls ingress-nginx-tls --key tls.key --cert tls.crt Rancherå®‰è£…æ·»åŠ  Helm Chart ä»“åº“æ‰§è¡Œ helm repo add å‘½ä»¤ï¼Œä»¥æ·»åŠ åŒ…å«å®‰è£… Rancher çš„ Chart çš„ Helm Chart ä»“åº“ã€‚æœ‰å…³å¦‚ä½•é€‰æ‹©ä»“åº“ï¼Œä»¥åŠå“ªä¸ªä»“åº“æœ€é€‚åˆä½ çš„ç”¨ä¾‹ï¼Œè¯·å‚è§é€‰æ‹© Rancher ç‰ˆæœ¬ã€‚ Latestï¼šå»ºè®®ç”¨äºè¯•ç”¨æœ€æ–°åŠŸèƒ½ helm repo add rancher-latest https://releases.rancher.com/server-charts/latest Stableï¼šå»ºè®®ç”¨äºç”Ÿäº§ç¯å¢ƒ helm repo add rancher-stable https://releases.rancher.com/server-charts/stable Alphaï¼šå³å°†å‘å¸ƒçš„å®éªŒæ€§é¢„è§ˆã€‚ helm repo add rancher-alpha https://releases.rancher.com/server-charts/alpha æ³¨æ„ï¼šä¸æ”¯æŒå‡çº§åˆ° Alpha ç‰ˆã€ä» Alpha ç‰ˆå‡çº§æˆ–åœ¨ Alpha ç‰ˆä¹‹é—´å‡çº§ã€‚ ä¸º Rancher åˆ›å»ºå‘½åç©ºé—´ä½ éœ€è¦å®šä¹‰ä¸€ä¸ª Kubernetes å‘½åç©ºé—´ï¼Œç”¨äºå®‰è£…ç”± Chart åˆ›å»ºçš„èµ„æºã€‚è¿™ä¸ªå‘½åç©ºé—´çš„åç§°ä¸º cattle-systemï¼š kubectl create namespace cattle-system é€‰æ‹© SSL é…ç½®Rancher Management Server é»˜è®¤éœ€è¦ SSLTLS é…ç½®æ¥ä¿è¯è®¿é—®çš„å®‰å…¨æ€§ã€‚ å¦‚æœä½ æƒ³åœ¨å¤–éƒ¨ç»ˆæ­¢ SSLTLSï¼Œè¯·å‚è§å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨çš„ TLS ç»ˆæ­¢ã€‚ ä½ å¯ä»¥ä»ä»¥ä¸‹ä¸‰ç§è¯ä¹¦æ¥æºä¸­é€‰æ‹©ä¸€ç§ï¼Œç”¨äºåœ¨ Rancher Server ä¸­ç»ˆæ­¢ TLSï¼š Rancher ç”Ÿæˆçš„ TLS è¯ä¹¦ï¼šè¦æ±‚ä½ åœ¨é›†ç¾¤ä¸­å®‰è£… cert-managerã€‚Rancher ä½¿ç”¨ cert-manager ç­¾å‘å¹¶ç»´æŠ¤è¯ä¹¦ã€‚Rancher ä¼šç”Ÿæˆè‡ªå·±çš„ CA è¯ä¹¦ï¼Œå¹¶ä½¿ç”¨è¯¥ CA ç­¾ç½²è¯ä¹¦ã€‚ç„¶å cert-managerè´Ÿè´£ç®¡ç†è¯¥è¯ä¹¦ã€‚ Letâ€™s Encryptï¼šLetâ€™s Encrypt é€‰é¡¹ä¹Ÿéœ€è¦ä½¿ç”¨ cert-managerã€‚ä½†æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œcert-manager ä¸ Letâ€™s Encrypt çš„ç‰¹æ®Šé¢å‘è€…ç›¸ç»“åˆï¼Œè¯¥é¢å‘è€…æ‰§è¡Œè·å– Letâ€™s Encrypt é¢å‘çš„è¯ä¹¦æ‰€éœ€çš„æ‰€æœ‰æ“ä½œï¼ˆåŒ…æ‹¬è¯·æ±‚å’ŒéªŒè¯ï¼‰ã€‚æ­¤é…ç½®ä½¿ç”¨ HTTP éªŒè¯ï¼ˆHTTP-01ï¼‰ï¼Œå› æ­¤è´Ÿè½½å‡è¡¡å™¨å¿…é¡»å…·æœ‰å¯ä»¥ä»äº’è”ç½‘è®¿é—®çš„å…¬å…± DNS è®°å½•ã€‚ ä½ å·²æœ‰çš„è¯ä¹¦ï¼šä½¿ç”¨å·²æœ‰çš„ CA é¢å‘çš„å…¬æœ‰æˆ–ç§æœ‰è¯ä¹¦ã€‚Rancher å°†ä½¿ç”¨è¯¥è¯ä¹¦æ¥ä¿æŠ¤ WebSocket å’Œ HTTPS æµé‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¿…é¡»ä¸Šä¼ åç§°åˆ†åˆ«ä¸º tls.crt å’Œ tls.keyçš„ PEM æ ¼å¼çš„è¯ä¹¦ä»¥åŠç›¸å…³çš„å¯†é’¥ã€‚å¦‚æœä½ ä½¿ç”¨ç§æœ‰ CAï¼Œåˆ™è¿˜å¿…é¡»ä¸Šä¼ è¯¥ CA è¯ä¹¦ã€‚è¿™æ˜¯ç”±äºä½ çš„èŠ‚ç‚¹å¯èƒ½ä¸ä¿¡ä»»æ­¤ç§æœ‰ CAã€‚Rancher å°†è·å–è¯¥ CA è¯ä¹¦ï¼Œå¹¶ä»ä¸­ç”Ÿæˆä¸€ä¸ªæ ¡éªŒå’Œï¼Œå„ç§ Rancher ç»„ä»¶å°†ä½¿ç”¨è¯¥æ ¡éªŒå’Œæ¥éªŒè¯å…¶ä¸ Rancher çš„è¿æ¥ã€‚ é…ç½® Helm Chart é€‰é¡¹ æ˜¯å¦éœ€è¦ cert-manager Rancher ç”Ÿæˆçš„è¯ä¹¦ï¼ˆé»˜è®¤ï¼‰ ingress.tls.source=rancher æ˜¯ Letâ€™s Encrypt ingress.tls.source=letsEncrypt æ˜¯ ä½ å·²æœ‰çš„è¯ä¹¦ ingress.tls.source=secret å¦ å®‰è£… cert-manager å¦‚æœä½ ä½¿ç”¨è‡ªå·±çš„è¯ä¹¦æ–‡ä»¶ï¼ˆingress.tls.source=secretï¼‰æˆ–ä½¿ç”¨å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨çš„ TLS ç»ˆæ­¢ï¼Œä½ å¯ä»¥è·³è¿‡æ­¤æ­¥éª¤ã€‚ ä»…åœ¨ä½¿ç”¨ Rancher ç”Ÿæˆçš„è¯ä¹¦ï¼ˆingress.tls.source=rancherï¼‰æˆ– Letâ€™s Encrypt é¢å‘çš„è¯ä¹¦ï¼ˆingress.tls.source=letsEncryptï¼‰æ—¶ï¼Œæ‰éœ€è¦å®‰è£… cert-managerã€‚ # å¦‚æœä½ æ‰‹åŠ¨å®‰è£…äº†CRDï¼Œè€Œä¸æ˜¯åœ¨ Helm å®‰è£…å‘½ä»¤ä¸­æ·»åŠ äº† `--set installCRDs=true` é€‰é¡¹ï¼Œä½ åº”è¯¥åœ¨å‡çº§ Helm Chart ä¹‹å‰å‡çº§ CRD èµ„æºã€‚#kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.18.2/cert-manager.crds.yaml# æ·»åŠ  Jetstack Helm ä»“åº“helm repo add jetstack https://charts.jetstack.io# æ›´æ–°æœ¬åœ° Helm Chart ä»“åº“ç¼“å­˜helm repo updatekubectl create namespace cert-managerhelm install cert-manager --namespace cert-manager --version v1.18.2 --set crds.enabled=true jetstack/cert-manager æ ¹æ®ä½ é€‰æ‹©çš„è¯ä¹¦é€‰é¡¹ï¼Œé€šè¿‡ Helm å®‰è£… Rancherä¸åŒçš„è¯ä¹¦é…ç½®éœ€è¦ä½¿ç”¨ä¸åŒçš„ Rancher å®‰è£…å‘½ä»¤ã€‚ é»˜è®¤æƒ…å†µæ˜¯ä½¿ç”¨ Rancher ç”Ÿæˆ CAï¼Œå¹¶ä½¿ç”¨ cert-manager é¢å‘ç”¨äºè®¿é—® Rancher Server æ¥å£çš„è¯ä¹¦ã€‚ ç”±äº rancher æ˜¯ ingress.tls.source çš„é»˜è®¤é€‰é¡¹ï¼Œå› æ­¤åœ¨æ‰§è¡Œ helm install å‘½ä»¤æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦æŒ‡å®š ingress.tls.sourceã€‚ å°† hostname è®¾ç½®ä¸ºè§£æåˆ°ä½ çš„è´Ÿè½½å‡è¡¡å™¨çš„ DNS åç§°ã€‚ å°† bootstrapPassword è®¾ç½®ä¸º admin ç”¨æˆ·ç‹¬æœ‰çš„å€¼ã€‚ å¦‚æœä½ éœ€è¦å®‰è£…æŒ‡å®šçš„ Rancher ç‰ˆæœ¬ï¼Œä½¿ç”¨ --version æ ‡å¿—ï¼Œä¾‹å¦‚ --version 2.7.0ã€‚ # æ·»åŠ  ingress-controllerhelm repo add ingress-nginx https://kubernetes.github.io/ingress-nginxhelm pull ingress-nginx/ingress-nginxcd ingress-nginx# ä¿®æ”¹ values.yaml æ–‡ä»¶ä¿®æ”¹ hostNetwork çš„å€¼ä¸º truereplicaCountçš„å€¼ä¿®æ”¹ä¸ºï¼š2dnsPolicyçš„å€¼æ”¹ä¸º: ClusterFirstWithHostNetkindç±»å‹æ›´æ”¹ä¸ºï¼šDaemonSetå…³é—­æ‰€æœ‰é•œåƒçš„ digestingressClassResource.default=truekubectl create ns ingresshelm install ingress-nginx -n ingress . -f values.yaml # æ·»åŠ åŸŸååˆ°hostæ–‡ä»¶10.37.129.11 www1.k8s.com # â€Œå¦‚ä¸ŠæŠ¥é”™éœ€è¦é‡æ–°åˆ›å»º Webhook è¯ä¹¦â€Œkubectl delete secret -n ingress-nginx ingress-nginx-admissionkubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/cloud/deploy.yaml# â€ŒéªŒè¯ Webhook æœåŠ¡â€Œkubectl get validatingwebhookconfigurations ingress-nginx-admission -o yamlç¡®è®¤é…ç½®ä¸­å­˜åœ¨æœ‰æ•ˆçš„ clientConfig å’ŒæœåŠ¡ç«¯ç‚¹# å®‰è£… rancherhelm install rancher rancher-stable/rancher \\ --namespace cattle-system \\ --set hostname=rancher.dev.com \\ --set bootstrapPassword=admin \\ --set ingress.tls.source=letsEncrypt \\ --set letsEncrypt.email=me@example.org \\ --set letsEncrypt.ingress.class=nginx \\ --set ingress.ingressClassName=nginx éªŒè¯ Rancher Server æ˜¯å¦éƒ¨ç½²æˆåŠŸæ·»åŠ å¯†æ–‡åï¼Œæ£€æŸ¥ Rancher æ˜¯å¦å·²æˆåŠŸè¿è¡Œï¼š kubectl -n cattle-system rollout status deploy/rancherWaiting for deployment rancher rollout to finish: 0 of 3 updated replicas are available...deployment rancher successfully rolled out å¦‚æœä½ çœ‹åˆ° error: deployment rancher exceeded its progress deadline è¿™ä¸ªé”™è¯¯ï¼Œå¯è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥ deployment çš„çŠ¶æ€ï¼š kubectl -n cattle-system get deploy rancherNAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGErancher 3 3 3 3 3mecho 10.37.129.10 rancher.my.org /etc/hosts DESIRED å’Œ AVAILABLEçš„ä¸ªæ•°åº”è¯¥ç›¸åŒã€‚ kubectl -n cattle-system exec $(kubectl -n cattle-system get pods -l app=rancher | grep 1/1 | head -1 | awk print $1 ) -- reset-password helm repo add harbor https://helm.goharbor.io","tags":[null],"categories":[null]},{"title":"Kubernetes Service","path":"/wiki/Kubernetes/Service.html","content":"ServiceServiceæ¦‚å¿µKubernetes ä¸­ Service æ˜¯ å°†è¿è¡Œåœ¨ä¸€ä¸ªæˆ–ä¸€ç»„ Pod ä¸Šçš„ç½‘ç»œåº”ç”¨ç¨‹åºå…¬å¼€ä¸ºç½‘ç»œæœåŠ¡çš„æ–¹æ³•ã€‚ Kubernetes ä¸­ Service çš„ä¸€ä¸ªå…³é”®ç›®æ ‡æ˜¯è®©ä½ æ— éœ€ä¿®æ”¹ç°æœ‰åº”ç”¨ä»¥ä½¿ç”¨æŸç§ä¸ç†Ÿæ‚‰çš„æœåŠ¡å‘ç°æœºåˆ¶ã€‚ ä½ å¯ä»¥åœ¨ Pod é›†åˆä¸­è¿è¡Œä»£ç ï¼Œæ— è®ºè¯¥ä»£ç æ˜¯ä¸ºäº‘åŸç”Ÿç¯å¢ƒè®¾è®¡çš„ï¼Œè¿˜æ˜¯è¢«å®¹å™¨åŒ–çš„è€åº”ç”¨ã€‚ ä½ å¯ä»¥ä½¿ç”¨ Service è®©ä¸€ç»„ Pod å¯åœ¨ç½‘ç»œä¸Šè®¿é—®ï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±èƒ½ä¸ä¹‹äº¤äº’ã€‚ å¦‚æœä½ ä½¿ç”¨ Deployment æ¥è¿è¡Œä½ çš„åº”ç”¨ï¼Œ Deployment å¯ä»¥åŠ¨æ€åœ°åˆ›å»ºå’Œé”€æ¯ Podã€‚ åœ¨ä»»ä½•æ—¶åˆ»ï¼Œä½ éƒ½ä¸çŸ¥é“æœ‰å¤šå°‘ä¸ªè¿™æ ·çš„ Pod æ­£åœ¨å·¥ä½œä»¥åŠå®ƒä»¬å¥åº·ä¸å¦ï¼› ä½ å¯èƒ½ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¾¨åˆ«å¥åº·çš„ Podã€‚ Kubernetes Pod çš„åˆ›å»ºå’Œé”€æ¯æ˜¯ä¸ºäº†åŒ¹é…é›†ç¾¤çš„é¢„æœŸçŠ¶æ€ã€‚ Pod æ˜¯ä¸´æ—¶èµ„æºï¼ˆä½ ä¸åº”è¯¥æœŸå¾…å•ä¸ª Pod æ—¢å¯é åˆè€ç”¨ï¼‰ã€‚ æ¯ä¸ª Pod ä¼šè·å¾—å±äºè‡ªå·±çš„ IP åœ°å€ï¼ˆKubernetes æœŸå¾…ç½‘ç»œæ’ä»¶æ¥ä¿è¯è¿™ä¸€ç‚¹ï¼‰ã€‚ å¯¹äºé›†ç¾¤ä¸­ç»™å®šçš„æŸä¸ª Deploymentï¼Œè¿™ä¸€åˆ»è¿è¡Œçš„ Pod é›†åˆå¯èƒ½ä¸åŒäºä¸‹ä¸€åˆ»è¿è¡Œè¯¥åº”ç”¨çš„ Pod é›†åˆã€‚ è¿™å°±å¸¦æ¥äº†ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæŸç»„ Podï¼ˆç§°ä¸ºâ€œåç«¯â€ï¼‰ä¸ºé›†ç¾¤å†…çš„å…¶ä»– Podï¼ˆç§°ä¸ºâ€œå‰ç«¯â€ï¼‰ é›†åˆæä¾›åŠŸèƒ½ï¼Œå‰ç«¯è¦å¦‚ä½•å‘ç°å¹¶è·Ÿè¸ªè¦è¿æ¥çš„ IP åœ°å€ï¼Œä»¥ä¾¿å…¶ä½¿ç”¨è´Ÿè½½çš„åç«¯ç»„ä»¶å‘¢ï¼Ÿ Service API æ˜¯ Kubernetes çš„ç»„æˆéƒ¨åˆ†ï¼Œå®ƒæ˜¯ä¸€ç§æŠ½è±¡ï¼Œå¸®åŠ©ä½ å°† Pod é›†åˆåœ¨ç½‘ç»œä¸Šå…¬å¼€å‡ºå»ã€‚ æ¯ä¸ª Service å¯¹è±¡å®šä¹‰ç«¯ç‚¹çš„ä¸€ä¸ªé€»è¾‘é›†åˆï¼ˆé€šå¸¸è¿™äº›ç«¯ç‚¹å°±æ˜¯ Podï¼‰ä»¥åŠå¦‚ä½•è®¿é—®åˆ°è¿™äº› Pod çš„ç­–ç•¥ã€‚ æ ¸å¿ƒå·¥ä½œåŸç†kube-proxy: ç›‘å¬ apiServer å°† Service å˜åŒ–ä¿®æ”¹æœ¬åœ° iptables è§„åˆ™iptablesipvs: è´Ÿè´£è½¬å‘ç”¨æˆ·è¯·æ±‚æµé‡ Iptables Ipvs # ä¿®æ”¹ä¸ºipvs# æ³¨æ„ç³»ç»Ÿè¦æ”¯æŒ ipvskubectl edit configmap kube-proxy -n kube-systemkubectl delete pod -n kube-system -l k8s-app=kube-proxy â€Œç¼–è¾‘kube-proxyé…ç½®â€Œï¼š å‘½ä»¤ï¼škubectl edit configmap kube-proxy -n kube-system è§£é‡Šï¼šæ­¤å‘½ä»¤ç”¨äºç¼–è¾‘kube-systemå‘½åç©ºé—´ä¸­çš„kube-proxy ConfigMapï¼Œé€šå¸¸ç”¨äºæ›´æ”¹kube-proxyçš„å·¥ä½œæ¨¡å¼ã€‚ â€Œè®¾ç½®kube-proxyæ¨¡å¼ä¸ºipvsâ€Œï¼š åœ¨ç¼–è¾‘ç•Œé¢ä¸­ï¼Œå°†modeå­—æ®µè®¾ç½®ä¸ºipvsã€‚ è§£é‡Šï¼šipvsæ¨¡å¼æ˜¯é«˜æ€§èƒ½çš„IPè´Ÿè½½å‡è¡¡æ¨¡å¼ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡é›†ç¾¤ã€‚ â€Œåˆ é™¤kube-proxy Podâ€Œï¼š å‘½ä»¤ï¼škubectl delete pod -n kube-system -l k8s-app=kube-proxy è§£é‡Šï¼šæ­¤å‘½ä»¤ç”¨äºåˆ é™¤kube-systemå‘½åç©ºé—´ä¸­æ‰€æœ‰æ ‡ç­¾ä¸ºk8s-app=kube-proxyçš„Podï¼Œä»¥ä¾¿åº”ç”¨æ–°çš„é…ç½®ã€‚ Serviceç±»å‹Kubernetes Service çš„ç±»å‹ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š â€ŒClusterIPâ€Œï¼šè¿™æ˜¯é»˜è®¤ç±»å‹ï¼Œä»…é›†ç¾¤å†…éƒ¨å¯ä»¥è®¿é—®ï¼Œé€šè¿‡è‡ªåŠ¨åˆ†é…çš„è™šæ‹ŸIPè¿›è¡Œé€šä¿¡ã€‚ â€ŒNodePortâ€Œï¼šåœ¨ ClusterIP çš„åŸºç¡€ä¸Šï¼Œä¸ºæ¯å°æœºå™¨ç»‘å®šä¸€ä¸ªç«¯å£ï¼Œå¯ä»¥é€šè¿‡ NodeIP:NodePort çš„æ–¹å¼è®¿é—®æœåŠ¡ã€‚ â€ŒLoadBalancerâ€Œï¼šåœ¨ NodePort çš„åŸºç¡€ä¸Šï¼Œå€ŸåŠ©äº‘æä¾›å•†åˆ›å»ºä¸€ä¸ªå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ï¼Œå°†å¤–éƒ¨è¯·æ±‚è½¬å‘åˆ° NodeIP:NodePortã€‚ â€ŒExternalNameâ€Œï¼šæ­¤ç±»å‹å°†é›†ç¾¤å¤–éƒ¨çš„æœåŠ¡å¼•å…¥åˆ°é›†ç¾¤å†…éƒ¨ï¼Œé›†ç¾¤å†…éƒ¨å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›æœåŠ¡ï¼Œä½†éœ€ Kubernetes 1.7 æˆ–æ›´é«˜ç‰ˆæœ¬çš„ kube-dns æ”¯æŒã€‚ Serviceç±»å‹æ¨¡å¼è¯¦è§£ä»¥ä¸‹æ˜¯Kubernetes Serviceçš„å››ç§æ ¸å¿ƒæ¨¡å¼è¯¦è§£åŠå…¶åº”ç”¨åœºæ™¯ï¼š ClusterIPï¼ˆé»˜è®¤ç±»å‹ï¼‰â€Œæ ¸å¿ƒæœºåˆ¶â€Œ åˆ†é…é›†ç¾¤å†…éƒ¨è™šæ‹ŸIPï¼ˆVIPï¼‰ï¼Œä»…å…è®¸â€Œé›†ç¾¤å†…è®¿é—®â€Œã€‚ é€šè¿‡kube-proxyç»´æŠ¤åŠ¨æ€è·¯ç”±è§„åˆ™ï¼ˆiptablesIPVSå®ç°ï¼‰ã€‚ è‡ªåŠ¨è´Ÿè½½å‡è¡¡åˆ°å…³è”Podï¼ˆé€šè¿‡Label SelectoråŒ¹é…ï¼‰â€Œã€‚ â€Œå…¸å‹åœºæ™¯â€Œ å¾®æœåŠ¡é—´å†…éƒ¨é€šä¿¡ï¼ˆå¦‚å‰ç«¯è°ƒç”¨åç«¯APIï¼‰ã€‚ æ•°æ®åº“æœåŠ¡æš´éœ²ç»™åº”ç”¨å±‚ã€‚ ä¼˜åŠ¿ï¼šå®‰å…¨éš”ç¦»ï¼Œæ— éœ€æš´éœ²å¤–éƒ¨ç«¯å£â€Œ NodePortâ€Œä¸‰å±‚æ‰©å±•æ¶æ„â€Œ graph LRA[å¤–éƒ¨è¯·æ±‚] -- B(NodeIP:30000-32767ç«¯å£)B -- C[ClusterIPè™šæ‹ŸIP]C -- D[åç«¯Pod] â€Œæ ¸å¿ƒç‰¹æ€§â€Œ åœ¨ClusterIPåŸºç¡€ä¸Šï¼Œâ€Œæ¯ä¸ªNodeå¼€æ”¾é™æ€ç«¯å£â€Œï¼ˆé»˜è®¤30000-32767ï¼‰ã€‚ å¤–éƒ¨é€šè¿‡ä»»æ„NodeIP:NodePortè®¿é—®æœåŠ¡ã€‚ éœ€æ‰‹åŠ¨ç®¡ç†é˜²ç«å¢™è§„åˆ™â€Œã€‚ â€Œè¿ç»´åœºæ™¯â€Œ å¼€å‘æµ‹è¯•ç¯å¢ƒä¸´æ—¶è®¿é—®ã€‚ ä¸æ”¯æŒLoadBalancerçš„æœ¬åœ°é›†ç¾¤ã€‚ LoadBalancerï¼ˆäº‘æœåŠ¡å¢å¼ºï¼‰â€Œå·¥ä½œæµç¨‹â€Œ åˆ›å»ºServiceæ—¶è‡ªåŠ¨ç”³è¯·äº‘å¹³å°è´Ÿè½½å‡è¡¡å™¨ã€‚ è´Ÿè½½å‡è¡¡å™¨å°†æµé‡å¯¼å‘æ‰€æœ‰Nodeçš„NodePortã€‚ NodePortè½¬å‘è‡³ClusterIPå†åˆ°Podâ€Œã€‚ â€Œäº‘æœåŠ¡å·®å¼‚â€Œ äº‘å¹³å° å®ç°ç‰¹æ€§ AWS è‡ªåŠ¨åˆ›å»ºNLBå¹¶é…ç½®å®‰å…¨ç»„ GCP é›†æˆå¥åº·æ£€æŸ¥ä¸å…¨çƒè´Ÿè½½å‡è¡¡ Azure æ”¯æŒå…¬ç½‘å†…ç½‘è´Ÿè½½å‡è¡¡å™¨åŒæ¨¡å¼ å±€é™ï¼šä¾èµ–äº‘å‚å•†ï¼Œæœ¬åœ°é›†ç¾¤æ— æ³•ç›´æ¥ä½¿ç”¨â€Œ æœ¬åœ°ä½¿ç”¨ keepaliveipvs: äº‘æœåŠ¡ï¼š ExternalNameï¼ˆè·¨é›†ç¾¤æœåŠ¡æ¥å…¥ï¼‰â€Œç‰¹æ®Šå®ç°æœºåˆ¶â€Œ åˆ›å»ºCNAMEè®°å½•æŒ‡å‘å¤–éƒ¨åŸŸåï¼ˆæ— IPåˆ†é…ï¼‰ ä¾èµ–kube-dns 1.7+ç‰ˆæœ¬è§£æ ç¤ºä¾‹é…ç½®ï¼š kind: Servicespec: type: ExternalName externalName: external-api.example.com â€Œå…¸å‹ç”¨ä¾‹â€Œ å®‰å…¨è®¿é—®äº‘æ•°æ®åº“æœåŠ¡ï¼ˆå¦‚RDSï¼‰ é›†æˆé—ç•™ç³»ç»Ÿæ— éœ€æœåŠ¡å‘ç°æ”¹é€  æ³¨æ„ï¼šä¸æä¾›è´Ÿè½½å‡è¡¡ä¸ä»£ç†åŠŸèƒ½â€Œ Service å®éªŒclusterIpmyapp-clusterip-deploy.yaml apiVersion: apps/v1kind: Deploymentmetadata: name: myapp-clusterip-deploy namespace: defaultspec: replicas: 3 selector: matchLabels: app: myapp release: stabel svc: clusterip template: metadata: labels: app: myapp release: stabel env: test svc: clusterip spec: containers: - name: myapp-container image: wangyanglinux/myapp:v1.0 imagePullPolicy: IfNotPresent ports: - name: http containerPort: 80 readinessProbe: httpGet: port: 80 path: /index1.html initialDelaySeconds: 1 periodSeconds: 3 myapp-service.yaml apiVersion: v1kind: Servicemetadata: name: myapp-clusterip namespace: defaultspec: type: ClusterIP selector: app: myapp release: stabel svc: clusterip ports: - name: http port: 80 targetPort: 80 å½“å¼€å§‹åˆ›å»º pod å’Œ Service æ—¶ï¼Œå¯ä»¥çœ‹åˆ° pod æœªå°±ç»ªçš„çŠ¶æ€ä¸‹æ˜¯ä¸ä¼šåŠ å…¥ Service, å½“åˆ›å»º index1.html å pod å°±ç»ªï¼ŒService å¯ä»¥è½¬å‘åˆ°å°±ç»ªçš„ pod ä¸‹ã€‚ åœ¨ myapp-clusterip-deploy-5c9cc9b64-hk69z å®¹å™¨ä¸­æ·»åŠ  index1.html å¹¶ä¿®æ”¹ index.html ä¸º v2ã€‚ ä½¿ç”¨åŸŸåè®¿é—®Service#åœ¨é›†ç¾¤k8så†…éƒ¨ä½¿ç”¨DNSè§£æåŸŸåsvcName.nameSpaceName.svc.domainname.domainNameé›†ç¾¤é»˜è®¤åŸŸåæ˜¯ï¼šcluster.local.ç¤ºä¾‹ï¼šmyapp-clusterip.default.svc.cluster.local. æŒä¹…åŒ–é“¾æ¥åœ¨Kubernetesä¸­ï¼Œservice.spec.sessionAffinity: ClientIP å‚æ•°ç”¨äºé…ç½®æœåŠ¡çš„ä¼šè¯ä¿æŒæœºåˆ¶ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è¯´æ˜å’Œæ“ä½œæ–¹æ³•ï¼š ä½œç”¨ä¸åŸç† æ ¸å¿ƒåŠŸèƒ½ â€Œä¼šè¯ä¿æŒâ€Œï¼šå°†æ¥è‡ªåŒä¸€å®¢æˆ·ç«¯IPçš„è¯·æ±‚â€ŒæŒç»­è·¯ç”±åˆ°åŒä¸€ä¸ªåç«¯Podâ€Œ â€Œè§£å†³æœ‰çŠ¶æ€æœåŠ¡é—®é¢˜â€Œï¼šé€‚ç”¨äºéœ€è¦ä¿æŒä¼šè¯çš„åº”ç”¨ï¼ˆå¦‚ç™»å½•ä¼šè¯ã€æ–‡ä»¶ä¸Šä¼ ç­‰åœºæ™¯ï¼‰ â€Œå·¥ä½œæµç¨‹â€Œ sequenceDiagram participant Client participant Service participant Pod1 participant Pod2 Client-Service: è¯·æ±‚1 (IP:192.168.1.10) Service-Pod1: è½¬å‘è¯·æ±‚1 â†’ è®°å½•IPä¸Podæ˜ å°„ Client-Service: è¯·æ±‚2 (IP:192.168.1.10) Service-Pod1: å†æ¬¡è½¬å‘åˆ°ç›¸åŒPod Note right of Service: åŒä¸€IPçš„åç»­è¯·æ±‚br/å›ºå®šè·¯ç”±åˆ°Pod1 Client-Service: æ–°å®¢æˆ·ç«¯è¯·æ±‚ (IP:192.168.1.20) Service-Pod2: é¦–æ¬¡è¯·æ±‚åˆ†é…æ–°Pod â€Œä¸é»˜è®¤æ¨¡å¼å¯¹æ¯”â€Œ æ¨¡å¼ è¯·æ±‚åˆ†å‘ç­–ç•¥ é€‚ç”¨åœºæ™¯ sessionAffinity: None (é»˜è®¤) è½®è¯¢éšæœºè´Ÿè½½å‡è¡¡ æ— çŠ¶æ€æœåŠ¡ sessionAffinity: ClientIP åŸºäºæºIPå›ºå®šè·¯ç”± æœ‰çŠ¶æ€ä¼šè¯éœ€æ±‚ é…ç½®å‚æ•°è¯¦è§£ â€Œæ ¸å¿ƒå‚æ•°â€Œ spec: sessionAffinity: ClientIP # å¿…éœ€å‚æ•° sessionAffinityConfig: clientIP: timeoutSeconds: 10800 # ä¼šè¯ä¿æŒæ—¶é—´ï¼ˆç§’ï¼‰ â€Œè¶…æ—¶æœºåˆ¶â€Œ â€ŒtimeoutSecondsâ€Œï¼šä¼šè¯ä¿æŒçš„æœ‰æ•ˆæœŸï¼ˆé»˜è®¤å€¼10800ç§’ 3å°æ—¶ï¼‰ è¶…è¿‡è¯¥æ—¶é—´æœªæ”¶åˆ°ç›¸åŒIPçš„è¯·æ±‚ï¼Œæ˜ å°„å…³ç³»è‡ªåŠ¨æ¸…é™¤ è®¾ç½®ä¸º0è¡¨ç¤ºæ°¸ä¸è¿‡æœŸï¼ˆä¸æ¨èï¼‰ æ³¨æ„äº‹é¡¹ â€Œç½‘ç»œå±‚ä¾èµ–â€Œï¼š å®¢æˆ·ç«¯çœŸå®IPå¿…é¡»èƒ½ä¼ é€’åˆ°Serviceï¼ˆé…ç½®externalTrafficPolicy: Localï¼‰ NodePortLoadBalancerç±»å‹éœ€é…ç½®äº‘å‚å•†çš„ä¿ç•™å®¢æˆ·ç«¯IPé€‰é¡¹ â€Œå±€é™æ€§â€Œï¼š ä¸æ”¯æŒåŸºäºCookieçš„ä¼šè¯ä¿æŒ NATç½‘ç»œä¸‹å¤šä¸ªå®¢æˆ·ç«¯å¯èƒ½å…±äº«ç›¸åŒå…¬ç½‘IPï¼ˆå¯¼è‡´æµé‡é›†ä¸­ï¼‰ â€Œæ€§èƒ½å½±å“â€Œï¼š å¤§è§„æ¨¡é›†ç¾¤ä¸­IPæ˜ å°„è¡¨å¯èƒ½å ç”¨å†…å­˜ å»ºè®®é…åˆsessionAffinityConfig.timeoutSecondsè®¾ç½®åˆç†è¶…æ—¶ ğŸ’¡ â€Œæœ€ä½³å®è·µâ€Œï¼šéœ€è¦ç²¾ç¡®ä¼šè¯ä¿æŒæ—¶ï¼Œå»ºè®®åœ¨åº”ç”¨å±‚å®ç°ï¼ˆå¦‚JWTCookieï¼‰ï¼Œè¯¥å‚æ•°ä»…ä½œä¸ºç½‘ç»œå±‚è¾…åŠ©æ–¹æ¡ˆã€‚ sessionAffinity å®éªŒkubectl edit svc myapp-clusterip å†é€šè¿‡ Service è®¿é—®æ—¶ï¼Œä¼šä¸€ç›´è½¬å‘åˆ°ä¸€ä¸ª podã€‚ internalTrafficPolicy å®éªŒ â€Œå‘½ä»¤åŠŸèƒ½â€Œï¼šè¯¥å‘½ä»¤ç”¨äºè§£é‡Š Kubernetes æœåŠ¡ï¼ˆServiceï¼‰èµ„æºè§„æ ¼ï¼ˆspecï¼‰ä¸­çš„ internalTrafficPolicy å­—æ®µã€‚ â€Œå­—æ®µå«ä¹‰â€Œï¼šinternalTrafficPolicy æè¿°äº†èŠ‚ç‚¹å¦‚ä½•åˆ†å‘å®ƒä»¬åœ¨ ClusterIP ä¸Šæ¥æ”¶åˆ°çš„æœåŠ¡æµé‡ã€‚ â€Œæšä¸¾å€¼â€Œï¼š â€ŒClusterï¼šé»˜è®¤å€¼ï¼Œæµé‡ä¼šå‡åŒ€è·¯ç”±åˆ°æœåŠ¡çš„æ‰€æœ‰ç«¯ç‚¹ï¼Œå¯èƒ½å—æ‹“æ‰‘å’Œå…¶ä»–åŠŸèƒ½çš„å½±å“ã€‚ â€ŒLocalï¼šæµé‡ä»…è·¯ç”±åˆ°ä¸å®¢æˆ·ç«¯ Pod åœ¨åŒä¸€èŠ‚ç‚¹ä¸Šçš„æœåŠ¡ç«¯ç‚¹ï¼Œè‹¥æ— æœ¬åœ°ç«¯ç‚¹åˆ™ä¸¢å¼ƒæµé‡ã€‚ â€Œåº”ç”¨åœºæ™¯â€Œï¼šæ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚çš„ç­–ç•¥ï¼Œä»¥ä¼˜åŒ–æœåŠ¡è®¿é—®æ•ˆç‡å’Œèµ„æºåˆ©ç”¨ã€‚ kubectl edit svc myapp-clusterip å°±ç»ªçš„ pod è¿è¡Œåœ¨ node02å’Œnode03èŠ‚ç‚¹ä¸Šã€‚ æ­¤æ—¶åœ¨node01èŠ‚ç‚¹è®¿é—® Service æ­¤æµé‡ä¼šè¢«ä¸¢å¼ƒã€‚ åœ¨ node02å’Œnode03ä¸Šè®¿é—® Service æ—¶ä¹Ÿåªä¼šåˆ°æœ¬åœ°èŠ‚ç‚¹çš„ pod ä¸Šã€‚ NodePortå®éªŒapiVersion: apps/v1kind: Deploymentmetadata: name: myapp-nodeport-deploy namespace: defaultspec: replicas: 3 selector: matchLabels: app: myapp release: stabel svc: nodeport template: metadata: labels: app: myapp release: stabel env: test svc: nodeport spec: containers: - name: myapp-container image: wangyanglinux/myapp:v1.0 imagePullPolicy: IfNotPresent ports: - name: http containerPort: 80 apiVersion: v1kind: Servicemetadata: name: myapp-nodeport namespace: defaultspec: type: NodePort selector: app: myapp release: stabel svc: nodeport ports: - name: http port: 80 targetPort: 80 nodePort: 30010 #å¯ä»¥ä¸æŒ‡å®šç”±k8sé›†ç¾¤é…ç½® kubectl apply -f myapp-nodeport-deploy.yaml kubectl apply -f myapp-nodeport-service.yaml ä½¿ç”¨ Service èƒ½å¤Ÿæ­£å¸¸è°ƒç”¨ã€‚ åœ¨å¤–éƒ¨ä½¿ç”¨èŠ‚ç‚¹ip+ç«¯å£ä¹Ÿèƒ½æ­£å¸¸è®¿é—®ã€‚ externalTrafficPolicy å®éªŒ â€Œä½œç”¨â€Œï¼šè¯¥å‘½ä»¤ç”¨äºè§£é‡Š Kubernetes æœåŠ¡ï¼ˆServiceï¼‰è§„æ ¼ï¼ˆspecï¼‰ä¸­çš„ externalTrafficPolicy å­—æ®µã€‚ â€Œå­—æ®µå«ä¹‰â€Œï¼šexternalTrafficPolicy æè¿°äº†èŠ‚ç‚¹å¦‚ä½•åˆ†å‘å®ƒä»¬æ¥æ”¶åˆ°çš„æœåŠ¡æµé‡ï¼Œè¿™äº›æµé‡æ¥è‡ªæœåŠ¡çš„â€œå¤–éƒ¨é¢å‘â€åœ°å€ï¼ˆå¦‚ NodePortsã€ExternalIPs å’Œ LoadBalancer IPsï¼‰ã€‚ â€Œå¯é€‰å€¼â€Œï¼š â€ŒClusterâ€Œï¼šé»˜è®¤å€¼ï¼Œè¡¨ç¤ºæµé‡ä¼šå‡åŒ€è·¯ç”±åˆ°æœåŠ¡çš„æ‰€æœ‰ç«¯ç‚¹ã€‚ â€ŒLocalâ€Œï¼šæµé‡ä»…è·¯ç”±åˆ°æ¥æ”¶æµé‡çš„èŠ‚ç‚¹ä¸Šçš„æœ¬åœ°ç«¯ç‚¹ï¼Œä¸ä¼ªè£…å®¢æˆ·ç«¯æº IPã€‚è‹¥å‘é€åˆ°æ²¡æœ‰ç«¯ç‚¹çš„èŠ‚ç‚¹ï¼Œæµé‡å°†è¢«ä¸¢å¼ƒã€‚ â€Œæ³¨æ„äº‹é¡¹â€Œï¼š é›†ç¾¤å†…éƒ¨å‘é€åˆ° External IP æˆ– LoadBalancer IP çš„æµé‡å§‹ç»ˆéµå¾ª â€œClusterâ€ è¯­ä¹‰ã€‚ é›†ç¾¤å†…éƒ¨å‘é€åˆ° NodePort çš„å®¢æˆ·ç«¯åœ¨é€‰æ‹©èŠ‚ç‚¹æ—¶å¯èƒ½éœ€è¦è€ƒè™‘æµé‡ç­–ç•¥ã€‚ kubectl edit svc myapp-nodeport æ­¤æ—¶å¤–éƒ¨æµé‡åªèƒ½è®¿é—®åˆ°æœ¬èŠ‚ç‚¹ä¸Šçš„ podã€‚ ExternalName å®éªŒ â€Œæ ¸å¿ƒåŠŸèƒ½â€Œ åˆ›å»ºä¸€ç§ç‰¹æ®Šç±»å‹çš„ Serviceï¼Œé€šè¿‡ â€ŒDNS CNAME è®°å½•â€Œå°† Kubernetes é›†ç¾¤å†…éƒ¨çš„æœåŠ¡åç§°æ˜ å°„åˆ°å¤–éƒ¨åŸŸåï¼ˆå¦‚ç¬¬ä¸‰æ–¹ APIã€æ•°æ®åº“ç­‰ï¼‰ï¼Œå®ç°è·¨é›†ç¾¤è®¿é—®å¤–éƒ¨æœåŠ¡çš„é€æ˜ä»£ç†ã€‚ â€Œå·¥ä½œåŸç†â€Œ â€ŒDNS é‡å®šå‘â€Œï¼šå½“é›†ç¾¤å†…åº”ç”¨è®¿é—®è¯¥ Service æ—¶ï¼ŒKubernetes DNS è¿”å› externalName å­—æ®µæŒ‡å®šçš„å¤–éƒ¨åŸŸåï¼ˆå¦‚ external-service.example.comï¼‰çš„ CNAME è®°å½•ï¼Œè€Œé ClusterIPã€‚ â€Œæ— ä»£ç†è´Ÿè½½å‡è¡¡â€Œï¼šä¸åŒäºå…¶ä»– Service ç±»å‹ï¼ŒExternalName ä¸åˆ›å»ºä»£ç†ã€è´Ÿè½½å‡è¡¡å™¨æˆ– Endpointsï¼Œä»…é€šè¿‡ DNS æœºåˆ¶è½¬å‘è¯·æ±‚ã€‚ â€Œä¸»è¦ç”¨é€”â€Œ â€Œé›†æˆå¤–éƒ¨æœåŠ¡â€Œï¼šå°†é›†ç¾¤å†…åº”ç”¨ä¸å¤–éƒ¨æœåŠ¡ï¼ˆå¦‚äº‘æ•°æ®åº“ã€ç¬¬ä¸‰æ–¹ APIï¼‰è§£è€¦ï¼Œé¿å…ç¡¬ç¼–ç å¤–éƒ¨åœ°å€ã€‚ â€Œç®€åŒ–åœ°å€è¿ç§»â€Œï¼šè‹¥å¤–éƒ¨æœåŠ¡åœ°å€å˜æ›´ï¼Œåªéœ€æ›´æ–° externalName å­—æ®µï¼Œæ— éœ€é‡å¯åº”ç”¨ã€‚ â€Œè·¨å‘½åç©ºé—´ç¯å¢ƒâ€Œï¼šè®¿é—®å…¶ä»– Namespace çš„æœåŠ¡ï¼ˆéœ€ç›®æ ‡æœåŠ¡æ”¯æŒï¼‰æˆ–æ··åˆäº‘ç¯å¢ƒçš„å¤–éƒ¨èµ„æºã€‚ â€Œå…³é”®ç‰¹æ€§â€Œ â€Œç‰¹æ€§â€Œ â€Œè¯´æ˜â€Œ â€Œæ— è´Ÿè½½å‡è¡¡â€Œ ä¸æä¾›æµé‡åˆ†å‘æˆ–å¥åº·æ£€æŸ¥ï¼Œä¾èµ–å¤–éƒ¨æœåŠ¡çš„å¯ç”¨æ€§ã€‚ â€Œé…ç½®ç®€åŒ–â€Œ ä»…éœ€å£°æ˜ type: ExternalName å’Œ externalName: ç›®æ ‡åŸŸåã€‚ â€Œé›†ç¾¤å†…éƒ¨è®¿é—®â€Œ åªèƒ½é€šè¿‡ Kubernetes é›†ç¾¤å†…éƒ¨çš„ DNS åç§°è®¿é—®è¯¥æœåŠ¡ã€‚ â€Œæ³¨æ„äº‹é¡¹â€Œ â€Œåè®®é™åˆ¶â€Œï¼šä¸æŒ‡å®šç«¯å£æˆ–åè®®ï¼Œéœ€ç¡®ä¿å¤–éƒ¨æœåŠ¡å…¼å®¹ DNS è§£ææœºåˆ¶ã€‚ â€Œå®‰å…¨æ€§â€Œï¼šä¾èµ–å¤–éƒ¨æœåŠ¡çš„å®‰å…¨ç­–ç•¥ï¼ˆå¦‚ TLSé˜²ç«å¢™ï¼‰ï¼Œä¸æä¾› Kubernetes ç½‘ç»œç­–ç•¥æ”¯æŒã€‚ â€Œæ€»ç»“â€Œï¼šExternalName æœ¬è´¨æ˜¯ DNS åˆ«åï¼Œé€‚ç”¨äºé€æ˜æ¡¥æ¥é›†ç¾¤å†…å¤–æœåŠ¡ï¼Œä½†éœ€æ˜ç¡®å…¶æ— ä»£ç†ã€æ— è´Ÿè½½å‡è¡¡çš„ç‰¹æ€§é™åˆ¶ã€‚ kind: ServiceapiVersion: v1metadata: name: my-service-1 namespace: defaultspec: type: ExternalName externalName: www.baidu.com kubectl apply -f my-ExternalName.yaml kubectl get svckubectl exec -it myapp-nodeport-deploy-685dcc6ddf-fzjcf bin/bashping my-service-1.default.svc.cluster.local. EndpointsKubernetes ä¸­çš„ Service å®šä¹‰äº†ä¸€ç»„ Pods çš„é€»è¾‘é›†åˆåŠä¸€ä¸ªç”¨æˆ·è®¿é—®å®ƒä»¬çš„ç­–ç•¥ã€‚ä¸€ä¸ª Service çš„ç›®æ ‡ Pod é›†åˆé€šå¸¸ç”± Label Selector å†³å®šã€‚ Endpointsæ˜¯ä¸€ç»„å®é™…æœåŠ¡çš„ç«¯ç‚¹é›†åˆï¼Œæ¯ä¸ª Endpoint ä»£è¡¨ä¸€ä¸ªå¯è®¿é—®çš„æœåŠ¡ç«¯ç‚¹ï¼Œå³çŠ¶æ€ä¸º running çš„ Pod çš„å¯è®¿é—®ç«¯ç‚¹ã€‚ ä¸€èˆ¬ Pod éƒ½ä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å­˜åœ¨ï¼Œæ‰€ä»¥ä¸€ç»„ Pod çš„ç«¯ç‚¹åˆåœ¨ä¸€èµ·ç§°ä¸º EndPointsã€‚åªæœ‰è¢« Service Selector åŒ¹é…ä¸”çŠ¶æ€ä¸º Running çš„ Podï¼Œæ‰ä¼šè¢«åŠ å…¥åˆ°ä¸ Service åŒåçš„Endpointsä¸­ï¼Œå½¢æˆä¸€ç»„ Pod çš„ç«¯ç‚¹é›†åˆã€‚ Endpoint çš„å·¥ä½œæœºåˆ¶graph LRA[Service] -- B(Endpoint)B -- C[Pod 1br192.168.1.2:80]B -- D[Pod 2br192.168.1.3:80]B -- E[Pod 3br192.168.1.4:80] è‡ªåŠ¨åˆ›å»ºâ€Œï¼šå½“ Service å®šä¹‰äº† selectorï¼ˆå¦‚app: nginxï¼‰æ—¶ï¼ŒKubernetes è‡ªåŠ¨ã€‚ ç›‘æ§åŒ¹é…è¯¥æ ‡ç­¾çš„ Pod å°† Pod çš„ IP å’Œç«¯å£å¡«å……åˆ° Endpoint å¯¹è±¡ â€Œæµé‡è½¬å‘â€Œï¼šService æ¥æ”¶åˆ°è¯·æ±‚åï¼Œæ ¹æ®è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆå¦‚è½®è¯¢ï¼‰å°†æµé‡åˆ†å‘åˆ° Endpoint ä¸­çš„ Podã€‚ Endpoint çš„æ ¸å¿ƒä»·å€¼ â€ŒæœåŠ¡å‘ç°â€ŒPod å¯é€šè¿‡ Service åç§°è®¿é—®åç«¯ï¼Œæ— éœ€æ„ŸçŸ¥å…·ä½“ IP å˜åŒ–ã€‚ â€ŒåŠ¨æ€æ›´æ–°â€Œå½“ Pod æ‰©ç¼©å®¹æˆ–é‡å¯æ—¶ï¼ŒEndpoint è‡ªåŠ¨æ›´æ–°åœ°å€åˆ—è¡¨ï¼ˆä¾‹å¦‚æ–° Pod IP è‡ªåŠ¨åŠ å…¥ï¼‰ã€‚ â€Œè§£è€¦æ¶æ„â€Œåº”ç”¨åªéœ€è®¿é—® Service åç§°ï¼Œæµé‡è·¯ç”±ç”± Endpoint æœºåˆ¶é€æ˜å¤„ç†ã€‚ â€Œæ··åˆäº‘é›†æˆâ€Œé€šè¿‡æ‰‹åŠ¨é…ç½® Endpointï¼Œå¯å°†é›†ç¾¤å†…æœåŠ¡ä¸å¤–éƒ¨ç³»ç»Ÿï¼ˆå¦‚ä¼ ç»Ÿæ•°æ®åº“ï¼‰æ— ç¼è¿æ¥ã€‚ ä¸ ExternalName çš„åŒºåˆ« â€Œç‰¹æ€§â€Œ â€ŒEndpointâ€Œ â€ŒExternalName Serviceâ€Œ â€Œç›®æ ‡ç±»å‹â€Œ Pod æˆ–å¤–éƒ¨ IP å¤–éƒ¨åŸŸå (CNAME è®°å½•) â€ŒDNS è§£æâ€Œ è¿”å› Service çš„ ClusterIP ç›´æ¥è¿”å›å¤–éƒ¨åŸŸå â€Œé…ç½®æ–¹å¼â€Œ è‡ªåŠ¨ç”Ÿæˆæˆ–æ‰‹åŠ¨å®šä¹‰ Endpoint å¯¹è±¡ ä»…éœ€åœ¨ Service ä¸­è®¾ç½® externalName â€Œæµé‡è·¯å¾„â€Œ ç»è¿‡ kube-proxy è½¬å‘ çº¯ DNS é‡å®šå‘ï¼Œæ— ä»£ç† â€Œé€‚ç”¨åœºæ™¯â€Œ é›†ç¾¤å†… Pod æˆ–æ··åˆäº‘ç¯å¢ƒ ç®€å•åŸŸåæ˜ å°„ Endpointå®éªŒè‡ªåŠ¨å…³è”ï¼ˆé…ç½® selectorï¼‰apiVersion: apps/v1kind: Deploymentmetadata: name: myapp-clusterip-deploy namespace: defaultspec: replicas: 3 selector: matchLabels: app: myapp release: stabel svc: clusterip template: metadata: labels: app: myapp release: stabel env: test svc: clusterip spec: containers: - name: myapp-container image: wangyanglinux/myapp:v1.0 imagePullPolicy: IfNotPresent ports: - name: http containerPort: 80 readinessProbe: httpGet: port: 80 path: /index1.html initialDelaySeconds: 1 periodSeconds: 3 apiVersion: v1kind: Servicemetadata: name: myapp-clusterip namespace: defaultspec: type: ClusterIP selector: app: myapp release: stabel svc: clusterip ports: - name: http port: 80 targetPort: 80 kubectl apply -f myapp-clusterip-deploy.yaml kubectl apply -f myapp-service.yaml å¯ä»¥çœ‹åˆ°åˆ›å»º Service æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºäº†åŒåçš„ Endpointã€‚å› ä¸º Pod æœªå°±ç»ªæ‰€ä»¥ Pod ip è¿˜æœªè®¡å…¥åˆ°è¯¥ç«¯ç‚¹ä¸‹ã€‚ kubectl exec -it myapp-clusterip-deploy-5c9cc9b64-5jg56 bin/bashecho haha /usr/local/nginx/html/index1.htmlkubectl exec -it myapp-clusterip-deploy-5c9cc9b64-67kbq bin/bashecho haha /usr/local/nginx/html/index1.html å¯ä»¥çœ‹åˆ°å½“ Pod å°±ç»ªåï¼ŒPod IP è‡ªåŠ¨åŠ å…¥åˆ°äº† Endpoint ä¸­ã€‚ æ‰‹åŠ¨å…³è”ï¼ˆæ— é…ç½® selectorï¼‰apiVersion: v1kind: Servicemetadata: name: nginx-noselectspec: ports: - protocol: TCP port: 6666 targetPort: 80 apiVersion: v1kind: Endpointsmetadata: # è¿™ä¸ªåå­—è¦ä¸åˆ›å»ºçš„ Service å‘½åç›¸åŒ name: nginx-noselectsubsets: - addresses: # node2 èŠ‚ç‚¹ IP - ip: 10.37.129.11 ports: - port: 80 å¦‚æœ Endpoint éœ€è¦è·Ÿè¸ªå¤šä¸ª ip (å¤šä¸ª pod æˆ–è€…å®¹å™¨æˆ–è€…åº”ç”¨)ï¼Œå¯ä»¥ä½¿ç”¨: - addresses: - ip: 172.17.0.2 - ip: 172.17.0.3 - ip: 172.17.0.4 ... ... kubectl apply -f service-noselect.yaml kubectl apply -f endpoints-noselect.yaml # åœ¨ node2 èŠ‚ç‚¹æ‰§è¡Œdocker run -itd -p 80:80 --net host wangyanglinux/myapp:v1 å°† nginx åœ¨ node2 èŠ‚ç‚¹å¯åŠ¨åï¼Œæ­¤æ—¶å¯ä»¥è®¿é—®ã€‚ è®¿é—®æœªå°±ç»ªçš„ PodapiVersion: v1kind: Podmetadata: name: readiness-httpget-pod namespace: default labels: app: myapp env: testspec: containers: - name: readiness-httpget-container image: wangyanglinux/myapp:v1.0 imagePullPolicy: IfNotPresent readinessProbe: httpGet: port: 80 path: /index1.html initialDelaySeconds: 1 periodSeconds: 3 apiVersion: v1kind: Servicemetadata: labels: app: myapp name: myappspec: ports: - name: 80-80 port: 80 protocol: TCP targetPort: 80 selector: app: myapp type: ClusterIP æ­¤æ—¶æ— æ³•è®¿é—®ã€‚ kubectl patch service myapp -p spec:publishNotReadyAddresses: true æ·»åŠ  publishNotReadyAddresses:ture é…ç½®åã€‚è¯¥é…ç½®ä½¿å¾— Service èƒ½å¤ŸæŠ“å–åˆ°ä¸ºå°±ç»ªçš„ Podã€‚","tags":[null],"categories":[null]},{"title":"Lokiå®‰è£…","path":"/wiki/Kubernetes/lokiå®‰è£….html","content":"Lokiç®€ä»‹Lokiæ˜¯ç”±Grafana Labså¼€å‘çš„å¼€æºæ—¥å¿—èšåˆç³»ç»Ÿï¼Œä¸“ä¸ºäº‘åŸç”Ÿç¯å¢ƒè®¾è®¡ã€‚å®ƒçš„æ ¸å¿ƒç‰¹ç‚¹åŒ…æ‹¬ï¼š â€Œè½»é‡é«˜æ•ˆâ€Œï¼šä¸å¯¹æ—¥å¿—å†…å®¹è¿›è¡Œå…¨æ–‡ç´¢å¼•ï¼Œè€Œæ˜¯é€šè¿‡æ ‡ç­¾(ä¸Prometheusç›¸åŒçš„æ ‡ç­¾ç³»ç»Ÿ)æ¥ç´¢å¼•æ—¥å¿—æµï¼Œå¤§å¹…é™ä½å­˜å‚¨éœ€æ±‚ã€‚ â€Œäº‘åŸç”Ÿä¼˜åŒ–â€Œï¼šç‰¹åˆ«é€‚åˆ Kubernetes ç¯å¢ƒï¼Œèƒ½è‡ªåŠ¨å¤„ç† Pod æ ‡ç­¾ç­‰å…ƒæ•°æ®ã€‚ â€Œç»æµå®æƒ â€Œï¼šç›¸æ¯”ä¼ ç»Ÿæ—¥å¿—ç³»ç»Ÿ(å¦‚ELK)ï¼Œå­˜å‚¨æˆæœ¬æ˜¾è‘—é™ä½ã€‚ â€Œä¸Grafanaæ·±åº¦é›†æˆâ€Œï¼šå¯ç›´æ¥åœ¨Grafanaä¸­æŸ¥è¯¢æ—¥å¿—ï¼Œæ— éœ€åˆ‡æ¢å·¥å…·ã€‚ Lokiä¸»è¦ç”±ä¸‰ä¸ªç»„ä»¶æ„æˆï¼š â€ŒLokiâ€Œï¼šä¸»æœåŠ¡å™¨ï¼Œè´Ÿè´£æ—¥å¿—å­˜å‚¨å’ŒæŸ¥è¯¢ã€‚ â€ŒPromtailâ€Œï¼šæ—¥å¿—æ”¶é›†ä»£ç†ï¼Œè´Ÿè´£é‡‡é›†æ—¥å¿—å¹¶å‘é€ç»™Lokiã€‚ â€ŒGrafanaâ€Œï¼šç”¨äºæ—¥å¿—æŸ¥è¯¢å’Œå±•ç¤ºçš„UIç•Œé¢ã€‚ å®‰è£…tar -zxvf loki-stack-2.9.11-wangyang.xinxianghf.tgzcd loki-stack/ # æŸ¥çœ‹ docker æ•°æ®å­˜å‚¨è·¯å¾„cat /etc/docker/daemon.json values-pre.yaml # è¿™éƒ¨åˆ†é…ç½®å¯ç”¨äº†Lokiçš„æŒä¹…åŒ–å­˜å‚¨åŠŸèƒ½ï¼Œä½¿ç”¨NFSä½œä¸ºåç«¯å­˜å‚¨ï¼Œåˆ†é…2GBç©ºé—´ã€‚ReadWriteOnceæ¨¡å¼é€‚åˆLokiçš„å•èŠ‚ç‚¹è¯»å†™åœºæ™¯ã€‚loki: enabled: true # å¯ç”¨Lokiç»„ä»¶ persistence: enabled: true # å¯ç”¨æŒä¹…åŒ–å­˜å‚¨ accessModes: - ReadWriteOnce # å•èŠ‚ç‚¹è¯»å†™è®¿é—®æ¨¡å¼ size: 5Gi # åˆ†é…5GBå­˜å‚¨ç©ºé—´ storageClassName: nfs-client # ä½¿ç”¨NFSå­˜å‚¨ç±»# Promtailé…ç½®äº†ä»ä¸»æœºæ”¶é›†å®¹å™¨æ—¥å¿—çš„è·¯å¾„ï¼ŒåŒ…æ‹¬Dockerå®¹å™¨æ—¥å¿—(/var/lib/docker/containers)å’ŒKubernetes Podæ—¥å¿—(/var/log/pods)promtail: enabled: true # å¯ç”¨Promtailæ—¥å¿—æ”¶é›†å™¨ defaultVolumes: # å®šä¹‰ä¸»æœºè·¯å¾„å· - name: run hostPath: path: /run/promtail - name: containers hostPath: path: /var/lib/docker/containers - name: pods hostPath: path: /var/log/pods defaultVolumeMounts: # å®šä¹‰å®¹å™¨æŒ‚è½½ç‚¹ - name: run mountPath: /run/promtail - name: containers mountPath: /var/lib/docker/containers readOnly: true # åªè¯»æ¨¡å¼æŒ‚è½½ - name: pods mountPath: /var/log/pods readOnly: true# GrafanaåŒæ ·é…ç½®äº†æŒä¹…åŒ–å­˜å‚¨ï¼Œç¡®ä¿ä»ªè¡¨æ¿é…ç½®å’Œç”¨æˆ·æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚ä¸Lokiä½¿ç”¨ç›¸åŒçš„NFSå­˜å‚¨ç±»ä¾¿äºç»Ÿä¸€ç®¡ç†grafana: enabled: true # å¯ç”¨Grafana persistence: enabled: true # å¯ç”¨æŒä¹…åŒ–å­˜å‚¨ accessModes: - ReadWriteOnce # å•èŠ‚ç‚¹è¯»å†™è®¿é—®æ¨¡å¼ size: 5Gi # åˆ†é…5GBå­˜å‚¨ç©ºé—´ storageClassName: nfs-client # ä½¿ç”¨NFSå­˜å‚¨ç±» # å®‰è£…kubectl create namespace lokihelm install loki -n loki -f values-pre.yaml . loki-ingress.yaml apiVersion: networking.k8s.io/v1kind: Ingressmetadata: name: grafana namespace: lokispec: ingressClassName: nginx rules: - host: grafana.dev.com http: paths: - path: / pathType: Prefix backend: service: name: loki-grafana port: number: 80 # å®‰è£… ingresskubectl apply -f loki-ingress.yaml -n loki# æ·»åŠ åŸŸååˆ° hosts# æŸ¥è¯¢å¯†ç kubectl get secret loki-grafana -n loki -o yamlecho VUVNZ1BJU2hVeDdsOXBRR0U2MDVqTE5KTVMyZFp5Y0FzRkR2TEdtNg== | base64 -d","tags":[null],"categories":[null]},{"title":"Kubernetes äºŒè¿›åˆ¶å®‰è£…","path":"/wiki/Kubernetes/äºŒè¿›åˆ¶å®‰è£….html","content":"k8säºŒè¿›åˆ¶å®‰è£…èŠ‚ç‚¹ç¯å¢ƒåˆå§‹åŒ–ç³»ç»Ÿå®‰è£…å‚è€ƒ Kubernetes å®‰è£… - è™šæ‹Ÿæœºå®‰è£… é•œåƒä¸‹è½½# å®˜æ–¹ä¸‹è½½åœ°å€https://rockylinux.org/download# é˜¿é‡Œäº‘é•œåƒä¸‹è½½åœ°å€https://mirrors.aliyun.com/rockylinux/9/isos/x86_64/?spm=a2c6h.25603864.0.0.29696621VzJej5 ç¯å¢ƒé…ç½®(æ‰€æœ‰èŠ‚ç‚¹)# ç½‘å¡é…ç½®# cat /etc/NetworkManager/system-connections/enp0s5.nmconnection[ipv4]method=manualaddress1=10.37.129.10/24,10.37.129.200dns=114.114.114.114;8.8.8.8# é‡å¯ç½‘ç»œé…ç½®systemctl restart NetworkManagerreboot # ä¿®æ”¹ä¸»æœºåå’Œè§£æhostnamectl set-hostname k8s-master01hostnamectl set-hostname k8s-node01# cat /etc/hosts10.37.129.10 k8s-master01 m110.37.129.11 k8s-master02 m210.37.129.12 k8s-master03 m310.37.129.13 k8s-node01 n110.37.129.14 k8s-node02 n2# Rocky ç³»ç»Ÿè½¯ä»¶æºæ›´æ¢sed -e s|^mirrorlist=|#mirrorlist=|g \\ -e s|^#baseurl=http://dl.rockylinux.org/$contentdir|baseurl=https://mirrors.aliyun.com/rockylinux|g \\ -i.bak \\ /etc/yum.repos.d/[Rr]ocky*.repodnf makecache# é˜²ç«å¢™ä¿®æ”¹ firewalld ä¸º iptablessystemctl stop firewalldsystemctl disable firewalldyum -y install iptables-servicessystemctl start iptablesiptables -Fsystemctl enable iptables# ç¦ç”¨ Selinuxsetenforce 0sed -i s/SELINUX=enforcing/SELINUX=disabled/g /etc/selinux/configgrubby --update-kernel ALL --args selinux=0# æŸ¥çœ‹æ˜¯å¦ç¦ç”¨ï¼Œgrubby --info DEFAULT# å›æ»šå†…æ ¸å±‚ç¦ç”¨æ“ä½œï¼Œgrubby --update-kernel ALL --remove-args selinux# è®¾ç½®æ—¶åŒºtimedatectl set-timezone Asia/Shanghai# å…³é—­ swap åˆ†åŒºswapoff -ased -i s:/dev/mapper/rl-swap:#/dev/mapper/rl-swap:g /etc/fstabfree -m # æŸ¥çœ‹å†…å­˜ä¿¡æ¯# å®‰è£… ipvsyum install -y ipvsadm# å¼€å¯è·¯ç”±è½¬å‘echo net.ipv4.ip_forward=1 /etc/sysctl.confsysctl -p# å®‰è£…å¿…å¤‡çš„å·¥å…·åŒ…yum update -y yum -y install wget psmisc vim net-tools nfs-utils telnet yum-utils device-mapper-persistent-data lvm2 git tar curl # æ’é™¤ calico ç½‘å¡è¢« NetworkManager æ‰€ç®¡ç†cat /etc/NetworkManager/conf.d/calico.conf EOF [keyfile]unmanaged-devices=interface-name:cali*;interface-name:tunl*EOFsystemctl restart NetworkManager#è¿™ä¸ªå‚æ•°ç”¨äºæŒ‡å®šä¸ç”± NetworkManager ç®¡ç†çš„è®¾å¤‡ã€‚å®ƒç”±ä»¥ä¸‹ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆ:#interface-name:cali*#è¡¨ç¤ºä»¥ cali å¼€å¤´çš„æ¥å£åç§°è¢«æ’é™¤åœ¨ NetworkManager ç®¡ç†ä¹‹å¤–ã€‚ä¾‹å¦‚ï¼Œcali0, cali1 ç­‰æ¥å£ä¸å— NetworkManager ç®¡ç†#interface-name:tunl*#è¡¨ç¤ºä»¥ tunl å¼€å¤´çš„æ¥å£åç§°è¢«æ’é™¤åœ¨ NetworkManager ç®¡ç†ä¹‹å¤–ã€‚ä¾‹å¦‚ï¼Œtunl0, tunl1 ç­‰æ¥å£ä¸å— NetworkManager ç®¡ç†#é€šè¿‡ä½¿ç”¨è¿™ä¸ªå‚æ•°ï¼Œå¯ä»¥å°†ç‰¹å®šçš„æ¥å£æ’é™¤åœ¨ NetworkManager çš„ç®¡ç†èŒƒå›´ä¹‹å¤–ï¼Œä»¥ä¾¿å…¶ä»–å·¥å…·æˆ–è¿›ç¨‹å¯ä»¥ç‹¬ç«‹åœ°ç®¡ç†å’Œé…ç½®è¿™äº›æ¥å£ # æ—¶é—´åŒæ­¥é…ç½®# æœåŠ¡ç«¯(m1ã€m2ã€m3èŠ‚ç‚¹)yum install chrony -ycat /etc/chrony.conf EOF pool ntp.aliyun.com iburstdriftfile /var/lib/chrony/driftmakestep 1.0 3rtcsyncallow 10.37.129.0/24local stratum 10keyfile /etc/chrony.keysleapsectz right/UTClogdir /var/log/chronyEOFsystemctl restart chronydsystemctl enable chronyd# å®¢æˆ·ç«¯(n1ã€n2èŠ‚ç‚¹)yum install chrony -ycat /etc/chrony.conf EOF pool 10.37.129.10 iburstpool 10.37.129.11 iburstpool 10.37.129.12 iburstdriftfile /var/lib/chrony/driftmakestep 1.0 3rtcsynckeyfile /etc/chrony.keysleapsectz right/UTClogdir /var/log/chronyEOFsystemctl restart chronyd systemctl enable chronyd#ä½¿ç”¨å®¢æˆ·ç«¯è¿›è¡ŒéªŒè¯chronyc sources -v # é…ç½® ulimitulimit -SHn 65535cat /etc/security/limits.conf EOF* soft nofile 655360* hard nofile 131072* soft nproc 655350* hard nproc 655350* seft memlock unlimited* hard memlock unlimiteddEOF # å®‰è£… ipvsyum install ipvsadm ipset sysstat conntrack libseccomp -ycat /etc/modules-load.d/ipvs.conf EOF ip_vsip_vs_rrip_vs_wrrip_vs_shnf_conntrackip_tablesip_setxt_setipt_setipt_rpfilteript_REJECTipipEOFsystemctl restart systemd-modules-load.servicelsmod | grep -e ip_vs -e nf_conntrack# ä¿®æ”¹å†…æ ¸å‚æ•°cat EOF /etc/sysctl.d/k8s.confnet.ipv4.ip_forward = 1net.bridge.bridge-nf-call-iptables = 1fs.may_detach_mounts = 1vm.overcommit_memory=1vm.panic_on_oom=0fs.inotify.max_user_watches=89100fs.file-max=52706963fs.nr_open=52706963net.netfilter.nf_conntrack_max=2310720net.ipv4.tcp_keepalive_time = 600net.ipv4.tcp_keepalive_probes = 3net.ipv4.tcp_keepalive_intvl =15net.ipv4.tcp_max_tw_buckets = 36000net.ipv4.tcp_tw_reuse = 1net.ipv4.tcp_max_orphans = 327680net.ipv4.tcp_orphan_retries = 3net.ipv4.tcp_syncookies = 1net.ipv4.tcp_max_syn_backlog = 16384net.ipv4.ip_conntrack_max = 65536net.ipv4.tcp_max_syn_backlog = 16384net.ipv4.tcp_timestamps = 0net.core.somaxconn = 16384net.ipv6.conf.all.disable_ipv6 = 0net.ipv6.conf.default.disable_ipv6 = 0net.ipv6.conf.lo.disable_ipv6 = 0net.ipv6.conf.all.forwarding = 1EOFsysctl --system # å®‰è£… Docker# äºŒè¿›åˆ¶åŒ…ä¸‹è½½åœ°å€ï¼šhttps://download.docker.com/linux/static/stable/x86_64/# wget https://mirrors.ustc.edu.cn/docker-ce/linux/static/stable/x86_64/docker-25.0.3.tgztar -zxvf kubernetes-1.29.2.tar.gzcd kubernetes-1.29.2/soft/tar xf docker-*.tgz cp docker/* /usr/bin/# åˆ›å»º containerd çš„ service æ–‡ä»¶,å¹¶ä¸”å¯åŠ¨cat /etc/systemd/system/containerd.service EOF[Unit]Description=containerd container runtimeDocumentation=https://containerd.ioAfter=network.target local-fs.target[Service]ExecStartPre=-/sbin/modprobe overlayExecStart=/usr/bin/containerdType=notifyDelegate=yesKillMode=processRestart=alwaysRestartSec=5LimitNPROC=infinityLimitCORE=infinityLimitNOFILE=1048576TasksMax=infinityOOMScoreAdjust=-999[Install]WantedBy=multi-user.targetEOFsystemctl enable --now containerd.service# å‡†å¤‡ docker çš„ service æ–‡ä»¶cat /etc/systemd/system/docker.service EOF[Unit]Description=Docker Application Container EngineDocumentation=https://docs.docker.comAfter=network-online.target firewalld.service cri-docker.service docker.socket containerd.serviceWants=network-online.targetRequires=docker.socket containerd.service[Service]Type=notifyExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sockExecReload=/bin/kill -s HUP $MAINPIDTimeoutSec=0RestartSec=2Restart=alwaysStartLimitBurst=3StartLimitInterval=60sLimitNOFILE=infinityLimitNPROC=infinityLimitCORE=infinityTasksMax=infinityDelegate=yesKillMode=processOOMScoreAdjust=-500[Install]WantedBy=multi-user.targetEOF#å‡†å¤‡ docker çš„ socket æ–‡ä»¶cat /etc/systemd/system/docker.socket EOF[Unit]Description=Docker Socket for the API[Socket]ListenStream=/var/run/docker.sockSocketMode=0660SocketUser=rootSocketGroup=docker[Install]WantedBy=sockets.targetEOF# é…ç½®åŠ é€Ÿå™¨mkdir -p /etc/docker/cat /etc/docker/daemon.json EOF exec-opts: [native.cgroupdriver=systemd], registry-mirrors: [ https://docker.mirrors.ustc.edu.cn ], max-concurrent-downloads: 10, log-driver: json-file, log-level: warn, log-opts: max-size: 10m, max-file: 3 , data-root: /var/lib/dockerEOF# å¯åŠ¨ Dockergroupadd dockersystemctl daemon-reloadsystemctl enable --now docker.socketsystemctl enable --now docker.servicesystemctl enable --now cri-docker.servicesystemctl status docker.servicedocker info # è§£å‹ cri-docker# https://github.com/Mirantis/cri-dockerd/releases/# wget https://mirrors.chenby.cn/https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.10/cri-dockerd-0.3.10.amd64.tgztar xvf cri-dockerd-*.amd64.tgz cd cri-dockerdcp cri-dockerd /usr/bin/chmod +x /usr/bin/cri-dockerd# å†™å…¥å¯åŠ¨ cri-docker é…ç½®æ–‡ä»¶cat /usr/lib/systemd/system/cri-docker.service EOF[Unit]Description=CRI Interface for Docker Application Container EngineDocumentation=https://docs.mirantis.comAfter=network-online.target firewalld.service docker.serviceWants=network-online.targetRequires=cri-docker.socket[Service]Type=notifyExecStart=/usr/bin/cri-dockerd --network-plugin=cni --pod-infra-container-image=registry.aliyuncs.com/google_containers/pause:3.7ExecReload=/bin/kill -s HUP $MAINPIDTimeoutSec=0RestartSec=2Restart=alwaysStartLimitBurst=3StartLimitInterval=60sLimitNOFILE=infinityLimitNPROC=infinityLimitCORE=infinityTasksMax=infinityDelegate=yesKillMode=process[Install]WantedBy=multi-user.targetEOF# å†™å…¥ cri-docker çš„ socket é…ç½®æ–‡ä»¶cat /usr/lib/systemd/system/cri-docker.socket EOF[Unit]Description=CRI Docker Socket for the APIPartOf=cri-docker.service[Socket]ListenStream=%t/cri-dockerd.sockSocketMode=0660SocketUser=rootSocketGroup=docker[Install]WantedBy=sockets.targetEOF# å¯åŠ¨ cri-dockersystemctl daemon-reloadsystemctl enable --now cri-docker.servicesystemctl status cri-docker.service k8s ä¸ ETCD é…ç½®ï¼ˆm1èŠ‚ç‚¹æ“ä½œï¼‰# ä¸‹è½½å®‰è£…åŒ…#wget https://mirrors.chenby.cn/https://github.com/etcd-io/etcd/releases/download/v3.5.12/etcd-v3.5.12-linux-amd64.tar.gz#wget https://dl.k8s.io/v1.29.2/kubernetes-server-linux-amd64.tar.gzcd kubernetes-1.29.2/soft# è§£å‹k8så®‰è£…æ–‡ä»¶tar -xf kubernetes-server-linux-amd64.tar.gz --strip-components=3 -C /usr/local/bin kubernetes/server/bin/kubelet,ctl,-apiserver,-controller-manager,-scheduler,-proxy# è§£å‹etcdå®‰è£…æ–‡ä»¶tar -xf etcd*.tar.gz mv etcd-*/etcd /usr/local/bin/ mv etcd-*/etcdctl /usr/local/bin/# æŸ¥çœ‹/usr/local/binä¸‹å†…å®¹ls /usr/local/bin/# æŸ¥çœ‹ç‰ˆæœ¬kubelet --version Kubernetes v1.29.2etcdctl version etcdctl version: 3.5.12 API version: 3.5# scpå…å¯†é…ç½®cd ~ssh-keygen -t rsassh-copy-id root@m2ssh-copy-id root@m3ssh-copy-id root@n1ssh-copy-id root@n2# å°†ç»„ä»¶å‘é€è‡³å…¶å®ƒ k8s èŠ‚ç‚¹Master=k8s-master02 k8s-master03Work=k8s-node01 k8s-node02# æ‹·è´ master ç»„ä»¶for NODE in $Master; do echo $NODE; scp /usr/local/bin/kubelet,ctl,-apiserver,-controller-manager,-scheduler,-proxy $NODE:/usr/local/bin/; scp /usr/local/bin/etcd* $NODE:/usr/local/bin/; done# æ‹·è´ work ç»„ä»¶for NODE in $Work; do echo $NODE; scp /usr/local/bin/kubelet,-proxy $NODE:/usr/local/bin/ ; done# æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œmkdir -p /opt/cni/bin # CA è¯ä¹¦é…ç½®cd kubernetes-1.29.2/softcp -a cfssl* /usr/local/bin# master01 èŠ‚ç‚¹ä¸‹è½½è¯ä¹¦ç”Ÿæˆå·¥å…·#wget https://mirrors.chenby.cn/https://github.com/cloudflare/cfssl/releases/download/v1.6.4/cfssl_1.6.4_linux_amd64 -O /usr/local/bin/cfssl#wget https://mirrors.chenby.cn/https://github.com/cloudflare/cfssl/releases/download/v1.6.4/cfssljson_1.6.4_linux_amd64 -O /usr/local/bin/cfssljsonchmod +x /usr/local/bin/cfssl /usr/local/bin/cfssljson# ç”Ÿæˆ ETCD è¯ä¹¦mkdir /etc/etcd/ssl -pcd /etc/etcd/ssl# å†™å…¥ç”Ÿæˆè¯ä¹¦æ‰€éœ€çš„é…ç½®æ–‡ä»¶,master01 èŠ‚ç‚¹ç”Ÿæˆ etcd è¯ä¹¦cat ca-config.json EOF signing: default: expiry: 876000h , profiles: kubernetes: usages: [ signing, key encipherment, server auth, client auth ], expiry: 876000h EOFcat etcd-ca-csr.json EOF CN: etcd, key: algo: rsa, size: 2048 , names: [ C: CN, ST: Beijing, L: Beijing, O: etcd, OU: Etcd Security ], ca: expiry: 876000h EOFcfssl gencert -initca etcd-ca-csr.json | cfssljson -bare /etc/etcd/ssl/etcd-cacat etcd-csr.json EOF CN: etcd, key: algo: rsa, size: 2048 , names: [ C: CN, ST: Beijing, L: Beijing, O: etcd, OU: Etcd Security ]EOFcfssl gencert -ca=/etc/etcd/ssl/etcd-ca.pem -ca-key=/etc/etcd/ssl/etcd-ca-key.pem -config=ca-config.json -hostname=127.0.0.1,k8s-master01,k8s-master02,k8s-master03,10.37.129.10,10.37.129.11,10.37.129.12,fc00:43f4:1eea:1::10,fc00:43f4:1eea:1::20,fc00:43f4:1eea:1::30,::1 -profile=kubernetes etcd-csr.json | cfssljson -bare /etc/etcd/ssl/etcd# å°†è¯ä¹¦å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹Master=k8s-master02 k8s-master03for NODE in $Master; do ssh $NODE mkdir -p /etc/etcd/ssl; for FILE in etcd-ca-key.pem etcd-ca.pem etcd-key.pem etcd.pem; do scp /etc/etcd/ssl/$FILE $NODE:/etc/etcd/ssl/$FILE; done; done # ç”Ÿæˆ K8S ç›¸å…³è¯ä¹¦mkdir -p /etc/kubernetes/pkicd /etc/kubernetes/pki# master01 èŠ‚ç‚¹ç”Ÿæˆ k8s è¯ä¹¦, å†™å…¥ç”Ÿæˆè¯ä¹¦æ‰€éœ€çš„é…ç½®æ–‡ä»¶cat ca-csr.json EOF CN: kubernetes, key: algo: rsa, size: 2048 , names: [ C: CN, ST: Beijing, L: Beijing, O: Kubernetes, OU: Kubernetes-manual ], ca: expiry: 876000h EOFcfssl gencert -initca ca-csr.json | cfssljson -bare /etc/kubernetes/pki/cacat apiserver-csr.json EOF CN: kube-apiserver, key: algo: rsa, size: 2048 , names: [ C: CN, ST: Beijing, L: Beijing, O: Kubernetes, OU: Kubernetes-manual ]EOFcat ca-config.json EOF signing: default: expiry: 876000h , profiles: kubernetes: usages: [ signing, key encipherment, server auth, client auth ], expiry: 876000h EOFcfssl gencert -ca=/etc/kubernetes/pki/ca.pem -ca-key=/etc/kubernetes/pki/ca-key.pem -config=ca-config.json -hostname=10.96.0.1,10.37.129.16,127.0.0.1,kubernetes,kubernetes.default,kubernetes.default.svc,kubernetes.default.svc.cluster,kubernetes.default.svc.cluster.local,k8s.com,k8s.cn,10.37.129.10,10.37.129.11,10.37.129.12,10.37.129.13,10.37.129.14,10.37.129.15,10.37.129.16,10.37.129.17,10.37.129.18,10.37.129.19,10.37.129.20,fc00:43f4:1eea:1::10,fc00:43f4:1eea:1::20,fc00:43f4:1eea:1::30,fc00:43f4:1eea:1::40,fc00:43f4:1eea:1::50,fc00:43f4:1eea:1::60,fc00:43f4:1eea:1::70,fc00:43f4:1eea:1::80,fc00:43f4:1eea:1::90,fc00:43f4:1eea:1::100,::1 -profile=kubernetes apiserver-csr.json | cfssljson -bare /etc/kubernetes/pki/apiserver# ç”Ÿæˆ apiserver èšåˆè¯ä¹¦cat front-proxy-ca-csr.json EOF CN: kubernetes, key: algo: rsa, size: 2048 , ca: expiry: 876000h EOFcfssl gencert -initca front-proxy-ca-csr.json | cfssljson -bare /etc/kubernetes/pki/front-proxy-ca cat front-proxy-client-csr.json EOF CN: front-proxy-client, key: algo: rsa, size: 2048 EOFcfssl gencert \\-ca=/etc/kubernetes/pki/front-proxy-ca.pem \\-ca-key=/etc/kubernetes/pki/front-proxy-ca-key.pem \\-config=ca-config.json \\-profile=kubernetes \\front-proxy-client-csr.json | cfssljson -bare /etc/kubernetes/pki/front-proxy-client# ç”Ÿæˆ controller-manage çš„è¯ä¹¦cat manager-csr.json EOF CN: system:kube-controller-manager, key: algo: rsa, size: 2048 , names: [ C: CN, ST: Beijing, L: Beijing, O: system:kube-controller-manager, OU: Kubernetes-manual ]EOFcfssl gencert \\ -ca=/etc/kubernetes/pki/ca.pem \\ -ca-key=/etc/kubernetes/pki/ca-key.pem \\ -config=ca-config.json \\ -profile=kubernetes \\ manager-csr.json | cfssljson -bare /etc/kubernetes/pki/controller-managerkubectl config set-cluster kubernetes \\ --certificate-authority=/etc/kubernetes/pki/ca.pem \\ --embed-certs=true \\ --server=https://127.0.0.1:8443 \\ --kubeconfig=/etc/kubernetes/controller-manager.kubeconfig kubectl config set-context system:kube-controller-manager@kubernetes \\ --cluster=kubernetes \\ --user=system:kube-controller-manager \\ --kubeconfig=/etc/kubernetes/controller-manager.kubeconfig kubectl config set-credentials system:kube-controller-manager \\ --client-certificate=/etc/kubernetes/pki/controller-manager.pem \\ --client-key=/etc/kubernetes/pki/controller-manager-key.pem \\ --embed-certs=true \\ --kubeconfig=/etc/kubernetes/controller-manager.kubeconfigkubectl config use-context system:kube-controller-manager@kubernetes \\ --kubeconfig=/etc/kubernetes/controller-manager.kubeconfig# ç”Ÿæˆ kube-scheduler çš„è¯ä¹¦cat scheduler-csr.json EOF CN: system:kube-scheduler, key: algo: rsa, size: 2048 , names: [ C: CN, ST: Beijing, L: Beijing, O: system:kube-scheduler, OU: Kubernetes-manual ]EOFcfssl gencert \\ -ca=/etc/kubernetes/pki/ca.pem \\ -ca-key=/etc/kubernetes/pki/ca-key.pem \\ -config=ca-config.json \\ -profile=kubernetes \\ scheduler-csr.json | cfssljson -bare /etc/kubernetes/pki/scheduler kubectl config set-cluster kubernetes \\ --certificate-authority=/etc/kubernetes/pki/ca.pem \\ --embed-certs=true \\ --server=https://127.0.0.1:8443 \\ --kubeconfig=/etc/kubernetes/scheduler.kubeconfig kubectl config set-credentials system:kube-scheduler \\ --client-certificate=/etc/kubernetes/pki/scheduler.pem \\ --client-key=/etc/kubernetes/pki/scheduler-key.pem \\ --embed-certs=true \\ --kubeconfig=/etc/kubernetes/scheduler.kubeconfig kubectl config set-context system:kube-scheduler@kubernetes \\ --cluster=kubernetes \\ --user=system:kube-scheduler \\ --kubeconfig=/etc/kubernetes/scheduler.kubeconfig kubectl config use-context system:kube-scheduler@kubernetes \\ --kubeconfig=/etc/kubernetes/scheduler.kubeconfig # ç”Ÿæˆ admin çš„è¯ä¹¦é…ç½®cat admin-csr.json EOF CN: admin, key: algo: rsa, size: 2048 , names: [ C: CN, ST: Beijing, L: Beijing, O: system:masters, OU: Kubernetes-manual ]EOFcfssl gencert \\ -ca=/etc/kubernetes/pki/ca.pem \\ -ca-key=/etc/kubernetes/pki/ca-key.pem \\ -config=ca-config.json \\ -profile=kubernetes \\ admin-csr.json | cfssljson -bare /etc/kubernetes/pki/admin kubectl config set-cluster kubernetes \\ --certificate-authority=/etc/kubernetes/pki/ca.pem \\ --embed-certs=true \\ --server=https://127.0.0.1:8443 \\ --kubeconfig=/etc/kubernetes/admin.kubeconfig kubectl config set-credentials kubernetes-admin \\ --client-certificate=/etc/kubernetes/pki/admin.pem \\ --client-key=/etc/kubernetes/pki/admin-key.pem \\ --embed-certs=true \\ --kubeconfig=/etc/kubernetes/admin.kubeconfig kubectl config set-context kubernetes-admin@kubernetes \\ --cluster=kubernetes \\ --user=kubernetes-admin \\ --kubeconfig=/etc/kubernetes/admin.kubeconfig kubectl config use-context kubernetes-admin@kubernetes --kubeconfig=/etc/kubernetes/admin.kubeconfig# åˆ›å»º kube-proxy è¯ä¹¦cat kube-proxy-csr.json EOF CN: system:kube-proxy, key: algo: rsa, size: 2048 , names: [ C: CN, ST: Beijing, L: Beijing, O: system:kube-proxy, OU: Kubernetes-manual ]EOFcfssl gencert \\ -ca=/etc/kubernetes/pki/ca.pem \\ -ca-key=/etc/kubernetes/pki/ca-key.pem \\ -config=ca-config.json \\ -profile=kubernetes \\ kube-proxy-csr.json | cfssljson -bare /etc/kubernetes/pki/kube-proxy kubectl config set-cluster kubernetes \\ --certificate-authority=/etc/kubernetes/pki/ca.pem \\ --embed-certs=true \\ --server=https://127.0.0.1:8443 \\ --kubeconfig=/etc/kubernetes/kube-proxy.kubeconfig kubectl config set-credentials kube-proxy \\ --client-certificate=/etc/kubernetes/pki/kube-proxy.pem \\ --client-key=/etc/kubernetes/pki/kube-proxy-key.pem \\ --embed-certs=true \\ --kubeconfig=/etc/kubernetes/kube-proxy.kubeconfig kubectl config set-context kube-proxy@kubernetes \\ --cluster=kubernetes \\ --user=kube-proxy \\ --kubeconfig=/etc/kubernetes/kube-proxy.kubeconfig kubectl config use-context kube-proxy@kubernetes --kubeconfig=/etc/kubernetes/kube-proxy.kubeconfig# åˆ›å»º ServiceAccount Key â€”â€”secretopenssl genrsa -out /etc/kubernetes/pki/sa.key 2048openssl rsa -in /etc/kubernetes/pki/sa.key -pubout -out /etc/kubernetes/pki/sa.pub# å°†è¯ä¹¦å‘é€åˆ°å…¶ä»– master èŠ‚ç‚¹# å…¶ä»–ä¸¤ä¸ªä¸»èŠ‚ç‚¹åˆ›å»ºç›®å½•mkdir /etc/kubernetes/pki/ -pNODE=k8s-master02 k8s-master03for NODE in k8s-master02 k8s-master03; do for FILE in $(ls /etc/kubernetes/pki | grep -v etcd); do scp /etc/kubernetes/pki/$FILE $NODE:/etc/kubernetes/pki/$FILE; done; for FILE in admin.kubeconfig controller-manager.kubeconfig scheduler.kubeconfig; do scp /etc/kubernetes/$FILE $NODE:/etc/kubernetes/$FILE; done; done# æŸ¥çœ‹è¯ä¹¦ls /etc/kubernetes/pki/ | wc -l k8s ç³»ç»Ÿç»„ä»¶é…ç½®ETCD# ETCD é…ç½®# m1èŠ‚ç‚¹æ‰§è¡Œ# å¦‚æœè¦ç”¨IPv6é‚£ä¹ˆæŠŠIPv4åœ°å€ä¿®æ”¹ä¸ºIPv6å³å¯cat /etc/etcd/etcd.config.yml EOF name: k8s-master01data-dir: /var/lib/etcdwal-dir: /var/lib/etcd/walsnapshot-count: 5000heartbeat-interval: 100election-timeout: 1000quota-backend-bytes: 0listen-peer-urls: https://10.37.129.10:2380listen-client-urls: https://10.37.129.10:2379,http://127.0.0.1:2379max-snapshots: 3max-wals: 5cors:initial-advertise-peer-urls: https://10.37.129.10:2380advertise-client-urls: https://10.37.129.10:2379discovery:discovery-fallback: proxydiscovery-proxy:discovery-srv:initial-cluster: k8s-master01=https://10.37.129.10:2380,k8s-master02=https://10.37.129.11:2380,k8s-master03=https://10.37.129.12:2380initial-cluster-token: etcd-k8s-clusterinitial-cluster-state: newstrict-reconfig-check: falseenable-v2: trueenable-pprof: trueproxy: offproxy-failure-wait: 5000proxy-refresh-interval: 30000proxy-dial-timeout: 1000proxy-write-timeout: 5000proxy-read-timeout: 0client-transport-security: cert-file: /etc/kubernetes/pki/etcd/etcd.pem key-file: /etc/kubernetes/pki/etcd/etcd-key.pem client-cert-auth: true trusted-ca-file: /etc/kubernetes/pki/etcd/etcd-ca.pem auto-tls: truepeer-transport-security: cert-file: /etc/kubernetes/pki/etcd/etcd.pem key-file: /etc/kubernetes/pki/etcd/etcd-key.pem peer-client-cert-auth: true trusted-ca-file: /etc/kubernetes/pki/etcd/etcd-ca.pem auto-tls: truedebug: falselog-package-levels:log-outputs: [default]force-new-cluster: falseEOF# m2èŠ‚ç‚¹æ‰§è¡Œ# å¦‚æœè¦ç”¨IPv6é‚£ä¹ˆæŠŠIPv4åœ°å€ä¿®æ”¹ä¸ºIPv6å³å¯cat /etc/etcd/etcd.config.yml EOF name: k8s-master02data-dir: /var/lib/etcdwal-dir: /var/lib/etcd/walsnapshot-count: 5000heartbeat-interval: 100election-timeout: 1000quota-backend-bytes: 0listen-peer-urls: https://10.37.129.11:2380listen-client-urls: https://10.37.129.11:2379,http://127.0.0.1:2379max-snapshots: 3max-wals: 5cors:initial-advertise-peer-urls: https://10.37.129.11:2380advertise-client-urls: https://10.37.129.11:2379discovery:discovery-fallback: proxydiscovery-proxy:discovery-srv:initial-cluster: k8s-master01=https://10.37.129.10:2380,k8s-master02=https://10.37.129.11:2380,k8s-master03=https://10.37.129.12:2380initial-cluster-token: etcd-k8s-clusterinitial-cluster-state: newstrict-reconfig-check: falseenable-v2: trueenable-pprof: trueproxy: offproxy-failure-wait: 5000proxy-refresh-interval: 30000proxy-dial-timeout: 1000proxy-write-timeout: 5000proxy-read-timeout: 0client-transport-security: cert-file: /etc/kubernetes/pki/etcd/etcd.pem key-file: /etc/kubernetes/pki/etcd/etcd-key.pem client-cert-auth: true trusted-ca-file: /etc/kubernetes/pki/etcd/etcd-ca.pem auto-tls: truepeer-transport-security: cert-file: /etc/kubernetes/pki/etcd/etcd.pem key-file: /etc/kubernetes/pki/etcd/etcd-key.pem peer-client-cert-auth: true trusted-ca-file: /etc/kubernetes/pki/etcd/etcd-ca.pem auto-tls: truedebug: falselog-package-levels:log-outputs: [default]force-new-cluster: falseEOF# m3èŠ‚ç‚¹æ‰§è¡Œ# å¦‚æœè¦ç”¨IPv6é‚£ä¹ˆæŠŠIPv4åœ°å€ä¿®æ”¹ä¸ºIPv6å³å¯cat /etc/etcd/etcd.config.yml EOF name: k8s-master03data-dir: /var/lib/etcdwal-dir: /var/lib/etcd/walsnapshot-count: 5000heartbeat-interval: 100election-timeout: 1000quota-backend-bytes: 0listen-peer-urls: https://10.37.129.12:2380listen-client-urls: https://10.37.129.12:2379,http://127.0.0.1:2379max-snapshots: 3max-wals: 5cors:initial-advertise-peer-urls: https://10.37.129.12:2380advertise-client-urls: https://10.37.129.12:2379discovery:discovery-fallback: proxydiscovery-proxy:discovery-srv:initial-cluster: k8s-master01=https://10.37.129.10:2380,k8s-master02=https://10.37.129.11:2380,k8s-master03=https://10.37.129.12:2380initial-cluster-token: etcd-k8s-clusterinitial-cluster-state: newstrict-reconfig-check: falseenable-v2: trueenable-pprof: trueproxy: offproxy-failure-wait: 5000proxy-refresh-interval: 30000proxy-dial-timeout: 1000proxy-write-timeout: 5000proxy-read-timeout: 0client-transport-security: cert-file: /etc/kubernetes/pki/etcd/etcd.pem key-file: /etc/kubernetes/pki/etcd/etcd-key.pem client-cert-auth: true trusted-ca-file: /etc/kubernetes/pki/etcd/etcd-ca.pem auto-tls: truepeer-transport-security: cert-file: /etc/kubernetes/pki/etcd/etcd.pem key-file: /etc/kubernetes/pki/etcd/etcd-key.pem peer-client-cert-auth: true trusted-ca-file: /etc/kubernetes/pki/etcd/etcd-ca.pem auto-tls: truedebug: falselog-package-levels:log-outputs: [default]force-new-cluster: falseEOF# åˆ›å»º serviceï¼ˆ æ‰€æœ‰ master èŠ‚ç‚¹æ“ä½œï¼‰cat /usr/lib/systemd/system/etcd.service EOF[Unit]Description=Etcd ServiceDocumentation=https://coreos.com/etcd/docs/latest/After=network.target[Service]Type=notifyExecStart=/usr/local/bin/etcd --config-file=/etc/etcd/etcd.config.ymlRestart=on-failureRestartSec=10LimitNOFILE=65536[Install]WantedBy=multi-user.targetAlias=etcd3.serviceEOF# åˆ›å»º etcd è¯ä¹¦ç›®å½•ï¼ˆ æ‰€æœ‰ master èŠ‚ç‚¹æ“ä½œï¼‰mkdir /etc/kubernetes/pki/etcdln -s /etc/etcd/ssl/* /etc/kubernetes/pki/etcd/systemctl daemon-reloadsystemctl enable --now etcd.servicesystemctl status etcd.service# æŸ¥çœ‹ etcd çŠ¶æ€# å¦‚æœè¦ç”¨ IPv6 é‚£ä¹ˆæŠŠ IPv4 åœ°å€ä¿®æ”¹ä¸º IPv6 å³å¯export ETCDCTL_API=3etcdctl --endpoints=10.37.129.12:2379,10.37.129.11:2379,10.37.129.10:2379 --cacert=/etc/kubernetes/pki/etcd/etcd-ca.pem --cert=/etc/kubernetes/pki/etcd/etcd.pem --key=/etc/kubernetes/pki/etcd/etcd-key.pem endpoint status --write-out=tableetcdctl member list --endpoints=10.37.129.12:2379,10.37.129.11:2379,10.37.129.10:2379 --cacert=/etc/kubernetes/pki/etcd/etcd-ca.pem --cert=/etc/kubernetes/pki/etcd/etcd.pem --key=/etc/kubernetes/pki/etcd/etcd-key.pem Nginx(è½¬å‘åˆ°ApiServerçš„è¯·æ±‚)# Nginx é…ç½®# å®‰è£…ç¼–è¯‘ç¯å¢ƒyum install gcc -y# ä¸‹è½½è§£å‹ nginx äºŒè¿›åˆ¶æ–‡ä»¶# wget http://nginx.org/download/nginx-1.25.3.tar.gzcd /kubernetes-1.29.2/softtar xvf nginx-*.tar.gzcd nginx-1.25.3# è¿›è¡Œç¼–è¯‘./configure --with-stream --without-http --without-http_uwsgi_module --without-http_scgi_module --without-http_fastcgi_modulemake make install # æ‹·è´ç¼–è¯‘å¥½çš„ nginxnode=k8s-master02 k8s-master03 k8s-node01 k8s-node02for NODE in $node; do scp -r /usr/local/nginx/ $NODE:/usr/local/nginx/; done# å†™å…¥é…ç½®æ–‡ä»¶ï¼ˆåœ¨æ‰€æœ‰ä¸»æœºä¸Šæ‰§è¡Œï¼‰cat /usr/local/nginx/conf/kube-nginx.conf EOFworker_processes 1;events worker_connections 1024;stream upstream backend least_conn; hash $remote_addr consistent; server 10.37.129.10:6443 max_fails=3 fail_timeout=30s; server 10.37.129.11:6443 max_fails=3 fail_timeout=30s; server 10.37.129.12:6443 max_fails=3 fail_timeout=30s; server listen 127.0.0.1:8443; proxy_connect_timeout 1s; proxy_pass backend; EOFcat /etc/systemd/system/kube-nginx.service EOF[Unit]Description=kube-apiserver nginx proxyAfter=network.targetAfter=network-online.targetWants=network-online.target[Service]Type=forkingExecStartPre=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/kube-nginx.conf -p /usr/local/nginx -tExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/kube-nginx.conf -p /usr/local/nginxExecReload=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/kube-nginx.conf -p /usr/local/nginx -s reloadPrivateTmp=trueRestart=alwaysRestartSec=5StartLimitInterval=0LimitNOFILE=65536 [Install]WantedBy=multi-user.targetEOFsystemctl daemon-reloadsystemctl enable --now kube-nginx.servicesystemctl status kube-nginx.service ApiServer# æ‰€æœ‰ k8s èŠ‚ç‚¹åˆ›å»ºä»¥ä¸‹ç›®å½•mkdir -p /etc/kubernetes/manifests/ /etc/systemd/system/kubelet.service.d /var/lib/kubelet /var/log/kubernetes# åˆ›å»º apiserverï¼ˆæ‰€æœ‰ master èŠ‚ç‚¹ï¼‰# master01 èŠ‚ç‚¹é…ç½®cat /usr/lib/systemd/system/kube-apiserver.service EOF[Unit]Description=Kubernetes API ServerDocumentation=https://github.com/kubernetes/kubernetesAfter=network.target[Service]ExecStart=/usr/local/bin/kube-apiserver \\\\ --v=2 \\\\ --allow-privileged=true \\\\ --bind-address=0.0.0.0 \\\\ --secure-port=6443 \\\\ --advertise-address=10.37.129.10 \\\\ --service-cluster-ip-range=10.96.0.0/12,fd00:1111::/112 \\\\ --service-node-port-range=30000-32767 \\\\ --etcd-servers=https://10.37.129.11:2379,https://10.37.129.12:2379,https://10.37.129.10:2379 \\\\ --etcd-cafile=/etc/etcd/ssl/etcd-ca.pem \\\\ --etcd-certfile=/etc/etcd/ssl/etcd.pem \\\\ --etcd-keyfile=/etc/etcd/ssl/etcd-key.pem \\\\ --client-ca-file=/etc/kubernetes/pki/ca.pem \\\\ --tls-cert-file=/etc/kubernetes/pki/apiserver.pem \\\\ --tls-private-key-file=/etc/kubernetes/pki/apiserver-key.pem \\\\ --kubelet-client-certificate=/etc/kubernetes/pki/apiserver.pem \\\\ --kubelet-client-key=/etc/kubernetes/pki/apiserver-key.pem \\\\ --service-account-key-file=/etc/kubernetes/pki/sa.pub \\\\ --service-account-signing-key-file=/etc/kubernetes/pki/sa.key \\\\ --service-account-issuer=https://kubernetes.default.svc.cluster.local \\\\ --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname \\\\ --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,ResourceQuota \\ --authorization-mode=Node,RBAC \\\\ --enable-bootstrap-token-auth=true \\\\ --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.pem \\\\ --proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.pem \\\\ --proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client-key.pem \\\\ --requestheader-allowed-names=aggregator \\\\ --requestheader-group-headers=X-Remote-Group \\\\ --requestheader-extra-headers-prefix=X-Remote-Extra- \\\\ --requestheader-username-headers=X-Remote-User \\\\ --enable-aggregator-routing=trueRestart=on-failureRestartSec=10sLimitNOFILE=65535[Install]WantedBy=multi-user.targetEOF# master02 èŠ‚ç‚¹é…ç½®cat /usr/lib/systemd/system/kube-apiserver.service EOF[Unit]Description=Kubernetes API ServerDocumentation=https://github.com/kubernetes/kubernetesAfter=network.target[Service]ExecStart=/usr/local/bin/kube-apiserver \\\\ --v=2 \\\\ --allow-privileged=true \\\\ --bind-address=0.0.0.0 \\\\ --secure-port=6443 \\\\ --advertise-address=10.37.129.11 \\\\ --service-cluster-ip-range=10.96.0.0/12,fd00:1111::/112 \\\\ --service-node-port-range=30000-32767 \\\\ --etcd-servers=https://10.37.129.11:2379,https://10.37.129.12:2379,https://10.37.129.10:2379 \\\\ --etcd-cafile=/etc/etcd/ssl/etcd-ca.pem \\\\ --etcd-certfile=/etc/etcd/ssl/etcd.pem \\\\ --etcd-keyfile=/etc/etcd/ssl/etcd-key.pem \\\\ --client-ca-file=/etc/kubernetes/pki/ca.pem \\\\ --tls-cert-file=/etc/kubernetes/pki/apiserver.pem \\\\ --tls-private-key-file=/etc/kubernetes/pki/apiserver-key.pem \\\\ --kubelet-client-certificate=/etc/kubernetes/pki/apiserver.pem \\\\ --kubelet-client-key=/etc/kubernetes/pki/apiserver-key.pem \\\\ --service-account-key-file=/etc/kubernetes/pki/sa.pub \\\\ --service-account-signing-key-file=/etc/kubernetes/pki/sa.key \\\\ --service-account-issuer=https://kubernetes.default.svc.cluster.local \\\\ --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname \\\\ --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,ResourceQuota \\\\ --authorization-mode=Node,RBAC \\\\ --enable-bootstrap-token-auth=true \\\\ --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.pem \\\\ --proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.pem \\\\ --proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client-key.pem \\\\ --requestheader-allowed-names=aggregator \\\\ --requestheader-group-headers=X-Remote-Group \\\\ --requestheader-extra-headers-prefix=X-Remote-Extra- \\\\ --requestheader-username-headers=X-Remote-User \\\\ --enable-aggregator-routing=trueRestart=on-failureRestartSec=10sLimitNOFILE=65535[Install]WantedBy=multi-user.targetEOF# master03 é…ç½®cat /usr/lib/systemd/system/kube-apiserver.service EOF[Unit]Description=Kubernetes API ServerDocumentation=https://github.com/kubernetes/kubernetesAfter=network.target[Service]ExecStart=/usr/local/bin/kube-apiserver \\\\ --v=2 \\\\ --allow-privileged=true \\\\ --bind-address=0.0.0.0 \\\\ --secure-port=6443 \\\\ --advertise-address=10.37.129.12 \\\\ --service-cluster-ip-range=10.96.0.0/12,fd00:1111::/112 \\\\ --service-node-port-range=30000-32767 \\\\ --etcd-servers=https://10.37.129.11:2379,https://10.37.129.12:2379,https://10.37.129.10:2379 \\\\ --etcd-cafile=/etc/etcd/ssl/etcd-ca.pem \\\\ --etcd-certfile=/etc/etcd/ssl/etcd.pem \\\\ --etcd-keyfile=/etc/etcd/ssl/etcd-key.pem \\\\ --client-ca-file=/etc/kubernetes/pki/ca.pem \\\\ --tls-cert-file=/etc/kubernetes/pki/apiserver.pem \\\\ --tls-private-key-file=/etc/kubernetes/pki/apiserver-key.pem \\\\ --kubelet-client-certificate=/etc/kubernetes/pki/apiserver.pem \\\\ --kubelet-client-key=/etc/kubernetes/pki/apiserver-key.pem \\\\ --service-account-key-file=/etc/kubernetes/pki/sa.pub \\\\ --service-account-signing-key-file=/etc/kubernetes/pki/sa.key \\\\ --service-account-issuer=https://kubernetes.default.svc.cluster.local \\\\ --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname \\\\ --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,ResourceQuota \\\\ --authorization-mode=Node,RBAC \\\\ --enable-bootstrap-token-auth=true \\\\ --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.pem \\\\ --proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.pem \\\\ --proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client-key.pem \\\\ --requestheader-allowed-names=aggregator \\\\ --requestheader-group-headers=X-Remote-Group \\\\ --requestheader-extra-headers-prefix=X-Remote-Extra- \\\\ --requestheader-username-headers=X-Remote-User \\\\ --enable-aggregator-routing=trueRestart=on-failureRestartSec=10sLimitNOFILE=65535[Install]WantedBy=multi-user.targetEOF# å¯åŠ¨ apiServer(masterèŠ‚ç‚¹)systemctl daemon-reloadsystemctl enable --now kube-apiserver.servicesystemctl status kube-apiserver.service ControllerManager# é…ç½® kube-controller-manager service# æ‰€æœ‰masterèŠ‚ç‚¹é…ç½®ï¼Œä¸”é…ç½®ç›¸åŒ# 172.16.0.0/12ä¸ºpodç½‘æ®µï¼ŒæŒ‰éœ€æ±‚è®¾ç½®ä½ è‡ªå·±çš„ç½‘æ®µcat /usr/lib/systemd/system/kube-controller-manager.service EOF[Unit]Description=Kubernetes Controller ManagerDocumentation=https://github.com/kubernetes/kubernetesAfter=network.target[Service]ExecStart=/usr/local/bin/kube-controller-manager \\\\ --v=2 \\\\ --bind-address=0.0.0.0 \\\\ --root-ca-file=/etc/kubernetes/pki/ca.pem \\\\ --cluster-signing-cert-file=/etc/kubernetes/pki/ca.pem \\\\ --cluster-signing-key-file=/etc/kubernetes/pki/ca-key.pem \\\\ --service-account-private-key-file=/etc/kubernetes/pki/sa.key \\\\ --kubeconfig=/etc/kubernetes/controller-manager.kubeconfig \\\\ --leader-elect=true \\\\ --use-service-account-credentials=true \\\\ --node-monitor-grace-period=40s \\\\ --node-monitor-period=5s \\\\ --controllers=*,bootstrapsigner,tokencleaner \\\\ --allocate-node-cidrs=true \\\\ --service-cluster-ip-range=10.96.0.0/12,fd00:1111::/112 \\\\ --cluster-cidr=172.16.0.0/12,fc00:2222::/112 \\\\ --node-cidr-mask-size-ipv4=24 \\\\ --node-cidr-mask-size-ipv6=120 \\\\ --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.pemRestart=alwaysRestartSec=10s[Install]WantedBy=multi-user.targetEOF# å¯åŠ¨ kube-controller-managersystemctl daemon-reloadsystemctl enable --now kube-controller-manager.servicesystemctl status kube-controller-manager.service Scheduler# é…ç½® kube-scheduler service# æ‰€æœ‰ master èŠ‚ç‚¹é…ç½®ï¼Œä¸”é…ç½®ç›¸åŒcat /usr/lib/systemd/system/kube-scheduler.service EOF[Unit]Description=Kubernetes SchedulerDocumentation=https://github.com/kubernetes/kubernetesAfter=network.target[Service]ExecStart=/usr/local/bin/kube-scheduler \\\\ --v=2 \\\\ --bind-address=0.0.0.0 \\\\ --leader-elect=true \\\\ --kubeconfig=/etc/kubernetes/scheduler.kubeconfigRestart=alwaysRestartSec=10s[Install]WantedBy=multi-user.targetEOF# å¯åŠ¨ kube-schedulersystemctl daemon-reloadsystemctl enable --now kube-scheduler.servicesystemctl status kube-scheduler.service TLS Bootstrapping é…ç½®# åœ¨ master01 ä¸Šé…ç½®kubectl config set-cluster kubernetes \\--certificate-authority=/etc/kubernetes/pki/ca.pem \\--embed-certs=true --server=https://127.0.0.1:8443 \\--kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfigkubectl config set-credentials tls-bootstrap-token-user \\--token=c8ad9c.2e4d610cf3e7426e \\--kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfigkubectl config set-context tls-bootstrap-token-user@kubernetes \\--cluster=kubernetes \\--user=tls-bootstrap-token-user \\--kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfigkubectl config use-context tls-bootstrap-token-user@kubernetes \\--kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig# masterèŠ‚ç‚¹æ‰§è¡Œmkdir -p /root/.kube ; cp /etc/kubernetes/admin.kubeconfig /root/.kube/config# æŸ¥çœ‹é›†ç¾¤çŠ¶æ€kubectl get cscd ~cat bootstrap.secret.yaml EOFapiVersion: v1kind: Secretmetadata: name: bootstrap-token-c8ad9c namespace: kube-systemtype: bootstrap.kubernetes.io/tokenstringData: description: The default bootstrap token generated by kubelet . token-id: c8ad9c token-secret: 2e4d610cf3e7426e usage-bootstrap-authentication: true usage-bootstrap-signing: true auth-extra-groups: system:bootstrappers:default-node-token,system:bootstrappers:worker,system:bootstrappers:ingress ---apiVersion: rbac.authorization.k8s.io/v1kind: ClusterRoleBindingmetadata: name: kubelet-bootstraproleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: system:node-bootstrappersubjects:- apiGroup: rbac.authorization.k8s.io kind: Group name: system:bootstrappers:default-node-token---apiVersion: rbac.authorization.k8s.io/v1kind: ClusterRoleBindingmetadata: name: node-autoapprove-bootstraproleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: system:certificates.k8s.io:certificatesigningrequests:nodeclientsubjects:- apiGroup: rbac.authorization.k8s.io kind: Group name: system:bootstrappers:default-node-token---apiVersion: rbac.authorization.k8s.io/v1kind: ClusterRoleBindingmetadata: name: node-autoapprove-certificate-rotationroleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: system:certificates.k8s.io:certificatesigningrequests:selfnodeclientsubjects:- apiGroup: rbac.authorization.k8s.io kind: Group name: system:nodes---apiVersion: rbac.authorization.k8s.io/v1kind: ClusterRolemetadata: annotations: rbac.authorization.kubernetes.io/autoupdate: true labels: kubernetes.io/bootstrapping: rbac-defaults name: system:kube-apiserver-to-kubeletrules: - apiGroups: - resources: - nodes/proxy - nodes/stats - nodes/log - nodes/spec - nodes/metrics verbs: - *---apiVersion: rbac.authorization.k8s.io/v1kind: ClusterRoleBindingmetadata: name: system:kube-apiserver namespace: roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: system:kube-apiserver-to-kubeletsubjects: - apiGroup: rbac.authorization.k8s.io kind: User name: kube-apiserverEOF kubectl apply -f bootstrap.secret.yaml Node é…ç½®å¤åˆ¶ç›¸å…³è¯ä¹¦è‡³ node# åœ¨ master01 ä¸Šå°†è¯ä¹¦å¤åˆ¶åˆ° node èŠ‚ç‚¹cd /etc/kubernetes/ for NODE in k8s-master02 k8s-master03 k8s-node01 k8s-node02; do ssh $NODE mkdir -p /etc/kubernetes/pki; for FILE in pki/ca.pem pki/ca-key.pem pki/front-proxy-ca.pem bootstrap-kubelet.kubeconfig kube-proxy.kubeconfig; do scp /etc/kubernetes/$FILE $NODE:/etc/kubernetes/$FILE; done; done é…ç½® kubeletï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰# kubelet é…ç½®# å½“ä½¿ç”¨ docker ä½œä¸º Runtimecat /usr/lib/systemd/system/kubelet.service EOF[Unit]Description=Kubernetes KubeletDocumentation=https://github.com/kubernetes/kubernetesAfter=network-online.target firewalld.service cri-docker.service docker.socket containerd.serviceWants=network-online.targetRequires=docker.socket containerd.service[Service]ExecStart=/usr/local/bin/kubelet \\\\ --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig \\\\ --kubeconfig=/etc/kubernetes/kubelet.kubeconfig \\\\ --config=/etc/kubernetes/kubelet-conf.yml \\\\ --container-runtime-endpoint=unix:///run/cri-dockerd.sock \\\\ --node-labels=node.kubernetes.io/node= [Install]WantedBy=multi-user.targetEOFcat /etc/kubernetes/kubelet-conf.yml EOFapiVersion: kubelet.config.k8s.io/v1beta1kind: KubeletConfigurationaddress: 0.0.0.0port: 10250readOnlyPort: 10255authentication: anonymous: enabled: false webhook: cacheTTL: 2m0s enabled: true x509: clientCAFile: /etc/kubernetes/pki/ca.pemauthorization: mode: Webhook webhook: cacheAuthorizedTTL: 5m0s cacheUnauthorizedTTL: 30scgroupDriver: systemdcgroupsPerQOS: trueclusterDNS:- 10.96.0.10clusterDomain: cluster.localcontainerLogMaxFiles: 5containerLogMaxSize: 10MicontentType: application/vnd.kubernetes.protobufcpuCFSQuota: truecpuManagerPolicy: nonecpuManagerReconcilePeriod: 10senableControllerAttachDetach: trueenableDebuggingHandlers: trueenforceNodeAllocatable:- podseventBurst: 10eventRecordQPS: 5evictionHard: imagefs.available: 15% memory.available: 100Mi nodefs.available: 10% nodefs.inodesFree: 5%evictionPressureTransitionPeriod: 5m0sfailSwapOn: truefileCheckFrequency: 20shairpinMode: promiscuous-bridgehealthzBindAddress: 127.0.0.1healthzPort: 10248httpCheckFrequency: 20simageGCHighThresholdPercent: 85imageGCLowThresholdPercent: 80imageMinimumGCAge: 2m0siptablesDropBit: 15iptablesMasqueradeBit: 14kubeAPIBurst: 10kubeAPIQPS: 5makeIPTablesUtilChains: truemaxOpenFiles: 1000000maxPods: 110nodeStatusUpdateFrequency: 10soomScoreAdj: -999podPidsLimit: -1registryBurst: 10registryPullQPS: 5resolvConf: /etc/resolv.confrotateCertificates: trueruntimeRequestTimeout: 2m0sserializeImagePulls: truestaticPodPath: /etc/kubernetes/manifestsstreamingConnectionIdleTimeout: 4h0m0ssyncFrequency: 1m0svolumeStatsAggPeriod: 1m0sEOFsystemctl daemon-reloadsystemctl enable --now kubelet.servicesystemctl status kubelet.service kube-proxy é…ç½®ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰# å°† kubeconfig å‘é€è‡³å…¶ä»–èŠ‚ç‚¹# master-1 æ‰§è¡Œfor NODE in k8s-master02 k8s-master03 k8s-node01 k8s-node02; do scp /etc/kubernetes/kube-proxy.kubeconfig $NODE:/etc/kubernetes/kube-proxy.kubeconfig; done# æ‰€æœ‰ k8s èŠ‚ç‚¹æ·»åŠ  kube-proxy çš„ service æ–‡ä»¶cat /usr/lib/systemd/system/kube-proxy.service EOF[Unit]Description=Kubernetes Kube ProxyDocumentation=https://github.com/kubernetes/kubernetesAfter=network.target[Service]ExecStart=/usr/local/bin/kube-proxy \\\\ --config=/etc/kubernetes/kube-proxy.yaml \\\\ --cluster-cidr=172.16.0.0/12,fc00:2222::/112 \\\\ --v=2Restart=alwaysRestartSec=10s[Install]WantedBy=multi-user.targetEOF# æ‰€æœ‰ k8sèŠ‚ç‚¹æ·»åŠ  kube-proxy çš„é…ç½®cat /etc/kubernetes/kube-proxy.yaml EOFapiVersion: kubeproxy.config.k8s.io/v1alpha1bindAddress: 0.0.0.0clientConnection: acceptContentTypes: burst: 10 contentType: application/vnd.kubernetes.protobuf kubeconfig: /etc/kubernetes/kube-proxy.kubeconfig qps: 5clusterCIDR: 172.16.0.0/12,fc00:2222::/112configSyncPeriod: 15m0sconntrack: max: null maxPerCore: 32768 min: 131072 tcpCloseWaitTimeout: 1h0m0s tcpEstablishedTimeout: 24h0m0senableProfiling: falsehealthzBindAddress: 0.0.0.0:10256hostnameOverride: iptables: masqueradeAll: false masqueradeBit: 14 minSyncPeriod: 0s syncPeriod: 30sipvs: masqueradeAll: true minSyncPeriod: 5s scheduler: rr syncPeriod: 30skind: KubeProxyConfigurationmetricsBindAddress: 127.0.0.1:10249mode: ipvsnodePortAddresses: nulloomScoreAdj: -999portRange: udpIdleTimeout: 250msEOFsystemctl daemon-reloadsystemctl enable --now kube-proxy.servicesystemctl status kube-proxy.service å®‰è£…ç½‘ç»œæ’ä»¶(m1èŠ‚ç‚¹æ“ä½œ)#wget https://mirrors.chenby.cn/https://github.com/projectcalico/calico/blob/master/manifests/calico-typha.yaml#cp calico-typha.yaml calico.yaml#vim calico.yaml# calico-config ConfigMapå¤„ #ipam: # type: calico-ipam, #, #- name: IP # value: autodetect# #- name: CALICO_IPV4POOL_CIDR # value: 172.16.0.0/12# vim calico-ipv6.yaml# calico-config ConfigMapå¤„# ipam: # type: calico-ipam,# assign_ipv4: true,# assign_ipv6: true# ,# - name: IP# value: autodetect# # - name: IP6# value: autodetect# # - name: CALICO_IPV4POOL_CIDR# value: 172.16.0.0/12# # - name: CALICO_IPV6POOL_CIDR# value: fc00:2222::/112# # - name: FELIX_IPV6SUPPORT# value: true# è‹¥dockeré•œåƒæ‹‰ä¸ä¸‹æ¥ï¼Œå¯ä»¥ä½¿ç”¨å›½å†…çš„ä»“åº“#sed -i s#docker.io/calico/#m.daocloud.io/docker.io/calico/#g calico.yaml #sed -i s#docker.io/calico/#m.daocloud.io/docker.io/calico/#g calico-ipv6.yaml#sed -i s#m.daocloud.io/docker.io/calico/#docker.io/calico/#g calico.yaml #sed -i s#m.daocloud.io/docker.io/calico/#docker.io/calico/#g calico-ipv6.yaml# ä¿®æ”¹ä¸ºå›½å†…æº dockeræºå¯é€‰#sed -i s#coredns/#m.daocloud.io/docker.io/coredns/#g values.yaml#sed -i s#registry.k8s.io/#m.daocloud.io/registry.k8s.io/#g values.yamlcd kubernetes-1.29.2/softmv dockertools /usr/local/binscp /usr/local/bin/dockertools root@m2:/usr/local/bin/scp /usr/local/bin/dockertools root@m3:/usr/local/bin/scp /usr/local/bin/dockertools root@n1:/usr/local/bin/scp /usr/local/bin/dockertools root@n2:/usr/local/bin/cd kubernetes-1.29.2dockertools load -l images/scp -r images root@m2:/root/scp -r images root@m3:/root/scp -r images root@n1:/root/scp -r images root@n2:/root/# å…¶ä»–èŠ‚ç‚¹æ‰§è¡Œcd /root/dockertools load -l images/# æœ¬åœ°æ²¡æœ‰å…¬ç½‘ IPv6 ä½¿ç”¨ calico.yamlcd /home/k8s/soft/kubernetes-1.29.2/manifestskubectl apply -f calico-typha.yaml#åˆ é™¤#kubectl delete -f calico-typha.yaml å®‰è£… CoreDNSï¼ˆm1èŠ‚ç‚¹æ“ä½œï¼‰# å®‰è£… helmcd kubernetes-1.29.2/softtar -zxvf helm-v3.14.4-linux-amd64.tar.gz mv linux-amd64/helm /usr/local/bin/helm version# ä¸‹è½½tgzåŒ…#helm repo add coredns https://coredns.github.io/helm#helm pull coredns/coredns#tar xvf coredns-*.tgzhelm install coredns ./coredns/ -n kube-system#åˆ é™¤#helm uninstall coredns -n kube-system# ä¿®æ”¹IPåœ°å€#vim values.yaml#cat values.yaml | grep clusterIP:#clusterIP: 10.96.0.10 å®‰è£… Metrics Server# ä¸‹è½½ #wget https://mirrors.chenby.cn/https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml# ä¿®æ”¹é…ç½®#vim components.yaml---## 1# - args:# - --cert-dir=/tmp# - --secure-port=10250# - --kubelet-preferred-address-types=InternalIP,#ExternalIP,Hostname# - --kubelet-use-node-status-port# - --metric-resolution=15s# - --kubelet-insecure-tls# - --requestheader-client-ca-file=/etc/kubernetes/#pki/front-proxy-ca.pem# - --requestheader-username-headers=X-Remote-User# - --requestheader-group-headers=X-Remote-Group# - #--requestheader-extra-headers-prefix=X-Remote-Ext#ra-#### 2# volumeMounts:# - mountPath: /tmp# name: tmp-dir# - name: ca-ssl# mountPath: /etc/kubernetes/pki### 3# volumes:# - emptyDir: # name: tmp-dir# - name: ca-ssl# hostPath:# path: /etc/kubernetes/pki---# ä¿®æ”¹ä¸ºå›½å†…æº dockeræºå¯é€‰#sed -i s#registry.k8s.io/#m.daocloud.io/registry.k8s.io/#g *.yaml# m1èŠ‚ç‚¹æ‰§è¡Œéƒ¨ç½²cd kubernetes-1.29.2/manifestskubectl apply -f components.yamlkubectl top pod -n kube-system å®‰è£…å‘½ä»¤è¡¥å…¨# masterèŠ‚ç‚¹æ‰§è¡Œyum install bash-completion -ysource /usr/share/bash-completion/bash_completionsource (kubectl completion bash)echo source (kubectl completion bash) ~/.bashrc# è®¾ç½® master èŠ‚ç‚¹æ±¡ç‚¹kubectl taint nodes k8s-node01 node-role.kubernetes.io/control-plane=:NoSchedule","tags":[null],"categories":[null]},{"title":"Kuberneteså­˜å‚¨","path":"/wiki/Kubernetes/å­˜å‚¨.html","content":"å­˜å‚¨å­˜å‚¨åˆ†ç±» â€Œå…ƒæ•°æ®â€Œï¼š â€ŒconfigMapâ€Œï¼šç”¨äºä¿å­˜é…ç½®æ•°æ®ï¼Œè¿™äº›æ•°æ®æ˜¯æ˜æ–‡å­˜å‚¨çš„ã€‚ â€ŒSecretâ€Œï¼šç”¨äºä¿å­˜æ•æ„Ÿæ€§æ•°æ®ï¼Œè¿™äº›æ•°æ®æ˜¯ç»è¿‡ç¼–ç çš„ï¼Œä»¥ç¡®ä¿å®‰å…¨æ€§ã€‚ â€ŒDownward APIâ€Œï¼šå®¹å™¨åœ¨è¿è¡Œæ—¶å¯ä»¥ä»Kubernetes APIæœåŠ¡å™¨è·å–æœ‰å…³å®ƒä»¬è‡ªèº«çš„ä¿¡æ¯ã€‚ â€ŒçœŸå®æ•°æ®â€Œï¼š â€ŒVolumeâ€Œï¼šç”¨äºå­˜å‚¨ä¸´æ—¶æˆ–æŒä¹…æ€§æ•°æ®ï¼Œæ»¡è¶³å®¹å™¨è¿è¡Œæ—¶çš„æ•°æ®å­˜å‚¨éœ€æ±‚ã€‚ â€ŒPersistentVolumeâ€Œï¼šç”³è¯·åˆ¶çš„æŒä¹…åŒ–å­˜å‚¨ï¼Œç”¨äºé•¿æœŸä¿å­˜æ•°æ®ã€‚ ConfigMapConfigMap æ˜¯ Kubernetes ä¸­ç”¨äºâ€Œç®¡ç†éæ•æ„Ÿé…ç½®æ•°æ®â€Œçš„æ ¸å¿ƒèµ„æºå¯¹è±¡ï¼Œå®ƒå°†é…ç½®ä¿¡æ¯ä¸å®¹å™¨é•œåƒè§£è€¦ï¼Œå®ç°åº”ç”¨é…ç½®çš„é›†ä¸­åŒ–ã€åŠ¨æ€åŒ–ç®¡ç†ã€‚ æ ¸å¿ƒåŠŸèƒ½ä¸ç‰¹æ€§ â€Œåˆ†ç¦»é…ç½®ä¸ä»£ç â€Œå°†ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ï¼ˆå¦‚ nginx.confï¼‰ç­‰ä»å®¹å™¨é•œåƒä¸­å‰¥ç¦»ï¼Œé¿å…å› é…ç½®å˜æ›´éœ€é‡æ–°æ„å»ºé•œåƒçš„é—®é¢˜ã€‚â€Œ â€Œæ”¯æŒå¤šç§æ•°æ®æ ¼å¼ é”®å€¼å¯¹ï¼ˆkey: valueï¼‰ å®Œæ•´é…ç½®æ–‡ä»¶ï¼ˆå¦‚ JSONã€XMLã€YAMLï¼‰ ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆ.env æ ¼å¼ï¼‰â€Œ â€ŒåŠ¨æ€æ›´æ–°èƒ½åŠ›â€Œä¿®æ”¹ ConfigMap åï¼Œéƒ¨åˆ†æŒ‚è½½æ–¹å¼ï¼ˆå¦‚ Volume æŒ‚è½½ï¼‰å¯å®æ—¶åŒæ­¥åˆ° Pod å†…ï¼Œæ— éœ€é‡å¯å®¹å™¨ï¼ˆéœ€åº”ç”¨æ”¯æŒé…ç½®çƒ­åŠ è½½ï¼‰ã€‚â€Œ â€Œæ³¨æ„äº‹é¡¹â€Œ1.ConfigMap å¿…é¡»ä¸ Pod åŒå‘½åç©ºé—´â€Œã€‚2.å• ConfigMap æ•°æ®é‡å»ºè®®ä¸è¶…è¿‡ 1 MiBï¼Œå¤§æ–‡ä»¶å»ºè®®ä½¿ç”¨æŒä¹…åŒ–å­˜å‚¨â€Œã€‚ åˆ›å»ºæ–¹å¼ æ–‡ä»¶ vi config.filekubectl create configmap game-config --from-file=config.file å‘½ä»¤è¡Œ kubectl create configmap literal-config --from-literal=name=zhangsan --from-literal=password=321 yamlå£°æ˜å¼é…ç½® apiVersion: v1kind: ConfigMapmetadata: name: timezone-configdata: timezone: Asia/Shanghai # é”®å€¼å¯¹ profile.properties: | # å®Œæ•´é…ç½®æ–‡ä»¶ app.log.level=INFO app.thread.count=4 ConfigMapå®éªŒé…ç½®ç¯å¢ƒå˜é‡apiVersion: v1kind: ConfigMapmetadata: name: literal-config namespace: defaultdata: name: dave password: pass---apiVersion: v1kind: ConfigMapmetadata: name: env-config namespace: defaultdata: log_level: INFO---apiVersion: v1kind: Podmetadata: name: cm-env-podspec: containers: - name: myapp-container image: wangyanglinux/myapp:v1.0 command: [ /bin/sh, -c, env ] env: - name: USERNAME valueFrom: configMapKeyRef: name: literal-config key: name - name: PASSWORD valueFrom: configMapKeyRef: name: literal-config key: password envFrom: - configMapRef: name: env-config restartPolicy: Never åœ¨åŒä¸€ä¸ª yaml å†…å¤šä¸ªèµ„æºæ–‡ä»¶å¯ä»¥ä½¿ç”¨ â€” éš”ç¦» kubectl create -f config-pod-env.yaml å¯åŠ¨å‘½ä»¤apiVersion: v1kind: ConfigMapmetadata: name: literal-config namespace: defaultdata: name: dave password: pass---apiVersion: v1kind: Podmetadata: name: cm-command-podspec: containers: - name: myapp-container image: wangyanglinux/myapp:v1.0 command: [ /bin/sh, -c, echo $(USERNAME) $(PASSWORD) ] env: - name: USERNAME valueFrom: configMapKeyRef: name: literal-config key: name - name: PASSWORD valueFrom: configMapKeyRef: name: literal-config key: password restartPolicy: Never è¾“å‡ºé…ç½®åˆ°æ–‡ä»¶apiVersion: v1kind: ConfigMapmetadata: name: literal-config namespace: defaultdata: name: dave password: pass---apiVersion: v1kind: Podmetadata: name: cm-volume-podspec: containers: - name: myapp-container image: wangyanglinux/myapp:v1.0 volumeMounts: - name: config-volume mountPath: /etc/config volumes: - name: config-volume configMap: name: literal-config restartPolicy: Never ä½œç”¨ï¼š â€ŒConfigMap æŒ‚è½½â€Œ åä¸º literal-config çš„ ConfigMap è¢«æŒ‚è½½ä¸ºåä¸º config-volume çš„å·ï¼Œå…¶æ‰€æœ‰é”®å€¼å¯¹å°†è‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶ï¼ˆé”®åä½œä¸ºæ–‡ä»¶åï¼Œå€¼ä½œä¸ºæ–‡ä»¶å†…å®¹ï¼‰â€Œã€‚ æŒ‚è½½è·¯å¾„ä¸ºå®¹å™¨å†…çš„ /etc/configï¼Œå®¹å™¨å¯é€šè¿‡æ–‡ä»¶ç³»ç»Ÿç›´æ¥è¯»å–é…ç½®â€Œã€‚ â€ŒåŠ¨æ€æ›´æ–°ç‰¹æ€§â€Œ è‹¥ä¿®æ”¹ literal-config çš„å†…å®¹ï¼Œå·²æŒ‚è½½çš„æ–‡ä»¶ä¼šè‡ªåŠ¨æ›´æ–°ï¼ˆéœ€åº”ç”¨æ”¯æŒé…ç½®çƒ­åŠ è½½ï¼‰ï¼Œæ— éœ€é‡å¯ Podâ€Œã€‚ ä¸ env æ³¨å…¥æ–¹å¼ä¸åŒï¼ŒVolume æŒ‚è½½çš„é…ç½®æ›´æ–°æ˜¯å®æ—¶çš„â€Œã€‚ é…ç½®è¯´æ˜ï¼š â€ŒVolume å£°æ˜â€Œ volumes å­—æ®µå®šä¹‰äº†ä¸€ä¸ªåä¸º config-volume çš„å·ï¼Œå…¶æ•°æ®æºæ¥è‡ª ConfigMap literal-configâ€Œã€‚ ConfigMap ä¸­çš„æ¯ä¸ªé”®å€¼å¯¹ä¼šç”Ÿæˆç‹¬ç«‹æ–‡ä»¶ï¼ˆä¾‹å¦‚é”® name å¯¹åº”æ–‡ä»¶ /etc/config/nameï¼‰â€Œã€‚ â€ŒVolume æŒ‚è½½â€Œ å®¹å™¨é€šè¿‡ volumeMounts å°† config-volume æŒ‚è½½åˆ° /etc/configï¼Œè¯¥è·¯å¾„ä¸‹çš„æ–‡ä»¶å¯ç›´æ¥è¢«åº”ç”¨è¯»å–â€Œã€‚ è‹¥æŒ‚è½½è·¯å¾„å·²å­˜åœ¨æ–‡ä»¶ï¼ŒConfigMap å†…å®¹ä¼šè¦†ç›–åŸæœ‰æ–‡ä»¶â€Œã€‚ kubectl create -f cm-volume-pod.yamlkubectl exec -it cm-volume-pod /bin/bash kubectl edit cm literal-config å¯ä»¥çœ‹åˆ°ä¿®æ”¹äº† literal-config ä¸­çš„å€¼åå¯¹åº” Pod é‡Œçš„å†…å®¹ä¹Ÿè¢«ä¿®æ”¹äº†ã€‚ Podä¸­æ–‡ä»¶æ˜¯ä»¥é“¾æ¥çš„æ–¹å¼ç”Ÿæˆçš„ï¼Œæ›´æ–°å®é™…æ˜¯ç”Ÿæˆæ–°çš„æ–‡ä»¶ç„¶åä¿®æ”¹é“¾æ¥ã€‚ çƒ­æ›´æ–°nginx.conf worker_processes 1;user nginx;daemon off;events worker_connections 1024;http default_type application/octet-stream; sendfile on; keepalive_timeout 65; server listen 80; server_name localhost; #charset koi8-r; #access_log logs/host.access.log main; location / root /usr/local/nginx/html; index index.html index.htm; #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html root html; hotupdate-deploy.yaml apiVersion: apps/v1kind: Deploymentmetadata: labels: app: hotupdate-deploy name: hotupdate-deployspec: replicas: 5 selector: matchLabels: app: hotupdate-deploy template: metadata: labels: app: hotupdate-deploy spec: containers: - name: nginx image: wangyanglinux/myapp:v1.0 volumeMounts: - name: config-volume mountPath: /usr/local/nginx/conf/ volumes: - name: config-volume configMap: name: nginx.conf kubectl create cm nginx.conf --from-file=nginx.confkubectl create -f hotupdate-deploy.yaml Podä¸­ä¹ŸæˆåŠŸæŒ‚è½½äº† default.con æ–‡ä»¶ã€‚ kubectl edit cm default-nginx ç­‰å¾…ä¸€æ®µæ—¶é—´åå¯ä»¥çœ‹åˆ° Pod ä¸­é…ç½®æ–‡ä»¶ç«¯å£ä¹Ÿä¿®æ”¹ä¸ºäº† 8080ã€‚ æ­¤æ—¶è®¿é—® 8080 ç«¯å£æ˜¯ä¸é€šçš„ï¼Œå› ä¸º Pod æ˜¯æ²¡ç”¨é‡å¯ä½¿ç”¨æ–°çš„é…ç½®ã€‚ kubectl patch deployment hotupdate-deploy --patch spec: template: metadata: annotations: version/config: 66666666 æ›´æ–°ConfigMapæ—¶ï¼Œéœ€æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š â€Œæ»šåŠ¨æ›´æ–°â€Œï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œæ›´æ–°ConfigMapä¸ä¼šè§¦å‘Podçš„æ»šåŠ¨æ›´æ–°ã€‚å¦‚éœ€å¼ºåˆ¶è§¦å‘ï¼Œå¯é€šè¿‡ä¿®æ”¹ pod annotations çš„æ–¹å¼å¼ºåˆ¶è§¦å‘æ»šåŠ¨æ›´æ–°ã€‚ kubectl patch deployment hotupdate-deploy --patch spec: template: metadata: annotations: version/config: 66666666 â€ŒVolumeæ•°æ®åŒæ­¥â€Œï¼šè€ŒæŒ‚è½½ä¸ºVolumeçš„æ•°æ®åˆ™éœ€è¦å¤§çº¦â€Œ10ç§’â€Œçš„æ—¶é—´æ‰èƒ½åŒæ­¥æ›´æ–°ã€‚ ä¸å¯æ”¹å˜Kubernetes æä¾›äº†ä¸€ç§å¯é€‰é…ç½®ï¼Œå…è®¸å°† ConfigMap å’Œ Secret è®¾ç½®ä¸ºä¸å¯å˜ã€‚è¿™ä¸€åŠŸèƒ½å¸¦æ¥ä»¥ä¸‹å¥½å¤„ï¼š â€Œé˜²æ­¢æ„å¤–æ›´æ–°â€Œï¼šâ€Œç¦æ­¢å˜æ›´ ConfigMap å’Œ Secret çš„æ•°æ®â€Œï¼Œå¯ä»¥é¿å…éé¢„æœŸçš„æ›´æ–°å¯¼è‡´åº”ç”¨ç¨‹åºä¸­æ–­ã€‚ â€Œæå‡é›†ç¾¤æ€§èƒ½â€Œï¼šé€šè¿‡å°† ConfigMap æ ‡è®°ä¸ºä¸å¯å˜ï¼Œå¯ä»¥å…³é—­ kube-apiserver å¯¹å…¶çš„ç›‘è§†ï¼Œä»è€Œâ€Œæ˜¾è‘—é™ä½ kube-apiserver çš„è´Ÿè½½â€Œã€‚ â€Œä¼˜åŒ–èµ„æºç®¡ç†â€Œï¼šå¯¹äºå¤§é‡ä½¿ç”¨ ConfigMap çš„é›†ç¾¤ï¼Œè¿™ä¸€é…ç½®æœ‰åŠ©äºâ€Œæ›´å¥½åœ°ç®¡ç†èµ„æºâ€Œï¼Œç¡®ä¿é›†ç¾¤ç¨³å®šè¿è¡Œã€‚ kubectl edit cm nginx.conf æ·»åŠ å®Œè¯¥å‚æ•°åå†æ‰§è¡Œä¿®æ”¹å‘½ä»¤ä¼šæ‹’ç»ä¿å­˜ä¿®æ”¹ã€‚ å¦‚æœä¿®æ”¹ä¸ºæ— å¯æ”¹å˜çš„çŠ¶æ€ï¼Œæ˜¯ä¸å…è®¸å›é€€ï¼Œä¸å¯é€†çš„ã€‚åªèƒ½åˆ é™¤æ­¤ cmï¼Œç„¶åé‡æ–°åˆ›å»ºä¸€ä¸ªæ— ä¸å¯æ”¹å˜æ ‡è®°çš„cmã€‚ envä¸envFromåŒºåˆ«åœ¨ Kubernetes ä¸­ï¼Œenv å’Œ envFrom éƒ½æ˜¯ç”¨äºä¸ºå®¹å™¨è®¾ç½®ç¯å¢ƒå˜é‡çš„å­—æ®µï¼Œä½†å®ƒä»¬åœ¨åŠŸèƒ½å’Œä½¿ç”¨æ–¹å¼ä¸Šæœ‰æ˜¾è‘—åŒºåˆ«ã€‚ æ ¸å¿ƒåŒºåˆ«å¯¹æ¯” â€Œç‰¹æ€§â€Œ â€Œenvâ€Œ â€ŒenvFromâ€Œ â€Œæ•°æ®æ¥æºâ€Œ ç›´æ¥å®šä¹‰æˆ–ä» ConfigMapSecret çš„â€Œå•ä¸ªé”®â€Œå¼•ç”¨ ä» ConfigMapSecret çš„â€Œå…¨éƒ¨é”®å€¼å¯¹â€Œæ‰¹é‡å¼•ç”¨ â€Œæ›´æ–°è¡Œä¸ºâ€Œ ä¿®æ”¹åéœ€é‡å¯ Pod ç”Ÿæ•ˆâ€Œ ä¿®æ”¹åéœ€åˆ é™¤å¹¶é‡å»º Pod æ‰èƒ½ç”Ÿæ•ˆâ€Œ â€Œé€‚ç”¨åœºæ™¯â€Œ éœ€è¦ç²¾ç¡®æ§åˆ¶å°‘é‡ç¯å¢ƒå˜é‡ éœ€è¦æ‰¹é‡å¯¼å…¥æ•´ä¸ªé…ç½®æ–‡ä»¶çš„é”®å€¼å¯¹ â€Œè¯­æ³•ç¤ºä¾‹â€Œ valueFrom.configMapKeyRef configMapRef æˆ– secretRef å…·ä½“å·®å¼‚è§£æ â€Œenv çš„å…¸å‹ç”¨æ³• â€Œç›´æ¥å®šä¹‰å€¼â€Œï¼š env: - name: LOG_LEVEL value: INFO â€Œå¼•ç”¨ ConfigMap çš„å•ä¸ªé”®ï¼ˆå¦‚ç”¨æˆ·ç¤ºä¾‹ä¸­çš„ USERNAMEï¼‰ï¼š env: - name: USERNAME valueFrom: configMapKeyRef: name: literal-config key: name â€Œç‰¹ç‚¹â€Œï¼šç²¾å‡†æ§åˆ¶æ¯ä¸ªå˜é‡ï¼Œé€‚åˆæ•æ„Ÿæ•°æ®ï¼ˆå¦‚å¯†ç ï¼‰æˆ–éœ€å‘½åçš„å˜é‡â€Œã€‚ â€ŒenvFrom çš„å…¸å‹ç”¨æ³• â€Œæ‰¹é‡å¯¼å…¥ ConfigMap æ‰€æœ‰é”®å€¼å¯¹â€Œï¼ˆå¦‚ç”¨æˆ·ç¤ºä¾‹ä¸­çš„ env-configï¼‰ï¼š envFrom: - configMapRef: name: env-config â€Œç‰¹ç‚¹â€Œï¼šè‡ªåŠ¨å°† ConfigMap ä¸­çš„æ¯ä¸ªé”®å€¼å¯¹è½¬æ¢ä¸ºç¯å¢ƒå˜é‡ï¼Œé”®åç›´æ¥ä½œä¸ºå˜é‡åâ€Œã€‚â€Œ æ³¨æ„â€Œï¼šè‹¥éœ€é¿å…å‘½åå†²çªï¼Œå¯é€šè¿‡ prefix æ·»åŠ ç»Ÿä¸€å‰ç¼€â€Œã€‚ è¡Œä¸ºå·®å¼‚è¯¦è§£ â€Œæ›´æ–°åçš„ç”Ÿæ•ˆæ–¹å¼â€Œ â€Œenv ä¿®æ”¹ï¼šç›´æ¥ç¼–è¾‘ Pod YAML ä¸­çš„ env å­—æ®µå¹¶åº”ç”¨åï¼ŒKubernetes ä¼šè‡ªåŠ¨é‡å¯ Pod ä½¿æ–°å˜é‡ç”Ÿæ•ˆâ€Œã€‚ â€ŒenvFrom ä¿®æ”¹ï¼šæ›´æ–°å¼•ç”¨çš„ ConfigMap åï¼Œéœ€æ‰‹åŠ¨åˆ é™¤ Pod è§¦å‘é‡å»ºæ‰èƒ½åŠ è½½æ–°å˜é‡ï¼ˆç¯å¢ƒå˜é‡ä¸ä¼šè‡ªåŠ¨æ›´æ–°ï¼‰â€Œã€‚ â€Œä¸ Volume æŒ‚è½½çš„å¯¹æ¯”â€Œ è‹¥é€šè¿‡ Volume æŒ‚è½½ ConfigMapï¼Œæ–‡ä»¶å†…å®¹ä¼šå®æ—¶æ›´æ–°ï¼Œä½†ç¯å¢ƒå˜é‡æ–¹å¼ï¼ˆæ— è®º env æˆ– envFromï¼‰å‡éœ€é‡å»º Podâ€Œã€‚ æœ€ä½³å®è·µå»ºè®® â€Œæ•æ„Ÿæ•°æ®â€Œï¼šä¼˜å…ˆä½¿ç”¨ env + secretKeyRef è€Œé envFromï¼Œé¿å…æ„å¤–æš´éœ² Secret çš„å…¨éƒ¨å†…å®¹â€Œã€‚ â€Œæ‰¹é‡é…ç½®â€Œï¼šéæ•æ„Ÿä¸”éœ€å®Œæ•´å¯¼å…¥çš„é…ç½®ï¼ˆå¦‚åœ°åŸŸåˆ—è¡¨ï¼‰ï¼Œæ¨èä½¿ç”¨ envFrom ç®€åŒ–ç®¡ç†â€Œã€‚ â€Œå‘½åè§„èŒƒâ€Œï¼šé€šè¿‡ prefix ä¸º envFrom å¯¼å…¥çš„å˜é‡æ·»åŠ å‰ç¼€ï¼ˆå¦‚ APP_ï¼‰ï¼Œé¿å…å‘½åå†²çªâ€Œã€‚ æ€»ç»“ï¼šenv æä¾›ç²¾ç»†åŒ–æ§åˆ¶ï¼ŒenvFrom ç®€åŒ–æ‰¹é‡å¯¼å…¥ï¼Œæ ¹æ®åœºæ™¯éœ€æ±‚é€‰æ‹©å³å¯â€Œã€‚ SecretSecret çš„æ ¸å¿ƒä½œç”¨Secret ç”¨äºâ€Œå®‰å…¨å­˜å‚¨å’Œåˆ†å‘æ•æ„Ÿæ•°æ®â€Œï¼Œä¾‹å¦‚ï¼š â€Œè®¤è¯ä¿¡æ¯â€Œï¼šæ•°æ®åº“å¯†ç ã€API å¯†é’¥ã€OAuth ä»¤ç‰Œç­‰ã€‚â€Œ â€ŒTLS è¯ä¹¦â€Œï¼šä¸º HTTPS é€šä¿¡æä¾›åŠ å¯†è¯ä¹¦å’Œç§é’¥ã€‚â€Œ â€Œç§æœ‰ä»“åº“å‡­æ®â€Œï¼šæ‹‰å–ç§æœ‰é•œåƒæ—¶æ‰€éœ€çš„ Docker æ³¨å†Œè¡¨ç”¨æˆ·åå’Œå¯†ç ã€‚â€Œ â€ŒåŠ¨æ€æ›´æ–°æ”¯æŒâ€Œï¼šåœ¨ä¸é‡å¯ Pod çš„å‰æä¸‹è½®æ¢æ•æ„Ÿæ•°æ®ï¼ˆå¦‚è¯ä¹¦ï¼‰ã€‚â€Œ å…³é”®ä¼˜åŠ¿ï¼šé€šè¿‡ Base64 ç¼–ç å‡å°‘æ˜æ–‡æš´éœ²é£é™©ï¼Œå¹¶ä¾æ‰˜ RBAC æœºåˆ¶æ§åˆ¶è®¿é—®æƒé™ã€‚â€Œ Secret çš„ç±»å‹é€šè¿‡ä¸º Secret å¯¹è±¡çš„ type å­—æ®µè®¾ç½®ä¸€ä¸ªéç©ºçš„å­—ç¬¦ä¸²å€¼ï¼Œä½ ä¹Ÿå¯ä»¥å®šä¹‰å¹¶ä½¿ç”¨è‡ªå·± Secret ç±»å‹ï¼ˆå¦‚æœ type å€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œåˆ™è¢«è§†ä¸º Opaque ç±»å‹ï¼‰ã€‚ Kubernetes å¹¶ä¸å¯¹ç±»å‹çš„åç§°ä½œä»»ä½•é™åˆ¶ã€‚ä¸è¿‡ï¼Œå¦‚æœä½ è¦ä½¿ç”¨å†…ç½®ç±»å‹ä¹‹ä¸€ï¼Œ åˆ™ä½ å¿…é¡»æ»¡è¶³ä¸ºè¯¥ç±»å‹æ‰€å®šä¹‰çš„æ‰€æœ‰è¦æ±‚ã€‚ å†…ç½®ç±»å‹ ç”¨æ³• Opaque ç”¨æˆ·å®šä¹‰çš„ä»»æ„æ•°æ® kubernetes.io/service-account-token æœåŠ¡è´¦å·ä»¤ç‰Œ kubernetes.io/dockercfg ~/.dockercfg æ–‡ä»¶çš„åºåˆ—åŒ–å½¢å¼ kubernetes.io/dockerconfigjson ~/.docker/config.json æ–‡ä»¶çš„åºåˆ—åŒ–å½¢å¼ kubernetes.io/basic-auth ç”¨äºåŸºæœ¬èº«ä»½è®¤è¯çš„å‡­æ® kubernetes.io/ssh-auth ç”¨äº SSH èº«ä»½è®¤è¯çš„å‡­æ® kubernetes.io/tls ç”¨äº TLS å®¢æˆ·ç«¯æˆ–è€…æœåŠ¡å™¨ç«¯çš„æ•°æ® bootstrap.kubernetes.io/token å¯åŠ¨å¼•å¯¼ä»¤ç‰Œæ•°æ® Opaqueå®éªŒåˆ›å»º secret[root@k8s-node01 ~]# echo -n admin | base64YWRtaW4=[root@k8s-node01 ~]# echo -n 1f2d1e2e67df | base64MWYyZDFlMmU2N2Rm[root@k8s-node01 ~]# apiVersion: v1kind: Secretmetadata: name: mysecrettype: Opaquedata: # éœ€è¦ä½¿ç”¨ base64 ç¼–ç åçš„æ•°æ® password: MWYyZDFlMmU2N2Rm username: YWRtaW4= kubectl create -f mysecret.yaml kubectl describe secret mysecret secretç¯å¢ƒå˜é‡apiVersion: apps/v1kind: Deploymentmetadata: labels: app: opaque-secret-env name: opaque-secret-env-deployspec: replicas: 5 selector: matchLabels: app: op-se-env-pod template: metadata: labels: app: op-se-env-pod spec: containers: - image: wangyanglinux/myapp:v1.0 name: myapp-continaer ports: - containerPort: 80 env: - name: TEST_USER valueFrom: secretKeyRef: name: mysecret key: username - name: TEST_PASSWORD valueFrom: secretKeyRef: name: mysecret key: password å®¹å™¨ä¸­ä¼šå°†ç¼–ç åçš„ mysecret è§£ç ã€‚ æŒ‚è½½ secretapiVersion: v1kind: Podmetadata: labels: name: secret-volume name: secret-volume-podspec: volumes: - name: volumes12 secret: secretName: mysecret containers: - image: wangyanglinux/myapp:v1.0 name: myapp-container volumeMounts: - name: volumes12 mountPath: /data è®¾ç½®æŒ‚è½½ç›®å½•æƒé™apiVersion: v1kind: Podmetadata: labels: name: secret-volume name: secret-volume-podspec: volumes: - name: volumes12 secret: secretName: mysecret defaultMode: 256 containers: - image: wangyanglinux/myapp:v1.0 name: myapp-container volumeMounts: - name: volumes12 mountPath: /data æŒ‚è½½å•ä¸ªkeyapiVersion: v1kind: Podmetadata: labels: name: secret-volume name: secret-volume-podspec: volumes: - name: volumes12 secret: secretName: mysecret items: - key: username path: my-group/my-username containers: - image: wangyanglinux/myapp:v1.0 name: myapp-container volumeMounts: - name: volumes12 mountPath: /data å•ç‹¬æŒ‚è½½éƒ¨åˆ† secret æ•°æ®ä¸æ”¯æŒçƒ­æ›´æ–° Secret çƒ­æ›´æ–°å½“å·ä¸­å­˜å‚¨å¹¶æ­£åœ¨ä½¿ç”¨çš„ Secret è¢«æ›´æ–°æ—¶ï¼Œâ€Œæ˜ å°„çš„é”®ä¹Ÿä¼šéšä¹‹æ›´æ–°â€Œã€‚è¿™ä¸€è¿‡ç¨‹ç”±ç»„ä»¶ kubelet è´Ÿè´£ç›‘æ§ï¼Œå®ƒä¼šâ€Œå‘¨æœŸæ€§åŒæ­¥å¹¶æ£€æŸ¥æŒ‚è½½çš„ Secret æ˜¯å¦ä¸ºæœ€æ–°ç‰ˆæœ¬â€Œã€‚ä½†å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œkubelet åœ¨æ£€æŸ¥è¿‡ç¨‹ä¸­ï¼Œâ€Œä¼šä½¿ç”¨å…¶æœ¬åœ°ç¼“å­˜çš„æ•°å€¼ä½œä¸º Secret çš„å½“å‰å€¼â€Œã€‚æ­¤å¤–ï¼Œå¦‚æœå®¹å™¨æ˜¯é€šè¿‡ Secret ä½œä¸ºå­è·¯å¾„å·æŒ‚è½½çš„ï¼Œâ€Œé‚£ä¹ˆè¯¥å®¹å™¨å°†ä¸ä¼šæ”¶åˆ° Secret æ›´æ–°çš„é€šçŸ¥â€Œã€‚ âŒ å­è·¯å¾„æŒ‚è½½ï¼ˆæ— è‡ªåŠ¨æ›´æ–°ï¼‰ï¼š volumeMounts: - name: secret-vol mountPath: /etc/ssl/private.key # ç›®æ ‡æ–‡ä»¶è·¯å¾„ subPath: private.key # ä»…ç»‘å®šæ­¤é”®å€¼ æ›´æ–° Secret åï¼Œå®¹å™¨å†…æ–‡ä»¶ä¿æŒä¸å˜ã€‚ âœ… å®Œæ•´å·æŒ‚è½½ï¼ˆæ”¯æŒçƒ­æ›´æ–°ï¼‰ï¼š volumeMounts: - name: secret-vol mountPath: /etc/ssl # æŒ‚è½½æ•´ä¸ªå· Secret æ›´æ–°åï¼Œkubelet ä¼šè‡ªåŠ¨åŒæ­¥åˆ° /etc/ssl ç›®å½•ä¸‹ã€‚ apiVersion: v1kind: Secretmetadata: name: mysecrettype: Opaquedata: # éœ€è¦ä½¿ç”¨ base64 ç¼–ç åçš„æ•°æ® password: MWYyZDFlMmU2N2Rm username: YWRtaW4=---apiVersion: v1kind: Podmetadata: labels: name: secret-volume name: secret-volume-podspec: volumes: - name: volumes12 secret: secretName: mysecret containers: - image: wangyanglinux/myapp:v1.0 name: myapp-container volumeMounts: - name: volumes12 mountPath: /data kubectl create -f secret-volume-pod-1.yaml kubectl exec -it secret-volume-pod bin/bashkubectl edit secret mysecret ä¸å¯å˜ apiVersion: v1kind: Secretmetadata: name: mysecret-1type: Opaqueimmutable: truedata: # éœ€è¦ä½¿ç”¨ base64 ç¼–ç åçš„æ•°æ® password: MWYyZDFlMmU2N2Rm username: YWRtaW4= Downward APIDownward API æ˜¯ Kubernetes æä¾›çš„ä¸€ç§æœºåˆ¶ï¼Œå…è®¸å®¹å™¨åœ¨ä¸ç›´æ¥è°ƒç”¨ Kubernetes API çš„æƒ…å†µä¸‹è·å–è‡ªèº«æˆ–é›†ç¾¤çš„å…ƒæ•°æ®ã€‚å®ƒé€šè¿‡ä¸¤ç§æ–¹å¼å°† Pod å’Œå®¹å™¨çš„å­—æ®µæš´éœ²ç»™è¿è¡Œä¸­çš„å®¹å™¨ï¼šâ€Œç¯å¢ƒå˜é‡â€Œå’Œâ€Œæ–‡ä»¶æŒ‚è½½â€Œï¼ˆé€šè¿‡ç‰¹æ®Šå·ç±»å‹ï¼‰ã€‚ â€Œæ ¸å¿ƒåŠŸèƒ½ â€Œå…ƒæ•°æ®æ³¨å…¥â€Œ æ”¯æŒæ³¨å…¥ Pod åç§°ã€å‘½åç©ºé—´ã€æ ‡ç­¾ã€æ³¨è§£ã€èµ„æºè¯·æ±‚é™åˆ¶ç­‰å­—æ®µã€‚ ä¾‹å¦‚ï¼Œå°† Pod åç§°é€šè¿‡ç¯å¢ƒå˜é‡ POD_NAME ä¼ é€’ç»™å®¹å™¨ï¼Œä¾›åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚ â€ŒåŠ¨æ€é…ç½®â€Œ åº”ç”¨ç¨‹åºå¯æ ¹æ®è¿è¡Œæ—¶ä¿¡æ¯ï¼ˆå¦‚èŠ‚ç‚¹ CPU æ•°é‡æˆ–å†…å­˜é™åˆ¶ï¼‰è°ƒæ•´è¡Œä¸ºã€‚ä¾‹å¦‚ï¼ŒNginx å¯é€šè¿‡ Downward API è·å–çœŸå® CPU æ ¸å¿ƒæ•°ï¼ŒåŠ¨æ€è®¾ç½® worker_processes å‚æ•°ã€‚ â€Œä½è€¦åˆè®¾è®¡â€Œ é¿å…åœ¨å®¹å™¨å†…ç¡¬ç¼–ç  Kubernetes ä¾èµ–ï¼Œæå‡åº”ç”¨çš„å¯ç§»æ¤æ€§ã€‚ â€Œå®ç°æ–¹å¼ â€Œæ–¹å¼â€Œ â€Œé€‚ç”¨åœºæ™¯â€Œ â€Œç¤ºä¾‹å­—æ®µâ€Œ â€Œç¯å¢ƒå˜é‡â€Œ æ³¨å…¥å•ä¸ªå˜é‡ï¼ˆå¦‚ Pod IPï¼‰ metadata.nameã€status.podIP â€Œæ–‡ä»¶æŒ‚è½½â€Œ æ³¨å…¥å¤æ‚æ•°æ®ï¼ˆå¦‚æ ‡ç­¾æˆ–æ³¨è§£ï¼‰ metadata.labelsã€metadata.annotations â€Œæ³¨æ„â€Œï¼šå¹¶éæ‰€æœ‰å­—æ®µéƒ½æ”¯æŒä¸¤ç§æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œspec.nodeName ä»…æ”¯æŒç¯å¢ƒå˜é‡æ³¨å…¥ã€‚ â€Œå…¸å‹åº”ç”¨åœºæ™¯ â€Œèµ„æºæ„ŸçŸ¥â€Œå®¹å™¨é€šè¿‡ requests.cpu æˆ– limits.memory è·å–èµ„æºé™åˆ¶ï¼Œä¼˜åŒ–çº¿ç¨‹æˆ–å†…å­˜åˆ†é…ã€‚ â€Œæ ‡è¯†ä¼ é€’â€Œä½¿ç”¨ metadata.uid æˆ– metadata.labels ä½œä¸ºåº”ç”¨å”¯ä¸€æ ‡è¯†ç¬¦ã€‚ â€Œç¯å¢ƒé›†æˆâ€Œç»“åˆ ConfigMap æˆ– Secretï¼Œå®ç°é…ç½®çš„åŠ¨æ€åŠ è½½ã€‚ â€Œä¸ ConfigMapSecret çš„åŒºåˆ« Downward API â€Œç›´æ¥æš´éœ² Pod è‡ªèº«å…ƒæ•°æ®â€Œï¼Œè€Œ ConfigMapSecret ç”¨äºå¤–éƒ¨é…ç½®ç®¡ç†ã€‚ æ— éœ€é¢„å…ˆå®šä¹‰èµ„æºï¼Œç›´æ¥åœ¨ Pod é…ç½®ä¸­å¼•ç”¨å³å¯ã€‚ é€šè¿‡ Downward APIï¼ŒKubernetes å®ç°äº†å®¹å™¨ä¸é›†ç¾¤ç¯å¢ƒçš„æ— ç¼é›†æˆï¼ŒåŒæ—¶ä¿æŒäº†åº”ç”¨çš„è½»é‡æ€§å’Œå¯ç§»æ¤æ€§ã€‚ Downward API å®éªŒDownward API ç¯å¢ƒå˜é‡apiVersion: v1kind: Podmetadata: name: downward-api-env-examplespec: containers: - name: my-container image: wangyanglinux/myapp:v1.0 env: - name: POD_NAME valueFrom: fieldRef: fieldPath: metadata.name - name: POD_NAMESPACE valueFrom: fieldRef: fieldPath: metadata.namespace - name: POD_IP valueFrom: fieldRef: fieldPath: status.podIP - name: CPU_REQUEST valueFrom: resourceFieldRef: resource: requests.cpu - name: CPU_LIMIT valueFrom: resourceFieldRef: resource: limits.cpu - name: MEMORY_REQUEST valueFrom: resourceFieldRef: resource: requests.memory - name: MEMORY_LIMIT valueFrom: resourceFieldRef: resource: limits.memory restartPolicy: Never kubectl create -f downward-api-env-example.yaml kubectl get pod -o widekubectl exec -it downward-api-env-example bin/bash Downward API æŒ‚è½½é…ç½®apiVersion: v1kind: Podmetadata: name: downward-api-volume-examplespec: containers: - name: my-container image: wangyanglinux/myapp:v1.0 resources: limits: cpu: 1 memory: 512Mi requests: cpu: 0.5 memory: 256Mi volumeMounts: - name: downward-api-volume mountPath: /etc/podinfo volumes: - name: downward-api-volume downwardAPI: items: - path: annotations fieldRef: fieldPath: metadata.annotations - path: labels fieldRef: fieldPath: metadata.labels - path: name fieldRef: fieldPath: metadata.name - path: namespace fieldRef: fieldPath: metadata.namespace - path: uid fieldRef: fieldPath: metadata.uid - path: cpuRequest resourceFieldRef: containerName: my-container resource: requests.cpu - path: memoryRequest resourceFieldRef: containerName: my-container resource: requests.memory - path: cpuLimit resourceFieldRef: containerName: my-container resource: limits.cpu - path: memoryLimit resourceFieldRef: containerName: my-container resource: limits.memory restartPolicy: Never # æ”¯æŒçƒ­æ›´æ–°kubectl label pod downward-api-volume-example domain=www.gaga.com VolumeVolume çš„æ ¸å¿ƒä½œç”¨ â€Œæ•°æ®æŒä¹…åŒ–â€Œå½“ Pod è¢«é”€æ¯é‡å»ºæ—¶ï¼ŒVolume å¯ä¿ç•™å®¹å™¨äº§ç”Ÿçš„æ•°æ®ï¼ˆå¦‚æ•°æ®åº“æ–‡ä»¶ï¼‰ï¼Œé¿å…æ•°æ®ä¸¢å¤±â€Œã€‚ â€Œå®¹å™¨é—´æ•°æ®å…±äº«â€ŒåŒä¸€ Pod å†…çš„å¤šä¸ªå®¹å™¨å¯é€šè¿‡ Volume å…±äº«ç›®å½•ï¼ˆå¦‚ web æœåŠ¡ä¸æ—¥å¿—æ”¶é›†å™¨å…±äº«æ—¥å¿—è·¯å¾„ï¼‰â€Œã€‚ â€Œé…ç½®æ³¨å…¥â€Œå°† ConfigMapSecret ä»¥æ–‡ä»¶å½¢å¼æŒ‚è½½åˆ°å®¹å™¨å†…ï¼Œå®ç°é…ç½®åŠ¨æ€åŠ è½½â€Œã€‚ Volume çš„ä¸»è¦ç±»å‹åŠç‰¹æ€§ ç±»å‹ é€‚ç”¨åœºæ™¯ ç”Ÿå‘½å‘¨æœŸ emptyDir ä¸´æ—¶ç¼“å­˜ã€ä¸­é—´è®¡ç®—ç»“æœ ä¸ Pod å…±å­˜äº¡â€Œ hostPath å®¿ä¸»æœºç›®å½•æ˜ å°„ï¼ˆè°ƒè¯•åœºæ™¯ï¼‰ ä¾èµ–èŠ‚ç‚¹æŒä¹…åŒ–â€Œ emptyDirâ€Œå½“Podè¢«åˆ†é…ç»™èŠ‚ç‚¹æ—¶ï¼Œä¼šåˆ›å»ºemptyDirå·çš„ç›¸å…³ä¿¡æ¯å¦‚ä¸‹â€Œï¼š â€Œåˆ›å»ºä¸å­˜åœ¨â€Œï¼šPodè¢«åˆ†é…è‡³èŠ‚ç‚¹æ—¶ï¼Œä¼šé¦–å…ˆåˆ›å»ºemptyDirå·ã€‚åªè¦Podåœ¨è¯¥èŠ‚ç‚¹è¿è¡Œï¼Œè¯¥å·å°±ä¼šæŒç»­å­˜åœ¨ã€‚ â€Œæ•°æ®äº¤äº’â€Œï¼šPodä¸­çš„å®¹å™¨å¯ä»¥è¯»å–å’Œå†™å…¥emptyDirå·ä¸­çš„æ–‡ä»¶ï¼Œä¸”è¯¥å·å¯ä»¥æŒ‚è½½åˆ°æ¯ä¸ªå®¹å™¨ä¸­çš„ç›¸åŒæˆ–ä¸åŒè·¯å¾„ã€‚ â€Œæ•°æ®å®‰å…¨æ€§â€Œï¼šè‹¥å®¹å™¨å´©æºƒï¼ŒPodä¸ä¼šè¢«ç§»é™¤ï¼Œå› æ­¤emptyDirå·ä¸­çš„æ•°æ®åœ¨å®¹å™¨å´©æºƒæ—¶ä»ç„¶æ˜¯å®‰å…¨çš„ã€‚ â€Œæ•°æ®åˆ é™¤â€Œï¼šå½“Podä»èŠ‚ç‚¹ä¸­åˆ é™¤æ—¶ï¼ŒemptyDirå·ä¸­çš„æ•°æ®å°†è¢«æ°¸ä¹…åˆ é™¤ã€‚ â€Œåº”ç”¨åœºæ™¯â€Œï¼šemptyDirå¯ç”¨ä½œæš‚å­˜ç©ºé—´ï¼Œå¦‚åŸºäºç£ç›˜çš„åˆå¹¶æ’åºæˆ–é•¿æ—¶é—´è®¡ç®—å´©æºƒæ¢å¤æ—¶çš„æ£€æŸ¥ç‚¹ï¼›ä¹Ÿå¯åœ¨WebæœåŠ¡å™¨å®¹å™¨æä¾›æ•°æ®æ—¶ï¼Œä¿å­˜å†…å®¹ç®¡ç†å™¨å®¹å™¨æå–çš„æ–‡ä»¶ã€‚ apiVersion: v1kind: Podmetadata: name: volume-emptydir-disk-pod namespace: defaultspec: containers: - name: myapp image: wangyanglinux/myapp:v1.0 ports: - containerPort: 80 volumeMounts: - name: logs-volume mountPath: /usr/local/nginx/logs - name: busybox image: wangyanglinux/tools:busybox command: [/bin/sh,-c,touch /logs/access.log tail -f /logs/access.log] volumeMounts: - name: logs-volume mountPath: /logs volumes: - name: logs-volume emptyDir: - è¿™ä¸ª Pod åŒ…å«ä¸¤ä¸ªå®¹å™¨ (`myapp` å’Œ `busybox`)ï¼Œå®ƒä»¬å…±äº«åŒä¸€ä¸ªå­˜å‚¨å· `logs-volume`ã€‚- `busybox` å®¹å™¨ä¼šåœ¨æŒ‚è½½è·¯å¾„ `/logs` ä¸‹åˆ›å»ºä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ `access.log`ï¼Œå¹¶æŒç»­è¾“å‡ºè¯¥æ–‡ä»¶çš„å†…å®¹ã€‚- `myapp` å®¹å™¨åˆ™å°† `logs-volume` æŒ‚è½½åˆ°äº† `/usr/local/nginx/logs`ï¼Œå¯ä»¥è®¿é—® `busybox` å®¹å™¨ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶ã€‚ â€Œkubeletå·¥ä½œç›®å½•â€Œï¼škubeletçš„å·¥ä½œç›®å½•ç”±root-dirå‚æ•°æ§åˆ¶ï¼Œé»˜è®¤è·¯å¾„ä¸ºvarlibkubeletã€‚ â€ŒemptyDirå­˜å‚¨æœºåˆ¶â€Œï¼šå¯¹äºæ¯ä¸ªä½¿ç”¨äº† emptyDir: çš„podï¼Œkubeletä¼šåœ¨å…¶å·¥ä½œç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªä¸“å±ç›®å½•ï¼Œæ ¼å¼å¦‚varlibkubeletpods{podid}volumeskubernetes.io~empty-dirã€‚ â€Œæ•°æ®å­˜å‚¨ä½ç½®â€Œï¼šæ‰€æœ‰æ”¾åœ¨emptyDirå·ä¸­çš„æ•°æ®ï¼Œæœ€ç»ˆéƒ½ä¼šå­˜å‚¨åœ¨nodeèŠ‚ç‚¹çš„ä¸Šè¿°æŒ‡å®šè·¯å¾„ä¸­ã€‚ kubectl get pod -o widekubectl get pod volume-emptydir-disk-pod -o yaml# åˆ‡æ¢åˆ° node2 èŠ‚ç‚¹yum install treecd /var/lib/kubelet/pods/5825bf00-5823-45ee-9490-b110b0520587/volumestree kubernetes.io~empty-dir/ å…±äº«å†…å­˜apiVersion: v1kind: Podmetadata: name: volume-emptydir-mem namespace: defaultspec: containers: - name: myapp image: wangyanglinux/myapp:v1.0 ports: - containerPort: 80 resources: limits: cpu: 1 memory: 1024Mi requests: cpu: 1 memory: 1024Mi volumeMounts: - name: mem-volume mountPath: /data volumes: - name: mem-volume emptyDir: medium: Memory sizeLimit: 500Mi ğŸ“Œ å®é™…ç”¨é€” é«˜é€Ÿç¼“å­˜ é€‚ç”¨äºéœ€è¦å¿«é€Ÿè¯»å†™çš„æ•°æ®ï¼Œå¦‚ä¸­é—´è®¡ç®—ç»“æœã€ç¼“å­˜æ—¥å¿—ç­‰ã€‚ å› ä¸ºä½¿ç”¨å†…å­˜ï¼Œæ€§èƒ½è¿œé«˜äºç£ç›˜å·ã€‚ è·¨å®¹å™¨å…±äº«æ•°æ® åŒä¸€ Pod ä¸­çš„å¤šä¸ªå®¹å™¨å¯ä»¥é€šè¿‡æŒ‚è½½åŒä¸€ä¸ª emptyDir å·è¿›è¡Œé€šä¿¡æˆ–æ•°æ®å…±äº«ã€‚ ç¤ºä¾‹ä¸­è™½åªæœ‰ä¸€ä¸ªå®¹å™¨ï¼Œä½†å¯æ‰©å±•ä¸ºå¤šå®¹å™¨åä½œåœºæ™¯ã€‚ ä¸´æ—¶æ–‡ä»¶å¤„ç† å¦‚å›¾ç‰‡å¤„ç†ã€å‹ç¼©åŒ…è§£å‹ç­‰æ“ä½œï¼Œå®Œæˆåå³å¯åˆ é™¤ï¼Œæ— éœ€æŒä¹…åŒ–ã€‚ âš ï¸ æ³¨æ„äº‹é¡¹ æ˜“å¤±æ€§ï¼šPod è¢«åˆ é™¤æˆ–é‡å¯æ—¶ï¼ŒemptyDir æ•°æ®å°†æ°¸ä¹…ä¸¢å¤±ã€‚ èµ„æºç«äº‰ï¼šç”±äºä½¿ç”¨å†…å­˜ï¼Œéœ€åˆç†é…ç½® sizeLimit å’Œå®¹å™¨å†…å­˜è¯·æ±‚é™åˆ¶ï¼Œé¿å… OOMï¼ˆOut of Memoryï¼‰ã€‚ é€‚åˆåœºæ™¯ï¼šä»…é€‚ç”¨äºæ— çŠ¶æ€ã€å¯¹æ€§èƒ½è¦æ±‚é«˜ã€ä¸ä¾èµ–æŒä¹…åŒ–çš„ä»»åŠ¡ã€‚ hostPathhostPathæ˜¯Kubernetesä¸­ä¸€ç§ç‰¹æ®Šçš„å­˜å‚¨å·ç±»å‹ï¼Œå®ƒå…è®¸å°†å®¿ä¸»æœºèŠ‚ç‚¹ä¸Šçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ç›´æ¥æŒ‚è½½åˆ°Podä¸­ã€‚ åŸºæœ¬æ¦‚å¿µä¸æ ¸å¿ƒç‰¹æ€§hostPathå·çš„ä¸»è¦åŠŸèƒ½æ˜¯å°†å·¥ä½œèŠ‚ç‚¹(å®¿ä¸»æœº)ä¸Šçš„ç‰¹å®šç›®å½•æˆ–æ–‡ä»¶æŒ‚è½½åˆ°Podå®¹å™¨å†…éƒ¨ï¼Œä½¿å®¹å™¨èƒ½å¤Ÿç›´æ¥è¯»å†™å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿâ€Œã€‚ä¸emptyDirç­‰ä¸´æ—¶å­˜å‚¨ä¸åŒï¼ŒhostPathå…·æœ‰ä»¥ä¸‹å…³é”®ç‰¹æ€§ï¼š â€ŒèŠ‚ç‚¹çº§æŒä¹…åŒ–â€Œï¼šæ•°æ®ç”Ÿå‘½å‘¨æœŸä¸èŠ‚ç‚¹è€ŒéPodç»‘å®šï¼Œå³ä½¿Podè¢«åˆ é™¤ï¼Œåªè¦æ–°Podè°ƒåº¦åˆ°åŒä¸€èŠ‚ç‚¹ï¼Œæ•°æ®ä»ç„¶å¯ç”¨â€Œã€‚è¿™ç§ç‰¹æ€§ä½¿å…¶æˆä¸ºæœ€ç®€å•çš„èŠ‚ç‚¹çº§æŒä¹…åŒ–æ–¹æ¡ˆã€‚ â€Œç›´æ¥æ–‡ä»¶ç³»ç»Ÿè®¿é—®â€Œï¼šå®¹å™¨è·å¾—å¯¹å®¿ä¸»æœºæŒ‡å®šè·¯å¾„çš„å®Œå…¨è®¿é—®æƒé™ï¼Œå¯ä»¥è¯»å–æˆ–ä¿®æ”¹èŠ‚ç‚¹ç³»ç»Ÿæ–‡ä»¶(å–å†³äºé…ç½®)â€Œã€‚è¿™ç§èƒ½åŠ›ä½¿å…¶æˆä¸ºç³»ç»Ÿçº§å·¥å…·çš„ç†æƒ³é€‰æ‹©ã€‚ â€ŒèŠ‚ç‚¹äº²å’Œæ€§ä¾èµ–â€Œï¼šç”±äºæ•°æ®å­˜å‚¨åœ¨ç‰¹å®šèŠ‚ç‚¹ä¸Šï¼Œä½¿ç”¨hostPathçš„Podé€šå¸¸éœ€è¦é…ç½®èŠ‚ç‚¹äº²å’Œæ€§è§„åˆ™ï¼Œç¡®ä¿æ€»æ˜¯è°ƒåº¦åˆ°åŒ…å«æ‰€éœ€æ•°æ®çš„èŠ‚ç‚¹â€Œã€‚ å…¸å‹åº”ç”¨åœºæ™¯hostPathç‰¹åˆ«é€‚åˆä»¥ä¸‹ç‰¹å®šéœ€æ±‚ï¼š â€Œç³»ç»Ÿç›‘æ§ä¸æ—¥å¿—æ”¶é›†â€Œï¼šç›‘æ§ä»£ç†Podéœ€è¦è®¿é—®å®¿ä¸»æœºçš„ç³»ç»Ÿæ—¥å¿—ç›®å½•(å¦‚varlog)æ¥æ”¶é›†èŠ‚ç‚¹çº§æ—¥å¿—ä¿¡æ¯â€Œã€‚è¿™æ˜¯hostPathæœ€å¸¸è§çš„ç”Ÿäº§ç¯å¢ƒç”¨é€”ã€‚ â€Œå¼€å‘è°ƒè¯•å·¥å…·â€Œï¼šå¼€å‘ç¯å¢ƒä¸­ï¼Œå·¥å…·Podå¯èƒ½éœ€è¦è®¿é—®å®¿ä¸»æœºçš„Dockerå¥—æ¥å­—(varrundocker.sock)æˆ–è°ƒè¯•æ¥å£ï¼ŒhostPathä¸ºæ­¤æä¾›äº†ä¾¿åˆ©â€Œã€‚ â€ŒèŠ‚ç‚¹ç‰¹å®šé…ç½®è®¿é—®â€Œï¼šå½“åº”ç”¨éœ€è¦è¯»å–èŠ‚ç‚¹ç‰¹æœ‰çš„é…ç½®æˆ–ç¡¬ä»¶ä¿¡æ¯æ—¶(å¦‚GPUèŠ‚ç‚¹é…ç½®)ï¼ŒhostPathæ˜¯ç›´æ¥æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆâ€Œã€‚ â€Œå•èŠ‚ç‚¹æ•°æ®æŒä¹…åŒ–â€Œï¼šåœ¨å¼€å‘æˆ–æµ‹è¯•ç¯å¢ƒä¸­ï¼Œå•èŠ‚ç‚¹éƒ¨ç½²çš„æ•°æ®åº“æˆ–ç¼“å­˜å¯ä»¥ä½¿ç”¨hostPathä½œä¸ºç®€å•çš„æŒä¹…åŒ–å­˜å‚¨â€Œã€‚ä½†æ­¤ç”¨æ³•ä¸é€‚åˆç”Ÿäº§ç¯å¢ƒã€‚ âš ï¸ hostPath æ³¨æ„äº‹é¡¹ â€ŒPodè¡Œä¸ºå·®å¼‚â€Œï¼šç”±äºæ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„æ–‡ä»¶ä¸åŒï¼Œå…·æœ‰ç›¸åŒé…ç½®çš„Podåœ¨ä¸åŒèŠ‚ç‚¹ä¸Šè¿è¡Œæ—¶ï¼Œå…¶è¡Œä¸ºå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚ â€ŒKubernetesè°ƒåº¦é—®é¢˜â€Œï¼šå½“KubernetesæŒ‰ç…§è®¡åˆ’æ·»åŠ èµ„æºæ„ŸçŸ¥è°ƒåº¦æ—¶ï¼Œå®ƒæ— æ³•è€ƒè™‘hostPathä½¿ç”¨çš„èµ„æºï¼Œè¿™å¯èƒ½å¯¼è‡´èµ„æºåˆ†é…ä¸å‡ã€‚ â€ŒhostPathå†™å…¥æƒé™ï¼šåœ¨åº•å±‚ä¸»æœºä¸Šåˆ›å»ºçš„æ–‡ä»¶æˆ–ç›®å½•é»˜è®¤åªèƒ½ç”±rootç”¨æˆ·å†™å…¥ã€‚è‹¥æƒ³åœ¨hostPathå·ä¸­å†™å…¥æ•°æ®ï¼Œéœ€åœ¨ç‰¹æƒå®¹å™¨ä¸­ä»¥rootèº«ä»½è¿è¡Œè¿›ç¨‹ï¼Œæˆ–ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶æƒé™ã€‚ hostPath ç±»å‹ â€Œå€¼â€Œ â€Œè¡Œä¸ºæè¿°â€Œ â€ŒDirectoryOrCreateâ€Œ è‹¥è·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºç©ºç›®å½•ï¼Œæƒé™è®¾ä¸º0755 â€ŒDirectoryâ€Œ è·¯å¾„ä¸‹å¿…é¡»å·²å­˜åœ¨ç›®å½•ï¼Œå¦åˆ™æ“ä½œå°†å¤±è´¥ â€ŒFileOrCreateâ€Œ è‹¥è·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºç©ºæ–‡ä»¶ï¼Œæƒé™è®¾ä¸º0644 â€ŒFileâ€Œ è·¯å¾„ä¸‹å¿…é¡»å·²å­˜åœ¨æ–‡ä»¶ï¼Œå¦åˆ™æ“ä½œå°†å¤±è´¥ â€ŒSocketâ€Œ è·¯å¾„ä¸‹å¿…é¡»å·²å­˜åœ¨UNIXå¥—æ¥å­— â€ŒCharDeviceâ€Œ è·¯å¾„ä¸‹å¿…é¡»å·²å­˜åœ¨å­—ç¬¦è®¾å¤‡ â€ŒBlockDeviceâ€Œ è·¯å¾„ä¸‹å¿…é¡»å·²å­˜åœ¨å—è®¾å¤‡ hostPath å®éªŒapiVersion: v1kind: Podmetadata: name: hostpath-podspec: containers: - image: wangyanglinux/myapp:v1.0 name: myapp volumeMounts: - mountPath: /test-pd name: test-volume volumes: - name: test-volume hostPath: # directory location on host path: /test # this field is optional type: Directory å½“æ£€æµ‹ /test ç›®å½•ä¸å­˜åœ¨æ—¶ä¸ä¼šæˆåŠŸåˆ›å»º podã€‚ åœ¨ pod è¿è¡Œçš„èŠ‚ç‚¹2ä¸Šåˆ›å»º /test,æ­¤æ—¶ pod èƒ½å¤ŸæˆåŠŸåˆ›å»ºã€‚ # åœ¨èŠ‚ç‚¹2ä¸Šåˆ›å»ºæ–°æ–‡ä»¶ï¼Œå¯ä»¥åœ¨å®¹å™¨ä¸­å…±äº«åˆ°æ­¤æ–‡ä»¶echo gaga /test/index.html# åœ¨ pod å®¹å™¨ä¸­å†™å…¥æ•°æ®åˆ°index.htmlä¸­ï¼ŒèŠ‚ç‚¹2ä¸­æ­¤æ–‡ä»¶ä¹Ÿä¼šå˜åŠ¨kubectl exec -it hostpath-pod /bin/bashcd test-pd/echo nihao index.html PVPVCâ€ŒPVPVC åŸºæœ¬æ¦‚å¿µ â€ŒPVï¼ˆPersistentVolumeï¼‰ç”±é›†ç¾¤ç®¡ç†å‘˜é¢„å…ˆé…ç½®çš„å­˜å‚¨èµ„æºï¼Œä»£è¡¨å®é™…çš„å­˜å‚¨è®¾å¤‡ï¼ˆå¦‚NFSã€äº‘å­˜å‚¨ç­‰ï¼‰ï¼Œå…·æœ‰ç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸâ€Œã€‚ â€ŒPVCï¼ˆPersistentVolumeClaimï¼‰ç”¨æˆ·å¯¹å­˜å‚¨èµ„æºçš„è¯·æ±‚ï¼Œé€šè¿‡ PVC å£°æ˜æ‰€éœ€çš„å­˜å‚¨å¤§å°å’Œè®¿é—®æ¨¡å¼ï¼ŒKubernetesä¼šä¸ºå…¶åŒ¹é…ç¬¦åˆæ¡ä»¶çš„PVâ€Œã€‚ é€šè¿‡PVPVCçš„æŠ½è±¡å±‚ï¼ŒKuberneteså®ç°äº†å­˜å‚¨èµ„æºä¸åº”ç”¨çš„è§£è€¦ï¼Œæ”¯æŒçµæ´»çš„åŠ¨æ€å­˜å‚¨ç®¡ç†â€Œã€‚ â€Œæ ¸å¿ƒç‰¹æ€§å¯¹æ¯” â€Œç‰¹æ€§â€Œ â€ŒPVâ€Œ â€ŒPVCâ€Œ â€Œåˆ›å»ºè€…â€Œ ç®¡ç†å‘˜æ‰‹åŠ¨æˆ–åŠ¨æ€åˆ¶å¤‡ï¼ˆStorageClassï¼‰â€Œ ç”¨æˆ·æŒ‰éœ€å£°æ˜â€Œ â€Œç»‘å®šå…³ç³»â€Œ ä¸PVCä¸€å¯¹ä¸€ç»‘å®šâ€Œ ç»‘å®šåç‹¬å PVèµ„æºâ€Œ â€Œç”Ÿå‘½å‘¨æœŸâ€Œ ç‹¬ç«‹äºPodå­˜åœ¨â€Œ éšPodåˆ é™¤å¯ä¿ç•™æˆ–é‡Šæ”¾ï¼ˆå–å†³äºå›æ”¶ç­–ç•¥ï¼‰â€Œ å…³é”®é…ç½®å‚æ•° â€ŒPVPVCçš„è®¿é—®æ¨¡å¼ ReadWriteOnceï¼ˆå•èŠ‚ç‚¹è¯»å†™ï¼‰ ReadOnlyManyï¼ˆå¤šèŠ‚ç‚¹åªè¯»ï¼‰ ReadWriteManyï¼ˆå¤šèŠ‚ç‚¹è¯»å†™ï¼‰â€Œ â€ŒPVå›æ”¶ç­–ç•¥ Retainï¼ˆä¿ç•™ï¼Œæ‰‹åŠ¨æ¸…ç†ï¼‰ Deleteï¼ˆè‡ªåŠ¨åˆ é™¤å­˜å‚¨ï¼‰ Recycleï¼ˆå·²åºŸå¼ƒï¼Œç”±åŠ¨æ€åˆ¶å¤‡æ›¿ä»£ï¼‰â€Œ PVPVCçŠ¶æ€ Availableï¼ˆå¯ç”¨ï¼‰ï¼šè¡¨ç¤ºè¯¥èµ„æºå½“å‰å¤„äºç©ºé—²çŠ¶æ€ï¼Œæœªè¢«ä»»ä½•å£°æ˜æ‰€ç»‘å®šï¼Œå¯ä¾›ä½¿ç”¨ã€‚ â€ŒBoundï¼ˆå·²ç»‘å®šï¼‰ï¼šæ„å‘³ç€è¯¥å·å·²ç»è¢«æŸä¸ªå£°æ˜ç»‘å®šï¼Œæ­£åœ¨è¢«ä½¿ç”¨ä¸­ã€‚ Releasedï¼ˆå·²é‡Šæ”¾ï¼‰ï¼šå£°æ˜å·²è¢«åˆ é™¤ï¼Œä½†èµ„æºå°šæœªè¢«é›†ç¾¤é‡æ–°å£°æ˜ï¼Œå¤„äºä¸­é—´çŠ¶æ€ï¼Œç­‰å¾…è¢«é‡æ–°åˆ†é…ã€‚ â€ŒFailedï¼ˆå¤±è´¥ï¼‰ï¼šæŒ‡è¯¥å·çš„è‡ªåŠ¨å›æ”¶è¿‡ç¨‹å¤±è´¥ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨å¤„ç†æˆ–æ£€æŸ¥é”™è¯¯åŸå› ã€‚ PVCä¿æŠ¤PVCä¿æŠ¤çš„ä¸»è¦ä½œç”¨æ˜¯â€Œç¡®ä¿æ­£åœ¨è¢«Podä½¿ç”¨çš„PVCä¸ä¼šè¢«ä»ç³»ç»Ÿä¸­ç§»é™¤â€Œï¼Œä»è€Œé˜²æ­¢å¯èƒ½å› æ­¤å¯¼è‡´çš„æ•°æ®ä¸¢å¤±ã€‚å…·ä½“æœºåˆ¶å¦‚ä¸‹ï¼š â€Œæ´»åŠ¨çŠ¶æ€åˆ¤å®šâ€Œï¼šå½“PodçŠ¶æ€ä¸ºPendingï¼ˆç­‰å¾…ä¸­ï¼‰ä¸”å·²åˆ†é…ç»™èŠ‚ç‚¹ï¼Œæˆ–Podä¸ºRunningï¼ˆè¿è¡Œä¸­ï¼‰çŠ¶æ€æ—¶ï¼Œç›¸å…³çš„PVCè¢«è§†ä¸ºå¤„äºæ´»åŠ¨çŠ¶æ€ã€‚ â€Œä¿æŠ¤æœºåˆ¶â€Œï¼šä¸€æ—¦å¯ç”¨äº†PVCä¿æŠ¤åŠŸèƒ½ï¼Œè‹¥ç”¨æˆ·å°è¯•åˆ é™¤ä¸€ä¸ªæ­£åœ¨è¢«Podä½¿ç”¨çš„PVCï¼Œè¯¥PVCä¸ä¼šè¢«ç«‹å³åˆ é™¤ã€‚â€Œåˆ é™¤æ“ä½œå°†è¢«æ¨è¿Ÿâ€Œï¼Œç›´è‡³è¯¥PVCä¸å†è¢«ä»»ä½•Podä½¿ç”¨ä¸ºæ­¢ã€‚ è¿™æ ·ï¼ŒPVCä¿æŠ¤æœºåˆ¶æœ‰æ•ˆä¿éšœäº†æ•°æ®çš„å®‰å…¨æ€§å’ŒæŒç»­æ€§ã€‚ PVCé€‰æ‹©PVæœºåˆ¶â€Œ1. åŸºç¡€åŒ¹é…è§„åˆ™â€Œ â€Œå®¹é‡ä¼˜å…ˆâ€Œï¼šPVCä¼šä¼˜å…ˆé€‰æ‹©â€Œå®¹é‡â‰¥è¯·æ±‚å€¼ä¸”å·®å€¼æœ€å°â€Œçš„PVï¼ˆå¦‚PVCè¯·æ±‚1Giï¼Œå­˜åœ¨1Giå’Œ2Giçš„PVæ—¶ä¼˜å…ˆç»‘å®š1Giï¼‰â€Œã€‚ â€Œè®¿é—®æ¨¡å¼â€Œï¼šPVå¿…é¡»æ”¯æŒPVCå£°æ˜çš„è®¿é—®æ¨¡å¼ï¼ˆå¦‚ReadWriteOnceReadWriteManyï¼‰â€Œã€‚ â€ŒStorageClassåŒ¹é…â€Œï¼šè‹¥PVCæŒ‡å®šäº†storageClassNameï¼Œåˆ™ä»…åŒ¹é…åŒç±»çš„PVï¼›æœªæŒ‡å®šæ—¶ä»…åŒ¹é…æœªè®¾ç½®StorageClassçš„PVâ€Œã€‚ â€Œ2. é«˜çº§é€‰æ‹©æœºåˆ¶â€Œ â€Œæ ‡ç­¾é€‰æ‹©å™¨ï¼ˆLabel Selectorï¼‰PVCå¯é€šè¿‡ spec.selector åŒ¹é…PVçš„æ ‡ç­¾ï¼Œå®ç°ç²¾ç»†åŒ–ç­›é€‰ï¼ˆå¦‚é€‰æ‹©ç‰¹å®šæ€§èƒ½çš„SSDå­˜å‚¨ï¼‰â€Œã€‚ # PVCé…ç½®ç¤ºä¾‹spec: selector: matchLabels: tier: ssd â€Œé™æ€ç»‘å®šï¼ˆvolumeNameï¼‰ç›´æ¥é€šè¿‡spec.volumeNameæŒ‡å®šPVåç§°ï¼Œå¼ºåˆ¶ç»‘å®šç‰¹å®šPVï¼ˆéœ€ç¡®ä¿PVæœªè¢«å ç”¨ï¼‰â€Œã€‚ 3. åŠ¨æ€åŒ¹é…æµç¨‹â€Œ â€Œé™æ€ä¾›åº”â€Œï¼šç®¡ç†å‘˜é¢„å…ˆåˆ›å»ºPVï¼ŒPVCæ ¹æ®ä¸Šè¿°è§„åˆ™è‡ªåŠ¨åŒ¹é…â€Œã€‚ â€ŒåŠ¨æ€ä¾›åº”ï¼šé€šè¿‡StorageClassè‡ªåŠ¨åˆ›å»ºPVå¹¶ç»‘å®šPVCï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„â€Œã€‚ # StorageClassåŠ¨æ€é…ç½®ç¤ºä¾‹provisioner: kubernetes.io/aws-ebsparameters: type: gp2 4. å†²çªå¤„ç†ä¸ä¼˜å…ˆçº§â€Œ â€Œå”¯ä¸€æ€§â€Œï¼š1ä¸ªPVåªèƒ½ç»‘å®š1ä¸ªPVCï¼Œç»‘å®šåçŠ¶æ€å˜ä¸ºBoundâ€Œã€‚ â€Œå¤šPVç«äº‰â€Œï¼šå½“å¤šä¸ªPVæ»¡è¶³æ¡ä»¶æ—¶ï¼ŒKubernetesè°ƒåº¦å™¨æŒ‰â€Œå®¹é‡æœ€æ¥è¿‘â€ŒåŸåˆ™é€‰æ‹©â€Œã€‚ å·¥ä½œæµç¨‹ â€Œé™æ€åˆ¶å¤‡â€Œï¼šç®¡ç†å‘˜é¢„å…ˆåˆ›å»ºPVæ± ï¼ŒPVCé€šè¿‡åŒ¹é…æ¡ä»¶ç»‘å®šå¯ç”¨PVâ€Œã€‚ â€ŒåŠ¨æ€åˆ¶å¤‡â€Œï¼šé€šè¿‡StorageClassè‡ªåŠ¨æŒ‰éœ€åˆ›å»ºPVï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„â€Œã€‚ â€Œç»‘å®šä¸ä½¿ç”¨â€Œï¼šPVCç»‘å®šPVåï¼ŒPodé€šè¿‡volumeMountsæŒ‚è½½PVCå®ç°æ•°æ®æŒä¹…åŒ–â€Œã€‚ â€Œæ³¨æ„äº‹é¡¹ â€Œæœªç»‘å®šçŠ¶æ€â€Œï¼šè‹¥PVCéœ€æ±‚æ— åŒ¹é…PVï¼Œå°†æ— é™æœŸç­‰å¾…ç›´è‡³æ»¡è¶³æ¡ä»¶â€Œã€‚ â€Œå®‰å…¨é™åˆ¶â€Œï¼šPVçš„hostPathç±»å‹éœ€è°¨æ…é…ç½®è·¯å¾„æƒé™ï¼ˆå¦‚DirectoryOrCreateFileOrCreateï¼‰â€Œã€‚ PVPVCå®éªŒ1.å®‰è£…NFSæœåŠ¡å™¨ # 3ä¸ªèŠ‚ç‚¹æ‰§è¡Œyum install -y nfs-utils rpcbind# ä»¥node1èŠ‚ç‚¹ä¸ºnfsæœåŠ¡ï¼Œåœ¨node1èŠ‚ç‚¹æ‰§è¡Œä¸‹åˆ—å‘½ä»¤mkdir /nfsdatachmod 666 /nfsdatachown nobody /nfsdatacd /nfsdata/mkdir 1..10echo 1 1/index.htmlecho 2 2/index.htmlecho 3 3/index.htmlecho 4 4/index.htmlecho 5 5/index.htmlecho 6 6/index.htmlecho 7 7/index.htmlecho 8 8/index.htmlecho 9 9/index.htmlecho 10 10/index.htmlecho /nfsdata/1 *(rw,no_root_squash,no_all_squash,sync) /etc/exportsecho /nfsdata/2 *(rw,no_root_squash,no_all_squash,sync) /etc/exportsecho /nfsdata/3 *(rw,no_root_squash,no_all_squash,sync) /etc/exportsecho /nfsdata/4 *(rw,no_root_squash,no_all_squash,sync) /etc/exportsecho /nfsdata/5 *(rw,no_root_squash,no_all_squash,sync) /etc/exportsecho /nfsdata/6 *(rw,no_root_squash,no_all_squash,sync) /etc/exportsecho /nfsdata/7 *(rw,no_root_squash,no_all_squash,sync) /etc/exportsecho /nfsdata/8 *(rw,no_root_squash,no_all_squash,sync) /etc/exportsecho /nfsdata/9 *(rw,no_root_squash,no_all_squash,sync) /etc/exportsecho /nfsdata/10 *(rw,no_root_squash,no_all_squash,sync) /etc/exportssystemctl start rpcbindsystemctl start nfs-serversystemctl restart rpcbindshowmount -e 10.37.129.10# æµ‹è¯•æŒ‚è½½# åœ¨ node2 èŠ‚ç‚¹æŒ‚è½½nfsmkdir /nfstestmount -t nfs 10.37.129.10:/nfsdata/1 /nfstest/cd /nfstestumount /nfstest/ 2.éƒ¨ç½² PV apiVersion: v1kind: PersistentVolumemetadata: name: nfspv1spec: capacity: storage: 1Gi accessModes: - ReadWriteOnce persistentVolumeReclaimPolicy: Recycle storageClassName: nfs nfs: path: /nfsdata/1 server: 10.37.129.10---apiVersion: v1kind: PersistentVolumemetadata: name: nfspv2spec: capacity: storage: 0.9Gi accessModes: - ReadWriteOnce persistentVolumeReclaimPolicy: Recycle storageClassName: nfs nfs: path: /nfsdata/2 server: 10.37.129.10---apiVersion: v1kind: PersistentVolumemetadata: name: nfspv3spec: capacity: storage: 1.2Gi accessModes: - ReadWriteOnce persistentVolumeReclaimPolicy: Recycle storageClassName: nfs nfs: path: /nfsdata/3 server: 10.37.129.10---apiVersion: v1kind: PersistentVolumemetadata: name: nfspv4spec: capacity: storage: 1Gi accessModes: - ReadWriteOnce persistentVolumeReclaimPolicy: Recycle storageClassName: nfs nfs: path: /nfsdata/4 server: 10.37.129.10---apiVersion: v1kind: PersistentVolumemetadata: name: nfspv5spec: capacity: storage: 1Gi accessModes: - ReadWriteMany persistentVolumeReclaimPolicy: Recycle storageClassName: nfs nfs: path: /nfsdata/5 server: 10.37.129.10---apiVersion: v1kind: PersistentVolumemetadata: name: nfspv6spec: capacity: storage: 1Gi accessModes: - ReadWriteOnce persistentVolumeReclaimPolicy: Recycle storageClassName: nfs1 nfs: path: /nfsdata/6 server: 10.37.129.10---apiVersion: v1kind: PersistentVolumemetadata: name: nfspv7spec: capacity: storage: 1Gi accessModes: - ReadWriteOnce persistentVolumeReclaimPolicy: Retain storageClassName: nfs nfs: path: /nfsdata/7 server: 10.37.129.10 kubectl create -f vp-demo.yaml kubectl get pv 3.åˆ›å»ºæœåŠ¡ä½¿ç”¨PVC apiVersion: v1kind: Servicemetadata: name: nginx labels: app: nginxspec: ports: - port: 80 name: web clusterIP: None selector: app: nginx---apiVersion: apps/v1kind: StatefulSetmetadata: name: webspec: selector: matchLabels: app: nginx serviceName: nginx replicas: 3 template: metadata: labels: app: nginx spec: containers: - name: nginx image: wangyanglinux/myapp:v1.0 ports: - containerPort: 80 name: web volumeMounts: - name: www mountPath: /usr/local/nginx/html volumeClaimTemplates: - metadata: name: www spec: accessModes: [ ReadWriteOnce ] storageClassName: nfs resources: requests: storage: 1Gi é…ç½®è§£æ Serviceéƒ¨åˆ†ï¼ˆHeadless Serviceï¼‰ï¼š apiVersion: v1kind: Servicemetadata: name: nginx labels: app: nginxspec: ports: - port: 80 name: web clusterIP: None # å…³é”®é…ç½®ï¼šå£°æ˜ä¸ºæ— å¤´æœåŠ¡ selector: app: nginx â€Œæ ¸å¿ƒä½œç”¨â€Œï¼šä¸ºStatefulSetæä¾›ç¨³å®šçš„ç½‘ç»œæ ‡è¯†ï¼Œæ¯ä¸ªPodä¼šè·å¾—ç‹¬ç«‹çš„DNSè®°å½•ï¼ˆæ ¼å¼ï¼špod-name.service-name.namespace.svc.cluster.localï¼‰â€Œã€‚ â€Œå…³é”®ç‰¹æ€§ï¼š clusterIP: Noneï¼šè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªHeadless Serviceï¼Œä¸åˆ†é…é›†ç¾¤IPï¼Œç›´æ¥é€šè¿‡Pod IPé€šä¿¡â€Œã€‚ selectorï¼šåŒ¹é…æ ‡ç­¾ä¸ºapp: nginxçš„Podï¼Œä¸StatefulSetçš„Podæ¨¡æ¿ä¸€è‡´â€Œã€‚ StatefulSetéƒ¨åˆ†ï¼š apiVersion: apps/v1kind: StatefulSetmetadata: name: webspec: serviceName: nginx # ç»‘å®šä¸Šè¿°Headless Service replicas: 3 template: metadata: labels: app: nginx spec: containers: - name: nginx image: wangyanglinux/myapp:v1.0 ports: - containerPort: 80 name: web volumeMounts: - name: www mountPath: /usr/local/nginx/html volumeClaimTemplates: # åŠ¨æ€å­˜å‚¨å£°æ˜æ¨¡æ¿ - metadata: name: www spec: accessModes: [ ReadWriteOnce ] storageClassName: nfs resources: requests: storage: 1Gi â€Œæ ¸å¿ƒåŠŸèƒ½â€Œï¼šç®¡ç†æœ‰çŠ¶æ€åº”ç”¨ï¼Œç¡®ä¿Podå…·æœ‰ç¨³å®šçš„æ ‡è¯†å’ŒæŒä¹…åŒ–å­˜å‚¨â€Œã€‚ â€Œå…³é”®é…ç½®ï¼š â€Œæœ‰åºéƒ¨ç½²â€Œï¼šPodæŒ‰é¡ºåºåˆ›å»ºï¼ˆå¦‚web-0ã€web-1ã€web-2ï¼‰ï¼Œé‡å¯ååç§°ä¸å˜â€Œã€‚ â€Œå­˜å‚¨å·æ¨¡æ¿ï¼š volumeClaimTemplatesï¼šä¸ºæ¯ä¸ªPodåŠ¨æ€åˆ›å»ºPVCï¼Œç»‘å®šnfså­˜å‚¨ç±»çš„1Giå·â€Œã€‚ volumeMountsï¼šå°†å·æŒ‚è½½åˆ°å®¹å™¨å†…çš„/usr/local/nginx/htmlè·¯å¾„â€Œã€‚ â€ŒæœåŠ¡ç»‘å®šâ€Œï¼šé€šè¿‡serviceName: nginxå…³è”Headless Serviceï¼Œå®ç°Podé—´ç›´æ¥é€šä¿¡â€Œã€‚ æ•´ä½“åä½œæœºåˆ¶ï¼š â€Œç½‘ç»œæ ‡è¯†â€Œï¼šStatefulSet Podé€šè¿‡Headless Serviceè·å¾—å”¯ä¸€DNSï¼Œå¦‚web-0.nginx.default.svc.cluster.localâ€Œã€‚ â€Œæ•°æ®æŒä¹…åŒ–â€Œï¼šæ¯ä¸ªPodçš„PVCç‹¬ç«‹ç»‘å®šPVï¼Œå³ä½¿Podé‡å»ºæ•°æ®ä»ä¿ç•™â€Œã€‚ kubectl apply -f pvc-demo.yamlkubectl get pod -o widekubectl get pvkubectl get svckubectl get endpointsyum install bind-utils # digï¼ˆDomain Information Groperï¼‰æ˜¯ä¸€ä¸ªç”¨äºâ€ŒDNSæŸ¥è¯¢â€Œçš„å¸¸ç”¨å‘½ä»¤è¡Œå·¥å…·ï¼Œä¸»è¦ç”¨äºè¯Šæ–­å’Œè°ƒè¯•åŸŸåè§£æé—®é¢˜â€Œdig -t A nginx.default.svc.cluster.local. @10.0.0.10 # ä¿®æ”¹æŒ‚è½½çš„index.htmlï¼Œåˆ é™¤podkubectl get pod -o widekubectl exec -it web-0 /bin/bash # ä¿®æ”¹å‰¯æœ¬æ•°ï¼Œæ­¤æ—¶æ»¡è¶³æ¡ä»¶çš„ pv æ•°ä¸è¶³ï¼Œæ‰€ä»¥ä¼šå¡ä½kubectl scale statefulset web --replicas 10 # å½“æˆ‘ä»¬åˆ é™¤pvå¯¹åº”ç»‘å®šçš„pvcæ—¶ï¼Œpvä¼šè¢«é‡Šæ”¾ï¼Œæ­¤æ—¶åˆ›å»ºå…¶ä»–pvcä¸ä¼šç»‘å®šé‡Šæ”¾çš„pvkubectl delete -f pvc-demo.yaml kubectl delete pvc --all # å¯ä»¥åˆ é™¤pvä¸­å¼•ç”¨éƒ¨åˆ†å°†pvçŠ¶æ€ä¿®æ”¹ä¸ºæ´»è·ƒ kubectl edit pv nfspv1 StorageClassâ€ŒStorageClassï¼ˆå­˜å‚¨ç±»ï¼‰æ˜¯Kubernetesä¸­ç”¨äºåŠ¨æ€ç®¡ç†æŒä¹…åŒ–å­˜å‚¨çš„æ ¸å¿ƒå¯¹è±¡â€Œï¼Œå®ƒå®šä¹‰äº†å­˜å‚¨çš„ç±»å‹ã€ä¾›ç»™ç­–ç•¥åŠåç«¯é…ç½®ï¼Œä½¿ç®¡ç†å‘˜èƒ½å¤ŸæŒ‰éœ€è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†æŒä¹…å·ï¼ˆPVï¼‰â€Œã€‚ StorageClassâ€Œ æ ¸å¿ƒåŠŸèƒ½ â€ŒåŠ¨æ€ä¾›ç»™å­˜å‚¨â€Œï¼šæ ¹æ®ç”¨æˆ·æäº¤çš„PVCï¼ˆæŒä¹…å·å£°æ˜ï¼‰è‡ªåŠ¨åˆ›å»ºåŒ¹é…çš„PVï¼Œæ— éœ€æ‰‹åŠ¨é¢„é…ç½®å­˜å‚¨èµ„æºâ€Œã€‚ â€Œå®šä¹‰å­˜å‚¨ç±»å‹â€Œï¼šæ”¯æŒé…ç½®ä¸åŒå­˜å‚¨åç«¯ï¼ˆå¦‚SSDã€HDDã€äº‘å­˜å‚¨ç­‰ï¼‰çš„å‚æ•°ï¼ˆå¦‚æ€§èƒ½ã€å†—ä½™ç­–ç•¥ï¼‰â€Œã€‚ â€Œç”Ÿå‘½å‘¨æœŸç®¡ç†â€Œï¼šé€šè¿‡reclaimPolicyï¼ˆå¦‚Deleteæˆ–Retainï¼‰æ§åˆ¶PVçš„å›æ”¶è¡Œä¸ºâ€Œã€‚ â€Œå…³é”®ç»„æˆ â€ŒProvisionerï¼ˆä¾›åº”è€…ï¼‰ï¼šæŒ‡å®šå­˜å‚¨åç«¯çš„é©±åŠ¨ï¼ˆå¦‚AWS EBSã€NFSã€Cephç­‰ï¼‰ï¼Œè´Ÿè´£å®é™…åˆ›å»ºPVâ€Œã€‚ â€ŒParametersï¼ˆå‚æ•°ï¼‰ï¼šå®šä¹‰å­˜å‚¨åç«¯çš„é…ç½®ï¼ˆå¦‚äº‘å­˜å‚¨çš„åŒºåŸŸã€ç£ç›˜ç±»å‹ï¼‰â€Œã€‚ â€ŒBindingæ¨¡å¼â€Œï¼šæ”¯æŒImmediateï¼ˆç«‹å³ç»‘å®šï¼‰æˆ–WaitForFirstConsumerï¼ˆå»¶è¿Ÿç»‘å®šè‡³Podè°ƒåº¦ï¼‰â€Œã€‚ â€Œä¸PVPVCçš„å…³ç³» â€ŒPVï¼ˆæŒä¹…å·ï¼‰ï¼šç”±StorageClassåŠ¨æ€åˆ›å»ºï¼Œæˆ–ç”±ç®¡ç†å‘˜é™æ€é¢„é…ç½®â€Œã€‚ â€ŒPVCï¼ˆæŒä¹…å·å£°æ˜ï¼‰ï¼šç”¨æˆ·é€šè¿‡PVCç”³è¯·å­˜å‚¨èµ„æºï¼ŒStorageClassè‡ªåŠ¨åŒ¹é…å¹¶ç”ŸæˆPVâ€Œã€‚ StorageClassâ€Œ å…¸å‹åº”ç”¨åœºæ™¯ â€Œäº‘åŸç”Ÿç¯å¢ƒâ€Œï¼šåŠ¨æ€åˆ†é…äº‘å­˜å‚¨ï¼ˆå¦‚AWS EBSã€Azure Diskï¼‰ä»¥é€‚åº”å¼¹æ€§æ‰©å±•éœ€æ±‚â€Œã€‚ â€Œæ··åˆå­˜å‚¨ç®¡ç†â€Œï¼šä¸ºä¸åŒä¸šåŠ¡å®šä¹‰å¤šç±»StorageClassï¼ˆå¦‚é«˜æ€§èƒ½SSDã€ä½æˆæœ¬HDDï¼‰â€Œã€‚ â€Œè‡ªåŠ¨åŒ–è¿ç»´â€Œï¼šå‡å°‘æ‰‹åŠ¨ç»´æŠ¤PVçš„å·¥ä½œé‡ï¼Œæå‡é›†ç¾¤å­˜å‚¨æ•ˆç‡â€Œã€‚ StorageClassâ€Œ å®éªŒnfs-client-provisioneræ˜¯Kubernetesä¸­çš„ä¸€ä¸ªä¾›åº”å•†ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯â€ŒåŠ¨æ€æä¾›ç”±NFSï¼ˆNetwork File Systemï¼‰å…±äº«æ”¯æŒçš„æŒä¹…å·â€Œã€‚åœ¨Kubernetesé›†ç¾¤ä¸­ï¼ŒæŒä¹…å·æ˜¯ç‹¬ç«‹äºPodå­˜åœ¨çš„å­˜å‚¨èµ„æºï¼Œç”¨äºæŒä¹…åœ°å­˜å‚¨æ•°æ®ã€‚nfs-client-provisioneré€šè¿‡ä»¥ä¸‹æ–¹å¼å‘æŒ¥ä½œç”¨ï¼š â€Œè‡ªåŠ¨åŒ–åˆ›å»ºæŒä¹…å·â€Œï¼šå®ƒæ ¹æ®éœ€è¦è‡ªåŠ¨åŒ–åˆ›å»ºæŒä¹…å·ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œã€‚ â€Œä¸NFSæœåŠ¡å™¨äº¤äº’â€Œï¼šé€šè¿‡ä¸NFSæœåŠ¡å™¨è¿›è¡Œäº¤äº’ï¼Œå®ç°å­˜å‚¨çš„åŠ¨æ€åˆ†é…ã€‚ â€Œç®€åŒ–ç®¡ç†â€Œï¼šä½¿å¾—åœ¨Kubernetesé›†ç¾¤ä¸­ä¸ºåº”ç”¨ç¨‹åºåŠ¨æ€åˆ†é…å­˜å‚¨å˜å¾—æ›´åŠ ç®€å•ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†NFSå…±äº«å’ŒæŒä¹…å·çš„åˆ›å»ºè¿‡ç¨‹ã€‚ 1.æ·»åŠ å…±äº«ç›®å½• echo /nfsdata/share *(rw,no_root_squash,no_all_squash,sync) /etc/exportsmkdir /nfsdata/sharechown -R nobody /nfsdata/sharesystemctl enable nfs-server systemctl restart nfs-server systemctl restart rpcbindshowmount -e 10.37.129.10 2.åˆ›å»ºå‘½åç©ºé—´ kubectl create ns nfs-storageclass 3.éƒ¨ç½² nfs-client-provisioner apiVersion: apps/v1kind: Deploymentmetadata: name: nfs-client-provisioner namespace: nfs-storageclassspec: replicas: 1 selector: matchLabels: app: nfs-client-provisioner strategy: type: Recreate template: metadata: labels: app: nfs-client-provisioner spec: serviceAccountName: nfs-client-provisioner containers: - name: nfs-client-provisioner image: k8s.dockerproxy.com/sig-storage/nfs-subdir-external-provisioner:v4.0.2 volumeMounts: - name: nfs-client-root mountPath: /persistentvolumes env: - name: PROVISIONER_NAME value: k8s-sigs.io/nfs-subdir-external-provisioner - name: NFS_SERVER # value: YOUR NFS SERVER HOSTNAME value: 10.37.129.10 - name: NFS_PATH value: /nfsdata/share volumes: - name: nfs-client-root nfs: # value: YOUR NFS SERVER HOSTNAME server: 10.37.129.10 path: /nfsdata/share---apiVersion: v1kind: ServiceAccountmetadata: name: nfs-client-provisioner # replace with namespace where provisioner is deployed namespace: nfs-storageclass---kind: ClusterRoleapiVersion: rbac.authorization.k8s.io/v1metadata: name: nfs-client-provisioner-runnerrules:- apiGroups: [] resources: [nodes] verbs: [get, list, watch]- apiGroups: [] resources: [persistentvolumes] verbs: [get, list, watch, create, delete]- apiGroups: [] resources: [persistentvolumeclaims] verbs: [get, list, watch, update]- apiGroups: [storage.k8s.io] resources: [storageclasses] verbs: [get, list, watch]- apiGroups: [] resources: [events] verbs: [create, update, patch]---kind: ClusterRoleBindingapiVersion: rbac.authorization.k8s.io/v1metadata: name: run-nfs-client-provisionersubjects:- kind: ServiceAccount name: nfs-client-provisioner # replace with namespace where provisioner is deployed namespace: nfs-storageclassroleRef: kind: ClusterRole name: nfs-client-provisioner-runner apiGroup: rbac.authorization.k8s.io---kind: RoleapiVersion: rbac.authorization.k8s.io/v1metadata: name: leader-locking-nfs-client-provisioner # replace with namespace where provisioner is deployed namespace: nfs-storageclassrules:- apiGroups: [] resources: [endpoints] verbs: [get, list, watch, create, update, patch]---kind: RoleBindingapiVersion: rbac.authorization.k8s.io/v1metadata: name: leader-locking-nfs-client-provisioner namespace: nfs-storageclasssubjects:- kind: ServiceAccount name: nfs-client-provisioner # replace with namespace where provisioner is deployed namespace: nfs-storageclassroleRef: kind: Role name: leader-locking-nfs-client-provisioner apiGroup: rbac.authorization.k8s.io 4.åˆ›å»ºStorageClass apiVersion: storage.k8s.io/v1kind: StorageClassmetadata: name: nfs-client namespace: nfs-storageclassprovisioner: k8s-sigs.io/nfs-subdir-external-provisionerparameters: pathPattern: $.PVC.namespace/$.PVC.name onDelete: delete 5.æµ‹è¯• pod apiVersion: v1kind: PersistentVolumeClaimmetadata: name: test-claim annotations: volume.beta.kubernetes.io/storage-class: nfs-clientspec: accessModes: - ReadWriteMany resources: requests: storage: 1Mi storageClassName: nfs-client---apiVersion: v1kind: Podmetadata: name: test-podspec: containers: - name: test-pod image: wangyanglinux/myapp:v1.0 volumeMounts: - name: nfs-pvc mountPath: /usr/local/nginx/html restartPolicy: Never volumes: - name: nfs-pvc persistentVolumeClaim: claimName: test-claim","tags":[null],"categories":[null]},{"title":"Kuberneteså¸¸ç”¨å‘½ä»¤","path":"/wiki/Kubernetes/å¸¸ç”¨å‘½ä»¤.html","content":"å¸¸ç”¨å‘½ä»¤# è·å–å½“å‰çš„èµ„æºï¼Œpod$ kubectl get pod -A,--all-namespaces æŸ¥çœ‹å½“å‰æ‰€æœ‰åç§°ç©ºé—´çš„èµ„æº -n æŒ‡å®šåç§°ç©ºé—´ï¼Œé»˜è®¤å€¼ defaultï¼Œkube-system ç©ºé—´å­˜æ”¾æ˜¯å½“å‰ç»„ä»¶èµ„æº --show-labels æŸ¥çœ‹å½“å‰çš„æ ‡ç­¾ -l ç­›é€‰èµ„æºï¼Œkeyã€key=value -o wide è¯¦ç»†ä¿¡æ¯åŒ…æ‹¬ IPã€åˆ†é…çš„èŠ‚ç‚¹ -w ç›‘è§†ï¼Œæ‰“å°å½“å‰çš„èµ„æºå¯¹è±¡çš„å˜åŒ–éƒ¨åˆ†# æ·»åŠ æ ‡ç­¾kubectl label node k8s-node03 domain=xinxianghf# è¿›å…¥ Pod å†…éƒ¨çš„å®¹å™¨æ‰§è¡Œå‘½ä»¤$ kubectl exec -it podName -c cName -- command -c å¯ä»¥çœç•¥ï¼Œé»˜è®¤è¿›å…¥å”¯ä¸€çš„å®¹å™¨å†…éƒ¨ # æŸ¥çœ‹èµ„æºçš„æè¿°$ kubectl explain pod.spec# æŸ¥çœ‹ pod å†…éƒ¨å®¹å™¨çš„ æ—¥å¿—$ kubectl logs podName -c cName# æŸ¥çœ‹èµ„æºå¯¹è±¡çš„è¯¦ç»†æè¿°$ kubectl describe pod podName# åˆ é™¤èµ„æºå¯¹è±¡$ kubectl delete kindName objName --all åˆ é™¤å½“å‰æ‰€æœ‰çš„èµ„æºå¯¹è±¡# æŸ¥çœ‹ rc æ§åˆ¶å™¨$ kubectl get rc# æŸ¥çœ‹ rc æ§åˆ¶å™¨$ kubectl get rcDeploymentâ€Œ å¸¸ç”¨å‘½ä»¤#â€Œåˆ›å»º Deploymentâ€Œï¼šå‘½ä»¤ï¼škubectl create -f deployment.yaml --recordè§£é‡Šï¼šæ­¤å‘½ä»¤ç”¨äºæ ¹æ® deployment.yaml æ–‡ä»¶åˆ›å»º Deploymentã€‚â€Œ--record å‚æ•°ä¼šè®°å½•æ¯æ¬¡å˜æ›´ï¼Œä¾¿äºåç»­æŸ¥çœ‹æ¯æ¬¡ä¿®è®¢çš„å˜åŒ–â€Œã€‚#â€Œä¿®æ”¹å‰¯æœ¬æ•° Deploymentâ€Œï¼šå‘½ä»¤ï¼škubectl scale deployment nginx-deployment --replicas 10è§£é‡Šï¼šæ­¤å‘½ä»¤ç”¨äºè°ƒæ•´ nginx-deployment çš„å‰¯æœ¬æ•°ä¸º 10ã€‚â€Œé€šè¿‡å¢åŠ æˆ–å‡å°‘ Pod æ•°é‡ï¼Œç¡®ä¿ Deployment è¾¾åˆ°æŒ‡å®šçš„å‰¯æœ¬è§„æ¨¡â€Œã€‚#â€Œè®¾ç½®è‡ªåŠ¨ç¼©æ”¾â€Œï¼šå‘½ä»¤ï¼škubectl autoscale deployment nginx-deployment --min=10 --max=15 --cpu-percent=80è§£é‡Šï¼šæ­¤å‘½ä»¤ä¸º nginx-deployment è®¾ç½®è‡ªåŠ¨ç¼©æ”¾è§„åˆ™ã€‚â€Œå½“ CPU ä½¿ç”¨ç‡è¶…è¿‡ 80% æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¢åŠ å‰¯æœ¬æ•°ï¼Œæœ€å¤šå¢åŠ åˆ° 15 ä¸ªï¼›å½“è´Ÿè½½é™ä½æ—¶ï¼Œå‰¯æœ¬æ•°ä¼šè‡ªåŠ¨å‡å°‘ï¼Œä½†ä¸å°‘äº 10 ä¸ªâ€Œã€‚#â€Œæ›´æ–° Deployment é•œåƒâ€Œï¼šå‘½ä»¤ï¼škubectl set image deployment/nginx-deployment nginx-deployment-container=wangyanglinux/myapp:v2.0è§£é‡Šï¼šæ­¤å‘½ä»¤ç”¨äºæ›´æ–° nginx-deployment ä¸­çš„é•œåƒã€‚â€Œå°†æŒ‡å®šå®¹å™¨çš„é•œåƒæ›¿æ¢ä¸º wangyanglinux/myapp:v2.0ï¼Œå®ç°åº”ç”¨çš„ç‰ˆæœ¬å‡çº§â€Œã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„ nginx-deployment-container åº”ä¸ºå®¹å™¨å ã€‚#â€Œå›æ»š Deploymentâ€Œï¼šå‘½ä»¤ï¼škubectl rollout undo deployment/nginx-deploymentè§£é‡Šï¼šæ­¤å‘½ä»¤ç”¨äºå›æ»š nginx-deployment åˆ°ä¹‹å‰çš„ç‰ˆæœ¬ã€‚â€Œå½“æ–°ç‰ˆæœ¬å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å‘½ä»¤å¿«é€Ÿæ¢å¤åˆ°ä¹‹å‰çš„ç¨³å®šç‰ˆæœ¬â€Œã€‚#åˆ é™¤ Deploymentâ€Œï¼šå‘½ä»¤ï¼škubectl delete -f deploymentNameè§£é‡Šï¼šé€šè¿‡ deployment.yaml æ–‡ä»¶å»åˆ é™¤å¯¹åº”Deploymentâ€Œã€‚#å¯¼å‡ºèµ„æºæ¸…å•å‘½ä»¤: --dry-run -o yamlè§£é‡Šï¼šå°†å‘½ä»¤ç”Ÿæˆçš„yamlå¯¼å‡º?ç¤ºä¾‹ï¼škubectl create svc clusterip myapp --tcp=80:80 --dry-run -o yaml#å‘½ä»¤è¡¥å…¨yum install bash-completionsource (kubectl completion bash) å¸¸è§æŠ¥é”™kubectl get ds -n kube-system calico-nodekubectl rollout restart ds -n kube-system calico-node","tags":[null],"categories":[null]},{"title":"Kubernetesæ§åˆ¶å™¨","path":"/wiki/Kubernetes/æ§åˆ¶å™¨.html","content":"æ§åˆ¶å™¨åœ¨ Kubernetes ä¸­è¿è¡Œäº†ä¸€ç³»åˆ—æ§åˆ¶å™¨æ¥ç¡®ä¿é›†ç¾¤çš„å½“å‰çŠ¶æ€ä¸æœŸæœ›çŠ¶æ€ä¿æŒä¸€è‡´ï¼Œå®ƒä»¬å°±æ˜¯ Kubernetes é›†ç¾¤å†…éƒ¨çš„ç®¡ç†æ§åˆ¶ä¸­å¿ƒæˆ–è€…è¯´æ˜¯â€ä¸­å¿ƒå¤§è„‘â€ã€‚ä¾‹å¦‚ï¼ŒReplicaSet æ§åˆ¶å™¨è´Ÿè´£ç»´æŠ¤é›†ç¾¤ä¸­è¿è¡Œçš„ Pod æ•°é‡ï¼›Node æ§åˆ¶å™¨è´Ÿè´£ç›‘æ§èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œå¹¶åœ¨èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶ï¼Œæ‰§è¡Œè‡ªåŠ¨åŒ–ä¿®å¤æµç¨‹ï¼Œç¡®ä¿é›†ç¾¤å§‹ç»ˆå¤„äºé¢„æœŸçš„å·¥ä½œçŠ¶æ€ã€‚ Pod æ§åˆ¶å™¨ReplicationControllerï¼ˆRCï¼‰ç”¨æ¥ç¡®ä¿å®¹å™¨åº”ç”¨çš„å‰¯æœ¬æ•°å§‹ç»ˆä¿æŒåœ¨ç”¨æˆ·å®šä¹‰çš„å‰¯æœ¬æ•°ï¼Œå³å¦‚æœæœ‰å®¹å™¨å¼‚å¸¸é€€å‡ºï¼Œä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„ Pod æ¥æ›¿ä»£ï¼›è€Œå¦‚æœå¼‚å¸¸å¤šå‡ºæ¥çš„å®¹å™¨ä¹Ÿä¼šè‡ªåŠ¨å›æ”¶ï¼› åœ¨æ–°ç‰ˆæœ¬çš„ Kubernetes ä¸­å»ºè®®ä½¿ç”¨ ReplicaSet æ¥å–ä»£ ReplicationControllerã€‚ReplicaSet è·Ÿ ReplicationController æ²¡æœ‰æœ¬è´¨åŒºåˆ«ï¼Œåªæ˜¯åå­—ä¸ä¸€æ ·ï¼Œå¹¶ä¸” ReplicaSet æ”¯æŒé›†åˆå¼çš„ selectorã€‚ RC æ§åˆ¶å™¨apiVersion: v1kind: ReplicationControllermetadata: # è®¾ç½®æ§åˆ¶å™¨çš„åç§°ï¼Œåœ¨å‘½åç©ºé—´å†…å”¯ä¸€ name: rc-testspec: replicas: 3 selector: # é€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨åŒ¹é…è¦ç®¡ç†çš„Pod app: rc-demo template: metadata: labels: # ä¸ºåˆ›å»ºçš„Podè®¾ç½®æ ‡ç­¾ï¼Œéœ€ä¸selectoråŒ¹é… app: rc-demo spec: containers: - name: rc-demo-container image: wangyanglinux/myapp:v1.0 env: - name: GET_HOSTS_FROM value: dns name: zhangsan value: 123 ports: - containerPort: 80 kubectl apply -f 1-rc-demo.yamlkubectl get podkubectl get rc å¯ä»¥çœ‹åˆ°æˆåŠŸè¿è¡Œäº†ä¸‰ä¸ª podã€‚ kubectl delete pod rc-test-dln5b å½“æˆ‘ä»¬åˆ é™¤å…¶ä¸­ä¸€ä¸ª pod ä¸æ»¡è¶³æœŸæœ›æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„ podã€‚ kubectl get pod --show-labelskubectl label pod rc-test-4692h version=v1kubectl get pods -l app=rc-demo --show-labels ä¿®æ”¹ pod æ ‡ç­¾åï¼Œå½“è¿˜èƒ½é€šè¿‡ selector é€‰æ‹©å™¨åŒ¹é…åˆ°è¯¥ podï¼Œåˆ™ä¸ä¼šé‡æ–°åˆ›å»º podã€‚ kubectl label pod rc-test-lqtl8 app=hahaha --overwrite å½“ selector é€‰æ‹©å™¨åŒ¹é…ä¸åˆ° pod æ ‡ç­¾ï¼Œåˆ™ä¼šé‡æ–°åˆ›å»º podã€‚ kubectl label pod rc-test-lqtl8 app=rc-demo --overwrite å°† pod æ ‡ç­¾æ”¹å›ï¼Œå¯ä»¥å‘ç°æœ€æ–°åˆ›å»ºçš„ pod å°†è¢«åˆ é™¤ã€‚ kubectl scale rc rc-test --replicas=10 ä¿®æ”¹ pod å‰¯æœ¬æ•°ã€‚ RS æ§åˆ¶å™¨apiVersion: apps/v1kind: ReplicaSetmetadata: # è®¾ç½®æ§åˆ¶å™¨çš„åç§°ï¼Œåœ¨å‘½åç©ºé—´å†…å”¯ä¸€ name: rs-ml-testspec: replicas: 3 selector: matchLabels: # é€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨åŒ¹é…è¦ç®¡ç†çš„Pod app: rs-ml-demo template: metadata: labels: # ä¸ºåˆ›å»ºçš„Podè®¾ç½®æ ‡ç­¾ï¼Œéœ€ä¸selectoråŒ¹é… app: rs-ml-demo spec: containers: - name: rs-ml-demo-container image: wangyanglinux/myapp:v1.0 env: - name: GET_HOSTS_FROM value: dns ports: - containerPort: 80 matchLabels ä¸ rc åŠŸèƒ½ç±»ä¼¼ã€‚ selector.matchExpressions rs åœ¨æ ‡ç­¾é€‰æ‹©å™¨ä¸Šï¼Œé™¤äº†å¯ä»¥å®šä¹‰é”®å€¼å¯¹çš„é€‰æ‹©å½¢å¼ï¼Œè¿˜æ”¯æŒ matchExpressions å­—æ®µï¼Œå¯ä»¥æä¾›å¤šç§é€‰æ‹©ã€‚ ç›®å‰æ”¯æŒçš„æ“ä½œåŒ…æ‹¬ï¼š Inï¼šlabel çš„å€¼åœ¨æŸä¸ªåˆ—è¡¨ä¸­ NotInï¼šlabel çš„å€¼ä¸åœ¨æŸä¸ªåˆ—è¡¨ä¸­ Existsï¼šæŸä¸ª label å­˜åœ¨ DoesNotExistï¼šæŸä¸ª label ä¸å­˜åœ¨ apiVersion: apps/v1kind: ReplicaSetmetadata: # è®¾ç½®æ§åˆ¶å™¨çš„åç§°ï¼Œåœ¨å‘½åç©ºé—´å†…å”¯ä¸€ name: rs-me-exists-testspec: replicas: 3 selector: matchExpressions: # pod å­˜åœ¨ key ä¸º app çš„æ ‡ç­¾å°±å¯ä»¥åŒ¹é…ä¸Š - key: app operator: Exists template: metadata: labels: app: spring spec: containers: - name: rs-ml-exists-container image: wangyanglinux/myapp:v1.0 ports: - containerPort: 80 åªéœ€è¦ pod ä¸­å­˜åœ¨ key ä¸º app çš„æ ‡ç­¾å°±èƒ½å¤ŸåŒ¹é…ï¼Œä¿®æ”¹ app çš„å€¼ä¸å½±å“ã€‚ apiVersion: apps/v1kind: ReplicaSetmetadata: # è®¾ç½®æ§åˆ¶å™¨çš„åç§°ï¼Œåœ¨å‘½åç©ºé—´å†…å”¯ä¸€ name: rs-me-in-testspec: replicas: 3 selector: matchExpressions: # pod å­˜åœ¨ app å€¼ä¸º values ä¸­çš„æ ‡ç­¾å°±å¯ä»¥åŒ¹é…ä¸Š - key: app operator: In values: - spring - haha template: metadata: labels: # key ä¸º app app: spring2 spec: containers: - name: rs-ml-exists-container image: wangyanglinux/myapp:v1.0 ports: - containerPort: 80 æ–°ç‰ˆ k8s åˆ›å»º pod æ—¶ä¼šæ£€æµ‹å®¹å™¨æ ‡ç­¾æ˜¯å¦ç¬¦åˆè§„åˆ™ï¼ŒåŒ¹é…å¤±è´¥ä¼šç›´æ¥åˆ›å»ºå¤±è´¥ã€‚ æŠŠ spring2 æ”¹ä¸º springã€‚ kubectl apply -f 4-rs-in-demo.yaml kubectl label pod rs-me-in-test-bxprv app=haha --overwritekubectl get pod --show-labels ä¿®æ”¹ pod æ ‡ç­¾å­˜åœ¨åˆ—è¡¨ä¸­æ—¶ï¼Œä¸ä¼šé‡æ–°åˆ›å»º podã€‚ kubectl label pod rs-me-in-test-bxprv app=haha1 --overwritekubectl get pod --show-labels ä¸å­˜åœ¨åˆ—è¡¨ä¸­å°±ä¼šé‡æ–°åˆ›å»ºæ–°çš„ podã€‚ DeploymentDeployment ä¸º Pod å’Œ ReplicaSet æä¾›äº†ä¸€ä¸ªå£°æ˜å¼å®šä¹‰ (declarative ) æ–¹æ³•ï¼Œç”¨æ¥æ›¿ä»£ä»¥å‰çš„ ReplicationController æ¥æ–¹ä¾¿ç®¡ç†åº”ç”¨ã€‚å…¸å‹çš„åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼š å®šä¹‰ Deployment æ¥åˆ›å»º Pod å’Œ ReplicaSet æ»šåŠ¨å‡çº§å’Œå›æ»šåº”ç”¨ æ‰©å®¹å’Œç¼©å®¹ æš‚åœå’Œç»§ç»­ Deployment å‘½ä»¤å¼å’Œå£°æ˜å¼åœ¨Kubernetesä¸­ï¼Œå£°æ˜å¼ä¸å‘½ä»¤å¼æ˜¯ä¸¤ç§ä¸åŒçš„æ“ä½œæ–¹å¼ã€‚ â€Œå£°æ˜å¼â€Œæ˜¯å¯¹æœ€ç»ˆç»“æœçš„é™ˆè¿°ï¼Œè¡¨æ˜æ„å›¾è€Œéå®ç°è¿‡ç¨‹ã€‚ä¾‹å¦‚ï¼Œåœ¨ Kubernetes ä¸­è¯´â€œåº”è¯¥æœ‰ä¸€ä¸ªåŒ…å«ä¸‰ä¸ª Pod çš„ ReplicaSetâ€ï¼Œè¿™æ˜¯ä¸€ç§å£°æ˜å¼çš„è¡¨è¾¾ï¼Œå®ƒæè¿°äº†æœŸæœ›çš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯å¦‚ä½•è¾¾åˆ°è¿™ä¸ªçŠ¶æ€ã€‚ â€Œå‘½ä»¤å¼â€Œåˆ™æ˜¯ä¸»åŠ¨ä¸”ç›´æ¥çš„å‘½ä»¤ã€‚æ¯”å¦‚â€œåˆ›å»ºä¸€ä¸ªåŒ…å«ä¸‰ä¸ª Pod çš„ ReplicaSetâ€ï¼Œè¿™æ˜¯ä¸€ä¸ªå‘½ä»¤å¼çš„æ“ä½œï¼Œå®ƒç›´æ¥æŒ‡ç¤ºç³»ç»Ÿæ‰§è¡Œå…·ä½“çš„åŠ¨ä½œã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œå£°æ˜å¼ä¸å‘½ä»¤å¼åœ¨ Kubernetes ä¸­åˆ†åˆ«ä»£è¡¨äº†æè¿°æœŸæœ›çŠ¶æ€å’Œç›´æ¥æ‰§è¡Œå‘½ä»¤çš„ä¸¤ç§æ–¹å¼ã€‚ kubectl replace å’Œ kubectl apply åŒºåˆ«åœ¨Kubernetesä¸­ï¼Œkubectl replaceå’Œkubectl applyæ˜¯ä¸¤ä¸ªå¸¸ç”¨çš„å‘½ä»¤ï¼Œç”¨äºç®¡ç†é›†ç¾¤ä¸­çš„èµ„æºã€‚ä»¥ä¸‹æ˜¯è¿™ä¸¤ä¸ªå‘½ä»¤åœ¨è¯»å–å†…å®¹å¹¶è¿›è¡Œæ“ä½œæ—¶çš„è¯¦ç»†åŒºåˆ«ï¼š â€Œä¸€ã€å‘½ä»¤åŠŸèƒ½â€Œkubectl replaceâ€Œ åŠŸèƒ½ï¼šä½¿ç”¨æ–°çš„é…ç½®å®Œå…¨æ›¿æ¢æ‰ç°æœ‰èµ„æºçš„é…ç½®ã€‚ ç‰¹ç‚¹ï¼šæ–°é…ç½®å°†è¦†ç›–ç°æœ‰èµ„æºçš„æ‰€æœ‰å­—æ®µå’Œå±æ€§ï¼ŒåŒ…æ‹¬æœªæŒ‡å®šçš„å­—æ®µï¼Œå¯¼è‡´æ•´ä¸ªèµ„æºçš„æ›¿æ¢ã€‚è¿™ç±»ä¼¼äºåˆ é™¤ç°æœ‰èµ„æºå¹¶é‡æ–°åˆ›å»ºã€‚ â€Œkubectl applyâ€Œ åŠŸèƒ½ï¼šä½¿ç”¨æ–°çš„é…ç½®éƒ¨åˆ†åœ°æ›´æ–°ç°æœ‰èµ„æºçš„é…ç½®ã€‚ ç‰¹ç‚¹ï¼šæ ¹æ®æä¾›çš„é…ç½®æ–‡ä»¶æˆ–å‚æ•°ï¼Œåªæ›´æ–°ä¸æ–°é…ç½®ä¸­ä¸åŒçš„éƒ¨åˆ†ï¼Œè€Œä¸ä¼šè¦†ç›–æ•´ä¸ªèµ„æºçš„é…ç½®ã€‚è¿™ä¿ç•™äº†æœªæŒ‡å®šå­—æ®µçš„åŸæœ‰å€¼ã€‚ â€ŒäºŒã€å­—æ®µçº§åˆ«æ›´æ–°â€Œâ€Œkubectl replaceâ€Œï¼šå®Œå…¨æ›¿æ¢æ‰€æœ‰å­—æ®µå’Œå±æ€§ï¼Œæ— è®ºæ˜¯å¦åœ¨æ–°é…ç½®ä¸­æŒ‡å®šã€‚ â€Œkubectl applyâ€Œï¼šåªæ›´æ–°ä¸æ–°é…ç½®ä¸­ä¸åŒçš„å­—æ®µå’Œå±æ€§ï¼Œä¿ç•™æœªæŒ‡å®šçš„å­—æ®µä¸å—å½±å“ã€‚ â€Œä¸‰ã€ä½¿ç”¨åœºæ™¯â€Œâ€Œkubectl replaceâ€Œï¼šé€‚ç”¨äºéœ€è¦å½»åº•æ›¿æ¢èµ„æºé…ç½®çš„åœºæ™¯ï¼Œå¦‚èµ„æºé…ç½®å‘ç”Ÿé‡å¤§å˜æ›´æ—¶ã€‚ä½¿ç”¨å‰éœ€è°¨æ…ï¼Œå› ä¸ºæ›¿æ¢æ“ä½œæ˜¯ä¸å¯é€†çš„ã€‚ â€Œkubectl applyâ€Œï¼šé€‚ç”¨äºéœ€è¦éƒ¨åˆ†æ›´æ–°èµ„æºé…ç½®çš„åœºæ™¯ï¼Œå¦‚ä»…ä¿®æ”¹éƒ¨åˆ†é…ç½®å‚æ•°æ—¶ã€‚å®ƒæä¾›äº†æ›´é«˜çš„çµæ´»æ€§å’Œå¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œé€‚åˆåœ¨å¤šä¸ªç”¨æˆ·æˆ–è¿›ç¨‹åŒæ—¶ä¿®æ”¹åŒä¸€èµ„æºæ—¶ä½¿ç”¨ã€‚ å››ã€éƒ¨åˆ†æ›´æ–°â€Œkubectl replaceâ€Œï¼šä¸æ”¯æŒéƒ¨åˆ†æ›´æ–°ã€‚å½“ä½ ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ—¶ï¼Œå®ƒä¼šæ›¿æ¢æ•´ä¸ªèµ„æºçš„é…ç½®ï¼Œè¿™æ„å‘³ç€èµ„æºçš„æ‰€æœ‰å­—æ®µéƒ½ä¼šè¢«æ–°çš„é…ç½®æ–‡ä»¶ä¸­çš„å€¼æ‰€è¦†ç›–ã€‚ â€Œkubectl applyâ€Œï¼šæ”¯æŒéƒ¨åˆ†æ›´æ–°ã€‚è¿™ä¸ªå‘½ä»¤åªä¼šæ›´æ–°æ–°é…ç½®ä¸­å‘ç”Ÿå˜åŒ–çš„éƒ¨åˆ†ï¼Œè€Œä¿ç•™æœªæŒ‡å®šçš„éƒ¨åˆ†ä¸å—å½±å“ã€‚è¿™ä½¿å¾—kubectl applyåœ¨è¿›è¡Œé…ç½®æ›´æ–°æ—¶æ›´åŠ çµæ´»å’Œé«˜æ•ˆã€‚ äº”â€Œã€ä¸å…¶ä»–é…ç½®çš„å½±å“â€Œâ€Œkubectl replaceâ€Œï¼šåœ¨æ›¿æ¢èµ„æºæ—¶ï¼Œä¸è€ƒè™‘å…¶ä»–èµ„æºé…ç½®çš„çŠ¶æ€ã€‚è¿™æ„å‘³ç€å³ä½¿å…¶ä»–èµ„æºä¾èµ–äºè¢«æ›¿æ¢çš„èµ„æºï¼Œkubectl replaceä¹Ÿä¸ä¼šè€ƒè™‘è¿™äº›ä¾èµ–å…³ç³»ï¼Œç›´æ¥è¿›è¡Œæ›¿æ¢æ“ä½œã€‚ â€Œkubectl applyâ€Œï¼šèƒ½å¤Ÿç»“åˆä½¿ç”¨ -f æˆ– -k å‚æ•°ï¼Œä»æ–‡ä»¶æˆ–ç›®å½•ä¸­è¯»å–å¤šä¸ªèµ„æºé…ç½®ï¼Œå¹¶æ ¹æ®å½“å‰é›†ç¾¤ä¸­çš„èµ„æºçŠ¶æ€è¿›è¡Œæ›´æ–°ã€‚è¿™ä½¿å¾— kubectl apply èƒ½å¤Ÿæ›´æ™ºèƒ½åœ°å¤„ç†èµ„æºä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œç¡®ä¿æ›´æ–°çš„é¡ºåˆ©è¿›è¡Œã€‚ â€Œæ€»ç»“â€Œï¼šâ€Œkubectl applyâ€Œæ›´é€‚åˆè¿›è¡Œéƒ¨åˆ†æ›´æ–°å’Œç»“åˆå¤šä¸ªé…ç½®æ–‡ä»¶è¿›è¡Œæ›´æ–°ï¼Œå®ƒèƒ½å¤Ÿä¿ç•™æœªæŒ‡å®šçš„éƒ¨åˆ†ä¸å—å½±å“ï¼Œå¹¶æ ¹æ®å½“å‰é›†ç¾¤çŠ¶æ€è¿›è¡Œæ™ºèƒ½æ›´æ–°ã€‚ â€Œkubectl replaceâ€Œåˆ™æ›´åŠ ç›´æ¥å’Œå½»åº•ï¼Œå®ƒä¼šæ›¿æ¢æ•´ä¸ªèµ„æºçš„é…ç½®ï¼Œä¸è€ƒè™‘å…¶ä»–èµ„æºé…ç½®çš„çŠ¶æ€ã€‚åœ¨ä½¿ç”¨æ—¶éœ€è¦è°¨æ…ï¼Œä»¥é¿å…å¯¹é›†ç¾¤é€ æˆä¸å¿…è¦çš„å½±å“ã€‚ æµ‹è¯•apiVersion: apps/v1kind: Deploymentmetadata: labels: app: myapp-deploy name: myapp-deployspec: selector: matchLabels: app: myapp-deploy template: metadata: labels: app: myapp-deploy spec: containers: - image: wangyanglinux/myapp:v1.0 name: myapp # æ‰§è¡Œkubectl apply -f 5-deployment-demo1.yaml å¯ä»¥çœ‹åˆ° pod æ­£å¸¸åˆ›å»ºã€‚è¿™ä¸ªæ—¶å€™ pod ä¸ªæ•°ä¸º 1ã€‚ # ä¿®æ”¹å‰¯æœ¬æ•°kubectl scale deploy myapp-deploy --replicas=3 # ä¿®æ”¹ pod ç‰ˆæœ¬ä¸º 2.0 ... spec: containers: - image: wangyanglinux/myapp:v2.0 name: myapp kubectl apply -f 5-deployment-demo1.yaml å¯ä»¥çœ‹åˆ° pod æ•°æœªæ”¹å˜ï¼Œä¸”ç‰ˆæœ¬ä¿®æ”¹ä¸º2.0ã€‚ kubectl replace -f 5-deployment-demo1.yaml ä½¿ç”¨ kubectl replace è¿è¡Œæ—¶ï¼ŒæŒ‰ç…§æœ€æ–°çš„ deployment æ–‡ä»¶æè¿°å…¨éƒ¨é‡æ–°åˆ›å»ºã€‚ Deploymentâ€Œ å¸¸ç”¨å‘½ä»¤ â€Œåˆ›å»º Deploymentâ€Œï¼š å‘½ä»¤ï¼škubectl create -f deployment.yaml â€“record è§£é‡Šï¼šæ­¤å‘½ä»¤ç”¨äºæ ¹æ® deployment.yaml æ–‡ä»¶åˆ›å»º Deploymentã€‚â€Œ--record å‚æ•°ä¼šè®°å½•æ¯æ¬¡å˜æ›´ï¼Œä¾¿äºåç»­æŸ¥çœ‹æ¯æ¬¡ä¿®è®¢çš„å˜åŒ–â€Œã€‚ ç¼©æ”¾ Deploymentâ€Œï¼š å‘½ä»¤ï¼škubectl scale deployment nginx-deployment â€“replicas 10 è§£é‡Šï¼šæ­¤å‘½ä»¤ç”¨äºè°ƒæ•´ nginx-deployment çš„å‰¯æœ¬æ•°ä¸º 10ã€‚â€Œé€šè¿‡å¢åŠ æˆ–å‡å°‘ Pod æ•°é‡ï¼Œç¡®ä¿ Deployment è¾¾åˆ°æŒ‡å®šçš„å‰¯æœ¬è§„æ¨¡â€Œã€‚ â€Œè®¾ç½®è‡ªåŠ¨ç¼©æ”¾â€Œï¼š å‘½ä»¤ï¼škubectl autoscale deployment nginx-deployment â€“min10 â€“max15 â€“cpu-percent80 è§£é‡Šï¼šæ­¤å‘½ä»¤ä¸º nginx-deployment è®¾ç½®è‡ªåŠ¨ç¼©æ”¾è§„åˆ™ã€‚â€Œå½“ CPU ä½¿ç”¨ç‡è¶…è¿‡ 80% æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¢åŠ å‰¯æœ¬æ•°ï¼Œæœ€å¤šå¢åŠ åˆ° 15 ä¸ªï¼›å½“è´Ÿè½½é™ä½æ—¶ï¼Œå‰¯æœ¬æ•°ä¼šè‡ªåŠ¨å‡å°‘ï¼Œä½†ä¸å°‘äº 10 ä¸ªâ€Œã€‚ æ›´æ–° Deployment é•œåƒâ€Œï¼š å‘½ä»¤ï¼škubectl set image deploymentnginx-deployment nginx-deployment-containerwangyanglinuxmyapp:v2.0 è§£é‡Šï¼šæ­¤å‘½ä»¤ç”¨äºæ›´æ–° nginx-deployment ä¸­çš„é•œåƒã€‚â€Œå°†æŒ‡å®šå®¹å™¨çš„é•œåƒæ›¿æ¢ä¸º wangyanglinuxmyapp:v2.0ï¼Œå®ç°åº”ç”¨çš„ç‰ˆæœ¬å‡çº§â€Œã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„ nginx-deployment-container åº”ä¸ºå®¹å™¨åã€‚ â€Œå›æ»š Deploymentâ€Œï¼š å‘½ä»¤ï¼škubectl rollout undo deploymentnginx-deployment è§£é‡Šï¼šæ­¤å‘½ä»¤ç”¨äºå›æ»š nginx-deployment åˆ°ä¹‹å‰çš„ç‰ˆæœ¬ã€‚â€Œå½“æ–°ç‰ˆæœ¬å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å‘½ä»¤å¿«é€Ÿæ¢å¤åˆ°ä¹‹å‰çš„ç¨³å®šç‰ˆæœ¬â€Œã€‚ åˆ é™¤ Deploymentâ€Œ: å‘½ä»¤ï¼škubectl delete -f deploymentName è§£é‡Šï¼šé€šè¿‡ deployment.yaml æ–‡ä»¶å»åˆ é™¤å¯¹åº”Deploymentâ€Œã€‚ æŸ¥è¯¢ Deployment èµ„æºæ–‡ä»¶ï¼š å‘½ä»¤ï¼škubectl get deploy deployName -o yaml è§£é‡Šï¼škubectl get deploy myapp-deploy -o yaml æŸ¥çœ‹myapp-deployèµ„æºæ–‡ä»¶ â€Œæ£€æŸ¥æ»šåŠ¨æ›´æ–°çŠ¶æ€â€Œï¼š å‘½ä»¤ï¼škubectl rollout status deployments nginx-deployment â€ŒåŠŸèƒ½ï¼šæ­¤å‘½ä»¤ç”¨äºæ£€æŸ¥ nginx-deployment çš„æ»šåŠ¨æ›´æ–°æ˜¯å¦å®Œæˆï¼Œä»¥åŠå½“å‰çš„çŠ¶æ€ã€‚ â€ŒæŸ¥çœ‹å†å²è®°å½•â€Œï¼š å‘½ä»¤ï¼škubectl rollout history deployment/nginx-deployment â€ŒåŠŸèƒ½ï¼šåˆ—å‡º nginx-deployment çš„æ‰€æœ‰å†å²ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬æ¯ä¸ªç‰ˆæœ¬çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚åˆ›å»ºæ—¶é—´å’Œå“ˆå¸Œå€¼ã€‚ â€Œå›æ»šåˆ°ç‰¹å®šç‰ˆæœ¬â€Œï¼š å‘½ä»¤ï¼škubectl rollout undo deployment/nginx-deployment --to-revision=2 â€ŒåŠŸèƒ½ï¼šå°† nginx-deployment å›æ»šåˆ°ç¬¬ 2 ä¸ªç‰ˆæœ¬ã€‚è¿™å¯¹äºä¿®å¤é”™è¯¯æˆ–æ¢å¤åˆ°ç¨³å®šçŠ¶æ€éå¸¸æœ‰ç”¨ã€‚ â€Œæš‚åœæ»šåŠ¨æ›´æ–°â€Œï¼š å‘½ä»¤ï¼škubectl rollout pause deployment/nginx-deployment â€ŒåŠŸèƒ½ï¼šæš‚åœ nginx-deployment çš„å½“å‰æ»šåŠ¨æ›´æ–°ã€‚è¿™å¯ä»¥åœ¨éœ€è¦æš‚åœæ›´æ–°ä»¥è¿›è¡Œå…¶ä»–æ“ä½œæ—¶ä½¿ç”¨ã€‚ æ›´æ–°ç­–ç•¥åœ¨å‡çº§æ—¶ï¼ŒDeploymentèƒ½ç¡®ä¿åªæœ‰ä¸€å®šæ•°é‡çš„Podå¤„äºdownçŠ¶æ€ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¼šä¿è¯è‡³å°‘æœ‰æ¯”æœŸæœ›Podæ•°é‡å°‘ä¸€ä¸ªçš„Podå¤„äºupçŠ¶æ€ï¼ˆå³â€Œæœ€å¤šä¸€ä¸ªPodä¸å¯ç”¨â€Œï¼‰ã€‚ åŒæ—¶ï¼ŒDeploymentä¹Ÿèƒ½ç¡®ä¿åªåˆ›å»ºå‡ºè¶…è¿‡æœŸæœ›æ•°é‡çš„ä¸€å®šæ•°é‡çš„Podã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¼šç¡®ä¿æœ€å¤šæ¯”æœŸæœ›Podæ•°é‡å¤šä¸€ä¸ªçš„Podå¤„äºupçŠ¶æ€ï¼ˆå³â€Œæœ€å¤šä¸€ä¸ªsurgeâ€Œï¼‰ã€‚ åœ¨ï¼ˆapiVersion: apps/v1ï¼‰ç‰ˆæœ¬çš„Kubernetesä¸­ï¼Œå…³äºPodæ•°é‡æ§åˆ¶çš„ç­–ç•¥å°†ä»å½“å‰çš„1-1ï¼ˆå³ä¸€ä¸ªdownï¼Œä¸€ä¸ªsurgeï¼‰å˜æˆ25%-25%ï¼ˆå³25%çš„Podå¯èƒ½å¤„äºdownçŠ¶æ€ï¼ŒåŒæ—¶å…è®¸25%çš„é¢å¤–Podå¤„äºupçŠ¶æ€ï¼‰ã€‚ ç­–ç•¥ç±»å‹ä½¿ç”¨kubectl explainå‘½ä»¤è¯»å–Kuberneteséƒ¨ç½²ï¼ˆDeploymentï¼‰çš„spec.strategy.typeå­—æ®µå†…å®¹æ—¶ï¼Œå¯ä»¥äº†è§£åˆ°éƒ¨ç½²ç­–ç•¥çš„ç›¸å…³ä¿¡æ¯ï¼Œå…·ä½“å¦‚ä¸‹ï¼š â€ŒRecreateâ€Œï¼šé‡æ–°åˆ›å»ºæ–¹å¼ï¼Œå³å…ˆåœæ­¢æ‰€æœ‰æ—§ç‰ˆæœ¬Podï¼Œå†åˆ›å»ºæ–°ç‰ˆæœ¬Podã€‚ â€ŒrollingUpdateâ€Œï¼šæ»šåŠ¨æ›´æ–°æ–¹å¼ï¼Œé€æ­¥æ›¿æ¢æ—§ç‰ˆæœ¬Podä¸ºæ–°ç‰ˆæœ¬ï¼Œä»¥å‡å°‘æœåŠ¡ä¸­æ–­ã€‚ â€ŒmaxSurgeâ€Œï¼šæŒ‡å®šæ»šåŠ¨æ›´æ–°è¿‡ç¨‹ä¸­å…è®¸è¶…å‡ºæœŸæœ›å‰¯æœ¬æ•°çš„æ•°é‡ï¼Œæœ‰ä¸¤ç§æŒ‡å®šæ–¹å¼ï¼š æŒ‡å®šæ•°é‡â€Œï¼šç›´æ¥ç»™å‡ºå…·ä½“çš„è¶…å‡ºå‰¯æœ¬æ•°ã€‚ â€Œç™¾åˆ†æ¯”â€Œï¼šä»¥æœŸæœ›å‰¯æœ¬æ•°çš„ç™¾åˆ†æ¯”å½¢å¼ç»™å‡ºã€‚ â€ŒmaxUnavailableâ€Œï¼šæŒ‡å®šåœ¨æ»šåŠ¨æ›´æ–°è¿‡ç¨‹ä¸­å…è®¸çš„æœ€å¤§ä¸å¯ç”¨Podæ•°é‡ï¼Œç¡®ä¿æœåŠ¡çš„é«˜å¯ç”¨æ€§ã€‚ è¿™äº›å‚æ•°å…±åŒæ§åˆ¶äº† Kubernetes éƒ¨ç½²çš„æ›´æ–°ç­–ç•¥ï¼Œä½¿å¾—ç®¡ç†å‘˜å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚çµæ´»é…ç½®æ›´æ–°æ–¹å¼ï¼Œä»¥å‡å°‘å¯¹ä¸šåŠ¡çš„å½±å“ã€‚ æ¸…ç†ç­–ç•¥å¯ä»¥é€šè¿‡è®¾ç½® .spec.revisionHistoryLimit é¡¹æ¥æ§åˆ¶ deployment çš„ revision å†å²è®°å½•æ•°é‡ã€‚â€Œé»˜è®¤æƒ…å†µä¸‹â€Œï¼Œç³»ç»Ÿä¼šä¿ç•™æ‰€æœ‰çš„ revision å†å²è®°å½•ã€‚å¦‚æœå°† .spec.revisionHistoryLimit è®¾ç½®ä¸º â€Œ0â€Œï¼Œåˆ™ Deployment å°†ä¸å…è®¸è¿›è¡Œå›é€€æ“ä½œï¼Œå³ä¸ä¼šä¿ç•™ä»»ä½•å†å²ç‰ˆæœ¬ã€‚ é‡‘ä¸é›€éƒ¨ç½²é‡‘ä¸é›€éƒ¨ç½²çš„åå­—æ¥æºäº17ä¸–çºªè‹±å›½çŸ¿äº•çš„ä¸€ä¸ªä¼ ç»Ÿæ–¹æ³•ï¼š â€Œä¸€ã€å‘½åç”±æ¥â€Œå·¥äººä»¬ä½¿ç”¨é‡‘ä¸é›€ä½œä¸ºç“¦æ–¯æ£€æµ‹æŒ‡æ ‡ï¼Œå› ä¸ºé‡‘ä¸é›€å¯¹ç“¦æ–¯æ°”ä½“ååˆ†æ•æ„Ÿï¼Œå¾®é‡ç“¦æ–¯å°±èƒ½è®©å…¶åœæ­¢æ­Œå”±ï¼Œé«˜æµ“åº¦æ—¶åˆ™ä¼šæ¯’å‘èº«äº¡ï¼Œä»è€Œæé†’å·¥äººç´§æ€¥æ’¤ç¦»ã€‚ â€ŒäºŒã€æ ¸å¿ƒæ€æƒ³â€Œåœ¨å®é™…è¿è¡Œç¯å¢ƒä¸­ï¼Œé‡‘ä¸é›€éƒ¨ç½²ä»…é’ˆå¯¹ä¸€å°éƒ¨åˆ†ç”¨æˆ·æˆ–æµé‡æµ‹è¯•æ–°ç‰ˆæœ¬è½¯ä»¶ï¼Œè€Œå¤§éƒ¨åˆ†ç”¨æˆ·æˆ–æµé‡ç»§ç»­ä½¿ç”¨æ—§ç‰ˆæœ¬ã€‚è¿™ç§æ–¹æ³•å¯ä»¥åŠæ—©å‘ç°æ–°ç‰ˆæœ¬ä¸­çš„æ½œåœ¨é—®é¢˜ï¼Œå‡å°‘å¯¹æ•´ä¸ªç³»ç»Ÿçš„å†²å‡»ã€‚ â€Œä¸‰ã€å®æ–½æ•ˆæœâ€Œé€šè¿‡å¯¹æ–°ç‰ˆæœ¬è¿›è¡Œæœ‰é™èŒƒå›´çš„å®æ—¶æµ‹è¯•å’Œç›‘æ§ï¼Œç¡®ä¿æ–°ç‰ˆæœ¬åœ¨å…¨é¢æ¨å¹¿å‰å·²ç»è¿‡å……åˆ†éªŒè¯ï¼Œæé«˜äº†è½¯ä»¶éƒ¨ç½²çš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚ kubectl patch deployment deployment-demo -p spec:strategy:rollingUpdate:maxSurge:1,maxUnavailable:0#â€Œæ›´æ–°æ»šåŠ¨æ›´æ–°ç­–ç•¥â€Œï¼š#ä½¿ç”¨ kubectl patch å‘½ä»¤æ›´æ–° deployment-demo Deployment çš„æ»šåŠ¨æ›´æ–°ç­–ç•¥ã€‚# -maxSurge: 1 è¡¨ç¤ºåœ¨æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œå…è®¸æœ€å¤šæ¯”æœŸæœ›å‰¯æœ¬æ•°å¤šä¸€ä¸ªçš„å‰¯æœ¬å­˜åœ¨ã€‚# -maxUnavailable: 0 è¡¨ç¤ºåœ¨æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œä¸å…è®¸æœ‰ä»»ä½•å‰¯æœ¬å¤„äºä¸å¯ç”¨çŠ¶æ€ã€‚kubectl patch deployment deployment-demo --patch spec:template:spec:containers:[name:deployment-demo-container,image:wangyanglinux/myapp:v2.0] kubectl rollout pause deploy deployment-demo#æ›´æ–°å®¹å™¨é•œåƒâ€Œï¼š#å†æ¬¡ä½¿ç”¨ kubectl patch å‘½ä»¤ï¼Œè¿™æ¬¡æ˜¯ä¸ºäº†æ›´æ–° deployment-demo Deployment ä¸­å®¹å™¨çš„é•œåƒã€‚#å°†å®¹å™¨ deployment-demo-container çš„é•œåƒæ›´æ–°ä¸º wangyanglinux/myapp:v2.0ã€‚#ä½¿ç”¨ è¿æ¥äº† kubectl rollout pause deploy deployment-demo å‘½ä»¤ï¼Œç”¨äºåœ¨é•œåƒæ›´æ–°åç«‹å³æš‚åœ Deployment çš„æ»šåŠ¨æ›´æ–°ï¼Œç¡®ä¿æ›´æ–°è¿‡ç¨‹çš„å®‰å…¨æ€§ã€‚â€Œkubectl rollout resume deploy deployment-demo#æ¢å¤æ»šåŠ¨æ›´æ–°â€Œï¼š#ä½¿ç”¨ kubectl rollout resume deploy deployment-demo å‘½ä»¤æ¢å¤ Deployment çš„æ»šåŠ¨æ›´æ–°ã€‚#è¿™å…è®¸ Kubernetes æ ¹æ®æ–°çš„é…ç½®å’Œé•œåƒå¯åŠ¨æ–°çš„å‰¯æœ¬ï¼Œå®Œæˆæ•´ä¸ªæ›´æ–°è¿‡ç¨‹ã€‚ DaemonSetDaemonSet ç¡®ä¿åœ¨å…¨éƒ¨æˆ–éƒ¨åˆ† Node ä¸Šè¿è¡Œä¸€ä¸ª Pod çš„å‰¯æœ¬ã€‚å…·ä½“ç‰¹æ€§å¦‚ä¸‹ï¼š â€ŒåŠ¨æ€è°ƒæ•´â€Œï¼šå½“æœ‰æ–° Node åŠ å…¥é›†ç¾¤æ—¶ï¼Œä¼šè‡ªåŠ¨ä¸ºå…¶æ–°å¢ä¸€ä¸ª Podï¼›è‹¥ Node ä»é›†ç¾¤ç§»é™¤ï¼Œç›¸åº”çš„ Pod ä¹Ÿä¼šè¢«å›æ”¶ã€‚ â€Œåˆ é™¤æœºåˆ¶â€Œï¼šåˆ é™¤ DaemonSet ä¼šå¯¼è‡´å…¶åˆ›å»ºçš„æ‰€æœ‰ Pod è¢«åˆ é™¤ã€‚ â€Œå…¸å‹ç”¨æ³•â€Œï¼š â€Œé›†ç¾¤å­˜å‚¨â€Œï¼šåœ¨æ¯ä¸ª Node ä¸Šè¿è¡Œå¦‚ glusterdã€ceph ç­‰å­˜å‚¨ daemonã€‚ â€Œæ—¥å¿—æ”¶é›†â€Œï¼šåˆ©ç”¨ fluentdã€logstash ç­‰å·¥å…·åœ¨æ¯ä¸ª Node ä¸Šæ”¶é›†æ—¥å¿—ã€‚ â€Œç³»ç»Ÿç›‘æ§â€Œï¼šåœ¨æ¯ä¸ª Node éƒ¨ç½² Prometheus Node Exporterã€collectdã€Datadog ä»£ç†ã€New Relic ä»£ç†æˆ– Ganglia gmond è¿›è¡Œç›‘æ§ã€‚ apiVersion: apps/v1kind: DaemonSetmetadata: name: daemonset-demo labels: app: daemonset-demospec: selector: matchLabels: name: daemonset-demo template: metadata: labels: name: daemonset-demo spec: containers: - name: daemonset-demo-container image: wangyanglinux/myapp:v1.0 kubectl apply -f 6-daemonset-demo.yaml å¯ä»¥çœ‹åˆ° pod è¿è¡Œåœ¨äº† node2, node3èŠ‚ç‚¹ã€‚ æ³¨æ„ï¼š master èŠ‚ç‚¹é»˜è®¤æ˜¯æ±¡ç‚¹èŠ‚ç‚¹ä¸å‚ä¸è°ƒåº¦ Jobæ§åˆ¶å™¨Jobè´Ÿè´£æ‰¹å¤„ç†ä»»åŠ¡ï¼Œç¡®ä¿ä»»åŠ¡çš„ä¸€æ¬¡æ€§æˆåŠŸæ‰§è¡Œï¼Œå¯ç®¡ç†ä¸€ä¸ªæˆ–å¤šä¸ªPodã€‚ â€Œå…³é”®å‚æ•°â€Œï¼š â€Œspec.templateï¼šæ ¼å¼ä¸Podç›¸åŒï¼Œå®šä¹‰äº†Jobä¸­Podçš„æ¨¡æ¿ã€‚ â€ŒRestartPolicyï¼šä»…æ”¯æŒNeverï¼ˆä»ä¸é‡å¯ï¼‰æˆ–OnFailureï¼ˆå¤±è´¥æ—¶é‡å¯ï¼‰ï¼Œæ§åˆ¶Podçš„é‡å¯ç­–ç•¥ã€‚ â€ŒPodç»“æŸæ¡ä»¶â€Œï¼šå•ä¸ªPodæˆåŠŸè¿è¡Œåï¼Œé»˜è®¤Jobç»“æŸï¼ˆé»˜è®¤è¿”å›ç ä¸º 0 æ—¶æ‰æ˜¯æˆåŠŸï¼‰ã€‚ .spec.completionsï¼šâ€Œæ ‡å¿—Jobå®Œæˆæ‰€éœ€æˆåŠŸè¿è¡Œçš„Podæ•°é‡â€Œï¼Œé»˜è®¤ä¸º1ã€‚ .spec.parallelismï¼šâ€Œæ ‡å¿—å¹¶è¡Œè¿è¡Œçš„Podæ•°é‡â€Œï¼Œé»˜è®¤ä¸º1ã€‚ .spec.activeDeadlineSecondsï¼šâ€Œè®¾ç½®å¤±è´¥Podçš„é‡è¯•æœ€å¤§æ—¶é•¿â€Œï¼Œè¶…è¿‡åˆ™ä¸å†é‡è¯•ã€‚ è®¡ç®— P çš„å€¼# -*- coding: utf-8 -*-from __future__ import division# å¯¼å…¥æ—¶é—´æ¨¡å—import time# è®¡ç®—å½“å‰æ—¶é—´time1=time.time()# ç®—æ³•æ ¹æ®é©¬é’å…¬å¼è®¡ç®—åœ†å‘¨ç‡ #number = 1000# å¤šè®¡ç®—10ä½ï¼Œé˜²æ­¢å°¾æ•°å–èˆçš„å½±å“number1 = number+10# ç®—åˆ°å°æ•°ç‚¹ånumber1ä½b = 10**number1# æ±‚å«4/5çš„é¦–é¡¹x1 = b*4//5# æ±‚å«1/239çš„é¦–é¡¹x2 = b // -239# æ±‚ç¬¬ä¸€å¤§é¡¹he = x1+x2#è®¾ç½®ä¸‹é¢å¾ªç¯çš„ç»ˆç‚¹ï¼Œå³å…±è®¡ç®—né¡¹number *= 2#å¾ªç¯åˆå€¼=3ï¼Œæœ«å€¼2n,æ­¥é•¿=2for i in xrange(3,number,2):# æ±‚æ¯ä¸ªå«1/5çš„é¡¹åŠç¬¦å·x1 //= -25# æ±‚æ¯ä¸ªå«1/239çš„é¡¹åŠç¬¦å·x2 //= -57121# æ±‚ä¸¤é¡¹ä¹‹å’Œx = (x1+x2) // i# æ±‚æ€»å’Œhe += x# æ±‚å‡ºÏ€pai = he*4#èˆæ‰ååä½pai //= 10**10# è¾“å‡ºåœ†å‘¨ç‡Ï€çš„å€¼paistring=str(pai)result=paistring[0]+str(.)+paistring[1:len(paistring)]print resulttime2=time.time()print uTotal time: + str(time2 - time1) + s apiVersion: batch/v1kind: Jobmetadata: name: job-demospec: template: metadata: name: job-demo-pod spec: containers: - name: job-demo-container image: wangyanglinux/tools:maqingpythonv1 restartPolicy: Never kubectl apply -f 6-daemonset-demo.yaml æ§åˆ¶é”™è¯¯ç è¿”å›ä¸º 1apiVersion: batch/v1kind: Jobmetadata: name: randspec: template: metadata: name: rand spec: containers: - name: rand image: wangyanglinux/tools:randexitv1 args: [--exitcode=1] restartPolicy: Never ä»»åŠ¡æœ€ç»ˆæ‰§è¡Œå¤±è´¥ éšæœºç”Ÿæˆè¿”å›ç apiVersion: batch/v1kind: Jobmetadata: name: randspec: completions: 10 parallelism: 5 template: metadata: name: rand spec: containers: - name: rand image: wangyanglinux/tools:randexitv1 restartPolicy: Never Cron JobCron Jobä¸»è¦ç”¨äºç®¡ç†åŸºäºæ—¶é—´çš„ä»»åŠ¡ï¼Œå…·ä½“åŠŸèƒ½åŒ…æ‹¬ï¼š â€Œåœ¨ç‰¹å®šæ—¶é—´ç‚¹è¿è¡Œä¸€æ¬¡â€Œï¼šé€‚ç”¨äºéœ€è¦åœ¨æŸä¸ªå…·ä½“æ—¶é—´ç‚¹æ‰§è¡Œçš„ä»»åŠ¡ã€‚ â€Œå‘¨æœŸæ€§è¿è¡Œâ€Œï¼šå¯è®¾å®šåœ¨å›ºå®šçš„æ—¶é—´ç‚¹å‘¨æœŸæ€§åœ°æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æ¯å¤©ã€æ¯å‘¨ç­‰ã€‚ â€Œå…¸å‹ç”¨æ³•ï¼š â€Œè°ƒåº¦ä»»åŠ¡â€Œï¼šæ ¹æ®è®¾å®šçš„æ—¶é—´ç‚¹è‡ªåŠ¨è°ƒåº¦ä»»åŠ¡è¿è¡Œã€‚ â€Œå‘¨æœŸæ€§ä»»åŠ¡â€Œï¼šå¦‚â€Œæ•°æ®åº“å¤‡ä»½â€Œã€â€Œå‘é€é‚®ä»¶â€Œç­‰ï¼Œå¯å¤§å¤§ç®€åŒ–è¿ç»´å·¥ä½œã€‚ â€Œä½¿ç”¨æ¡ä»¶â€Œï¼šéœ€ç¡®ä¿Kubernetesé›†ç¾¤ç‰ˆæœ¬â€Œå¤§äºç­‰äº1.8â€Œï¼Œä»¥æ”¯æŒCronJobåŠŸèƒ½ã€‚ æ³¨æ„ï¼šåˆ›å»º Job çš„æ“ä½œåº”è¯¥æ˜¯å¹‚ç­‰çš„ã€‚ å¸¸ç”¨å‚æ•°ï¼š â€Œ.spec.scheduleï¼šè°ƒåº¦ï¼Œå¿…éœ€å­—æ®µï¼Œç”¨äºæŒ‡å®šä»»åŠ¡çš„è¿è¡Œå‘¨æœŸï¼Œæ ¼å¼ä¸Cronç›¸åŒã€‚ â€Œ.spec.jobTemplateï¼šJobæ¨¡æ¿ï¼Œå¿…éœ€å­—æ®µï¼Œç”¨äºæŒ‡å®šéœ€è¦è¿è¡Œçš„ä»»åŠ¡ï¼Œæ ¼å¼ä¸Jobç›¸åŒã€‚ â€Œ.spec.startingDeadlineSecondsï¼šå¯åŠ¨Jobçš„æœŸé™ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ï¼Œè¯¥å­—æ®µå¯é€‰ã€‚è‹¥å› ä»»ä½•åŸå› é”™è¿‡è°ƒåº¦æ—¶é—´ï¼Œåˆ™é”™è¿‡æ‰§è¡Œæ—¶é—´çš„Jobå°†è¢«è§†ä¸ºå¤±è´¥ã€‚è‹¥æœªæŒ‡å®šï¼Œåˆ™æ— æœŸé™é™åˆ¶ã€‚ â€Œ.spec.concurrencyPolicyï¼šå¹¶å‘ç­–ç•¥ï¼Œè¯¥å­—æ®µå¯é€‰ã€‚ç”¨äºæŒ‡å®šå¦‚ä½•å¤„ç†ç”±CronJobåˆ›å»ºçš„Jobçš„å¹¶å‘æ‰§è¡Œï¼Œç­–ç•¥åŒ…æ‹¬ï¼š Allowï¼ˆé»˜è®¤ï¼‰ï¼šå…è®¸å¹¶å‘è¿è¡ŒJobã€‚ Forbidï¼šç¦æ­¢å¹¶å‘è¿è¡Œï¼Œè‹¥å‰ä¸€ä¸ªJobæœªå®Œæˆï¼Œåˆ™è·³è¿‡ä¸‹ä¸€ä¸ªã€‚ Replaceï¼šå–æ¶ˆå½“å‰æ­£åœ¨è¿è¡Œçš„Jobï¼Œç”¨æ–°çš„Jobæ›¿æ¢ã€‚ æ³¨æ„â€Œï¼šå¹¶å‘ç­–ç•¥ä»…é€‚ç”¨äºç”±åŒä¸€ä¸ª CronJob åˆ›å»ºçš„ Jobã€‚è‹¥å­˜åœ¨å¤šä¸ª CronJobï¼Œå®ƒä»¬åˆ›å»ºçš„ Job ä¹‹é—´å…è®¸å¹¶å‘è¿è¡Œã€‚ â€Œ.spec.suspendâ€Œï¼šæ­¤å­—æ®µç”¨äºæŒ‚èµ·Jobçš„æ‰§è¡Œï¼Œæ˜¯å¯é€‰çš„ã€‚è‹¥è®¾ç½®ä¸ºtrueï¼Œåˆ™åç»­æ‰€æœ‰è®¡åˆ’ä¸­çš„Jobæ‰§è¡Œéƒ½ä¼šè¢«æŒ‚èµ·ã€‚ä½†è¯·æ³¨æ„ï¼Œå®ƒå¯¹å·²ç»å¼€å§‹æ‰§è¡Œçš„Jobæ²¡æœ‰å½±å“ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å­—æ®µçš„å€¼ä¸ºfalseã€‚ â€Œspec.successfulJobsHistoryLimitâ€Œ å’Œ â€Œ.spec.failedJobsHistoryLimitâ€Œï¼šè¿™ä¸¤ä¸ªå­—æ®µç”¨äºè®¾ç½®æˆåŠŸå’Œå¤±è´¥Jobçš„å†å²è®°å½•ä¿ç•™æ•°é‡ï¼ŒåŒæ ·æ˜¯å¯é€‰çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒæˆåŠŸJobçš„å†å²è®°å½•ä¿ç•™æ•°é‡ä¸º3ï¼Œå¤±è´¥Jobçš„ä¿ç•™æ•°é‡ä¸º1ã€‚å¦‚æœå°†è¿™ä¸¤ä¸ªå­—æ®µçš„å€¼è®¾ç½®ä¸º0ï¼Œåˆ™ç›¸å…³ç±»å‹çš„Jobå®Œæˆåå°†ä¸ä¼šè¢«ä¿ç•™ã€‚ apiVersion: batch/v1kind: CronJobmetadata: name: cronjob-demospec: # æ¯éš”ä¸€åˆ†é’Ÿè°ƒä¸€æ¬¡ schedule: */1 * * * * jobTemplate: spec: # æˆåŠŸ 3 ä¸ª pod ä»»åŠ¡æ‰ç®—æˆåŠŸ completions: 3 template: spec: containers: - name: cronjob-demo-container image: busybox args: - /bin/sh - -c - date; echo Hello from the Kubernetes cluster restartPolicy: OnFailure","tags":[null],"categories":[null]},{"title":"Kubernetesè°ƒåº¦å™¨","path":"/wiki/Kubernetes/è°ƒåº¦å™¨.html","content":"è°ƒåº¦å™¨è°ƒåº¦å™¨æ ¸å¿ƒæ¦‚å¿µKubernetesè°ƒåº¦å™¨(kube-scheduler)æ˜¯é›†ç¾¤æ§åˆ¶å¹³é¢çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£å°†æ–°åˆ›å»ºçš„Podåˆ†é…åˆ°åˆé€‚çš„èŠ‚ç‚¹(Node)ä¸Šè¿è¡Œã€‚ è°ƒåº¦å™¨æ ¸å¿ƒä½œç”¨ â€Œèµ„æºåŒ¹é…â€Œï¼šæ ¹æ®Podçš„èµ„æºè¯·æ±‚(CPUå†…å­˜ç­‰)å’ŒèŠ‚ç‚¹å¯ç”¨èµ„æºè¿›è¡ŒåŒ¹é…â€Œã€‚ â€Œç­–ç•¥æ‰§è¡Œâ€Œï¼šé€šè¿‡é¢„è®¾è§„åˆ™(å¦‚èŠ‚ç‚¹äº²å’Œæ€§ã€æ±¡ç‚¹å®¹å¿ç­‰)ä¼˜åŒ–Podåˆ†å¸ƒâ€Œã€‚ â€Œé«˜å¯ç”¨ä¿éšœâ€Œï¼šç¡®ä¿Podåˆ†æ•£åœ¨å¤šä¸ªèŠ‚ç‚¹ï¼Œé¿å…å•ç‚¹æ•…éšœâ€Œã€‚ è°ƒåº¦ä¸‰é˜¶æ®µæµç¨‹ â€Œé¢„é€‰é˜¶æ®µ(PredicatesFilter) è¿‡æ»¤ä¸ç¬¦åˆç¡¬æ€§æ¡ä»¶çš„èŠ‚ç‚¹ï¼Œæ£€æŸ¥é¡¹åŒ…æ‹¬ï¼š èµ„æºå¯ç”¨æ€§(èŠ‚ç‚¹å‰©ä½™èµ„æº â‰¥ Podè¯·æ±‚)â€Œ èŠ‚ç‚¹é€‰æ‹©å™¨(nodeSelector)åŒ¹é…â€Œ æ±¡ç‚¹å®¹å¿(Taints Tolerations)â€Œ Podäº²å’Œæ€§è§„åˆ™(Pod Affinity)â€Œ â€Œä¼˜é€‰é˜¶æ®µ(PrioritiesScore) å¯¹é€šè¿‡é¢„é€‰çš„èŠ‚ç‚¹è¿›è¡Œå¤šç»´è¯„åˆ†ï¼š èµ„æºå‡è¡¡(åˆ©ç”¨ç‡è¶Šä½å¾—åˆ†è¶Šé«˜)â€Œ é•œåƒæœ¬åœ°åŒ–(å·²å­˜åœ¨æ‰€éœ€é•œåƒçš„èŠ‚ç‚¹ä¼˜å…ˆ)â€Œ æ‹“æ‰‘åˆ†å¸ƒ(åŒå¯ç”¨åŒºæœºæ¶ä¼˜å…ˆ)â€Œ æœ€ç»ˆé€‰æ‹©ç»¼åˆå¾—åˆ†æœ€é«˜çš„èŠ‚ç‚¹â€Œ â€Œç»‘å®šé˜¶æ®µ(Binding) å°†Podçš„nodeNameå­—æ®µè®¾ç½®ä¸ºé€‰ä¸­èŠ‚ç‚¹å¹¶å†™å…¥etcdâ€Œ ç›®æ ‡èŠ‚ç‚¹çš„kubeletç›‘å¬åˆ°å˜åŒ–åå¯åŠ¨Podâ€Œ å…³é”®è°ƒåº¦ç­–ç•¥ â€ŒèŠ‚ç‚¹äº²å’Œæ€§(Node Affinity) requiredDuringScheduling: å¿…é¡»æ»¡è¶³çš„ç¡¬æ€§è§„åˆ™â€Œ preferredDuringScheduling: ä¼˜å…ˆæ»¡è¶³çš„è½¯æ€§è§„åˆ™â€Œ â€Œæ±¡ç‚¹ä¸å®¹å¿(Taints Tolerations) é€šè¿‡æ±¡ç‚¹æ ‡è®°èŠ‚ç‚¹ç‰¹æ®ŠçŠ¶æ€(å¦‚ä¸“ç”¨èŠ‚ç‚¹)â€Œ Podéœ€å£°æ˜å¯¹åº”å®¹å¿æ‰èƒ½è°ƒåº¦â€Œ â€Œä¼˜å…ˆçº§ä¸æŠ¢å (Priority Preemption) é«˜ä¼˜å…ˆçº§Podå¯æŠ¢å ä½ä¼˜å…ˆçº§Podçš„èµ„æºâ€Œ éœ€é¢„å…ˆå®šä¹‰PriorityClasså¯¹è±¡â€Œ æ¶æ„æ¼”è¿›ä»Kubernetes 1.15å¼€å§‹ï¼Œè°ƒåº¦æ¡†æ¶é€æ­¥ä»PredicatesPrioritiesä¸¤é˜¶æ®µæ¨¡å‹è½¬å˜ä¸ºå¤šé˜¶æ®µæ’ä»¶æ¶æ„(FilterScore)ï¼Œå¢å¼ºäº†æ‰©å±•æ€§å’Œç²¾ç»†åŒ–æ§åˆ¶èƒ½åŠ›â€Œã€‚å½“å‰ä¸»æµç‰ˆæœ¬æ”¯æŒé€šè¿‡ComponentConfigçµæ´»é…ç½®æ’ä»¶åŠå…¶æ‰§è¡Œé¡ºåºâ€Œã€‚ å…¸å‹è°ƒåº¦è¿‡ç¨‹ç¤ºä¾‹ï¼šå½“åˆ›å»ºéœ€2æ ¸CPUçš„Podæ—¶ï¼Œè°ƒåº¦å™¨ä¼šå…ˆè¿‡æ»¤å‡ºå‰©ä½™CPUâ‰¥2æ ¸çš„èŠ‚ç‚¹ï¼Œå†æ ¹æ®èµ„æºå‡è¡¡ã€äº²å’Œæ€§ç­‰ç­–ç•¥é€‰æ‹©æœ€ä¼˜èŠ‚ç‚¹ï¼Œæœ€ç»ˆå®Œæˆç»‘å®šå¹¶è§¦å‘Podåˆ›å»ºâ€Œã€‚ è°ƒåº¦å™¨å®éªŒ# åœ¨ kubernetes Master èŠ‚ç‚¹å¼€å¯ apiServer çš„ä»£ç†kubectl proxy --port=8001 # åŸºäº shell ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰è°ƒåº¦å™¨# vi my-scheduler.sh# yum -y install epel-release# yum -y install jq#!/bin/bashSERVER=localhost:8001while true; do # è·å–ä½¿ç”¨my-schedulerä¸”æœªåˆ†é…èŠ‚ç‚¹çš„Podåˆ—è¡¨ for PODNAME in $(kubectl --server $SERVER get pods -o json | jq .items[] | select(.spec.schedulerName == my-scheduler) | select(.spec.nodeName == null) | .metadata.name | tr -d ) do # è·å–æ‰€æœ‰èŠ‚ç‚¹åˆ—è¡¨ NODES=($(kubectl --server $SERVER get nodes -o json | jq .items[].metadata.name | tr -d )) NUMNODES=$#NODES[@] # éšæœºé€‰æ‹©èŠ‚ç‚¹ CHOSEN=$NODES[$[ $RANDOM % $NUMNODES ]] # åˆ›å»ºç»‘å®šè¯·æ±‚ curl --header Content-Type:application/json --request POST --data apiVersion:v1,kind:Binding,metadata: name:$PODNAME,target:apiVersion:v1,kind: Node, name: $CHOSEN http://$SERVER/api/v1/namespaces/default/pods/$PODNAME/binding/ echo Assigned $PODNAME to $CHOSEN done sleep 1done # ä¸æŒ‡å®šè°ƒåº¦å™¨apiVersion: apps/v1kind: Deploymentmetadata: labels: app: myapp name: myappspec: replicas: 1 selector: matchLabels: app: myapp template: metadata: labels: app: myapp spec: containers: - image: wangyanglinux/myapp:v1.0 name: myapp vi 1-pod-demo.yamlkubectl create -f 1-pod-demo.yaml -o yaml ä¸æŒ‡å®šè°ƒåº¦å™¨ï¼Œé»˜è®¤ä½¿ç”¨ default-scheduler apiVersion: apps/v1kind: Deploymentmetadata: labels: app: myapp name: myappspec: replicas: 1 selector: matchLabels: app: myapp template: metadata: labels: app: myapp spec: schedulerName: my-scheduler containers: - image: wangyanglinux/myapp:v1.0 name: myapp chmod 777 my-scheduler.shsh my-scheduler.shkubectl apply -f 2-pod-my-scheduler.yaml èŠ‚ç‚¹äº²å’Œæ€§KubernetesèŠ‚ç‚¹äº²å’Œæ€§(Node Affinity)æ˜¯é€šè¿‡èŠ‚ç‚¹æ ‡ç­¾æ§åˆ¶Podè°ƒåº¦çš„æ ¸å¿ƒæœºåˆ¶ï¼Œç›¸æ¯”ç®€å•çš„nodeSelectoræä¾›æ›´ç²¾ç»†åŒ–çš„è°ƒåº¦ç­–ç•¥â€Œã€‚ èŠ‚ç‚¹äº²å’Œæ€§åŸºæœ¬æ¦‚å¿µèŠ‚ç‚¹äº²å’Œæ€§å…è®¸åŸºäºèŠ‚ç‚¹æ ‡ç­¾å®šä¹‰è°ƒåº¦è§„åˆ™ï¼Œå†³å®šPodåº”è¯¥(æˆ–ä¸åº”è¯¥)è¿è¡Œåœ¨å“ªäº›èŠ‚ç‚¹ä¸Šâ€Œã€‚ â€Œå®šå‘è°ƒåº¦â€Œï¼šå¦‚å°†GPUåº”ç”¨è°ƒåº¦åˆ°å¸¦GPUæ ‡ç­¾çš„èŠ‚ç‚¹â€Œã€‚ â€Œæ‹“æ‰‘çº¦æŸâ€Œï¼šå¦‚å°†æœåŠ¡åˆ†æ•£åˆ°ä¸åŒå¯ç”¨åŒºå®ç°é«˜å¯ç”¨â€Œã€‚ èŠ‚ç‚¹äº²å’Œæ€§æ ¸å¿ƒç±»å‹ç¡¬äº²å’Œæ€§(Required) â€Œè§„åˆ™æ ‡è¯†â€Œï¼šrequiredDuringSchedulingIgnoredDuringExecution â€Œç‰¹ç‚¹â€Œï¼šå¿…é¡»æ»¡è¶³çš„å¼ºåˆ¶æ€§è§„åˆ™ï¼Œå¦åˆ™Podä¿æŒPendingçŠ¶æ€â€Œã€‚ â€Œå…¸å‹åœºæ™¯ï¼š affinity: nodeAffinity: requiredDuringSchedulingIgnoredDuringExecution: nodeSelectorTerms: - matchExpressions: - key: gpu-type operator: In values: [a100] è½¯äº²å’Œæ€§(Preferred) â€Œè§„åˆ™æ ‡è¯†â€Œï¼špreferredDuringSchedulingIgnoredDuringExecution â€Œç‰¹ç‚¹â€Œï¼šä¼˜å…ˆä½†ä¸å¼ºåˆ¶æ»¡è¶³ï¼Œé€šè¿‡æƒé‡(weight)å®ç°ä¼˜å…ˆçº§åŒºåˆ† â€Œè½¯æ€§è¦æ±‚â€Œï¼šæ¯”å¦‚ä½ å¸Œæœ›å¯¹è±¡ã€Œæœ€å¥½ã€ä¼šåšé¥­ï¼ˆæƒé‡80ï¼‰ï¼Œã€Œå…¶æ¬¡ã€å–œæ¬¢å® ç‰©ï¼ˆæƒé‡ 50ï¼‰ã€‚ä¸ä¼šåšé¥­ä¹Ÿèƒ½æ¥å—ï¼Œä½†ä¼šçš„è¯æ›´ä¼˜å…ˆè€ƒè™‘ã€‚ â€Œæƒé‡ä½œç”¨â€Œï¼šç³»ç»Ÿä¼šç»™ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹æ‰“åˆ†ï¼š ä¼šåšé¥­çš„+80åˆ† å–œæ¬¢å® ç‰©çš„+50åˆ† æœ€ç»ˆé€‰æ€»åˆ†æœ€é«˜çš„ â€Œå…œåº•æœºåˆ¶â€Œï¼šå³ä½¿æ²¡æœ‰å®Œå…¨åŒ¹é…çš„èŠ‚ç‚¹ï¼ˆæ¯”å¦‚æ²¡äººä¼šåšé¥­ï¼‰ï¼ŒPodä¹Ÿèƒ½è¢«è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ï¼Œ ä¸ä¼šå¡ä½ã€‚ â€Œå…¸å‹åœºæ™¯ï¼š affinity: nodeAffinity: preferredDuringSchedulingIgnoredDuringExecution: - weight: 80 preference: matchExpressions: - key: zone operator: In values: [east-1] å…³é”®æ“ä½œç¬¦ æ“ä½œç¬¦ ä½œç”¨ ç¤ºä¾‹åœºæ™¯ InNotIn æ ‡ç­¾å€¼æ˜¯å¦åœ¨é›†åˆå†…å¤– è°ƒåº¦åˆ°ç‰¹å®šå¯ç”¨åŒº(zoneeast)â€Œ Exists åªéœ€å­˜åœ¨æ ‡ç­¾é”®(ä¸æ ¡éªŒå€¼) è¯†åˆ«GPUèŠ‚ç‚¹(gpuæ ‡ç­¾å­˜åœ¨)â€Œ DoesNotExist æ ‡ç­¾é”®å¿…é¡»ä¸å­˜åœ¨ é¿å¼€ç»´æŠ¤èŠ‚ç‚¹(maintenanceæ ‡ç­¾)â€Œ GtLt æ•°å€¼æ¯”è¾ƒ(é€‚ç”¨äºCPUå†…å­˜ç­‰æ•°å€¼å‹æ ‡ç­¾) è¦æ±‚èŠ‚ç‚¹å‰©ä½™å†…å­˜8Giâ€Œ é«˜çº§ç‰¹æ€§ â€Œå¤šæ¡ä»¶ç»„åˆâ€Œï¼š åŒä¸€nodeSelectorTermså†…å¤šä¸ªmatchExpressionsæ˜¯ANDå…³ç³»â€Œ ä¸åŒnodeSelectorTermsä¹‹é—´æ˜¯ORå…³ç³»â€Œ nodeSelectorTerms:- matchExpressions: # å¿…é¡»åŒæ—¶æ»¡è¶³Aå’ŒB - key: A operator: Exists - key: B operator: In values: [v1]- matchExpressions: # æˆ–æ»¡è¶³C - key: C operator: Exists â€ŒåŠ¨æ€å®¹å¿â€Œï¼š IgnoredDuringExecutionè¡¨ç¤ºèŠ‚ç‚¹æ ‡ç­¾å˜åŒ–ä¸ä¼šé©±é€å·²è¿è¡Œçš„Podâ€Œ éœ€é…åˆrequiredDuringSchedulingRequiredDuringExecutionå®ç°åŠ¨æ€é‡è°ƒåº¦(å®éªŒç‰¹æ€§)â€Œ å¯¹æ¯”å…¶ä»–æœºåˆ¶ ç‰¹æ€§ nodeSelector èŠ‚ç‚¹äº²å’Œæ€§ æ±¡ç‚¹å®¹å¿ è¡¨è¾¾èƒ½åŠ› ä»…ç²¾ç¡®åŒ¹é… æ”¯æŒå¤æ‚é€»è¾‘è¿ç®—â€Œ åŸºäºæ’æ–¥æœºåˆ¶â€Œ å¼ºåˆ¶ç¨‹åº¦ å¼ºåˆ¶ å¯ç¡¬è½¯çº¦æŸâ€Œ å¼ºåˆ¶ å…¸å‹åº”ç”¨åœºæ™¯ ç®€å•ç¯å¢ƒéƒ¨ç½² ç²¾ç»†åŒ–è°ƒåº¦â€Œ èŠ‚ç‚¹éš”ç¦»ä¸“ç”¨â€Œ æœ€ä½³å®è·µ â€Œæ ‡ç­¾è§„åˆ’â€Œï¼šæå‰è®¾è®¡èŠ‚ç‚¹æ ‡ç­¾ä½“ç³»(å¦‚env=prodã€disk=ssdç­‰)â€Œ â€Œæƒé‡åˆ†é…â€Œï¼šè½¯äº²å’Œæ€§ä¸­åˆç†è®¾ç½®weight(1-100)åŒºåˆ†ä¼˜å…ˆçº§â€Œ â€Œæ‹“æ‰‘çº¦æŸâ€Œï¼šç»“åˆtopologyKeyå®ç°æœºæ¶å¯ç”¨åŒºçº§åˆ«çš„åˆ†å¸ƒâ€Œ â€Œæ€§èƒ½è€ƒé‡â€Œï¼šé¿å…ä½¿ç”¨å¤§é‡å¤æ‚è§„åˆ™å¢åŠ è°ƒåº¦å™¨è´Ÿè½½ èŠ‚ç‚¹äº²å’Œæ€§å®éªŒè½¯ç­–ç•¥apiVersion: v1kind: Podmetadata: name: node-affinity-preferred labels: app: node-affinity-preferredspec: containers: - name: node-affinity-preferred-pod image: wangyanglinux/myapp:v1.0 affinity: nodeAffinity: preferredDuringSchedulingIgnoredDuringExecution: - weight: 1 preference: matchExpressions: - key: domain operator: In values: - xinxianghf å½“å‰èŠ‚ç‚¹å¹¶æ²¡æœ‰åŒ¹é…çš„æ ‡ç­¾ï¼Œæ­¤æ—¶ pod ä¹Ÿèƒ½å¤ŸæˆåŠŸéƒ¨ç½²ã€‚ # ç»™èŠ‚ç‚¹3æ·»åŠ æ ‡ç­¾kubectl label node k8s-node03 domain=xinxianghf æ­¤æ—¶å¯ä»¥çœ‹åˆ° pod è¢«è°ƒåº¦åˆ°èŠ‚ç‚¹3äº†ã€‚ ç¡¬ç­–ç•¥apiVersion: v1kind: Podmetadata: name: node-affinity-required labels: app: node-affinity-requiredspec: containers: - name: node-affinity-required-pod image: wangyanglinux/myapp:v1.0 affinity: nodeAffinity: requiredDuringSchedulingIgnoredDuringExecution: nodeSelectorTerms: - matchExpressions: - key: kubernetes.io/hostname operator: In values: - k8s-node04 æ²¡æœ‰åŒ¹é…ä¸Šäº²å’Œæ€§çš„èŠ‚ç‚¹ pod ä¸ä¼šéƒ¨ç½²æˆåŠŸã€‚ Podäº²å’Œæ€§Kubernetes â€ŒPod äº²å’Œæ€§ï¼ˆPod Affinityï¼‰â€Œ æ˜¯ä¸€ç§è°ƒåº¦ç­–ç•¥ï¼Œç”¨äºæ§åˆ¶ Pod å¦‚ä½•ä¸å…¶ä»– Pod å…±åŒè°ƒåº¦åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ï¼ˆäº²å’Œï¼‰æˆ–é¿å…è°ƒåº¦åœ¨ä¸€èµ·ï¼ˆåäº²å’Œï¼‰ã€‚å®ƒæ¯”èŠ‚ç‚¹äº²å’Œæ€§æ›´ç²¾ç»†ï¼Œå› ä¸ºå®ƒåŸºäº â€ŒPod ä¹‹é—´çš„å…³ç³»â€Œ è€ŒéèŠ‚ç‚¹æ ‡ç­¾æ¥å†³ç­–ã€‚ â€ŒPod äº²å’Œæ€§çš„æ ¸å¿ƒæ¦‚å¿µPod äº²å’Œæ€§åˆ†ä¸ºä¸¤ç§ï¼š â€ŒPod äº²å’Œï¼ˆPod Affinityï¼‰ï¼šè®© Pod å°½é‡è°ƒåº¦åˆ°æŸäº› Pod æ‰€åœ¨çš„èŠ‚ç‚¹ï¼ˆä¾‹å¦‚ï¼šå‰ç«¯ Pod å°½é‡å’Œåç«¯ Pod åœ¨åŒä¸€èŠ‚ç‚¹ï¼‰ã€‚ â€ŒPod åäº²å’Œï¼ˆPod Anti-Affinityï¼‰ï¼šè®© Pod é¿å…è°ƒåº¦åˆ°æŸäº› Pod æ‰€åœ¨çš„èŠ‚ç‚¹ï¼ˆä¾‹å¦‚ï¼šåŒä¸€æœåŠ¡çš„å¤šä¸ªå‰¯æœ¬é¿å…åœ¨åŒä¸€èŠ‚ç‚¹ï¼Œæé«˜å®¹ç¾èƒ½åŠ›ï¼‰ã€‚ Pod äº²å’Œæ€§åŒæ ·æ”¯æŒ â€Œç¡¬æ€§ï¼ˆRequiredï¼‰ å’Œ â€Œè½¯æ€§ï¼ˆPreferredï¼‰ ä¸¤ç§è§„åˆ™ï¼š â€Œç¡¬æ€§ï¼ˆRequiredï¼‰ï¼šå¿…é¡»æ»¡è¶³ï¼Œå¦åˆ™ Pod æ— æ³•è°ƒåº¦ï¼ˆPendingï¼‰ã€‚ â€Œè½¯æ€§ï¼ˆPreferredï¼‰ï¼šå°½é‡æ»¡è¶³ï¼Œä½†ä¸å¼ºåˆ¶ï¼Œé€šè¿‡ weightï¼ˆ1-100ï¼‰è°ƒæ•´ä¼˜å…ˆçº§ã€‚ Pod äº²å’Œæ€§çš„å…³é”®é…ç½®topologyKeyï¼šå†³å®šäº²å’Œæ€§çš„ä½œç”¨èŒƒå›´Pod äº²å’Œæ€§ä¾èµ– topologyKey æ¥å®šä¹‰â€œæ‹“æ‰‘åŸŸâ€ï¼Œå¸¸è§çš„ topologyKey åŒ…æ‹¬ï¼š kubernetes.io/hostnameï¼ˆåŒä¸€èŠ‚ç‚¹ï¼‰ topology.kubernetes.io/zoneï¼ˆåŒä¸€å¯ç”¨åŒºï¼‰ topology.kubernetes.io/regionï¼ˆåŒä¸€åŒºåŸŸï¼‰ â€Œç¤ºä¾‹â€Œï¼š affinity: podAffinity: requiredDuringSchedulingIgnoredDuringExecution: - labelSelector: matchExpressions: - key: app operator: In values: [backend] topologyKey: kubernetes.io/hostname # å¿…é¡»å’Œ backend Pod åœ¨åŒä¸€èŠ‚ç‚¹ labelSelectorï¼šåŒ¹é…ç›®æ ‡ PodPod äº²å’Œæ€§é€šè¿‡ labelSelector é€‰æ‹©è¦äº²å’Œæˆ–åäº²å’Œçš„ Podã€‚ â€Œç¤ºä¾‹â€Œï¼š affinity: podAntiAffinity: requiredDuringSchedulingIgnoredDuringExecution: - labelSelector: matchExpressions: - key: app operator: In values: [frontend] topologyKey: kubernetes.io/hostname # é¿å…å’Œ frontend Pod åœ¨åŒä¸€èŠ‚ç‚¹ äº²å’Œæ€§åŒ¹é…è§„åˆ™åœ¨ Kubernetes ä¸­ï¼ŒPod äº²å’Œæ€§åäº²å’Œæ€§è°ƒåº¦æ—¶ï¼ŒlabelSelector å’Œ topologyKey çš„åŒ¹é…è§„åˆ™éµå¾ªä»¥ä¸‹é€»è¾‘é¡ºåºå’Œäº¤äº’å…³ç³»ã€‚ â€ŒåŒ¹é…æµç¨‹çš„å…ˆåè§„åˆ™ â€ŒlabelSelector ä¼˜å…ˆåŒ¹é… è°ƒåº¦å™¨é¦–å…ˆæ ¹æ® labelSelector ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„ â€Œç›®æ ‡ Podâ€Œï¼ˆä¾‹å¦‚ app=backend çš„ Podï¼‰ã€‚ åŒ¹é…é€»è¾‘æ”¯æŒ Inã€NotInã€Exists ç­‰æ“ä½œç¬¦ï¼Œä¸”åŒä¸€ matchExpressions å†…å¤šä¸ªæ¡ä»¶æ˜¯ â€ŒAND å…³ç³»â€Œï¼Œä¸åŒ matchExpressions ä¹‹é—´æ˜¯ â€ŒOR å…³ç³»â€Œã€‚ â€ŒtopologyKey å®šä¹‰ä½œç”¨åŸŸ åœ¨æ‰¾åˆ°ç›®æ ‡ Pod åï¼Œè°ƒåº¦å™¨æ ¹æ® topologyKeyï¼ˆå¦‚ hostnameã€zoneï¼‰ç¡®å®šè¿™äº› Pod æ‰€åœ¨çš„ â€Œæ‹“æ‰‘åŸŸâ€Œï¼ˆå¦‚èŠ‚ç‚¹ã€å¯ç”¨åŒºï¼‰ã€‚ èŠ‚ç‚¹å¿…é¡»æ‹¥æœ‰ topologyKey æŒ‡å®šçš„æ ‡ç­¾(æ˜¯æ ‡ç­¾ä¸æ˜¯æ ‡ç­¾å€¼)ï¼Œå¦åˆ™ä¼šè¢«æ’é™¤ï¼ˆä¾‹å¦‚èŠ‚ç‚¹æ—  zone æ ‡ç­¾æ—¶ï¼Œæ— æ³•å‚ä¸åŸºäº zone çš„è°ƒåº¦ï¼‰ã€‚ â€Œæœ€ç»ˆè°ƒåº¦å†³ç­–â€Œ å¯¹äº â€Œäº²å’Œæ€§â€Œï¼šæ–° Pod ä¼šè¢«è°ƒåº¦åˆ°ç›®æ ‡ Pod æ‰€åœ¨çš„æ‹“æ‰‘åŸŸï¼ˆå¦‚ç›¸åŒèŠ‚ç‚¹æˆ–å¯ç”¨åŒºï¼‰ã€‚ å¯¹äº â€Œåäº²å’Œæ€§â€Œï¼šæ–° Pod ä¼šé¿å…è°ƒåº¦åˆ°ç›®æ ‡ Pod æ‰€åœ¨çš„æ‹“æ‰‘åŸŸã€‚ å…³é”®äº¤äº’è§„åˆ™ â€Œä¾èµ–å…³ç³»â€Œï¼šlabelSelector çš„åŒ¹é…ç»“æœæ˜¯ topologyKey è®¡ç®—çš„å‰æã€‚è‹¥æ²¡æœ‰ Pod åŒ¹é… labelSelectorï¼Œåˆ™ topologyKey è§„åˆ™ä¸ç”Ÿæ•ˆï¼ˆç¡¬æ€§è§„åˆ™ä¼šå¯¼è‡´è°ƒåº¦å¤±è´¥ï¼Œè½¯æ€§è§„åˆ™ä¼šè¢«å¿½ç•¥ï¼‰ã€‚ â€Œä½œç”¨åŸŸéš”ç¦»â€Œï¼štopologyKey çš„å€¼ï¼ˆæ ‡ç­¾ï¼‰ï¼ˆå¦‚ hostname æˆ– zoneï¼‰å†³å®šäº†äº²å’Œæ€§åäº²å’Œæ€§çš„å½±å“èŒƒå›´ã€‚ hostnameï¼šç¡®ä¿ Pod åœ¨åŒä¸€èŠ‚ç‚¹æˆ–ä¸åŒèŠ‚ç‚¹ã€‚ zoneï¼šç¡®ä¿ Pod åœ¨åŒä¸€å¯ç”¨åŒºæˆ–è·¨å¯ç”¨åŒºåˆ†å¸ƒã€‚ â€ŒåŠ¨æ€è°ƒæ•´â€Œï¼šè‹¥ç›®æ ‡ Pod çš„æ‹“æ‰‘åˆ†å¸ƒå˜åŒ–ï¼ˆå¦‚èŠ‚ç‚¹æ ‡ç­¾æ›´æ–°ï¼‰ï¼Œè°ƒåº¦å™¨ä¼šé‡æ–°è®¡ç®—äº²å’Œæ€§åäº²å’Œæ€§çº¦æŸã€‚ â€Œåœºæ™¯ 1ï¼šPod äº²å’Œæ€§â€Œaffinity: podAffinity: requiredDuringSchedulingIgnoredDuringExecution: - labelSelector: matchExpressions: - key: app operator: In values: [backend] # 1. å…ˆåŒ¹é… app=backend çš„ Pod topologyKey: kubernetes.io/hostname # 2. å†ç¡®ä¿æ–° Pod ä¸è¿™äº› Pod åœ¨æœ‰ `kubernetes.io/hostname` æ ‡ç­¾çš„èŠ‚ç‚¹ä¸Š â€Œæ‰§è¡Œé¡ºåºâ€Œï¼š æ‰¾åˆ°æ‰€æœ‰ app=backend çš„ Podã€‚ ç»Ÿè®¡è¿™äº› Pod æ‰€åœ¨çš„èŠ‚ç‚¹ï¼ˆæ ¹æ® hostname æ ‡ç­¾ï¼‰ã€‚ å°†æ–° Pod è°ƒåº¦åˆ°è¿™äº›èŠ‚ç‚¹ä¹‹ä¸€ã€‚ â€Œåœºæ™¯ 2ï¼šPod åäº²å’Œæ€§ï¼ˆé«˜å¯ç”¨ï¼‰affinity: podAntiAffinity: requiredDuringSchedulingIgnoredDuringExecution: - labelSelector: matchExpressions: - key: app operator: In values: [redis] # 1. å…ˆåŒ¹é… app=redis çš„ Pod topologyKey: topology.kubernetes.io/zone # 2. å†é¿å…æ–° Pod ä¸è¿™äº› Pod åœ¨åŒä¸€å¯ç”¨åŒº â€Œæ‰§è¡Œé¡ºåºâ€Œï¼š æ‰¾åˆ°æ‰€æœ‰ app=redis çš„ Podã€‚ ç»Ÿè®¡è¿™äº› Pod æ‰€åœ¨çš„å¯ç”¨åŒºï¼ˆæ ¹æ® zone æ ‡ç­¾ï¼‰ã€‚ å°†æ–° Pod è°ƒåº¦åˆ°å…¶ä»–å¯ç”¨åŒºçš„èŠ‚ç‚¹ã€‚ â€ŒåŒ¹é…æ³¨æ„äº‹é¡¹ â€Œç¡¬æ€§è§„åˆ™é£é™©â€Œï¼šè‹¥ labelSelector æ— åŒ¹é…é¡¹ä¸”è§„åˆ™ä¸º requiredDuringSchedulingï¼ŒPod å°†æ— æ³•è°ƒåº¦ã€‚ â€Œè½¯æ€§è§„åˆ™çµæ´»æ€§â€Œï¼špreferredDuringScheduling ä¼šå°è¯•æ»¡è¶³æ¡ä»¶ï¼Œä½†å…è®¸å¤±è´¥ï¼Œå¹¶é€šè¿‡ weight è°ƒæ•´ä¼˜å…ˆçº§ã€‚ â€Œæ ‡ç­¾ä¸€è‡´æ€§â€Œï¼šç¡®ä¿ç›®æ ‡ Pod å’ŒèŠ‚ç‚¹çš„æ ‡ç­¾æ­£ç¡®ï¼Œå¦åˆ™è§„åˆ™å¯èƒ½å¤±æ•ˆã€‚ é€šè¿‡åˆç†ç»„åˆ labelSelector å’Œ topologyKeyï¼Œå¯ä»¥å®ç°ç²¾ç»†åŒ–çš„ Pod è°ƒåº¦ç­–ç•¥ï¼Œä¼˜åŒ–èµ„æºåˆ©ç”¨å’Œé«˜å¯ç”¨æ€§ã€‚ â€ŒPod äº²å’Œæ€§ vs. èŠ‚ç‚¹äº²å’Œæ€§ ç‰¹æ€§ Pod äº²å’Œæ€§ èŠ‚ç‚¹äº²å’Œæ€§ â€Œå†³ç­–ä¾æ®â€Œ åŸºäºå…¶ä»– Pod çš„æ ‡ç­¾ åŸºäºèŠ‚ç‚¹æ ‡ç­¾ â€Œé€‚ç”¨åœºæ™¯â€Œ å¾®æœåŠ¡å…±ç½®ã€é«˜å¯ç”¨ ç¡¬ä»¶ç¯å¢ƒè°ƒåº¦ï¼ˆå¦‚ GPU èŠ‚ç‚¹ï¼‰ â€Œçµæ´»æ€§â€Œ æ›´ç²¾ç»†ï¼ˆåŸºäº Pod å…³ç³»ï¼‰ è¾ƒç²—ç²’åº¦ï¼ˆåŸºäºèŠ‚ç‚¹å±æ€§ï¼‰ â€Œ**å…¸å‹ topologyKey**â€Œ hostnameã€zoneã€region æ— ï¼ˆç›´æ¥åŒ¹é…èŠ‚ç‚¹æ ‡ç­¾ï¼‰ â€ŒPod äº²å’Œæ€§æ€»ç»“ â€ŒPod äº²å’Œæ€§â€Œ é€‚ç”¨äºéœ€è¦ Pod ç´§å¯†åä½œçš„åœºæ™¯ï¼ˆå¦‚å¾®æœåŠ¡å…±ç½®ï¼‰ã€‚ â€ŒPod åäº²å’Œæ€§â€Œ é€‚ç”¨äºé«˜å¯ç”¨å’Œèµ„æºéš”ç¦»åœºæ™¯ï¼ˆå¦‚é¿å…å•ç‚¹æ•…éšœï¼‰ã€‚ â€ŒtopologyKeyâ€Œ å†³å®šäº²å’Œæ€§çš„ä½œç”¨èŒƒå›´ï¼ˆèŠ‚ç‚¹ã€å¯ç”¨åŒºã€åŒºåŸŸï¼‰ã€‚ â€Œç¡¬æ€§è§„åˆ™ï¼ˆRequiredï¼‰ ç¡®ä¿ä¸¥æ ¼è°ƒåº¦ï¼Œâ€Œè½¯æ€§è§„åˆ™ï¼ˆPreferredï¼‰ æä¾›çµæ´»æ€§ã€‚ é€šè¿‡åˆç†ä½¿ç”¨ Pod äº²å’Œæ€§ï¼Œå¯ä»¥ä¼˜åŒ– Kubernetes é›†ç¾¤çš„èµ„æºåˆ©ç”¨ç‡å’Œåº”ç”¨ç¨³å®šæ€§ã€‚ Pod äº²å’Œæ€§å®éªŒäº²å’Œæ€§è½¯ç­–ç•¥apiVersion: v1kind: Podmetadata: name: pod-aff-prefer labels: app: pod-affspec: containers: - name: myapp image: wangyanglinux/myapp:v1.0 affinity: podAffinity: preferredDuringSchedulingIgnoredDuringExecution: - weight: 1 podAffinityTerm: labelSelector: matchExpressions: - key: app operator: In values: - pod-1 topologyKey: kubernetes.io/hostname apiVersion: v1kind: Podmetadata: name: node-affinity-preferred labels: app: node-affinity-preferredspec: containers: - name: node-affinity-preferred-pod image: wangyanglinux/myapp:v1.0 affinity: nodeAffinity: preferredDuringSchedulingIgnoredDuringExecution: - weight: 1 preference: matchExpressions: - key: domain operator: In values: - xinxianghf # å…ˆéƒ¨ç½²ä¸€ä¸ª pod åˆ°èŠ‚ç‚¹3kubectl apply -f node-affinity-preferred-pod.yaml # æ·»åŠ  pod æ ‡ç­¾kubectl label pod node-affinity-preferred app=pod-1 --overwritekubectl apply -f pod-aff-prefer.yaml å¯ä»¥çœ‹åˆ° pod-aff-prefer ä¹Ÿè¢«éƒ¨ç½²åˆ°äº†èŠ‚ç‚¹3ã€‚ äº²å’Œæ€§ç¡¬ç­–ç•¥apiVersion: v1kind: Podmetadata: name: pod-aff-req labels: app: pod-aff-reqspec: containers: - name: pod-aff-req-c image: wangyanglinux/myapp:v1.0 affinity: podAffinity: requiredDuringSchedulingIgnoredDuringExecution: - labelSelector: matchExpressions: - key: app operator: In values: - pod-2 topologyKey: kubernetes.io/hostname kubectl delete pod --allkubectl apply -f pod-aff-req.yaml æ²¡æœ‰åŒ¹é…åˆ°äº²å’Œ Pod ä¸èƒ½å¤ŸæˆåŠŸéƒ¨ç½²ã€‚ åäº²å’Œæ€§è½¯ç­–ç•¥apiVersion: v1kind: Podmetadata: name: pod-antiaff-prefer labels: app: pod-affspec: containers: - name: myapp image: wangyanglinux/myapp:v1.0 affinity: podAntiAffinity: preferredDuringSchedulingIgnoredDuringExecution: - weight: 1 podAffinityTerm: labelSelector: matchExpressions: - key: app operator: In values: - pod-1 topologyKey: kubernetes.io/hostname apiVersion: v1kind: Podmetadata: name: node-affinity-preferred-1 labels: app: pod-1spec: containers: - name: node-affinity-preferred-pod-1 image: wangyanglinux/myapp:v1.0 affinity: nodeAffinity: preferredDuringSchedulingIgnoredDuringExecution: - weight: 1 preference: matchExpressions: - key: domain operator: In values: - xinxianghf-1 apiVersion: v1kind: Podmetadata: name: node-affinity-preferred labels: app: pod-1spec: containers: - name: node-affinity-preferred-pod image: wangyanglinux/myapp:v1.0 affinity: nodeAffinity: preferredDuringSchedulingIgnoredDuringExecution: - weight: 1 preference: matchExpressions: - key: domain operator: In values: - xinxianghf # ç»™èŠ‚ç‚¹2æ·»åŠ æ ‡ç­¾kubectl label node k8s-node02 domain=xinxianghf-1# å…ˆéƒ¨ç½²2ä¸ª pod åˆ°èŠ‚ç‚¹2ã€3kubectl apply -f node-affinity-preferred-pod.yaml kubectl apply -f node-affinity-preferred-pod-1.yaml # éƒ¨ç½²åäº²å’Œ podkubectl apply -f pod-antiaff-prefer.yaml å¯ä»¥çœ‹åˆ°å³ä½¿æœ‰åŒ¹é…çš„åäº²å’Œ pod çš„èŠ‚ç‚¹ï¼Œè¯¥ pod ä¹Ÿèƒ½éƒ¨ç½²æˆåŠŸã€‚ åäº²å’Œæ€§ç¡¬ç­–ç•¥apiVersion: v1kind: Podmetadata: name: pod-antiaff-req labels: app: pod-antiaff-reqspec: containers: - name: pod-antiaff-req-c image: wangyanglinux/myapp:v1.0 affinity: podAntiAffinity: requiredDuringSchedulingIgnoredDuringExecution: - labelSelector: matchExpressions: - key: app operator: In values: - pod-1 topologyKey: kubernetes.io/hostname kubectl apply -f pod-antiaff-req.yaml kubectl get pod -o wide --show-labels æ±¡ç‚¹å’Œå®¹å¿æ±¡ç‚¹å’Œå®¹å¿æ ¸å¿ƒæ¦‚å¿µ â€Œæ±¡ç‚¹(Taints) å®šä¹‰åœ¨èŠ‚ç‚¹(Node)ä¸Šçš„æ ‡è®°ï¼Œç”¨äºé™åˆ¶ Pod çš„è°ƒåº¦â€Œã€‚ æœ¬è´¨æ˜¯é”®å€¼å¯¹+æ•ˆæœ(effect)çš„ç»„åˆï¼škey=value:effectâ€Œã€‚ è¢«æ ‡è®°çš„èŠ‚ç‚¹ä¸ä¸€å®šæ˜¯æ•…éšœèŠ‚ç‚¹ï¼Œå¯èƒ½æ˜¯ç‰¹æ®Šç”¨é€”èŠ‚ç‚¹ï¼ˆå¦‚GPUèŠ‚ç‚¹ã€ç”Ÿäº§ç¯å¢ƒèŠ‚ç‚¹ç­‰ï¼‰ã€‚â€Œ â€Œå®¹å¿åº¦(Tolerations) å®šä¹‰åœ¨ Pod ä¸Šçš„å±æ€§ï¼Œå…è®¸ Pod è°ƒåº¦åˆ°å¸¦æœ‰åŒ¹é…æ±¡ç‚¹çš„èŠ‚ç‚¹â€Œã€‚ ä¸æ±¡ç‚¹æˆå¯¹å‡ºç°ï¼Œå½¢æˆè°ƒåº¦ç­–ç•¥çš„äº’æ–¥æœºåˆ¶â€Œã€‚ æ±¡ç‚¹çš„ç»„æˆå‚æ•° â€Œkeyâ€Œ æ±¡ç‚¹çš„åˆ†ç±»æ ‡è¯†ï¼ˆå¦‚ acceleratorã€envï¼‰â€Œã€‚ ç¤ºä¾‹ï¼šaccelerator=gpu:NoSchedule æ ‡è¯†GPUèŠ‚ç‚¹â€Œã€‚ â€Œvalueâ€Œ æ±¡ç‚¹çš„å…·ä½“å€¼ï¼ˆå¦‚ nvidiaã€prodï¼‰â€Œã€‚ å¯ä¸ºç©ºä½†éœ€ä¿ç•™ç­‰å·ï¼ˆå¦‚ disk=:NoScheduleï¼‰â€Œã€‚ â€Œeffectâ€Œ å®šä¹‰æ’æ–¥ç­‰çº§ï¼Œæ”¯æŒä¸‰ç§æ•ˆæœï¼š NoScheduleï¼šç¦æ­¢è°ƒåº¦æ–°Podï¼ˆå·²è¿è¡Œçš„Podä¸å—å½±å“ï¼‰â€Œã€‚ PreferNoScheduleï¼šå°½é‡ä¸è°ƒåº¦ï¼ˆæŸ”æ€§é™åˆ¶ï¼‰â€Œã€‚ NoExecuteï¼šé©±é€ä¸èƒ½å®¹å¿çš„å·²è¿è¡ŒPodâ€Œã€‚ å®¹å¿ç±»å‹åœ¨ Kubernetes ä¸­ï¼Œå®¹å¿åº¦(Tolerations)çš„ operator å­—æ®µå®šä¹‰äº†å®¹å¿è§„åˆ™ä¸æ±¡ç‚¹çš„åŒ¹é…æ–¹å¼ï¼Œæ”¯æŒä»¥ä¸‹ä¸¤ç§ä¸»è¦ç±»å‹ï¼š Equalï¼ˆç²¾ç¡®åŒ¹é…ï¼‰ï¼š â€ŒåŠŸèƒ½â€Œï¼šè¦æ±‚ Pod å®¹å¿åº¦çš„ keyã€value å’Œ effect å¿…é¡»ä¸èŠ‚ç‚¹æ±¡ç‚¹çš„å¯¹åº”å­—æ®µå®Œå…¨ä¸€è‡´ã€‚ â€Œå…¸å‹é…ç½®â€Œï¼š tolerations:- key: gpu operator: Equal value: nvidia # å¿…é¡»ä¸æ±¡ç‚¹çš„valueå®Œå…¨åŒ¹é… effect: NoSchedule â€Œé€‚ç”¨åœºæ™¯â€Œï¼šéœ€è¦ä¸¥æ ¼é™åˆ¶ Pod åªèƒ½å®¹å¿ç‰¹å®šå€¼çš„æ±¡ç‚¹ï¼ˆå¦‚ä¸“ç”¨ç¡¬ä»¶èŠ‚ç‚¹ï¼‰ã€‚ â€ŒExistsï¼ˆå­˜åœ¨æ€§åŒ¹é…ï¼‰ï¼š â€ŒåŠŸèƒ½â€Œï¼šä»…éœ€å®¹å¿åº¦çš„ key å’Œ effect ä¸æ±¡ç‚¹åŒ¹é…ï¼Œå¿½ç•¥ value å­—æ®µï¼ˆå³ä½¿æ±¡ç‚¹æœ‰valueï¼‰ã€‚ â€Œå…¸å‹é…ç½®ï¼š tolerations:- key: env operator: Exists # æ— éœ€æŒ‡å®švalue effect: NoExecute â€Œé€‚ç”¨åœºæ™¯â€Œï¼šå®¹å¿æŸä¸€ç±»æ±¡ç‚¹ï¼ˆå¦‚æ‰€æœ‰ç¯å¢ƒéš”ç¦»æ ‡ç­¾ï¼‰ã€‚ ç‰¹æ®Šè§„åˆ™ï¼š å½“ operator ä¸º Exists æ—¶ï¼Œè‹¥æœªæŒ‡å®š key åˆ™è¡¨ç¤ºå®¹å¿æ‰€æœ‰æ±¡ç‚¹ï¼ˆæç«¯æƒ…å†µï¼Œæ…ç”¨ï¼‰ã€‚ è‹¥æœªæ˜¾å¼å®šä¹‰ operatorï¼Œé»˜è®¤è¡Œä¸ºç­‰åŒäº Equalã€‚ ä¸¤ç§æ“ä½œç¬¦çš„å¯¹æ¯”ï¼š ç±»å‹ åŒ¹é…è¦æ±‚ çµæ´»æ€§ Equal å®Œå…¨åŒ¹é…keyvalueeffect ä½ Exists ä»…åŒ¹é…keyeffectï¼Œå¿½ç•¥value é«˜ é€šè¿‡åˆç†é€‰æ‹©æ“ä½œç¬¦ï¼Œå¯ä»¥å®ç°ä»ç²¾ç¡®æ§åˆ¶åˆ°å®½æ¾åŒ¹é…çš„è°ƒåº¦ç­–ç•¥ã€‚ æ±¡ç‚¹å’Œå®¹å¿çš„å…¸å‹åº”ç”¨åœºæ™¯ â€Œä¸“ç”¨èŠ‚ç‚¹éš”ç¦»â€Œ ä¾‹å¦‚ï¼šGPUèŠ‚ç‚¹ä»…å…è®¸æœºå™¨å­¦ä¹ ä»»åŠ¡ Pod è°ƒåº¦â€Œã€‚ å®ç°æ–¹å¼ï¼šèŠ‚ç‚¹æ·»åŠ æ±¡ç‚¹ + ç‰¹å®š Pod é…ç½®å®¹å¿â€Œã€‚ â€ŒèŠ‚ç‚¹ç»´æŠ¤â€Œ ç»´æŠ¤å‰ç»™èŠ‚ç‚¹æ‰“ NoExecute æ±¡ç‚¹ï¼Œè‡ªåŠ¨é©±é€ Podâ€Œã€‚ â€Œç¯å¢ƒåŒºåˆ†â€Œ ç”Ÿäº§æµ‹è¯•ç¯å¢ƒèŠ‚ç‚¹é€šè¿‡ä¸åŒæ±¡ç‚¹éš”ç¦»â€Œã€‚ æ“ä½œç¤ºä¾‹ â€Œæ·»åŠ åˆ é™¤æ±¡ç‚¹â€Œ # æ·»åŠ æ±¡ç‚¹kubectl taint nodes node1 env=prod:NoSchedule# åˆ é™¤æ±¡ç‚¹kubectl taint nodes node1 env=prod:NoSchedule- â€ŒPod å®¹å¿åº¦é…ç½®â€Œ tolerations:- key: env operator: Equal value: prod effect: NoSchedule â€Œå®¹å¿ç‰¹æ®Šç±»å‹å½“ä¸æŒ‡å®š value æ—¶ï¼Œè¡¨ç¤ºå®¹å¿æ‰€æœ‰çš„æ±¡ç‚¹ valueï¼› tolerations:- key: key operator: Exists effect: NoSchedule å½“ä¸æŒ‡å®š key å€¼æ—¶ï¼Œè¡¨ç¤ºå®¹å¿æ‰€æœ‰çš„æ±¡ç‚¹; tolerations:- operator: Exists å½“ä¸æŒ‡å®š effect å€¼æ—¶ï¼Œè¡¨ç¤ºå®¹å¿æ‰€æœ‰çš„æ±¡ç‚¹ä½œç”¨; tolerations:- key: key operator: Exists æ±¡ç‚¹ã€å®¹å¿å®éªŒæ±¡ç‚¹å®éªŒkubectl describe node k8s-node01 å¯ä»¥çœ‹åˆ° master èŠ‚ç‚¹è®¾ç½®äº†ä¸€ä¸ªæ±¡ç‚¹, æ‰€ä»¥ pod é»˜è®¤éƒ½ä¼šè¢«è°ƒåº¦åˆ°2ã€3èŠ‚ç‚¹ã€‚ # å»é™¤æ±¡ç‚¹kubectl taint nodes k8s-node01 node-role.kubernetes.io/control-plane=:NoSchedule-kubectl describe node k8s-node01# å®Œæˆå®éªŒä¿®æ”¹å›kubectl taint nodes k8s-node01 node-role.kubernetes.io/control-plane=:NoSchedule apiVersion: apps/v1kind: Deploymentmetadata: labels: app: myapp name: myappspec: replicas: 10 selector: matchLabels: app: myapp template: metadata: labels: app: myapp spec: containers: - image: wangyanglinux/myapp:v1.0 name: myapp å¯ä»¥çœ‹åˆ° pod ä¹Ÿéƒ¨ç½²åˆ°äº† node1 èŠ‚ç‚¹ã€‚ å®¹å¿å®éªŒapiVersion: apps/v1kind: Deploymentmetadata: labels: app: myapp name: myappspec: replicas: 10 selector: matchLabels: app: myapp template: metadata: labels: app: myapp spec: tolerations: - operator: Exists containers: - image: wangyanglinux/myapp:v1.0 name: myapp æ·»åŠ å®¹å¿æ±¡ç‚¹åï¼Œpod ä¹Ÿå¯ä»¥è¢«è°ƒåº¦åˆ° node1 èŠ‚ç‚¹ã€‚ å›ºå®šè°ƒåº¦å›ºå®šèŠ‚ç‚¹è°ƒåº¦æ˜¯ Kubernetes ä¸­å¼ºåˆ¶å°† Pod åˆ†é…åˆ°ç‰¹å®šèŠ‚ç‚¹çš„æœºåˆ¶ï¼Œä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼å®ç°ã€‚ nodeName å¼ºåˆ¶è°ƒåº¦ â€ŒåŸç†â€Œï¼šç›´æ¥è·³è¿‡é»˜è®¤è°ƒåº¦å™¨ï¼Œå°† Pod ç»‘å®šåˆ°æŒ‡å®šèŠ‚ç‚¹åç§°â€Œã€‚ â€Œç‰¹ç‚¹ï¼š å®Œå…¨ç»•è¿‡è°ƒåº¦å™¨çš„è¿‡æ»¤æ‰“åˆ†æµç¨‹ï¼Œæ— è§†èŠ‚ç‚¹èµ„æºçŠ¶æ€å’Œæ±¡ç‚¹â€Œã€‚ èŠ‚ç‚¹ä¸å­˜åœ¨æˆ–èµ„æºä¸è¶³æ—¶ï¼ŒPod ä¼šæŒç»­å¤„äº Pending çŠ¶æ€â€Œã€‚ â€Œç¤ºä¾‹é…ç½®ï¼š spec: nodeName: node01 # ç²¾ç¡®æŒ‡å®šèŠ‚ç‚¹åç§° nodeSelector æ ‡ç­¾é€‰æ‹©è°ƒåº¦ â€ŒåŸç†â€Œï¼šé€šè¿‡èŠ‚ç‚¹æ ‡ç­¾ï¼ˆLabelï¼‰åŒ¹é…é€‰æ‹©ç›®æ ‡èŠ‚ç‚¹â€Œã€‚ â€Œç‰¹ç‚¹ï¼š éœ€é¢„å…ˆç»™èŠ‚ç‚¹æ‰“æ ‡ç­¾ï¼ˆå¦‚ disktype=ssdï¼‰â€Œã€‚ æ”¯æŒå¤šæ ‡ç­¾ç»„åˆåŒ¹é…ï¼ˆAND é€»è¾‘ï¼‰â€Œã€‚ ä»å—èŠ‚ç‚¹èµ„æºæ¡ä»¶å’Œæ±¡ç‚¹é™åˆ¶â€Œã€‚ â€Œç¤ºä¾‹é…ç½®ï¼š spec: nodeSelector: disktype: ssd gpu: true å¯¹æ¯”ä¸é€‚ç”¨åœºæ™¯ æ–¹å¼ çµæ´»æ€§ è°ƒåº¦å™¨å¹²é¢„ å…¸å‹åœºæ™¯ nodeName ä½ å®Œå…¨è·³è¿‡ è°ƒè¯•ã€ç‰¹æ®Šç¡¬ä»¶ä¾èµ–åœºæ™¯â€Œ nodeSelector é«˜ éƒ¨åˆ†å‚ä¸ å¸¸è§„å›ºå®šèŠ‚ç‚¹éœ€æ±‚â€Œ å›ºå®šè°ƒåº¦æ³¨æ„äº‹é¡¹ â€ŒnodeName é£é™©â€Œï¼šèŠ‚ç‚¹æ•…éšœä¼šå¯¼è‡´ Pod ä¸å¯ç”¨ï¼Œéœ€é…åˆå¥åº·æ£€æŸ¥â€Œã€‚ â€Œæ ‡ç­¾ç®¡ç†â€Œï¼šç¡®ä¿èŠ‚ç‚¹æ ‡ç­¾ä¸è°ƒåº¦éœ€æ±‚ä¸¥æ ¼åŒ¹é…ï¼Œé¿å…è¯¯è°ƒåº¦â€Œã€‚ â€Œèµ„æºå†²çªâ€Œï¼šå›ºå®šè°ƒåº¦å¯èƒ½åŠ å‰§èŠ‚ç‚¹èµ„æºç¢ç‰‡åŒ–ï¼Œå»ºè®®è®¾ç½®èµ„æºé™åˆ¶ã€‚ å›ºå®šè°ƒåº¦å®éªŒnodeName å®éªŒapiVersion: apps/v1kind: Deploymentmetadata: labels: app: myapp name: myappspec: selector: matchLabels: app: myapp template: metadata: labels: app: myapp spec: nodeName: k8s-node01 containers: - image: wangyanglinux/myapp:v1.0 name: myapp æ— è§†äº† node1 èŠ‚ç‚¹çš„æ±¡ç‚¹ã€‚ nodeSelector å®éªŒapiVersion: apps/v1kind: Deploymentmetadata: name: nodeselect-testspec: replicas: 2 selector: matchLabels: app: nodeselect template: metadata: labels: app: nodeselect spec: nodeSelector: type: nodeselect containers: - name: myweb image: wangyanglinux/myapp:v1.0 ports: - containerPort: 80 # ç»™ node1 èŠ‚ç‚¹æ·»åŠ  nodeselect æ ‡ç­¾kubectl label node k8s-node01 type=nodeselectkubectl apply -f nodeselect-test.yaml å¯ä»¥çœ‹åˆ° pod éƒ½å¤„äº Pending çŠ¶æ€ï¼Œå› ä¸ºåªæœ‰ node1 èŠ‚ç‚¹æœ‰ typenodeselect æ ‡ç­¾ï¼Œä½†æ˜¯è¯¥èŠ‚ç‚¹å­˜åœ¨æ±¡ç‚¹ï¼Œæ‰€ä»¥ pod è°ƒåº¦ä¸åˆ°è¯¥èŠ‚ç‚¹ã€‚ # ç»™ node2 èŠ‚ç‚¹æ·»åŠ  nodeselect æ ‡ç­¾kubectl label node k8s-node02 type=nodeselect","tags":[null],"categories":[null]},{"title":"Kubernetesèµ„æºæ¸…å•","path":"/wiki/Kubernetes/èµ„æºæ¸…å•.html","content":"èµ„æºæ¸…å•ä»€ä¹ˆæ˜¯èµ„æºæ¸…å•ï¼Ÿèµ„æºï¼šK8S ä¸­æ‰€æœ‰çš„å†…å®¹éƒ½æŠ½è±¡ä¸º èµ„æºï¼Œèµ„æºå®ä¾‹åŒ–ä¹‹åç§°ä¸º å¯¹è±¡â€Œã€‚ èµ„æºæ¸…å•çš„ä½œç”¨â€Œï¼šæ˜¯ä¸ K8S é›†ç¾¤äº¤äº’çš„æœºåˆ¶ï¼Œç”¨äºä¼ é€’é…ç½®ä¿¡æ¯ï¼Œåˆ›å»ºç¬¦åˆé¢„æœŸçš„ Pod æˆ–å…¶ä»–èµ„æºâ€Œã€‚ åœ¨ Kubernetesï¼ˆK8Sï¼‰ä¸­ï¼Œâ€Œèµ„æºâ€Œã€â€Œå¯¹è±¡â€Œå’Œâ€Œèµ„æºæ¸…å•â€Œæ˜¯ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒä»¬çš„å…³ç³»å¯ä»¥ç”¨æ—¥å¸¸ç”Ÿæ´»ä¸­çš„ä¾‹å­æ¥ç±»æ¯”ï¼š èµ„æºï¼ˆResourceï¼‰ â€Œé€šä¿—è§£é‡Šï¼šèµ„æºæ˜¯ K8S é‡Œçš„â€œå·¥å…·â€æˆ–â€œåŸææ–™â€ï¼Œæ¯ç§å·¥å…·éƒ½æœ‰ç‰¹å®šåŠŸèƒ½ã€‚æ¯”å¦‚ï¼š Podï¼šåƒæ˜¯ä¸€ä¸ªâ€œå¿«é€’åŒ…è£¹â€ï¼Œé‡Œé¢è£…ç€ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ï¼ˆæ¯”å¦‚ Nginx æœåŠ¡ï¼‰â€Œã€‚ Deploymentï¼šåƒâ€œæµæ°´çº¿è¯´æ˜ä¹¦â€ï¼Œå‘Šè¯‰ K8S å¦‚ä½•æ‰¹é‡ç®¡ç†ç›¸åŒçš„ Podï¼ˆæ¯”å¦‚å§‹ç»ˆä¿æŒ 3 ä¸ª Nginx å‰¯æœ¬è¿è¡Œï¼‰â€Œã€‚ Serviceï¼šç›¸å½“äºâ€œç”µè¯å·ç ç°¿â€ï¼Œè®©å…¶ä»–æœåŠ¡èƒ½æ‰¾åˆ°ä½ çš„ Podâ€Œã€‚ â€Œæœ¬è´¨â€Œï¼šK8S å°†è®¡ç®—ã€å­˜å‚¨ã€ç½‘ç»œç­‰èƒ½åŠ›æŠ½è±¡æˆä¸åŒç±»å‹çš„èµ„æºï¼Œç”¨æˆ·é€šè¿‡æ“ä½œè¿™äº›èµ„æºæ¥ç®¡ç†åº”ç”¨â€Œã€‚ å¯¹è±¡ï¼ˆObjectï¼‰ â€Œé€šä¿—è§£é‡Šâ€Œï¼šå¯¹è±¡æ˜¯èµ„æºçš„â€œå…·ä½“å®ä¾‹â€ã€‚æ¯”å¦‚ï¼š èµ„æºæ˜¯â€œèœè°±â€ï¼Œå¯¹è±¡å°±æ˜¯â€œæŒ‰èœè°±åšå‡ºæ¥çš„èœâ€ã€‚ ä½ å®šä¹‰ä¸€ä¸ª Deployment èµ„æºï¼ˆèœè°±ï¼‰ï¼ŒK8S å®é™…åˆ›å»ºçš„å°±æ˜¯ä¸€ä¸ª Deployment å¯¹è±¡ï¼ˆä¸€ç›˜èœï¼‰â€Œã€‚ â€Œå…³é”®ç‚¹â€Œï¼šå¯¹è±¡æ˜¯è¿è¡Œæ—¶å­˜åœ¨çš„å®ä½“ï¼ŒæŒæœ‰å½“å‰çŠ¶æ€ï¼ˆæ¯”å¦‚ Pod æ˜¯å¦è¿è¡Œæ­£å¸¸ï¼‰â€Œã€‚ èµ„æºæ¸…å•ï¼ˆManifestï¼‰ â€Œé€šä¿—è§£é‡Šâ€Œï¼šèµ„æºæ¸…å•æ˜¯â€œéœ€æ±‚è¯´æ˜ä¹¦â€ï¼Œç”¨ YAML æˆ– JSON æ ¼å¼å†™ä¸‹ä½ çš„éœ€æ±‚ã€‚ä¾‹å¦‚ï¼š apiVersion: v1 # ç”¨å“ªä¸ªç‰ˆæœ¬çš„â€œå·¥å…·â€ï¼ˆAPI ç‰ˆæœ¬ï¼‰kind: Pod # è¦åˆ›å»ºä»€ä¹ˆï¼ˆèµ„æºç±»å‹ï¼‰metadata: name: nginx-pod # å®ä¾‹åç§°spec: containers: - name: nginx # å®¹å™¨å image: nginx # é•œåƒåœ°å€ â€Œä½œç”¨â€Œï¼šæŠŠè¿™ä»½æ¸…å•æäº¤ç»™ K8Sï¼Œå®ƒå°±ä¼šæŒ‰ä½ çš„è¦æ±‚åˆ›å»ºå¹¶ç®¡ç†å¯¹åº”çš„å¯¹è±¡â€Œã€‚ ä¸‰è€…çš„å…³ç³»æ€»ç»“ â€Œèµ„æºâ€Œæ˜¯æŠ½è±¡çš„åŠŸèƒ½åˆ†ç±»ï¼ˆå¦‚ Podã€Serviceï¼‰ã€‚ â€Œå¯¹è±¡â€Œæ˜¯èµ„æºçš„å®é™…å®ä¾‹ï¼ˆå¦‚ä¸€ä¸ªåä¸º nginx-pod çš„ Podï¼‰ã€‚ â€Œèµ„æºæ¸…å•â€Œæ˜¯ç”Ÿæˆå¯¹è±¡çš„â€œé…æ–¹â€ï¼ˆYAMLJSON æ–‡ä»¶ï¼‰â€Œã€‚ â€Œç±»æ¯”â€Œï¼š èµ„æº ä¹é«˜ç§¯æœ¨çš„ç±»å‹ï¼ˆæ¯”å¦‚è½¦è½®ã€çª—æˆ·ï¼‰ã€‚ å¯¹è±¡ æ‹¼å¥½çš„ä¹é«˜æ¨¡å‹ï¼ˆæ¯”å¦‚ä¸€è¾†è½¦ï¼‰ã€‚ èµ„æºæ¸…å• æ‹¼è£…è¯´æ˜ä¹¦ï¼ˆå‘Šè¯‰ä½ æ€ä¹ˆæ‹¼ï¼‰â€Œã€‚ é€šè¿‡è¿™ç§æœºåˆ¶ï¼ŒK8S å®ç°äº†å¯¹åº”ç”¨çš„å£°æ˜å¼ç®¡ç†ï¼ˆä½ åªéœ€æè¿°â€œæƒ³è¦ä»€ä¹ˆâ€ï¼Œè€Œéâ€œå¦‚ä½•åšâ€ï¼‰â€Œã€‚ èµ„æºç±»å‹å‘½åç©ºé—´çº§åˆ«å·¥ä½œè´Ÿè½½å‹èµ„æº (Workload)ç”¨äºç®¡ç†å®¹å™¨åŒ–åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼š Podï¼šæœ€åŸºæœ¬çš„å¯è°ƒåº¦å•ä½ï¼ŒåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨â€Œã€‚ Deploymentï¼šç®¡ç†æ— çŠ¶æ€åº”ç”¨ï¼Œæ”¯æŒæ»šåŠ¨æ›´æ–°å’Œå›æ»šâ€Œã€‚ StatefulSetï¼šç®¡ç†æœ‰çŠ¶æ€åº”ç”¨ï¼Œæä¾›ç¨³å®šçš„å­˜å‚¨å’Œå”¯ä¸€æ ‡è¯†â€Œã€‚ DaemonSetï¼šç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹è¿è¡Œä¸€ä¸ª Pod å‰¯æœ¬â€Œã€‚ Job CronJobï¼šç”¨äºä¸€æ¬¡æ€§æˆ–å®šæ—¶ä»»åŠ¡â€Œã€‚ æœåŠ¡å‘ç°åŠè´Ÿè½½å‡è¡¡å‹èµ„æºâ€Œ Serviceï¼šå®šä¹‰æœåŠ¡ç«¯ç‚¹ï¼Œå®ç°å†…éƒ¨æˆ–å¤–éƒ¨è®¿é—®å’Œè´Ÿè½½å‡è¡¡â€Œã€‚ Ingressï¼šç®¡ç†å¤–éƒ¨è®¿é—®çš„è·¯ç”±è§„åˆ™â€Œã€‚ é…ç½®ä¸å­˜å‚¨å‹èµ„æº Volumeï¼šæä¾›æŒä¹…åŒ–å­˜å‚¨æ”¯æŒâ€Œã€‚ ConfigMap Secretï¼šåˆ†åˆ«å­˜å‚¨éæ•æ„Ÿé…ç½®å’Œæ•æ„Ÿæ•°æ®â€Œã€‚ CSIï¼šæ‰©å±•ç¬¬ä¸‰æ–¹å­˜å‚¨æ¥å£â€Œã€‚ é›†ç¾¤çº§èµ„æºâ€Œ Namespaceï¼šé€»è¾‘éš”ç¦»èµ„æºï¼Œæ”¯æŒå¤šç§Ÿæˆ·ç®¡ç†â€Œã€‚ Nodeï¼šä»£è¡¨é›†ç¾¤ä¸­çš„ç‰©ç†æˆ–è™šæ‹Ÿæœºâ€Œã€‚ å…ƒæ•°æ®å‹èµ„æº HPA (HorizontalPodAutoscaler)ï¼šåŸºäºæŒ‡æ ‡è‡ªåŠ¨æ‰©ç¼©å®¹â€Œã€‚ LimitRangeï¼šå®šä¹‰èµ„æºé™åˆ¶èŒƒå›´â€Œã€‚ èµ„æºçš„ç¼–å†™ç»“æ„èµ„æºæ¸…å•å¿…é¡»åŒ…å«ä»¥ä¸‹æ ¸å¿ƒå­—æ®µâ€Œï¼š apiVersion: group/version # èµ„æºæ‰€å±çš„ API ç»„å’Œç‰ˆæœ¬kind: ResourceType # èµ„æºç±»å‹ï¼ˆå¦‚ Deploymentã€Serviceï¼‰metadata: # å…ƒæ•°æ® name: string # èµ„æºåç§° namespace: string # æ‰€å±å‘½åç©ºé—´ï¼ˆå¯é€‰ï¼‰é»˜è®¤æ˜¯spec: # èµ„æºçš„è¯¦ç»†é…ç½® containers: # å®¹å™¨åˆ—è¡¨ï¼ˆä»¥ Pod ä¸ºä¾‹ï¼‰ - name: string # å®¹å™¨åç§° image: string # å®¹å™¨é•œåƒ imagePullPolicy: Always|Never|IfNotPresent # é•œåƒæ‹‰å–ç­–ç•¥ï¼ˆå¯é€‰ï¼‰ èµ„æºæ¸…å•çš„å­—æ®µéœ€ä¸¥æ ¼éµå¾ª K8S API è§„èŒƒï¼Œå¯é€šè¿‡ kubectl explain å‘½ä»¤æŸ¥è¯¢å­—æ®µå®šä¹‰â€Œã€‚ ç¤ºä¾‹apiVersion: v1kind: Podmetadata: name: pod-demo namespace: default labels: app: myappspec: containers: - name: myapp-1 image: wangyanglinux/myapp:v1.0 - name: busybox-1 image: wangyanglinux/tools:busybox command: - /bin/sh - -c - sleep 3600 åˆ›å»ºPod kubectl create -f 1-pod-demo.yaml æŸ¥çœ‹podè¯¦ç»†ä¿¡æ¯ kubectl describe pod pod-demo(podåç§°) å¯ä»¥çœ‹åˆ°podåˆ›å»ºè¿‡ç¨‹ä¸­çš„äº‹ä»¶ï¼š é”™è¯¯æ’æŸ¥apiVersion: v1kind: Podmetadata: name: pod-demo-1 namespace: default labels: app: myappspec: containers: - name: myapp-1 image: wangyanglinux/myapp:v1.0 - name: myapp-2 image: wangyanglinux/myapp:v1.0 cp 1-pod-demo.yaml 2-pod-demo.yaml kubectl apply -f 2-pod-demo.yaml å¯ä»¥çœ‹åˆ° pod-demo-1 åˆ›å»ºå¤±è´¥ æ’æŸ¥é”™è¯¯ï¼š kubectl describe pod pod-demo-1 è¿›å…¥å®¹å™¨æŸ¥çœ‹æ—¥å¿—ï¼š kubectl logs pod-demo-1 -c myapp-2","tags":[null],"categories":[null]},{"title":"MySQLä¸­ä¸€æ¡selectè¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ","path":"/wiki/MySQL/MySQL1.html","content":"ä¸€æ¡SQLæŸ¥è¯¢è¯­å¥çš„æ‰§è¡ŒåŸºç¡€å‡†å¤‡ æˆ‘ä»¬å…ˆåˆ›å»ºä¸€å¼ è¡¨ create table learnhub.user_test( id bigint null, name varchar(255) null, age int null);insert into user_test (id, name, age) values (1, å¼ ä¸‰, 18); æ‰§è¡ŒæŸ¥è¯¢ select * from user_test where id = 1; æ‰§è¡Œå®Œè¿™æ¡sqlåæˆ‘ä»¬èƒ½è·å–åˆ°ä¸€ä¸ªç»“æœã€‚ è¿™é‡Œå°±æœ‰ä¸ªé—®é¢˜mysqlå†…éƒ¨æ˜¯å¦‚ä½•æ‰§è¡Œçš„å‘¢ï¼Ÿ ç»è¿‡å“ªäº›æ­¥éª¤ç»™æˆ‘ä»¬è¿”å›äº†è¿™æ ·çš„ä¸€æ¡æ•°æ®ï¼Ÿ å¸¦ç€è¿™ä¸¤ä¸ªé—®é¢˜æˆ‘ä»¬å…ˆæ¥è®¤è¯†MySQLçš„åŸºç¡€æ¶æ„ã€‚ åŸºç¡€æ¶æ„ä¸‹é¢æ˜¯MySQLçš„åŸºæœ¬æ¶æ„ç¤ºæ„å›¾ï¼Œä»ä¸­ä½ å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°SQLè¯­å¥åœ¨MySQLçš„å„ä¸ªåŠŸèƒ½æ¨¡å—ä¸­çš„æ‰§è¡Œè¿‡ç¨‹ã€‚ å¤§ä½“æ¥è¯´ï¼ŒMySQLåˆ†ä¸ºServerå±‚å’Œå¼•æ“å±‚ä¸¤éƒ¨åˆ†ã€‚ Serverå±‚åŒ…æ‹¬è¿æ¥å™¨ã€æŸ¥è¯¢ç¼“å­˜ã€åˆ†æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ç­‰ï¼Œæ¶µç›–MySQLçš„å¤§å¤šæ•°æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ã€‚ è€Œå­˜å‚¨å¼•æ“å±‚è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œæå–ã€‚å…¶æ¶æ„æ¨¡å¼æ˜¯æ’ä»¶å¼çš„ï¼Œæ”¯æŒInnoDBã€MyISAMã€Memoryç­‰å¤šä¸ªå­˜å‚¨å¼•æ“ã€‚ç°åœ¨æœ€å¸¸ç”¨çš„å­˜å‚¨å¼•æ“æ˜¯InnoDBï¼Œå®ƒä»MySQL 5.5.5ç‰ˆæœ¬å¼€å§‹æˆä¸ºäº†é»˜è®¤å­˜å‚¨å¼•æ“ã€‚ è¿æ¥å™¨æˆ‘ä»¬è¦æ‰§è¡Œsqlè¯­å¥ï¼Œé¦–å…ˆå°±è¦è¾“å…¥ç”¨æˆ·åã€å¯†ç å…ˆè¿æ¥ä¸ŠMySQLã€‚è¿™ä¸ªè¿æ¥MySQLçš„è¿‡ç¨‹ä¸»è¦å°±æ˜¯é€šè¿‡è¿æ¥å™¨ã€‚è¿æ¥å™¨ä¼šå¯¹è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œè®¤è¯ã€‚ å¦‚æœç”¨æˆ·åæˆ–å¯†ç ä¸å¯¹ï¼Œä½ å°±ä¼šæ”¶åˆ°ä¸€ä¸ªAccess denied for userçš„é”™è¯¯ï¼Œç„¶åå®¢æˆ·ç«¯ç¨‹åºç»“æŸæ‰§è¡Œã€‚ å¦‚æœç”¨æˆ·åå¯†ç è®¤è¯é€šè¿‡ï¼Œè¿æ¥å™¨ä¼šåˆ°æƒé™è¡¨é‡Œé¢æŸ¥å‡ºä½ æ‹¥æœ‰çš„æƒé™ã€‚ä¹‹åï¼Œè¿™ä¸ªè¿æ¥é‡Œé¢çš„æƒé™åˆ¤æ–­é€»è¾‘ï¼Œéƒ½å°†ä¾èµ–äºæ­¤æ—¶è¯»åˆ°çš„æƒé™ã€‚ è¿™å°±æ„å‘³ç€ï¼Œä¸€ä¸ªç”¨æˆ·æˆåŠŸå»ºç«‹è¿æ¥åï¼Œå³ä½¿ä½ ç”¨ç®¡ç†å‘˜è´¦å·å¯¹è¿™ä¸ªç”¨æˆ·çš„æƒé™åšäº†ä¿®æ”¹ï¼Œä¹Ÿä¸ä¼šå½±å“å·²ç»å­˜åœ¨è¿æ¥çš„æƒé™ã€‚ä¿®æ”¹å®Œæˆåï¼Œåªæœ‰å†æ–°å»ºçš„è¿æ¥æ‰ä¼šä½¿ç”¨æ–°çš„æƒé™è®¾ç½®ã€‚ è¿æ¥å®Œæˆåæˆ‘ä»¬å¯ä»¥ä½¿ç”¨show processlistæ¥æŸ¥çœ‹è¿æ¥çš„çŠ¶æ€ã€‚ å¦‚æœè¿æ¥åï¼Œæ²¡æœ‰åç»­æ“ä½œè¿æ¥å°±å¤„äºç©ºé—²çŠ¶æ€æ­¤æ—¶Commandåˆ—ä¼šæ˜¾ç¤ºä¸ºSleepã€‚å¦‚æœå®¢æˆ·ç«¯å¤ªé•¿æ—¶é—´æ²¡æœ‰åŠ¨é™ï¼Œæ­¤æ—¶è¿æ¥å™¨å°±ä¼šæ–­å¼€æ­¤è¿æ¥ã€‚è¿™ä¸ªæ—¶é—´ç”±wait_timeouté»˜è®¤ä¸º8å°æ—¶ï¼Œå¯ä»¥é€šè¿‡show global variables like wait_timeout;æŸ¥çœ‹ã€‚ å¦‚æœåœ¨è¿æ¥è¢«æ–­å¼€ä¹‹åï¼Œå®¢æˆ·ç«¯å†æ¬¡å‘é€è¯·æ±‚çš„è¯ï¼Œå°±ä¼šæ”¶åˆ°ä¸€ä¸ªé”™è¯¯æé†’ï¼š Lost connection to MySQL server during queryã€‚è¿™æ—¶å€™å¦‚æœä½ è¦ç»§ç»­ï¼Œå°±éœ€è¦é‡è¿ï¼Œç„¶åå†æ‰§è¡Œè¯·æ±‚äº†ã€‚ MySqlæœ€å¤§æ”¯æŒçš„è¿æ¥æ•°é»˜è®¤ä¸º151ï¼Œç”±max_connectionsæ§åˆ¶ã€‚è¶…è¿‡è¿™ä¸ªå€¼ï¼Œç³»ç»Ÿå°±ä¼šæ‹’ç»æ¥ä¸‹æ¥çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶æŠ¥é”™æç¤ºâ€œToo many connectionsâ€ã€‚ show variables like max_connections; æŸ¥è¯¢ç¼“å­˜MySQL 8.0ç‰ˆæœ¬ç›´æ¥å°†æŸ¥è¯¢ç¼“å­˜çš„æ•´å—åŠŸèƒ½åˆ æ‰äº†ï¼Œä¹Ÿå°±æ˜¯è¯´8.0å¼€å§‹å½»åº•æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½äº†ã€‚ è§£æSQLåˆ†æå™¨å»ºç«‹å®Œè¿æ¥åï¼Œå°±å¯ä»¥æ‰§è¡ŒæŸ¥è¯¢æ“ä½œäº†ã€‚MySQLæ¥æ”¶åˆ°ä¸€æ¡å‘é€è¿‡æ¥çš„SQLï¼Œé¦–å…ˆéœ€è¦è§£æè¿™ä¸ªSQLæ‰èƒ½çŸ¥é“è¿™ä¸ªSQLè¦åšäº›ä»€ä¹ˆã€‚ åˆ†æå™¨å…ˆä¼šåšè¯æ³•åˆ†æã€‚ä½ è¾“å…¥çš„æ˜¯ç”±å¤šä¸ªå­—ç¬¦ä¸²å’Œç©ºæ ¼ç»„æˆçš„ä¸€æ¡SQLè¯­å¥ï¼ŒMySQLéœ€è¦è¯†åˆ«å‡ºé‡Œé¢çš„å­—ç¬¦ä¸²åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œä»£è¡¨ä»€ä¹ˆã€‚ MySQLä»ä½ è¾“å…¥çš„selectè¿™ä¸ªå…³é”®å­—è¯†åˆ«å‡ºæ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ã€‚å®ƒä¹Ÿè¦æŠŠå­—ç¬¦ä¸²user_testè¯†åˆ«æˆè¡¨åuser_testï¼ŒæŠŠå­—ç¬¦ä¸²idè¯†åˆ«æˆåˆ—idã€‚ åšå®Œäº†è¿™äº›è¯†åˆ«ä»¥åï¼Œå°±è¦åšè¯­æ³•åˆ†æã€‚æ ¹æ®è¯æ³•åˆ†æçš„ç»“æœï¼Œè¯­æ³•åˆ†æå™¨ä¼šæ ¹æ®è¯­æ³•è§„åˆ™ï¼Œåˆ¤æ–­ä½ è¾“å…¥çš„è¿™ä¸ªSQLè¯­å¥æ˜¯å¦æ»¡è¶³MySQLè¯­æ³•ã€‚ å¦‚æœä½ çš„è¯­å¥ä¸å¯¹ï¼Œå°±ä¼šæ”¶åˆ°You have an error in your SQL syntaxçš„é”™è¯¯æé†’ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªè¯­å¥selectå°‘æ‰“äº†å¼€å¤´çš„å­—æ¯sã€‚ æ‰§è¡ŒSQLé¢„å¤„ç†å™¨é¢„å¤„ç†å™¨é˜¶æ®µä¸»è¦åšäº†ä¸¤ä»¶äº‹ï¼š æ£€æŸ¥ SQL æŸ¥è¯¢è¯­å¥ä¸­çš„è¡¨æˆ–è€…å­—æ®µæ˜¯å¦å­˜åœ¨ï¼› å°† select * ä¸­çš„ * ç¬¦å·ï¼Œæ‰©å±•ä¸ºè¡¨ä¸Šçš„æ‰€æœ‰åˆ—ï¼› ä¸‹é¢è¿™æ¡æŸ¥è¯¢è¯­å¥ï¼Œå¦‚æœuser_test è¿™å¼ è¡¨æ˜¯ä¸å­˜åœ¨çš„ï¼Œè¿™æ—¶ MySQL å°±ä¼šåœ¨æ‰§è¡Œ SQL æŸ¥è¯¢è¯­å¥çš„ prepare é˜¶æ®µä¸­æŠ¥é”™ã€‚ select * from user_test where id = 1; ä¼˜åŒ–å™¨ç»è¿‡åˆ†æå™¨åï¼ŒMySQLçŸ¥é“äº†ä½ è¦åšä»€ä¹ˆäº†ã€‚åœ¨çœŸæ­£å¼€å§‹æ‰§è¡Œå‰è¿˜è¦ç»è¿‡ä¼˜åŒ–å™¨çš„å¤„ç†ã€‚ ä¼˜åŒ–å™¨ä¸»è¦ä½œç”¨æ˜¯åœ¨æ‰§è¡Œå¤æ‚sqlæ—¶é€‰æ‹©ä¸€ä¸ªæœ€ä¼˜æ–¹æ¡ˆï¼Œä¾‹å¦‚æœ‰è¡¨ä¸­å¤šä¸ªç´¢å¼•ï¼Œå†³å®šèµ°å“ªä¸ªç´¢å¼•ï¼›æˆ–è€…è¯­å¥ä¸­æœ‰å¤šä¸ªè¡¨å…³è”ï¼Œå†³å®šè¡¨å…³è”çš„é¡ºåºã€‚æ¯”å¦‚æ‰§è¡Œä¸‹é¢è¿™æ ·çš„è¯­å¥ï¼Œè¿™ä¸ªè¯­å¥æ˜¯æ‰§è¡Œä¸¤ä¸ªè¡¨çš„joinï¼š select * from t1 join t2 using(ID) where t1.c=10 and t2.d=20; æ—¢å¯ä»¥å…ˆä»è¡¨t1é‡Œé¢å–å‡ºc10çš„è®°å½•çš„IDå€¼ï¼Œå†æ ¹æ®IDå€¼å…³è”åˆ°è¡¨t2ï¼Œå†åˆ¤æ–­t2é‡Œé¢dçš„å€¼æ˜¯å¦ç­‰äº20ã€‚ ä¹Ÿå¯ä»¥å…ˆä»è¡¨t2é‡Œé¢å–å‡ºd20çš„è®°å½•çš„IDå€¼ï¼Œå†æ ¹æ®IDå€¼å…³è”åˆ°t1ï¼Œå†åˆ¤æ–­t1é‡Œé¢cçš„å€¼æ˜¯å¦ç­‰äº10ã€‚ è¿™ä¸¤ç§æ‰§è¡Œæ–¹æ³•çš„é€»è¾‘ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯æ‰§è¡Œçš„æ•ˆç‡ä¼šæœ‰ä¸åŒï¼Œè€Œä¼˜åŒ–å™¨çš„ä½œç”¨å°±æ˜¯å†³å®šé€‰æ‹©ä½¿ç”¨å“ªä¸€ä¸ªæ–¹æ¡ˆã€‚ ä¼˜åŒ–å™¨é˜¶æ®µå®Œæˆåï¼Œè¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæ–¹æ¡ˆå°±ç¡®å®šä¸‹æ¥äº†ï¼Œç„¶åè¿›å…¥æ‰§è¡Œå™¨é˜¶æ®µã€‚ æ‰§è¡Œå™¨MySQLé€šè¿‡åˆ†æå™¨çŸ¥é“äº†ä½ æƒ³åšä»€ä¹ˆï¼Œé€šè¿‡ä¼˜åŒ–å™¨çŸ¥é“äº†è¯¥æ€ä¹ˆåšï¼Œäºæ˜¯è¿›å…¥æ‰§è¡Œé˜¶æ®µï¼Œå¼€å§‹æ‰§è¡Œè¯­å¥ã€‚ å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œè¦å…ˆåˆ¤æ–­ä¸€ä¸‹ä½ å¯¹è¿™ä¸ªè¡¨Tæœ‰æ²¡æœ‰æ‰§è¡ŒæŸ¥è¯¢çš„æƒé™ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä¼šè¿”å›æ²¡æœ‰æƒé™çš„é”™è¯¯ã€‚ mysql select * from T where ID=10;ERROR 1142 (42000): SELECT command denied to user b@localhost for table T å¦‚æœæœ‰æƒé™ï¼Œå°±æ‰“å¼€è¡¨ç»§ç»­æ‰§è¡Œã€‚æ‰“å¼€è¡¨çš„æ—¶å€™ï¼Œæ‰§è¡Œå™¨å°±ä¼šæ ¹æ®è¡¨çš„å¼•æ“å®šä¹‰ï¼Œå»ä½¿ç”¨è¿™ä¸ªå¼•æ“æä¾›çš„æ¥å£ã€‚ æ¯”å¦‚æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­çš„è¡¨Tä¸­ï¼ŒIDå­—æ®µæ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆæ‰§è¡Œå™¨çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š è°ƒç”¨InnoDBå¼•æ“æ¥å£å–è¿™ä¸ªè¡¨çš„ç¬¬ä¸€è¡Œï¼Œåˆ¤æ–­IDå€¼æ˜¯ä¸æ˜¯10ï¼Œå¦‚æœä¸æ˜¯åˆ™è·³è¿‡ï¼Œå¦‚æœæ˜¯åˆ™å°†è¿™è¡Œå­˜åœ¨ç»“æœé›†ä¸­ï¼› è°ƒç”¨å¼•æ“æ¥å£å–â€œä¸‹ä¸€è¡Œâ€ï¼Œé‡å¤ç›¸åŒçš„åˆ¤æ–­é€»è¾‘ï¼Œç›´åˆ°å–åˆ°è¿™ä¸ªè¡¨çš„æœ€åä¸€è¡Œã€‚ æ‰§è¡Œå™¨å°†ä¸Šè¿°éå†è¿‡ç¨‹ä¸­æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è¡Œç»„æˆçš„è®°å½•é›†ä½œä¸ºç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ è‡³æ­¤ï¼Œè¿™ä¸ªè¯­å¥å°±æ‰§è¡Œå®Œæˆäº†ã€‚ æ€»ç»“æ‰§è¡Œä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥ï¼ŒæœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ è¿æ¥å™¨ï¼šå»ºç«‹è¿æ¥ï¼Œç®¡ç†è¿æ¥ã€æ ¡éªŒç”¨æˆ·èº«ä»½ï¼› æŸ¥è¯¢ç¼“å­˜ï¼šæŸ¥è¯¢è¯­å¥å¦‚æœå‘½ä¸­æŸ¥è¯¢ç¼“å­˜åˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚MySQL 8.0 å·²åˆ é™¤è¯¥æ¨¡å—ï¼› è§£æ SQLï¼šé€šè¿‡è§£æå™¨å¯¹ SQL æŸ¥è¯¢è¯­å¥è¿›è¡Œè¯æ³•åˆ†æã€è¯­æ³•åˆ†æï¼Œç„¶åæ„å»ºè¯­æ³•æ ‘ï¼Œæ–¹ä¾¿åç»­æ¨¡å—è¯»å–è¡¨åã€å­—æ®µã€è¯­å¥ç±»å‹ï¼› æ‰§è¡Œ SQLï¼š é¢„å¤„ç†é˜¶æ®µï¼šæ£€æŸ¥è¡¨æˆ–å­—æ®µæ˜¯å¦å­˜åœ¨ï¼›å°† select * ä¸­çš„ * ç¬¦å·æ‰©å±•ä¸ºè¡¨ä¸Šçš„æ‰€æœ‰åˆ—ï¼› ä¼˜åŒ–é˜¶æ®µï¼šåŸºäºæŸ¥è¯¢æˆæœ¬çš„è€ƒè™‘ï¼Œ é€‰æ‹©æŸ¥è¯¢æˆæœ¬æœ€å°çš„æ‰§è¡Œè®¡åˆ’ï¼› æ‰§è¡Œé˜¶æ®µï¼šæ ¹æ®æ‰§è¡Œè®¡åˆ’æ‰§è¡Œ SQL æŸ¥è¯¢è¯­å¥ï¼Œä»å­˜å‚¨å¼•æ“è¯»å–è®°å½•ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼›","tags":[null],"categories":[null]},{"title":"MySQLä¸­ä¸€è¡Œè®°å½•æ˜¯æ€ä¹ˆå­˜å‚¨çš„ï¼Ÿ","path":"/wiki/MySQL/MySQL2.html","content":"MySQLä¸­æ•°æ®å­˜æ”¾åœ¨å“ª?MySQLåœ¨æœºå™¨æ‰ç”µé‡å¯æœåŠ¡åä»èƒ½å¤ŸæŸ¥è¯¢åˆ°å·²å­˜å‚¨çš„æ•°æ®æ˜¯å› ä¸ºæ•°æ®å­˜å‚¨åœ¨ç£ç›˜ä¸­ï¼Œéšç€MySQLæœåŠ¡é‡å¯ä¼šåŠ è½½ç£ç›˜ä¸­çš„æ•°æ®ï¼Œè¿™æ ·ä¿è¯æ•°æ®çš„æŒä¹…æ€§ã€‚é‚£ä¹ˆæœ‰ä¸ªé—®é¢˜ï¼ŒMySQLçš„æ•°æ®å­˜å‚¨åœ¨ç£ç›˜å“ªï¼Ÿ é€šè¿‡SHOW VARIABLES LIKE datadir;å‘½ä»¤å¯ä»¥æŸ¥çœ‹MySQLçš„æ•°æ®æ–‡ä»¶å­˜æ”¾ä½ç½® åœ¨MySQLä¸­ï¼Œæˆ‘ä»¬æ¯åˆ›å»ºä¸€ä¸ªæ•°æ®åº“æ—¶éƒ½ä¼šåœ¨/var/lib/mysql/é‡Œåˆ›å»ºä¸€ä¸ªä»¥æ•°æ®åº“åä¸ºåçš„ç›®å½•ï¼Œç„¶åä¿å­˜è¡¨æ•°æ®æ–‡ä»¶åœ¨è¯¥ç›®å½•ä¸‹ã€‚ ä¾‹å¦‚ï¼šåˆ›å»ºä¸€ä¸ªTestæ•°æ®åº“ï¼Œåœ¨è¯¥åº“ä¸­åˆ›å»ºä¸€ä¸ªtestè¡¨ã€‚è¿›å…¥åˆ°Testç›®å½•å¯ä»¥çœ‹åˆ°ä»¥ä¸‹å†…å®¹ å¯ä»¥çœ‹åˆ°Testç›®å½•ä¸‹æœ‰ä¸€ä¸ªtest.ibdæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸­ä¿å­˜äº†testè¡¨çš„ç»“æ„åŠæ•°æ®ã€‚ è¡¨ä¸­æ•°æ®å­˜å‚¨ç»“æ„æ˜¯æ€æ ·çš„ï¼Ÿ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¡¨ä¸­çš„æ•°æ®æ˜¯æŒ‰ç…§ä¸€è¡Œä¸€è¡Œç»„æˆçš„ï¼Œå®é™…æ•´ä¸ªè¡¨ç©ºé—´åœ¨ InnoDB å¼•æ“ä¸­ï¼Œæ˜¯ç”±æ®µï¼ˆsegmentï¼‰ã€åŒºï¼ˆextentï¼‰ã€é¡µï¼ˆpageï¼‰ã€è¡Œï¼ˆrowï¼‰ç»„æˆã€‚ æˆ‘ä»¬ä»ä¸‹åˆ°ä¸Šçœ‹ã€‚ è¡Œï¼ˆrowï¼‰ æ•°æ®åº“è¡¨ä¸­çš„è®°å½•éƒ½æ˜¯æŒ‰è¡Œï¼ˆrowï¼‰æ¥å­˜æ”¾çš„ã€‚æ¯è¡Œè®°å½•æ ¹æ®ä¸åŒçš„æ ¼å¼ï¼Œæœ‰ä¸åŒçš„å­˜å‚¨ç»“æ„ã€‚ é¡µï¼ˆpageï¼‰ æ•°æ®åº“ä¸­è®°å½•æ˜¯ä¸€è¡Œè¡Œè®°å½•çš„ï¼Œä½†æ˜¯è¯»å–æ•°æ®çš„æ—¶å€™å¹¶ä¸æ˜¯æŒ‰ç…§ä¸€è¡Œä¸€è¡Œæ¥è¯»å–ï¼Œå¦åˆ™ä¸€æ¬¡è¯»å–ï¼ˆä¸€æ¬¡IOï¼‰åªèƒ½å¤„ç†ä¸€è¡Œæ•°æ®ï¼Œæ•ˆç‡å¤ªä½ã€‚å› æ­¤ï¼Œåœ¨InnoDBä¸­çš„æ•°æ®æ˜¯ä»¥ã€é¡µã€‘ä¸ºå•ä½æ¥è¯»å†™çš„ã€‚å½“éœ€è¦è¯»å–ä¸€è¡Œè®°å½•æ—¶ï¼Œä¼šå°†è¯¥è¡Œè®°å½•æ‰€åœ¨é¡µä¸€èµ·è¯»å–æ•´ä½“æ”¾å…¥å†…å­˜ä¸­ã€‚é»˜è®¤æ¯ä¸ªé¡µçš„å¤§å°æ˜¯16KBï¼Œä¹Ÿå°±æ˜¯è¯´æœ€å¤šåªèƒ½ä¿è¯16KBçš„è¿ç»­å­˜å‚¨ç©ºé—´ã€‚é¡µçš„ç±»å‹æœ‰å¾ˆå¤šï¼Œå¸¸è§çš„æœ‰æ•°æ®é¡µã€undo æ—¥å¿—é¡µã€æº¢å‡ºé¡µç­‰ç­‰ã€‚è¡¨ä¸­çš„è®°å½•å­˜å‚¨åœ¨ã€Œæ•°æ®é¡µã€é‡Œé¢ã€‚ åŒºï¼ˆextentï¼‰ åœ¨ InnoDB å­˜å‚¨å¼•æ“ä¸­æ˜¯ä½¿ç”¨ B+ æ ‘æ¥ç»„ç»‡æ•°æ®çš„ã€‚ åœ¨å­˜å‚¨æ•°æ®çš„å¶å­èŠ‚ç‚¹ä¸Šæ˜¯é€šè¿‡åŒå‘é“¾è¡¨è¿æ¥èµ·æ¥çš„ï¼Œå¦‚æœä»¥é¡µä¸ºå•ä½æ¥åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œé‚£ä¹ˆé“¾è¡¨ä¸­ç›¸é‚»çš„ä¸¤ä¸ªé¡µä¹‹é—´çš„ç‰©ç†ä½ç½®å¹¶ä¸æ˜¯è¿ç»­çš„ï¼Œå¯èƒ½ç¦»å¾—éå¸¸è¿œï¼Œé‚£ä¹ˆç£ç›˜æŸ¥è¯¢æ—¶å°±ä¼šæœ‰å¤§é‡çš„éšæœºIOï¼Œéšæœº IO æ˜¯éå¸¸æ…¢çš„ã€‚ æ‰€ä»¥åœ¨è¡¨ä¸­æœ‰å¤§é‡æ•°æ®æ—¶ï¼Œä¸ºæŸä¸ªç´¢å¼•åˆ†é…ç©ºé—´çš„æ—¶å€™å°±ä¸å†æŒ‰ç…§é¡µä¸ºå•ä½åˆ†é…äº†ï¼Œè€Œæ˜¯æŒ‰ç…§åŒºï¼ˆextentï¼‰ä¸ºå•ä½åˆ†é…ã€‚æ¯ä¸ªåŒºçš„å¤§å°ä¸º 1MBï¼Œå¯¹äº 16KB çš„é¡µæ¥è¯´ï¼Œè¿ç»­çš„ 64 ä¸ªé¡µä¼šè¢«åˆ’ä¸ºä¸€ä¸ªåŒºï¼Œè¿™æ ·å°±ä½¿å¾—é“¾è¡¨ä¸­ç›¸é‚»çš„é¡µçš„ç‰©ç†ä½ç½®ä¹Ÿç›¸é‚»ï¼Œå°±èƒ½ä½¿ç”¨é¡ºåº IO äº†ã€‚ æ®µï¼ˆsegmentï¼‰ è¡¨ç©ºé—´æ˜¯ç”±å„ä¸ªæ®µï¼ˆsegmentï¼‰ç»„æˆçš„ï¼Œæ®µæ˜¯ç”±å¤šä¸ªåŒºï¼ˆextentï¼‰ç»„æˆçš„ã€‚æ®µä¸€èˆ¬åˆ†ä¸ºæ•°æ®æ®µã€ç´¢å¼•æ®µå’Œå›æ»šæ®µç­‰ã€‚ ç´¢å¼•æ®µï¼šå­˜æ”¾ B + æ ‘çš„éå¶å­èŠ‚ç‚¹çš„åŒºçš„é›†åˆï¼› æ•°æ®æ®µï¼šå­˜æ”¾ B + æ ‘çš„å¶å­èŠ‚ç‚¹çš„åŒºçš„é›†åˆï¼› å›æ»šæ®µï¼šå­˜æ”¾çš„æ˜¯å›æ»šæ•°æ®çš„åŒºçš„é›†åˆï¼ŒMVCC å°±æ˜¯åˆ©ç”¨äº†å›æ»šæ®µå®ç°äº†å¤šç‰ˆæœ¬æŸ¥è¯¢æ•°æ®ã€‚ InnoDBè¡Œæ ¼å¼é•¿å•¥æ ·ï¼Ÿè¡Œæ ¼å¼ï¼ˆrow_formatï¼‰ï¼Œå°±æ˜¯ä¸€æ¡è®°å½•åœ¨ç£ç›˜ä¸­çš„å­˜å‚¨ç»“æ„ã€‚ InnoDBæä¾›äº†4ä¸­è¡Œæ ¼å¼ï¼Œåˆ†åˆ«æ˜¯Redundantã€Compactã€Dynamicå’Œ Compressed è¡Œæ ¼å¼ã€‚ Redundant æ˜¯å¾ˆå¤è€çš„è¡Œæ ¼å¼äº†ï¼Œ MySQL 5.0 ç‰ˆæœ¬ä¹‹å‰ç”¨çš„è¡Œæ ¼å¼ï¼Œç°åœ¨åŸºæœ¬æ²¡äººç”¨äº†ã€‚ ç”±äº Redundant ä¸æ˜¯ä¸€ç§ç´§å‡‘çš„è¡Œæ ¼å¼ï¼Œæ‰€ä»¥ MySQL 5.0 ä¹‹åå¼•å…¥äº† Compact è¡Œè®°å½•å­˜å‚¨æ–¹å¼ï¼ŒCompact æ˜¯ä¸€ç§ç´§å‡‘çš„è¡Œæ ¼å¼ï¼Œè®¾è®¡çš„åˆè¡·å°±æ˜¯ä¸ºäº†è®©ä¸€ä¸ªæ•°æ®é¡µä¸­å¯ä»¥å­˜æ”¾æ›´å¤šçš„è¡Œè®°å½•ï¼Œä» MySQL 5.1 ç‰ˆæœ¬ä¹‹åï¼Œè¡Œæ ¼å¼é»˜è®¤è®¾ç½®æˆ Compactã€‚ Dynamic å’Œ Compressed ä¸¤ä¸ªéƒ½æ˜¯ç´§å‡‘çš„è¡Œæ ¼å¼ï¼Œå®ƒä»¬çš„è¡Œæ ¼å¼éƒ½å’Œ Compact å·®ä¸å¤šï¼Œå› ä¸ºéƒ½æ˜¯åŸºäº Compact æ”¹è¿›ä¸€ç‚¹ä¸œè¥¿ã€‚ä» MySQL5.7 ç‰ˆæœ¬ä¹‹åï¼Œé»˜è®¤ä½¿ç”¨ Dynamic è¡Œæ ¼å¼ã€‚ Compactè¡Œæ ¼å¼é•¿å•¥æ ·ï¼Ÿ ä¸€æ¡å®Œæ•´çš„è®°å½•åˆ†ä¸ºã€è®°å½•é¢å¤–ä¿¡æ¯ã€‘å’Œã€è®°å½•çœŸå®æ•°æ®ã€‘ä¸¤éƒ¨åˆ†ã€‚ è®°å½•é¢å¤–ä¿¡æ¯è®°å½•çš„é¢å¤–ä¿¡æ¯åŒ…å« 3 ä¸ªéƒ¨åˆ†ï¼šå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€NULL å€¼åˆ—è¡¨ã€è®°å½•å¤´ä¿¡æ¯ã€‚ å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨åœ¨ MySql ä¸­ char æ˜¯å®šé•¿çš„ï¼Œvarchar æ˜¯å˜é•¿çš„ï¼Œvarchar å­—æ®µå®é™…å­˜å‚¨çš„æ•°æ®çš„é•¿åº¦ï¼ˆå¤§å°ï¼‰ä¸å›ºå®šçš„ã€‚æ‰€ä»¥åœ¨å­˜å‚¨çš„æ—¶å€™éœ€è¦å°†æ•°æ®çš„å¤§å°ä¹Ÿå­˜èµ·æ¥ï¼Œå­˜åˆ° ã€å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€‘ ä¸­ã€‚è¯»å–æ—¶å†æ ¹æ®å­—æ®µé•¿åº¦åˆ—è¡¨ä¸­çš„é•¿åº¦å»è¯»å–å¯¹åº”å¤§å°çš„æ•°æ®ã€‚ ä¸ºäº†å±•ç¤ºã€å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€‘å…·ä½“æ˜¯æ€ä¹ˆä¿å­˜ã€å˜é•¿å­—æ®µçš„çœŸå®æ•°æ®å ç”¨çš„å­—èŠ‚æ•°ã€‘ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºè¿™æ ·ä¸€å¼ è¡¨ï¼Œå­—ç¬¦é›†æ˜¯ asciiï¼ˆæ‰€ä»¥æ¯ä¸€ä¸ªå­—ç¬¦å ç”¨çš„ 1 å­—èŠ‚ï¼‰ï¼Œè¡Œæ ¼å¼æ˜¯ Compactï¼Œuser è¡¨ä¸­ name å’Œ phone å­—æ®µéƒ½æ˜¯å˜é•¿å­—æ®µï¼š CREATE TABLE `user` ( `id` int(20) NOT NULL, `name` VARCHAR(20) DEFAULT NULL, `phone` VARCHAR(20) DEFAULT NULL, `sex` int(1) DEFAULT NULL, PRIMARY KEY (`id`) USING BTREE) ENGINE = InnoDB DEFAULT CHARACTER SET = ascii ROW_FORMAT = COMPACT; åœ¨ user è¡¨ä¸­æ’å…¥ä¸‰è¡Œæ•°æ®ï¼š æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸‰è¡Œæ•°æ®çš„ã€å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€‘æ˜¯æ€æ ·å­˜å‚¨çš„ã€‚ å…ˆçœ‹ç¬¬ä¸€æ¡è®°å½•ï¼š idå’Œsexéƒ½æ˜¯å®šé•¿çš„ä¸ç”¨ç®¡ï¼› nameåˆ—å€¼ä¸ºaï¼ŒçœŸå®å ç”¨å­—èŠ‚æ•°æ˜¯ 1 ä¸ªå­—èŠ‚ï¼Œåå…­è¿›åˆ¶è¡¨ç¤ºä¸º 0x01ï¼› phoneåˆ—å€¼ä¸º155ï¼ŒçœŸå®å ç”¨å­—èŠ‚æ•°æ˜¯ 3 ä¸ªå­—èŠ‚ï¼Œåå…­è¿›åˆ¶è¡¨ç¤ºä¸º 0x03; è¿™äº›å˜é•¿å­—æ®µçš„çœŸå®æ•°æ®å ç”¨çš„å­—èŠ‚æ•°ä¼šæŒ‰ç…§åˆ—çš„é¡ºåº é€†åºå­˜æ”¾ã€‚ åŒç†ï¼Œç¬¬äºŒæ¡è®°å½•æ ¼å¼å¦‚ä¸‹ï¼š ç¬¬ä¸‰æ¡è®°å½•ä¸­ phone åˆ—çš„å€¼æ˜¯ NULLï¼ŒNULL æ˜¯ä¸ä¼šå­˜æ”¾åœ¨è¡Œæ ¼å¼ä¸­è®°å½•çš„çœŸå®æ•°æ®éƒ¨åˆ†é‡Œçš„ï¼Œæ‰€ä»¥ã€Œå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€é‡Œä¸éœ€è¦ä¿å­˜å€¼ä¸º NULL çš„å˜é•¿å­—æ®µçš„é•¿åº¦ã€‚ ã€å˜é•¿å­—æ®µå­—èŠ‚æ•°åˆ—è¡¨ã€‘ä¸æ˜¯å¿…é¡»çš„ã€‚ å½“æ•°æ®è¡¨æ²¡æœ‰å˜é•¿å­—æ®µçš„æ—¶å€™ï¼Œæ¯”å¦‚å…¨éƒ¨éƒ½æ˜¯ int ç±»å‹çš„å­—æ®µï¼Œè¿™æ—¶å€™è¡¨é‡Œçš„è¡Œæ ¼å¼å°±ä¸ä¼šæœ‰ã€å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€‘äº†ï¼Œå› ä¸ºæ²¡å¿…è¦ï¼Œä¸å¦‚å»æ‰ä»¥èŠ‚çœç©ºé—´ã€‚ æ‰€ä»¥ã€å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€‘åªå‡ºç°åœ¨æ•°æ®è¡¨æœ‰å˜é•¿å­—æ®µçš„æ—¶å€™ã€‚ Nullå€¼åˆ—è¡¨åœ¨ä¸Šè¿° user è¡¨ä¸­ï¼Œå­˜åœ¨å­—æ®µå€¼ä¸º Null çš„åˆ—ï¼Œåœ¨ Compact è¡Œæ ¼å¼ä¸­ä¼šæŠŠè¿™äº›å€¼ä¸º Null çš„åˆ—å­˜å‚¨åˆ° Null å€¼åˆ—è¡¨ä¸­ã€‚ å­˜åœ¨å…è®¸ NULL å€¼çš„åˆ—ï¼Œåˆ™æ¯ä¸ªåˆ—å¯¹åº”ä¸€ä¸ªäºŒè¿›åˆ¶ä½ï¼ˆbitï¼‰ï¼ŒäºŒè¿›åˆ¶ä½æŒ‰ç…§åˆ—çš„é¡ºåºé€†åºæ’åˆ—ã€‚ äºŒè¿›åˆ¶ä½çš„å€¼ä¸º1æ—¶ï¼Œä»£è¡¨è¯¥åˆ—çš„å€¼ä¸ºNULLã€‚ äºŒè¿›åˆ¶ä½çš„å€¼ä¸º0æ—¶ï¼Œä»£è¡¨è¯¥åˆ—çš„å€¼ä¸ä¸ºNULLã€‚ å¦å¤–ï¼ŒNULL å€¼åˆ—è¡¨å¿…é¡»ç”¨æ•´æ•°ä¸ªå­—èŠ‚çš„ä½è¡¨ç¤ºï¼ˆ1å­—èŠ‚8ä½ï¼‰ï¼Œå¦‚æœä½¿ç”¨çš„äºŒè¿›åˆ¶ä½ä¸ªæ•°ä¸è¶³æ•´æ•°ä¸ªå­—èŠ‚ï¼Œåˆ™åœ¨å­—èŠ‚çš„é«˜ä½è¡¥ 0ã€‚ ä»¥ user è¡¨ä¸ºä¾‹ï¼Œä»¥ä¸‹å±•ç¤ºuser è¡¨ä¸­ä¸‰æ¡è®°å½• ã€Nullå€¼åˆ—è¡¨ã€‘çš„å­˜å‚¨æ–¹å¼ã€‚ å…ˆæ¥çœ‹ç¬¬ä¸€æ¡è®°å½•ï¼Œç¬¬ä¸€æ¡è®°å½•æ‰€æœ‰åˆ—éƒ½æœ‰å€¼ï¼Œä¸å­˜åœ¨ NULL å€¼ï¼Œæ‰€ä»¥ç”¨äºŒè¿›åˆ¶æ¥è¡¨ç¤ºä¸ºï¼š ä½†æ˜¯ InnoDB æ˜¯ç”¨æ•´æ•°å­—èŠ‚çš„äºŒè¿›åˆ¶ä½æ¥è¡¨ç¤º NULL å€¼åˆ—è¡¨çš„ï¼Œç°åœ¨ä¸è¶³ 8 ä½ï¼Œæ‰€ä»¥è¦åœ¨é«˜ä½è¡¥ 0ï¼Œæœ€ç»ˆç”¨äºŒè¿›åˆ¶æ¥è¡¨ç¤ºä¸ºï¼š æ‰€ä»¥ï¼Œå¯¹äºç¬¬ä¸€æ¡æ•°æ®ï¼ŒNULL å€¼åˆ—è¡¨ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºæ˜¯ 0x00ã€‚ åŒç†ï¼Œç¬¬äºŒæ¡è®°å½• age åˆ—æ˜¯ NULL å€¼ï¼Œæ‰€ä»¥ï¼Œå¯¹äºç¬¬äºŒæ¡æ•°æ®ï¼ŒNULLå€¼åˆ—è¡¨ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºæ˜¯ 0x04ã€‚ ç¬¬ä¸‰æ¡è®°å½• phone åˆ— å’Œ age åˆ—æ˜¯ NULL å€¼ï¼Œæ‰€ä»¥ï¼Œå¯¹äºç¬¬ä¸‰æ¡æ•°æ®ï¼ŒNULL å€¼åˆ—è¡¨ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºæ˜¯ 0x06ã€‚ NULL å€¼åˆ—è¡¨ä¹Ÿä¸æ˜¯å¿…é¡»çš„ã€‚ å½“æ•°æ®è¡¨çš„å­—æ®µéƒ½å®šä¹‰æˆ NOT NULL çš„æ—¶å€™ï¼Œè¿™æ—¶å€™è¡¨é‡Œçš„è¡Œæ ¼å¼å°±ä¸ä¼šæœ‰ NULL å€¼åˆ—è¡¨äº†ã€‚ æ‰€ä»¥åœ¨è®¾è®¡æ•°æ®åº“è¡¨çš„æ—¶å€™ï¼Œé€šå¸¸éƒ½æ˜¯å»ºè®®å°†å­—æ®µè®¾ç½®ä¸º NOT NULLï¼Œè¿™æ ·å¯ä»¥è‡³å°‘èŠ‚çœ 1 å­—èŠ‚çš„ç©ºé—´ï¼ˆNULL å€¼åˆ—è¡¨è‡³å°‘å ç”¨ 1 å­—èŠ‚ç©ºé—´ï¼‰ã€‚ ã€NULL å€¼åˆ—è¡¨ã€‘çš„ç©ºé—´ä¸æ˜¯å›ºå®š 1 å­—èŠ‚çš„ã€‚ å½“ä¸€æ¡è®°å½•æœ‰ 9 ä¸ªå­—æ®µå€¼éƒ½æ˜¯ NULLï¼Œé‚£ä¹ˆå°±ä¼šåˆ›å»º 2 å­—èŠ‚ç©ºé—´çš„ã€NULL å€¼åˆ—è¡¨ã€‘ï¼Œä»¥æ­¤ç±»æ¨ã€‚ è®°å½•å¤´ä¿¡æ¯è®°å½•å¤´ä¿¡æ¯ä¸­åŒ…å«çš„å†…å®¹å¾ˆå¤šï¼Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œè¿™é‡Œè¯´å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„ï¼š delete_mask ï¼šæ ‡è¯†æ­¤æ¡æ•°æ®æ˜¯å¦è¢«åˆ é™¤ã€‚ä»è¿™é‡Œå¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬æ‰§è¡Œ detele åˆ é™¤è®°å½•çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šçœŸæ­£çš„åˆ é™¤è®°å½•ï¼Œåªæ˜¯å°†è¿™ä¸ªè®°å½•çš„ delete_mask æ ‡è®°ä¸º 1ã€‚ next_recordï¼šä¸‹ä¸€æ¡è®°å½•çš„ä½ç½®ã€‚ä»è¿™é‡Œå¯ä»¥çŸ¥é“ï¼Œè®°å½•ä¸è®°å½•ä¹‹é—´æ˜¯é€šè¿‡é“¾è¡¨ç»„ç»‡çš„ã€‚åœ¨å‰é¢æˆ‘ä¹Ÿæåˆ°äº†ï¼ŒæŒ‡å‘çš„æ˜¯ä¸‹ä¸€æ¡è®°å½•çš„ã€Œè®°å½•å¤´ä¿¡æ¯ã€å’Œã€ŒçœŸå®æ•°æ®ã€ä¹‹é—´çš„ä½ç½®ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯å‘å·¦è¯»å°±æ˜¯è®°å½•å¤´ä¿¡æ¯ï¼Œå‘å³è¯»å°±æ˜¯çœŸå®æ•°æ®ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚ record_typeï¼šè¡¨ç¤ºå½“å‰è®°å½•çš„ç±»å‹ï¼Œ0è¡¨ç¤ºæ™®é€šè®°å½•ï¼Œ1è¡¨ç¤ºB+æ ‘éå¶å­èŠ‚ç‚¹è®°å½•ï¼Œ2è¡¨ç¤ºæœ€å°è®°å½•ï¼Œ3è¡¨ç¤ºæœ€å¤§è®°å½•ã€‚ è®°å½•çœŸå®æ•°æ®è®°å½•çœŸå®æ•°æ®éƒ¨åˆ†é™¤äº†æˆ‘ä»¬å®šä¹‰çš„å­—æ®µï¼Œè¿˜æœ‰ä¸‰ä¸ªéšè—å­—æ®µï¼Œåˆ†åˆ«ä¸ºï¼šrow_idã€trx_idã€roll_pointerï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸‰ä¸ªå­—æ®µæ˜¯ä»€ä¹ˆã€‚ row_id å¦‚æœæˆ‘ä»¬å»ºè¡¨çš„æ—¶å€™æŒ‡å®šäº†ä¸»é”®æˆ–è€…å”¯ä¸€çº¦æŸåˆ—ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰ row_id éšè—å­—æ®µäº†ã€‚å¦‚æœæ—¢æ²¡æœ‰æŒ‡å®šä¸»é”®ï¼Œåˆæ²¡æœ‰å”¯ä¸€çº¦æŸï¼Œé‚£ä¹ˆ InnoDB å°±ä¼šä¸ºè®°å½•æ·»åŠ  row_id éšè—å­—æ®µã€‚row_idä¸æ˜¯å¿…éœ€çš„ï¼Œå ç”¨ 6 ä¸ªå­—èŠ‚ã€‚ trx_id äº‹åŠ¡idï¼Œè¡¨ç¤ºè¿™ä¸ªæ•°æ®æ˜¯ç”±å“ªä¸ªäº‹åŠ¡ç”Ÿæˆçš„ã€‚ trx_idæ˜¯å¿…éœ€çš„ï¼Œå ç”¨ 6 ä¸ªå­—èŠ‚ã€‚ roll_pointer è¿™æ¡è®°å½•ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„æŒ‡é’ˆã€‚roll_pointer æ˜¯å¿…éœ€çš„ï¼Œå ç”¨ 7 ä¸ªå­—èŠ‚ã€‚ varchar(n) ä¸­ n çš„æœ€å¤§å€¼MySQL è§„å®šé™¤äº† TEXTã€BLOBs è¿™ç§å¤§å¯¹è±¡ç±»å‹ä¹‹å¤–ï¼Œå…¶ä»–æ‰€æœ‰çš„åˆ—ï¼ˆä¸åŒ…æ‹¬éšè—åˆ—å’Œè®°å½•å¤´ä¿¡æ¯ï¼‰å ç”¨çš„å­—èŠ‚é•¿åº¦åŠ èµ·æ¥ä¸èƒ½è¶…è¿‡ 65535 ä¸ªå­—èŠ‚ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€è¡Œè®°å½•é™¤äº† TEXTã€BLOBs ç±»å‹çš„åˆ—ï¼Œé™åˆ¶æœ€å¤§ä¸º 65535 å­—èŠ‚ï¼Œæ³¨æ„æ˜¯ä¸€è¡Œçš„æ€»é•¿åº¦ï¼Œä¸æ˜¯ä¸€åˆ—ã€‚ varchar(n) å­—æ®µç±»å‹çš„ n ä»£è¡¨çš„æ˜¯æœ€å¤šå­˜å‚¨çš„å­—ç¬¦æ•°é‡ï¼Œå¹¶ä¸æ˜¯å­—èŠ‚å¤§å°å“¦ã€‚ è¦ç®— varchar(n) æœ€å¤§èƒ½å…è®¸å­˜å‚¨çš„å­—èŠ‚æ•°ï¼Œè¿˜è¦çœ‹æ•°æ®åº“è¡¨çš„å­—ç¬¦é›†ï¼Œå› ä¸ºå­—ç¬¦é›†ä»£è¡¨ç€ï¼Œ1ä¸ªå­—ç¬¦è¦å ç”¨å¤šå°‘å­—èŠ‚ï¼Œæ¯”å¦‚ ascii å­—ç¬¦é›†ï¼Œ 1 ä¸ªå­—ç¬¦å ç”¨ 1 å­—èŠ‚ï¼Œé‚£ä¹ˆ varchar(100) æ„å‘³ç€æœ€å¤§èƒ½å…è®¸å­˜å‚¨ 100 å­—èŠ‚çš„æ•°æ®ã€‚ ä¿è¯æ‰€æœ‰å­—æ®µçš„é•¿åº¦ + å˜é•¿å­—æ®µå­—èŠ‚æ•°åˆ—è¡¨æ‰€å ç”¨çš„å­—èŠ‚æ•° + NULLå€¼åˆ—è¡¨æ‰€å ç”¨çš„å­—èŠ‚æ•° 65535ã€‚","tags":[null],"categories":[null]},{"title":"Pytestç®€ä»‹","path":"/wiki/Python/Pytest.html","content":"ç®€ä»‹Pytest æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”æ˜“äºä½¿ç”¨çš„ Python æµ‹è¯•æ¡†æ¶ï¼Œç”¨äºç¼–å†™å’Œè¿è¡Œ å•å…ƒæµ‹è¯• ç”¨ä¾‹ã€é›†æˆæµ‹è¯•å’ŒåŠŸèƒ½æµ‹è¯•ï¼Œå¯¹æ¯” unittest æ¡†æ¶ï¼ŒPytest çš„ä¼˜åŠ¿éå¸¸æ˜æ˜¾ï¼š ç®€å•æ˜“ç”¨ï¼šPytest çš„è¯­æ³•ç®€å•æ˜äº†ï¼Œå­¦ä¹ æ›²çº¿ä½ï¼Œå®ƒé‡‡ç”¨äº†è‡ªç„¶çš„æµ‹è¯•ç”¨ä¾‹ç¼–å†™æ–¹å¼ï¼Œä½¿å¾—ç¼–å†™æµ‹è¯•ä»£ç å˜å¾—æ›´åŠ ç®€å•å’Œç›´è§‚ã€‚ çµæ´»æ€§ï¼šPytest æ”¯æŒå¤šç§æµ‹è¯•æ ·å¼ï¼ŒåŒ…æ‹¬å‡½æ•°å¼ã€ç±»å¼ã€æ¨¡å—çº§åˆ«çš„æµ‹è¯•ï¼Œç”šè‡³æ”¯æŒæµ‹è¯•ç”Ÿæˆå™¨ï¼Œè€Œä¸”æ’ä»¶ç”Ÿæ€éå¸¸ä¸°å¯Œï¼Œå¯ä»¥é€šè¿‡æ’ä»¶æ¥æ‰©å±• Pytest çš„åŠŸèƒ½ï¼Œæ»¡è¶³å„ç§æµ‹è¯•åœºæ™¯ã€‚ é›†æˆæ€§ï¼šPytest å¯ä»¥å¾ˆå¥½åœ°ä¸å…¶ä»–æµ‹è¯•å·¥å…·å’Œæ¡†æ¶é›†æˆï¼Œæ¯”å¦‚ä¸ Jenkinsã€Travis CIã€Coverage.py ç­‰ã€‚å®ƒè¿˜æ”¯æŒä¸å…¶ä»–æµ‹è¯•æ¡†æ¶ï¼ˆå¦‚ unittest å’Œ doctestï¼‰ååŒå·¥ä½œã€‚ ä¸°å¯Œçš„è¾“å‡ºä¿¡æ¯ï¼šPytest åœ¨æµ‹è¯•è¿è¡Œè¿‡ç¨‹ä¸­æä¾›ä¸°å¯Œçš„è¾“å‡ºä¿¡æ¯ï¼ŒåŒ…æ‹¬æµ‹è¯•ç»“æœã€å¤±è´¥åŸå› ã€è¯¦ç»†çš„å †æ ˆè·Ÿè¸ªç­‰ï¼Œä¾¿äºå¼€å‘äººå‘˜å®šä½å’Œä¿®å¤é—®é¢˜ã€‚ https://docs.pytest.org/en/stable/getting-started.html pip install -U pytest ç¼–å†™è§„åˆ™åœ¨ Pytest ä¸­ï¼Œæµ‹è¯•ç”¨ä¾‹çš„ç¼–å†™éœ€è¦éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š æµ‹è¯•æ–‡ä»¶ä»¥ test_å¼€å¤´æˆ–_test ç»“å°¾ï¼› æµ‹è¯•ç±»ä»¥ Test å¼€å¤´ï¼Œå¹¶ä¸”ä¸èƒ½å¸¦æœ‰ init æ–¹æ³•ï¼› æµ‹è¯•å‡½æ•°ä»¥ test_ å¼€å¤´ï¼› æ–­è¨€ä½¿ç”¨åŸºæœ¬çš„ assert å³å¯ï¼› Pytest ä¼šé€’å½’æŸ¥æ‰¾å½“å‰ç›®å½•åŠå­ç›®å½•ä¸‹çš„æ‰€æœ‰ä»¥ test_ å¼€å§‹æˆ–è€… _test ç»“å°¾çš„ Python è„šæœ¬ï¼Œæ‰§è¡Œå…¶ä¸­ç¬¦åˆè§„åˆ™çš„å‡½æ•°å’Œæ–¹æ³•ï¼Œä¸éœ€è¦æ˜¾ç¤ºè°ƒç”¨ã€‚ ä¸€äº›å¸¸è§çš„è¿è¡Œå‘½ä»¤ï¼š # ç›´æ¥è¿è¡Œæ–‡ä»¶å¤¹å†…ç¬¦åˆè§„åˆ™çš„æ‰€æœ‰ç”¨ä¾‹pytest folder_name# æ‰§è¡ŒæŸä¸ª Python æ–‡ä»¶ä¸­çš„ç”¨ä¾‹pytest test_file.py# æ‰§è¡ŒæŸä¸ª Python æ–‡ä»¶å†…çš„æŸä¸ªå‡½æ•°pytest test_file.py::test_func# æ‰§è¡ŒæŸä¸ª Python æ–‡ä»¶å†…æŸä¸ªæµ‹è¯•ç±»çš„æŸä¸ªæ–¹æ³•pytest test_file.py::TestClass::test_method# è¿è¡Œæµ‹è¯•æ—¶æ˜¾ç¤ºæ ‡å‡†è¾“å‡º(stdout)ï¼Œå…è®¸æµ‹è¯•ä¸­çš„ print() è¯­å¥ç›´æ¥è¾“å‡ºåˆ°ç»ˆç«¯pytest -s# è¿è¡Œæµ‹è¯•æ—¶æ˜¾ç¤ºè¯¦ç»†çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹çš„åç§°åŠç»“æœ(é€šè¿‡/å¤±è´¥/è·³è¿‡ç­‰)ï¼Œ-v ä»£è¡¨ verbosepytest -v åŸºæœ¬æµ‹è¯• pytesttest_example.py import mathdef test_pow(): num = 25 res = math.pow(5, 2) assert res == numdef test_sqrt(): res = math.sqrt(4) assert res == 1 pytest è¾“å‡ºç»“æœï¼š (.venv) PS D:\\work\\example_workspace\\example_Python pytest test session starts platform win32 â€“ Python 3.13.2, pytest-8.3.5, pluggy-1.5.0rootdir: D:\\work\\example_workspace\\example_Pythoncollected 2 items pytest\\test_example.py .F [100%] FAILURES ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ test_sqrt ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ def test_sqrt(): res = math.sqrt(4) assert res == 1 E assert 2.0 == 1 pytest\\test_example.py:18: AssertionError short test summary info FAILED pytesttest_example.py:: test_sqrt - assert 2.0 1 1 failed, 1 passed in 0.04s (.venv) PS D:\\work\\example_workspace\\example_Python æŸ¥çœ‹ç»“æœçš„ç¬¬ä¸€è¡Œã€‚å®ƒæ˜¾ç¤ºæ–‡ä»¶åå’Œç»“æœã€‚F ä»£è¡¨æµ‹è¯•å¤±è´¥ï¼Œç‚¹ (.) ä»£è¡¨æµ‹è¯•æˆåŠŸã€‚ åœ¨æ­¤ä¹‹ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¤±è´¥æµ‹è¯•çš„è¯¦ç»†ä¿¡æ¯ã€‚å®ƒå°†æ˜¾ç¤ºæµ‹è¯•å¤±è´¥çš„è¯­å¥ã€‚ æœ€åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æµ‹è¯•æ‰§è¡Œæ‘˜è¦ï¼Œ1 ä¸ªå¤±è´¥ï¼Œ1 ä¸ªé€šè¿‡ã€‚ # -v å¢åŠ è¯¦ç»†ç¨‹åº¦pytest -v (.venv) PS D:\\work\\example_workspace\\example_Python pytest -v test session starts platform win32 â€“ Python 3.13.2, pytest-8.3.5, pluggy-1.5.0 â€“ D:\\work\\example_workspace\\example_Python.venv\\Scripts\\Python.execachedir: .pytest_cacherootdir: D:\\work\\example_workspace\\example_Pythoncollected 2 items pytesttest_example.py:: test_pow PASSED [ 50%]pytesttest_example.py:: test_sqrt FAILED [100%] FAILURES ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ test_sqrt ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ def test_sqrt(): res = math.sqrt(4) assert res == 1 E assert 2.0 == 1 pytest\\test_example.py:18: AssertionError short test summary info FAILED pytesttest_example.py:: test_sqrt - assert 2.0 1 1 failed, 1 passed in 0.04s (.venv) PS D:\\work\\example_workspace\\example_Python ç°åœ¨ç»“æœæ›´èƒ½è¯´æ˜å¤±è´¥çš„æµ‹è¯•å’Œé€šè¿‡çš„æµ‹è¯•ã€‚ æ³¨æ„ï¼š pytest å‘½ä»¤å°†æ‰§è¡Œæ‰€æœ‰æ ¼å¼çš„æ–‡ä»¶ test_* è¦ä¹ˆ***_test**åœ¨å½“å‰ç›®å½•å’Œå­ç›®å½•ä¸­ã€‚ æ‰§è¡Œæ–‡ä»¶ pytesttest_example.py import mathdef test_pow2(): num = 25 res = math.pow(5, 2) assert res == numdef test_sqrt2(): res = math.sqrt(4) assert res == 1 pytest (.venv) PS D:\\work\\example_workspace\\example_Python pytest test session starts platform win32 â€“ Python 3.13.2, pytest-8.3.5, pluggy-1.5.0rootdir: D:\\work\\example_workspace\\example_Pythoncollected 4 items pytest\\test_example.py .F [ 50%]pytest\\test_example2.py .F [100%] FAILURES ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ test_sqrt ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ def test_sqrt(): res = math.sqrt(4) assert res == 1 E assert 2.0 == 1 pytest\\test_example.py:18: AssertionError____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ test_sqrt2 ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ _____ def test_sqrt2(): res = math.sqrt(4) assert res == 1 E assert 2.0 == 1 pytest\\test_example2.py:18: AssertionError short test summary info FAILED pytesttest_example.py:: test_sqrt - assert 2.0 1FAILED pytesttest_example2.py:: test_sqrt2 - assert 2.0 1 2 failed, 2 passed in 0.05s (.venv) PS D:\\work\\example_workspace\\example_Python ä¼šè¾“å‡ºä¸¤ä¸ªæ–‡ä»¶çš„æµ‹è¯•ç»“æœã€‚ å¦‚æœè¦æŒ‡å®šæ‰§è¡ŒæŸä¸ªæ–‡ä»¶æµ‹è¯•ã€‚ # pytest filenamepytest .\\examples_pytest\\test_example.py è¾“å‡ºç»“æœï¼š (.venv) PS D:\\work\\example_workspace\\example_Python pytest .\\examples_pytest\\test_example.py test session starts platform win32 â€“ Python 3.13.2, pytest-8.3.5, pluggy-1.5.0rootdir: D:\\work\\example_workspace\\example_Pythoncollected 2 items examples_pytest\\test_example.py .F [100%] FAILURES ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ test_sqrt ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ _____ def test_sqrt(): res = math.sqrt(4) assert res == 1 E assert 2.0 == 1 examples_pytest\\test_example.py:19: AssertionError short test summary info FAILED examples_pytesttest_example.py:: test_sqrt - assert 2.0 1 1 failed, 1 passed in 0.04s (.venv) PS D:\\work\\example_workspace\\example_Python æ‰§è¡Œæµ‹è¯•å¥—ä»¶çš„å­é›†åœ¨å®é™…åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å°†æœ‰å¤šä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½ä¼šæœ‰å¤šä¸ªæµ‹è¯•ã€‚æµ‹è¯•å°†æ¶µç›–å„ç§æ¨¡å—å’ŒåŠŸèƒ½ã€‚å‡è®¾ï¼Œæˆ‘ä»¬åªæƒ³è¿è¡Œä¸€ç»„ç‰¹å®šçš„æµ‹è¯•ï¼›æˆ‘ä»¬è¯¥æ€ä¹ˆåšï¼Ÿ Pytest æä¾›äº†ä¸¤ç§æ–¹æ³•æ¥è¿è¡Œæµ‹è¯•å¥—ä»¶çš„å­é›†ã€‚ æ ¹æ®æµ‹è¯•åç§°çš„å­å­—ç¬¦ä¸²åŒ¹é…é€‰æ‹©è¦è¿è¡Œçš„æµ‹è¯•ã€‚ æ ¹æ®åº”ç”¨çš„æ ‡è®°é€‰æ‹©è¦è¿è¡Œçš„æµ‹è¯•ç»„ã€‚ æµ‹è¯•åç§°çš„å­ä¸²åŒ¹é…è¯­æ³•ï¼š pytest -k substring -v -k substring è¡¨ç¤ºè¦åœ¨æµ‹è¯•åç§°ä¸­æœç´¢çš„å­å­—ç¬¦ä¸²ã€‚ # è¿‡æ»¤å‡º math æ–‡ä»¶æµ‹è¯•pytest -k math -v (.venv) PS D:\\work\\example_workspace\\example_Python pytest -k math -v test session starts platform win32 â€“ Python 3.13.2, pytest-8.3.5, pluggy-1.5.0 â€“ D:\\work\\example_workspace\\example_Python.venv\\Scripts\\Python.execachedir: .pytest_cacherootdir: D:\\work\\example_workspace\\example_Pythoncollected 5 items 4 deselected 1 selected examples_pytesttest_math.py:: test_pow PASSED [100%] 1 passed, 4 deselected in 0.02s # è¿‡æ»¤å‡º test_example çš„æ–‡ä»¶æµ‹è¯•pytest -k test_example -v (.venv) PS D:\\work\\example_workspace\\example_Python pytest -k test_example -v test session starts platform win32 â€“ Python 3.13.2, pytest-8.3.5, pluggy-1.5.0 â€“ D:\\work\\example_workspace\\example_Python.venv\\Scripts\\Python.execachedir: .pytest_cacherootdir: D:\\work\\example_workspace\\example_Pythoncollected 5 items 1 deselected 4 selected examples_pytesttest_example.py:: test_pow PASSED [ 25%]examples_pytesttest_example.py:: test_sqrt FAILED [ 50%]examples_pytesttest_example2.py:: test_pow2 PASSED [ 75%]examples_pytesttest_example2.py:: test_sqrt2 FAILED [100%] FAILURES ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ test_sqrt ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ _____ def test_sqrt(): res = math.sqrt(4) assert res == 1 E assert 2.0 == 1 examples_pytest\\test_example.py:19: AssertionError____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ test_sqrt2 ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ def test_sqrt2(): res = math.sqrt(4) assert res == 1 E assert 2.0 == 1 examples_pytest\\test_example2.py:19: AssertionError short test summary info FAILED examples_pytesttest_example.py:: test_sqrt - assert 2.0 1FAILED examples_pytesttest_example2.py:: test_sqrt2 - assert 2.0 1 2 failed, 2 passed, 1 deselected in 0.05s (.venv) PS D:\\work\\example_workspace\\example_Python # ä» example ç›®å½•è¿‡æ»¤pytest -k example -v (.venv) PS D:\\work\\example_workspace\\example_Python pytest -k example -v test session starts platform win32 â€“ Python 3.13.2, pytest-8.3.5, pluggy-1.5.0 â€“ D:\\work\\example_workspace\\example_Python.venv\\Scripts\\Python.execachedir: .pytest_cacherootdir: D:\\work\\example_workspace\\example_Pythoncollected 5 items examples_pytesttest_example.py:: test_pow PASSED [ 20%]examples_pytesttest_example.py:: test_sqrt FAILED [ 40%]examples_pytesttest_example2.py:: test_pow2 PASSED [ 60%]examples_pytesttest_example2.py:: test_sqrt2 FAILED [ 80%]examples_pytesttest_math.py:: test_pow PASSED [100%] FAILURES ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ test_sqrt ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ _____ def test_sqrt(): res = math.sqrt(4) assert res == 1 E assert 2.0 == 1 examples_pytest\\test_example.py:19: AssertionError____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ test_sqrt2 ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ def test_sqrt2(): res = math.sqrt(4) assert res == 1 E assert 2.0 == 1 examples_pytest\\test_example2.py:19: AssertionError short test summary info FAILED examples_pytesttest_example.py:: test_sqrt - assert 2.0 1FAILED examples_pytesttest_example2.py:: test_sqrt2 - assert 2.0 1 2 failed, 3 passed in 0.05s (.venv) PS D:\\work\\example_workspace\\example_Python å¯¹æµ‹è¯•è¿›è¡Œåˆ†ç»„Pytest å…è®¸æˆ‘ä»¬åœ¨æµ‹è¯•å‡½æ•°ä¸Šä½¿ç”¨æ ‡è®°ã€‚æ ‡è®°ç”¨äºè®¾ç½®å„ç§ç‰¹å¾å±æ€§æ¥æµ‹è¯•åŠŸèƒ½ã€‚Pytest æä¾›äº†è®¸å¤šå†…ç½®æ ‡è®°ï¼Œä¾‹å¦‚ xfailã€skip å’Œ parametrizeã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç”¨æˆ·å¯ä»¥åˆ›å»ºè‡ªå·±çš„æ ‡è®°åç§°ã€‚ @pytest.mark.markername è¦ä½¿ç”¨æ ‡è®°ï¼Œæˆ‘ä»¬å¿…é¡» import pytest æµ‹è¯•æ–‡ä»¶ä¸­çš„æ¨¡å—ã€‚æˆ‘ä»¬å¯ä»¥ä¸ºæµ‹è¯•å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„æ ‡è®°åç§°å¹¶è¿è¡Œå…·æœ‰è¿™äº›æ ‡è®°åç§°çš„æµ‹è¯•ã€‚ è¦è¿è¡Œæ ‡è®°çš„æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­æ³•ï¼š pytest -m markername -v -m markername è¡¨ç¤ºè¦æ‰§è¡Œçš„æµ‹è¯•çš„æ ‡è®°åç§°ã€‚ examples_pytesttest_compare.py import pytest@pytest.mark.greatdef test_greater(): num = 100 assert num 100 @pytest.mark.greatdef test_greater_equal(): num = 100 assert num = 100@pytest.mark.othersdef test_less(): num = 100 assert num 200 examples_pytesttest_square.py import mathimport pytest@pytest.mark.squaredef test_sqrt(): num = 25 assert math.sqrt(num) == 5@pytest.mark.squaredef testsquare(): num = 7 assert 7 * 7 == 40@pytest.mark.othersdef test_equality(): assert 10 == 11 # è¿è¡Œæ ‡è®°ä¸º others çš„æµ‹è¯•pytest -m others -v (.venv) PS D:\\work\\example_workspace\\example_Python pytest -m others -v test session starts platform win32 â€“ Python 3.13.2, pytest-8.3.5, pluggy-1.5.0 â€“ D:\\work\\example_workspace\\example_Python.venv\\Scripts\\Python.execachedir: .pytest_cacherootdir: D:\\work\\example_workspace\\example_Pythoncollected 11 items 9 deselected 2 selected examples_pytesttest_compare.py:: test_less PASSED [ 50%]examples_pytesttest_square.py:: test_equality FAILED [100%] FAILURES ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ _test_equality _ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ @pytest.mark.others def test_equality(): assert 10 == 11 E assert 10 == 11 examples_pytest\\test_square.py:28: AssertionError short test summary info FAILED examples_pytesttest_square.py:: test_equality - assert 10 11 1 failed, 1 passed, 9 deselected, 6 warnings in 0.05s (.venv) PS D:\\work\\example_workspace\\example_Python fixtureåœ¨ Pytest ä¸­ï¼Œfixture æ˜¯ä¸€ç§ç”¨äºä¸ºæµ‹è¯•å‡½æ•°æä¾›é¢„è®¾æ•°æ®æˆ–è®¾ç½®æµ‹è¯•ç¯å¢ƒçš„æœºåˆ¶ã€‚ç®€å•æ¥è¯´ï¼Œå¯ä»¥ ä½¿ç”¨ fixture æ¥ä¸ºæµ‹è¯•æä¾›é¢„è®¾æ•°æ®å’Œè®¾ç½®æµ‹è¯•ç¯å¢ƒçš„åŠŸèƒ½ã€‚ fixture é€šå¸¸å†™åœ¨ conftest.py æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”å¯¹åº”çš„ç›®å½•åŠå­ç›®å½•éƒ½å¯ä»¥ä½¿ç”¨ conftest.py æä¾›çš„ fixtureï¼Œå¦‚æœå­˜åœ¨åµŒå¥— conftest.py æ–‡ä»¶ï¼Œåˆ™ä½¿ç”¨çš„æ˜¯æœ€æ¥è¿‘çš„ fixtureã€‚å®šä¹‰å¥½ fixture åï¼Œåœ¨æµ‹è¯•å‡½æ•°ä¸­ï¼Œå¯ä»¥ä½¿ç”¨åŒåçš„å‚æ•°ç›´æ¥ä½¿ç”¨ï¼ŒPytest ä¼šè‡ªåŠ¨æ³¨å…¥ã€‚ æ ‡è®°ä¸€ä¸ªå‡½æ•°ä¸º fixture: @pytest.fixture æµ‹è¯•å‡½æ•°å¯ä»¥é€šè¿‡å°† fixture åç§°ä½œä¸ºè¾“å…¥å‚æ•°æ¥ä½¿ç”¨ fixtureã€‚ examples_pytestfixturetest_div.py import pytest@pytest.fixturedef input_value(): input = 39 return inputdef test_divisible_by_3(input_value): assert input_value % 3 == 0def test_divisible_by_6(input_value): assert input_value % 6 == 0 åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º input_value çš„ fixture æ ‡æ³¨å‡½æ•°ï¼Œå®ƒä¸ºæµ‹è¯•æä¾›è¾“å…¥ã€‚è¦è®¿é—® fixture åŠŸèƒ½ï¼Œæµ‹è¯•å¿…é¡»ä½¿ç”¨ fixture æ ‡æ³¨çš„å‡½æ•°åç§°ä½œä¸ºè¾“å…¥å‚æ•°ã€‚ Pytest åœ¨æ‰§è¡Œæµ‹è¯•æ—¶ï¼Œä¼šå°†å‡½æ•°åç§°ä½œä¸ºè¾“å…¥å‚æ•°ã€‚ç„¶åå®ƒæ‰§è¡Œ fixture å‡½æ•°å¹¶å°†è¿”å›å€¼å­˜å‚¨åˆ°è¾“å…¥å‚æ•°ä¸­ï¼Œä¾›æµ‹è¯•ä½¿ç”¨ã€‚ pytest -k divisible -v è¾“å‡ºç»“æœï¼š (.venv) PS D:\\work\\example_workspace\\example_Python pytest -k divisible -v test session starts platform win32 â€“ Python 3.13.2, pytest-8.3.5, pluggy-1.5.0 â€“ D:\\work\\example_workspace\\example_Python.venv\\Scripts\\Python.execachedir: .pytest_cacherootdir: D:\\work\\example_workspace\\example_Pythoncollected 13 items 11 deselected 2 selected examples_pytestfixturetest_div.py:: test_divisible_by_3 PASSED [ 50%]examples_pytestfixturetest_div.py:: test_divisible_by_6 FAILED [100%] FAILURES ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ test_divisible_by_6 ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ ____ input_value 39 def test_divisible_by_6(input_value): assert input_value % 6 == 0 E assert (39 % 6) == 0 examples_pytest\\fixture\\test_div.py:24: AssertionError short test summary info FAILED examples_pytestfixturetest_div.py:: test_divisible_by_6 - assert (39 % 6) 0 1 failed, 1 passed, 11 deselected, 6 warnings in 0.05s ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•æœ‰å…¶è‡ªèº«çš„å±€é™æ€§ã€‚åœ¨æµ‹è¯•æ–‡ä»¶ä¸­å®šä¹‰çš„ fixture å‡½æ•°ä»…åœ¨æµ‹è¯•æ–‡ä»¶ä¸­å…·æœ‰èŒƒå›´ã€‚æˆ‘ä»¬ä¸èƒ½åœ¨å¦ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ä¸­ä½¿ç”¨è¯¥ fixture å‡½æ•°ã€‚ä¸ºäº†ä½¿ä¸€ä¸ª fixture å¯ç”¨äºå¤šä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ä¸€ä¸ªåä¸º conftest.py çš„æ–‡ä»¶ä¸­å®šä¹‰ fixture å‡½æ•°ã€‚ examples_pytestfixtureconftest.py import pytest@pytest.fixturedef input_value(): input = 39 return input pytest -k divisible -v (.venv) PS D:\\work\\example_workspace\\example_Python pytest -k divisible -v test session starts platform win32 â€“ Python 3.13.2, pytest-8.3.5, pluggy-1.5.0 â€“ D:\\work\\example_workspace\\example_Python.venv\\Scripts\\Python.execachedir: .pytest_cacherootdir: D:\\work\\example_workspace\\example_Pythoncollected 15 items 11 deselected 4 selected examples_pytestfixturetest_div.py:: test_divisible_by_3 PASSED [ 25%]examples_pytestfixturetest_div.py:: test_divisible_by_6 FAILED [ 50%]examples_pytestfixturetest_div2.py:: test_divisible_by_3 PASSED [ 75%]examples_pytestfixturetest_div2.py:: test_divisible_by_6 FAILED [100%] æµ‹è¯•å°†åœ¨åŒä¸€æ–‡ä»¶ä¸­æŸ¥æ‰¾ fixtureã€‚ç”±äºåœ¨æ–‡ä»¶ä¸­æ²¡æœ‰æ‰¾åˆ° fixtureï¼Œå®ƒä¼šåœ¨ conftest.py æ–‡ä»¶ä¸­æ£€æŸ¥ fixtureã€‚æ‰¾åˆ°å®ƒåï¼Œå°†è°ƒç”¨ fixture æ–¹æ³•å¹¶å°†ç»“æœèµ‹å€¼ç»™æµ‹è¯•çš„è¾“å…¥å‚æ•°ã€‚ å‚æ•°åŒ–æµ‹è¯•åœ¨ Pytest ä¸­å¯ä»¥ä½¿ç”¨ @pytest.mark.parametrize è£…é¥°æµ‹è¯•å‡½æ•°ï¼Œå®ç°ä½¿ç”¨ä¸åŒçš„å‚æ•°å€¼å¤šæ¬¡æµ‹è¯•è¿è¡Œç›¸åŒçš„ä»£ç ï¼Œä»¥è¦†ç›–å¤šç§æµ‹è¯•åœºæ™¯ï¼Œå¯ä»¥ä¼ é€’ 2 ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯å‚æ•°åå’Œå‚æ•°å€¼ï¼š å‚æ•°åï¼šå¯ä»¥ä¸ºå•ä¸ªå‚æ•°æˆ–å¤šä¸ªå‚æ•° å‚æ•°å€¼ï¼šä¸ºå•ä¸ªå‚æ•°å¯¹åº”çš„å‚æ•°åˆ—è¡¨ï¼Œå¤šä¸ªå‚æ•°å¯¹åº”çš„å…ƒç»„å‚æ•°åˆ—è¡¨ï¼› import pytest# é‡å¤æµ‹è¯•ä¸¤æ¬¡ç¬¬ä¸€æ¬¡è¾“å…¥num = 1ï¼Œç¬¬äºŒæ¬¡è¾“å…¥num = 2@pytest.mark.parametrize(num, [1, 2])def test_multiplication_1(num): assert num == 1 @pytest.mark.parametrize(username, password, [(zhangsan, 123), (lisi, 321)])def test_multiplication_username_password(username, password): assert username.__eq__(zhangsan) assert password.__eq__(123) pytest -k multiplication -v è¾“å‡ºç»“æœï¼š (.venv) PS D:\\work\\example_workspace\\example_Python pytest -k multiplication -v test session starts platform win32 â€“ Python 3.13.2, pytest-8.3.5, pluggy-1.5.0 â€“ D:\\work\\example_workspace\\example_Python.venv\\Scripts\\Python.execachedir: .pytest_cacherootdir: D:\\work\\example_workspace\\example_Pythoncollected 19 items 15 deselected 4 selected examples_pytestparametrizetest_multiplication.py:: test_multiplication_1 [1] PASSED [25%]examples_pytestparametrizetest_multiplication.py:: test_multiplication_1 [2] FAILED [ 50%]examples_pytestparametrizetest_multiplication.py:: test_multiplication_username_password [zhangsan-123] PASSED [ 75%]examples_pytestparametrizetest_multiplication.py:: test_multiplication_username_password [lisi-321] FAILED [100%]","tags":[null],"categories":[null]},{"title":"Pythonç¯å¢ƒæ­å»º","path":"/wiki/Python/Pythonå®‰è£….html","content":"ç®€ä»‹Pythonæ˜¯ç”±è·å…°ç¨‹åºå‘˜å‰å¤šÂ·èŒƒç½—è‹å§†ï¼ˆGuido van Rossumï¼‰äº1989å¹´åœ£è¯èŠ‚æœŸé—´è®¾è®¡å¹¶é¦–å‘çš„ç¼–ç¨‹è¯­è¨€ï¼Œé¦–ä¸ªå…¬å¼€ç‰ˆæœ¬å‘å¸ƒäº1991å¹´ã€‚å…¶åç§°æºè‡ªè‹±å›½å–œå‰§å›¢ä½“â€œè’™æÂ·æ´¾æ£®çš„é£è¡Œé©¬æˆå›¢â€ï¼ˆMonty Pythonâ€™s Flying Circusï¼‰ï¼Œä½“ç°äº†è¯­è¨€è®¾è®¡çš„è½»æ¾ç†å¿µã€‚ æ ¸å¿ƒç‰¹ç‚¹ â€Œè¯­æ³•ç®€æ´â€Œé‡‡ç”¨å¼ºåˆ¶ç¼©è¿›å’Œæ¥è¿‘è‡ªç„¶è¯­è¨€çš„è¡¨è¾¾æ–¹å¼ï¼Œå¼ºè°ƒä»£ç å¯è¯»æ€§ï¼Œé€‚åˆåˆå­¦è€…å¿«é€Ÿå…¥é—¨ã€‚ â€Œå¤šèŒƒå¼æ”¯æŒâ€ŒåŒæ—¶æ”¯æŒé¢å‘å¯¹è±¡ã€é¢å‘è¿‡ç¨‹ã€å‡½æ•°å¼ç¼–ç¨‹ç­‰å¤šç§ç¼–ç¨‹èŒƒå¼ï¼Œçµæ´»æ€§é«˜ã€‚ â€Œè§£é‡Šå‹è¯­è¨€â€Œæ— éœ€ç¼–è¯‘å³å¯ç›´æ¥è¿è¡Œï¼Œå¼€å‘æ•ˆç‡é«˜ï¼Œä½†æ‰§è¡Œé€Ÿåº¦é€šå¸¸æ…¢äºç¼–è¯‘å‹è¯­è¨€ã€‚ â€Œè·¨å¹³å°æ€§â€Œå¯åœ¨Windowsã€Linuxã€MacOSç­‰å¤šç§æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œï¼Œå…¼å®¹æ€§å¼ºã€‚ â€Œä¸°å¯Œçš„ç”Ÿæ€â€Œæ ‡å‡†åº“æ¶µç›–ç½‘ç»œã€æ•°æ®åº“ã€æ–‡æœ¬å¤„ç†ç­‰é¢†åŸŸï¼Œç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚NumPyã€Djangoï¼‰è¦†ç›–ç§‘å­¦è®¡ç®—ã€Webå¼€å‘ç­‰åœºæ™¯ã€‚ åº”ç”¨é¢†åŸŸ â€ŒWebå¼€å‘â€Œï¼šDjangoã€Flaskç­‰æ¡†æ¶æ”¯æŒé«˜æ•ˆåç«¯å¼€å‘ã€‚ â€Œæ•°æ®åˆ†æä¸AIâ€Œï¼šPandasã€TensorFlowç­‰åº“å¹¿æ³›åº”ç”¨äºæ•°æ®å¤„ç†å’Œæœºå™¨å­¦ä¹ ã€‚ â€Œè‡ªåŠ¨åŒ–è¿ç»´â€Œï¼šé€šè¿‡è„šæœ¬å®ç°ç³»ç»Ÿç®¡ç†å’Œä»»åŠ¡è‡ªåŠ¨åŒ–ã€‚ â€Œç§‘å­¦è®¡ç®—â€Œï¼šNumPyã€SciPyç­‰å·¥å…·æ”¯æŒå¤æ‚æ•°å­¦è¿ç®—ã€‚ å®‰è£…https://www.python.org/downloads/ Python ç¨³å®šç‰ˆå¹¶æ²¡æœ‰ä¸€ä¸ªå›ºå®šçš„â€œæ ‡è®°â€ï¼Œè€Œæ˜¯æŒ‡å‘å¸ƒåç»è¿‡å……åˆ†æµ‹è¯•ï¼Œå¤„äºBugfixï¼ˆé—®é¢˜ä¿®å¤ï¼‰æˆ–Securityï¼ˆå®‰å…¨è¿è¡Œï¼‰é˜¶æ®µçš„ç‰ˆæœ¬ã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®é¡¹ç›®éœ€æ±‚å’Œç¨³å®šæ€§è€ƒè™‘ï¼Œé€‰æ‹©å¤„äºSecurity é˜¶æ®µçš„ç‰ˆæœ¬ä½¿ç”¨ï¼Œä¾‹å¦‚æ›¾ç»çš„Python 3.8 å’Œ3.9ã€‚ æŸ¥çœ‹ç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ï¼š Bugfix é˜¶æ®µï¼š:æŒ‡æ­¤ç‰ˆæœ¬ä»æœ‰æ–°çš„Bugï¼ˆé”™è¯¯ï¼‰è¢«ä¿®å¤ã€‚ Security é˜¶æ®µï¼š:æŒ‡æ­¤ç‰ˆæœ¬åªæ¥å—å®‰å…¨ç›¸å…³çš„Bug ä¿®å¤ï¼Œæ­¤é˜¶æ®µåä¸å†æ¥å—å…¶ä»–Bug ä¿®å¤ã€‚ uvhttps://docs.astral.sh/uv/getting-started/ uv æ˜¯ç”± Astral å›¢é˜Ÿï¼ˆRuff å·¥å…·çš„å¼€å‘è€…ï¼‰ä½¿ç”¨ Rust ç¼–å†™çš„é«˜æ€§èƒ½ Python åŒ…ç®¡ç†å·¥å…·ï¼Œæ—¨åœ¨æ›¿ä»£ä¼ ç»Ÿå·¥å…·é“¾ï¼ˆå¦‚ pipã€virtualenv ç­‰ï¼‰ï¼Œæä¾›æé€Ÿçš„ä¾èµ–è§£æã€è™šæ‹Ÿç¯å¢ƒç®¡ç†å’Œé¡¹ç›®å·¥å…·é›†æˆã€‚ â€Œæ€§èƒ½ä¼˜åŠ¿â€Œ æ— ç¼“å­˜æ—¶æ¯” pip å¿« 8-10 å€ï¼Œçƒ­ç¼“å­˜æ—¶å¿« 80-115 å€ï¼› ä¾èµ–è§£æã€ä¸‹è½½å’Œå®‰è£…å…¨ç¨‹å¹¶è¡ŒåŒ–ï¼Œå……åˆ†åˆ©ç”¨ç¡¬ä»¶èµ„æºã€‚ â€ŒåŠŸèƒ½é›†æˆâ€Œ ç»Ÿä¸€å‘½ä»¤è¡Œæ¥å£ï¼Œæ•´åˆ pipï¼ˆåŒ…ç®¡ç†ï¼‰ã€pyenvï¼ˆPython ç‰ˆæœ¬æ§åˆ¶ï¼‰ã€pipxï¼ˆå·¥å…·å®‰è£…ï¼‰ç­‰åŠŸèƒ½ï¼› æ”¯æŒé™æ€åˆ†å‘ï¼Œæ— éœ€ Python ç¯å¢ƒå³å¯è¿è¡Œï¼Œé¿å…ç‰ˆæœ¬å†²çªã€‚ â€Œå…¼å®¹æ€§ä¸æ ‡å‡†åŒ–â€Œ è™šæ‹Ÿç¯å¢ƒç¬¦åˆæ ‡å‡†ï¼Œå¯ä¸ç°æœ‰å·¥å…·ï¼ˆå¦‚ Poetryã€pipenvï¼‰äº’æ¢ä½¿ç”¨ï¼› æ”¯æŒç°ä»£ Python æ‰“åŒ…åŠŸèƒ½ï¼ˆGitURLæœ¬åœ°ä¾èµ–ã€çº¦æŸæ–‡ä»¶ç­‰ï¼‰ã€‚ â€Œè·¨å¹³å°æ”¯æŒâ€Œ æ”¯æŒ Windowsã€Linux å’Œ macOSï¼Œæä¾›ä¸€è‡´çš„ä½¿ç”¨ä½“éªŒã€‚ å®‰è£…æ–¹å¼é€šå¸¸é€šè¿‡å‘½ä»¤è¡Œç›´æ¥å®‰è£…ï¼ˆå¦‚ curl -LsSf https://astral.sh/uv/install.sh | shï¼‰ï¼Œå…·ä½“å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚ brew install uv åœ¨ pycharm ä¸­ä½¿ç”¨ uv","tags":[null],"categories":[null]},{"title":"Pytest asyncioç®€ä»‹","path":"/wiki/Python/asyncio.html","content":"Python asyncio çš„æ¦‚å¿µasyncio æ˜¯ Python æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œç”¨äºæ”¯æŒå¼‚æ­¥ç¼–ç¨‹ã€‚å®ƒäº Python 3.4 å¼•å…¥ï¼Œå¹¶åœ¨åç»­ç‰ˆæœ¬ä¸­ä¸æ–­å®Œå–„ï¼ˆå¦‚ Python 3.5 å¼•å…¥ asyncawait è¯­æ³•ï¼‰ã€‚asyncio çš„æ ¸å¿ƒç›®æ ‡æ˜¯å¤„ç† IO å¯†é›†å‹ä»»åŠ¡ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å†™ã€æ•°æ®åº“æ“ä½œï¼‰ï¼Œå…è®¸ç¨‹åºåœ¨ç­‰å¾… IO æ“ä½œæ—¶ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œä»è€Œå®ç°å¹¶å‘è€Œéå¹¶è¡Œï¼ˆåŒºåˆ«äºå¤šçº¿ç¨‹æˆ–å¤šè¿›ç¨‹çš„å¹¶è¡Œæ‰§è¡Œï¼‰ã€‚ å…³é”®æ¦‚å¿µï¼š **åç¨‹ (Coroutine)**ï¼šasyncio çš„åŸºç¡€å•ä½ï¼Œä½¿ç”¨ async def å®šä¹‰çš„å‡½æ•°ã€‚åç¨‹æ˜¯å¯æš‚åœå’Œæ¢å¤çš„å‡½æ•°ï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹ã€‚å®ƒä»¬é€šè¿‡ await å…³é”®å­—åœ¨ç­‰å¾…æ“ä½œæ—¶è®©å‡ºæ§åˆ¶æƒã€‚ **äº‹ä»¶å¾ªç¯ (Event Loop)**ï¼šasyncio çš„æ ¸å¿ƒå¼•æ“ï¼Œç±»ä¼¼äºä¸€ä¸ªè°ƒåº¦å™¨ã€‚å®ƒè´Ÿè´£ç›‘æ§å¤šä¸ªåç¨‹çš„æ‰§è¡ŒçŠ¶æ€ï¼Œå½“ä¸€ä¸ªåç¨‹ç­‰å¾… IO æ—¶ï¼Œåˆ‡æ¢åˆ°å¦ä¸€ä¸ªå°±ç»ªçš„åç¨‹ã€‚äº‹ä»¶å¾ªç¯æ˜¯å•çº¿ç¨‹çš„ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚ **ä»»åŠ¡ (Task)**ï¼šåç¨‹çš„å°è£…å½¢å¼ï¼Œä½¿ç”¨ asyncio.create_task() åˆ›å»ºã€‚ä»»åŠ¡å…è®¸åç¨‹åœ¨äº‹ä»¶å¾ªç¯ä¸­å¹¶å‘è¿è¡Œï¼Œå¹¶æä¾›å–æ¶ˆã€ç­‰å¾…ç­‰ç®¡ç†åŠŸèƒ½ã€‚ Futureï¼šè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„æœªæ¥ç»“æœçš„å¯¹è±¡ï¼Œä¸ä»»åŠ¡ç±»ä¼¼ï¼Œä½†æ›´åº•å±‚ã€‚Future å¯ä»¥è®¾ç½®ç»“æœæˆ–å¼‚å¸¸ï¼Œç”¨äºæ‰‹åŠ¨æ§åˆ¶å¼‚æ­¥æ“ä½œã€‚ å¼‚æ­¥ä¸Šä¸‹æ–‡ï¼šåŒ…æ‹¬é˜Ÿåˆ— (asyncio.Queue)ã€é” (asyncio.Lock)ã€ä¿¡å·é‡ (asyncio.Semaphore) ç­‰ï¼Œç”¨äºåœ¨å¼‚æ­¥ç¯å¢ƒä¸­ç®¡ç†å…±äº«èµ„æºã€‚ asyncio ä¸æ˜¯çœŸæ­£çš„å¤šçº¿ç¨‹ï¼Œè€Œæ˜¯åŸºäºâ€œåä½œå¼å¤šä»»åŠ¡â€ï¼ˆcooperative multitaskingï¼‰ï¼Œåç¨‹å¿…é¡»ä¸»åŠ¨è®©å‡ºæ§åˆ¶æƒï¼ˆé€šè¿‡ awaitï¼‰ã€‚ Python asyncio çš„åŸç†asyncio çš„åŸç†å»ºç«‹åœ¨â€œéé˜»å¡ IOâ€å’Œâ€œäº‹ä»¶é©±åŠ¨â€æ¨¡å‹ä¸Šï¼Œå€Ÿé‰´äº† Node.js çš„å•çº¿ç¨‹äº‹ä»¶å¾ªç¯ï¼Œä½†æ›´æ³¨é‡ Python çš„è¯­æ³•å‹å¥½æ€§ã€‚ äº‹ä»¶å¾ªç¯çš„å·¥ä½œæœºåˆ¶ äº‹ä»¶å¾ªç¯æ˜¯ä¸€ä¸ªæ— é™å¾ªç¯ï¼Œä¸æ–­æ£€æŸ¥æ³¨å†Œçš„åç¨‹æˆ–ä»»åŠ¡çš„çŠ¶æ€ã€‚ å½“ä¸€ä¸ªåç¨‹é‡åˆ° await æ—¶ï¼Œå®ƒä¼šæš‚åœæ‰§è¡Œï¼Œå¹¶å°†æ§åˆ¶æƒè¿”å›ç»™äº‹ä»¶å¾ªç¯ã€‚äº‹ä»¶å¾ªç¯åˆ™è½®è¯¢å…¶ä»–ä»»åŠ¡ã€‚ åº•å±‚ä¾èµ–äºæ“ä½œç³»ç»Ÿæä¾›çš„éé˜»å¡ IO æ¥å£ï¼ˆå¦‚ selectã€epollã€kqueueï¼‰ï¼Œè¿™äº›æ¥å£å…è®¸ç¨‹åºæ£€æŸ¥å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆsocketsã€filesï¼‰çš„å°±ç»ªçŠ¶æ€ï¼Œè€Œä¸é˜»å¡ã€‚ ç¤ºä¾‹æµç¨‹ï¼š åˆ›å»ºäº‹ä»¶å¾ªç¯ï¼šloop = asyncio.get_event_loop()ï¼ˆåœ¨ Python 3.7+ ä¸­æ¨èä½¿ç”¨ asyncio.run() ç®€åŒ–ï¼‰ã€‚ æ³¨å†Œåç¨‹ï¼šé€šè¿‡ asyncio.create_task(coro()) æˆ– loop.create_task()ã€‚ è¿è¡Œå¾ªç¯ï¼šasyncio.run(main())ï¼Œç›´åˆ°æ‰€æœ‰ä»»åŠ¡å®Œæˆæˆ–å¼‚å¸¸å‘ç”Ÿã€‚ å¾ªç¯ç»“æŸï¼šå¤„ç†æ¸…ç†ï¼Œå¦‚å…³é—­è¿æ¥ã€‚ åç¨‹çš„æ‰§è¡ŒåŸç† åç¨‹æ˜¯ç”Ÿæˆå™¨ï¼ˆgeneratorï¼‰çš„æ‰©å±•ï¼Œä½¿ç”¨ yield fromï¼ˆæ—§è¯­æ³•ï¼‰æˆ– awaitã€‚ å½“åç¨‹è¢« await æ—¶ï¼Œå®ƒè¿”å›ä¸€ä¸ª Awaitable å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯ Future æˆ– Taskï¼‰ï¼Œäº‹ä»¶å¾ªç¯ä¼šç­‰å¾…å…¶å®Œæˆã€‚ åç¨‹æ ˆï¼šasyncio ç»´æŠ¤ä¸€ä¸ªåç¨‹è°ƒç”¨æ ˆï¼Œæ”¯æŒåµŒå¥— awaitã€‚ å¼‚å¸¸å¤„ç†ï¼šåç¨‹ä¸­çš„å¼‚å¸¸ä¼šä¼ æ’­åˆ°ä»»åŠ¡ä¸­ï¼Œå¯é€šè¿‡ task.exception() æ•è·ã€‚ ä¸çº¿ç¨‹è¿›ç¨‹çš„æ¯”è¾ƒ ä¼˜åŠ¿ï¼šä½å¼€é”€ï¼ˆæ— çº¿ç¨‹åˆ‡æ¢æˆæœ¬ï¼‰ã€çº¿ç¨‹å®‰å…¨ï¼ˆå•çº¿ç¨‹ï¼‰ã€æ˜“äºè°ƒè¯•ã€‚ åŠ£åŠ¿ï¼šä¸é€‚åˆ CPU å¯†é›†å‹ä»»åŠ¡ï¼ˆä¼šé˜»å¡äº‹ä»¶å¾ªç¯ï¼‰ã€‚å¯¹äº CPU ä»»åŠ¡ï¼Œå¯ç»“åˆ asyncio.to_thread()ï¼ˆPython 3.9+ï¼‰æˆ–å¤šè¿›ç¨‹ã€‚ GILï¼ˆGlobal Interpreter Lockï¼‰ï¼šasyncio åœ¨å•çº¿ç¨‹ä¸­è¿è¡Œï¼Œä¸å— GIL å½±å“ï¼Œä½†å¦‚æœç»“åˆå¤šçº¿ç¨‹ï¼Œä»éœ€æ³¨æ„ã€‚ å†…éƒ¨å®ç°ç»†èŠ‚ asyncio ä½¿ç”¨ selectors æ¨¡å—æŠ½è±¡åº•å±‚ IO å¤šè·¯å¤ç”¨ã€‚ transport å’Œ protocolï¼šç”¨äºç½‘ç»œç¼–ç¨‹ï¼Œå¦‚ loop.create_connection() è¿”å› transportï¼ˆä½çº§ IOï¼‰å’Œ protocolï¼ˆæ•°æ®å¤„ç†ï¼‰ã€‚ å…¼å®¹æ€§ï¼šasyncio æ”¯æŒä¸å…¶ä»–å¼‚æ­¥åº“é›†æˆï¼Œå¦‚ aiohttpï¼ˆHTTP å®¢æˆ·ç«¯æœåŠ¡å™¨ï¼‰ã€aiomysql ç­‰ã€‚ åŸºæœ¬ç”¨æ³•è¿è¡Œåç¨‹è¦è¿è¡Œä¸€ä¸ªåç¨‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ asyncio.run() å‡½æ•°ã€‚å®ƒä¼šåˆ›å»ºä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œå¹¶è¿è¡ŒæŒ‡å®šçš„åç¨‹ã€‚ import asyncioasync def main(): print(Start) await asyncio.sleep(1) print(End)asyncio.run(main()) å¹¶å‘æ‰§è¡Œå¤šä¸ªä»»åŠ¡ä½ å¯ä»¥ä½¿ç”¨ asyncio.gather() å‡½æ•°å¹¶å‘æ‰§è¡Œå¤šä¸ªåç¨‹ï¼Œå¹¶ç­‰å¾…å®ƒä»¬å…¨éƒ¨å®Œæˆã€‚ import asyncioasync def task1(): print(Task 1 started) await asyncio.sleep(1) print(Task 1 finished)async def task2(): print(Task 2 started) await asyncio.sleep(2) print(Task 2 finished)async def main(): await asyncio.gather(task1(), task2())asyncio.run(main()) è¶…æ—¶æ§åˆ¶ä½ å¯ä»¥ä½¿ç”¨ asyncio.wait_for() å‡½æ•°ä¸ºåç¨‹è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚å¦‚æœåç¨‹åœ¨æŒ‡å®šæ—¶é—´å†…æœªå®Œæˆï¼Œå°†å¼•å‘ asyncio.TimeoutError å¼‚å¸¸ã€‚ import asyncioasync def long_task(): await asyncio.sleep(10) print(Task finished)async def main(): try: await asyncio.wait_for(long_task(), timeout=5) except asyncio.TimeoutError: print(Task timed out)asyncio.run(main()) Python asyncio çš„åº”ç”¨asyncio å¹¿æ³›ç”¨äºé«˜å¹¶å‘åœºæ™¯ï¼Œå°¤å…¶åœ¨ Web å¼€å‘ã€çˆ¬è™«å’Œå®æ—¶åº”ç”¨ä¸­ã€‚ä»¥ä¸‹æ˜¯å…¸å‹åº”ç”¨å’Œä»£ç ç¤ºä¾‹ã€‚ ç½‘ç»œ IOï¼šå¼‚æ­¥ HTTP è¯·æ±‚ä½¿ç”¨ aiohttp åº“ï¼ˆéœ€å®‰è£…ï¼Œä½† asyncio æä¾›åŸºç¡€æ”¯æŒï¼‰ã€‚ import asyncioimport aiohttpasync def fetch(url): async with aiohttp.ClientSession() as session: async with session.get(url) as response: return await response.text()async def main(): urls = [https://example.com, https://python.org] tasks = [asyncio.create_task(fetch(url)) for url in urls] results = await asyncio.gather(*tasks) print(results)asyncio.run(main()) åº”ç”¨ï¼šçˆ¬è™«ã€API è°ƒç”¨ã€‚å¹¶å‘è¯·æ±‚å¤šä¸ª URLï¼Œè€Œä¸é˜»å¡ã€‚ æœåŠ¡å™¨åº”ç”¨ï¼šå¼‚æ­¥ Web æœåŠ¡å™¨ä½¿ç”¨ asyncio æ„å»º echo æœåŠ¡å™¨ã€‚ import asyncioasync def handle_echo(reader, writer): data = await reader.read(100) message = data.decode() addr = writer.get_extra_info(peername) print(fReceived message!r from addr!r) writer.write(data) await writer.drain() writer.close()async def main(): server = await asyncio.start_server(handle_echo, 127.0.0.1, 8888) async with server: await server.serve_forever()asyncio.run(main()) åº”ç”¨ï¼šèŠå¤©æœåŠ¡å™¨ã€WebSocket æœåŠ¡ã€‚é«˜å¹¶å‘è¿æ¥å¤„ç†ã€‚ æ–‡ä»¶ IO å’Œå®šæ—¶ä»»åŠ¡å¼‚æ­¥è¯»æ–‡ä»¶ï¼šä½¿ç”¨ aiofiles åº“ã€‚å®šæ—¶ï¼šasyncio.sleep() ç”¨äºéé˜»å¡å»¶è¿Ÿã€‚ import asyncioasync def delayed_task(): print(Starting delay) await asyncio.sleep(2) print(Delay complete)asyncio.run(delayed_task()) åº”ç”¨ï¼šGUI åº”ç”¨ï¼ˆå¦‚ Tkinter + asyncioï¼‰ã€å®šæ—¶å™¨ã€æ—¥å¿—å¤„ç†ã€‚ å…¶ä»–é«˜çº§åº”ç”¨ æ•°æ®åº“æ“ä½œï¼šä½¿ç”¨ aiopg æˆ– asyncpg è¿›è¡Œå¼‚æ­¥ PostgreSQL æŸ¥è¯¢ã€‚ æ¶ˆæ¯é˜Ÿåˆ—ï¼šç»“åˆ aioamqpï¼ˆAMQPï¼‰æˆ– asyncio.Queue å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ã€‚ å¾®æœåŠ¡ï¼šåœ¨ FastAPIï¼ˆåŸºäº ASGI å’Œ asyncioï¼‰ä¸­æ„å»ºå¼‚æ­¥ APIã€‚ å±€é™ä¸æ‰©å±•ï¼šå¯¹äºé˜»å¡ä»£ç ï¼Œå¯ç”¨ loop.run_in_executor() åœ¨çº¿ç¨‹æ± ä¸­è¿è¡Œã€‚å¤§å‹é¡¹ç›®ä¸­ï¼Œç»“åˆ uvloopï¼ˆæ›´å¿«çš„äº‹ä»¶å¾ªç¯å®ç°ï¼‰æå‡æ€§èƒ½ã€‚ å¸¸ç”¨ç±»ã€æ–¹æ³•å’Œå‡½æ•°æ ¸å¿ƒå‡½æ•° æ–¹æ³•å‡½æ•° è¯´æ˜ ç¤ºä¾‹ asyncio.run(coro) è¿è¡Œå¼‚æ­¥ä¸»å‡½æ•°ï¼ˆPython 3.7+ï¼‰ asyncio.run(main()) asyncio.create_task(coro) åˆ›å»ºä»»åŠ¡å¹¶åŠ å…¥äº‹ä»¶å¾ªç¯ task = asyncio.create_task(fetch_data()) asyncio.gather(\\*coros) å¹¶å‘è¿è¡Œå¤šä¸ªåç¨‹ await asyncio.gather(task1, task2) asyncio.sleep(delay) å¼‚æ­¥ç­‰å¾…ï¼ˆéé˜»å¡ï¼‰ await asyncio.sleep(1) asyncio.wait(coros) æ§åˆ¶ä»»åŠ¡å®Œæˆæ–¹å¼ done, pending = await asyncio.wait([task1, task2]) äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰ æ–¹æ³• è¯´æ˜ ç¤ºä¾‹ loop.run_until_complete(future) è¿è¡Œç›´åˆ°ä»»åŠ¡å®Œæˆ loop.run_until_complete(main()) loop.run_forever() æ°¸ä¹…è¿è¡Œäº‹ä»¶å¾ªç¯ loop.run_forever() loop.stop() åœæ­¢äº‹ä»¶å¾ªç¯ loop.stop() loop.close() å…³é—­äº‹ä»¶å¾ªç¯ loop.close() loop.call_soon(callback) å®‰æ’å›è°ƒå‡½æ•°ç«‹å³æ‰§è¡Œ loop.call_soon(print, Hello) loop.call_later(delay, callback) å»¶è¿Ÿæ‰§è¡Œå›è°ƒ loop.call_later(5, callback) åç¨‹ï¼ˆCoroutineï¼‰ä¸ä»»åŠ¡ï¼ˆTaskï¼‰ æ–¹æ³•è£…é¥°å™¨ è¯´æ˜ ç¤ºä¾‹ @asyncio.coroutine åç¨‹è£…é¥°å™¨ï¼ˆæ—§ç‰ˆï¼ŒPython 3.4-3.7ï¼‰ @asyncio.coroutine def old_coro(): async def å®šä¹‰åç¨‹ï¼ˆPython 3.5+ï¼‰ async def fetch(): task.cancel() å–æ¶ˆä»»åŠ¡ task.cancel() task.done() æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å®Œæˆ if task.done(): task.result() è·å–ä»»åŠ¡ç»“æœï¼ˆéœ€ä»»åŠ¡å®Œæˆï¼‰ data = task.result() åŒæ­¥åŸè¯­ï¼ˆç±»ä¼¼threadingï¼‰ ç±» è¯´æ˜ ç¤ºä¾‹ asyncio.Lock() å¼‚æ­¥äº’æ–¥é” lock = asyncio.Lock() async with lock: asyncio.Event() äº‹ä»¶é€šçŸ¥ event = asyncio.Event() await event.wait() asyncio.Queue() å¼‚æ­¥é˜Ÿåˆ— queue = asyncio.Queue() await queue.put(item) asyncio.Semaphore() ä¿¡å·é‡ sem = asyncio.Semaphore(5) async with sem: ç½‘ç»œä¸å­è¿›ç¨‹ æ–¹æ³•ç±» è¯´æ˜ ç¤ºä¾‹ asyncio.open_connection() å»ºç«‹TCPè¿æ¥ reader, writer = await asyncio.open_connection(host, 80) asyncio.start_server() åˆ›å»ºTCPæœåŠ¡å™¨ server = await asyncio.start_server(handle, 0.0.0.0, 8888) asyncio.create_subprocess_exec() åˆ›å»ºå­è¿›ç¨‹ proc = await asyncio.create_subprocess_exec(ls) å®ç”¨å·¥å…· æ–¹æ³• è¯´æ˜ ç¤ºä¾‹ asyncio.current_task() è·å–å½“å‰ä»»åŠ¡ task = asyncio.current_task() asyncio.all_tasks() è·å–æ‰€æœ‰ä»»åŠ¡ tasks = asyncio.all_tasks() asyncio.shield(coro) ä¿æŠ¤ä»»åŠ¡ä¸è¢«å–æ¶ˆ await asyncio.shield(critical_task) asyncio.wait_for(coro, timeout) å¸¦è¶…æ—¶çš„ç­‰å¾… try: await asyncio.wait_for(task, 5)","tags":[null],"categories":[null]},{"title":"Pythonä¾èµ–æ³¨å…¥","path":"/wiki/Python/ä¾èµ–æ³¨å…¥.html","content":"ä¾èµ–æ³¨å…¥çš„æ ¸å¿ƒæ¦‚å¿µâ€Œ â€Œç›®çš„â€Œï¼šè§£è€¦ç»„ä»¶ï¼Œé€šè¿‡å¤–éƒ¨ä¼ é€’ä¾èµ–é¡¹ï¼Œè€Œéåœ¨ç±»å†…éƒ¨åˆ›å»ºã€‚ â€Œä¼˜åŠ¿â€Œï¼šæé«˜å¯æµ‹è¯•æ€§ã€å¯ç»´æŠ¤æ€§å’Œçµæ´»æ€§ã€‚ æ‰‹åŠ¨ä¾èµ–æ³¨å…¥æ„é€ å‡½æ•°æ³¨å…¥class Service: def do_something(self): return Real Serviceclass Client: def __init__(self, service: Service): # ä¾èµ–é€šè¿‡æ„é€ å‡½æ•°ä¼ å…¥ self.service = service def execute(self): return self.service.do_something()# ä½¿ç”¨service = Service()client = Client(service)print(client.execute()) # è¾“å‡º: Real Service æ–¹æ³•æ³¨å…¥class Service: def do_something(self): return Real Serviceclass Client: def execute(self, service: Service): # ä¾èµ–é€šè¿‡æ–¹æ³•å‚æ•°ä¼ å…¥ return service.do_something()# ä½¿ç”¨client = Client()service = Service()print(client.execute(service)) # è¾“å‡º: Real Service è‡ªåŠ¨æ³¨å…¥injectpip install injector åˆ›å»ºæ³¨å…¥å™¨ä¸ç»‘å®šä¾èµ–è‡ªåŠ¨æ³¨å…¥éœ€è¦æä¾› __init__ æ–¹æ³• from injector import Injector, injectclass Inner: def __init__(self): self.forty_two = 42class Outer: @inject def __init__(self, inner: Inner): self.inner = innerinjector = Injector()outer = injector.get(Outer)print(outer.inner.forty_two) ä½¿ç”¨ dataclasses from dataclasses import dataclassfrom injector import Injector, injectclass Inner: def __init__(self): self.forty_two = 42@inject@dataclassclass Outer: inner: Innerinjector = Injector()outer = injector.get(Outer)print(outer.inner.forty_two) # Prints 42","tags":[null],"categories":[null]},{"title":"Pythonå‡½æ•°","path":"/wiki/Python/å‡½æ•°.html","content":"å‡½æ•°æ˜¯ç»„ç»‡å¥½çš„ï¼Œå¯é‡å¤ä½¿ç”¨çš„ï¼Œç”¨æ¥å®ç°å•ä¸€ï¼Œæˆ–ç›¸å…³è”åŠŸèƒ½çš„ä»£ç æ®µã€‚ å‡½æ•°èƒ½æé«˜åº”ç”¨çš„æ¨¡å—æ€§ï¼Œå’Œä»£ç çš„é‡å¤åˆ©ç”¨ç‡ã€‚ä½ å·²ç»çŸ¥é“ Python æä¾›äº†è®¸å¤šå†…å»ºå‡½æ•°ï¼Œæ¯”å¦‚ print()ã€‚ä½†ä½ ä¹Ÿå¯ä»¥è‡ªå·±åˆ›å»ºå‡½æ•°ï¼Œè¿™è¢«å«åšç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ã€‚ å®šä¹‰å‡½æ•°ä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªç”±è‡ªå·±æƒ³è¦åŠŸèƒ½çš„å‡½æ•°ï¼Œä»¥ä¸‹æ˜¯ç®€å•çš„è§„åˆ™ï¼š å‡½æ•°ä»£ç å—ä»¥ def å…³é”®è¯å¼€å¤´ï¼Œåæ¥å‡½æ•°æ ‡è¯†ç¬¦åç§°å’Œåœ†æ‹¬å· ()ã€‚ ä»»ä½•ä¼ å…¥å‚æ•°å’Œè‡ªå˜é‡å¿…é¡»æ”¾åœ¨åœ†æ‹¬å·ä¸­é—´ï¼Œåœ†æ‹¬å·ä¹‹é—´å¯ä»¥ç”¨äºå®šä¹‰å‚æ•°ã€‚ å‡½æ•°çš„ç¬¬ä¸€è¡Œè¯­å¥å¯ä»¥é€‰æ‹©æ€§åœ°ä½¿ç”¨æ–‡æ¡£å­—ç¬¦ä¸²â€”ç”¨äºå­˜æ”¾å‡½æ•°è¯´æ˜ã€‚ å‡½æ•°å†…å®¹ä»¥å†’å· : èµ·å§‹ï¼Œå¹¶ä¸”ç¼©è¿›ã€‚ return [è¡¨è¾¾å¼] ç»“æŸå‡½æ•°ï¼Œé€‰æ‹©æ€§åœ°è¿”å›ä¸€ä¸ªå€¼ç»™è°ƒç”¨æ–¹ï¼Œä¸å¸¦è¡¨è¾¾å¼çš„ return ç›¸å½“äºè¿”å› Noneã€‚ def å‡½æ•°åï¼ˆå‚æ•°åˆ—è¡¨ï¼‰: å‡½æ•°ä½“ é»˜è®¤æƒ…å†µä¸‹ï¼Œå‚æ•°å€¼å’Œå‚æ•°åç§°æ˜¯æŒ‰å‡½æ•°å£°æ˜ä¸­å®šä¹‰çš„é¡ºåºåŒ¹é…èµ·æ¥çš„ã€‚ #!/usr/bin/python3def hello() : print(Hello World!)hello() # æ¯”è¾ƒä¸¤ä¸ªæ•°ï¼Œå¹¶è¿”å›è¾ƒå¤§çš„æ•°: def max(a, b): if a b: return a else: return b a = 4b = 5print(max(a, b)) # 5 å‡½æ•°è°ƒç”¨å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼šç»™äº†å‡½æ•°ä¸€ä¸ªåç§°ï¼ŒæŒ‡å®šäº†å‡½æ•°é‡ŒåŒ…å«çš„å‚æ•°ï¼Œå’Œä»£ç å—ç»“æ„ã€‚ è¿™ä¸ªå‡½æ•°çš„åŸºæœ¬ç»“æ„å®Œæˆä»¥åï¼Œä½ å¯ä»¥é€šè¿‡å¦ä¸€ä¸ªå‡½æ•°è°ƒç”¨æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä» Python å‘½ä»¤æç¤ºç¬¦æ‰§è¡Œã€‚ å¦‚ä¸‹å®ä¾‹è°ƒç”¨äº† printme() å‡½æ•°ï¼š #!/usr/bin/python3 # å®šä¹‰å‡½æ•°def printme( str ): # æ‰“å°ä»»ä½•ä¼ å…¥çš„å­—ç¬¦ä¸² print (str) return # è°ƒç”¨å‡½æ•°printme(æˆ‘è¦è°ƒç”¨ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°!) # æˆ‘è¦è°ƒç”¨ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°!printme(å†æ¬¡è°ƒç”¨åŒä¸€å‡½æ•°) # å†æ¬¡è°ƒç”¨åŒä¸€å‡½æ•° å‚æ•°ä¼ é€’åœ¨ Python ä¸­ï¼Œç±»å‹å±äºå¯¹è±¡ï¼Œå¯¹è±¡æœ‰ä¸åŒç±»å‹çš„åŒºåˆ†ï¼Œå˜é‡æ˜¯æ²¡æœ‰ç±»å‹çš„ï¼š a=[1,2,3]a=Runoob ä»¥ä¸Šä»£ç ä¸­ï¼Œ**[1,2,3]** æ˜¯ List ç±»å‹ï¼Œ**â€Runoobâ€** æ˜¯ String ç±»å‹ï¼Œè€Œå˜é‡ a æ˜¯æ²¡æœ‰ç±»å‹ï¼Œå®ƒä»…ä»…æ˜¯ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼ˆä¸€ä¸ªæŒ‡é’ˆï¼‰ï¼Œå¯ä»¥æ˜¯æŒ‡å‘ List ç±»å‹å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯æŒ‡å‘ String ç±»å‹å¯¹è±¡ã€‚ å¯æ›´æ”¹(mutable)ä¸ä¸å¯æ›´æ”¹(immutable)å¯¹è±¡ï¼š åœ¨ Python ä¸­ï¼Œstrings, tuples, å’Œ numbers æ˜¯ä¸å¯æ›´æ”¹çš„å¯¹è±¡ï¼Œè€Œ list, dict ç­‰åˆ™æ˜¯å¯ä»¥ä¿®æ”¹çš„å¯¹è±¡ã€‚ ä¸å¯å˜ç±»å‹ï¼š å˜é‡èµ‹å€¼ a 5 åå†èµ‹å€¼ a 10ï¼Œè¿™é‡Œå®é™…æ˜¯æ–°ç”Ÿæˆä¸€ä¸ª int å€¼å¯¹è±¡ 10ï¼Œå†è®© a æŒ‡å‘å®ƒï¼Œè€Œ 5 è¢«ä¸¢å¼ƒï¼Œä¸æ˜¯æ”¹å˜ a çš„å€¼ï¼Œç›¸å½“äºæ–°ç”Ÿæˆäº† aã€‚ å¯å˜ç±»å‹ï¼š å˜é‡èµ‹å€¼ la = [1,2,3,4] åå†èµ‹å€¼ la [2] = 5 åˆ™æ˜¯å°† list la çš„ç¬¬ä¸‰ä¸ªå…ƒç´ å€¼æ›´æ”¹ï¼Œæœ¬èº« la æ²¡æœ‰åŠ¨ï¼Œåªæ˜¯å…¶å†…éƒ¨çš„ä¸€éƒ¨åˆ†å€¼è¢«ä¿®æ”¹äº†ã€‚ Python å‡½æ•°çš„å‚æ•°ä¼ é€’ï¼š ä¸å¯å˜ç±»å‹ï¼š ç±»ä¼¼ C++ çš„å€¼ä¼ é€’ï¼Œå¦‚æ•´æ•°ã€å­—ç¬¦ä¸²ã€å…ƒç»„ã€‚å¦‚ fun(a)ï¼Œä¼ é€’çš„åªæ˜¯ a çš„å€¼ï¼Œæ²¡æœ‰å½±å“ a å¯¹è±¡æœ¬èº«ã€‚å¦‚æœåœ¨ fun(a) å†…éƒ¨ä¿®æ”¹ a çš„å€¼ï¼Œåˆ™æ˜¯æ–°ç”Ÿæˆä¸€ä¸ª a çš„å¯¹è±¡ã€‚ å¯å˜ç±»å‹ï¼š ç±»ä¼¼ C++ çš„å¼•ç”¨ä¼ é€’ï¼Œå¦‚ åˆ—è¡¨ï¼Œå­—å…¸ã€‚å¦‚ fun(la)ï¼Œåˆ™æ˜¯å°† la çœŸæ­£çš„ä¼ è¿‡å»ï¼Œä¿®æ”¹å fun å¤–éƒ¨çš„ la ä¹Ÿä¼šå—å½±å“ Python ä¸­ä¸€åˆ‡éƒ½æ˜¯å¯¹è±¡ï¼Œä¸¥æ ¼æ„ä¹‰æˆ‘ä»¬ä¸èƒ½è¯´å€¼ä¼ é€’è¿˜æ˜¯å¼•ç”¨ä¼ é€’ï¼Œæˆ‘ä»¬åº”è¯¥è¯´ä¼ ä¸å¯å˜å¯¹è±¡å’Œä¼ å¯å˜å¯¹è±¡ã€‚ ä¼ ä¸å¯å˜å¯¹è±¡ç¤ºä¾‹ï¼š é€šè¿‡ id() å‡½æ•°æ¥æŸ¥çœ‹å†…å­˜åœ°å€å˜åŒ–ã€‚ def change(a): print(id(a)) # æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ a=10 print(id(a)) # ä¸€ä¸ªæ–°å¯¹è±¡ a = 1print(id(a))change(a) è¾“å‡ºç»“æœï¼š 4379369136 43793691364379369424 å¯ä»¥çœ‹è§åœ¨è°ƒç”¨å‡½æ•°å‰åï¼Œå½¢å‚å’Œå®å‚æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼ˆå¯¹è±¡ id ç›¸åŒï¼‰ï¼Œåœ¨å‡½æ•°å†…éƒ¨ä¿®æ”¹å½¢å‚åï¼Œå½¢å‚æŒ‡å‘çš„æ˜¯ä¸åŒçš„ idã€‚ ä¼ å¯å˜å¯¹è±¡ç¤ºä¾‹ï¼š å¯å˜å¯¹è±¡åœ¨å‡½æ•°é‡Œä¿®æ”¹äº†å‚æ•°ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„å‡½æ•°é‡Œï¼ŒåŸå§‹çš„å‚æ•°ä¹Ÿè¢«æ”¹å˜äº†ã€‚ #!/usr/bin/python3 # å¯å†™å‡½æ•°è¯´æ˜def changeme( mylist ): ä¿®æ”¹ä¼ å…¥çš„åˆ—è¡¨ mylist.append([1,2,3,4]) print (å‡½æ•°å†…å–å€¼: , mylist) return # è°ƒç”¨changemeå‡½æ•°mylist = [10,20,30]changeme( mylist )print (å‡½æ•°å¤–å–å€¼: , mylist) ä¼ å…¥å‡½æ•°çš„å’Œåœ¨æœ«å°¾æ·»åŠ æ–°å†…å®¹çš„å¯¹è±¡ç”¨çš„æ˜¯åŒä¸€ä¸ªå¼•ç”¨ã€‚ è¾“å‡ºç»“æœï¼š å‡½æ•°å†…å–å€¼: [10, 20, 30, [1, 2, 3, 4]]å‡½æ•°å¤–å–å€¼: [10, 20, 30, [1, 2, 3, 4]] å‚æ•°ä»¥ä¸‹æ˜¯è°ƒç”¨å‡½æ•°æ—¶å¯ä½¿ç”¨çš„æ­£å¼å‚æ•°ç±»å‹ï¼š å¿…éœ€å‚æ•° å…³é”®å­—å‚æ•° é»˜è®¤å‚æ•° ä¸å®šé•¿å‚æ•° å¿…é¡»å‚æ•°å¿…éœ€å‚æ•°é¡»ä»¥æ­£ç¡®çš„é¡ºåºä¼ å…¥å‡½æ•°ã€‚è°ƒç”¨æ—¶çš„æ•°é‡å¿…é¡»å’Œå£°æ˜æ—¶çš„ä¸€æ ·ã€‚ è°ƒç”¨ printme() å‡½æ•°ï¼Œä½ å¿…é¡»ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œä¸ç„¶ä¼šå‡ºç°è¯­æ³•é”™è¯¯ï¼š #!/usr/bin/python3 #å¯å†™å‡½æ•°è¯´æ˜def printme( str ): æ‰“å°ä»»ä½•ä¼ å…¥çš„å­—ç¬¦ä¸² print (str) return # è°ƒç”¨ printme å‡½æ•°ï¼Œä¸åŠ å‚æ•°ä¼šæŠ¥é”™printme() è¾“å‡ºç»“æœï¼š Traceback (most recent call last):File â€œtest.pyâ€, line 10, in moduleprintme()TypeError: printme() missing 1 required positional argument: â€˜strâ€™ å…³é”®å­—å‚æ•°å…³é”®å­—å‚æ•°å’Œå‡½æ•°è°ƒç”¨å…³ç³»ç´§å¯†ï¼Œå‡½æ•°è°ƒç”¨ä½¿ç”¨å…³é”®å­—å‚æ•°æ¥ç¡®å®šä¼ å…¥çš„å‚æ•°å€¼ã€‚ ä½¿ç”¨å…³é”®å­—å‚æ•°å…è®¸å‡½æ•°è°ƒç”¨æ—¶å‚æ•°çš„é¡ºåºä¸å£°æ˜æ—¶ä¸ä¸€è‡´ï¼Œå› ä¸º Python è§£é‡Šå™¨èƒ½å¤Ÿç”¨å‚æ•°ååŒ¹é…å‚æ•°å€¼ã€‚ ä»¥ä¸‹åœ¨å‡½æ•° printme() è°ƒç”¨æ—¶ä½¿ç”¨å‚æ•°åï¼š #!/usr/bin/python3 #å¯å†™å‡½æ•°è¯´æ˜def printme( str ): æ‰“å°ä»»ä½•ä¼ å…¥çš„å­—ç¬¦ä¸² print (str) return #è°ƒç”¨printmeå‡½æ•°printme( str = èœé¸Ÿæ•™ç¨‹) # èœé¸Ÿæ•™ç¨‹ ä»¥ä¸‹æ¼”ç¤ºäº†å‡½æ•°å‚æ•°çš„ä½¿ç”¨ä¸éœ€è¦ä½¿ç”¨æŒ‡å®šé¡ºåºï¼š #!/usr/bin/python3 #å¯å†™å‡½æ•°è¯´æ˜def printinfo( name, age ): æ‰“å°ä»»ä½•ä¼ å…¥çš„å­—ç¬¦ä¸² print (åå­—: , name) print (å¹´é¾„: , age) return #è°ƒç”¨printinfoå‡½æ•°printinfo( age=50, name=runoob ) è¾“å‡ºç»“æœï¼š åå­—: runoobå¹´é¾„: 50 é»˜è®¤å‚æ•°è°ƒç”¨å‡½æ•°æ—¶ï¼Œå¦‚æœæ²¡æœ‰ä¼ é€’å‚æ•°ï¼Œåˆ™ä¼šä½¿ç”¨é»˜è®¤å‚æ•°ã€‚ä»¥ä¸‹å®ä¾‹ä¸­å¦‚æœæ²¡æœ‰ä¼ å…¥ age å‚æ•°ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ï¼š #!/usr/bin/python3 #å¯å†™å‡½æ•°è¯´æ˜def printinfo( name, age = 35 ): æ‰“å°ä»»ä½•ä¼ å…¥çš„å­—ç¬¦ä¸² print (åå­—: , name) print (å¹´é¾„: , age) return #è°ƒç”¨printinfoå‡½æ•°printinfo( age=50, name=runoob )print (------------------------)printinfo( name=runoob ) è¾“å‡ºç»“æœï¼š åå­—: runoobå¹´é¾„: 50------------------------åå­—: runoobå¹´é¾„: 35 å¸¦æœ‰é»˜è®¤å€¼çš„å‚æ•°éœ€è¦æ”¾åˆ°å‚æ•°åˆ—è¡¨æœ€åé¢ï¼Œä¸ç„¶ä¼šæŠ¥é”™ã€‚ ä¸å®šé•¿å‚æ•°ä½ å¯èƒ½éœ€è¦ä¸€ä¸ªå‡½æ•°èƒ½å¤„ç†æ¯”å½“åˆå£°æ˜æ—¶æ›´å¤šçš„å‚æ•°ã€‚è¿™äº›å‚æ•°å«åšä¸å®šé•¿å‚æ•°ï¼Œå’Œä¸Šè¿° 2 ç§å‚æ•°ä¸åŒï¼Œå£°æ˜æ—¶ä¸ä¼šå‘½åã€‚ def functionname([formal_args,] *var_args_tuple ): å‡½æ•°_æ–‡æ¡£å­—ç¬¦ä¸² function_suite return [expression] åŠ äº†æ˜Ÿå· * çš„å‚æ•°ä¼šä»¥å…ƒç»„(tuple)çš„å½¢å¼å¯¼å…¥ï¼Œå­˜æ”¾æ‰€æœ‰æœªå‘½åçš„å˜é‡å‚æ•°ã€‚ #!/usr/bin/python3 # å¯å†™å‡½æ•°è¯´æ˜def printinfo( arg1, *vartuple ): æ‰“å°ä»»ä½•ä¼ å…¥çš„å‚æ•° print (è¾“å‡º: ) print (arg1) print (vartuple) # è°ƒç”¨printinfo å‡½æ•°printinfo( 70, 60, 50 ) è¾“å‡ºç»“æœï¼š è¾“å‡º:70(60, 50) å¦‚æœåœ¨å‡½æ•°è°ƒç”¨æ—¶æ²¡æœ‰æŒ‡å®šå‚æ•°ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªç©ºå…ƒç»„ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸å‘å‡½æ•°ä¼ é€’æœªå‘½åçš„å˜é‡ã€‚ #!/usr/bin/python3 # å¯å†™å‡½æ•°è¯´æ˜def printinfo( arg1, *vartuple ): æ‰“å°ä»»ä½•ä¼ å…¥çš„å‚æ•° print (è¾“å‡º: ) print (arg1) for var in vartuple: print (var) return # è°ƒç”¨printinfo å‡½æ•°printinfo( 10 )printinfo( 70, 60, 50 ) è¾“å‡ºç»“æœï¼š è¾“å‡º:10()è¾“å‡º:706050 è¿˜æœ‰ä¸€ç§å°±æ˜¯å‚æ•°å¸¦ä¸¤ä¸ªæ˜Ÿå· ** ï¼š def functionname([formal_args,] **var_args_dict ): å‡½æ•°_æ–‡æ¡£å­—ç¬¦ä¸² function_suite return [expression] åŠ äº†ä¸¤ä¸ªæ˜Ÿå· * çš„å‚æ•°ä¼šä»¥å­—å…¸çš„å½¢å¼å¯¼å…¥ã€‚ #!/usr/bin/python3 # å¯å†™å‡½æ•°è¯´æ˜def printinfo( arg1, **vardict ): æ‰“å°ä»»ä½•ä¼ å…¥çš„å‚æ•° print (è¾“å‡º: ) print (arg1) print (vardict) # è°ƒç”¨printinfo å‡½æ•°printinfo(1, a=2,b=3) è¾“å‡ºç»“æœï¼š è¾“å‡º:1{â€˜aâ€™: 2, â€˜bâ€™: 3} å£°æ˜å‡½æ•°æ—¶ï¼Œå‚æ•°ä¸­æ˜Ÿå· * å¯ä»¥å•ç‹¬å‡ºç°ï¼Œä¾‹å¦‚ï¼š def f(a,b,*,c): return a+b+c å¦‚æœå•ç‹¬å‡ºç°æ˜Ÿå· *ï¼Œåˆ™æ˜Ÿå· * åçš„å‚æ•°å¿…é¡»ç”¨å…³é”®å­—ä¼ å…¥ï¼š def f(a,b,*,c):... return a+b+c... f(1,2,3) # æŠ¥é”™Traceback (most recent call last): File stdin, line 1, in moduleTypeError: f() takes 2 positional arguments but 3 were given f(1,2,c=3) # æ­£å¸¸6 return è¯­å¥return [è¡¨è¾¾å¼] è¯­å¥ç”¨äºé€€å‡ºå‡½æ•°ï¼Œé€‰æ‹©æ€§åœ°å‘è°ƒç”¨æ–¹è¿”å›ä¸€ä¸ªè¡¨è¾¾å¼ã€‚ä¸å¸¦å‚æ•°å€¼çš„ return è¯­å¥è¿”å› Noneã€‚ #!/usr/bin/python3 # å¯å†™å‡½æ•°è¯´æ˜def sum( arg1, arg2 ): # è¿”å›2ä¸ªå‚æ•°çš„å’Œ. total = arg1 + arg2 print (å‡½æ•°å†… : , total) return total # è°ƒç”¨sumå‡½æ•°total = sum( 10, 20 )print (å‡½æ•°å¤– : , total) è¾“å‡ºç»“æœï¼š å‡½æ•°å†… : 30å‡½æ•°å¤– : 30 å¼ºåˆ¶ä½ç½®å‚æ•°Python3.8 æ–°å¢äº†ä¸€ä¸ªå‡½æ•°å½¢å‚è¯­æ³• / ç”¨æ¥æŒ‡æ˜å‡½æ•°å½¢å‚å¿…é¡»ä½¿ç”¨æŒ‡å®šä½ç½®å‚æ•°ï¼Œä¸èƒ½ä½¿ç”¨å…³é”®å­—å‚æ•°çš„å½¢å¼ã€‚ åœ¨ä»¥ä¸‹çš„ä¾‹å­ä¸­ï¼Œå½¢å‚ a å’Œ b å¿…é¡»ä½¿ç”¨æŒ‡å®šä½ç½®å‚æ•°ï¼Œc æˆ– d å¯ä»¥æ˜¯ä½ç½®å½¢å‚æˆ–å…³é”®å­—å½¢å‚ï¼Œè€Œ e å’Œ f è¦æ±‚ä¸ºå…³é”®å­—å½¢å‚: def f(a, b, /, c, d, *, e, f): print(a, b, c, d, e, f) ä»¥ä¸‹ä½¿ç”¨æ–¹æ³•æ˜¯æ­£ç¡®çš„ï¼š f(10, 20, 30, d=40, e=50, f=60) ä»¥ä¸‹ä½¿ç”¨æ–¹æ³•ä¼šå‘ç”Ÿé”™è¯¯ï¼š f(10, b=20, c=30, d=40, e=50, f=60) # b ä¸èƒ½ä½¿ç”¨å…³é”®å­—å‚æ•°çš„å½¢å¼f(10, 20, 30, 40, 50, f=60) # e å¿…é¡»ä½¿ç”¨å…³é”®å­—å‚æ•°çš„å½¢å¼ è§£åŒ…ä¼ å‚è‹¥å‡½æ•°çš„å½¢å‚æ˜¯å®šé•¿å‚æ•°ï¼Œå¯ä»¥é€šè¿‡ * å’Œ ** å¯¹åˆ—è¡¨ã€å…ƒç»„ã€å­—å…¸ç­‰è§£åŒ…ä¼ å‚ã€‚ def func(a,b,c): return a * b * ctuple1 = (1,2,3)print(func(*tuple1))# å­—å…¸ä¸­keyçš„åç§°å’Œå‚æ•°åå¿…é¡»ä¸€è‡´dict1 = a: 1, b: 2, c: 3print(func(**dict1)) é˜²æ­¢å‡½æ•°ä¿®æ”¹åˆ—è¡¨æœ‰æ—¶è¦å‡½æ•°å¯¹åˆ—è¡¨è¿›è¡Œå¤„ç†ï¼Œåˆä¸å¸Œæœ›å‡½æ•°ä¿®æ”¹åŸåˆ—è¡¨ï¼Œå¯ä»¥ä½¿ç”¨ copy.deepcopy()ã€‚ import copydef multiply(var): var[3].append(400) print(å‡½æ•°å¤„ç†ï¼š, var)list1 = [1, 2, 3, [100, 200, 300]]print(å‡½æ•°å¤–å¤„ç†å‰ï¼š, list1)multiply(copy.deepcopy(list1))print(å‡½æ•°å¤–ç†åï¼š, list1)å‡½æ•°å¤–å¤„ç†å‰ï¼š [1, 2, 3, [100, 200, 300]]å‡½æ•°å¤„ç†ï¼š [1, 2, 3, [100, 200, 300, 400]]å‡½æ•°å¤–ç†åï¼š [1, 2, 3, [100, 200, 300]] lambda(åŒ¿åå‡½æ•°)Python ä½¿ç”¨ lambda æ¥åˆ›å»ºåŒ¿åå‡½æ•°ã€‚ lambda å‡½æ•°æ˜¯ä¸€ç§å°å‹ã€åŒ¿åçš„ã€å†…è”å‡½æ•°ï¼Œå®ƒå¯ä»¥å…·æœ‰ä»»æ„æ•°é‡çš„å‚æ•°ï¼Œä½†åªèƒ½æœ‰ä¸€ä¸ªè¡¨è¾¾å¼ã€‚ åŒ¿åå‡½æ•°ä¸éœ€è¦ä½¿ç”¨ def å…³é”®å­—å®šä¹‰å®Œæ•´å‡½æ•°ã€‚ lambda å‡½æ•°é€šå¸¸ç”¨äºç¼–å†™ç®€å•çš„ã€å•è¡Œçš„å‡½æ•°ï¼Œé€šå¸¸åœ¨éœ€è¦å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œä¾‹å¦‚åœ¨ map()ã€filter()ã€reduce() ç­‰å‡½æ•°ä¸­ã€‚ lambda å‡½æ•°ç‰¹ç‚¹ï¼š lambda å‡½æ•°æ˜¯åŒ¿åçš„ï¼Œå®ƒä»¬æ²¡æœ‰å‡½æ•°åç§°ï¼Œåªèƒ½é€šè¿‡èµ‹å€¼ç»™å˜é‡æˆ–ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°æ¥ä½¿ç”¨ã€‚ lambda å‡½æ•°é€šå¸¸åªåŒ…å«ä¸€è¡Œä»£ç ï¼Œè¿™ä½¿å¾—å®ƒä»¬é€‚ç”¨äºç¼–å†™ç®€å•çš„å‡½æ•°ã€‚ lambda è¯­æ³•æ ¼å¼ï¼š lambda arguments: expression lambda æ˜¯ Python çš„å…³é”®å­—ï¼Œç”¨äºå®šä¹‰ lambda å‡½æ•°ã€‚ arguments æ˜¯å‚æ•°åˆ—è¡¨ï¼Œå¯ä»¥åŒ…å«é›¶ä¸ªæˆ–å¤šä¸ªå‚æ•°ï¼Œä½†å¿…é¡»åœ¨å†’å·(:)å‰æŒ‡å®šã€‚ expression æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œç”¨äºè®¡ç®—å¹¶è¿”å›å‡½æ•°çš„ç»“æœã€‚ ä»¥ä¸‹çš„ lambda å‡½æ•°æ²¡æœ‰å‚æ•°ï¼š f = lambda: Hello, world! print(f()) # è¾“å‡º: Hello, world! è¾“å‡ºç»“æœï¼š Hello, world! ä½¿ç”¨ lambda åˆ›å»ºåŒ¿åå‡½æ•°ï¼Œè®¾ç½®ä¸€ä¸ªå‡½æ•°å‚æ•° aï¼Œå‡½æ•°è®¡ç®—å‚æ•° a åŠ  10ï¼Œå¹¶è¿”å›ç»“æœï¼š x = lambda a : a + 10 print(x(5)) è¾“å‡ºç»“æœï¼š 15 lambda å‡½æ•°ä¹Ÿå¯ä»¥è®¾ç½®å¤šä¸ªå‚æ•°ï¼Œå‚æ•°ä½¿ç”¨é€—å· , éš”å¼€ï¼š x = lambda a, b : a * b print(x(5, 6)) è¾“å‡ºç»“æœï¼š 30 lambda å‡½æ•°é€šå¸¸ä¸å†…ç½®å‡½æ•°å¦‚ map()ã€filter() å’Œ reduce() ä¸€èµ·ä½¿ç”¨ï¼Œä»¥ä¾¿åœ¨é›†åˆä¸Šæ‰§è¡Œæ“ä½œã€‚ä¾‹å¦‚ï¼š numbers = [1, 2, 3, 4, 5]squared = list(map(lambda x: x**2, numbers))print(squared) # è¾“å‡º: [1, 4, 9, 16, 25] è¾“å‡ºç»“æœï¼š [1, 4, 9, 16, 25] ä½¿ç”¨ lambda å‡½æ•°ä¸ filter() ä¸€èµ·ï¼Œç­›é€‰å¶æ•°ï¼š numbers = [1, 2, 3, 4, 5, 6, 7, 8]even_numbers = list(filter(lambda x: x % 2 == 0, numbers))print(even_numbers) # è¾“å‡ºï¼š[2, 4, 6, 8] è¾“å‡ºç»“æœï¼š [2, 4, 6, 8] å‡½æ•°åµŒå¥—åŸºæœ¬ç»“æ„ç¤ºä¾‹ï¼š def outer(): x = 10 def inner(): print(fè®¿é—®å¤–éƒ¨å˜é‡: x) # innerå¯è®¿é—®outerçš„å˜é‡ inner()outer() # è¾“å‡ºï¼šè®¿é—®å¤–éƒ¨å˜é‡: 10 æ ¸å¿ƒç‰¹æ€§ï¼š â€Œä½œç”¨åŸŸè§„åˆ™â€Œ å†…éƒ¨å‡½æ•°å¯è®¿é—®å¤–å±‚ä½œç”¨åŸŸå˜é‡ï¼ˆnon-local ä½œç”¨åŸŸï¼‰ å¤–éƒ¨å‡½æ•°æ— æ³•è®¿é—®å†…éƒ¨å‡½æ•°çš„å±€éƒ¨å˜é‡ â€Œé—­åŒ…ï¼ˆClosureï¼‰ def counter(): n = 0 def inc(): nonlocal n n += 1 return n return incc = counter()print(c(), c(), c()) # è¾“å‡ºï¼š1 2 3 â€Œè£…é¥°å™¨åº”ç”¨ï¼š def logger(func): def wrapper(*args, **kwargs): print(få¼€å§‹æ‰§è¡Œ: func.__name__) result = func(*args, **kwargs) print(æ‰§è¡Œç»“æŸ) return result return wrapper@loggerdef say_hello(): print(Hello World!)say_hello() åº”ç”¨åœºæ™¯ï¼š â€Œå°è£…ç§æœ‰é€»è¾‘â€Œï¼šéšè—ä¸éœ€è¦æš´éœ²çš„å†…éƒ¨å®ç° â€Œåˆ›å»ºå·¥å‚å‡½æ•°â€Œï¼šåŠ¨æ€ç”ŸæˆåŠŸèƒ½ç›¸ä¼¼çš„å‡½æ•° â€Œå®ç°è£…é¥°å™¨â€Œï¼šå¢å¼ºå‡½æ•°åŠŸèƒ½è€Œä¸ä¿®æ”¹åŸå‡½æ•° â€Œå»¶è¿Ÿè®¡ç®—â€Œï¼šé€šè¿‡é—­åŒ…ä¿å­˜ä¸­é—´çŠ¶æ€ æ³¨æ„äº‹é¡¹ï¼š # é”™è¯¯ç¤ºä¾‹ï¼šå¾ªç¯ä¸­åˆ›å»ºé—­åŒ…def create_funcs(): return [lambda: i for i in range(3)]funcs = create_funcs()print([f() for f in funcs]) # è¾“å‡ºï¼š[2, 2, 2] è€Œéé¢„æœŸ[0,1,2]# æ­£ç¡®å†™æ³•ï¼šä½¿ç”¨é»˜è®¤å‚æ•°æ•è·å˜é‡def create_funcs_fixed(): return [lambda x=i: x for i in range(3)]","tags":[null],"categories":[null]},{"title":"Pythonå‘½åç©ºé—´å’Œä½œç”¨åŸŸ","path":"/wiki/Python/å‘½åç©ºé—´å’Œä½œç”¨åŸŸ.html","content":"å‘½åç©ºé—´å‘½åç©ºé—´(Namespace)æ˜¯ä»åç§°åˆ°å¯¹è±¡çš„æ˜ å°„ï¼Œå¤§éƒ¨åˆ†çš„å‘½åç©ºé—´éƒ½æ˜¯é€šè¿‡ Python å­—å…¸æ¥å®ç°çš„ã€‚ å‘½åç©ºé—´æä¾›äº†åœ¨é¡¹ç›®ä¸­é¿å…åå­—å†²çªçš„ä¸€ç§æ–¹æ³•ã€‚å„ä¸ªå‘½åç©ºé—´æ˜¯ç‹¬ç«‹çš„ï¼Œæ²¡æœ‰ä»»ä½•å…³ç³»çš„ï¼Œæ‰€ä»¥ä¸€ä¸ªå‘½åç©ºé—´ä¸­ä¸èƒ½æœ‰é‡åï¼Œä½†ä¸åŒçš„å‘½åç©ºé—´æ˜¯å¯ä»¥é‡åè€Œæ²¡æœ‰ä»»ä½•å½±å“ã€‚ æˆ‘ä»¬ä¸¾ä¸€ä¸ªè®¡ç®—æœºç³»ç»Ÿä¸­çš„ä¾‹å­ï¼Œä¸€ä¸ªæ–‡ä»¶å¤¹(ç›®å½•)ä¸­å¯ä»¥åŒ…å«å¤šä¸ªæ–‡ä»¶å¤¹ï¼Œæ¯ä¸ªæ–‡ä»¶å¤¹ä¸­ä¸èƒ½æœ‰ç›¸åŒçš„æ–‡ä»¶åï¼Œä½†ä¸åŒæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶å¯ä»¥é‡åã€‚ ä¸€èˆ¬æœ‰ä¸‰ç§å‘½åç©ºé—´ï¼š å†…ç½®åç§°ï¼ˆbuilt-in namesï¼‰ï¼Œ Python è¯­è¨€å†…ç½®çš„åç§°ï¼Œæ¯”å¦‚å‡½æ•°å absã€char å’Œå¼‚å¸¸åç§° BaseExceptionã€Exception ç­‰ç­‰ã€‚ å…¨å±€åç§°ï¼ˆglobal namesï¼‰ï¼Œæ¨¡å—ä¸­å®šä¹‰çš„åç§°ï¼Œè®°å½•äº†æ¨¡å—çš„å˜é‡ï¼ŒåŒ…æ‹¬å‡½æ•°ã€ç±»ã€å…¶å®ƒå¯¼å…¥çš„æ¨¡å—ã€æ¨¡å—çº§çš„å˜é‡å’Œå¸¸é‡ã€‚ å±€éƒ¨åç§°ï¼ˆlocal namesï¼‰ï¼Œå‡½æ•°ä¸­å®šä¹‰çš„åç§°ï¼Œè®°å½•äº†å‡½æ•°çš„å˜é‡ï¼ŒåŒ…æ‹¬å‡½æ•°çš„å‚æ•°å’Œå±€éƒ¨å®šä¹‰çš„å˜é‡ã€‚ï¼ˆç±»ä¸­å®šä¹‰çš„ä¹Ÿæ˜¯ï¼‰ å‘½åç©ºé—´æŸ¥æ‰¾é¡ºåº: å‡è®¾æˆ‘ä»¬è¦ä½¿ç”¨å˜é‡ runoobï¼Œåˆ™ Python çš„æŸ¥æ‰¾é¡ºåºä¸ºï¼šå±€éƒ¨çš„å‘½åç©ºé—´ - å…¨å±€å‘½åç©ºé—´ - å†…ç½®å‘½åç©ºé—´ã€‚ å¦‚æœæ‰¾ä¸åˆ°å˜é‡ runoobï¼Œå®ƒå°†æ”¾å¼ƒæŸ¥æ‰¾å¹¶å¼•å‘ä¸€ä¸ª NameError å¼‚å¸¸ï¼š NameError: name â€˜runoobâ€™ is not definedã€‚ å‘½åç©ºé—´çš„ç”Ÿå‘½å‘¨æœŸï¼š å‘½åç©ºé—´çš„ç”Ÿå‘½å‘¨æœŸå–å†³äºå¯¹è±¡çš„ä½œç”¨åŸŸï¼Œå¦‚æœå¯¹è±¡æ‰§è¡Œå®Œæˆï¼Œåˆ™è¯¥å‘½åç©ºé—´çš„ç”Ÿå‘½å‘¨æœŸå°±ç»“æŸã€‚ å› æ­¤ï¼Œæˆ‘ä»¬æ— æ³•ä»å¤–éƒ¨å‘½åç©ºé—´è®¿é—®å†…éƒ¨å‘½åç©ºé—´çš„å¯¹è±¡ã€‚ # var1 æ˜¯å…¨å±€åç§°var1 = 5def some_func(): # var2 æ˜¯å±€éƒ¨åç§° var2 = 6 def some_inner_func(): # var3 æ˜¯å†…åµŒçš„å±€éƒ¨åç§° var3 = 7 ä½œç”¨åŸŸä½œç”¨åŸŸå°±æ˜¯ä¸€ä¸ª Python ç¨‹åºå¯ä»¥ç›´æ¥è®¿é—®å‘½åç©ºé—´çš„æ­£æ–‡åŒºåŸŸã€‚ åœ¨ä¸€ä¸ª Python ç¨‹åºä¸­ï¼Œç›´æ¥è®¿é—®ä¸€ä¸ªå˜é‡ï¼Œä¼šä»å†…åˆ°å¤–ä¾æ¬¡è®¿é—®æ‰€æœ‰çš„ä½œç”¨åŸŸç›´åˆ°æ‰¾åˆ°ï¼Œå¦åˆ™ä¼šæŠ¥æœªå®šä¹‰çš„é”™è¯¯ã€‚ Python ä¸­ï¼Œç¨‹åºçš„å˜é‡å¹¶ä¸æ˜¯åœ¨å“ªä¸ªä½ç½®éƒ½å¯ä»¥è®¿é—®çš„ï¼Œè®¿é—®æƒé™å†³å®šäºè¿™ä¸ªå˜é‡æ˜¯åœ¨å“ªé‡Œèµ‹å€¼çš„ã€‚ å˜é‡çš„ä½œç”¨åŸŸå†³å®šäº†åœ¨å“ªä¸€éƒ¨åˆ†ç¨‹åºå¯ä»¥è®¿é—®å“ªä¸ªç‰¹å®šçš„å˜é‡åç§°ã€‚ Python çš„ä½œç”¨åŸŸä¸€å…±æœ‰ 4 ç§ï¼Œåˆ†åˆ«æ˜¯ï¼š æœ‰å››ç§ä½œç”¨åŸŸï¼š Lï¼ˆLocalï¼‰ï¼šæœ€å†…å±‚ï¼ŒåŒ…å«å±€éƒ¨å˜é‡ï¼Œæ¯”å¦‚ä¸€ä¸ªå‡½æ•°æ–¹æ³•å†…éƒ¨ã€‚ Eï¼ˆEnclosingï¼‰ï¼šåŒ…å«äº†éå±€éƒ¨(non-local)ä¹Ÿéå…¨å±€(non-global)çš„å˜é‡ã€‚æ¯”å¦‚ä¸¤ä¸ªåµŒå¥—å‡½æ•°ï¼Œä¸€ä¸ªå‡½æ•°ï¼ˆæˆ–ç±»ï¼‰ A é‡Œé¢åˆåŒ…å«äº†ä¸€ä¸ªå‡½æ•° B ï¼Œé‚£ä¹ˆå¯¹äº B ä¸­çš„å˜é‡åç§°æ¥è¯´ A ä¸­çš„ä½œç”¨åŸŸå°±ä¸º nonlocalã€‚ Gï¼ˆGlobalï¼‰ï¼šå½“å‰è„šæœ¬çš„æœ€å¤–å±‚ï¼Œæ¯”å¦‚å½“å‰æ¨¡å—çš„å…¨å±€å˜é‡ã€‚ Bï¼ˆBuilt-inï¼‰ï¼š åŒ…å«äº†å†…å»ºçš„å˜é‡å…³é”®å­—ç­‰ï¼Œæœ€åè¢«æœç´¢ã€‚ LEGB è§„åˆ™ï¼ˆLocal, Enclosing, Global, Built-inï¼‰ï¼šPython æŸ¥æ‰¾å˜é‡æ—¶çš„é¡ºåºæ˜¯ï¼š L â€“ E â€“ G â€“ Bã€‚ Localï¼šå½“å‰å‡½æ•°çš„å±€éƒ¨ä½œç”¨åŸŸã€‚ Enclosingï¼šåŒ…å«å½“å‰å‡½æ•°çš„å¤–éƒ¨å‡½æ•°çš„ä½œç”¨åŸŸï¼ˆå¦‚æœæœ‰åµŒå¥—å‡½æ•°ï¼‰ã€‚ Globalï¼šå½“å‰æ¨¡å—çš„å…¨å±€ä½œç”¨åŸŸã€‚ Built-inï¼šPython å†…ç½®çš„ä½œç”¨åŸŸã€‚ åœ¨å±€éƒ¨æ‰¾ä¸åˆ°ï¼Œä¾¿ä¼šå»å±€éƒ¨å¤–çš„å±€éƒ¨æ‰¾ï¼ˆä¾‹å¦‚é—­åŒ…ï¼‰ï¼Œå†æ‰¾ä¸åˆ°å°±ä¼šå»å…¨å±€æ‰¾ï¼Œå†è€…å»å†…ç½®ä¸­æ‰¾ã€‚ g_count = 0 # å…¨å±€ä½œç”¨åŸŸdef outer(): o_count = 1 # é—­åŒ…å‡½æ•°å¤–çš„å‡½æ•°ä¸­ def inner(): i_count = 2 # å±€éƒ¨ä½œç”¨åŸŸ å†…ç½®ä½œç”¨åŸŸæ˜¯é€šè¿‡ä¸€ä¸ªåä¸º builtin çš„æ ‡å‡†æ¨¡å—æ¥å®ç°çš„ï¼Œä½†æ˜¯è¿™ä¸ªå˜é‡åè‡ªèº«å¹¶æ²¡æœ‰æ”¾å…¥å†…ç½®ä½œç”¨åŸŸå†…ï¼Œæ‰€ä»¥å¿…é¡»å¯¼å…¥è¿™ä¸ªæ–‡ä»¶æ‰èƒ½å¤Ÿä½¿ç”¨å®ƒã€‚åœ¨ Python3.0 ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„ä»£ç æ¥æŸ¥çœ‹åˆ°åº•é¢„å®šä¹‰äº†å“ªäº›å˜é‡ï¼š import builtins dir(builtins) Python ä¸­åªæœ‰æ¨¡å—ï¼ˆmoduleï¼‰ï¼Œç±»ï¼ˆclassï¼‰ä»¥åŠå‡½æ•°ï¼ˆdefã€lambdaï¼‰æ‰ä¼šå¼•å…¥æ–°çš„ä½œç”¨åŸŸï¼Œå…¶å®ƒçš„ä»£ç å—ï¼ˆå¦‚ if/elif/else/ã€try/exceptã€for/while ç­‰ï¼‰æ˜¯ä¸ä¼šå¼•å…¥æ–°çš„ä½œç”¨åŸŸçš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™äº›è¯­å¥å†…å®šä¹‰çš„å˜é‡ï¼Œå¤–éƒ¨ä¹Ÿå¯ä»¥è®¿é—®ï¼Œå¦‚ä¸‹ä»£ç ï¼š if True:... msg = I am from Runoob... msgI am from Runoob å®ä¾‹ä¸­ msg å˜é‡å®šä¹‰åœ¨ if è¯­å¥å—ä¸­ï¼Œä½†å¤–éƒ¨è¿˜æ˜¯å¯ä»¥è®¿é—®çš„ã€‚ å¦‚æœå°† msg å®šä¹‰åœ¨å‡½æ•°ä¸­ï¼Œåˆ™å®ƒå°±æ˜¯å±€éƒ¨å˜é‡ï¼Œå¤–éƒ¨ä¸èƒ½è®¿é—®ï¼š def test():... msg_inner = I am from Runoob... msg_innerTraceback (most recent call last): File stdin, line 1, in moduleNameError: name msg_inner is not defined ä»æŠ¥é”™çš„ä¿¡æ¯ä¸Šçœ‹ï¼Œè¯´æ˜äº† msg_inner æœªå®šä¹‰ï¼Œæ— æ³•ä½¿ç”¨ï¼Œå› ä¸ºå®ƒæ˜¯å±€éƒ¨å˜é‡ï¼Œåªæœ‰åœ¨å‡½æ•°å†…å¯ä»¥ä½¿ç”¨ã€‚ å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡å®šä¹‰åœ¨å‡½æ•°å†…éƒ¨çš„å˜é‡æ‹¥æœ‰ä¸€ä¸ªå±€éƒ¨ä½œç”¨åŸŸï¼Œå®šä¹‰åœ¨å‡½æ•°å¤–çš„æ‹¥æœ‰å…¨å±€ä½œç”¨åŸŸã€‚ å±€éƒ¨å˜é‡åªèƒ½åœ¨å…¶è¢«å£°æ˜çš„å‡½æ•°å†…éƒ¨è®¿é—®ï¼Œè€Œå…¨å±€å˜é‡å¯ä»¥åœ¨æ•´ä¸ªç¨‹åºèŒƒå›´å†…è®¿é—®ã€‚ åœ¨å‡½æ•°å†…éƒ¨å£°æ˜çš„å˜é‡åªåœ¨å‡½æ•°å†…éƒ¨çš„ä½œç”¨åŸŸä¸­æœ‰æ•ˆï¼Œè°ƒç”¨å‡½æ•°æ—¶ï¼Œè¿™äº›å†…éƒ¨å˜é‡ä¼šè¢«åŠ å…¥åˆ°å‡½æ•°å†…éƒ¨çš„ä½œç”¨åŸŸä¸­ï¼Œå¹¶ä¸”ä¸ä¼šå½±å“åˆ°å‡½æ•°å¤–éƒ¨çš„åŒåå˜é‡ï¼Œå¦‚ä¸‹ç¤ºä¾‹ï¼š #!/usr/bin/python3 total = 0 # è¿™æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡# å¯å†™å‡½æ•°è¯´æ˜def sum( arg1, arg2 ): #è¿”å›2ä¸ªå‚æ•°çš„å’Œ. total = arg1 + arg2 # totalåœ¨è¿™é‡Œæ˜¯å±€éƒ¨å˜é‡. print (å‡½æ•°å†…æ˜¯å±€éƒ¨å˜é‡ : , total) return total #è°ƒç”¨sumå‡½æ•°sum( 10, 20 )print (å‡½æ•°å¤–æ˜¯å…¨å±€å˜é‡ : , total) è¾“å‡ºç»“æœï¼š å‡½æ•°å†…æ˜¯å±€éƒ¨å˜é‡ : 30å‡½æ•°å¤–æ˜¯å…¨å±€å˜é‡ : 0 1ã€å…¨å±€å˜é‡ï¼šåœ¨å‡½æ•°å¤–éƒ¨å®šä¹‰çš„å˜é‡ï¼Œå¯ä»¥åœ¨æ•´ä¸ªæ–‡ä»¶ä¸­è¢«è®¿é—®ã€‚åœ¨å‡½æ•°å¤–éƒ¨å®šä¹‰çš„å˜é‡å¯¹æ‰€æœ‰å‡½æ•°éƒ½æ˜¯å¯è§çš„ï¼Œé™¤éå‡½æ•°å†…éƒ¨å®šä¹‰äº†åŒåçš„å±€éƒ¨å˜é‡ã€‚ x = 10 # å…¨å±€å˜é‡def my_function(): print(x) # å¯ä»¥è®¿é—®å…¨å±€å˜é‡ xmy_function() # è¾“å‡º 10 2ã€å±€éƒ¨å˜é‡ï¼šåœ¨å‡½æ•°å†…éƒ¨å®šä¹‰çš„å˜é‡ï¼Œä»…åœ¨å‡½æ•°å†…æœ‰æ•ˆï¼Œå‡½æ•°å¤–æ— æ³•è®¿é—®ã€‚å±€éƒ¨å˜é‡ä¼˜å…ˆçº§é«˜äºå…¨å±€å˜é‡ï¼Œå› æ­¤å¦‚æœå±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡åŒåï¼Œå‡½æ•°å†…éƒ¨ä¼šä½¿ç”¨å±€éƒ¨å˜é‡ã€‚ def my_function(): x = 5 # å±€éƒ¨å˜é‡ print(x) # è®¿é—®å±€éƒ¨å˜é‡ xmy_function() # è¾“å‡º 5print(x) # æŠ¥é”™: NameError: name x is not defined global å’Œ nonlocalå½“å†…éƒ¨ä½œç”¨åŸŸæƒ³ä¿®æ”¹å¤–éƒ¨ä½œç”¨åŸŸçš„å˜é‡æ—¶ï¼Œå°±è¦ç”¨åˆ° global å’Œ nonlocal å…³é”®å­—äº†ã€‚ ä»¥ä¸‹å®ä¾‹ä¿®æ”¹å…¨å±€å˜é‡ numï¼š #!/usr/bin/python3 num = 1def fun1(): global num # éœ€è¦ä½¿ç”¨ global å…³é”®å­—å£°æ˜ print(num) num = 123 print(num)fun1()print(num) è¾“å‡ºç»“æœï¼š 1123123 å¦‚æœè¦ä¿®æ”¹åµŒå¥—ä½œç”¨åŸŸï¼ˆenclosing ä½œç”¨åŸŸï¼Œå¤–å±‚éå…¨å±€ä½œç”¨åŸŸï¼‰ä¸­çš„å˜é‡åˆ™éœ€è¦ nonlocal å…³é”®å­—äº†ï¼Œå¦‚ä¸‹ç¤ºä¾‹ï¼š #!/usr/bin/python3 def outer(): num = 10 def inner(): nonlocal num # nonlocalå…³é”®å­—å£°æ˜ num = 100 print(num) inner() print(num)outer() è¾“å‡ºç»“æœï¼š 100100 å¦å¤–æœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå‡è®¾ä¸‹é¢è¿™æ®µä»£ç è¢«è¿è¡Œï¼š #!/usr/bin/python3 a = 10def test(): a = a + 1 print(a)test() Traceback (most recent call last):File â€œtest.pyâ€, line 7, in test()File â€œtest.pyâ€, line 5, in testa a + 1UnboundLocalError: local variable â€˜aâ€™ referenced before assignment é”™è¯¯ä¿¡æ¯ä¸ºå±€éƒ¨ä½œç”¨åŸŸå¼•ç”¨é”™è¯¯ï¼Œå› ä¸º test å‡½æ•°ä¸­çš„ a ä½¿ç”¨çš„æ˜¯å±€éƒ¨ï¼Œæœªå®šä¹‰ï¼Œæ— æ³•ä¿®æ”¹ã€‚ ä¿®æ”¹ a ä¸ºå…¨å±€å˜é‡ï¼š #!/usr/bin/python3 a = 10def test(): global a a = a + 1 print(a)test() # 11 ä¹Ÿå¯ä»¥é€šè¿‡å‡½æ•°å‚æ•°ä¼ é€’ï¼š #!/usr/bin/python3 a = 10def test(a): a = a + 1 print(a)test(a) # 11 æ€»ç»“: å…¨å±€å˜é‡ åœ¨å‡½æ•°å¤–éƒ¨å®šä¹‰ï¼Œå¯ä»¥åœ¨æ•´ä¸ªæ–‡ä»¶ä¸­è®¿é—®ã€‚ å±€éƒ¨å˜é‡ åœ¨å‡½æ•°å†…éƒ¨å®šä¹‰ï¼Œåªèƒ½åœ¨å‡½æ•°å†…è®¿é—®ã€‚ ä½¿ç”¨ global å¯ä»¥åœ¨å‡½æ•°ä¸­ä¿®æ”¹å…¨å±€å˜é‡ã€‚ ä½¿ç”¨ nonlocal å¯ä»¥åœ¨åµŒå¥—å‡½æ•°ä¸­ä¿®æ”¹å¤–éƒ¨å‡½æ•°çš„å˜é‡ã€‚","tags":[null],"categories":[null]},{"title":"PythonåŸºæœ¬æ•°æ®ç±»å‹","path":"/wiki/Python/åŸºæœ¬æ•°æ®ç±»å‹.html","content":"åŸºæœ¬æ•°æ®ç±»å‹Python ä¸­çš„å˜é‡ ä¸éœ€è¦å£°æ˜ã€‚æ¯ä¸ªå˜é‡åœ¨ ä½¿ç”¨å‰éƒ½å¿…é¡»èµ‹å€¼ï¼Œå˜é‡èµ‹å€¼ä»¥åè¯¥å˜é‡æ‰ä¼šè¢«åˆ›å»ºã€‚ åœ¨ Python ä¸­ï¼Œå˜é‡å°±æ˜¯å˜é‡ï¼Œå®ƒæ²¡æœ‰ç±»å‹ï¼Œæˆ‘ä»¬æ‰€è¯´çš„ â€œç±»å‹â€ æ˜¯å˜é‡æ‰€æŒ‡çš„ å†…å­˜ä¸­å¯¹è±¡çš„ç±»å‹ã€‚ ç­‰å·ï¼ˆï¼‰ç”¨æ¥ç»™å˜é‡èµ‹å€¼ã€‚ ç­‰å·ï¼ˆï¼‰è¿ç®—ç¬¦å·¦è¾¹æ˜¯ä¸€ä¸ªå˜é‡åï¼Œç­‰å·ï¼ˆï¼‰è¿ç®—ç¬¦å³è¾¹æ˜¯å­˜å‚¨åœ¨å˜é‡ä¸­çš„å€¼ã€‚ #!/usr/bin/python3 count = 100 # æ•´å½¢å˜é‡miles = 1.0 # æµ®ç‚¹å‹å˜é‡name = å¼ ä¸‰ # å­—ç¬¦ä¸²print(count, miles, name) å¤šä¸ªå˜é‡èµ‹å€¼Python å…è®¸ä½ åŒæ—¶ä¸ºå¤šä¸ªå˜é‡èµ‹å€¼ã€‚ä¾‹å¦‚ï¼š a = b = c = å¼ ä¸‰print(a, b, c) ä»¥ä¸Šå®ä¾‹ï¼Œåˆ›å»ºä¸€ä¸ªæ•´å‹å¯¹è±¡ï¼Œå€¼ä¸º â€˜â€™å¼ ä¸‰â€™â€™ï¼Œä»åå‘å‰èµ‹å€¼ï¼Œä¸‰ä¸ªå˜é‡è¢«èµ‹äºˆç›¸åŒçš„æ•°å€¼ã€‚ ä¹Ÿå¯ä»¥ä¸ºå¤šä¸ªå¯¹è±¡æŒ‡å®šå¤šä¸ªå˜é‡ã€‚ #!/usr/bin/python3 a,b,c = å¼ ä¸‰,1,2print(a) # å¼ ä¸‰print(b) # 1print(c) # 2a,b,c = å¼ ä¸‰,1 # è¿™ç§æƒ…å†µä¼šæŠ¥é”™ æ ‡å‡†æ•°æ®ç±»å‹Python3 ä¸­å¸¸è§çš„æ•°æ®ç±»å‹æœ‰ï¼š Numberï¼ˆæ•°å­—ï¼‰ int float bool complex Stringï¼ˆå­—ç¬¦ä¸²ï¼‰ boolï¼ˆå¸ƒå°”ç±»å‹ï¼‰ True False Listï¼ˆåˆ—è¡¨ï¼‰ Tupleï¼ˆå…ƒç»„ï¼‰ Setï¼ˆé›†åˆï¼‰ Dictionaryï¼ˆå­—å…¸ï¼‰ Python3 çš„å…­ä¸ªæ ‡å‡†æ•°æ®ç±»å‹ä¸­ï¼š ä¸å¯å˜æ•°æ®ï¼ˆ3 ä¸ªï¼‰ï¼š Numberï¼ˆæ•°å­—ï¼‰ã€Stringï¼ˆå­—ç¬¦ä¸²ï¼‰ã€Tupleï¼ˆå…ƒç»„ï¼‰ï¼› å¯å˜æ•°æ®ï¼ˆ3 ä¸ªï¼‰ï¼š Listï¼ˆåˆ—è¡¨ï¼‰ã€Dictionaryï¼ˆå­—å…¸ï¼‰ã€Setï¼ˆé›†åˆï¼‰ã€‚ æ­¤å¤–è¿˜æœ‰ä¸€äº›é«˜çº§çš„æ•°æ®ç±»å‹ï¼Œå¦‚: å­—èŠ‚æ•°ç»„ç±»å‹(bytes)ã€‚ NumberNumber åŸºç¡€Python3 æ”¯æŒ intã€floatã€boolã€complexï¼ˆå¤æ•°ï¼‰ã€‚ åœ¨ Python 3 é‡Œï¼Œåªæœ‰ä¸€ç§æ•´æ•°ç±»å‹ intï¼Œè¡¨ç¤ºä¸ºé•¿æ•´å‹ï¼Œæ²¡æœ‰ python2 ä¸­çš„ Longã€‚ æ•°æ®ç±»å‹æ˜¯ä¸å…è®¸æ”¹å˜çš„ï¼Œè¿™å°±æ„å‘³ç€å¦‚æœæ”¹å˜æ•°å­—æ•°æ®ç±»å‹çš„å€¼ï¼Œå°†é‡æ–°åˆ†é…å†…å­˜ç©ºé—´ã€‚ åƒå¤§å¤šæ•°è¯­è¨€ä¸€æ ·ï¼Œæ•°å€¼ç±»å‹çš„èµ‹å€¼å’Œè®¡ç®—éƒ½æ˜¯å¾ˆç›´è§‚çš„ã€‚ å†…ç½®çš„ type() å‡½æ•°å¯ä»¥ç”¨æ¥æŸ¥è¯¢å˜é‡æ‰€æŒ‡çš„å¯¹è±¡ç±»å‹ã€‚ a,b,c,d=20,5.5,True,4+3j # j åœ¨ Python ä¸­è¡¨ç¤ºè™šæ•°å•ä½ï¼Œç”¨äºå®šä¹‰å¤æ•°# å¤æ•°ç”±å®æ•°éƒ¨åˆ†å’Œè™šæ•°éƒ¨åˆ†æ„æˆï¼Œå¯ä»¥ç”¨ a + bjï¼Œæˆ–è€… complex(a,b) è¡¨ç¤ºï¼Œ å¤æ•°çš„å®éƒ¨ a å’Œè™šéƒ¨ b éƒ½æ˜¯æµ®ç‚¹å‹ã€‚ print(type(a),type(b),type(c),type(d))class int class float class bool class complex æ­¤å¤–è¿˜å¯ä»¥ç”¨ isinstance æ¥åˆ¤æ–­ï¼š a = 111 isinstance(a, int)True isinstance å’Œ type çš„åŒºåˆ«åœ¨äºï¼š type()ä¸ä¼šè®¤ä¸ºå­ç±»æ˜¯ä¸€ç§çˆ¶ç±»ç±»å‹ã€‚ isinstance()ä¼šè®¤ä¸ºå­ç±»æ˜¯ä¸€ç§çˆ¶ç±»ç±»å‹ã€‚ class A:... pass... class B(A):... pass... isinstance(A(), A)True type(A()) == A True isinstance(B(), A)True type(B()) == AFalse A æ˜¯ä¸€ä¸ªåŸºç±»ã€‚ B ç»§æ‰¿è‡ª Aï¼Œå³ B æ˜¯ A çš„å­ç±»ã€‚ æ³¨æ„ï¼š Python3 ä¸­ï¼Œbool æ˜¯ int çš„å­ç±»ï¼ŒTrue å’Œ False å¯ä»¥å’Œæ•°å­—ç›¸åŠ ï¼ŒTrue 1ã€False 0 ä¼šè¿”å› Trueï¼Œä½†å¯ä»¥é€šè¿‡ is æ¥åˆ¤æ–­ç±»å‹ã€‚ issubclass(bool, int) True True==1True False==0True True+12 False+11 1 is TrueFalse 0 is FalseFalse bool ç»§æ‰¿è‡ª intï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç±»å‹ã€‚ True == 1 å’Œ False == 0 ç»“æœä¸º Trueï¼Œå› ä¸ºå®ƒä»¬çš„å€¼ç›¸ç­‰ã€‚ True is 1 ç»“æœä¸º Falseï¼Œå› ä¸º is æ¯”è¾ƒçš„æ˜¯å¯¹è±¡èº«ä»½ï¼Œè€Œå®ƒä»¬çš„ç±»å‹ä¸åŒ åœ¨ Python2 ä¸­æ˜¯æ²¡æœ‰å¸ƒå°”å‹çš„ï¼Œå®ƒç”¨æ•°å­— 0 è¡¨ç¤º Falseï¼Œç”¨ 1 è¡¨ç¤º Trueã€‚ å½“æŒ‡å®šä¸€ä¸ªå€¼æ—¶ï¼ŒNumber å¯¹è±¡å°±ä¼šè¢«åˆ›å»ºï¼š a = 1b = 2.2 æ•°å€¼è¿ç®—ï¼š 5 + 4 # åŠ æ³•9 4.3 - 2 # å‡æ³•2.3 3 * 7 # ä¹˜æ³•21 2 / 4 # é™¤æ³•ï¼Œå¾—åˆ°ä¸€ä¸ªæµ®ç‚¹æ•°0.5 2 // 4 # é™¤æ³•ï¼Œå¾—åˆ°ä¸€ä¸ªæ•´æ•°0 17 % 3 # å–ä½™ 2 2 ** 5 # ä¹˜æ–¹32 1ã€Python å¯ä»¥åŒæ—¶ä¸ºå¤šä¸ªå˜é‡èµ‹å€¼ï¼Œå¦‚ a, b 1, 2ã€‚2ã€ä¸€ä¸ªå˜é‡å¯ä»¥é€šè¿‡èµ‹å€¼æŒ‡å‘ä¸åŒç±»å‹çš„å¯¹è±¡ã€‚3ã€æ•°å€¼çš„é™¤æ³•åŒ…å«ä¸¤ä¸ªè¿ç®—ç¬¦ï¼š**** è¿”å›ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œ**** è¿”å›ä¸€ä¸ªæ•´æ•°ã€‚4ã€åœ¨æ··åˆè®¡ç®—æ—¶ï¼ŒPython ä¼šæŠŠæ•´å‹è½¬æ¢æˆä¸ºæµ®ç‚¹æ•°ã€‚ å¸¸ç”¨å‡½æ•°æ•°å­¦å‡½æ•° å‡½æ•° è¿”å›å€¼ ( æè¿° ) abs(x) è¿”å›æ•°å­—çš„ç»å¯¹å€¼ï¼Œå¦‚ abs(-10) è¿”å› 10 ceil(x) è¿”å›æ•°å­—çš„ä¸Šå…¥æ•´æ•°ï¼Œå¦‚ math.ceil(4.1) è¿”å› 5 cmp(x, y) å¦‚æœ x y è¿”å› -1, å¦‚æœ x y è¿”å› 0, å¦‚æœ x y è¿”å› 1ã€‚ Python 3 å·²åºŸå¼ƒï¼Œä½¿ç”¨ (x y)-(x y) æ›¿æ¢ã€‚ exp(x) è¿”å› e çš„ x æ¬¡å¹‚(ex), å¦‚ math.exp(1) è¿”å› 2.718281828459045 fabs(x) ä»¥æµ®ç‚¹æ•°å½¢å¼è¿”å›æ•°å­—çš„ç»å¯¹å€¼ï¼Œå¦‚ math.fabs(-10) è¿”å› 10.0 floor(x) è¿”å›æ•°å­—çš„ä¸‹èˆæ•´æ•°ï¼Œå¦‚ math.floor(4.9)è¿”å› 4 log(x) å¦‚ math.log(math.e)è¿”å› 1.0, math.log(100,10)è¿”å› 2.0 log10(x) è¿”å›ä»¥ 10 ä¸ºåŸºæ•°çš„ x çš„å¯¹æ•°ï¼Œå¦‚ math.log10(100)è¿”å› 2.0 max(x1, x2,â€¦) è¿”å›ç»™å®šå‚æ•°çš„æœ€å¤§å€¼ï¼Œå‚æ•°å¯ä»¥ä¸ºåºåˆ—ã€‚ min(x1, x2,â€¦) è¿”å›ç»™å®šå‚æ•°çš„æœ€å°å€¼ï¼Œå‚æ•°å¯ä»¥ä¸ºåºåˆ—ã€‚ modf(x) è¿”å› x çš„æ•´æ•°éƒ¨åˆ†ä¸å°æ•°éƒ¨åˆ†ï¼Œä¸¤éƒ¨åˆ†çš„æ•°å€¼ç¬¦å·ä¸ x ç›¸åŒï¼Œæ•´æ•°éƒ¨åˆ†ä»¥æµ®ç‚¹å‹è¡¨ç¤ºã€‚ pow(x, y) x**y è¿ç®—åçš„å€¼ã€‚ [round(x , n]) è¿”å›æµ®ç‚¹æ•° x çš„å››èˆäº”å…¥å€¼ï¼Œå¦‚ç»™å‡º n å€¼ï¼Œåˆ™ä»£è¡¨èˆå…¥åˆ°å°æ•°ç‚¹åçš„ä½æ•°ã€‚å…¶å®å‡†ç¡®çš„è¯´æ˜¯ä¿ç•™å€¼å°†ä¿ç•™åˆ°ç¦»ä¸Šä¸€ä½æ›´è¿‘çš„ä¸€ç«¯ã€‚ sqrt(x) è¿”å›æ•°å­— x çš„å¹³æ–¹æ ¹ã€‚ éšæœºæ•°å‡½æ•°éšæœºæ•°å¯ä»¥ç”¨äºæ•°å­¦ï¼Œæ¸¸æˆï¼Œå®‰å…¨ç­‰é¢†åŸŸä¸­ï¼Œè¿˜ç»å¸¸è¢«åµŒå…¥åˆ°ç®—æ³•ä¸­ï¼Œç”¨ä»¥æé«˜ç®—æ³•æ•ˆç‡ï¼Œå¹¶æé«˜ç¨‹åºçš„å®‰å…¨æ€§ã€‚ Python åŒ…å«ä»¥ä¸‹å¸¸ç”¨éšæœºæ•°å‡½æ•°ï¼š å‡½æ•° æè¿° choice(seq) ä»åºåˆ—çš„å…ƒç´ ä¸­éšæœºæŒ‘é€‰ä¸€ä¸ªå…ƒç´ ï¼Œæ¯”å¦‚ random.choice(range(10))ï¼Œä» 0 åˆ° 9 ä¸­éšæœºæŒ‘é€‰ä¸€ä¸ªæ•´æ•°ã€‚ [randrange (start,] stop [, step]) ä»æŒ‡å®šèŒƒå›´å†…ï¼ŒæŒ‰æŒ‡å®šåŸºæ•°é€’å¢çš„é›†åˆä¸­è·å–ä¸€ä¸ªéšæœºæ•°ï¼ŒåŸºæ•°é»˜è®¤å€¼ä¸º 1 random() éšæœºç”Ÿæˆä¸‹ä¸€ä¸ªå®æ•°ï¼Œå®ƒåœ¨[0,1)èŒƒå›´å†…ã€‚ [seed(x]) æ”¹å˜éšæœºæ•°ç”Ÿæˆå™¨çš„ç§å­ seedã€‚å¦‚æœä½ ä¸äº†è§£å…¶åŸç†ï¼Œä½ ä¸å¿…ç‰¹åˆ«å»è®¾å®š seedï¼ŒPython ä¼šå¸®ä½ é€‰æ‹© seedã€‚ shuffle(lst) å°†åºåˆ—çš„æ‰€æœ‰å…ƒç´ éšæœºæ’åº uniform(x, y) éšæœºç”Ÿæˆä¸‹ä¸€ä¸ªå®æ•°ï¼Œå®ƒåœ¨ [x, y] èŒƒå›´å†…ã€‚ ä¸‰è§’å‡½æ•°Python åŒ…æ‹¬ä»¥ä¸‹ä¸‰è§’å‡½æ•°ï¼š å‡½æ•° æè¿° acos(x) è¿”å› x çš„åä½™å¼¦å¼§åº¦å€¼ã€‚ asin(x) è¿”å› x çš„åæ­£å¼¦å¼§åº¦å€¼ã€‚ atan(x) è¿”å› x çš„åæ­£åˆ‡å¼§åº¦å€¼ã€‚ atan2(y, x) è¿”å›ç»™å®šçš„ X åŠ Y åæ ‡å€¼çš„åæ­£åˆ‡å€¼ã€‚ cos(x) è¿”å› x çš„å¼§åº¦çš„ä½™å¼¦å€¼ã€‚ hypot(x, y) è¿”å›æ¬§å‡ é‡Œå¾·èŒƒæ•° sqrt(x x + y y)ã€‚ sin(x) è¿”å›çš„ x å¼§åº¦çš„æ­£å¼¦å€¼ã€‚ tan(x) è¿”å› x å¼§åº¦çš„æ­£åˆ‡å€¼ã€‚ degrees(x) å°†å¼§åº¦è½¬æ¢ä¸ºè§’åº¦, å¦‚ degrees(math.pi2) ï¼Œ è¿”å› 90.0 radians(x) å°†è§’åº¦è½¬æ¢ä¸ºå¼§åº¦ æ•°å­¦å¸¸é‡ å¸¸é‡ æè¿° pi æ•°å­¦å¸¸é‡ piï¼ˆåœ†å‘¨ç‡ï¼Œä¸€èˆ¬ä»¥ Ï€ æ¥è¡¨ç¤ºï¼‰ e æ•°å­¦å¸¸é‡ eï¼Œe å³è‡ªç„¶å¸¸æ•°ï¼ˆè‡ªç„¶å¸¸æ•°ï¼‰ã€‚ StringString åŸºç¡€Python ä¸­çš„å­—ç¬¦ä¸²ç”¨å•å¼•å· â€˜ æˆ–åŒå¼•å· â€œ æ‹¬èµ·æ¥ï¼ŒåŒæ—¶ä½¿ç”¨åæ–œæ  \\ è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ã€‚ å­—ç¬¦ä¸²çš„æˆªå–çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š å˜é‡[å¤´ä¸‹æ ‡:å°¾ä¸‹æ ‡] ç´¢å¼•å€¼ä»¥ 0 ä¸ºå¼€å§‹å€¼ï¼Œ-1 ä¸ºä»æœ«å°¾çš„å¼€å§‹ä½ç½®ã€‚ [å¤´ä¸‹æ ‡:å°¾ä¸‹æ ‡] è·å–çš„å­å­—ç¬¦ä¸²åŒ…å«å¤´ä¸‹æ ‡çš„å­—ç¬¦ï¼Œä½†ä¸åŒ…å«å°¾ä¸‹æ ‡çš„å­—ç¬¦ã€‚ + æ˜¯å­—ç¬¦ä¸²çš„è¿æ¥ç¬¦ï¼Œ * è¡¨ç¤ºå¤åˆ¶å½“å‰å­—ç¬¦ä¸²ï¼Œä¸ä¹‹ç»“åˆçš„æ•°å­—ä¸ºå¤åˆ¶çš„æ¬¡æ•°ã€‚ #!/usr/bin/python3str = Runoob # å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡print(str) # æ‰“å°æ•´ä¸ªå­—ç¬¦ä¸² Runoobprint(str[0:-1]) # æ‰“å°å­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªåˆ°å€’æ•°ç¬¬äºŒä¸ªå­—ç¬¦ï¼ˆä¸åŒ…å«å€’æ•°ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼‰Runooprint(str[0]) # æ‰“å°å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ Rprint(str[2:5]) # æ‰“å°å­—ç¬¦ä¸²ç¬¬ä¸‰åˆ°ç¬¬äº”ä¸ªå­—ç¬¦ï¼ˆåŒ…å«ç¬¬äº”ä¸ªå­—ç¬¦ï¼‰nooprint(str[2:]) # æ‰“å°å­—ç¬¦ä¸²ä»ç¬¬ä¸‰ä¸ªå­—ç¬¦å¼€å§‹åˆ°æœ«å°¾ noobprint(str * 2) # æ‰“å°å­—ç¬¦ä¸²ä¸¤æ¬¡ RunoobRunoobprint(str + TEST) # æ‰“å°å­—ç¬¦ä¸²å’ŒTESTæ‹¼æ¥åœ¨ä¸€èµ· RunoobTEST Python ä½¿ç”¨åæ–œæ  \\ è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚æœä½ ä¸æƒ³è®©åæ–œæ å‘ç”Ÿè½¬ä¹‰ï¼Œå¯ä»¥åœ¨å­—ç¬¦ä¸²å‰é¢æ·»åŠ ä¸€ä¸ª rï¼Œè¡¨ç¤ºåŸå§‹å­—ç¬¦ä¸²ï¼š print(hel lo)hello print(rhel lo)hel lo å¦å¤–ï¼Œ\\å¯ä»¥ä½œä¸ºç»­è¡Œç¬¦ï¼Œè¡¨ç¤ºä¸‹ä¸€è¡Œæ˜¯ä¸Šä¸€è¡Œçš„å»¶ç»­ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ ... æˆ–è€… ... è·¨è¶Šå¤šè¡Œã€‚ æ³¨æ„ï¼ŒPython æ²¡æœ‰å•ç‹¬çš„å­—ç¬¦ç±»å‹ï¼Œä¸€ä¸ªå­—ç¬¦å°±æ˜¯é•¿åº¦ä¸º 1 çš„å­—ç¬¦ä¸²ã€‚ str = å¼ ä¸‰ print(str[1])ä¸‰ print(str[0])å¼  print(str[3]) Python å­—ç¬¦ä¸²ä¸èƒ½è¢«æ”¹å˜ã€‚å‘ä¸€ä¸ªç´¢å¼•ä½ç½®èµ‹å€¼ï¼Œæ¯”å¦‚ word [0] â€˜mâ€™ ä¼šå¯¼è‡´é”™è¯¯ã€‚ str[0] = æTraceback (most recent call last): File python-input-40, line 1, in module str[0] = æ ~~~^^^TypeError: str object does not support item assignment 1ã€åæ–œæ å¯ä»¥ç”¨æ¥è½¬ä¹‰ï¼Œä½¿ç”¨ r å¯ä»¥è®©åæ–œæ ä¸å‘ç”Ÿè½¬ä¹‰ã€‚2ã€å­—ç¬¦ä¸²å¯ä»¥ç”¨ + è¿ç®—ç¬¦è¿æ¥åœ¨ä¸€èµ·ï¼Œç”¨ * è¿ç®—ç¬¦é‡å¤ã€‚3ã€Python ä¸­çš„å­—ç¬¦ä¸²æœ‰ä¸¤ç§ç´¢å¼•æ–¹å¼ï¼Œä»å·¦å¾€å³ä»¥ 0 å¼€å§‹ï¼Œä»å³å¾€å·¦ä»¥ -1 å¼€å§‹ã€‚4ã€Python ä¸­çš„å­—ç¬¦ä¸² ä¸èƒ½æ”¹å˜ã€‚ inter æœºåˆ¶æ¯ä¸ªï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œä¸å¤¹æ‚ç©ºæ ¼æˆ–è€…ç‰¹æ®Šç¬¦å·ï¼Œé»˜è®¤å¼€å¯internæœºåˆ¶ï¼Œå…±äº«å†…å­˜ï¼Œé å¼•ç”¨è®¡æ•°å†³å®šæ˜¯å¦é”€æ¯ã€‚ç›¸åŒçš„å­—ç¬¦ä¸²é»˜è®¤åªä¿ç•™ä¸€ä»½ï¼Œå½“åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒä¼šå…ˆæ£€æŸ¥å†…å­˜é‡Œæœ‰æ²¡æœ‰è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœæœ‰å°±ä¸å†åˆ›å»ºæ–°çš„äº†ã€‚ å­—ç¬¦ä¸²ç¼“å†²æ± å•ä¸ªå­—æ¯ï¼Œé•¿åº¦ä¸º 1 çš„ ASCII å­—ç¬¦ä¼šè¢« interned åŒ…æ‹¬ç©ºå­—ç¬¦ã€‚ Python è½¬ä¹‰å­—ç¬¦åœ¨éœ€è¦åœ¨å­—ç¬¦ä¸­ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦æ—¶ï¼ŒPython ç”¨åæ–œæ  \\ è½¬ä¹‰å­—ç¬¦ã€‚å¦‚ä¸‹è¡¨ï¼š è½¬ä¹‰å­—ç¬¦ æè¿° å®ä¾‹ (åœ¨è¡Œå°¾æ—¶) ç»­è¡Œç¬¦ print(line1 \\ line2 \\ line3) line1 line2 line3 \\ åæ–œæ ç¬¦å· print(\\\\) \\ å•å¼•å· print(\\) åŒå¼•å· print(\\) \\a å“é“ƒ print(\\a) æ‰§è¡Œåç”µè„‘æœ‰å“å£°ã€‚ \\b é€€æ ¼(Backspace) print(Hello \\b World!) Hello World! \\000 ç©º print(\\000) æ¢è¡Œ print( ) \\v çºµå‘åˆ¶è¡¨ç¬¦ print(Hello \\v World!) Hello World! \\t æ¨ªå‘åˆ¶è¡¨ç¬¦ print(Hello \\t World!) Hello World! \\r å›è½¦ï¼Œå°† \\r åé¢çš„å†…å®¹ç§»åˆ°å­—ç¬¦ä¸²å¼€å¤´ï¼Œå¹¶é€ä¸€æ›¿æ¢å¼€å¤´éƒ¨åˆ†çš„å­—ç¬¦ï¼Œç›´è‡³å°† \\r åé¢çš„å†…å®¹å®Œå…¨æ›¿æ¢å®Œæˆã€‚ print(Hello\\rWorld!) World! print(google runoob taobao\\r123456) 123456 runoob taobao \\f æ¢é¡µ print(Hello \\f World!) Hello World! \\yyy å…«è¿›åˆ¶æ•°ï¼Œy ä»£è¡¨ 0~7 çš„å­—ç¬¦ï¼Œä¾‹å¦‚ï¼š\\012 ä»£è¡¨æ¢è¡Œã€‚ print(\\110\\145\\154\\154\\157\\40\\127\\157\\162\\154\\144\\41) Hello World! \\xyy åå…­è¿›åˆ¶æ•°ï¼Œä»¥ \\x å¼€å¤´ï¼Œy ä»£è¡¨çš„å­—ç¬¦ï¼Œä¾‹å¦‚ï¼š\\x0a ä»£è¡¨æ¢è¡Œ print(\\x48\\x65\\x6c\\x6c\\x6f\\x20\\x57\\x6f\\x72\\x6c\\x64\\x21) Hello World! \\other å…¶å®ƒçš„å­—ç¬¦ä»¥æ™®é€šæ ¼å¼è¾“å‡º Python å­—ç¬¦ä¸²è¿ç®—ç¬¦ä¸‹è¡¨å®ä¾‹å˜é‡ a å€¼ä¸ºå­—ç¬¦ä¸² â€œHelloâ€ï¼Œb å˜é‡å€¼ä¸º â€œPythonâ€ï¼š æ“ä½œç¬¦ æè¿° å®ä¾‹ + å­—ç¬¦ä¸²è¿æ¥ a + b è¾“å‡ºç»“æœï¼š HelloPython * é‡å¤è¾“å‡ºå­—ç¬¦ä¸² a* 2 è¾“å‡ºç»“æœï¼šHelloHello [] é€šè¿‡ç´¢å¼•è·å–å­—ç¬¦ä¸²ä¸­å­—ç¬¦ a [1] è¾“å‡ºç»“æœ e [ : ] æˆªå–å­—ç¬¦ä¸²ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œéµå¾ª å·¦é—­å³å¼€ åŸåˆ™ï¼Œstr [0:2] æ˜¯ä¸åŒ…å«ç¬¬ 3 ä¸ªå­—ç¬¦çš„ã€‚ a [1:4] è¾“å‡ºç»“æœ ell in æˆå‘˜è¿ç®—ç¬¦ - å¦‚æœå­—ç¬¦ä¸²ä¸­åŒ…å«ç»™å®šçš„å­—ç¬¦è¿”å› True â€˜Hâ€™ in a è¾“å‡ºç»“æœ True not in æˆå‘˜è¿ç®—ç¬¦ - å¦‚æœå­—ç¬¦ä¸²ä¸­ä¸åŒ…å«ç»™å®šçš„å­—ç¬¦è¿”å› True â€˜Mâ€™ not in a è¾“å‡ºç»“æœ True rR åŸå§‹å­—ç¬¦ä¸² - åŸå§‹å­—ç¬¦ä¸²ï¼šæ‰€æœ‰çš„å­—ç¬¦ä¸²éƒ½æ˜¯ç›´æ¥æŒ‰ç…§å­—é¢çš„æ„æ€æ¥ä½¿ç”¨ï¼Œæ²¡æœ‰è½¬ä¹‰ç‰¹æ®Šæˆ–ä¸èƒ½æ‰“å°çš„å­—ç¬¦ã€‚ åŸå§‹å­—ç¬¦ä¸²é™¤åœ¨å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå¼•å·å‰åŠ ä¸Šå­—æ¯ rï¼ˆå¯ä»¥å¤§å°å†™ï¼‰ä»¥å¤–ï¼Œä¸æ™®é€šå­—ç¬¦ä¸²æœ‰ç€å‡ ä¹å®Œå…¨ç›¸åŒçš„è¯­æ³•ã€‚ print( r ) print( R ) % æ ¼å¼å­—ç¬¦ä¸² #!/usr/bin/python3 a = Hellob = Python print(a + b è¾“å‡ºç»“æœï¼š, a + b)print(a * 2 è¾“å‡ºç»“æœï¼š, a * 2)print(a[1] è¾“å‡ºç»“æœï¼š, a[1])print(a[1:4] è¾“å‡ºç»“æœï¼š, a[1:4]) if( H in a) : print(H åœ¨å˜é‡ a ä¸­)else : print(H ä¸åœ¨å˜é‡ a ä¸­) if( M not in a) : print(M ä¸åœ¨å˜é‡ a ä¸­)else : print(M åœ¨å˜é‡ a ä¸­) print (r )print (R ) ä»¥ä¸Šå®ä¾‹è¾“å‡ºç»“æœä¸ºï¼š a + b è¾“å‡ºç»“æœï¼š HelloPythona * 2 è¾“å‡ºç»“æœï¼š HelloHelloa[1] è¾“å‡ºç»“æœï¼š ea[1:4] è¾“å‡ºç»“æœï¼š ellH åœ¨å˜é‡ a ä¸­M ä¸åœ¨å˜é‡ a ä¸­ Python å­—ç¬¦ä¸²æ ¼å¼åŒ–Python æ”¯æŒæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„è¾“å‡º ã€‚å°½ç®¡è¿™æ ·å¯èƒ½ä¼šç”¨åˆ°éå¸¸å¤æ‚çš„è¡¨è¾¾å¼ï¼Œä½†æœ€åŸºæœ¬çš„ç”¨æ³•æ˜¯å°†ä¸€ä¸ªå€¼æ’å…¥åˆ°ä¸€ä¸ªæœ‰å­—ç¬¦ä¸²æ ¼å¼ç¬¦ %s çš„å­—ç¬¦ä¸²ä¸­ã€‚ åœ¨ Python ä¸­ï¼Œå­—ç¬¦ä¸²æ ¼å¼åŒ–ä½¿ç”¨ä¸ C ä¸­ sprintf å‡½æ•°ä¸€æ ·çš„è¯­æ³•ã€‚ #!/usr/bin/python3 print (æˆ‘å« %s ä»Šå¹´ %d å²! % (å°æ˜, 10))# æˆ‘å« å°æ˜ ä»Šå¹´ 10 å²ï¼ Python å­—ç¬¦ä¸²æ ¼å¼åŒ–ç¬¦å·: ç¬¦ å· æè¿° %c æ ¼å¼åŒ–å­—ç¬¦åŠå…¶ ASCII ç  %s æ ¼å¼åŒ–å­—ç¬¦ä¸² %d æ ¼å¼åŒ–æ•´æ•° %u æ ¼å¼åŒ–æ— ç¬¦å·æ•´å‹ %o æ ¼å¼åŒ–æ— ç¬¦å·å…«è¿›åˆ¶æ•° %x æ ¼å¼åŒ–æ— ç¬¦å·åå…­è¿›åˆ¶æ•° %X æ ¼å¼åŒ–æ— ç¬¦å·åå…­è¿›åˆ¶æ•°ï¼ˆå¤§å†™ï¼‰ %f æ ¼å¼åŒ–æµ®ç‚¹æ•°å­—ï¼Œå¯æŒ‡å®šå°æ•°ç‚¹åçš„ç²¾åº¦ %e ç”¨ç§‘å­¦è®¡æ•°æ³•æ ¼å¼åŒ–æµ®ç‚¹æ•° %E ä½œç”¨åŒ%eï¼Œç”¨ç§‘å­¦è®¡æ•°æ³•æ ¼å¼åŒ–æµ®ç‚¹æ•° %g %f å’Œ%e çš„ç®€å†™ %G %f å’Œ %E çš„ç®€å†™ %p ç”¨åå…­è¿›åˆ¶æ•°æ ¼å¼åŒ–å˜é‡çš„åœ°å€ æ ¼å¼åŒ–æ“ä½œç¬¦è¾…åŠ©æŒ‡ä»¤: ç¬¦å· åŠŸèƒ½ * å®šä¹‰å®½åº¦æˆ–è€…å°æ•°ç‚¹ç²¾åº¦ - ç”¨åšå·¦å¯¹é½ + åœ¨æ­£æ•°å‰é¢æ˜¾ç¤ºåŠ å·( + ) sp åœ¨æ­£æ•°å‰é¢æ˜¾ç¤ºç©ºæ ¼ # åœ¨å…«è¿›åˆ¶æ•°å‰é¢æ˜¾ç¤ºé›¶(â€˜0â€™)ï¼Œåœ¨åå…­è¿›åˆ¶å‰é¢æ˜¾ç¤ºâ€™0xâ€™æˆ–è€…â€™0Xâ€™(å–å†³äºç”¨çš„æ˜¯â€™xâ€™è¿˜æ˜¯â€™Xâ€™) 0 æ˜¾ç¤ºçš„æ•°å­—å‰é¢å¡«å……â€™0â€™è€Œä¸æ˜¯é»˜è®¤çš„ç©ºæ ¼ % â€˜%%â€™è¾“å‡ºä¸€ä¸ªå•ä¸€çš„â€™%â€™ (var) æ˜ å°„å˜é‡(å­—å…¸å‚æ•°) m.n. m æ˜¯æ˜¾ç¤ºçš„æœ€å°æ€»å®½åº¦, n æ˜¯å°æ•°ç‚¹åçš„ä½æ•°(å¦‚æœå¯ç”¨çš„è¯) Python2.6 å¼€å§‹ï¼Œæ–°å¢äº†ä¸€ç§æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„å‡½æ•° str.format()ï¼Œå®ƒå¢å¼ºäº†å­—ç¬¦ä¸²æ ¼å¼åŒ–çš„åŠŸèƒ½ã€‚ Python ä¸‰å¼•å·Python ä¸‰å¼•å·å…è®¸ä¸€ä¸ªå­—ç¬¦ä¸²è·¨å¤šè¡Œï¼Œå­—ç¬¦ä¸²ä¸­å¯ä»¥åŒ…å«æ¢è¡Œç¬¦ã€åˆ¶è¡¨ç¬¦ä»¥åŠå…¶ä»–ç‰¹æ®Šå­—ç¬¦ã€‚ #!/usr/bin/python3 para_str = è¿™æ˜¯ä¸€ä¸ªå¤šè¡Œå­—ç¬¦ä¸²çš„å®ä¾‹å¤šè¡Œå­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨åˆ¶è¡¨ç¬¦TAB ( \\t )ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨æ¢è¡Œç¬¦ [ ]ã€‚print (para_str) è¿™æ˜¯ä¸€ä¸ªå¤šè¡Œå­—ç¬¦ä¸²çš„å®ä¾‹å¤šè¡Œå­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨åˆ¶è¡¨ç¬¦TAB ( )ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨æ¢è¡Œç¬¦ [ ]ã€‚ ä¸‰å¼•å·è®©ç¨‹åºå‘˜ä»å¼•å·å’Œç‰¹æ®Šå­—ç¬¦ä¸²çš„æ³¥æ½­é‡Œé¢è§£è„±å‡ºæ¥ï¼Œè‡ªå§‹è‡³ç»ˆä¿æŒä¸€å°å—å­—ç¬¦ä¸²çš„æ ¼å¼æ˜¯æ‰€è°“çš„ WYSIWYGï¼ˆæ‰€è§å³æ‰€å¾—ï¼‰æ ¼å¼çš„ã€‚ ä¸€ä¸ªå…¸å‹çš„ç”¨ä¾‹æ˜¯ï¼Œå½“ä½ éœ€è¦ä¸€å— HTML æˆ–è€… SQL æ—¶ï¼Œè¿™æ—¶ç”¨å­—ç¬¦ä¸²ç»„åˆï¼Œç‰¹æ®Šå­—ç¬¦ä¸²è½¬ä¹‰å°†ä¼šéå¸¸çš„ç¹çã€‚ errHTML = HTMLHEADTITLEFriends CGI Demo/TITLE/HEADBODYH3ERROR/H3B%s/BPFORMINPUT TYPE=button VALUE=BackONCLICK=window.history.back()/FORM/BODY/HTMLcursor.execute(CREATE TABLE users ( login VARCHAR(8), uid INTEGER,prid INTEGER)) f-stringf-string æ˜¯ python3.6 ä¹‹åç‰ˆæœ¬æ·»åŠ çš„ï¼Œç§°ä¹‹ä¸ºå­—é¢é‡æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæ˜¯æ–°çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„è¯­æ³•ã€‚ ä¹‹å‰æˆ‘ä»¬ä¹ æƒ¯ç”¨ç™¾åˆ†å· (%): name = Runoob Hello %s % nameHello Runoob f-string æ ¼å¼åŒ–å­—ç¬¦ä¸²ä»¥ f å¼€å¤´ï¼Œåé¢è·Ÿç€å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²ä¸­çš„è¡¨è¾¾å¼ç”¨å¤§æ‹¬å· {} åŒ…èµ·æ¥ï¼Œå®ƒä¼šå°†å˜é‡æˆ–è¡¨è¾¾å¼è®¡ç®—åçš„å€¼æ›¿æ¢è¿›å»ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š name = Runoob fHello name # æ›¿æ¢å˜é‡Hello Runoob f1+2 # ä½¿ç”¨è¡¨è¾¾å¼3 w = name: Runoob, url: www.runoob.com fw[name]: w[url]Runoob: www.runoob.com ç”¨äº†è¿™ç§æ–¹å¼æ˜æ˜¾æ›´ç®€å•äº†ï¼Œä¸ç”¨å†å»åˆ¤æ–­ä½¿ç”¨ %sï¼Œè¿˜æ˜¯ %dã€‚ åœ¨ Python 3.8 çš„ç‰ˆæœ¬ä¸­å¯ä»¥ä½¿ç”¨ ç¬¦å·æ¥æ‹¼æ¥è¿ç®—è¡¨è¾¾å¼ä¸ç»“æœã€‚ x = 1 print(fx+1) # Python 3.62 x = 1 print(fx+1=) # Python 3.8x+1=2 Unicode å­—ç¬¦ä¸²åœ¨ Python2 ä¸­ï¼Œæ™®é€šå­—ç¬¦ä¸²æ˜¯ä»¥ 8 ä½ ASCII ç è¿›è¡Œå­˜å‚¨çš„ï¼Œè€Œ Unicode å­—ç¬¦ä¸²åˆ™å­˜å‚¨ä¸º 16 ä½ unicode å­—ç¬¦ä¸²ï¼Œè¿™æ ·èƒ½å¤Ÿè¡¨ç¤ºæ›´å¤šçš„å­—ç¬¦é›†ã€‚ä½¿ç”¨çš„è¯­æ³•æ˜¯åœ¨å­—ç¬¦ä¸²å‰é¢åŠ ä¸Šå‰ç¼€ uã€‚ åœ¨ Python3 ä¸­ï¼Œæ‰€æœ‰çš„å­—ç¬¦ä¸²éƒ½æ˜¯ Unicode å­—ç¬¦ä¸²ã€‚ å­—ç¬¦ä¸²å†…å»ºå‡½æ•°Python çš„å­—ç¬¦ä¸²å¸¸ç”¨å†…å»ºå‡½æ•°å¦‚ä¸‹ï¼š åºå· æ–¹æ³•åŠæè¿° 1 capitalize() å°†å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦è½¬æ¢ä¸ºå¤§å†™ 2 center(width, fillchar) è¿”å›ä¸€ä¸ªæŒ‡å®šçš„å®½åº¦ width å±…ä¸­çš„å­—ç¬¦ä¸²ï¼Œfillchar ä¸ºå¡«å……çš„å­—ç¬¦ï¼Œé»˜è®¤ä¸ºç©ºæ ¼ã€‚ 3 count(str, beg 0, end len(string)) è¿”å› str åœ¨ string é‡Œé¢å‡ºç°çš„æ¬¡æ•°ï¼Œå¦‚æœ beg æˆ–è€… end æŒ‡å®šåˆ™è¿”å›æŒ‡å®šèŒƒå›´å†… str å‡ºç°çš„æ¬¡æ•° 4 bytes.decode(encoding â€œutf-8â€, errors â€œstrictâ€) Python3 ä¸­æ²¡æœ‰ decode æ–¹æ³•ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ bytes å¯¹è±¡çš„ decode() æ–¹æ³•æ¥è§£ç ç»™å®šçš„ bytes å¯¹è±¡ï¼Œè¿™ä¸ª bytes å¯¹è±¡å¯ä»¥ç”± str.encode() æ¥ç¼–ç è¿”å›ã€‚ 5 encode(encoding â€™UTF-8â€™, errors â€™strictâ€™) ä»¥ encoding æŒ‡å®šçš„ç¼–ç æ ¼å¼ç¼–ç å­—ç¬¦ä¸²ï¼Œå¦‚æœå‡ºé”™é»˜è®¤æŠ¥ä¸€ä¸ª ValueError çš„å¼‚å¸¸ï¼Œé™¤é errors æŒ‡å®šçš„æ˜¯â€™ignoreâ€™æˆ–è€…â€™replaceâ€™ 6 endswith(suffix, beg 0, end len(string)) æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä»¥ suffix ç»“æŸï¼Œå¦‚æœ beg æˆ–è€… end æŒ‡å®šåˆ™æ£€æŸ¥æŒ‡å®šçš„èŒƒå›´å†…æ˜¯å¦ä»¥ suffix ç»“æŸï¼Œå¦‚æœæ˜¯ï¼Œè¿”å› True, å¦åˆ™è¿”å› Falseã€‚ 7 expandtabs(tabsize 8) æŠŠå­—ç¬¦ä¸² string ä¸­çš„ tab ç¬¦å·è½¬ä¸ºç©ºæ ¼ï¼Œtab ç¬¦å·é»˜è®¤çš„ç©ºæ ¼æ•°æ˜¯ 8 ã€‚ 8 find(str, beg 0, end len(string)) æ£€æµ‹ str æ˜¯å¦åŒ…å«åœ¨å­—ç¬¦ä¸²ä¸­ï¼Œå¦‚æœæŒ‡å®šèŒƒå›´ beg å’Œ end ï¼Œåˆ™æ£€æŸ¥æ˜¯å¦åŒ…å«åœ¨æŒ‡å®šèŒƒå›´å†…ï¼Œå¦‚æœåŒ…å«è¿”å›å¼€å§‹çš„ç´¢å¼•å€¼ï¼Œå¦åˆ™è¿”å›-1 9 index(str, beg 0, end len(string)) è·Ÿ find()æ–¹æ³•ä¸€æ ·ï¼Œåªä¸è¿‡å¦‚æœ str ä¸åœ¨å­—ç¬¦ä¸²ä¸­ä¼šæŠ¥ä¸€ä¸ªå¼‚å¸¸ã€‚ 10 isalnum() æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ç”±å­—æ¯å’Œæ•°å­—ç»„æˆï¼Œå³å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å­—ç¬¦éƒ½æ˜¯å­—æ¯æˆ–æ•°å­—ã€‚å¦‚æœå­—ç¬¦ä¸²è‡³å°‘æœ‰ä¸€ä¸ªå­—ç¬¦ï¼Œå¹¶ä¸”æ‰€æœ‰å­—ç¬¦éƒ½æ˜¯å­—æ¯æˆ–æ•°å­—ï¼Œåˆ™è¿”å› Trueï¼›å¦åˆ™è¿”å› Falseã€‚ 11 isalpha() å¦‚æœå­—ç¬¦ä¸²è‡³å°‘æœ‰ä¸€ä¸ªå­—ç¬¦å¹¶ä¸”æ‰€æœ‰å­—ç¬¦éƒ½æ˜¯å­—æ¯æˆ–ä¸­æ–‡å­—åˆ™è¿”å› True, å¦åˆ™è¿”å› False 12 isdigit() å¦‚æœå­—ç¬¦ä¸²åªåŒ…å«æ•°å­—åˆ™è¿”å› True å¦åˆ™è¿”å› False.. 13 islower() å¦‚æœå­—ç¬¦ä¸²ä¸­åŒ…å«è‡³å°‘ä¸€ä¸ªåŒºåˆ†å¤§å°å†™çš„å­—ç¬¦ï¼Œå¹¶ä¸”æ‰€æœ‰è¿™äº›(åŒºåˆ†å¤§å°å†™çš„)å­—ç¬¦éƒ½æ˜¯å°å†™ï¼Œåˆ™è¿”å› Trueï¼Œå¦åˆ™è¿”å› False 14 isnumeric() å¦‚æœå­—ç¬¦ä¸²ä¸­åªåŒ…å«æ•°å­—å­—ç¬¦ï¼Œåˆ™è¿”å› Trueï¼Œå¦åˆ™è¿”å› False 15 isspace() å¦‚æœå­—ç¬¦ä¸²ä¸­åªåŒ…å«ç©ºç™½ï¼Œåˆ™è¿”å› Trueï¼Œå¦åˆ™è¿”å› False. 16 istitle() å¦‚æœå­—ç¬¦ä¸²æ˜¯æ ‡é¢˜åŒ–çš„(è§ title())åˆ™è¿”å› Trueï¼Œå¦åˆ™è¿”å› False 17 isupper() å¦‚æœå­—ç¬¦ä¸²ä¸­åŒ…å«è‡³å°‘ä¸€ä¸ªåŒºåˆ†å¤§å°å†™çš„å­—ç¬¦ï¼Œå¹¶ä¸”æ‰€æœ‰è¿™äº›(åŒºåˆ†å¤§å°å†™çš„)å­—ç¬¦éƒ½æ˜¯å¤§å†™ï¼Œåˆ™è¿”å› Trueï¼Œå¦åˆ™è¿”å› False 18 join(seq) ä»¥æŒ‡å®šå­—ç¬¦ä¸²ä½œä¸ºåˆ†éš”ç¬¦ï¼Œå°† seq ä¸­æ‰€æœ‰çš„å…ƒç´ (çš„å­—ç¬¦ä¸²è¡¨ç¤º)åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸² 19 len(string) è¿”å›å­—ç¬¦ä¸²é•¿åº¦ 20 [ljust(width, fillchar]) è¿”å›ä¸€ä¸ªåŸå­—ç¬¦ä¸²å·¦å¯¹é½, å¹¶ä½¿ç”¨ fillchar å¡«å……è‡³é•¿åº¦ width çš„æ–°å­—ç¬¦ä¸²ï¼Œfillchar é»˜è®¤ä¸ºç©ºæ ¼ã€‚ 21 lower() è½¬æ¢å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å¤§å†™å­—ç¬¦ä¸ºå°å†™. 22 lstrip() æˆªæ‰å­—ç¬¦ä¸²å·¦è¾¹çš„ç©ºæ ¼æˆ–æŒ‡å®šå­—ç¬¦ã€‚ 23 maketrans() åˆ›å»ºå­—ç¬¦æ˜ å°„çš„è½¬æ¢è¡¨ï¼Œå¯¹äºæ¥å—ä¸¤ä¸ªå‚æ•°çš„æœ€ç®€å•çš„è°ƒç”¨æ–¹å¼ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºéœ€è¦è½¬æ¢çš„å­—ç¬¦ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¹Ÿæ˜¯å­—ç¬¦ä¸²è¡¨ç¤ºè½¬æ¢çš„ç›®æ ‡ã€‚ 24 max(str) è¿”å›å­—ç¬¦ä¸² str ä¸­æœ€å¤§çš„å­—æ¯ã€‚ 25 min(str) è¿”å›å­—ç¬¦ä¸² str ä¸­æœ€å°çš„å­—æ¯ã€‚ 26 [replace(old, new , max]) æŠŠ å°†å­—ç¬¦ä¸²ä¸­çš„ old æ›¿æ¢æˆ new, å¦‚æœ max æŒ‡å®šï¼Œåˆ™æ›¿æ¢ä¸è¶…è¿‡ max æ¬¡ã€‚ 27 rfind(str, beg 0, end len(string)) ç±»ä¼¼äº find()å‡½æ•°ï¼Œä¸è¿‡æ˜¯ä»å³è¾¹å¼€å§‹æŸ¥æ‰¾. 28 rindex( str, beg 0, end len(string)) ç±»ä¼¼äº index()ï¼Œä¸è¿‡æ˜¯ä»å³è¾¹å¼€å§‹. 29 [rjust(width,, fillchar]) è¿”å›ä¸€ä¸ªåŸå­—ç¬¦ä¸²å³å¯¹é½, å¹¶ä½¿ç”¨ fillchar(é»˜è®¤ç©ºæ ¼ï¼‰å¡«å……è‡³é•¿åº¦ width çš„æ–°å­—ç¬¦ä¸² 30 rstrip() åˆ é™¤å­—ç¬¦ä¸²æœ«å°¾çš„ç©ºæ ¼æˆ–æŒ‡å®šå­—ç¬¦ã€‚ 31 split(str â€œâ€, num string.count(str)) ä»¥ str ä¸ºåˆ†éš”ç¬¦æˆªå–å­—ç¬¦ä¸²ï¼Œå¦‚æœ num æœ‰æŒ‡å®šå€¼ï¼Œåˆ™ä»…æˆªå– num+1 ä¸ªå­å­—ç¬¦ä¸² 32 [splitlines(keepends]) æŒ‰ç…§è¡Œ(â€˜\\râ€™, â€˜\\r â€™, â€™)åˆ†éš”ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«å„è¡Œä½œä¸ºå…ƒç´ çš„åˆ—è¡¨ï¼Œå¦‚æœå‚æ•° keepends ä¸º Falseï¼Œä¸åŒ…å«æ¢è¡Œç¬¦ï¼Œå¦‚æœä¸º Trueï¼Œåˆ™ä¿ç•™æ¢è¡Œç¬¦ã€‚ 33 startswith(substr, beg 0, end len(string)) æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦æ˜¯ä»¥æŒ‡å®šå­å­—ç¬¦ä¸² substr å¼€å¤´ï¼Œæ˜¯åˆ™è¿”å› Trueï¼Œå¦åˆ™è¿”å› Falseã€‚å¦‚æœ beg å’Œ end æŒ‡å®šå€¼ï¼Œåˆ™åœ¨æŒ‡å®šèŒƒå›´å†…æ£€æŸ¥ã€‚ 34 [strip(chars]) åœ¨å­—ç¬¦ä¸²ä¸Šæ‰§è¡Œ lstrip()å’Œ rstrip() 35 swapcase() å°†å­—ç¬¦ä¸²ä¸­å¤§å†™è½¬æ¢ä¸ºå°å†™ï¼Œå°å†™è½¬æ¢ä¸ºå¤§å†™ 36 title() è¿”å› â€œæ ‡é¢˜åŒ–â€ çš„å­—ç¬¦ä¸², å°±æ˜¯è¯´æ‰€æœ‰å•è¯éƒ½æ˜¯ä»¥å¤§å†™å¼€å§‹ï¼Œå…¶ä½™å­—æ¯å‡ä¸ºå°å†™(è§ istitle()) 37 translate(table, deletechars â€œâ€) æ ¹æ® table ç»™å‡ºçš„è¡¨(åŒ…å« 256 ä¸ªå­—ç¬¦)è½¬æ¢ string çš„å­—ç¬¦, è¦è¿‡æ»¤æ‰çš„å­—ç¬¦æ”¾åˆ° deletechars å‚æ•°ä¸­ 38 upper() è½¬æ¢å­—ç¬¦ä¸²ä¸­çš„å°å†™å­—æ¯ä¸ºå¤§å†™ 39 zfill (width) è¿”å›é•¿åº¦ä¸º width çš„å­—ç¬¦ä¸²ï¼ŒåŸå­—ç¬¦ä¸²å³å¯¹é½ï¼Œå‰é¢å¡«å…… 0 40 isdecimal() æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦åªåŒ…å«åè¿›åˆ¶å­—ç¬¦ï¼Œå¦‚æœæ˜¯è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚ boolå¸ƒå°”ç±»å‹å³ True æˆ– Falseã€‚ åœ¨ Python ä¸­ï¼ŒTrue å’Œ False éƒ½æ˜¯å…³é”®å­—ï¼Œè¡¨ç¤ºå¸ƒå°”å€¼ã€‚ å¸ƒå°”ç±»å‹å¯ä»¥ç”¨æ¥æ§åˆ¶ç¨‹åºçš„æµç¨‹ï¼Œæ¯”å¦‚åˆ¤æ–­æŸä¸ªæ¡ä»¶æ˜¯å¦æˆç«‹ï¼Œæˆ–è€…åœ¨æŸä¸ªæ¡ä»¶æ»¡è¶³æ—¶æ‰§è¡ŒæŸæ®µä»£ç ã€‚ å¸ƒå°”ç±»å‹ç‰¹ç‚¹ï¼š å¸ƒå°”ç±»å‹åªæœ‰ä¸¤ä¸ªå€¼ï¼šTrue å’Œ Falseã€‚ bool æ˜¯ int çš„å­ç±»ï¼Œå› æ­¤å¸ƒå°”å€¼å¯ä»¥è¢«çœ‹ä½œæ•´æ•°æ¥ä½¿ç”¨ï¼Œå…¶ä¸­ True ç­‰ä»·äº 1ã€‚ å¸ƒå°”ç±»å‹å¯ä»¥å’Œå…¶ä»–æ•°æ®ç±»å‹è¿›è¡Œæ¯”è¾ƒï¼Œæ¯”å¦‚æ•°å­—ã€å­—ç¬¦ä¸²ç­‰ã€‚åœ¨æ¯”è¾ƒæ—¶ï¼ŒPython ä¼šå°† True è§†ä¸º 1ï¼ŒFalse è§†ä¸º 0ã€‚ å¸ƒå°”ç±»å‹å¯ä»¥å’Œé€»è¾‘è¿ç®—ç¬¦ä¸€èµ·ä½¿ç”¨ï¼ŒåŒ…æ‹¬ andã€or å’Œ notã€‚è¿™äº›è¿ç®—ç¬¦å¯ä»¥ç”¨æ¥ç»„åˆå¤šä¸ªå¸ƒå°”è¡¨è¾¾å¼ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„å¸ƒå°”å€¼ã€‚ å¸ƒå°”ç±»å‹ä¹Ÿå¯ä»¥è¢«è½¬æ¢æˆå…¶ä»–æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚æ•´æ•°ã€æµ®ç‚¹æ•°å’Œå­—ç¬¦ä¸²ã€‚åœ¨è½¬æ¢æ—¶ï¼ŒTrue ä¼šè¢«è½¬æ¢æˆ 1ï¼ŒFalse ä¼šè¢«è½¬æ¢æˆ 0ã€‚ å¯ä»¥ä½¿ç”¨ bool() å‡½æ•°å°†å…¶ä»–ç±»å‹çš„å€¼è½¬æ¢ä¸ºå¸ƒå°”å€¼ã€‚ä»¥ä¸‹å€¼åœ¨è½¬æ¢ä¸ºå¸ƒå°”å€¼æ—¶ä¸º Falseï¼šNoneã€Falseã€é›¶ (0ã€0.0ã€0j)ã€ç©ºåºåˆ—ï¼ˆå¦‚ ã€()ã€[]ï¼‰å’Œç©ºæ˜ å°„ï¼ˆå¦‚ ï¼‰ã€‚å…¶ä»–æ‰€æœ‰å€¼è½¬æ¢ä¸ºå¸ƒå°”å€¼æ—¶å‡ä¸º Trueã€‚ # å¸ƒå°”ç±»å‹çš„å€¼å’Œç±»å‹a = Trueb = Falseprint(type(a)) # class boolprint(type(b)) # class bool# å¸ƒå°”ç±»å‹çš„æ•´æ•°è¡¨ç°print(int(True)) # 1print(int(False)) # 0# ä½¿ç”¨ bool() å‡½æ•°è¿›è¡Œè½¬æ¢print(bool(0)) # Falseprint(bool(-1)) # Trueprint(bool(-1.1)) # Trueprint(bool(1.1)) # Trueprint(bool(42)) # Trueprint(bool()) # Falseprint(bool(Python)) # Trueprint(bool([])) # Falseprint(bool([1, 2, 3])) # True# å¸ƒå°”é€»è¾‘è¿ç®—print(True and False) # Falseprint(True or False) # Trueprint(not True) # False# å¸ƒå°”æ¯”è¾ƒè¿ç®—print(5 3) # Trueprint(2 == 2) # Trueprint(7 4) # False# å¸ƒå°”å€¼åœ¨æ§åˆ¶æµä¸­çš„åº”ç”¨if True: print(This will always print) if not False: print(This will also always print) x = 10if x: print(x is non-zero and thus True in a boolean context) æ³¨æ„: åœ¨ Python ä¸­ï¼Œæ‰€æœ‰éé›¶çš„æ•°å­—å’Œéç©ºçš„å­—ç¬¦ä¸²ã€åˆ—è¡¨ã€å…ƒç»„ç­‰æ•°æ®ç±»å‹éƒ½è¢«è§†ä¸º Trueï¼Œåªæœ‰ 0ã€ç©ºå­—ç¬¦ä¸²ã€ç©ºåˆ—è¡¨ã€ç©ºå…ƒç»„ ç­‰è¢«è§†ä¸º Falseã€‚å› æ­¤ï¼Œåœ¨è¿›è¡Œå¸ƒå°”ç±»å‹è½¬æ¢æ—¶ï¼Œéœ€è¦æ³¨æ„æ•°æ®ç±»å‹çš„çœŸå‡æ€§ã€‚ List []List åŸºç¡€Listï¼ˆåˆ—è¡¨ï¼‰ æ˜¯ Python ä¸­ä½¿ç”¨æœ€é¢‘ç¹çš„æ•°æ®ç±»å‹ã€‚ åˆ—è¡¨å¯ä»¥å®Œæˆå¤§å¤šæ•°é›†åˆç±»çš„æ•°æ®ç»“æ„å®ç°ã€‚åˆ—è¡¨ä¸­å…ƒç´ çš„ç±»å‹å¯ä»¥ä¸ç›¸åŒï¼Œåˆ—è¡¨ä¸­çš„å…ƒç´ æ˜¯å¯ä»¥æ”¹å˜çš„ã€‚å®ƒæ”¯æŒæ•°å­—ï¼Œå­—ç¬¦ä¸²ç”šè‡³å¯ä»¥åŒ…å«åˆ—è¡¨ï¼ˆæ‰€è°“åµŒå¥—ï¼‰ã€‚ åˆ—è¡¨æ˜¯å†™åœ¨æ–¹æ‹¬å· [] ä¹‹é—´ã€ç”¨é€—å·åˆ†éš”å¼€çš„å…ƒç´ åˆ—è¡¨ã€‚ å’Œå­—ç¬¦ä¸²ä¸€æ ·ï¼Œåˆ—è¡¨åŒæ ·å¯ä»¥è¢«ç´¢å¼•å’Œæˆªå–ï¼Œåˆ—è¡¨è¢«æˆªå–åè¿”å›ä¸€ä¸ªåŒ…å«æ‰€éœ€å…ƒç´ çš„æ–°åˆ—è¡¨ã€‚ åˆ—è¡¨æˆªå–çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š å˜é‡[å¤´ä¸‹æ ‡:å°¾ä¸‹æ ‡] ç´¢å¼•å€¼ä»¥ 0 ä¸ºå¼€å§‹å€¼ï¼Œ**-1** ä¸ºä»æœ«å°¾çš„å¼€å§‹ä½ç½®ã€‚ åŠ å· + æ˜¯åˆ—è¡¨è¿æ¥è¿ç®—ç¬¦ï¼Œæ˜Ÿå· * æ˜¯é‡å¤æ“ä½œã€‚å¦‚ä¸‹ç¤ºä¾‹ï¼š #!/usr/bin/python3lst = [] * 3list = [ abcd, 786 , 2.23, runoob, 70.2 ] # å®šä¹‰ä¸€ä¸ªåˆ—è¡¨tinylist = [123, runoob]print(lst) # åˆå§‹åŒ–å…¨0åˆ—è¡¨ []print (list) # æ‰“å°æ•´ä¸ªåˆ—è¡¨ [abcd, 786, 2.23, runoob, 70.2]print (list[0]) # æ‰“å°åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´  abcdprint (list[1:3]) # æ‰“å°åˆ—è¡¨ç¬¬äºŒåˆ°ç¬¬å››ä¸ªå…ƒç´ ï¼ˆä¸åŒ…å«ç¬¬å››ä¸ªå…ƒç´ ï¼‰[786, 2.23] print (list[2:]) # æ‰“å°åˆ—è¡¨ä»ç¬¬ä¸‰ä¸ªå…ƒç´ å¼€å§‹åˆ°æœ«å°¾print (tinylist * 2) # æ‰“å°tinyliståˆ—è¡¨ä¸¤æ¬¡ [123, runoob, 123, runoob]print (list + tinylist) # æ‰“å°ä¸¤ä¸ªåˆ—è¡¨æ‹¼æ¥åœ¨ä¸€èµ·çš„ç»“æœ [abcd, 786, 2.23, runoob, 70.2, 123, runoob]print(list + tinylist * 2) # å…ˆæ‰§è¡Œ * å†æ‰§è¡Œ + [abcd, 786, 2.23, runoob, 70.2, 123, runoob, 123, runoob]print((list + tinylist) * 2) # [abcd, 786, 2.23, runoob, 70.2, 123, runoob, abcd, 786, 2.23, runoob, 70.2, 123, runoob] [abcd, 786, 2.23, runoob, 70.2] abcd [786, 2.23] [2.23, runoob, 70.2] [123, runoob, 123, runoob] [abcd, 786, 2.23, runoob, 70.2, 123, runoob] [abcd, 786, 2.23, runoob, 70.2, 123, runoob, 123, runoob] [abcd, 786, 2.23, runoob, 70.2, 123, runoob, abcd, 786, 2.23, runoob, 70.2, 123, runoob] ä¸å­—ç¬¦ä¸²ä¸ä¸€æ ·çš„æ˜¯ï¼Œåˆ—è¡¨ä¸­çš„å…ƒç´ æ˜¯å¯ä»¥æ”¹å˜çš„ï¼š a = [1, 2, 3, 4, 5, 6] a[0] = 9 a[2:5] = [13, 14, 15] a[9, 2, 13, 14, 15, 6] a[2:5] = [] # å°†å¯¹åº”çš„å…ƒç´ å€¼è®¾ç½®ä¸º [] a[9, 2, 6] List å†…ç½®äº†æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œä¾‹å¦‚ append()ã€pop() ç­‰ç­‰ï¼Œè¿™åœ¨åé¢ä¼šè®²åˆ°ã€‚ 1ã€åˆ—è¡¨å†™åœ¨æ–¹æ‹¬å·ä¹‹é—´ï¼Œå…ƒç´ ç”¨é€—å·éš”å¼€ã€‚2ã€å’Œå­—ç¬¦ä¸²ä¸€æ ·ï¼Œåˆ—è¡¨å¯ä»¥è¢«ç´¢å¼•å’Œåˆ‡ç‰‡ã€‚3ã€åˆ—è¡¨å¯ä»¥ä½¿ç”¨ + æ“ä½œç¬¦è¿›è¡Œæ‹¼æ¥ã€‚4ã€åˆ—è¡¨ä¸­çš„å…ƒç´ æ˜¯å¯ä»¥æ”¹å˜çš„ã€‚ Python åˆ—è¡¨æˆªå–å¯ä»¥æ¥æ”¶ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå‚æ•°ä½œç”¨æ˜¯æˆªå–çš„æ­¥é•¿ï¼Œä»¥ä¸‹å®ä¾‹åœ¨ç´¢å¼• 1 åˆ°ç´¢å¼• 4 çš„ä½ç½®å¹¶è®¾ç½®ä¸ºæ­¥é•¿ä¸º 2ï¼ˆé—´éš”ä¸€ä¸ªä½ç½®ï¼‰æ¥æˆªå–å­—ç¬¦ä¸²ï¼š å¦‚æœç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºè´Ÿæ•°è¡¨ç¤ºé€†å‘è¯»å–ï¼Œä»¥ä¸‹ç¤ºä¾‹ç”¨äºç¿»è½¬å­—ç¬¦ä¸²ï¼š def reverseWords(input): # é€šè¿‡ç©ºæ ¼å°†å­—ç¬¦ä¸²åˆ†éš”ç¬¦ï¼ŒæŠŠå„ä¸ªå•è¯åˆ†éš”ä¸ºåˆ—è¡¨ inputWords = input.split( ) # ç¿»è½¬å­—ç¬¦ä¸² # å‡è®¾åˆ—è¡¨ list = [1,2,3,4], # list[0]=1, list[1]=2 ï¼Œè€Œ -1 è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´  list[-1]=4 ( ä¸ list[3]=4 ä¸€æ ·) # inputWords[-1::-1] æœ‰ä¸‰ä¸ªå‚æ•° # ç¬¬ä¸€ä¸ªå‚æ•° -1 è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´  # ç¬¬äºŒä¸ªå‚æ•°ä¸ºç©ºï¼Œè¡¨ç¤ºç§»åŠ¨åˆ°åˆ—è¡¨æœ«å°¾ # ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºæ­¥é•¿ï¼Œ-1 è¡¨ç¤ºé€†å‘ inputWords=inputWords[-1::-1] # é‡æ–°ç»„åˆå­—ç¬¦ä¸² output = .join(inputWords) return output if __name__ == __main__: input = I like runoob rw = reverseWords(input) print(rw) # runoob like I æ›´æ–°åˆ—è¡¨ä½ å¯ä»¥å¯¹åˆ—è¡¨çš„æ•°æ®é¡¹è¿›è¡Œä¿®æ”¹æˆ–æ›´æ–°ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ append() æ–¹æ³•æ¥æ·»åŠ åˆ—è¡¨é¡¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š #!/usr/bin/python3list = [Google, Runoob, 1997, 2000]print (ç¬¬ä¸‰ä¸ªå…ƒç´ ä¸º : , list[2])list[2] = 2001print (æ›´æ–°åçš„ç¬¬ä¸‰ä¸ªå…ƒç´ ä¸º : , list[2])list1 = [Google, Runoob, Taobao]list1.append(Baidu)print (æ›´æ–°åçš„åˆ—è¡¨ : , list1) ç¬¬ä¸‰ä¸ªå…ƒç´ ä¸º : 1997æ›´æ–°åçš„ç¬¬ä¸‰ä¸ªå…ƒç´ ä¸º : 2001æ›´æ–°åçš„åˆ—è¡¨ : [Google, Runoob, Taobao, Baidu] åˆ é™¤åˆ—è¡¨å…ƒç´ å¯ä»¥ä½¿ç”¨ del è¯­å¥æ¥åˆ é™¤åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼š #!/usr/bin/python3 list = [Google, Runoob, 1997, 2000] print (åŸå§‹åˆ—è¡¨ : , list)del list[2]print (åˆ é™¤ç¬¬ä¸‰ä¸ªå…ƒç´  : , list) åŸå§‹åˆ—è¡¨ : [Google, Runoob, 1997, 2000]åˆ é™¤ç¬¬ä¸‰ä¸ªå…ƒç´  : [Google, Runoob, 2000] åˆ—è¡¨è„šæœ¬æ“ä½œç¬¦åˆ—è¡¨å¯¹ + å’Œ çš„æ“ä½œç¬¦ä¸å­—ç¬¦ä¸²ç›¸ä¼¼ã€‚+ å·ç”¨äºç»„åˆåˆ—è¡¨ï¼Œ å·ç”¨äºé‡å¤åˆ—è¡¨ã€‚ Python è¡¨è¾¾å¼ ç»“æœ æè¿° len([1, 2, 3]) 3 é•¿åº¦ [1, 2, 3] + [4, 5, 6] [1, 2, 3, 4, 5, 6] ç»„åˆ [â€˜Hi!â€™] * 4 [â€˜Hi!â€™, â€˜Hi!â€™, â€˜Hi!â€™, â€˜Hi!â€™] é‡å¤ 3 in [1, 2, 3] True å…ƒç´ æ˜¯å¦å­˜åœ¨äºåˆ—è¡¨ä¸­ for x in [1, 2, 3]: print(x, endâ€ â€œ) 1 2 3 è¿­ä»£ åˆ—è¡¨æˆªå–ä¸æ‹¼æ¥Python çš„åˆ—è¡¨æˆªå–ä¸å­—ç¬¦ä¸²æ“ä½œç±»ä¼¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š Python è¡¨è¾¾å¼ ç»“æœ æè¿° L [2] â€˜Taobaoâ€™ è¯»å–ç¬¬ä¸‰ä¸ªå…ƒç´  L [-2] â€˜Runoobâ€™ ä»å³ä¾§å¼€å§‹è¯»å–å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ : count from the right L [1:] [â€˜Runoobâ€™, â€˜Taobaoâ€™] è¾“å‡ºä»ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹åçš„æ‰€æœ‰å…ƒç´  L=[Google, Runoob, Taobao] L[2]Taobao L[-2]Runoob L[1:][Runoob, Taobao] åˆ—è¡¨è¿˜æ”¯æŒæ‹¼æ¥æ“ä½œï¼š squares = [1, 4, 9, 16, 25] squares += [36, 49, 64, 81, 100] squares[1, 4, 9, 16, 25, 36, 49, 64, 81, 100] åµŒå¥—åˆ—è¡¨ a = [a, b, c] n = [1, 2, 3] x = [a, n] x[[a, b, c], [1, 2, 3]] x[0][a, b, c] x[0][1]b åˆ—è¡¨æ¯”è¾ƒåˆ—è¡¨æ¯”è¾ƒéœ€è¦å¼•å…¥ operator æ¨¡å—çš„ eq æ–¹æ³• # å¯¼å…¥ operator æ¨¡å—import operatora = [1, 2]b = [2, 3]c = [2, 3]print(operator.eq(a,b): , operator.eq(a,b))print(operator.eq(c,b): , operator.eq(c,b)) operator.eq(a,b): Falseoperator.eq(c,b): True åˆ—è¡¨å‡½æ•°æ–¹æ³• åºå· å‡½æ•° 1 len(list) åˆ—è¡¨å…ƒç´ ä¸ªæ•° 2 max(list) è¿”å›åˆ—è¡¨å…ƒç´ æœ€å¤§å€¼ 3 min(list) è¿”å›åˆ—è¡¨å…ƒç´ æœ€å°å€¼ 4 list(seq) å°†å…ƒç»„è½¬æ¢ä¸ºåˆ—è¡¨ åºå· æ–¹æ³• 1 list.append(obj) åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ æ–°çš„å¯¹è±¡ 2 list.count(obj) ç»Ÿè®¡æŸä¸ªå…ƒç´ åœ¨åˆ—è¡¨ä¸­å‡ºç°çš„æ¬¡æ•° 3 list.extend(seq) åœ¨åˆ—è¡¨æœ«å°¾ä¸€æ¬¡æ€§è¿½åŠ å¦ä¸€ä¸ªåºåˆ—ä¸­çš„å¤šä¸ªå€¼ï¼ˆç”¨æ–°åˆ—è¡¨æ‰©å±•åŸæ¥çš„åˆ—è¡¨ï¼‰ 4 list.index(obj) ä»åˆ—è¡¨ä¸­æ‰¾å‡ºæŸä¸ªå€¼ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ç´¢å¼•ä½ç½® 5 list.insert(index, obj) å°†å¯¹è±¡æ’å…¥åˆ—è¡¨ 6 list.pop(index -1]) ç§»é™¤åˆ—è¡¨ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼ˆé»˜è®¤æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œå¹¶ä¸”è¿”å›è¯¥å…ƒç´ çš„å€¼ 7 list.remove(obj) ç§»é™¤åˆ—è¡¨ä¸­æŸä¸ªå€¼çš„ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ 8 list.reverse() åå‘åˆ—è¡¨ä¸­å…ƒç´  9 list.sort( key None, reverse False) å¯¹åŸåˆ—è¡¨è¿›è¡Œæ’åº 10 list.clear() æ¸…ç©ºåˆ—è¡¨ 11 list.copy() å¤åˆ¶åˆ—è¡¨ Tuple ()Tuple åŸºç¡€å…ƒç»„ï¼ˆtupleï¼‰ä¸åˆ—è¡¨ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äº å…ƒç»„çš„å…ƒç´ ä¸èƒ½ä¿®æ”¹ã€‚å…ƒç»„å†™åœ¨å°æ‹¬å· () é‡Œï¼Œå…ƒç´ ä¹‹é—´ç”¨é€—å·éš”å¼€ã€‚ å…ƒç»„ä¸­çš„å…ƒç´ ç±»å‹ä¹Ÿå¯ä»¥ä¸ç›¸åŒï¼š #!/usr/bin/python3tuple = (ab, 1 , 1.2, )tinytuple = (3, c, 3.1)tup2 = ()tup3 = a,b,c # å¯ä»¥ä¸éœ€è¦æ‹¬å·print (tuple) # è¾“å‡ºå®Œæ•´å…ƒç»„print (tuple[0]) # è¾“å‡ºå…ƒç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ print (tuple[1:3]) # è¾“å‡ºä»ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹åˆ°ç¬¬ä¸‰ä¸ªå…ƒç´ print (tuple[2:]) # è¾“å‡ºä»ç¬¬ä¸‰ä¸ªå…ƒç´ å¼€å§‹çš„æ‰€æœ‰å…ƒç´ print (tinytuple * 2) # è¾“å‡ºä¸¤æ¬¡å…ƒç»„print (tuple + tinytuple) # è¿æ¥å…ƒç»„ (â€˜abâ€™, 1, 1.2)ab(1, 1.2)(1.2,)(3, â€˜câ€™, 3.1, 3, â€˜câ€™, 3.1)(â€˜abâ€™, 1, 1.2, 3, â€˜câ€™, 3.1) å…ƒç»„ä¸å­—ç¬¦ä¸²ç±»ä¼¼ï¼Œå¯ä»¥è¢«ç´¢å¼•ä¸”ä¸‹æ ‡ç´¢å¼•ä» 0 å¼€å§‹ï¼Œ-1 ä¸ºä»æœ«å°¾å¼€å§‹çš„ä½ç½®ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œæˆªå–ã€‚ å…¶å®ï¼Œå¯ä»¥æŠŠå­—ç¬¦ä¸²çœ‹ä½œä¸€ç§ç‰¹æ®Šçš„å…ƒç»„ã€‚ tup = (1, 2, 3, 4, 5, 6) print(tup[0])1 print(tup[1:5])(2, 3, 4, 5) tup[0] = 11 # ä¿®æ”¹å…ƒç»„å…ƒç´ çš„æ“ä½œæ˜¯éæ³•çš„Traceback (most recent call last): File stdin, line 1, in moduleTypeError: tuple object does not support item assignment è™½ç„¶ tuple çš„å…ƒç´ ä¸å¯æ”¹å˜ï¼Œä½†å®ƒå¯ä»¥åŒ…å«å¯å˜çš„å¯¹è±¡ï¼Œæ¯”å¦‚ list åˆ—è¡¨ã€‚ æ„é€ åŒ…å« 0 ä¸ªæˆ– 1 ä¸ªå…ƒç´ çš„å…ƒç»„æ¯”è¾ƒç‰¹æ®Šï¼Œæ‰€ä»¥æœ‰ä¸€äº›é¢å¤–çš„è¯­æ³•è§„åˆ™ï¼š tup1 = () # ç©ºå…ƒç»„tup2 = (20,) # ä¸€ä¸ªå…ƒç´ ï¼Œéœ€è¦åœ¨å…ƒç´ åæ·»åŠ é€—å· å¦‚æœä½ æƒ³åˆ›å»ºåªæœ‰ä¸€ä¸ªå…ƒç´ çš„å…ƒç»„ï¼Œéœ€è¦æ³¨æ„åœ¨å…ƒç´ åé¢æ·»åŠ ä¸€ä¸ªé€—å·ï¼Œä»¥åŒºåˆ†å®ƒæ˜¯ä¸€ä¸ªå…ƒç»„è€Œä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„å€¼ï¼Œè¿™æ˜¯å› ä¸ºåœ¨æ²¡æœ‰é€—å·çš„æƒ…å†µä¸‹ï¼ŒPython ä¼šå°†æ‹¬å·è§£é‡Šä¸ºæ•°å­¦è¿ç®—ä¸­çš„æ‹¬å·ï¼Œè€Œä¸æ˜¯å…ƒç»„çš„è¡¨ç¤ºã€‚ å¦‚æœä¸æ·»åŠ é€—å·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå®ƒå°†è¢«è§£é‡Šä¸ºä¸€ä¸ªæ™®é€šçš„å€¼è€Œä¸æ˜¯å…ƒç»„ï¼š not_a_tuple = (1)print(type(not_a_tuple)) # class inttuple = (1,)print(type(tuple)) # class tuple è¿™æ ·çš„è¯ï¼Œnot_a_tuple å°†æ˜¯æ•´æ•°ç±»å‹è€Œä¸æ˜¯å…ƒç»„ç±»å‹ã€‚ stringã€list å’Œ tuple éƒ½å±äº sequenceï¼ˆåºåˆ—ï¼‰ã€‚ 1ã€ä¸å­—ç¬¦ä¸²ä¸€æ ·ï¼Œå…ƒç»„çš„å…ƒç´ ä¸èƒ½ä¿®æ”¹ã€‚2ã€å…ƒç»„ä¹Ÿå¯ä»¥è¢«ç´¢å¼•å’Œåˆ‡ç‰‡ï¼Œæ–¹æ³•ä¸€æ ·ã€‚3ã€æ³¨æ„æ„é€ åŒ…å« 0 æˆ– 1 ä¸ªå…ƒç´ çš„å…ƒç»„çš„ç‰¹æ®Šè¯­æ³•è§„åˆ™ã€‚4ã€å…ƒç»„ä¹Ÿå¯ä»¥ä½¿ç”¨ + æ“ä½œç¬¦è¿›è¡Œæ‹¼æ¥ã€‚ è®¿é—®å…ƒç»„å…ƒç»„å¯ä»¥ä½¿ç”¨ä¸‹æ ‡ç´¢å¼•æ¥è®¿é—®å…ƒç»„ä¸­çš„å€¼ï¼Œå¦‚ä¸‹ç¤ºä¾‹: #!/usr/bin/python3 tup1 = (Google, Runoob, 1997, 2000)tup2 = (1, 2, 3, 4, 5, 6, 7 ) print (tup1[0]: , tup1[0]) # tup1[0]: Googleprint (tup2[1:5]: , tup2[1:5]) # tup2[1:5]: (2, 3, 4, 5) ä¿®æ”¹å…ƒç»„å…ƒç»„ä¸­çš„å…ƒç´ å€¼æ˜¯ä¸å…è®¸ä¿®æ”¹çš„ï¼Œä½†æˆ‘ä»¬å¯ä»¥å¯¹å…ƒç»„è¿›è¡Œè¿æ¥ç»„åˆï¼Œå¦‚ä¸‹ç¤ºä¾‹: #!/usr/bin/python3 tup1 = (12, 34.56)tup2 = (abc, xyz) # ä»¥ä¸‹ä¿®æ”¹å…ƒç»„å…ƒç´ æ“ä½œæ˜¯éæ³•çš„# tup1[0] = 100 # åˆ›å»ºä¸€ä¸ªæ–°çš„å…ƒç»„tup3 = tup1 + tup2print (tup3) # (12, 34.56, abc, xyz) åˆ é™¤å…ƒç»„å…ƒç»„ä¸­çš„å…ƒç´ å€¼æ˜¯ä¸å…è®¸åˆ é™¤çš„ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ del è¯­å¥æ¥åˆ é™¤æ•´ä¸ªå…ƒç»„ï¼Œå¦‚ä¸‹ç¤ºä¾‹: tup = (Google, Runoob, 1997, 2000) del tup[0]Traceback (most recent call last): File python-input-66, line 1, in module del tup[0] ~~~^^^TypeError: tuple object doesnt support item deletion #!/usr/bin/python3 tup = (Google, Runoob, 1997, 2000) print (tup)del tupprint (åˆ é™¤åçš„å…ƒç»„ tup : )print (tup) ä»¥ä¸Šç¤ºä¾‹å…ƒç»„è¢«åˆ é™¤åï¼Œè¾“å‡ºå˜é‡ä¼šæœ‰å¼‚å¸¸ä¿¡æ¯ï¼Œè¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š åˆ é™¤åçš„å…ƒç»„ tup : Traceback (most recent call last): File test.py, line 8, in module print (tup)NameError: name tup is not defined å…ƒç»„è¿ç®—ç¬¦ä¸å­—ç¬¦ä¸²ä¸€æ ·ï¼Œå…ƒç»„ä¹‹é—´å¯ä»¥ä½¿ç”¨ +ã€+= å’Œ * å·è¿›è¡Œè¿ç®—ã€‚è¿™å°±æ„å‘³ç€ä»–ä»¬å¯ä»¥ç»„åˆå’Œå¤åˆ¶ï¼Œè¿ç®—åä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„å…ƒç»„ã€‚ Python è¡¨è¾¾å¼ ç»“æœ æè¿° len((1, 2, 3)) 3 è®¡ç®—å…ƒç´ ä¸ªæ•° a = (1, 2, 3) b = (4, 5, 6) c = a+b c (1, 2, 3, 4, 5, 6) (1, 2, 3, 4, 5, 6) è¿æ¥ï¼Œc å°±æ˜¯ä¸€ä¸ªæ–°çš„å…ƒç»„ï¼Œå®ƒåŒ…å«äº† a å’Œ b ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚ a = (1, 2, 3) b = (4, 5, 6) a += b a (1, 2, 3, 4, 5, 6) (1, 2, 3, 4, 5, 6) è¿æ¥ï¼Œa å°±å˜æˆäº†ä¸€ä¸ªæ–°çš„å…ƒç»„ï¼Œå®ƒåŒ…å«äº† a å’Œ b ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚ (Hi!,) * 4 (â€˜Hi!â€™, â€˜Hi!â€™, â€˜Hi!â€™, â€˜Hi!â€™) å¤åˆ¶ 3 in (1, 2, 3) True å…ƒç´ æ˜¯å¦å­˜åœ¨ for x in (1, 2, 3): print (x, end= ) 1 2 3 è¿­ä»£ å…ƒç»„ç´¢å¼•ï¼Œæˆªå–å› ä¸ºå…ƒç»„ä¹Ÿæ˜¯ä¸€ä¸ªåºåˆ—ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¿é—®å…ƒç»„ä¸­çš„æŒ‡å®šä½ç½®çš„å…ƒç´ ï¼Œä¹Ÿå¯ä»¥æˆªå–ç´¢å¼•ä¸­çš„ä¸€æ®µå…ƒç´ ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š tup = (Google, Runoob, Taobao, Wiki, Weibo,Weixin) Python è¡¨è¾¾å¼ ç»“æœ æè¿° tup [1] â€˜Runoobâ€™ è¯»å–ç¬¬äºŒä¸ªå…ƒç´  tup [-2] â€˜Weiboâ€™ åå‘è¯»å–ï¼Œè¯»å–å€’æ•°ç¬¬äºŒä¸ªå…ƒç´  tup [1:] (â€˜Runoobâ€™, â€˜Taobaoâ€™, â€˜Wikiâ€™, â€˜Weiboâ€™, â€˜Weixinâ€™) æˆªå–å…ƒç´ ï¼Œä»ç¬¬äºŒä¸ªå¼€å§‹åçš„æ‰€æœ‰å…ƒç´ ã€‚ tup [1:4] (â€˜Runoobâ€™, â€˜Taobaoâ€™, â€˜Wikiâ€™) æˆªå–å…ƒç´ ï¼Œä»ç¬¬äºŒä¸ªå¼€å§‹åˆ°ç¬¬å››ä¸ªå…ƒç´ ï¼ˆç´¢å¼•ä¸º 3ï¼‰ã€‚ tup = (Google, Runoob, Taobao, Wiki, Weibo,Weixin) tup[1]Runoob tup[-2]Weibo tup[1:](Runoob, Taobao, Wiki, Weibo, Weixin) tup[1:4](Runoob, Taobao, Wiki) å…ƒç»„å†…ç½®å‡½æ•°Python å…ƒç»„åŒ…å«äº†ä»¥ä¸‹å†…ç½®å‡½æ•° åºå· æ–¹æ³•åŠæè¿° å®ä¾‹ 1 len(tuple) è®¡ç®—å…ƒç»„å…ƒç´ ä¸ªæ•°ã€‚ tuple1 = (Google, Runoob, Taobao) len(tuple1) 3 2 max(tuple) è¿”å›å…ƒç»„ä¸­å…ƒç´ æœ€å¤§å€¼ã€‚ tuple2 = (5, 4, 8) max(tuple2) 8 3 min(tuple) è¿”å›å…ƒç»„ä¸­å…ƒç´ æœ€å°å€¼ã€‚ tuple2 = (5, 4, 8) min(tuple2) 4 4 tuple(iterable) å°†å¯è¿­ä»£ç³»åˆ—è½¬æ¢ä¸ºå…ƒç»„ã€‚ list1= [Google, Taobao, Runoob, Baidu] tuple1=tuple(list1) tuple1 (Google, Taobao, Runoob, Baidu) å…³äºå…ƒç»„æ˜¯ä¸å¯å˜çš„æ‰€è°“å…ƒç»„çš„ä¸å¯å˜æŒ‡çš„æ˜¯å…ƒç»„æ‰€æŒ‡å‘çš„å†…å­˜ä¸­çš„å†…å®¹ä¸å¯å˜ã€‚ tup = (r, u, n, o, o, b) tup[0] = g # ä¸æ”¯æŒä¿®æ”¹å…ƒç´ Traceback (most recent call last): File stdin, line 1, in moduleTypeError: tuple object does not support item assignment id(tup) # æŸ¥çœ‹å†…å­˜åœ°å€4440687904 tup = (1,2,3) id(tup)4441088800 # å†…å­˜åœ°å€ä¸ä¸€æ ·äº† ä»ä»¥ä¸Šç¤ºä¾‹å¯ä»¥çœ‹å‡ºï¼Œé‡æ–°èµ‹å€¼çš„å…ƒç»„ tupï¼Œç»‘å®šåˆ°æ–°çš„å¯¹è±¡äº†ï¼Œä¸æ˜¯ä¿®æ”¹äº†åŸæ¥çš„å¯¹è±¡ã€‚ Set Set åŸºç¡€Python ä¸­çš„é›†åˆï¼ˆSetï¼‰æ˜¯ä¸€ç§ æ— åºã€å¯å˜ çš„æ•°æ®ç±»å‹ï¼Œç”¨äºå­˜å‚¨ å”¯ä¸€ çš„å…ƒç´ ã€‚ é›†åˆä¸­çš„å…ƒç´  ä¸ä¼šé‡å¤ï¼Œå¹¶ä¸”å¯ä»¥è¿›è¡Œäº¤é›†ã€å¹¶é›†ã€å·®é›†ç­‰å¸¸è§çš„é›†åˆæ“ä½œã€‚ åœ¨ Python ä¸­ï¼Œé›†åˆä½¿ç”¨å¤§æ‹¬å· è¡¨ç¤ºï¼Œå…ƒç´ ä¹‹é—´ç”¨é€—å· , åˆ†éš”ã€‚ å¦å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ set() å‡½æ•°åˆ›å»ºé›†åˆã€‚ æ³¨æ„ï¼š åˆ›å»ºä¸€ä¸ªç©ºé›†åˆå¿…é¡»ç”¨ set() è€Œä¸æ˜¯ **{ }**ï¼Œå› ä¸º { } æ˜¯ç”¨æ¥åˆ›å»ºä¸€ä¸ªç©ºå­—å…¸ã€‚ åˆ›å»ºæ ¼å¼ï¼š parame = value01,value02,...æˆ–è€…set(value)param = 1,2,2print(param) # 1, 2print(set(1,2)) # 1, 2print(set(1233)) # 3, 2, 1 #!/usr/bin/python3sites = Google, Google, Taobao, Taobao, Runoob, Facebook, Zhihu, Baiduprint(sites) # è¾“å‡ºé›†åˆï¼Œé‡å¤çš„å…ƒç´ è¢«è‡ªåŠ¨å»æ‰ Zhihu, Baidu, Taobao, Runoob, Google, Facebook# æˆå‘˜æµ‹è¯• if Runoob in sites : print(Runoob åœ¨é›†åˆä¸­) else : print(Runoob ä¸åœ¨é›†åˆä¸­)# Runoob åœ¨é›†åˆä¸­# setå¯ä»¥è¿›è¡Œé›†åˆè¿ç®—a = set(abracadabra)b = set(alacazam)print(a) # b, c, a, r, dprint(a - b) # a å’Œ b çš„å·®é›† r, b, dprint(a | b) # a å’Œ b çš„å¹¶é›† b, c, a, z, m, r, l, dprint(a b) # a å’Œ b çš„äº¤é›† c, aprint(a ^ b) # a å’Œ b ä¸­ä¸åŒæ—¶å­˜åœ¨çš„å…ƒç´  z, b, m, r, l, d æ·»åŠ å…ƒç´ s.add( x ) å°†å…ƒç´  x æ·»åŠ åˆ°é›†åˆ s ä¸­ï¼Œå¦‚æœå…ƒç´ å·²å­˜åœ¨ï¼Œåˆ™ä¸è¿›è¡Œä»»ä½•æ“ä½œã€‚ s = set([1,2,è€ç‹])s.add(3)print(s) # 1, 2, 3, è€ç‹ è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æ·»åŠ å…ƒç´ ï¼Œä¸”å‚æ•°å¯ä»¥æ˜¯åˆ—è¡¨ï¼Œå…ƒç»„ï¼Œå­—å…¸ç­‰ã€‚ s.update( x ) x å¯ä»¥æœ‰å¤šä¸ªï¼Œç”¨é€—å·åˆ†å¼€ã€‚ s = set([è€ç‹])s.update([5,6])s.update((3,4))s.update(1,2)print(s) # è€ç‹, 2, 3, 4, 1, 5, 6 ç§»é™¤å…ƒç´ s.remove( x ) å°†å…ƒç´  x ä»é›†åˆ s ä¸­ç§»é™¤ï¼Œå¦‚æœå…ƒç´ ä¸å­˜åœ¨ï¼Œåˆ™ä¼šå‘ç”Ÿé”™è¯¯ã€‚ s = set((1,2,3))s.remove(1)print(s) # 2, 3# åˆ é™¤ä¸å­˜åœ¨çš„å…ƒç´ ä¼šæŠ¥é”™s.remove(è€ç‹)Traceback (most recent call last): File d:\\work\\styspace\\sty_python\\test.py, line 2, in module s.remove(è€ç‹) ~~~~~~~~^^^^^^^^KeyError: è€ç‹ æ­¤å¤–è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•ä¹Ÿæ˜¯ç§»é™¤é›†åˆä¸­çš„å…ƒç´ ï¼Œä¸”å¦‚æœå…ƒç´ ä¸å­˜åœ¨ï¼Œä¸ä¼šå‘ç”Ÿé”™è¯¯ã€‚ s.discard( x ) s = set((1,2,3))s.discard(è€ç‹) # ä¸ä¼šæŠ¥é”™print(s) # 1, 2, 3 æˆ‘ä»¬ä¹Ÿå¯ä»¥è®¾ç½®éšæœºåˆ é™¤é›†åˆä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼š s.pop() s = set((1,2,3))s.pop()print(s) # 2, 3 set é›†åˆçš„ pop æ–¹æ³•ä¼šå¯¹é›†åˆè¿›è¡Œæ— åºçš„æ’åˆ—ï¼Œç„¶åå°†è¿™ä¸ªæ— åºæ’åˆ—é›†åˆçš„å·¦é¢ç¬¬ä¸€ä¸ªå…ƒç´ è¿›è¡Œåˆ é™¤ã€‚ è®¡ç®—é›†åˆå…ƒç´ ä¸ªæ•°len(s) è®¡ç®—é›†åˆ s å…ƒç´ ä¸ªæ•°ã€‚ thisset = set((Google, Runoob, Taobao)) len(thisset)3 æ¸…ç©ºé›†åˆs.clear() æ¸…ç©ºé›†åˆ sã€‚ thisset = set((Google, Runoob, Taobao)) thisset.clear() print(thisset)set() åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­å­˜åœ¨x in s åˆ¤æ–­å…ƒç´  x æ˜¯å¦åœ¨é›†åˆ s ä¸­ï¼Œå­˜åœ¨è¿”å› Trueï¼Œä¸å­˜åœ¨è¿”å› Falseã€‚ thisset = set((Google, Runoob, Taobao)) Runoob in thissetTrue Facebook in thissetFalse é›†åˆå†…ç½®æ–¹æ³•å®Œæ•´åˆ—è¡¨ æ–¹æ³• æè¿° add() ä¸ºé›†åˆæ·»åŠ å…ƒç´  clear() ç§»é™¤é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´  copy() æ‹·è´ä¸€ä¸ªé›†åˆ difference() è¿”å›å¤šä¸ªé›†åˆçš„å·®é›† difference_update() ç§»é™¤é›†åˆä¸­çš„å…ƒç´ ï¼Œè¯¥å…ƒç´ åœ¨æŒ‡å®šçš„é›†åˆä¹Ÿå­˜åœ¨ã€‚ discard() åˆ é™¤é›†åˆä¸­æŒ‡å®šçš„å…ƒç´  intersection() è¿”å›é›†åˆçš„äº¤é›† intersection_update() è¿”å›é›†åˆçš„äº¤é›†ã€‚ isdisjoint() åˆ¤æ–­ä¸¤ä¸ªé›†åˆæ˜¯å¦åŒ…å«ç›¸åŒçš„å…ƒç´ ï¼Œå¦‚æœæ²¡æœ‰è¿”å› Trueï¼Œå¦åˆ™è¿”å› Falseã€‚ issubset() åˆ¤æ–­æŒ‡å®šé›†åˆæ˜¯å¦ä¸ºè¯¥æ–¹æ³•å‚æ•°é›†åˆçš„å­é›†ã€‚ issuperset() åˆ¤æ–­è¯¥æ–¹æ³•çš„å‚æ•°é›†åˆæ˜¯å¦ä¸ºæŒ‡å®šé›†åˆçš„å­é›† pop() éšæœºç§»é™¤å…ƒç´  remove() ç§»é™¤æŒ‡å®šå…ƒç´  symmetric_difference() è¿”å›ä¸¤ä¸ªé›†åˆä¸­ä¸é‡å¤çš„å…ƒç´ é›†åˆã€‚ symmetric_difference_update() ç§»é™¤å½“å‰é›†åˆä¸­åœ¨å¦å¤–ä¸€ä¸ªæŒ‡å®šé›†åˆç›¸åŒçš„å…ƒç´ ï¼Œå¹¶å°†å¦å¤–ä¸€ä¸ªæŒ‡å®šé›†åˆä¸­ä¸åŒçš„å…ƒç´ æ’å…¥åˆ°å½“å‰é›†åˆä¸­ã€‚ union() è¿”å›ä¸¤ä¸ªé›†åˆçš„å¹¶é›† update() ç»™é›†åˆæ·»åŠ å…ƒç´  len() è®¡ç®—é›†åˆå…ƒç´ ä¸ªæ•° Dictionary k:vDictionary åŸºç¡€å­—å…¸ï¼ˆdictionaryï¼‰æ˜¯ Python ä¸­å¦ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å†…ç½®æ•°æ®ç±»å‹ã€‚ åˆ—è¡¨æ˜¯æœ‰åºçš„å¯¹è±¡é›†åˆï¼Œå­—å…¸æ˜¯æ— åºçš„å¯¹è±¡é›†åˆã€‚ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«åœ¨äºï¼šå­—å…¸å½“ä¸­çš„å…ƒç´ æ˜¯é€šè¿‡é”®æ¥å­˜å–çš„ï¼Œè€Œä¸æ˜¯é€šè¿‡åç§»å­˜å–ã€‚ å­—å…¸æ˜¯ä¸€ç§æ˜ å°„ç±»å‹ï¼Œå­—å…¸ç”¨ { } æ ‡è¯†ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ— åºçš„ é”®(key) : å€¼(value) çš„é›†åˆã€‚ é”®(key)å¿…é¡»ä½¿ç”¨ä¸å¯å˜ç±»å‹ã€‚ åœ¨åŒä¸€ä¸ªå­—å…¸ä¸­ï¼Œé”®(key)å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚ dict = 0:2dict[one] = 1dict[2] = twotinydict = 1:å¼ ä¸‰, sex:2print(dict) # 0: 2, one: 1, 2: twoprint(dict[2]) # twoprint(tinydict) # 1: å¼ ä¸‰, sex: 2print(tinydict.keys()) # dict_keys([1, sex])print(tinydict.values()) # dict_values([å¼ ä¸‰, 2]) æ„é€ å‡½æ•° dict() å¯ä»¥ç›´æ¥ä»é”®å€¼å¯¹åºåˆ—ä¸­æ„å»ºå­—å…¸å¦‚ä¸‹ï¼š dict([(Runoob, 1), (Google, 2), (Taobao, 3)])Runoob: 1, Google: 2, Taobao: 3 dict(Runoob=1, Google=2, Taobao=3)Runoob: 1, Google: 2, Taobao: 3 1ã€å­—å…¸æ˜¯ä¸€ç§æ˜ å°„ç±»å‹ï¼Œå®ƒçš„å…ƒç´ æ˜¯é”®å€¼å¯¹ã€‚2ã€å­—å…¸çš„å…³é”®å­—å¿…é¡»ä¸ºä¸å¯å˜ç±»å‹ï¼Œä¸”ä¸èƒ½é‡å¤ã€‚3ã€åˆ›å»ºç©ºå­—å…¸ä½¿ç”¨ **{ }**ã€‚ è®¿é—®å­—å…¸#!/usr/bin/python tinydict = Name: Zara, Age: 7, Class: First print(tinydict[Name]: , tinydict[Name]) # tinydict[Name]: Zaraprint(tinydict[Age]: , tinydict[Age]) # tinydict[Age]: 7 å¦‚æœç”¨å­—å…¸é‡Œæ²¡æœ‰çš„é”®è®¿é—®æ•°æ®ï¼Œä¼šè¾“å‡ºé”™è¯¯å¦‚ä¸‹ï¼š print tinydict[Alice]: , tinydict[Alice]tinydict[Alice]: Traceback (most recent call last): File test.py, line 5, in module print tinydict[Alice]: , tinydict[Alice]KeyError: Alice ä¿®æ”¹å­—å…¸å¸¸ç”¨å‘å­—å…¸æ·»åŠ æ–°å†…å®¹çš„æ–¹æ³•æ˜¯å¢åŠ æ–°çš„é”®å€¼å¯¹ï¼Œä¿®æ”¹æˆ–åˆ é™¤å·²æœ‰é”®å€¼å¯¹: tinydict = name: runoob, code: 1, site: www.runoob.comtinydict[name] = è€ç‹ # æ›´æ–°tinydict[sex] = 1 # æ·»åŠ print(tinydict[name]: , tinydict[name]) # tinydict[name]: è€ç‹print(tinydict[sex]) # 1 updatePythonä¸­çš„å­—å…¸ï¼ˆdictï¼‰çš„update()æ–¹æ³•ç”¨äºå°†ä¸€ä¸ªå­—å…¸æˆ–å…¶ä»–å¯è¿­ä»£å¯¹è±¡çš„é”®å€¼å¯¹æ›´æ–°åˆ°å½“å‰å­—å…¸ä¸­ã€‚ dict.update([other]) otherï¼ˆå¯é€‰ï¼‰ï¼šå¯ä»¥æ˜¯å¦ä¸€ä¸ªå­—å…¸ã€åŒ…å«é”®å€¼å¯¹çš„å¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚åˆ—è¡¨ã€å…ƒç»„ï¼‰ï¼Œæˆ–å…³é”®å­—å‚æ•°ã€‚ åŠŸèƒ½ï¼š â€Œè¦†ç›–æˆ–æ·»åŠ é”®å€¼å¯¹â€Œï¼šå¦‚æœå½“å‰å­—å…¸ä¸­å­˜åœ¨ç›¸åŒçš„é”®ï¼Œåˆ™æ›´æ–°å¯¹åº”çš„å€¼ï¼›å¦åˆ™æ·»åŠ æ–°çš„é”®å€¼å¯¹ã€‚ â€Œæ”¯æŒå¤šç§å‚æ•°ç±»å‹â€Œï¼šæ¥å—å­—å…¸ã€å¯è¿­ä»£å¯¹è±¡æˆ–å…³é”®å­—å‚æ•°ã€‚ å‚æ•°ç±»å‹ï¼š â€Œå­—å…¸æˆ–æ˜ å°„å¯¹è±¡ï¼š d1 = a: 1, b: 2d2 = b: 3, c: 4d1.update(d2) # d1å˜ä¸º a:1, b:3, c:4 â€Œå¯è¿­ä»£çš„é”®å€¼å¯¹ï¼š d = d.update([(a, 1), (b, 2)]) # då˜ä¸º a:1, b:2 â€Œå…³é”®å­—å‚æ•°*ï¼š d = a: 1d.update(b=2, c=3) # då˜ä¸º a:1, b:2, c:3 å¤„ç†é¡ºåºï¼š å…ˆå¤„ç†ä½ç½®å‚æ•°ï¼ˆå­—å…¸æˆ–å¯è¿­ä»£å¯¹è±¡ï¼‰ï¼Œå†å¤„ç†å…³é”®å­—å‚æ•°ã€‚ â€Œé‡å¤é”®çš„å€¼ä¼šè¢«è¦†ç›–â€Œï¼Œåå‡ºç°çš„å€¼ä¼˜å…ˆçº§æ›´é«˜ã€‚ d = x: 0d.update(x: 1, y: 2, x=3, z=4)# ç»“æœï¼šx:3, y:2, z:4 è¿”å›å€¼ï¼š update()æ˜¯åŸåœ°æ“ä½œï¼Œç›´æ¥ä¿®æ”¹åŸå­—å…¸ï¼Œè¿”å›Noneã€‚ é”™è¯¯æƒ…å†µï¼š â€Œæ— æ•ˆçš„é”®å€¼å¯¹ç»“æ„â€Œï¼š d.update([(a, 1, 2)]) # æŠ›å‡º ValueErrorï¼ˆå…ƒç´ é•¿åº¦ä¸ç¬¦ï¼‰ â€Œä¸å¯å“ˆå¸Œçš„é”®â€Œï¼š d.update([key]: 1) # æŠ›å‡º TypeErrorï¼ˆåˆ—è¡¨ä¸å¯ä½œä¸ºé”®ï¼‰ â€Œéå¯è¿­ä»£æˆ–éæ˜ å°„å¯¹è±¡â€Œï¼š d.update(None) # æŠ›å‡º TypeErrorï¼ˆå¯¹è±¡æ— æ•ˆï¼‰ æ³¨æ„äº‹é¡¹ï¼š è‹¥éœ€åˆå¹¶å¤šä¸ªå­—å…¸ï¼Œå¯å…ˆåˆå¹¶å†æ›´æ–°ï¼š d.update(dict1, dict2) é¿å…é“¾å¼æ“ä½œï¼ˆå› è¿”å›Noneï¼‰ï¼š # é”™è¯¯ç¤ºä¾‹d = d.update(other_dict) # d å˜ä¸º None ç¤ºä¾‹ä»£ç ï¼š # åŸºæœ¬ç”¨æ³•d = a: 1, b: 2d.update(b: 3, c: 4)print(d) # è¾“å‡º: a:1, b:3, c:4# æ··åˆå‚æ•°ç±»å‹d = x: 0d.update([(x, 1)], x=2, y=3)print(d) # è¾“å‡º: x:2, y:3# é”™è¯¯å¤„ç†try: d.update([(invalid,)])except ValueError as e: print(e) # è¾“å‡º: dictionary update sequence element #0 has length 1; 2 is required é€šè¿‡update()æ–¹æ³•ï¼Œå¯ä»¥çµæ´»åœ°åˆå¹¶å­—å…¸ã€è¦†ç›–å€¼æˆ–æ·»åŠ æ–°é”®å€¼å¯¹ï¼Œé€‚ç”¨äºéœ€è¦åŠ¨æ€æ›´æ–°å­—å…¸çš„åœºæ™¯ã€‚ åˆ é™¤å­—å…¸å…ƒç´ èƒ½åˆ å•ä¸€çš„å…ƒç´ ä¹Ÿèƒ½æ¸…ç©ºå­—å…¸ï¼Œæ¸…ç©ºåªéœ€ä¸€é¡¹æ“ä½œã€‚ æ˜¾ç¤ºåˆ é™¤ä¸€ä¸ªå­—å…¸ç”¨ del å‘½ä»¤ï¼š tinydict = name: runoob, code: 1, site: www.runoob.comdel tinydict[name] # åˆ é™¤é”®æ˜¯Nameçš„æ¡ç›®print (tinydict) # code: 1, site: www.runoob.comtinydict.clear() # æ¸…ç©ºå­—å…¸æ‰€æœ‰æ¡ç›®print (tinydict) # del tinydict # åˆ é™¤å­—å…¸print(tinydict) # åˆ é™¤åå­—å…¸ä¸å¯ç”¨ï¼Œä¼šæŠ¥é”™Traceback (most recent call last): File d:\\work\\styspace\\sty_python\\test.py, line 7, in module print(tinydict) ^^^^^^^^NameError: name tinydict is not defined å­—å…¸é”®çš„ç‰¹æ€§å­—å…¸å€¼å¯ä»¥æ²¡æœ‰é™åˆ¶åœ°å–ä»»ä½• Python å¯¹è±¡ï¼Œæ—¢å¯ä»¥æ˜¯æ ‡å‡†çš„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯ç”¨æˆ·å®šä¹‰çš„ï¼Œä½†é”®ä¸è¡Œã€‚ ä¸¤ä¸ªé‡è¦çš„ç‚¹éœ€è¦è®°ä½ï¼š 1ï¼‰ä¸å…è®¸åŒä¸€ä¸ªé”®å‡ºç°ä¸¤æ¬¡ã€‚åˆ›å»ºæ—¶å¦‚æœåŒä¸€ä¸ªé”®è¢«èµ‹å€¼ä¸¤æ¬¡ï¼Œåä¸€ä¸ªå€¼ä¼šè¦†ç›–å‰ä¸€ä¸ªå€¼ï¼š tinydict = name:è€ç‹print (tinydict[name]) # è€ç‹tinydict[name]=è€æprint (tinydict[name]) # è€æ 2ï¼‰é”®å¿…é¡»ä¸å¯å˜ï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ•°å­—ï¼Œå­—ç¬¦ä¸²æˆ–å…ƒç»„å……å½“ï¼Œç”¨åˆ—è¡¨å°±ä¸è¡Œï¼š tinydict = name:è€ç‹, 1:è€æ,(1,2):è€ç å­—print(tinydict.keys()) # dict_keys([name, 1, (1, 2)])print(tinydict[(1,2)]) # è€ç å­— tinydict = [1,2]: hello worldprint (tinydict)Traceback (most recent call last): File d:\\work\\styspace\\sty_python\\test.py, line 1, in module tinydict = [1,2]: hello world ^^^^^^^^^^^^^^^^^^^^^^TypeError: unhashable type: list å­—å…¸å†…ç½®å‡½æ•°æ–¹æ³•Python å­—å…¸åŒ…å«äº†ä»¥ä¸‹å†…ç½®å‡½æ•°ï¼š åºå· å‡½æ•°åŠæè¿° 1 cmp(dict1, dict2) æ¯”è¾ƒä¸¤ä¸ªå­—å…¸å…ƒç´ ã€‚ 2 len(dict) è®¡ç®—å­—å…¸å…ƒç´ ä¸ªæ•°ï¼Œå³é”®çš„æ€»æ•°ã€‚ 3 str(dict) è¾“å‡ºå­—å…¸å¯æ‰“å°çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚ 4 type(variable) è¿”å›è¾“å…¥çš„å˜é‡ç±»å‹ï¼Œå¦‚æœå˜é‡æ˜¯å­—å…¸å°±è¿”å›å­—å…¸ç±»å‹ã€‚ Python å­—å…¸åŒ…å«äº†ä»¥ä¸‹å†…ç½®æ–¹æ³•ï¼š åºå· å‡½æ•°åŠæè¿° 1 dict.clear() åˆ é™¤å­—å…¸å†…æ‰€æœ‰å…ƒç´  2 dict.copy() è¿”å›ä¸€ä¸ªå­—å…¸çš„æµ…å¤åˆ¶ 3 dict.fromkeys(seq , val]) åˆ›å»ºä¸€ä¸ªæ–°å­—å…¸ï¼Œä»¥åºåˆ— seq ä¸­å…ƒç´ åšå­—å…¸çš„é”®ï¼Œval ä¸ºå­—å…¸æ‰€æœ‰é”®å¯¹åº”çš„åˆå§‹å€¼ 4 dict.get(key, default None) è¿”å›æŒ‡å®šé”®çš„å€¼ï¼Œå¦‚æœå€¼ä¸åœ¨å­—å…¸ä¸­è¿”å› default å€¼ 6 dict.items() ä»¥åˆ—è¡¨è¿”å›å¯éå†çš„(é”®, å€¼) å…ƒç»„æ•°ç»„ 7 dict.keys() ä»¥åˆ—è¡¨è¿”å›ä¸€ä¸ªå­—å…¸æ‰€æœ‰çš„é”® 8 dict.setdefault(key, default None) å’Œ get()ç±»ä¼¼, ä½†å¦‚æœé”®ä¸å­˜åœ¨äºå­—å…¸ä¸­ï¼Œå°†ä¼šæ·»åŠ é”®å¹¶å°†å€¼è®¾ä¸º default 9 dict.update(dict2) æŠŠå­—å…¸ dict2 çš„é”®å€¼å¯¹æ›´æ–°åˆ° dict é‡Œ 10 dict.values() ä»¥åˆ—è¡¨è¿”å›å­—å…¸ä¸­çš„æ‰€æœ‰å€¼ 11 [pop(key, default]) åˆ é™¤å­—å…¸ç»™å®šé”® key æ‰€å¯¹åº”çš„å€¼ï¼Œè¿”å›å€¼ä¸ºè¢«åˆ é™¤çš„å€¼ã€‚key å€¼å¿…é¡»ç»™å‡ºã€‚ å¦åˆ™ï¼Œè¿”å› default å€¼ã€‚ 12 popitem() è¿”å›å¹¶åˆ é™¤å­—å…¸ä¸­çš„æœ€åä¸€å¯¹é”®å’Œå€¼ã€‚ defaultdictåŸºæœ¬æ¦‚å¿µï¼š defaultdict æ˜¯ dict çš„å­ç±»ï¼Œåœ¨è®¿é—®ä¸å­˜åœ¨çš„é”®æ—¶è‡ªåŠ¨ç”Ÿæˆé»˜è®¤å€¼ï¼Œé¿å… KeyError é”™è¯¯â€Œã€‚ é€šè¿‡æŒ‡å®š â€Œå·¥å‚å‡½æ•°â€Œ åˆå§‹åŒ–ï¼Œå¸¸è§ç±»å‹åŒ…æ‹¬ intã€listã€set ç­‰â€Œã€‚ åˆå§‹åŒ–ï¼š from collections import defaultdict# ç¤ºä¾‹1ï¼šé»˜è®¤å€¼ä¸º0ï¼ˆé€‚ç”¨äºè®¡æ•°åœºæ™¯ï¼‰count_dict = defaultdict(int) # ç¤ºä¾‹2ï¼šé»˜è®¤å€¼ä¸ºç©ºåˆ—è¡¨ï¼ˆé€‚ç”¨äºåˆ†ç»„åœºæ™¯ï¼‰group_dict = defaultdict(list) # ç¤ºä¾‹3ï¼šé»˜è®¤å€¼ä¸ºç©ºé›†åˆï¼ˆé€‚ç”¨äºå»é‡åœºæ™¯ï¼‰unique_dict = defaultdict(set) # ç¤ºä¾‹4ï¼šè‡ªå®šä¹‰é»˜è®¤å€¼ï¼ˆå¦‚ç©ºå¼ é‡ï¼‰import torchcustom_dict = defaultdict(lambda: torch.tensor([])) # â€Œ:ml-citationref=6 data=citationList æ³¨æ„äº‹é¡¹ï¼š â€Œå·¥å‚å‡½æ•°éœ€ä¸ºå¯è°ƒç”¨å¯¹è±¡â€Œä¾‹å¦‚ defaultdict(list) æ­£ç¡®ï¼Œè€Œ defaultdict([]) é”™è¯¯â€Œã€‚ â€Œæ€§èƒ½æƒè¡¡â€Œ ä¼˜åŠ¿ï¼šå¤„ç†å¤§é‡ç¼ºå¤±é”®æ—¶æ•ˆç‡é«˜äºæ™®é€šå­—å…¸â€Œã€‚ åŠ£åŠ¿ï¼šåˆå§‹åŒ–æ—¶éœ€é¢å¤–å†…å­˜å¼€é”€ï¼Œæ•°æ®é‡è¾ƒå°æ—¶å¯èƒ½ä¸å¦‚æ™®é€šå­—å…¸é«˜æ•ˆâ€Œã€‚ â€Œåºåˆ—åŒ–å…¼å®¹æ€§â€Œåºåˆ—åŒ–ï¼ˆå¦‚è½¬ JSONï¼‰å‰éœ€å°† defaultdict è½¬ä¸ºæ™®é€šå­—å…¸ï¼šdict(defaultdict_obj)â€Œã€‚ ç¤ºä¾‹ï¼š é¢˜ç›®ï¼šç»™å®šå››ä¸ªåŒ…å«æ•´æ•°çš„æ•°ç»„åˆ—è¡¨ A , B , C , D ,è®¡ç®—æœ‰å¤šå°‘ä¸ªå…ƒç»„ (i, j, k, l) ï¼Œä½¿å¾— A[i] + B[j] + C[k] + D[l] = 0ã€‚ä¸ºäº†ä½¿é—®é¢˜ç®€å•åŒ–ï¼Œæ‰€æœ‰çš„ A, B, C, D å…·æœ‰ç›¸åŒçš„é•¿åº¦ Nï¼Œä¸” 0 â‰¤ N â‰¤ 500 ã€‚æ‰€æœ‰æ•´æ•°çš„èŒƒå›´åœ¨ -2^28 åˆ° 2^28 - 1 ä¹‹é—´ï¼Œæœ€ç»ˆç»“æœä¸ä¼šè¶…è¿‡ 2^31 - 1 ã€‚ä¾‹å¦‚:è¾“å…¥:A = [ 1, 2]B = [-2,-1]C = [-1, 2]D = [ 0, 2]è¾“å‡º:2è§£é‡Š:ä¸¤ä¸ªå…ƒç»„å¦‚ä¸‹:(0, 0, 0, 1) - A[0] + B[0] + C[0] + D[1] = 1 + (-2) + (-1) + 2 = 0(1, 1, 0, 0) - A[1] + B[1] + C[0] + D[0] = 2 + (-1) + (-1) + 0 = 0from collections import defaultdict class Solution: def fourSumCount(self, nums1: list, nums2: list, nums3: list, nums4: list) - int: rec, cnt = defaultdict(lambda : 0), 0 for i in nums1: for j in nums2: rec[i+j] += 1 for i in nums3: for j in nums4: cnt += rec.get(-(i+j), 0) return cnt bytesåœ¨ Python3 ä¸­ï¼Œbytes ç±»å‹è¡¨ç¤ºçš„æ˜¯ä¸å¯å˜çš„äºŒè¿›åˆ¶åºåˆ—ï¼ˆbyte sequenceï¼‰ã€‚ ä¸å­—ç¬¦ä¸²ç±»å‹ä¸åŒçš„æ˜¯ï¼Œbytes ç±»å‹ä¸­çš„å…ƒç´ æ˜¯æ•´æ•°å€¼ï¼ˆ0 åˆ° 255 ä¹‹é—´çš„æ•´æ•°ï¼‰ï¼Œè€Œä¸æ˜¯ Unicode å­—ç¬¦ã€‚ bytes ç±»å‹é€šå¸¸ç”¨äºå¤„ç†äºŒè¿›åˆ¶æ•°æ®ï¼Œæ¯”å¦‚å›¾åƒæ–‡ä»¶ã€éŸ³é¢‘æ–‡ä»¶ã€è§†é¢‘æ–‡ä»¶ç­‰ç­‰ã€‚åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œä¹Ÿç»å¸¸ä½¿ç”¨ bytes ç±»å‹æ¥ä¼ è¾“äºŒè¿›åˆ¶æ•°æ®ã€‚ åˆ›å»º bytes å¯¹è±¡çš„æ–¹å¼æœ‰å¤šç§ï¼Œæœ€å¸¸è§çš„æ–¹å¼æ˜¯ä½¿ç”¨ b å‰ç¼€ï¼š æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ bytes() å‡½æ•°å°†å…¶ä»–ç±»å‹çš„å¯¹è±¡è½¬æ¢ä¸º bytes ç±»å‹ã€‚bytes() å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦è½¬æ¢çš„å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç¼–ç æ–¹ å¼ï¼Œå¦‚æœçœç•¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œåˆ™é»˜è®¤ä½¿ç”¨ UTF-8 ç¼–ç ï¼š x = bytes(hello, encoding=utf-8) ä¸å­—ç¬¦ä¸²ç±»å‹ç±»ä¼¼ï¼Œbytes ç±»å‹ä¹Ÿæ”¯æŒè®¸å¤šæ“ä½œå’Œæ–¹æ³•ï¼Œå¦‚åˆ‡ç‰‡ã€æ‹¼æ¥ã€æŸ¥æ‰¾ã€æ›¿æ¢ç­‰ç­‰ã€‚åŒæ—¶ï¼Œç”±äº bytes ç±»å‹æ˜¯ä¸å¯å˜çš„ï¼Œå› æ­¤åœ¨è¿› è¡Œä¿®æ”¹æ“ä½œæ—¶éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ bytes å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š x = bhelloy = x[1:3] # åˆ‡ç‰‡æ“ä½œï¼Œå¾—åˆ° belz = x + bworld # æ‹¼æ¥æ“ä½œï¼Œå¾—åˆ° bhelloworld éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œbytes ç±»å‹ä¸­çš„å…ƒç´ æ˜¯æ•´æ•°å€¼ï¼Œå› æ­¤åœ¨è¿›è¡Œæ¯”è¾ƒæ“ä½œæ—¶éœ€è¦ä½¿ç”¨ç›¸åº”çš„æ•´æ•°å€¼ã€‚ä¾‹å¦‚ï¼š x = bhelloif x[0] == ord(h): print(The first element is h) x = bhprint(x[0]) # 104 å…¶ä¸­ ord() å‡½æ•°ç”¨äºå°†å­—ç¬¦è½¬æ¢ä¸ºç›¸åº”çš„æ•´æ•°å€¼ã€‚ éå†æŠ€å·§åœ¨å­—å…¸ä¸­éå†æ—¶ï¼Œå…³é”®å­—å’Œå¯¹åº”çš„å€¼å¯ä»¥ä½¿ç”¨ items() æ–¹æ³•åŒæ—¶è§£è¯»å‡ºæ¥ï¼š dic = key1:v1, key2:2, 3:v3for k, v in dic.items(): print(k, v) è¾“å‡ºç»“æœï¼š key1 v1key2 23 v3 åœ¨åºåˆ—ä¸­éå†æ—¶ï¼Œç´¢å¼•ä½ç½®å’Œå¯¹åº”å€¼å¯ä»¥ä½¿ç”¨ enumerate() å‡½æ•°åŒæ—¶å¾—åˆ°ï¼š list_demo = [a,b,3]for i, v in enumerate(list_demo): print(i, v) è¾“å‡ºç»“æœï¼š 0 a1 b2 3 åŒæ—¶éå†ä¸¤ä¸ªæˆ–æ›´å¤šçš„åºåˆ—ï¼Œå¯ä»¥ä½¿ç”¨ zip() ç»„åˆï¼š list1 = [a,b,c]list2 = [d,e,f]for v1, v2 in zip(list1, list2): print(flist1 value v1, list2 value v2) è¾“å‡ºç»“æœï¼š list1 value a, list2 value dlist1 value b, list2 value elist1 value c, list2 value f è¦åå‘éå†ä¸€ä¸ªåºåˆ—ï¼Œé¦–å…ˆæŒ‡å®šè¿™ä¸ªåºåˆ—ï¼Œç„¶åè°ƒç”¨ reversed() å‡½æ•°ï¼š list = range(1,10,2)for i in reversed(list): print(i) è¾“å‡ºç»“æœï¼š 97531 è¦æŒ‰é¡ºåºéå†ä¸€ä¸ªåºåˆ—ï¼Œä½¿ç”¨ sorted() å‡½æ•°è¿”å›ä¸€ä¸ªå·²æ’åºçš„åºåˆ—ï¼Œå¹¶ä¸ä¿®æ”¹åŸå€¼ï¼š list = [3,1,9,5,7,5]for v in sorted(set(list)): print(v) è¾“å‡ºç»“æœï¼š 13579 æ•°æ®ç±»å‹è½¬æ¢æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ•°æ®å†…ç½®çš„ç±»å‹è¿›è¡Œè½¬æ¢ï¼Œæ•°æ®ç±»å‹çš„è½¬æ¢ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä½ åªéœ€è¦å°†æ•°æ®ç±»å‹ä½œä¸ºå‡½æ•°åå³å¯ã€‚ Python æ•°æ®ç±»å‹è½¬æ¢å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š éšå¼ç±»å‹è½¬æ¢ - è‡ªåŠ¨å®Œæˆ æ˜¾å¼ç±»å‹è½¬æ¢ - éœ€è¦ä½¿ç”¨ç±»å‹å‡½æ•°æ¥è½¬æ¢ éšå¼è½¬æ¢åœ¨éšå¼ç±»å‹è½¬æ¢ä¸­ï¼ŒPython ä¼šè‡ªåŠ¨å°†ä¸€ç§æ•°æ®ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§æ•°æ®ç±»å‹ï¼Œä¸éœ€è¦æˆ‘ä»¬å»å¹²é¢„ã€‚ ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯¹ä¸¤ç§ä¸åŒç±»å‹çš„æ•°æ®è¿›è¡Œè¿ç®—ï¼Œè¾ƒä½æ•°æ®ç±»å‹ï¼ˆæ•´æ•°ï¼‰å°±ä¼šè½¬æ¢ä¸ºè¾ƒé«˜æ•°æ®ç±»å‹ï¼ˆæµ®ç‚¹æ•°ï¼‰ä»¥é¿å…æ•°æ®ä¸¢å¤±ã€‚ num_int = 123num_float = 12.3num_new = num_int + num_floatprint(num_new) # 135.3print(type(num_new)) # class float num_int = 123num_str = 456print(num_int + num_str)Traceback (most recent call last): File d:\\work\\sty_project\\sty_python\\01.basic\\str.py, line 4, in module print(num_int + num_str) ~~~~~~~~^~~~~~~~~TypeError: unsupported operand type(s) for +: int and str ä»è¾“å‡ºä¸­å¯ä»¥çœ‹å‡ºï¼Œæ•´å‹å’Œå­—ç¬¦ä¸²ç±»å‹è¿ç®—ç»“æœä¼šæŠ¥é”™ï¼Œè¾“å‡º TypeErrorã€‚ Python åœ¨è¿™ç§æƒ…å†µä¸‹æ— æ³•ä½¿ç”¨éšå¼è½¬æ¢ã€‚ æ˜¾ç¤ºè½¬æ¢åœ¨æ˜¾å¼ç±»å‹è½¬æ¢ä¸­ï¼Œç”¨æˆ·å°†å¯¹è±¡çš„æ•°æ®ç±»å‹è½¬æ¢ä¸ºæ‰€éœ€çš„æ•°æ®ç±»å‹ã€‚ æˆ‘ä»¬ä½¿ç”¨ int()ã€float()ã€str() ç­‰é¢„å®šä¹‰å‡½æ•°æ¥æ‰§è¡Œæ˜¾å¼ç±»å‹è½¬æ¢ã€‚ int() å¼ºåˆ¶è½¬æ¢ä¸ºæ•´å‹ï¼š x = int(1) # x è¾“å‡ºç»“æœä¸º 1y = int(2.8) # y è¾“å‡ºç»“æœä¸º 2z = int(3) # z è¾“å‡ºç»“æœä¸º 3 float() å¼ºåˆ¶è½¬æ¢ä¸ºæµ®ç‚¹å‹ï¼š x = float(1) # x è¾“å‡ºç»“æœä¸º 1.0y = float(2.8) # y è¾“å‡ºç»“æœä¸º 2.8z = float(3) # z è¾“å‡ºç»“æœä¸º 3.0w = float(4.2) # w è¾“å‡ºç»“æœä¸º 4.2 æ•´å‹å’Œå­—ç¬¦ä¸²ç±»å‹è¿›è¡Œè¿ç®—ï¼Œå°±å¯ä»¥ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢æ¥å®Œæˆï¼š num_int = 123num_str = 456print(num_int æ•°æ®ç±»å‹ä¸º:,type(num_int)) # num_int æ•°æ®ç±»å‹ä¸º: class intprint(ç±»å‹è½¬æ¢å‰ï¼Œnum_str æ•°æ®ç±»å‹ä¸º:,type(num_str)) # ç±»å‹è½¬æ¢å‰ï¼Œnum_str æ•°æ®ç±»å‹ä¸º: class strnum_str = int(num_str) # å¼ºåˆ¶è½¬æ¢ä¸ºæ•´å‹print(ç±»å‹è½¬æ¢åï¼Œnum_str æ•°æ®ç±»å‹ä¸º:,type(num_str)) # ç±»å‹è½¬æ¢åï¼Œnum_str æ•°æ®ç±»å‹ä¸º: class intnum_sum = num_int + num_strprint(num_int ä¸ num_str ç›¸åŠ ç»“æœä¸º:,num_sum) # num_int ä¸ num_str ç›¸åŠ ç»“æœä¸º: 579print(sum æ•°æ®ç±»å‹ä¸º:,type(num_sum)) # sum æ•°æ®ç±»å‹ä¸º: class int å‡½æ•° è¯´æ˜ int(x [,base]) å°†xè½¬æ¢ä¸ºä¸€ä¸ªæ•´æ•°ï¼Œxè‹¥ä¸ºå­—ç¬¦ä¸²å¯ç”¨baseæŒ‡å®šè¿›åˆ¶ float(x) å°†xè½¬æ¢ä¸ºä¸€ä¸ªæµ®ç‚¹æ•° complex(real[,imag]) åˆ›å»ºä¸€ä¸ªå®éƒ¨ä¸ºrealï¼Œè™šéƒ¨ä¸ºimagçš„å¤æ•° str(x) å°†å¯¹è±¡xè½¬æ¢ä¸ºä¸€ä¸ªå­—ç¬¦ä¸² repr(x) å°†å¯¹è±¡xè½¬æ¢ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥è½¬ä¹‰å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦ eval(x) æ‰§è¡Œxå­—ç¬¦ä¸²è¡¨è¾¾å¼ï¼Œå¹¶è¿”å›è¡¨è¾¾å¼çš„å€¼ bin(x) å°†ä¸€ä¸ªæ•´æ•°è½¬æ¢ä¸ºä¸€ä¸ªäºŒè¿›åˆ¶å­—ç¬¦ä¸² oct(x) å°†ä¸€ä¸ªæ•´æ•°è½¬æ¢ä¸ºä¸€ä¸ªå…«è¿›åˆ¶å­—ç¬¦ä¸² hex(x) å°†ä¸€ä¸ªæ•´æ•°è½¬æ¢ä¸ºä¸€ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ä¸² ord(x) å°†ä¸€ä¸ªå­—ç¬¦è½¬æ¢ä¸ºå®ƒçš„ASCIIæ•´æ•°å€¼ chr(x) å°†ä¸€ä¸ªæ•´æ•°è½¬æ¢ä¸ºä¸€ä¸ªUnicodeå­—ç¬¦ tuple(s) å°†åºåˆ—sè½¬æ¢ä¸ºä¸€ä¸ªå…ƒç»„ list(s) å°†åºåˆ—sè½¬æ¢ä¸ºä¸€ä¸ªåˆ—è¡¨ set(s) è½¬æ¢sä¸ºå¯å˜é›†åˆ","tags":[null],"categories":[null]},{"title":"PythonåŸºç¡€è¯­æ³•","path":"/wiki/Python/åŸºç¡€è¯­æ³•.html","content":"ç¼–ç é»˜è®¤æƒ…å†µä¸‹ï¼ŒPython 3 æºç æ–‡ä»¶ä»¥ UTF-8 ç¼–ç ï¼Œæ‰€æœ‰å­—ç¬¦ä¸²éƒ½æ˜¯ unicode å­—ç¬¦ä¸²ã€‚ å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸ºæºç æ–‡ä»¶æŒ‡å®šä¸åŒçš„ç¼–ç ã€‚ # -*- coding: cp-1252 -*- æ ‡è¯†ç¬¦ ç¬¬ä¸€ä¸ªå­—ç¬¦å¿…é¡»æ˜¯å­—æ¯è¡¨ä¸­ å­—æ¯ æˆ–ä¸‹åˆ’çº¿ _ ã€‚ æ ‡è¯†ç¬¦çš„å…¶ä»–çš„éƒ¨åˆ†ç”± å­—æ¯ã€æ•°å­— å’Œ ä¸‹åˆ’çº¿ ç»„æˆã€‚ æ ‡è¯†ç¬¦å¯¹å¤§å°å†™æ•æ„Ÿã€‚ åœ¨ Python 3 ä¸­ï¼Œå¯ä»¥ç”¨ä¸­æ–‡ä½œä¸ºå˜é‡åï¼Œé ASCII æ ‡è¯†ç¬¦ä¹Ÿæ˜¯å…è®¸çš„äº†ã€‚ ä¿ç•™å­—Python çš„æ ‡å‡†åº“æä¾›äº†ä¸€ä¸ª keyword æ¨¡å—ï¼Œå¯ä»¥è¾“å‡ºå½“å‰ç‰ˆæœ¬çš„æ‰€æœ‰å…³é”®å­—ï¼š import keyword keyword.kwlist[False, None, True, and, as, assert, async, await, break, class, continue, def, del, elif, else, except, finally, for, from, global, if, import, in, is, lambda, nonlocal, not, or, pass, raise, return, try, while, with, yield] æ³¨é‡ŠPython ä¸­å•è¡Œæ³¨é‡Šä»¥ # å¼€å¤´ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š #!/usr/bin/python3 # ç¬¬ä¸€ä¸ªæ³¨é‡Šprint (Hello, Python!) # ç¬¬äºŒä¸ªæ³¨é‡Š å¤šè¡Œæ³¨é‡Šå¯ä»¥ç”¨å¤šä¸ª # å·ï¼Œæˆ–è€… â€˜â€™â€™ å’Œ **â€â€ â€œ**ï¼š #!/usr/bin/python3 # ç¬¬ä¸€ä¸ªæ³¨é‡Š# ç¬¬äºŒä¸ªæ³¨é‡Š å¤šè¡Œæ³¨é‡Šå¤šè¡Œæ³¨é‡Šå¤šè¡Œæ³¨é‡Šå¤šè¡Œæ³¨é‡Šprint (Hello, Python!) ä»£ç ç¼©è¿›Python æœ€å…·ç‰¹è‰²çš„å°±æ˜¯ä½¿ç”¨ç¼©è¿›æ¥è¡¨ç¤ºä»£ç å—ï¼Œä¸éœ€è¦ä½¿ç”¨å¤§æ‹¬å· {} ã€‚ ç¼©è¿›çš„ç©ºæ ¼æ•°æ˜¯å¯å˜çš„ï¼Œä½†æ˜¯åŒä¸€ä¸ªä»£ç å—çš„è¯­å¥å¿…é¡»åŒ…å«ç›¸åŒçš„ç¼©è¿›ç©ºæ ¼æ•°ã€‚å®ä¾‹å¦‚ä¸‹ï¼š if True: print(True)else: print(False) ä»¥ä¸‹ä»£ç æœ€åä¸€è¡Œè¯­å¥ç¼©è¿›æ•°çš„ç©ºæ ¼æ•°ä¸ä¸€è‡´ï¼Œä¼šå¯¼è‡´è¿è¡Œé”™è¯¯ï¼š if True: print(True)else: print(False) print(hello) # ç¼©è¿›ä¸ä¸€è‡´ï¼Œä¼šå¯¼è‡´è¿è¡Œé”™è¯¯ å¤šè¡Œè¯­å¥Python é€šå¸¸æ˜¯ä¸€è¡Œå†™å®Œä¸€æ¡è¯­å¥ï¼Œä½†å¦‚æœè¯­å¥å¾ˆé•¿ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åæ–œæ  \\ æ¥å®ç°å¤šè¡Œè¯­å¥ï¼Œä¾‹å¦‚ï¼š str = ä½  + \\å¥½ + \\å•Šprint(str) # ä½ å¥½å•Š åœ¨ [], {}, æˆ– () ä¸­çš„å¤šè¡Œè¯­å¥ï¼Œä¸éœ€è¦ä½¿ç”¨åæ–œæ  \\ï¼Œä¾‹å¦‚ï¼š str = [ä½ ,å¥½,å•Š]print(str) # [ä½ , å¥½, å•Š]str1 = ä½ ,å¥½,å•Šprint(str1) # ä½ , å¥½, å•Š ç©ºè¡Œå‡½æ•°ä¹‹é—´æˆ–ç±»çš„æ–¹æ³•ä¹‹é—´ç”¨ç©ºè¡Œåˆ†éš”ï¼Œè¡¨ç¤ºä¸€æ®µæ–°çš„ä»£ç çš„å¼€å§‹ã€‚ç±»å’Œå‡½æ•°å…¥å£ä¹‹é—´ä¹Ÿç”¨ä¸€è¡Œç©ºè¡Œåˆ†éš”ï¼Œä»¥çªå‡ºå‡½æ•°å…¥å£çš„å¼€å§‹ã€‚ ç©ºè¡Œä¸ä»£ç ç¼©è¿›ä¸åŒï¼Œç©ºè¡Œå¹¶ä¸æ˜¯ Python è¯­æ³•çš„ä¸€éƒ¨åˆ†ã€‚ä¹¦å†™æ—¶ä¸æ’å…¥ç©ºè¡Œï¼ŒPython è§£é‡Šå™¨è¿è¡Œä¹Ÿä¸ä¼šå‡ºé”™ã€‚ä½†æ˜¯ç©ºè¡Œçš„ä½œç”¨åœ¨äºåˆ† éš”ä¸¤æ®µä¸åŒåŠŸèƒ½æˆ–å«ä¹‰çš„ä»£ç ï¼Œä¾¿äºæ—¥åä»£ç çš„ç»´æŠ¤æˆ–é‡æ„ã€‚ è®°ä½ï¼š ç©ºè¡Œä¹Ÿæ˜¯ç¨‹åºä»£ç çš„ä¸€éƒ¨åˆ†ã€‚ class MyClass: def __init__(self, name): self.name = name def greet(self): # è¿™ä¸€è¡Œç©ºè¡Œç”¨äºåˆ†éš”ä¸åŒåŠŸèƒ½çš„ä»£ç  print(fHello, self.name!) # ç±»ä¸å‡½æ•°ä¹‹é—´æ’å…¥ç©ºè¡Œæ¥çªå‡ºå‡½æ•°å…¥å£ def farewell(self): print(fGoodbye, self.name!) ç­‰å¾…ç”¨æˆ·è¾“å…¥æ‰§è¡Œä¸‹é¢çš„ç¨‹åºåœ¨æŒ‰å›è½¦é”®åå°±ä¼šç­‰å¾…ç”¨æˆ·è¾“å…¥: #!/usr/bin/python3 input( æŒ‰ä¸‹ enter åé€€å‡º) ä»¥ä¸Šä»£ç ä¸­ ï¼Œ åœ¨ç»“æœè¾“å‡ºå‰ä¼šè¾“å‡ºä¸¤ä¸ªæ–°çš„ç©ºè¡Œã€‚ä¸€æ—¦ç”¨æˆ·æŒ‰ä¸‹ enter é”®æ—¶ï¼Œç¨‹åºå°†é€€å‡ºã€‚ åŒä¸€è¡Œæ˜¾ç¤ºå¤šæ¡è¯­å¥Python å¯ä»¥åœ¨åŒä¸€è¡Œä¸­ä½¿ç”¨å¤šæ¡è¯­å¥ï¼Œè¯­å¥ä¹‹é—´ä½¿ç”¨åˆ†å· ; åˆ†å‰²ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„å®ä¾‹ï¼š #!/usr/bin/python3 import sys; str = zhangsan; sys.stdout.write(str + ) å¤šä¸ªè¯­å¥æ„æˆä»£ç ç»„ç¼©è¿›ç›¸åŒ çš„ä¸€ç»„è¯­å¥æ„æˆä¸€ä¸ªä»£ç å—ï¼Œæˆ‘ä»¬ç§°ä¹‹ä»£ç ç»„ã€‚ åƒ ifã€whileã€def å’Œ class è¿™æ ·çš„å¤åˆè¯­å¥ï¼Œé¦–è¡Œä»¥å…³é”®å­—å¼€å§‹ï¼Œä»¥å†’å·( : )ç»“æŸï¼Œè¯¥è¡Œä¹‹åçš„ä¸€è¡Œæˆ–å¤šè¡Œä»£ç æ„æˆä»£ç ç»„ã€‚ æˆ‘ä»¬å°†é¦–è¡ŒåŠåé¢çš„ä»£ç ç»„ç§°ä¸ºä¸€ä¸ªå­å¥(clause)ã€‚ å¦‚ä¸‹å®ä¾‹ï¼š if expression : suiteelif expression : suite else : suite import ä¸ fromâ€¦importåœ¨ Python ç”¨ import æˆ–è€… fromâ€¦import æ¥å¯¼å…¥ç›¸åº”çš„æ¨¡å—ã€‚ å°†æ•´ä¸ªæ¨¡å—(somemodule)å¯¼å…¥ï¼Œæ ¼å¼ä¸ºï¼š import somemodule ä»æŸä¸ªæ¨¡å—ä¸­å¯¼å…¥æŸä¸ªå‡½æ•°, æ ¼å¼ä¸ºï¼š from somemodule import somefunction ä»æŸä¸ªæ¨¡å—ä¸­å¯¼å…¥å¤šä¸ªå‡½æ•°, æ ¼å¼ä¸ºï¼š from somemodule import firstfunc, secondfunc, thirdfunc å°†æŸä¸ªæ¨¡å—ä¸­çš„å…¨éƒ¨å‡½æ•°å¯¼å…¥ï¼Œæ ¼å¼ä¸ºï¼š from somemodule import * # å¯¼å…¥æ•´ä¸ªæ¨¡å—import mathprint(math.sqrt(16)) # è®¡ç®—å¹³æ–¹æ ¹# ä»æŸä¸ªæ¨¡å—ä¸­å¯¼å…¥æŸä¸ªå‡½æ•°from random import randintprint(randint(1, 10)) # ç”Ÿæˆ 1 åˆ° 10 ä¹‹é—´çš„éšæœºæ•´æ•°# ä»æŸä¸ªæ¨¡å—ä¸­å¯¼å…¥å¤šä¸ªå‡½æ•°from datetime import datetime, timedeltanow = datetime.now()print(Current time:, now)tomorrow = now + timedelta(days=1)print(Tomorrow:, tomorrow)# ä»æŸä¸ªæ¨¡å—ä¸­å¯¼å…¥æ‰€æœ‰å‡½æ•°ï¼ˆä¸æ¨èï¼Œå¯èƒ½å¯¼è‡´å‘½åå†²çªï¼‰from os import *print(getcwd()) # è·å–å½“å‰å·¥ä½œç›®å½• è¯´æ˜ï¼š import math ç›´æ¥å¯¼å…¥æ•´ä¸ª math æ¨¡å—ï¼Œéœ€è¦ä½¿ç”¨ math.sqrt() è®¿é—®å…¶å‡½æ•°ã€‚ from random import randint åªå¯¼å…¥ randintï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ randint()ã€‚ from datetime import datetime, timedelta åªå¯¼å…¥ datetime å’Œ timedeltaï¼Œé¿å…åŠ è½½æ•´ä¸ª datetime æ¨¡å—ã€‚ from os import * å¯¼å…¥ os æ¨¡å—çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå¯èƒ½ä¼šå¯¼è‡´å‘½åå†²çªï¼Œå› æ­¤é€šå¸¸ä¸æ¨èä½¿ç”¨ã€‚","tags":[null],"categories":[null]},{"title":"Pythonæ¨å¯¼å¼","path":"/wiki/Python/æ¨å¯¼å¼.html","content":"Python æ¨å¯¼å¼æ˜¯ä¸€ç§ç‹¬ç‰¹çš„æ•°æ®å¤„ç†æ–¹å¼ï¼Œå¯ä»¥ä»ä¸€ä¸ªæ•°æ®åºåˆ—æ„å»ºå¦ä¸€ä¸ªæ–°çš„æ•°æ®åºåˆ—çš„ç»“æ„ä½“ã€‚ Python æ¨å¯¼å¼æ˜¯ä¸€ç§å¼ºå¤§ä¸”ç®€æ´çš„è¯­æ³•ï¼Œé€‚ç”¨äºç”Ÿæˆåˆ—è¡¨ã€å­—å…¸ã€é›†åˆå’Œç”Ÿæˆå™¨ã€‚ åœ¨ä½¿ç”¨æ¨å¯¼å¼æ—¶ï¼Œéœ€è¦æ³¨æ„å¯è¯»æ€§ï¼Œå°½é‡ä¿æŒè¡¨è¾¾å¼ç®€æ´ï¼Œä»¥å…å½±å“ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ Python æ”¯æŒå„ç§æ•°æ®ç»“æ„çš„æ¨å¯¼å¼ï¼š åˆ—è¡¨(list)æ¨å¯¼å¼ å­—å…¸(dict)æ¨å¯¼å¼ é›†åˆ(set)æ¨å¯¼å¼ å…ƒç»„(tuple)æ¨å¯¼å¼ åˆ—è¡¨æ¨å¯¼å¼[è¡¨è¾¾å¼ for å˜é‡ in åˆ—è¡¨] [out_exp_res for out_exp in input_list]æˆ–è€… [è¡¨è¾¾å¼ for å˜é‡ in åˆ—è¡¨ if æ¡ä»¶][out_exp_res for out_exp in input_list if condition] out_exp_resï¼šåˆ—è¡¨ç”Ÿæˆå…ƒç´ è¡¨è¾¾å¼ï¼Œå¯ä»¥æ˜¯æœ‰è¿”å›å€¼çš„å‡½æ•°ã€‚ for out_exp in input_listï¼šè¿­ä»£ input_list å°† out_exp ä¼ å…¥åˆ° out_exp_res è¡¨è¾¾å¼ä¸­ã€‚ if conditionï¼šæ¡ä»¶è¯­å¥ï¼Œå¯ä»¥è¿‡æ»¤åˆ—è¡¨ä¸­ä¸ç¬¦åˆæ¡ä»¶çš„å€¼ã€‚ names = [Bob,Tom,alice,Jerry,Wendy,Smith]new_names = [name.upper() for name in names]print(new_names) # [BOB, TOM, ALICE, JERRY, WENDY, SMITH]lst = [1,2,3,4]new_lst = [i**2 for i in lst if i 2]print(new_lst) #[9, 16] å­—å…¸æ¨å¯¼å¼ key_expr: value_expr for value in collection æˆ– key_expr: value_expr for value in collection if condition list_demo = [google, baidu,byte dance]new_dict = v:len(v) for v in list_demoprint(new_dict) # google: 6, baidu: 5, byte dance: 10 dic = x:x**2 for x in range(4)print(dic) # 0: 0, 1: 1, 2: 4, 3: 9 é›†åˆæ¨å¯¼å¼ expression for item in Sequence æˆ– expression for item in Sequence if conditional set_new = i**2 for i in range(4)print(set_new) # 0, 1, 4, 9 a = x for x in abcdefgasdwe if x not in abcprint(a) # e, s, d, f, g, w å…ƒç»„æ¨å¯¼å¼å…ƒç»„æ¨å¯¼å¼å¯ä»¥åˆ©ç”¨ range åŒºé—´ã€å…ƒç»„ã€åˆ—è¡¨ã€å­—å…¸å’Œé›†åˆç­‰æ•°æ®ç±»å‹ï¼Œå¿«é€Ÿç”Ÿæˆä¸€ä¸ªæ»¡è¶³æŒ‡å®šéœ€æ±‚çš„å…ƒç»„ã€‚ å…ƒç»„æ¨å¯¼å¼åŸºæœ¬æ ¼å¼ï¼š (expression for item in Sequence )æˆ–(expression for item in Sequence if conditional ) å…ƒç»„æ¨å¯¼å¼å’Œåˆ—è¡¨æ¨å¯¼å¼çš„ç”¨æ³•ä¹Ÿå®Œå…¨ç›¸åŒï¼Œåªæ˜¯å…ƒç»„æ¨å¯¼å¼æ˜¯ç”¨ () åœ†æ‹¬å·å°†å„éƒ¨åˆ†æ‹¬èµ·æ¥ï¼Œè€Œåˆ—è¡¨æ¨å¯¼å¼ç”¨çš„æ˜¯ä¸­æ‹¬å· []ï¼Œå¦å¤– å…ƒç»„æ¨å¯¼å¼è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ã€‚ a = (x for x in range(1,10))print(a) # generator object genexpr at 0x000001A18D0D5F00","tags":[null],"categories":[null]},{"title":"Pythonæ¡ä»¶æ§åˆ¶","path":"/wiki/Python/æ¡ä»¶æ§åˆ¶.html","content":"if è¯­å¥if condition_1: statement_block_1elif condition_2: statement_block_2else: statement_block_3 å¦‚æœ â€œcondition_1â€ ä¸º True å°†æ‰§è¡Œ â€œstatement_block_1â€ å—è¯­å¥ å¦‚æœ â€œcondition_1â€ ä¸º Falseï¼Œå°†åˆ¤æ–­ â€œcondition_2â€ å¦‚æœ â€œcondition_2â€ ä¸º True å°†æ‰§è¡Œ â€œstatement_block_2â€ å—è¯­å¥ å¦‚æœ â€œcondition_2â€ ä¸º Falseï¼Œå°†æ‰§è¡Œ â€œstatement_block_3â€ å—è¯­å¥ Python ä¸­ç”¨ elif ä»£æ›¿äº† else ifï¼Œæ‰€ä»¥ if è¯­å¥çš„å…³é”®å­—ä¸ºï¼šif â€“ elif â€“ elseã€‚ æ³¨æ„ï¼š 1ã€æ¯ä¸ªæ¡ä»¶åé¢è¦ä½¿ç”¨å†’å· **:**ï¼Œè¡¨ç¤ºæ¥ä¸‹æ¥æ˜¯æ»¡è¶³æ¡ä»¶åè¦æ‰§è¡Œçš„è¯­å¥å—ã€‚ 2ã€ä½¿ç”¨ç¼©è¿›æ¥åˆ’åˆ†è¯­å¥å—ï¼Œç›¸åŒç¼©è¿›æ•°çš„è¯­å¥åœ¨ä¸€èµ·ç»„æˆä¸€ä¸ªè¯­å¥å—ã€‚ 3ã€åœ¨ Python ä¸­æ²¡æœ‰ switchâ€¦case è¯­å¥ï¼Œä½†åœ¨ Python3.10 ç‰ˆæœ¬æ·»åŠ äº† matchâ€¦caseï¼ŒåŠŸèƒ½ä¹Ÿç±»ä¼¼ã€‚ #!/usr/bin/python3 var1 = 100if var1: print (1 - if è¡¨è¾¾å¼æ¡ä»¶ä¸º true) print (var1) var2 = 0if var2: print (2 - if è¡¨è¾¾å¼æ¡ä»¶ä¸º true) print (var2)print (Good bye!) æ‰§è¡Œä»¥ä¸Šä»£ç ï¼Œè¾“å‡ºç»“æœä¸ºï¼š 1 - if è¡¨è¾¾å¼æ¡ä»¶ä¸º true100Good bye! ä»¥ä¸‹ä¸º if ä¸­å¸¸ç”¨çš„æ“ä½œè¿ç®—ç¬¦: æ“ä½œç¬¦ æè¿° å°äº = å°äºæˆ–ç­‰äº å¤§äº = å¤§äºæˆ–ç­‰äº == ç­‰äºï¼Œæ¯”è¾ƒä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ != ä¸ç­‰äº #!/usr/bin/python3 # ç¨‹åºæ¼”ç¤ºäº† == æ“ä½œç¬¦# ä½¿ç”¨æ•°å­—print(5 == 6) # False# ä½¿ç”¨å˜é‡x = 5y = 8print(x == y) # False #!/usr/bin/python3 # è¯¥å®ä¾‹æ¼”ç¤ºäº†æ•°å­—çŒœè°œæ¸¸æˆnumber = 7guess = -1print(æ•°å­—çŒœè°œæ¸¸æˆ!)while guess != number: guess = int(input(è¯·è¾“å…¥ä½ çŒœçš„æ•°å­—ï¼š)) if guess == number: print(æ­å–œï¼Œä½ çŒœå¯¹äº†ï¼) elif guess number: print(çŒœçš„æ•°å­—å°äº†...) elif guess number: print(çŒœçš„æ•°å­—å¤§äº†...) æ•°å­—çŒœè°œæ¸¸æˆ!è¯·è¾“å…¥ä½ çŒœçš„æ•°å­—ï¼š1çŒœçš„æ•°å­—å°äº†â€¦è¯·è¾“å…¥ä½ çŒœçš„æ•°å­—ï¼š9çŒœçš„æ•°å­—å¤§äº†â€¦è¯·è¾“å…¥ä½ çŒœçš„æ•°å­—ï¼š7æ­å–œï¼Œä½ çŒœå¯¹äº†ï¼ ä¸‰ç›®è¿ç®—è¯­æ³•æ ¼å¼ï¼š exp1 if contion else exp2# condition æ˜¯åˆ¤æ–­æ¡ä»¶ï¼Œexp1 å’Œ exp2 æ˜¯ä¸¤ä¸ªè¡¨è¾¾å¼ã€‚ å¦‚æœ condition æˆç«‹ï¼ˆç»“æœä¸ºçœŸï¼‰ï¼Œå°±æ‰§è¡Œ exp1ï¼Œå¹¶æŠŠ exp1 çš„ç»“æœä½œä¸ºæ•´ä¸ªè¡¨è¾¾å¼çš„ç»“æœï¼› å¦‚æœ condition ä¸æˆç«‹ï¼ˆç»“æœä¸ºå‡ï¼‰ï¼Œå°±æ‰§è¡Œ exp2ï¼Œå¹¶æŠŠ exp2 çš„ç»“æœä½œä¸ºæ•´ä¸ªè¡¨è¾¾å¼çš„ç»“æœã€‚ ç¤ºä¾‹ï¼š if ab: max = aelse: max = b æ›´åŠ ç®€æ´çš„å†™æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š max = a if ab else b max a if a b else b çš„å«ä¹‰æ˜¯ï¼š å¦‚æœ a b æˆç«‹ï¼Œå°±æŠŠ a ä½œä¸ºæ•´ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼Œå¹¶èµ‹ç»™å˜é‡ maxï¼› å¦‚æœ a b ä¸æˆç«‹ï¼Œå°±æŠŠ b ä½œä¸ºæ•´ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼Œå¹¶èµ‹ç»™å˜é‡ maxã€‚ if åµŒå¥—# !/usr/bin/python3 num=int(input(è¾“å…¥ä¸€ä¸ªæ•°å­—ï¼š))if num%2==0: if num%3==0: print (ä½ è¾“å…¥çš„æ•°å­—å¯ä»¥æ•´é™¤ 2 å’Œ 3) else: print (ä½ è¾“å…¥çš„æ•°å­—å¯ä»¥æ•´é™¤ 2ï¼Œä½†ä¸èƒ½æ•´é™¤ 3)else: if num%3==0: print (ä½ è¾“å…¥çš„æ•°å­—å¯ä»¥æ•´é™¤ 3ï¼Œä½†ä¸èƒ½æ•´é™¤ 2) else: print (ä½ è¾“å…¥çš„æ•°å­—ä¸èƒ½æ•´é™¤ 2 å’Œ 3) mathcâ€¦casePython 3.10 å¢åŠ äº† matchâ€¦case çš„æ¡ä»¶åˆ¤æ–­ï¼Œä¸éœ€è¦å†ä½¿ç”¨ä¸€è¿ä¸²çš„ if-else æ¥åˆ¤æ–­äº†ã€‚ match åçš„å¯¹è±¡ä¼šä¾æ¬¡ä¸ case åçš„å†…å®¹è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œåˆ™æ‰§è¡ŒåŒ¹é…åˆ°çš„è¡¨è¾¾å¼ï¼Œå¦åˆ™ç›´æ¥è·³è¿‡ï¼Œ_ å¯ä»¥åŒ¹é…ä¸€åˆ‡ã€‚ match subject: case pattern_1: action_1 case pattern_2: action_2 case pattern_3: action_3 case _: action_wildcard case _: ç±»ä¼¼äº C å’Œ Java ä¸­çš„ default:ï¼Œå½“å…¶ä»– case éƒ½æ— æ³•åŒ¹é…æ—¶ï¼ŒåŒ¹é…è¿™æ¡ï¼Œä¿è¯æ°¸è¿œä¼šåŒ¹é…æˆåŠŸã€‚ def http_error(status): match status: case 400: return Bad request case 404: return Not found case 418: return Im a teapot case _: return Somethings wrong with the internetmystatus=400print(http_error(400)) # Bad request ä¸€ä¸ª case ä¹Ÿå¯ä»¥è®¾ç½®å¤šä¸ªåŒ¹é…æ¡ä»¶ï¼Œæ¡ä»¶ä½¿ç”¨ ï½œ éš”å¼€ï¼Œä¾‹å¦‚ï¼š ... case 401|403|404: return Not allowed æ¡ä»¶åˆ¤æ–­ä¸­çš„éšå¼è½¬æ¢Python çš„ if è¯­å¥ä¼šè‡ªåŠ¨æ‰§è¡Œå¸ƒå°”è½¬æ¢ï¼Œä»¥ä¸‹å€¼è¢«è§†ä¸º Falseï¼š False | None | 0 | 0.0 | | [] | () | | set() | range(0) ç±»å‹åˆ¤æ–­æœ€ä½³å®è·µï¼š def check_value(val): # ä¸¥æ ¼åˆ¤æ–­Noneç±»å‹ if val is None: print(æœªèµ‹å€¼) # æ£€æŸ¥ç©ºå­—ç¬¦ä¸² elif isinstance(val, str) and not val: print(ç©ºå­—ç¬¦ä¸²) # æ£€æŸ¥æ•°å€¼é›¶ elif isinstance(val, (int, float)) and val == 0: print(é›¶å€¼) # æ£€æŸ¥ç©ºå®¹å™¨ elif hasattr(val, __len__) and not val: print(ç©ºå®¹å™¨) whilewhile åˆ¤æ–­æ¡ä»¶(condition)ï¼š æ‰§è¡Œè¯­å¥(statements)â€¦â€¦ #!/usr/bin/env python3 n = 100 sum = 0counter = 1while counter = n: sum = sum + counter counter += 1 print(1 åˆ° %d ä¹‹å’Œä¸º: %d % (n,sum)) # 1 åˆ° 100 ä¹‹å’Œä¸º: 5050 æ— é™å¾ªç¯å¯ä»¥å°†åˆ¤æ–­æ¡ä»¶è®¾ç½®ä¸º True å®ç°æ— é™å¾ªç¯ #!/usr/bin/python3 var = 1while var == 1 : # è¡¨è¾¾å¼æ°¸è¿œä¸º true num = int(input(è¾“å…¥ä¸€ä¸ªæ•°å­— :)) print (ä½ è¾“å…¥çš„æ•°å­—æ˜¯: , num) print (Good bye!) è¾“å‡ºç»“æœï¼š è¾“å…¥ä¸€ä¸ªæ•°å­— :5ä½ è¾“å…¥çš„æ•°å­—æ˜¯: 5è¾“å…¥ä¸€ä¸ªæ•°å­— : å¯ä»¥ä½¿ç”¨ CTRL+C æ¥é€€å‡ºå½“å‰çš„æ— é™å¾ªç¯ã€‚ whileâ€¦elseå¦‚æœ while åé¢çš„æ¡ä»¶è¯­å¥ä¸º false æ—¶ï¼Œåˆ™æ‰§è¡Œ else çš„è¯­å¥å—ã€‚ while expr: statement(s)else: additional_statement(s) expr æ¡ä»¶è¯­å¥ä¸º true åˆ™æ‰§è¡Œ statement(s) è¯­å¥å—ï¼Œå¦‚æœä¸º falseï¼Œåˆ™æ‰§è¡Œ additional_statement(s)ã€‚ å¾ªç¯è¾“å‡ºæ•°å­—ï¼Œå¹¶åˆ¤æ–­å¤§å°ï¼š #!/usr/bin/python3 count = 0while count 5: print (count, å°äº 5) count = count + 1else: print (count, å¤§äºæˆ–ç­‰äº 5) è¾“å‡ºç»“æœï¼š 0 å°äº 51 å°äº 52 å°äº 53 å°äº 54 å°äº 55 å¤§äºæˆ–ç­‰äº 5 forPython for å¾ªç¯å¯ä»¥éå†ä»»ä½•å¯è¿­ä»£å¯¹è±¡ï¼Œå¦‚ä¸€ä¸ªåˆ—è¡¨æˆ–è€…ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ for å¾ªç¯çš„ä¸€èˆ¬æ ¼å¼å¦‚ä¸‹ï¼š for variable in sequence: statementselse: statements #!/usr/bin/python3 sites = [Baidu, Google,Runoob,Taobao]for site in sites: print(site) è¾“å‡ºç»“æœï¼š BaiduGoogleRunoobTaobao ä¹Ÿå¯ç”¨äºæ‰“å°å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦ï¼š #!/usr/bin/python3 word = runoob for letter in word: print(letter) è¾“å‡ºç»“æœï¼š runoob æ•´æ•°èŒƒå›´å€¼å¯ä»¥é…åˆ range() å‡½æ•°ä½¿ç”¨ï¼š # 1 åˆ° 5 çš„æ‰€æœ‰æ•°å­—ï¼šfor number in range(1, 6): print(number) è¾“å‡ºç»“æœï¼š 12345 forâ€¦elseåœ¨ Python ä¸­ï¼Œfor...else è¯­å¥ç”¨äºåœ¨å¾ªç¯ç»“æŸåæ‰§è¡Œä¸€æ®µä»£ç ã€‚ for item in iterable: # å¾ªç¯ä¸»ä½“else: # å¾ªç¯ç»“æŸåæ‰§è¡Œçš„ä»£ç  å½“å¾ªç¯æ‰§è¡Œå®Œæ¯•ï¼ˆå³éå†å®Œ iterable ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼‰åï¼Œä¼šæ‰§è¡Œ else å­å¥ä¸­çš„ä»£ç ï¼Œå¦‚æœåœ¨å¾ªç¯è¿‡ç¨‹ä¸­é‡åˆ°äº† break è¯­å¥ï¼Œåˆ™ä¼šä¸­æ–­å¾ªç¯ï¼Œæ­¤æ—¶ä¸ä¼šæ‰§è¡Œ else å­å¥ã€‚ for x in range(6): print(x)else: print(Finally finished!) è¾“å‡ºç»“æœï¼š 012345Finally finished! ä»¥ä¸‹ for å®ä¾‹ä¸­ä½¿ç”¨äº† break è¯­å¥ï¼Œbreak è¯­å¥ç”¨äºè·³å‡ºå½“å‰å¾ªç¯ä½“ï¼Œä¸ä¼šæ‰§è¡Œ else å­å¥ï¼š #!/usr/bin/python3 sites = [Baidu, Google,Runoob,Taobao]for site in sites: if site == Runoob: print(èœé¸Ÿæ•™ç¨‹!) break print(å¾ªç¯æ•°æ® + site)else: print(æ²¡æœ‰å¾ªç¯æ•°æ®!)print(å®Œæˆå¾ªç¯!) è¾“å‡ºç»“æœï¼š å¾ªç¯æ•°æ® Baiduå¾ªç¯æ•°æ® Googleèœé¸Ÿæ•™ç¨‹!å®Œæˆå¾ªç¯! range()å‡½æ•°å¦‚æœä½ éœ€è¦éå†æ•°å­—åºåˆ—ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½® range() å‡½æ•°ã€‚å®ƒä¼šç”Ÿæˆæ•°åˆ—ï¼Œä¾‹å¦‚: for i in range(5): print(i) è¾“å‡ºç»“æœï¼š 01234 å¯ä»¥ä½¿ç”¨ range() æŒ‡å®šåŒºé—´çš„å€¼ï¼š for i in range(1,5): print(i) è¾“å‡ºç»“æœï¼š 1234 ä»¥ä½¿ range() ä»¥æŒ‡å®šæ•°å­—å¼€å§‹å¹¶æŒ‡å®šä¸åŒçš„å¢é‡(ç”šè‡³å¯ä»¥æ˜¯è´Ÿæ•°ï¼Œæœ‰æ—¶è¿™ä¹Ÿå«åšâ€™æ­¥é•¿â€™)ï¼š for i in range(1,10,2): print(i) for i in range(1,-10,-2): print(i) è¾“å‡ºç»“æœï¼š 13579 1-1-3-5-7-9 å¯ä»¥ç»“åˆ range() å’Œ len() å‡½æ•°ä»¥éå†ä¸€ä¸ªåºåˆ—çš„ç´¢å¼•, å¦‚ä¸‹æ‰€ç¤ºï¼š a = [Google, Baidu, Runoob, Taobao, QQ]for i in range(len(a)): print(i, a[i]) è¾“å‡ºç»“æœï¼š 0 Google1 Baidu2 Runoob3 Taobao4 QQ break å’Œ contiuebreak è¯­å¥å¯ä»¥è·³å‡º for å’Œ while çš„å¾ªç¯ä½“ã€‚å¦‚æœä½ ä» for æˆ– while å¾ªç¯ä¸­ç»ˆæ­¢ï¼Œä»»ä½•å¯¹åº”çš„å¾ªç¯ else å—å°†ä¸æ‰§è¡Œã€‚ continue è¯­å¥è¢«ç”¨æ¥å‘Šè¯‰ Python è·³è¿‡å½“å‰å¾ªç¯å—ä¸­çš„å‰©ä½™è¯­å¥ï¼Œç„¶åç»§ç»­è¿›è¡Œä¸‹ä¸€è½®å¾ªç¯ã€‚ n = 5while n 0: n -= 1 if n == 2: break print(n)print(å¾ªç¯ç»“æŸã€‚) è¾“å‡ºç»“æœï¼š 43å¾ªç¯ç»“æŸã€‚ n = 5while n 0: n -= 1 if n == 2: continue print(n)print(å¾ªç¯ç»“æŸã€‚) è¾“å‡ºç»“æœï¼š 4310å¾ªç¯ç»“æŸã€‚ å¾ªç¯è¯­å¥å¯ä»¥æœ‰ else å­å¥ï¼Œå®ƒåœ¨ç©·å°½åˆ—è¡¨(ä»¥ for å¾ªç¯)æˆ–æ¡ä»¶å˜ä¸º false (while å¾ªç¯)å¯¼è‡´å¾ªç¯ç»ˆæ­¢æ—¶è¢«æ‰§è¡Œï¼Œä½† å¾ªç¯è¢« break ç»ˆæ­¢æ—¶ä¸æ‰§è¡Œã€‚ a = [Google, Baidu, Runoob, Taobao, QQ]for i in range(len(a)): print(i, a[i]) if i == 2: breakelse: print(end) è¾“å‡ºç»“æœï¼š 0 Google1 Baidu2 Runoob pass è¯­å¥Python pass æ˜¯ç©ºè¯­å¥ï¼Œæ˜¯ä¸ºäº†ä¿æŒç¨‹åºç»“æ„çš„å®Œæ•´æ€§ã€‚ pass ä¸åšä»»ä½•äº‹æƒ…ï¼Œä¸€èˆ¬ç”¨åšå ä½è¯­å¥ã€‚ #!/usr/bin/python3 for letter in Runoob: if letter == o: pass print (æ‰§è¡Œ pass å—) print (å½“å‰å­—æ¯ :, letter) print (Good bye!) è¾“å‡ºç»“æœï¼š å½“å‰å­—æ¯ : Rå½“å‰å­—æ¯ : uå½“å‰å­—æ¯ : næ‰§è¡Œ pass å—å½“å‰å­—æ¯ : oæ‰§è¡Œ pass å—å½“å‰å­—æ¯ : oå½“å‰å­—æ¯ : bGood bye! end å…³é”®å­—å…³é”®å­— end å¯ä»¥ç”¨äºå°†ç»“æœè¾“å‡ºåˆ°åŒä¸€è¡Œï¼Œæˆ–è€…åœ¨è¾“å‡ºçš„æœ«å°¾æ·»åŠ ä¸åŒçš„å­—ç¬¦ã€‚ #!/usr/bin/python3 # Fibonacci series: æ–æ³¢çº³å¥‘æ•°åˆ—# ä¸¤ä¸ªå…ƒç´ çš„æ€»å’Œç¡®å®šäº†ä¸‹ä¸€ä¸ªæ•°a, b = 0, 1while b 1000: print(b, end=,) a, b = b, a+b è¾“å‡ºç»“æœï¼š 1,1,2,3,5,8,13,21,34,55,89,144,233,377,610,987,","tags":[null],"categories":[null]},{"title":"Pythonæšä¸¾","path":"/wiki/Python/æšä¸¾.html","content":"åŸºæœ¬æ¦‚å¿µPythoné€šè¿‡ enum æ¨¡å—å®ç°æšä¸¾ç±»å‹ï¼Œéœ€ç»§æ‰¿ Enum åŸºç±»ï¼š from enum import Enumclass Color(Enum): RED = 1 GREEN = 2 BLUE = 3 # æˆå‘˜å€¼å¯ä¸ºä»»æ„æ•°æ®ç±»å‹â€Œ æ ¸å¿ƒç‰¹æ€§çŠ¶æ€è¡¨ç¤ºï¼š class OrderStatus(Enum): PENDING = 10 PAID = 20 SHIPPED = 30 # ä»£æ›¿é­”æ³•æ•°å­— ç±»å‹å®‰å…¨éªŒè¯ï¼š def process_color(color: Color): if not isinstance(color, Color): raise TypeError(å¿…é¡»ä¼ å…¥Coloræšä¸¾) é…ç½®ç®¡ç†ï¼š class EnvConfig(Enum): DEV = dev.example.com PROD = api.example.comâ€œ å¸¸ç”¨æ–¹æ³•from enum import Enum, autoclass Status(Enum): # æ˜¾å¼èµ‹å€¼ ACTIVE = 10 INACTIVE = 20 # è‡ªåŠ¨é€’å¢èµ‹å€¼ï¼ˆé€‚ç”¨äºæ•´æ•°ï¼‰ PENDING = auto() # è‡ªåŠ¨ç”Ÿæˆ# è®¿é—®æ–¹å¼print(Status.ACTIVE) # è¾“å‡º: Status.ACTIVEprint(Status[INACTIVE]) # é€šè¿‡åç§°è®¿é—®print(Status(20)) # é€šè¿‡å€¼è·å–æˆå‘˜ æˆå‘˜å±æ€§æå–Status.ACTIVE.name # ACTIVEStatus.PENDING.value # 21ï¼ˆè‡ªåŠ¨ç”Ÿæˆå€¼)","tags":[null],"categories":[null]},{"title":"Pythonæ¨¡å—","path":"/wiki/Python/æ¨¡å—ä¸åŒ….html","content":"æ¦‚å¿µPythonä¸­ä¸€ä¸ªä»¥.pyç»“å°¾çš„æºæ–‡ä»¶å³ä¸ºä¸€ä¸ªæ¨¡å—ï¼ˆModuleï¼‰ã€‚å…¶ä¸­å¯ä»¥åŒ…å«å˜é‡ã€å‡½æ•°å’Œç±»ç­‰ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æŠŠèƒ½å¤Ÿå®ç°æŸä¸€ç‰¹å®šåŠŸèƒ½çš„ä»£ç æ”¾ç½®åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ä½œä¸ºä¸€ä¸ªæ¨¡å—ã€‚ æ¨¡å—å¯ä»¥åŒ…å«å‡½æ•°ã€ç±»ã€å˜é‡ä»¥åŠå¯æ‰§è¡Œçš„ä»£ç ã€‚é€šè¿‡æ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»£ç ç»„ç»‡æˆå¯é‡ç”¨çš„å•å…ƒï¼Œä¾¿äºç®¡ç†å’Œç»´æŠ¤ã€‚ æ¨¡å—çš„ä½œç”¨: ä»£ç å¤ç”¨ï¼šå°†å¸¸ç”¨çš„åŠŸèƒ½å°è£…åˆ°æ¨¡å—ä¸­ï¼Œå¯ä»¥åœ¨å¤šä¸ªç¨‹åºä¸­é‡å¤ä½¿ç”¨ã€‚ å‘½åç©ºé—´ç®¡ç†ï¼šæ¨¡å—å¯ä»¥é¿å…å‘½åå†²çªï¼Œä¸åŒæ¨¡å—ä¸­çš„åŒåå‡½æ•°æˆ–å˜é‡ä¸ä¼šäº’ç›¸å¹²æ‰°ã€‚ ä»£ç ç»„ç»‡ï¼šå°†ä»£ç æŒ‰åŠŸèƒ½åˆ’åˆ†åˆ°ä¸åŒçš„æ¨¡å—ä¸­ï¼Œä½¿ç¨‹åºç»“æ„æ›´æ¸…æ™°ã€‚ è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ Python æ ‡å‡†åº“ä¸­æ¨¡å—çš„ä¾‹å­ã€‚ #!/usr/bin/python3# æ–‡ä»¶å: using_sys.py import sys print(å‘½ä»¤è¡Œå‚æ•°å¦‚ä¸‹:)for i in sys.argv: print(i) print( Python è·¯å¾„ä¸ºï¼š, sys.path, ) æ‰§è¡Œç»“æœï¼š $ Python using_sys.py å‚æ•° 1 å‚æ•° 2å‘½ä»¤è¡Œå‚æ•°å¦‚ä¸‹:using_sys.pyå‚æ•° 1å‚æ•° 2 Python è·¯å¾„ä¸ºï¼š [â€˜rootâ€™, â€˜usrlibpython3.4â€™, â€˜usrlibpython3.4plat-x86_64-linux-gnuâ€™, â€˜usrlibpython3.4lib-dynloadâ€™, â€˜usrlocallibpython3.4dist-packagesâ€™, â€˜usrlibpython3dist-packagesâ€™] 1ã€import sys å¼•å…¥ Python æ ‡å‡†åº“ä¸­çš„ sys.py æ¨¡å—ï¼›è¿™æ˜¯å¼•å…¥æŸä¸€æ¨¡å—çš„æ–¹æ³•ã€‚ 2ã€sys.argv æ˜¯ä¸€ä¸ªåŒ…å«å‘½ä»¤è¡Œå‚æ•°çš„åˆ—è¡¨ã€‚ 3ã€sys.path åŒ…å«äº†ä¸€ä¸ª Python è§£é‡Šå™¨è‡ªåŠ¨æŸ¥æ‰¾æ‰€éœ€æ¨¡å—çš„è·¯å¾„çš„åˆ—è¡¨ã€‚ åˆ›å»ºæ¨¡å—æ¨¡å—ååŒºåˆ†å¤§å°å†™ï¼Œä¸”ä¸èƒ½ä¸Pythonè‡ªå¸¦çš„æ ‡å‡†æ¨¡å—é‡åã€‚åˆ›å»ºä¸€ä¸ªæ¨¡å— my_add.py num =100def add(a, b): æ±‚ä¸¤ä¸ªæ•°çš„å’Œ return a + b å¯¼å…¥æ¨¡å—å…¨éƒ¨å¯¼å…¥ importå¯¼å…¥æ¨¡å—çš„æ‰€æœ‰æˆå‘˜ï¼Œé€šè¿‡æ¨¡å—å.æˆå‘˜åçš„æ–¹å¼è®¿é—®ã€‚å³ä½¿å¤šæ¬¡ä½¿ç”¨ importå¯¼å…¥åŒä¸€æ¨¡å—ï¼Œæ¨¡å—ä¹Ÿåªä¼šè¢«å¯¼å…¥ä¸€æ¬¡ã€‚ import æ¨¡å—å [as åˆ«å] åœ¨åŒä¸€ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªmain.pyæ–‡ä»¶ï¼Œåœ¨å…¶ä¸­å¯¼å…¥ my_add.py æ¨¡å—å¹¶ä½¿ç”¨ã€‚ main.py # å¯¼å…¥æ¨¡å—import my_add# ä½¿ç”¨æ¨¡å—print(my_add.add(1, 2))print(my_add.num) ä¹Ÿå¯ä»¥åœ¨å¯¼å…¥æ¨¡å—æ—¶ç»™æ¨¡å—èµ·åˆ«åã€‚ # å¯¼å…¥æ¨¡å—import my_add as a1# ä½¿ç”¨æ¨¡å—print(a1.add(1, 2))print(a1.num) å±€éƒ¨å¯¼å…¥ from importæŒ‡å®šå¯¼å…¥æ¨¡å—çš„éƒ¨åˆ†æˆå‘˜ï¼Œç›´æ¥é€šè¿‡æˆå‘˜åçš„æ–¹å¼è®¿é—®ã€‚åªèƒ½ä½¿ç”¨å…¶å¯¼å…¥çš„æˆå‘˜,æœªå¯¼å…¥çš„æˆå‘˜ä¸èƒ½ä½¿ç”¨ã€‚å¦‚æœå¤šä¸ªæ¨¡å—ä¸­å­˜åœ¨é‡åæˆå‘˜ï¼Œåä¸€æ¬¡å¯¼å…¥ä¼šè¦†ç›–å‰ä¸€æ¬¡å¯¼å…¥ã€‚ from æ¨¡å—å import æˆå‘˜å1[as åˆ«å], æˆå‘˜å2[as åˆ«å],â€¦ åˆ›å»ºæ–°æ¨¡å— my_multi.py num =200_str1=abcdef multi(a, b): æ±‚ä¸¤ä¸ªæ•°çš„ç§¯ return a * b main.py from my_add import add print(add(1, 2))# åªèƒ½ä½¿ç”¨å¯¼å…¥çš„æˆå‘˜print(num) # NameError: name num is not defined é€šè¿‡åˆ«ååŒºåˆ†ä¸åŒæ¨¡å—çš„å˜é‡ã€‚ # å¯¼å…¥æ¨¡å—from my_add import add,num as a1from my_multi import num as m1# ä½¿ç”¨æ¨¡å—print(add(1, 2)) # 3print(a1) # 100print(m1) # 200 å±€éƒ¨å¯¼å…¥ from import *å¯¼å…¥æ¨¡å—ä¸­æ‰€æœ‰ä¸ä»¥å•ä¸‹åˆ’çº¿å¼€å¤´çš„æˆå‘˜ï¼Œç›´æ¥é€šè¿‡æˆå‘˜åçš„æ–¹å¼è®¿é—®ã€‚ from æ¨¡å—å import * # å¯¼å…¥æ¨¡å—from my_add import *# ä½¿ç”¨æ¨¡å—print(add(1, 2))print(num)print(_str1) __all__å±æ€§ä½¿ç”¨from import *å¯¼å…¥æ¨¡å—æ—¶ï¼Œå¯ä»¥åœ¨è¢«å¯¼å…¥çš„æ¨¡å—ä¸­ä½¿ç”¨ __all__è®¾ç½®å“ªäº›å†…å®¹å¯ä»¥è¢«å¯¼å…¥ã€‚__all__ çš„è®¾ç½®åªé’ˆå¯¹ä½¿ç”¨ from import* å¯¼å…¥æ¨¡å—æ—¶æœ‰æ•ˆã€‚ my_add.py __all__ = [num,add] # å†…å®¹å¿…é¡»è¦ç”¨å¼•å·å¼•èµ·æ¥num = 100num1 = 200_str1=abcdef add(a, b): æ±‚ä¸¤ä¸ªæ•°çš„å’Œ return a + b main.py from my_add import *print(add(1, 2))print(num)print(num1) # NameError: name num1 is not defined è€Œä½¿ç”¨import my_addå…¨å±€å¯¼å…¥æ¨¡å—åå¯ä»¥æ­£å¸¸ä½¿ç”¨æ‰€æœ‰å…ƒç´ ã€‚ import my_addprint(my_add.add(1, 2))print(my_add.num)print(my_add.num1) æ¨¡å—æœç´¢è·¯å¾„å½“æˆ‘ä»¬ä½¿ç”¨ import è¯­å¥çš„æ—¶å€™ï¼ŒPython è§£é‡Šå™¨æ˜¯æ€æ ·æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶çš„å‘¢ï¼Ÿ è¿™å°±æ¶‰åŠåˆ° Python çš„æœç´¢è·¯å¾„ï¼Œæœç´¢è·¯å¾„æ˜¯ç”±ä¸€ç³»åˆ—ç›®å½•åç»„æˆçš„ï¼ŒPython è§£é‡Šå™¨å°±ä¾æ¬¡ä»è¿™äº›ç›®å½•ä¸­å»å¯»æ‰¾æ‰€å¼•å…¥çš„æ¨¡å—ã€‚ å½“å¯¼å…¥ä¸€ä¸ªæ¨¡å—æ—¶ï¼ŒPython ä¼šæŒ‰ç…§ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾æ¨¡å—ï¼š å½“å‰ç›®å½•ã€‚ ç¯å¢ƒå˜é‡ PYTHONPATH æŒ‡å®šçš„ç›®å½•ã€‚ Python æ ‡å‡†åº“ç›®å½•ã€‚ .pth æ–‡ä»¶ä¸­æŒ‡å®šçš„ç›®å½•ã€‚ æœç´¢è·¯å¾„æ˜¯åœ¨ Python ç¼–è¯‘æˆ–å®‰è£…çš„æ—¶å€™ç¡®å®šçš„ï¼Œå®‰è£…æ–°çš„åº“åº”è¯¥ä¹Ÿä¼šä¿®æ”¹ã€‚æœç´¢è·¯å¾„è¢«å­˜å‚¨åœ¨ sys æ¨¡å—ä¸­çš„ path å˜é‡ï¼Œåšä¸€ä¸ªç®€å•çš„å®éªŒï¼Œåœ¨äº¤äº’å¼è§£é‡Šå™¨ä¸­ï¼Œè¾“å…¥ä»¥ä¸‹ä»£ç ï¼š import sys sys.path[, D:\\\\work\\\\tools\\\\python\\\\python313.zip, D:\\\\work\\\\tools\\\\python\\\\DLLs, D:\\\\work\\\\tools\\\\python\\\\Lib, D:\\\\work\\\\tools\\\\python, D:\\\\work\\\\tools\\\\python\\\\Lib\\\\site-packages] sys.path è¾“å‡ºæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­ç¬¬ä¸€é¡¹æ˜¯ç©ºä¸² â€˜â€™ï¼Œä»£è¡¨å½“å‰ç›®å½•ï¼ˆè‹¥æ˜¯ä»ä¸€ä¸ªè„šæœ¬ä¸­æ‰“å°å‡ºæ¥çš„è¯ï¼Œå¯ä»¥æ›´æ¸…æ¥šåœ°çœ‹å‡ºæ˜¯å“ªä¸ªç›®å½•ï¼‰ï¼Œäº¦å³æˆ‘ä»¬æ‰§è¡Œ Python è§£é‡Šå™¨çš„ç›®å½•ï¼ˆå¯¹äºè„šæœ¬çš„è¯å°±æ˜¯è¿è¡Œçš„è„šæœ¬æ‰€åœ¨çš„ç›®å½•ï¼‰ã€‚ å› æ­¤è‹¥åƒæˆ‘ä¸€æ ·åœ¨å½“å‰ç›®å½•ä¸‹å­˜åœ¨ä¸è¦å¼•å…¥æ¨¡å—åŒåçš„æ–‡ä»¶ï¼Œå°±ä¼šæŠŠè¦å¼•å…¥çš„æ¨¡å—å±è”½æ‰ã€‚ äº†è§£äº†æœç´¢è·¯å¾„çš„æ¦‚å¿µï¼Œå°±å¯ä»¥åœ¨è„šæœ¬ä¸­ä¿®æ”¹ sys.path æ¥å¼•å…¥ä¸€äº›ä¸åœ¨æœç´¢è·¯å¾„ä¸­çš„æ¨¡å—ã€‚ åœ¨å½“å‰ç›®å½•æ–°å»º fibo.py fibo.py # æ–æ³¢é‚£å¥‘(fibonacci)æ•°åˆ—æ¨¡å— def fib(n): # å®šä¹‰åˆ° n çš„æ–æ³¢é‚£å¥‘æ•°åˆ— a, b = 0, 1 while b n: print(b, end= ) a, b = b, a+b print() åœ¨åŒçº§ç›®å½•æ–°å»º hello.py å¯¼å…¥ fibo.py hello.py import fibo# å¯ä»¥ä½¿ç”¨æ¨¡å—åç§°æ¥è®¿é—®å‡½æ•°fibo.fib(10) # 1 1 2 3 5 8 å¦‚æœç»å¸¸ä½¿ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥æŠŠå®ƒèµ‹ç»™ä¸€ä¸ªæœ¬åœ°çš„åç§°ï¼š import fibofib = fibo.fibfib(10) # 1 1 2 3 5 8 åˆ«åä½¿ç”¨ as å…³é”®å­—ä¸ºæ¨¡å—æˆ–å‡½æ•°èµ·åˆ«åï¼š import numpy as np # å°† numpy æ¨¡å—åˆ«åè®¾ç½®ä¸º npfrom math import sqrt as square_root # å°† sqrt å‡½æ•°åˆ«åè®¾ç½®ä¸º square_root æ·±å…¥æ¨¡å—æ¨¡å—é™¤äº†æ–¹æ³•å®šä¹‰ï¼Œè¿˜å¯ä»¥åŒ…æ‹¬å¯æ‰§è¡Œçš„ä»£ç ã€‚è¿™äº›ä»£ç ä¸€èˆ¬ç”¨æ¥åˆå§‹åŒ–è¿™ä¸ªæ¨¡å—ã€‚è¿™äº›ä»£ç åªæœ‰åœ¨ç¬¬ä¸€æ¬¡è¢«å¯¼å…¥æ—¶æ‰ä¼šè¢«æ‰§è¡Œã€‚ æ¯ä¸ªæ¨¡å—æœ‰å„è‡ªç‹¬ç«‹çš„ç¬¦å·è¡¨ï¼Œåœ¨æ¨¡å—å†…éƒ¨ä¸ºæ‰€æœ‰çš„å‡½æ•°å½“ä½œå…¨å±€ç¬¦å·è¡¨æ¥ä½¿ç”¨ã€‚ æ‰€ä»¥ï¼Œæ¨¡å—çš„ä½œè€…å¯ä»¥æ”¾å¿ƒå¤§èƒ†çš„åœ¨æ¨¡å—å†…éƒ¨ä½¿ç”¨è¿™äº›å…¨å±€å˜é‡ï¼Œè€Œä¸ç”¨æ‹…å¿ƒæŠŠå…¶ä»–ç”¨æˆ·çš„å…¨å±€å˜é‡ææ··ã€‚ ä»å¦ä¸€ä¸ªæ–¹é¢ï¼Œå½“ä½ ç¡®å®çŸ¥é“ä½ åœ¨åšä»€ä¹ˆçš„è¯ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ modname.itemname è¿™æ ·çš„è¡¨ç¤ºæ³•æ¥è®¿é—®æ¨¡å—å†…çš„å‡½æ•°ã€‚ æ¨¡å—æ˜¯å¯ä»¥å¯¼å…¥å…¶ä»–æ¨¡å—çš„ã€‚åœ¨ä¸€ä¸ªæ¨¡å—ï¼ˆæˆ–è€…è„šæœ¬ï¼Œæˆ–è€…å…¶ä»–åœ°æ–¹ï¼‰çš„æœ€å‰é¢ä½¿ç”¨ import æ¥å¯¼å…¥ä¸€ä¸ªæ¨¡å—ï¼Œå½“ç„¶è¿™åªæ˜¯ä¸€ä¸ªæƒ¯ä¾‹ï¼Œè€Œä¸æ˜¯å¼ºåˆ¶çš„ã€‚è¢«å¯¼å…¥çš„æ¨¡å—çš„åç§°å°†è¢«æ”¾å…¥å½“å‰æ“ä½œçš„æ¨¡å—çš„ç¬¦å·è¡¨ä¸­ã€‚ è¿˜æœ‰ä¸€ç§å¯¼å…¥çš„æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨ import ç›´æ¥æŠŠæ¨¡å—å†…ï¼ˆå‡½æ•°ï¼Œå˜é‡çš„ï¼‰åç§°å¯¼å…¥åˆ°å½“å‰æ“ä½œæ¨¡å—ã€‚æ¯”å¦‚: from fibo import fib è¿™ç§å¯¼å…¥çš„æ–¹æ³•ä¸ä¼šæŠŠè¢«å¯¼å…¥çš„æ¨¡å—çš„åç§°æ”¾åœ¨å½“å‰çš„å­—ç¬¦è¡¨ä¸­ï¼ˆæ‰€ä»¥åœ¨è¿™ä¸ªä¾‹å­é‡Œé¢ï¼Œfibo è¿™ä¸ªåç§°æ˜¯æ²¡æœ‰å®šä¹‰çš„ï¼‰ã€‚ è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥ä¸€æ¬¡æ€§çš„æŠŠæ¨¡å—ä¸­çš„æ‰€æœ‰ï¼ˆå‡½æ•°ï¼Œå˜é‡ï¼‰åç§°éƒ½å¯¼å…¥åˆ°å½“å‰æ¨¡å—çš„å­—ç¬¦è¡¨: from fibo import * è¿™å°†æŠŠæ‰€æœ‰çš„åå­—éƒ½å¯¼å…¥è¿›æ¥ï¼Œä½†æ˜¯é‚£äº›ç”±å•ä¸€ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰å¼€å¤´çš„åå­—ä¸åœ¨æ­¤ä¾‹ã€‚å¤§å¤šæ•°æƒ…å†µï¼Œ Python ç¨‹åºå‘˜ä¸ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œå› ä¸ºå¼•å…¥çš„å…¶å®ƒæ¥æºçš„å‘½åï¼Œå¾ˆå¯èƒ½è¦†ç›–äº†å·²æœ‰çš„å®šä¹‰ã€‚ _name_å±æ€§ä¸€ä¸ªæ¨¡å—è¢«å¦ä¸€ä¸ªç¨‹åºç¬¬ä¸€æ¬¡å¼•å…¥æ—¶ï¼Œå…¶ä¸»ç¨‹åºå°†è¿è¡Œã€‚ å¦‚æœæˆ‘ä»¬æƒ³åœ¨æ¨¡å—è¢«å¼•å…¥æ—¶ï¼Œæ¨¡å—ä¸­çš„æŸä¸€ç¨‹åºå—ä¸æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ __name__ å±æ€§æ¥ä½¿è¯¥ç¨‹åºå—ä»…åœ¨è¯¥æ¨¡å—è‡ªèº«è¿è¡Œæ—¶æ‰§è¡Œã€‚ fibo.py # æ–æ³¢é‚£å¥‘(fibonacci)æ•°åˆ—æ¨¡å— def fib(n): # å®šä¹‰åˆ° n çš„æ–æ³¢é‚£å¥‘æ•°åˆ— a, b = 0, 1 while b n: print(b, end= ) a, b = b, a+b print() if __name__ == __main__: print(ç¨‹åºè‡ªèº«åœ¨è¿è¡Œ)else: print(__name__) print(æˆ‘æ¥è‡ªå¦ä¸€æ¨¡å—) ç›´æ¥è¿è¡Œ fibo.py è¾“å‡ºï¼š D:worktoolsPythonPython.exe d:worksty_projectsty_Python01.basicfibo.pyç¨‹åºè‡ªèº«åœ¨è¿è¡Œ test.pyt from fibo import fibfib(10) è¿è¡Œå¯¼å…¥ fibo çš„ hello.py è¾“å‡ºï¼š D:worktoolsPythonPython.exe d:worksty_projectsty_Python01.basichello.pyfiboæˆ‘æ¥è‡ªå¦ä¸€æ¨¡å—1 1 2 3 5 8 è¯´æ˜ï¼šæ¯ä¸ªæ¨¡å—éƒ½æœ‰ä¸€ä¸ª __name__ å±æ€§ã€‚ å¦‚æœæ¨¡å—æ˜¯è¢«ç›´æ¥è¿è¡Œï¼Œ__name__ çš„å€¼ä¸º __main__ã€‚ å¦‚æœæ¨¡å—æ˜¯è¢«å¯¼å…¥çš„ï¼Œ__name__ çš„å€¼ä¸ºæ¨¡å—åã€‚ __name__ ä¸ __main__ åº•ä¸‹æ˜¯åŒä¸‹åˆ’çº¿ï¼Œ _ _ dir() å‡½æ•°å†…ç½®çš„å‡½æ•° dir() å¯ä»¥æ‰¾åˆ°æ¨¡å—å†…å®šä¹‰çš„æ‰€æœ‰åç§°ã€‚ä»¥ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨çš„å½¢å¼è¿”å›ï¼š import fibo, sys dir(fibo)[__name__, fib] dir(sys) [__displayhook__, __doc__, __excepthook__, __loader__, __name__, __package__, __stderr__, __stdin__, __stdout__, _clear_type_cache, _current_frames, _debugmallocstats, _getframe, _home, _mercurial, _xoptions, abiflags, api_version, argv, base_exec_prefix, base_prefix, builtin_module_names, byteorder, call_tracing, callstats, copyright, displayhook, dont_write_bytecode, exc_info, excepthook, exec_prefix, executable, exit, flags, float_info, float_repr_style, getcheckinterval, getdefaultencoding, getdlopenflags, getfilesystemencoding, getobjects, getprofile, getrecursionlimit, getrefcount, getsizeof, getswitchinterval, gettotalrefcount, gettrace, hash_info, hexversion, implementation, int_info, intern, maxsize, maxunicode, meta_path, modules, path, path_hooks, path_importer_cache, platform, prefix, ps1, setcheckinterval, setdlopenflags, setprofile, setrecursionlimit, setswitchinterval, settrace, stderr, stdin, stdout, thread_info, version, version_info, warnoptions] å¦‚æœæ²¡æœ‰ç»™å®šå‚æ•°ï¼Œé‚£ä¹ˆ dir() å‡½æ•°ä¼šç½—åˆ—å‡ºå½“å‰å®šä¹‰çš„æ‰€æœ‰åç§°ï¼š a = [1, 2, 3, 4, 5] import fibo fib = fibo.fib dir() # å¾—åˆ°ä¸€ä¸ªå½“å‰æ¨¡å—ä¸­å®šä¹‰çš„å±æ€§åˆ—è¡¨[__builtins__, __name__, a, fib, fibo, sys] a = 5 # å»ºç«‹ä¸€ä¸ªæ–°çš„å˜é‡ a dir()[__builtins__, __doc__, __name__, a, sys] del a # åˆ é™¤å˜é‡åa dir()[__builtins__, __doc__, __name__, sys] æ ‡å‡†æ¨¡å—Python æœ¬èº«å¸¦ç€ä¸€äº›æ ‡å‡†çš„æ¨¡å—åº“ï¼Œåœ¨ Python åº“å‚è€ƒæ–‡æ¡£ä¸­å°†ä¼šä»‹ç»åˆ°ï¼ˆå°±æ˜¯åé¢çš„ â€œåº“å‚è€ƒæ–‡æ¡£â€ï¼‰ã€‚ æ¨¡å—å åŠŸèƒ½æè¿° math æ•°å­¦è¿ç®—ï¼ˆå¦‚å¹³æ–¹æ ¹ã€ä¸‰è§’å‡½æ•°ç­‰ï¼‰ os æ“ä½œç³»ç»Ÿç›¸å…³åŠŸèƒ½ï¼ˆå¦‚æ–‡ä»¶ã€ç›®å½•æ“ä½œï¼‰ sys ç³»ç»Ÿç›¸å…³çš„å‚æ•°å’Œå‡½æ•° random ç”Ÿæˆéšæœºæ•° datetime å¤„ç†æ—¥æœŸå’Œæ—¶é—´ json å¤„ç† JSON æ•°æ® re æ­£åˆ™è¡¨è¾¾å¼æ“ä½œ collections æä¾›é¢å¤–çš„æ•°æ®ç»“æ„ï¼ˆå¦‚ defaultdictã€dequeï¼‰ itertools æä¾›è¿­ä»£å™¨å·¥å…· functools é«˜é˜¶å‡½æ•°å·¥å…·ï¼ˆå¦‚ reduceã€lru_cacheï¼‰ æœ‰äº›æ¨¡å—ç›´æ¥è¢«æ„å»ºåœ¨è§£æå™¨é‡Œï¼Œè¿™äº›è™½ç„¶ä¸æ˜¯ä¸€äº›è¯­è¨€å†…ç½®çš„åŠŸèƒ½ï¼Œä½†æ˜¯ä»–å´èƒ½å¾ˆé«˜æ•ˆçš„ä½¿ç”¨ï¼Œç”šè‡³æ˜¯ç³»ç»Ÿçº§è°ƒç”¨ä¹Ÿæ²¡é—®é¢˜ã€‚ è¿™äº›ç»„ä»¶ä¼šæ ¹æ®ä¸åŒçš„æ“ä½œç³»ç»Ÿè¿›è¡Œä¸åŒå½¢å¼çš„é…ç½®ï¼Œæ¯”å¦‚ winreg è¿™ä¸ªæ¨¡å—å°±åªä¼šæä¾›ç»™ Windows ç³»ç»Ÿã€‚ åº”è¯¥æ³¨æ„åˆ°è¿™æœ‰ä¸€ä¸ªç‰¹åˆ«çš„æ¨¡å— sys ï¼Œå®ƒå†…ç½®åœ¨æ¯ä¸€ä¸ª Python è§£æå™¨ä¸­ã€‚å˜é‡ sys.ps1 å’Œ sys.ps2 å®šä¹‰äº†ä¸»æç¤ºç¬¦å’Œå‰¯æç¤ºç¬¦æ‰€å¯¹åº”çš„å­—ç¬¦ä¸²: import sys sys.ps1 sys.ps2... sys.ps1 = C C print(Runoob!)Runoob!C åŒ…åŒ…æ˜¯ä¸€ç§ç®¡ç† Python æ¨¡å—å‘½åç©ºé—´çš„å½¢å¼ï¼Œé‡‡ç”¨ â€œç‚¹æ¨¡å—åç§°â€ã€‚ æ¯”å¦‚ä¸€ä¸ªæ¨¡å—çš„åç§°æ˜¯ A.Bï¼Œ é‚£ä¹ˆä»–è¡¨ç¤ºä¸€ä¸ªåŒ… A ä¸­çš„å­æ¨¡å— B ã€‚ å°±å¥½åƒä½¿ç”¨æ¨¡å—çš„æ—¶å€™ï¼Œä½ ä¸ç”¨æ‹…å¿ƒä¸åŒæ¨¡å—ä¹‹é—´çš„å…¨å±€å˜é‡ç›¸äº’å½±å“ä¸€æ ·ï¼Œé‡‡ç”¨ç‚¹æ¨¡å—åç§°è¿™ç§å½¢å¼ä¹Ÿä¸ç”¨æ‹…å¿ƒä¸åŒåº“ä¹‹é—´çš„æ¨¡å—é‡åçš„æƒ…å†µã€‚ è¿™æ ·ä¸åŒçš„ä½œè€…éƒ½å¯ä»¥æä¾› NumPy æ¨¡å—ï¼Œæˆ–è€…æ˜¯ Python å›¾å½¢åº“ã€‚ ä¸å¦¨å‡è®¾ä½ æƒ³è®¾è®¡ä¸€å¥—ç»Ÿä¸€å¤„ç†å£°éŸ³æ–‡ä»¶å’Œæ•°æ®çš„æ¨¡å—ï¼ˆæˆ–è€…ç§°ä¹‹ä¸ºä¸€ä¸ª â€œåŒ…â€ï¼‰ã€‚ ç°å­˜å¾ˆå¤šç§ä¸åŒçš„éŸ³é¢‘æ–‡ä»¶æ ¼å¼ï¼ˆåŸºæœ¬ä¸Šéƒ½æ˜¯é€šè¿‡åç¼€ååŒºåˆ†çš„ï¼Œä¾‹å¦‚ï¼š .wavï¼Œ:file:.aiffï¼Œ:file:.auï¼Œï¼‰ï¼Œæ‰€ä»¥ä½ éœ€è¦æœ‰ä¸€ç»„ä¸æ–­å¢åŠ çš„æ¨¡å—ï¼Œç”¨æ¥åœ¨ä¸åŒçš„æ ¼å¼ä¹‹é—´è½¬æ¢ã€‚ å¹¶ä¸”é’ˆå¯¹è¿™äº›éŸ³é¢‘æ•°æ®ï¼Œè¿˜æœ‰å¾ˆå¤šä¸åŒçš„æ“ä½œï¼ˆæ¯”å¦‚æ··éŸ³ï¼Œæ·»åŠ å›å£°ï¼Œå¢åŠ å‡è¡¡å™¨åŠŸèƒ½ï¼Œåˆ›å»ºäººé€ ç«‹ä½“å£°æ•ˆæœï¼‰ï¼Œæ‰€ä»¥ä½ è¿˜éœ€è¦ä¸€ç»„æ€ä¹ˆä¹Ÿå†™ä¸å®Œçš„æ¨¡å—æ¥å¤„ç†è¿™äº›æ“ä½œã€‚ è¿™é‡Œç»™å‡ºäº†ä¸€ç§å¯èƒ½çš„åŒ…ç»“æ„ï¼ˆåœ¨åˆ†å±‚çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼‰: sound/ é¡¶å±‚åŒ… __init__.py åˆå§‹åŒ– sound åŒ… formats/ æ–‡ä»¶æ ¼å¼è½¬æ¢å­åŒ… __init__.py wavread.py wavwrite.py aiffread.py aiffwrite.py auread.py auwrite.py ... effects/ å£°éŸ³æ•ˆæœå­åŒ… __init__.py echo.py surround.py reverse.py ... filters/ filters å­åŒ… __init__.py equalizer.py vocoder.py karaoke.py ... åœ¨å¯¼å…¥ä¸€ä¸ªåŒ…çš„æ—¶å€™ï¼ŒPython ä¼šæ ¹æ® sys.path ä¸­çš„ç›®å½•æ¥å¯»æ‰¾è¿™ä¸ªåŒ…ä¸­åŒ…å«çš„å­ç›®å½•ã€‚ ç›®å½•åªæœ‰åŒ…å«ä¸€ä¸ªå«åš __init__.py çš„æ–‡ä»¶æ‰ä¼šè¢«è®¤ä½œæ˜¯ä¸€ä¸ªåŒ…ï¼Œä¸»è¦æ˜¯ä¸ºäº†é¿å…ä¸€äº›æ»¥ä¿—çš„åå­—ï¼ˆæ¯”å¦‚å«åš stringï¼‰ä¸å°å¿ƒçš„å½±å“æœç´¢è·¯å¾„ä¸­çš„æœ‰æ•ˆæ¨¡å—ã€‚ æœ€ç®€å•çš„æƒ…å†µï¼Œæ”¾ä¸€ä¸ªç©ºçš„ :file:__init__.py å°±å¯ä»¥äº†ã€‚å½“ç„¶è¿™ä¸ªæ–‡ä»¶ä¸­ä¹Ÿå¯ä»¥åŒ…å«ä¸€äº›åˆå§‹åŒ–ä»£ç æˆ–è€…ä¸ºï¼ˆå°†åœ¨åé¢ä»‹ç»çš„ï¼‰ all å˜é‡èµ‹å€¼ã€‚ ç”¨æˆ·å¯ä»¥æ¯æ¬¡åªå¯¼å…¥ä¸€ä¸ªåŒ…é‡Œé¢çš„ç‰¹å®šæ¨¡å—ï¼Œæ¯”å¦‚ï¼š import sound.effects.echo è¿™å°†ä¼šå¯¼å…¥å­æ¨¡å— : sound.effects.echoã€‚ ä»–å¿…é¡»ä½¿ç”¨å…¨åå»è®¿é—®ï¼š sound.effects.echo.echofilter(input, output, delay=0.7, atten=4) è¿˜æœ‰ä¸€ç§å¯¼å…¥å­æ¨¡å—çš„æ–¹æ³•æ˜¯ï¼š from sound.effects import echo è¿™åŒæ ·ä¼šå¯¼å…¥å­æ¨¡å—: echoï¼Œå¹¶ä¸”ä»–ä¸éœ€è¦é‚£äº›å†—é•¿çš„å‰ç¼€ï¼Œæ‰€ä»¥å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š echo.echofilter(input, output, delay=0.7, atten=4) è¿˜æœ‰ä¸€ç§å˜åŒ–å°±æ˜¯ç›´æ¥å¯¼å…¥ä¸€ä¸ªå‡½æ•°æˆ–è€…å˜é‡ï¼š from sound.effects.echo import echofilter åŒæ ·çš„ï¼Œè¿™ç§æ–¹æ³•ä¼šå¯¼å…¥å­æ¨¡å—: echoï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥ä½¿ç”¨ä»–çš„ echofilter() å‡½æ•°ï¼š echofilter(input, output, delay=0.7, atten=4) æ³¨æ„å½“ä½¿ç”¨ from package import item è¿™ç§å½¢å¼çš„æ—¶å€™ï¼Œå¯¹åº”çš„ item æ—¢å¯ä»¥æ˜¯åŒ…é‡Œé¢çš„å­æ¨¡å—ï¼ˆå­åŒ…ï¼‰ï¼Œæˆ–è€…åŒ…é‡Œé¢å®šä¹‰çš„å…¶ä»–åç§°ï¼Œæ¯”å¦‚å‡½æ•°ï¼Œç±»æˆ–è€…å˜é‡ã€‚ import è¯­æ³•ä¼šé¦–å…ˆæŠŠ item å½“ä½œä¸€ä¸ªåŒ…å®šä¹‰çš„åç§°ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œå†è¯•å›¾æŒ‰ç…§ä¸€ä¸ªæ¨¡å—å»å¯¼å…¥ã€‚å¦‚æœè¿˜æ²¡æ‰¾åˆ°ï¼ŒæŠ›å‡ºä¸€ä¸ª :exc:ImportError å¼‚å¸¸ã€‚ åä¹‹ï¼Œå¦‚æœä½¿ç”¨å½¢å¦‚ import item.subitem.subsubitem è¿™ç§å¯¼å…¥å½¢å¼ï¼Œé™¤äº†æœ€åä¸€é¡¹ï¼Œéƒ½å¿…é¡»æ˜¯åŒ…ï¼Œè€Œæœ€åä¸€é¡¹åˆ™å¯ä»¥æ˜¯æ¨¡å—æˆ–è€…æ˜¯åŒ…ï¼Œä½†æ˜¯ä¸å¯ä»¥æ˜¯ç±»ï¼Œå‡½æ•°æˆ–è€…å˜é‡çš„åå­—ã€‚ ä»åŒ…ä¸­å¯¼å…¥ *å¦‚æœæˆ‘ä»¬ä½¿ç”¨ from sound.effects import * ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ Python ä¼šè¿›å…¥æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰¾åˆ°è¿™ä¸ªåŒ…é‡Œé¢æ‰€æœ‰çš„å­æ¨¡å—ï¼Œç„¶åä¸€ä¸ªä¸€ä¸ªçš„æŠŠå®ƒä»¬éƒ½å¯¼å…¥è¿›æ¥ã€‚ ä½†è¿™ä¸ªæ–¹æ³•åœ¨ Windows å¹³å°ä¸Šå·¥ä½œçš„å°±ä¸æ˜¯éå¸¸å¥½ï¼Œå› ä¸º Windows æ˜¯ä¸€ä¸ªä¸åŒºåˆ†å¤§å°å†™çš„ç³»ç»Ÿã€‚ åœ¨ Windows å¹³å°ä¸Šï¼Œæˆ‘ä»¬æ— æ³•ç¡®å®šä¸€ä¸ªå«åš ECHO.py çš„æ–‡ä»¶å¯¼å…¥ä¸ºæ¨¡å—æ˜¯ echo è¿˜æ˜¯ Echoï¼Œæˆ–è€…æ˜¯ ECHOã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åªéœ€è¦æä¾›ä¸€ä¸ªç²¾ç¡®åŒ…çš„ç´¢å¼•ã€‚ å¯¼å…¥è¯­å¥éµå¾ªå¦‚ä¸‹è§„åˆ™ï¼šå¦‚æœåŒ…å®šä¹‰æ–‡ä»¶ __init__.py å­˜åœ¨ä¸€ä¸ªå«åš __all__ çš„åˆ—è¡¨å˜é‡ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨ from package import * çš„æ—¶å€™å°±æŠŠè¿™ä¸ªåˆ—è¡¨ä¸­çš„æ‰€æœ‰åå­—ä½œä¸ºåŒ…å†…å®¹å¯¼å…¥ã€‚ ä½œä¸ºåŒ…çš„ä½œè€…ï¼Œå¯åˆ«å¿˜äº†åœ¨æ›´æ–°åŒ…ä¹‹åä¿è¯ __all__ ä¹Ÿæ›´æ–°äº†ã€‚ ä»¥ä¸‹å®ä¾‹åœ¨ file:sounds/effects/__init__.py ä¸­åŒ…å«å¦‚ä¸‹ä»£ç : __all__ = [echo, surround, reverse] è¿™è¡¨ç¤ºå½“ä½ ä½¿ç”¨ from sound.effects import è¿™ç§ç”¨æ³•æ—¶ï¼Œä½ åªä¼šå¯¼å…¥åŒ…é‡Œé¢è¿™ä¸‰ä¸ªå­æ¨¡å—ã€‚ å¦‚æœ __all__ çœŸçš„æ²¡æœ‰å®šä¹‰ï¼Œé‚£ä¹ˆä½¿ç”¨ from sound.effects import * è¿™ç§è¯­æ³•çš„æ—¶å€™ï¼Œå°±ä¸ä¼šå¯¼å…¥åŒ… sound.effects é‡Œçš„ä»»ä½•å­æ¨¡å—ã€‚ä»–åªæ˜¯æŠŠåŒ… sound.effects å’Œå®ƒé‡Œé¢å®šä¹‰çš„æ‰€æœ‰å†…å®¹å¯¼å…¥è¿›æ¥ï¼ˆå¯èƒ½è¿è¡Œ __init__.py é‡Œå®šä¹‰çš„åˆå§‹åŒ–ä»£ç ï¼‰ã€‚ è¿™ä¼šæŠŠ __init__.py é‡Œé¢å®šä¹‰çš„æ‰€æœ‰åå­—å¯¼å…¥è¿›æ¥ã€‚å¹¶ä¸”ä»–ä¸ä¼šç ´åæ‰æˆ‘ä»¬åœ¨è¿™å¥è¯ä¹‹å‰å¯¼å…¥çš„æ‰€æœ‰æ˜ç¡®æŒ‡å®šçš„æ¨¡å—ã€‚çœ‹ä¸‹è¿™éƒ¨åˆ†ä»£ç : import sound.effects.echoimport sound.effects.surroundfrom sound.effects import * è¿™ä¸ªä¾‹å­ä¸­ï¼Œåœ¨æ‰§è¡Œ from...import å‰ï¼ŒåŒ… sound.effects ä¸­çš„ echo å’Œ surround æ¨¡å—éƒ½è¢«å¯¼å…¥åˆ°å½“å‰çš„å‘½åç©ºé—´ä¸­äº†ã€‚ï¼ˆå½“ç„¶å¦‚æœå®šä¹‰äº† __all__ å°±æ›´æ²¡é—®é¢˜äº†ï¼‰ é€šå¸¸æˆ‘ä»¬å¹¶ä¸ä¸»å¼ ä½¿ç”¨ * è¿™ç§æ–¹æ³•æ¥å¯¼å…¥æ¨¡å—ï¼Œå› ä¸ºè¿™ç§æ–¹æ³•ç»å¸¸ä¼šå¯¼è‡´ä»£ç çš„å¯è¯»æ€§é™ä½ã€‚ä¸è¿‡è¿™æ ·å€’çš„ç¡®æ˜¯å¯ä»¥çœå»ä¸å°‘æ•²é”®çš„åŠŸå¤«ï¼Œè€Œä¸”ä¸€äº›æ¨¡å—éƒ½è®¾è®¡æˆäº†åªèƒ½é€šè¿‡ç‰¹å®šçš„æ–¹æ³•å¯¼å…¥ã€‚ è®°ä½ï¼Œä½¿ç”¨ from Package import specific_submodule è¿™ç§æ–¹æ³•æ°¸è¿œä¸ä¼šæœ‰é”™ã€‚äº‹å®ä¸Šï¼Œè¿™ä¹Ÿæ˜¯æ¨èçš„æ–¹æ³•ã€‚é™¤éæ˜¯ä½ è¦å¯¼å…¥çš„å­æ¨¡å—æœ‰å¯èƒ½å’Œå…¶ä»–åŒ…çš„å­æ¨¡å—é‡åã€‚ å¦‚æœåœ¨ç»“æ„ä¸­åŒ…æ˜¯ä¸€ä¸ªå­åŒ…ï¼ˆæ¯”å¦‚è¿™ä¸ªä¾‹å­ä¸­å¯¹äºåŒ… sound æ¥è¯´ï¼‰ï¼Œè€Œä½ åˆæƒ³å¯¼å…¥å…„å¼ŸåŒ…ï¼ˆåŒçº§åˆ«çš„åŒ…ï¼‰ä½ å°±å¾—ä½¿ç”¨å¯¼å…¥ç»å¯¹çš„è·¯å¾„æ¥å¯¼å…¥ã€‚æ¯”å¦‚ï¼Œå¦‚æœæ¨¡å— sound.filters.vocoder è¦ä½¿ç”¨åŒ… sound.effects ä¸­çš„æ¨¡å— echoï¼Œä½ å°±è¦å†™æˆ from sound.effects import echoã€‚ from . import echofrom .. import formatsfrom ..filters import equalizer æ— è®ºæ˜¯éšå¼çš„è¿˜æ˜¯æ˜¾å¼çš„ç›¸å¯¹å¯¼å…¥éƒ½æ˜¯ä»å½“å‰æ¨¡å—å¼€å§‹çš„ã€‚ä¸»æ¨¡å—çš„åå­—æ°¸è¿œæ˜¯ â€œ__main__â€œï¼Œä¸€ä¸ª Python åº”ç”¨ç¨‹åºçš„ä¸»æ¨¡å—ï¼Œåº”å½“æ€»æ˜¯ä½¿ç”¨ç»å¯¹è·¯å¾„å¼•ç”¨ã€‚ åŒ…è¿˜æä¾›ä¸€ä¸ªé¢å¤–çš„å±æ€§ __path__ã€‚è¿™æ˜¯ä¸€ä¸ªç›®å½•åˆ—è¡¨ï¼Œé‡Œé¢æ¯ä¸€ä¸ªåŒ…å«çš„ç›®å½•éƒ½æœ‰ä¸ºè¿™ä¸ªåŒ…æœåŠ¡çš„ __init__.pyï¼Œä½ å¾—åœ¨å…¶ä»– __init__.py è¢«æ‰§è¡Œå‰å®šä¹‰å“¦ã€‚å¯ä»¥ä¿®æ”¹è¿™ä¸ªå˜é‡ï¼Œç”¨æ¥å½±å“åŒ…å«åœ¨åŒ…é‡Œé¢çš„æ¨¡å—å’Œå­åŒ…ã€‚ è¿™ä¸ªåŠŸèƒ½å¹¶ä¸å¸¸ç”¨ï¼Œä¸€èˆ¬ç”¨æ¥æ‰©å±•åŒ…é‡Œé¢çš„æ¨¡å—ã€‚","tags":[null],"categories":[null]},{"title":"Pythonè£…é¥°å™¨","path":"/wiki/Python/è£…é¥°å™¨.html","content":"è£…é¥°å™¨è£…é¥°å™¨ï¼ˆdecoratorsï¼‰æ˜¯ Python ä¸­çš„ä¸€ç§é«˜çº§åŠŸèƒ½ï¼Œå®ƒå…è®¸ä½ åŠ¨æ€åœ°ä¿®æ”¹å‡½æ•°æˆ–ç±»çš„è¡Œä¸ºã€‚ è£…é¥°å™¨æ˜¯ä¸€ç§å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°æˆ–ä¿®æ”¹åŸæ¥çš„å‡½æ•°ã€‚ è£…é¥°å™¨çš„è¯­æ³•ä½¿ç”¨ @decorator_name æ¥åº”ç”¨åœ¨å‡½æ•°æˆ–æ–¹æ³•ä¸Šã€‚ Python è¿˜æä¾›äº†ä¸€äº›å†…ç½®çš„è£…é¥°å™¨ï¼Œæ¯”å¦‚ @staticmethod å’Œ @classmethodï¼Œç”¨äºå®šä¹‰é™æ€æ–¹æ³•å’Œç±»æ–¹æ³•ã€‚ è£…é¥°å™¨çš„åº”ç”¨åœºæ™¯ï¼š æ—¥å¿—è®°å½•: è£…é¥°å™¨å¯ç”¨äºè®°å½•å‡½æ•°çš„è°ƒç”¨ä¿¡æ¯ã€å‚æ•°å’Œè¿”å›å€¼ã€‚ æ€§èƒ½åˆ†æ: å¯ä»¥ä½¿ç”¨è£…é¥°å™¨æ¥æµ‹é‡å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ã€‚ æƒé™æ§åˆ¶: è£…é¥°å™¨å¯ç”¨äºé™åˆ¶å¯¹æŸäº›å‡½æ•°çš„è®¿é—®æƒé™ã€‚ ç¼“å­˜: è£…é¥°å™¨å¯ç”¨äºå®ç°å‡½æ•°ç»“æœçš„ç¼“å­˜ï¼Œä»¥æé«˜æ€§èƒ½ã€‚ åŸºæœ¬è¯­æ³•Python è£…é¥°å…è®¸åœ¨ä¸ä¿®æ”¹åŸæœ‰å‡½æ•°ä»£ç çš„åŸºç¡€ä¸Šï¼ŒåŠ¨æ€åœ°å¢åŠ æˆ–ä¿®æ”¹å‡½æ•°çš„åŠŸèƒ½ï¼Œè£…é¥°å™¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ¥æ”¶å‡½æ•°ä½œä¸ºè¾“å…¥å¹¶è¿”å›ä¸€ä¸ªæ–°çš„åŒ…è£…è¿‡åçš„å‡½æ•°çš„å¯¹è±¡ã€‚ def decorator_function(original_function): def wrapper(*args, **kwargs): # è¿™é‡Œæ˜¯åœ¨è°ƒç”¨åŸå§‹å‡½æ•°å‰æ·»åŠ çš„æ–°åŠŸèƒ½ # before_call_code() print(before_call_code) result = original_function(*args, **kwargs) # è¿™é‡Œæ˜¯åœ¨è°ƒç”¨åŸå§‹å‡½æ•°åæ·»åŠ çš„æ–°åŠŸèƒ½ #after_call_code() print(after_call_code) return result return wrapper# ä½¿ç”¨è£…é¥°å™¨@decorator_functiondef target_function(arg1, arg2): print(run code)target_function(1,2) è¾“å‡ºç»“æœï¼š before_call_coderun codeafter_call_code è§£æï¼š decorator æ˜¯ä¸€ä¸ªè£…é¥°å™¨å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‡½æ•° func ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå†…éƒ¨å‡½æ•° wrapperï¼Œåœ¨ wrapper å‡½æ•°å†…éƒ¨ï¼Œä½ å¯ä»¥æ‰§è¡Œä¸€äº›é¢å¤–çš„æ“ä½œï¼Œç„¶åè°ƒç”¨åŸå§‹å‡½æ•° funcï¼Œå¹¶è¿”å›å…¶ç»“æœã€‚ decorator_function æ˜¯è£…é¥°å™¨ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå‡½æ•° original_function ä½œä¸ºå‚æ•°ã€‚ wrapper æ˜¯å†…éƒ¨å‡½æ•°ï¼Œå®ƒæ˜¯å®é™…ä¼šè¢«è°ƒç”¨çš„æ–°å‡½æ•°ï¼Œå®ƒåŒ…è£¹äº†åŸå§‹å‡½æ•°çš„è°ƒç”¨ï¼Œå¹¶åœ¨å…¶å‰åå¢åŠ äº†é¢å¤–çš„è¡Œä¸ºã€‚ å½“æˆ‘ä»¬ä½¿ç”¨ @decorator_function å‰ç¼€åœ¨ target_function å®šä¹‰å‰ï¼ŒPython ä¼šè‡ªåŠ¨å°† target_function ä½œä¸ºå‚æ•°ä¼ é€’ç»™ decorator_functionï¼Œç„¶åå°†è¿”å›çš„ wrapper å‡½æ•°æ›¿æ¢æ‰åŸæ¥çš„ target_functionã€‚ è£…é¥°å™¨é€šè¿‡ @ ç¬¦å·åº”ç”¨åœ¨å‡½æ•°å®šä¹‰ä¹‹å‰ï¼Œä¾‹å¦‚ï¼š @time_loggerdef target_function(): pass ç­‰åŒäºï¼š def target_function(): passtarget_function = time_logger(target_function) è¿™ä¼šå°† target_function å‡½æ•°ä¼ é€’ç»™ decorator è£…é¥°å™¨ï¼Œå¹¶å°†è¿”å›çš„å‡½æ•°é‡æ–°èµ‹å€¼ç»™ target_functionã€‚ä»è€Œï¼Œæ¯æ¬¡è°ƒç”¨ target_function æ—¶ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨äº†ç»è¿‡è£…é¥°å™¨å¤„ç†åçš„å‡½æ•°ã€‚ é€šè¿‡è£…é¥°å™¨ï¼Œå¼€å‘è€…å¯ä»¥åœ¨ä¿æŒä»£ç æ•´æ´çš„åŒæ—¶ï¼Œçµæ´»ä¸”é«˜æ•ˆåœ°æ‰©å±•ç¨‹åºçš„åŠŸèƒ½ã€‚ å¸¦å‚æ•°çš„è£…é¥°å™¨è£…é¥°å™¨å‡½æ•°ä¹Ÿå¯ä»¥æ¥å—å‚æ•°ï¼Œä¾‹å¦‚ï¼š def repeat(n): def decorator(func): def wrapper(*args, **kwargs): for _ in range(n): result = func(*args, **kwargs) return result return wrapper return decorator@repeat(3)def greet(name): print(fHello, name!)greet(Alice) ä»¥ä¸Šä»£ç ä¸­ repeat å‡½æ•°æ˜¯ä¸€ä¸ªå¸¦å‚æ•°çš„è£…é¥°å™¨ï¼Œå®ƒæ¥å—ä¸€ä¸ªæ•´æ•°å‚æ•° nï¼Œç„¶åè¿”å›ä¸€ä¸ªè£…é¥°å™¨å‡½æ•°ã€‚è¯¥è£…é¥°å™¨å‡½æ•°å†…éƒ¨å®šä¹‰äº† wrapper å‡½æ•°ï¼Œåœ¨è°ƒç”¨åŸå§‹å‡½æ•°ä¹‹å‰é‡å¤æ‰§è¡Œ n æ¬¡ã€‚å› æ­¤ï¼Œgreet å‡½æ•°åœ¨è¢« @repeat(3) è£…é¥°åï¼Œä¼šæ‰“å°ä¸‰æ¬¡é—®å€™è¯­ã€‚ è¾“å‡ºç»“æœï¼š Hello, Alice!Hello, Alice!Hello, Alice! dataclasses@dataclass æ˜¯ Python 3.7 å¼•å…¥çš„ä¸€ä¸ªè£…é¥°å™¨ï¼Œç”¨äºè‡ªåŠ¨ç”Ÿæˆç±»çš„ç‰¹æ®Šæ–¹æ³•ï¼Œå¦‚ init()ã€repr() å’Œ eq() ç­‰ã€‚ ä½¿ç”¨ @dataclass å¯ä»¥ç®€åŒ–ç±»çš„å®šä¹‰ï¼Œä½¿å…¶æ›´åŠ ç®€æ´å’Œæ˜“è¯»ã€‚ å¯¼å…¥ dataclassï¼š from dataclasses import dataclass å®šä¹‰ç±»å¹¶ä½¿ç”¨ @dataclass è£…é¥°ï¼š @dataclassclass MyClass: field1: type field2: type # å¯ä»¥æ·»åŠ é»˜è®¤å€¼ field3: type = default_value è‡ªåŠ¨ç”Ÿæˆçš„æ–¹æ³•ï¼š__init__()ï¼šæ ¹æ®ç±»å®šä¹‰çš„å­—æ®µè‡ªåŠ¨ç”Ÿæˆåˆå§‹åŒ–æ–¹æ³•ã€‚__repr__()ï¼šç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²è¡¨ç¤ºï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚__eq__()ï¼šç”Ÿæˆæ¯”è¾ƒæ–¹æ³•ï¼Œç”¨äºæ¯”è¾ƒä¸¤ä¸ªå®ä¾‹æ˜¯å¦ç›¸ç­‰ã€‚ å¯é€‰å‚æ•°ï¼šinitï¼šæ˜¯å¦è‡ªåŠ¨ç”Ÿæˆ __init__() æ–¹æ³•ï¼Œé»˜è®¤ä¸º Trueã€‚reprï¼šæ˜¯å¦è‡ªåŠ¨ç”Ÿæˆ __repr__() æ–¹æ³•ï¼Œé»˜è®¤ä¸º Trueã€‚eqï¼šæ˜¯å¦è‡ªåŠ¨ç”Ÿæˆ __eq__() æ–¹æ³•ï¼Œé»˜è®¤ä¸º Trueã€‚orderï¼šæ˜¯å¦ç”Ÿæˆæ¯”è¾ƒæ–¹æ³•ï¼ˆ__lt__, __le__, __gt__, __ge__ï¼‰ï¼Œé»˜è®¤ä¸º Falseã€‚unsafe_hashï¼šæ˜¯å¦ç”Ÿæˆ __hash__() æ–¹æ³•ï¼Œé»˜è®¤ä¸º Falseã€‚ ç¤ºä¾‹ï¼š from dataclasses import dataclass@dataclassclass Product: name: str price: float quantity: int = 0 def total_cost(self) - float: return self.price * self.quantity# ä½¿ç”¨ç¤ºä¾‹product = Product(name=Laptop, price=1200.0, quantity=3)print(product) # è¾“å‡º: Product(name=Laptop, price=1200.0, quantity=3)print(product.total_cost()) # è¾“å‡º: 3600.0","tags":[null],"categories":[null]},{"title":"Pythonè¿ç®—ç¬¦","path":"/wiki/Python/è¿ç®—ç¬¦.html","content":"è¿ç®—ç¬¦ç±»å‹Python è¯­è¨€æ”¯æŒä»¥ä¸‹ç±»å‹çš„è¿ç®—ç¬¦: ç®—æœ¯è¿ç®—ç¬¦ æ¯”è¾ƒï¼ˆå…³ç³»ï¼‰è¿ç®—ç¬¦ èµ‹å€¼è¿ç®—ç¬¦ é€»è¾‘è¿ç®—ç¬¦ ä½è¿ç®—ç¬¦ æˆå‘˜è¿ç®—ç¬¦ èº«ä»½è¿ç®—ç¬¦ Python ç®—æœ¯è¿ç®—ç¬¦ä»¥ä¸‹å‡è®¾å˜é‡ a 10ï¼Œå˜é‡ b 21ï¼š è¿ç®—ç¬¦ æè¿° å®ä¾‹ + åŠ  - ä¸¤ä¸ªå¯¹è±¡ç›¸åŠ  a + b è¾“å‡ºç»“æœ 31 - å‡ - å¾—åˆ°è´Ÿæ•°æˆ–æ˜¯ä¸€ä¸ªæ•°å‡å»å¦ä¸€ä¸ªæ•° a - b è¾“å‡ºç»“æœ -11 * ä¹˜ - ä¸¤ä¸ªæ•°ç›¸ä¹˜æˆ–æ˜¯è¿”å›ä¸€ä¸ªè¢«é‡å¤è‹¥å¹²æ¬¡çš„å­—ç¬¦ä¸² a * b è¾“å‡ºç»“æœ 210 é™¤ - x é™¤ä»¥ y b a è¾“å‡ºç»“æœ 2.1 % å–æ¨¡ - è¿”å›é™¤æ³•çš„ä½™æ•° b % a è¾“å‡ºç»“æœ 1 ** å¹‚ - è¿”å› x çš„ y æ¬¡å¹‚ a** b ä¸º 10 çš„ 21 æ¬¡æ–¹ å–æ•´é™¤ - å¾€å°çš„æ–¹å‘å–æ•´æ•° 9//2 4 -9//2 -5 a = 21b = 10c = 0 c = a + bprint (1 - c çš„å€¼ä¸ºï¼š, c) c = a - bprint (2 - c çš„å€¼ä¸ºï¼š, c) c = a * bprint (3 - c çš„å€¼ä¸ºï¼š, c) c = a / bprint (4 - c çš„å€¼ä¸ºï¼š, c) c = a % bprint (5 - c çš„å€¼ä¸ºï¼š, c) # ä¿®æ”¹å˜é‡ a ã€b ã€ca = 2b = 3c = a**b print (6 - c çš„å€¼ä¸ºï¼š, c) a = 10b = 5c = a//b print (7 - c çš„å€¼ä¸ºï¼š, c) ä»¥ä¸Šå®ä¾‹è¾“å‡ºç»“æœï¼š 1 - c çš„å€¼ä¸ºï¼š 312 - c çš„å€¼ä¸ºï¼š 113 - c çš„å€¼ä¸ºï¼š 2104 - c çš„å€¼ä¸ºï¼š 2.15 - c çš„å€¼ä¸ºï¼š 16 - c çš„å€¼ä¸ºï¼š 87 - c çš„å€¼ä¸ºï¼š 2 Python æ¯”è¾ƒè¿ç®—ç¬¦ä»¥ä¸‹å‡è®¾å˜é‡ a ä¸º 10ï¼Œå˜é‡ b ä¸º 20ï¼š è¿ç®—ç¬¦ æè¿° å®ä¾‹ ç­‰äº - æ¯”è¾ƒå¯¹è±¡æ˜¯å¦ç›¸ç­‰ (a b) è¿”å› Falseã€‚ ! ä¸ç­‰äº - æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ä¸ç›¸ç­‰ (a ! b) è¿”å› Trueã€‚ å¤§äº - è¿”å› x æ˜¯å¦å¤§äº y (a b) è¿”å› Falseã€‚ å°äº - è¿”å› x æ˜¯å¦å°äº yã€‚æ‰€æœ‰æ¯”è¾ƒè¿ç®—ç¬¦è¿”å› 1 è¡¨ç¤ºçœŸï¼Œè¿”å› 0 è¡¨ç¤ºå‡ã€‚è¿™åˆ†åˆ«ä¸ç‰¹æ®Šçš„å˜é‡ True å’Œ False ç­‰ä»·ã€‚æ³¨æ„ï¼Œè¿™äº›å˜é‡åçš„å¤§å†™ã€‚ (a b) è¿”å› Trueã€‚ å¤§äºç­‰äº - è¿”å› x æ˜¯å¦å¤§äºç­‰äº yã€‚ (a b) è¿”å› Falseã€‚ å°äºç­‰äº - è¿”å› x æ˜¯å¦å°äºç­‰äº yã€‚ (a b) è¿”å› Trueã€‚ ä»¥ä¸‹å®ä¾‹æ¼”ç¤ºäº† Python æ‰€æœ‰æ¯”è¾ƒè¿ç®—ç¬¦çš„æ“ä½œï¼š a = 21b = 10c = 0 if ( a == b ): print (1 - a ç­‰äº b)else: print (1 - a ä¸ç­‰äº b) if ( a != b ): print (2 - a ä¸ç­‰äº b)else: print (2 - a ç­‰äº b) if ( a b ): print (3 - a å°äº b)else: print (3 - a å¤§äºç­‰äº b) if ( a b ): print (4 - a å¤§äº b)else: print (4 - a å°äºç­‰äº b) # ä¿®æ”¹å˜é‡ a å’Œ b çš„å€¼a = 5b = 20if ( a = b ): print (5 - a å°äºç­‰äº b)else: print (5 - a å¤§äº b) if ( b = a ): print (6 - b å¤§äºç­‰äº a)else: print (6 - b å°äº a) ä»¥ä¸Šå®ä¾‹è¾“å‡ºç»“æœï¼š 1 - a ä¸ç­‰äº b2 - a ä¸ç­‰äº b3 - a å¤§äºç­‰äº b4 - a å¤§äº b5 - a å°äºç­‰äº b6 - b å¤§äºç­‰äº a Python èµ‹å€¼è¿ç®—ç¬¦ä»¥ä¸‹å‡è®¾å˜é‡ a ä¸º 10ï¼Œå˜é‡ b ä¸º 20ï¼š è¿ç®—ç¬¦ æè¿° å®ä¾‹ ç®€å•çš„èµ‹å€¼è¿ç®—ç¬¦ c a + b å°† a + b çš„è¿ç®—ç»“æœèµ‹å€¼ä¸º c + åŠ æ³•èµ‹å€¼è¿ç®—ç¬¦ c + a ç­‰æ•ˆäº c c + a - å‡æ³•èµ‹å€¼è¿ç®—ç¬¦ c - a ç­‰æ•ˆäº c c - a * ä¹˜æ³•èµ‹å€¼è¿ç®—ç¬¦ c a ç­‰æ•ˆäº c c a é™¤æ³•èµ‹å€¼è¿ç®—ç¬¦ c a ç­‰æ•ˆäº c c a % å–æ¨¡èµ‹å€¼è¿ç®—ç¬¦ c % a ç­‰æ•ˆäº c c % a ** å¹‚èµ‹å€¼è¿ç®—ç¬¦ c a ç­‰æ•ˆäº c c a å–æ•´é™¤èµ‹å€¼è¿ç®—ç¬¦ c a ç­‰æ•ˆäº c c a : æµ·è±¡è¿ç®—ç¬¦ï¼Œè¿™ä¸ªè¿ç®—ç¬¦çš„ä¸»è¦ç›®çš„æ˜¯åœ¨è¡¨è¾¾å¼ä¸­åŒæ—¶è¿›è¡Œèµ‹å€¼å’Œè¿”å›èµ‹å€¼çš„å€¼ã€‚Python3.8 ç‰ˆæœ¬æ–°å¢è¿ç®—ç¬¦ã€‚ åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œèµ‹å€¼è¡¨è¾¾å¼å¯ä»¥é¿å…è°ƒç”¨ len() ä¸¤æ¬¡: if (n := len(a)) 10: print(fList is too long (n elements, expected = 10)) ä»¥ä¸‹å®ä¾‹æ¼”ç¤ºäº† Python æ‰€æœ‰èµ‹å€¼è¿ç®—ç¬¦çš„æ“ä½œï¼š #!/usr/bin/python3 a = 21b = 10c = 0 c = a + bprint (1 - c çš„å€¼ä¸ºï¼š, c) c += aprint (2 - c çš„å€¼ä¸ºï¼š, c) c *= aprint (3 - c çš„å€¼ä¸ºï¼š, c) c /= a print (4 - c çš„å€¼ä¸ºï¼š, c) c = 2c %= aprint (5 - c çš„å€¼ä¸ºï¼š, c) c **= aprint (6 - c çš„å€¼ä¸ºï¼š, c) c //= aprint (7 - c çš„å€¼ä¸ºï¼š, c) ä»¥ä¸Šç¤ºä¾‹è¾“å‡ºç»“æœï¼š 1 - c çš„å€¼ä¸ºï¼š 312 - c çš„å€¼ä¸ºï¼š 523 - c çš„å€¼ä¸ºï¼š 10924 - c çš„å€¼ä¸ºï¼š 52.05 - c çš„å€¼ä¸ºï¼š 26 - c çš„å€¼ä¸ºï¼š 20971527 - c çš„å€¼ä¸ºï¼š 99864 åœ¨ Python 3.8 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œå¼•å…¥äº†ä¸€ç§æ–°çš„è¯­æ³•ç‰¹æ€§ï¼Œç§°ä¸º â€œæµ·è±¡è¿ç®—ç¬¦â€ï¼ˆWalrus Operatorï¼‰ï¼Œå®ƒä½¿ç”¨ := ç¬¦å·ã€‚è¿™ä¸ªè¿ç®—ç¬¦çš„ä¸»è¦ç›®çš„æ˜¯åœ¨è¡¨è¾¾å¼ä¸­åŒæ—¶è¿›è¡Œèµ‹å€¼å’Œè¿”å›èµ‹å€¼çš„å€¼ã€‚ ä½¿ç”¨æµ·è±¡è¿ç®—ç¬¦å¯ä»¥åœ¨ä¸€äº›æƒ…å†µä¸‹ç®€åŒ–ä»£ç ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦åœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨èµ‹å€¼ç»“æœçš„æƒ…å†µä¸‹ã€‚è¿™å¯¹äºç®€åŒ–å¾ªç¯æ¡ä»¶æˆ–è¡¨è¾¾å¼ä¸­çš„é‡å¤è®¡ç®—å¾ˆæœ‰ç”¨ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„å®ä¾‹ï¼Œæ¼”ç¤ºäº†æµ·è±¡è¿ç®—ç¬¦çš„ä½¿ç”¨ï¼š # ä¼ ç»Ÿå†™æ³•n = 10if n 5: print(n)# ä½¿ç”¨æµ·è±¡è¿ç®—ç¬¦if (n := 10) 5: print(n) æµ·è±¡è¿ç®—ç¬¦çš„ä¼˜ç‚¹ï¼š æµ·è±¡è¿ç®—ç¬¦ï¼ˆ:=ï¼‰å…è®¸åœ¨è¡¨è¾¾å¼å†…éƒ¨è¿›è¡Œèµ‹å€¼ï¼Œè¿™å¯ä»¥å‡å°‘ä»£ç çš„é‡å¤ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œç®€æ´æ€§ã€‚ åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œä¼ ç»Ÿå†™æ³•éœ€è¦å•ç‹¬ä¸€è¡Œæ¥èµ‹å€¼ nï¼Œç„¶ååœ¨ if è¯­å¥ä¸­è¿›è¡Œæ¡ä»¶æ£€æŸ¥ã€‚è€Œä½¿ç”¨æµ·è±¡è¿ç®—ç¬¦çš„å†™æ³•å¯ä»¥åœ¨ if è¯­å¥ä¸­ç›´æ¥è¿›è¡Œèµ‹å€¼å’Œæ¡ä»¶æ£€æŸ¥ã€‚ Python ä½è¿ç®—ç¬¦æŒ‰ä½è¿ç®—ç¬¦æ˜¯æŠŠæ•°å­—çœ‹ä½œäºŒè¿›åˆ¶æ¥è¿›è¡Œè®¡ç®—çš„ã€‚Python ä¸­çš„æŒ‰ä½è¿ç®—æ³•åˆ™å¦‚ä¸‹ï¼š ä¸‹è¡¨ä¸­å˜é‡ a ä¸º 60ï¼Œb ä¸º 13 äºŒè¿›åˆ¶æ ¼å¼å¦‚ä¸‹ï¼š a = 0011 1100b = 0000 1101-----------------ab = 0000 1100a|b = 0011 1101a^b = 0011 0001~a = 1100 0011 è¿ç®—ç¬¦ æè¿° å®ä¾‹ æŒ‰ä½ä¸è¿ç®—ç¬¦ï¼šå‚ä¸è¿ç®—çš„ä¸¤ä¸ªå€¼, å¦‚æœä¸¤ä¸ªç›¸åº”ä½éƒ½ä¸º 1, åˆ™è¯¥ä½çš„ç»“æœä¸º 1, å¦åˆ™ä¸º 0 (a b) è¾“å‡ºç»“æœ 12 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 0000 1100 | æŒ‰ä½æˆ–è¿ç®—ç¬¦ï¼šåªè¦å¯¹åº”çš„äºŒä¸ªäºŒè¿›ä½æœ‰ä¸€ä¸ªä¸º 1 æ—¶ï¼Œç»“æœä½å°±ä¸º 1ã€‚ (a | b) è¾“å‡ºç»“æœ 61 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 0011 1101 ^ æŒ‰ä½å¼‚æˆ–è¿ç®—ç¬¦ï¼šå½“ä¸¤å¯¹åº”çš„äºŒè¿›ä½ç›¸å¼‚æ—¶ï¼Œç»“æœä¸º 1 (a ^ b) è¾“å‡ºç»“æœ 49 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 0011 0001 ~ æŒ‰ä½å–åè¿ç®—ç¬¦ï¼šå¯¹æ•°æ®çš„æ¯ä¸ªäºŒè¿›åˆ¶ä½å–å, å³æŠŠ 1 å˜ä¸º 0, æŠŠ 0 å˜ä¸º 1ã€‚**~x** ç±»ä¼¼äº -x-1 (~a ) è¾“å‡ºç»“æœ -61 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 1100 0011ï¼Œ åœ¨ä¸€ä¸ªæœ‰ç¬¦å·äºŒè¿›åˆ¶æ•°çš„è¡¥ç å½¢å¼ã€‚ å·¦ç§»åŠ¨è¿ç®—ç¬¦ï¼šè¿ç®—æ•°çš„å„äºŒè¿›ä½å…¨éƒ¨å·¦ç§»è‹¥å¹²ä½ï¼Œç”± â€œâ€ å³è¾¹çš„æ•°æŒ‡å®šç§»åŠ¨çš„ä½æ•°ï¼Œé«˜ä½ä¸¢å¼ƒï¼Œä½ä½è¡¥ 0ã€‚ a 2 è¾“å‡ºç»“æœ 240 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 1111 0000 å³ç§»åŠ¨è¿ç®—ç¬¦ï¼šæŠŠ â€œâ€ å·¦è¾¹çš„è¿ç®—æ•°çš„å„äºŒè¿›ä½å…¨éƒ¨å³ç§»è‹¥å¹²ä½ï¼Œâ€â€ å³è¾¹çš„æ•°æŒ‡å®šç§»åŠ¨çš„ä½æ•° a 2 è¾“å‡ºç»“æœ 15 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 0000 1111 ä»¥ä¸‹å®ä¾‹æ¼”ç¤ºäº† Python æ‰€æœ‰ä½è¿ç®—ç¬¦çš„æ“ä½œï¼š #!/usr/bin/python3 a = 60 # 60 = 0011 1100 b = 13 # 13 = 0000 1101 c = 0 c = a b # 12 = 0000 1100print (1 - c çš„å€¼ä¸ºï¼š, c) c = a | b # 61 = 0011 1101 print (2 - c çš„å€¼ä¸ºï¼š, c) c = a ^ b # 49 = 0011 0001print (3 - c çš„å€¼ä¸ºï¼š, c) c = ~a # -61 = 1100 0011print (4 - c çš„å€¼ä¸ºï¼š, c) c = a 2 # 240 = 1111 0000print (5 - c çš„å€¼ä¸ºï¼š, c) c = a 2 # 15 = 0000 1111print (6 - c çš„å€¼ä¸ºï¼š, c) ä»¥ä¸Šå®ä¾‹è¾“å‡ºç»“æœï¼š 1 - c çš„å€¼ä¸ºï¼š 122 - c çš„å€¼ä¸ºï¼š 613 - c çš„å€¼ä¸ºï¼š 494 - c çš„å€¼ä¸ºï¼š -615 - c çš„å€¼ä¸ºï¼š 2406 - c çš„å€¼ä¸ºï¼š 15 Python é€»è¾‘è¿ç®—ç¬¦Python è¯­è¨€æ”¯æŒé€»è¾‘è¿ç®—ç¬¦ï¼Œä»¥ä¸‹å‡è®¾å˜é‡ a ä¸º 10, b ä¸º 20: è¿ç®—ç¬¦ é€»è¾‘è¡¨è¾¾å¼ æè¿° å®ä¾‹ and x and y å¸ƒå°” â€œä¸â€ - å¦‚æœ x ä¸º Falseï¼Œx and y è¿”å› x çš„å€¼ï¼Œå¦åˆ™è¿”å› y çš„è®¡ç®—å€¼ã€‚ (a and b) è¿”å› 20ã€‚ or x or y å¸ƒå°” â€œæˆ–â€ - å¦‚æœ x æ˜¯ Trueï¼Œå®ƒè¿”å› x çš„å€¼ï¼Œå¦åˆ™å®ƒè¿”å› y çš„è®¡ç®—å€¼ã€‚ (a or b) è¿”å› 10ã€‚ not not x å¸ƒå°” â€œéâ€ - å¦‚æœ x ä¸º Trueï¼Œè¿”å› False ã€‚å¦‚æœ x ä¸º Falseï¼Œå®ƒè¿”å› Trueã€‚ not(a and b) è¿”å› False ä»¥ä¸Šå®ä¾‹è¾“å‡ºç»“æœï¼š #!/usr/bin/python3 a = 10b = 20 if ( a and b ): print (1 - å˜é‡ a å’Œ b éƒ½ä¸º true) # 1 - å˜é‡ a å’Œ b éƒ½ä¸º trueelse: print (1 - å˜é‡ a å’Œ b æœ‰ä¸€ä¸ªä¸ä¸º true) if ( a or b ): print (2 - å˜é‡ a å’Œ b éƒ½ä¸º trueï¼Œæˆ–å…¶ä¸­ä¸€ä¸ªå˜é‡ä¸º true) # 2 - å˜é‡ a å’Œ b éƒ½ä¸º trueï¼Œæˆ–å…¶ä¸­ä¸€ä¸ªå˜é‡ä¸º trueelse: print (2 - å˜é‡ a å’Œ b éƒ½ä¸ä¸º true) # ä¿®æ”¹å˜é‡ a çš„å€¼a = 0if ( a and b ): print (3 - å˜é‡ a å’Œ b éƒ½ä¸º true)else: print (3 - å˜é‡ a å’Œ b æœ‰ä¸€ä¸ªä¸ä¸º true) # 3 - å˜é‡ a å’Œ b æœ‰ä¸€ä¸ªä¸ä¸º true if ( a or b ): print (4 - å˜é‡ a å’Œ b éƒ½ä¸º trueï¼Œæˆ–å…¶ä¸­ä¸€ä¸ªå˜é‡ä¸º true) # 4 - å˜é‡ a å’Œ b éƒ½ä¸º trueï¼Œæˆ–å…¶ä¸­ä¸€ä¸ªå˜é‡ä¸º trueelse: print (4 - å˜é‡ a å’Œ b éƒ½ä¸ä¸º true) if not( a and b ): print (5 - å˜é‡ a å’Œ b éƒ½ä¸º falseï¼Œæˆ–å…¶ä¸­ä¸€ä¸ªå˜é‡ä¸º false) # 5 - å˜é‡ a å’Œ b éƒ½ä¸º falseï¼Œæˆ–å…¶ä¸­ä¸€ä¸ªå˜é‡ä¸º falseelse: print (5 - å˜é‡ a å’Œ b éƒ½ä¸º true) Python æˆå‘˜è¿ç®—ç¬¦é™¤äº†ä»¥ä¸Šçš„ä¸€äº›è¿ç®—ç¬¦ä¹‹å¤–ï¼ŒPython è¿˜æ”¯æŒæˆå‘˜è¿ç®—ç¬¦ï¼Œæµ‹è¯•å®ä¾‹ä¸­åŒ…å«äº†ä¸€ç³»åˆ—çš„æˆå‘˜ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ï¼Œåˆ—è¡¨æˆ–å…ƒç»„ã€‚ è¿ç®—ç¬¦ æè¿° å®ä¾‹ in å¦‚æœåœ¨æŒ‡å®šçš„åºåˆ—ä¸­æ‰¾åˆ°å€¼è¿”å› Trueï¼Œå¦åˆ™è¿”å› Falseã€‚ x åœ¨ y åºåˆ—ä¸­ , å¦‚æœ x åœ¨ y åºåˆ—ä¸­è¿”å› Trueã€‚ not in å¦‚æœåœ¨æŒ‡å®šçš„åºåˆ—ä¸­æ²¡æœ‰æ‰¾åˆ°å€¼è¿”å› Trueï¼Œå¦åˆ™è¿”å› Falseã€‚ x ä¸åœ¨ y åºåˆ—ä¸­ , å¦‚æœ x ä¸åœ¨ y åºåˆ—ä¸­è¿”å› Trueã€‚ ä»¥ä¸‹å®ä¾‹æ¼”ç¤ºäº† Python æ‰€æœ‰æˆå‘˜è¿ç®—ç¬¦çš„æ“ä½œï¼š #!/usr/bin/python3 a = 10b = 20list = [1, 2, 3, 4, 5 ] if ( a in list ): print (1 - å˜é‡ a åœ¨ç»™å®šçš„åˆ—è¡¨ä¸­ list ä¸­)else: print (1 - å˜é‡ a ä¸åœ¨ç»™å®šçš„åˆ—è¡¨ä¸­ list ä¸­) if ( b not in list ): print (2 - å˜é‡ b ä¸åœ¨ç»™å®šçš„åˆ—è¡¨ä¸­ list ä¸­)else: print (2 - å˜é‡ b åœ¨ç»™å®šçš„åˆ—è¡¨ä¸­ list ä¸­) # ä¿®æ”¹å˜é‡ a çš„å€¼a = 2if ( a in list ): print (3 - å˜é‡ a åœ¨ç»™å®šçš„åˆ—è¡¨ä¸­ list ä¸­)else: print (3 - å˜é‡ a ä¸åœ¨ç»™å®šçš„åˆ—è¡¨ä¸­ list ä¸­) ä»¥ä¸Šç¤ºä¾‹è¾“å‡ºç»“æœï¼š 1 - å˜é‡ a ä¸åœ¨ç»™å®šçš„åˆ—è¡¨ä¸­ list ä¸­2 - å˜é‡ b ä¸åœ¨ç»™å®šçš„åˆ—è¡¨ä¸­ list ä¸­3 - å˜é‡ a åœ¨ç»™å®šçš„åˆ—è¡¨ä¸­ list ä¸­ Python èº«ä»½è¿ç®—ç¬¦èº«ä»½è¿ç®—ç¬¦ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å­˜å‚¨å•å…ƒ è¿ç®—ç¬¦ æè¿° å®ä¾‹ is is æ˜¯åˆ¤æ–­ä¸¤ä¸ªæ ‡è¯†ç¬¦æ˜¯ä¸æ˜¯å¼•ç”¨è‡ªä¸€ä¸ªå¯¹è±¡ x is y, ç±»ä¼¼ id(x) id(y) , å¦‚æœå¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡åˆ™è¿”å› Trueï¼Œå¦åˆ™è¿”å› False is not is not æ˜¯åˆ¤æ–­ä¸¤ä¸ªæ ‡è¯†ç¬¦æ˜¯ä¸æ˜¯å¼•ç”¨è‡ªä¸åŒå¯¹è±¡ x is not y ï¼Œ ç±»ä¼¼ **id(x) ! id(y)**ã€‚å¦‚æœå¼•ç”¨çš„ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡åˆ™è¿”å›ç»“æœ Trueï¼Œå¦åˆ™è¿”å› Falseã€‚ æ³¨ï¼š id() å‡½æ•°ç”¨äºè·å–å¯¹è±¡å†…å­˜åœ°å€ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ¼”ç¤ºäº† Python æ‰€æœ‰èº«ä»½è¿ç®—ç¬¦çš„æ“ä½œï¼š #!/usr/bin/python3 a = 20b = 20 if ( a is b ): print (1 - a å’Œ b æœ‰ç›¸åŒçš„æ ‡è¯†)else: print (1 - a å’Œ b æ²¡æœ‰ç›¸åŒçš„æ ‡è¯†) if ( id(a) == id(b) ): print (2 - a å’Œ b æœ‰ç›¸åŒçš„æ ‡è¯†)else: print (2 - a å’Œ b æ²¡æœ‰ç›¸åŒçš„æ ‡è¯†) # ä¿®æ”¹å˜é‡ b çš„å€¼b = 30if ( a is b ): print (3 - a å’Œ b æœ‰ç›¸åŒçš„æ ‡è¯†)else: print (3 - a å’Œ b æ²¡æœ‰ç›¸åŒçš„æ ‡è¯†) if ( a is not b ): print (4 - a å’Œ b æ²¡æœ‰ç›¸åŒçš„æ ‡è¯†)else: print (4 - a å’Œ b æœ‰ç›¸åŒçš„æ ‡è¯†) ä»¥ä¸Šç¤ºä¾‹è¾“å‡ºç»“æœï¼š 1 - a å’Œ b æœ‰ç›¸åŒçš„æ ‡è¯†2 - a å’Œ b æœ‰ç›¸åŒçš„æ ‡è¯†3 - a å’Œ b æ²¡æœ‰ç›¸åŒçš„æ ‡è¯†4 - a å’Œ b æ²¡æœ‰ç›¸åŒçš„æ ‡è¯† #is ä¸ == åŒºåˆ«ï¼š#is ç”¨äºåˆ¤æ–­ä¸¤ä¸ªå˜é‡å¼•ç”¨å¯¹è±¡æ˜¯å¦ä¸ºåŒä¸€ä¸ªï¼Œ == ç”¨äºåˆ¤æ–­å¼•ç”¨å˜é‡çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚a = [1, 2, 3] b = a b is a True b == aTrue b = a[:] b is aFalse b == aTrue Python è¿ç®—ç¬¦ä¼˜å…ˆçº§ä»¥ä¸‹è¡¨æ ¼åˆ—å‡ºäº†ä»æœ€é«˜åˆ°æœ€ä½ä¼˜å…ˆçº§çš„æ‰€æœ‰è¿ç®—ç¬¦ï¼Œ ç›¸åŒå•å…ƒæ ¼å†…çš„è¿ç®—ç¬¦å…·æœ‰ç›¸åŒä¼˜å…ˆçº§ã€‚ è¿ç®—ç¬¦å‡æŒ‡äºŒå…ƒè¿ç®—ï¼Œé™¤éç‰¹åˆ«æŒ‡å‡ºã€‚ ç›¸åŒå•å…ƒæ ¼å†…çš„è¿ç®—ç¬¦ä»å·¦è‡³å³åˆ†ç»„ï¼ˆé™¤äº†å¹‚è¿ç®—æ˜¯ä»å³è‡³å·¦åˆ†ç»„ï¼‰ï¼š è¿ç®—ç¬¦ æè¿° (expressions...), [expressions...], key: value..., expressions... åœ†æ‹¬å·çš„è¡¨è¾¾å¼ x[index], x[index:index], x(arguments...), x.attribute è¯»å–ï¼Œåˆ‡ç‰‡ï¼Œè°ƒç”¨ï¼Œå±æ€§å¼•ç”¨ await x await è¡¨è¾¾å¼ ** ä¹˜æ–¹(æŒ‡æ•°) +x, -x, ~x æ­£ï¼Œè´Ÿï¼ŒæŒ‰ä½é NOT *, @, /, //, % ä¹˜ï¼ŒçŸ©é˜µä¹˜ï¼Œé™¤ï¼Œæ•´é™¤ï¼Œå–ä½™ +, - åŠ å’Œå‡ , ç§»ä½ æŒ‰ä½ä¸ AND ^ æŒ‰ä½å¼‚æˆ– XOR | æŒ‰ä½æˆ– OR in,not in, is,is not, , =, , =, !=, == æ¯”è¾ƒè¿ç®—ï¼ŒåŒ…æ‹¬æˆå‘˜æ£€æµ‹å’Œæ ‡è¯†å·æ£€æµ‹ not x é€»è¾‘é NOT and é€»è¾‘ä¸ AND or é€»è¾‘æˆ– OR if -- else æ¡ä»¶è¡¨è¾¾å¼ lambda lambda è¡¨è¾¾å¼ := èµ‹å€¼è¡¨è¾¾å¼ ä»¥ä¸‹å®ä¾‹æ¼”ç¤ºäº† Python æ‰€æœ‰è¿ç®—ç¬¦ä¼˜å…ˆçº§çš„æ“ä½œï¼š #!/usr/bin/python3 a = 20b = 10c = 15d = 5e = 0 e = (a + b) * c / d #( 30 * 15 ) / 5print ((a + b) * c / d è¿ç®—ç»“æœä¸ºï¼š, e) e = ((a + b) * c) / d # (30 * 15 ) / 5print (((a + b) * c) / d è¿ç®—ç»“æœä¸ºï¼š, e) e = (a + b) * (c / d) # (30) * (15/5)print ((a + b) * (c / d) è¿ç®—ç»“æœä¸ºï¼š, e) e = a + (b * c) / d # 20 + (150/5)print (a + (b * c) / d è¿ç®—ç»“æœä¸ºï¼š, e) ä»¥ä¸Šå®ä¾‹è¾“å‡ºç»“æœï¼š (a + b) * c / d è¿ç®—ç»“æœä¸ºï¼š 90.0((a + b) * c) / d è¿ç®—ç»“æœä¸ºï¼š 90.0(a + b) * (c / d) è¿ç®—ç»“æœä¸ºï¼š 90.0a + (b * c) / d è¿ç®—ç»“æœä¸ºï¼š 50.0 and æ‹¥æœ‰æ›´é«˜ä¼˜å…ˆçº§: x = Truey = Falsez = False if x or y and z: print(yes)else: print(no) ä»¥ä¸Šå®ä¾‹å…ˆè®¡ç®— y and z å¹¶è¿”å› False ï¼Œç„¶å x or False è¿”å› Trueï¼Œè¾“å‡ºç»“æœï¼š yes æ³¨æ„ï¼š Python3 å·²ä¸æ”¯æŒ è¿ç®—ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨ ! ä»£æ›¿ï¼Œå¦‚æœä½ ä¸€å®šè¦ä½¿ç”¨è¿™ç§æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„æ–¹å¼ï¼š from __future__ import barry_as_FLUFL 1 2 True python","tags":[null],"categories":[null]},{"title":"Pythonè¿­ä»£å™¨å’Œç”Ÿæˆå™¨","path":"/wiki/Python/è¿­ä»£å™¨å’Œç”Ÿæˆå™¨.html","content":"è¿­ä»£å™¨è¿­ä»£æ˜¯ Python æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œæ˜¯è®¿é—®é›†åˆå…ƒç´ çš„ä¸€ç§æ–¹å¼ã€‚ è¿­ä»£å™¨æ˜¯ä¸€ä¸ªå¯ä»¥è®°ä½éå†çš„ä½ç½®çš„å¯¹è±¡ã€‚ è¿­ä»£å™¨å¯¹è±¡ä»é›†åˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹è®¿é—®ï¼Œç›´åˆ°æ‰€æœ‰çš„å…ƒç´ è¢«è®¿é—®å®Œç»“æŸã€‚è¿­ä»£å™¨åªèƒ½å¾€å‰ä¸ä¼šåé€€ã€‚ è¿­ä»£å™¨æœ‰ä¸¤ä¸ªåŸºæœ¬çš„æ–¹æ³•ï¼šiter() å’Œ next()ã€‚ å­—ç¬¦ä¸²ï¼Œåˆ—è¡¨æˆ–å…ƒç»„å¯¹è±¡éƒ½å¯ç”¨äºåˆ›å»ºè¿­ä»£å™¨ï¼š str = abcdit1 = iter(str)print(it1) # str_ascii_iterator object at 0x000001E778C5F370list = [1,2,3,4]it2 = iter(list) print(it2) # list_iterator object at 0x000001E778C5F3D0tup = (1,2,3,4)it3 = iter(tup) print(it3) # tuple_iterator object at 0x000001E778C5F400set = 1,2,3,4it4 = iter(set)print(it4) # set_iterator object at 0x000001E778C7E080dic = a:1,b:2it5 = iter(dic)print(it5) # dict_keyiterator object at 0x000001E778BFB4C0 è¿­ä»£å™¨å¯¹è±¡å¯ä»¥ä½¿ç”¨å¸¸è§„ for è¯­å¥è¿›è¡Œéå†ï¼š #!/usr/bin/python3 list=[1,2,3,4]it = iter(list) # åˆ›å»ºè¿­ä»£å™¨å¯¹è±¡for x in it: print (x, end= ) #1 2 3 4 ä¹Ÿå¯ä»¥ä½¿ç”¨ next() å‡½æ•°ï¼š #!/usr/bin/python3 import sys # å¼•å…¥ sys æ¨¡å— list=[1,2,3,4]it = iter(list) # åˆ›å»ºè¿­ä»£å™¨å¯¹è±¡ while True: try: print (next(it)) except StopIteration: # StopIteration å¼‚å¸¸ç”¨äºæ ‡è¯†è¿­ä»£çš„å®Œæˆï¼Œé˜²æ­¢å‡ºç°æ— é™å¾ªç¯çš„æƒ…å†µï¼Œ sys.exit() è¾“å‡ºç»“æœï¼š 1234 ç”Ÿæˆå™¨(yield)åœ¨ Python ä¸­ï¼Œä½¿ç”¨äº† yield çš„å‡½æ•°è¢«ç§°ä¸ºç”Ÿæˆå™¨ï¼ˆgeneratorï¼‰ã€‚ yield æ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œç”¨äºå®šä¹‰ç”Ÿæˆå™¨å‡½æ•°ï¼Œç”Ÿæˆå™¨å‡½æ•°æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ï¼Œå¯ä»¥åœ¨è¿­ä»£è¿‡ç¨‹ä¸­é€æ­¥äº§ç”Ÿå€¼ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§è¿”å›æ‰€æœ‰ç»“æœã€‚ è·Ÿæ™®é€šå‡½æ•°ä¸åŒçš„æ˜¯ï¼Œç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªè¿”å›è¿­ä»£å™¨çš„å‡½æ•°ï¼Œåªèƒ½ç”¨äºè¿­ä»£æ“ä½œï¼Œæ›´ç®€å•ç‚¹ç†è§£ç”Ÿæˆå™¨å°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚ å½“åœ¨ç”Ÿæˆå™¨å‡½æ•°ä¸­ä½¿ç”¨ yield è¯­å¥æ—¶ï¼Œå‡½æ•°çš„æ‰§è¡Œå°†ä¼šæš‚åœï¼Œå¹¶å°† yield åé¢çš„è¡¨è¾¾å¼ä½œä¸ºå½“å‰è¿­ä»£çš„å€¼è¿”å›ã€‚ ç„¶åï¼Œæ¯æ¬¡è°ƒç”¨ç”Ÿæˆå™¨çš„ next() æ–¹æ³•æˆ–ä½¿ç”¨ for å¾ªç¯è¿›è¡Œè¿­ä»£æ—¶ï¼Œå‡½æ•°ä¼šä»ä¸Šæ¬¡æš‚åœçš„åœ°æ–¹ç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°å†æ¬¡é‡åˆ° yield è¯­å¥ã€‚è¿™æ ·ï¼Œç”Ÿæˆå™¨å‡½æ•°å¯ä»¥é€æ­¥äº§ç”Ÿå€¼ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§è®¡ç®—å¹¶è¿”å›æ‰€æœ‰ç»“æœã€‚ è°ƒç”¨ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†ç”Ÿæˆå™¨å‡½æ•°çš„ä½¿ç”¨ï¼š def countdown(n): while n 0: yield n n -= 1 # åˆ›å»ºç”Ÿæˆå™¨å¯¹è±¡generator = countdown(5) # é€šè¿‡è¿­ä»£ç”Ÿæˆå™¨è·å–å€¼print(next(generator)) # è¾“å‡º: 5print(next(generator)) # è¾“å‡º: 4print(next(generator)) # è¾“å‡º: 3 # ä½¿ç”¨ for å¾ªç¯è¿­ä»£ç”Ÿæˆå™¨for value in generator: print(value) # è¾“å‡º: 2 1 ä»¥ä¸Šå®ä¾‹ä¸­ï¼Œcountdown å‡½æ•°æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ã€‚å®ƒä½¿ç”¨ yield è¯­å¥é€æ­¥äº§ç”Ÿä» n åˆ° 1 çš„å€’æ•°æ•°å­—ã€‚åœ¨æ¯æ¬¡è°ƒç”¨ yield è¯­å¥æ—¶ï¼Œå‡½æ•°ä¼šè¿”å›å½“å‰çš„å€’æ•°å€¼ï¼Œå¹¶åœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨æ—¶ä»ä¸Šæ¬¡æš‚åœçš„åœ°æ–¹ç»§ç»­æ‰§è¡Œã€‚ é€šè¿‡åˆ›å»ºç”Ÿæˆå™¨å¯¹è±¡å¹¶ä½¿ç”¨ next() å‡½æ•°æˆ– for å¾ªç¯è¿­ä»£ç”Ÿæˆå™¨ï¼Œæˆ‘ä»¬å¯ä»¥é€æ­¥è·å–ç”Ÿæˆå™¨å‡½æ•°äº§ç”Ÿçš„å€¼ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨ next() å‡½æ•°è·å–å‰ä¸‰ä¸ªå€’æ•°å€¼ï¼Œç„¶åé€šè¿‡ for å¾ªç¯è·å–å‰©ä¸‹çš„ä¸¤ä¸ªå€’æ•°å€¼ã€‚ ç”Ÿæˆå™¨å‡½æ•°çš„ä¼˜åŠ¿æ˜¯å®ƒä»¬å¯ä»¥æŒ‰éœ€ç”Ÿæˆå€¼ï¼Œé¿å…ä¸€æ¬¡æ€§ç”Ÿæˆå¤§é‡æ•°æ®å¹¶å ç”¨å¤§é‡å†…å­˜ã€‚æ­¤å¤–ï¼Œç”Ÿæˆå™¨è¿˜å¯ä»¥ä¸å…¶ä»–è¿­ä»£å·¥å…·ï¼ˆå¦‚ for å¾ªç¯ï¼‰æ— ç¼é…åˆä½¿ç”¨ï¼Œæä¾›ç®€æ´å’Œé«˜æ•ˆçš„è¿­ä»£æ–¹å¼ã€‚","tags":[null],"categories":[null]},{"title":"Pythoné”™è¯¯å’Œå¼‚å¸¸","path":"/wiki/Python/é”™è¯¯å’Œå¼‚å¸¸.html","content":"Python æœ‰ä¸¤ç§é”™è¯¯å¾ˆå®¹æ˜“è¾¨è®¤ï¼šè¯­æ³•é”™è¯¯å’Œå¼‚å¸¸ã€‚ Python assertï¼ˆæ–­è¨€ï¼‰ç”¨äºåˆ¤æ–­ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œåœ¨è¡¨è¾¾å¼æ¡ä»¶ä¸º false çš„æ—¶å€™è§¦å‘å¼‚å¸¸ã€‚ è¯­æ³•é”™è¯¯Python çš„è¯­æ³•é”™è¯¯æˆ–è€…ç§°ä¹‹ä¸ºè§£æé”™ï¼Œæ˜¯åˆå­¦è€…ç»å¸¸ç¢°åˆ°çš„ï¼Œå¦‚ä¸‹ï¼š while True print(Hello world) File stdin, line 1, in ? while True print(Hello world) ^SyntaxError: invalid syntax è¿™ä¸ªä¾‹å­ä¸­ï¼Œå‡½æ•° print() è¢«æ£€æŸ¥åˆ°æœ‰é”™è¯¯ï¼Œæ˜¯å®ƒå‰é¢ç¼ºå°‘äº†ä¸€ä¸ªå†’å· : ã€‚ è¯­æ³•åˆ†æå™¨æŒ‡å‡ºäº†å‡ºé”™çš„ä¸€è¡Œï¼Œå¹¶ä¸”åœ¨æœ€å…ˆæ‰¾åˆ°çš„é”™è¯¯çš„ä½ç½®æ ‡è®°äº†ä¸€ä¸ªå°å°çš„ç®­å¤´ã€‚ å¼‚å¸¸å³ä¾¿ Python ç¨‹åºçš„è¯­æ³•æ˜¯æ­£ç¡®çš„ï¼Œåœ¨è¿è¡Œå®ƒçš„æ—¶å€™ï¼Œä¹Ÿæœ‰å¯èƒ½å‘ç”Ÿé”™è¯¯ã€‚è¿è¡ŒæœŸæ£€æµ‹åˆ°çš„é”™è¯¯è¢«ç§°ä¸ºå¼‚å¸¸ã€‚ å¤§å¤šæ•°çš„å¼‚å¸¸éƒ½ä¸ä¼šè¢«ç¨‹åºå¤„ç†ï¼Œéƒ½ä»¥é”™è¯¯ä¿¡æ¯çš„å½¢å¼å±•ç°åœ¨è¿™é‡Œ: 10 * (1/0) # 0 ä¸èƒ½ä½œä¸ºé™¤æ•°ï¼Œè§¦å‘å¼‚å¸¸Traceback (most recent call last): File stdin, line 1, in ?ZeroDivisionError: division by zero 4 + spam*3 # spam æœªå®šä¹‰ï¼Œè§¦å‘å¼‚å¸¸Traceback (most recent call last): File stdin, line 1, in ?NameError: name spam is not defined 2 + 2 # int ä¸èƒ½ä¸ str ç›¸åŠ ï¼Œè§¦å‘å¼‚å¸¸Traceback (most recent call last): File stdin, line 1, in moduleTypeError: can only concatenate str (not int) to str å¼‚å¸¸ä»¥ä¸åŒçš„ç±»å‹å‡ºç°ï¼Œè¿™äº›ç±»å‹éƒ½ä½œä¸ºä¿¡æ¯çš„ä¸€éƒ¨åˆ†æ‰“å°å‡ºæ¥: ä¾‹å­ä¸­çš„ç±»å‹æœ‰ ZeroDivisionErrorï¼ŒNameError å’Œ TypeErrorã€‚ é”™è¯¯ä¿¡æ¯çš„å‰é¢éƒ¨åˆ†æ˜¾ç¤ºäº†å¼‚å¸¸å‘ç”Ÿçš„ä¸Šä¸‹æ–‡ï¼Œå¹¶ä»¥è°ƒç”¨æ ˆçš„å½¢å¼æ˜¾ç¤ºå…·ä½“ä¿¡æ¯ã€‚ å¼‚å¸¸å¤„ç†å¼‚å¸¸æ•æ‰å¯ä»¥ä½¿ç”¨ try/except è¯­å¥ã€‚ ä»¥ä¸‹ä¾‹å­ä¸­ï¼Œè®©ç”¨æˆ·è¾“å…¥ä¸€ä¸ªåˆæ³•çš„æ•´æ•°ï¼Œä½†æ˜¯å…è®¸ç”¨æˆ·ä¸­æ–­è¿™ä¸ªç¨‹åºï¼ˆä½¿ç”¨ Control-C æˆ–è€…æ“ä½œç³»ç»Ÿæä¾›çš„æ–¹æ³•ï¼‰ã€‚ç”¨æˆ·ä¸­æ–­çš„ä¿¡æ¯ä¼šå¼•å‘ä¸€ä¸ª KeyboardInterrupt å¼‚å¸¸ã€‚ while True: try: x = int(input(è¯·è¾“å…¥ä¸€ä¸ªæ•°å­—: )) break except ValueError: print(æ‚¨è¾“å…¥çš„ä¸æ˜¯æ•°å­—ï¼Œè¯·å†æ¬¡å°è¯•è¾“å…¥ï¼) try è¯­å¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼å·¥ä½œï¼› é¦–å…ˆï¼Œæ‰§è¡Œ try å­å¥ï¼ˆåœ¨å…³é”®å­— try å’Œå…³é”®å­— except ä¹‹é—´çš„è¯­å¥ï¼‰ã€‚ å¦‚æœæ²¡æœ‰å¼‚å¸¸å‘ç”Ÿï¼Œå¿½ç•¥ except å­å¥ï¼Œtry å­å¥æ‰§è¡Œåç»“æŸã€‚ å¦‚æœåœ¨æ‰§è¡Œ try å­å¥çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆ try å­å¥ä½™ä¸‹çš„éƒ¨åˆ†å°†è¢«å¿½ç•¥ã€‚å¦‚æœå¼‚å¸¸çš„ç±»å‹å’Œ except ä¹‹åçš„åç§°ç›¸ç¬¦ï¼Œé‚£ä¹ˆå¯¹åº”çš„ except å­å¥å°†è¢«æ‰§è¡Œã€‚ å¦‚æœä¸€ä¸ªå¼‚å¸¸æ²¡æœ‰ä¸ä»»ä½•çš„ except åŒ¹é…ï¼Œé‚£ä¹ˆè¿™ä¸ªå¼‚å¸¸å°†ä¼šä¼ é€’ç»™ä¸Šå±‚çš„ try ä¸­ã€‚ ä¸€ä¸ª try è¯­å¥å¯èƒ½åŒ…å«å¤šä¸ª except å­å¥ï¼Œåˆ†åˆ«æ¥å¤„ç†ä¸åŒçš„ç‰¹å®šçš„å¼‚å¸¸ã€‚æœ€å¤šåªæœ‰ä¸€ä¸ªåˆ†æ”¯ä¼šè¢«æ‰§è¡Œã€‚ å¤„ç†ç¨‹åºå°†åªé’ˆå¯¹å¯¹åº”çš„ try å­å¥ä¸­çš„å¼‚å¸¸è¿›è¡Œå¤„ç†ï¼Œè€Œä¸æ˜¯å…¶ä»–çš„ try çš„å¤„ç†ç¨‹åºä¸­çš„å¼‚å¸¸ã€‚ ä¸€ä¸ª except å­å¥å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªå¼‚å¸¸ï¼Œè¿™äº›å¼‚å¸¸å°†è¢«æ”¾åœ¨ä¸€ä¸ªæ‹¬å·é‡Œæˆä¸ºä¸€ä¸ªå…ƒç»„ï¼Œä¾‹å¦‚ï¼š except (RuntimeError, TypeError, NameError): pass æœ€åä¸€ä¸ªexcept å­å¥å¯ä»¥å¿½ç•¥å¼‚å¸¸çš„åç§°ï¼Œå®ƒå°†è¢«å½“ä½œé€šé…ç¬¦ä½¿ç”¨ã€‚ä½ å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•æ‰“å°ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œç„¶åå†æ¬¡æŠŠå¼‚å¸¸æŠ›å‡ºã€‚ import systry: f = open(myfile.txt) s = f.readline() i = int(s.strip())except OSError as err: print(OS error: 0.format(err))except ValueError: print(Could not convert data to an integer.)except: print(Unexpected error:, sys.exc_info()[0]) raise tryexceptâ€¦elsetry/except è¯­å¥è¿˜æœ‰ä¸€ä¸ªå¯é€‰çš„ else å­å¥ï¼Œå¦‚æœä½¿ç”¨è¿™ä¸ªå­å¥ï¼Œé‚£ä¹ˆå¿…é¡»æ”¾åœ¨æ‰€æœ‰çš„ except å­å¥ä¹‹åã€‚ else å­å¥å°†åœ¨ try å­å¥æ²¡æœ‰å‘ç”Ÿä»»ä½•å¼‚å¸¸çš„æ—¶å€™æ‰§è¡Œã€‚ ä»¥ä¸‹å®ä¾‹åœ¨ try è¯­å¥ä¸­åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å¯ä»¥æ‰“å¼€ï¼Œå¦‚æœæ‰“å¼€æ–‡ä»¶æ—¶æ­£å¸¸çš„æ²¡æœ‰å‘ç”Ÿå¼‚å¸¸åˆ™æ‰§è¡Œ else éƒ¨åˆ†çš„è¯­å¥ï¼Œè¯»å–æ–‡ä»¶å†…å®¹ï¼š for arg in sys.argv[1:]: try: f = open(arg, r) except IOError: print(cannot open, arg) else: print(arg, has, len(f.readlines()), lines) f.close() ä½¿ç”¨ else å­å¥æ¯”æŠŠæ‰€æœ‰çš„è¯­å¥éƒ½æ”¾åœ¨ try å­å¥é‡Œé¢è¦å¥½ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸€äº›æ„æƒ³ä¸åˆ°ï¼Œè€Œ except åˆæ— æ³•æ•è·çš„å¼‚å¸¸ã€‚ å¼‚å¸¸å¤„ç†å¹¶ä¸ä»…ä»…å¤„ç†é‚£äº›ç›´æ¥å‘ç”Ÿåœ¨ try å­å¥ä¸­çš„å¼‚å¸¸ï¼Œè€Œä¸”è¿˜èƒ½å¤„ç†å­å¥ä¸­è°ƒç”¨çš„å‡½æ•°ï¼ˆç”šè‡³é—´æ¥è°ƒç”¨çš„å‡½æ•°ï¼‰é‡ŒæŠ›å‡ºçš„å¼‚å¸¸ã€‚ ä¾‹å¦‚ï¼š def this_fails(): x = 1/0 try: this_fails() except ZeroDivisionError as err: print(Handling run-time error:, err) Handling run-time error: int division or modulo by zero tryâ€¦finallytry-finally è¯­å¥æ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸éƒ½å°†æ‰§è¡Œæœ€åçš„ä»£ç ã€‚ ä»¥ä¸‹å®ä¾‹ä¸­ finally è¯­å¥æ— è®ºå¼‚å¸¸æ˜¯å¦å‘ç”Ÿéƒ½ä¼šæ‰§è¡Œï¼š try: runoob()except AssertionError as error: print(error)else: try: with open(file.log) as file: read_data = file.read() except FileNotFoundError as fnf_error: print(fnf_error)finally: print(è¿™å¥è¯ï¼Œæ— è®ºå¼‚å¸¸æ˜¯å¦å‘ç”Ÿéƒ½ä¼šæ‰§è¡Œã€‚) æŠ›å‡ºå¼‚å¸¸Python ä½¿ç”¨ raise è¯­å¥æŠ›å‡ºä¸€ä¸ªæŒ‡å®šçš„å¼‚å¸¸ã€‚ raise è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š raise [Exception [, args [, traceback]]] ä»¥ä¸‹å®ä¾‹å¦‚æœ x å¤§äº 5 å°±è§¦å‘å¼‚å¸¸ï¼š x = 10if x 5: raise Exception(x ä¸èƒ½å¤§äº 5ã€‚x çš„å€¼ä¸º: .format(x)) æ‰§è¡Œä»¥ä¸Šä»£ç ä¼šè§¦å‘å¼‚å¸¸ï¼š Traceback (most recent call last):File â€œtest.pyâ€, line 3, in moduleraise Exception(â€˜x ä¸èƒ½å¤§äº 5ã€‚x çš„å€¼ä¸º: {}â€™.format(x))Exception: x ä¸èƒ½å¤§äº 5ã€‚x çš„å€¼ä¸º: 10 raise å”¯ä¸€çš„ä¸€ä¸ªå‚æ•°æŒ‡å®šäº†è¦è¢«æŠ›å‡ºçš„å¼‚å¸¸ã€‚å®ƒå¿…é¡»æ˜¯ä¸€ä¸ªå¼‚å¸¸çš„å®ä¾‹æˆ–è€…æ˜¯å¼‚å¸¸çš„ç±»ï¼ˆä¹Ÿå°±æ˜¯ Exception çš„å­ç±»ï¼‰ã€‚ å¦‚æœä½ åªæƒ³çŸ¥é“è¿™æ˜¯å¦æŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼Œå¹¶ä¸æƒ³å»å¤„ç†å®ƒï¼Œé‚£ä¹ˆä¸€ä¸ªç®€å•çš„ raise è¯­å¥å°±å¯ä»¥å†æ¬¡æŠŠå®ƒæŠ›å‡ºã€‚ try: raise NameError(HiThere) # æ¨¡æ‹Ÿä¸€ä¸ªå¼‚å¸¸ã€‚ except NameError: print(An exception flew by!) raise # å†æ¬¡æŠ›å‡º An exception flew by!Traceback (most recent call last): File stdin, line 2, in ?NameError: HiThere ç”¨æˆ·è‡ªå®šä¹‰å¼‚å¸¸ä½ å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°çš„å¼‚å¸¸ç±»æ¥æ‹¥æœ‰è‡ªå·±çš„å¼‚å¸¸ã€‚å¼‚å¸¸ç±»ç»§æ‰¿è‡ª Exception ç±»ï¼Œå¯ä»¥ç›´æ¥ç»§æ‰¿ï¼Œæˆ–è€…é—´æ¥ç»§æ‰¿ã€‚ class MyError(Exception): def __init__(self, value): self.value = value def __str__(self): return repr(self.value) try: raise MyError(2*2) except MyError as e: print(My exception occurred, value:, e.value) My exception occurred, value: 4 raise MyError(oops!)Traceback (most recent call last): File stdin, line 1, in ?__main__.MyError: oops! åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç±» Exception é»˜è®¤çš„ __init__() è¢«è¦†ç›–ã€‚ å½“åˆ›å»ºä¸€ä¸ªæ¨¡å—æœ‰å¯èƒ½æŠ›å‡ºå¤šç§ä¸åŒçš„å¼‚å¸¸æ—¶ï¼Œä¸€ç§é€šå¸¸çš„åšæ³•æ˜¯ä¸ºè¿™ä¸ªåŒ…å»ºç«‹ä¸€ä¸ªåŸºç¡€å¼‚å¸¸ç±»ï¼Œç„¶ååŸºäºè¿™ä¸ªåŸºç¡€ç±»ä¸ºä¸åŒçš„é”™è¯¯æƒ…å†µåˆ›å»ºä¸åŒçš„å­ç±»ï¼š class Error(Exception): Base class for exceptions in this module. passclass InputError(Error): Exception raised for errors in the input. Attributes: expression -- input expression in which the error occurred message -- explanation of the error def __init__(self, expression, message): self.expression = expression self.message = messageclass TransitionError(Error): Raised when an operation attempts a state transition thats not allowed. Attributes: previous -- state at beginning of transition next -- attempted new state message -- explanation of why the specific transition is not allowed def __init__(self, previous, next, message): self.previous = previous self.next = next self.message = message å¤§å¤šæ•°çš„å¼‚å¸¸çš„åå­—éƒ½ä»¥ â€œErrorâ€ ç»“å°¾ï¼Œå°±è·Ÿæ ‡å‡†çš„å¼‚å¸¸å‘½åä¸€æ ·ã€‚ å®šä¹‰æ¸…ç†è¡Œä¸ºtry è¯­å¥è¿˜æœ‰å¦å¤–ä¸€ä¸ªå¯é€‰çš„å­å¥ï¼Œå®ƒå®šä¹‰äº†æ— è®ºåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¼šæ‰§è¡Œçš„æ¸…ç†è¡Œä¸ºã€‚ try:... raise KeyboardInterrupt... finally:... print(Goodbye, world!)... Goodbye, world!Traceback (most recent call last): File stdin, line 2, in moduleKeyboardInterrupt ä»¥ä¸Šä¾‹å­ä¸ç®¡ try å­å¥é‡Œé¢æœ‰æ²¡æœ‰å‘ç”Ÿå¼‚å¸¸ï¼Œfinally å­å¥éƒ½ä¼šæ‰§è¡Œã€‚ å¦‚æœä¸€ä¸ªå¼‚å¸¸åœ¨ try å­å¥é‡Œï¼ˆæˆ–è€…åœ¨ except å’Œ else å­å¥é‡Œï¼‰è¢«æŠ›å‡ºï¼Œè€Œåˆæ²¡æœ‰ä»»ä½•çš„ except æŠŠå®ƒæˆªä½ï¼Œé‚£ä¹ˆè¿™ä¸ªå¼‚å¸¸ä¼šåœ¨ finally å­å¥æ‰§è¡Œåè¢«æŠ›å‡ºã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªæ›´åŠ å¤æ‚çš„ä¾‹å­ï¼ˆåœ¨åŒä¸€ä¸ª try è¯­å¥é‡ŒåŒ…å« except å’Œ finally å­å¥ï¼‰: def divide(x, y): try: result = x / y except ZeroDivisionError: print(division by zero!) else: print(result is, result) finally: print(executing finally clause) divide(2, 1)result is 2.0executing finally clause divide(2, 0)division by zero!executing finally clause divide(2, 1)executing finally clauseTraceback (most recent call last): File stdin, line 1, in ? File stdin, line 3, in divideTypeError: unsupported operand type(s) for /: str and str finally å­å¥å§‹ç»ˆéƒ½ä¼šæ‰§è¡Œã€‚ é¢„å®šä¹‰çš„æ¸…ç†è¡Œä¸º(with)ä¸€äº›å¯¹è±¡å®šä¹‰äº†æ ‡å‡†çš„æ¸…ç†è¡Œä¸ºï¼Œæ— è®ºç³»ç»Ÿæ˜¯å¦æˆåŠŸçš„ä½¿ç”¨äº†å®ƒï¼Œä¸€æ—¦ä¸éœ€è¦å®ƒäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ ‡å‡†çš„æ¸…ç†è¡Œä¸ºå°±ä¼šæ‰§è¡Œã€‚ ä¸‹é¢è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å°è¯•æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åæŠŠå†…å®¹æ‰“å°åˆ°å±å¹•ä¸Šï¼š for line in open(myfile.txt): print(line, end=) ä»¥ä¸Šè¿™æ®µä»£ç çš„é—®é¢˜æ˜¯ï¼Œå½“æ‰§è¡Œå®Œæ¯•åï¼Œæ–‡ä»¶ä¼šä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œå¹¶æ²¡æœ‰è¢«å…³é—­ã€‚ å…³é”®è¯ with è¯­å¥å°±å¯ä»¥ä¿è¯è¯¸å¦‚æ–‡ä»¶ä¹‹ç±»çš„å¯¹è±¡åœ¨ä½¿ç”¨å®Œä¹‹åä¸€å®šä¼šæ­£ç¡®çš„æ‰§è¡Œä»–çš„æ¸…ç†æ–¹æ³•ï¼š with open(myfile.txt) as f: for line in f: print(line, end=) ä»¥ä¸Šè¿™æ®µä»£ç æ‰§è¡Œå®Œæ¯•åï¼Œå°±ç®—åœ¨å¤„ç†è¿‡ç¨‹ä¸­å‡ºé—®é¢˜äº†ï¼Œæ–‡ä»¶ f æ€»æ˜¯ä¼šå…³é—­ã€‚ Python ä¸­çš„ with è¯­å¥ç”¨äºå¼‚å¸¸å¤„ç†ï¼Œå°è£…äº† tryâ€¦exceptâ€¦finally ç¼–ç èŒƒå¼ï¼Œæé«˜äº†æ˜“ç”¨æ€§ã€‚ with è¯­å¥ä½¿ä»£ç æ›´æ¸…æ™°ã€æ›´å…·å¯è¯»æ€§ï¼Œ å®ƒç®€åŒ–äº†æ–‡ä»¶æµç­‰å…¬å…±èµ„æºçš„ç®¡ç†ã€‚ åœ¨å¤„ç†æ–‡ä»¶å¯¹è±¡æ—¶ä½¿ç”¨ with å…³é”®å­—æ˜¯ä¸€ç§å¾ˆå¥½çš„åšæ³•ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹ä»¥ä¸‹å‡ ç§ä»£ç å®ä¾‹ï¼š ä¸ä½¿ç”¨ withï¼Œä¹Ÿä¸ä½¿ç”¨ tryâ€¦exceptâ€¦finallyã€‚ file = open(./test_runoob.txt, w)file.write(hello world !)file.close() ä»¥ä¸Šä»£ç å¦‚æœåœ¨è°ƒç”¨ write çš„è¿‡ç¨‹ä¸­ï¼Œå‡ºç°äº†å¼‚å¸¸ï¼Œåˆ™ close æ–¹æ³•å°†æ— æ³•è¢«æ‰§è¡Œï¼Œå› æ­¤èµ„æºå°±ä¼šä¸€ç›´è¢«è¯¥ç¨‹åºå ç”¨è€Œæ— æ³•è¢«é‡Šæ”¾ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬å‘¢å¯ä»¥ä½¿ç”¨ tryâ€¦exceptâ€¦finally æ¥æ”¹è¿›ä»£ç ï¼š file = open(./test_runoob.txt, w)try: file.write(hello world)finally: file.close() ä»¥ä¸Šä»£ç æˆ‘ä»¬å¯¹å¯èƒ½å‘ç”Ÿå¼‚å¸¸çš„ä»£ç å¤„è¿›è¡Œ try æ•è·ï¼Œå‘ç”Ÿå¼‚å¸¸æ—¶æ‰§è¡Œ except ä»£ç å—ï¼Œfinally ä»£ç å—æ˜¯æ— è®ºä»€ä¹ˆæƒ…å†µéƒ½ä¼šæ‰§è¡Œï¼Œæ‰€ä»¥æ–‡ä»¶ä¼šè¢«å…³é—­ï¼Œä¸ä¼šå› ä¸ºæ‰§è¡Œå¼‚å¸¸è€Œå ç”¨èµ„æºã€‚ ä½¿ç”¨ with å…³é”®å­—ï¼š with open(./test_runoob.txt, w) as file: file.write(hello world !) ä½¿ç”¨ with å…³é”®å­—ç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨ f.close() æ–¹æ³•ï¼Œ with çš„ä½œç”¨ç­‰æ•ˆäº try/finally è¯­å¥æ˜¯ä¸€æ ·çš„ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨æ‰§è¡Œ with å…³é”®å­—åæ£€éªŒæ–‡ä»¶æ˜¯å¦å…³é—­ï¼š with open(./test_runoob.txt) as f:... read_data = f.read() # æŸ¥çœ‹æ–‡ä»¶æ˜¯å¦å…³é—­ f.closedTrue with è¯­å¥å®ç°åŸç†å»ºç«‹åœ¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¹‹ä¸Šã€‚ ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ˜¯ä¸€ä¸ªå®ç° __enter__ å’Œ __exit__ æ–¹æ³•çš„ç±»ã€‚ ä½¿ç”¨ with è¯­å¥ç¡®ä¿åœ¨åµŒå¥—å—çš„æœ«å°¾è°ƒç”¨ exit æ–¹æ³•ã€‚ è¿™ä¸ªæ¦‚å¿µç±»ä¼¼äº try...finally å—çš„ä½¿ç”¨ã€‚","tags":[null],"categories":[null]},{"title":"Pythoné¢å‘å¯¹è±¡","path":"/wiki/Python/é¢å‘å¯¹è±¡.html","content":"ç±»å®šä¹‰class ClassName: statement-1 . . . statement-N ç±»å®ä¾‹åŒ–åï¼Œå¯ä»¥ä½¿ç”¨å…¶å±æ€§ï¼Œå®é™…ä¸Šï¼Œåˆ›å»ºä¸€ä¸ªç±»ä¹‹åï¼Œå¯ä»¥é€šè¿‡ç±»åè®¿é—®å…¶å±æ€§ã€‚ å±æ€§ç±»å±æ€§ä¹Ÿå«ç±»å˜é‡ã€‚åœ¨ç±»ä¸­æ–¹æ³•å¤–å®šä¹‰çš„å±æ€§ã€‚ class Person: # ç±»å±æ€§ home = earthprint(Person.home) # é€šè¿‡ç±»åè®¿é—®ç±»å±æ€§p1 = Person() # åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡print(p1.home) # é€šè¿‡å®ä¾‹åè®¿é—®ç±»å±æ€§ï¼Œ(å¦‚æœå®ä¾‹æ²¡æœ‰è¦†ç›–è¿™ä¸ªç±»å±æ€§çš„å€¼) æ‰€æœ‰è¯¥ç±»çš„å®ä¾‹å…±äº«åŒä¸€ä¸ªç±»å±æ€§: class Person: äººçš„ç±» home = earth # å®šä¹‰ç±»å±æ€§ï¼Œæ‰€æœ‰å®ä¾‹å…±äº«p1 = Person() # åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡p2 = Person() # åˆ›å»ºå¦ä¸€ä¸ªå®ä¾‹å¯¹è±¡print(p1.home) # earthprint(p2.home) # earthPerson.home = mars # ä¿®æ”¹ç±»å±æ€§print(p1.home) # marsprint(p2.home) # mars å®ä¾‹å±æ€§ä¹Ÿå«å®ä¾‹å˜é‡ã€‚åœ¨ç±»æ–¹æ³•ä¸­å®šä¹‰çš„å±æ€§ã€‚é€šè¿‡ self.å±æ€§åå®šä¹‰ã€‚ class Person: äººçš„ç±» def __init__(self, name, age): self.name = name # å®šä¹‰å®ä¾‹å±æ€§ self.age = agep1 = Person(å¼ ä¸‰, 18) # åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡print(p1.name, p1.age) # å¼ ä¸‰ print(Person.name) # æŠ¥é”™ é€šè¿‡ [å®ä¾‹å.å±æ€§å] æ·»åŠ ä¸ä¿®æ”¹å®ä¾‹å±æ€§: class Person: äººçš„ç±» passp1 = Person() # åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡p1.name = å¼ ä¸‰ # æ·»åŠ å®ä¾‹å±æ€§p1.age = 18 # æ·»åŠ å®ä¾‹å±æ€§print(p1.name, p1.age) # å¼ ä¸‰ 18p1.age = 25 # ä¿®æ”¹å®ä¾‹å±æ€§print(p1.name, p1.age) # å¼ ä¸‰ 25 æ¯ä¸ªå®ä¾‹ç‹¬æœ‰ä¸€ä»½å®ä¾‹å±æ€§: class Person: äººçš„ç±» def __init__(self, name): self.name = name # å®šä¹‰å®ä¾‹å±æ€§ self.age = 0 # å®šä¹‰å®ä¾‹å±æ€§p1 = Person(å¼ ä¸‰) # åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡print(p1.name, p1.age) # å¼ ä¸‰ 0p1.age = 18 # ä¿®æ”¹p1çš„ageå±æ€§print(p1.name, p1.age) # å¼ ä¸‰ 18p2 = Person(æå››) # åˆ›å»ºå¦ä¸€ä¸ªå®ä¾‹å¯¹è±¡print(p2.name, p2.age) # æå›› 0 ç±»å¯¹è±¡ç±»å¯¹è±¡æ”¯æŒä¸¤ç§æ“ä½œï¼šå±æ€§å¼•ç”¨å’Œå®ä¾‹åŒ–ã€‚ å±æ€§å¼•ç”¨ä½¿ç”¨å’Œ Python ä¸­æ‰€æœ‰çš„å±æ€§å¼•ç”¨ä¸€æ ·çš„æ ‡å‡†è¯­æ³•ï¼šobj.nameã€‚ ç±»å¯¹è±¡åˆ›å»ºåï¼Œç±»å‘½åç©ºé—´ä¸­æ‰€æœ‰çš„å‘½åéƒ½æ˜¯æœ‰æ•ˆå±æ€§åã€‚æ‰€ä»¥å¦‚æœç±»å®šä¹‰æ˜¯è¿™æ ·ï¼š #!/usr/bin/python3 class MyClass: ä¸€ä¸ªç®€å•çš„ç±»å®ä¾‹ i = 12345 def f(self): return hello world # å®ä¾‹åŒ–ç±»x = MyClass() # è®¿é—®ç±»çš„å±æ€§å’Œæ–¹æ³•print(MyClass ç±»çš„å±æ€§ i ä¸ºï¼š, x.i)print(MyClass ç±»çš„æ–¹æ³• f è¾“å‡ºä¸ºï¼š, x.f()) ä»¥ä¸Šåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç±»å®ä¾‹å¹¶å°†è¯¥å¯¹è±¡èµ‹ç»™å±€éƒ¨å˜é‡ xï¼Œx ä¸ºç©ºçš„å¯¹è±¡ã€‚ æ‰§è¡Œä»¥ä¸Šç¨‹åºè¾“å‡ºç»“æœä¸ºï¼š MyClass ç±»çš„å±æ€§ i ä¸ºï¼š 12345MyClass ç±»çš„æ–¹æ³• f è¾“å‡ºä¸ºï¼š hello world ç±»æœ‰ä¸€ä¸ªåä¸º __init__() çš„ç‰¹æ®Šæ–¹æ³•ï¼ˆæ„é€ æ–¹æ³•ï¼‰ï¼Œè¯¥æ–¹æ³•åœ¨ç±»å®ä¾‹åŒ–æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š def __init__(self): self.data = [] ç±»å®šä¹‰äº† __init__() æ–¹æ³•ï¼Œç±»çš„å®ä¾‹åŒ–æ“ä½œä¼šè‡ªåŠ¨è°ƒç”¨ __init__() æ–¹æ³•ã€‚å¦‚ä¸‹å®ä¾‹åŒ–ç±» MyClassï¼Œå¯¹åº”çš„ __init__() æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ï¼š x = MyClass() å½“ç„¶ï¼Œ __init__() æ–¹æ³•å¯ä»¥æœ‰å‚æ•°ï¼Œå‚æ•°é€šè¿‡ __init__() ä¼ é€’åˆ°ç±»çš„å®ä¾‹åŒ–æ“ä½œä¸Šã€‚ä¾‹å¦‚: #!/usr/bin/python3 class Complex: def __init__(self, realpart, imagpart): self.r = realpart self.i = imagpartx = Complex(3.0, -4.5)print(x.r, x.i) # è¾“å‡ºç»“æœï¼š3.0 -4.5 æ–¹æ³•Pythonçš„ç±»ä¸­æœ‰ä¸‰ç§æ–¹æ³•ï¼šå®ä¾‹æ–¹æ³•ã€é™æ€æ–¹æ³•ã€ç±»æ–¹æ³•ã€‚ å®ä¾‹æ–¹æ³• å®ä¾‹æ–¹æ³•åœ¨ç±»ä¸­å®šä¹‰ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸º selfï¼Œä»£è¡¨å®ä¾‹æœ¬èº«ã€‚ å®ä¾‹æ–¹æ³•åªèƒ½è¢«å®ä¾‹å¯¹è±¡è°ƒç”¨ã€‚ å¯ä»¥è®¿é—®å®ä¾‹å±æ€§ã€ç±»å±æ€§ã€ç±»æ–¹æ³•ã€‚ class Person: äººçš„ç±» home = earth def __init__(self, name): self.name = name def instance_method(self): print(self.name, self.home, Person.home)p = Person(å¼ ä¸‰)p.instance_method() # å¼ ä¸‰ earth earthï¼Œæ­¤æ—¶pä¸­æ²¡æœ‰homeå®ä¾‹å±æ€§ï¼Œä¼šå»æŸ¥æ‰¾homeç±»å±æ€§Person.home = venus # ä¿®æ”¹ç±»å±æ€§p.home = mars # å®šä¹‰å®ä¾‹å±æ€§p.instance_method() # å¼ ä¸‰ mars venus selfself ä»£è¡¨ç±»çš„å®ä¾‹ï¼Œè€Œéç±»ã€‚ ç±»çš„æ–¹æ³•ä¸æ™®é€šçš„å‡½æ•°åªæœ‰ä¸€ä¸ªç‰¹åˆ«çš„åŒºåˆ«â€”â€”å®ƒä»¬å¿…é¡»æœ‰ä¸€ä¸ªé¢å¤–çš„ ç¬¬ä¸€ä¸ªå‚æ•°åç§°, æŒ‰ç…§æƒ¯ä¾‹å®ƒçš„åç§°æ˜¯ selfã€‚ class Test: def prt(self): print(self) print(self.__class__) t = Test()t.prt() è¾“å‡ºç»“æœï¼š **main**.Test object at 0x000002A70E826900class â€˜**main**.Testâ€™ ä»æ‰§è¡Œç»“æœå¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºï¼Œself ä»£è¡¨çš„æ˜¯ç±»çš„å®ä¾‹ï¼Œä»£è¡¨å½“å‰å¯¹è±¡çš„åœ°å€ï¼Œè€Œ self.class åˆ™æŒ‡å‘ç±»ã€‚ self ä¸æ˜¯ Python å…³é”®å­—ï¼Œæˆ‘ä»¬æŠŠä»–æ¢æˆ laowang ä¹Ÿæ˜¯å¯ä»¥æ­£å¸¸æ‰§è¡Œçš„ï¼š class Test: def prt(laowang): print(laowang) print(laowang.__class__) t = Test()t.prt() è¾“å‡ºç»“æœï¼š **main**.Test object at 0x0000025B6BD46900class â€˜**main**.Testâ€™ åœ¨ Python ä¸­ï¼Œself æ˜¯ä¸€ä¸ªæƒ¯ç”¨çš„åç§°ï¼Œç”¨äºè¡¨ç¤ºç±»çš„å®ä¾‹ï¼ˆå¯¹è±¡ï¼‰è‡ªèº«ã€‚å®ƒæ˜¯ä¸€ä¸ªæŒ‡å‘å®ä¾‹çš„å¼•ç”¨ï¼Œä½¿å¾—ç±»çš„æ–¹æ³•èƒ½å¤Ÿè®¿é—®å’Œæ“ä½œå®ä¾‹çš„å±æ€§ã€‚ å½“ä½ å®šä¹‰ä¸€ä¸ªç±»ï¼Œå¹¶åœ¨ç±»ä¸­å®šä¹‰æ–¹æ³•æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°é€šå¸¸è¢«å‘½åä¸º selfï¼Œå°½ç®¡ä½ å¯ä»¥ä½¿ç”¨å…¶ä»–åç§°ï¼Œä½†å¼ºçƒˆå»ºè®®ä½¿ç”¨ selfï¼Œä»¥ä¿æŒä»£ç çš„ä¸€è‡´æ€§å’Œå¯è¯»æ€§ã€‚ class MyClass: def __init__(self, value): self.value = value def display_value(self): print(self.value)# åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹obj = MyClass(42) # è°ƒç”¨å®ä¾‹çš„æ–¹æ³•obj.display_value() # è¾“å‡º 42 åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œself æ˜¯ä¸€ä¸ªæŒ‡å‘ç±»å®ä¾‹çš„å¼•ç”¨ï¼Œå®ƒåœ¨ __init__ æ„é€ å‡½æ•°ä¸­ç”¨äºåˆå§‹åŒ–å®ä¾‹çš„å±æ€§ï¼Œä¹Ÿåœ¨ display_value æ–¹æ³•ä¸­ç”¨äºè®¿é—®å®ä¾‹çš„å±æ€§ã€‚é€šè¿‡ä½¿ç”¨ selfï¼Œä½ å¯ä»¥åœ¨ç±»çš„æ–¹æ³•ä¸­è®¿é—®å’Œæ“ä½œå®ä¾‹çš„å±æ€§ï¼Œä»è€Œå®ç°ç±»çš„è¡Œä¸ºã€‚ ç±»æ–¹æ³• ç±»æ–¹æ³•åœ¨ç±»ä¸­é€šè¿‡ @classmethod å®šä¹‰ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸º clsï¼Œä»£è¡¨ç±»æœ¬èº«ã€‚ ç±»æ–¹æ³•å¯ä»¥è¢« ç±» å’Œ å®ä¾‹å¯¹è±¡ è°ƒç”¨ã€‚ å¯ä»¥è®¿é—®ç±»å±æ€§ã€‚ åœ¨ä¸åˆ›å»ºå®ä¾‹çš„æƒ…å†µä¸‹è°ƒç”¨ï¼Œé€šè¿‡ç±»åç›´æ¥è°ƒç”¨ï¼Œéå¸¸æ–¹ä¾¿ï¼Œé€‚åˆä¸€äº›å’Œç±»æ•´ä½“ç›¸å…³çš„æ“ä½œã€‚ class Person: äººçš„ç±» home = earth # å®šä¹‰ç±»å±æ€§ @classmethod def class_method(cls): print(cls.home)Person.class_method() # é€šè¿‡ç±»è°ƒç”¨ç±»æ–¹æ³•p1 = Person() # åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡p1.class_method() # é€šè¿‡å®ä¾‹å¯¹è±¡è°ƒç”¨ç±»æ–¹æ³• é™æ€æ–¹æ³• é™æ€æ–¹æ³•åœ¨ç±»ä¸­é€šè¿‡ @staticmethod å®šä¹‰ ä¸è®¿é—®å®ä¾‹å±æ€§æˆ–ç±»å±æ€§ï¼Œåªä¾èµ–äºä¼ å…¥çš„å‚æ•° å¯ä»¥é€šè¿‡ç±»åæˆ–å®ä¾‹è°ƒç”¨ï¼Œä½†å®ƒä¸ä¼šè®¿é—®ç±»æˆ–å®ä¾‹çš„å†…éƒ¨ä¿¡æ¯ï¼Œæ›´åƒæ˜¯ä¸€ä¸ªå·¥å…·å‡½æ•°ï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿ç»„ç»‡ä»£ç ï¼ŒæŠŠå®ƒæ”¾åœ¨äº†ç±»é‡Œé¢ã€‚ class Person: äººçš„ç±» home = earth # å®šä¹‰ç±»å±æ€§ @staticmethod def static_method(): print(static method)Person.static_method() # é€šè¿‡ç±»è°ƒç”¨é™æ€æ–¹æ³•p1 = Person() # åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡p1.static_method() # é€šè¿‡å®ä¾‹å¯¹è±¡è°ƒç”¨é™æ€æ–¹æ³• ç±»å¤–æ–¹æ³•å¹¶éå¿…é¡»åœ¨ç±»å®šä¹‰ä¸­è¿›è¡Œæ–¹æ³•å®šä¹‰ï¼Œä¹Ÿå¯ä»¥å°†ä¸€ä¸ªå‡½æ•°å¯¹è±¡èµ‹å€¼ç»™ä¸€ä¸ªç±»å†…å±€éƒ¨å˜é‡ã€‚ # åœ¨ç±»å¤–å®šä¹‰çš„å‡½æ•°def f1(self, x, y): print(x y)class C: f = f1C().f(6, 13) # 4 å°è£…ç§æœ‰åŒ–æœ‰æ—¶ä¸ºäº†é™åˆ¶å±æ€§å’Œæ–¹æ³•åªèƒ½åœ¨ç±»å†…è®¿é—®ï¼Œå¤–éƒ¨æ— æ³•è®¿é—®ï¼›æˆ–çˆ¶ç±»ä¸­æŸäº›å±æ€§å’Œæ–¹æ³•ä¸å¸Œæœ›è¢«å­ç±»ç»§æ‰¿ã€‚å¯ä»¥å°†å…¶ç§æœ‰åŒ–ã€‚ éå…¬å¼€ API: å¤§å¤šæ•° Python ä»£ç éƒ½éµå¾ªè¿™æ ·ä¸€ä¸ªçº¦å®šï¼šæœ‰ä¸€ä¸ªå‰ç¼€ä¸‹åˆ’çº¿çš„å˜é‡æˆ–æ–¹æ³•åº”è¢«è§†ä¸ºéå…¬å¼€çš„APIï¼Œä¾‹å¦‚ _var1ã€‚è¿™ç§çº¦å®šä¸å…·æœ‰å¼ºåˆ¶åŠ›ã€‚ åŒä¸‹åˆ’çº¿:åç§°æ”¹å†™ æœ‰ä¸¤ä¸ªå‰ç¼€ä¸‹åˆ’çº¿ï¼Œå¹¶è‡³å¤šä¸€ä¸ªåç¼€ä¸‹åˆ’çº¿çš„æ ‡è¯†ç¬¦ï¼Œä¾‹å¦‚ __xï¼Œä¼šè¢«æ”¹å†™ä¸º _ç±»å__xã€‚åªæœ‰åœ¨ç±»å†…éƒ¨å¯ä»¥é€šè¿‡ __x è®¿é—®ï¼Œå…¶ä»–åœ°æ–¹æ— æ³•è®¿é—®æˆ–åªèƒ½é€šè¿‡_ç±»å__x è®¿é—®ã€‚ ç§æœ‰å±æ€§é€šè¿‡åŒä¸‹åˆ’çº¿å®šä¹‰ç§æœ‰å±æ€§ã€‚ class Person: def __init__(self, name): self.__name = name def get_name(self): return self.__namep = Person(å¼ ä¸‰)print(p.get_name()) # å¼ ä¸‰print(p._Person__name) # å¼ ä¸‰print(p.__name) # æŠ¥é”™ ç§æœ‰æ–¹æ³•é€šè¿‡åŒä¸‹åˆ’çº¿å®šä¹‰ç§æœ‰æ–¹æ³•ã€‚ class Person: # å®šä¹‰ç§æœ‰æ–¹æ³• def __private_method(self): print(private method) # å®šä¹‰å®ä¾‹æ–¹æ³•ï¼Œè°ƒç”¨ç§æœ‰æ–¹æ³• def do_something(self): self.__private_method()p = Person()p.do_something() # private methodp._Person__private_method() # private methodp.__private_method() # æŠ¥é”™ ç»§æ‰¿Python åŒæ ·æ”¯æŒç±»çš„ç»§æ‰¿ï¼Œå¦‚æœä¸€ç§è¯­è¨€ä¸æ”¯æŒç»§æ‰¿ï¼Œç±»å°±æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚æ´¾ç”Ÿç±»çš„å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š class DerivedClassName(BaseClassName): statement-1 . . . statement-N å­ç±»ï¼ˆæ´¾ç”Ÿç±» DerivedClassNameï¼‰ä¼šç»§æ‰¿çˆ¶ç±»ï¼ˆåŸºç±» BaseClassNameï¼‰çš„ å±æ€§å’Œæ–¹æ³•ã€‚ BaseClassNameï¼ˆå®ä¾‹ä¸­çš„åŸºç±»åï¼‰å¿…é¡»ä¸æ´¾ç”Ÿç±»å®šä¹‰åœ¨ä¸€ä¸ªä½œç”¨åŸŸå†…ã€‚é™¤äº†ç±»ï¼Œè¿˜å¯ä»¥ç”¨è¡¨è¾¾å¼ï¼ŒåŸºç±»å®šä¹‰åœ¨å¦ä¸€ä¸ªæ¨¡å—ä¸­æ—¶è¿™ä¸€ç‚¹éå¸¸æœ‰ç”¨ï¼š class DerivedClassName(modname.BaseClassName): #!/usr/bin/python3 #ç±»å®šä¹‰class people: #å®šä¹‰åŸºæœ¬å±æ€§ name = age = 0 #å®šä¹‰ç§æœ‰å±æ€§,ç§æœ‰å±æ€§åœ¨ç±»å¤–éƒ¨æ— æ³•ç›´æ¥è¿›è¡Œè®¿é—® __weight = 0 #å®šä¹‰æ„é€ æ–¹æ³• def __init__(self,n,a,w): self.name = n self.age = a self.__weight = w def speak(self): print(%s è¯´: æˆ‘ %d å²ã€‚ %(self.name,self.age)) #å•ç»§æ‰¿ç¤ºä¾‹class student(people): grade = def __init__(self,n,a,w,g): #è°ƒç”¨çˆ¶ç±»çš„æ„å‡½ people.__init__(self,n,a,w) self.grade = g #è¦†å†™çˆ¶ç±»çš„æ–¹æ³• def speak(self): print(%s è¯´: æˆ‘ %d å²äº†ï¼Œæˆ‘åœ¨è¯» %d å¹´çº§%(self.name,self.age,self.grade)) s = student(ken,10,60,3)s.speak() è¾“å‡ºç»“æœï¼š ken è¯´: æˆ‘ 10 å²äº†ï¼Œæˆ‘åœ¨è¯» 3 å¹´çº§ å¤šç»§æ‰¿Python åŒæ ·æœ‰é™çš„æ”¯æŒå¤šç»§æ‰¿å½¢å¼ã€‚å¤šç»§æ‰¿çš„ç±»å®šä¹‰å½¢å¦‚ä¸‹ï¼š class DerivedClassName(Base1, Base2, Base3): statement-1 . . . statement-N éœ€è¦æ³¨æ„åœ†æ‹¬å·ä¸­çˆ¶ç±»çš„é¡ºåºï¼Œè‹¥æ˜¯çˆ¶ç±»ä¸­æœ‰ç›¸åŒçš„æ–¹æ³•åï¼Œè€Œåœ¨å­ç±»ä½¿ç”¨æ—¶æœªæŒ‡å®šï¼ŒPython ä»å·¦è‡³å³æœç´¢ å³æ–¹æ³•åœ¨å­ç±»ä¸­æœªæ‰¾åˆ°æ—¶ï¼Œä»å·¦åˆ°å³æŸ¥æ‰¾çˆ¶ç±»ä¸­æ˜¯å¦åŒ…å«æ–¹æ³•ã€‚ #!/usr/bin/python3 #ç±»å®šä¹‰class people: #å®šä¹‰åŸºæœ¬å±æ€§ name = age = 0 #å®šä¹‰ç§æœ‰å±æ€§,ç§æœ‰å±æ€§åœ¨ç±»å¤–éƒ¨æ— æ³•ç›´æ¥è¿›è¡Œè®¿é—® __weight = 0 #å®šä¹‰æ„é€ æ–¹æ³• def __init__(self,n,a,w): self.name = n self.age = a self.__weight = w def speak(self): print(%s è¯´: æˆ‘ %d å²ã€‚ %(self.name,self.age)) #å•ç»§æ‰¿ç¤ºä¾‹class student(people): grade = def __init__(self,n,a,w,g): #è°ƒç”¨çˆ¶ç±»çš„æ„å‡½ people.__init__(self,n,a,w) self.grade = g #è¦†å†™çˆ¶ç±»çš„æ–¹æ³• def speak(self): print(%s è¯´: æˆ‘ %d å²äº†ï¼Œæˆ‘åœ¨è¯» %d å¹´çº§%(self.name,self.age,self.grade)) #å¦ä¸€ä¸ªç±»ï¼Œå¤šç»§æ‰¿ä¹‹å‰çš„å‡†å¤‡class speaker(): topic = name = def __init__(self,n,t): self.name = n self.topic = t def speak(self): print(æˆ‘å« %sï¼Œæˆ‘æ˜¯ä¸€ä¸ªæ¼”è¯´å®¶ï¼Œæˆ‘æ¼”è®²çš„ä¸»é¢˜æ˜¯ %s%(self.name,self.topic)) #å¤šç»§æ‰¿class sample(speaker,student): a = def __init__(self,n,a,w,g,t): student.__init__(self,n,a,w,g) speaker.__init__(self,n,t) test = sample(Tim,25,80,4,Python)test.speak() #æ–¹æ³•ååŒï¼Œé»˜è®¤è°ƒç”¨çš„æ˜¯åœ¨æ‹¬å·ä¸­å‚æ•°ä½ç½®æ’å‰çˆ¶ç±»çš„æ–¹æ³• è¾“å‡ºç»“æœï¼š æˆ‘å« Timï¼Œæˆ‘æ˜¯ä¸€ä¸ªæ¼”è¯´å®¶ï¼Œæˆ‘æ¼”è®²çš„ä¸»é¢˜æ˜¯ Python # ä¿®æ”¹samepleä¸­ç»§æ‰¿é¡ºåºclass sample(student, speaker): a = def __init__(self,n, a, w, g, t): student.__init__(self,n,a,w,g) speaker.__init__(self,n,t)test = sample(Tim,25,80,4,Python)test.speak() #æ–¹æ³•ååŒï¼Œé»˜è®¤è°ƒç”¨çš„æ˜¯åœ¨æ‹¬å·ä¸­å‚æ•°ä½ç½®æ’å‰çˆ¶ç±»çš„æ–¹æ³• è¾“å‡ºç»“æœï¼š ken è¯´: æˆ‘ 10 å²äº†ï¼Œæˆ‘åœ¨è¯» 3 å¹´çº§ æ–¹æ³•é‡å†™å¦‚æœä½ çš„çˆ¶ç±»æ–¹æ³•çš„åŠŸèƒ½ä¸èƒ½æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œä½ å¯ä»¥åœ¨å­ç±»é‡å†™ä½ çˆ¶ç±»çš„æ–¹æ³•ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š #!/usr/bin/python3 class Parent: # å®šä¹‰çˆ¶ç±» def myMethod(self): print (è°ƒç”¨çˆ¶ç±»æ–¹æ³•) class Child(Parent): # å®šä¹‰å­ç±» def myMethod(self): print (è°ƒç”¨å­ç±»æ–¹æ³•) c = Child() # å­ç±»å®ä¾‹c.myMethod() # å­ç±»è°ƒç”¨é‡å†™æ–¹æ³•super(Child,c).myMethod() #ç”¨å­ç±»å¯¹è±¡è°ƒç”¨çˆ¶ç±»å·²è¢«è¦†ç›–çš„æ–¹æ³• super() å‡½æ•° æ˜¯ç”¨äºè°ƒç”¨çˆ¶ç±»(è¶…ç±»)çš„ä¸€ä¸ªæ–¹æ³•ã€‚ è¾“å‡ºç»“æœï¼š è°ƒç”¨å­ç±»æ–¹æ³•è°ƒç”¨çˆ¶ç±»æ–¹æ³• å­ç±»é‡å†™çˆ¶ç±» __init__()æ–¹æ³•åœºæ™¯ å­ç±»éœ€è¦è‡ªåŠ¨è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼š å­ç±»ä¸é‡å†™ __init__() æ–¹æ³•ï¼Œå®ä¾‹åŒ–å­ç±»åï¼Œä¼šè‡ªåŠ¨è°ƒç”¨çˆ¶ç±»çš„ __init__() çš„æ–¹æ³•ã€‚ å­ç±»ä¸éœ€è¦è‡ªåŠ¨è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼š å­ç±»é‡å†™ __init__() æ–¹æ³•ï¼Œå®ä¾‹åŒ–å­ç±»åï¼Œå°†ä¸ä¼šè‡ªåŠ¨è°ƒç”¨çˆ¶ç±»çš„ __init__() çš„æ–¹æ³•ã€‚ å­ç±»é‡å†™ __init__() æ–¹æ³•åˆéœ€è¦è°ƒç”¨çˆ¶ç±»çš„ __init__() æ–¹æ³•ï¼š ä½¿ç”¨ super å…³é”®è¯ï¼š super(å­ç±»ï¼Œself).__init__(å‚æ•°1ï¼Œå‚æ•°2ï¼Œ....)class Son(Father): def __init__(self, name): super(Son, self).__init__(name) ç±»çš„å±æ€§ä¸æ–¹æ³• ç±»çš„ç§æœ‰å±æ€§ __private_attrsï¼šä¸¤ä¸ªä¸‹åˆ’çº¿å¼€å¤´ï¼Œå£°æ˜è¯¥å±æ€§ä¸ºç§æœ‰ï¼Œä¸èƒ½åœ¨ç±»çš„å¤–éƒ¨è¢«ä½¿ç”¨æˆ–ç›´æ¥è®¿é—®ã€‚åœ¨ç±»å†…éƒ¨çš„æ–¹æ³•ä¸­ä½¿ç”¨æ—¶ self.__private_attrsã€‚ ç±»çš„æ–¹æ³• åœ¨ç±»çš„å†…éƒ¨ï¼Œä½¿ç”¨ def å…³é”®å­—æ¥å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œä¸ä¸€èˆ¬å‡½æ•°å®šä¹‰ä¸åŒï¼Œç±»æ–¹æ³•å¿…é¡»åŒ…å«å‚æ•° selfï¼Œä¸”ä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œself ä»£è¡¨çš„æ˜¯ç±»çš„å®ä¾‹ã€‚ self çš„åå­—å¹¶ä¸æ˜¯è§„å®šæ­»çš„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ thisï¼Œä½†æ˜¯æœ€å¥½è¿˜æ˜¯æŒ‰ç…§çº¦å®šä½¿ç”¨ selfã€‚ ç±»çš„ç§æœ‰æ–¹æ³• __private_methodï¼šä¸¤ä¸ªä¸‹åˆ’çº¿å¼€å¤´ï¼Œå£°æ˜è¯¥æ–¹æ³•ä¸ºç§æœ‰æ–¹æ³•ï¼Œåªèƒ½åœ¨ç±»çš„å†…éƒ¨è°ƒç”¨ ï¼Œä¸èƒ½åœ¨ç±»çš„å¤–éƒ¨è°ƒç”¨ã€‚self.__private_methodsã€‚ ç±»çš„ç§æœ‰å±æ€§ç¤ºä¾‹: #!/usr/bin/python3 class JustCounter: __secretCount = 0 # ç§æœ‰å˜é‡ publicCount = 0 # å…¬å¼€å˜é‡ def count(self): self.__secretCount += 1 self.publicCount += 1 print (self.__secretCount) counter = JustCounter()counter.count()counter.count()print (counter.publicCount)print (counter.__secretCount) # æŠ¥é”™ï¼Œå®ä¾‹ä¸èƒ½è®¿é—®ç§æœ‰å˜é‡ è¾“å‡ºç»“æœï¼š 122Traceback (most recent call last):File â€œtest.pyâ€, line 16, in moduleprint (counter.__secretCount) # æŠ¥é”™ï¼Œå®ä¾‹ä¸èƒ½è®¿é—®ç§æœ‰å˜é‡AttributeError: â€˜JustCounterâ€™ object has no attribute â€˜__secretCountâ€™ ç±»çš„ç§æœ‰æ–¹æ³•ç¤ºä¾‹ï¼š #!/usr/bin/python3 class Site: def __init__(self, name, url): self.name = name # public self.__url = url # private def who(self): print(name : , self.name) print(url : , self.__url) def __foo(self): # ç§æœ‰æ–¹æ³• print(è¿™æ˜¯ç§æœ‰æ–¹æ³•) def foo(self): # å…¬å…±æ–¹æ³• print(è¿™æ˜¯å…¬å…±æ–¹æ³•) self.__foo() x = Site(èœé¸Ÿæ•™ç¨‹, www.runoob.com)x.who() # æ­£å¸¸è¾“å‡ºx.foo() # æ­£å¸¸è¾“å‡ºx.__foo() # æŠ¥é”™ è¾“å‡ºç»“æœï¼š D:worktoolsPythonPython.exe d:worksty_projectsty_Python01.basichello.pyname : èœé¸Ÿæ•™ç¨‹url : www.runoob.comè¿™æ˜¯å…¬å…±æ–¹æ³•è¿™æ˜¯ç§æœ‰æ–¹æ³•Traceback (most recent call last):File â€œd:\\work\\sty_project\\sty_Python\\01.basic\\hello.pyâ€, line 22, in modulex.__foo() # æŠ¥é”™^^^^^^^AttributeError: â€˜Siteâ€™ object has no attribute â€˜__fooâ€™ ç±»çš„ä¸“æœ‰æ–¹æ³•: __init__ : æ„é€ å‡½æ•°ï¼Œåœ¨ç”Ÿæˆå¯¹è±¡æ—¶è°ƒç”¨__del__ : ææ„å‡½æ•°ï¼Œé‡Šæ”¾å¯¹è±¡æ—¶ä½¿ç”¨__repr__ : æ‰“å°ï¼Œè½¬æ¢__setitem__ : æŒ‰ç…§ç´¢å¼•èµ‹å€¼__getitem__: æŒ‰ç…§ç´¢å¼•è·å–å€¼__len__: è·å¾—é•¿åº¦__cmp__: æ¯”è¾ƒè¿ç®—__call__: å‡½æ•°è°ƒç”¨__add__: åŠ è¿ç®—__sub__: å‡è¿ç®—__mul__: ä¹˜è¿ç®—__truediv__: é™¤è¿ç®—__mod__: æ±‚ä½™è¿ç®—__pow__: ä¹˜æ–¹","tags":[null],"categories":[null]},{"title":"RocketMQå¿«é€Ÿå®‰è£…","path":"/wiki/RocketMQ/RocketMQ1.html","content":"1. ç›´æ¥å®‰è£…RocketMQ1.1 å®‰è£…JDKvi /etc/profileJAVA_HOME=/home/jdk/jvm/jre-1.6.0-openjdk.x86_64PATH=$PATH:$JAVA_HOME/binCLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jarexport JAVA_HOME CLASSPATH PATH 1.1 ä¸‹è½½äºŒè¿›åˆ¶åŒ…å®˜ç½‘ä¸‹è½½åœ°å€ï¼šhttps://rocketmq.apache.org/download/ https://dist.apache.org/repos/dist/release/rocketmq/4.9.8/rocketmq-all-4.9.8-bin-release.zip 1.2 é…ç½®ç¯å¢ƒå˜é‡vim /etc/profile# æœ«å°¾æ·»åŠ  export NAMESRV_ADDR=é˜¿é‡Œäº‘å…¬ç½‘IP:9876export NAMESRV_ADDR=117.72.71.187:9876 1.3 ä¿®æ”¹NameServerçš„è¿è¡Œè„šæœ¬è¿›å…¥binç›®å½•ä¸‹ï¼Œä¿®æ”¹runserver.shæ–‡ä»¶,å°†71è¡Œå’Œ76è¡Œçš„Xmså’ŒXmxç­‰æ”¹å°ä¸€ç‚¹ vim runserver.shJAVA_OPT=$JAVA_OPT -server -Xms256m -Xmx256m -Xmn128m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320mJAVA_OPT=$JAVA_OPT -server -Xms256m -Xmx256m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m 1.4 ä¿®æ”¹Brokerè¿è¡Œè„šæœ¬è¿›å…¥binç›®å½•ä¸‹ï¼Œä¿®æ”¹runbroker.shæ–‡ä»¶,ä¿®æ”¹85è¡Œ JAVA_OPT=$JAVA_OPT -server -Xms256m -Xmx256m 1.5 ä¿®æ”¹Brokeré…ç½®brokerClusterName = DefaultClusterbrokerName = broker-abrokerId = 0deleteWhen = 04fileReservedTime = 48brokerRole = ASYNC_MASTERflushDiskType = ASYNC_FLUSHnamesrvAddr=117.72.71.187:9876autoCreateTopicEnable=true#brokerIP1=é˜¿é‡Œäº‘å…¬ç½‘IPbrokerIP1=117.72.71.187 1.6 å¯åŠ¨NameServer### åœ¨å®‰è£…ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªlogsæ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾æ—¥å¿—cd /home/soft/rocketmq4.9.8mkdir logs### å¯åŠ¨namesrvnohup sh /home/soft/rocketmq4.9.8/bin/mqnamesrv /home/soft/rocketmq4.9.8/logs/namesrv.log ### éªŒè¯namesrvæ˜¯å¦å¯åŠ¨æˆåŠŸtail -f /home/soft/rocketmq4.9.8/logs/namesrv.logThe Name Server boot success... æˆ‘ä»¬å¯ä»¥åœ¨namesrv.log ä¸­çœ‹åˆ° â€˜The Name Server boot success..â€™ï¼Œ è¡¨ç¤ºNameServer å·²æˆåŠŸå¯åŠ¨ã€‚ 1.7 å¯åŠ¨BrokerNameServeræˆåŠŸå¯åŠ¨åï¼Œæˆ‘ä»¬å¯åŠ¨Broker ### å…ˆå¯åŠ¨brokernohup sh /home/soft/rocketmq4.9.8/bin/mqbroker -c /home/soft/rocketmq4.9.8/conf/broker.conf /home/soft/rocketmq4.9.8/logs/broker.log ### éªŒè¯brokeræ˜¯å¦å¯åŠ¨æˆåŠŸ, æ¯”å¦‚, brokerçš„ipæ˜¯192.168.1.2 ç„¶ååå­—æ˜¯broker-atail f /home/soft/rocketmq4.9.8/logs/broker.log The broker[broker-a,192.169.1.2:10911] boot success... 2. Dockerå®‰è£…RocketMQ2.1 æ‹‰å–é•œåƒdocker pull apache/rocketmq:4.9.7 2.2 å¯åŠ¨NameServerdocker run -d --restart=always --name namesrv -p 9876:9876 \\-v /home/rocketmq/data/namesrv/logs:/home/rocketmq/logs \\-v /home/rocketmq/data/namesrv/store:/home/rocketmq/store \\-e MAX_POSSIBLE_HEAP=100000000 apache/rocketmq:4.9.7 sh mqnamesrv 2.3 é…ç½®broker.conf# æ‰€å±é›†ç¾¤åç§°ï¼Œå¦‚æœèŠ‚ç‚¹è¾ƒå¤šå¯ä»¥é…ç½®å¤šä¸ªbrokerClusterName = DefaultCluster#brokeråç§°ï¼Œmasterå’Œslaveä½¿ç”¨ç›¸åŒçš„åç§°ï¼Œè¡¨æ˜ä»–ä»¬çš„ä¸»ä»å…³ç³»brokerName = broker-a#0è¡¨ç¤ºMasterï¼Œå¤§äº0è¡¨ç¤ºä¸åŒçš„slavebrokerId = 0#è¡¨ç¤ºå‡ ç‚¹åšæ¶ˆæ¯åˆ é™¤åŠ¨ä½œï¼Œé»˜è®¤æ˜¯å‡Œæ™¨4ç‚¹deleteWhen = 04#åœ¨ç£ç›˜ä¸Šä¿ç•™æ¶ˆæ¯çš„æ—¶é•¿ï¼Œå•ä½æ˜¯å°æ—¶fileReservedTime = 48#æœ‰ä¸‰ä¸ªå€¼ï¼šSYNC_MASTERï¼ŒASYNC_MASTERï¼ŒSLAVEï¼›åŒæ­¥å’Œå¼‚æ­¥è¡¨ç¤ºMasterå’ŒSlaveä¹‹é—´åŒæ­¥æ•°æ®çš„æœºåˆ¶ï¼›brokerRole = ASYNC_MASTER#åˆ·ç›˜ç­–ç•¥ï¼Œå–å€¼ä¸ºï¼šASYNC_FLUSHï¼ŒSYNC_FLUSHè¡¨ç¤ºåŒæ­¥åˆ·ç›˜å’Œå¼‚æ­¥åˆ·ç›˜ï¼›SYNC_FLUSHæ¶ˆæ¯å†™å…¥ç£ç›˜åæ‰è¿”å›æˆåŠŸçŠ¶æ€ï¼ŒASYNC_FLUSHä¸éœ€è¦ï¼›flushDiskType = ASYNC_FLUSH#è®¾ç½®brokerèŠ‚ç‚¹æ‰€åœ¨æœåŠ¡å™¨çš„ipåœ°å€ï¼ˆ**è¿™ä¸ªéå¸¸é‡è¦,ä¸»ä»æ¨¡å¼ä¸‹ï¼Œä»èŠ‚ç‚¹ä¼šæ ¹æ®ä¸»èŠ‚ç‚¹çš„brokerIP2æ¥åŒæ­¥æ•°æ®ï¼Œå¦‚æœä¸é…ç½®ï¼Œä¸»ä»æ— æ³•åŒæ­¥ï¼ŒbrokerIP1è®¾ç½®ä¸ºè‡ªå·±å¤–ç½‘èƒ½è®¿é—®çš„ipï¼ŒæœåŠ¡å™¨åŒç½‘å¡æƒ…å†µä¸‹å¿…é¡»é…ç½®ï¼Œæ¯”å¦‚é˜¿é‡Œäº‘è¿™ç§ï¼Œä¸»èŠ‚ç‚¹éœ€è¦é…ç½®ip1å’Œip2ï¼Œä»èŠ‚ç‚¹åªéœ€è¦é…ç½®ip1å³å¯ï¼‰brokerIP1 = 117.72.71.187#nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰²namesrvAddr=117.72.71.187:9876#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£,#listenPort = 10911#æ˜¯å¦å…è®¸Brokerè‡ªåŠ¨åˆ›å»ºTopic ä¸Šçº¿ä¸ºfalse æµ‹è¯•å¯å¼€å¯autoCreateTopicEnable = true#æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ ä¸Šçº¿ä¸ºfalse æµ‹è¯•å¯å¼€å¯autoCreateSubscriptionGroup = true#å¼€å¯é‰´æƒaclEnable=false 2.4 å¯åŠ¨Brokerdocker run -d --restart=always --name rocketmq-broker-a -p 10909:10909 -p 10911:10911 \\-v /home/rocketmq/broker/broker-a/logs:/home/rocketmq/logs \\-v /home/rocketmq/broker/broker-a/store:/home/rocketmq/store \\-v /home/rocketmq/broker/broker-a/conf:/home/rocketmq/rocketmq-4.9.7/conf \\-e MAX_POSSIBLE_HEAP=200000000 apache/rocketmq:4.9.7 sh mqbroker -c /home/rocketmq/conf/broker.conf 3. å®‰è£…RocketMQ DashboardRocketMQ Dashboard æ˜¯ RocketMQ çš„ç®¡æ§åˆ©å™¨ï¼Œä¸ºç”¨æˆ·æä¾›å®¢æˆ·ç«¯å’Œåº”ç”¨ç¨‹åºçš„å„ç§äº‹ä»¶ã€æ€§èƒ½çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œæ”¯æŒä»¥å¯è§†åŒ–å·¥å…·ä»£æ›¿ Topic é…ç½®ã€Broker ç®¡ç†ç­‰å‘½ä»¤è¡Œæ“ä½œã€‚ æ‹‰å–é•œåƒ docker pull apacherocketmq/rocketmq-dashboard:latest å¯åŠ¨ docker run -d --name rocketmq-dashboard \\-e JAVA_OPTS=-Drocketmq.namesrv.addr=127.0.0.1:9876 \\-p 8080:8080 \\-t apacherocketmq/rocketmq-dashboard:latestdocker run -d --name rocketmq-dashboard \\-e JAVA_OPTS=-Drocketmq.namesrv.addr=117.72.71.187:9876 \\-p 8080:8080 \\-t apacherocketmq/rocketmq-dashboard:latest å¯åŠ¨æ—¶IPä¿®æ”¹ä¸ºè‡ªå·±ä¸»æœºçš„IP namesrv.addr:port æ›¿æ¢ä¸º rocketmq ä¸­é…ç½®çš„ nameserver åœ°å€ï¼šç«¯å£å· é»˜è®¤ç«¯å£é…ç½®ä¸‹ï¼Œéœ€å¼€æ”¾ç«¯å£å·ï¼šæ§åˆ¶å°ï¼š8080ï¼›namesrvï¼š9876ï¼›brokerï¼š10909ã€10911ã€‚ äº‘æœåŠ¡å™¨ï¼šè®¾ç½®å®‰å…¨ç»„è®¿é—®è§„åˆ™ æœ¬åœ°è™šæ‹Ÿæœºï¼šå…³é—­é˜²ç«å¢™ï¼Œæˆ– -add-port","tags":[null],"categories":[null]},{"title":"RocketMQåŸºç¡€æ¦‚å¿µ","path":"/wiki/RocketMQ/RocketMQ2.html","content":"1. RocketMQåŸºç¡€æ¶ˆæ¯æ¨¡å‹ ä¸Šå›¾å°±æ˜¯ä¸€ä¸ªåŸºæœ¬çš„æ¶ˆæ¯ç³»ç»Ÿæ¨¡å‹ï¼ŒåŒ…æ‹¬ç”Ÿäº§è€… (Producer)ï¼Œæ¶ˆè´¹è€… (Consumer)ï¼Œä¸­é—´è¿›è¡ŒåŸºäºæ¶ˆæ¯ä¸»é¢˜ï¼ˆTopicï¼‰çš„æ¶ˆæ¯ä¼ é€ã€‚ 2. RocketMQæ‰©å±•æ¨¡å‹åœ¨åŸºäºä¸»é¢˜çš„ç³»ç»Ÿä¸­ï¼Œæ¶ˆæ¯è¢«å‘å¸ƒåˆ°ä¸»é¢˜æˆ–å‘½åé€šé“ä¸Šã€‚æ¶ˆè´¹è€…å°†æ”¶åˆ°å…¶è®¢é˜…ä¸»é¢˜ä¸Šçš„æ‰€æœ‰æ¶ˆæ¯ï¼Œç”Ÿäº§è€…è´Ÿè´£å®šä¹‰è®¢é˜…è€…æ‰€è®¢é˜…çš„æ¶ˆæ¯ç±»åˆ«ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºç¡€çš„æ¦‚å¿µæ¨¡å‹ï¼Œè€Œåœ¨å®é™…çš„åº”ç”¨ä¸­ï¼Œç»“æ„ä¼šæ›´å¤æ‚ã€‚ä¾‹å¦‚ä¸ºäº†æ”¯æŒé«˜å¹¶å‘å’Œæ°´å¹³æ‰©å±•ï¼Œä¸­é—´çš„æ¶ˆæ¯ä¸»é¢˜éœ€è¦è¿›è¡Œåˆ†åŒºï¼ŒåŒä¸€ä¸ªTopicä¼šæœ‰å¤šä¸ªç”Ÿäº§è€…ï¼ŒåŒä¸€ä¸ªä¿¡æ¯ä¼šæœ‰å¤šä¸ªæ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…ä¹‹é—´è¦è¿›è¡Œè´Ÿè½½å‡è¡¡ç­‰ã€‚ ä¸Šå›¾å°±æ˜¯ä¸€ä¸ªæ‰©å±•åçš„æ¶ˆæ¯æ¨¡å‹ï¼ŒåŒ…æ‹¬ä¸¤ä¸ªç”Ÿäº§è€…ï¼Œä¸¤ä¸ªæ¶ˆæ¯Topicï¼Œä»¥åŠä¸¤ç»„æ¶ˆè´¹è€… Comsumerã€‚ å­˜å‚¨æ¶ˆæ¯Topicçš„ ä»£ç†æœåŠ¡å™¨( Broker )ï¼Œæ˜¯å®é™…éƒ¨ç½²è¿‡ç¨‹å¯¹åº”çš„ä»£ç†æœåŠ¡å™¨ã€‚ ä¸ºäº†æ¶ˆæ¯å†™å…¥èƒ½åŠ›çš„æ°´å¹³æ‰©å±•ï¼ŒRocketMQ å¯¹ Topicè¿›è¡Œäº†åˆ†åŒºï¼Œè¿™ç§æ“ä½œè¢«ç§°ä¸ºé˜Ÿåˆ—ï¼ˆMessageQueueï¼‰ã€‚ ä¸ºäº†æ¶ˆè´¹èƒ½åŠ›çš„æ°´å¹³æ‰©å±•ï¼ŒConsumerGroupçš„æ¦‚å¿µåº”è¿è€Œç”Ÿã€‚ ç›¸åŒçš„ConsumerGroupä¸‹çš„æ¶ˆè´¹è€…ä¸»è¦æœ‰ä¸¤ç§è´Ÿè½½å‡è¡¡æ¨¡å¼ï¼Œå³å¹¿æ’­æ¨¡å¼ï¼Œå’Œé›†ç¾¤æ¨¡å¼ï¼ˆå›¾ä¸­æ˜¯æœ€å¸¸ç”¨çš„é›†ç¾¤æ¨¡å¼ï¼‰ã€‚ åœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼ŒåŒä¸€ä¸ª ConsumerGroup ä¸­çš„ Consumer å®ä¾‹æ˜¯è´Ÿè½½å‡è¡¡æ¶ˆè´¹ï¼Œå¦‚å›¾ä¸­ ConsumerGroupA è®¢é˜… TopicAï¼ŒTopicA å¯¹åº” 3ä¸ªé˜Ÿåˆ—ï¼Œåˆ™ GroupA ä¸­çš„ Consumer1 æ¶ˆè´¹çš„æ˜¯ MessageQueue 0å’Œ MessageQueue 1çš„æ¶ˆæ¯ï¼ŒConsumer2æ˜¯æ¶ˆè´¹çš„æ˜¯MessageQueue2çš„æ¶ˆæ¯ã€‚ åœ¨å¹¿æ’­æ¨¡å¼ä¸‹ï¼ŒåŒä¸€ä¸ª ConsumerGroup ä¸­çš„æ¯ä¸ª Consumer å®ä¾‹éƒ½å¤„ç†å…¨éƒ¨çš„é˜Ÿåˆ—ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¿æ’­æ¨¡å¼ä¸‹å› ä¸ºæ¯ä¸ª Consumer å®ä¾‹éƒ½éœ€è¦å¤„ç†å…¨éƒ¨çš„æ¶ˆæ¯ï¼Œå› æ­¤è¿™ç§æ¨¡å¼ä»…æ¨èåœ¨é€šçŸ¥æ¨é€ã€é…ç½®åŒæ­¥ç±»å°æµé‡åœºæ™¯ä½¿ç”¨ã€‚ 3. ç”Ÿäº§è€…3.1 æ¶ˆæ¯RocketMQ æ¶ˆæ¯æ„æˆéå¸¸ç®€å•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ topicï¼Œè¡¨ç¤ºè¦å‘é€çš„æ¶ˆæ¯çš„ä¸»é¢˜ã€‚ body è¡¨ç¤ºæ¶ˆæ¯çš„å­˜å‚¨å†…å®¹ properties è¡¨ç¤ºæ¶ˆæ¯å±æ€§ transactionId ä¼šåœ¨äº‹åŠ¡æ¶ˆæ¯ä¸­ä½¿ç”¨ã€‚ Message å¯ä»¥è®¾ç½®çš„å±æ€§å€¼åŒ…æ‹¬ï¼š å­—æ®µå é»˜è®¤å€¼ å¿…è¦æ€§ è¯´æ˜ Topic null å¿…å¡« æ¶ˆæ¯æ‰€å± topic çš„åç§° Body null å¿…å¡« æ¶ˆæ¯ä½“ Tags null é€‰å¡« æ¶ˆæ¯æ ‡ç­¾ï¼Œæ–¹ä¾¿æœåŠ¡å™¨è¿‡æ»¤ä½¿ç”¨ã€‚ç›®å‰åªæ”¯æŒæ¯ä¸ªæ¶ˆæ¯è®¾ç½®ä¸€ä¸ª Keys null é€‰å¡« ä»£è¡¨è¿™æ¡æ¶ˆæ¯çš„ä¸šåŠ¡å…³é”®è¯ Flag 0 é€‰å¡« å®Œå…¨ç”±åº”ç”¨æ¥è®¾ç½®ï¼ŒRocketMQ ä¸åšå¹²é¢„ DelayTimeLevel 0 é€‰å¡« æ¶ˆæ¯å»¶æ—¶çº§åˆ«ï¼Œ0 è¡¨ç¤ºä¸å»¶æ—¶ï¼Œå¤§äº 0 ä¼šå»¶æ—¶ç‰¹å®šçš„æ—¶é—´æ‰ä¼šè¢«æ¶ˆè´¹ WaitStoreMsgOK true é€‰å¡« è¡¨ç¤ºæ¶ˆæ¯æ˜¯å¦åœ¨æœåŠ¡å™¨è½ç›˜åæ‰è¿”å›åº”ç­”ã€‚ Tag: ä¸ç®¡æ˜¯ RocketMQ çš„ Tag è¿‡æ»¤è¿˜æ˜¯å»¶è¿Ÿæ¶ˆæ¯ç­‰éƒ½ä¼šåˆ©ç”¨ Properties æ¶ˆæ¯å±æ€§æœºåˆ¶ï¼Œè¿™äº›ç‰¹æ®Šä¿¡æ¯ä½¿ç”¨äº†ç³»ç»Ÿä¿ç•™çš„å±æ€§Keyï¼Œè®¾ç½®è‡ªå®šä¹‰å±æ€§æ—¶éœ€è¦é¿å…å’Œç³»ç»Ÿå±æ€§Keyå†²çªã€‚ Keys: æœåŠ¡å™¨ä¼šæ ¹æ® keys åˆ›å»ºå“ˆå¸Œç´¢å¼•ï¼Œè®¾ç½®åï¼Œå¯ä»¥åœ¨ Console ç³»ç»Ÿæ ¹æ® Topicã€Keys æ¥æŸ¥è¯¢æ¶ˆæ¯ï¼Œç”±äºæ˜¯å“ˆå¸Œç´¢å¼•ï¼Œè¯·å°½å¯èƒ½ä¿è¯ key å”¯ä¸€ï¼Œä¾‹å¦‚è®¢å•å·ï¼Œå•†å“ Id ç­‰ã€‚ 3.2 TagTopic ä¸ Tag éƒ½æ˜¯ä¸šåŠ¡ä¸Šç”¨æ¥å½’ç±»çš„æ ‡è¯†ï¼ŒåŒºåˆ«åœ¨äº Topic æ˜¯ä¸€çº§åˆ†ç±»ï¼Œè€Œ Tag å¯ä»¥ç†è§£ä¸ºæ˜¯äºŒçº§åˆ†ç±»ã€‚ä½¿ç”¨ Tag å¯ä»¥å®ç°å¯¹ Topic ä¸­çš„æ¶ˆæ¯è¿›è¡Œè¿‡æ»¤ã€‚ Topicï¼šæ¶ˆæ¯ä¸»é¢˜ï¼Œé€šè¿‡ Topic å¯¹ä¸åŒçš„ä¸šåŠ¡æ¶ˆæ¯è¿›è¡Œåˆ†ç±»ã€‚ Tagï¼šæ¶ˆæ¯æ ‡ç­¾ï¼Œç”¨æ¥è¿›ä¸€æ­¥åŒºåˆ†æŸä¸ª Topic ä¸‹çš„æ¶ˆæ¯åˆ†ç±»ï¼Œæ¶ˆæ¯ä»ç”Ÿäº§è€…å‘å‡ºå³å¸¦ä¸Šçš„å±æ€§ã€‚ ä»€ä¹ˆæ—¶å€™è¯¥ç”¨ Topicï¼Œä»€ä¹ˆæ—¶å€™è¯¥ç”¨ Tagï¼Ÿ å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œåˆ¤æ–­ï¼š æ¶ˆæ¯ç±»å‹æ˜¯å¦ä¸€è‡´ï¼šå¦‚æ™®é€šæ¶ˆæ¯ã€äº‹åŠ¡æ¶ˆæ¯ã€å®šæ—¶ï¼ˆå»¶æ—¶ï¼‰æ¶ˆæ¯ã€é¡ºåºæ¶ˆæ¯ï¼Œä¸åŒçš„æ¶ˆæ¯ç±»å‹ä½¿ç”¨ä¸åŒçš„ Topicï¼Œæ— æ³•é€šè¿‡ Tag è¿›è¡ŒåŒºåˆ†ã€‚ ä¸šåŠ¡æ˜¯å¦ç›¸å…³è”ï¼šæ²¡æœ‰ç›´æ¥å…³è”çš„æ¶ˆæ¯ï¼Œå¦‚æ·˜å®äº¤æ˜“æ¶ˆæ¯ï¼Œäº¬ä¸œç‰©æµæ¶ˆæ¯ä½¿ç”¨ä¸åŒçš„ Topic è¿›è¡ŒåŒºåˆ†ï¼›è€ŒåŒæ ·æ˜¯å¤©çŒ«äº¤æ˜“æ¶ˆæ¯ï¼Œç”µå™¨ç±»è®¢å•ã€å¥³è£…ç±»è®¢å•ã€åŒ–å¦†å“ç±»è®¢å•çš„æ¶ˆæ¯å¯ä»¥ç”¨ Tag è¿›è¡ŒåŒºåˆ†ã€‚ æ¶ˆæ¯ä¼˜å…ˆçº§æ˜¯å¦ä¸€è‡´ï¼šå¦‚åŒæ ·æ˜¯ç‰©æµæ¶ˆæ¯ï¼Œç›’é©¬å¿…é¡»å°æ—¶å†…é€è¾¾ï¼Œå¤©çŒ«è¶…å¸‚ 24 å°æ—¶å†…é€è¾¾ï¼Œæ·˜å®ç‰©æµåˆ™ç›¸å¯¹ä¼šæ…¢ä¸€äº›ï¼Œä¸åŒä¼˜å…ˆçº§çš„æ¶ˆæ¯ç”¨ä¸åŒçš„ Topic è¿›è¡ŒåŒºåˆ†ã€‚ æ¶ˆæ¯é‡çº§æ˜¯å¦ç›¸å½“ï¼šæœ‰äº›ä¸šåŠ¡æ¶ˆæ¯è™½ç„¶é‡å°ä½†æ˜¯å®æ—¶æ€§è¦æ±‚é«˜ï¼Œå¦‚æœè·ŸæŸäº›ä¸‡äº¿é‡çº§çš„æ¶ˆæ¯ä½¿ç”¨åŒä¸€ä¸ª Topicï¼Œåˆ™æœ‰å¯èƒ½ä¼šå› ä¸ºè¿‡é•¿çš„ç­‰å¾…æ—¶é—´è€Œâ€œé¥¿æ­»â€ï¼Œæ­¤æ—¶éœ€è¦å°†ä¸åŒé‡çº§çš„æ¶ˆæ¯è¿›è¡Œæ‹†åˆ†ï¼Œä½¿ç”¨ä¸åŒçš„ Topicã€‚ æ€»çš„æ¥è¯´ï¼Œé’ˆå¯¹æ¶ˆæ¯åˆ†ç±»ï¼Œæ‚¨å¯ä»¥é€‰æ‹©åˆ›å»ºå¤šä¸ª Topicï¼Œæˆ–è€…åœ¨åŒä¸€ä¸ª Topic ä¸‹åˆ›å»ºå¤šä¸ª Tagã€‚ä½†é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸åŒçš„ Topic ä¹‹é—´çš„æ¶ˆæ¯æ²¡æœ‰å¿…ç„¶çš„è”ç³»ï¼Œè€Œ Tag åˆ™ç”¨æ¥åŒºåˆ†åŒä¸€ä¸ª Topic ä¸‹ç›¸äº’å…³è”çš„æ¶ˆæ¯ï¼Œä¾‹å¦‚å…¨é›†å’Œå­é›†çš„å…³ç³»ã€æµç¨‹å…ˆåçš„å…³ç³»ã€‚ 3.3 KeysApache RocketMQ æ¯ä¸ªæ¶ˆæ¯å¯ä»¥åœ¨ä¸šåŠ¡å±‚é¢çš„è®¾ç½®å”¯ä¸€æ ‡è¯†ç  keys å­—æ®µï¼Œæ–¹ä¾¿å°†æ¥å®šä½æ¶ˆæ¯ä¸¢å¤±é—®é¢˜ã€‚ Broker ç«¯ä¼šä¸ºæ¯ä¸ªæ¶ˆæ¯åˆ›å»ºç´¢å¼•ï¼ˆå“ˆå¸Œç´¢å¼•ï¼‰ï¼Œåº”ç”¨å¯ä»¥é€šè¿‡ topicã€key æ¥æŸ¥è¯¢è¿™æ¡æ¶ˆæ¯å†…å®¹ï¼Œä»¥åŠæ¶ˆæ¯è¢«è°æ¶ˆè´¹ã€‚ç”±äºæ˜¯å“ˆå¸Œç´¢å¼•ï¼Œè¯·åŠ¡å¿…ä¿è¯ key å°½å¯èƒ½å”¯ä¸€ï¼Œè¿™æ ·å¯ä»¥é¿å…æ½œåœ¨çš„å“ˆå¸Œå†²çªã€‚ 3.4 é˜Ÿåˆ—ä¸ºäº†æ”¯æŒé«˜å¹¶å‘å’Œæ°´å¹³æ‰©å±•ï¼Œéœ€è¦å¯¹ Topic è¿›è¡Œåˆ†åŒºï¼Œåœ¨ RocketMQ ä¸­è¿™è¢«ç§°ä¸ºé˜Ÿåˆ—ï¼Œä¸€ä¸ª Topic å¯èƒ½æœ‰å¤šä¸ªé˜Ÿåˆ—ï¼Œå¹¶ä¸”å¯èƒ½åˆ†å¸ƒåœ¨ä¸åŒçš„ Broker ä¸Šã€‚ ä¸€èˆ¬æ¥è¯´ä¸€æ¡æ¶ˆæ¯ï¼Œå¦‚æœæ²¡æœ‰é‡å¤å‘é€ï¼ˆæ¯”å¦‚å› ä¸ºæœåŠ¡ç«¯æ²¡æœ‰å“åº”è€Œè¿›è¡Œé‡è¯•ï¼‰ï¼Œåˆ™åªä¼šå­˜åœ¨åœ¨ Topic çš„å…¶ä¸­ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œæ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™å­˜å‚¨ï¼Œæ¯æ¡æ¶ˆæ¯ä¼šæœ‰è‡ªå·±çš„ä½ç‚¹ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¼šç»Ÿè®¡å½“å‰æ¶ˆæ¯çš„æ€»æ¡æ•°ï¼Œè¿™ä¸ªç§°ä¸ºæœ€å¤§ä½ç‚¹ MaxOffsetï¼›é˜Ÿåˆ—çš„èµ·å§‹ä½ç½®å¯¹åº”çš„ä½ç½®å«åšèµ·å§‹ä½ç‚¹ MinOffsetã€‚é˜Ÿåˆ—å¯ä»¥æå‡æ¶ˆæ¯å‘é€å’Œæ¶ˆè´¹çš„å¹¶å‘åº¦ã€‚ 3.5 ç”Ÿäº§è€…ç”Ÿäº§è€…ï¼ˆProducerï¼‰å°±æ˜¯æ¶ˆæ¯çš„å‘é€è€…ï¼ŒApache RocketMQ æ‹¥æœ‰ä¸°å¯Œçš„æ¶ˆæ¯ç±»å‹ï¼Œå¯ä»¥æ”¯æŒä¸åŒçš„åº”ç”¨åœºæ™¯ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”Ÿäº§ç¯å¢ƒä¸­ä¸åŒæ¶ˆæ¯ç±»å‹éœ€è¦ä½¿ç”¨ä¸åŒçš„ä¸»é¢˜ï¼Œä¸è¦åœ¨åŒä¸€ä¸ªä¸»é¢˜å†…ä½¿ç”¨å¤šç§æ¶ˆæ¯ç±»å‹ï¼Œè¿™æ ·å¯ä»¥é¿å…è¿ç»´è¿‡ç¨‹ä¸­çš„é£é™©å’Œé”™è¯¯ã€‚ 4. æ¶ˆæ¯ç”Ÿäº§åŠæ¶ˆè´¹4.1 æ™®é€šæ¶ˆæ¯Apache RocketMQå¯ç”¨äºä»¥ä¸‰ç§æ–¹å¼å‘é€æ¶ˆæ¯ï¼šåŒæ­¥ã€å¼‚æ­¥å’Œå•å‘ä¼ è¾“ã€‚å‰ä¸¤ç§æ¶ˆæ¯ç±»å‹æ˜¯å¯é çš„ï¼Œå› ä¸ºæ— è®ºå®ƒä»¬æ˜¯å¦æˆåŠŸå‘é€éƒ½æœ‰å“åº”ã€‚ 4.1.1 åŒæ­¥æ¶ˆæ¯åŒæ­¥å‘é€æ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼ï¼Œæ˜¯æŒ‡æ¶ˆæ¯å‘é€æ–¹å‘å‡ºä¸€æ¡æ¶ˆæ¯åï¼Œä¼šåœ¨æ”¶åˆ°æœåŠ¡ç«¯åŒæ­¥å“åº”ä¹‹åæ‰å‘ä¸‹ä¸€æ¡æ¶ˆæ¯çš„é€šè®¯æ–¹å¼ï¼Œå¯é çš„åŒæ­¥ä¼ è¾“è¢«å¹¿æ³›åº”ç”¨äºå„ç§åœºæ™¯ï¼Œå¦‚é‡è¦çš„é€šçŸ¥æ¶ˆæ¯ã€çŸ­æ¶ˆæ¯é€šçŸ¥ç­‰ã€‚ åŒæ­¥å‘é€çš„æ•´ä¸ªä»£ç æµç¨‹å¦‚ä¸‹ï¼š é¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ªproducerã€‚æ™®é€šæ¶ˆæ¯å¯ä»¥åˆ›å»º DefaultMQProducerï¼Œåˆ›å»ºæ—¶éœ€è¦å¡«å†™ç”Ÿäº§ç»„çš„åç§°ï¼Œç”Ÿäº§è€…ç»„æ˜¯æŒ‡åŒä¸€ç±»Producerçš„é›†åˆï¼Œè¿™ç±»Producerå‘é€åŒä¸€ç±»æ¶ˆæ¯ä¸”å‘é€é€»è¾‘ä¸€è‡´ã€‚ è®¾ç½® NameServer çš„åœ°å€ã€‚Apache RocketMQå¾ˆå¤šæ–¹å¼è®¾ç½®NameServeråœ°å€(å®¢æˆ·ç«¯é…ç½®ä¸­æœ‰ä»‹ç»)ï¼Œè¿™é‡Œæ˜¯åœ¨ä»£ç ä¸­è°ƒç”¨producerçš„API setNamesrvAddrè¿›è¡Œè®¾ç½®ï¼Œå¦‚æœæœ‰å¤šä¸ªNameServerï¼Œä¸­é—´ä»¥åˆ†å·éš”å¼€ï¼Œæ¯”å¦‚â€127.0.0.2:9876;127.0.0.3:9876â€ã€‚ ç¬¬ä¸‰æ­¥æ˜¯æ„å»ºæ¶ˆæ¯ã€‚æŒ‡å®štopicã€tagã€bodyç­‰ä¿¡æ¯ï¼Œtagå¯ä»¥ç†è§£æˆæ ‡ç­¾ï¼Œå¯¹æ¶ˆæ¯è¿›è¡Œå†å½’ç±»ï¼ŒRocketMQå¯ä»¥åœ¨æ¶ˆè´¹ç«¯å¯¹tagè¿›è¡Œè¿‡æ»¤ã€‚ æœ€åè°ƒç”¨sendæ¥å£å°†æ¶ˆæ¯å‘é€å‡ºå»ã€‚åŒæ­¥å‘é€ç­‰å¾…ç»“æœæœ€åè¿”å›SendResultï¼ŒSendResultåŒ…å«å®é™…å‘é€çŠ¶æ€è¿˜åŒ…æ‹¬SEND_OKï¼ˆå‘é€æˆåŠŸï¼‰, FLUSH_DISK_TIMEOUTï¼ˆåˆ·ç›˜è¶…æ—¶ï¼‰, FLUSH_SLAVE_TIMEOUTï¼ˆåŒæ­¥åˆ°å¤‡è¶…æ—¶ï¼‰, SLAVE_NOT_AVAILABLEï¼ˆå¤‡ä¸å¯ç”¨ï¼‰ï¼Œå¦‚æœå‘é€å¤±è´¥ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ /** * * * @author lm * @since 2024-05-24 09:12:17 * @version 1.0 */public class TestRocketMQ @Test public void testProducer() throws MQClientException, MQBrokerException, RemotingException, InterruptedException // 1.åˆ›å»ºæ¶ˆæ¯ç”Ÿäº§è€…producerï¼Œå¹¶åˆ¶å®šç”Ÿäº§è€…ç»„å DefaultMQProducer producer = new DefaultMQProducer(TestProducerGroup); // 2.æŒ‡å®šNameserveråœ°å€ producer.setNamesrvAddr(117.72.71.187:9876); // 3.å¯åŠ¨producer producer.start(); // 4.åˆ›å»ºæ¶ˆæ¯å¯¹è±¡ï¼ŒæŒ‡å®šä¸»é¢˜Topicã€Tagå’Œæ¶ˆæ¯ä½“ç­‰ String topic = TestTopic; String msg = Hello RocketMQ; String tag = TesTag; Message message = new Message(topic, tag, msg.getBytes()); // 5.å‘é€æ¶ˆæ¯ SendResult send = producer.send(message); System.out.println(send); // 6.å…³é—­ç”Ÿäº§è€…producer producer.shutdown(); åŒæ­¥å‘é€æ–¹å¼è¯·åŠ¡å¿…æ•è·å‘é€å¼‚å¸¸ï¼Œå¹¶åšä¸šåŠ¡ä¾§å¤±è´¥å…œåº•é€»è¾‘ï¼Œå¦‚æœå¿½ç•¥å¼‚å¸¸åˆ™å¯èƒ½ä¼šå¯¼è‡´æ¶ˆæ¯æœªæˆåŠŸå‘é€çš„æƒ…å†µã€‚ å‘é€æˆåŠŸæ˜¾ç¤º åœ¨ä»ªè¡¨æ¿å¯ä»¥çœ‹åˆ°ç”Ÿäº§çš„æ¶ˆæ¯ æ¶ˆæ¯æ¶ˆè´¹ @Test public void testConsumer() throws MQClientException, IOException // å®ä¾‹åŒ–æ¶ˆè´¹è€… DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(TestConsumerGroup); // è®¾ç½®NameServerçš„åœ°å€ consumer.setNamesrvAddr(117.72.71.187:9876); // è®¢é˜…ä¸€ä¸ªæˆ–è€…å¤šä¸ªTopicï¼Œä»¥åŠTagæ¥è¿‡æ»¤éœ€è¦æ¶ˆè´¹çš„æ¶ˆæ¯ consumer.subscribe(TestTopic, *); // æ³¨å†Œå›è°ƒå®ç°ç±»æ¥å¤„ç†ä»brokeræ‹‰å–å›æ¥çš„æ¶ˆæ¯ consumer.registerMessageListener((MessageListenerConcurrently) (msgs, context) - System.out.printf(%s Receive New Messages: %s %n, Thread.currentThread().getName(), msgs.toString()); // æ ‡è®°è¯¥æ¶ˆæ¯å·²ç»è¢«æˆåŠŸæ¶ˆè´¹ return ConsumeConcurrentlyStatus.CONSUME_SUCCESS; ); // å¯åŠ¨æ¶ˆè´¹è€…å®ä¾‹ consumer.start(); // ç­‰å¾…æ¶ˆæ¯æ¥æ”¶ System.in.read(); System.out.printf(Consumer Started.%n); åœ¨ä»ªè¡¨æ¿ä¸­å¯ä»¥çœ‹åˆ°å¯¹åº”çš„æ¶ˆè´¹è€…ç»„åŠæ¶ˆè´¹è¯¦æƒ… 4.1.2 å¼‚æ­¥æ¶ˆæ¯å¼‚æ­¥å‘é€æ˜¯æŒ‡å‘é€æ–¹å‘å‡ºä¸€æ¡æ¶ˆæ¯åï¼Œä¸ç­‰æœåŠ¡ç«¯è¿”å›å“åº”ï¼Œæ¥ç€å‘é€ä¸‹ä¸€æ¡æ¶ˆæ¯çš„é€šè®¯æ–¹å¼ã€‚ å¼‚æ­¥å‘é€éœ€è¦å®ç°å¼‚æ­¥å‘é€å›è°ƒæ¥å£ï¼ˆSendCallbackï¼‰ã€‚ æ¶ˆæ¯å‘é€æ–¹åœ¨å‘é€äº†ä¸€æ¡æ¶ˆæ¯åï¼Œä¸éœ€è¦ç­‰å¾…æœåŠ¡ç«¯å“åº”å³å¯å‘é€ç¬¬äºŒæ¡æ¶ˆæ¯ï¼Œå‘é€æ–¹é€šè¿‡å›è°ƒæ¥å£æ¥æ”¶æœåŠ¡ç«¯å“åº”ï¼Œå¹¶å¤„ç†å“åº”ç»“æœã€‚å¼‚æ­¥å‘é€ä¸€èˆ¬ç”¨äºé“¾è·¯è€—æ—¶è¾ƒé•¿ï¼Œå¯¹å“åº”æ—¶é—´è¾ƒä¸ºæ•æ„Ÿçš„ä¸šåŠ¡åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œè§†é¢‘ä¸Šä¼ åé€šçŸ¥å¯åŠ¨è½¬ç æœåŠ¡ï¼Œè½¬ç å®Œæˆåé€šçŸ¥æ¨é€è½¬ç ç»“æœç­‰ã€‚ @Test public void testAsyncMessage() throws MQClientException, MQBrokerException, RemotingException, InterruptedException // åˆå§‹åŒ–ä¸€ä¸ªproducerå¹¶è®¾ç½®Producer group name DefaultMQProducer producer = new DefaultMQProducer(TestProducerGroup); // è®¾ç½®NameServeråœ°å€ producer.setNamesrvAddr(117.72.71.187:9876); // å¯åŠ¨producer producer.start(); producer.setRetryTimesWhenSendAsyncFailed(0); int messageCount = 10; final CountDownLatch countDownLatch = new CountDownLatch(messageCount); for (int i = 0; i messageCount; i++) try final int index = i; // åˆ›å»ºä¸€æ¡æ¶ˆæ¯ï¼Œå¹¶æŒ‡å®štopicã€tagã€bodyç­‰ä¿¡æ¯ï¼Œtagå¯ä»¥ç†è§£æˆæ ‡ç­¾ï¼Œå¯¹æ¶ˆæ¯è¿›è¡Œå†å½’ç±»ï¼ŒRocketMQå¯ä»¥åœ¨æ¶ˆè´¹ç«¯å¯¹tagè¿›è¡Œè¿‡æ»¤ Message msg = new Message(TestTopic, TagAsync, Hello world.getBytes(RemotingHelper.DEFAULT_CHARSET)); // å¼‚æ­¥å‘é€æ¶ˆæ¯, å‘é€ç»“æœé€šè¿‡callbackè¿”å›ç»™å®¢æˆ·ç«¯ producer.send(msg, new SendCallback() @Override public void onSuccess(SendResult sendResult) System.out.printf(%-10d OK %s %n, index, sendResult.getMsgId()); countDownLatch.countDown(); @Override public void onException(Throwable e) System.out.printf(%-10d Exception %s %n, index, e); e.printStackTrace(); countDownLatch.countDown(); ); catch (Exception e) e.printStackTrace(); countDownLatch.countDown(); //å¼‚æ­¥å‘é€ï¼Œå¦‚æœè¦æ±‚å¯é ä¼ è¾“ï¼Œå¿…é¡»è¦ç­‰å›è°ƒæ¥å£è¿”å›æ˜ç¡®ç»“æœåæ‰èƒ½ç»“æŸé€»è¾‘ï¼Œå¦åˆ™ç«‹å³å…³é—­Producerå¯èƒ½å¯¼è‡´éƒ¨åˆ†æ¶ˆæ¯å°šæœªä¼ è¾“æˆåŠŸ countDownLatch.await(5, TimeUnit.SECONDS); // ä¸€æ—¦producerä¸å†ä½¿ç”¨ï¼Œå…³é—­producer producer.shutdown(); å¼‚æ­¥å‘é€ä¸åŒæ­¥å‘é€ä»£ç å”¯ä¸€åŒºåˆ«åœ¨äºè°ƒç”¨sendæ¥å£çš„å‚æ•°ä¸åŒï¼Œå¼‚æ­¥å‘é€ä¸ä¼šç­‰å¾…å‘é€è¿”å›ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯sendæ–¹æ³•éœ€è¦ä¼ å…¥ SendCallback çš„å®ç°ï¼ŒSendCallback æ¥å£ä¸»è¦æœ‰onSuccess å’Œ onException ä¸¤ä¸ªæ–¹æ³•ï¼Œè¡¨ç¤ºæ¶ˆæ¯å‘é€æˆåŠŸå’Œæ¶ˆæ¯å‘é€å¤±è´¥ã€‚ 4.1.3 å•é¡¹æ¨¡å¼ å‘é€æ–¹åªè´Ÿè´£å‘é€æ¶ˆæ¯ï¼Œä¸ç­‰å¾…æœåŠ¡ç«¯è¿”å›å“åº”ä¸”æ²¡æœ‰å›è°ƒå‡½æ•°è§¦å‘ï¼Œå³åªå‘é€è¯·æ±‚ä¸ç­‰å¾…åº”ç­”ã€‚æ­¤æ–¹å¼å‘é€æ¶ˆæ¯çš„è¿‡ç¨‹è€—æ—¶éå¸¸çŸ­ï¼Œä¸€èˆ¬åœ¨å¾®ç§’çº§åˆ«ã€‚é€‚ç”¨äºæŸäº›è€—æ—¶éå¸¸çŸ­ï¼Œä½†å¯¹å¯é æ€§è¦æ±‚å¹¶ä¸é«˜çš„åœºæ™¯ï¼Œä¾‹å¦‚æ—¥å¿—æ”¶é›†ã€‚ @Test public void testOnewaySend() throws MQClientException, UnsupportedEncodingException, RemotingException, InterruptedException // åˆå§‹åŒ–ä¸€ä¸ªproducerå¹¶è®¾ç½®Producer group name DefaultMQProducer producer = new DefaultMQProducer(TestProducerGroup); // è®¾ç½®NameServeråœ°å€ producer.setNamesrvAddr(117.72.71.187:9876); // å¯åŠ¨producer producer.start(); for (int i = 0; i 10; i++) // åˆ›å»ºä¸€æ¡æ¶ˆæ¯ï¼Œå¹¶æŒ‡å®štopicã€tagã€bodyç­‰ä¿¡æ¯ï¼Œtagå¯ä»¥ç†è§£æˆæ ‡ç­¾ï¼Œå¯¹æ¶ˆæ¯è¿›è¡Œå†å½’ç±»ï¼ŒRocketMQå¯ä»¥åœ¨æ¶ˆè´¹ç«¯å¯¹tagè¿›è¡Œè¿‡æ»¤ Message msg = new Message(TestTopic /* Topic */, TagOneway /* Tag */, (Hello RocketMQ + i).getBytes(RemotingHelper.DEFAULT_CHARSET) /* Message body */ ); // ç”±äºåœ¨onewayæ–¹å¼å‘é€æ¶ˆæ¯æ—¶æ²¡æœ‰è¯·æ±‚åº”ç­”å¤„ç†ï¼Œå¦‚æœå‡ºç°æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œåˆ™ä¼šå› ä¸ºæ²¡æœ‰é‡è¯•è€Œå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ // è‹¥æ•°æ®ä¸å¯ä¸¢ï¼Œå»ºè®®é€‰ç”¨å¯é åŒæ­¥æˆ–å¯é å¼‚æ­¥å‘é€æ–¹å¼ã€‚ producer.sendOneway(msg); // ä¸€æ—¦producerä¸å†ä½¿ç”¨ï¼Œå…³é—­producer producer.shutdown(); 4.2 é¡ºåºæ¶ˆæ¯é¡ºåºæ¶ˆæ¯æ˜¯ä¸€ç§å¯¹æ¶ˆæ¯å‘é€å’Œæ¶ˆè´¹é¡ºåºæœ‰ä¸¥æ ¼è¦æ±‚çš„æ¶ˆæ¯ã€‚ å¯¹äºä¸€ä¸ªæŒ‡å®šçš„Topicï¼Œæ¶ˆæ¯ä¸¥æ ¼æŒ‰ç…§å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„åŸåˆ™è¿›è¡Œæ¶ˆæ¯å‘å¸ƒå’Œæ¶ˆè´¹ï¼Œå³å…ˆå‘å¸ƒçš„æ¶ˆæ¯å…ˆæ¶ˆè´¹ï¼Œåå‘å¸ƒçš„æ¶ˆæ¯åæ¶ˆè´¹ã€‚åœ¨ Apache RocketMQ ä¸­æ”¯æŒåˆ†åŒºé¡ºåºæ¶ˆæ¯ã€‚æˆ‘ä»¬å¯ä»¥æŒ‰ç…§æŸä¸€ä¸ªæ ‡å‡†å¯¹æ¶ˆæ¯è¿›è¡Œåˆ†åŒºï¼ˆè®¢å•IDï¼‰ï¼ŒåŒä¸€ä¸ªè®¢å•IDçš„æ¶ˆæ¯ä¼šè¢«åˆ†é…åˆ°åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå¹¶æŒ‰ç…§é¡ºåºè¢«æ¶ˆè´¹ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ RocketMQ æ¶ˆæ¯çš„é¡ºåºæ€§åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œç”Ÿäº§é¡ºåºæ€§å’Œæ¶ˆè´¹é¡ºåºæ€§ã€‚åªæœ‰åŒæ—¶æ»¡è¶³äº†ç”Ÿäº§é¡ºåºæ€§å’Œæ¶ˆè´¹é¡ºåºæ€§æ‰èƒ½è¾¾åˆ°ä¸Šè¿°çš„FIFOæ•ˆæœã€‚ ç”Ÿäº§é¡ºåºæ€§ï¼š RocketMQ é€šè¿‡ç”Ÿäº§è€…å’ŒæœåŠ¡ç«¯çš„åè®®ä¿éšœå•ä¸ªç”Ÿäº§è€…ä¸²è¡Œåœ°å‘é€æ¶ˆæ¯ï¼Œå¹¶æŒ‰åºå­˜å‚¨å’ŒæŒä¹…åŒ–ã€‚å¦‚éœ€ä¿è¯æ¶ˆæ¯ç”Ÿäº§çš„é¡ºåºæ€§ï¼Œåˆ™å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š å•ä¸€ç”Ÿäº§è€…ï¼š æ¶ˆæ¯ç”Ÿäº§çš„é¡ºåºæ€§ä»…æ”¯æŒå•ä¸€ç”Ÿäº§è€…ï¼Œä¸åŒç”Ÿäº§è€…åˆ†å¸ƒåœ¨ä¸åŒçš„ç³»ç»Ÿï¼Œå³ä½¿è®¾ç½®ç›¸åŒçš„åˆ†åŒºé”®ï¼Œä¸åŒç”Ÿäº§è€…ä¹‹é—´äº§ç”Ÿçš„æ¶ˆæ¯ä¹Ÿæ— æ³•åˆ¤å®šå…¶å…ˆåé¡ºåºã€‚ ä¸²è¡Œå‘é€ï¼šç”Ÿäº§è€…å®¢æˆ·ç«¯æ”¯æŒå¤šçº¿ç¨‹å®‰å…¨è®¿é—®ï¼Œä½†å¦‚æœç”Ÿäº§è€…ä½¿ç”¨å¤šçº¿ç¨‹å¹¶è¡Œå‘é€ï¼Œåˆ™ä¸åŒçº¿ç¨‹é—´äº§ç”Ÿçš„æ¶ˆæ¯å°†æ— æ³•åˆ¤å®šå…¶å…ˆåé¡ºåºã€‚ æ»¡è¶³ä»¥ä¸Šæ¡ä»¶çš„ç”Ÿäº§è€…ï¼Œå°†é¡ºåºæ¶ˆæ¯å‘é€è‡³æœåŠ¡ç«¯åï¼Œä¼šä¿è¯è®¾ç½®äº†åŒä¸€åˆ†åŒºé”®çš„æ¶ˆæ¯ï¼ŒæŒ‰ç…§å‘é€é¡ºåºå­˜å‚¨åœ¨åŒä¸€é˜Ÿåˆ—ä¸­ã€‚æœåŠ¡ç«¯é¡ºåºå­˜å‚¨é€»è¾‘å¦‚ä¸‹ï¼š æ¨¡æ‹Ÿä¸€ä¸ªè®¢å•çš„å‘é€æµç¨‹ï¼Œåˆ›å»ºä¸¤ä¸ªè®¢å•ï¼Œå‘é€çš„æ¶ˆæ¯åˆ†åˆ«æ˜¯ è®¢å•å·111 æ¶ˆæ¯æµç¨‹ ä¸‹è®¢å•-ç‰©æµ-ç­¾æ”¶ è®¢å•å·112 æ¶ˆæ¯æµç¨‹ ä¸‹è®¢å•-ç‰©æµ-æ‹’æ”¶ @Test public void testOrderMessage() throws MQClientException // åˆ›å»ºé»˜è®¤çš„ç”Ÿäº§è€… DefaultMQProducer producer = new DefaultMQProducer(TestProducerGroup); // è®¾ç½®nameServeråœ°å€ producer.setNamesrvAddr(117.72.71.187:9876); // å¯åŠ¨å®ä¾‹ producer.start(); ListOrder orderList = Arrays.asList( new Order(1, 111, 59D, new Date(), ä¸‹è®¢å•), new Order(2, 111, 59D, new Date(), ç‰©æµ), new Order(3, 111, 59D, new Date(), ç­¾æ”¶), new Order(4, 112, 89D, new Date(), ä¸‹è®¢å•), new Order(5, 112, 89D, new Date(), ç‰©æµ), new Order(6, 112, 89D, new Date(), æ‹’æ”¶) ); // å¾ªç¯é›†åˆå¼€å§‹å‘é€ orderList.forEach(order - Message message = new Message(TestTopic, TagOrder ,order.toString().getBytes()); try // å‘é€çš„æ—¶å€™ ç›¸åŒçš„è®¢å•å·é€‰æ‹©åŒä¸€ä¸ªé˜Ÿåˆ— producer.send(message, new MessageQueueSelector() @Override public MessageQueue select(ListMessageQueue mqs, Message msg, Object arg) // å½“å‰ä¸»é¢˜æœ‰å¤šå°‘ä¸ªé˜Ÿåˆ— int queueNumber = mqs.size(); // è¿™ä¸ªargå°±æ˜¯åé¢ä¼ å…¥çš„ order.getOrderNumber() Integer i = (Integer) arg; // ç”¨è¿™ä¸ªå€¼å»%é˜Ÿåˆ—çš„ä¸ªæ•°å¾—åˆ°ä¸€ä¸ªé˜Ÿåˆ— int index = i % queueNumber; // è¿”å›é€‰æ‹©çš„è¿™ä¸ªé˜Ÿåˆ—å³å¯ ï¼Œé‚£ä¹ˆç›¸åŒçš„è®¢å•å· å°±ä¼šè¢«æ”¾åœ¨ç›¸åŒçš„é˜Ÿåˆ—é‡Œ å®ç°FIFOäº† return mqs.get(index); , order.getOrderNumber()); catch (Exception e) System.out.println(å‘é€å¼‚å¸¸); ); // å…³é—­å®ä¾‹ producer.shutdown(); è¿™é‡Œçš„åŒºåˆ«ä¸»è¦æ˜¯è°ƒç”¨äº†SendResult send(Message msg, MessageQueueSelector selector, Object arg)æ–¹æ³•ï¼ŒMessageQueueSelector æ˜¯é˜Ÿåˆ—é€‰æ‹©å™¨ï¼Œarg æ˜¯ä¸€ä¸ª Java Object å¯¹è±¡ï¼Œå¯ä»¥ä¼ å…¥ä½œä¸ºæ¶ˆæ¯å‘é€åˆ†åŒºçš„åˆ†ç±»æ ‡å‡†ã€‚ MessageQueueSelectorçš„æ¥å£å¦‚ä¸‹ï¼š public interface MessageQueueSelector MessageQueue select(final ListMessageQueue mqs, final Message msg, final Object arg); å…¶ä¸­ mqs æ˜¯å¯ä»¥å‘é€çš„é˜Ÿåˆ—ï¼Œmsgæ˜¯æ¶ˆæ¯ï¼Œargæ˜¯ä¸Šè¿°sendæ¥å£ä¸­ä¼ å…¥çš„Objectå¯¹è±¡ï¼Œè¿”å›çš„æ˜¯è¯¥æ¶ˆæ¯éœ€è¦å‘é€åˆ°çš„é˜Ÿåˆ—ã€‚ä¸Šè¿°ä¾‹å­é‡Œï¼Œæ˜¯ä»¥orderNumberä½œä¸ºåˆ†åŒºåˆ†ç±»æ ‡å‡†ï¼Œå¯¹æ‰€æœ‰é˜Ÿåˆ—ä¸ªæ•°å–ä½™ï¼Œæ¥å¯¹å°†ç›¸åŒorderNumberçš„æ¶ˆæ¯å‘é€åˆ°åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­ã€‚ ç”Ÿäº§ç¯å¢ƒä¸­å»ºè®®é€‰æ‹©æœ€ç»†ç²’åº¦çš„åˆ†åŒºé”®è¿›è¡Œæ‹†åˆ†ï¼Œä¾‹å¦‚ï¼Œå°†è®¢å•IDã€ç”¨æˆ·IDä½œä¸ºåˆ†åŒºé”®å…³é”®å­—ï¼Œå¯å®ç°åŒä¸€ç»ˆç«¯ç”¨æˆ·çš„æ¶ˆæ¯æŒ‰ç…§é¡ºåºå¤„ç†ï¼Œä¸åŒç”¨æˆ·çš„æ¶ˆæ¯æ— éœ€ä¿è¯é¡ºåºã€‚ å¦‚æœä¸€ä¸ªBrokeræ‰çº¿ï¼Œé‚£ä¹ˆæ­¤æ—¶é˜Ÿåˆ—æ€»æ•°æ˜¯å¦ä¼šå‘åŒ–ï¼Ÿ å¦‚æœå‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆåŒä¸€ä¸ª ShardingKey çš„æ¶ˆæ¯å°±ä¼šå‘é€åˆ°ä¸åŒçš„é˜Ÿåˆ—ä¸Šï¼Œé€ æˆä¹±åºã€‚å¦‚æœä¸å‘ç”Ÿå˜åŒ–ï¼Œé‚£æ¶ˆæ¯å°†ä¼šå‘é€åˆ°æ‰çº¿Brokerçš„é˜Ÿåˆ—ä¸Šï¼Œå¿…ç„¶æ˜¯å¤±è´¥çš„ã€‚å› æ­¤ Apache RocketMQ æä¾›äº†ä¸¤ç§æ¨¡å¼ï¼Œå¦‚æœè¦ä¿è¯ä¸¥æ ¼é¡ºåºè€Œä¸æ˜¯å¯ç”¨æ€§ï¼Œåˆ›å»º Topic æ˜¯è¦æŒ‡å®š -o å‚æ•°ï¼ˆâ€“orderï¼‰ä¸ºtrueï¼Œè¡¨ç¤ºé¡ºåºæ¶ˆæ¯: $ sh bin/mqadmin updateTopic -c DefaultCluster -t TopicTest -o true -n 127.0.0.1:9876create topic to 127.0.0.1:10911 success.TopicConfig [topicName=TopicTest, readQueueNums=8, writeQueueNums=8, perm=RW-, topicFilterType=SINGLE_TAG, topicSysFlag=0, order=true, attributes=null] å…¶æ¬¡è¦ä¿è¯NameServerä¸­çš„é…ç½® orderMessageEnable å’Œ returnOrderTopicConfigToBroker å¿…é¡»æ˜¯ trueã€‚å¦‚æœä¸Šè¿°ä»»æ„ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼Œåˆ™æ˜¯ä¿è¯å¯ç”¨æ€§è€Œä¸æ˜¯ä¸¥æ ¼é¡ºåºã€‚ 4.3 å»¶è¿Ÿæ¶ˆæ¯å»¶è¿Ÿæ¶ˆæ¯å‘é€æ˜¯æŒ‡æ¶ˆæ¯å‘é€åˆ°Apache RocketMQåï¼Œå¹¶ä¸æœŸæœ›ç«‹é©¬æŠ•é€’è¿™æ¡æ¶ˆæ¯ï¼Œè€Œæ˜¯å»¶è¿Ÿä¸€å®šæ—¶é—´åæ‰æŠ•é€’åˆ°Consumerè¿›è¡Œæ¶ˆè´¹ã€‚ Apache RocketMQ ä¸€å…±æ”¯æŒ18ä¸ªç­‰çº§çš„å»¶è¿ŸæŠ•é€’ï¼Œå…·ä½“æ—¶é—´å¦‚ä¸‹ï¼š æŠ•é€’ç­‰çº§ï¼ˆdelay levelï¼‰ å»¶è¿Ÿæ—¶é—´ æŠ•é€’ç­‰çº§ï¼ˆdelay levelï¼‰ å»¶è¿Ÿæ—¶é—´ 1 1s 10 6min 2 5s 11 7min 3 10s 12 8min 4 30s 13 9min 5 1min 14 10min 6 2min 15 20min 7 3min 16 30min 8 4min 17 1h 9 5min 18 2h @Test public void testDelayMessage() throws Exception // åˆ›å»ºé»˜è®¤çš„ç”Ÿäº§è€… DefaultMQProducer producer = new DefaultMQProducer(TestProducerGroup); // è®¾ç½®nameServeråœ°å€ producer.setNamesrvAddr(117.72.71.187:9876); // å¯åŠ¨å®ä¾‹ producer.start(); Message msg = new Message(TestTopic, (å»¶è¿Ÿæ¶ˆæ¯).getBytes()); // ç»™è¿™ä¸ªæ¶ˆæ¯è®¾å®šä¸€ä¸ªå»¶è¿Ÿç­‰çº§ // messageDelayLevel = 1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h msg.setDelayTimeLevel(3); // å‘é€å•å‘æ¶ˆæ¯ producer.send(msg); // æ‰“å°æ—¶é—´ System.out.println(new Date()); // å…³é—­å®ä¾‹ producer.shutdown(); å‘é€å»¶è¿Ÿæ¶ˆæ¯ æ¶ˆè´¹å»¶è¿Ÿæ¶ˆæ¯ å¯ä»¥çœ‹åˆ°ç»è¿‡10såæ‰æ¶ˆè´¹åˆ°æ¶ˆæ¯ 4.4 æ‰¹é‡æ¶ˆæ¯åœ¨å¯¹ååç‡æœ‰ä¸€å®šè¦æ±‚çš„æƒ…å†µä¸‹ï¼ŒApache RocketMQå¯ä»¥å°†ä¸€äº›æ¶ˆæ¯èšæˆä¸€æ‰¹ä»¥åè¿›è¡Œå‘é€ï¼Œå¯ä»¥å¢åŠ ååç‡ï¼Œå¹¶å‡å°‘APIå’Œç½‘ç»œè°ƒç”¨æ¬¡æ•°ã€‚ @Test public void testBatchMessage() throws Exception // åˆ›å»ºé»˜è®¤çš„ç”Ÿäº§è€… DefaultMQProducer producer = new DefaultMQProducer(TestProducerGroup); // è®¾ç½®nameServeråœ°å€ producer.setNamesrvAddr(117.72.71.187:9876); // å¯åŠ¨å®ä¾‹ producer.start(); ListMessage msgs = Arrays.asList( new Message(TestTopic, æˆ‘æ˜¯ä¸€ç»„æ¶ˆæ¯çš„Aæ¶ˆæ¯.getBytes()), new Message(TestTopic, æˆ‘æ˜¯ä¸€ç»„æ¶ˆæ¯çš„Bæ¶ˆæ¯.getBytes()), new Message(TestTopic, æˆ‘æ˜¯ä¸€ç»„æ¶ˆæ¯çš„Cæ¶ˆæ¯.getBytes()) ); SendResult send = producer.send(msgs); System.out.println(send); // å…³é—­å®ä¾‹ producer.shutdown(); è¿™é‡Œè°ƒç”¨éå¸¸ç®€å•ï¼Œå°†æ¶ˆæ¯æ‰“åŒ…æˆ CollectionMessage msgs ä¼ å…¥æ–¹æ³•ä¸­å³å¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ‰¹é‡æ¶ˆæ¯çš„å¤§å°ä¸èƒ½è¶…è¿‡ 1MiBï¼ˆå¦åˆ™éœ€è¦è‡ªè¡Œåˆ†å‰²ï¼‰ï¼Œå…¶æ¬¡åŒä¸€æ‰¹ batch ä¸­ topic å¿…é¡»ç›¸åŒã€‚ 4.5 äº‹åŠ¡æ¶ˆæ¯åœ¨ä¸€äº›å¯¹æ•°æ®ä¸€è‡´æ€§æœ‰å¼ºéœ€æ±‚çš„åœºæ™¯ï¼Œå¯ä»¥ç”¨ Apache RocketMQ äº‹åŠ¡æ¶ˆæ¯æ¥è§£å†³ï¼Œä»è€Œä¿è¯ä¸Šä¸‹æ¸¸æ•°æ®çš„ä¸€è‡´æ€§ã€‚ ä»¥ç”µå•†äº¤æ˜“åœºæ™¯ä¸ºä¾‹ï¼Œç”¨æˆ·æ”¯ä»˜è®¢å•è¿™ä¸€æ ¸å¿ƒæ“ä½œçš„åŒæ—¶ä¼šæ¶‰åŠåˆ°ä¸‹æ¸¸ç‰©æµå‘è´§ã€ç§¯åˆ†å˜æ›´ã€è´­ç‰©è½¦çŠ¶æ€æ¸…ç©ºç­‰å¤šä¸ªå­ç³»ç»Ÿçš„å˜æ›´ã€‚å½“å‰ä¸šåŠ¡çš„å¤„ç†åˆ†æ”¯åŒ…æ‹¬ï¼š ä¸»åˆ†æ”¯è®¢å•ç³»ç»ŸçŠ¶æ€æ›´æ–°ï¼šç”±æœªæ”¯ä»˜å˜æ›´ä¸ºæ”¯ä»˜æˆåŠŸã€‚ ç‰©æµç³»ç»ŸçŠ¶æ€æ–°å¢ï¼šæ–°å¢å¾…å‘è´§ç‰©æµè®°å½•ï¼Œåˆ›å»ºè®¢å•ç‰©æµè®°å½•ã€‚ ç§¯åˆ†ç³»ç»ŸçŠ¶æ€å˜æ›´ï¼šå˜æ›´ç”¨æˆ·ç§¯åˆ†ï¼Œæ›´æ–°ç”¨æˆ·ç§¯åˆ†è¡¨ã€‚ è´­ç‰©è½¦ç³»ç»ŸçŠ¶æ€å˜æ›´ï¼šæ¸…ç©ºè´­ç‰©è½¦ï¼Œæ›´æ–°ç”¨æˆ·è´­ç‰©è½¦è®°å½•ã€‚ ä½¿ç”¨æ™®é€šæ¶ˆæ¯å’Œè®¢å•äº‹åŠ¡æ— æ³•ä¿è¯ä¸€è‡´çš„åŸå› ï¼Œæœ¬è´¨ä¸Šæ˜¯ç”±äºæ™®é€šæ¶ˆæ¯æ— æ³•åƒå•æœºæ•°æ®åº“äº‹åŠ¡ä¸€æ ·ï¼Œå…·å¤‡æäº¤ã€å›æ»šå’Œç»Ÿä¸€åè°ƒçš„èƒ½åŠ›ã€‚ è€ŒåŸºäº RocketMQ çš„åˆ†å¸ƒå¼äº‹åŠ¡æ¶ˆæ¯åŠŸèƒ½ï¼Œåœ¨æ™®é€šæ¶ˆæ¯åŸºç¡€ä¸Šï¼Œæ”¯æŒäºŒé˜¶æ®µçš„æäº¤èƒ½åŠ›ã€‚å°†äºŒé˜¶æ®µæäº¤å’Œæœ¬åœ°äº‹åŠ¡ç»‘å®šï¼Œå®ç°å…¨å±€æäº¤ç»“æœçš„ä¸€è‡´æ€§ã€‚ äº‹åŠ¡æ¶ˆæ¯å‘é€åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µã€‚ç¬¬ä¸€é˜¶æ®µä¼šå‘é€ä¸€ä¸ªåŠäº‹åŠ¡æ¶ˆæ¯ï¼ŒåŠäº‹åŠ¡æ¶ˆæ¯æ˜¯æŒ‡æš‚ä¸èƒ½æŠ•é€’çš„æ¶ˆæ¯ï¼Œç”Ÿäº§è€…å·²ç»æˆåŠŸåœ°å°†æ¶ˆæ¯å‘é€åˆ°äº† Brokerï¼Œä½†æ˜¯Broker æœªæ”¶åˆ°ç”Ÿäº§è€…å¯¹è¯¥æ¶ˆæ¯çš„äºŒæ¬¡ç¡®è®¤ï¼Œæ­¤æ—¶è¯¥æ¶ˆæ¯è¢«æ ‡è®°æˆâ€œæš‚ä¸èƒ½æŠ•é€’â€çŠ¶æ€ï¼Œå¦‚æœå‘é€æˆåŠŸåˆ™æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œå¹¶æ ¹æ®æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒæˆåŠŸä¸å¦ï¼Œå‘ Broker åŠäº‹åŠ¡æ¶ˆæ¯çŠ¶æ€ï¼ˆcommitæˆ–è€…rollbackï¼‰ï¼ŒåŠäº‹åŠ¡æ¶ˆæ¯åªæœ‰ commit çŠ¶æ€æ‰ä¼šçœŸæ­£å‘ä¸‹æ¸¸æŠ•é€’ã€‚ å¦‚æœç”±äºç½‘ç»œé—ªæ–­ã€ç”Ÿäº§è€…åº”ç”¨é‡å¯ç­‰åŸå› ï¼Œå¯¼è‡´æŸæ¡äº‹åŠ¡æ¶ˆæ¯çš„äºŒæ¬¡ç¡®è®¤ä¸¢å¤±ï¼ŒBroker ç«¯ä¼šé€šè¿‡æ‰«æå‘ç°æŸæ¡æ¶ˆæ¯é•¿æœŸå¤„äºâ€œåŠäº‹åŠ¡æ¶ˆæ¯â€æ—¶ï¼Œéœ€è¦ä¸»åŠ¨å‘æ¶ˆæ¯ç”Ÿäº§è€…è¯¢é—®è¯¥æ¶ˆæ¯çš„æœ€ç»ˆçŠ¶æ€ï¼ˆCommitæˆ–æ˜¯Rollbackï¼‰ã€‚ è¿™æ ·æœ€ç»ˆä¿è¯äº†æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒæˆåŠŸï¼Œä¸‹æ¸¸å°±èƒ½æ”¶åˆ°æ¶ˆæ¯ï¼Œæœ¬åœ°äº‹åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œä¸‹æ¸¸å°±æ”¶ä¸åˆ°æ¶ˆæ¯ã€‚æ€»è€Œä¿è¯äº†ä¸Šä¸‹æ¸¸æ•°æ®çš„ä¸€è‡´æ€§ã€‚ æ•´ä¸ªäº‹åŠ¡æ¶ˆæ¯çš„è¯¦ç»†äº¤äº’æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š äº‹åŠ¡æ¶ˆæ¯å‘é€æ­¥éª¤å¦‚ä¸‹ï¼š ç”Ÿäº§è€…å°†åŠäº‹åŠ¡æ¶ˆæ¯å‘é€è‡³ RocketMQ Brokerã€‚ RocketMQ Broker å°†æ¶ˆæ¯æŒä¹…åŒ–æˆåŠŸä¹‹åï¼Œå‘ç”Ÿäº§è€…è¿”å› Ack ç¡®è®¤æ¶ˆæ¯å·²ç»å‘é€æˆåŠŸï¼Œæ­¤æ—¶æ¶ˆæ¯æš‚ä¸èƒ½æŠ•é€’ï¼Œä¸ºåŠäº‹åŠ¡æ¶ˆæ¯ã€‚ ç”Ÿäº§è€…å¼€å§‹æ‰§è¡Œæœ¬åœ°äº‹åŠ¡é€»è¾‘ã€‚ ç”Ÿäº§è€…æ ¹æ®æœ¬åœ°äº‹åŠ¡æ‰§è¡Œç»“æœå‘æœåŠ¡ç«¯æäº¤äºŒæ¬¡ç¡®è®¤ç»“æœï¼ˆCommitæˆ–æ˜¯Rollbackï¼‰ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°ç¡®è®¤ç»“æœåå¤„ç†é€»è¾‘å¦‚ä¸‹ï¼š äºŒæ¬¡ç¡®è®¤ç»“æœä¸ºCommitï¼šæœåŠ¡ç«¯å°†åŠäº‹åŠ¡æ¶ˆæ¯æ ‡è®°ä¸ºå¯æŠ•é€’ï¼Œå¹¶æŠ•é€’ç»™æ¶ˆè´¹è€…ã€‚ äºŒæ¬¡ç¡®è®¤ç»“æœä¸ºRollbackï¼šæœåŠ¡ç«¯å°†å›æ»šäº‹åŠ¡ï¼Œä¸ä¼šå°†åŠäº‹åŠ¡æ¶ˆæ¯æŠ•é€’ç»™æ¶ˆè´¹è€…ã€‚ åœ¨æ–­ç½‘æˆ–è€…æ˜¯ç”Ÿäº§è€…åº”ç”¨é‡å¯çš„ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œè‹¥æœåŠ¡ç«¯æœªæ”¶åˆ°å‘é€è€…æäº¤çš„äºŒæ¬¡ç¡®è®¤ç»“æœï¼Œæˆ–æœåŠ¡ç«¯æ”¶åˆ°çš„äºŒæ¬¡ç¡®è®¤ç»“æœä¸ºUnknownæœªçŸ¥çŠ¶æ€ï¼Œç»è¿‡å›ºå®šæ—¶é—´åï¼ŒæœåŠ¡ç«¯å°†å¯¹æ¶ˆæ¯ç”Ÿäº§è€…å³ç”Ÿäº§è€…é›†ç¾¤ä¸­ä»»ä¸€ç”Ÿäº§è€…å®ä¾‹å‘èµ·æ¶ˆæ¯å›æŸ¥ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæœåŠ¡ç«¯ä»…ä»…ä¼šæŒ‰ç…§å‚æ•°å°è¯•æŒ‡å®šæ¬¡æ•°ï¼Œè¶…è¿‡æ¬¡æ•°åäº‹åŠ¡ä¼šå¼ºåˆ¶å›æ»šï¼Œå› æ­¤æœªå†³äº‹åŠ¡çš„å›æŸ¥æ—¶æ•ˆæ€§éå¸¸å…³é”®ï¼Œéœ€è¦æŒ‰ç…§ä¸šåŠ¡çš„å®é™…é£é™©æ¥è®¾ç½®ã€‚ äº‹åŠ¡æ¶ˆæ¯å›æŸ¥æ­¥éª¤å¦‚ä¸‹ï¼š 7. ç”Ÿäº§è€…æ”¶åˆ°æ¶ˆæ¯å›æŸ¥åï¼Œéœ€è¦æ£€æŸ¥å¯¹åº”æ¶ˆæ¯çš„æœ¬åœ°äº‹åŠ¡æ‰§è¡Œçš„æœ€ç»ˆç»“æœã€‚ 8. ç”Ÿäº§è€…æ ¹æ®æ£€æŸ¥å¾—åˆ°çš„æœ¬åœ°äº‹åŠ¡çš„æœ€ç»ˆçŠ¶æ€å†æ¬¡æäº¤äºŒæ¬¡ç¡®è®¤ï¼ŒæœåŠ¡ç«¯ä»æŒ‰ç…§æ­¥éª¤4å¯¹åŠäº‹åŠ¡æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚ /** * TransactionalMessageCheckServiceçš„æ£€æµ‹é¢‘ç‡é»˜è®¤1åˆ†é’Ÿï¼Œå¯é€šè¿‡åœ¨broker.confæ–‡ä»¶ä¸­è®¾ç½®transactionCheckIntervalçš„å€¼æ¥æ”¹å˜é»˜è®¤å€¼ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚ * ä»brokeré…ç½®æ–‡ä»¶ä¸­è·å–transactionTimeOutå‚æ•°å€¼ã€‚ * ä»brokeré…ç½®æ–‡ä»¶ä¸­è·å–transactionCheckMaxå‚æ•°å€¼ï¼Œè¡¨ç¤ºäº‹åŠ¡çš„æœ€å¤§æ£€æµ‹æ¬¡æ•°ï¼Œå¦‚æœè¶…è¿‡æ£€æµ‹æ¬¡æ•°ï¼Œæ¶ˆæ¯ä¼šé»˜è®¤ä¸ºä¸¢å¼ƒï¼Œå³å›æ»šæ¶ˆæ¯ã€‚ * * @throws Exception */ @Test public void testTransactionProducer() throws Exception // åˆ›å»ºä¸€ä¸ªäº‹åŠ¡æ¶ˆæ¯ç”Ÿäº§è€… TransactionMQProducer producer = new TransactionMQProducer(TestProducerGroup); producer.setNamesrvAddr(117.72.71.187:9876); // è®¾ç½®äº‹åŠ¡æ¶ˆæ¯ç›‘å¬å™¨ producer.setTransactionListener(new TransactionListener() // è¿™ä¸ªæ˜¯æ‰§è¡Œæœ¬åœ°ä¸šåŠ¡æ–¹æ³• @Override public LocalTransactionState executeLocalTransaction(Message msg, Object arg) System.out.println(new Date()); System.out.println(new String(msg.getBody())); // è¿™ä¸ªå¯ä»¥ä½¿ç”¨try catchå¯¹ä¸šåŠ¡ä»£ç è¿›è¡Œæ€§åŒ…è£¹ // COMMIT_MESSAGE è¡¨ç¤ºå…è®¸æ¶ˆè´¹è€…æ¶ˆè´¹è¯¥æ¶ˆæ¯ // ROLLBACK_MESSAGE è¡¨ç¤ºè¯¥æ¶ˆæ¯å°†è¢«åˆ é™¤ï¼Œä¸å…è®¸æ¶ˆè´¹ // UNKNOWè¡¨ç¤ºéœ€è¦MQå›æŸ¥æ‰èƒ½ç¡®å®šçŠ¶æ€ é‚£ä¹ˆè¿‡ä¸€ä¼š ä»£ç ä¼šèµ°ä¸‹é¢çš„checkLocalTransaction(msg)æ–¹æ³• return LocalTransactionState.UNKNOW; // è¿™é‡Œæ˜¯å›æŸ¥æ–¹æ³• å›æŸ¥ä¸æ˜¯å†æ¬¡æ‰§è¡Œä¸šåŠ¡æ“ä½œï¼Œè€Œæ˜¯ç¡®è®¤ä¸Šé¢çš„æ“ä½œæ˜¯å¦æœ‰ç»“æœ // é»˜è®¤æ˜¯1minå›æŸ¥ é»˜è®¤å›æŸ¥15æ¬¡ è¶…è¿‡æ¬¡æ•°åˆ™ä¸¢å¼ƒæ‰“å°æ—¥å¿— å¯ä»¥é€šè¿‡å‚æ•°è®¾ç½® // transactionTimeOut è¶…æ—¶æ—¶é—´ // transactionCheckMax æœ€å¤§å›æŸ¥æ¬¡æ•° // transactionCheckInterval å›æŸ¥é—´éš”æ—¶é—´å•ä½æ¯«ç§’ // è§¦å‘æ¡ä»¶ // 1.å½“ä¸Šé¢æ‰§è¡Œæœ¬åœ°äº‹åŠ¡è¿”å›ç»“æœUNKNOWæ—¶,æˆ–è€…ä¸‹é¢çš„å›æŸ¥æ–¹æ³•ä¹Ÿè¿”å›UNKNOWæ—¶ ä¼šè§¦å‘å›æŸ¥ // 2.å½“ä¸Šé¢æ“ä½œè¶…è¿‡20sæ²¡æœ‰åšå‡ºä¸€ä¸ªç»“æœï¼Œä¹Ÿå°±æ˜¯è¶…æ—¶æˆ–è€…å¡ä¸»äº†ï¼Œä¹Ÿä¼šè¿›è¡Œå›æŸ¥ @Override public LocalTransactionState checkLocalTransaction(MessageExt msg) System.err.println(new Date()); System.err.println(new String(msg.getBody())); // è¿™é‡Œ return LocalTransactionState.UNKNOW; ); producer.start(); Message message = new Message(TestTopic2, æˆ‘æ˜¯ä¸€ä¸ªäº‹åŠ¡æ¶ˆæ¯.getBytes()); // å‘é€æ¶ˆæ¯ producer.sendMessageInTransaction(message, null); System.out.println(new Date()); System.in.read(); @Test public void testTransactionConsumer() throws Exception // åˆ›å»ºé»˜è®¤æ¶ˆè´¹è€…ç»„ DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(consumer-group); // è®¾ç½®nameServeråœ°å€ consumer.setNamesrvAddr(117.72.71.187:9876); // è®¢é˜…ä¸€ä¸ªä¸»é¢˜æ¥æ¶ˆè´¹ *è¡¨ç¤ºæ²¡æœ‰è¿‡æ»¤å‚æ•° è¡¨ç¤ºè¿™ä¸ªä¸»é¢˜çš„ä»»ä½•æ¶ˆæ¯ consumer.subscribe(TestTopic2, *); // æ³¨å†Œä¸€ä¸ªæ¶ˆè´¹ç›‘å¬ MessageListenerConcurrentlyæ˜¯å¹¶å‘æ¶ˆè´¹ // é»˜è®¤æ˜¯20ä¸ªçº¿ç¨‹ä¸€èµ·æ¶ˆè´¹ï¼Œå¯ä»¥å‚çœ‹ consumer.setConsumeThreadMax() consumer.registerMessageListener(new MessageListenerConcurrently() @Override public ConsumeConcurrentlyStatus consumeMessage(ListMessageExt msgs, ConsumeConcurrentlyContext context) // è¿™é‡Œæ‰§è¡Œæ¶ˆè´¹çš„ä»£ç  é»˜è®¤æ˜¯å¤šçº¿ç¨‹æ¶ˆè´¹ System.out.println(Thread.currentThread().getName() + ---- + new String(msgs.get(0).getBody())); return ConsumeConcurrentlyStatus.CONSUME_SUCCESS; ); consumer.start(); System.in.read(); å¯ä»¥çœ‹åˆ°å½“ä¸Šé¢æ‰§è¡Œæœ¬åœ°äº‹åŠ¡è¿”å›ç»“æœUNKNOWæ—¶ï¼Œæˆ–è€…ä¸‹é¢çš„å›æŸ¥æ–¹æ³•ä¹Ÿè¿”å›UNKNOWæ—¶ä¼šè§¦å‘å›æŸ¥ã€‚ @Override public LocalTransactionState checkLocalTransaction(MessageExt msg) System.err.println(new Date()); System.err.println(new String(msg.getBody())); // è¿™é‡Œ return LocalTransactionState.COMMIT_MESSAGE; å½“ä¿®æ”¹æ¶ˆæ¯çŠ¶æ€æ—¶æ¶ˆè´¹è€…æ‰èƒ½æ”¶åˆ°æ¶ˆæ¯ äº‹åŠ¡æ¶ˆæ¯çš„å‘é€ä¸å†ä½¿ç”¨ DefaultMQProducerï¼Œè€Œæ˜¯ä½¿ç”¨ TransactionMQProducer è¿›è¡Œå‘é€ï¼Œä¼šé»˜è®¤ç”Ÿæˆä¸€ä¸ªäº‹åŠ¡å›æŸ¥çš„çº¿ç¨‹æ± ï¼Œæœ€é‡è¦çš„æ˜¯éœ€è¦å®ç° TransactionListener æ¥å£ï¼Œå¹¶ä¼ å…¥ TransactionMQProducerã€‚ TransactionListeneræ¥å£çš„å®šä¹‰å¦‚ä¸‹ï¼š public interface TransactionListener /** * When send transactional prepare(half) message succeed, this method will be invoked to execute local transaction. * * @param msg Half(prepare) message * @param arg Custom business parameter * @return Transaction state */ LocalTransactionState executeLocalTransaction(final Message msg, final Object arg); /** * When no response to prepare(half) message. broker will send check message to check the transaction status, and this * method will be invoked to get local transaction status. * * @param msg Check message * @return Transaction state */ LocalTransactionState checkLocalTransaction(final MessageExt msg); executeLocalTransaction æ˜¯åŠäº‹åŠ¡æ¶ˆæ¯å‘é€æˆåŠŸåï¼Œæ‰§è¡Œæœ¬åœ°äº‹åŠ¡çš„æ–¹æ³•ï¼Œå…·ä½“æ‰§è¡Œå®Œæœ¬åœ°äº‹åŠ¡åï¼Œå¯ä»¥åœ¨è¯¥æ–¹æ³•ä¸­è¿”å›ä»¥ä¸‹ä¸‰ç§çŠ¶æ€ï¼š LocalTransactionState.COMMIT_MESSAGEï¼šæäº¤äº‹åŠ¡ï¼Œå…è®¸æ¶ˆè´¹è€…æ¶ˆè´¹è¯¥æ¶ˆæ¯ LocalTransactionState.ROLLBACK_MESSAGEï¼šå›æ»šäº‹åŠ¡ï¼Œæ¶ˆæ¯å°†è¢«ä¸¢å¼ƒä¸å…è®¸æ¶ˆè´¹ã€‚ LocalTransactionState.UNKNOWï¼šæš‚æ—¶æ— æ³•åˆ¤æ–­çŠ¶æ€ï¼Œç­‰å¾…å›ºå®šæ—¶é—´ä»¥åBrokerç«¯æ ¹æ®å›æŸ¥è§„åˆ™å‘ç”Ÿäº§è€…è¿›è¡Œæ¶ˆæ¯å›æŸ¥ã€‚ checkLocalTransactionæ˜¯ç”±äºäºŒæ¬¡ç¡®è®¤æ¶ˆæ¯æ²¡æœ‰æ”¶åˆ°ï¼ŒBrokerç«¯å›æŸ¥äº‹åŠ¡çŠ¶æ€çš„æ–¹æ³•ã€‚ å›æŸ¥è§„åˆ™ï¼šæœ¬åœ°äº‹åŠ¡æ‰§è¡Œå®Œæˆåï¼Œè‹¥Brokerç«¯æ”¶åˆ°çš„æœ¬åœ°äº‹åŠ¡è¿”å›çŠ¶æ€ä¸ºLocalTransactionState.UNKNOWï¼Œæˆ–ç”Ÿäº§è€…åº”ç”¨é€€å‡ºå¯¼è‡´æœ¬åœ°äº‹åŠ¡æœªæäº¤ä»»ä½•çŠ¶æ€ã€‚åˆ™Brokerç«¯ä¼šå‘æ¶ˆæ¯ç”Ÿäº§è€…å‘èµ·äº‹åŠ¡å›æŸ¥ï¼Œç¬¬ä¸€æ¬¡å›æŸ¥åä»æœªè·å–åˆ°äº‹åŠ¡çŠ¶æ€ï¼Œåˆ™ä¹‹åæ¯éš”ä¸€æ®µæ—¶é—´ä¼šå†æ¬¡å›æŸ¥ï¼ˆé»˜è®¤é—´éš”æ—¶é—´ä¸º1åˆ†é’Ÿï¼‰ã€‚ æ­¤å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯äº‹åŠ¡æ¶ˆæ¯çš„ç”Ÿäº§ç»„åç§° ProducerGroupNameä¸èƒ½éšæ„è®¾ç½®ã€‚äº‹åŠ¡æ¶ˆæ¯æœ‰å›æŸ¥æœºåˆ¶ï¼Œå›æŸ¥æ—¶Brokerç«¯å¦‚æœå‘ç°åŸå§‹ç”Ÿäº§è€…å·²ç»å´©æºƒï¼Œåˆ™ä¼šè”ç³»åŒä¸€ç”Ÿäº§è€…ç»„çš„å…¶ä»–ç”Ÿäº§è€…å®ä¾‹å›æŸ¥æœ¬åœ°äº‹åŠ¡æ‰§è¡Œæƒ…å†µä»¥Commitæˆ–RollbackåŠäº‹åŠ¡æ¶ˆæ¯ã€‚ 5. æ¶ˆè´¹è€…5.1 åŸºç¡€æ¦‚å¿µæ¶ˆæ¯é€šè¿‡ç”Ÿäº§è€…å‘é€åˆ°æŸä¸€ä¸ªTopicï¼Œå¦‚æœéœ€è¦è®¢é˜…è¯¥Topicå¹¶æ¶ˆè´¹é‡Œé¢çš„æ¶ˆæ¯çš„è¯ï¼Œå°±è¦åˆ›å»ºå¯¹åº”çš„æ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ã€‚åœ¨ä»‹ç»æ¶ˆè´¹è€…çš„ä½¿ç”¨æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆä»‹ç»æ¶ˆè´¹ç»„ã€æ¶ˆè´¹ä½ç‚¹ã€æ¨å’Œæ‹‰ç­‰æ¦‚å¿µã€‚ 5.1.1 æ¶ˆè´¹è€…ä¸æ¶ˆè´¹ç»„æ¶ˆæ¯ç³»ç»Ÿçš„é‡è¦ä½œç”¨ä¹‹ä¸€æ˜¯å‰Šå³°å¡«è°·ï¼Œä½†æ¯”å¦‚åœ¨ç”µå•†å¤§ä¿ƒçš„åœºæ™¯ä¸­ï¼Œå¦‚æœä¸‹æ¸¸çš„æ¶ˆè´¹è€…æ¶ˆè´¹èƒ½åŠ›ä¸è¶³çš„è¯ï¼Œå¤§é‡çš„ç¬æ—¶æµé‡è¿›å…¥ä¼šåå †ç§¯åœ¨æœåŠ¡ç«¯ã€‚æ­¤æ—¶ï¼Œæ¶ˆæ¯çš„ç«¯åˆ°ç«¯å»¶è¿Ÿï¼ˆä»å‘é€åˆ°è¢«æ¶ˆè´¹çš„æ—¶é—´ï¼‰å°±ä¼šå¢åŠ ï¼Œå¯¹æœåŠ¡ç«¯è€Œè¨€ï¼Œä¸€ç›´æ¶ˆè´¹å†å²æ•°æ®ä¹Ÿä¼šäº§ç”Ÿå†·è¯»ã€‚å› æ­¤éœ€è¦å¢åŠ æ¶ˆè´¹èƒ½åŠ›æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé™¤äº†å»ä¼˜åŒ–æ¶ˆæ¯æ¶ˆè´¹çš„æ—¶é—´ï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯æ‰©å®¹æ¶ˆè´¹è€…ã€‚ ä½†æ˜¯å¦éšæ„å¢åŠ æ¶ˆè´¹è€…å°±èƒ½æå‡æ¶ˆè´¹èƒ½åŠ›ï¼Ÿ é¦–å…ˆéœ€è¦äº†è§£æ¶ˆè´¹ç»„çš„æ¦‚å¿µã€‚åœ¨æ¶ˆè´¹è€…ä¸­æ¶ˆè´¹ç»„çš„æœ‰éå¸¸é‡è¦çš„ä½œç”¨ï¼Œå¦‚æœå¤šä¸ªæ¶ˆè´¹è€…è®¾ç½®äº†ç›¸åŒçš„Consumer Groupï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™äº›æ¶ˆè´¹è€…åœ¨åŒä¸€ä¸ªæ¶ˆè´¹ç»„å†…ã€‚ åœ¨ Apache RocketMQ æœ‰ä¸¤ç§æ¶ˆè´¹æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯ï¼š é›†ç¾¤æ¶ˆè´¹æ¨¡å¼ï¼šå½“ä½¿ç”¨é›†ç¾¤æ¶ˆè´¹æ¨¡å¼æ—¶ï¼ŒRocketMQ è®¤ä¸ºä»»æ„ä¸€æ¡æ¶ˆæ¯åªéœ€è¦è¢«æ¶ˆè´¹ç»„å†…çš„ä»»æ„ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†å³å¯ã€‚ å¹¿æ’­æ¶ˆè´¹æ¨¡å¼ï¼šå½“ä½¿ç”¨å¹¿æ’­æ¶ˆè´¹æ¨¡å¼æ—¶ï¼ŒRocketMQ ä¼šå°†æ¯æ¡æ¶ˆæ¯æ¨é€ç»™æ¶ˆè´¹ç»„æ‰€æœ‰çš„æ¶ˆè´¹è€…ï¼Œä¿è¯æ¶ˆæ¯è‡³å°‘è¢«æ¯ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ä¸€æ¬¡ã€‚ é›†ç¾¤æ¶ˆè´¹æ¨¡å¼é€‚ç”¨äºæ¯æ¡æ¶ˆæ¯åªéœ€è¦è¢«å¤„ç†ä¸€æ¬¡çš„åœºæ™¯ï¼Œä¹Ÿå°±æ˜¯è¯´æ•´ä¸ªæ¶ˆè´¹ç»„ä¼šTopicæ”¶åˆ°å…¨é‡çš„æ¶ˆæ¯ï¼Œè€Œæ¶ˆè´¹ç»„å†…çš„æ¶ˆè´¹åˆ†æ‹…æ¶ˆè´¹è¿™äº›æ¶ˆæ¯ï¼Œå› æ­¤å¯ä»¥é€šè¿‡æ‰©ç¼©æ¶ˆè´¹è€…æ•°é‡ï¼Œæ¥æå‡æˆ–é™ä½æ¶ˆè´¹èƒ½åŠ›ï¼Œå…·ä½“ç¤ºä¾‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ˜¯æœ€å¸¸è§çš„æ¶ˆè´¹æ–¹å¼ã€‚ å¹¿æ’­æ¶ˆè´¹æ¨¡å¼é€‚ç”¨äºæ¯æ¡æ¶ˆæ¯éœ€è¦è¢«æ¶ˆè´¹ç»„çš„æ¯ä¸ªæ¶ˆè´¹è€…å¤„ç†çš„åœºæ™¯ï¼Œä¹Ÿå°±æ˜¯è¯´æ¶ˆè´¹ç»„å†…çš„æ¯ä¸ªæ¶ˆè´¹è€…éƒ½ä¼šæ”¶åˆ°è®¢é˜…Topicçš„å…¨é‡æ¶ˆæ¯ï¼Œå› æ­¤å³ä½¿æ‰©ç¼©æ¶ˆè´¹è€…æ•°é‡ä¹Ÿæ— æ³•æå‡æˆ–é™ä½æ¶ˆè´¹èƒ½åŠ›ï¼Œå…·ä½“ç¤ºä¾‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ 5.1.2 è´Ÿè½½å‡è¡¡é›†ç¾¤æ¨¡å¼ä¸‹ï¼ŒåŒä¸€ä¸ªæ¶ˆè´¹ç»„å†…çš„æ¶ˆè´¹è€…ä¼šåˆ†æ‹…æ”¶åˆ°çš„å…¨é‡æ¶ˆæ¯ï¼Œè¿™é‡Œçš„åˆ†é…ç­–ç•¥æ˜¯æ€æ ·çš„ï¼Ÿå¦‚æœæ‰©å®¹æ¶ˆè´¹è€…æ˜¯å¦ä¸€å®šèƒ½æå‡æ¶ˆè´¹èƒ½åŠ›ï¼Ÿ Apache RocketMQ æä¾›äº†å¤šç§é›†ç¾¤æ¨¡å¼ä¸‹çš„åˆ†é…ç­–ç•¥ï¼ŒåŒ…æ‹¬å¹³å‡åˆ†é…ç­–ç•¥ã€æœºæˆ¿ä¼˜å…ˆåˆ†é…ç­–ç•¥ã€ä¸€è‡´æ€§hashåˆ†é…ç­–ç•¥ç­‰ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç è¿›è¡Œè®¾ç½®ç›¸åº”è´Ÿè½½å‡è¡¡ç­–ç•¥ consumer.setAllocateMessageQueueStrategy(new AllocateMessageQueueAveragely()); é»˜è®¤çš„åˆ†é…ç­–ç•¥æ˜¯å¹³å‡åˆ†é…ï¼Œè¿™ä¹Ÿæ˜¯æœ€å¸¸è§çš„ç­–ç•¥ã€‚å¹³å‡åˆ†é…ç­–ç•¥ä¸‹æ¶ˆè´¹ç»„å†…çš„æ¶ˆè´¹è€…ä¼šæŒ‰ç…§ç±»ä¼¼åˆ†é¡µçš„ç­–ç•¥å‡æ‘Šæ¶ˆè´¹ã€‚ åœ¨å¹³å‡åˆ†é…çš„ç®—æ³•ä¸‹ï¼Œå¯ä»¥é€šè¿‡å¢åŠ æ¶ˆè´¹è€…çš„æ•°é‡æ¥æé«˜æ¶ˆè´¹çš„å¹¶è¡Œåº¦ã€‚æ¯”å¦‚ä¸‹å›¾ä¸­ï¼Œé€šè¿‡å¢åŠ æ¶ˆè´¹è€…æ¥æé«˜æ¶ˆè´¹èƒ½åŠ›ã€‚ ä½†ä¹Ÿä¸æ˜¯ä¸€å‘³åœ°å¢åŠ æ¶ˆè´¹è€…å°±èƒ½æå‡æ¶ˆè´¹èƒ½åŠ›çš„ï¼Œæ¯”å¦‚ä¸‹å›¾ä¸­Topicçš„æ€»é˜Ÿåˆ—æ•°å°äºæ¶ˆè´¹è€…çš„æ•°é‡æ—¶ï¼Œæ¶ˆè´¹è€…å°†åˆ†é…ä¸åˆ°é˜Ÿåˆ—ï¼Œå³ä½¿æ¶ˆè´¹è€…å†å¤šä¹Ÿæ— æ³•æå‡æ¶ˆè´¹èƒ½åŠ›ã€‚ 5.1.3 æ¶ˆè´¹ä½ç‚¹ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨Apache RocketMQä¸­æ¯ä¸ªé˜Ÿåˆ—éƒ½ä¼šè®°å½•è‡ªå·±çš„æœ€å°ä½ç‚¹ã€æœ€å¤§ä½ç‚¹ã€‚é’ˆå¯¹äºæ¶ˆè´¹ç»„ï¼Œè¿˜æœ‰æ¶ˆè´¹ä½ç‚¹çš„æ¦‚å¿µï¼Œåœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œæ¶ˆè´¹ä½ç‚¹æ˜¯ç”±å®¢æˆ·ç«¯æç»™äº¤æœåŠ¡ç«¯ä¿å­˜çš„ï¼Œåœ¨å¹¿æ’­æ¨¡å¼ä¸‹ï¼Œæ¶ˆè´¹ä½ç‚¹æ˜¯ç”±å®¢æˆ·ç«¯è‡ªå·±ä¿å­˜çš„ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æ¶ˆè´¹ä½ç‚¹æ­£å¸¸æ›´æ–°ï¼Œä¸ä¼šå‡ºç°æ¶ˆæ¯é‡å¤ï¼Œä½†å¦‚æœæ¶ˆè´¹è€…å‘ç”Ÿå´©æºƒæˆ–æœ‰æ–°çš„æ¶ˆè´¹è€…åŠ å…¥ç¾¤ç»„ï¼Œå°±ä¼šè§¦å‘é‡å¹³è¡¡ï¼Œé‡å¹³è¡¡å®Œæˆåï¼Œæ¯ä¸ªæ¶ˆè´¹è€…å¯èƒ½ä¼šåˆ†é…åˆ°æ–°çš„é˜Ÿåˆ—ï¼Œè€Œä¸æ˜¯ä¹‹å‰å¤„ç†çš„é˜Ÿåˆ—ã€‚ä¸ºäº†èƒ½ç»§ç»­ä¹‹å‰çš„å·¥ä½œï¼Œæ¶ˆè´¹è€…éœ€è¦è¯»å–æ¯ä¸ªé˜Ÿåˆ—æœ€åä¸€æ¬¡çš„æäº¤çš„æ¶ˆè´¹ä½ç‚¹ï¼Œç„¶åä»æ¶ˆè´¹ä½ç‚¹å¤„ç»§ç»­æ‹‰å–æ¶ˆæ¯ã€‚ä½†åœ¨å®é™…æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”±äºå®¢æˆ·ç«¯æäº¤ç»™æœåŠ¡ç«¯çš„æ¶ˆè´¹ä½ç‚¹å¹¶ä¸æ˜¯å®æ—¶çš„ï¼Œæ‰€ä»¥é‡å¹³è¡¡å°±å¯èƒ½ä¼šå¯¼è‡´æ¶ˆæ¯å°‘é‡é‡å¤ã€‚ 5.1.4 æ¨ã€æ‹‰å’Œé•¿è½®è¯¢MQçš„æ¶ˆè´¹æ¨¡å¼å¯ä»¥å¤§è‡´åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯æ¨Pushï¼Œä¸€ç§æ˜¯æ‹‰Pullã€‚ Pushæ˜¯æœåŠ¡ç«¯ä¸»åŠ¨æ¨é€æ¶ˆæ¯ç»™å®¢æˆ·ç«¯ï¼Œä¼˜ç‚¹æ˜¯åŠæ—¶æ€§è¾ƒå¥½ï¼Œä½†å¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰åšå¥½æµæ§ï¼Œä¸€æ—¦æœåŠ¡ç«¯æ¨é€å¤§é‡æ¶ˆæ¯åˆ°å®¢æˆ·ç«¯æ—¶ï¼Œå°±ä¼šå¯¼è‡´å®¢æˆ·ç«¯æ¶ˆæ¯å †ç§¯ç”šè‡³å´©æºƒã€‚ Pullæ˜¯å®¢æˆ·ç«¯éœ€è¦ä¸»åŠ¨åˆ°æœåŠ¡ç«¯å–æ•°æ®ï¼Œä¼˜ç‚¹æ˜¯å®¢æˆ·ç«¯å¯ä»¥ä¾æ®è‡ªå·±çš„æ¶ˆè´¹èƒ½åŠ›è¿›è¡Œæ¶ˆè´¹ï¼Œä½†æ‹‰å–çš„é¢‘ç‡ä¹Ÿéœ€è¦ç”¨æˆ·è‡ªå·±æ§åˆ¶ï¼Œæ‹‰å–é¢‘ç¹å®¹æ˜“é€ æˆæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„å‹åŠ›ï¼Œæ‹‰å–é—´éš”é•¿åˆå®¹æ˜“é€ æˆæ¶ˆè´¹ä¸åŠæ—¶ã€‚ Apache RocketMQæ—¢æä¾›äº†Pushæ¨¡å¼ä¹Ÿæä¾›äº†Pullæ¨¡å¼ã€‚ 5.2 Pushæ¶ˆè´¹@Test public void testPushConsumer() throws MQClientException, IOException // åˆå§‹åŒ–consumerï¼Œå¹¶è®¾ç½®consumer group name DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(consumer-group); // è®¾ç½®NameServeråœ°å€ consumer.setNamesrvAddr(117.72.71.187:9876); //è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªtopicï¼Œå¹¶æŒ‡å®štagè¿‡æ»¤æ¡ä»¶ï¼Œè¿™é‡ŒæŒ‡å®š*è¡¨ç¤ºæ¥æ”¶æ‰€æœ‰tagçš„æ¶ˆæ¯ consumer.subscribe(TestTopic, *); //æ³¨å†Œå›è°ƒæ¥å£æ¥å¤„ç†ä»Brokerä¸­æ”¶åˆ°çš„æ¶ˆæ¯ consumer.registerMessageListener(new MessageListenerConcurrently() @Override public ConsumeConcurrentlyStatus consumeMessage(ListMessageExt msgs, ConsumeConcurrentlyContext context) System.out.printf(%s Receive New Messages: %s %n, Thread.currentThread().getName(), msgs); // è¿”å›æ¶ˆæ¯æ¶ˆè´¹çŠ¶æ€ï¼ŒConsumeConcurrentlyStatus.CONSUME_SUCCESSä¸ºæ¶ˆè´¹æˆåŠŸ return ConsumeConcurrentlyStatus.CONSUME_SUCCESS; ); // å¯åŠ¨Consumer consumer.start(); System.out.printf(Consumer Started.%n); System.in.read(); é¦–å…ˆéœ€è¦åˆå§‹åŒ–æ¶ˆè´¹è€…ï¼Œåˆå§‹åŒ–æ¶ˆè´¹è€…æ—¶ï¼Œå¿…é¡»å¡«å†™ConsumerGroupNameï¼ŒåŒä¸€ä¸ªæ¶ˆè´¹ç»„çš„ConsumerGroupNameæ˜¯ç›¸åŒçš„ï¼Œè¿™æ˜¯åˆ¤æ–­æ¶ˆè´¹è€…æ˜¯å¦å±äºåŒä¸€ä¸ªæ¶ˆè´¹ç»„çš„é‡è¦å±æ€§ã€‚ç„¶åæ˜¯è®¾ç½®NameServeråœ°å€ï¼Œè¿™é‡Œä¸Producerä¸€æ ·ä¸å†ä»‹ç»ã€‚ç„¶åæ˜¯è°ƒç”¨subscribeæ–¹æ³•è®¢é˜…Topicï¼Œsubscribeæ–¹æ³•éœ€è¦æŒ‡å®šéœ€è¦è®¢é˜…çš„Topicåï¼Œä¹Ÿå¯ä»¥å¢åŠ æ¶ˆæ¯è¿‡æ»¤çš„æ¡ä»¶ï¼Œæ¯”å¦‚TagAç­‰ï¼Œä¸Šè¿°ä»£ç ä¸­æŒ‡å®š[*]è¡¨ç¤ºæ¥æ”¶æ‰€æœ‰tagçš„æ¶ˆæ¯ã€‚é™¤äº†è®¢é˜…ä¹‹å¤–ï¼Œè¿˜éœ€è¦æ³¨å†Œå›è°ƒæ¥å£ç¼–å†™æ¶ˆè´¹é€»è¾‘æ¥å¤„ç†ä»Brokerä¸­æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œè°ƒç”¨registerMessageListeneræ–¹æ³•ï¼Œéœ€è¦ä¼ å…¥MessageListenerçš„å®ç°ï¼Œä¸Šè¿°ä»£ç ä¸­æ˜¯å¹¶å‘æ¶ˆè´¹ï¼Œå› æ­¤æ˜¯MessageListenerConcurrentlyçš„å®ç°ï¼Œå…¶æ¥å£å¦‚ä¸‹ï¼š /** * A MessageListenerConcurrently object is used to receive asynchronously delivered messages concurrently */public interface MessageListenerConcurrently extends MessageListener /** * It is not recommend to throw exception,rather than returning ConsumeConcurrentlyStatus.RECONSUME_LATER if * consumption failure * * @param msgs msgs.size() = 1br DefaultMQPushConsumer.consumeMessageBatchMaxSize=1,you can modify here * @return The consume status */ ConsumeConcurrentlyStatus consumeMessage(final ListMessageExt msgs, final ConsumeConcurrentlyContext context); å…¶ä¸­ï¼Œmsgsæ˜¯ä»Brokerç«¯è·å–çš„éœ€è¦è¢«æ¶ˆè´¹æ¶ˆæ¯åˆ—è¡¨ï¼Œç”¨æˆ·å®ç°è¯¥æ¥å£ï¼Œå¹¶æŠŠè‡ªå·±å¯¹æ¶ˆæ¯çš„æ¶ˆè´¹é€»è¾‘å†™åœ¨consumeMessageæ–¹æ³•ä¸­ï¼Œç„¶åè¿”å›æ¶ˆè´¹çŠ¶æ€ï¼ŒConsumeConcurrentlyStatus.CONSUME_SUCCESSè¡¨ç¤ºæ¶ˆè´¹æˆåŠŸï¼Œæˆ–è€…è¡¨ç¤ºRECONSUME_LATERè¡¨ç¤ºæ¶ˆè´¹å¤±è´¥ï¼Œä¸€æ®µæ—¶é—´åå†é‡æ–°æ¶ˆè´¹ã€‚ 5.3 é›†ç¾¤æ¨¡å¼å’Œå¹¿æ’­æ¨¡å¼æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç æ¥è®¾ç½®é‡‡ç”¨é›†ç¾¤æ¨¡å¼ï¼ŒRocketMQ Push Consumeré»˜è®¤ä¸ºé›†ç¾¤æ¨¡å¼ï¼ŒåŒä¸€ä¸ªæ¶ˆè´¹ç»„å†…çš„æ¶ˆè´¹è€…åˆ†æ‹…æ¶ˆè´¹ã€‚ consumer.setMessageModel(MessageModel.CLUSTERING); é€šè¿‡ä»¥ä¸‹ä»£ç æ¥è®¾ç½®é‡‡ç”¨å¹¿æ’­æ¨¡å¼ï¼Œå¹¿æ’­æ¨¡å¼ä¸‹ï¼Œæ¶ˆè´¹ç»„å†…çš„æ¯ä¸€ä¸ªæ¶ˆè´¹è€…éƒ½ä¼šæ¶ˆè´¹å…¨é‡æ¶ˆæ¯ã€‚ consumer.setMessageModel(MessageModel.BROADCASTING); 5.4 é¡ºåºæ¶ˆè´¹ä¸Šé¢å·²ç»ä»‹ç»è®¾ç½®Push Consumerå¹¶å‘æ¶ˆè´¹çš„æ–¹æ³•ï¼Œé€šè¿‡åœ¨æ³¨å†Œæ¶ˆè´¹å›è°ƒæ¥å£æ—¶ä¼ å…¥MessageListenerConcurrentlyæ¥å£çš„å®ç°æ¥å®Œæˆã€‚åœ¨å¹¶å‘æ¶ˆè´¹ä¸­ï¼Œå¯èƒ½ä¼šæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ¶ˆè´¹ä¸€ä¸ªé˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œå› æ­¤å³ä½¿å‘é€ç«¯é€šè¿‡å‘é€é¡ºåºæ¶ˆæ¯ä¿è¯æ¶ˆæ¯åœ¨åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­æŒ‰ç…§FIFOçš„é¡ºåºï¼Œä¹Ÿæ— æ³•ä¿è¯æ¶ˆæ¯å®é™…è¢«é¡ºåºæ¶ˆè´¹ã€‚å› æ­¤RocketMQæä¾›äº†é¡ºåºæ¶ˆè´¹çš„æ–¹å¼ï¼Œ é¡ºåºæ¶ˆè´¹è®¾ç½®ä¸å¹¶å‘æ¶ˆè´¹APIå±‚é¢åªæœ‰ä¸€å¤„ä¸åŒï¼Œåœ¨æ³¨å†Œæ¶ˆè´¹å›è°ƒæ¥å£æ—¶ä¼ å…¥MessageListenerOrderlyæ¥å£çš„å®ç°ã€‚ @Test public void testPushOrderConsumer() throws MQClientException, IOException // åˆå§‹åŒ–consumerï¼Œå¹¶è®¾ç½®consumer group name DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(consumer-group); // è®¾ç½®NameServeråœ°å€ consumer.setNamesrvAddr(117.72.71.187:9876); consumer.setMessageModel(MessageModel.BROADCASTING); //è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªtopicï¼Œå¹¶æŒ‡å®štagè¿‡æ»¤æ¡ä»¶ï¼Œè¿™é‡ŒæŒ‡å®š*è¡¨ç¤ºæ¥æ”¶æ‰€æœ‰tagçš„æ¶ˆæ¯ consumer.subscribe(TestTopic, *); //æ³¨å†Œå›è°ƒæ¥å£æ¥å¤„ç†ä»Brokerä¸­æ”¶åˆ°çš„æ¶ˆæ¯ AtomicLong consumeTimes = new AtomicLong(0); consumer.registerMessageListener(new MessageListenerOrderly() @Override public ConsumeOrderlyStatus consumeMessage(ListMessageExt msgs, ConsumeOrderlyContext context) System.out.printf(%s Receive New Messages: %s %n, Thread.currentThread().getName(), msgs); consumeTimes.incrementAndGet(); if ((consumeTimes.get() % 2) == 0) return ConsumeOrderlyStatus.SUCCESS; else if ((consumeTimes.get() % 5) == 0) context.setSuspendCurrentQueueTimeMillis(3000); return ConsumeOrderlyStatus.SUSPEND_CURRENT_QUEUE_A_MOMENT; return ConsumeOrderlyStatus.SUCCESS; ); // å¯åŠ¨Consumer consumer.start(); System.out.printf(Consumer Started.%n); System.in.read(); é¡ºåºæ¶ˆè´¹ä¹Ÿæœ‰ä¸¤ç§è¿”å›ç»“æœï¼ŒConsumeOrderlyStatus.SUCCESSè¡¨ç¤ºæ¶ˆè´¹æˆåŠŸï¼ŒConsumeOrderlyStatus.SUSPEND_CURRENT_QUEUE_A_MOMENTè¡¨ç¤ºæ¶ˆè´¹å¤±è´¥ã€‚ ä¿®æ”¹Topicé˜Ÿåˆ—æ•°ä¸º1 @Test public void testAsyncMessage() throws MQClientException, MQBrokerException, RemotingException, InterruptedException // åˆå§‹åŒ–ä¸€ä¸ªproducerå¹¶è®¾ç½®Producer group name DefaultMQProducer producer = new DefaultMQProducer(TestProducerGroup); // è®¾ç½®NameServeråœ°å€ producer.setNamesrvAddr(117.72.71.187:9876); // å¯åŠ¨producer producer.start(); producer.setRetryTimesWhenSendAsyncFailed(0); int messageCount = 10; final CountDownLatch countDownLatch = new CountDownLatch(messageCount); for (int i = 0; i messageCount; i++) try final int index = i; // åˆ›å»ºä¸€æ¡æ¶ˆæ¯ï¼Œå¹¶æŒ‡å®štopicã€tagã€bodyç­‰ä¿¡æ¯ï¼Œtagå¯ä»¥ç†è§£æˆæ ‡ç­¾ï¼Œå¯¹æ¶ˆæ¯è¿›è¡Œå†å½’ç±»ï¼ŒRocketMQå¯ä»¥åœ¨æ¶ˆè´¹ç«¯å¯¹tagè¿›è¡Œè¿‡æ»¤ Message msg = new Message(TestTopic, TagAsync, (i + ).getBytes(RemotingHelper.DEFAULT_CHARSET)); // å¼‚æ­¥å‘é€æ¶ˆæ¯, å‘é€ç»“æœé€šè¿‡callbackè¿”å›ç»™å®¢æˆ·ç«¯ producer.send(msg, new SendCallback() @Override public void onSuccess(SendResult sendResult) System.out.printf(%-10d OK %s %n, index, sendResult.getMsgId()); countDownLatch.countDown(); @Override public void onException(Throwable e) System.out.printf(%-10d Exception %s %n, index, e); e.printStackTrace(); countDownLatch.countDown(); ); catch (Exception e) e.printStackTrace(); countDownLatch.countDown(); // å¼‚æ­¥å‘é€ï¼Œå¦‚æœè¦æ±‚å¯é ä¼ è¾“ï¼Œå¿…é¡»è¦ç­‰å›è°ƒæ¥å£è¿”å›æ˜ç¡®ç»“æœåæ‰èƒ½ç»“æŸé€»è¾‘ï¼Œå¦åˆ™ç«‹å³å…³é—­Producerå¯èƒ½å¯¼è‡´éƒ¨åˆ†æ¶ˆæ¯å°šæœªä¼ è¾“æˆåŠŸ countDownLatch.await(5, TimeUnit.SECONDS); // ä¸€æ—¦producerä¸å†ä½¿ç”¨ï¼Œå…³é—­producer producer.shutdown(); å‘é€10æ¡æ¶ˆæ¯ï¼Œå¹¶å‘æ¶ˆè´¹ å¯ä»¥çœ‹åˆ°æ¶ˆæ¯æ¶ˆè´¹æ—¶æ¶ˆæ¯é¡ºåºå’Œå‘é€é¡ºåºä¸ä¸€è‡´ã€‚ é¡ºåºæ¶ˆè´¹ å¯ä»¥çœ‹åˆ°æ¶ˆæ¯æ¶ˆè´¹æ—¶æ¶ˆæ¯é¡ºåºå’Œå‘é€é¡ºåºä¸€è‡´ã€‚ 5.5 æ¶ˆæ¯è¿‡æ»¤æ¶ˆæ¯è¿‡æ»¤æ˜¯æŒ‡æ¶ˆæ¯ç”Ÿäº§è€…å‘Topicä¸­å‘é€æ¶ˆæ¯æ—¶ï¼Œè®¾ç½®æ¶ˆæ¯å±æ€§å¯¹æ¶ˆæ¯è¿›è¡Œåˆ†ç±»ï¼Œæ¶ˆè´¹è€…è®¢é˜…Topicæ—¶ï¼Œæ ¹æ®æ¶ˆæ¯å±æ€§è®¾ç½®è¿‡æ»¤æ¡ä»¶å¯¹æ¶ˆæ¯è¿›è¡Œè¿‡æ»¤ï¼Œåªæœ‰ç¬¦åˆè¿‡æ»¤æ¡ä»¶çš„æ¶ˆæ¯æ‰ä¼šè¢«æŠ•é€’åˆ°æ¶ˆè´¹ç«¯è¿›è¡Œæ¶ˆè´¹ã€‚ æ¶ˆè´¹è€…è®¢é˜…Topicæ—¶è‹¥æœªè®¾ç½®è¿‡æ»¤æ¡ä»¶ï¼Œæ— è®ºæ¶ˆæ¯å‘é€æ—¶æ˜¯å¦æœ‰è®¾ç½®è¿‡æ»¤å±æ€§ï¼ŒTopicä¸­çš„æ‰€æœ‰æ¶ˆæ¯éƒ½å°†è¢«æŠ•é€’åˆ°æ¶ˆè´¹ç«¯è¿›è¡Œæ¶ˆè´¹ã€‚ RocketMQæ”¯æŒçš„æ¶ˆæ¯è¿‡æ»¤æ–¹å¼æœ‰ä¸¤ç§ï¼ŒTagè¿‡æ»¤å’ŒSQL92è¿‡æ»¤ã€‚ è¿‡æ»¤æ–¹å¼ è¯´æ˜ åœºæ™¯ Tagè¿‡æ»¤ æ¶ˆè´¹è€…è®¢é˜…çš„Tagå’Œå‘é€è€…è®¾ç½®çš„æ¶ˆæ¯Tagç›¸äº’åŒ¹é…ï¼Œåˆ™æ¶ˆæ¯è¢«æŠ•é€’ç»™æ¶ˆè´¹ç«¯è¿›è¡Œæ¶ˆè´¹ã€‚ ç®€å•è¿‡æ»¤åœºæ™¯ã€‚ä¸€æ¡æ¶ˆæ¯æ”¯æŒè®¾ç½®ä¸€ä¸ªTagï¼Œä»…éœ€è¦å¯¹Topicä¸­çš„æ¶ˆæ¯è¿›è¡Œä¸€çº§åˆ†ç±»å¹¶è¿‡æ»¤æ—¶å¯ä»¥ä½¿ç”¨æ­¤æ–¹å¼ã€‚ SQL92è¿‡æ»¤ å‘é€è€…è®¾ç½®Tagæˆ–æ¶ˆæ¯å±æ€§ï¼Œæ¶ˆè´¹è€…è®¢é˜…æ»¡è¶³SQL92è¿‡æ»¤è¡¨è¾¾å¼çš„æ¶ˆæ¯è¢«æŠ•é€’ç»™æ¶ˆè´¹ç«¯è¿›è¡Œæ¶ˆè´¹ã€‚ å¤æ‚è¿‡æ»¤åœºæ™¯ã€‚ä¸€æ¡æ¶ˆæ¯æ”¯æŒè®¾ç½®å¤šä¸ªå±æ€§ï¼Œå¯æ ¹æ®SQLè¯­æ³•è‡ªå®šä¹‰ç»„åˆå¤šç§ç±»å‹çš„è¡¨è¾¾å¼å¯¹æ¶ˆæ¯è¿›è¡Œå¤šçº§åˆ†ç±»å¹¶å®ç°å¤šç»´åº¦çš„è¿‡æ»¤ã€‚ Tagè¿‡æ»¤ Tagåœ¨ç”Ÿäº§è€…ç« èŠ‚å·²ç»ä»‹ç»è¿‡ï¼Œç”¨äºå¯¹æŸä¸ªTopicä¸‹çš„æ¶ˆæ¯è¿›è¡Œåˆ†ç±»ã€‚ç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼ŒæŒ‡å®šæ¶ˆæ¯çš„Tagï¼Œæ¶ˆè´¹è€…éœ€æ ¹æ®å·²ç»æŒ‡å®šçš„Tagæ¥è¿›è¡Œè®¢é˜…ã€‚ ä»¥ä¸‹å›¾ç”µå•†äº¤æ˜“åœºæ™¯ä¸ºä¾‹ï¼Œä»å®¢æˆ·ä¸‹å•åˆ°æ”¶åˆ°å•†å“è¿™ä¸€è¿‡ç¨‹ä¼šç”Ÿäº§ä¸€ç³»åˆ—æ¶ˆæ¯ï¼Œä»¥å¦‚ä¸‹æ¶ˆæ¯ä¸ºä¾‹ï¼š è®¢å•æ¶ˆæ¯ æ”¯ä»˜æ¶ˆæ¯ ç‰©æµæ¶ˆæ¯ è¿™äº›æ¶ˆæ¯ä¼šå‘é€åˆ°åç§°ä¸ºTrade_Topicçš„Topicä¸­ï¼Œè¢«å„ä¸ªä¸åŒçš„ç³»ç»Ÿæ‰€è®¢é˜…ï¼Œä»¥å¦‚ä¸‹ç³»ç»Ÿä¸ºä¾‹ï¼š æ”¯ä»˜ç³»ç»Ÿï¼šåªéœ€è®¢é˜…æ”¯ä»˜æ¶ˆæ¯ã€‚ ç‰©æµç³»ç»Ÿï¼šåªéœ€è®¢é˜…ç‰©æµæ¶ˆæ¯ã€‚ å®æ—¶è®¡ç®—ç³»ç»Ÿï¼šéœ€è¦è®¢é˜…æ‰€æœ‰å’Œäº¤æ˜“ç›¸å…³çš„æ¶ˆæ¯ã€‚ äº¤æ˜“æˆåŠŸç‡åˆ†æç³»ç»Ÿï¼šéœ€è®¢é˜…è®¢å•å’Œæ”¯ä»˜æ¶ˆæ¯ã€‚ è¿‡æ»¤ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤º å¯¹äºç‰©æµç³»ç»Ÿå’Œæ”¯ä»˜ç³»ç»Ÿæ¥è¯´ï¼Œå®ƒä»¬éƒ½åªè®¢é˜…å•ä¸ªTagï¼Œæ­¤æ—¶åªéœ€è¦åœ¨è°ƒç”¨subcribeæ¥å£æ—¶æ˜ç¡®æ ‡æ˜Tagå³å¯ã€‚ consumer.subscribe(TagFilterTest, TagA); å¯¹äºå®æ—¶è®¡ç®—ç³»ç»Ÿæ¥è¯´ï¼Œå®ƒè®¢é˜…äº¤æ˜“Topicä¸‹æ‰€æœ‰çš„æ¶ˆæ¯ï¼ŒTagç”¨æ˜Ÿå·ï¼ˆ*ï¼‰è¡¨ç¤ºå³å¯ã€‚ consumer.subscribe(TagFilterTest, *); å¯¹äºäº¤æ˜“æˆåŠŸç‡åˆ†æç³»ç»Ÿæ¥è¯´ï¼Œå®ƒè®¢é˜…äº†è®¢å•å’Œæ”¯ä»˜ä¸¤ä¸ªTagçš„æ¶ˆæ¯ï¼Œåœ¨å¤šä¸ªTagä¹‹é—´ç”¨ä¸¤ä¸ªç«–çº¿ï¼ˆ||ï¼‰åˆ†éš”å³å¯ã€‚ consumer.subscribe(TagFilterTest, TagA||TagB); è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœåŒä¸€ä¸ªæ¶ˆè´¹è€…å¤šæ¬¡è®¢é˜…æŸä¸ªTopicä¸‹çš„Tagï¼Œä»¥æœ€åä¸€æ¬¡è®¢é˜…ä¸ºå‡†ã€‚ //å¦‚ä¸‹é”™è¯¯ä»£ç ä¸­ï¼ŒConsumeråªèƒ½è®¢é˜…åˆ°TagFilterTestä¸‹TagBçš„æ¶ˆæ¯ï¼Œè€Œä¸èƒ½è®¢é˜…TagAçš„æ¶ˆæ¯ã€‚consumer.subscribe(TagFilterTest, TagA);consumer.subscribe(TagFilterTest, TagB); SQL92è¿‡æ»¤ SQL92è¿‡æ»¤æ˜¯åœ¨æ¶ˆæ¯å‘é€æ—¶è®¾ç½®æ¶ˆæ¯çš„Tagæˆ–è‡ªå®šä¹‰å±æ€§ï¼Œæ¶ˆè´¹è€…è®¢é˜…æ—¶ä½¿ç”¨SQLè¯­æ³•è®¾ç½®è¿‡æ»¤è¡¨è¾¾å¼ï¼Œæ ¹æ®è‡ªå®šä¹‰å±æ€§æˆ–Tagè¿‡æ»¤æ¶ˆæ¯ã€‚ Tagå±äºä¸€ç§ç‰¹æ®Šçš„æ¶ˆæ¯å±æ€§ï¼Œåœ¨SQLè¯­æ³•ä¸­ï¼ŒTagçš„å±æ€§å€¼ä¸ºTAGSã€‚ å¼€å¯å±æ€§è¿‡æ»¤é¦–å…ˆè¦åœ¨Brokerç«¯è®¾ç½®é…ç½®enablePropertyFiltertrueï¼Œè¯¥å€¼é»˜è®¤ä¸ºfalseã€‚ ä»¥ä¸‹å›¾ç”µå•†äº¤æ˜“åœºæ™¯ä¸ºä¾‹ï¼Œä»å®¢æˆ·ä¸‹å•åˆ°æ”¶åˆ°å•†å“è¿™ä¸€è¿‡ç¨‹ä¼šç”Ÿäº§ä¸€ç³»åˆ—æ¶ˆæ¯ï¼ŒæŒ‰ç…§ç±»å‹å°†æ¶ˆæ¯åˆ†ä¸ºè®¢å•æ¶ˆæ¯å’Œç‰©æµæ¶ˆæ¯ï¼Œå…¶ä¸­ç»™ç‰©æµæ¶ˆæ¯å®šä¹‰åœ°åŸŸå±æ€§ï¼ŒæŒ‰ç…§åœ°åŸŸåˆ†ä¸ºæ­å·å’Œä¸Šæµ·ï¼š è®¢å•æ¶ˆæ¯ ç‰©æµæ¶ˆæ¯ ç‰©æµæ¶ˆæ¯ä¸”åœ°åŸŸä¸ºæ­å· ç‰©æµæ¶ˆæ¯ä¸”åœ°åŸŸä¸ºä¸Šæµ· è¿™äº›æ¶ˆæ¯ä¼šå‘é€åˆ°åç§°ä¸ºTrade_Topicçš„Topicä¸­ï¼Œè¢«å„ä¸ªä¸åŒçš„ç³»ç»Ÿæ‰€è®¢é˜…ï¼Œä»¥å¦‚ä¸‹ç³»ç»Ÿä¸ºä¾‹ï¼š ç‰©æµç³»ç»Ÿ1ï¼šåªéœ€è®¢é˜…ç‰©æµæ¶ˆæ¯ä¸”æ¶ˆæ¯åœ°åŸŸä¸ºæ­å·ã€‚ ç‰©æµç³»ç»Ÿ2ï¼šåªéœ€è®¢é˜…ç‰©æµæ¶ˆæ¯ä¸”æ¶ˆæ¯åœ°åŸŸä¸ºæ­å·æˆ–ä¸Šæµ·ã€‚ è®¢å•è·Ÿè¸ªç³»ç»Ÿï¼šåªéœ€è®¢é˜…è®¢å•æ¶ˆæ¯ã€‚ SQL92è¿‡æ»¤ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š åœ°åŸŸå°†ä½œä¸ºè‡ªå®šä¹‰å±æ€§è®¾ç½®åœ¨æ¶ˆæ¯ä¸­ã€‚ æ¶ˆæ¯å‘é€ç«¯ï¼š è®¾ç½®æ¶ˆæ¯çš„è‡ªå®šä¹‰å±æ€§ã€‚ Message msg = new Message(topic, tagA, Hello MQ.getBytes());// è®¾ç½®è‡ªå®šä¹‰å±æ€§Aï¼Œå±æ€§å€¼ä¸º1ã€‚msg.putUserProperties(a, 1); æ¶ˆæ¯æ¶ˆè´¹ç«¯ï¼š ä½¿ç”¨SQLè¯­æ³•è®¾ç½®è¿‡æ»¤è¡¨è¾¾å¼ï¼Œå¹¶æ ¹æ®è‡ªå®šä¹‰å±æ€§è¿‡æ»¤æ¶ˆæ¯ã€‚ consumer.subscribe(SqlFilterTest, MessageSelector.bySql((TAGS is not null and TAGS in (TagA, TagB)) + and (a is not null and a between 0 and 3))); 5.6 æ¶ˆæ¯é‡è¯•å’Œæ­»ä¿¡é˜Ÿåˆ—æ¶ˆæ¯é‡è¯• è‹¥Consumeræ¶ˆè´¹æŸæ¡æ¶ˆæ¯å¤±è´¥ï¼Œåˆ™RocketMQä¼šåœ¨é‡è¯•é—´éš”æ—¶é—´åï¼Œå°†æ¶ˆæ¯é‡æ–°æŠ•é€’ç»™Consumeræ¶ˆè´¹ï¼Œè‹¥è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°åæ¶ˆæ¯è¿˜æ²¡æœ‰æˆåŠŸè¢«æ¶ˆè´¹ï¼Œåˆ™æ¶ˆæ¯å°†è¢«æŠ•é€’è‡³æ­»ä¿¡é˜Ÿåˆ—ã€‚ æ¶ˆæ¯é‡è¯•åªé’ˆå¯¹é›†ç¾¤æ¶ˆè´¹æ¨¡å¼ç”Ÿæ•ˆï¼›å¹¿æ’­æ¶ˆè´¹æ¨¡å¼ä¸æä¾›å¤±è´¥é‡è¯•ç‰¹æ€§ï¼Œå³æ¶ˆè´¹å¤±è´¥åï¼Œå¤±è´¥æ¶ˆæ¯ä¸å†é‡è¯•ï¼Œç»§ç»­æ¶ˆè´¹æ–°çš„æ¶ˆæ¯ æœ€å¤§é‡è¯•æ¬¡æ•°ï¼šæ¶ˆæ¯æ¶ˆè´¹å¤±è´¥åï¼Œå¯è¢«é‡å¤æŠ•é€’çš„æœ€å¤§æ¬¡æ•°ã€‚ consumer.setMaxReconsumeTimes(10); é‡è¯•é—´éš”ï¼šæ¶ˆæ¯æ¶ˆè´¹å¤±è´¥åå†æ¬¡è¢«æŠ•é€’ç»™Consumeræ¶ˆè´¹çš„é—´éš”æ—¶é—´ï¼Œåªåœ¨é¡ºåºæ¶ˆè´¹ä¸­èµ·ä½œç”¨ã€‚ consumer.setSuspendCurrentQueueTimeMillis(5000); é¡ºåºæ¶ˆè´¹å’Œå¹¶å‘æ¶ˆè´¹çš„é‡è¯•æœºåˆ¶å¹¶ä¸ç›¸åŒï¼Œé¡ºåºæ¶ˆè´¹æ¶ˆè´¹å¤±è´¥åä¼šå…ˆåœ¨å®¢æˆ·ç«¯æœ¬åœ°é‡è¯•ç›´åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œè¿™æ ·å¯ä»¥é¿å…æ¶ˆè´¹å¤±è´¥çš„æ¶ˆæ¯è¢«è·³è¿‡ï¼Œæ¶ˆè´¹ä¸‹ä¸€æ¡æ¶ˆæ¯è€Œæ‰“ä¹±é¡ºåºæ¶ˆè´¹çš„é¡ºåºï¼Œè€Œå¹¶å‘æ¶ˆè´¹æ¶ˆè´¹å¤±è´¥åä¼šå°†æ¶ˆè´¹å¤±è´¥çš„æ¶ˆæ¯é‡æ–°æŠ•é€’å›æœåŠ¡ç«¯ï¼Œå†ç­‰å¾…æœåŠ¡ç«¯é‡æ–°æŠ•é€’å›æ¥ï¼Œåœ¨è¿™æœŸé—´ä¼šæ­£å¸¸æ¶ˆè´¹é˜Ÿåˆ—åé¢çš„æ¶ˆæ¯ã€‚ å¹¶å‘æ¶ˆè´¹å¤±è´¥åå¹¶ä¸æ˜¯æŠ•é€’å›åŸTopicï¼Œè€Œæ˜¯æŠ•é€’åˆ°ä¸€ä¸ªç‰¹æ®ŠTopicï¼Œå…¶å‘½åä¸º%RETRY%ConsumerGroupNameï¼Œé›†ç¾¤æ¨¡å¼ä¸‹å¹¶å‘æ¶ˆè´¹æ¯ä¸€ä¸ªConsumerGroupä¼šå¯¹åº”ä¸€ä¸ªç‰¹æ®ŠTopicï¼Œå¹¶ä¼šè®¢é˜…è¯¥Topicã€‚ @Test public void testRetryQueueConsumer() throws MQClientException, IOException // åˆå§‹åŒ–consumerï¼Œå¹¶è®¾ç½®consumer group name DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(consumer-group); // è®¾ç½®NameServeråœ°å€ consumer.setNamesrvAddr(117.72.71.187:9876); // è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªtopicï¼Œå¹¶æŒ‡å®štagè¿‡æ»¤æ¡ä»¶ï¼Œè¿™é‡ŒæŒ‡å®š*è¡¨ç¤ºæ¥æ”¶æ‰€æœ‰tagçš„æ¶ˆæ¯ consumer.subscribe(TestTopic, *); // è®¾ç½®æœ€å¤§é‡è¯•æ¬¡æ•° consumer.setMaxReconsumeTimes(1); // æ³¨å†Œå›è°ƒæ¥å£æ¥å¤„ç†ä»Brokerä¸­æ”¶åˆ°çš„æ¶ˆæ¯ consumer.registerMessageListener(new MessageListenerConcurrently() @Override public ConsumeConcurrentlyStatus consumeMessage(ListMessageExt msgs, ConsumeConcurrentlyContext context) System.out.printf(%s Receive New Messages: %s %n, Thread.currentThread().getName(), msgs); return ConsumeConcurrentlyStatus.RECONSUME_LATER; ); // å¯åŠ¨Consumer consumer.start(); System.out.printf(Consumer Started.%n); System.in.read(); å¯ä»¥çœ‹åˆ°æ¶ˆè´¹å¤±è´¥æ—¶ï¼Œä¼šå°†æ¶ˆæ¯ä¼ é€’åˆ°ã€%RETRY%ConsumerGroupNameã€‘Topicä¸­ ä¸¤è€…å‚æ•°å·®åˆ«å¦‚ä¸‹: æ¶ˆè´¹ç±»å‹ é‡è¯•é—´éš” æœ€å¤§é‡è¯•æ¬¡æ•° é¡ºåºæ¶ˆè´¹ é—´éš”æ—¶é—´å¯é€šè¿‡è‡ªå®šä¹‰è®¾ç½®ï¼ŒSuspendCurrentQueueTimeMillis æœ€å¤§é‡è¯•æ¬¡æ•°å¯é€šè¿‡è‡ªå®šä¹‰å‚æ•°MaxReconsumeTimeså–å€¼è¿›è¡Œé…ç½®ã€‚è¯¥å‚æ•°å–å€¼æ— æœ€å¤§é™åˆ¶ã€‚è‹¥æœªè®¾ç½®å‚æ•°å€¼ï¼Œé»˜è®¤æœ€å¤§é‡è¯•æ¬¡æ•°ä¸ºInteger.MAX å¹¶å‘æ¶ˆè´¹ é—´éš”æ—¶é—´æ ¹æ®é‡è¯•æ¬¡æ•°é˜¶æ¢¯å˜åŒ–ï¼Œå–å€¼èŒƒå›´ï¼š1ç§’ï½2å°æ—¶ã€‚ä¸æ”¯æŒè‡ªå®šä¹‰é…ç½® æœ€å¤§é‡è¯•æ¬¡æ•°å¯é€šè¿‡è‡ªå®šä¹‰å‚æ•°MaxReconsumeTimeså–å€¼è¿›è¡Œé…ç½®ã€‚é»˜è®¤å€¼ä¸º16æ¬¡ï¼Œè¯¥å‚æ•°å–å€¼æ— æœ€å¤§é™åˆ¶ï¼Œå»ºè®®ä½¿ç”¨é»˜è®¤å€¼ å¹¶å‘æ¶ˆè´¹é‡è¯•é—´éš”å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°ä¸å»¶è¿Ÿæ¶ˆæ¯ç¬¬ä¸‰ä¸ªç­‰çº§å¼€å§‹çš„æ—¶é—´å®Œå…¨ä¸€è‡´ã€‚ ç¬¬å‡ æ¬¡é‡è¯• ä¸ä¸Šæ¬¡é‡è¯•çš„é—´éš”æ—¶é—´ ç¬¬å‡ æ¬¡é‡è¯• ä¸ä¸Šæ¬¡é‡è¯•çš„é—´éš”æ—¶é—´ 1 10s 9 7min 2 30s 10 8min 3 1min 11 9min 4 2min 12 10min 5 3min 13 20min 6 4min 14 30min 7 5min 15 1h 8 6min 16 2h æ­»ä¿¡é˜Ÿåˆ— å½“ä¸€æ¡æ¶ˆæ¯åˆæ¬¡æ¶ˆè´¹å¤±è´¥ï¼ŒRocketMQä¼šè‡ªåŠ¨è¿›è¡Œæ¶ˆæ¯é‡è¯•ï¼Œè¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°åï¼Œè‹¥æ¶ˆè´¹ä¾ç„¶å¤±è´¥ï¼Œåˆ™è¡¨æ˜æ¶ˆè´¹è€…åœ¨æ­£å¸¸æƒ…å†µä¸‹æ— æ³•æ­£ç¡®åœ°æ¶ˆè´¹è¯¥æ¶ˆæ¯ã€‚æ­¤æ—¶ï¼Œè¯¥æ¶ˆæ¯ä¸ä¼šç«‹åˆ»è¢«ä¸¢å¼ƒï¼Œè€Œæ˜¯å°†å…¶å‘é€åˆ°è¯¥æ¶ˆè´¹è€…å¯¹åº”çš„ç‰¹æ®Šé˜Ÿåˆ—ä¸­ï¼Œè¿™ç±»æ¶ˆæ¯ç§°ä¸ºæ­»ä¿¡æ¶ˆæ¯ï¼ˆDead-Letter Messageï¼‰ï¼Œå­˜å‚¨æ­»ä¿¡æ¶ˆæ¯çš„ç‰¹æ®Šé˜Ÿåˆ—ç§°ä¸ºæ­»ä¿¡é˜Ÿåˆ—ï¼ˆDead-Letter Queueï¼‰ï¼Œæ­»ä¿¡é˜Ÿåˆ—æ˜¯æ­»ä¿¡Topicä¸‹åˆ†åŒºæ•°å”¯ä¸€çš„å•ç‹¬é˜Ÿåˆ—ã€‚å¦‚æœäº§ç”Ÿäº†æ­»ä¿¡æ¶ˆæ¯ï¼Œé‚£å¯¹åº”çš„ConsumerGroupçš„æ­»ä¿¡Topicåç§°ä¸º%DLQ%ConsumerGroupNameï¼Œæ­»ä¿¡é˜Ÿåˆ—çš„æ¶ˆæ¯å°†ä¸ä¼šå†è¢«æ¶ˆè´¹ã€‚å¯ä»¥åˆ©ç”¨RocketMQ Adminå·¥å…·æˆ–è€…RocketMQ Dashboardä¸ŠæŸ¥è¯¢åˆ°å¯¹åº”æ­»ä¿¡æ¶ˆæ¯çš„ä¿¡æ¯ã€‚ @Test public void testDeadQueueConsumer() throws MQClientException, IOException // åˆå§‹åŒ–consumerï¼Œå¹¶è®¾ç½®consumer group name DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(consumer-group); // è®¾ç½®NameServeråœ°å€ consumer.setNamesrvAddr(117.72.71.187:9876); //è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªtopicï¼Œå¹¶æŒ‡å®štagè¿‡æ»¤æ¡ä»¶ï¼Œè¿™é‡ŒæŒ‡å®š*è¡¨ç¤ºæ¥æ”¶æ‰€æœ‰tagçš„æ¶ˆæ¯ consumer.subscribe(TestTopic, *); consumer.setMaxReconsumeTimes(0); //æ³¨å†Œå›è°ƒæ¥å£æ¥å¤„ç†ä»Brokerä¸­æ”¶åˆ°çš„æ¶ˆæ¯ consumer.registerMessageListener(new MessageListenerOrderly() @Override public ConsumeOrderlyStatus consumeMessage(ListMessageExt msgs, ConsumeOrderlyContext context) System.out.printf(%s Receive New Messages: %s %n, Thread.currentThread().getName(), msgs); return ConsumeOrderlyStatus.SUSPEND_CURRENT_QUEUE_A_MOMENT; ); // å¯åŠ¨Consumer consumer.start(); System.out.printf(Consumer Started.%n); System.in.read(); å¯ä»¥çœ‹åˆ°è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°åï¼Œæ¶ˆè´¹ä¾ç„¶å¤±è´¥ä¼šå°†æ¶ˆæ¯ä¼ é€’åˆ°ã€%DLQ%ConsumerGroupNameã€‘Topicä¸­ã€‚ 5.7 Pullæ¶ˆè´¹åœ¨RocketMQä¸­æœ‰ä¸¤ç§Pullæ–¹å¼ï¼Œä¸€ç§æ˜¯æ¯”è¾ƒåŸå§‹Pull Consumerï¼Œå®ƒä¸æä¾›ç›¸å…³çš„è®¢é˜…æ–¹æ³•ï¼Œéœ€è¦è°ƒç”¨pullæ–¹æ³•æ—¶æŒ‡å®šé˜Ÿåˆ—è¿›è¡Œæ‹‰å–ï¼Œå¹¶éœ€è¦è‡ªå·±æ›´æ–°ä½ç‚¹ã€‚å¦ä¸€ç§æ˜¯Lite Pull Consumerï¼Œå®ƒæä¾›äº†Subscribeå’ŒAssignä¸¤ç§æ–¹å¼ï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ã€‚","tags":[null],"categories":[null]},{"title":"Spring IOCå®¹å™¨åŠ è½½æµç¨‹åŸç†","path":"/wiki/Spring/Springå®¹å™¨åŠ è½½æµç¨‹åŸç†.html","content":"1. æ‰‹å†™Springå…ˆæ¥æ€è€ƒä¸‹å¦‚ä½•è‡ªå·±æ‰‹å†™ä¸€ä¸ªç®€å•çš„Springã€‚ æ‰«æ æˆ‘ä»¬è¦è®©Springç®¡ç†æˆ‘ä»¬çš„ç±»ï¼Œé¦–å…ˆéœ€è¦åœ¨ç±»ä¸Šæ·»åŠ æ³¨è§£å¦‚@Componentï¼ˆè¿™é‡Œé»˜è®¤å·²æ³¨è§£æ–¹å¼ä½¿ç”¨Springï¼‰ã€‚è¿™é‡Œå°±æœ‰ä¸ªé—®é¢˜äº†Springæ€ä¹ˆçŸ¥é“æ·»åŠ äº†@Componentçš„ç±»ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªé…ç½®ç±»å»é…ç½®æ‰«æè·¯å¾„ï¼ˆè¿™ä¸ªé…ç½®å¯ä»¥ä»xmlæ–‡ä»¶æ¥ï¼Œä¹Ÿå¯ä»¥æ—¶JavaConfigé…ç½®ç±»ï¼‰ã€‚ åŠ è½½ æ‰«æå¯¹åº”è·¯å¾„ä¸‹çš„æ–‡ä»¶æˆ‘ä»¬èƒ½å¤Ÿå¾—åˆ°æ‰€æœ‰çš„ç±»æ–‡ä»¶ï¼Œåªéœ€éå†æ–‡ä»¶åˆ¤æ–­æ˜¯å¦å¯¹åº”ç±»ä¸Šæœ‰æ²¡æœ‰ç›¸åº”æ³¨è§£å°±å¯ä»¥åˆ¤æ–­æ˜¯å¦éœ€è¦Springç®¡ç†ã€‚ è¿™é‡Œæˆ‘ä»¬æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Ÿ æˆ‘ä»¬æ‹¿åˆ°æ‰€æœ‰æ³¨è§£æ ‡æ³¨çš„ç±»ä¿¡æ¯åç›´æ¥å®ä¾‹åŒ–æ”¾å…¥Springå®¹å™¨ä¼šæ€ä¹ˆæ ·ï¼Ÿ å¦‚æœè¿™ä¹ˆè®¾è®¡å¯¹ä¸Beanå¯¹è±¡æˆ‘ä»¬å°±ä¸èƒ½ä½¿ç”¨å¾ˆå¤šç‰¹æ€§ä¾‹å¦‚å•ä¾‹ã€å¤šä¾‹ã€æ‡’åŠ è½½ç­‰ã€‚ æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼•å…¥ä¸ªä¸­é—´å±‚æ¥æè¿°ç±»ä¿¡æ¯ï¼ˆBeanDefinitionï¼‰ï¼ŒBeanDefinitionä¸­å¯ä»¥æè¿°ç±»ç±»å‹ã€æ˜¯å¦å•ä¾‹ã€æ˜¯å¦æ‡’åŠ è½½ç­‰ç‰¹æ€§ï¼Œè¿™æ ·èƒ½å¤Ÿæ›´åŠ çµæ´»ä½¿ç”¨ç±»ã€‚ æˆ‘ä»¬å°†æ‰€æœ‰æ‰«æåˆ°éœ€è¦Springç®¡ç†çš„ç±»å°è£…æˆBeanDefinitionï¼Œå¹¶æ”¾å…¥ä¸€ä¸ªMapString, BeanDefinition beanDefinitionMapä¸­ã€‚ å®ä¾‹åŒ– æ ¹æ®ä¸Šé¢æ­¥éª¤æˆ‘ä»¬å·²ç»æ‹¿åˆ°äº†beanDefinitionMapï¼Œéå†beanDefinitionMapæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸€ä¸ªBeanå¯¹è±¡ï¼ˆé€šè¿‡åå°„æ„é€ å‡½æ•°æ¥å®ä¾‹åŒ–åˆ›å»ºç›¸åº”ç±»å¯¹è±¡ï¼‰ã€‚å±æ€§æ³¨å…¥ åˆ›å»ºäº†å®ä¾‹å¯¹è±¡ï¼Œæ­¤æ—¶ç±»ä¸­å±æ€§ï¼ˆ@Autowireæ ‡æ³¨çš„ï¼‰è¿˜æ˜¯nulléœ€è¦å®Œæˆå±æ€§æ³¨å…¥ã€‚ç±»ä¸­çš„å±æ€§ï¼ˆ@Autowireæ ‡æ³¨çš„ï¼‰å…¶å®è¿˜æ˜¯Springç®¡ç†çš„å¯¹è±¡ï¼Œç›´æ¥å»Springå®¹å™¨ä¸­æ‹¿è¿™ä¸ªå¯¹è±¡å°±è¡Œã€‚å¦‚æœæ²¡æœ‰å°±æ ¹æ®BeanDefinitionå»åˆ›å»ºå¯¹è±¡ç„¶åæ³¨å…¥è¿›æ¥ã€‚ å›è°ƒ ä¸ºäº†æ‰©å±•ï¼Œè¿™ä¸ªé˜¶æ®µåŒ…å«äº†å„ç§å›è°ƒæ–¹æ³•ã€‚ä¾‹å¦‚å„ç§Awareå›è°ƒã€BeanPostProcessorå›è°ƒã€InitializingBeanå›è°ƒç­‰ã€‚ 2. Beanç”Ÿå‘½å‘¨æœŸ2.1 Beançš„åˆ›å»ºå¤§è‡´è¿‡ç¨‹å…ˆæ¥çœ‹ä¸‹Springçš„ç®€å•ä½¿ç”¨ @ComponentScan(org.springframework.demo)public class AppConfig @Componentpublic class UserService public class Main public static void main(String[] args) AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(AppConfig.class); System.out.println(context.getBean(userService)); æ€è€ƒä¸€ä¸‹ï¼Ÿä¸ºä»€ä¹ˆé€šè¿‡è°ƒç”¨context.getBean(userService)å°±èƒ½å¾—åˆ°UserServiceå¯¹è±¡ï¼Ÿ åœ¨åˆ›å»ºAnnotationConfigApplicationContextå®¹å™¨å¯¹è±¡æ—¶ï¼Œä¼šæ ¹æ®ä¼ å…¥çš„AppConfigç±»æ‹¿åˆ°@ComponentScanæ³¨è§£æ ‡æ³¨çš„æ‰«æè·¯å¾„ã€‚ æ ¹æ®è·¯å¾„æ‰«æè¿™ä¸ªåŒ…è·¯å¾„ä¸‹çš„æ‰€æœ‰classç±»ï¼Œå¦‚æœå‘ç°æŸä¸ªç±»ä¸Šå­˜åœ¨@Componentã€@Serviceç­‰æ³¨è§£ï¼Œé‚£ä¹ˆSpringå°±æŠŠè¿™ä¸ªç±»è®°å½•ä¸‹æ¥ï¼Œå­˜å…¥BeanDefinitionMapã€‚ Springä¼šæ ¹æ®æŸä¸ªè§„åˆ™ç”Ÿæˆå½“å‰ç±»å¯¹åº”çš„beanNameï¼Œä½œä¸ºkeyå­˜å…¥Mapï¼Œå½“å‰ç±»ä½œä¸ºvalueã€‚ é‚£Springåˆ°åº•æ˜¯å¦‚ä½•æ¥åˆ›å»ºä¸€ä¸ªBeançš„å‘¢ï¼Œè¿™ä¸ªå°±æ˜¯Beanåˆ›å»ºçš„ç”Ÿå‘½å‘¨æœŸï¼Œå¤§è‡´è¿‡ç¨‹å¦‚ä¸‹ï¼š åˆ©ç”¨è¯¥ç±»çš„æ„é€ æ–¹æ³•æ¥å®ä¾‹åŒ–å¾—åˆ°ä¸€ä¸ªå¯¹è±¡ï¼ˆä½†æ˜¯å¦‚ä½•ä¸€ä¸ªç±»ä¸­æœ‰å¤šä¸ªæ„é€ æ–¹æ³•ï¼ŒSpringåˆ™ä¼šè¿›è¡Œé€‰æ‹©ï¼Œè¿™ä¸ªå«åšæ¨æ–­æ„é€ æ–¹æ³•ï¼‰ å¾—åˆ°ä¸€ä¸ªå¯¹è±¡åï¼ŒSpringä¼šåˆ¤æ–­è¯¥å¯¹è±¡ä¸­æ˜¯å¦å­˜åœ¨è¢«@Autowiredæ³¨è§£äº†çš„å±æ€§ï¼ŒæŠŠè¿™äº›å±æ€§æ‰¾å‡ºæ¥å¹¶ç”±Springè¿›è¡Œèµ‹å€¼ï¼ˆä¾èµ–æ³¨å…¥ï¼‰ ä¾èµ–æ³¨å…¥åï¼ŒSpringä¼šåˆ¤æ–­è¯¥å¯¹è±¡æ˜¯å¦å®ç°äº†BeanNameAwareæ¥å£ã€BeanClassLoaderAwareæ¥å£ã€BeanFactoryAwareæ¥å£ï¼Œå¦‚æœå®ç°äº†ï¼Œå°±è¡¨ç¤ºå½“å‰å¯¹è±¡å¿…é¡»å®ç°è¯¥æ¥å£ä¸­æ‰€å®šä¹‰çš„setBeanName()ã€setBeanClassLoader()ã€setBeanFactory()æ–¹æ³•ï¼Œé‚£Springå°±ä¼šè°ƒç”¨è¿™äº›æ–¹æ³•å¹¶ä¼ å…¥ç›¸åº”çš„å‚æ•°ï¼ˆAwareå›è°ƒï¼‰ Awareå›è°ƒåï¼ŒSpringä¼šåˆ¤æ–­è¯¥å¯¹è±¡ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªæ–¹æ³•è¢«@PostConstructæ³¨è§£äº†ï¼Œå¦‚æœå­˜åœ¨ï¼ŒSpringä¼šè°ƒç”¨å½“å‰å¯¹è±¡çš„æ­¤æ–¹æ³•ï¼ˆåˆå§‹åŒ–å‰ï¼‰ ç´§æ¥ç€ï¼ŒSpringä¼šåˆ¤æ–­è¯¥å¯¹è±¡æ˜¯å¦å®ç°äº†InitializingBeanæ¥å£ï¼Œå¦‚æœå®ç°äº†ï¼Œå°±è¡¨ç¤ºå½“å‰å¯¹è±¡å¿…é¡»å®ç°è¯¥æ¥å£ä¸­çš„afterPropertiesSet()æ–¹æ³•ï¼Œé‚£Springå°±ä¼šè°ƒç”¨å½“å‰å¯¹è±¡ä¸­çš„afterPropertiesSet()æ–¹æ³•ï¼ˆåˆå§‹åŒ–ï¼‰ æœ€åï¼ŒSpringä¼šåˆ¤æ–­å½“å‰å¯¹è±¡éœ€ä¸éœ€è¦è¿›è¡ŒAOPï¼Œå¦‚æœä¸éœ€è¦é‚£ä¹ˆBeanå°±åˆ›å»ºå®Œäº†ï¼Œå¦‚æœéœ€è¦è¿›è¡ŒAOPï¼Œåˆ™ä¼šè¿›è¡ŒåŠ¨æ€ä»£ç†å¹¶ç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡åšä¸ºBeanï¼ˆåˆå§‹åŒ–åï¼‰ 2.2 ç”ŸæˆBeanDefinitionè¿™é‡Œæˆ‘ä»¬æ ¹æ®æºç æ¥è¯¦ç»†äº†è§£ä¸Šè¿°Beanåˆ›å»ºçš„æ­¥éª¤ï¼š ç¬¬ä¸€æ­¥æ ¹æ®è·¯å¾„æ‰«æç”ŸæˆbeanDefinitionå¹¶æ”¾å…¥beanDefinitionMap ClassPathBeanDefinitionScanner.doScan protected SetBeanDefinitionHolder doScan(String... basePackages) Assert.notEmpty(basePackages, At least one base package must be specified); // å®šä¹‰ä¸€ä¸ªSetå­˜æ”¾BeanDefinitionHolderï¼Œè¿™ä¸ªç±»é‡Œé¢å­˜æ”¾ beanDefinitionã€beanName; SetBeanDefinitionHolder beanDefinitions = new LinkedHashSet(); for (String basePackage : basePackages) // æ‰«æbasePackageä¸‹çš„ç±»æ–‡ä»¶å°†ç¬¦åˆæ¡ä»¶çš„ç±»å°è£…æˆBeanDefinition SetBeanDefinition candidates = findCandidateComponents(basePackage); for (BeanDefinition candidate : candidates) // å¤„ç†@Scopeæ³¨è§£ ScopeMetadata scopeMetadata = this.scopeMetadataResolver.resolveScopeMetadata(candidate); candidate.setScope(scopeMetadata.getScopeName()); String beanName = this.beanNameGenerator.generateBeanName(candidate, this.registry); if (candidate instanceof AbstractBeanDefinition abstractBeanDefinition) postProcessBeanDefinition(abstractBeanDefinition, beanName); if (candidate instanceof AnnotatedBeanDefinition annotatedBeanDefinition) // å¤„ç†é€šç”¨æ³¨è§£@Lazyã€@Primaryã€@DependsOnã€@Role AnnotationConfigUtils.processCommonDefinitionAnnotations(annotatedBeanDefinition); // æ£€æŸ¥BeanDefinitionæ˜¯å¦é‡å¤ï¼Œä¸é‡å¤ç›´æ¥è¿”å›true if (checkCandidate(beanName, candidate)) BeanDefinitionHolder definitionHolder = new BeanDefinitionHolder(candidate, beanName); definitionHolder = AnnotationConfigUtils.applyScopedProxyMode(scopeMetadata, definitionHolder, this.registry); beanDefinitions.add(definitionHolder); // this.beanDefinitionMap.put(beanName, beanDefinition); // å°†beanDefinitionæ”¾å…¥beanDefinitionMap registerBeanDefinition(definitionHolder, this.registry); return beanDefinitions; private SetBeanDefinition scanCandidateComponents(String basePackage) SetBeanDefinition candidates = new LinkedHashSet(); try // è·å–åŒ…è·¯å¾„ä¸‹.classæ–‡ä»¶ä¿¡æ¯ String packageSearchPath = ResourcePatternResolver.CLASSPATH_ALL_URL_PREFIX + resolveBasePackage(basePackage) + / + this.resourcePattern; Resource[] resources = getResourcePatternResolver().getResources(packageSearchPath); boolean traceEnabled = logger.isTraceEnabled(); boolean debugEnabled = logger.isDebugEnabled(); for (Resource resource : resources) String filename = resource.getFilename(); if (filename != null filename.contains(ClassUtils.CGLIB_CLASS_SEPARATOR)) // Ignore CGLIB-generated classes in the classpath continue; if (traceEnabled) logger.trace(Scanning + resource); try // è¯»å–ç±»å…ƒæ•°æ®ä¿¡æ¯ï¼šä¾‹å¦‚ç±»åã€æ³¨è§£ã€æ¥å£ç­‰ MetadataReader metadataReader = getMetadataReaderFactory().getMetadataReader(resource); if (isCandidateComponent(metadataReader)) ScannedGenericBeanDefinition sbd = new ScannedGenericBeanDefinition(metadataReader); sbd.setSource(resource); // åˆ¤æ–­æ˜¯å¦æ¥å£ã€æŠ½è±¡ç±»ã€å†…éƒ¨ç±»å’Œå¤„ç†@Lookupæ³¨è§£ if (isCandidateComponent(sbd)) if (debugEnabled) logger.debug(Identified candidate component class: + resource); // å°†BeanDefinitionæ”¾å…¥é›†åˆ candidates.add(sbd); ... else if (traceEnabled) logger.trace(Ignored because not matching any filter: + resource); ... catch (IOException ex) throw new BeanDefinitionStoreException(I/O failure during classpath scanning, ex); return candidates; æ€»ç»“ï¼š é€šè¿‡ResourcePatternResolverè·å¾—æŒ‡å®šåŒ…è·¯å¾„ä¸‹çš„æ‰€æœ‰.classæ–‡ä»¶ï¼ˆSpringæºç ä¸­å°†ç±»æ–‡ä»¶åŒ…è£…æˆäº†Resourceå¯¹è±¡ï¼‰ è¯»å–ç±»å…ƒæ•°æ®ä¿¡æ¯ï¼šä¾‹å¦‚ç±»åã€æ³¨è§£ã€æ¥å£ç­‰ï¼Œè®¾ç½®sourceå±æ€§ æ ¹æ®è¯»å–åˆ°çš„å…ƒæ•°æ®ä¿¡æ¯æ ¹æ®excludeFilterså’ŒincludeFiltersè¿›è¡Œè¿‡æ»¤åŠæ¡ä»¶æ³¨è§£@Conditionalçš„ç­›é€‰ å¤„ç†é€šç”¨æ³¨è§£@Lazyã€@Primaryã€@DependsOnã€@Role æ£€æŸ¥BeanDefinitionæ˜¯å¦é‡å¤ å°†beanDefinitionæ”¾å…¥beanDefinitionMap 2.3 åˆå¹¶BeanDefinitionåœ¨2.1ä¸­æ‹¿åˆ°æ‰€æœ‰BeanDefinitionä¹‹åï¼Œå°±å¯ä»¥æ ¹æ®BeanDefinitionåˆ›å»ºBeanå¯¹è±¡äº†ã€‚åœ¨Springä¸­æ”¯æŒçˆ¶å­BeanDefinitionï¼ŒåŠæœ‰ä¸‹åˆ—è¿™ç§æƒ…å†µã€‚ bean id=userServiceParent scope=prototype /beanbean id=userService parent=userServiceParent/bean userServiceParentå¯¹è±¡æ˜¯userServiceçš„çˆ¶ç±»ï¼Œè¿™ä¸ªæ—¶å€™å­ç±»æ˜¯éœ€è¦ç»§æ‰¿çˆ¶ç±»ä¸­çš„å±æ€§æ‰€ä»¥ä¸èƒ½ç›´æ¥æ‹¿userServiceçš„BeanDefinitionå»è¿›è¡Œå®ä¾‹åŒ–å¯¹è±¡ï¼Œéœ€è¦å°†userServiceçš„BeanDefinitionå’ŒuserServiceParentçš„BeanDefinitionåˆå¹¶åæ ¹æ®åˆå¹¶åçš„BeanDefinitionå†å»è¿›è¡Œå®ä¾‹åŒ–ã€‚ DefaultListableBeanFactory.preInstantiateSingletons() public void preInstantiateSingletons() throws BeansException ... for (String beanName : beanNames) // è·å–åˆå¹¶åçš„BeanDefinition // å¤„ç†è¿™ç§æƒ…å†µï¼š // bean id=userServiceParent scope=prototype /bean // bean id=userService parent=userServiceParent/bean // åˆ›å»ºå­ç±»Beanæ—¶éœ€è¦å°†çˆ¶BeanDefinitionä¸­çš„å±æ€§åˆå¹¶åˆ°å­BeanDefinitionä¸­ï¼Œç”ŸæˆRootBeanDefinition RootBeanDefinition bd = getMergedLocalBeanDefinition(beanName); ... ... 2.4 åŠ è½½ç±»æ ¹æ®åˆå¹¶åçš„RootBeanDefinitionå°±å¯ä»¥åˆ›å»ºBeanå¯¹è±¡äº†ï¼Œåœ¨å®ä¾‹åŒ–å¯¹è±¡å‰éœ€è¦åŠ è½½ç±»ä¿¡æ¯ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½¿ç”¨ç±»åŠ è½½å™¨åŠ è½½ç±»ã€‚ AbstractAutowireCapableBeanFactory.createBean()// åŠ è½½ç±»ä¿¡æ¯Class? resolvedClass = resolveBeanClass(mbd, beanName); @Nullableprotected Class? resolveBeanClass(RootBeanDefinition mbd, String beanName, Class?... typesToMatch) throws CannotLoadBeanClassException try if (mbd.hasBeanClass()) return mbd.getBeanClass(); // 1. ä¼˜å…ˆè¿”å›å½“å‰çº¿ç¨‹ä¸­çš„ClassLoader // 2. çº¿ç¨‹ä¸­ç±»åŠ è½½å™¨ä¸ºnullçš„æƒ…å†µä¸‹ï¼Œè¿”å›ClassUtilsç±»çš„ç±»åŠ è½½å™¨ // 3. å¦‚æœClassUtilsç±»çš„ç±»åŠ è½½å™¨ä¸ºç©ºï¼Œé‚£ä¹ˆåˆ™è¡¨ç¤ºæ˜¯Bootstrapç±»åŠ è½½å™¨åŠ è½½çš„ClassUtilsç±»ï¼Œé‚£ä¹ˆåˆ™è¿”å›ç³»ç»Ÿç±»åŠ è½½å™¨ Class? beanClass = doResolveBeanClass(mbd, typesToMatch); if (mbd.hasBeanClass()) mbd.prepareMethodOverrides(); return beanClass; ... 2.5 å®ä¾‹åŒ–å‰ç±»ä¿¡æ¯åŠ è½½å®Œæˆåå°±å¯ä»¥è¿›è¡Œå®ä¾‹åŒ–äº†ï¼ŒSpringåœ¨å®ä¾‹åŒ–Beanå¯¹è±¡å‰æä¾›äº†æ‰©å±•ç‚¹ï¼Œé€šè¿‡ç»§æ‰¿InstantiationAwareBeanPostProcessoræ¥å£å®ç°postProcessBeforeInstantiationæ–¹æ³•ï¼Œå°±å¯ä»¥åœ¨å®ä¾‹åŒ–å‰è°ƒç”¨è¯¥æ–¹æ³•ã€‚ AbstractAutowireCapableBeanFactory.createBean() // å¤„ç†å®ä¾‹åŒ–å‰å›è°ƒ InstantiationAwareBeanPostProcessor.postProcessBeforeInstantiationObject bean = resolveBeforeInstantiation(beanName, mbdToUse);@Nullableprotected Object resolveBeforeInstantiation(String beanName, RootBeanDefinition mbd) Object bean = null;\tif (!Boolean.FALSE.equals(mbd.beforeInstantiationResolved)) // Make sure bean class is actually resolved at this point. // hasInstantiationAwareBeanPostProcessors if (!mbd.isSynthetic() hasInstantiationAwareBeanPostProcessors()) Class? targetType = determineTargetType(beanName, mbd); if (targetType != null) bean = applyBeanPostProcessorsBeforeInstantiation(targetType, beanName); if (bean != null) bean = applyBeanPostProcessorsAfterInitialization(bean, beanName); mbd.beforeInstantiationResolved = (bean != null); return bean; éœ€è¦æ³¨æ„çš„æ˜¯postProcessBeforeInstantiationæ˜¯æœ‰è¿”å›å€¼çš„ï¼Œå¦‚æœè¿”å›ä¸ä¸ºnullè¡¨ç¤ºä¸éœ€è¦Springæ¥å®ä¾‹åŒ–äº†ï¼Œå¹¶ä¸”åç»­çš„Springä¾èµ–æ³¨å…¥ä¹Ÿä¸ä¼šè¿›è¡Œäº†ï¼Œç›´æ¥æ‰§è¡Œåˆå§‹åŒ–åè¿™ä¸€æ­¥ã€‚ 2.6 å®ä¾‹åŒ–AbstractAutowireCapableBeanFactory.createBean() // å®ä¾‹åŒ–Beanå¯¹è±¡Object beanInstance = doCreateBean(beanName, mbdToUse, args); 2.7 BeanDefinitionçš„åç½®å¤„ç†åœ¨Beanå¯¹è±¡å®ä¾‹åŒ–åï¼ŒSpringåœ¨å®ä¾‹åŒ–Beanå¯¹è±¡åæä¾›äº†æ‰©å±•ç‚¹ï¼Œé€šè¿‡ç»§æ‰¿MergedBeanDefinitionPostProcessoræ¥å£å®ç°postProcessMergedBeanDefinitionæ–¹æ³•ï¼Œå°±å¯ä»¥åœ¨å®ä¾‹åŒ–åè°ƒç”¨è¯¥æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥å¯¹æ­¤æ—¶çš„BeanDefinitionè¿›è¡ŒåŠ å·¥ã€‚ AutowiredAnnotationBeanPostProcessorå°±æ˜¯ä¸€ä¸ªMergedBeanDefinitionPostProcessorï¼Œä¸­ä¼šå»æŸ¥æ‰¾æ³¨å…¥ç‚¹ï¼Œå¹¶ç¼“å­˜åœ¨AutowiredAnnotationBeanPostProcessorå¯¹è±¡çš„ä¸€ä¸ªMapä¸­ï¼ˆinjectionMetadataCacheï¼‰ã€‚ 2.8 å®ä¾‹åŒ–åBeanå®ä¾‹åŒ–åäº†ï¼ŒSpringåœ¨å®ä¾‹åŒ–Beanå¯¹è±¡å‰æä¾›äº†æ‰©å±•ç‚¹ï¼Œé€šè¿‡ç»§æ‰¿InstantiationAwareBeanPostProcessoræ¥å£å®ç°postProcessAfterInstantiationæ–¹æ³•ï¼Œå°±å¯ä»¥åœ¨å®ä¾‹åŒ–å‰è°ƒç”¨è¯¥æ–¹æ³•ã€‚ AbstractAutowireCapableBeanFactory.populateBean() // Give any InstantiationAwareBeanPostProcessors the opportunity to modify the// state of the bean before properties are set. This can be used, for example,// to support styles of field injection.if (!mbd.isSynthetic() hasInstantiationAwareBeanPostProcessors()) for (InstantiationAwareBeanPostProcessor bp : getBeanPostProcessorCache().instantiationAware) if (!bp.postProcessAfterInstantiation(bw.getWrappedInstance(), beanName)) return; 2.9 è‡ªåŠ¨æ³¨å…¥å¤„ç†Springçš„è‡ªåŠ¨æ³¨å…¥ï¼Œè¯¦ç»†çœ‹ç¬¬ä¸‰ç« èŠ‚ 2.10 å¤„ç†å±æ€§è¿™ä¸ªæ­¥éª¤ä¸­ï¼Œå°±ä¼šå¤„ç†@Autowiredã€@Resourceã€@Valueç­‰æ³¨è§£ï¼Œä¹Ÿæ˜¯é€šè¿‡InstantiationAwareBeanPostProcessor.postProcessProperties()æ‰©å±•ç‚¹æ¥å®ç°çš„ AbstractAutowireCapableBeanFactory.populateBean() if (hasInstantiationAwareBeanPostProcessors()) if (pvs == null) pvs = mbd.getPropertyValues(); for (InstantiationAwareBeanPostProcessor bp : getBeanPostProcessorCache().instantiationAware) PropertyValues pvsToUse = bp.postProcessProperties(pvs, bw.getWrappedInstance(), beanName); if (pvsToUse == null) return; pvs = pvsToUse; 2.11 æ‰§è¡ŒAwareå®Œæˆäº†å±æ€§èµ‹å€¼ä¹‹åï¼ŒSpringä¼šæ‰§è¡Œä¸€äº›å›è°ƒï¼ŒåŒ…æ‹¬ï¼š BeanNameAwareï¼šå›ä¼ beanNameç»™beanå¯¹è±¡ã€‚ BeanClassLoaderAwareï¼šå›ä¼ classLoaderç»™beanå¯¹è±¡ã€‚ BeanFactoryAwareï¼šå›ä¼ beanFactoryç»™å¯¹è±¡ã€‚ 2.12 åˆå§‹åŒ–å‰åˆå§‹åŒ–å‰ï¼Œä¹Ÿæ˜¯Springæä¾›çš„ä¸€ä¸ªæ‰©å±•ç‚¹ï¼š**BeanPostProcessor.postProcessBeforeInitialization()**ï¼Œæ¯”å¦‚ åˆ©ç”¨åˆå§‹åŒ–å‰ï¼Œå¯ä»¥å¯¹è¿›è¡Œäº†ä¾èµ–æ³¨å…¥çš„Beanè¿›è¡Œå¤„ç†ã€‚ AbstractAutowireCapableBeanFactory.initializeBean() if (mbd == null || !mbd.isSynthetic()) wrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName); 2.13 åˆå§‹åŒ– æŸ¥çœ‹å½“å‰Beanå¯¹è±¡æ˜¯å¦å®ç°äº†InitializingBeanæ¥å£ï¼Œå¦‚æœå®ç°äº†å°±è°ƒç”¨å…¶afterPropertiesSet()æ–¹æ³• æ‰§è¡ŒBeanDefinitionä¸­æŒ‡å®šçš„åˆå§‹åŒ–æ–¹æ³• @Componentpublic class MyMergedBeanDefinitionPostProcessor implements MergedBeanDefinitionPostProcessor @Override\tpublic void postProcessMergedBeanDefinition(RootBeanDefinition beanDefinition, Class? beanType, String beanName) if (beanName.equals(userService)) beanDefinition.setInitMethodNames(init); @Componentpublic class UserService public void init() System.out.println(UserService init); 2.14 æ€»ç»“ InstantiationAwareBeanPostProcessor.postProcessBeforeInstantiation() å®ä¾‹åŒ– MergedBeanDefinitionPostProcessor.postProcessMergedBeanDefinition() InstantiationAwareBeanPostProcessor.postProcessAfterInstantiation() è‡ªåŠ¨æ³¨å…¥BY_TYPEã€BY_NAME InstantiationAwareBeanPostProcessor.postProcessProperties() å›è°ƒAwareå¯¹è±¡ BeanPostProcessor.postProcessBeforeInitialization() åˆå§‹åŒ– BeanPostProcessor.postProcessAfterInitialization() 3. ä¾èµ–æ³¨å…¥æºç è§£æ3.1 æŸ¥è¯¢æ³¨å…¥ç‚¹å®ä¾‹åŒ–åçš„Beanå¯¹è±¡åªæ˜¯newäº†ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­çš„å±æ€§å€¼è¿˜æ˜¯nullï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦å¯¹Beanå¯¹è±¡ä¸­çš„å±æ€§èµ‹å€¼ã€‚ åœ¨Springä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨@Autowiredæ³¨è§£å®ç°è‡ªåŠ¨æ³¨å…¥ã€‚ @Autowiredæ³¨è§£å¯ä»¥å†™åœ¨ï¼š å±æ€§ä¸Šï¼šå…ˆæ ¹æ®å±æ€§ç±»å‹å»æ‰¾Beanï¼Œå¦‚æœæ‰¾åˆ°å¤šä¸ªå†æ ¹æ®å±æ€§åç¡®å®šä¸€ä¸ª æ„é€ æ–¹æ³•ä¸Šï¼šå…ˆæ ¹æ®æ–¹æ³•å‚æ•°ç±»å‹å»æ‰¾Beanï¼Œå¦‚æœæ‰¾åˆ°å¤šä¸ªå†æ ¹æ®å‚æ•°åç¡®å®šä¸€ä¸ª setæ–¹æ³•ä¸Šï¼šå…ˆæ ¹æ®æ–¹æ³•å‚æ•°ç±»å‹å»æ‰¾Beanï¼Œå¦‚æœæ‰¾åˆ°å¤šä¸ªå†æ ¹æ®å‚æ•°åç¡®å®šä¸€ä¸ª è¦å¾€Beanä¸­å±æ€§æ³¨å…¥ç›¸åº”å€¼æ—¶éœ€è¦å…ˆæ‰¾å±æ€§å¯¹åº”çš„æ³¨å…¥ç‚¹ï¼ˆ@Autowiredã€@Valueã€@Injectæ‰€æ ‡æ³¨çš„åœ°æ–¹ï¼‰ï¼Œåœ¨Springä¸­åˆ©ç”¨AutowiredAnnotationBeanPostProcessorçš„**postProcessMergedBeanDefinition()**æ–¹æ³•æ‰¾å‡ºæ³¨å…¥ç‚¹å¹¶ç¼“å­˜ï¼Œæ‰¾æ³¨å…¥ç‚¹çš„æµç¨‹ä¸ºï¼š éå†å½“å‰ç±»çš„æ‰€æœ‰çš„å±æ€§å­—æ®µField è·å–ç±»å…ƒæ•°æ®ä¿¡æ¯åˆ¤æ–­å­—æ®µä¸Šæ˜¯å¦å­˜åœ¨@Autowiredã€@Valueã€@Injectä¸­çš„å…¶ä¸­ä»»æ„ä¸€ä¸ªï¼Œå­˜åœ¨åˆ™è®¤ä¸ºè¯¥å­—æ®µæ˜¯ä¸€ä¸ªæ³¨å…¥ç‚¹ åˆ¤æ–­å±æ€§æ˜¯å¦æ˜¯é™æ€çš„ï¼Œé™æ€çš„ä¸è¿›è¡Œæ³¨å…¥ è·å–@Autowiredä¸­requiredå±æ€§å€¼ å°†å±æ€§å’Œrequiredæ„é€ æˆAutowiredFieldElementå¯¹è±¡æ”¾å…¥fieldElementsé›†åˆ éå†å½“å‰ç±»çš„æ‰€æœ‰æ–¹æ³• åˆ¤æ–­å½“å‰Methodæ˜¯å¦æ˜¯æ¡¥æ¥æ–¹æ³•ï¼Œå¦‚æœæ˜¯æ‰¾åˆ°åŸæ–¹æ³• æŸ¥çœ‹æ–¹æ³•ä¸Šæ˜¯å¦å­˜åœ¨@Autowiredã€@Valueã€@Injectä¸­çš„å…¶ä¸­ä»»æ„ä¸€ä¸ªï¼Œå­˜åœ¨åˆ™è®¤ä¸ºè¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªæ³¨å…¥ç‚¹ å¦‚æœæ–¹æ³•æ˜¯staticçš„ï¼Œåˆ™ä¸è¿›è¡Œæ³¨å…¥ è·å–@Autowiredä¸­çš„requiredå±æ€§çš„å€¼ å°†æ–¹æ³•ä¿¡æ¯æ„é€ æˆä¸€ä¸ªAutowiredMethodElementå¯¹è±¡ï¼Œä½œä¸ºä¸€ä¸ªæ³¨å…¥ç‚¹å¯¹è±¡æ·»åŠ åˆ°currElementsé›†åˆä¸­ã€‚ éå†å®Œå½“å‰ç±»çš„å­—æ®µå’Œæ–¹æ³•åï¼Œå°†éå†çˆ¶ç±»çš„ï¼Œç›´åˆ°æ²¡æœ‰çˆ¶ç±»ã€‚ æœ€åå°†currElementsé›†åˆå°è£…æˆä¸€ä¸ªInjectionMetadataå¯¹è±¡ï¼Œä½œä¸ºå½“å‰Beanå¯¹äºçš„æ³¨å…¥ç‚¹é›†åˆå¯¹è±¡ï¼Œå¹¶ç¼“å­˜ã€‚ AutowiredAnnotationBeanPostProcessor.postProcessMergedBeanDefinition() @Overridepublic void postProcessMergedBeanDefinition(RootBeanDefinition beanDefinition, Class? beanType, String beanName) // Register externally managed config members on bean definition.\t// æŸ¥æ‰¾å±æ€§æ³¨å…¥ç‚¹\tfindInjectionMetadata(beanName, beanType, beanDefinition); ... AutowiredAnnotationBeanPostProcessor.findAutowiringMetadata()private InjectionMetadata findAutowiringMetadata(String beanName, Class? clazz, @Nullable PropertyValues pvs) // Fall back to class name as cache key, for backwards compatibility with custom callers.\tString cacheKey = (StringUtils.hasLength(beanName) ? beanName : clazz.getName());\t// Quick check on the concurrent map first, with minimal locking. // åœ¨ç¼“å­˜ä¸­ MapString, InjectionMetadata injectionMetadataCache æŸ¥è¯¢æ˜¯å¦å­˜åœ¨æ³¨å…¥ç‚¹\tInjectionMetadata metadata = this.injectionMetadataCache.get(cacheKey);\tif (InjectionMetadata.needsRefresh(metadata, clazz)) synchronized (this.injectionMetadataCache) metadata = this.injectionMetadataCache.get(cacheKey); if (InjectionMetadata.needsRefresh(metadata, clazz)) if (metadata != null) metadata.clear(pvs); // æ„å»ºæ³¨å…¥ç‚¹ metadata = buildAutowiringMetadata(clazz); this.injectionMetadataCache.put(cacheKey, metadata); return metadata; AutowiredAnnotationBeanPostProcessor.buildAutowiringMetadata()private InjectionMetadata buildAutowiringMetadata(Class? clazz) // åˆ¤æ–­classåæ˜¯å¦æ˜¯â€œjava.â€å¼€å¤´å¦‚æœæ˜¯ç›´æ¥è¿”å›\tif (!AnnotationUtils.isCandidateClass(clazz, this.autowiredAnnotationTypes)) return InjectionMetadata.EMPTY; // æ³¨å…¥ç‚¹é›†åˆ\tfinal ListInjectionMetadata.InjectedElement elements = new ArrayList();\tClass? targetClass = clazz;\tdo // æ³¨å…¥ç‚¹å­—æ®µé›†åˆ final ListInjectionMetadata.InjectedElement fieldElements = new ArrayList(); ReflectionUtils.doWithLocalFields(targetClass, field - // åˆ¤æ–­å­—æ®µæ˜¯å¦å­˜åœ¨@Autowiredã€@Valueã€@Injectä¸­ä»»æ„ä¸€ä¸ª MergedAnnotation? ann = findAutowiredAnnotation(field); if (ann != null) // åˆ¤æ–­å­—æ®µæ˜¯å¦é™æ€ç±»å‹ if (Modifier.isStatic(field.getModifiers())) if (logger.isInfoEnabled()) logger.info(Autowired annotation is not supported on static fields: + field); return; // è·å–@Autowiredæ³¨è§£ä¸­requiredå±æ€§å€¼ boolean required = determineRequiredStatus(ann); // æ„é€ æ³¨å…¥ç‚¹æ”¾å…¥é›†åˆ fieldElements.add(new AutowiredFieldElement(field, required)); ); final ListInjectionMetadata.InjectedElement methodElements = new ArrayList(); ReflectionUtils.doWithLocalMethods(targetClass, method - // åˆ¤æ–­æ˜¯å¦æ¡¥æ¥æ–¹æ³•ï¼Œå¦‚æœæ˜¯æ¡¥æ¥æ–¹æ³•æ ¹æ®æ¡¥æ¥æ–¹æ³•æ‰¾åˆ°å®é™…çš„æ–¹æ³• Method bridgedMethod = BridgeMethodResolver.findBridgedMethod(method); if (!BridgeMethodResolver.isVisibilityBridgeMethodPair(method, bridgedMethod)) return; // åˆ¤æ–­æ–¹æ³•ä¸Šæ˜¯å¦æœ‰æ³¨å…¥ç‚¹ MergedAnnotation? ann = findAutowiredAnnotation(bridgedMethod); if (ann != null method.equals(ClassUtils.getMostSpecificMethod(method, clazz))) // åˆ¤æ–­æ˜¯å¦é™æ€æ–¹æ³• if (Modifier.isStatic(method.getModifiers())) if (logger.isInfoEnabled()) logger.info(Autowired annotation is not supported on static methods: + method); return; // æ–¹æ³•å…¥å‚ä¸º0 if (method.getParameterCount() == 0) if (method.getDeclaringClass().isRecord()) // Annotations on the compact constructor arguments made available on accessors, ignoring. return; if (logger.isInfoEnabled()) logger.info(Autowired annotation should only be used on methods with parameters: + method); boolean required = determineRequiredStatus(ann); PropertyDescriptor pd = BeanUtils.findPropertyForMethod(bridgedMethod, clazz); // æ„é€ æ–¹æ³•æ³¨å…¥ç‚¹æ”¾å…¥é›†åˆ methodElements.add(new AutowiredMethodElement(method, required, pd)); ); elements.addAll(0, sortMethodElements(methodElements, targetClass)); elements.addAll(0, fieldElements); // æ‹¿åˆ°çˆ¶ç±»ç±»å‹ targetClass = targetClass.getSuperclass(); // å¾ªç¯éå†çˆ¶ç±»è·å–çˆ¶ç±»æ³¨å…¥ç‚¹\twhile (targetClass != null targetClass != Object.class);\treturn InjectionMetadata.forElements(elements, clazz); staticçš„å­—æ®µæˆ–æ–¹æ³•ä¸ºä»€ä¹ˆä¸æ”¯æŒï¼Ÿ @Component@Scope(prototype)public class OrderService @Component@Scope(prototype)public class UserService @Autowired\tprivate static OrderService orderService;\tpublic void test() System.out.println(test); å¦‚æœUserServiceå’ŒOrderServiceéƒ½æ˜¯åŸå‹Beanï¼Œå‡è®¾Springæ”¯æŒstaticå­—æ®µè¿›è¡Œè‡ªåŠ¨æ³¨å…¥ï¼Œé‚£ä¹ˆç°åœ¨è°ƒç”¨ä¸¤æ¬¡ UserService userService1 context.getBean(â€œuserServiceâ€) UserService userService2 context.getBean(â€œuserServiceâ€) æ­¤æ—¶ï¼ŒuserService1çš„orderServiceå€¼æ˜¯ä»€ä¹ˆï¼Ÿè¿˜æ˜¯å®ƒè‡ªå·±æ³¨å…¥çš„å€¼å—ï¼Ÿ ä¸€æ—¦userService2 åˆ›å»ºå¥½äº†ä¹‹åï¼Œå› ä¸ºorderServiceå­—æ®µæ˜¯ä¸€ä¸ªé™æ€çš„ï¼Œé™æ€å±æ€§æ˜¯å±äºç±»çš„ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡ŒUserService userService2 = context.getBean(userService)ä»£ç åuserService1ä¸­orderServiceå°±ä¼šè¢«ä¿®æ”¹ä¸ºuserService2ä¸­çš„orderServiceï¼Œä»è€Œå‡ºç°bugã€‚ æ¡¥æ¥æ–¹æ³• public interface UserServiceT void setOrderService(T t); @Componentpublic class UserServiceImpl implements UserServiceOrderService private OrderService orderService;\t@Override\t@Autowired\tpublic void setOrderService(OrderService orderService) this.orderService = orderService; public void test() System.out.println(test); UserServiceImplå¯¹åº”çš„å­—èŠ‚ç ä¸ºï¼š å¯ä»¥çœ‹åˆ°åœ¨UserSerivceçš„å­—èŠ‚ç ä¸­æœ‰ä¸¤ä¸ªsetOrderServiceæ–¹æ³•ï¼š public setOrderService(LcomzhouyuserviceOrderService;)V public synthetic bridge setOrderService(LjavalangObject;)V å¹¶ä¸”éƒ½æ˜¯å­˜åœ¨@Autowiredæ³¨è§£çš„ã€‚ æ‰€ä»¥åœ¨Springä¸­éœ€è¦å¤„ç†è¿™ç§æƒ…å†µï¼Œå½“éå†åˆ°æ¡¥æ¥æ–¹æ³•æ—¶ï¼Œå¾—æ‰¾åˆ°åŸæ–¹æ³•ã€‚ 3.2 æ³¨å…¥ç‚¹æ³¨å…¥åœ¨ä¸Šä¸€æ­¥æŸ¥è¯¢åˆ°æ³¨å…¥ç‚¹åï¼Œå°±å¯ä»¥æ ¹æ®æ³¨å…¥ç‚¹æ¥è¿›è¡Œä¾èµ–æ³¨å…¥äº†ã€‚æ³¨å…¥åˆ†ä¸ºä»å­—æ®µæ³¨å…¥åŠæ–¹æ³•å…¥å‚å±æ€§çš„æ³¨å…¥ã€‚ 3.2.1 å­—æ®µæ³¨å…¥InstantiationAwareBeanPostProcessor.postProcessPropertiesAutowiredAnnotationBeanPostProcessor.postProcessPropertiesAutowiredFieldElement.inject@Nullableprivate Object resolveFieldValue(Field field, Object bean, @Nullable String beanName) // æ ¹æ®å­—æ®µç”Ÿæˆå±æ€§æè¿°å™¨\tDependencyDescriptor desc = new DependencyDescriptor(field, this.required);\tdesc.setContainingClass(bean.getClass());\tSetString autowiredBeanNames = new LinkedHashSet(2);\tAssert.state(beanFactory != null, No BeanFactory available);\tTypeConverter typeConverter = beanFactory.getTypeConverter();\tObject value;\ttry // è·å–åˆ°å±æ€§å¯¹åº”Bean value = beanFactory.resolveDependency(desc, beanName, autowiredBeanNames, typeConverter); catch (BeansException ex) throw new UnsatisfiedDependencyException(null, beanName, new InjectionPoint(field), ex); ...\treturn value;@Override@Nullablepublic Object resolveDependency(DependencyDescriptor descriptor, @Nullable String requestingBeanName, @Nullable SetString autowiredBeanNames, @Nullable TypeConverter typeConverter) throws BeansException // åˆå§‹åŒ–æ–¹æ³•å‚æ•°çš„åç§°\tdescriptor.initParameterNameDiscovery(getParameterNameDiscoverer());\tif (Optional.class == descriptor.getDependencyType()) return createOptionalDependency(descriptor, requestingBeanName); else if (ObjectFactory.class == descriptor.getDependencyType() || ObjectProvider.class == descriptor.getDependencyType()) return new DependencyObjectProvider(descriptor, requestingBeanName); else if (javaxInjectProviderClass == descriptor.getDependencyType()) return new Jsr330Factory().createDependencyProvider(descriptor, requestingBeanName); else if (descriptor.supportsLazyResolution()) // åˆ¤æ–­å±æ€§æˆ–æ–¹æ³•å‚æ•°ä¸Šæ˜¯å¦æœ‰@Lazyæ³¨è§£ï¼Œå¦‚æœæœ‰è¯¥æ³¨è§£ç›´æ¥å…ˆè¿”å›ä¸ªä»£ç†å¯¹è±¡ Object result = getAutowireCandidateResolver().getLazyResolutionProxyIfNecessary( descriptor, requestingBeanName); if (result != null) return result; // descriptorè¡¨ç¤ºæŸä¸ªå±æ€§æˆ–è€…æŸä¸ªsetæ–¹æ³•\t// requestingBeanNameè¡¨ç¤ºæ­£åœ¨ä¾èµ–æ³¨å…¥çš„Bean\treturn doResolveDependency(descriptor, requestingBeanName, autowiredBeanNames, typeConverter);@Nullablepublic Object doResolveDependency(DependencyDescriptor descriptor, @Nullable String beanName, @Nullable SetString autowiredBeanNames, @Nullable TypeConverter typeConverter) throws BeansException InjectionPoint previousInjectionPoint = ConstructorResolver.setCurrentInjectionPoint(descriptor);\ttry ... // Step 2: pre-defined value or expression, e.g. from @Value // è·å–@Valueæ³¨è§£çš„å€¼ Object value = getAutowireCandidateResolver().getSuggestedValue(descriptor); if (value != null) if (value instanceof String strValue) // å ä½ç¬¦å¡«å……$ String resolvedValue = resolveEmbeddedValue(strValue); BeanDefinition bd = (beanName != null containsBean(beanName) ? getMergedBeanDefinition(beanName) : null); // è§£æSpringè¡¨è¾¾å¼# value = evaluateBeanDefinitionString(resolvedValue, bd); ... // Step 3a: multiple beans as stream / array / standard collection / plain map // æ ¹æ®typeæŸ¥åˆ°å¤šä¸ªç¬¦åˆç±»å‹çš„Beanæ—¶ // MapString, OrderService/ListOrderService orderServiceså¤„ç†è¿™ç§ç±»å‹å±æ€§ Object multipleBeans = resolveMultipleBeans(descriptor, beanName, autowiredBeanNames, typeConverter); if (multipleBeans != null) return multipleBeans; // Step 3b: direct bean matches, possibly direct beans of type Collection / Map // æ‰¾åˆ°æ‰€æœ‰çš„Bean,keyæ˜¯BeanName,valueå¯èƒ½æ˜¯beanå¯¹è±¡ä¹Ÿæœ‰å¯èƒ½æ˜¯beanClass // å¤„ç†è¿™ç§åœºæ™¯.ä¾‹å¦‚æ ¹æ®ç±»å‹æ‰¾åˆ°äº†å¤šä¸ªç¬¦åˆçš„Bean,æœ‰çš„Beanå¯èƒ½å·²ç»å®ä¾‹è¯äº†ä½†æ˜¯æœ‰çš„è¿˜æ²¡æœ‰å®ä¾‹åŒ–ã€‚ï¼ˆæ‰¾å‡ºæ¥çš„Beanå¯èƒ½å¹¶ä¸æ˜¯éœ€è¦çš„Bean // è¿™ä¸ªæ—¶å€™ä¸éœ€è¦æå‰å»å®ä¾‹åŒ–å®ƒ MapString, Object matchingBeans = findAutowireCandidates(beanName, type, descriptor); if (matchingBeans.isEmpty()) // Step 3c (fallback): custom Collection / Map declarations for collecting multiple beans multipleBeans = resolveMultipleBeansFallback(descriptor, beanName, autowiredBeanNames, typeConverter); if (multipleBeans != null) return multipleBeans; // Raise exception if nothing found for required injection point // Requiredä¸ºtrueæŠ›å‡ºå¼‚å¸¸ if (isRequired(descriptor)) raiseNoMatchingBeanFound(type, descriptor.getResolvableType(), descriptor); return null; String autowiredBeanName; Object instanceCandidate; // Step 4: determine single candidate if (matchingBeans.size() 1) // å…ˆæ ¹æ®@Primaryã€@PriorityåŒ¹é…ç¬¦åˆçš„Beanå†æ ¹æ®BeanNameå»åŒ¹é… autowiredBeanName = determineAutowireCandidate(matchingBeans, descriptor); if (autowiredBeanName == null) if (isRequired(descriptor) || !indicatesArrayCollectionOrMap(type)) // Raise exception if no clear match found for required injection point return descriptor.resolveNotUnique(descriptor.getResolvableType(), matchingBeans); else // In case of an optional Collection/Map, silently ignore a non-unique case: // possibly it was meant to be an empty collection of multiple regular beans // (before 4.3 in particular when we didnt even look for collection beans). return null; instanceCandidate = matchingBeans.get(autowiredBeanName); else // We have exactly one match. Map.EntryString, Object entry = matchingBeans.entrySet().iterator().next(); autowiredBeanName = entry.getKey(); instanceCandidate = entry.getValue(); // Step 5: validate single result if (autowiredBeanNames != null) autowiredBeanNames.add(autowiredBeanName); if (instanceCandidate instanceof Class) // è°ƒç”¨beanFactory.getBean(beanName)è¿›è¡Œå®ä¾‹åŒ– instanceCandidate = descriptor.resolveCandidate(autowiredBeanName, type, this); Object result = instanceCandidate; ... return result; ... æ€»ç»“ï¼š è°ƒç”¨InstantiationAwareBeanPostProcessor.postProcessPropertiesè¿›å…¥AutowiredFieldElement.injectå­—æ®µå±æ€§æ³¨å…¥æ–¹æ³• åˆ¤æ–­å±æ€§ä¸Šæ˜¯å¦æœ‰@Lazyæ³¨è§£å¦‚æœæœ‰ç›´æ¥è¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡ è§£æ@Valueæ³¨è§£ã€æ ¹æ®å­—æ®µç±»å‹æŸ¥è¯¢ç¬¦åˆç±»å‹çš„Bean åˆ¤æ–­å­—æ®µå±æ€§æ˜¯å¦æ˜¯é›†åˆç±»å‹ï¼Œä¸”æŸ¥è¯¢åˆ°ç¬¦åˆç±»å‹çš„Beanï¼Œå¦‚æœæ˜¯ç›´æ¥è¿”å› è°ƒç”¨findAutowireCandidates()æ‰¾å‡ºæ‰€æœ‰ç¬¦åˆç±»å‹çš„Beançš„åå­—æˆ–å¯¹è±¡ï¼ˆå·²ç»å®ä¾‹åŒ–äº†ï¼‰ åˆ¤æ–­æŸ¥è¯¢æ˜¯å¦æœ‰å¤šä¸ªç¬¦åˆçš„Beanï¼Œå†åˆ¤æ–­å¤„ç†@Primaryã€@PriorityåŒ¹é…ç¬¦åˆçš„Beanå†æ ¹æ®BeanNameå»åŒ¹é… åˆ¤æ–­Beanæ˜¯å¦æ˜¯classï¼Œæ˜¯å°±ç»è¡Œå®ä¾‹åŒ–è¿”å›Beanå¯¹è±¡ å°†æ‹¿åˆ°çš„Beané€šè¿‡åå°„æ³¨å…¥åˆ°å­—æ®µä¸­ è¿™ä¸ªfindAutowireCandidates()æ–¹æ³•æ˜¯æŸ¥è¯¢Beançš„æ ¸å¿ƒå®ç°ï¼š æ‰¾å‡ºBeanFactoryä¸­ç±»å‹ä¸ºtypeçš„æ‰€æœ‰çš„Beançš„åå­—ï¼Œæ³¨æ„æ˜¯åå­—ï¼Œè€Œä¸æ˜¯Beanå¯¹è±¡ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥æ ¹æ®BeanDefinitionå°±èƒ½åˆ¤æ–­å’Œå½“å‰typeæ˜¯ä¸æ˜¯åŒ¹é…ï¼Œä¸ç”¨ç”ŸæˆBeanå¯¹è±¡ æŠŠresolvableDependenciesä¸­keyä¸ºtypeçš„å¯¹è±¡æ‰¾å‡ºæ¥å¹¶æ·»åŠ åˆ°resultä¸­ éå†æ ¹æ®typeæ‰¾å‡ºçš„beanNameï¼Œåˆ¤æ–­å½“å‰beanNameå¯¹åº”çš„Beanæ˜¯ä¸æ˜¯èƒ½å¤Ÿè¢«è‡ªåŠ¨æ³¨å…¥ å…ˆåˆ¤æ–­beanNameå¯¹åº”çš„BeanDefinitionä¸­çš„autowireCandidateï¼ˆ@Beanä¸­å±æ€§ï¼‰å±æ€§ï¼Œå¦‚æœä¸ºfalseï¼Œè¡¨ç¤ºä¸èƒ½ç”¨æ¥è¿›è¡Œè‡ªåŠ¨æ³¨å…¥ï¼Œå¦‚æœä¸ºtrueåˆ™ç»§ç»­è¿›è¡Œåˆ¤æ–­ åˆ¤æ–­å½“å‰typeæ˜¯ä¸æ˜¯æ³›å‹ï¼Œå¦‚æœæ˜¯æ³›å‹æ˜¯ä¼šæŠŠå®¹å™¨ä¸­æ‰€æœ‰çš„beanNameæ‰¾å‡ºæ¥çš„ï¼Œå¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œé‚£ä¹ˆåœ¨è¿™ä¸€æ­¥ä¸­å°±è¦è·å–åˆ°æ³›å‹çš„çœŸæ­£ç±»å‹ï¼Œç„¶åè¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœå½“å‰beanNameå’Œå½“å‰æ³›å‹å¯¹åº”çš„çœŸå®ç±»å‹åŒ¹é…ï¼Œé‚£ä¹ˆåˆ™ç»§ç»­åˆ¤æ–­ å¦‚æœå½“å‰DependencyDescriptorä¸Šå­˜åœ¨@Qualifieræ³¨è§£ï¼Œé‚£ä¹ˆåˆ™è¦åˆ¤æ–­å½“å‰beanNameä¸Šæ˜¯å¦å®šä¹‰äº†Qualifierï¼Œå¹¶ä¸”æ˜¯å¦å’Œå½“å‰DependencyDescriptorä¸Šçš„Qualifierç›¸ç­‰ï¼Œç›¸ç­‰åˆ™åŒ¹é… ç»è¿‡ä¸Šè¿°éªŒè¯ä¹‹åï¼Œå½“å‰beanNameæ‰èƒ½æˆä¸ºä¸€ä¸ªå¯æ³¨å…¥çš„ï¼Œæ·»åŠ åˆ°resultä¸­ 3.2.2 æ–¹æ³•å‚æ•°æ³¨å…¥@Nullableprivate Object[] resolveMethodArguments(Method method, Object bean, @Nullable String beanName) // æ–¹æ³•å‚æ•°ä¸ªæ•°\tint argumentCount = method.getParameterCount();\tObject[] arguments = new Object[argumentCount];\tDependencyDescriptor[] descriptors = new DependencyDescriptor[argumentCount];\tSetString autowiredBeanNames = new LinkedHashSet(argumentCount * 2);\tAssert.state(beanFactory != null, No BeanFactory available);\tTypeConverter typeConverter = beanFactory.getTypeConverter();\t// éå†æ–¹æ³•å‚æ•°æ‰¾åˆ°å¯¹åº”Beanå¯¹è±¡\tfor (int i = 0; i arguments.length; i++) MethodParameter methodParam = new MethodParameter(method, i); DependencyDescriptor currDesc = new DependencyDescriptor(methodParam, this.required); currDesc.setContainingClass(bean.getClass()); descriptors[i] = currDesc; try // è·å–Beanï¼Œè¿™é‡Œçš„é€»è¾‘å’Œå­—æ®µå±æ€§ä¸€è‡´ Object arg = beanFactory.resolveDependency(currDesc, beanName, autowiredBeanNames, typeConverter); if (arg == null !this.required !methodParam.isOptional()) arguments = null; break; arguments[i] = arg; catch (BeansException ex) throw new UnsatisfiedDependencyException(null, beanName, new InjectionPoint(methodParam), ex); ...\treturn arguments; 3.3 @ResourceCommonAnnotationBeanPostProcessor.postProcessProperties @Overridepublic PropertyValues postProcessProperties(PropertyValues pvs, Object bean, String beanName) // æŸ¥è¯¢@Resourceæ³¨å…¥ç‚¹\tInjectionMetadata metadata = findResourceMetadata(beanName, bean.getClass(), pvs);\ttry // å±æ€§æ³¨å…¥ metadata.inject(bean, beanName, pvs); catch (Throwable ex) throw new BeanCreationException(beanName, Injection of resource dependencies failed, ex); return pvs;protected Object autowireResource(BeanFactory factory, LookupElement element, @Nullable String requestingBeanName) throws NoSuchBeanDefinitionException Object resource;\tSetString autowiredBeanNames;\tString name = element.name;\tif (factory instanceof AutowireCapableBeanFactory autowireCapableBeanFactory) // åˆ¤æ–­BeanFactoryä¸­æ˜¯å¦å­˜åœ¨ç›¸åº”BeanNameçš„Beanå¯¹è±¡ if (this.fallbackToDefaultTypeMatch element.isDefaultName !factory.containsBean(name)) autowiredBeanNames = new LinkedHashSet(); // ä¸å­˜åœ¨èµ°resolveDependencyï¼Œå…ˆbyTypeå†byName resource = autowireCapableBeanFactory.resolveDependency( element.getDependencyDescriptor(), requestingBeanName, autowiredBeanNames, null); if (resource == null) throw new NoSuchBeanDefinitionException(element.getLookupType(), No resolvable resource object); else // å­˜åœ¨ç›´æ¥æ ¹æ®nameæ‹¿åˆ°Bean resource = autowireCapableBeanFactory.resolveBeanByName(name, element.getDependencyDescriptor()); autowiredBeanNames = Collections.singleton(name); ...\treturn resource; 4. å¾ªç¯ä¾èµ–@Componentpublic class OrderService @Autowired\tprivate UserService userService;@Componentpublic class UserService @Autowired\tprivate OrderService orderService;public class Main public static void main(String[] args) AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(AppConfig.class); UserService userService = (UserService) context.getBean(userService); OrderService orderService = (OrderService) context.getBean(orderService); System.out.println(userService); System.out.println(orderService); å¯ä»¥çœ‹åˆ°æ‰§è¡Œç»“æœæ˜¯èƒ½å¤Ÿæ‰“å°å‡ºuserServiceå’ŒorderServiceå¯¹è±¡ï¼Œä¸Šé¢ä»£ç ä¸­userServiceå’ŒorderServiceäº’ç›¸ä¾èµ–äº§ç”Ÿäº†å¾ªç¯ä¾èµ–ï¼Œæ€ä¹ˆå»è§£å†³è¿™ç§å¾ªç¯ä¾èµ–å‘¢ï¼Ÿ æˆ‘ä»¬æƒ³è±¡ä¸‹å¦‚æœåŠ å…¥ä¸€ä¸ªä¸­é—´ç¼“å­˜ï¼Œåœ¨åˆ›å»ºAçš„è¿‡ç¨‹ä¸­æŠŠAåŠ å…¥ç¼“å­˜ï¼Œå†åˆ›å»ºBæ—¶ä¾èµ–Aåªéœ€è¦ä»ç¼“å­˜ä¸­æŠŠAå–å‡ºå°±å¯ä»¥äº†ã€‚è¿™æ ·å¾ªç¯å°±å¾ˆç®€å•çš„æ‰“ç ´äº†ã€‚ é€šè¿‡ä¸Šé¢åˆ†æåªè¦äºŒçº§ç¼“å­˜å°±èƒ½ç»“æœå¾ªç¯ä¾èµ–çš„é—®é¢˜é‚£ä¸ºä»€ä¹ˆSpirngå¼•å…¥ä¸‰çº§ç¼“å­˜å‘¢ï¼Ÿå› ä¸ºSpringä¸­æœ‰çš„Beanéœ€è¦è¿›è¡ŒAOPå¤„ç†ï¼Œå¦‚æœä½¿ç”¨äºŒçº§ç¼“å­˜é‚£ä¹ˆæ³¨å…¥çš„å±æ€§è¿˜æ˜¯åŸå§‹å¯¹è±¡ä¸æ˜¯AOPåçš„ä»£ç†å¯¹è±¡ã€‚ Springä¸­æ€ä¹ˆé€šè¿‡ä¸‰çº§ç¼“å­˜å®ç°AOPä»£ç†å¯¹è±¡çš„æ³¨å…¥å‘¢ï¼Ÿ åœ¨å®ä¾‹åŒ–Beanåï¼Œä¼šå¾€singletonFactoriesä¸­æ·»åŠ ä¸€ä¸ª() - getEarlyBeanReference(beanName, mbd, bean) AbstractAutowireCapableBeanFactory.doCreateBean() protected Object doCreateBean(String beanName, RootBeanDefinition mbd, @Nullable Object[] args) throws BeanCreationException ...\tif (instanceWrapper == null) // å®ä¾‹åŒ–Beanå¯¹è±¡ instanceWrapper = createBeanInstance(beanName, mbd, args); ...\t// Eagerly cache singletons to be able to resolve circular references\t// even when triggered by lifecycle interfaces like BeanFactoryAware.\tboolean earlySingletonExposure = (mbd.isSingleton() this.allowCircularReferences isSingletonCurrentlyInCreation(beanName));\tif (earlySingletonExposure) if (logger.isTraceEnabled()) logger.trace(Eagerly caching bean + beanName + to allow for resolving potential circular references); // æ‰€æœ‰å•ä¾‹Beanéƒ½ä¼šæ·»åŠ ä¸€ä¸ªObjectFactory? singletonFactory // this.singletonFactories.put(beanName, singletonFactory); addSingletonFactory(beanName, () - getEarlyBeanReference(beanName, mbd, bean)); // Initialize the bean instance.\tObject exposedObject = bean;\ttry // å±æ€§æ³¨å…¥ populateBean(beanName, mbd, instanceWrapper); // åˆå§‹åŒ–Bean exposedObject = initializeBean(beanName, exposedObject, mbd); ... @Nullableprotected Object getSingleton(String beanName, boolean allowEarlyReference) // Quick check for existing instance without full singleton lock // å‡è®¾Aã€Bæœ‰å¾ªç¯ä¾èµ–ï¼Œä¸”Béœ€è¦AOPã€‚åˆ›å»ºAæ—¶éœ€è¦æ‹¿åˆ°Bå¯¹è±¡,è¿™é‡Œä»å•ä¾‹æ± ä¸­ç¬¬ä¸€æ¬¡æ˜¯æ‰¾ä¸åˆ°Bçš„\tObject singletonObject = this.singletonObjects.get(beanName); // isSingletonCurrentlyInCreation()è¿™ä¸ªæ–¹æ³•åˆ¤æ–­äº†æ˜¯å¦äº§ç”Ÿäº†å¾ªç¯ä¾èµ–\tif (singletonObject == null isSingletonCurrentlyInCreation(beanName)) // ç¬¬ä¸€æ¬¡è°ƒç”¨è¿™é‡Œä¹Ÿæ˜¯ç©º singletonObject = this.earlySingletonObjects.get(beanName); if (singletonObject == null allowEarlyReference) synchronized (this.singletonObjects) // Consistent creation of early reference within full singleton lock singletonObject = this.singletonObjects.get(beanName); if (singletonObject == null) singletonObject = this.earlySingletonObjects.get(beanName); if (singletonObject == null) // æ‹¿åˆ°ä¸‰çº§ç¼“å­˜ä¸­lambdaè¡¨è¾¾å¼ () - getEarlyBeanReference(beanName, mbd, bean) ObjectFactory? singletonFactory = this.singletonFactories.get(beanName); if (singletonFactory != null) // æ‰§è¡Œlambdaè¡¨è¾¾å¼-è°ƒç”¨AbstractAutowireCapableBeanFactory.getEarlyBeanReference()æ‹¿åˆ°å®ä¾‹åŒ–çš„Beanï¼Œå¦‚æœæ˜¯ä»£ç†ä»£ç†è¿”å›ä»£ç†å¯¹è±¡ singletonObject = singletonFactory.getObject(); this.earlySingletonObjects.put(beanName, singletonObject); this.singletonFactories.remove(beanName); return singletonObject; /** * Wrap the given bean if necessary, i.e. if it is eligible for being proxied. * @param bean the raw bean instance * @param beanName the name of the bean * @param cacheKey the cache key for metadata access * @return a proxy wrapping the bean, or the raw bean instance as-is */protected Object wrapIfNecessary(Object bean, String beanName, Object cacheKey) ...\t// Create proxy if we have advice. // åˆ¤æ–­æ˜¯å¦æœ‰adviceå¦‚æœæœ‰å°±å»åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œæ²¡æœ‰å°±ç›´æ¥è¿”å›æ™®é€šå¯¹è±¡\tObject[] specificInterceptors = getAdvicesAndAdvisorsForBean(bean.getClass(), beanName, null);\tif (specificInterceptors != DO_NOT_PROXY) this.advisedBeans.put(cacheKey, Boolean.TRUE); Object proxy = createProxy( bean.getClass(), beanName, specificInterceptors, new SingletonTargetSource(bean)); this.proxyTypes.put(cacheKey, proxy.getClass()); return proxy; this.advisedBeans.put(cacheKey, Boolean.FALSE);\treturn bean; æ€»ç»“ï¼š singletonObjectsï¼šç¼“å­˜ç»è¿‡äº†å®Œæ•´ç”Ÿå‘½å‘¨æœŸçš„bean earlySingletonObjectsï¼šç¼“å­˜æœªç»è¿‡å®Œæ•´ç”Ÿå‘½å‘¨æœŸçš„beanï¼Œå¦‚æœæŸä¸ªbeanå‡ºç°äº†å¾ªç¯ä¾èµ–ï¼Œå°±ä¼šæå‰æŠŠè¿™ä¸ªæš‚æ—¶æœªç»è¿‡å®Œæ•´ç”Ÿå‘½å‘¨æœŸçš„beanæ”¾å…¥earlySingletonObjectsä¸­ï¼Œè¿™ä¸ªbeanå¦‚æœè¦ç»è¿‡AOPï¼Œé‚£ä¹ˆå°±ä¼šæŠŠä»£ç†å¯¹è±¡æ”¾å…¥earlySingletonObjectsä¸­ï¼Œå¦åˆ™å°±æ˜¯æŠŠåŸå§‹å¯¹è±¡æ”¾å…¥earlySingletonObjectsã€‚ singletonFactoriesï¼šç¼“å­˜çš„æ˜¯ä¸€ä¸ªObjectFactoryï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªLambdaè¡¨è¾¾å¼ã€‚åœ¨æ¯ä¸ªBeançš„ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œç»è¿‡å®ä¾‹åŒ–å¾—åˆ°ä¸€ä¸ªåŸå§‹å¯¹è±¡åï¼Œéƒ½ä¼šæå‰åŸºäºåŸå§‹å¯¹è±¡æš´éœ²ä¸€ä¸ªLambdaè¡¨è¾¾å¼ï¼Œå¹¶ä¿å­˜åˆ°ä¸‰çº§ç¼“å­˜ä¸­ï¼Œè¿™ä¸ªLambdaè¡¨è¾¾å¼å¯èƒ½ç”¨åˆ°ï¼Œä¹Ÿå¯èƒ½ç”¨ä¸åˆ°ï¼Œå¦‚æœå½“å‰Beanæ²¡æœ‰å‡ºç°å¾ªç¯ä¾èµ–ï¼Œé‚£ä¹ˆè¿™ä¸ªLambdaè¡¨è¾¾å¼æ²¡ç”¨ï¼Œå½“å‰beanæŒ‰ç…§è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸæ­£å¸¸æ‰§è¡Œï¼Œæ‰§è¡Œå®Œåç›´æ¥æŠŠå½“å‰beanæ”¾å…¥singletonObjectsä¸­ï¼Œå¦‚æœå½“å‰beanåœ¨ä¾èµ–æ³¨å…¥æ—¶å‘ç°å‡ºç°äº†å¾ªç¯ä¾èµ–ï¼ˆå½“å‰æ­£åœ¨åˆ›å»ºçš„beanè¢«å…¶ä»–beanä¾èµ–äº†ï¼‰ï¼Œåˆ™ä»ä¸‰çº§ç¼“å­˜ä¸­æ‹¿åˆ°Lambdaè¡¨è¾¾å¼ï¼Œå¹¶æ‰§è¡ŒLambdaè¡¨è¾¾å¼å¾—åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶æŠŠå¾—åˆ°çš„å¯¹è±¡æ”¾å…¥äºŒçº§ç¼“å­˜ï¼ˆ(å¦‚æœå½“å‰Beanéœ€è¦AOPï¼Œé‚£ä¹ˆæ‰§è¡Œlambdaè¡¨è¾¾å¼ï¼Œå¾—åˆ°å°±æ˜¯å¯¹åº”çš„ä»£ç†å¯¹è±¡ï¼Œå¦‚æœæ— éœ€AOPï¼Œåˆ™ç›´æ¥å¾—åˆ°ä¸€ä¸ªåŸå§‹å¯¹è±¡)ï¼‰ã€‚","tags":[null],"categories":[null]},{"title":"Springæºç ç¼–è¯‘","path":"/wiki/Spring/Springæºç ç¼–è¯‘.html","content":"1. ä¸‹è½½æºç Springå®˜æ–¹æ–‡æ¡£ç¼–è¯‘æºç æ­¥éª¤ï¼šhttps://github.com/spring-projects/spring-framework/wiki/Build-from-Source åŸºç¡€ç¯å¢ƒ ç‰ˆæœ¬ æ“ä½œç³»ç»Ÿ Windows 11 Springæºç  6.1.11 Javaç¯å¢ƒ JDK 17ã€JDK 21 ç¼–è¯‘å·¥å…· Gradle 8.9 å¼€å‘å·¥å…· IDEA 2024.1.1 ç‰ˆæœ¬ç®¡ç† Git git clone git@github.com:spring-projects/spring-framework.gitcd spring-framework 2. ä¿®æ”¹é…ç½®é…ç½®Gradleä¸‹è½½åŠ é€Ÿ åœ¨gradle-8.9\\init.dæ–‡ä»¶å¤¹ä¸‹æ–°å¢init.gradleæ–‡ä»¶ allprojects repositories maven url file:///D:/work/tools/gradle/repository // æœ¬åœ°ä»“åº“åœ°å€ï¼Œå¦‚æœæ²¡æœ‰ä¾æ¬¡å‘ä¸‹å¯»æ‰¾ maven url https://maven.aliyun.com/repository/public mavenLocal() mavenCentral() buildscript repositories maven url https://maven.aliyun.com/repository/public mavenLocal() mavenCentral() ä¿®æ”¹ideaä¸­Gradleé…ç½® maven url https://maven.aliyun.com/repository/public // é˜¿é‡Œäº‘é•œåƒä»“åº“ é…ç½®é•œåƒåŠ é€Ÿ pluginManagement repositories //æ–°å¢é˜¿é‡Œäº‘é•œåƒåœ°å€ maven url https://maven.aliyun.com/repository/public mavenCentral() gradlePluginPortal() maven url https://repo.spring.io/release 3. ç¼–è¯‘æºç æ ¹æ®import-into-idea.mdæ–‡ä»¶æŒ‡å¯¼ï¼Œæ‰§è¡Œ./gradlew :spring-oxm:compileTestJava æ³¨æ„ä»£ç†è®¾ç½®ï¼š ç¼–è¯‘å®Œæˆååˆ·æ–°ä¸‹ 4. æ’é™¤spring-aspects 5. æ–°å¢demoæ¨¡å—å¼•å…¥spring-contextä¾èµ–ï¼Œè¿›è¡Œæµ‹è¯•ã€‚ git config â€“global http.proxy http://127.0.0.1:17890git config â€“global https.proxy â€˜http://127.0.0.1:17890â€˜ ORgit config â€“global http.proxy â€˜socks5:127.0.0.1:10808â€™git config â€“global https.proxy â€˜socks5:127.0.0.1:10808â€™","tags":[null],"categories":[null]},{"title":"æ•°ç»„é¢˜è§£","path":"/wiki/leetcode/array.html","content":"704. äºŒåˆ†æŸ¥æ‰¾https://leetcode.com/problems/binary-search/ ç»™å®šä¸€ä¸ª n ä¸ªå…ƒç´ æœ‰åºçš„ï¼ˆå‡åºï¼‰æ•´å‹æ•°ç»„ nums å’Œä¸€ä¸ªç›®æ ‡å€¼ target ï¼Œå†™ä¸€ä¸ªå‡½æ•°æœç´¢ nums ä¸­çš„ targetï¼Œå¦‚æœç›®æ ‡å€¼å­˜åœ¨è¿”å›ä¸‹æ ‡ï¼Œå¦åˆ™è¿”å› -1ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: nums = [-1,0,3,5,9,12], target = 9 è¾“å‡º: 4 è§£é‡Š: 9 å‡ºç°åœ¨ nums ä¸­å¹¶ä¸”ä¸‹æ ‡ä¸º 4 ç¤ºä¾‹ 2: è¾“å…¥: nums = [-1,0,3,5,9,12], target = 2 è¾“å‡º: -1 è§£é‡Š: 2 ä¸å­˜åœ¨ nums ä¸­å› æ­¤è¿”å› -1 æç¤ºï¼š ä½ å¯ä»¥å‡è®¾ nums ä¸­çš„æ‰€æœ‰å…ƒç´ æ˜¯ä¸é‡å¤çš„ã€‚ n å°†åœ¨ [1, 10000]ä¹‹é—´ã€‚ nums çš„æ¯ä¸ªå…ƒç´ éƒ½å°†åœ¨ [-9999, 9999]ä¹‹é—´ã€‚ class Solution public int search(int[] nums, int target) int len = nums.length; int left = 0; int right = len - 1; while (left = right) int mid = left + (right - left) / 2; if (nums[mid] == target) return mid; else if (nums[mid] target) left = mid + 1; else if (nums[mid] target) right = mid - 1; return -1; func search(nums []int, target int) int left := 0 right := len(nums) - 1 for left = right mid := left + (right - left) / 2 if nums[mid] == target return mid else if nums[mid] target left = mid + 1 else right = mid - 1 return -1 27. ç§»é™¤å…ƒç´ åŠ›æ‰£é¢˜ç›®é“¾æ¥(opens new window) ç»™ä½ ä¸€ä¸ªæ•°ç»„ nums å’Œä¸€ä¸ªå€¼ valï¼Œä½ éœ€è¦ åŸåœ° ç§»é™¤æ‰€æœ‰æ•°å€¼ç­‰äº val çš„å…ƒç´ ï¼Œå¹¶è¿”å›ç§»é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚ ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»ä»…ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´å¹¶åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„ã€‚ å…ƒç´ çš„é¡ºåºå¯ä»¥æ”¹å˜ã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚ ç¤ºä¾‹ 1: ç»™å®š nums [3,2,2,3], val 3, å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 2, å¹¶ä¸” nums ä¸­çš„å‰ä¸¤ä¸ªå…ƒç´ å‡ä¸º 2ã€‚ ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚ ç¤ºä¾‹ 2: ç»™å®š nums [0,1,2,2,3,0,4,2], val 2, å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 5, å¹¶ä¸” nums ä¸­çš„å‰äº”ä¸ªå…ƒç´ ä¸º 0, 1, 3, 0, 4ã€‚ ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚ func removeElement(nums []int, val int) int slow := 0 len := len(nums) for fast:=0; fast len; fast++ if nums[fast] != val nums[slow] = nums[fast] slow++ return slow 26. åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹https://leetcode.com/problems/remove-duplicates-from-sorted-array/description/ Given an integer array nums sorted in non-decreasing order, remove the duplicates in-place such that each unique element appears only once. The relative order of the elements should be kept the same. Then return the number of unique elements in nums. Consider the number of unique elements of nums to be k, to get accepted, you need to do the following things: Change the array nums such that the first k elements of nums contain the unique elements in the order they were present in nums initially. The remaining elements of nums are not important as well as the size of nums. Return k. Custom Judge: The judge will test your solution with the following code: int[] nums = [...]; // Input arrayint[] expectedNums = [...]; // The expected answer with correct lengthint k = removeDuplicates(nums); // Calls your implementationassert k == expectedNums.length;for (int i = 0; i k; i++) assert nums[i] == expectedNums[i]; If all assertions pass, then your solution will be accepted. Example 1: Input: nums = [1,1,2]Output: 2, nums = [1,2,_]Explanation: Your function should return k = 2, with the first two elements of nums being 1 and 2 respectively.It does not matter what you leave beyond the returned k (hence they are underscores). Example 2: Input: nums = [0,0,1,1,1,2,2,3,3,4]Output: 5, nums = [0,1,2,3,4,_,_,_,_,_]Explanation: Your function should return k = 5, with the first five elements of nums being 0, 1, 2, 3, and 4 respectively.It does not matter what you leave beyond the returned k (hence they are underscores). func removeDuplicates(nums []int) int slow := 0 len := len(nums) for fast := 1; fast len; fast++ // [0,1,2,3,4,2,2,3,3,4] if nums[slow] != nums[fast] slow++ nums[slow] = nums[fast] return slow + 1 283. ç§»é™¤0Given an integer array nums, move all 0â€˜s to the end of it while maintaining the relative order of the non-zero elements. Note that you must do this in-place without making a copy of the array. Example 1: Input: nums = [0,1,0,3,12]Output: [1,3,12,0,0] Example 2: Input: nums = [0]Output: [0] Constraints: 1 = nums.length = 104 -231 = nums[i] = 231 - 1 func moveZeroes(nums []int) slow := 0\tlen := len(nums)\tfor fast := 0; fast len; fast++ // [3,12,0,3,12,0] if nums[fast] != 0 nums[slow] = nums[fast] slow++ for i := slow; i len; i++ nums[i] = 0 977. æœ‰åºæ•°ç»„çš„å¹³æ–¹https://leetcode.com/problems/squares-of-a-sorted-array/description/ Given an integer array nums sorted in non-decreasing order, return an array of the squares of each number sorted in non-decreasing order. Example 1: Input: nums = [-4,-1,0,3,10]Output: [0,1,9,16,100]Explanation: After squaring, the array becomes [16,1,0,9,100].After sorting, it becomes [0,1,9,16,100]. Example 2: Input: nums = [-7,-3,2,3,11]Output: [4,9,9,49,121] func sortedSquares(nums []int) []int left := 0\tlen := len(nums)\tright := len - 1 res := make([]int, len)\tfor i := len - 1; i = 0; i-- lr := nums[left] * nums[left] rr := nums[right] * nums[right] if lr rr res[i] = lr left++ else res[i] = rr right-- return res 209. é•¿åº¦æœ€å°çš„å­æ•°ç»„Given an array of positive integers nums and a positive integer target, return the minimal length of a subarray whose sum is greater than or equal to target. If there is no such subarray, return 0 instead. Example 1: Input: target = 7, nums = [2,3,1,2,4,3]Output: 2Explanation: The subarray [4,3] has the minimal length under the problem constraint. Example 2: Input: target = 4, nums = [1,4,4]Output: 1 Example 3: Input: target = 11, nums = [1,1,1,1,1,1,1,1]Output: 0 func minSubArrayLen(target int, nums []int) int slow := 0\tlen := len(nums)\tsum := 0\tres := math.MaxInt\tfor fast := 0; fast len; fast++ sum += nums[fast] for sum = target k := fast - slow + 1 if res k res = k sum = sum - nums[slow] slow++ if res == math.MaxInt res = 0 return res","tags":[null],"categories":[null]},{"title":"æ•°ç»„é¢˜è§£","path":"/wiki/leetcode/binary_tree.html","content":"äºŒå‰æ ‘åŸºæœ¬å®šä¹‰åŸºæœ¬æ¦‚å¿µâ€ŒäºŒå‰æ ‘â€Œæ˜¯ä¸€ç§æ ‘å½¢æ•°æ®ç»“æ„ï¼Œæ»¡è¶³ï¼š â€Œæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰2ä¸ªå­èŠ‚ç‚¹â€Œï¼Œç§°ä¸ºâ€Œå·¦å­èŠ‚ç‚¹â€Œå’Œâ€Œå³å­èŠ‚ç‚¹â€Œã€‚ â€Œå­æ ‘æœ‰ä¸¥æ ¼é¡ºåºâ€Œï¼šå·¦å­æ ‘å’Œå³å­æ ‘ä¸å¯äº’æ¢ï¼ˆå³ä½¿æŸä¸ªå­æ ‘ä¸ºç©ºï¼‰ã€‚ åº¦å®šä¹‰â€Œï¼šä¸€ä¸ªèŠ‚ç‚¹æ‹¥æœ‰çš„â€Œå­èŠ‚ç‚¹æ•°é‡â€Œã€‚ äºŒå‰æ ‘ä¸­çš„åº¦èŒƒå›´â€Œï¼š â€Œ0â€Œï¼ˆå¶å­èŠ‚ç‚¹ï¼Œæ— å­èŠ‚ç‚¹ï¼‰ â€Œ1â€Œï¼ˆåªæœ‰å·¦æˆ–å³å­èŠ‚ç‚¹ï¼‰ â€Œ2â€Œï¼ˆåŒæ—¶æœ‰å·¦å’Œå³å­èŠ‚ç‚¹ï¼‰ ç¤ºä¾‹â€Œï¼š Aï¼ˆåº¦=2ï¼‰ / \\Bï¼ˆåº¦=1ï¼‰ Cï¼ˆåº¦=0ï¼‰ \\ Dï¼ˆåº¦=0ï¼‰ äºŒå‰æ ‘ç§ç±»æ»¡äºŒå‰æ ‘æ»¡äºŒå‰æ ‘ï¼šå¦‚æœä¸€æ£µäºŒå‰æ ‘åªæœ‰åº¦ä¸º0çš„ç»“ç‚¹å’Œåº¦ä¸º2çš„ç»“ç‚¹ï¼Œå¹¶ä¸”åº¦ä¸º0çš„ç»“ç‚¹åœ¨åŒä¸€å±‚ä¸Šï¼Œåˆ™è¿™æ£µäºŒå‰æ ‘ä¸ºæ»¡äºŒå‰æ ‘ã€‚ A / \\ B C/ \\ / \\D E F G å®Œå…¨äºŒå‰æ ‘å®Œå…¨äºŒå‰æ ‘ï¼šé™¤æœ€åä¸€å±‚å¤–ï¼Œå…¶ä»–å±‚èŠ‚ç‚¹å…¨æ»¡ï¼Œä¸”æœ€åä¸€å±‚èŠ‚ç‚¹â€Œå‘å·¦å¯¹é½â€Œã€‚ A / \\ B C/ \\ /D E F äºŒå‰æ ‘çš„å­˜å‚¨æ–¹å¼äºŒå‰æ ‘å¯ä»¥é“¾å¼å­˜å‚¨ï¼Œä¹Ÿå¯ä»¥é¡ºåºå­˜å‚¨ã€‚ é‚£ä¹ˆé“¾å¼å­˜å‚¨æ–¹å¼å°±ç”¨æŒ‡é’ˆï¼Œ é¡ºåºå­˜å‚¨çš„æ–¹å¼å°±æ˜¯ç”¨æ•°ç»„ã€‚ é¡¾åæ€ä¹‰å°±æ˜¯é¡ºåºå­˜å‚¨çš„å…ƒç´ åœ¨å†…å­˜æ˜¯è¿ç»­åˆ†å¸ƒçš„ï¼Œè€Œé“¾å¼å­˜å‚¨åˆ™æ˜¯é€šè¿‡æŒ‡é’ˆæŠŠåˆ†å¸ƒåœ¨å„ä¸ªåœ°å€çš„èŠ‚ç‚¹ä¸²è”ä¸€èµ·ã€‚ é“¾å¼å­˜å‚¨å¦‚å›¾ï¼š é¡ºåºå­˜å‚¨å…¶å®å°±æ˜¯ç”¨æ•°ç»„æ¥å­˜å‚¨äºŒå‰æ ‘ï¼Œé¡ºåºå­˜å‚¨çš„æ–¹å¼å¦‚å›¾ï¼š äºŒå‰æ ‘çš„éå†äºŒå‰æ ‘ä¸»è¦æœ‰ä¸¤ç§éå†æ–¹å¼ï¼š æ·±åº¦ä¼˜å…ˆéå†ï¼šå…ˆå¾€æ·±èµ°ï¼Œé‡åˆ°å¶å­èŠ‚ç‚¹å†å¾€å›èµ°ã€‚ å¹¿åº¦ä¼˜å…ˆéå†ï¼šä¸€å±‚ä¸€å±‚çš„å»éå†ã€‚ æ·±åº¦ä¼˜å…ˆéå†ï¼š å‰åºéå†ï¼ˆé€’å½’æ³•ï¼Œè¿­ä»£æ³•ï¼‰ ä¸­åºéå†ï¼ˆé€’å½’æ³•ï¼Œè¿­ä»£æ³•ï¼‰ ååºéå†ï¼ˆé€’å½’æ³•ï¼Œè¿­ä»£æ³•ï¼‰ è¿™é‡Œå‰ä¸­åï¼Œå…¶å®æŒ‡çš„å°±æ˜¯ä¸­é—´èŠ‚ç‚¹çš„éå†é¡ºåºï¼Œåªè¦å¤§å®¶è®°ä½ å‰ä¸­ååºæŒ‡çš„å°±æ˜¯ä¸­é—´èŠ‚ç‚¹çš„ä½ç½®å°±å¯ä»¥äº†ã€‚ çœ‹å¦‚ä¸‹ä¸­é—´èŠ‚ç‚¹çš„é¡ºåºï¼Œå°±å¯ä»¥å‘ç°ï¼Œä¸­é—´èŠ‚ç‚¹çš„é¡ºåºå°±æ˜¯æ‰€è°“çš„éå†æ–¹å¼ å‰åºéå†ï¼šä¸­å·¦å³ ä¸­åºéå†ï¼šå·¦ä¸­å³ ååºéå†ï¼šå·¦å³ä¸­ å¹¿åº¦ä¼˜å…ˆéå†ï¼š å±‚æ¬¡éå†ï¼ˆè¿­ä»£æ³•ï¼‰ äºŒå‰æ ‘ç›¸å…³é¢˜ç›®ï¼Œç»å¸¸ä¼šä½¿ç”¨é€’å½’çš„æ–¹å¼æ¥å®ç°æ·±åº¦ä¼˜å…ˆéå†ï¼Œä¹Ÿå°±æ˜¯å®ç°å‰ä¸­ååºéå†ï¼Œä½¿ç”¨é€’å½’æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„ã€‚ è€Œå¹¿åº¦ä¼˜å…ˆéå†çš„å®ç°ä¸€èˆ¬ä½¿ç”¨é˜Ÿåˆ—æ¥å®ç°ï¼Œè¿™ä¹Ÿæ˜¯é˜Ÿåˆ—å…ˆè¿›å…ˆå‡ºçš„ç‰¹ç‚¹æ‰€å†³å®šçš„ï¼Œå› ä¸ºéœ€è¦å…ˆè¿›å…ˆå‡ºçš„ç»“æ„ï¼Œæ‰èƒ½ä¸€å±‚ä¸€å±‚çš„æ¥éå†äºŒå‰æ ‘ã€‚ äºŒå‰æ ‘å®šä¹‰public class TreeNode int val; TreeNode left; TreeNode right; TreeNode() TreeNode(int val) this.val = val; TreeNode(int val, TreeNode left, TreeNode right) this.val = val; this.left = left; this.right = right; class TreeNode: def __init__(self, val, left = None, right = None): self.val = val self.left = left self.right = right type TreeNode struct Val int Left *TreeNode Right *TreeNode function TreeNode(val, left, right) this.val = (val===undefined ? 0 : val) this.left = (left===undefined ? null : left) this.right = (right===undefined ? null : right) docker run -d â€“name weaviate-dev -e AUTHENTICATION_APIKEY_ENABLEDâ€trueâ€ -e AUTHENTICATION_APIKEYâ€your_api_keyâ€ -p 8080:8080 -p 50051:50051 semitechnologiesweaviate","tags":[null],"categories":[null]},{"title":"å“ˆå¸Œè¡¨é¢˜è§£","path":"/wiki/leetcode/hash.html","content":"242.æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯https://leetcode.com/problems/valid-anagram/description/ ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ t ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­ t æ˜¯å¦æ˜¯ s çš„å­—æ¯å¼‚ä½è¯ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: s â€œanagramâ€, t â€œnagaramâ€ è¾“å‡º: true ç¤ºä¾‹ 2: è¾“å…¥: s â€œratâ€, t â€œcarâ€ è¾“å‡º: false è¯´æ˜: ä½ å¯ä»¥å‡è®¾å­—ç¬¦ä¸²åªåŒ…å«å°å†™å­—æ¯ã€‚ æ€è·¯ï¼š å®šä¹‰ä¸€ä¸ªæ•°ç»„å«åšrecordç”¨æ¥ä¸Šè®°å½•å­—ç¬¦ä¸²sé‡Œå­—ç¬¦å‡ºç°çš„æ¬¡æ•°ã€‚ éœ€è¦æŠŠå­—ç¬¦æ˜ å°„åˆ°æ•°ç»„ä¹Ÿå°±æ˜¯å“ˆå¸Œè¡¨çš„ç´¢å¼•ä¸‹æ ‡ä¸Šï¼Œå› ä¸ºå­—ç¬¦aåˆ°å­—ç¬¦zçš„ASCIIæ˜¯26ä¸ªè¿ç»­çš„æ•°å€¼ï¼Œæ‰€ä»¥å­—ç¬¦aæ˜ å°„ä¸ºä¸‹æ ‡0ï¼Œç›¸åº”çš„å­—ç¬¦zæ˜ å°„ä¸ºä¸‹æ ‡25ã€‚ å†éå† å­—ç¬¦ä¸²sçš„æ—¶å€™ï¼Œåªéœ€è¦å°† s[i] - â€˜aâ€™ æ‰€åœ¨çš„å…ƒç´ åš+1 æ“ä½œå³å¯ï¼Œå¹¶ä¸éœ€è¦è®°ä½å­—ç¬¦açš„ASCIIï¼Œåªè¦æ±‚å‡ºä¸€ä¸ªç›¸å¯¹æ•°å€¼å°±å¯ä»¥äº†ã€‚ è¿™æ ·å°±å°†å­—ç¬¦ä¸²sä¸­å­—ç¬¦å‡ºç°çš„æ¬¡æ•°ï¼Œç»Ÿè®¡å‡ºæ¥äº†ã€‚ é‚£çœ‹ä¸€ä¸‹å¦‚ä½•æ£€æŸ¥å­—ç¬¦ä¸²tä¸­æ˜¯å¦å‡ºç°äº†è¿™äº›å­—ç¬¦ï¼ŒåŒæ ·åœ¨éå†å­—ç¬¦ä¸²tçš„æ—¶å€™ï¼Œå¯¹tä¸­å‡ºç°çš„å­—ç¬¦æ˜ å°„å“ˆå¸Œè¡¨ç´¢å¼•ä¸Šçš„æ•°å€¼å†åš-1çš„æ“ä½œã€‚ é‚£ä¹ˆæœ€åæ£€æŸ¥ä¸€ä¸‹ï¼Œrecordæ•°ç»„å¦‚æœæœ‰çš„å…ƒç´ ä¸ä¸ºé›¶0ï¼Œè¯´æ˜å­—ç¬¦ä¸²så’Œtä¸€å®šæ˜¯è°å¤šäº†å­—ç¬¦æˆ–è€…è°å°‘äº†å­—ç¬¦ï¼Œreturn falseã€‚ æœ€åå¦‚æœrecordæ•°ç»„æ‰€æœ‰å…ƒç´ éƒ½ä¸ºé›¶0ï¼Œè¯´æ˜å­—ç¬¦ä¸²så’Œtæ˜¯å­—æ¯å¼‚ä½è¯ï¼Œreturn trueã€‚ æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œç©ºé—´ä¸Šå› ä¸ºå®šä¹‰æ˜¯çš„ä¸€ä¸ªå¸¸é‡å¤§å°çš„è¾…åŠ©æ•°ç»„ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦ä¸ºO(1)ã€‚ class Solution public boolean isAnagram(String s, String t) int sLen = s.length(); int tLen = t.length(); if (sLen != tLen) return false; int[] records = new int[26]; for (int i = 0; i sLen; i++) records[s.charAt(i) - a]++; for (int i = 0; i tLen; i++) records[t.charAt(i) - a]--; for (int record : records) if (record != 0) return false; return true; func isAnagram(s string, t string) bool if len(s) != len(t) return false records := [26]int\tfor _, v := range s records[v-a]++ for _, v := range t records[(v-a)]-- for _, v := range records if v != 0 return false return true 349. ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†https://leetcode.com/problems/intersection-of-two-arrays/ é¢˜æ„ï¼šç»™å®šä¸¤ä¸ªæ•°ç»„ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—å®ƒä»¬çš„äº¤é›†ã€‚ è¯´æ˜ï¼š è¾“å‡ºç»“æœä¸­çš„æ¯ä¸ªå…ƒç´ ä¸€å®šæ˜¯å”¯ä¸€çš„ã€‚ æˆ‘ä»¬å¯ä»¥ä¸è€ƒè™‘è¾“å‡ºç»“æœçš„é¡ºåºã€‚ class Solution public int[] intersection(int[] nums1, int[] nums2) SetInteger set = new HashSet(); SetInteger resSet = new HashSet(); for (int num : nums1) set.add(num); for (int num : nums2) if (set.contains(num)) resSet.add(num); return resSet.stream().mapToInt(x - x).toArray(); func intersection(nums1 []int, nums2 []int) []int // æ¨¡æ‹Ÿseté›†åˆ\tset := make(map[int]struct)\tres := make([]int, 0) // nums = 1,2,2,1 // nums2 = 2,2,2\tfor _, v := range nums1 if _, ok := set[v]; !ok // 1 : struct // 2 : struct set[v] = struct for _, v := range nums2 if _, ok := set[v]; ok res = append(res, v) // æ³¨æ„è¦åˆ é™¤ delete(set, v) return res 202. å¿«ä¹æ•°https://leetcode.com/problems/happy-number/submissions/1364131847/ ç¼–å†™ä¸€ä¸ªç®—æ³•æ¥åˆ¤æ–­ä¸€ä¸ªæ•° n æ˜¯ä¸æ˜¯å¿«ä¹æ•°ã€‚ ã€Œå¿«ä¹æ•°ã€å®šä¹‰ä¸ºï¼šå¯¹äºä¸€ä¸ªæ­£æ•´æ•°ï¼Œæ¯ä¸€æ¬¡å°†è¯¥æ•°æ›¿æ¢ä¸ºå®ƒæ¯ä¸ªä½ç½®ä¸Šçš„æ•°å­—çš„å¹³æ–¹å’Œï¼Œç„¶åé‡å¤è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°è¿™ä¸ªæ•°å˜ä¸º 1ï¼Œä¹Ÿå¯èƒ½æ˜¯ æ— é™å¾ªç¯ ä½†å§‹ç»ˆå˜ä¸åˆ° 1ã€‚å¦‚æœ å¯ä»¥å˜ä¸º 1ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å°±æ˜¯å¿«ä¹æ•°ã€‚ å¦‚æœ n æ˜¯å¿«ä¹æ•°å°±è¿”å› True ï¼›ä¸æ˜¯ï¼Œåˆ™è¿”å› False ã€‚ ç¤ºä¾‹ï¼š è¾“å…¥ï¼š19è¾“å‡ºï¼štrueè§£é‡Šï¼š1^2 + 9^2 828^2 + 2^2 686^2 + 8^2 1001^2 + 0^2 + 0^2 1 func isHappy(n int) bool set := make(map[int]bool)\tfor !set[n] if n == 1 return true set[n] = true n = getSum(n) return falsefunc getSum(n int) int sum := 0\tfor n 0 digit := n % 10 sum += digit * digit n /= 10 return sum 1. ä¸¤æ•°ä¹‹å’ŒåŠ›æ‰£é¢˜ç›®é“¾æ¥(opens new window) ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡ºå’Œä¸ºç›®æ ‡å€¼çš„é‚£ ä¸¤ä¸ª æ•´æ•°ï¼Œå¹¶è¿”å›ä»–ä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚ ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œæ•°ç»„ä¸­åŒä¸€ä¸ªå…ƒç´ ä¸èƒ½ä½¿ç”¨ä¸¤éã€‚ ç¤ºä¾‹: ç»™å®š nums [2, 7, 11, 15], target 9 å› ä¸º nums[0] + nums[1] 2 + 7 9 æ‰€ä»¥è¿”å› [0, 1] func twoSum(nums []int, target int) []int m := make(map[int]int) for i, num := range nums m[num] = i for i, num := range nums v, ok := m[target - num] // æ³¨æ„éœ€è¦åˆ¤æ–­æ˜¯å¦æ˜¯æœ¬èº« if ok v != i return []inti, v return nil","tags":[null],"categories":[null]},{"title":"é“¾è¡¨é¢˜è§£","path":"/wiki/leetcode/link.html","content":"203.ç§»é™¤é“¾è¡¨å…ƒç´ https://leetcode.com/problems/remove-linked-list-elements/ é¢˜ç›®ï¼š ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ head å’Œä¸€ä¸ªæ•´æ•° val ï¼Œè¯·ä½ åˆ é™¤é“¾è¡¨ä¸­æ‰€æœ‰æ»¡è¶³ Node.val == val çš„èŠ‚ç‚¹ï¼Œå¹¶è¿”å› æ–°çš„å¤´èŠ‚ç‚¹ ã€‚ ç¤ºä¾‹ 1: è¾“å…¥ï¼šhead = [1,2,6,3,4,5,6], val = 6è¾“å‡ºï¼š[1,2,3,4,5] ç¤ºä¾‹ 2: è¾“å…¥ï¼šhead = [], val = 1è¾“å‡ºï¼š[] ç¤ºä¾‹ 3: è¾“å…¥ï¼šhead = [7,7,7,7], val = 7è¾“å‡ºï¼š[] æ€è·¯ï¼š åˆ¤æ–­é“¾è¡¨ä¸­ç¬¦åˆvalå€¼çš„æ•°ï¼Œåªè¦éå†é“¾è¡¨æ—¶è·å–é“¾è¡¨å€¼ç„¶åæ¯”å¯¹valå€¼å°±å¯è¿›è¡Œåˆ¤æ–­ã€‚ è¦ç§»é™¤é“¾è¡¨ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåªè¦çŸ¥é“é“¾è¡¨å½“å‰èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹æŒ‡é’ˆå°±è¡Œã€‚è®©ä¸Šä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å°±å¯åˆ å»å½“å‰èŠ‚ç‚¹ã€‚å¦‚æœåˆ¤æ–­ä¸ç¬¦åˆåˆ é™¤æ¡ä»¶ï¼Œéœ€è¦ç§»åŠ¨å‰ç½®æŒ‡é’ˆã€‚å½“å‰æŒ‡é’ˆæ— è®ºæ˜¯å¦åˆ é™¤éƒ½éœ€ç§»åŠ¨ä¸‹ä¸€ä½ã€‚ if (curNode.val == val) preNode.next = curNode.next else preNode = curNode;curNode = curNode.next; è€ƒè™‘åˆ°å¤´èŠ‚ç‚¹å¦‚æœç¬¦åˆvalå€¼æ—¶ï¼Œéœ€è¦åˆ é™¤å¤´èŠ‚ç‚¹ã€‚è¿™ä¸ªæ—¶å€™éœ€è¦åˆ›å»ºä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹æ¥æŒ‡å‘å¤´èŠ‚ç‚¹ã€‚ ListNode dummyNode = new ListNode(-1);dummyNode.next = head; é¢˜è§£ï¼š /** * Definition for singly-linked list. * public class ListNode * int val; * ListNode next; * ListNode() * ListNode(int val) this.val = val; * ListNode(int val, ListNode next) this.val = val; this.next = next; * */class Solution public ListNode removeElements(ListNode head, int val) // è™šæ‹ŸæŒ‡é’ˆæŒ‡å‘å¤´èŠ‚ç‚¹ ListNode dummyNode = new ListNode(-1); dummyNode.next = head; // å½“å‰æŒ‡é’ˆ ListNode curNode = head; // å‰ç½®æŒ‡é’ˆ ListNode preNode = dummyNode; // åˆ¤æ–­é“¾è¡¨æ˜¯å¦éå†å®Œæˆ while(curNode != null) if (curNode.val == val) // åˆ é™¤å½“å‰èŠ‚ç‚¹ preNode.next = curNode.next; else // ç§»åŠ¨å‰ç½®æŒ‡é’ˆ preNode = curNode; // ç§»åŠ¨å½“å‰æŒ‡é’ˆ curNode = curNode.next; return dummyNode.next; /** * Definition for singly-linked list. * type ListNode struct * Val int * Next *ListNode * */func removeElements(head *ListNode, val int) *ListNode dummyNode := ListNode dummyNode.Next = head cur := head pre := dummyNode for cur != nil next := cur.Next v := cur.Val if v == val pre.Next = next else pre = cur cur = next return dummyNode.Next 206.åè½¬é“¾è¡¨https://leetcode.com/problems/reverse-linked-list/description/ é¢˜ç›®ï¼šåè½¬ä¸€ä¸ªå•é“¾è¡¨ã€‚ ç¤ºä¾‹: è¾“å…¥: 1-2-3-4-5-NULL è¾“å‡º: 5-4-3-2-1-NULL æ€è·¯: è¦ç¿»è½¬é“¾è¡¨ï¼Œå³è¦åä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚ä½†æ˜¯ä¿®æ”¹åä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆæ—¶è¦ä¿å­˜å¥½åä¸€ä¸ªèŠ‚ç‚¹åŸå…ˆçš„æŒ‡å‘ï¼Œä¸è¦é“¾è¡¨å°±éå†ä¸äº†äº†ã€‚ å¯ä»¥ä½¿ç”¨åŒæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å½“å‰èŠ‚ç‚¹ï¼Œä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘åä¸€ä¸ªèŠ‚ç‚¹ã€‚ åä¸€ä¸ªèŠ‚ç‚¹ä»headèŠ‚ç‚¹å¼€å§‹ï¼Œå½“å‰èŠ‚ç‚¹ä¸ºnullã€‚ä¿è¯headèŠ‚ç‚¹æŒ‡å‘nullã€‚ é¢˜è§£: /** * Definition for singly-linked list. * public class ListNode * int val; * ListNode next; * ListNode() * ListNode(int val) this.val = val; * ListNode(int val, ListNode next) this.val = val; this.next = next; * */class Solution public ListNode reverseList(ListNode head) // åä¸€ä¸ªèŠ‚ç‚¹ ListNode post = head; // å½“å‰èŠ‚ç‚¹ ListNode cur = null; while (post != null) // ä¿å­˜åä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘ ListNode next = post.next; // åä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘å½“å‰èŠ‚ç‚¹ï¼Œç¿»è½¬ post.next = cur; // ç§»åŠ¨å½“å‰èŠ‚ç‚¹æŒ‡é’ˆ cur = post; // ç§»åŠ¨åä¸€ä¸ªèŠ‚ç‚¹æŒ‡é’ˆ post = next; return cur; /** * Definition for singly-linked list. * type ListNode struct * Val int * Next *ListNode * */func reverseList(head *ListNode) *ListNode fast := head var slow *ListNode for fast != nil // ä¿ç•™Next next := fast.Next fast.Next = slow slow = fast fast = next return slow 24.ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹https://leetcode.com/problems/swap-nodes-in-pairs/description/ é¢˜ç›®ï¼š ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œä¸¤ä¸¤äº¤æ¢å…¶ä¸­ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œå¹¶è¿”å›äº¤æ¢åçš„é“¾è¡¨ã€‚ ä½ ä¸èƒ½åªæ˜¯å•çº¯çš„æ”¹å˜èŠ‚ç‚¹å†…éƒ¨çš„å€¼ï¼Œè€Œæ˜¯éœ€è¦å®é™…çš„è¿›è¡ŒèŠ‚ç‚¹äº¤æ¢ã€‚ æ€è·¯ï¼š è€ƒè™‘åˆ°å¤´èŠ‚ç‚¹ä¸ºç©ºçš„æƒ…å†µï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ å¯ä»¥ä½¿ç”¨åŒæŒ‡é’ˆcurã€postã€‚curæŒ‡å‘è™šæ‹ŸèŠ‚ç‚¹ï¼ŒpostæŒ‡å‘å¤´èŠ‚ç‚¹ é‡å¤èŠ‚ç‚¹äº¤æ¢ ç§»åŠ¨curå’Œpost æ³¨æ„ï¼šcurç§»åŠ¨æ—¶æ˜¯ç§»åŠ¨åˆ°postä¹‹å‰æŒ‡å‘çš„ä½ç½® é¢˜è§£ï¼š /** * Definition for singly-linked list. * public class ListNode * int val; * ListNode next; * ListNode() * ListNode(int val) this.val = val; * ListNode(int val, ListNode next) this.val = val; this.next = next; * */class Solution public ListNode swapPairs(ListNode head) ListNode dummy = new ListNode(-1); dummy.next = head; ListNode cur = dummy; ListNode post = head; while (post != null post.next != null) ListNode next = post.next; ListNode nextnext = next.next; cur.next = next; next.next = post; post.next = nextnext; // æ³¨æ„ï¼šcuræŒ‡é’ˆæŒ‡å‘postä¹‹å‰æŒ‡å‘çš„ä½ç½® cur = post; post = nextnext; return dummy.next; /** * Definition for singly-linked list. * type ListNode struct * Val int * Next *ListNode * */func swapPairs(head *ListNode) *ListNode if head == nil || head.Next == nil return head dummy := ListNode\tslow := dummy\tfast := head\tfor fast != nil fast.Next != nil next := fast.Next next2 := fast.Next.Next slow.Next = next next.Next = fast fast.Next = next2 slow = fast fast = next2 return dummy.Next 19. åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹https://leetcode.com/problems/remove-nth-node-from-end-of-list/description/ é¢˜ç›®ï¼š ç»™ä½ ä¸€ä¸ªé“¾è¡¨ï¼Œåˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ n ä¸ªç»“ç‚¹ï¼Œå¹¶ä¸”è¿”å›é“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚ è¿›é˜¶ï¼šä½ èƒ½å°è¯•ä½¿ç”¨ä¸€è¶Ÿæ‰«æå®ç°å—ï¼Ÿ æ€è·¯ï¼š è€ƒè™‘åˆ°å¯èƒ½åˆ é™¤å¤´èŠ‚ç‚¹é‚£ä¹ˆå°±è¦åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿå¤´èŠ‚ç‚¹ åˆ é™¤æŸä¸ªèŠ‚ç‚¹å¯ä»¥è€ƒè™‘ä½¿ç”¨åŒæŒ‡é’ˆ åˆ é™¤å€’æ•°èŠ‚ç‚¹ï¼Œå¯ä»¥å®šä¹‰å¿«ã€æ…¢æŒ‡é’ˆã€‚åˆ é™¤å€’æ•°nä¸ªèŠ‚ç‚¹ï¼Œå¿«æŒ‡é’ˆå°±å…ˆèµ°næ­¥ã€‚ç„¶åå†åŒæ—¶éå†é“¾è¡¨ç›´åˆ°å¿«æŒ‡é’ˆèµ°åˆ°é“¾è¡¨å°¾éƒ¨ã€‚è¿™ä¸ªæ—¶å€™æ…¢æŒ‡é’ˆåœç•™åœ¨è¦åˆ é™¤çš„èŠ‚ç‚¹å‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚ é¢˜è§£ï¼š /** * Definition for singly-linked list. * public class ListNode * int val; * ListNode next; * ListNode() * ListNode(int val) this.val = val; * ListNode(int val, ListNode next) this.val = val; this.next = next; * */class Solution public ListNode removeNthFromEnd(ListNode head, int n) ListNode dummy = new ListNode(-1); dummy.next = head; ListNode fast = dummy; ListNode slow = dummy; // å¿«æŒ‡é’ˆå…ˆèµ°næ­¥ for (int i = 0; i n; i++) fast = fast.next; // å¿«ã€æ…¢æŒ‡é’ˆåŒæ—¶èµ°ç›´åˆ°å¿«æŒ‡é’ˆèµ°åˆ°é“¾è¡¨å°¾éƒ¨ while(fast.next != null) fast = fast.next; slow = slow.next; // åˆ é™¤å€’æ•°nçš„èŠ‚ç‚¹ slow.next = slow.next.next; return dummy.next; /** * Definition for singly-linked list. * type ListNode struct * Val int * Next *ListNode * */func removeNthFromEnd(head *ListNode, n int) *ListNode if head == nil || head.Next == nil return nil dummy := ListNode dummy.Next = head\tfast := dummy\tslow := dummy\t// å¿«æŒ‡é’ˆå…ˆèµ°næ­¥\tfor i := 0; i n; i++ fast = fast.Next for fast.Next != nil fast = fast.Next slow = slow.Next slow.Next = slow.Next.Next return dummy.Next 160. é“¾è¡¨ç›¸äº¤https://leetcode.com/problems/intersection-of-two-linked-lists/description/ é¢˜ç›®ï¼š ç»™ä½ ä¸¤ä¸ªå•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ headA å’Œ headB ï¼Œè¯·ä½ æ‰¾å‡ºå¹¶è¿”å›ä¸¤ä¸ªå•é“¾è¡¨ç›¸äº¤çš„èµ·å§‹èŠ‚ç‚¹ã€‚å¦‚æœä¸¤ä¸ªé“¾è¡¨æ²¡æœ‰äº¤ç‚¹ï¼Œè¿”å› null ã€‚ å›¾ç¤ºä¸¤ä¸ªé“¾è¡¨åœ¨èŠ‚ç‚¹ c1 å¼€å§‹ç›¸äº¤ï¼š æ€è·¯ï¼š å®šä¹‰ä¸¤ä¸ªæŒ‡é’ˆcurAå’ŒcurBåˆ†åˆ«æŒ‡å‘Aã€B è®©ä¸¤ä¸ªæŒ‡é’ˆåŒæ—¶ç§»åŠ¨ï¼ŒcurAç§»åŠ¨åˆ°æœ«ç«¯æ—¶ã€‚å°†curAæŒ‡å‘Bï¼Œå¹¶å†æ¬¡ç§»åŠ¨curAå’ŒcurBã€‚å½“curBç§»åŠ¨åˆ°æœ«ç«¯æ—¶å°†curBæŒ‡å‘Aã€‚ åŒæ—¶ç§»åŠ¨curAå’ŒcurBï¼Œå¹¶åˆ¤æ–­curAå’ŒcurBæ˜¯å¦ç›¸åŒã€‚ç›´åˆ°éå†åˆ°é“¾è¡¨å°¾éƒ¨ã€‚è‹¥æ— ç›¸åŒåˆ™è¿”å›nullã€‚ é¢˜è§£ï¼š /** * Definition for singly-linked list. * public class ListNode * int val; * ListNode next; * ListNode(int x) * val = x; * next = null; * * */public class Solution public ListNode getIntersectionNode(ListNode headA, ListNode headB) ListNode nodeA = headA; ListNode nodeB = headB; // ç§»åŠ¨nodeAå’ŒnodeB while (nodeA != null nodeB != null) nodeA = nodeA.next; nodeB = nodeB.next; if (nodeA == null) // nodeAæŒ‡å‘B nodeA = headB; while (nodeB != null) nodeB = nodeB.next; nodeA = nodeA.next; // nodeBæŒ‡å‘A nodeB = headA; else if (nodeB == null) nodeB = headA; while (nodeA != null) nodeB = nodeB.next; nodeA = nodeA.next; nodeA = headB; while (nodeA != null) // åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç›¸äº¤èŠ‚ç‚¹ if (nodeA == nodeB) return nodeA; nodeA = nodeA.next; nodeB = nodeB.next; return null; /** * Definition for singly-linked list. * type ListNode struct * Val int * Next *ListNode * */func getIntersectionNode(headA, headB *ListNode) *ListNode curA := headA curB := headB for curA != nil curB != nil curA = curA.Next curB = curB.Next if curA == nil curA = headB for curB != nil curA = curA.Next curB = curB.Next curB = headA if curB == nil curB = headA for curA != nil curA = curA.Next curB = curB.Next curA = headB for curA != nil if curA == curB return curA curA = curA.Next curB = curB.Next return nil","tags":[null],"categories":[null]},{"title":"å­—ç¬¦ä¸²é¢˜è§£","path":"/wiki/leetcode/string.html","content":"344. åè½¬å­—ç¬¦ä¸²https://leetcode.com/problems/reverse-string/description/ ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯å°†è¾“å…¥çš„å­—ç¬¦ä¸²åè½¬è¿‡æ¥ã€‚è¾“å…¥å­—ç¬¦ä¸²ä»¥å­—ç¬¦æ•°ç»„ char[] çš„å½¢å¼ç»™å‡ºã€‚ä¸è¦ç»™å¦å¤–çš„æ•° ç»„åˆ†é…é¢å¤–çš„ç©ºé—´ï¼Œä½ å¿…é¡»åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„ã€ä½¿ç”¨ O(1) çš„é¢å¤–ç©ºé—´è§£å†³è¿™ä¸€é—®é¢˜ã€‚ä½ å¯ä»¥å‡è®¾æ•°ç»„ä¸­çš„æ‰€æœ‰å­— ç¬¦éƒ½æ˜¯ ASCII ç è¡¨ä¸­çš„å¯æ‰“å°å­—ç¬¦ã€‚ ç¤ºä¾‹ 1ï¼šè¾“å…¥ï¼š[â€œhâ€,â€eâ€,â€lâ€,â€lâ€,â€oâ€]è¾“å‡ºï¼š[â€œoâ€,â€lâ€,â€lâ€,â€eâ€,â€hâ€] ç¤ºä¾‹ 2ï¼šè¾“å…¥ï¼š[â€œHâ€,â€aâ€,â€nâ€,â€nâ€,â€aâ€,â€hâ€]è¾“å‡ºï¼š[â€œhâ€,â€aâ€,â€nâ€,â€nâ€,â€aâ€,â€Hâ€] func reverseString(s []byte) l := len(s) - 1\tfor i := 0; i = l / 2; i++ tmp := s[i] s[i] = s[l - i] s[l - i] = tmp 541. åè½¬å­—ç¬¦ä¸²IIhttps://leetcode.com/problems/reverse-string-ii/description/ ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² s å’Œä¸€ä¸ªæ•´æ•° kï¼Œä»å­—ç¬¦ä¸²å¼€å¤´ç®—èµ·, æ¯è®¡æ•°è‡³ 2k ä¸ªå­—ç¬¦ï¼Œå°±åè½¬è¿™ 2k ä¸ªå­—ç¬¦ä¸­çš„å‰ k ä¸ªå­—ç¬¦ã€‚ å¦‚æœå‰©ä½™å­—ç¬¦å°‘äº k ä¸ªï¼Œå¦‚æœå‰©ä½™å­—ç¬¦å°äº 2k ä½†å¤§äºæˆ–ç­‰äº k ä¸ªï¼Œåˆ™åè½¬å‰ k ä¸ªå­—ç¬¦ï¼Œå…¶ä½™å­—ç¬¦ä¿æŒåŸæ ·ã€‚ ç¤ºä¾‹: è¾“å…¥: s â€œabcdefgâ€, k 2 è¾“å‡º: â€œbacdfegâ€ func reverseStr(s string, k int) string res := []byte(s)\tl := len(s)\tfor i := 0; i l; i += 2 * k if i+k = l reverse(res[i : i+k]) else reverse(res[i:l]) return string(res)func reverse(b []byte) left := 0 right := len(b) - 1 for left right b[left], b[right] = b[right], b[left] left++ right--","tags":[null],"categories":[null]}]