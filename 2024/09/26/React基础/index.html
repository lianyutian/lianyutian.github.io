
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.33.1" theme-name="Stellar" theme-version="1.33.1">
  
  
  <meta name="generator" content="Hexo 7.3.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  <meta name="theme-color" content="#f9fafb">
  <title>React基础 - Lianyutian</title>

  
    <meta name="description" content="1. 简介React 是一个用于构建用户界面（UI）的 JavaScript 库，用户界面由按钮、文本和图像等小单元内容构建而成。React 帮助你把它们组合成可重用、可嵌套的 组件。从 web 端网站到移动端应用，屏幕上的所有内容都可以被分解成组件。 React 的主要特点包括：  组件化：将 UI 拆分为可重用的组件，使得开发和维护更加高效。 虚拟 DOM：通过虚拟 DOM 提升性能，只在实际">
<meta property="og:type" content="article">
<meta property="og:title" content="React基础">
<meta property="og:url" content="http://example.com/2024/09/26/React%E5%9F%BA%E7%A1%80/">
<meta property="og:site_name" content="Lianyutian">
<meta property="og:description" content="1. 简介React 是一个用于构建用户界面（UI）的 JavaScript 库，用户界面由按钮、文本和图像等小单元内容构建而成。React 帮助你把它们组合成可重用、可嵌套的 组件。从 web 端网站到移动端应用，屏幕上的所有内容都可以被分解成组件。 React 的主要特点包括：  组件化：将 UI 拆分为可重用的组件，使得开发和维护更加高效。 虚拟 DOM：通过虚拟 DOM 提升性能，只在实际">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/assets/20240507174529.png">
<meta property="article:published_time" content="2024-09-26T09:09:40.000Z">
<meta property="article:modified_time" content="2025-08-29T09:51:59.870Z">
<meta property="article:author" content="lianyutian">
<meta property="article:tag" content="React">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/assets/20240507174529.png">
  
  
  
  <meta name="keywords" content="React">

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="Lianyutian" type="application/atom+xml">
  

  <link rel="stylesheet" href="/css/main.css?v=1.33.1">


  
    <link rel="shortcut icon" href="/assets/20240507174529.png">
  

  

  <script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"lianyutian","sameAs":[],"image":"/assets/20240507174529.png"},"dateCreated":"2024-09-26T09:09:40+00:00","dateModified":"2025-08-29T09:51:59+00:00","datePublished":"2024-09-26T09:09:40+00:00","description":"","headline":"React基础","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2024/09/26/React%E5%9F%BA%E7%A1%80/"},"publisher":{"@type":"Organization","name":"lianyutian","sameAs":[],"image":"/assets/20240507174529.png","logo":{"@type":"ImageObject","url":"/assets/20240507174529.png"}},"url":"http://example.com/2024/09/26/React%E5%9F%BA%E7%A1%80/","keywords":"React","image":[]}</script>
  
</head>
<body>

<div class="l_body content" id="start" layout="post" type="tech" ><aside class="l_left"><div class="sidebg"></div><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/assets/20240507174529.png" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main">Lianyutian</div><div class="sub cap">学无止境</div></a></div></header>

<div class="nav-area">

<nav class="menu dis-select"><a class="nav-item active" title="文章" href="/" style="color:#1e6150"><span>文章</span></a><a class="nav-item" title="wiki" href="/wiki/" style="color:#1e6150"><span>wiki</span></a></nav>
</div>
<div class="widgets">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="站内搜索"></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>



<widget class="widget-wrapper recent post-list"><div class="widget-header dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><a class="item title" href="/2025/03/27/%E7%A4%BE%E5%8C%BA%E5%95%86%E5%9F%8E/"><span class="title">'社区商城'</span></a><a class="item title" href="/2024/11/26/cloud-mall-vue/"><span class="title">cloud-mall-vue</span></a><a class="item title" href="/2024/09/06/protobuf%E5%9F%BA%E7%A1%80/"><span class="title">protobuf基础</span></a><a class="item title" href="/2024/09/06/rpc%E5%9F%BA%E7%A1%80/"><span class="title">rpc基础</span></a><a class="item title" href="/2025/03/25/xxl-job/"><span class="title">xxl-job基础</span></a><a class="item title" href="/2025/03/27/%E4%BA%91%E7%8E%AF%E5%A2%83/"><span class="title">云环境</span></a><a class="item title" href="/2025/03/28/%E5%8C%BA%E5%9D%97%E9%93%BE/"><span class="title">区块链</span></a><a class="item title" href="/2024/05/29/ReentrantLock%E8%AF%A6%E8%A7%A3/"><span class="title">ReentrantLock详解</span></a><a class="item title" href="/2024/12/13/circle-shop/"><span class="title">circle-shop</span></a><a class="item title" href="/2024/09/03/Gin%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/"><span class="title">Gin基础学习</span></a></div></widget>
</div>

</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a></div>
<div class="flex-row" id="post-meta"><span class="text created">发布于：<time datetime="2024-09-26T09:09:40.000Z">2024-09-26</time></span><span class="sep updated"></span><span class="text updated">更新于：<time datetime="2025-08-29T09:51:59.870Z">2025-08-29</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>React基础</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h1><p>React 是一个用于构建用户界面（UI）的 JavaScript 库，用户界面由按钮、文本和图像等小单元内容构建而成。React 帮助你把它们组合成可重用、可嵌套的 <em>组件</em>。从 web 端网站到移动端应用，屏幕上的所有内容都可以被分解成组件。</p>
<p>React 的主要特点包括：</p>
<ol>
<li><strong>组件化</strong>：将 UI 拆分为可重用的组件，使得开发和维护更加高效。</li>
<li><strong>虚拟 DOM</strong>：通过虚拟 DOM 提升性能，只在实际需要更新的部分进行重渲染，减少了与真实 DOM 的直接操作。</li>
<li><strong>单向数据流</strong>：数据在应用中的流动是单向的，简化了数据管理，使得调试更为方便。</li>
<li><strong>声明式编程</strong>：开发者只需描述想要的 UI 状态，React 会处理更新的细节。</li>
</ol>
<h1 id="2-描述-UI"><a href="#2-描述-UI" class="headerlink" title="2. 描述 UI"></a>2. 描述 UI</h1><h2 id="2-1-组件"><a href="#2-1-组件" class="headerlink" title="2.1 组件"></a>2.1 组件</h2><h3 id="2-1-1-UI构成"><a href="#2-1-1-UI构成" class="headerlink" title="2.1.1 UI构成"></a>2.1.1 UI构成</h3><p>在 Web 当中，HTML 允许我们使用其内置的标签集（如 <code>&lt;h1&gt;</code> 和 <code>&lt;li&gt;</code>）创建丰富的结构化文档：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">article</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我的第一个组件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>组件：UI 构成要素<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>定义组件<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>使用组件<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/mysql20240926091658.png"></p>
<p><code>&lt;article&gt;</code> 表示这篇文章，<code>&lt;h1&gt;</code> 表示文章的标题，<code>&lt;ol&gt;</code> 以有序列表的形式表示文章的（缩写的）目录。每一个侧边栏、头像、模态框、下拉框的背后是都是像这样的（结合了用于样式的 CSS 和用于交互的 JavaScript 的）标签——你在 Web 上看到的每一个 UI 模块。</p>
<p>React 允许你将标签、CSS 和 JavaScript 组合成自定义“组件”，即 <strong>应用程序中可复用的 UI 元素</strong>。上文中表示目录的代码可以改写成一个能够在每个页面中渲染的 <code>&lt;TableOfContents /&gt;</code> 组件。实际上，使用的依然是 <code>&lt;article&gt;</code>、<code>&lt;h1&gt;</code> 等相同的 HTML 标签。</p>
<p>就像使用 HTML 标签一样，你可以组合、排序和嵌套组件来绘制整个页面。</p>
<p>随着项目的发展，你会发现很多布局可以通过复用已经完成的组件来实现，从而加快开发进程。你可以使用 React 开源社区分享的大量组件（例如 <a target="_blank" rel="noopener" href="https://chakra-ui.com/">Chakra UI</a> 和 <a target="_blank" rel="noopener" href="https://material-ui.com/">Material UI</a>）来快速启动项目。 </p>
<h3 id="2-1-2-定义组件"><a href="#2-1-2-定义组件" class="headerlink" title="2.1.2 定义组件"></a>2.1.2 定义组件</h3><p>一直以来，创建网页时，Web 开发人员会用标签描述内容，然后通过 JavaScript 来增加交互。</p>
<p>这种在 Web 上添加交互的方式能产生出色的效果。现在许多网站和全部应用都需要交互。</p>
<p>React 最为重视交互性且使用了相同的处理方式：<strong>React 组件是一段可以使用标签进行扩展的 JavaScript 函数</strong>。</p>
<p>如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Profile</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">img</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/MK3eW3Am.jpg&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">alt</span>=<span class="string">&quot;Katherine Johnson&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>以下是构建组件的步骤：</strong></p>
<p><strong>第一步：导出组件</strong></p>
<p><code>export default</code> 前缀是一种 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/web/javascript/reference/statements/export">JavaScript 标准语法</a>（非 React 的特性）。它允许你导出一个文件中的主要函数以便你以后可以从其他文件引入它。欲了解更多关于导入的内容，请参阅 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/importing-and-exporting-components">组件的导入与导出</a> 章节！</p>
<p><strong>第二步：定义函数</strong></p>
<p>使用 <code>function Profile() &#123; &#125;</code> 定义名为 <code>Profile</code> 的 JavaScript 函数。</p>
<blockquote>
<p>React 组件是常规的 JavaScript 函数，但 <strong>组件的名称必须以大写字母开头</strong>，否则它们将无法运行！</p>
</blockquote>
<p><strong>第三步：添加标签</strong></p>
<p>这个组件返回一个带有 <code>src</code> 和 <code>alt</code> 属性的 <code>&lt;img /&gt;</code> 标签。<code>&lt;img /&gt;</code> 写得像 HTML，但实际上是 JavaScript！这种语法被称为 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/writing-markup-with-jsx">JSX</a>，它允许你在 JavaScript 中嵌入标签。</p>
<p>返回语句可以全写在一行上，如下面组件中所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/MK3eW3As.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Katherine Johnson&quot;</span> /&gt;</span></span>;</span><br></pre></td></tr></table></figure>

<p>但是，如果你的标签和 <code>return</code> 关键字不在同一行，则必须把它包裹在一对括号中，如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/MK3eW3As.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Katherine Johnson&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>没有括号包裹的话，任何在 <code>return</code> 下一行的代码都 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/2846283/what-are-the-rules-for-javascripts-automatic-semicolon-insertion-asi">将被忽略</a>！</p>
</blockquote>
<h3 id="2-1-3-使用组件"><a href="#2-1-3-使用组件" class="headerlink" title="2.1.3 使用组件"></a>2.1.3 使用组件</h3><p>现在你已经定义了 <code>Profile</code> 组件，你可以在其他组件中使用它。例如，你可以导出一个内部使用了多个 <code>Profile</code> 组件的 <code>Gallery</code> 组件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Profile</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">img</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/MK3eW3As.jpg&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">alt</span>=<span class="string">&quot;Katherine Johnson&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Gallery</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>了不起的科学家<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Profile</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Profile</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Profile</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- This setup is not suitable for production. --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Only use it in development! --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/@babel/standalone/babel.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">&quot;https://ga.jspm.io/npm:es-module-shims@1.7.0/dist/es-module-shims.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;importmap&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">&#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="string">&quot;imports&quot;</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="string">&quot;react&quot;</span>: <span class="string">&quot;https://esm.sh/react?dev&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="string">&quot;react-dom/client&quot;</span>: <span class="string">&quot;https://esm.sh/react-dom/client?dev&quot;</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/babel&quot;</span> <span class="attr">data-type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">StrictMode</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; createRoot &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">Profile</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">return</span> (</span></span><br><span class="line"><span class="language-javascript">    <span class="language-xml"><span class="tag">&lt;<span class="name">img</span></span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="language-javascript">      <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/MK3eW3As.jpg&quot;</span></span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="language-javascript">      <span class="attr">alt</span>=<span class="string">&quot;Katherine Johnson&quot;</span></span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="language-javascript">    /&gt;</span></span></span></span><br><span class="line"><span class="language-javascript">  );</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">let</span> <span class="title class_">App</span> = <span class="keyword">function</span> <span class="title function_">Gallery</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">return</span> (</span></span><br><span class="line"><span class="language-javascript">    <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-javascript">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>了不起的科学家<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-javascript">      <span class="tag">&lt;<span class="name">Profile</span> /&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-javascript">      <span class="tag">&lt;<span class="name">Profile</span> /&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-javascript">      <span class="tag">&lt;<span class="name">Profile</span> /&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-javascript">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span></span><br><span class="line"><span class="language-javascript">  );</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> root = <span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">root.<span class="title function_">render</span>(</span></span><br><span class="line"><span class="language-javascript">  <span class="language-xml"><span class="tag">&lt;<span class="name">StrictMode</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-javascript">    <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-javascript">  <span class="tag">&lt;/<span class="name">StrictMode</span>&gt;</span></span></span></span><br><span class="line"><span class="language-javascript">);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">* &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-family</span>: sans-serif;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">h1</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin-top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">22px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">h2</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin-top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">h3</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin-top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">h4</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin-top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">h5</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin-top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">h6</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin-top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">12px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">code</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">1.2em</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">ul</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding-inline-start</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">img</span> &#123; <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">10px</span> <span class="number">10px</span> <span class="number">0</span>; <span class="attribute">height</span>: <span class="number">90px</span>; &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>浏览器所看到的</strong></p>
<p>注意下面两者的区别：</p>
<ul>
<li><code>&lt;section&gt;</code> 是小写的，所以 React 知道我们指的是 HTML 标签。</li>
<li><code>&lt;Profile /&gt;</code> 以大写 <code>P</code> 开头，所以 React 知道我们想要使用名为 <code>Profile</code> 的组件。</li>
</ul>
<p>然而 <code>Profile</code> 包含更多的 HTML：<code>&lt;img /&gt;</code>。这是浏览器最后所看到的：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>了不起的科学家<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/MK3eW3As.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Katherine Johnson&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/MK3eW3As.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Katherine Johnson&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/MK3eW3As.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Katherine Johnson&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-1-4-嵌套和组织组件"><a href="#2-1-4-嵌套和组织组件" class="headerlink" title="2.1.4 嵌套和组织组件"></a>2.1.4 嵌套和组织组件</h3><p>组件是常规的 JavaScript 函数，所以你可以将多个组件保存在同一份文件中。当组件相对较小或彼此紧密相关时，这是一种省事的处理方式。如果这个文件变得臃肿，你也可以随时将 <code>Profile</code> 移动到单独的文件中。你可以立即在 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/importing-and-exporting-components">关于引入的页面</a> 中学习如何做到这些。</p>
<p>因为 <code>Profile</code> 组件在 <code>Gallery</code> 组件中渲染——甚至好几次！——我们可以认为 <code>Gallery</code> 是一个 <strong>父组件</strong>，将每个 <code>Profile</code> 渲染为一个“孩子”。这是 React 的神奇之处：你可以只定义组件一次，然后按需多处和多次使用。</p>
<blockquote>
<p>组件可以渲染其他组件，但是 <strong>请不要嵌套他们的定义</strong>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Gallery</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 🔴 永远不要在组件中定义组件</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">Profile</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面这段代码 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/preserving-and-resetting-state#different-components-at-the-same-position-reset-state">非常慢，并且会导致 bug 产生</a>。因此，你应该在顶层定义每个组件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Gallery</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 在顶层声明组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Profile</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当子组件需要使用父组件的数据时，你需要 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/passing-props-to-a-component">通过 props 的形式进行传递</a>，而不是嵌套定义。</p>
</blockquote>
<h3 id="2-1-5-组件的导入与导出"><a href="#2-1-5-组件的导入与导出" class="headerlink" title="2.1.5 组件的导入与导出"></a>2.1.5 组件的导入与导出</h3><p>组件的神奇之处在于它们的可重用性：你可以创建一个由其他组件构成的组件。但当你嵌套了越来越多的组件时，则需要将它们拆分成不同的文件。这样可以使得查找文件更加容易，并且能在更多地方复用这些组件。</p>
<h4 id="2-1-5-1-根组件"><a href="#2-1-5-1-根组件" class="headerlink" title="2.1.5.1 根组件"></a>2.1.5.1 根组件</h4><p>在 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/your-first-component">你的第一个组件</a> 中，你创建了一个 <code>Profile</code> 组件，并且渲染在 <code>Gallery</code> 组件里。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Profile</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">img</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/MK3eW3As.jpg&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">alt</span>=<span class="string">&quot;Katherine Johnson&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Gallery</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>了不起的科学家们<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Profile</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Profile</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Profile</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在此示例中，所有组件目前都定义在 <strong>根组件</strong> <code>App.js</code> 文件中。具体还需根据项目配置决定，有些根组件可能会声明在其他文件中。如果你使用的框架基于文件进行路由，如 Next.js，那你每个页面的根组件都会不一样。</p>
<h4 id="2-1-5-2-导入和导出组件"><a href="#2-1-5-2-导入和导出组件" class="headerlink" title="2.1.5.2 导入和导出组件"></a>2.1.5.2 导入和导出组件</h4><p>如果将来需要在首页添加关于科学书籍的列表，亦或者需要将所有的资料信息移动到其他文件。这时将 <code>Gallery</code> 组件和 <code>Profile</code> 组件移出根组件文件会更加合理。这会使组件更加模块化，并且可在其他文件中复用。你可以根据以下三个步骤对组件进行拆分：</p>
<ol>
<li><strong>创建</strong> 一个新的 JS 文件来存放该组件。</li>
<li><strong>导出</strong> 该文件中的函数组件（可以使用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/export#using_the_default_export">默认导出</a> 或 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/export#using_named_exports">具名导出</a>）</li>
<li>在需要使用该组件的文件中 <strong>导入</strong>（可以根据相应的导出方式使用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/import#importing_defaults">默认导入</a> 或 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/import#import_a_single_export_from_a_module">具名导入</a>）。</li>
</ol>
<p>这里将 <code>Profile</code> 组件和 <code>Gallery</code> 组件，从 <code>App.js</code> 文件中移动到了 <code>Gallery.js</code> 文件中。修改后，即可在 <code>App.js</code> 中导入 <code>Gallery.js</code> 中的 <code>Gallery</code> 组件:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Profile</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">img</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/QIrZWGIs.jpg&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">alt</span>=<span class="string">&quot;Alan L. Hart&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Gallery</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>了不起的科学家们<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Profile</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Profile</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Profile</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Gallery</span> <span class="keyword">from</span> <span class="string">&#x27;./Gallery.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Gallery</span> /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该示例中需要注意的是，如何将组件拆分成两个文件：</p>
<ol>
<li>Gallery.js<ul>
<li>定义了 <code>Profile</code> 组件，该组件仅在该文件内使用，没有被导出。</li>
<li>使用 <strong>默认导出</strong> 的方式，将 <code>Gallery</code> 组件导出</li>
</ul>
</li>
<li>App.js<ul>
<li>使用 <strong>默认导入</strong> 的方式，从 <code>Gallery.js</code> 中导入 <code>Gallery</code> 组件。</li>
<li>使用 <strong>默认导出</strong> 的方式，将根组件 <code>App</code> 导出。</li>
</ul>
</li>
</ol>
<blockquote>
<p>引入过程中，你可能会遇到一些文件并未添加 <code>.js</code> 文件后缀，如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Gallery</span> <span class="keyword">from</span> <span class="string">&#x27;./Gallery&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>无论是 <code>&#39;./Gallery.js&#39;</code> 还是 <code>&#39;./Gallery&#39;</code>，在 React 里都能正常使用，只是前者更符合 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/JavaScript/Guide/Modules">原生 ES 模块</a>。</p>
</blockquote>
<p><strong>默认导出与具名导出</strong></p>
<p>这是 JavaScript 里两个主要用来导出值的方式：默认导出和具名导出。到目前为止，我们的示例中只用到了默认导出。但你可以在一个文件中，选择使用其中一种，或者两种都使用。<strong>一个文件里有且仅有一个 <em>默认</em> 导出，但是可以有任意多个 <em>具名</em> 导出。</strong></p>
<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/mysql20240926110419.png"></p>
<p>组件的导出方式决定了其导入方式。当你用默认导入的方式，导入具名导出的组件时，就会报错。如下表格可以帮你更好地理解它们：</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>导出语句</th>
<th>导入语句</th>
</tr>
</thead>
<tbody><tr>
<td>默认</td>
<td><code>export default function Button() &#123;&#125;</code></td>
<td><code>import Button from &#39;./Button.js&#39;;</code></td>
</tr>
<tr>
<td>具名</td>
<td><code>export function Button() &#123;&#125;</code></td>
<td><code>import &#123; Button &#125; from &#39;./Button.js&#39;;</code></td>
</tr>
</tbody></table>
<p>当使用默认导入时，你可以在 <code>import</code> 语句后面进行任意命名。比如 <code>import Banana from &#39;./Button.js&#39;</code>，如此你能获得与默认导出一致的内容。相反，对于具名导入，导入和导出的名字必须一致。这也是称其为 <strong>具名</strong> 导入的原因！</p>
<p><strong>通常，文件中仅包含一个组件时，人们会选择默认导出，而当文件中包含多个组件或某个值需要导出时，则会选择具名导出。</strong> 无论选择哪种方式，请记得给你的组件和相应的文件命名一个有意义的名字。我们不建议创建未命名的组件，比如 <code>export default () =&gt; &#123;&#125;</code>，因为这样会使得调试变得异常困难。</p>
<h4 id="2-1-5-3-从同一文件导出和导入多个组件"><a href="#2-1-5-3-从同一文件导出和导入多个组件" class="headerlink" title="2.1.5.3 从同一文件导出和导入多个组件"></a>2.1.5.3 从同一文件导出和导入多个组件</h4><p>如果你只想展示一个 <code>Profile</code> 组，而不展示整个图集。你也可以导出 <code>Profile</code> 组件。但 <code>Gallery.js</code> 中已包含 <strong>默认</strong> 导出，此时，你不能定义 <strong>两个</strong> 默认导出。但你可以将其在新文件中进行默认导出，或者将 <code>Profile</code> 进行 <strong>具名</strong> 导出。<strong>同一文件中，有且仅有一个默认导出，但可以有多个具名导出！</strong></p>
<blockquote>
<p>为了减少在默认导出和具名导出之间的混淆，一些团队会选择只使用一种风格（默认或者具名），或者禁止在单个文件内混合使用。这因人而异，选择最适合你的即可！</p>
</blockquote>
<p>首先，用具名导出的方式，将 <code>Profile</code> 组件从 <code>Gallery.js</code> <strong>导出</strong>（不使用 <code>default</code> 关键字）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">Profile</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着，用具名导入的方式，从 <code>Gallery.js</code> 文件中 <strong>导入</strong> <code>Profile</code> 组件（用大括号）:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Profile</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./Gallery.js&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>最后，在 <code>App</code> 组件里 <strong>渲染</strong> <code>&lt;Profile /&gt;</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Profile</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，<code>Gallery.js</code> 包含两个导出：一个是默认导出的 <code>Gallery</code>，另一个是具名导出的 <code>Profile</code>。<code>App.js</code> 中均导入了这两个组件。尝试将 <code>&lt;Profile /&gt;</code> 改成 <code>&lt;Gallery /&gt;</code>，回到示例中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">Profile</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">img</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/QIrZWGIs.jpg&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">alt</span>=<span class="string">&quot;Alan L. Hart&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Gallery</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>了不起的科学家们<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Profile</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Profile</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Profile</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Gallery</span> <span class="keyword">from</span> <span class="string">&#x27;./Gallery.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Profile</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./Gallery.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Profile</span> /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>示例中混合使用了默认导出和具名导出：</p>
<ul>
<li>Gallery.js<ul>
<li>使用 <strong>具名导出</strong> 的方式，将 <code>Profile</code> 组件导出，并取名为 <code>Profile</code>。</li>
<li>使用 <strong>默认导出</strong> 的方式，将 <code>Gallery</code> 组件导出。</li>
</ul>
</li>
<li>App.js<ul>
<li>使用 <strong>具名导入</strong> 的方式，从 <code>Gallery.js</code> 中导入 <code>Profile</code> 组件，并取名为 <code>Profile</code>。</li>
<li>使用 <strong>默认导入</strong> 的方式，从 <code>Gallery.js</code> 中导入 <code>Gallery</code> 组件。</li>
<li>使用 <strong>默认导出</strong> 的方式，将根组件 <code>App</code> 导出。</li>
</ul>
</li>
</ul>
<h2 id="2-2-JSX标签语言"><a href="#2-2-JSX标签语言" class="headerlink" title="2.2 JSX标签语言"></a>2.2 JSX标签语言</h2><p><strong>JSX</strong> 是 JavaScript 语法扩展，可以让你在 JavaScript 文件中书写类似 HTML 的标签。虽然还有其它方式可以编写组件，但大部分 React 开发者更喜欢 JSX 的简洁性，并且在大部分代码库中使用它。</p>
<h3 id="2-2-1-将标签引入-JavaScript"><a href="#2-2-1-将标签引入-JavaScript" class="headerlink" title="2.2.1 将标签引入 JavaScript"></a>2.2.1 将标签引入 JavaScript</h3><p>网页是构建在 HTML、CSS 和 JavaScript 之上的。多年以来，web 开发者都是将网页内容存放在 HTML 中，样式放在 CSS 中，而逻辑则放在 JavaScript 中 —— 通常是在不同的文件中！页面的内容通过标签语言描述并存放在 HTML 文件中，而逻辑则单独存放在 JavaScript 文件中。</p>
<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/mysql20240926111754.png"></p>
<p>但随着 Web 的交互性越来越强，逻辑越来越决定页面中的内容。JavaScript 控制着 HTML 的内容！这也是为什么 <strong>在 React 中，渲染逻辑和标签共同存在于同一个地方——组件。</strong></p>
<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/mysql20240926133555.png"></p>
<p>将一个按钮的渲染逻辑和标签放在一起可以确保它们在每次编辑时都能保持互相同步。反之，彼此无关的细节是互相隔离的，例如按钮的标签和侧边栏的标签。这样我们在修改其中任意一个组件时会更安全。</p>
<p>每个 React 组件都是一个 JavaScript 函数，它会返回一些标签，React 会将这些标签渲染到浏览器上。React 组件使用一种被称为 JSX 的语法扩展来描述这些标签。JSX 看起来和 HTML 很像，但它的语法更加严格并且可以动态展示信息。了解这些区别最好的方式就是将一些 HTML 标签转化为 JSX 标签。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html#whats-a-jsx-transform">JSX and React 是相互独立的</a> 东西。但它们经常一起使用，但你 <strong>可以</strong> 单独使用它们中的任意一个，JSX 是一种语法扩展，而 React 则是一个 JavaScript 的库。</p>
</blockquote>
<h3 id="2-2-2-JSX-规则"><a href="#2-2-2-JSX-规则" class="headerlink" title="2.2.2 JSX 规则"></a>2.2.2 JSX 规则</h3><h4 id="2-2-2-1-只能返回一个根元素"><a href="#2-2-2-1-只能返回一个根元素" class="headerlink" title="2.2.2.1 只能返回一个根元素"></a>2.2.2.1 只能返回一个根元素</h4><p>如果想要在一个组件中包含多个元素，<strong>需要用一个父标签把它们包裹起来</strong>。</p>
<p>例如，你可以使用一个 <code>&lt;div&gt;</code> 标签：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>海蒂·拉玛的待办事项<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/yXOvdOSs.jpg&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">alt</span>=<span class="string">&quot;Hedy Lamarr&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;photo&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果你不想在标签中增加一个额外的 <code>&lt;div&gt;</code>，可以用 <code>&lt;&gt;</code> 和 <code>&lt;/&gt;</code> 元素来代替：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>海蒂·拉玛的待办事项<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/yXOvdOSs.jpg&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">alt</span>=<span class="string">&quot;Hedy Lamarr&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;photo&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个空标签被称作 *<a target="_blank" rel="noopener" href="https://zh-hans.react.dev/reference/react/Fragment">Fragment</a>*。React Fragment 允许你将子元素分组，而不会在 HTML 结构中添加额外节点。</p>
<blockquote>
<h4 id="为什么多个-JSX-标签需要被一个父元素包裹？"><a href="#为什么多个-JSX-标签需要被一个父元素包裹？" class="headerlink" title="为什么多个 JSX 标签需要被一个父元素包裹？"></a>为什么多个 JSX 标签需要被一个父元素包裹？</h4><p>JSX 虽然看起来很像 HTML，但在底层其实被转化为了 JavaScript 对象，你不能在一个函数中返回多个对象，除非用一个数组把他们包装起来。这就是为什么多个 JSX 标签必须要用一个父元素或者 Fragment 来包裹。</p>
</blockquote>
<h4 id="2-2-2-2-标签必须闭合"><a href="#2-2-2-2-标签必须闭合" class="headerlink" title="2.2.2.2 标签必须闭合"></a>2.2.2.2 标签必须闭合</h4><p>JSX 要求标签必须正确闭合。像 <code>&lt;img&gt;</code> 这样的自闭合标签必须书写成 <code>&lt;img /&gt;</code>，而像 <code>&lt;li&gt;oranges</code> 这样只有开始标签的元素必须带有闭合标签，需要改为 <code>&lt;li&gt;oranges&lt;/li&gt;</code>。</p>
<p>海蒂·拉玛的照片和待办事项的标签经修改后变为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/yXOvdOSs.jpg&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">alt</span>=<span class="string">&quot;Hedy Lamarr&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;photo&quot;</span></span></span><br><span class="line"><span class="tag">   /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>发明一种新式交通信号灯<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>排练一个电影场景<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>改进频谱技术<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span><span class="tag">&lt;&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/yXOvdOSs.jpg&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">alt</span>=<span class="string">&quot;Hedy Lamarr&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;photo&quot;</span></span></span><br><span class="line"><span class="tag">   /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>发明一种新式交通信号灯<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>排练一个电影场景<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>改进频谱技术<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/&gt;</span></span><br><span class="line"><span class="tag">&lt;/&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-3-使用驼峰式命名法"><a href="#2-2-2-3-使用驼峰式命名法" class="headerlink" title="2.2.2.3 使用驼峰式命名法"></a>2.2.2.3 使用驼峰式命名法</h4><p>JSX 最终会被转化为 JavaScript，而 JSX 中的属性也会变成 JavaScript 对象中的键值对。在你自己的组件中，经常会遇到需要用变量的方式读取这些属性的时候。但 JavaScript 对变量的命名有限制。例如，变量名称不能包含 <code>-</code> 符号或者像 <code>class</code> 这样的保留字。</p>
<p>这就是为什么在 React 中，大部分 HTML 和 SVG 属性都用驼峰式命名法表示。例如，需要用 <code>strokeWidth</code> 代替 <code>stroke-width</code>。由于 <code>class</code> 是一个保留字，所以在 React 中需要用 <code>className</code> 来代替。这也是 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/className">DOM 属性中的命名</a>:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/yXOvdOSs.jpg&quot;</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">alt</span>=<span class="string">&quot;Hedy Lamarr&quot;</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">className</span>=<span class="string">&quot;photo&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<p>你可以 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/reference/react-dom/components/common">在 React DOM 元素中找到所有对应的属性</a>。如果你在编写属性时发生了错误，不用担心 —— React 会在 <a target="_blank" rel="noopener" href="https://firefox-source-docs.mozilla.org/devtools-user/browser_console/index.html">浏览器控制台</a> 中打印一条可能的更正信息。</p>
<blockquote>
<p>由于历史原因，<a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/Accessibility/ARIA"><code>aria-*</code></a> 和 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Learn/HTML/Howto/Use_data_attributes"><code>data-*</code></a> 属性是以带 <code>-</code> 符号的 HTML 格式书写的。</p>
</blockquote>
<h3 id="2-2-3-将-HTML-转化为-JSX"><a href="#2-2-3-将-HTML-转化为-JSX" class="headerlink" title="2.2.3 将 HTML 转化为 JSX"></a>2.2.3 将 HTML 转化为 JSX</h3><p>假设你现在有一些（完全有效的）HTML 标签：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>海蒂·拉玛的待办事项<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/yXOvdOSs.jpg&quot;</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">alt</span>=<span class="string">&quot;Hedy Lamarr&quot;</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">class</span>=<span class="string">&quot;photo&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>发明一种新式交通信号灯</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>排练一个电影场景</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>改进频谱技术</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>而现在想要把这些标签迁移到组件中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">TodoList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">// ???</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果直接复制到组件中，并不能正常工作：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">TodoList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">// 这不起作用！</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>海蒂·拉玛的待办事项<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    &lt;img </span><br><span class="line">      src=&quot;https://i.imgur.com/yXOvdOSs.jpg&quot; </span><br><span class="line">      alt=&quot;Hedy Lamarr&quot; </span><br><span class="line">      class=&quot;photo&quot;</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;li&gt;发明一种新式交通信号灯</span><br><span class="line">      &lt;li&gt;排练一个电影场景</span><br><span class="line">      &lt;li&gt;改进频谱技术</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是因为 JSX 语法更加严格并且相比 HTML 有更多的规则！上面的错误提示可以帮助你修复标签中的错误，当然也可以参考下面的指引。</p>
<blockquote>
<p>大部分情况下，React 在屏幕上显示的错误提示就能帮你找到问题所在，如果在编写过程中遇到问题就参考一下提示吧。</p>
</blockquote>
<p>将现有的 HTML 中的所有属性转化 JSX 的格式是很繁琐的。我们建议使用 <a target="_blank" rel="noopener" href="https://transform.tools/html-to-jsx">转化器</a> 将 HTML 和 SVG 标签转化为 JSX。这种转化器在实践中非常有用。但我们依然有必要去了解这种转化过程中发生了什么，这样你就可以编写自己的 JSX 了。</p>
<p>这是最终的结果：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">TodoList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>海蒂·拉玛的待办事项<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">img</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/yXOvdOSs.jpg&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">alt</span>=<span class="string">&quot;Hedy Lamarr&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">className</span>=<span class="string">&quot;photo&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>发明一种新式交通信号灯<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>排练一个电影场景<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>改进频谱技术<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-4-在-JSX-中通过大括号使用-JavaScript"><a href="#2-2-4-在-JSX-中通过大括号使用-JavaScript" class="headerlink" title="2.2.4 在 JSX 中通过大括号使用 JavaScript"></a>2.2.4 在 JSX 中通过大括号使用 JavaScript</h3><p>JSX 允许你在 JavaScript 中编写类似 HTML 的标签，从而使渲染的逻辑和内容可以写在一起。</p>
<p>有时候，你可能想要在标签中添加一些 JavaScript 逻辑或者引用动态的属性。这种情况下，你可以在 JSX 的大括号内来编写 JavaScript。</p>
<h4 id="2-2-4-1-使用引号传递字符串"><a href="#2-2-4-1-使用引号传递字符串" class="headerlink" title="2.2.4.1 使用引号传递字符串"></a>2.2.4.1 使用引号传递字符串</h4><p>当你想把一个字符串属性传递给 JSX 时，把它放到单引号或双引号中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Avatar</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">img</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">className</span>=<span class="string">&quot;avatar&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/7vQD0fPs.jpg&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">alt</span>=<span class="string">&quot;Gregorio Y. Zara&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的 <code>&quot;https://i.imgur.com/7vQD0fPs.jpg&quot;</code> 和 <code>&quot;Gregorio Y. Zara&quot;</code> 就是被作为字符串传递的。</p>
<p>但是如果你想要动态地指定 <code>src</code> 或 <code>alt</code> 的值呢？你可以 <strong>用 <code>&#123;</code> 和 <code>&#125;</code> 替代 <code>&quot;</code> 和 <code>&quot;</code> 以使用 JavaScript 变量</strong> ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Avatar</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> avatar = <span class="string">&#x27;https://i.imgur.com/7vQD0fPs.jpg&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> description = <span class="string">&#x27;Gregorio Y. Zara&#x27;</span>;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">img</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">className</span>=<span class="string">&quot;avatar&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">src</span>=<span class="string">&#123;avatar&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">alt</span>=<span class="string">&#123;description&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请注意 <code>className=&quot;avatar&quot;</code> 和 <code>src=&#123;avatar&#125;</code> 之间的区别，<code>className=&quot;avatar&quot;</code> 指定了一个就叫 <code>&quot;avatar&quot;</code> 的使图片在样式上变圆的 CSS 类名，而 <code>src=&#123;avatar&#125;</code> 这种写法会去读取 JavaScript 中 <code>avatar</code> 这个变量的值。这是因为大括号可以使你直接在标签中使用 JavaScript！</p>
<h4 id="2-2-4-2-使用大括号：一扇进入-JavaScript-世界的窗户"><a href="#2-2-4-2-使用大括号：一扇进入-JavaScript-世界的窗户" class="headerlink" title="2.2.4.2 使用大括号：一扇进入 JavaScript 世界的窗户"></a>2.2.4.2 使用大括号：一扇进入 JavaScript 世界的窗户</h4><p>JSX 是一种编写 JavaScript 的特殊方式。这为在大括号 <code>&#123; &#125;</code> 中使用 JavaScript 带来了可能。下面的示例中声明了科学家的名字，<code>name</code>，然后在 <code>&lt;h1&gt;</code> 后的大括号内嵌入它：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">TodoList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> name = <span class="string">&#x27;Gregorio Y. Zara&#x27;</span>;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;name&#125;&#x27;s To Do List<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>试着将 <code>name</code> 的值从 <code>&#39;Gregorio Y. Zara&#39;</code> 更改成 <code>&#39;Hedy Lamarr&#39;</code>。看看这个 To Do List 的标题将如何变化？</p>
<p>大括号内的任何 JavaScript 表达式都能正常运行，包括像 <code>formatDate()</code> 这样的函数调用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> today = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">formatDate</span>(<span class="params">date</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Intl</span>.<span class="title class_">DateTimeFormat</span>(</span><br><span class="line">    <span class="string">&#x27;zh-CN&#x27;</span>,</span><br><span class="line">    &#123; <span class="attr">weekday</span>: <span class="string">&#x27;long&#x27;</span> &#125;</span><br><span class="line">  ).<span class="title function_">format</span>(date);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">TodoList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>To Do List for &#123;formatDate(today)&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 JSX 中，只能在以下两种场景中使用大括号：</p>
<ol>
<li>用作 JSX 标签内的<strong>文本</strong>：<code>&lt;h1&gt;&#123;name&#125;&#39;s To Do List&lt;/h1&gt;</code> 是有效的，但是 <code>&lt;&#123;tag&#125;&gt;Gregorio Y. Zara&#39;s To Do List&lt;/&#123;tag&#125;&gt;</code> 无效。</li>
<li>用作紧跟在 <code>=</code> 符号后的 <strong>属性</strong>：<code>src=&#123;avatar&#125;</code> 会读取 <code>avatar</code> 变量，但是 <code>src=&quot;&#123;avatar&#125;&quot;</code> 只会传一个字符串 <code>&#123;avatar&#125;</code>。</li>
</ol>
<h4 id="2-2-4-3-使用-“双大括号”：JSX-中的-CSS-和-对象"><a href="#2-2-4-3-使用-“双大括号”：JSX-中的-CSS-和-对象" class="headerlink" title="2.2.4.3 使用 “双大括号”：JSX 中的 CSS 和 对象"></a>2.2.4.3 使用 “双大括号”：JSX 中的 CSS 和 对象</h4><p>除了字符串、数字和其它 JavaScript 表达式，你甚至可以在 JSX 中传递对象。对象也用大括号表示，例如 <code>&#123; name: &quot;Hedy Lamarr&quot;, inventions: 5 &#125;</code>。因此，为了能在 JSX 中传递，你必须用另一对额外的大括号包裹对象：<code>person=&#123;&#123; name: "Hedy Lamarr", inventions: 5 &#125;&#125;</code>。</p>
<p>你可能在 JSX 的内联 CSS 样式中就已经见过这种写法了。React 不要求你使用内联样式（使用 CSS 类就能满足大部分情况）。但是当你需要内联样式的时候，你可以给 <code>style</code> 属性传递一个对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">TodoList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">style</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &#123;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">       <span class="attr">backgroundColor:</span> &#x27;<span class="attr">black</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">     <span class="attr">color:</span> &#x27;<span class="attr">pink</span>&#x27;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>Improve the videophone<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>Prepare aeronautics lectures<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>Work on the alcohol-fuelled engine<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以当你下次在 JSX 中看到 <code>&#123;&#123;` 和 `&#125;&#125;</code>时，就知道它只不过是包在大括号里的一个对象罢了！</p>
<blockquote>
<p>内联 <code>style</code> 属性 使用驼峰命名法编写。例如，HTML <code>&lt;ul style=&quot;background-color: black&quot;&gt;</code> 在你的组件里应该写成 <code>&lt;ul style=&#123;&#123; backgroundColor: 'black' &#125;&#125;&gt;</code>。</p>
</blockquote>
<h4 id="2-2-4-4-JavaScript-对象和大括号的更多可能"><a href="#2-2-4-4-JavaScript-对象和大括号的更多可能" class="headerlink" title="2.2.4.4 JavaScript 对象和大括号的更多可能"></a>2.2.4.4 JavaScript 对象和大括号的更多可能</h4><p>你可以将多个表达式合并到一个对象中，在 JSX 的大括号内分别使用它们：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Gregorio Y. Zara&#x27;</span>,</span><br><span class="line">  <span class="attr">theme</span>: &#123;</span><br><span class="line">    <span class="attr">backgroundColor</span>: <span class="string">&#x27;black&#x27;</span>,</span><br><span class="line">    <span class="attr">color</span>: <span class="string">&#x27;pink&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">TodoList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;person.theme&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;person.name&#125;&#x27;s Todos<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">img</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">className</span>=<span class="string">&quot;avatar&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/7vQD0fPs.jpg&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">alt</span>=<span class="string">&quot;Gregorio Y. Zara&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>Improve the videophone<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>Prepare aeronautics lectures<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>Work on the alcohol-fuelled engine<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在你几乎了解了有关 JSX 的一切：</p>
<ul>
<li>JSX 引号内的值会作为字符串传递给属性。</li>
<li>大括号让你可以将 JavaScript 的逻辑和变量带入到标签中。</li>
<li>它们会在 JSX 标签中的内容区域或紧随属性的 <code>=</code> 后起作用。</li>
<li><code>&#123;&#123;` 和 `&#125;&#125;</code> 并不是什么特殊的语法：它只是包在 JSX 大括号内的 JavaScript 对象。</li>
</ul>
<h2 id="2-3-父子组件属性传递"><a href="#2-3-父子组件属性传递" class="headerlink" title="2.3 父子组件属性传递"></a>2.3 父子组件属性传递</h2><p>React 组件使用 <em>props</em> 来互相通信。每个父组件都可以提供 props 给它的子组件，从而将一些信息传递给它。Props 可能会让你想起 HTML 属性，但你可以通过它们传递任何 JavaScript 值，包括对象、数组和函数。</p>
<h3 id="2-3-1-简介"><a href="#2-3-1-简介" class="headerlink" title="2.3.1 简介"></a>2.3.1 简介</h3><p>Props 是你传递给 JSX 标签的信息。例如，<code>className</code>、<code>src</code>、<code>alt</code>、<code>width</code> 和 <code>height</code> 便是一些可以传递给 <code>&lt;img&gt;</code> 的 props：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Avatar</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">img</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">className</span>=<span class="string">&quot;avatar&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/1bX5QH6.jpg&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">alt</span>=<span class="string">&quot;Lin Lanying&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">width</span>=<span class="string">&#123;100&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">height</span>=<span class="string">&#123;100&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Profile</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Avatar</span> /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你可以传递给 <code>&lt;img&gt;</code> 标签的 props 是预定义的（ReactDOM 符合 <a target="_blank" rel="noopener" href="https://www.w3.org/TR/html52/semantics-embedded-content.html#the-img-element">HTML 标准</a>）。但是你可以将任何 props 传递给 <strong>你自己的</strong> 组件，例如 <code>&lt;Avatar&gt;</code> ，以便自定义它们。</p>
<h3 id="2-3-2-向组件传递-props"><a href="#2-3-2-向组件传递-props" class="headerlink" title="2.3.2 向组件传递 props"></a>2.3.2 向组件传递 props</h3><p>在这段代码中， <code>Profile</code> 组件没有向它的子组件 <code>Avatar</code> 传递任何 props ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Profile</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Avatar</span> /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你可以分两步给 <code>Avatar</code> 一些 props。</p>
<p><strong>步骤一：将 props 传递给子组件</strong></p>
<p>首先，将一些 props 传递给 <code>Avatar</code>。例如，让我们传递两个 props：<code>person</code>（一个对象）和 <code>size</code>（一个数字）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Profile</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Avatar</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">person</span>=<span class="string">&#123;&#123;</span> <span class="attr">name:</span> &#x27;<span class="attr">Lin</span> <span class="attr">Lanying</span>&#x27;, <span class="attr">imageId:</span> &#x27;<span class="attr">1bX5QH6</span>&#x27; &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">size</span>=<span class="string">&#123;100&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，你可以在 <code>Avatar</code> 组件中读取这些 props 了。</p>
<p><strong>步骤二：在子组件中读取 props</strong></p>
<p>你可以通过在 <code>function Avatar</code> 之后直接列出它们的名字 <code>person, size</code> 来读取这些 props。这些 props 在 <code>(&#123;</code> 和 <code>&#125;)</code> 之间，并由逗号分隔。这样，你可以在 <code>Avatar</code> 的代码中使用它们，就像使用变量一样。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Avatar</span>(<span class="params">&#123; person, size &#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// 在这里 person 和 size 是可访问的</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>向使用 <code>person</code> 和 <code>size</code> props 渲染的 <code>Avatar</code> 添加一些逻辑，你就完成了。</p>
<p>现在你可以配置 <code>Avatar</code> ，通过不同的 props，使它能以多种不同的方式进行渲染。尝试变换值吧！</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getImageUrl</span>(<span class="params">person, size = <span class="string">&#x27;s&#x27;</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="string">&#x27;https://i.imgur.com/&#x27;</span> +</span><br><span class="line">    person.<span class="property">imageId</span> +</span><br><span class="line">    size +</span><br><span class="line">    <span class="string">&#x27;.jpg&#x27;</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getImageUrl &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Avatar</span>(<span class="params">&#123; person, size &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">img</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">className</span>=<span class="string">&quot;avatar&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">src</span>=<span class="string">&#123;getImageUrl(person)&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">alt</span>=<span class="string">&#123;person.name&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">width</span>=<span class="string">&#123;size&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">height</span>=<span class="string">&#123;size&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Profile</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Avatar</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">size</span>=<span class="string">&#123;100&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">person</span>=<span class="string">&#123;&#123;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name:</span> &#x27;<span class="attr">Katsuko</span> <span class="attr">Saruhashi</span>&#x27;, </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">imageId:</span> &#x27;<span class="attr">YfeOqp2</span>&#x27;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Avatar</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">size</span>=<span class="string">&#123;80&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">person</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name:</span> &#x27;<span class="attr">Aklilu</span> <span class="attr">Lemma</span>&#x27;, </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">imageId:</span> &#x27;<span class="attr">OKS67lh</span>&#x27;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Props 使你独立思考父组件和子组件。 例如，你可以改变 <code>Profile</code> 中的 <code>person</code> 或 <code>size</code> props，而无需考虑 <code>Avatar</code> 如何使用它们。 同样，你可以改变 <code>Avatar</code> 使用这些 props 的方式，不必考虑 <code>Profile</code>。</p>
<p>你可以将 props 想象成可以调整的“旋钮”。它们的作用与函数的参数相同 —— 事实上，props <strong>正是</strong> 组件的唯一参数！ React 组件函数接受一个参数，一个 <code>props</code> 对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Avatar</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> person = props.<span class="property">person</span>;</span><br><span class="line">  <span class="keyword">let</span> size = props.<span class="property">size</span>;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通常你不需要整个 <code>props</code> 对象，所以可以将它<a target="_blank" rel="noopener" href="https://lianyutian.github.io/2023/12/08/2023-12-08-JavaScrpit%E8%BF%9B%E9%98%B6/#2-5-%E8%A7%A3%E6%9E%84%E8%B5%8B%E5%80%BC">解构</a>为单独的 props。</p>
<blockquote>
<p>在声明 props 时， <strong>不要忘记 <code>(</code> 和 <code>)</code> 之间的一对花括号 <code>&#123;</code> 和 <code>&#125;</code></strong>  ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Avatar</span>(<span class="params">&#123; person, size &#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种语法被称为 “解构”，等价于于从函数参数中读取属性：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Avatar</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> person = props.<span class="property">person</span>;</span><br><span class="line">  <span class="keyword">let</span> size = props.<span class="property">size</span>;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="2-3-3-给-prop-指定一个默认值"><a href="#2-3-3-给-prop-指定一个默认值" class="headerlink" title="2.3.3 给 prop 指定一个默认值"></a>2.3.3 给 prop 指定一个默认值</h3><p>如果你想在没有指定值的情况下给 prop 一个默认值，你可以通过在参数后面写 <code>=</code> 和默认值来进行解构：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Avatar</span>(<span class="params">&#123; person, size = <span class="number">100</span> &#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在， 如果 <code>&lt;Avatar person=&#123;...&#125; /&gt;</code> 渲染时没有 <code>size</code> prop，  <code>size</code> 将被赋值为 <code>100</code>。</p>
<p>默认值仅在缺少 <code>size</code> prop 或 <code>size=&#123;undefined&#125;</code> 时生效。 但是如果你传递了 <code>size=&#123;null&#125;</code> 或 <code>size=&#123;0&#125;</code>，默认值将 <strong>不</strong> 被使用。</p>
<h3 id="2-3-4-使用-JSX-展开语法传递-props"><a href="#2-3-4-使用-JSX-展开语法传递-props" class="headerlink" title="2.3.4 使用 JSX 展开语法传递 props"></a>2.3.4 使用 JSX 展开语法传递 props</h3><p>有时候，传递 props 会变得非常重复：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Profile</span>(<span class="params">&#123; person, size, isSepia, thickBorder &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Avatar</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">person</span>=<span class="string">&#123;person&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">size</span>=<span class="string">&#123;size&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">isSepia</span>=<span class="string">&#123;isSepia&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">thickBorder</span>=<span class="string">&#123;thickBorder&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重复代码没有错（它可以更清晰）。但有时你可能会重视简洁。一些组件将它们所有的 props 转发给子组件，正如 <code>Profile</code> 转给 <code>Avatar</code> 那样。因为这些组件不直接使用他们本身的任何 props，所以使用更简洁的“<a target="_blank" rel="noopener" href="https://lianyutian.github.io/2023/12/08/2023-12-08-JavaScrpit%E8%BF%9B%E9%98%B6/#2-3-%E5%B1%95%E5%BC%80%E8%BF%90%E7%AE%97%E7%AC%A6">展开</a>”语法是有意义的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Profile</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Avatar</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这会将 <code>Profile</code> 的所有 props 转发到 <code>Avatar</code>，而不列出每个名字。</p>
<p><strong>请克制地使用展开语法。</strong> 如果你在所有其他组件中都使用它，那就有问题了。 通常，它表示你应该拆分组件，并将子组件作为 JSX 传递。</p>
<h3 id="2-3-5-将-JSX-作为子组件传递"><a href="#2-3-5-将-JSX-作为子组件传递" class="headerlink" title="2.3.5 将 JSX 作为子组件传递"></a>2.3.5 将 JSX 作为子组件传递</h3><p>嵌套浏览器内置标签是很常见的：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>有时你会希望以相同的方式嵌套自己的组件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Card</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Avatar</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Card</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当将内容嵌套在 JSX 标签中时，父组件将在名为 <code>children</code> 的 prop 中接收到该内容。例如，下面的 <code>Card</code> 组件将接收一个被设为 <code>&lt;Avatar /&gt;</code> 的 <code>children</code> prop 并将其包裹在 div 中渲染：</p>
<p><code>App.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Avatar</span> <span class="keyword">from</span> <span class="string">&#x27;./Avatar.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Card</span>(<span class="params">&#123; children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Profile</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Card</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Avatar</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">size</span>=<span class="string">&#123;100&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">person</span>=<span class="string">&#123;&#123;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name:</span> &#x27;<span class="attr">Katsuko</span> <span class="attr">Saruhashi</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">imageId:</span> &#x27;<span class="attr">YfeOqp2</span>&#x27;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Card</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Avatar.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getImageUrl &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Avatar</span>(<span class="params">&#123; person, size &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">img</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">className</span>=<span class="string">&quot;avatar&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">src</span>=<span class="string">&#123;getImageUrl(person)&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">alt</span>=<span class="string">&#123;person.name&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">width</span>=<span class="string">&#123;size&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">height</span>=<span class="string">&#123;size&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>utils.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getImageUrl</span>(<span class="params">person, size = <span class="string">&#x27;s&#x27;</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="string">&#x27;https://i.imgur.com/&#x27;</span> +</span><br><span class="line">    person.<span class="property">imageId</span> +</span><br><span class="line">    size +</span><br><span class="line">    <span class="string">&#x27;.jpg&#x27;</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>尝试用一些文本替换 <code>&lt;Card&gt;</code> 中的 <code>&lt;Avatar&gt;</code>，看看 <code>Card</code> 组件如何包裹任意嵌套内容。它不必“知道”其中渲染的内容。你会在很多地方看到这种灵活的模式。</p>
<p>可以将带有 <code>children</code> prop 的组件看作有一个“洞”，可以由其父组件使用任意 JSX 来“填充”。你会经常使用 <code>children</code> prop 来进行视觉包装：面板、网格等等。</p>
<h3 id="2-3-6-Props-如何随时间变化"><a href="#2-3-6-Props-如何随时间变化" class="headerlink" title="2.3.6 Props 如何随时间变化"></a>2.3.6 Props 如何随时间变化</h3><p>下面的 <code>Clock</code> 组件从其父组件接收两个 props：<code>color</code> 和 <code>time</code>。（父组件的代码被省略，因为它使用 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/state-a-components-memory">state</a>，我们暂时不会深入研究。）</p>
<p>尝试在下面的选择框中更改颜色：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Clock</span>(<span class="params">&#123; color, time &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">color:</span> <span class="attr">color</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;time&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/mysql20240927092811.png"></p>
<p>这个例子说明，<strong>一个组件可能会随着时间的推移收到不同的 props。</strong> Props 并不总是静态的！在这里，<code>time</code> prop 每秒都在变化。当你选择另一种颜色时，<code>color</code> prop 也改变了。Props 反映了组件在任何时间点的数据，并不仅仅是在开始时。</p>
<p>然而，props 是 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Immutable_object">不可变的</a>（一个计算机科学术语，意思是“不可改变”）。当一个组件需要改变它的 props（例如，响应用户交互或新数据）时，它不得不“请求”它的父组件传递 <strong>不同的 props</strong> —— 一个新对象！它的旧 props 将被丢弃，最终 JavaScript 引擎将回收它们占用的内存。</p>
<p><strong>不要尝试“更改 props”。</strong> 当你需要响应用户输入（例如更改所选颜色）时，你可以“设置 state”，你可以在 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/state-a-components-memory">State: 一个组件的内存</a> 中继续了解。</p>
<h2 id="2-4-条件渲染"><a href="#2-4-条件渲染" class="headerlink" title="2.4 条件渲染"></a>2.4 条件渲染</h2><p>通常你的组件会需要根据不同的情况显示不同的内容。在 React 中，你可以通过使用 JavaScript 的 <code>if</code> 语句、<code>&amp;&amp;</code> 和 <code>? :</code> 运算符来选择性地渲染 JSX。</p>
<h3 id="2-4-1-条件返回-JSX"><a href="#2-4-1-条件返回-JSX" class="headerlink" title="2.4.1 条件返回 JSX"></a>2.4.1 条件返回 JSX</h3><p>假设有一个 <code>PackingList</code> 组件，里面渲染多个 <code>Item</code> 组件，每个物品可标记为打包与否：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Item</span>(<span class="params">&#123; name, isPacked &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&quot;item&quot;</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">PackingList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Sally Ride 的行李清单<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Item</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">isPacked</span>=<span class="string">&#123;true&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;宇航服&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Item</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">isPacked</span>=<span class="string">&#123;true&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;带金箔的头盔&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Item</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">isPacked</span>=<span class="string">&#123;false&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;Tam 的照片&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要注意的是，有些 <code>Item</code> 组件的 <code>isPacked</code> 属性是被设为 <code>true</code> 而不是 <code>false</code>。你可以在那些满足 <code>isPacked=&#123;true&#125;</code> 条件的物品旁加上一个勾选符号（✅）。</p>
<p>你可以用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/if...else">if&#x2F;else 语句</a> 去判断：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isPacked) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&quot;item&quot;</span>&gt;</span>&#123;name&#125; ✅<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&quot;item&quot;</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure>

<p>如果 <code>isPacked</code> 属性是 <code>true</code>，这段代码会<strong>返回一个不一样的 JSX</strong>。通过这样的改动，一些物品的名字后面会出现一个勾选符号：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Item</span>(<span class="params">&#123; name, isPacked &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (isPacked) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&quot;item&quot;</span>&gt;</span>&#123;name&#125; ✅<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&quot;item&quot;</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">PackingList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Sally Ride 的行李清单<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Item</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">isPacked</span>=<span class="string">&#123;true&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;宇航服&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Item</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">isPacked</span>=<span class="string">&#123;true&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;带金箔的头盔&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Item</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">isPacked</span>=<span class="string">&#123;false&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;Tam 的照片&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>留意这里你是怎么使用 JavaScript 的 <code>if</code> 和 <code>return</code> 语句来写分支逻辑。在 React 中，是由 JavaScript 来处理控制流的（比如条件）。</p>
<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/mysql20240927140735.png"></p>
<h3 id="2-4-2-选择性返回-null"><a href="#2-4-2-选择性返回-null" class="headerlink" title="2.4.2 选择性返回 null"></a>2.4.2 选择性返回 null</h3><p>在一些情况下，你不想有任何东西进行渲染。比如，你不想显示已经打包好的物品。但一个组件必须返回一些东西。这种情况下，你可以直接返回 <code>null</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isPacked) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&quot;item&quot;</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure>

<p>如果组件的 <code>isPacked</code> 属性为 <code>true</code>，那么它将只返回 <code>null</code>。否则，它将返回相应的 JSX 用来渲染。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Item</span>(<span class="params">&#123; name, isPacked &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (isPacked) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&quot;item&quot;</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">PackingList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Sally Ride 的行李清单<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Item</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">isPacked</span>=<span class="string">&#123;true&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;宇航服&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Item</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">isPacked</span>=<span class="string">&#123;true&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;带金箔的头盔&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Item</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">isPacked</span>=<span class="string">&#123;false&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;Tam 的照片&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\lm\AppData\Roaming\Typora\typora-user-images\image-20240927140722291.png" alt="image-20240927140722291"></p>
<p>实际上，在组件里返回 <code>null</code> 并不常见，因为这样会让想使用它的开发者感觉奇怪。通常情况下，你可以在父组件里选择是否要渲染该组件。让我们接着往下看吧！</p>
<h3 id="2-4-3-选择性地包含-JSX"><a href="#2-4-3-选择性地包含-JSX" class="headerlink" title="2.4.3 选择性地包含 JSX"></a>2.4.3 选择性地包含 JSX</h3><p>在之前的例子里，你在组件内部控制哪些 JSX 树（如果有的话！）会返回。你可能已经发现了在渲染输出里会有一些重复的内容：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;li className=<span class="string">&quot;item&quot;</span>&gt;&#123;name&#125; ✅&lt;/li&gt;</span><br></pre></td></tr></table></figure>

<p>和下面的写法很像：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;li className=<span class="string">&quot;item&quot;</span>&gt;&#123;name&#125;&lt;/li&gt;</span><br></pre></td></tr></table></figure>

<p>两个条件分支都会返回 <code>&lt;li className=&quot;item&quot;&gt;...&lt;/li&gt;</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isPacked) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&quot;item&quot;</span>&gt;</span>&#123;name&#125; ✅<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&quot;item&quot;</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure>

<p>虽然这些重复的内容没什么害处，但这样可能会导致你的代码更难维护。比如你想更改 <code>className</code>？你就需要修改两个地方！针对这种情况，你可以通过选择性地包含一小段 JSX 来让你的代码更加 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Don't_repeat_yourself">DRY</a>。</p>
<p><strong>三目运算符（<code>? :</code>）</strong></p>
<p>JavaScript 有一种紧凑型语法来实现条件判断表达式——<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Conditional_Operator">条件运算符</a> 又称“三目运算符”。</p>
<p>除了这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isPacked) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&quot;item&quot;</span>&gt;</span>&#123;name&#125; ✅<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&quot;item&quot;</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure>

<p>你还可以这样实现：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;isPacked ? name + &#x27; ✅&#x27; : name&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>你可以认为，<em>“如果 <code>isPacked</code> 为 true 时，则（<code>?</code>）渲染 <code>name + &#39; ✅&#39;</code>，否则（<code>:</code>）渲染 <code>name</code>。”</em></p>
<blockquote>
<p>如果你之前是习惯面向对象开发的，你可能会认为上面的两个例子略有不同，因为其中一个可能会创建两个不同的 <code>&lt;li&gt;</code> “实例”。但 JSX 元素不是“实例”，因为它们没有内部状态也不是真实的 DOM 节点。它们只是一些简单的描述，就像图纸一样。所以上面这两个例子事实上是完全相同的。在 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/preserving-and-resetting-state">状态的保持和重置</a> 里会深入探讨其原因。</p>
</blockquote>
<p>现在，假如你想将对应物品的文本放到另一个 HTML 标签里，比如用 <code>&lt;del&gt;</code> 来显示删除线。你可以添加更多的换行和括号，以便在各种情况下更好地去嵌套 JSX：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Item</span>(<span class="params">&#123; name, isPacked &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;isPacked ? (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">del</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;name + &#x27; ✅&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">del</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ) : (</span></span><br><span class="line"><span class="language-xml">        name</span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">PackingList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Sally Ride 的行李清单<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Item</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">isPacked</span>=<span class="string">&#123;true&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;宇航服&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Item</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">isPacked</span>=<span class="string">&#123;true&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;带金箔的头盔&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Item</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">isPacked</span>=<span class="string">&#123;false&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;Tam 的照片&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于简单的条件判断，这样的风格可以很好地实现，但需要适量使用。如果你的组件里有很多的嵌套式条件表达式，则需要考虑通过提取为子组件来简化这些嵌套表达式。在 React 里，标签也是你代码中的一部分，所以你可以使用变量和函数来整理一些复杂的表达式。</p>
<h3 id="2-4-4-与运算符（-）"><a href="#2-4-4-与运算符（-）" class="headerlink" title="2.4.4 与运算符（&amp;&amp;）"></a>2.4.4 与运算符（<code>&amp;&amp;</code>）</h3><p>你会遇到的另一个常见的快捷表达式是 [JavaScript 逻辑与（<code>&amp;&amp;</code>）运算符](<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Logical_AND#:~:text=The">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Logical_AND#:~:text=The</a> logical AND ( %26%26 ) operator,it returns a Boolean value.)。在 React 组件里，通常用在当条件成立时，你想渲染一些 JSX，<strong>或者不做任何渲染</strong>。使用 <code>&amp;&amp;</code>，你也可以实现仅当 <code>isPacked</code> 为 <code>true</code> 时，渲染勾选符号。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;name&#125; &#123;isPacked &amp;&amp; &#x27;✅&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>你可以认为，<em>“当 <code>isPacked</code> 为真值时，则（<code>&amp;&amp;</code>）渲染勾选符号，否则，不渲染。”</em></p>
<p>下面为具体的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Item</span>(<span class="params">&#123; name, isPacked &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;name&#125; &#123;isPacked &amp;&amp; &#x27;✅&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">PackingList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Sally Ride 的行李清单<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Item</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">isPacked</span>=<span class="string">&#123;true&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;宇航服&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Item</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">isPacked</span>=<span class="string">&#123;true&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;带金箔的头盔&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Item</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">isPacked</span>=<span class="string">&#123;false&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;Tam 的照片&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Logical_AND">JavaScript &amp;&amp; 表达式</a> 的左侧（我们的条件）为 <code>true</code> 时，它则返回其右侧的值（在我们的例子里是勾选符号）。但条件的结果是 <code>false</code>，则整个表达式会变成 <code>false</code>。在 JSX 里，React 会将 <code>false</code> 视为一个“空值”，就像 <code>null</code> 或者 <code>undefined</code>，这样 React 就不会在这里进行任何渲染。</p>
<blockquote>
<p><strong>切勿将数字放在 <code>&amp;&amp;</code> 左侧.</strong></p>
<p>JavaScript 会自动将左侧的值转换成布尔类型以判断条件成立与否。然而，如果左侧是 <code>0</code>，整个表达式将变成左侧的值（<code>0</code>），React 此时则会渲染 <code>0</code> 而不是不进行渲染。</p>
<p>例如，一个常见的错误是 <code>messageCount &amp;&amp; &lt;p&gt;New messages&lt;/p&gt;</code>。其原本是想当 <code>messageCount</code> 为 0 的时候不进行渲染，但实际上却渲染了 <code>0</code>。</p>
<p>为了更正，可以将左侧的值改成布尔类型：<code>messageCount &gt; 0 &amp;&amp; &lt;p&gt;New messages&lt;/p&gt;</code>。</p>
</blockquote>
<h3 id="2-4-5-选择性地将-JSX-赋值给变量"><a href="#2-4-5-选择性地将-JSX-赋值给变量" class="headerlink" title="2.4.5 选择性地将 JSX 赋值给变量"></a>2.4.5 选择性地将 JSX 赋值给变量</h3><p>当这些快捷方式妨碍写普通代码时，可以考虑使用 <code>if</code> 语句和变量。因为你可以使用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/let"><code>let</code></a> 进行重复赋值，所以一开始你可以将你想展示的（这里指的是物品的名字）作为默认值赋予给该变量。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> itemContent = name;</span><br></pre></td></tr></table></figure>

<p>结合 <code>if</code> 语句，当 <code>isPacked</code> 为 <code>true</code> 时，将 JSX 表达式的值重新赋值给 <code>itemContent</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isPacked) &#123;</span><br><span class="line">  itemContent = name + <span class="string">&quot; ✅&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/javascript-in-jsx-with-curly-braces#using-curly-braces-a-window-into-the-javascript-world">在 JSX 中通过大括号使用 JavaScript</a>。将变量用大括号嵌入在返回的 JSX 树中，来嵌套计算好的表达式与 JSX：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;li className=<span class="string">&quot;item&quot;</span>&gt;</span><br><span class="line">  &#123;itemContent&#125;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure>

<p>这种方式是最冗长的，但也是最灵活的。下面是相关的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Item</span>(<span class="params">&#123; name, isPacked &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> itemContent = name;</span><br><span class="line">  <span class="keyword">if</span> (isPacked) &#123;</span><br><span class="line">    itemContent = name + <span class="string">&quot; ✅&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;itemContent&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">PackingList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Sally Ride 的行李清单<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Item</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">isPacked</span>=<span class="string">&#123;true&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;宇航服&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Item</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">isPacked</span>=<span class="string">&#123;true&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;带金箔的头盔&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Item</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">isPacked</span>=<span class="string">&#123;false&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;Tam 的照片&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>跟之前的一样，这个方式不仅仅适用于文本，任意的 JSX 均适用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Item</span>(<span class="params">&#123; name, isPacked &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> itemContent = name;</span><br><span class="line">  <span class="keyword">if</span> (isPacked) &#123;</span><br><span class="line">    itemContent = (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">del</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;name + &quot; ✅&quot;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">del</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;itemContent&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">PackingList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Sally Ride 的行李清单<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Item</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">isPacked</span>=<span class="string">&#123;true&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;宇航服&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Item</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">isPacked</span>=<span class="string">&#123;true&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;带金箔的头盔&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Item</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">isPacked</span>=<span class="string">&#123;false&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;Tam 的照片&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果对 JavaScript 不熟悉，这些不同的风格一开始可能会让你感到不知所措。但是，学习这些将有助于你理解和写任何的 JavaScript 代码，而不仅仅是 React 组件。一开始可以选择一个你喜欢的来用，然后当你忘记其他的怎么用时，可以再翻阅这份参考资料。</p>
<h2 id="2-5-渲染列表"><a href="#2-5-渲染列表" class="headerlink" title="2.5 渲染列表"></a>2.5 渲染列表</h2><p>你可能经常需要通过 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array#">JavaScript 的数组方法</a> 来操作数组中的数据，从而将一个数据集渲染成多个相似的组件。在这篇文章中，你将学会如何在 React 中使用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array/filter"><code>filter()</code></a> 筛选需要渲染的组件和使用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array/map"><code>map()</code></a> 把数组转换成组件数组。</p>
<h3 id="2-5-1-从数组中渲染数据"><a href="#2-5-1-从数组中渲染数据" class="headerlink" title="2.5.1 从数组中渲染数据"></a>2.5.1 从数组中渲染数据</h3><p>这里我们有一个列表。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>凯瑟琳·约翰逊: 数学家<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>马里奥·莫利纳: 化学家<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>穆罕默德·阿卜杜勒·萨拉姆: 物理学家<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>珀西·莱温·朱利亚: 化学家<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>苏布拉马尼扬·钱德拉塞卡: 天体物理学家<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到，这些列表项之间唯一的区别就是其中的内容&#x2F;数据。未来你可能会碰到很多类似的情况，在那些场景中，你想基于不同的数据渲染出相似的组件，比如评论列表或者个人资料的图库。在这样的场景下，可以把要用到的数据存入 JavaScript 对象或数组，然后用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/map"><code>map()</code></a> 或 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array/filter"><code>filter()</code></a> 这样的方法来渲染出一个组件列表。</p>
<p>这里给出一个由数组生成一系列列表项的简单示例：</p>
<ol>
<li><p>首先，把数据 <strong>存储</strong> 到数组中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> people = [</span><br><span class="line">  <span class="string">&#x27;凯瑟琳·约翰逊: 数学家&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;马里奥·莫利纳: 化学家&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;穆罕默德·阿卜杜勒·萨拉姆: 物理学家&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;珀西·莱温·朱利亚: 化学家&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;苏布拉马尼扬·钱德拉塞卡: 天体物理学家&#x27;</span>,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>遍历</strong> <code>people</code> 这个数组中的每一项，并获得一个新的 JSX 节点数组 <code>listItems</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> listItems = people.<span class="title function_">map</span>(<span class="function"><span class="params">person</span> =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;person&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>把 <code>listItems</code> 用 <code>&lt;ul&gt;</code> 包裹起来，然后 <strong>返回</strong> 它：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return &lt;ul&gt;&#123;listItems&#125;&lt;/ul&gt;;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>来看看运行的结果：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> people = [</span><br><span class="line">  <span class="string">&#x27;凯瑟琳·约翰逊: 数学家&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;马里奥·莫利纳: 化学家&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;穆罕默德·阿卜杜勒·萨拉姆: 物理学家&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;珀西·莱温·朱利亚: 化学家&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;苏布拉马尼扬·钱德拉塞卡: 天体物理学家&#x27;</span>,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">List</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> listItems = people.<span class="title function_">map</span>(<span class="function"><span class="params">person</span> =&gt;</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;person&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span>&#123;listItems&#125;<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/mysql20240927111208.png"></p>
<p>注意上面的沙盒可能会输出这样一个控制台错误。</p>
<p>等会我们会学到怎么修复它。在此之前，我们先来看看如何把这个数组变得更加结构化。</p>
<h3 id="2-5-2-对数组项进行过滤"><a href="#2-5-2-对数组项进行过滤" class="headerlink" title="2.5.2 对数组项进行过滤"></a>2.5.2 对数组项进行过滤</h3><p>让我们把 <code>people</code> 数组变得更加结构化一点。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> people = [&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;凯瑟琳·约翰逊&#x27;</span>,</span><br><span class="line">  <span class="attr">profession</span>: <span class="string">&#x27;数学家&#x27;</span>,</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;马里奥·莫利纳&#x27;</span>,</span><br><span class="line">  <span class="attr">profession</span>: <span class="string">&#x27;化学家&#x27;</span>,</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;穆罕默德·阿卜杜勒·萨拉姆&#x27;</span>,</span><br><span class="line">  <span class="attr">profession</span>: <span class="string">&#x27;物理学家&#x27;</span>,</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;珀西·莱温·朱利亚&#x27;</span>,</span><br><span class="line">  <span class="attr">profession</span>: <span class="string">&#x27;化学家&#x27;</span>,</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">4</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;苏布拉马尼扬·钱德拉塞卡&#x27;</span>,</span><br><span class="line">  <span class="attr">profession</span>: <span class="string">&#x27;天体物理学家&#x27;</span>,</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<p>现在，假设你只想在屏幕上显示职业是 <code>化学家</code> 的人。那么你可以使用 JavaScript 的 <code>filter()</code> 方法来返回满足条件的项。这个方法会让数组的子项经过 “过滤器”（一个返回值为 <code>true</code> 或 <code>false</code> 的函数）的筛选，最终返回一个只包含满足条件的项的新数组。</p>
<p>既然你只想显示 <code>profession</code> 值是 <code>化学家</code> 的人，那么这里的 “过滤器” 函数应该长这样：<code>(person) =&gt; person.profession === &#39;化学家&#39;</code>。下面我们来看看该怎么把它们组合在一起：</p>
<ol>
<li><p>首先，<strong>创建</strong> 一个用来存化学家们的新数组 <code>chemists</code>，这里用到 <code>filter()</code> 方法过滤 <code>people</code> 数组来得到所有的化学家，过滤的条件应该是 <code>person.profession === &#39;化学家&#39;</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> chemists = people.<span class="title function_">filter</span>(<span class="function"><span class="params">person</span> =&gt;</span></span><br><span class="line">  person.<span class="property">profession</span> === <span class="string">&#x27;化学家&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>接下来 <strong>用 map 方法遍历</strong> <code>chemists</code> 数组:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> listItems = chemists.<span class="title function_">map</span>(<span class="function"><span class="params">person</span> =&gt;</span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;<span class="name">img</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">       <span class="attr">src</span>=<span class="string">&#123;getImageUrl(person)&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">       <span class="attr">alt</span>=<span class="string">&#123;person.name&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">     /&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;person.name&#125;:<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       &#123;&#x27; &#x27; + person.profession + &#x27; &#x27;&#125;</span></span><br><span class="line"><span class="language-xml">       因&#123;person.accomplishment&#125;而闻名世界</span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>最后，<strong>返回</strong> <code>listItems</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span>&#123;listItems&#125;<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><code>App.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; people &#125; <span class="keyword">from</span> <span class="string">&#x27;./data.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getImageUrl &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">List</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> chemists = people.<span class="title function_">filter</span>(<span class="function"><span class="params">person</span> =&gt;</span></span><br><span class="line">    person.<span class="property">profession</span> === <span class="string">&#x27;化学家&#x27;</span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">const</span> listItems = chemists.<span class="title function_">map</span>(<span class="function"><span class="params">person</span> =&gt;</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">img</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">src</span>=<span class="string">&#123;getImageUrl(person)&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">alt</span>=<span class="string">&#123;person.name&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;person.name&#125;:<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;&#x27; &#x27; + person.profession + &#x27; &#x27;&#125;</span></span><br><span class="line"><span class="language-xml">        因&#123;person.accomplishment&#125;而闻名世界</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span>&#123;listItems&#125;<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>data.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> people = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;凯瑟琳·约翰逊&#x27;</span>,</span><br><span class="line">    <span class="attr">profession</span>: <span class="string">&#x27;数学家&#x27;</span>,</span><br><span class="line">    <span class="attr">accomplishment</span>: <span class="string">&#x27;太空飞行相关数值的核算&#x27;</span>,</span><br><span class="line">    <span class="attr">imageId</span>: <span class="string">&#x27;MK3eW3A&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;马里奥·莫利纳&#x27;</span>,</span><br><span class="line">    <span class="attr">profession</span>: <span class="string">&#x27;化学家&#x27;</span>,</span><br><span class="line">    <span class="attr">accomplishment</span>: <span class="string">&#x27;北极臭氧空洞的发现&#x27;</span>,</span><br><span class="line">    <span class="attr">imageId</span>: <span class="string">&#x27;mynHUSa&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;穆罕默德·阿卜杜勒·萨拉姆&#x27;</span>,</span><br><span class="line">    <span class="attr">profession</span>: <span class="string">&#x27;物理学家&#x27;</span>,</span><br><span class="line">    <span class="attr">accomplishment</span>: <span class="string">&#x27;关于基本粒子间弱相互作用和电磁相互作用的统一理论&#x27;</span>,</span><br><span class="line">    <span class="attr">imageId</span>: <span class="string">&#x27;bE7W1ji&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;珀西·莱温·朱利亚&#x27;</span>,</span><br><span class="line">    <span class="attr">profession</span>: <span class="string">&#x27;化学家&#x27;</span>,</span><br><span class="line">    <span class="attr">accomplishment</span>: <span class="string">&#x27;开创性的可的松药物、类固醇和避孕药的研究&#x27;</span>,</span><br><span class="line">    <span class="attr">imageId</span>: <span class="string">&#x27;IOjWm71&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;苏布拉马尼扬·钱德拉塞卡&#x27;</span>,</span><br><span class="line">    <span class="attr">profession</span>: <span class="string">&#x27;天体物理学家&#x27;</span>,</span><br><span class="line">    <span class="attr">accomplishment</span>: <span class="string">&#x27;白矮星质量计算&#x27;</span>,</span><br><span class="line">    <span class="attr">imageId</span>: <span class="string">&#x27;lrWQx8l&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p><code>utils.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getImageUrl</span>(<span class="params">person</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="string">&#x27;https://i.imgur.com/&#x27;</span> +</span><br><span class="line">    person.<span class="property">imageId</span> +</span><br><span class="line">    <span class="string">&#x27;s.jpg&#x27;</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>因为箭头函数会隐式地返回位于 <code>=&gt;</code> 之后的表达式，所以你可以省略 <code>return</code> 语句。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> listItems = chemists.<span class="title function_">map</span>(<span class="function"><span class="params">person</span> =&gt;</span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>...<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span> <span class="comment">// 隐式地返回！</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>不过，<strong>如果你的 <code>=&gt;</code> 后面跟了一对花括号 <code>&#123;</code> ，那你必须使用 <code>return</code> 来指定返回值！</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> listItems = chemists.<span class="title function_">map</span>(<span class="function"><span class="params">person</span> =&gt;</span> &#123; <span class="comment">// 花括号</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>...<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>箭头函数 <code>=&gt; &#123;</code> 后面的部分被称为 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Arrow_functions#function_body">“块函数体”</a>，块函数体支持多行代码的写法，但要用 <code>return</code> 语句才能指定返回值。假如你忘了写 <code>return</code>，那这个函数什么都不会返回！</p>
</blockquote>
<h3 id="2-5-3-用-key-保持列表项的顺序"><a href="#2-5-3-用-key-保持列表项的顺序" class="headerlink" title="2.5.3 用 key 保持列表项的顺序"></a>2.5.3 用 <code>key</code> 保持列表项的顺序</h3><p>如果把上面任何一个沙盒示例在新标签页打开，你就会发现控制台有这样一个报错：</p>
<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/mysql20240927111918.png"></p>
<p>这是因为你必须给数组中的每一项都指定一个 <code>key</code>——它可以是字符串或数字的形式，只要能唯一标识出各个数组项就行：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;li key=&#123;person.<span class="property">id</span>&#125;&gt;...&lt;/li&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>直接放在 <code>map()</code> 方法里的 JSX 元素一般都需要指定 <code>key</code> 值！</p>
</blockquote>
<p>这些 key 会告诉 React，每个组件对应着数组里的哪一项，所以 React 可以把它们匹配起来。这在数组项进行移动（例如排序）、插入或删除等操作时非常重要。一个合适的 <code>key</code> 可以帮助 React 推断发生了什么，从而得以正确地更新 DOM 树。</p>
<p>用作 key 的值应该在数据中提前就准备好，而不是在运行时才随手生成：</p>
<p><code>App.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; people &#125; <span class="keyword">from</span> <span class="string">&#x27;./data.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getImageUrl &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">List</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> listItems = people.<span class="title function_">map</span>(<span class="function"><span class="params">person</span> =&gt;</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;person.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">img</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">src</span>=<span class="string">&#123;getImageUrl(person)&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">alt</span>=<span class="string">&#123;person.name&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;person.name&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;&#x27; &#x27; + person.profession + &#x27; &#x27;&#125;</span></span><br><span class="line"><span class="language-xml">          因&#123;person.accomplishment&#125;而闻名世界</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span>&#123;listItems&#125;<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>data.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> people = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">0</span>, <span class="comment">// 在 JSX 中作为 key 使用</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;凯瑟琳·约翰逊&#x27;</span>,</span><br><span class="line">    <span class="attr">profession</span>: <span class="string">&#x27;数学家&#x27;</span>,</span><br><span class="line">    <span class="attr">accomplishment</span>: <span class="string">&#x27;太空飞行相关数值的核算&#x27;</span>,</span><br><span class="line">    <span class="attr">imageId</span>: <span class="string">&#x27;MK3eW3A&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span>, <span class="comment">// 在 JSX 中作为 key 使用</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;马里奥·莫利纳&#x27;</span>,</span><br><span class="line">    <span class="attr">profession</span>: <span class="string">&#x27;化学家&#x27;</span>,</span><br><span class="line">    <span class="attr">accomplishment</span>: <span class="string">&#x27;北极臭氧空洞的发现&#x27;</span>,</span><br><span class="line">    <span class="attr">imageId</span>: <span class="string">&#x27;mynHUSa&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">2</span>, <span class="comment">// 在 JSX 中作为 key 使用</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;穆罕默德·阿卜杜勒·萨拉姆&#x27;</span>,</span><br><span class="line">    <span class="attr">profession</span>: <span class="string">&#x27;物理学家&#x27;</span>,</span><br><span class="line">    <span class="attr">accomplishment</span>: <span class="string">&#x27;关于基本粒子间弱相互作用和电磁相互作用的统一理论&#x27;</span>,</span><br><span class="line">    <span class="attr">imageId</span>: <span class="string">&#x27;bE7W1ji&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">3</span>, <span class="comment">// 在 JSX 中作为 key 使用</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;珀西·莱温·朱利亚&#x27;</span>,</span><br><span class="line">    <span class="attr">profession</span>: <span class="string">&#x27;化学家&#x27;</span>,</span><br><span class="line">    <span class="attr">accomplishment</span>: <span class="string">&#x27;开创性的可的松药物、类固醇和避孕药&#x27;</span>,</span><br><span class="line">    <span class="attr">imageId</span>: <span class="string">&#x27;IOjWm71&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">4</span>, <span class="comment">// 在 JSX 中作为 key 使用</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;苏布拉马尼扬·钱德拉塞卡&#x27;</span>,</span><br><span class="line">    <span class="attr">profession</span>: <span class="string">&#x27;天体物理学家&#x27;</span>,</span><br><span class="line">    <span class="attr">accomplishment</span>: <span class="string">&#x27;白矮星质量计算&#x27;</span>,</span><br><span class="line">    <span class="attr">imageId</span>: <span class="string">&#x27;lrWQx8l&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h3 id="2-5-4-如何设置-key-值"><a href="#2-5-4-如何设置-key-值" class="headerlink" title="2.5.4 如何设置 key 值"></a>2.5.4 如何设置 key 值</h3><p>不同来源的数据往往对应不同的 key 值获取方式：</p>
<ul>
<li><strong>来自数据库的数据：</strong> 如果你的数据是从数据库中获取的，那你可以直接使用数据表中的主键，因为它们天然具有唯一性。</li>
<li><strong>本地产生数据：</strong> 如果你数据的产生和保存都在本地（例如笔记软件里的笔记），那么你可以使用一个自增计数器或者一个类似 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/uuid"><code>uuid</code></a> 的库来生成 key。</li>
</ul>
<p><strong>key 需要满足的条件</strong></p>
<ul>
<li><strong>key 值在兄弟节点之间必须是唯一的。</strong> 不过不要求全局唯一，在不同的数组中可以使用相同的 key。</li>
<li><strong>key 值不能改变</strong>，否则就失去了使用 key 的意义！所以千万不要在渲染时动态地生成 key。</li>
</ul>
<p><strong>React 中为什么需要 key？</strong></p>
<p>设想一下，假如你桌面上的文件都没有文件名，取而代之的是，你需要通过文件的位置顺序来区分它们———第一个文件，第二个文件，以此类推。也许你也不是不能接受这种方式，可是一旦你删除了其中的一个文件，这种组织方式就会变得混乱无比。原来的第二个文件可能会变成第一个文件，第三个文件会成为第二个文件……</p>
<p>React 里需要 key 和文件夹里的文件需要有文件名的道理是类似的。它们（key 和文件名）都让我们可以从众多的兄弟元素中唯一标识出某一项（JSX 节点或文件）。而一个精心选择的 key 值所能提供的信息远远不止于这个元素在数组中的位置。即使元素的位置在渲染的过程中发生了改变，它提供的 <code>key</code> 值也能让 React 在整个生命周期中一直认得它。</p>
<blockquote>
<p>你可能会想直接把数组项的索引当作 key 值来用，实际上，如果你没有显式地指定 <code>key</code> 值，React 确实默认会这么做。但是数组项的顺序在插入、删除或者重新排序等操作中会发生改变，此时把索引顺序用作 key 值会产生一些微妙且令人困惑的 bug。</p>
<p>与之类似，请不要在运行过程中动态地产生 key，像是 <code>key=&#123;Math.random()&#125;</code> 这种方式。这会导致每次重新渲染后的 key 值都不一样，从而使得所有的组件和 DOM 元素每次都要重新创建。这不仅会造成运行变慢的问题，更有可能导致用户输入的丢失。所以，使用能从给定数据中稳定取得的值才是明智的选择。</p>
<p>有一点需要注意，组件不会把 <code>key</code> 当作 props 的一部分。Key 的存在只对 React 本身起到提示作用。如果你的组件需要一个 ID，那么请把它作为一个单独的 prop 传给组件： <code>&lt;Profile key=&#123;id&#125; userId=&#123;id&#125; /&gt;</code>。</p>
</blockquote>
<h2 id="2-6-保持组件纯粹"><a href="#2-6-保持组件纯粹" class="headerlink" title="2.6 保持组件纯粹"></a>2.6 保持组件纯粹</h2><p>部分 JavaScript 函数是 <strong>纯粹</strong> 的，这类函数通常被称为纯函数。纯函数仅执行计算操作，不做其他操作。你可以通过将组件按纯函数严格编写，以避免一些随着代码库的增长而出现的、令人困扰的 bug 以及不可预测的行为。但为了获得这些好处，你需要遵循一些规则。</p>
<h3 id="2-6-1-纯函数：组件作为公式"><a href="#2-6-1-纯函数：组件作为公式" class="headerlink" title="2.6.1 纯函数：组件作为公式"></a>2.6.1 纯函数：组件作为公式</h3><p>在计算机科学中（尤其是函数式编程的世界中），<a target="_blank" rel="noopener" href="https://wikipedia.org/wiki/Pure_function">纯函数</a> 通常具有如下特征：</p>
<ul>
<li><strong>只负责自己的任务</strong>。它不会更改在该函数调用前就已存在的对象或变量。</li>
<li><strong>输入相同，则输出相同</strong>。给定相同的输入，纯函数应总是返回相同的结果。</li>
</ul>
<p>举个你非常熟悉的纯函数示例：数学中的公式。</p>
<p>考虑如下数学公式：y &#x3D; 2x。</p>
<p>若 x &#x3D; 2 则 y &#x3D; 4。永远如此。</p>
<p>若 x &#x3D; 3 则 y &#x3D; 6。永远如此。</p>
<p>若 x &#x3D; 3，那么 y 并不会因为时间或股市的影响，而有时等于 9 、 –1 或 2.5。</p>
<p>若 y &#x3D; 2x 且 x &#x3D; 3, 那么 y <em>永远</em> 等于 6.</p>
<p>我们使用 JavaScript 的函数实现，看起来将会是这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">double</span>(<span class="params">number</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span> * number;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述例子中，<code>double()</code> 就是一个 <strong>纯函数</strong>。如果你传入 <code>3</code> ，它将总是返回 <code>6</code> 。</p>
<p>React 便围绕着这个概念进行设计。<strong>React 假设你编写的所有组件都是纯函数</strong>。也就是说，对于相同的输入，你所编写的 React 组件必须总是返回相同的 JSX。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Recipe</span>(<span class="params">&#123; drinkers &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ol</span>&gt;</span>    </span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>Boil &#123;drinkers&#125; cups of water.<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>Add &#123;drinkers&#125; spoons of tea and &#123;0.5 * drinkers&#125; spoons of spice.<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>Add &#123;0.5 * drinkers&#125; cups of milk to boil and sugar to taste.<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Spiced Chai Recipe<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>For two<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Recipe</span> <span class="attr">drinkers</span>=<span class="string">&#123;2&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>For a gathering<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Recipe</span> <span class="attr">drinkers</span>=<span class="string">&#123;4&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当你给函数 <code>Recipe</code> 传入 <code>drinkers=&#123;2&#125;</code> 参数时，它将返回包含 <code>2 cups of water</code> 的 JSX。永远如此。</p>
<p>而当你传入 <code>drinkers=&#123;4&#125;</code> 时，它将返回包含 <code>4 cups of water</code> 的 JSX。永远如此。</p>
<p>就像数学公式一样。</p>
<p>你可以把你的组件当作食谱：如果你遵循它们，并且在烹饪过程中不引入新食材，你每次都会得到相同的菜肴。那这道 “菜肴” 就是组件用于 React <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/render-and-commit">渲染</a> 的 JSX。</p>
<h3 id="2-6-2-副作用：（不符合）预期的后果"><a href="#2-6-2-副作用：（不符合）预期的后果" class="headerlink" title="2.6.2 副作用：（不符合）预期的后果"></a>2.6.2 副作用：（不符合）预期的后果</h3><p>React 的渲染过程必须自始至终是纯粹的。组件应该只 <strong>返回</strong> 它们的 JSX，而不 <strong>改变</strong> 在渲染前，就已存在的任何对象或变量 — 这将会使它们变得不纯粹！</p>
<p>以下是违反这一规则的组件示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> guest = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Cup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// Bad：正在更改预先存在的变量！</span></span><br><span class="line">  guest = guest + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Tea cup for guest #&#123;guest&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">TeaSet</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Cup</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Cup</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Cup</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该组件正在读写其外部声明的 <code>guest</code> 变量。这意味着 <strong>多次调用这个组件会产生不同的 JSX</strong>！并且，如果 <strong>其他</strong> 组件读取 <code>guest</code> ，它们也会产生不同的 JSX，其结果取决于它们何时被渲染！这是无法预测的。</p>
<p>回到我们的公式 y &#x3D; 2x ，现在即使 x &#x3D; 2 ，我们也不能相信 y &#x3D; 4 。我们的测试可能会失败，我们的用户可能会感到困扰，飞机可能会从天空坠毁——你将看到这会引发多么扑朔迷离的 bugs！</p>
<p>你可以 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/passing-props-to-a-component">将 <code>guest</code> 作为 prop 传入</a> 来修复此组件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Cup</span>(<span class="params">&#123; guest &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Tea cup for guest #&#123;guest&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">TeaSet</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Cup</span> <span class="attr">guest</span>=<span class="string">&#123;1&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Cup</span> <span class="attr">guest</span>=<span class="string">&#123;2&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Cup</span> <span class="attr">guest</span>=<span class="string">&#123;3&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在你的组件就是纯粹的，因为它返回的 JSX 只依赖于 <code>guest</code> prop。</p>
<p>一般来说，你不应该期望你的组件以任何特定的顺序被渲染。调用 y &#x3D; 5x 和 y &#x3D; 2x 的先后顺序并不重要：这两个公式相互独立。同样地，每个组件也应该“独立思考”，而不是在渲染过程中试图与其他组件协调，或者依赖于其他组件。渲染过程就像是一场学校考试：每个组件都应该自己计算 JSX！</p>
<blockquote>
<p>尽管你可能还没使用过，但在 React 中，你可以在渲染时读取三种输入：<a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/passing-props-to-a-component">props</a>，<a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/state-a-components-memory">state</a> 和 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/passing-data-deeply-with-context">context</a>。你应该始终将这些输入视为只读。</p>
<p>当你想根据用户输入 <em>更改</em> 某些内容时，你应该 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/state-a-components-memory">设置状态</a>，而不是直接写入变量。当你的组件正在渲染时，你永远不应该改变预先存在的变量或对象。</p>
<p>React 提供了 “严格模式”，在严格模式下开发时，它将会调用每个组件函数两次。<strong>通过重复调用组件函数，严格模式有助于找到违反这些规则的组件</strong>。</p>
<p>我们注意到，原始示例显示的是 “Guest #2”、“Guest #4” 和 “Guest #6”，而不是 “Guest #1”、“Guest #2” 和 “Guest #3”。原来的函数并不纯粹，因此调用它两次就出现了问题。但对于修复后的纯函数版本，即使调用该函数两次也能得到正确结果。<strong>纯函数仅仅执行计算，因此调用它们两次不会改变任何东西</strong> — 就像两次调用 <code>double(2)</code> 并不会改变返回值，两次求解 y &#x3D; 2x 不会改变 y 的值一样。相同的输入，总是返回相同的输出。</p>
<p>严格模式在生产环境下不生效，因此它不会降低应用程序的速度。如需引入严格模式，你可以用 <code>&lt;React.StrictMode&gt;</code> 包裹根组件。一些框架会默认这样做。</p>
</blockquote>
<h3 id="2-6-3-局部-mutation：组件的小秘密"><a href="#2-6-3-局部-mutation：组件的小秘密" class="headerlink" title="2.6.3 局部 mutation：组件的小秘密"></a>2.6.3 局部 mutation：组件的小秘密</h3><p>上述示例的问题出在渲染过程中，组件改变了 <strong>预先存在的</strong> 变量的值。为了让它听起来更可怕一点，我们将这种现象称为 <strong>突变（mutation）</strong> 。纯函数不会改变函数作用域外的变量、或在函数调用前创建的对象——这会使函数变得不纯粹！</p>
<p>但是，<strong>你完全可以在渲染时更改你 <em>刚刚</em> 创建的变量和对象</strong>。在本示例中，你创建一个 <code>[]</code> 数组，将其分配给一个 <code>cups</code> 变量，然后 <code>push</code> 一打 cup 进去：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Cup</span>(<span class="params">&#123; guest &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Tea cup for guest #&#123;guest&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">TeaGathering</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> cups = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= <span class="number">12</span>; i++) &#123;</span><br><span class="line">    cups.<span class="title function_">push</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Cup</span> <span class="attr">key</span>=<span class="string">&#123;i&#125;</span> <span class="attr">guest</span>=<span class="string">&#123;i&#125;</span> /&gt;</span></span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> cups;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果 <code>cups</code> 变量或 <code>[]</code> 数组是在 <code>TeaGathering</code> 函数之外创建的，这将是一个很大的问题！因为如果那样的话，当你调用数组的 push 方法时，就会更改 <strong>预先存在的</strong> 对象。</p>
<p>但是，这里不会有影响，因为每次渲染时，你都是在 <code>TeaGathering</code> 函数内部创建的它们。<code>TeaGathering</code> 之外的代码并不会知道发生了什么。这就被称为 <strong>“局部 mutation”</strong> — 如同藏在组件里的小秘密。</p>
<h3 id="2-6-4-哪些地方-可能-引发副作用"><a href="#2-6-4-哪些地方-可能-引发副作用" class="headerlink" title="2.6.4 哪些地方 可能 引发副作用"></a>2.6.4 哪些地方 <strong>可能</strong> 引发副作用</h3><p>函数式编程在很大程度上依赖于纯函数，但 <strong>某些事物</strong> 在特定情况下不得不发生改变。这是编程的要义！这些变动包括更新屏幕、启动动画、更改数据等，它们被称为 <strong>副作用</strong>。它们是 <strong>“额外”</strong> 发生的事情，与渲染过程无关。</p>
<p>在 React 中，**副作用通常属于 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/responding-to-events">事件处理程序</a>**。事件处理程序是 React 在你执行某些操作（如单击按钮）时运行的函数。即使事件处理程序是在你的组件 <strong>内部</strong> 定义的，它们也不会在渲染期间运行！ <strong>因此事件处理程序无需是纯函数</strong>。</p>
<p>如果你用尽一切办法，仍无法为副作用找到合适的事件处理程序，你还可以调用组件中的 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/reference/react/useEffect"><code>useEffect</code></a> 方法将其附加到返回的 JSX 中。这会告诉 React 在渲染结束后执行它。<strong>然而，这种方法应该是你最后的手段</strong>。</p>
<blockquote>
<h4 id="React-为何侧重于纯函数"><a href="#React-为何侧重于纯函数" class="headerlink" title="React 为何侧重于纯函数?"></a>React 为何侧重于纯函数?</h4><p>编写纯函数需要遵循一些习惯和规程。但它开启了绝妙的机遇：</p>
<ul>
<li>你的组件可以在不同的环境下运行 — 例如，在服务器上！由于它们针对相同的输入，总是返回相同的结果，因此一个组件可以满足多个用户请求。</li>
<li>你可以为那些输入未更改的组件来 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/reference/react/memo">跳过渲染</a>，以提高性能。这是安全的做法，因为纯函数总是返回相同的结果，所以可以安全地缓存它们。</li>
<li>如果在渲染深层组件树的过程中，某些数据发生了变化，React 可以重新开始渲染，而不会浪费时间完成过时的渲染。纯粹性使得它随时可以安全地停止计算。</li>
</ul>
<p>我们正在构建的每个 React 新特性都利用到了纯函数。从数据获取到动画再到性能，保持组件的纯粹可以充分释放 React 范式的能力。</p>
</blockquote>
<h3 id="2-6-5-摘要"><a href="#2-6-5-摘要" class="headerlink" title="2.6.5 摘要"></a>2.6.5 摘要</h3><ul>
<li>一个组件必须是纯粹的，就意味着：<ul>
<li><strong>只负责自己的任务。</strong> 它不会更改在该函数调用前就已存在的对象或变量。</li>
<li><strong>输入相同，则输出相同。</strong> 给定相同的输入，组件应该总是返回相同的 JSX。</li>
</ul>
</li>
<li>渲染随时可能发生，因此组件不应依赖于彼此的渲染顺序。</li>
<li>你不应该改变任何用于组件渲染的输入。这包括 props、state 和 context。通过 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/state-a-components-memory">“设置” state</a> 来更新界面，而不要改变预先存在的对象。</li>
<li>努力在你返回的 JSX 中表达你的组件逻辑。当你需要“改变事物”时，你通常希望在事件处理程序中进行。作为最后的手段，你可以使用 <code>useEffect</code>。</li>
<li>编写纯函数需要一些练习，但它充分释放了 React 范式的能力。</li>
</ul>
<h2 id="2-7-将-UI-视为树"><a href="#2-7-将-UI-视为树" class="headerlink" title="2.7 将 UI 视为树"></a>2.7 将 UI 视为树</h2><p>当 React 应用程序逐渐成形时，许多组件会出现嵌套。那么 React 是如何跟踪应用程序组件结构的？</p>
<p>React 以及许多其他 UI 库，将 UI 建模为树。将应用程序视为树对于理解组件之间的关系以及调试性能和状态管理等未来将会遇到的一些概念非常有用。</p>
<h3 id="2-7-1-树结构"><a href="#2-7-1-树结构" class="headerlink" title="2.7.1 树结构"></a>2.7.1 树结构</h3><p>树是项目和 UI 之间的关系模型，通常使用树结构来表示 UI。例如，浏览器使用树结构来建模 HTML（<a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/Document_Object_Model/Introduction">DOM</a>）与CSS（<a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/CSS_Object_Model">CSSOM</a>）。移动平台也使用树来表示其视图层次结构。</p>
<p><img src="https://zh-hans.react.dev/_next/image?url=/images/docs/diagrams/preserving_state_dom_tree.dark.png&w=1920&q=75"></p>
<p>React 从组件中创建 UI 树。在这个示例中，UI 树最后会用于渲染 DOM。</p>
<p>水平排列的三个部分的图表。第一部分有三个垂直堆叠的矩形，并分别标记为 Component A、Component B 和 Component C。向下一个窗格过渡的是一个带有 React 标志的箭头，标记为 React。中间部分包含一棵组件树，根节点标记为 A，有两个子节点分别标记为 B 和 C。下一个部分再次使用带有 React 标志的箭头进行过渡，标记为 React DOM。第三和最后一个部分是浏览器的线框图，包含一棵有 8 个节点的树，其中只有一个子集被突出显示（表示中间部分的子树）。</p>
<p>与浏览器和移动平台一样，React 还使用树结构来管理和建模 React 应用程序中组件之间的关系。这些树是有用的工具，用于理解数据如何在 React 应用程序中流动以及如何优化呈现和应用程序大小。</p>
<h3 id="2-7-2-渲染树"><a href="#2-7-2-渲染树" class="headerlink" title="2.7.2 渲染树"></a>2.7.2 渲染树</h3><p>组件的一个主要特性是能够由其他组件组合而成。在 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/your-first-component#nesting-and-organizing-components">嵌套组件</a> 中有父组件和子组件的概念，其中每个父组件本身可能是另一个组件的子组件。</p>
<p>当渲染 React 应用程序时，可以在一个称为渲染树的树中建模这种关系。</p>
<p>下面的 React 应用程序渲染了一些鼓舞人心的引语。</p>
<p><code>App.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">FancyText</span> <span class="keyword">from</span> <span class="string">&#x27;./FancyText&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">InspirationGenerator</span> <span class="keyword">from</span> <span class="string">&#x27;./InspirationGenerator&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Copyright</span> <span class="keyword">from</span> <span class="string">&#x27;./Copyright&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">FancyText</span> <span class="attr">title</span> <span class="attr">text</span>=<span class="string">&quot;Get Inspired App&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">InspirationGenerator</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Copyright</span> <span class="attr">year</span>=<span class="string">&#123;2004&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">InspirationGenerator</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>FancyText.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">FancyText</span>(<span class="params">&#123;title, text&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> title</span><br><span class="line">    ? <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">&#x27;fancy title&#x27;</span>&gt;</span>&#123;text&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    : <span class="language-xml"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">className</span>=<span class="string">&#x27;fancy cursive&#x27;</span>&gt;</span>&#123;text&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>InspirationGenerator.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> quotes <span class="keyword">from</span> <span class="string">&#x27;./quotes&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">FancyText</span> <span class="keyword">from</span> <span class="string">&#x27;./FancyText&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">InspirationGenerator</span>(<span class="params">&#123;children&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [index, setIndex] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> quote = quotes[index];</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">next</span> = (<span class="params"></span>) =&gt; <span class="title function_">setIndex</span>((index + <span class="number">1</span>) % quotes.<span class="property">length</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>Your inspirational quote is:<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">FancyText</span> <span class="attr">text</span>=<span class="string">&#123;quote&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;next&#125;</span>&gt;</span>Inspire me again<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Copyright.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Copyright</span>(<span class="params">&#123;year&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&#x27;small&#x27;</span>&gt;</span>©️ &#123;year&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>quotes.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">  <span class="string">&quot;Don’t let yesterday take up too much of today.” — Will Rogers&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Ambition is putting a ladder against the sky.&quot;</span>,</span><br><span class="line">  <span class="string">&quot;A joy that&#x27;s shared is a joy made double.&quot;</span>,</span><br><span class="line">  ];</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/mysql20240927162318.png"></p>
<p>通过示例应用程序，可以构建上面的渲染树。</p>
<p>这棵树由节点组成，每个节点代表一个组件。例如，<code>App</code>、<code>FancyText</code>、<code>Copyright</code> 等都是我们树中的节点。</p>
<p>在 React 渲染树中，根节点是应用程序的 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/importing-and-exporting-components#the-root-component-file">根组件</a>。在这种情况下，根组件是 <code>App</code>，它是 React 渲染的第一个组件。树中的每个箭头从父组件指向子组件。</p>
<blockquote>
<h4 id="那么渲染树中的-HTML-标签在哪里呢？"><a href="#那么渲染树中的-HTML-标签在哪里呢？" class="headerlink" title="那么渲染树中的 HTML 标签在哪里呢？"></a>那么渲染树中的 HTML 标签在哪里呢？</h4><p>也许会注意到在上面的渲染树中，没有提到每个组件渲染的 HTML 标签。这是因为渲染树仅由 React <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/your-first-component#components-ui-building-blocks">组件</a> 组成。</p>
<p>React 是跨平台的 UI 框架。react.dev 展示了一些渲染到使用 HTML 标签作为 UI 原语的 web 的示例。但是 React 应用程序同样可以渲染到移动设备或桌面平台，这些平台可能使用不同的 UI 原语，如 <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/uikit/uiview">UIView</a> 或 <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/dotnet/api/system.windows.frameworkelement?view=windowsdesktop-7.0">FrameworkElement</a>。</p>
<p>这些平台 UI 原语不是 React 的一部分。无论应用程序渲染到哪个平台，React 渲染树都可以为 React 应用程序提供见解。</p>
</blockquote>
<p>渲染树表示 React 应用程序的单个渲染过程。在 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/conditional-rendering">条件渲染</a> 中，父组件可以根据传递的数据渲染不同的子组件。</p>
<p>我们可以更新应用程序以有条件地渲染励志语录或颜色。</p>
<p><code>App.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">FancyText</span> <span class="keyword">from</span> <span class="string">&#x27;./FancyText&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">InspirationGenerator</span> <span class="keyword">from</span> <span class="string">&#x27;./InspirationGenerator&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Copyright</span> <span class="keyword">from</span> <span class="string">&#x27;./Copyright&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">FancyText</span> <span class="attr">title</span> <span class="attr">text</span>=<span class="string">&quot;Get Inspired App&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">InspirationGenerator</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Copyright</span> <span class="attr">year</span>=<span class="string">&#123;2004&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">InspirationGenerator</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>FancyText.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">FancyText</span>(<span class="params">&#123;title, text&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> title</span><br><span class="line">    ? <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">&#x27;fancy title&#x27;</span>&gt;</span>&#123;text&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    : <span class="language-xml"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">className</span>=<span class="string">&#x27;fancy cursive&#x27;</span>&gt;</span>&#123;text&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Color.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Color</span>(<span class="params">&#123;value&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;colorbox&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;backgroundColor:</span> <span class="attr">value</span>&#125;&#125; /&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>InspirationGenerator.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> inspirations <span class="keyword">from</span> <span class="string">&#x27;./inspirations&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">FancyText</span> <span class="keyword">from</span> <span class="string">&#x27;./FancyText&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Color</span> <span class="keyword">from</span> <span class="string">&#x27;./Color&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">InspirationGenerator</span>(<span class="params">&#123;children&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [index, setIndex] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> inspiration = inspirations[index];</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">next</span> = (<span class="params"></span>) =&gt; <span class="title function_">setIndex</span>((index + <span class="number">1</span>) % inspirations.<span class="property">length</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>Your inspirational &#123;inspiration.type&#125; is:<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;inspiration.type === &#x27;quote&#x27;</span></span><br><span class="line"><span class="language-xml">      ? <span class="tag">&lt;<span class="name">FancyText</span> <span class="attr">text</span>=<span class="string">&#123;inspiration.value&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      : <span class="tag">&lt;<span class="name">Color</span> <span class="attr">value</span>=<span class="string">&#123;inspiration.value&#125;</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;next&#125;</span>&gt;</span>Inspire me again<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Copyright.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Copyright</span>(<span class="params">&#123;year&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&#x27;small&#x27;</span>&gt;</span>©️ &#123;year&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>inspirations.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">  &#123;<span class="attr">type</span>: <span class="string">&#x27;quote&#x27;</span>, <span class="attr">value</span>: <span class="string">&quot;Don’t let yesterday take up too much of today.” — Will Rogers&quot;</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">type</span>: <span class="string">&#x27;color&#x27;</span>, <span class="attr">value</span>: <span class="string">&quot;#B73636&quot;</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">type</span>: <span class="string">&#x27;quote&#x27;</span>, <span class="attr">value</span>: <span class="string">&quot;Ambition is putting a ladder against the sky.&quot;</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">type</span>: <span class="string">&#x27;color&#x27;</span>, <span class="attr">value</span>: <span class="string">&quot;#256266&quot;</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">type</span>: <span class="string">&#x27;quote&#x27;</span>, <span class="attr">value</span>: <span class="string">&quot;A joy that&#x27;s shared is a joy made double.&quot;</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">type</span>: <span class="string">&#x27;color&#x27;</span>, <span class="attr">value</span>: <span class="string">&quot;#F9F2B4&quot;</span>&#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/mysql20240927165151.png"></p>
<p>在这个示例中，根据 <code>inspiration.type</code> 的值可能会渲染 <code>&lt;FancyText&gt;</code> 或 <code>&lt;Color&gt;</code>。每次渲染过程的渲染树可能都不同。</p>
<p>尽管渲染树可能在不同的渲染过程中有所不同，但通常这些树有助于识别 React 应用程序中的顶级和叶子组件。顶级组件是离根组件最近的组件，它们影响其下所有组件的渲染性能，通常包含最多复杂性。叶子组件位于树的底部，没有子组件，通常会频繁重新渲染。</p>
<p>识别这些组件类别有助于理解应用程序的数据流和性能。</p>
<h3 id="2-7-3-模块依赖树"><a href="#2-7-3-模块依赖树" class="headerlink" title="2.7.3 模块依赖树"></a>2.7.3 模块依赖树</h3><p>在 React 应用程序中，可以使用树来建模的另一个关系是应用程序的模块依赖关系。当 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/importing-and-exporting-components#exporting-and-importing-a-component">拆分组件</a> 和逻辑到不同的文件中时，就创建了 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules">JavaScript 模块</a>，在这些模块中可以导出组件、函数或常量。</p>
<p>模块依赖树中的每个节点都是一个模块，每个分支代表该模块中的 <code>import</code> 语句。</p>
<p>以之前的 Inspirations 应用程序为例，可以构建一个模块依赖树，简称依赖树。</p>
<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/mysql20240927165508.png"></p>
<p>树的根节点是根模块，也称为入口文件。它通常包含根组件的模块。</p>
<p>与同一应用程序的渲染树相比，存在相似的结构，但也有一些显著的差异：</p>
<ul>
<li>构成树的节点代表模块，而不是组件。</li>
<li>非组件模块，如 <code>inspirations.js</code>，在这个树中也有所体现。渲染树仅封装组件。</li>
<li><code>Copyright.js</code> 出现在 <code>App.js</code> 下，但在渲染树中，<code>Copyright</code> 作为 <code>InspirationGenerator</code> 的子组件出现。这是因为 <code>InspirationGenerator</code> 接受 JSX 作为 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/passing-props-to-a-component#passing-jsx-as-children">children props</a>，因此它将 <code>Copyright</code> 作为子组件渲染，但不导入该模块。</li>
</ul>
<p>依赖树对于确定运行 React 应用程序所需的模块非常有用。在为生产环境构建 React 应用程序时，通常会有一个构建步骤，该步骤将捆绑所有必要的 JavaScript 以供客户端使用。负责此操作的工具称为 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Learn/Tools_and_testing/Understanding_client-side_tools/Overview#the_modern_tooling_ecosystem">bundler（捆绑器）</a>，并且 bundler 将使用依赖树来确定应包含哪些模块。</p>
<p>随着应用程序的增长，捆绑包大小通常也会增加。大型捆绑包大小对于客户端来说下载和运行成本高昂，并延迟 UI 绘制的时间。了解应用程序的依赖树可能有助于调试这些问题。</p>
<h3 id="2-7-4-摘要"><a href="#2-7-4-摘要" class="headerlink" title="2.7.4 摘要"></a>2.7.4 摘要</h3><ul>
<li>树是表示实体之间关系的常见方式，它们经常用于建模 UI。</li>
<li>渲染树表示单次渲染中 React 组件之间的嵌套关系。</li>
<li>使用条件渲染，渲染树可能会在不同的渲染过程中发生变化。使用不同的属性值，组件可能会渲染不同的子组件。</li>
<li>渲染树有助于识别顶级组件和叶子组件。顶级组件会影响其下所有组件的渲染性能，而叶子组件通常会频繁重新渲染。识别它们有助于理解和调试渲染性能问题。</li>
<li>依赖树表示 React 应用程序中的模块依赖关系。</li>
<li>构建工具使用依赖树来捆绑必要的代码以部署应用程序。</li>
<li>依赖树有助于调试大型捆绑包带来的渲染速度过慢的问题，以及发现哪些捆绑代码可以被优化。</li>
</ul>
<h1 id="3-交互"><a href="#3-交互" class="headerlink" title="3. 交互"></a>3. 交互</h1><p>界面上的控件会根据用户的输入而更新。例如，点击按钮切换轮播图的展示。在 React 中，随时间变化的数据被称为状态（state）。你可以向任何组件添加状态，并按需进行更新。在本章节中，你将学习如何编写处理交互的组件，更新它们的状态，并根据时间变化显示不同的效果。</p>
<h2 id="3-1-响应事件"><a href="#3-1-响应事件" class="headerlink" title="3.1 响应事件"></a>3.1 响应事件</h2><p>使用 React 可以在 JSX 中添加 <strong>事件处理函数</strong>。其中事件处理函数为自定义函数，它将在响应交互（如点击、悬停、表单输入框获得焦点等）时触发。</p>
<h3 id="3-1-1-添加事件处理函数"><a href="#3-1-1-添加事件处理函数" class="headerlink" title="3.1.1 添加事件处理函数"></a>3.1.1 添加事件处理函数</h3><p>如需添加一个事件处理函数，你需要先定义一个函数，然后 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/passing-props-to-a-component">将其作为 prop 传入</a> 合适的 JSX 标签。例如，这里有一个没绑定任何事件的按钮：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      未绑定任何事件</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>按照如下三个步骤，即可让它在用户点击时显示消息：</p>
<ol>
<li>在 <code>Button</code> 组件 <strong>内部</strong> 声明一个名为 <code>handleClick</code> 的函数。</li>
<li>实现函数内部的逻辑（使用 <code>alert</code> 来显示消息）。</li>
<li>添加 <code>onClick=&#123;handleClick&#125;</code> 到 <code>&lt;button&gt;</code> JSX 中。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;点击&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">     <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      点击</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你可以定义 <code>handleClick</code> 函数然后 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/passing-props-to-a-component">将其作为 prop 传入</a> <code>&lt;button&gt;</code>。其中 <code>handleClick</code> 是一个 <strong>事件处理函数</strong> 。事件处理函数有如下特点:</p>
<ul>
<li>通常在你的组件 <strong>内部</strong> 定义。</li>
<li>名称以 <code>handle</code> 开头，后跟事件名称。</li>
</ul>
<blockquote>
<p>按照惯例，通常将事件处理程序命名为 <code>handle</code>，后接事件名。你会经常看到 <code>onClick=&#123;handleClick&#125;</code>，<code>onMouseEnter=&#123;handleMouseEnter&#125;</code> 等。</p>
</blockquote>
<p>或者，你也可以在 JSX 中定义一个内联的事件处理函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onClick=&#123;<span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&#x27;你点击了我！&#x27;</span>);</span><br><span class="line">&#125;&#125;&gt;</span><br></pre></td></tr></table></figure>

<p>或者，直接使用更为简洁箭头函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&#x27;你点击了我！&#x27;</span>);</span><br><span class="line">&#125;&#125;&gt;</span><br></pre></td></tr></table></figure>

<p>以上所有方式都是等效的。当函数体较短时，内联事件处理函数会很方便。</p>
<blockquote>
<p>传递给事件处理函数的函数应直接传递，而非调用。例如：</p>
<table>
<thead>
<tr>
<th>传递一个函数（正确）</th>
<th>调用一个函数（错误）</th>
</tr>
</thead>
<tbody><tr>
<td><code>&lt;button onClick=&#123;handleClick&#125;&gt;</code></td>
<td><code>&lt;button onClick=&#123;handleClick()&#125;&gt;</code></td>
</tr>
</tbody></table>
<p>区别很微妙。在第一个示例中，<code>handleClick</code> 函数作为 <code>onClick</code> 事件处理函数传递。这会让 React 记住它，并且只在用户点击按钮时调用你的函数。</p>
<p>在第二个示例中，<code>handleClick()</code> 中最后的 <code>()</code> 会在 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/render-and-commit">渲染</a> 过程中 <strong>立即</strong> 触发函数，即使没有任何点击。这是因为位于 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/javascript-in-jsx-with-curly-braces">JSX <code>&#123;&#125;</code></a> 之间的 JavaScript 会立即执行。</p>
<p>当你编写内联代码时，同样的陷阱可能会以不同的方式出现：</p>
<table>
<thead>
<tr>
<th>传递一个函数（正确）</th>
<th>调用一个函数（错误）</th>
</tr>
</thead>
<tbody><tr>
<td><code>&lt;button onClick=&#123;() =&gt; alert(&#39;...&#39;)&#125;&gt;</code></td>
<td><code>&lt;button onClick=&#123;alert(&#39;...&#39;)&#125;&gt;</code></td>
</tr>
</tbody></table>
<p>如果按如下方式传递内联代码，并不会在点击时触发，而是会在每次组件渲染时触发：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 这个 alert 在组件渲染时触发，而不是点击时触发！</span><br><span class="line"></span><br><span class="line">&lt;button onClick=&#123;alert(&#x27;你点击了我！&#x27;)&#125;&gt;</span><br></pre></td></tr></table></figure>

<p>如果你想要定义内联事件处理函数，请将其包装在匿名函数中，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onClick=&#123;() =&gt; alert(&#x27;你点击了我！&#x27;)&#125;&gt;</span><br></pre></td></tr></table></figure>

<p>这里创建了一个稍后调用的函数，而不会在每次渲染时执行其内部代码。</p>
<p>在这两种情况下，你都应该传递一个函数：</p>
<ul>
<li><code>&lt;button onClick=&#123;handleClick&#125;&gt;</code> 传递了 <code>handleClick</code> 函数。</li>
<li><code>&lt;button onClick=&#123;() =&gt; alert(&#39;...&#39;)&#125;&gt;</code> 传递了 <code>() =&gt; alert(&#39;...&#39;)</code> 函数。</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://zh.javascript.info/arrow-functions-basics">了解更多箭头函数的信息</a>。</p>
</blockquote>
</blockquote>
<h3 id="3-1-2-在事件处理函数中读取-props"><a href="#3-1-2-在事件处理函数中读取-props" class="headerlink" title="3.1.2 在事件处理函数中读取 props"></a>3.1.2 在事件处理函数中读取 props</h3><p>由于事件处理函数声明于组件内部，因此它们可以直接访问组件的 props。示例中的按钮，当点击时会弹出带有 <code>message</code> prop 的 alert：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">AlertButton</span>(<span class="params">&#123; message, children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> alert(message)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Toolbar</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">AlertButton</span> <span class="attr">message</span>=<span class="string">&quot;正在播放！&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        播放电影</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">AlertButton</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">AlertButton</span> <span class="attr">message</span>=<span class="string">&quot;正在上传！&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        上传图片</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">AlertButton</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此处有两个按钮，会展示不同的消息。你可以尝试更改传递给它们的消息。</p>
<h3 id="3-1-3-将事件处理函数作为-props-传递"><a href="#3-1-3-将事件处理函数作为-props-传递" class="headerlink" title="3.1.3 将事件处理函数作为 props 传递"></a>3.1.3 将事件处理函数作为 props 传递</h3><p>通常，我们会在父组件中定义子组件的事件处理函数。比如：置于不同位置的 <code>Button</code> 组件，可能最终执行的功能也不同 —— 也许是播放电影，也许是上传图片。</p>
<p>为此，将组件从父组件接收的 prop 作为事件处理函数传递，如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params">&#123; onClick, children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;onClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">PlayButton</span>(<span class="params">&#123; movieName &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handlePlayClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">`正在播放 <span class="subst">$&#123;movieName&#125;</span>！`</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">onClick</span>=<span class="string">&#123;handlePlayClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      播放 &quot;&#123;movieName&#125;&quot;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">UploadButton</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> alert(&#x27;正在上传！&#x27;)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      上传图片</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Toolbar</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PlayButton</span> <span class="attr">movieName</span>=<span class="string">&quot;魔女宅急便&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">UploadButton</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>示例中，<code>Toolbar</code> 组件渲染了一个 <code>PlayButton</code> 组件和 <code>UploadButton</code> 组件：</p>
<ul>
<li><code>PlayButton</code> 将 <code>handlePlayClick</code> 作为 <code>onClick</code> prop 传入 <code>Button</code> 组件内部。</li>
<li><code>UploadButton</code> 将 <code>() =&gt; alert(&#39;正在上传！&#39;)</code> 作为 <code>onClick</code> prop 传入 <code>Button</code> 组件内部。</li>
</ul>
<p>最后，你的 <code>Button</code> 组件接收一个名为 <code>onClick</code> 的 prop。它直接将这个 prop 以 <code>onClick=&#123;onClick&#125;</code> 方式传递给浏览器内置的 <code>&lt;button&gt;</code>。当点击按钮时，React 会调用传入的函数。</p>
<p>如果你遵循某个 <a target="_blank" rel="noopener" href="https://uxdesign.cc/everything-you-need-to-know-about-design-systems-54b109851969">设计系统</a> 时，按钮之类的组件通常会包含样式，但不会指定行为。而 <code>PlayButton</code> 和 <code>UploadButton</code> 之类的组件则会向下传递事件处理函数。</p>
<h3 id="3-1-4-命名事件处理函数-prop"><a href="#3-1-4-命名事件处理函数-prop" class="headerlink" title="3.1.4 命名事件处理函数 prop"></a>3.1.4 命名事件处理函数 prop</h3><p>内置组件（<code>&lt;button&gt;</code> 和 <code>&lt;div&gt;</code>）仅支持 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/reference/react-dom/components/common#common-props">浏览器事件名称</a>，例如 <code>onClick</code>。但是，当你构建自己的组件时，你可以按你个人喜好命名事件处理函数的 prop。</p>
<blockquote>
<p>按照惯例，事件处理函数 props 应该以 <code>on</code> 开头，后跟一个大写字母。</p>
</blockquote>
<p>例如，<code>Button</code> 组件的 <code>onClick</code> prop 本来也可以被命名为 <code>onSmash</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params">&#123; onSmash, children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;onSmash&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Button</span> <span class="attr">onSmash</span>=<span class="string">&#123;()</span> =&gt;</span> alert(&#x27;正在播放！&#x27;)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        播放电影</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Button</span> <span class="attr">onSmash</span>=<span class="string">&#123;()</span> =&gt;</span> alert(&#x27;正在上传！&#x27;)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        上传图片</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述示例中，<code>&lt;button onClick=&#123;onSmash&#125;&gt;</code> 代表浏览器内置的 <code>&lt;button&gt;</code>（小写）仍然需要使用 <code>onClick</code> prop，而自定义的 <code>Button</code> 组件接收到的 prop 名称可由你决定！</p>
<p>当你的组件支持多种交互时，你可以根据不同的应用程序命名事件处理函数 prop。例如，一个 <code>Toolbar</code> 组件接收 <code>onPlayMovie</code> 和 <code>onUploadImage</code> 两个事件处理函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Toolbar</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onPlayMovie</span>=<span class="string">&#123;()</span> =&gt;</span> alert(&#x27;正在播放！&#x27;)&#125;</span></span><br><span class="line"><span class="language-xml">      onUploadImage=&#123;() =&gt; alert(&#x27;正在上传！&#x27;)&#125;</span></span><br><span class="line"><span class="language-xml">    /&gt;</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Toolbar</span>(<span class="params">&#123; onPlayMovie, onUploadImage &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Button</span> <span class="attr">onClick</span>=<span class="string">&#123;onPlayMovie&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        播放电影</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Button</span> <span class="attr">onClick</span>=<span class="string">&#123;onUploadImage&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        上传图片</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params">&#123; onClick, children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;onClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请注意，<code>App</code> 组件并不需要知道 <code>Toolbar</code> 将会对 <code>onPlayMovie</code> 和 <code>onUploadImage</code> 做 <strong>什么</strong> 。上述示例是 <code>Toolbar</code> 的实现细节。其中，<code>Toolbar</code> 将它们作为 <code>onClick</code> 处理函数传递给了 <code>Button</code> 组件，其实还可以通过键盘快捷键来触发它们。根据应用程序特定的交互方式（如 <code>onPlayMovie</code>）来命名 prop ，可以让你灵活地更改以后使用它们的方式。</p>
<blockquote>
<p>确保为事件处理程序使用适当的 HTML 标签。例如，要处理点击事件，请使用 <button onClick={handleClick}> 而不是 <code>&lt;div onClick=&#123;handleClick&#125;&gt;</code>。使用真正的浏览器 <code>&lt;button&gt;</code> 启用内置的浏览器行为，如键盘导航。如果你不喜欢按钮的默认浏览器样式，并且想让它看起来更像一个链接或不同的 UI 元素，你可以使用 CSS 来实现。<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Learn/Accessibility/HTML">了解有关编写无障碍标签的更多信息</a>。</p>
</blockquote>
<h3 id="3-1-5-事件传播"><a href="#3-1-5-事件传播" class="headerlink" title="3.1.5 事件传播"></a>3.1.5 事件传播</h3><p>事件处理函数还将捕获任何来自子组件的事件。通常，我们会说事件会沿着树向上“冒泡”或“传播”：它从事件发生的地方开始，然后沿着树向上传播。</p>
<p>下面这个 <code>&lt;div&gt;</code> 包含两个按钮。<code>&lt;div&gt;</code> 和每个按钮都有自己的 <code>onClick</code> 处理函数。你认为点击按钮时会触发哪些处理函数？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Toolbar</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;Toolbar&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">      alert(&#x27;你点击了 toolbar ！&#x27;);</span></span><br><span class="line"><span class="language-xml">    &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> alert(&#x27;正在播放！&#x27;)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        播放电影</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> alert(&#x27;正在上传！&#x27;)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        上传图片</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果你点击任一按钮，它自身的 <code>onClick</code> 将首先执行，然后父级 <code>&lt;div&gt;</code> 的 <code>onClick</code> 会接着执行。因此会出现两条消息。如果你点击 toolbar 本身，将只有父级 <code>&lt;div&gt;</code> 的 <code>onClick</code> 会执行。</p>
<blockquote>
<p>在 React 中所有事件都会传播，除了 <code>onScroll</code>，它仅适用于你附加到的 JSX 标签。</p>
</blockquote>
<h3 id="3-1-6-阻止传播"><a href="#3-1-6-阻止传播" class="headerlink" title="3.1.6 阻止传播"></a>3.1.6 阻止传播</h3><p>事件处理函数接收一个 <strong>事件对象</strong> 作为唯一的参数。按照惯例，它通常被称为 <code>e</code> ，代表 “event”（事件）。你可以使用此对象来读取有关事件的信息。</p>
<p>这个事件对象还允许你阻止传播。如果你想阻止一个事件到达父组件，你需要像下面 <code>Button</code> 组件那样调用 <code>e.stopPropagation()</code> ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params">&#123; onClick, children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">      e.stopPropagation();</span></span><br><span class="line"><span class="language-xml">      onClick();</span></span><br><span class="line"><span class="language-xml">    &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Toolbar</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;Toolbar&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">      alert(&#x27;你点击了 toolbar ！&#x27;);</span></span><br><span class="line"><span class="language-xml">    &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> alert(&#x27;正在播放！&#x27;)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        播放电影</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> alert(&#x27;正在上传！&#x27;)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        上传图片</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当你点击按钮时：</p>
<ol>
<li>React 调用了传递给 <code>&lt;button&gt;</code> 的 <code>onClick</code> 处理函数。</li>
<li>定义在<code>Button</code>中的处理函数执行了如下操作：<ul>
<li>调用 <code>e.stopPropagation()</code>，阻止事件进一步冒泡。</li>
<li>调用 <code>onClick</code> 函数，它是从 <code>Toolbar</code> 组件传递过来的 prop。</li>
</ul>
</li>
<li>在 <code>Toolbar</code> 组件中定义的函数，显示按钮对应的 alert。</li>
<li>由于传播被阻止，父级 <code>&lt;div&gt;</code> 的 <code>onClick</code> 处理函数不会执行。</li>
</ol>
<p>由于调用了 <code>e.stopPropagation()</code>，点击按钮现在将只显示一个 alert（来自 <code>&lt;button&gt;</code>），而并非两个（分别来自 <code>&lt;button&gt;</code> 和父级 toolbar <code>&lt;div&gt;</code>）。点击按钮与点击周围的 toolbar 不同，因此阻止传播对这个 UI 是有意义的。</p>
<blockquote>
<h4 id="捕获阶段事件"><a href="#捕获阶段事件" class="headerlink" title="捕获阶段事件"></a>捕获阶段事件</h4><p>极少数情况下，你可能需要捕获子元素上的所有事件，<strong>即便它们阻止了传播</strong>。例如，你可能想对每次点击进行埋点记录，传播逻辑暂且不论。那么你可以通过在事件名称末尾添加 <code>Capture</code> 来实现这一点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div onClickCapture=&#123;() =&gt; &#123; /* 这会首先执行 */ &#125;&#125;&gt;</span><br><span class="line">  &lt;button onClick=&#123;e =&gt; e.stopPropagation()&#125; /&gt;</span><br><span class="line">  &lt;button onClick=&#123;e =&gt; e.stopPropagation()&#125; /&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>每个事件分三个阶段传播：</p>
<ol>
<li>它向下传播，调用所有的 <code>onClickCapture</code> 处理函数。</li>
<li>它执行被点击元素的 <code>onClick</code> 处理函数。</li>
<li>它向上传播，调用所有的 <code>onClick</code> 处理函数。</li>
</ol>
<p>捕获事件对于路由或数据分析之类的代码很有用，但你可能不会在应用程序代码中使用它们。</p>
</blockquote>
<h3 id="3-1-7-传递处理函数作为事件传播的替代方案"><a href="#3-1-7-传递处理函数作为事件传播的替代方案" class="headerlink" title="3.1.7 传递处理函数作为事件传播的替代方案"></a>3.1.7 传递处理函数作为事件传播的替代方案</h3><p>注意，此处的点击事件处理函数先执行了一行代码，<strong>然后</strong>调用了父组件传递的 <code>onClick</code> prop：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params">&#123; onClick, children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">      e.stopPropagation();</span></span><br><span class="line"><span class="language-xml">      onClick();</span></span><br><span class="line"><span class="language-xml">    &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你也可以在调用父元素 <code>onClick</code> 函数之前，向这个处理函数添加更多代码。此模式是事件传播的另一种 <strong>替代方案</strong> 。它让子组件处理事件，同时也让父组件指定一些额外的行为。与事件传播不同，它并非自动。但使用这种模式的好处是你可以清楚地追踪因某个事件的触发而执行的整条代码链。</p>
<p>如果你依赖于事件传播，而且很难追踪哪些处理程序在执行，及其执行的原因，可以尝试这种方法。</p>
<h3 id="3-1-8-阻止默认行为"><a href="#3-1-8-阻止默认行为" class="headerlink" title="3.1.8 阻止默认行为"></a>3.1.8 阻止默认行为</h3><p>某些浏览器事件具有与事件相关联的默认行为。例如，点击 <code>&lt;form&gt;</code> 表单内部的按钮会触发表单提交事件，默认情况下将重新加载整个页面：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Signup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">onSubmit</span>=<span class="string">&#123;()</span> =&gt;</span> alert(&#x27;提交表单！&#x27;)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span>&gt;</span>发送<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你可以调用事件对象中的 <code>e.preventDefault()</code> 来阻止这种情况发生：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Signup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">onSubmit</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">      e.preventDefault();</span></span><br><span class="line"><span class="language-xml">      alert(&#x27;提交表单！&#x27;);</span></span><br><span class="line"><span class="language-xml">    &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span>&gt;</span>发送<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不要混淆 <code>e.stopPropagation()</code> 和 <code>e.preventDefault()</code>。它们都很有用，但二者并不相关：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/Event/stopPropagation"><code>e.stopPropagation()</code></a> 阻止触发绑定在外层标签上的事件处理函数。</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/Event/preventDefault"><code>e.preventDefault()</code></a> 阻止少数事件的默认浏览器行为。</li>
</ul>
<h3 id="3-1-9-事件处理函数可以包含副作用吗？"><a href="#3-1-9-事件处理函数可以包含副作用吗？" class="headerlink" title="3.1.9 事件处理函数可以包含副作用吗？"></a>3.1.9 事件处理函数可以包含副作用吗？</h3><p>当然可以！事件处理函数是执行副作用的最佳位置。</p>
<p>与渲染函数不同，事件处理函数不需要是 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/keeping-components-pure">纯函数</a>，因此它是用来 <em>更改</em> 某些值的绝佳位置。例如，更改输入框的值以响应键入，或者更改列表以响应按钮的触发。但是，为了更改某些信息，你首先需要某种方式存储它。在 React 中，这是通过 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/state-a-components-memory">state（组件的记忆）</a> 来完成的。</p>
<h3 id="3-1-10-摘要"><a href="#3-1-10-摘要" class="headerlink" title="3.1.10 摘要"></a>3.1.10 摘要</h3><ul>
<li>你可以通过将函数作为 prop 传递给元素如 <code>&lt;button&gt;</code> 来处理事件。</li>
<li>必须传递事件处理函数，<strong>而非函数调用！</strong> <code>onClick=&#123;handleClick&#125;</code> ，不是 <code>onClick=&#123;handleClick()&#125;</code>。</li>
<li>你可以单独或者内联定义事件处理函数。</li>
<li>事件处理函数在组件内部定义，所以它们可以访问 props。</li>
<li>你可以在父组件中定义一个事件处理函数，并将其作为 prop 传递给子组件。</li>
<li>你可以根据特定于应用程序的名称定义事件处理函数的 prop。</li>
<li>事件会向上传播。通过事件的第一个参数调用 <code>e.stopPropagation()</code> 来防止这种情况。</li>
<li>事件可能具有不需要的浏览器默认行为。调用 <code>e.preventDefault()</code> 来阻止这种情况。</li>
<li>从子组件显式调用事件处理函数 prop 是事件传播的另一种优秀替代方案。</li>
</ul>
<h2 id="3-2-State：组件的记忆"><a href="#3-2-State：组件的记忆" class="headerlink" title="3.2 State：组件的记忆"></a>3.2 State：组件的记忆</h2><p>组件通常需要根据交互更改屏幕上显示的内容。输入表单应该更新输入字段，单击轮播图上的“下一个”应该更改显示的图片，单击“购买”应该将商品放入购物车。组件需要“记住”某些东西：当前输入值、当前图片、购物车。在 React 中，这种组件特有的记忆被称为 <strong>state</strong>。</p>
<h3 id="3-2-1-当普通的变量无法满足时"><a href="#3-2-1-当普通的变量无法满足时" class="headerlink" title="3.2.1 当普通的变量无法满足时"></a>3.2.1 当普通的变量无法满足时</h3><p>以下是一个渲染雕塑图片的组件。点击 “Next” 按钮应该显示下一个雕塑并将 <code>index</code> 更改为 <code>1</code>，再次点击又更改为 <code>2</code>，以此类推。但这个组件现在<strong>不起作用</strong>：</p>
<p><code>data.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> sculptureList = [&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Homenaje a la Neurocirugía&#x27;</span>,</span><br><span class="line">  <span class="attr">artist</span>: <span class="string">&#x27;Marta Colvin Andrade&#x27;</span>,</span><br><span class="line">  <span class="attr">description</span>: <span class="string">&#x27;Although Colvin is predominantly known for abstract themes that allude to pre-Hispanic symbols, this gigantic sculpture, an homage to neurosurgery, is one of her most recognizable public art pieces.&#x27;</span>,</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;https://i.imgur.com/Mx7dA2Y.jpg&#x27;</span>,</span><br><span class="line">  <span class="attr">alt</span>: <span class="string">&#x27;A bronze statue of two crossed hands delicately holding a human brain in their fingertips.&#x27;</span>  </span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Floralis Genérica&#x27;</span>,</span><br><span class="line">  <span class="attr">artist</span>: <span class="string">&#x27;Eduardo Catalano&#x27;</span>,</span><br><span class="line">  <span class="attr">description</span>: <span class="string">&#x27;This enormous (75 ft. or 23m) silver flower is located in Buenos Aires. It is designed to move, closing its petals in the evening or when strong winds blow and opening them in the morning.&#x27;</span>,</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;https://i.imgur.com/ZF6s192m.jpg&#x27;</span>,</span><br><span class="line">  <span class="attr">alt</span>: <span class="string">&#x27;A gigantic metallic flower sculpture with reflective mirror-like petals and strong stamens.&#x27;</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<p><code>App.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; sculptureList &#125; <span class="keyword">from</span> <span class="string">&#x27;./data.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Gallery</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    index = index + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> sculpture = sculptureList[index];</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Next</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">i</span>&gt;</span>&#123;sculpture.name&#125; <span class="tag">&lt;/<span class="name">i</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml">        by &#123;sculpture.artist&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>  </span></span><br><span class="line"><span class="language-xml">        (&#123;index + 1&#125; of &#123;sculptureList.length&#125;)</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">img</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">src</span>=<span class="string">&#123;sculpture.url&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">alt</span>=<span class="string">&#123;sculpture.alt&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;sculpture.description&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>handleClick()</code> 事件处理函数正在更新局部变量 <code>index</code>。但存在两个原因使得变化不可见：</p>
<ol>
<li><strong>局部变量无法在多次渲染中持久保存。</strong> 当 React 再次渲染这个组件时，它会从头开始渲染——不会考虑之前对局部变量的任何更改。</li>
<li><strong>更改局部变量不会触发渲染。</strong> React 没有意识到它需要使用新数据再次渲染组件。</li>
</ol>
<p>要使用新数据更新组件，需要做两件事：</p>
<ol>
<li><strong>保留</strong> 渲染之间的数据。</li>
<li><strong>触发</strong> React 使用新数据渲染组件（重新渲染）。</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://zh-hans.react.dev/reference/react/useState"><code>useState</code></a> Hook 提供了这两个功能：</p>
<ol>
<li><strong>State 变量</strong> 用于保存渲染间的数据。</li>
<li><strong>State setter 函数</strong> 更新变量并触发 React 再次渲染组件。</li>
</ol>
<h3 id="3-2-2-添加一个-state-变量"><a href="#3-2-2-添加一个-state-变量" class="headerlink" title="3.2.2 添加一个 state 变量"></a>3.2.2 添加一个 state 变量</h3><p>要添加 state 变量，先从文件顶部的 React 中导入 <code>useState</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>然后，替换这一行：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> index = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>将其修改为</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [index, setIndex] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p><code>index</code> 是一个 state 变量，<code>setIndex</code> 是对应的 setter 函数。</p>
<p>这里的 <code>[</code> 和 <code>]</code> 语法称为<a target="_blank" rel="noopener" href="https://zh.javascript.info/destructuring-assignment">数组解构</a>，它允许你从数组中读取值。 <code>useState</code> 返回的数组总是正好有两项。</p>
<p>以下展示了它们在 <code>handleClick()</code> 中是如何共同起作用的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">setIndex</span>(index + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在点击 “Next” 按钮切换当前雕塑：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; sculptureList &#125; <span class="keyword">from</span> <span class="string">&#x27;./data.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Gallery</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [index, setIndex] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">setIndex</span>(index + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> sculpture = sculptureList[index];</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Next</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">i</span>&gt;</span>&#123;sculpture.name&#125; <span class="tag">&lt;/<span class="name">i</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml">        by &#123;sculpture.artist&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>  </span></span><br><span class="line"><span class="language-xml">        (&#123;index + 1&#125; of &#123;sculptureList.length&#125;)</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">img</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">src</span>=<span class="string">&#123;sculpture.url&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">alt</span>=<span class="string">&#123;sculpture.alt&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;sculpture.description&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-3-遇见你的第一个-Hook"><a href="#3-2-3-遇见你的第一个-Hook" class="headerlink" title="3.2.3 遇见你的第一个 Hook"></a>3.2.3 遇见你的第一个 Hook</h3><p>在 React 中，<code>useState</code> 以及任何其他以“<code>use</code>”开头的函数都被称为 <strong>Hook</strong>。</p>
<p>Hook 是特殊的函数，只在 React <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/render-and-commit#step-1-trigger-a-render">渲染</a>时有效（我们将在下一节详细介绍）。它们能让你 “hook” 到不同的 React 特性中去。</p>
<p>State 只是这些特性中的一个，你之后还会遇到其他 Hook。</p>
<blockquote>
<p><strong>Hooks ——以 <code>use</code> 开头的函数——只能在组件或<a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/reusing-logic-with-custom-hooks">自定义 Hook</a> 的最顶层调用。</strong> 你不能在条件语句、循环语句或其他嵌套函数内调用 Hook。Hook 是函数，但将它们视为关于组件需求的无条件声明会很有帮助。在组件顶部 “use” React 特性，类似于在文件顶部“导入”模块。</p>
</blockquote>
<h3 id="3-2-4-剖析-useState"><a href="#3-2-4-剖析-useState" class="headerlink" title="3.2.4 剖析 useState"></a>3.2.4 剖析 useState</h3><p>当你调用 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/reference/react/useState"><code>useState</code></a> 时，你是在告诉 React 你想让这个组件记住一些东西：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [index, setIndex] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>在这个例子里，你希望 React 记住 <code>index</code>。</p>
<blockquote>
<p>惯例是将这对返回值命名为 <code>const [thing, setThing]</code>。你也可以将其命名为任何你喜欢的名称，但遵照约定俗成能使跨项目合作更易理解。</p>
</blockquote>
<p><code>useState</code> 的唯一参数是 state 变量的<strong>初始值</strong>。在这个例子中，<code>index</code> 的初始值被<code>useState(0)</code>设置为 <code>0</code>。</p>
<p>每次你的组件渲染时，<code>useState</code> 都会给你一个包含两个值的数组：</p>
<ol>
<li><strong>state 变量</strong> (<code>index</code>) 会保存上次渲染的值。</li>
<li><strong>state setter 函数</strong> (<code>setIndex</code>) 可以更新 state 变量并触发 React 重新渲染组件。</li>
</ol>
<p>以下是实际发生的情况：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [index, setIndex] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>组件进行第一次渲染。</strong> 因为你将 <code>0</code> 作为 <code>index</code> 的初始值传递给 <code>useState</code>，它将返回 <code>[0, setIndex]</code>。 React 记住 <code>0</code> 是最新的 state 值。</li>
<li><strong>你更新了 state</strong>。当用户点击按钮时，它会调用 <code>setIndex(index + 1)</code>。 <code>index</code> 是 <code>0</code>，所以它是 <code>setIndex(1)</code>。这告诉 React 现在记住 <code>index</code> 是 <code>1</code> 并触发下一次渲染。</li>
<li><strong>组件进行第二次渲染</strong>。React 仍然看到 <code>useState(0)</code>，但是因为 React <em>记住</em> 了你将 <code>index</code> 设置为了 <code>1</code>，它将返回 <code>[1, setIndex]</code>。</li>
<li>以此类推！</li>
</ol>
<h3 id="3-2-5-赋予一个组件多个-state-变量"><a href="#3-2-5-赋予一个组件多个-state-变量" class="headerlink" title="3.2.5 赋予一个组件多个 state 变量"></a>3.2.5 赋予一个组件多个 state 变量</h3><p>你可以在一个组件中拥有任意多种类型的 state 变量。该组件有两个 state 变量，一个数字 <code>index</code> 和一个布尔值 <code>showMore</code>，点击 “Show Details” 会改变 <code>showMore</code> 的值：</p>
<p><code>data.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> sculptureList = [&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Homenaje a la Neurocirugía&#x27;</span>,</span><br><span class="line">  <span class="attr">artist</span>: <span class="string">&#x27;Marta Colvin Andrade&#x27;</span>,</span><br><span class="line">  <span class="attr">description</span>: <span class="string">&#x27;Although Colvin is predominantly known for abstract themes that allude to pre-Hispanic symbols, this gigantic sculpture, an homage to neurosurgery, is one of her most recognizable public art pieces.&#x27;</span>,</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;https://i.imgur.com/Mx7dA2Y.jpg&#x27;</span>,</span><br><span class="line">  <span class="attr">alt</span>: <span class="string">&#x27;A bronze statue of two crossed hands delicately holding a human brain in their fingertips.&#x27;</span>  </span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Floralis Genérica&#x27;</span>,</span><br><span class="line">  <span class="attr">artist</span>: <span class="string">&#x27;Eduardo Catalano&#x27;</span>,</span><br><span class="line">  <span class="attr">description</span>: <span class="string">&#x27;This enormous (75 ft. or 23m) silver flower is located in Buenos Aires. It is designed to move, closing its petals in the evening or when strong winds blow and opening them in the morning.&#x27;</span>,</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;https://i.imgur.com/ZF6s192m.jpg&#x27;</span>,</span><br><span class="line">  <span class="attr">alt</span>: <span class="string">&#x27;A gigantic metallic flower sculpture with reflective mirror-like petals and strong stamens.&#x27;</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<p><code>App.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; sculptureList &#125; <span class="keyword">from</span> <span class="string">&#x27;./data.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Gallery</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [index, setIndex] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [showMore, setShowMore] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleNextClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">setIndex</span>(index + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleMoreClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">setShowMore</span>(!showMore);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> sculpture = sculptureList[index];</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleNextClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Next</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">i</span>&gt;</span>&#123;sculpture.name&#125; <span class="tag">&lt;/<span class="name">i</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml">        by &#123;sculpture.artist&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>  </span></span><br><span class="line"><span class="language-xml">        (&#123;index + 1&#125; of &#123;sculptureList.length&#125;)</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleMoreClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;showMore ? &#x27;Hide&#x27; : &#x27;Show&#x27;&#125; details</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;showMore &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;sculpture.description&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">img</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">src</span>=<span class="string">&#123;sculpture.url&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">alt</span>=<span class="string">&#123;sculpture.alt&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果它们不相关，那么存在多个 state 变量是一个好主意，例如本例中的 <code>index</code> 和 <code>showMore</code>。但是，如果你发现经常同时更改两个 state 变量，那么最好将它们合并为一个。例如，如果你有一个包含多个字段的表单，那么有一个值为对象的 state 变量比每个字段对应一个 state 变量更方便。 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/choosing-the-state-structure">选择 state 结构</a>在这方面有更多提示。</p>
<blockquote>
<h4 id="React-如何知道返回哪个-state"><a href="#React-如何知道返回哪个-state" class="headerlink" title="React 如何知道返回哪个 state"></a>React 如何知道返回哪个 state</h4><p>你可能已经注意到，<code>useState</code> 在调用时没有任何关于它引用的是<em>哪个</em> state 变量的信息。没有传递给 <code>useState</code> 的“标识符”，它是如何知道要返回哪个 state 变量呢？它是否依赖于解析函数之类的魔法？答案是否定的。</p>
<p>相反，为了使语法更简洁，<strong>在同一组件的每次渲染中，Hooks 都依托于一个稳定的调用顺序</strong>。这在实践中很有效，因为如果你遵循上面的规则（“只在顶层调用 Hooks”），Hooks 将始终以相同的顺序被调用。此外，<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/eslint-plugin-react-hooks">linter 插件</a>也可以捕获大多数错误。</p>
<p>在 React 内部，为每个组件保存了一个数组，其中每一项都是一个 state 对。它维护当前 state 对的索引值，在渲染之前将其设置为 “0”。每次调用 useState 时，React 都会为你提供一个 state 对并增加索引值。你可以在文章 <a target="_blank" rel="noopener" href="https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e">React Hooks: not magic, just arrays</a>中阅读有关此机制的更多信息。</p>
<p>这个例子<strong>没有使用 React</strong>，但它让你了解 <code>useState</code> 在内部是如何工作的：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;nextButton&quot;</span>&gt;</span></span><br><span class="line">  Next</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">id</span>=<span class="string">&quot;header&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;moreButton&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;description&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;image&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">* &#123; <span class="attribute">box-sizing</span>: border-box; &#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-tag">body</span> &#123; <span class="attribute">font-family</span>: sans-serif; <span class="attribute">margin</span>: <span class="number">20px</span>; <span class="attribute">padding</span>: <span class="number">0</span>; &#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-tag">button</span> &#123; <span class="attribute">display</span>: block; <span class="attribute">margin-bottom</span>: <span class="number">10px</span>; &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> componentHooks = [];</span><br><span class="line"><span class="keyword">let</span> currentHookIndex = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// useState 在 React 中是如何工作的（简化版）</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useState</span>(<span class="params">initialState</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> pair = componentHooks[currentHookIndex];</span><br><span class="line">  <span class="keyword">if</span> (pair) &#123;</span><br><span class="line">    <span class="comment">// 这不是第一次渲染</span></span><br><span class="line">    <span class="comment">// 所以 state pair 已经存在</span></span><br><span class="line">    <span class="comment">// 将其返回并为下一次 hook 的调用做准备</span></span><br><span class="line">    currentHookIndex++;</span><br><span class="line">    <span class="keyword">return</span> pair;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这是我们第一次进行渲染</span></span><br><span class="line">  <span class="comment">// 所以新建一个 state pair 然后存储它</span></span><br><span class="line">  pair = [initialState, setState];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">setState</span>(<span class="params">nextState</span>) &#123;</span><br><span class="line">    <span class="comment">// 当用户发起 state 的变更，</span></span><br><span class="line">    <span class="comment">// 把新的值放入 pair 中</span></span><br><span class="line">    pair[<span class="number">0</span>] = nextState;</span><br><span class="line">    <span class="title function_">updateDOM</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 存储这个 pair 用于将来的渲染</span></span><br><span class="line">  <span class="comment">// 并且为下一次 hook 的调用做准备</span></span><br><span class="line">  componentHooks[currentHookIndex] = pair;</span><br><span class="line">  currentHookIndex++;</span><br><span class="line">  <span class="keyword">return</span> pair;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Gallery</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 每次调用 useState() 都会得到新的 pair</span></span><br><span class="line">  <span class="keyword">const</span> [index, setIndex] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [showMore, setShowMore] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleNextClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">setIndex</span>(index + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleMoreClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">setShowMore</span>(!showMore);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> sculpture = sculptureList[index];</span><br><span class="line">  <span class="comment">// 这个例子没有使用 React，所以</span></span><br><span class="line">  <span class="comment">// 返回一个对象而不是 JSX</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">onNextClick</span>: handleNextClick,</span><br><span class="line">    <span class="attr">onMoreClick</span>: handleMoreClick,</span><br><span class="line">    <span class="attr">header</span>: <span class="string">`<span class="subst">$&#123;sculpture.name&#125;</span> by <span class="subst">$&#123;sculpture.artist&#125;</span>`</span>,</span><br><span class="line">    <span class="attr">counter</span>: <span class="string">`<span class="subst">$&#123;index + <span class="number">1</span>&#125;</span> of <span class="subst">$&#123;sculptureList.length&#125;</span>`</span>,</span><br><span class="line">    <span class="attr">more</span>: <span class="string">`<span class="subst">$&#123;showMore ? <span class="string">&#x27;Hide&#x27;</span> : <span class="string">&#x27;Show&#x27;</span>&#125;</span> details`</span>,</span><br><span class="line">    <span class="attr">description</span>: showMore ? sculpture.<span class="property">description</span> : <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">imageSrc</span>: sculpture.<span class="property">url</span>,</span><br><span class="line">    <span class="attr">imageAlt</span>: sculpture.<span class="property">alt</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateDOM</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 在渲染组件之前</span></span><br><span class="line">  <span class="comment">// 重置当前 Hook 的下标</span></span><br><span class="line">  currentHookIndex = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> output = <span class="title class_">Gallery</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 更新 DOM 以匹配输出结果</span></span><br><span class="line">  <span class="comment">// 这部分工作由 React 为你完成</span></span><br><span class="line">  nextButton.<span class="property">onclick</span> = output.<span class="property">onNextClick</span>;</span><br><span class="line">  header.<span class="property">textContent</span> = output.<span class="property">header</span>;</span><br><span class="line">  moreButton.<span class="property">onclick</span> = output.<span class="property">onMoreClick</span>;</span><br><span class="line">  moreButton.<span class="property">textContent</span> = output.<span class="property">more</span>;</span><br><span class="line">  image.<span class="property">src</span> = output.<span class="property">imageSrc</span>;</span><br><span class="line">  image.<span class="property">alt</span> = output.<span class="property">imageAlt</span>;</span><br><span class="line">  <span class="keyword">if</span> (output.<span class="property">description</span> !== <span class="literal">null</span>) &#123;</span><br><span class="line">    description.<span class="property">textContent</span> = output.<span class="property">description</span>;</span><br><span class="line">    description.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    description.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> nextButton = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;nextButton&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> header = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;header&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> moreButton = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;moreButton&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> description = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;description&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> image = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;image&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> sculptureList = [&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Homenaje a la Neurocirugía&#x27;</span>,</span><br><span class="line">  <span class="attr">artist</span>: <span class="string">&#x27;Marta Colvin Andrade&#x27;</span>,</span><br><span class="line">  <span class="attr">description</span>: <span class="string">&#x27;Although Colvin is predominantly known for abstract themes that allude to pre-Hispanic symbols, this gigantic sculpture, an homage to neurosurgery, is one of her most recognizable public art pieces.&#x27;</span>,</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;https://i.imgur.com/Mx7dA2Y.jpg&#x27;</span>,</span><br><span class="line">  <span class="attr">alt</span>: <span class="string">&#x27;A bronze statue of two crossed hands delicately holding a human brain in their fingertips.&#x27;</span>  </span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Floralis Genérica&#x27;</span>,</span><br><span class="line">  <span class="attr">artist</span>: <span class="string">&#x27;Eduardo Catalano&#x27;</span>,</span><br><span class="line">  <span class="attr">description</span>: <span class="string">&#x27;This enormous (75 ft. or 23m) silver flower is located in Buenos Aires. It is designed to move, closing its petals in the evening or when strong winds blow and opening them in the morning.&#x27;</span>,</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;https://i.imgur.com/ZF6s192m.jpg&#x27;</span>,</span><br><span class="line">  <span class="attr">alt</span>: <span class="string">&#x27;A gigantic metallic flower sculpture with reflective mirror-like petals and strong stamens.&#x27;</span></span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使 UI 匹配当前 state</span></span><br><span class="line"><span class="title function_">updateDOM</span>();</span><br></pre></td></tr></table></figure>

<p>你不必理解它就可以使用 React，但你可能会发现这是一个有用的心智模型。</p>
</blockquote>
<h3 id="3-2-6-State-是隔离且私有的"><a href="#3-2-6-State-是隔离且私有的" class="headerlink" title="3.2.6 State 是隔离且私有的"></a>3.2.6 State 是隔离且私有的</h3><p><code>App.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Gallery</span> <span class="keyword">from</span> <span class="string">&#x27;./Gallery.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;Page&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Gallery</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Gallery</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Gallery.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; sculptureList &#125; <span class="keyword">from</span> <span class="string">&#x27;./data.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Gallery</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [index, setIndex] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [showMore, setShowMore] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleNextClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">setIndex</span>(index + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleMoreClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">setShowMore</span>(!showMore);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> sculpture = sculptureList[index];</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleNextClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Next</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">i</span>&gt;</span>&#123;sculpture.name&#125; <span class="tag">&lt;/<span class="name">i</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml">        by &#123;sculpture.artist&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>  </span></span><br><span class="line"><span class="language-xml">        (&#123;index + 1&#125; of &#123;sculptureList.length&#125;)</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleMoreClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;showMore ? &#x27;Hide&#x27; : &#x27;Show&#x27;&#125; details</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;showMore &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;sculpture.description&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">img</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">src</span>=<span class="string">&#123;sculpture.url&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">alt</span>=<span class="string">&#123;sculpture.alt&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>data.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> sculptureList = [&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Homenaje a la Neurocirugía&#x27;</span>,</span><br><span class="line">  <span class="attr">artist</span>: <span class="string">&#x27;Marta Colvin Andrade&#x27;</span>,</span><br><span class="line">  <span class="attr">description</span>: <span class="string">&#x27;Although Colvin is predominantly known for abstract themes that allude to pre-Hispanic symbols, this gigantic sculpture, an homage to neurosurgery, is one of her most recognizable public art pieces.&#x27;</span>,</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;https://i.imgur.com/Mx7dA2Y.jpg&#x27;</span>,</span><br><span class="line">  <span class="attr">alt</span>: <span class="string">&#x27;A bronze statue of two crossed hands delicately holding a human brain in their fingertips.&#x27;</span>  </span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Floralis Genérica&#x27;</span>,</span><br><span class="line">  <span class="attr">artist</span>: <span class="string">&#x27;Eduardo Catalano&#x27;</span>,</span><br><span class="line">  <span class="attr">description</span>: <span class="string">&#x27;This enormous (75 ft. or 23m) silver flower is located in Buenos Aires. It is designed to move, closing its petals in the evening or when strong winds blow and opening them in the morning.&#x27;</span>,</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;https://i.imgur.com/ZF6s192m.jpg&#x27;</span>,</span><br><span class="line">  <span class="attr">alt</span>: <span class="string">&#x27;A gigantic metallic flower sculpture with reflective mirror-like petals and strong stamens.&#x27;</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<p>这就是 state 与声明在模块顶部的普通变量不同的原因。 State 不依赖于特定的函数调用或在代码中的位置，它的作用域“只限于”屏幕上的某块特定区域。你渲染了两个 <code>&lt;Gallery /&gt;</code> 组件，所以它们的 state 是分别存储的。</p>
<p>还要注意 <code>Page</code> 组件“不知道”关于 <code>Gallery</code> state 的任何信息，甚至不知道它是否有任何 state。与 props 不同，<strong>state 完全私有于声明它的组件</strong>。父组件无法更改它。这使你可以向任何组件添加或删除 state，而不会影响其他组件。</p>
<p>如果你希望两个画廊保持其 states 同步怎么办？在 React 中执行此操作的正确方法是从子组件中<em>删除</em> state 并将其添加到离它们最近的共享父组件中。接下来的几节将专注于组织单个组件的 state，但我们将在<a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/sharing-state-between-components">组件间共享 state</a> 中回到这个主题。</p>
<h3 id="3-2-7-摘要"><a href="#3-2-7-摘要" class="headerlink" title="3.2.7 摘要"></a>3.2.7 摘要</h3><ul>
<li>当一个组件需要在多次渲染间“记住”某些信息时使用 state 变量。</li>
<li>State 变量是通过调用 <code>useState</code> Hook 来声明的。</li>
<li>Hook 是以 <code>use</code> 开头的特殊函数。它们能让你 “hook” 到像 state 这样的 React 特性中。</li>
<li>Hook 可能会让你想起 import：它们需要在非条件语句中调用。调用 Hook 时，包括 <code>useState</code>，仅在组件或另一个 Hook 的顶层被调用才有效。</li>
<li><code>useState</code> Hook 返回一对值：当前 state 和更新它的函数。</li>
<li>你可以拥有多个 state 变量。在内部，React 按顺序匹配它们。</li>
<li>State 是组件私有的。如果你在两个地方渲染它，则每个副本都有独属于自己的 state。</li>
</ul>
<h2 id="3-3-渲染和提交"><a href="#3-3-渲染和提交" class="headerlink" title="3.3 渲染和提交"></a>3.3 渲染和提交</h2><p>组件显示到屏幕之前，其必须被 React 渲染。理解这些处理步骤将帮助你思考代码的执行过程并能解释其行为。</p>
<p>想象一下，你的组件是厨房里的厨师，把食材烹制成美味的菜肴。在这种场景下，React 就是一名服务员，他会帮客户们下单并为他们送来所点的菜品。这种请求和提供 UI 的过程总共包括三个步骤：</p>
<ol>
<li><strong>触发</strong> 一次渲染（把客人的点单分发到厨房）</li>
<li><strong>渲染</strong> 组件（在厨房准备订单）</li>
<li><strong>提交</strong> 到 DOM（将菜品放在桌子上）</li>
</ol>
<h3 id="3-3-1-步骤-1-触发一次渲染"><a href="#3-3-1-步骤-1-触发一次渲染" class="headerlink" title="3.3.1 步骤 1: 触发一次渲染"></a>3.3.1 步骤 1: 触发一次渲染</h3><p>有两种原因会导致组件的渲染:</p>
<ol>
<li>组件的 <strong>初次渲染。</strong></li>
<li>组件（或者其祖先之一）的 <strong>状态发生了改变。</strong></li>
</ol>
<p><strong>初次渲染</strong></p>
<p>当应用启动时，会触发初次渲染。框架和沙箱有时会隐藏这部分代码，但它是通过调用 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/reference/react-dom/client/createRoot"><code>createRoot</code></a> 方法并传入目标 DOM 节点，然后用你的组件调用 <code>render</code> 函数完成的：</p>
<p><code>index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Image</span> <span class="keyword">from</span> <span class="string">&#x27;./Image.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createRoot &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = <span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>))</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Image</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure>

<p><code>image.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Image</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">img</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/ZF6s192.jpg&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">alt</span>=<span class="string">&quot;&#x27;Floralis Genérica&#x27; by Eduardo Catalano: a gigantic metallic flower sculpture with reflective petals&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>试着注释掉 <code>root.render()</code>，然后你将会看到组件消失。</p>
<p><strong>状态更新时重新渲染</strong></p>
<p>一旦组件被初次渲染，你就可以通过使用 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/reference/react/useState#setstate"><code>set</code> 函数</a> 更新其状态来触发之后的渲染。更新组件的状态会自动将一次渲染送入队列。（你可以把这种情况想象成餐厅客人在第一次下单之后又点了茶、点心和各种东西，具体取决于他们的胃口。）</p>
<h3 id="3-3-2-步骤-2-React-渲染你的组件"><a href="#3-3-2-步骤-2-React-渲染你的组件" class="headerlink" title="3.3.2 步骤 2: React 渲染你的组件"></a>3.3.2 步骤 2: React 渲染你的组件</h3><p>在你触发渲染后，React 会调用你的组件来确定要在屏幕上显示的内容。<strong>“渲染中” 即 React 在调用你的组件。</strong></p>
<ul>
<li><strong>在进行初次渲染时,</strong> React 会调用根组件。</li>
<li><strong>对于后续的渲染,</strong> React 会调用内部状态更新触发了渲染的函数组件。</li>
</ul>
<p>这个过程是递归的：如果更新后的组件会返回某个另外的组件，那么 React 接下来就会渲染 <em>那个</em> 组件，而如果那个组件又返回了某个组件，那么 React 接下来就会渲染 <em>那个</em> 组件，以此类推。这个过程会持续下去，直到没有更多的嵌套组件并且 React 确切知道哪些东西应该显示到屏幕上为止。</p>
<p>在接下来的例子中，React 将会调用 <code>Gallery()</code> 和 <code>Image()</code> 若干次：</p>
<p><code>index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Gallery</span> <span class="keyword">from</span> <span class="string">&#x27;./Gallery.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createRoot &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = <span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>))</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Gallery</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure>

<p><code>Gallery.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Gallery</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>鼓舞人心的雕塑<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Image</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Image</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Image</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Image</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">img</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">src</span>=<span class="string">&quot;https://i.imgur.com/ZF6s192.jpg&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">alt</span>=<span class="string">&quot;&#x27;Floralis Genérica&#x27; by Eduardo Catalano: a gigantic metallic flower sculpture with reflective petals&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>在初次渲染中，</strong> React 将会为<code>&lt;section&gt;</code>、<code>&lt;h1&gt;</code> 和三个 <code>&lt;img&gt;</code> 标签 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/Document/createElement">创建 DOM 节点</a>。</li>
<li><strong>在一次重渲染过程中,</strong> React 将计算它们的哪些属性（如果有的话）自上次渲染以来已更改。在下一步（提交阶段）之前，它不会对这些信息执行任何操作。</li>
</ul>
<blockquote>
<p>渲染必须始终是一次 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/keeping-components-pure">纯计算</a>:</p>
<ul>
<li><strong>输入相同，输出相同。</strong> 给定相同的输入，组件应始终返回相同的 JSX。（当有人点了西红柿沙拉时，他们不应该收到洋葱沙拉！）</li>
<li><strong>只做它自己的事情。</strong> 它不应更改任何存在于渲染之前的对象或变量。（一个订单不应更改其他任何人的订单。）</li>
</ul>
<p>否则，随着代码库复杂性的增加，你可能会遇到令人困惑的错误和不可预测的行为。在 “严格模式” 下开发时，React 会调用每个组件的函数两次，这可以帮助发现由不纯函数引起的错误。</p>
</blockquote>
<blockquote>
<h4 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h4><p>如果更新的组件在树中的位置非常高，渲染更新后的组件内部所有嵌套组件的默认行为将不会获得最佳性能。如果你遇到了性能问题，<a target="_blank" rel="noopener" href="https://reactjs.org/docs/optimizing-performance.html">性能</a> 章节描述了几种可选的解决方案 。<strong>不要过早进行优化！</strong></p>
</blockquote>
<h3 id="3-3-3-步骤-3-React-把更改提交到-DOM-上"><a href="#3-3-3-步骤-3-React-把更改提交到-DOM-上" class="headerlink" title="3.3.3 步骤 3: React 把更改提交到 DOM 上"></a>3.3.3 步骤 3: React 把更改提交到 DOM 上</h3><p>在渲染（调用）你的组件之后，React 将会修改 DOM。</p>
<ul>
<li><strong>对于初次渲染，</strong> React 会使用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/Node/appendChild"><code>appendChild()</code></a> DOM API 将其创建的所有 DOM 节点放在屏幕上。</li>
<li><strong>对于重渲染，</strong> React 将应用最少的必要操作（在渲染时计算！），以使得 DOM 与最新的渲染输出相互匹配。</li>
</ul>
<p><strong>React 仅在渲染之间存在差异时才会更改 DOM 节点。</strong> 例如，有一个组件，它每秒使用从父组件传递下来的不同属性重新渲染一次。注意，你可以添加一些文本到 <code>&lt;input&gt;</code> 标签，更新它的 <code>value</code>，但是文本不会在组件重渲染时消失：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Clock</span>(<span class="params">&#123; time &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;time&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个例子之所以会正常运行，是因为在最后一步中，React 只会使用最新的 <code>time</code> 更新 <code>&lt;h1&gt;</code> 标签的内容。它看到 <code>&lt;input&gt;</code> 标签出现在 JSX 中与上次相同的位置，因此 React 不会修改 <code>&lt;input&gt;</code> 标签或它的 <code>value</code>！</p>
<h3 id="3-3-4-尾声：浏览器绘制"><a href="#3-3-4-尾声：浏览器绘制" class="headerlink" title="3.3.4 尾声：浏览器绘制"></a>3.3.4 尾声：浏览器绘制</h3><p>在渲染完成并且 React 更新 DOM 之后，浏览器就会重新绘制屏幕。尽管这个过程被称为“浏览器渲染”（“browser rendering”），但我们还是将它称为“绘制”（“painting”），以避免在这些文档的其余部分中出现混淆。</p>
<h3 id="3-3-5-摘要"><a href="#3-3-5-摘要" class="headerlink" title="3.3.5 摘要"></a>3.3.5 摘要</h3><ul>
<li>在一个 React 应用中一次屏幕更新都会发生以下三个步骤：<ol>
<li>触发</li>
<li>渲染</li>
<li>提交</li>
</ol>
</li>
<li>你可以使用严格模式去找到组件中的错误</li>
<li>如果渲染结果与上次一样，那么 React 将不会修改 DOM</li>
</ul>
<h2 id="3-4-state-如同一张快照"><a href="#3-4-state-如同一张快照" class="headerlink" title="3.4 state 如同一张快照"></a>3.4 state 如同一张快照</h2><p>也许 state 变量看起来和一般的可读写的 JavaScript 变量类似。但 state 在其表现出的特性上更像是一张快照。设置它不会更改你已有的 state 变量，但会触发重新渲染。</p>
<h3 id="3-4-1-设置-state-会触发渲染"><a href="#3-4-1-设置-state-会触发渲染" class="headerlink" title="3.4.1 设置 state 会触发渲染"></a>3.4.1 设置 state 会触发渲染</h3><p>你可能会认为你的用户界面会直接对点击之类的用户输入做出响应并发生变化。在 React 中，它的工作方式与这种思维模型略有不同。在上一页中，你看到了来自 React 的<a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/render-and-commit#step-1-trigger-a-render">重新渲染和提交</a>。这意味着要使界面对输入做出反应，你需要设置其 state。</p>
<p>在这个例子中，当你按下 “send” 时，<code>setIsSent(true)</code> 会通知 React 重新渲染 UI：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Form</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [isSent, setIsSent] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> [message, setMessage] = <span class="title function_">useState</span>(<span class="string">&#x27;Hi!&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (isSent) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Your message is on its way!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">onSubmit</span>=<span class="string">&#123;(e)</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">      e.preventDefault();</span></span><br><span class="line"><span class="language-xml">      setIsSent(true);</span></span><br><span class="line"><span class="language-xml">      sendMessage(message);</span></span><br><span class="line"><span class="language-xml">    &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">textarea</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">placeholder</span>=<span class="string">&quot;Message&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&#123;message&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> setMessage(e.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">      /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>Send<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sendMessage</span>(<span class="params">message</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当你单击按钮时会发生以下情况：</p>
<ol>
<li>执行 <code>onSubmit</code> 事件处理函数。</li>
<li><code>setIsSent(true)</code> 将 <code>isSent</code> 设置为 <code>true</code> 并排列一个新的渲染。</li>
<li>React 根据新的 <code>isSent</code> 值重新渲染组件。</li>
</ol>
<p>让我们仔细看看 state 和渲染之间的关系。</p>
<h3 id="3-4-2-渲染会及时生成一张快照"><a href="#3-4-2-渲染会及时生成一张快照" class="headerlink" title="3.4.2 渲染会及时生成一张快照"></a>3.4.2 渲染会及时生成一张快照</h3><p><a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/render-and-commit#step-2-react-renders-your-components">“正在渲染”</a> 就意味着 React 正在调用你的组件——一个函数。你从该函数返回的 JSX 就像是在某个时间点上 UI 的快照。它的 props、事件处理函数和内部变量都是 <strong>根据当前渲染时的 state</strong> 被计算出来的。</p>
<p>与照片或电影画面不同，你返回的 UI “快照”是可交互的。它其中包括类似事件处理函数的逻辑，这些逻辑用于指定如何对输入作出响应。React 随后会更新屏幕来匹配这张快照，并绑定事件处理函数。因此，按下按钮就会触发你 JSX 中的点击事件处理函数。</p>
<p>当 React 重新渲染一个组件时：</p>
<ol>
<li>React 会再次调用你的函数</li>
<li>函数会返回新的 JSX 快照</li>
<li>React 会更新界面以匹配返回的快照</li>
</ol>
<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/mysql20240930092131.png"></p>
<p>作为一个组件的记忆，state 不同于在你的函数返回之后就会消失的普通变量。state 实际上“活”在 React 本身中——就像被摆在一个架子上！——位于你的函数之外。当 React 调用你的组件时，它会为特定的那一次渲染提供一张 state 快照。你的组件会在其 JSX 中返回一张包含一整套新的 props 和事件处理函数的 UI 快照 ，其中所有的值都是 <strong>根据那一次渲染中 state 的值</strong> 被计算出来的！</p>
<p><img src="https://raw.githubusercontent.com/lianyutian/tuchuang1/main/img/mysql20240930092229.png"></p>
<p>这里有个向你展示其运行原理的小例子。在这个例子中，你可能会以为点击“+3”按钮会调用 <code>setNumber(number + 1)</code> 三次从而使计数器递增三次。</p>
<p>看看你点击“+3”按钮时会发生什么?</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [number, setNumber] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;number&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        setNumber(number + 1);</span></span><br><span class="line"><span class="language-xml">        setNumber(number + 1);</span></span><br><span class="line"><span class="language-xml">        setNumber(number + 1);</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;&gt;+3<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 每次点击只会+1</span></span><br></pre></td></tr></table></figure>

<p>请注意，每次点击只会让 <code>number</code> 递增一次！</p>
<p><strong>设置 state 只会为下一次渲染变更 state 的值</strong>。在第一次渲染期间，<code>number</code> 为 <code>0</code>。这也就解释了为什么在 <strong>那次渲染中的</strong> <code>onClick</code> 处理函数中，即便在调用了 <code>setNumber(number + 1)</code> 之后，<code>number</code> 的值也仍然是 <code>0</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">setNumber</span>(number + <span class="number">1</span>);</span><br><span class="line">  <span class="title function_">setNumber</span>(number + <span class="number">1</span>);</span><br><span class="line">  <span class="title function_">setNumber</span>(number + <span class="number">1</span>);</span><br><span class="line">&#125;&#125;&gt;+<span class="number">3</span>&lt;/button&gt;</span><br></pre></td></tr></table></figure>

<p>以下是这个按钮的点击事件处理函数通知 React 要做的事情：</p>
<ol>
<li><code>setNumber(number + 1)</code>：<code>number</code> 是 <code>0</code> 所以 <code>setNumber(0 + 1)</code>。<ul>
<li>React 准备在下一次渲染时将 <code>number</code> 更改为 <code>1</code>。</li>
</ul>
</li>
<li><code>setNumber(number + 1)</code>：<code>number</code> 是<code>0</code> 所以 <code>setNumber(0 + 1)</code>。<ul>
<li>React 准备在下一次渲染时将 <code>number</code> 更改为 <code>1</code>。</li>
</ul>
</li>
<li><code>setNumber(number + 1)</code>：<code>number</code> 是<code>0</code> 所以 <code>setNumber(0 + 1)</code>。<ul>
<li>React 准备在下一次渲染时将 <code>number</code> 更改为 <code>1</code>。</li>
</ul>
</li>
</ol>
<p>尽管你调用了三次 <code>setNumber(number + 1)</code>，但在 <strong>这次渲染的</strong> 事件处理函数中 <code>number</code> 会一直是 <code>0</code>，所以你会三次将 state 设置成 <code>1</code>。这就是为什么在你的事件处理函数执行完以后，React 重新渲染的组件中的 <code>number</code> 等于 <code>1</code> 而不是 <code>3</code>。</p>
<p>你还可以通过在心里把 state 变量替换成它们在你代码中的值来想象这个过程。由于 <strong>这次渲染</strong> 中的 state 变量 <code>number</code> 是 <code>0</code>，其事件处理函数看起来会像这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">setNumber</span>(<span class="number">0</span> + <span class="number">1</span>);</span><br><span class="line">  <span class="title function_">setNumber</span>(<span class="number">0</span> + <span class="number">1</span>);</span><br><span class="line">  <span class="title function_">setNumber</span>(<span class="number">0</span> + <span class="number">1</span>);</span><br><span class="line">&#125;&#125;&gt;+<span class="number">3</span>&lt;/button&gt;</span><br></pre></td></tr></table></figure>

<p>对于下一次渲染来说，<code>number</code> 是 <code>1</code>，因此 <strong>那次渲染中的</strong> 点击事件处理函数看起来会像这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">setNumber</span>(<span class="number">1</span> + <span class="number">1</span>);</span><br><span class="line">  <span class="title function_">setNumber</span>(<span class="number">1</span> + <span class="number">1</span>);</span><br><span class="line">  <span class="title function_">setNumber</span>(<span class="number">1</span> + <span class="number">1</span>);</span><br><span class="line">&#125;&#125;&gt;+<span class="number">3</span>&lt;/button&gt;</span><br></pre></td></tr></table></figure>

<p>这就是为什么再次点击按钮会将计数器设置为 <code>2</code>，下次点击时会设为 <code>3</code>，依此类推。</p>
<h3 id="3-4-4-随时间变化的-state"><a href="#3-4-4-随时间变化的-state" class="headerlink" title="3.4.4 随时间变化的 state"></a>3.4.4 随时间变化的 state</h3><p>好的，刚才那些很有意思。试着猜猜点击这个按钮会发出什么警告：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [number, setNumber] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;number&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        setNumber(number + 5);</span></span><br><span class="line"><span class="language-xml">        alert(number);</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;&gt;+5<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// alert显示0, number渲染为5</span></span><br></pre></td></tr></table></figure>

<p>如果你使用之前替换的方法，你就能猜到这个提示框将会显示 “0”：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setNumber</span>(<span class="number">0</span> + <span class="number">5</span>);</span><br><span class="line"><span class="title function_">alert</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>但如果你在这个提示框上加上一个定时器， 使得它在组件重新渲染 <strong>之后</strong> 才触发，又会怎样呢？是会显示 “0” 还是 “5” ？猜一猜！</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [number, setNumber] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;number&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        setNumber(number + 5);</span></span><br><span class="line"><span class="language-xml">        setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">          alert(number);</span></span><br><span class="line"><span class="language-xml">        &#125;, 3000);</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;&gt;+5<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>到提示框运行时，React 中存储的 state 可能已经发生了更改，但它是使用用户与之交互时状态的快照进行调度的！</p>
<p><strong>一个 state 变量的值永远不会在一次渲染的内部发生变化，</strong> 即使其事件处理函数的代码是异步的。在 <strong>那次渲染的</strong> <code>onClick</code> 内部，<code>number</code> 的值即使在调用 <code>setNumber(number + 5)</code> 之后也还是 <code>0</code>。它的值在 React 通过调用你的组件“获取 UI 的快照”时就被“固定”了。</p>
<p>这里有个示例能够说明上述特性会使你的事件处理函数更不容易出现计时错误。下面是一个会在五秒延迟之后发送一条消息的表单。想象以下场景：</p>
<ol>
<li>你按下“发送”按钮，向 Alice 发送“你好”。</li>
<li>在五秒延迟结束之前，将“To”字段的值更改为“Bob”。</li>
</ol>
<p>你觉得 <code>alert</code> 会显示什么？它是会显示“你向 Alice 说了你好“还是会显示“你向 Bob 说了你好”？根据你已经学到的知识猜一猜，然后动手试一试：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Form</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [to, setTo] = <span class="title function_">useState</span>(<span class="string">&#x27;Alice&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> [message, setMessage] = <span class="title function_">useState</span>(<span class="string">&#x27;你好&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleSubmit</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    e.<span class="title function_">preventDefault</span>();</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">alert</span>(<span class="string">`你向 <span class="subst">$&#123;to&#125;</span> 说了<span class="subst">$&#123;message&#125;</span>`</span>);</span><br><span class="line">    &#125;, <span class="number">5000</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">onSubmit</span>=<span class="string">&#123;handleSubmit&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        To:&#123;&#x27; &#x27;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">select</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;to&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> setTo(e.target.value)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;Alice&quot;</span>&gt;</span>Alice<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;Bob&quot;</span>&gt;</span>Bob<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">textarea</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">placeholder</span>=<span class="string">&quot;Message&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&#123;message&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> setMessage(e.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">      /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>发送<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>React 会使 state 的值始终“固定”在一次渲染的各个事件处理函数内部</strong>。你无需担心代码运行时 state 是否发生了变化。</p>
<p>但是，万一你想在重新渲染之前读取最新的 state 怎么办？你应该使用 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/queueing-a-series-of-state-updates">状态更新函数</a>！</p>
<h3 id="3-4-5-摘要"><a href="#3-4-5-摘要" class="headerlink" title="3.4.5 摘要"></a>3.4.5 摘要</h3><ul>
<li>设置 state 请求一次新的渲染。</li>
<li>React 将 state 存储在组件之外，就像在架子上一样。</li>
<li>当你调用 <code>useState</code> 时，React 会为你提供<strong>该次渲染</strong> 的一张 state 快照。</li>
<li>变量和事件处理函数不会在重渲染中“存活”。每个渲染都有自己的事件处理函数。</li>
<li>每个渲染（以及其中的函数）始终“看到”的是 React 提供给<strong>这个</strong> 渲染的 state 快照。</li>
<li>你可以在心中替换事件处理函数中的 state，类似于替换渲染的 JSX。</li>
<li>过去创建的事件处理函数拥有的是创建它们的那次渲染中的 state 值。</li>
</ul>
<h2 id="3-5-把一系列-state-更新加入队列"><a href="#3-5-把一系列-state-更新加入队列" class="headerlink" title="3.5 把一系列 state 更新加入队列"></a>3.5 把一系列 state 更新加入队列</h2><p>设置组件 state 会把一次重新渲染加入队列。但有时你可能会希望在下次渲染加入队列之前对 state 的值执行多次操作。为此，了解 React 如何批量更新 state 会很有帮助。</p>
<h3 id="3-5-1-React-会对-state-更新进行批处理"><a href="#3-5-1-React-会对-state-更新进行批处理" class="headerlink" title="3.5.1 React 会对 state 更新进行批处理"></a>3.5.1 React 会对 state 更新进行批处理</h3><p>在下面的示例中，你可能会认为点击 “+3” 按钮会使计数器递增三次，因为它调用了 <code>setNumber(number + 1)</code> 三次：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [number, setNumber] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;number&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        setNumber(number + 1);</span></span><br><span class="line"><span class="language-xml">        setNumber(number + 1);</span></span><br><span class="line"><span class="language-xml">        setNumber(number + 1);</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;&gt;+3<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是，你可能还记得上一节中的内容，<a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/state-as-a-snapshot#rendering-takes-a-snapshot-in-time">每一次渲染的 state 值都是固定的</a>，因此无论你调用多少次 <code>setNumber(1)</code>，在第一次渲染的事件处理函数内部的 <code>number</code> 值总是 <code>0</code> ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setNumber</span>(<span class="number">0</span> + <span class="number">1</span>);</span><br><span class="line"><span class="title function_">setNumber</span>(<span class="number">0</span> + <span class="number">1</span>);</span><br><span class="line"><span class="title function_">setNumber</span>(<span class="number">0</span> + <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>但是这里还有另外一个影响因素需要讨论。<strong>React 会等到事件处理函数中的</strong> 所有 <strong>代码都运行完毕再处理你的 state 更新。</strong> 这就是重新渲染只会发生在所有这些 <code>setNumber()</code> 调用 <strong>之后</strong> 的原因。</p>
<p>这可能会让你想起餐厅里帮你点菜的服务员。服务员不会在你说第一道菜的时候就跑到厨房！相反，他们会让你把菜点完，让你修改菜品，甚至会帮桌上的其他人点菜。</p>
<p>这让你可以更新多个 state 变量——甚至来自多个组件的 state 变量——而不会触发太多的 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/render-and-commit#re-renders-when-state-updates">重新渲染</a>。但这也意味着只有在你的事件处理函数及其中任何代码执行完成 <strong>之后</strong>，UI 才会更新。这种特性也就是 <strong>批处理</strong>，它会使你的 React 应用运行得更快。它还会帮你避免处理只更新了一部分 state 变量的令人困惑的“半成品”渲染。</p>
<p><strong>React 不会跨 <em>多个</em> 需要刻意触发的事件（如点击）进行批处理</strong>——每次点击都是单独处理的。请放心，React 只会在一般来说安全的情况下才进行批处理。这可以确保，例如，如果第一次点击按钮会禁用表单，那么第二次点击就不会再次提交它。</p>
<h3 id="3-5-2-在下次渲染前多次更新同一个-state"><a href="#3-5-2-在下次渲染前多次更新同一个-state" class="headerlink" title="3.5.2 在下次渲染前多次更新同一个 state"></a>3.5.2 在下次渲染前多次更新同一个 state</h3><p>这是一个不常见的用例，但是如果你想在下次渲染之前多次更新同一个 state，你可以像 <code>setNumber(n =&gt; n + 1)</code> 这样传入一个根据队列中的前一个 state 计算下一个 state 的 <strong>函数</strong>，而不是像 <code>setNumber(number + 1)</code> 这样传入 <strong>下一个 state 值</strong>。这是一种告诉 React “用 state 值做某事”而不是仅仅替换它的方法。</p>
<p>现在尝试递增计数器：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [number, setNumber] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;number&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        setNumber(n =&gt; n + 1);</span></span><br><span class="line"><span class="language-xml">        setNumber(n =&gt; n + 1);</span></span><br><span class="line"><span class="language-xml">        setNumber(n =&gt; n + 1);</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;&gt;+3<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这里，<code>n =&gt; n + 1</code> 被称为 <strong>更新函数</strong>。当你将它传递给一个 state 设置函数时：</p>
<ol>
<li>React 会将此函数加入队列，以便在事件处理函数中的所有其他代码运行后进行处理。</li>
<li>在下一次渲染期间，React 会遍历队列并给你更新之后的最终 state。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setNumber</span>(<span class="function"><span class="params">n</span> =&gt;</span> n + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">setNumber</span>(<span class="function"><span class="params">n</span> =&gt;</span> n + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">setNumber</span>(<span class="function"><span class="params">n</span> =&gt;</span> n + <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>下面是 React 在执行事件处理函数时处理这几行代码的过程：</p>
<ol>
<li><code>setNumber(n =&gt; n + 1)</code>：<code>n =&gt; n + 1</code> 是一个函数。React 将它加入队列。</li>
<li><code>setNumber(n =&gt; n + 1)</code>：<code>n =&gt; n + 1</code> 是一个函数。React 将它加入队列。</li>
<li><code>setNumber(n =&gt; n + 1)</code>：<code>n =&gt; n + 1</code> 是一个函数。React 将它加入队列。</li>
</ol>
<p>当你在下次渲染期间调用 <code>useState</code> 时，React 会遍历队列。之前的 <code>number</code> state 的值是 <code>0</code>，所以这就是 React 作为参数 <code>n</code> 传递给第一个更新函数的值。然后 React 会获取你上一个更新函数的返回值，并将其作为 <code>n</code> 传递给下一个更新函数，以此类推：</p>
<table>
<thead>
<tr>
<th>更新队列</th>
<th><code>n</code></th>
<th>返回值</th>
</tr>
</thead>
<tbody><tr>
<td><code>n =&gt; n + 1</code></td>
<td><code>0</code></td>
<td><code>0 + 1 = 1</code></td>
</tr>
<tr>
<td><code>n =&gt; n + 1</code></td>
<td><code>1</code></td>
<td><code>1 + 1 = 2</code></td>
</tr>
<tr>
<td><code>n =&gt; n + 1</code></td>
<td><code>2</code></td>
<td><code>2 + 1 = 3</code></td>
</tr>
</tbody></table>
<p>React 会保存 <code>3</code> 为最终结果并从 <code>useState</code> 中返回。</p>
<p>这就是为什么在上面的示例中点击“+3”正确地将值增加“+3”。</p>
<h3 id="3-5-3-如果你在替换-state-后更新-state-会发生什么"><a href="#3-5-3-如果你在替换-state-后更新-state-会发生什么" class="headerlink" title="3.5.3 如果你在替换 state 后更新 state 会发生什么?"></a>3.5.3 如果你在替换 state 后更新 state 会发生什么?</h3><p>这个事件处理函数会怎么样？你认为 <code>number</code> 在下一次渲染中的值是什么？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">setNumber</span>(number + <span class="number">5</span>);</span><br><span class="line">  <span class="title function_">setNumber</span>(<span class="function"><span class="params">n</span> =&gt;</span> n + <span class="number">1</span>);</span><br><span class="line">&#125;&#125;&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [number, setNumber] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;number&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        setNumber(number + 5);</span></span><br><span class="line"><span class="language-xml">        setNumber(n =&gt; n + 1);</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;&gt;增加数字<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是事件处理函数告诉 React 要做的事情：</p>
<ol>
<li><code>setNumber(number + 5)</code>：<code>number</code> 为 <code>0</code>，所以 <code>setNumber(0 + 5)</code>。React 将 <em>“替换为 <code>5</code>”</em> 添加到其队列中。</li>
<li><code>setNumber(n =&gt; n + 1)</code>：<code>n =&gt; n + 1</code> 是一个更新函数。 React 将 <strong>该函数</strong> 添加到其队列中。</li>
</ol>
<p>在下一次渲染期间，React 会遍历 state 队列：</p>
<table>
<thead>
<tr>
<th>更新队列</th>
<th><code>n</code></th>
<th>返回值</th>
</tr>
</thead>
<tbody><tr>
<td>“替换为 <code>5</code>”</td>
<td><code>0</code>（未使用）</td>
<td><code>5</code></td>
</tr>
<tr>
<td><code>n =&gt; n + 1</code></td>
<td><code>5</code></td>
<td><code>5 + 1 = 6</code></td>
</tr>
</tbody></table>
<p>React 会保存 <code>6</code> 为最终结果并从 <code>useState</code> 中返回。</p>
<blockquote>
<p>你可能已经注意到，<code>setState(x)</code> 实际上会像 <code>setState(n =&gt; x)</code> 一样运行，只是没有使用 <code>n</code>！</p>
</blockquote>
<h3 id="3-5-4-如果你在更新-state-后替换-state-会发生什么"><a href="#3-5-4-如果你在更新-state-后替换-state-会发生什么" class="headerlink" title="3.5.4 如果你在更新 state 后替换 state 会发生什么 ?"></a>3.5.4 如果你在更新 state 后替换 state 会发生什么 ?</h3><p>让我们再看一个例子。你认为 <code>number</code> 在下一次渲染中的值是什么？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">setNumber</span>(number + <span class="number">5</span>);</span><br><span class="line">  <span class="title function_">setNumber</span>(<span class="function"><span class="params">n</span> =&gt;</span> n + <span class="number">1</span>);</span><br><span class="line">  <span class="title function_">setNumber</span>(<span class="number">42</span>);</span><br><span class="line">&#125;&#125;&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [number, setNumber] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;number&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        setNumber(number + 5);</span></span><br><span class="line"><span class="language-xml">        setNumber(n =&gt; n + 1);</span></span><br><span class="line"><span class="language-xml">        setNumber(42);</span></span><br><span class="line"><span class="language-xml">        alert(number)</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;&gt;增加数字<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以下是 React 在执行事件处理函数时处理这几行代码的过程：</p>
<ol>
<li><code>setNumber(number + 5)</code>：<code>number</code> 为 <code>0</code>，所以 <code>setNumber(0 + 5)</code>。React 将 <em>“替换为 <code>5</code>”</em> 添加到其队列中。</li>
<li><code>setNumber(n =&gt; n + 1)</code>：<code>n =&gt; n + 1</code> 是一个更新函数。React 将该函数添加到其队列中。</li>
<li><code>setNumber(42)</code>：React 将 <em>“替换为 <code>42</code>”</em> 添加到其队列中。</li>
</ol>
<p>在下一次渲染期间，React 会遍历 state 队列：</p>
<table>
<thead>
<tr>
<th>更新队列</th>
<th><code>n</code></th>
<th>返回值</th>
</tr>
</thead>
<tbody><tr>
<td>“替换为 <code>5</code>”</td>
<td><code>0</code>（未使用）</td>
<td><code>5</code></td>
</tr>
<tr>
<td><code>n =&gt; n + 1</code></td>
<td><code>5</code></td>
<td><code>5 + 1 = 6</code></td>
</tr>
<tr>
<td>“替换为 <code>42</code>”</td>
<td><code>6</code>（未使用）</td>
<td><code>42</code></td>
</tr>
</tbody></table>
<p>然后 React 会保存 <code>42</code> 为最终结果并从 <code>useState</code> 中返回。</p>
<p>总而言之，以下是你可以考虑传递给 <code>setNumber</code> state 设置函数的内容：</p>
<ul>
<li><strong>一个更新函数</strong>（例如：<code>n =&gt; n + 1</code>）会被添加到队列中。</li>
<li><strong>任何其他的值</strong>（例如：数字 <code>5</code>）会导致“替换为 <code>5</code>”被添加到队列中，已经在队列中的内容会被忽略。</li>
</ul>
<p>事件处理函数执行完成后，React 将触发重新渲染。在重新渲染期间，React 将处理队列。更新函数会在渲染期间执行，因此 <strong>更新函数必须是 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/keeping-components-pure">纯函数</a></strong> 并且只 <strong>返回</strong> 结果。不要尝试从它们内部设置 state 或者执行其他副作用。在严格模式下，React 会执行每个更新函数两次（但是丢弃第二个结果）以便帮助你发现错误。</p>
<h3 id="3-5-5-命名惯例"><a href="#3-5-5-命名惯例" class="headerlink" title="3.5.5 命名惯例"></a>3.5.5 命名惯例</h3><p>通常可以通过相应 state 变量的第一个字母来命名更新函数的参数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setEnabled</span>(<span class="function"><span class="params">e</span> =&gt;</span> !e);</span><br><span class="line"><span class="title function_">setLastName</span>(<span class="function"><span class="params">ln</span> =&gt;</span> ln.<span class="title function_">reverse</span>());</span><br><span class="line"><span class="title function_">setFriendCount</span>(<span class="function"><span class="params">fc</span> =&gt;</span> fc * <span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p>如果你喜欢更冗长的代码，另一个常见的惯例是重复使用完整的 state 变量名称，如 <code>setEnabled(enabled =&gt; !enabled)</code>，或使用前缀，如 <code>setEnabled(prevEnabled =&gt; !prevEnabled)</code>。</p>
<h3 id="3-5-6-摘要"><a href="#3-5-6-摘要" class="headerlink" title="3.5.6 摘要"></a>3.5.6 摘要</h3><ul>
<li>设置 state 不会更改现有渲染中的变量，但会请求一次新的渲染。</li>
<li>React 会在事件处理函数执行完成之后处理 state 更新。这被称为批处理。</li>
<li>要在一个事件中多次更新某些 state，你可以使用 <code>setNumber(n =&gt; n + 1)</code> 更新函数。</li>
</ul>
<h2 id="3-6-更新-state-中的对象"><a href="#3-6-更新-state-中的对象" class="headerlink" title="3.6 更新 state 中的对象"></a>3.6 更新 state 中的对象</h2><p>state 中可以保存任意类型的 JavaScript 值，包括对象。但是，你不应该直接修改存放在 React state 中的对象。相反，当你想要更新一个对象时，你需要创建一个新的对象（或者将其拷贝一份），然后将 state 更新为此对象。</p>
<h3 id="3-6-1-什么是-mutation？"><a href="#3-6-1-什么是-mutation？" class="headerlink" title="3.6.1 什么是 mutation？"></a>3.6.1 什么是 mutation？</h3><p>你可以在 state 中存放任意类型的 JavaScript 值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [x, setX] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>到目前为止，你已经尝试过在 state 中存放数字、字符串和布尔值，这些类型的值在 JavaScript 中是不可变（immutable）的，这意味着它们不能被改变或是只读的。你可以通过替换它们的值以触发一次重新渲染。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setX</span>(<span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<p>state <code>x</code> 从 <code>0</code> 变为 <code>5</code>，但是数字 <code>0</code> 本身并没有发生改变。在 JavaScript 中，无法对内置的原始值，如数字、字符串和布尔值，进行任何更改。</p>
<p>现在考虑 state 中存放对象的情况：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [position, setPosition] = <span class="title function_">useState</span>(&#123; <span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span> &#125;);</span><br></pre></td></tr></table></figure>

<p>从技术上来讲，可以改变对象自身的内容。<strong>当你这样做时，就制造了一个 mutation</strong>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">position.<span class="property">x</span> = <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<p>然而，虽然严格来说 React state 中存放的对象是可变的，但你应该像处理数字、布尔值、字符串一样将它们视为不可变的。因此你应该替换它们的值，而不是对它们进行修改。</p>
<h3 id="3-6-2-将-state-视为只读的"><a href="#3-6-2-将-state-视为只读的" class="headerlink" title="3.6.2 将 state 视为只读的"></a>3.6.2 将 state 视为只读的</h3><p>换句话说，你应该 <strong>把所有存放在 state 中的 JavaScript 对象都视为只读的</strong>。</p>
<p>在下面的例子中，我们用一个存放在 state 中的对象来表示指针当前的位置。当你在预览区触摸或移动光标时，红色的点本应移动。但是实际上红点仍停留在原处：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">MovingDot</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [position, setPosition] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">    <span class="attr">x</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">y</span>: <span class="number">0</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onPointerMove</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        position.x = e.clientX;</span></span><br><span class="line"><span class="language-xml">        position.y = e.clientY;</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      style=&#123;&#123;</span></span><br><span class="line"><span class="language-xml">        position: &#x27;relative&#x27;,</span></span><br><span class="line"><span class="language-xml">        width: &#x27;100vw&#x27;,</span></span><br><span class="line"><span class="language-xml">        height: &#x27;100vh&#x27;,</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">position:</span> &#x27;<span class="attr">absolute</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">backgroundColor:</span> &#x27;<span class="attr">red</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">borderRadius:</span> &#x27;<span class="attr">50</span>%&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">transform:</span> `<span class="attr">translate</span>($&#123;<span class="attr">position.x</span>&#125;<span class="attr">px</span>, $&#123;<span class="attr">position.y</span>&#125;<span class="attr">px</span>)`,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">left:</span> <span class="attr">-10</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">top:</span> <span class="attr">-10</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">width:</span> <span class="attr">20</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">height:</span> <span class="attr">20</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &#125;&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>问题出在下面这段代码中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">onPointerMove=&#123;<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">  position.<span class="property">x</span> = e.<span class="property">clientX</span>;</span><br><span class="line">  position.<span class="property">y</span> = e.<span class="property">clientY</span>;</span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码直接修改了 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/state-as-a-snapshot#rendering-takes-a-snapshot-in-time">上一次渲染中</a> 分配给 <code>position</code> 的对象。但是因为并没有使用 state 的设置函数，React 并不知道对象已更改。所以 React 没有做出任何响应。这就像在吃完饭之后才尝试去改变要点的菜一样。虽然在一些情况下，直接修改 state 可能是有效的，但我们并不推荐这么做。你应该把在渲染过程中可以访问到的 state 视为只读的。</p>
<p>在这种情况下，为了真正地 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/state-as-a-snapshot#setting-state-triggers-renders">触发一次重新渲染</a>，<strong>你需要创建一个新对象并把它传递给 state 的设置函数</strong>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">onPointerMove=&#123;<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">setPosition</span>(&#123;</span><br><span class="line">    <span class="attr">x</span>: e.<span class="property">clientX</span>,</span><br><span class="line">    <span class="attr">y</span>: e.<span class="property">clientY</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>通过使用 <code>setPosition</code>，你在告诉 React：</p>
<ul>
<li>使用这个新的对象替换 <code>position</code> 的值</li>
<li>然后再次渲染这个组件</li>
</ul>
<p>现在你可以看到，当你在预览区触摸或移动光标时，红点会跟随着你的指针移动：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">MovingDot</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [position, setPosition] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">    <span class="attr">x</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">y</span>: <span class="number">0</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onPointerMove</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        setPosition(&#123;</span></span><br><span class="line"><span class="language-xml">          x: e.clientX,</span></span><br><span class="line"><span class="language-xml">          y: e.clientY</span></span><br><span class="line"><span class="language-xml">        &#125;);</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      style=&#123;&#123;</span></span><br><span class="line"><span class="language-xml">        position: &#x27;relative&#x27;,</span></span><br><span class="line"><span class="language-xml">        width: &#x27;100vw&#x27;,</span></span><br><span class="line"><span class="language-xml">        height: &#x27;100vh&#x27;,</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">position:</span> &#x27;<span class="attr">absolute</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">backgroundColor:</span> &#x27;<span class="attr">red</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">borderRadius:</span> &#x27;<span class="attr">50</span>%&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">transform:</span> `<span class="attr">translate</span>($&#123;<span class="attr">position.x</span>&#125;<span class="attr">px</span>, $&#123;<span class="attr">position.y</span>&#125;<span class="attr">px</span>)`,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">left:</span> <span class="attr">-10</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">top:</span> <span class="attr">-10</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">width:</span> <span class="attr">20</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">height:</span> <span class="attr">20</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &#125;&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<h4 id="局部-mutation-是可以接受的"><a href="#局部-mutation-是可以接受的" class="headerlink" title="局部 mutation 是可以接受的"></a>局部 mutation 是可以接受的</h4><p>像这样的代码是有问题的，因为它改变了 state 中现有的对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">position.<span class="property">x</span> = e.<span class="property">clientX</span>;</span><br><span class="line">position.<span class="property">y</span> = e.<span class="property">clientY</span>;</span><br></pre></td></tr></table></figure>

<p>但是像这样的代码就 <strong>没有任何问题</strong>，因为你改变的是你刚刚创建的一个新的对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nextPosition = &#123;&#125;;</span><br><span class="line">nextPosition.<span class="property">x</span> = e.<span class="property">clientX</span>;</span><br><span class="line">nextPosition.<span class="property">y</span> = e.<span class="property">clientY</span>;</span><br><span class="line"><span class="title function_">setPosition</span>(nextPosition);</span><br></pre></td></tr></table></figure>

<p>事实上，它完全等同于下面这种写法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setPosition</span>(&#123;</span><br><span class="line">  <span class="attr">x</span>: e.<span class="property">clientX</span>,</span><br><span class="line">  <span class="attr">y</span>: e.<span class="property">clientY</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>只有当你改变已经处于 state 中的 <strong>现有</strong> 对象时，mutation 才会成为问题。而修改一个你刚刚创建的对象就不会出现任何问题，因为 <strong>还没有其他的代码引用它</strong>。改变它并不会意外地影响到依赖它的东西。这叫做“局部 mutation”。你甚至可以 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/keeping-components-pure#local-mutation-your-components-little-secret">在渲染的过程中</a> 进行“局部 mutation”的操作。这种操作既便捷又没有任何问题！</p>
</blockquote>
<h3 id="3-6-3-使用展开语法复制对象"><a href="#3-6-3-使用展开语法复制对象" class="headerlink" title="3.6.3 使用展开语法复制对象"></a>3.6.3 使用展开语法复制对象</h3><p>在之前的例子中，始终会根据当前指针的位置创建出一个新的 <code>position</code> 对象。但是通常，你会希望把 <strong>现有</strong> 数据作为你所创建的新对象的一部分。例如，你可能只想要更新表单中的一个字段，其他的字段仍然使用之前的值。</p>
<p>下面的代码中，输入框并不会正常运行，因为 <code>onChange</code> 直接修改了 state ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Form</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [person, setPerson] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">    <span class="attr">firstName</span>: <span class="string">&#x27;Barbara&#x27;</span>,</span><br><span class="line">    <span class="attr">lastName</span>: <span class="string">&#x27;Hepworth&#x27;</span>,</span><br><span class="line">    <span class="attr">email</span>: <span class="string">&#x27;bhepworth@sculpture.com&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleFirstNameChange</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    person.<span class="property">firstName</span> = e.<span class="property">target</span>.<span class="property">value</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleLastNameChange</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    person.<span class="property">lastName</span> = e.<span class="property">target</span>.<span class="property">value</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleEmailChange</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    person.<span class="property">email</span> = e.<span class="property">target</span>.<span class="property">value</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        First name:</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;person.firstName&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;handleFirstNameChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Last name:</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;person.lastName&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;handleLastNameChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Email:</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;person.email&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;handleEmailChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;person.firstName&#125;&#123;&#x27; &#x27;&#125;</span></span><br><span class="line"><span class="language-xml">        &#123;person.lastName&#125;&#123;&#x27; &#x27;&#125;</span></span><br><span class="line"><span class="language-xml">        (&#123;person.email&#125;)</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例如，下面这行代码修改了上一次渲染中的 state：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">person.<span class="property">firstName</span> = e.<span class="property">target</span>.<span class="property">value</span>;</span><br></pre></td></tr></table></figure>

<p>想要实现你的需求，最可靠的办法就是创建一个新的对象并将它传递给 <code>setPerson</code>。但是在这里，你还需要 <strong>把当前的数据复制到新对象中</strong>，因为你只改变了其中一个字段：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setPerson</span>(&#123;</span><br><span class="line">  <span class="attr">firstName</span>: e.<span class="property">target</span>.<span class="property">value</span>, <span class="comment">// 从 input 中获取新的 first name</span></span><br><span class="line">  <span class="attr">lastName</span>: person.<span class="property">lastName</span>,</span><br><span class="line">  <span class="attr">email</span>: person.<span class="property">email</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>你可以使用 <code>...</code> <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Spread_syntax#spread_in_object_literals">对象展开</a> 语法，这样你就不需要单独复制每个属性。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setPerson</span>(&#123;</span><br><span class="line">  ...person, <span class="comment">// 复制上一个 person 中的所有字段</span></span><br><span class="line">  <span class="attr">firstName</span>: e.<span class="property">target</span>.<span class="property">value</span> <span class="comment">// 但是覆盖 firstName 字段 </span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>现在表单可以正常运行了！</p>
<p>可以看到，你并没有为每个输入框单独声明一个 state。对于大型表单，将所有数据都存放在同一个对象中是非常方便的——前提是你能够正确地更新它！</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Form</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [person, setPerson] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">    <span class="attr">firstName</span>: <span class="string">&#x27;Barbara&#x27;</span>,</span><br><span class="line">    <span class="attr">lastName</span>: <span class="string">&#x27;Hepworth&#x27;</span>,</span><br><span class="line">    <span class="attr">email</span>: <span class="string">&#x27;bhepworth@sculpture.com&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleFirstNameChange</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="title function_">setPerson</span>(&#123;</span><br><span class="line">      ...person,</span><br><span class="line">      <span class="attr">firstName</span>: e.<span class="property">target</span>.<span class="property">value</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleLastNameChange</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="title function_">setPerson</span>(&#123;</span><br><span class="line">      ...person,</span><br><span class="line">      <span class="attr">lastName</span>: e.<span class="property">target</span>.<span class="property">value</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleEmailChange</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="title function_">setPerson</span>(&#123;</span><br><span class="line">      ...person,</span><br><span class="line">      <span class="attr">email</span>: e.<span class="property">target</span>.<span class="property">value</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        First name:</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;person.firstName&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;handleFirstNameChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Last name:</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;person.lastName&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;handleLastNameChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Email:</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;person.email&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;handleEmailChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;person.firstName&#125;&#123;&#x27; &#x27;&#125;</span></span><br><span class="line"><span class="language-xml">        &#123;person.lastName&#125;&#123;&#x27; &#x27;&#125;</span></span><br><span class="line"><span class="language-xml">        (&#123;person.email&#125;)</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请注意 <code>...</code> 展开语法本质是是“浅拷贝”——它只会复制一层。这使得它的执行速度很快，但是也意味着当你想要更新一个嵌套属性时，你必须得多次使用展开语法。</p>
<blockquote>
<h4 id="使用一个事件处理函数来更新多个字段"><a href="#使用一个事件处理函数来更新多个字段" class="headerlink" title="使用一个事件处理函数来更新多个字段"></a>使用一个事件处理函数来更新多个字段</h4><p>你也可以在对象的定义中使用 <code>[</code> 和 <code>]</code> 括号来实现属性的动态命名。下面是同一个例子，但它使用了一个事件处理函数而不是三个：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Form</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [person, setPerson] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">    <span class="attr">firstName</span>: <span class="string">&#x27;Barbara&#x27;</span>,</span><br><span class="line">    <span class="attr">lastName</span>: <span class="string">&#x27;Hepworth&#x27;</span>,</span><br><span class="line">    <span class="attr">email</span>: <span class="string">&#x27;bhepworth@sculpture.com&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleChange</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="title function_">setPerson</span>(&#123;</span><br><span class="line">      ...person,</span><br><span class="line">      [e.<span class="property">target</span>.<span class="property">name</span>]: e.<span class="property">target</span>.<span class="property">value</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        First name:</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;firstName&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;person.firstName&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;handleChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Last name:</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;person.lastName&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;handleChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Email:</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;email&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;person.email&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;handleChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;person.firstName&#125;&#123;&#x27; &#x27;&#125;</span></span><br><span class="line"><span class="language-xml">        &#123;person.lastName&#125;&#123;&#x27; &#x27;&#125;</span></span><br><span class="line"><span class="language-xml">        (&#123;person.email&#125;)</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这里，<code>e.target.name</code> 引用了 <code>&lt;input&gt;</code> 这个 DOM 元素的 <code>name</code> 属性。</p>
</blockquote>
<h3 id="3-6-4-更新一个嵌套对象"><a href="#3-6-4-更新一个嵌套对象" class="headerlink" title="3.6.4 更新一个嵌套对象"></a>3.6.4 更新一个嵌套对象</h3><p>考虑下面这种结构的嵌套对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [person, setPerson] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Niki de Saint Phalle&#x27;</span>,</span><br><span class="line">  <span class="attr">artwork</span>: &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;Blue Nana&#x27;</span>,</span><br><span class="line">    <span class="attr">city</span>: <span class="string">&#x27;Hamburg&#x27;</span>,</span><br><span class="line">    <span class="attr">image</span>: <span class="string">&#x27;https://i.imgur.com/Sd1AgUOm.jpg&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>如果你想要更新 <code>person.artwork.city</code> 的值，用 mutation 来实现的方法非常容易理解：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">person.<span class="property">artwork</span>.<span class="property">city</span> = <span class="string">&#x27;New Delhi&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>但是在 React 中，你需要将 state 视为不可变的！为了修改 <code>city</code> 的值，你首先需要创建一个新的 <code>artwork</code> 对象（其中预先填充了上一个 <code>artwork</code> 对象中的数据），然后创建一个新的 <code>person</code> 对象，并使得其中的 <code>artwork</code> 属性指向新创建的 <code>artwork</code> 对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nextArtwork = &#123; ...person.<span class="property">artwork</span>, <span class="attr">city</span>: <span class="string">&#x27;New Delhi&#x27;</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> nextPerson = &#123; ...person, <span class="attr">artwork</span>: nextArtwork &#125;;</span><br><span class="line"><span class="title function_">setPerson</span>(nextPerson);</span><br></pre></td></tr></table></figure>

<p>或者，写成一个函数调用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setPerson</span>(&#123;</span><br><span class="line">  ...person, <span class="comment">// 复制其它字段的数据 </span></span><br><span class="line">  <span class="attr">artwork</span>: &#123; <span class="comment">// 替换 artwork 字段 </span></span><br><span class="line">    ...person.<span class="property">artwork</span>, <span class="comment">// 复制之前 person.artwork 中的数据</span></span><br><span class="line">    <span class="attr">city</span>: <span class="string">&#x27;New Delhi&#x27;</span> <span class="comment">// 但是将 city 的值替换为 New Delhi！</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这虽然看起来有点冗长，但对于很多情况都能有效地解决问题：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Form</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [person, setPerson] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Niki de Saint Phalle&#x27;</span>,</span><br><span class="line">    <span class="attr">artwork</span>: &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;Blue Nana&#x27;</span>,</span><br><span class="line">      <span class="attr">city</span>: <span class="string">&#x27;Hamburg&#x27;</span>,</span><br><span class="line">      <span class="attr">image</span>: <span class="string">&#x27;https://i.imgur.com/Sd1AgUOm.jpg&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleNameChange</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="title function_">setPerson</span>(&#123;</span><br><span class="line">      ...person,</span><br><span class="line">      <span class="attr">name</span>: e.<span class="property">target</span>.<span class="property">value</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleTitleChange</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="title function_">setPerson</span>(&#123;</span><br><span class="line">      ...person,</span><br><span class="line">      <span class="attr">artwork</span>: &#123;</span><br><span class="line">        ...person.<span class="property">artwork</span>,</span><br><span class="line">        <span class="attr">title</span>: e.<span class="property">target</span>.<span class="property">value</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleCityChange</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="title function_">setPerson</span>(&#123;</span><br><span class="line">      ...person,</span><br><span class="line">      <span class="attr">artwork</span>: &#123;</span><br><span class="line">        ...person.<span class="property">artwork</span>,</span><br><span class="line">        <span class="attr">city</span>: e.<span class="property">target</span>.<span class="property">value</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleImageChange</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="title function_">setPerson</span>(&#123;</span><br><span class="line">      ...person,</span><br><span class="line">      <span class="attr">artwork</span>: &#123;</span><br><span class="line">        ...person.<span class="property">artwork</span>,</span><br><span class="line">        <span class="attr">image</span>: e.<span class="property">target</span>.<span class="property">value</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Name:</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;person.name&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;handleNameChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Title:</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;person.artwork.title&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;handleTitleChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        City:</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;person.artwork.city&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;handleCityChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Image:</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;person.artwork.image&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;handleImageChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">i</span>&gt;</span>&#123;person.artwork.title&#125;<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;&#x27; by &#x27;&#125;</span></span><br><span class="line"><span class="language-xml">        &#123;person.name&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        (located in &#123;person.artwork.city&#125;)</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">img</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">src</span>=<span class="string">&#123;person.artwork.image&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">alt</span>=<span class="string">&#123;person.artwork.title&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<h4 id="对象并非是真正嵌套的"><a href="#对象并非是真正嵌套的" class="headerlink" title="对象并非是真正嵌套的"></a>对象并非是真正嵌套的</h4><p>下面这个对象从代码上来看是“嵌套”的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Niki de Saint Phalle&#x27;</span>,</span><br><span class="line">  <span class="attr">artwork</span>: &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;Blue Nana&#x27;</span>,</span><br><span class="line">    <span class="attr">city</span>: <span class="string">&#x27;Hamburg&#x27;</span>,</span><br><span class="line">    <span class="attr">image</span>: <span class="string">&#x27;https://i.imgur.com/Sd1AgUOm.jpg&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>然而，当我们思考对象的特性时，“嵌套”并不是一个非常准确的方式。当这段代码运行的时候，不存在“嵌套”的对象。你实际上看到的是两个不同的对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj1 = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;Blue Nana&#x27;</span>,</span><br><span class="line">  <span class="attr">city</span>: <span class="string">&#x27;Hamburg&#x27;</span>,</span><br><span class="line">  <span class="attr">image</span>: <span class="string">&#x27;https://i.imgur.com/Sd1AgUOm.jpg&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj2 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Niki de Saint Phalle&#x27;</span>,</span><br><span class="line">  <span class="attr">artwork</span>: obj1</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>对象 <code>obj1</code> 并不处于 <code>obj2</code> 的“内部”。例如，下面的代码中，<code>obj3</code> 中的属性也可以指向 <code>obj1</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj1 = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;Blue Nana&#x27;</span>,</span><br><span class="line">  <span class="attr">city</span>: <span class="string">&#x27;Hamburg&#x27;</span>,</span><br><span class="line">  <span class="attr">image</span>: <span class="string">&#x27;https://i.imgur.com/Sd1AgUOm.jpg&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj2 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Niki de Saint Phalle&#x27;</span>,</span><br><span class="line">  <span class="attr">artwork</span>: obj1</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj3 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Copycat&#x27;</span>,</span><br><span class="line">  <span class="attr">artwork</span>: obj1</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>如果你直接修改 <code>obj3.artwork.city</code>，就会同时影响 <code>obj2.artwork.city</code> 和 <code>obj1.city</code>。这是因为 <code>obj3.artwork</code>、<code>obj2.artwork</code> 和 <code>obj1</code> 都指向同一个对象。当你用“嵌套”的方式看待对象时，很难看出这一点。相反，它们是相互独立的对象，只不过是用属性“指向”彼此而已。</p>
</blockquote>
<h3 id="3-6-5-使用-Immer-编写简洁的更新逻辑"><a href="#3-6-5-使用-Immer-编写简洁的更新逻辑" class="headerlink" title="3.6.5 使用 Immer 编写简洁的更新逻辑"></a>3.6.5 使用 Immer 编写简洁的更新逻辑</h3><p>如果你的 state 有多层的嵌套，你或许应该考虑 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/choosing-the-state-structure#avoid-deeply-nested-state">将其扁平化</a>。但是，如果你不想改变 state 的数据结构，你可能更喜欢用一种更便捷的方式来实现嵌套展开的效果。<a target="_blank" rel="noopener" href="https://github.com/immerjs/use-immer">Immer</a> 是一个非常流行的库，它可以让你使用简便但可以直接修改的语法编写代码，并会帮你处理好复制的过程。通过使用 Immer，你写出的代码看起来就像是你“打破了规则”而直接修改了对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">updatePerson</span>(<span class="function"><span class="params">draft</span> =&gt;</span> &#123;</span><br><span class="line">  draft.<span class="property">artwork</span>.<span class="property">city</span> = <span class="string">&#x27;Lagos&#x27;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>但是不同于一般的 mutation，它并不会覆盖之前的 state！</p>
<blockquote>
<h4 id="Immer-是如何运行的？"><a href="#Immer-是如何运行的？" class="headerlink" title="Immer 是如何运行的？"></a>Immer 是如何运行的？</h4><p>由 Immer 提供的 <code>draft</code> 是一种特殊类型的对象，被称为 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy</a>，它会记录你用它所进行的操作。这就是你能够随心所欲地直接修改对象的原因所在！从原理上说，Immer 会弄清楚 <code>draft</code> 对象的哪些部分被改变了，并会依照你的修改创建出一个全新的对象。</p>
</blockquote>
<p>尝试使用 Immer:</p>
<ol>
<li>运行 <code>npm install use-immer</code> 添加 Immer 依赖</li>
<li>用 <code>import &#123; useImmer &#125; from &#39;use-immer&#39;</code> 替换掉 <code>import &#123; useState &#125; from &#39;react&#39;</code></li>
</ol>
<p>下面我们把上面的例子用 Immer 实现一下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useImmer &#125; <span class="keyword">from</span> <span class="string">&#x27;use-immer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Form</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [person, updatePerson] = <span class="title function_">useImmer</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Niki de Saint Phalle&#x27;</span>,</span><br><span class="line">    <span class="attr">artwork</span>: &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;Blue Nana&#x27;</span>,</span><br><span class="line">      <span class="attr">city</span>: <span class="string">&#x27;Hamburg&#x27;</span>,</span><br><span class="line">      <span class="attr">image</span>: <span class="string">&#x27;https://i.imgur.com/Sd1AgUOm.jpg&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleNameChange</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="title function_">updatePerson</span>(<span class="function"><span class="params">draft</span> =&gt;</span> &#123;</span><br><span class="line">      draft.<span class="property">name</span> = e.<span class="property">target</span>.<span class="property">value</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleTitleChange</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="title function_">updatePerson</span>(<span class="function"><span class="params">draft</span> =&gt;</span> &#123;</span><br><span class="line">      draft.<span class="property">artwork</span>.<span class="property">title</span> = e.<span class="property">target</span>.<span class="property">value</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleCityChange</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="title function_">updatePerson</span>(<span class="function"><span class="params">draft</span> =&gt;</span> &#123;</span><br><span class="line">      draft.<span class="property">artwork</span>.<span class="property">city</span> = e.<span class="property">target</span>.<span class="property">value</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleImageChange</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="title function_">updatePerson</span>(<span class="function"><span class="params">draft</span> =&gt;</span> &#123;</span><br><span class="line">      draft.<span class="property">artwork</span>.<span class="property">image</span> = e.<span class="property">target</span>.<span class="property">value</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Name:</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;person.name&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;handleNameChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Title:</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;person.artwork.title&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;handleTitleChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        City:</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;person.artwork.city&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;handleCityChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Image:</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;person.artwork.image&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;handleImageChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">i</span>&gt;</span>&#123;person.artwork.title&#125;<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;&#x27; by &#x27;&#125;</span></span><br><span class="line"><span class="language-xml">        &#123;person.name&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        (located in &#123;person.artwork.city&#125;)</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">img</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">src</span>=<span class="string">&#123;person.artwork.image&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">alt</span>=<span class="string">&#123;person.artwork.title&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，事件处理函数变得更简洁了。你可以随意在一个组件中同时使用 <code>useState</code> 和 <code>useImmer</code>。如果你想要写出更简洁的更新处理函数，Immer 会是一个不错的选择，尤其是当你的 state 中有嵌套，并且复制对象会带来重复的代码时。</p>
<blockquote>
<h4 id="为什么在-React-中不推荐直接修改-state？"><a href="#为什么在-React-中不推荐直接修改-state？" class="headerlink" title="为什么在 React 中不推荐直接修改 state？"></a>为什么在 React 中不推荐直接修改 state？</h4><p>有以下几个原因：</p>
<ul>
<li><strong>调试</strong>：如果你使用 <code>console.log</code> 并且不直接修改 state，你之前日志中的 state 的值就不会被新的 state 变化所影响。这样你就可以清楚地看到两次渲染之间 state 的值发生了什么变化</li>
<li><strong>优化</strong>：React 常见的 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/reference/react/memo">优化策略</a> 依赖于如果之前的 props 或者 state 的值和下一次相同就跳过渲染。如果你从未直接修改 state ，那么你就可以很快看到 state 是否发生了变化。如果 <code>prevObj === obj</code>，那么你就可以肯定这个对象内部并没有发生改变。</li>
<li><strong>新功能</strong>：我们正在构建的 React 的新功能依赖于 state 被 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/state-as-a-snapshot">像快照一样看待</a> 的理念。如果你直接修改 state 的历史版本，可能会影响你使用这些新功能。</li>
<li><strong>需求变更</strong>：有些应用功能在不出现任何修改的情况下会更容易实现，比如实现撤销&#x2F;恢复、展示修改历史，或是允许用户把表单重置成某个之前的值。这是因为你可以把 state 之前的拷贝保存到内存中，并适时对其进行再次使用。如果一开始就用了直接修改 state 的方式，那么后面要实现这样的功能就会变得非常困难。</li>
<li><strong>更简单的实现</strong>：React 并不依赖于 mutation ，所以你不需要对对象进行任何特殊操作。它不需要像很多“响应式”的解决方案一样去劫持对象的属性、总是用代理把对象包裹起来，或者在初始化时做其他工作。这也是 React 允许你把任何对象存放在 state 中——不管对象有多大——而不会造成有任何额外的性能或正确性问题的原因。</li>
</ul>
<p>在实践中，你经常可以“侥幸”直接修改 state 而不出现什么问题，但是我们强烈建议你不要这样做，这样你就可以使用我们秉承着这种理念开发的 React 新功能。未来的贡献者甚至是你未来的自己都会感谢你的！</p>
</blockquote>
<h3 id="3-6-6-摘要"><a href="#3-6-6-摘要" class="headerlink" title="3.6.6 摘要"></a>3.6.6 摘要</h3><ul>
<li>将 React 中所有的 state 都视为不可直接修改的。</li>
<li>当你在 state 中存放对象时，直接修改对象并不会触发重渲染，并会改变前一次渲染“快照”中 state 的值。</li>
<li>不要直接修改一个对象，而要为它创建一个 <strong>新</strong> 版本，并通过把 state 设置成这个新版本来触发重新渲染。</li>
<li>你可以使用这样的 <code>&#123;...obj, something: &#39;newValue&#39;&#125;</code> 对象展开语法来创建对象的拷贝。</li>
<li>对象的展开语法是浅层的：它的复制深度只有一层。</li>
<li>想要更新嵌套对象，你需要从你更新的位置开始自底向上为每一层都创建新的拷贝。</li>
<li>想要减少重复的拷贝代码，可以使用 Immer。</li>
</ul>
<h2 id="3-7-更新-state-中的数组"><a href="#3-7-更新-state-中的数组" class="headerlink" title="3.7 更新 state 中的数组"></a>3.7 更新 state 中的数组</h2><p>数组是另外一种可以存储在 state 中的 JavaScript 对象，它虽然是可变的，但是却应该被视为不可变。同对象一样，当你想要更新存储于 state 中的数组时，你需要创建一个新的数组（或者创建一份已有数组的拷贝值），并使用新数组设置 state。</p>
<h3 id="3-7-1-在没有-mutation-的前提下更新数组"><a href="#3-7-1-在没有-mutation-的前提下更新数组" class="headerlink" title="3.7.1 在没有 mutation 的前提下更新数组"></a>3.7.1 在没有 mutation 的前提下更新数组</h3><p>在 JavaScript 中，数组只是另一种对象。<a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/updating-objects-in-state">同对象一样</a>，<strong>你需要将 React state 中的数组视为只读的</strong>。这意味着你不应该使用类似于 <code>arr[0] = &#39;bird&#39;</code> 这样的方式来重新分配数组中的元素，也不应该使用会直接修改原始数组的方法，例如 <code>push()</code> 和 <code>pop()</code>。</p>
<p>相反，每次要更新一个数组时，你需要把一个<strong>新</strong>的数组传入 state 的 setting 方法中。为此，你可以通过使用像 <code>filter()</code> 和 <code>map()</code> 这样不会直接修改原始值的方法，从原始数组生成一个新的数组。然后你就可以将 state 设置为这个新生成的数组。</p>
<p>下面是常见数组操作的参考表。当你操作 React state 中的数组时，你需要避免使用左列的方法，而首选右列的方法：</p>
<table>
<thead>
<tr>
<th></th>
<th>避免使用 (会改变原始数组)</th>
<th>推荐使用 (会返回一个新数组）</th>
</tr>
</thead>
<tbody><tr>
<td>添加元素</td>
<td><code>push</code>，<code>unshift</code></td>
<td><code>concat</code>，<code>[...arr]</code> 展开语法（<a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/updating-arrays-in-state#adding-to-an-array">例子</a>）</td>
</tr>
<tr>
<td>删除元素</td>
<td><code>pop</code>，<code>shift</code>，<code>splice</code></td>
<td><code>filter</code>，<code>slice</code>（<a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/updating-arrays-in-state#removing-from-an-array">例子</a>）</td>
</tr>
<tr>
<td>替换元素</td>
<td><code>splice</code>，<code>arr[i] = ...</code> 赋值</td>
<td><code>map</code>（<a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/updating-arrays-in-state#replacing-items-in-an-array">例子</a>）</td>
</tr>
<tr>
<td>排序</td>
<td><code>reverse</code>，<code>sort</code></td>
<td>先将数组复制一份（<a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/updating-arrays-in-state#making-other-changes-to-an-array">例子</a>）</td>
</tr>
</tbody></table>
<p>或者，你可以<a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/updating-arrays-in-state#write-concise-update-logic-with-immer">使用 Immer</a> ，这样你便可以使用表格中的所有方法了。</p>
<blockquote>
<p>不幸的是，虽然 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/slice"><code>slice</code></a> 和 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/splice"><code>splice</code></a> 的名字相似，但作用却迥然不同：</p>
<ul>
<li><code>slice</code> 让你可以拷贝数组或是数组的一部分。</li>
<li><code>splice</code> <strong>会直接修改</strong> 原始数组（插入或者删除元素）。</li>
</ul>
<p>在 React 中，更多情况下你会使用 <code>slice</code>（没有 <code>p</code> ！），因为你不想改变 state 中的对象或数组。<a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/updating-objects-in-state">更新对象</a>这一章节解释了什么是 mutation，以及为什么不推荐在 state 里这样做。</p>
</blockquote>
<h3 id="3-7-2-向数组中添加元素"><a href="#3-7-2-向数组中添加元素" class="headerlink" title="3.7.2 向数组中添加元素"></a>3.7.2 向数组中添加元素</h3><p><code>push()</code> 会直接修改原始数组，而你不希望这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> nextId = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">List</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [name, setName] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> [artists, setArtists] = <span class="title function_">useState</span>([]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>振奋人心的雕塑家们：<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&#123;name&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> setName(e.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">      /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        artists.push(&#123;</span></span><br><span class="line"><span class="language-xml">          id: nextId++,</span></span><br><span class="line"><span class="language-xml">          name: name,</span></span><br><span class="line"><span class="language-xml">        &#125;);</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;&gt;添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;artists.map(artist =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;artist.id&#125;</span>&gt;</span>&#123;artist.name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>相反，你应该创建一个 <strong>新</strong> 数组，其包含了原始数组的所有元素 <strong>以及</strong> 一个在末尾的新元素。这可以通过很多种方法实现，最简单的一种就是使用 <code>...</code> <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/a-javascript-refresher#array-spread">数组展开</a> 语法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setArtists</span>( <span class="comment">// 替换 state</span></span><br><span class="line">  [ <span class="comment">// 是通过传入一个新数组实现的</span></span><br><span class="line">    ...artists, <span class="comment">// 新数组包含原数组的所有元素</span></span><br><span class="line">    &#123; <span class="attr">id</span>: nextId++, <span class="attr">name</span>: name &#125; <span class="comment">// 并在末尾添加了一个新的元素</span></span><br><span class="line">  ]</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> nextId = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">List</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [name, setName] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> [artists, setArtists] = <span class="title function_">useState</span>([]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>振奋人心的雕塑家们：<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&#123;name&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> setName(e.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">      /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        setArtists([</span></span><br><span class="line"><span class="language-xml">          ...artists,</span></span><br><span class="line"><span class="language-xml">          &#123; id: nextId++, name: name &#125;</span></span><br><span class="line"><span class="language-xml">        ]);</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;&gt;添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;artists.map(artist =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;artist.id&#125;</span>&gt;</span>&#123;artist.name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>数组展开运算符还允许你把新添加的元素放在原始的 <code>...artists</code> 之前：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setArtists</span>([</span><br><span class="line">  &#123; <span class="attr">id</span>: nextId++, <span class="attr">name</span>: name &#125;,</span><br><span class="line">  ...artists <span class="comment">// 将原数组中的元素放在末尾</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<p>这样一来，展开操作就可以完成 <code>push()</code> 和 <code>unshift()</code> 的工作，将新元素添加到数组的末尾和开头。</p>
<h3 id="3-7-3-从数组中删除元素"><a href="#3-7-3-从数组中删除元素" class="headerlink" title="3.7.3 从数组中删除元素"></a>3.7.3 从数组中删除元素</h3><p>从数组中删除一个元素最简单的方法就是将它<strong>过滤出去</strong>。换句话说，你需要生成一个不包含该元素的新数组。这可以通过 <code>filter</code> 方法实现，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> initialArtists = [</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">0</span>, <span class="attr">name</span>: <span class="string">&#x27;Marta Colvin Andrade&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;Lamidi Olonade Fakeye&#x27;</span>&#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&#x27;Louise Nevelson&#x27;</span>&#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">List</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [artists, setArtists] = <span class="title function_">useState</span>(</span><br><span class="line">    initialArtists</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>振奋人心的雕塑家们：<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;artists.map(artist =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;artist.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;artist.name&#125;&#123;&#x27; &#x27;&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">              setArtists(</span></span><br><span class="line"><span class="language-xml">                artists.filter(a =&gt;</span></span><br><span class="line"><span class="language-xml">                  a.id !== artist.id</span></span><br><span class="line"><span class="language-xml">                )</span></span><br><span class="line"><span class="language-xml">              );</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">              删除</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>点击“删除”按钮几次，并且查看按钮处理点击事件的代码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setArtists</span>(</span><br><span class="line">  artists.<span class="title function_">filter</span>(<span class="function"><span class="params">a</span> =&gt;</span> a.<span class="property">id</span> !== artist.<span class="property">id</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>这里，<code>artists.filter(s =&gt; s.id !== artist.id)</code> 表示“创建一个新的数组，该数组由那些 ID 与 <code>artists.id</code> 不同的 <code>artists</code> 组成”。换句话说，每个 artist 的“删除”按钮会把 <em>那一个</em> artist 从原始数组中过滤掉，并使用过滤后的数组再次进行渲染。注意，<code>filter</code> 并不会改变原始数组。</p>
<h3 id="3-7-4-转换数组"><a href="#3-7-4-转换数组" class="headerlink" title="3.7.4 转换数组"></a>3.7.4 转换数组</h3><p>如果你想改变数组中的某些或全部元素，你可以用 <code>map()</code> 创建一个<strong>新</strong>数组。你传入 <code>map</code> 的函数决定了要根据每个元素的值或索引（或二者都要）对元素做何处理。</p>
<p>在下面的例子中，一个数组记录了两个圆形和一个正方形的坐标。当你点击按钮时，仅有两个圆形会向下移动 100 像素。这是通过使用 <code>map()</code> 生成一个新数组实现的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> initialShapes = [</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">0</span>, <span class="attr">type</span>: <span class="string">&#x27;circle&#x27;</span>, <span class="attr">x</span>: <span class="number">50</span>, <span class="attr">y</span>: <span class="number">100</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">type</span>: <span class="string">&#x27;square&#x27;</span>, <span class="attr">x</span>: <span class="number">150</span>, <span class="attr">y</span>: <span class="number">100</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">type</span>: <span class="string">&#x27;circle&#x27;</span>, <span class="attr">x</span>: <span class="number">250</span>, <span class="attr">y</span>: <span class="number">100</span> &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">ShapeEditor</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [shapes, setShapes] = <span class="title function_">useState</span>(</span><br><span class="line">    initialShapes</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> nextShapes = shapes.<span class="title function_">map</span>(<span class="function"><span class="params">shape</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (shape.<span class="property">type</span> === <span class="string">&#x27;square&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// 不作改变</span></span><br><span class="line">        <span class="keyword">return</span> shape;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 返回一个新的圆形，位置在下方 50px 处</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          ...shape,</span><br><span class="line">          <span class="attr">y</span>: shape.<span class="property">y</span> + <span class="number">50</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 使用新的数组进行重渲染</span></span><br><span class="line">    <span class="title function_">setShapes</span>(nextShapes);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        所有圆形向下移动！</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;shapes.map(shape =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">key</span>=<span class="string">&#123;shape.id&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">background:</span> &#x27;<span class="attr">purple</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">position:</span> &#x27;<span class="attr">absolute</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">left:</span> <span class="attr">shape.x</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">top:</span> <span class="attr">shape.y</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">borderRadius:</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">shape.type</span> === <span class="string">&#x27;circle&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              ? &#x27;<span class="attr">50</span>%&#x27; <span class="attr">:</span> &#x27;&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">width:</span> <span class="attr">20</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">height:</span> <span class="attr">20</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#125;&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-7-5-替换数组中的元素"><a href="#3-7-5-替换数组中的元素" class="headerlink" title="3.7.5 替换数组中的元素"></a>3.7.5 替换数组中的元素</h3><p>想要替换数组中一个或多个元素是非常常见的。类似 <code>arr[0] = &#39;bird&#39;</code> 这样的赋值语句会直接修改原始数组，所以在这种情况下，你也应该使用 <code>map</code>。</p>
<p>要替换一个元素，请使用 <code>map</code> 创建一个新数组。在你的 <code>map</code> 回调里，第二个参数是元素的索引。使用索引来判断最终是返回原始的元素（即回调的第一个参数）还是替换成其他值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> initialCounters = [</span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">CounterList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [counters, setCounters] = <span class="title function_">useState</span>(</span><br><span class="line">    initialCounters</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleIncrementClick</span>(<span class="params">index</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> nextCounters = counters.<span class="title function_">map</span>(<span class="function">(<span class="params">c, i</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (i === index) &#123;</span><br><span class="line">        <span class="comment">// 递增被点击的计数器数值</span></span><br><span class="line">        <span class="keyword">return</span> c + <span class="number">1</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 其余部分不发生变化</span></span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">setCounters</span>(nextCounters);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;counters.map((counter, i) =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;i&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;counter&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">            handleIncrementClick(i);</span></span><br><span class="line"><span class="language-xml">          &#125;&#125;&gt;+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-7-6-向数组中插入元素"><a href="#3-7-6-向数组中插入元素" class="headerlink" title="3.7.6 向数组中插入元素"></a>3.7.6 向数组中插入元素</h3><p>有时，你也许想向数组特定位置插入一个元素，这个位置既不在数组开头，也不在末尾。为此，你可以将数组展开运算符 <code>...</code> 和 <code>slice()</code> 方法一起使用。<code>slice()</code> 方法让你从数组中切出“一片”。为了将元素插入数组，你需要先展开原数组在插入点之前的切片，然后插入新元素，最后展开原数组中剩下的部分。</p>
<p>下面的例子中，插入按钮总是会将元素插入到数组中索引为 <code>1</code> 的位置。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> nextId = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">const</span> initialArtists = [</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">0</span>, <span class="attr">name</span>: <span class="string">&#x27;Marta Colvin Andrade&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;Lamidi Olonade Fakeye&#x27;</span>&#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&#x27;Louise Nevelson&#x27;</span>&#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">List</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [name, setName] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> [artists, setArtists] = <span class="title function_">useState</span>(</span><br><span class="line">    initialArtists</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> insertAt = <span class="number">1</span>; <span class="comment">// 可能是任何索引</span></span><br><span class="line">    <span class="keyword">const</span> nextArtists = [</span><br><span class="line">      <span class="comment">// 插入点之前的元素：</span></span><br><span class="line">      ...artists.<span class="title function_">slice</span>(<span class="number">0</span>, insertAt),</span><br><span class="line">      <span class="comment">// 新的元素：</span></span><br><span class="line">      &#123; <span class="attr">id</span>: nextId++, <span class="attr">name</span>: name &#125;,</span><br><span class="line">      <span class="comment">// 插入点之后的元素：</span></span><br><span class="line">      ...artists.<span class="title function_">slice</span>(insertAt)</span><br><span class="line">    ];</span><br><span class="line">    <span class="title function_">setArtists</span>(nextArtists);</span><br><span class="line">    <span class="title function_">setName</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>振奋人心的雕塑家们：<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&#123;name&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> setName(e.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">      /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        插入</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;artists.map(artist =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;artist.id&#125;</span>&gt;</span>&#123;artist.name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-7-7-其他改变数组的情况"><a href="#3-7-7-其他改变数组的情况" class="headerlink" title="3.7.7 其他改变数组的情况"></a>3.7.7 其他改变数组的情况</h3><p>总会有一些事，是你仅仅依靠展开运算符和 <code>map()</code> 或者 <code>filter()</code> 等不会直接修改原值的方法所无法做到的。例如，你可能想翻转数组，或是对数组排序。而 JavaScript 中的 <code>reverse()</code> 和 <code>sort()</code> 方法会改变原数组，所以你无法直接使用它们。</p>
<p><strong>然而，你可以先拷贝这个数组，再改变这个拷贝后的值。</strong></p>
<p>例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialList = [</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">0</span>, <span class="attr">title</span>: <span class="string">&#x27;Big Bellies&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">title</span>: <span class="string">&#x27;Lunar Landscape&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">title</span>: <span class="string">&#x27;Terracotta Army&#x27;</span> &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">List</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [list, setList] = <span class="title function_">useState</span>(initialList);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> nextList = [...list];</span><br><span class="line">    nextList.<span class="title function_">reverse</span>();</span><br><span class="line">    <span class="title function_">setList</span>(nextList);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        翻转</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;list.map(artwork =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;artwork.id&#125;</span>&gt;</span>&#123;artwork.title&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这段代码中，你先使用 <code>[...list]</code> 展开运算符创建了一份数组的拷贝值。当你有了这个拷贝值后，你就可以使用像 <code>nextList.reverse()</code> 或 <code>nextList.sort()</code> 这样直接修改原数组的方法。你甚至可以通过 <code>nextList[0] = &quot;something&quot;</code> 这样的方式对数组中的特定元素进行赋值。</p>
<p>然而，<strong>即使你拷贝了数组，你还是不能直接修改其内部的元素</strong>。这是因为数组的拷贝是浅拷贝——新的数组中依然保留了与原始数组相同的元素。因此，如果你修改了拷贝数组内部的某个对象，其实你正在直接修改当前的 state。举个例子，像下面的代码就会带来问题。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nextList = [...list];</span><br><span class="line">nextList[<span class="number">0</span>].<span class="property">seen</span> = <span class="literal">true</span>; <span class="comment">// 问题：直接修改了 list[0] 的值</span></span><br><span class="line"><span class="title function_">setList</span>(nextList);</span><br></pre></td></tr></table></figure>

<p>虽然 <code>nextList</code> 和 <code>list</code> 是两个不同的数组，**<code>nextList[0]</code> 和 <code>list[0]</code> 却指向了同一个对象**。因此，通过改变 <code>nextList[0].seen</code>，<code>list[0].seen</code> 的值也被改变了。这是一种 state 的 mutation 操作，你应该避免这么做！你可以用类似于 <a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/updating-objects-in-state#updating-a-nested-object">更新嵌套的 JavaScript 对象</a> 的方式解决这个问题——拷贝想要修改的特定元素，而不是直接修改它。下面是具体的操作。</p>
<h3 id="3-7-8-更新数组内部的对象"><a href="#3-7-8-更新数组内部的对象" class="headerlink" title="3.7.8 更新数组内部的对象"></a>3.7.8 更新数组内部的对象</h3><p>对象并不是 <em>真的</em> 位于数组“内部”。可能他们在代码中看起来像是在数组“内部”，但其实数组中的每个对象都是这个数组“指向”的一个存储于其它位置的值。这就是当你在处理类似 <code>list[0]</code> 这样的嵌套字段时需要格外小心的原因。其他人的艺术品清单可能指向了数组的同一个元素！</p>
<p><strong>当你更新一个嵌套的 state 时，你需要从想要更新的地方创建拷贝值，一直这样，直到顶层。</strong> 让我们看一下这该怎么做。</p>
<p>在下面的例子中，两个不同的艺术品清单有着相同的初始 state。他们本应该互不影响，但是因为一次 mutation，他们的 state 被意外地共享了，勾选一个清单中的事项会影响另外一个清单：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> nextId = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">const</span> initialList = [</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">0</span>, <span class="attr">title</span>: <span class="string">&#x27;Big Bellies&#x27;</span>, <span class="attr">seen</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">title</span>: <span class="string">&#x27;Lunar Landscape&#x27;</span>, <span class="attr">seen</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">title</span>: <span class="string">&#x27;Terracotta Army&#x27;</span>, <span class="attr">seen</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">BucketList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [myList, setMyList] = <span class="title function_">useState</span>(initialList);</span><br><span class="line">  <span class="keyword">const</span> [yourList, setYourList] = <span class="title function_">useState</span>(</span><br><span class="line">    initialList</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleToggleMyList</span>(<span class="params">artworkId, nextSeen</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> myNextList = [...myList];</span><br><span class="line">    <span class="keyword">const</span> artwork = myNextList.<span class="title function_">find</span>(</span><br><span class="line">      <span class="function"><span class="params">a</span> =&gt;</span> a.<span class="property">id</span> === artworkId</span><br><span class="line">    );</span><br><span class="line">    artwork.<span class="property">seen</span> = nextSeen;</span><br><span class="line">    <span class="title function_">setMyList</span>(myNextList);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleToggleYourList</span>(<span class="params">artworkId, nextSeen</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> yourNextList = [...yourList];</span><br><span class="line">    <span class="keyword">const</span> artwork = yourNextList.<span class="title function_">find</span>(</span><br><span class="line">      <span class="function"><span class="params">a</span> =&gt;</span> a.<span class="property">id</span> === artworkId</span><br><span class="line">    );</span><br><span class="line">    artwork.<span class="property">seen</span> = nextSeen;</span><br><span class="line">    <span class="title function_">setYourList</span>(yourNextList);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>艺术愿望清单<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我想看的艺术清单：<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ItemList</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">artworks</span>=<span class="string">&#123;myList&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onToggle</span>=<span class="string">&#123;handleToggleMyList&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>你想看的艺术清单：<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ItemList</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">artworks</span>=<span class="string">&#123;yourList&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onToggle</span>=<span class="string">&#123;handleToggleYourList&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ItemList</span>(<span class="params">&#123; artworks, onToggle &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;artworks.map(artwork =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;artwork.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">checked</span>=<span class="string">&#123;artwork.seen&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                onToggle(</span></span><br><span class="line"><span class="language-xml">                  artwork.id,</span></span><br><span class="line"><span class="language-xml">                  e.target.checked</span></span><br><span class="line"><span class="language-xml">                );</span></span><br><span class="line"><span class="language-xml">              &#125;&#125;</span></span><br><span class="line"><span class="language-xml">            /&gt;</span></span><br><span class="line"><span class="language-xml">            &#123;artwork.title&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>问题出在下面这段代码中:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myNextList = [...myList];</span><br><span class="line"><span class="keyword">const</span> artwork = myNextList.<span class="title function_">find</span>(<span class="function"><span class="params">a</span> =&gt;</span> a.<span class="property">id</span> === artworkId);</span><br><span class="line">artwork.<span class="property">seen</span> = nextSeen; <span class="comment">// 问题：直接修改了已有的元素</span></span><br><span class="line"><span class="title function_">setMyList</span>(myNextList);</span><br></pre></td></tr></table></figure>

<p>虽然 <code>myNextList</code> 这个数组是新的，但是其<strong>内部的元素本身</strong>与原数组 <code>myList</code> 是相同的。因此，修改 <code>artwork.seen</code>，其实是在修改<strong>原始的</strong> artwork 对象。而这个 artwork 对象也被 <code>yourList</code> 使用，这样就带来了 bug。这样的 bug 可能难以想到，但好在如果你避免直接修改 state，它们就会消失。</p>
<p><strong>你可以使用 <code>map</code> 在没有 mutation 的前提下将一个旧的元素替换成更新的版本。</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setMyList</span>(myList.<span class="title function_">map</span>(<span class="function"><span class="params">artwork</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (artwork.<span class="property">id</span> === artworkId) &#123;</span><br><span class="line">    <span class="comment">// 创建包含变更的 新 对象</span></span><br><span class="line">    <span class="keyword">return</span> &#123; ...artwork, <span class="attr">seen</span>: nextSeen &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 没有变更</span></span><br><span class="line">    <span class="keyword">return</span> artwork;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<p>此处的 <code>...</code> 是一个对象展开语法，被用来<a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/updating-objects-in-state#copying-objects-with-the-spread-syntax">创建一个对象的拷贝</a>.</p>
<p>通过这种方式，没有任何现有的 state 中的元素会被改变，bug 也就被修复了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> nextId = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">const</span> initialList = [</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">0</span>, <span class="attr">title</span>: <span class="string">&#x27;Big Bellies&#x27;</span>, <span class="attr">seen</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">title</span>: <span class="string">&#x27;Lunar Landscape&#x27;</span>, <span class="attr">seen</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">title</span>: <span class="string">&#x27;Terracotta Army&#x27;</span>, <span class="attr">seen</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">BucketList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [myList, setMyList] = <span class="title function_">useState</span>(initialList);</span><br><span class="line">  <span class="keyword">const</span> [yourList, setYourList] = <span class="title function_">useState</span>(</span><br><span class="line">    initialList</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleToggleMyList</span>(<span class="params">artworkId, nextSeen</span>) &#123;</span><br><span class="line">    <span class="title function_">setMyList</span>(myList.<span class="title function_">map</span>(<span class="function"><span class="params">artwork</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (artwork.<span class="property">id</span> === artworkId) &#123;</span><br><span class="line">        <span class="comment">// 创建包含变更的*新*对象</span></span><br><span class="line">        <span class="keyword">return</span> &#123; ...artwork, <span class="attr">seen</span>: nextSeen &#125;;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 没有变更</span></span><br><span class="line">        <span class="keyword">return</span> artwork;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleToggleYourList</span>(<span class="params">artworkId, nextSeen</span>) &#123;</span><br><span class="line">    <span class="title function_">setYourList</span>(yourList.<span class="title function_">map</span>(<span class="function"><span class="params">artwork</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (artwork.<span class="property">id</span> === artworkId) &#123;</span><br><span class="line">        <span class="comment">// 创建包含变更的*新*对象</span></span><br><span class="line">        <span class="keyword">return</span> &#123; ...artwork, <span class="attr">seen</span>: nextSeen &#125;;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 没有变更</span></span><br><span class="line">        <span class="keyword">return</span> artwork;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>艺术愿望清单<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我想看的艺术清单：<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ItemList</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">artworks</span>=<span class="string">&#123;myList&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onToggle</span>=<span class="string">&#123;handleToggleMyList&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>你想看的艺术清单：<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ItemList</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">artworks</span>=<span class="string">&#123;yourList&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onToggle</span>=<span class="string">&#123;handleToggleYourList&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ItemList</span>(<span class="params">&#123; artworks, onToggle &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;artworks.map(artwork =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;artwork.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">checked</span>=<span class="string">&#123;artwork.seen&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                onToggle(</span></span><br><span class="line"><span class="language-xml">                  artwork.id,</span></span><br><span class="line"><span class="language-xml">                  e.target.checked</span></span><br><span class="line"><span class="language-xml">                );</span></span><br><span class="line"><span class="language-xml">              &#125;&#125;</span></span><br><span class="line"><span class="language-xml">            /&gt;</span></span><br><span class="line"><span class="language-xml">            &#123;artwork.title&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通常来讲，<strong>你应该只直接修改你刚刚创建的对象</strong>。如果你正在插入一个<strong>新</strong>的 artwork，你可以修改它，但是如果你想要改变的是 state 中已经存在的东西，你就需要先拷贝一份了。</p>
<h3 id="3-7-9-使用-Immer-编写简洁的更新逻辑"><a href="#3-7-9-使用-Immer-编写简洁的更新逻辑" class="headerlink" title="3.7.9 使用 Immer 编写简洁的更新逻辑"></a>3.7.9 使用 Immer 编写简洁的更新逻辑</h3><p>在没有 mutation 的前提下更新嵌套数组可能会变得有点重复。<a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/updating-objects-in-state#write-concise-update-logic-with-immer">就像对对象一样</a>:</p>
<ul>
<li>通常情况下，你应该不需要更新处于非常深层级的 state 。如果你有此类需求，你或许需要<a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/choosing-the-state-structure#avoid-deeply-nested-state">调整一下数据的结构</a>，让数据变得扁平一些。</li>
<li>如果你不想改变 state 的数据结构，你也许会更喜欢使用 <a target="_blank" rel="noopener" href="https://github.com/immerjs/use-immer">Immer</a> ，它让你可以继续使用方便的，但会直接修改原值的语法，并负责为你生成拷贝值。</li>
</ul>
<p>下面是我们用 Immer 来重写的艺术愿望清单的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useImmer &#125; <span class="keyword">from</span> <span class="string">&#x27;use-immer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> nextId = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">const</span> initialList = [</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">0</span>, <span class="attr">title</span>: <span class="string">&#x27;Big Bellies&#x27;</span>, <span class="attr">seen</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">title</span>: <span class="string">&#x27;Lunar Landscape&#x27;</span>, <span class="attr">seen</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">title</span>: <span class="string">&#x27;Terracotta Army&#x27;</span>, <span class="attr">seen</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">BucketList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [myList, updateMyList] = <span class="title function_">useImmer</span>(</span><br><span class="line">    initialList</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">const</span> [yourList, updateYourList] = <span class="title function_">useImmer</span>(</span><br><span class="line">    initialList</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleToggleMyList</span>(<span class="params">id, nextSeen</span>) &#123;</span><br><span class="line">    <span class="title function_">updateMyList</span>(<span class="function"><span class="params">draft</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> artwork = draft.<span class="title function_">find</span>(<span class="function"><span class="params">a</span> =&gt;</span></span><br><span class="line">        a.<span class="property">id</span> === id</span><br><span class="line">      );</span><br><span class="line">      artwork.<span class="property">seen</span> = nextSeen;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleToggleYourList</span>(<span class="params">artworkId, nextSeen</span>) &#123;</span><br><span class="line">    <span class="title function_">updateYourList</span>(<span class="function"><span class="params">draft</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> artwork = draft.<span class="title function_">find</span>(<span class="function"><span class="params">a</span> =&gt;</span></span><br><span class="line">        a.<span class="property">id</span> === artworkId</span><br><span class="line">      );</span><br><span class="line">      artwork.<span class="property">seen</span> = nextSeen;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>艺术愿望清单<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我想看的艺术清单：<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ItemList</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">artworks</span>=<span class="string">&#123;myList&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onToggle</span>=<span class="string">&#123;handleToggleMyList&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>你想看的艺术清单：<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ItemList</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">artworks</span>=<span class="string">&#123;yourList&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onToggle</span>=<span class="string">&#123;handleToggleYourList&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ItemList</span>(<span class="params">&#123; artworks, onToggle &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;artworks.map(artwork =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;artwork.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">checked</span>=<span class="string">&#123;artwork.seen&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                onToggle(</span></span><br><span class="line"><span class="language-xml">                  artwork.id,</span></span><br><span class="line"><span class="language-xml">                  e.target.checked</span></span><br><span class="line"><span class="language-xml">                );</span></span><br><span class="line"><span class="language-xml">              &#125;&#125;</span></span><br><span class="line"><span class="language-xml">            /&gt;</span></span><br><span class="line"><span class="language-xml">            &#123;artwork.title&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请注意当使用 Immer 时，<strong>类似 <code>artwork.seen = nextSeen</code> 这种会产生 mutation 的语法不会再有任何问题了：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">updateMyTodos</span>(<span class="function"><span class="params">draft</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> artwork = draft.<span class="title function_">find</span>(<span class="function"><span class="params">a</span> =&gt;</span> a.<span class="property">id</span> === artworkId);</span><br><span class="line">  artwork.<span class="property">seen</span> = nextSeen;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这是因为你并不是在直接修改原始的 state，而是在修改 Immer 提供的一个特殊的 <code>draft</code> 对象。同理，你也可以为 <code>draft</code> 的内容使用 <code>push()</code> 和 <code>pop()</code> 这些会直接修改原值的方法。</p>
<p>在幕后，Immer 总是会根据你对 <code>draft</code> 的修改来从头开始构建下一个 state。这使得你的事件处理程序非常的简洁，同时也不会直接修改 state。</p>
<h3 id="3-7-10-摘要"><a href="#3-7-10-摘要" class="headerlink" title="3.7.10 摘要"></a>3.7.10 摘要</h3><ul>
<li>你可以把数组放入 state 中，但你不应该直接修改它。</li>
<li>不要直接修改数组，而是创建它的一份 <strong>新的</strong> 拷贝，然后使用新的数组来更新它的状态。</li>
<li>你可以使用 <code>[...arr, newItem]</code> 这样的数组展开语法来向数组中添加元素。</li>
<li>你可以使用 <code>filter()</code> 和 <code>map()</code> 来创建一个经过过滤或者变换的数组。</li>
<li>你可以使用 Immer 来保持代码简洁。</li>
</ul>
</article>
<div class="article-footer">
    <section id="license">
      <div class="header"><span>许可协议</span></div>
      <div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div>
    </section>
    

</div>

<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">较新文章</div><a href="/2024/11/26/cloud-mall-vue/">cloud-mall-vue</a></div><div class="item" id="next"><div class="note">较早文章</div><a href="/2024/09/06/rpc%E5%9F%BA%E7%A1%80/">rpc基础</a></div></section></div>






<footer class="page-footer footnote"><hr><div class="text"><div>
<span id="runtime_span"></span>
<script type="text/javascript">
function show_runtime() {
    window.setTimeout("show_runtime()", 1000);
    X = new Date("2023/11/20 17:00:00"); // 网站开始运行的日期和时间
    Y = new Date(); // 当前日期和时间
    T = (Y.getTime() - X.getTime()); // 网站运行的总毫秒数
    M = 24 * 60 * 60 * 1000; // 一天的毫秒数
    a = T / M; // 总天数
    A = Math.floor(a); // 总天数的整数部分
    b = (a - A) * 24; // 总小时数
    B = Math.floor(b); // 总小时数的整数部分
    c = (b - B) * 60; // 总分钟数
    C = Math.floor((b - B) * 60); // 总分钟数的整数部分
    D = Math.floor((c - C) * 60); // 总秒数
    runtime_span.innerHTML = "⏱️小破站至今运行 <span class='runtime'>" + A + "天" + B + "小时" + C + "分" + D + "秒</span>";
}
show_runtime();
</script> 
<img src="/assets/cat.gif" alt="" style="float: right; width: 30px;">
</div>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="false"><div class="widget-header dis-select"><span class="name">本文目录</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E7%AE%80%E4%BB%8B"><span class="toc-text">1. 简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E6%8F%8F%E8%BF%B0-UI"><span class="toc-text">2. 描述 UI</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E7%BB%84%E4%BB%B6"><span class="toc-text">2.1 组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-UI%E6%9E%84%E6%88%90"><span class="toc-text">2.1.1 UI构成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2-%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6"><span class="toc-text">2.1.2 定义组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-3-%E4%BD%BF%E7%94%A8%E7%BB%84%E4%BB%B6"><span class="toc-text">2.1.3 使用组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-4-%E5%B5%8C%E5%A5%97%E5%92%8C%E7%BB%84%E7%BB%87%E7%BB%84%E4%BB%B6"><span class="toc-text">2.1.4 嵌套和组织组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-5-%E7%BB%84%E4%BB%B6%E7%9A%84%E5%AF%BC%E5%85%A5%E4%B8%8E%E5%AF%BC%E5%87%BA"><span class="toc-text">2.1.5 组件的导入与导出</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-5-1-%E6%A0%B9%E7%BB%84%E4%BB%B6"><span class="toc-text">2.1.5.1 根组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-5-2-%E5%AF%BC%E5%85%A5%E5%92%8C%E5%AF%BC%E5%87%BA%E7%BB%84%E4%BB%B6"><span class="toc-text">2.1.5.2 导入和导出组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-5-3-%E4%BB%8E%E5%90%8C%E4%B8%80%E6%96%87%E4%BB%B6%E5%AF%BC%E5%87%BA%E5%92%8C%E5%AF%BC%E5%85%A5%E5%A4%9A%E4%B8%AA%E7%BB%84%E4%BB%B6"><span class="toc-text">2.1.5.3 从同一文件导出和导入多个组件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-JSX%E6%A0%87%E7%AD%BE%E8%AF%AD%E8%A8%80"><span class="toc-text">2.2 JSX标签语言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E5%B0%86%E6%A0%87%E7%AD%BE%E5%BC%95%E5%85%A5-JavaScript"><span class="toc-text">2.2.1 将标签引入 JavaScript</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-JSX-%E8%A7%84%E5%88%99"><span class="toc-text">2.2.2 JSX 规则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-1-%E5%8F%AA%E8%83%BD%E8%BF%94%E5%9B%9E%E4%B8%80%E4%B8%AA%E6%A0%B9%E5%85%83%E7%B4%A0"><span class="toc-text">2.2.2.1 只能返回一个根元素</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%A4%9A%E4%B8%AA-JSX-%E6%A0%87%E7%AD%BE%E9%9C%80%E8%A6%81%E8%A2%AB%E4%B8%80%E4%B8%AA%E7%88%B6%E5%85%83%E7%B4%A0%E5%8C%85%E8%A3%B9%EF%BC%9F"><span class="toc-text">为什么多个 JSX 标签需要被一个父元素包裹？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-2-%E6%A0%87%E7%AD%BE%E5%BF%85%E9%A1%BB%E9%97%AD%E5%90%88"><span class="toc-text">2.2.2.2 标签必须闭合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-3-%E4%BD%BF%E7%94%A8%E9%A9%BC%E5%B3%B0%E5%BC%8F%E5%91%BD%E5%90%8D%E6%B3%95"><span class="toc-text">2.2.2.3 使用驼峰式命名法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-%E5%B0%86-HTML-%E8%BD%AC%E5%8C%96%E4%B8%BA-JSX"><span class="toc-text">2.2.3 将 HTML 转化为 JSX</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-4-%E5%9C%A8-JSX-%E4%B8%AD%E9%80%9A%E8%BF%87%E5%A4%A7%E6%8B%AC%E5%8F%B7%E4%BD%BF%E7%94%A8-JavaScript"><span class="toc-text">2.2.4 在 JSX 中通过大括号使用 JavaScript</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-1-%E4%BD%BF%E7%94%A8%E5%BC%95%E5%8F%B7%E4%BC%A0%E9%80%92%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-text">2.2.4.1 使用引号传递字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-2-%E4%BD%BF%E7%94%A8%E5%A4%A7%E6%8B%AC%E5%8F%B7%EF%BC%9A%E4%B8%80%E6%89%87%E8%BF%9B%E5%85%A5-JavaScript-%E4%B8%96%E7%95%8C%E7%9A%84%E7%AA%97%E6%88%B7"><span class="toc-text">2.2.4.2 使用大括号：一扇进入 JavaScript 世界的窗户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-3-%E4%BD%BF%E7%94%A8-%E2%80%9C%E5%8F%8C%E5%A4%A7%E6%8B%AC%E5%8F%B7%E2%80%9D%EF%BC%9AJSX-%E4%B8%AD%E7%9A%84-CSS-%E5%92%8C-%E5%AF%B9%E8%B1%A1"><span class="toc-text">2.2.4.3 使用 “双大括号”：JSX 中的 CSS 和 对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-4-JavaScript-%E5%AF%B9%E8%B1%A1%E5%92%8C%E5%A4%A7%E6%8B%AC%E5%8F%B7%E7%9A%84%E6%9B%B4%E5%A4%9A%E5%8F%AF%E8%83%BD"><span class="toc-text">2.2.4.4 JavaScript 对象和大括号的更多可能</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E5%B1%9E%E6%80%A7%E4%BC%A0%E9%80%92"><span class="toc-text">2.3 父子组件属性传递</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-%E7%AE%80%E4%BB%8B"><span class="toc-text">2.3.1 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-%E5%90%91%E7%BB%84%E4%BB%B6%E4%BC%A0%E9%80%92-props"><span class="toc-text">2.3.2 向组件传递 props</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-%E7%BB%99-prop-%E6%8C%87%E5%AE%9A%E4%B8%80%E4%B8%AA%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-text">2.3.3 给 prop 指定一个默认值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-4-%E4%BD%BF%E7%94%A8-JSX-%E5%B1%95%E5%BC%80%E8%AF%AD%E6%B3%95%E4%BC%A0%E9%80%92-props"><span class="toc-text">2.3.4 使用 JSX 展开语法传递 props</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-5-%E5%B0%86-JSX-%E4%BD%9C%E4%B8%BA%E5%AD%90%E7%BB%84%E4%BB%B6%E4%BC%A0%E9%80%92"><span class="toc-text">2.3.5 将 JSX 作为子组件传递</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-6-Props-%E5%A6%82%E4%BD%95%E9%9A%8F%E6%97%B6%E9%97%B4%E5%8F%98%E5%8C%96"><span class="toc-text">2.3.6 Props 如何随时间变化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E6%9D%A1%E4%BB%B6%E6%B8%B2%E6%9F%93"><span class="toc-text">2.4 条件渲染</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-1-%E6%9D%A1%E4%BB%B6%E8%BF%94%E5%9B%9E-JSX"><span class="toc-text">2.4.1 条件返回 JSX</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-2-%E9%80%89%E6%8B%A9%E6%80%A7%E8%BF%94%E5%9B%9E-null"><span class="toc-text">2.4.2 选择性返回 null</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-3-%E9%80%89%E6%8B%A9%E6%80%A7%E5%9C%B0%E5%8C%85%E5%90%AB-JSX"><span class="toc-text">2.4.3 选择性地包含 JSX</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-4-%E4%B8%8E%E8%BF%90%E7%AE%97%E7%AC%A6%EF%BC%88-%EF%BC%89"><span class="toc-text">2.4.4 与运算符（&amp;&amp;）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-5-%E9%80%89%E6%8B%A9%E6%80%A7%E5%9C%B0%E5%B0%86-JSX-%E8%B5%8B%E5%80%BC%E7%BB%99%E5%8F%98%E9%87%8F"><span class="toc-text">2.4.5 选择性地将 JSX 赋值给变量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E6%B8%B2%E6%9F%93%E5%88%97%E8%A1%A8"><span class="toc-text">2.5 渲染列表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-1-%E4%BB%8E%E6%95%B0%E7%BB%84%E4%B8%AD%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE"><span class="toc-text">2.5.1 从数组中渲染数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-2-%E5%AF%B9%E6%95%B0%E7%BB%84%E9%A1%B9%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4"><span class="toc-text">2.5.2 对数组项进行过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-3-%E7%94%A8-key-%E4%BF%9D%E6%8C%81%E5%88%97%E8%A1%A8%E9%A1%B9%E7%9A%84%E9%A1%BA%E5%BA%8F"><span class="toc-text">2.5.3 用 key 保持列表项的顺序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-4-%E5%A6%82%E4%BD%95%E8%AE%BE%E7%BD%AE-key-%E5%80%BC"><span class="toc-text">2.5.4 如何设置 key 值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-%E4%BF%9D%E6%8C%81%E7%BB%84%E4%BB%B6%E7%BA%AF%E7%B2%B9"><span class="toc-text">2.6 保持组件纯粹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-1-%E7%BA%AF%E5%87%BD%E6%95%B0%EF%BC%9A%E7%BB%84%E4%BB%B6%E4%BD%9C%E4%B8%BA%E5%85%AC%E5%BC%8F"><span class="toc-text">2.6.1 纯函数：组件作为公式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-2-%E5%89%AF%E4%BD%9C%E7%94%A8%EF%BC%9A%EF%BC%88%E4%B8%8D%E7%AC%A6%E5%90%88%EF%BC%89%E9%A2%84%E6%9C%9F%E7%9A%84%E5%90%8E%E6%9E%9C"><span class="toc-text">2.6.2 副作用：（不符合）预期的后果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-3-%E5%B1%80%E9%83%A8-mutation%EF%BC%9A%E7%BB%84%E4%BB%B6%E7%9A%84%E5%B0%8F%E7%A7%98%E5%AF%86"><span class="toc-text">2.6.3 局部 mutation：组件的小秘密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-4-%E5%93%AA%E4%BA%9B%E5%9C%B0%E6%96%B9-%E5%8F%AF%E8%83%BD-%E5%BC%95%E5%8F%91%E5%89%AF%E4%BD%9C%E7%94%A8"><span class="toc-text">2.6.4 哪些地方 可能 引发副作用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#React-%E4%B8%BA%E4%BD%95%E4%BE%A7%E9%87%8D%E4%BA%8E%E7%BA%AF%E5%87%BD%E6%95%B0"><span class="toc-text">React 为何侧重于纯函数?</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-5-%E6%91%98%E8%A6%81"><span class="toc-text">2.6.5 摘要</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-7-%E5%B0%86-UI-%E8%A7%86%E4%B8%BA%E6%A0%91"><span class="toc-text">2.7 将 UI 视为树</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-1-%E6%A0%91%E7%BB%93%E6%9E%84"><span class="toc-text">2.7.1 树结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-2-%E6%B8%B2%E6%9F%93%E6%A0%91"><span class="toc-text">2.7.2 渲染树</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%82%A3%E4%B9%88%E6%B8%B2%E6%9F%93%E6%A0%91%E4%B8%AD%E7%9A%84-HTML-%E6%A0%87%E7%AD%BE%E5%9C%A8%E5%93%AA%E9%87%8C%E5%91%A2%EF%BC%9F"><span class="toc-text">那么渲染树中的 HTML 标签在哪里呢？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-3-%E6%A8%A1%E5%9D%97%E4%BE%9D%E8%B5%96%E6%A0%91"><span class="toc-text">2.7.3 模块依赖树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-4-%E6%91%98%E8%A6%81"><span class="toc-text">2.7.4 摘要</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E4%BA%A4%E4%BA%92"><span class="toc-text">3. 交互</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%93%8D%E5%BA%94%E4%BA%8B%E4%BB%B6"><span class="toc-text">3.1 响应事件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-%E6%B7%BB%E5%8A%A0%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0"><span class="toc-text">3.1.1 添加事件处理函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-%E5%9C%A8%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0%E4%B8%AD%E8%AF%BB%E5%8F%96-props"><span class="toc-text">3.1.2 在事件处理函数中读取 props</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-3-%E5%B0%86%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0%E4%BD%9C%E4%B8%BA-props-%E4%BC%A0%E9%80%92"><span class="toc-text">3.1.3 将事件处理函数作为 props 传递</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-4-%E5%91%BD%E5%90%8D%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0-prop"><span class="toc-text">3.1.4 命名事件处理函数 prop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-5-%E4%BA%8B%E4%BB%B6%E4%BC%A0%E6%92%AD"><span class="toc-text">3.1.5 事件传播</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-6-%E9%98%BB%E6%AD%A2%E4%BC%A0%E6%92%AD"><span class="toc-text">3.1.6 阻止传播</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8D%95%E8%8E%B7%E9%98%B6%E6%AE%B5%E4%BA%8B%E4%BB%B6"><span class="toc-text">捕获阶段事件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-7-%E4%BC%A0%E9%80%92%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0%E4%BD%9C%E4%B8%BA%E4%BA%8B%E4%BB%B6%E4%BC%A0%E6%92%AD%E7%9A%84%E6%9B%BF%E4%BB%A3%E6%96%B9%E6%A1%88"><span class="toc-text">3.1.7 传递处理函数作为事件传播的替代方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-8-%E9%98%BB%E6%AD%A2%E9%BB%98%E8%AE%A4%E8%A1%8C%E4%B8%BA"><span class="toc-text">3.1.8 阻止默认行为</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-9-%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0%E5%8F%AF%E4%BB%A5%E5%8C%85%E5%90%AB%E5%89%AF%E4%BD%9C%E7%94%A8%E5%90%97%EF%BC%9F"><span class="toc-text">3.1.9 事件处理函数可以包含副作用吗？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-10-%E6%91%98%E8%A6%81"><span class="toc-text">3.1.10 摘要</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-State%EF%BC%9A%E7%BB%84%E4%BB%B6%E7%9A%84%E8%AE%B0%E5%BF%86"><span class="toc-text">3.2 State：组件的记忆</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-%E5%BD%93%E6%99%AE%E9%80%9A%E7%9A%84%E5%8F%98%E9%87%8F%E6%97%A0%E6%B3%95%E6%BB%A1%E8%B6%B3%E6%97%B6"><span class="toc-text">3.2.1 当普通的变量无法满足时</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA-state-%E5%8F%98%E9%87%8F"><span class="toc-text">3.2.2 添加一个 state 变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-3-%E9%81%87%E8%A7%81%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA-Hook"><span class="toc-text">3.2.3 遇见你的第一个 Hook</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-4-%E5%89%96%E6%9E%90-useState"><span class="toc-text">3.2.4 剖析 useState</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-5-%E8%B5%8B%E4%BA%88%E4%B8%80%E4%B8%AA%E7%BB%84%E4%BB%B6%E5%A4%9A%E4%B8%AA-state-%E5%8F%98%E9%87%8F"><span class="toc-text">3.2.5 赋予一个组件多个 state 变量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#React-%E5%A6%82%E4%BD%95%E7%9F%A5%E9%81%93%E8%BF%94%E5%9B%9E%E5%93%AA%E4%B8%AA-state"><span class="toc-text">React 如何知道返回哪个 state</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-6-State-%E6%98%AF%E9%9A%94%E7%A6%BB%E4%B8%94%E7%A7%81%E6%9C%89%E7%9A%84"><span class="toc-text">3.2.6 State 是隔离且私有的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-7-%E6%91%98%E8%A6%81"><span class="toc-text">3.2.7 摘要</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E6%B8%B2%E6%9F%93%E5%92%8C%E6%8F%90%E4%BA%A4"><span class="toc-text">3.3 渲染和提交</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-%E6%AD%A5%E9%AA%A4-1-%E8%A7%A6%E5%8F%91%E4%B8%80%E6%AC%A1%E6%B8%B2%E6%9F%93"><span class="toc-text">3.3.1 步骤 1: 触发一次渲染</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-%E6%AD%A5%E9%AA%A4-2-React-%E6%B8%B2%E6%9F%93%E4%BD%A0%E7%9A%84%E7%BB%84%E4%BB%B6"><span class="toc-text">3.3.2 步骤 2: React 渲染你的组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-text">性能优化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-3-%E6%AD%A5%E9%AA%A4-3-React-%E6%8A%8A%E6%9B%B4%E6%94%B9%E6%8F%90%E4%BA%A4%E5%88%B0-DOM-%E4%B8%8A"><span class="toc-text">3.3.3 步骤 3: React 把更改提交到 DOM 上</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-4-%E5%B0%BE%E5%A3%B0%EF%BC%9A%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BB%98%E5%88%B6"><span class="toc-text">3.3.4 尾声：浏览器绘制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-5-%E6%91%98%E8%A6%81"><span class="toc-text">3.3.5 摘要</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-state-%E5%A6%82%E5%90%8C%E4%B8%80%E5%BC%A0%E5%BF%AB%E7%85%A7"><span class="toc-text">3.4 state 如同一张快照</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-1-%E8%AE%BE%E7%BD%AE-state-%E4%BC%9A%E8%A7%A6%E5%8F%91%E6%B8%B2%E6%9F%93"><span class="toc-text">3.4.1 设置 state 会触发渲染</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-2-%E6%B8%B2%E6%9F%93%E4%BC%9A%E5%8F%8A%E6%97%B6%E7%94%9F%E6%88%90%E4%B8%80%E5%BC%A0%E5%BF%AB%E7%85%A7"><span class="toc-text">3.4.2 渲染会及时生成一张快照</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-4-%E9%9A%8F%E6%97%B6%E9%97%B4%E5%8F%98%E5%8C%96%E7%9A%84-state"><span class="toc-text">3.4.4 随时间变化的 state</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-5-%E6%91%98%E8%A6%81"><span class="toc-text">3.4.5 摘要</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-%E6%8A%8A%E4%B8%80%E7%B3%BB%E5%88%97-state-%E6%9B%B4%E6%96%B0%E5%8A%A0%E5%85%A5%E9%98%9F%E5%88%97"><span class="toc-text">3.5 把一系列 state 更新加入队列</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-1-React-%E4%BC%9A%E5%AF%B9-state-%E6%9B%B4%E6%96%B0%E8%BF%9B%E8%A1%8C%E6%89%B9%E5%A4%84%E7%90%86"><span class="toc-text">3.5.1 React 会对 state 更新进行批处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-2-%E5%9C%A8%E4%B8%8B%E6%AC%A1%E6%B8%B2%E6%9F%93%E5%89%8D%E5%A4%9A%E6%AC%A1%E6%9B%B4%E6%96%B0%E5%90%8C%E4%B8%80%E4%B8%AA-state"><span class="toc-text">3.5.2 在下次渲染前多次更新同一个 state</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-3-%E5%A6%82%E6%9E%9C%E4%BD%A0%E5%9C%A8%E6%9B%BF%E6%8D%A2-state-%E5%90%8E%E6%9B%B4%E6%96%B0-state-%E4%BC%9A%E5%8F%91%E7%94%9F%E4%BB%80%E4%B9%88"><span class="toc-text">3.5.3 如果你在替换 state 后更新 state 会发生什么?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-4-%E5%A6%82%E6%9E%9C%E4%BD%A0%E5%9C%A8%E6%9B%B4%E6%96%B0-state-%E5%90%8E%E6%9B%BF%E6%8D%A2-state-%E4%BC%9A%E5%8F%91%E7%94%9F%E4%BB%80%E4%B9%88"><span class="toc-text">3.5.4 如果你在更新 state 后替换 state 会发生什么 ?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-5-%E5%91%BD%E5%90%8D%E6%83%AF%E4%BE%8B"><span class="toc-text">3.5.5 命名惯例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-6-%E6%91%98%E8%A6%81"><span class="toc-text">3.5.6 摘要</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-%E6%9B%B4%E6%96%B0-state-%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1"><span class="toc-text">3.6 更新 state 中的对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-1-%E4%BB%80%E4%B9%88%E6%98%AF-mutation%EF%BC%9F"><span class="toc-text">3.6.1 什么是 mutation？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-2-%E5%B0%86-state-%E8%A7%86%E4%B8%BA%E5%8F%AA%E8%AF%BB%E7%9A%84"><span class="toc-text">3.6.2 将 state 视为只读的</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%80%E9%83%A8-mutation-%E6%98%AF%E5%8F%AF%E4%BB%A5%E6%8E%A5%E5%8F%97%E7%9A%84"><span class="toc-text">局部 mutation 是可以接受的</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-3-%E4%BD%BF%E7%94%A8%E5%B1%95%E5%BC%80%E8%AF%AD%E6%B3%95%E5%A4%8D%E5%88%B6%E5%AF%B9%E8%B1%A1"><span class="toc-text">3.6.3 使用展开语法复制对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%B8%80%E4%B8%AA%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0%E6%9D%A5%E6%9B%B4%E6%96%B0%E5%A4%9A%E4%B8%AA%E5%AD%97%E6%AE%B5"><span class="toc-text">使用一个事件处理函数来更新多个字段</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-4-%E6%9B%B4%E6%96%B0%E4%B8%80%E4%B8%AA%E5%B5%8C%E5%A5%97%E5%AF%B9%E8%B1%A1"><span class="toc-text">3.6.4 更新一个嵌套对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E5%B9%B6%E9%9D%9E%E6%98%AF%E7%9C%9F%E6%AD%A3%E5%B5%8C%E5%A5%97%E7%9A%84"><span class="toc-text">对象并非是真正嵌套的</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-5-%E4%BD%BF%E7%94%A8-Immer-%E7%BC%96%E5%86%99%E7%AE%80%E6%B4%81%E7%9A%84%E6%9B%B4%E6%96%B0%E9%80%BB%E8%BE%91"><span class="toc-text">3.6.5 使用 Immer 编写简洁的更新逻辑</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Immer-%E6%98%AF%E5%A6%82%E4%BD%95%E8%BF%90%E8%A1%8C%E7%9A%84%EF%BC%9F"><span class="toc-text">Immer 是如何运行的？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%9C%A8-React-%E4%B8%AD%E4%B8%8D%E6%8E%A8%E8%8D%90%E7%9B%B4%E6%8E%A5%E4%BF%AE%E6%94%B9-state%EF%BC%9F"><span class="toc-text">为什么在 React 中不推荐直接修改 state？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-6-%E6%91%98%E8%A6%81"><span class="toc-text">3.6.6 摘要</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-7-%E6%9B%B4%E6%96%B0-state-%E4%B8%AD%E7%9A%84%E6%95%B0%E7%BB%84"><span class="toc-text">3.7 更新 state 中的数组</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-1-%E5%9C%A8%E6%B2%A1%E6%9C%89-mutation-%E7%9A%84%E5%89%8D%E6%8F%90%E4%B8%8B%E6%9B%B4%E6%96%B0%E6%95%B0%E7%BB%84"><span class="toc-text">3.7.1 在没有 mutation 的前提下更新数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-2-%E5%90%91%E6%95%B0%E7%BB%84%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%85%83%E7%B4%A0"><span class="toc-text">3.7.2 向数组中添加元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-3-%E4%BB%8E%E6%95%B0%E7%BB%84%E4%B8%AD%E5%88%A0%E9%99%A4%E5%85%83%E7%B4%A0"><span class="toc-text">3.7.3 从数组中删除元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-4-%E8%BD%AC%E6%8D%A2%E6%95%B0%E7%BB%84"><span class="toc-text">3.7.4 转换数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-5-%E6%9B%BF%E6%8D%A2%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E5%85%83%E7%B4%A0"><span class="toc-text">3.7.5 替换数组中的元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-6-%E5%90%91%E6%95%B0%E7%BB%84%E4%B8%AD%E6%8F%92%E5%85%A5%E5%85%83%E7%B4%A0"><span class="toc-text">3.7.6 向数组中插入元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-7-%E5%85%B6%E4%BB%96%E6%94%B9%E5%8F%98%E6%95%B0%E7%BB%84%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-text">3.7.7 其他改变数组的情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-8-%E6%9B%B4%E6%96%B0%E6%95%B0%E7%BB%84%E5%86%85%E9%83%A8%E7%9A%84%E5%AF%B9%E8%B1%A1"><span class="toc-text">3.7.8 更新数组内部的对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-9-%E4%BD%BF%E7%94%A8-Immer-%E7%BC%96%E5%86%99%E7%AE%80%E6%B4%81%E7%9A%84%E6%9B%B4%E6%96%B0%E9%80%BB%E8%BE%91"><span class="toc-text">3.7.9 使用 Immer 编写简洁的更新逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-10-%E6%91%98%E8%A6%81"><span class="toc-text">3.7.10 摘要</span></a></li></ol></li></ol></li></ol></div><div class="widget-footer"><a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><!-- Icon from Solar by 480 Design - https://creativecommons.org/licenses/by/4.0/ --><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"><path stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/><path d="M7 3.338A9.95 9.95 0 0 1 12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12c0-1.821.487-3.53 1.338-5"/></g></svg><span>回到顶部</span></a></div></widget>
</div></aside><div class='float-panel'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">


<script type="text/javascript">
  window.canonical = {"originalHost":null,"officialHosts":["localhost"],"encoded":""};
  const ctx = {
    date_suffix: {
      just: `刚刚`,
      min: `分钟前`,
      hour: `小时前`,
      day: `天前`,
    },
    root : `/`,
    tag_plugins: {
      chat: Object.assign({"api":"https://siteinfo.listentothewind.cn/api/v1"}),
    }
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"skip_search":null,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
    loading: `https://api.iconify.design/eos-icons:three-dots-loading.svg?color=%231cd0fd`,
  };
  const deps = {
    jquery: `https://gcore.jsdelivr.net/npm/jquery@3.7/dist/jquery.min.js`,
    marked: `https://gcore.jsdelivr.net/npm/marked@13.0/lib/marked.umd.min.js`,
    lazyload: `/%5Bobject%20Object%5D`
  }
  

</script>

<script type="text/javascript">
  
  function RunItem() {
    this.list = []; // 存放回调函数
    this.start = () => {
      for (var i = 0; i < this.list.length; i++) {
        this.list[i].run();
      }
    };
    this.push = (fn, name, setRequestAnimationFrame = true) => {
      let myfn = fn
      if (setRequestAnimationFrame) {
        myfn = () => {
          utils.requestAnimationFrame(fn)
        }
      }
      var f = new Item(myfn, name);
      this.list.push(f);
    };
    this.remove = (name) => {
      for (let index = 0; index < this.list.length; index++) {
        const e = this.list[index];
        if (e.name == name) {
          this.list.splice(index, 1);
        }
      }
    }
    // 构造一个可以run的对象
    function Item(fn, name) {
      // 函数名称
      this.name = name || fn.name;
      // run方法
      this.run = () => {
        try {
          fn()
        } catch (error) {
          console.log(error);
        }
      };
    }
  }

  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')) {
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function () {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },

    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      const maxRetry = 3;
      let retryCount = 0;

      return new Promise((resolve, reject) => {
        const load = () => {
          utils.onLoading?.(el);

          let timedOut = false;
          const timeout = setTimeout(() => {
            timedOut = true;
            console.warn('[request] 超时:', url);

            if (++retryCount >= maxRetry) {
              utils.onLoadFailure?.(el);
              onFailure?.();
              reject('请求超时');
            } else {
              setTimeout(load, 1000);
            }
          }, 5000);

          fetch(url).then(resp => {
            if (timedOut) return;
            clearTimeout(timeout);

            if (!resp.ok) throw new Error('响应失败');
            return resp;
          }).then(data => {
            if (timedOut) return;
            utils.onLoadSuccess?.(el);
            callback(data);
            resolve(data);
          }).catch(err => {
            clearTimeout(timeout);
            console.warn('[request] 错误:', err);

            if (++retryCount >= maxRetry) {
              utils.onLoadFailure?.(el);
              onFailure?.();
              reject(err);
            } else {
              setTimeout(load, 1000);
            }
          });
        };

        load();
      });
    },
    requestWithoutLoading: (url, options = {}, maxRetry = 2, timeout = 5000) => {
      return new Promise((resolve, reject) => {
        let retryCount = 0;

        const tryRequest = () => {
          let timedOut = false;
          const timer = setTimeout(() => {
            timedOut = true;
            if (++retryCount > maxRetry) reject('timeout');
            else tryRequest();
          }, timeout);

          fetch(url, options)
            .then(resp => {
              clearTimeout(timer);
              if (!resp.ok) throw new Error('bad response');
              resolve(resp);
            })
            .catch(err => {
              clearTimeout(timer);
              if (++retryCount > maxRetry) reject(err);
              else setTimeout(tryRequest, 500);
            });
        };

        tryRequest();
      });
    },
    /********************** requestAnimationFrame ********************************/
    // 1、requestAnimationFrame 会把每一帧中的所有 DOM 操作集中起来，在一次重绘或回流中就完成，并且重绘或回流的时间间隔紧紧跟随浏览器的刷新频率，一般来说，这个频率为每秒60帧。
    // 2、在隐藏或不可见的元素中，requestAnimationFrame 将不会进行重绘或回流，这当然就意味着更少的的 cpu，gpu 和内存使用量。
    requestAnimationFrame: (fn) => {
      if (!window.requestAnimationFrame) {
        window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame;
      }
      window.requestAnimationFrame(fn)
    },
    dark: {},
  };

  // utils.dark.mode 当前模式 dark or light
  // utils.dark.toggle() 暗黑模式触发器
  // utils.dark.push(callBack[,"callBackName"]) 传入触发器回调函数
  utils.dark.method = {
    toggle: new RunItem(),
  };
  utils.dark = Object.assign(utils.dark, {
    push: utils.dark.method.toggle.push,
  });
</script>
<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>
<script type="text/javascript">
  (() => {
    const tagSwitchers = document.querySelectorAll('.tag-subtree.parent-tag > a > .tag-switcher-wrapper')
    for (const tagSwitcher of tagSwitchers) {
      tagSwitcher.addEventListener('click', (e) => {
        const parent = e.target.closest('.tag-subtree.parent-tag')
        parent.classList.toggle('expanded')
        e.preventDefault()
      })
    }

    // Get active tag from query string, then activate it.
    const urlParams = new URLSearchParams(window.location.search)
    const activeTag = urlParams.get('tag')
    if (activeTag) {
      let tag = document.querySelector(`.tag-subtree[data-tag="${activeTag}"]`)
      if (tag) {
        tag.querySelector('a').classList.add('active')
        
        while (tag) {
          tag.classList.add('expanded')
          tag = tag.parentElement.closest('.tag-subtree.parent-tag')
        }
      }
    }
  })()
</script>

<script async src="https://gcore.jsdelivr.net/npm/vanilla-lazyload@19.1/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
    callback_loaded: (el) => {
      el.classList.add('loaded');
      const wrapper = el.closest('.lazy-box');
      const icon = wrapper?.querySelector('.lazy-icon');
      if (icon) icon.remove();
    }
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });

  window.wrapLazyloadImages = (container) => {
    if (typeof container === 'string') {
      container = document.querySelector(container);
    }
    if (!container) return;
    
    const images = container.querySelectorAll('img');
    images.forEach((img) => {
      if (img.classList.contains('lazy')) return;

      const src = img.getAttribute('src');
      if (!src) return;

      const wrapper = document.createElement('div');
      wrapper.className = 'lazy-box';

      const newImg = img.cloneNode();
      newImg.removeAttribute('src');
      newImg.setAttribute('data-src', src);
      newImg.classList.add('lazy');

      const icon = document.createElement('div');
      icon.className = 'lazy-icon';
      if (def.loading) {
        icon.style.backgroundImage = `url("${def.loading}")`;
      }

      wrapper.appendChild(newImg);
      wrapper.appendChild(icon);

      img.replaceWith(wrapper);
    });

    // 通知 LazyLoad 更新
    if (window.lazyLoadInstance?.update) {
      window.lazyLoadInstance.update();
    }
  }
  
</script>

<!-- required -->
<script src="/js/main.js?v=1.33.1" defer></script>

<script type="text/javascript">
  const applyTheme = (theme) => {
    if (theme === 'auto') {
      document.documentElement.removeAttribute('data-theme')
    } else {
      document.documentElement.setAttribute('data-theme', theme)
    }

    // applyThemeToGiscus(theme)
  }

  // FIXME: 这会导致无法使用 preferred_color_scheme 以外的主题
  const applyThemeToGiscus = (theme) => {
    // theme = theme === 'auto' ? 'preferred_color_scheme' : theme
    const cmt = document.getElementById('giscus')
    if (cmt) {
      // This works before giscus load.
      cmt.setAttribute('data-theme', theme)
    }

    const iframe = document.querySelector('#comments > section.giscus > iframe')
    if (iframe) {
      // This works after giscus loaded.
      const src = iframe.src
      const newSrc = src.replace(/theme=[\w]+/, `theme=${theme}`)
      iframe.src = newSrc
    }
  }

  const switchTheme = () => {
    // light -> dark -> auto -> light -> ...
    const currentTheme = document.documentElement.getAttribute('data-theme')
    let newTheme;
    switch (currentTheme) {
      case 'light':
        newTheme = 'dark'
        break
      case 'dark':
        newTheme = 'auto'
        break
      default:
        newTheme = 'light'
    }
    applyTheme(newTheme)
    window.localStorage.setItem('Stellar.theme', newTheme)
    utils.dark.mode = newTheme === 'auto' ? (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light") : newTheme;
    utils.dark.method.toggle.start();

    const messages = {
      light: `切换到浅色模式`,
      dark: `切换到深色模式`,
      auto: `切换到跟随系统配色`,
    }
    hud?.toast?.(messages[newTheme])
  }

  (() => {
    // Apply user's preferred theme, if any.
    const theme = window.localStorage.getItem('Stellar.theme')
    if (theme !== null) {
      applyTheme(theme)
    } else {
      utils.dark.mode = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
    }
    utils.dark.method.toggle.start();
  })()
</script>


<!-- optional -->



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"rating":{"js":"/js/services/rating.js","api":"https://star-vote.xaox.cc/api/rating"},"vote":{"js":"/js/services/vote.js","api":"https://star-vote.xaox.cc/api/vote"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"friends_and_posts":{"js":"/js/services/friends_and_posts.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"},"voice":{"js":"/js/plugins/voice.js"},"video":{"js":"/js/plugins/video.js"},"download-file":{"js":"/js/plugins/download-file.js"},"twikoo":{"js":"/js/services/twikoo_latest_comment.js"},"waline":{"js":"/js/services/waline_latest_comment.js"},"artalk":{"js":"/js/services/artalk_latest_comment.js"},"giscus":{"js":"/js/services/giscus_latest_comment.js"},"contributors":{"edit_this_page":{"_posts/":null,"wiki/stellar/":"https://github.com/xaoxuu/hexo-theme-stellar-docs/blob/main/"},"js":"/js/services/contributors.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else if (id == 'voice') {
        ctx.voiceAudios = document.querySelectorAll('.voice>audio');
        if (ctx.voiceAudios?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            createVoiceDom(ctx.voiceAudios);
          });
        }
      } else if (id == 'video') {
        ctx.videos = document.querySelectorAll('.video>video');
        if (ctx.videos?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            videoEvents(ctx.videos);
          });
        }
      } else if (id == 'download-file') {
        ctx.files = document.querySelectorAll('.file');
        if (ctx.files?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            downloadFileEvent(ctx.files);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }

    // chat iphone time
    let phoneTimes = document.querySelectorAll('.chat .status-bar .time');

    if (phoneTimes.length > 0) {
      NowTime();
      var date = new Date();
      var sec = date.getSeconds();
      var firstAdjustInterval = setInterval(firstAdjustTime, 1000 * (60 - sec));
    }

    function firstAdjustTime() {
      NowTime();
      clearInterval(firstAdjustInterval);
      setInterval(NowTime, 1000 * 60);
    }

    function NowTime() {
      for (let i = 0; i < phoneTimes.length; ++i) {
        var timeSpan = phoneTimes[i];
        var date = new Date();
        var hour = date.getHours();
        var min = date.getMinutes();
        timeSpan.innerHTML = check(hour) + ":" + check(min);
      }
    };

    function check(val) {
      if (val < 10) {
        return ("0" + val);
      }
      return (val);
    }

    // chat quote
    const chat_quote_obverser = new IntersectionObserver((entries, observer) => {
      entries.filter((entry) => { return entry.isIntersecting }).sort((a, b) => a.intersectionRect.y !== b.intersectionRect.y ? a.intersectionRect.y - b.intersectionRect.y : a.intersectionRect.x - b.intersectionRect.x).forEach((entry, index) => {
          observer.unobserve(entry.target);
          setTimeout(() => {
            entry.target.classList.add('quote-blink');
            setTimeout(() => {
              entry.target.classList.remove('quote-blink');
            }, 1000);
          }, Math.max(100, 16) * (index + 1));
        });
    });

    var chatQuotes = document.querySelectorAll(".chat .talk .quote");
    chatQuotes.forEach((quote) => {
      quote.addEventListener('click', function () {
        var chatCellDom = document.getElementById("quote-" + quote.getAttribute("quotedCellTag"));
        if (chatCellDom) {
          var chatDiv = chatCellDom.parentElement;
          var mid = chatDiv.clientHeight / 2;
          var offsetTop = chatCellDom.offsetTop;
          if (offsetTop > mid - chatCellDom.clientHeight / 2) {
            chatDiv.scrollTo({
              top: chatCellDom.offsetTop - mid + chatCellDom.clientHeight / 2,
              behavior: "smooth"
            });
          } else {
            chatDiv.scrollTo({
              top: 0,
              behavior: "smooth"
            });
          }
          chat_quote_obverser.observe(chatCellDom);
        }
      });
    });
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://gcore.jsdelivr.net/npm/flying-pages@2/flying-pages.min.js"></script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://gcore.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css`,
    js: `https://gcore.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js`
  };
  var selector = '[data-fancybox]:not(.error), .with-fancybox .atk-content img:not([atk-emoticon])';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const memos = document.getElementsByClassName('ds-memos');
    if (memos != undefined && memos.length > 0) {
      needFancybox = true;
    }
    const fancybox = document.getElementsByClassName('with-fancybox');
    if (fancybox != undefined && fancybox.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `复制成功`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
